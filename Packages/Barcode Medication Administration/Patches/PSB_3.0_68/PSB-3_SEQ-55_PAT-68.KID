Released PSB*3*68 SEQ #55
Extracted from mail message
**KIDS**:PSB*3.0*68^

**INSTALL NAME**
PSB*3.0*68
"BLD",8247,0)
PSB*3.0*68^BAR CODE MED ADMIN^0^3120416^y
"BLD",8247,1,0)
^^95^95^3120326^
"BLD",8247,1,1,0)
*************************************************************************
"BLD",8247,1,2,0)
 IMPORTANT: PATCH PSJ*5*267 MUST BE INSTALLED BEFORE THE INSTALLATION 
"BLD",8247,1,3,0)
            OF THIS PATCH.
"BLD",8247,1,4,0)
 
"BLD",8247,1,5,0)
 BCMA patch PSB*3*68 contains changes that will not function until patch 
"BLD",8247,1,6,0)
 PSJ*5*267 is installed. Both patches, PSJ*5*267 and PSB*3*68 need to be
"BLD",8247,1,7,0)
 installed for Inpatient Medications and BCMA to function correctly.
"BLD",8247,1,8,0)
*************************************************************************
"BLD",8247,1,9,0)
 
"BLD",8247,1,10,0)
ATTENTION: This patch includes a new Graphical User Interface (GUI) 
"BLD",8247,1,11,0)
executable file. Installation of this GUI is required immediately after 
"BLD",8247,1,12,0)
the KIDS install for the Patch to function.
"BLD",8247,1,13,0)
 
"BLD",8247,1,14,0)
This version of BCMA was successfully tested in the field against Wireless
"BLD",8247,1,15,0)
Medication Administration version 4.8 at Pittsburgh and Loma Linda.
"BLD",8247,1,16,0)
 
"BLD",8247,1,17,0)
For retrieval and installation instructions, please see the Client
"BLD",8247,1,18,0)
Installation Instructions section.
"BLD",8247,1,19,0)
 
"BLD",8247,1,20,0)
The Special Instructions and Other Print Info Project addresses 
"BLD",8247,1,21,0)
enhancements identified during Inpatient Medications Requirements for 
"BLD",8247,1,22,0)
Special Focus Group Initial Request Analysis (IMR SFG IRA) Phase 
"BLD",8247,1,23,0)
III/Phase IV, as well as modifications requested by the Bar Code
"BLD",8247,1,24,0)
Medication Administration (BCMA) and Inpatient Medications workgroups.  
"BLD",8247,1,25,0)
 
"BLD",8247,1,26,0)
The Inpatient Pharmacy patch PSJ*5*267 is also being released as part of
"BLD",8247,1,27,0)
these enhancements.  The projects purpose is to Standardize the character
"BLD",8247,1,28,0)
length between CPRS Provider's Comment, Inpatient Medications Special
"BLD",8247,1,29,0)
Instructions, and the IV Pharmacy Other Print Information fields.
"BLD",8247,1,30,0)
 
"BLD",8247,1,31,0)
The Inpatient Pharmacy patch PSJ*5*267 will add new fields to Inpatient 
"BLD",8247,1,32,0)
Medication to support an unlimited amount of text for Special 
"BLD",8247,1,33,0)
Instructions and Other Print Info (SI/OPI). 
"BLD",8247,1,34,0)
 
"BLD",8247,1,35,0)
1. BCMA Remote Procedure Calls (RPC) will be modified to send over the new
"BLD",8247,1,36,0)
   Inpatient Medications SI/OPI fields in an unlimited format to the BCMA
"BLD",8247,1,37,0)
   GUI client.
"BLD",8247,1,38,0)
 
"BLD",8247,1,39,0)
2. For backwards compatibility, of existing Active orders on file that
"BLD",8247,1,40,0)
   were using the old fixed length SI/OPI fields, then this information 
"BLD",8247,1,41,0)
   will be included in the new unlimited format also.
"BLD",8247,1,42,0)
 
"BLD",8247,1,43,0)
3. Modify the following reports to print the unlimited SI/OPI information:
"BLD",8247,1,44,0)
    a. Medication Administration History (MAH) Report
"BLD",8247,1,45,0)
    b. Display Order detail Report
"BLD",8247,1,46,0)
    c. Due List Report
"BLD",8247,1,47,0)
    d. IV Bag Status Report
"BLD",8247,1,48,0)
    e. Cover Sheet Report - Medication Overview Report
"BLD",8247,1,49,0)
    f. Cover Sheet Report - PRN Overview Report
"BLD",8247,1,50,0)
    g. Cover Sheet Report - IV Overview Report
"BLD",8247,1,51,0)
    h. Cover Sheet Report - Expired/DC'd/Expiring Report
"BLD",8247,1,52,0)
    i. BCMA Backup System (BCBU) Print MAR for All Wards
"BLD",8247,1,53,0)
    j. BCMA Backup System (BCBU) Print MAR for Selected Patient
"BLD",8247,1,54,0)
    k. BCMA Backup System (BCBU) Print MAR for Selected Ward
"BLD",8247,1,55,0)
 
"BLD",8247,1,56,0)
4. Add new check box field to allow if the unlimited text will be printed
"BLD",8247,1,57,0)
   on the following reports:
"BLD",8247,1,58,0)
    a. Due List Report
"BLD",8247,1,59,0)
    b. IV Bag Status Report
"BLD",8247,1,60,0)
    c. Cover Sheet Report - Medication Overview Report
"BLD",8247,1,61,0)
    d. Cover Sheet Report - PRN Overview Report
"BLD",8247,1,62,0)
    e. Cover Sheet Report - IV Overview Report
"BLD",8247,1,63,0)
    f. Cover Sheet Report - Expired/DC'd/Expiring Report
"BLD",8247,1,64,0)
 
"BLD",8247,1,65,0)
5. BCMA Client:
"BLD",8247,1,66,0)
    a. Added window to display unlimited Special Instructions / Other
"BLD",8247,1,67,0)
       Print Info via menu, right-click, and function key (F6).  This
"BLD",8247,1,68,0)
       window is also used to display Special Instructions / Other Print
"BLD",8247,1,69,0)
       Info when an order is flagged in Inpatient Medications and is given
"BLD",8247,1,70,0)
       in BCMA.
"BLD",8247,1,71,0)
    b. Fields which displayed Special Instructions / Other Print Info in
"BLD",8247,1,72,0)
       forms were widened to 80 characters and have vertical scroll.
"BLD",8247,1,73,0)
    c. Added Last Injections Site column to the Unit Dose VDL to show the 
"BLD",8247,1,74,0)
       what the last site was per Orderable item.
"BLD",8247,1,75,0)
    d. Enhanced the Injection Site dialog window to show two 
"BLD",8247,1,76,0)
       history tables.
"BLD",8247,1,77,0)
          1) To show the last 4 sites per the medication being given.
"BLD",8247,1,78,0)
          2) To show last 10 sites per the patient for any medication.
"BLD",8247,1,79,0)
      The tables above will use a new Division parameter, "Injection Site 
"BLD",8247,1,80,0)
      History Max Hours", added with this patch that controls how many
"BLD",8247,1,81,0)
      hours to look back when compiling these history tables.  The default
"BLD",8247,1,82,0)
      will be initialized to 72 hours, with this patch.
"BLD",8247,1,83,0)
 
"BLD",8247,1,84,0)
This Patch also Addresses 3 reported Remedy ticket issues:
"BLD",8247,1,85,0)
 
"BLD",8247,1,86,0)
1. After scanning a medication that requires multiple doses
"BLD",8247,1,87,0)
   or dosage strengths, the multiple dose dialog box's 
"BLD",8247,1,88,0)
   invalid medication pop-up functionality appears to be broken.
"BLD",8247,1,89,0)
2. Unable to view all allergies/ADRs on BCMA GUI for patient with
"BLD",8247,1,90,0)
   numerous allergies/ADRs.
"BLD",8247,1,91,0)
3. The Patient Record Flag changes from Red to Black if you lock
"BLD",8247,1,92,0)
   your computer. 
"BLD",8247,1,93,0)
 
"BLD",8247,1,94,0)
Please refer to the release notes for a full detailed list and examples 
"BLD",8247,1,95,0)
of items included in this patch.
"BLD",8247,4,0)
^9.64PA^53.79^2
"BLD",8247,4,53.69,0)
53.69
"BLD",8247,4,53.69,2,0)
^9.641^53.69^1
"BLD",8247,4,53.69,2,53.69,0)
BCMA REPORT REQUEST  (File-top level)
"BLD",8247,4,53.69,2,53.69,1,0)
^9.6411^3^1
"BLD",8247,4,53.69,2,53.69,1,3,0)
INCLUDE SPECIAL INSTRUCTIONS
"BLD",8247,4,53.69,222)
y^y^p^^^^n^^n
"BLD",8247,4,53.69,224)

"BLD",8247,4,53.79,0)
53.79
"BLD",8247,4,53.79,2,0)
^9.641^53.79^1
"BLD",8247,4,53.79,2,53.79,0)
BCMA MEDICATION LOG  (File-top level)
"BLD",8247,4,53.79,2,53.79,1,0)
^9.6411^.16^4
"BLD",8247,4,53.79,2,53.79,1,.01,0)
PATIENT NAME
"BLD",8247,4,53.79,2,53.79,1,.06,0)
ACTION DATE/TIME
"BLD",8247,4,53.79,2,53.79,1,.08,0)
ADMINISTRATION MEDICATION
"BLD",8247,4,53.79,2,53.79,1,.16,0)
INJECTION SITE
"BLD",8247,4,53.79,222)
y^y^p^^^^n^^n
"BLD",8247,4,53.79,224)

"BLD",8247,4,"APDD",53.69,53.69)

"BLD",8247,4,"APDD",53.69,53.69,3)

"BLD",8247,4,"APDD",53.79,53.79)

"BLD",8247,4,"APDD",53.79,53.79,.01)

"BLD",8247,4,"APDD",53.79,53.79,.06)

"BLD",8247,4,"APDD",53.79,53.79,.08)

"BLD",8247,4,"APDD",53.79,53.79,.16)

"BLD",8247,4,"B",53.69,53.69)

"BLD",8247,4,"B",53.79,53.79)

"BLD",8247,6.3)
26
"BLD",8247,"ABPKG")
n
"BLD",8247,"INID")
^n
"BLD",8247,"INIT")
PSB3P68
"BLD",8247,"KRN",0)
^9.67PA^779.2^20
"BLD",8247,"KRN",.4,0)
.4
"BLD",8247,"KRN",.401,0)
.401
"BLD",8247,"KRN",.402,0)
.402
"BLD",8247,"KRN",.403,0)
.403
"BLD",8247,"KRN",.5,0)
.5
"BLD",8247,"KRN",.84,0)
.84
"BLD",8247,"KRN",3.6,0)
3.6
"BLD",8247,"KRN",3.8,0)
3.8
"BLD",8247,"KRN",9.2,0)
9.2
"BLD",8247,"KRN",9.8,0)
9.8
"BLD",8247,"KRN",9.8,"NM",0)
^9.68A^20^20
"BLD",8247,"KRN",9.8,"NM",1,0)
PSBRPC3^^0^B309181
"BLD",8247,"KRN",9.8,"NM",2,0)
PSBO^^0^B87103799
"BLD",8247,"KRN",9.8,"NM",3,0)
PSBODO^^0^B36995822
"BLD",8247,"KRN",9.8,"NM",4,0)
PSBOCM^^0^B85413465
"BLD",8247,"KRN",9.8,"NM",5,0)
PSBOMH^^0^B83165444
"BLD",8247,"KRN",9.8,"NM",6,0)
PSBOMH2^^0^B46571592
"BLD",8247,"KRN",9.8,"NM",7,0)
PSBVDLU1^^0^B63529398
"BLD",8247,"KRN",9.8,"NM",8,0)
PSBPRN^^0^B32147222
"BLD",8247,"KRN",9.8,"NM",9,0)
PSBOCE^^0^B83955260
"BLD",8247,"KRN",9.8,"NM",10,0)
PSBOCI^^0^B92815487
"BLD",8247,"KRN",9.8,"NM",11,0)
PSBOCP^^0^B82953642
"BLD",8247,"KRN",9.8,"NM",12,0)
PSBODL^^0^B85139144
"BLD",8247,"KRN",9.8,"NM",13,0)
PSBODL1^^0^B43970993
"BLD",8247,"KRN",9.8,"NM",14,0)
PSBOIV^^0^B83398690
"BLD",8247,"KRN",9.8,"NM",15,0)
PSBCSUTL^^0^B149737589
"BLD",8247,"KRN",9.8,"NM",16,0)
PSBVDLTB^^0^B13695318
"BLD",8247,"KRN",9.8,"NM",17,0)
PSBINJEC^^0^B24162182
"BLD",8247,"KRN",9.8,"NM",18,0)
PSBVDLUD^^0^B85273287
"BLD",8247,"KRN",9.8,"NM",19,0)
PSBVDLPB^^0^B99542907
"BLD",8247,"KRN",9.8,"NM",20,0)
PSBVT^^0^B79719168
"BLD",8247,"KRN",9.8,"NM","B","PSBCSUTL",15)

"BLD",8247,"KRN",9.8,"NM","B","PSBINJEC",17)

"BLD",8247,"KRN",9.8,"NM","B","PSBO",2)

"BLD",8247,"KRN",9.8,"NM","B","PSBOCE",9)

"BLD",8247,"KRN",9.8,"NM","B","PSBOCI",10)

"BLD",8247,"KRN",9.8,"NM","B","PSBOCM",4)

"BLD",8247,"KRN",9.8,"NM","B","PSBOCP",11)

"BLD",8247,"KRN",9.8,"NM","B","PSBODL",12)

"BLD",8247,"KRN",9.8,"NM","B","PSBODL1",13)

"BLD",8247,"KRN",9.8,"NM","B","PSBODO",3)

"BLD",8247,"KRN",9.8,"NM","B","PSBOIV",14)

"BLD",8247,"KRN",9.8,"NM","B","PSBOMH",5)

"BLD",8247,"KRN",9.8,"NM","B","PSBOMH2",6)

"BLD",8247,"KRN",9.8,"NM","B","PSBPRN",8)

"BLD",8247,"KRN",9.8,"NM","B","PSBRPC3",1)

"BLD",8247,"KRN",9.8,"NM","B","PSBVDLPB",19)

"BLD",8247,"KRN",9.8,"NM","B","PSBVDLTB",16)

"BLD",8247,"KRN",9.8,"NM","B","PSBVDLU1",7)

"BLD",8247,"KRN",9.8,"NM","B","PSBVDLUD",18)

"BLD",8247,"KRN",9.8,"NM","B","PSBVT",20)

"BLD",8247,"KRN",19,0)
19
"BLD",8247,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",8247,"KRN",19,"NM",1,0)
PSB GUI CONTEXT - USER^^0
"BLD",8247,"KRN",19,"NM","B","PSB GUI CONTEXT - USER",1)

"BLD",8247,"KRN",19.1,0)
19.1
"BLD",8247,"KRN",101,0)
101
"BLD",8247,"KRN",409.61,0)
409.61
"BLD",8247,"KRN",771,0)
771
"BLD",8247,"KRN",779.2,0)
779.2
"BLD",8247,"KRN",870,0)
870
"BLD",8247,"KRN",8989.51,0)
8989.51
"BLD",8247,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",8247,"KRN",8989.51,"NM",1,0)
PSB INJECTION SITE MAX HOURS^^0
"BLD",8247,"KRN",8989.51,"NM","B","PSB INJECTION SITE MAX HOURS",1)

"BLD",8247,"KRN",8989.52,0)
8989.52
"BLD",8247,"KRN",8989.52,"NM",0)
^9.68A^1^1
"BLD",8247,"KRN",8989.52,"NM",1,0)
PSB DIVISION^^0
"BLD",8247,"KRN",8989.52,"NM","B","PSB DIVISION",1)

"BLD",8247,"KRN",8994,0)
8994
"BLD",8247,"KRN",8994,"NM",0)
^9.68A^5^5
"BLD",8247,"KRN",8994,"NM",1,0)
PSB GETORDERTAB^^0
"BLD",8247,"KRN",8994,"NM",2,0)
PSB GETINJECTIONSITE^^0
"BLD",8247,"KRN",8994,"NM",3,0)
PSB GETPRNS^^0
"BLD",8247,"KRN",8994,"NM",4,0)
PSB COVERSHEET1^^0
"BLD",8247,"KRN",8994,"NM",5,0)
PSB REPORT^^0
"BLD",8247,"KRN",8994,"NM","B","PSB COVERSHEET1",4)

"BLD",8247,"KRN",8994,"NM","B","PSB GETINJECTIONSITE",2)

"BLD",8247,"KRN",8994,"NM","B","PSB GETORDERTAB",1)

"BLD",8247,"KRN",8994,"NM","B","PSB GETPRNS",3)

"BLD",8247,"KRN",8994,"NM","B","PSB REPORT",5)

"BLD",8247,"KRN","B",.4,.4)

"BLD",8247,"KRN","B",.401,.401)

"BLD",8247,"KRN","B",.402,.402)

"BLD",8247,"KRN","B",.403,.403)

"BLD",8247,"KRN","B",.5,.5)

"BLD",8247,"KRN","B",.84,.84)

"BLD",8247,"KRN","B",3.6,3.6)

"BLD",8247,"KRN","B",3.8,3.8)

"BLD",8247,"KRN","B",9.2,9.2)

"BLD",8247,"KRN","B",9.8,9.8)

"BLD",8247,"KRN","B",19,19)

"BLD",8247,"KRN","B",19.1,19.1)

"BLD",8247,"KRN","B",101,101)

"BLD",8247,"KRN","B",409.61,409.61)

"BLD",8247,"KRN","B",771,771)

"BLD",8247,"KRN","B",779.2,779.2)

"BLD",8247,"KRN","B",870,870)

"BLD",8247,"KRN","B",8989.51,8989.51)

"BLD",8247,"KRN","B",8989.52,8989.52)

"BLD",8247,"KRN","B",8994,8994)

"BLD",8247,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8247,"QUES",0)
^9.62^^
"BLD",8247,"REQB",0)
^9.611^5^5
"BLD",8247,"REQB",1,0)
PSB*3.0*58^2
"BLD",8247,"REQB",2,0)
PSJ*5.0*267^2
"BLD",8247,"REQB",3,0)
PSB*3.0*61^2
"BLD",8247,"REQB",4,0)
PSB*3.0*62^2
"BLD",8247,"REQB",5,0)
PSB*3.0*67^2
"BLD",8247,"REQB","B","PSB*3.0*58",1)

"BLD",8247,"REQB","B","PSB*3.0*61",3)

"BLD",8247,"REQB","B","PSB*3.0*62",4)

"BLD",8247,"REQB","B","PSB*3.0*67",5)

"BLD",8247,"REQB","B","PSJ*5.0*267",2)

"FIA",53.69)
BCMA REPORT REQUEST
"FIA",53.69,0)
^PSB(53.69,
"FIA",53.69,0,0)
53.69
"FIA",53.69,0,1)
y^y^p^^^^n^^n
"FIA",53.69,0,10)

"FIA",53.69,0,11)

"FIA",53.69,0,"RLRO")

"FIA",53.69,0,"VR")
3.0^PSB
"FIA",53.69,53.69)
1
"FIA",53.69,53.69,3)

"FIA",53.79)
BCMA MEDICATION LOG
"FIA",53.79,0)
^PSB(53.79,
"FIA",53.79,0,0)
53.79PI
"FIA",53.79,0,1)
y^y^p^^^^n^^n
"FIA",53.79,0,10)

"FIA",53.79,0,11)

"FIA",53.79,0,"RLRO")

"FIA",53.79,0,"VR")
3.0^PSB
"FIA",53.79,53.79)
1
"FIA",53.79,53.79,.01)

"FIA",53.79,53.79,.06)

"FIA",53.79,53.79,.08)

"FIA",53.79,53.79,.16)

"INIT")
PSB3P68
"IX",53.79,53.79,"AINJ",0)
53.79^AINJ^By patient, action date/time, & inject site^R^^R^IR^I^53.79^^^^^S
"IX",53.79,53.79,"AINJ",1)
S ^PSB(53.79,"AINJ",X(1),X(2),$E(X(3),1,30),DA)=""
"IX",53.79,53.79,"AINJ",2)
K ^PSB(53.79,"AINJ",X(1),X(2),$E(X(3),1,30),DA)
"IX",53.79,53.79,"AINJ",2.5)
K ^PSB(53.79,"AINJ")
"IX",53.79,53.79,"AINJ",11.1,0)
^.114IA^3^3
"IX",53.79,53.79,"AINJ",11.1,1,0)
1^F^53.79^.01^^1^F
"IX",53.79,53.79,"AINJ",11.1,2,0)
2^F^53.79^.06^^2^F
"IX",53.79,53.79,"AINJ",11.1,3,0)
3^F^53.79^.16^30^3^F
"IX",53.79,53.79,"AINJOI",0)
53.79^AINJOI^By patient, orderable item, action date/time, & inject site^R^^R^IR^I^53.79^^^^^S
"IX",53.79,53.79,"AINJOI",1)
S ^PSB(53.79,"AINJOI",X(1),X(2),X(3),$E(X(4),1,30),DA)=""
"IX",53.79,53.79,"AINJOI",2)
K ^PSB(53.79,"AINJOI",X(1),X(2),X(3),$E(X(4),1,30),DA)
"IX",53.79,53.79,"AINJOI",2.5)
K ^PSB(53.79,"AINJOI")
"IX",53.79,53.79,"AINJOI",11.1,0)
^.114IA^4^4
"IX",53.79,53.79,"AINJOI",11.1,1,0)
1^F^53.79^.01^^1^F
"IX",53.79,53.79,"AINJOI",11.1,2,0)
2^F^53.79^.08^^2^F
"IX",53.79,53.79,"AINJOI",11.1,3,0)
3^F^53.79^.06^^3^F
"IX",53.79,53.79,"AINJOI",11.1,4,0)
4^F^53.79^.16^30^4^F
"IX",53.79,53.79,"AORDX",0)
53.79^AORDX^DFN,ORDER NUMBER,ADMIN DATE/TIME^R^^R^IR^I^53.79^^^^^S
"IX",53.79,53.79,"AORDX",.1,0)
^^2^2^3001106^
"IX",53.79,53.79,"AORDX",.1,1,0)
Cross reference by; .01 PATIENT NAME; .11 ORDER REFERENCE NUMBER; and .06
"IX",53.79,53.79,"AORDX",.1,2,0)
ADMINISTRATION DATE/TIME.
"IX",53.79,53.79,"AORDX",1)
S ^PSB(53.79,"AORDX",$E(X(1),1,30),$E(X(2),1,15),$E(X(3),1,15),DA)=""
"IX",53.79,53.79,"AORDX",2)
K ^PSB(53.79,"AORDX",$E(X(1),1,30),$E(X(2),1,15),$E(X(3),1,15),DA)
"IX",53.79,53.79,"AORDX",2.5)
K ^PSB(53.79,"AORDX")
"IX",53.79,53.79,"AORDX",11.1,0)
^.114IA^3^3
"IX",53.79,53.79,"AORDX",11.1,1,0)
1^F^53.79^.01^30^1^F
"IX",53.79,53.79,"AORDX",11.1,2,0)
2^F^53.79^.11^15^2^F
"IX",53.79,53.79,"AORDX",11.1,3,0)
3^F^53.79^.06^15^3^F
"IX",53.79,53.79,"APATCH",0)
53.79^APATCH^Updates APATCH when DFN or admin date/time changes.^R^^F^IR^I^53.79^^^^^S
"IX",53.79,53.79,"APATCH",1)
S ^PSB(53.79,"APATCH",X(1),X(2),DA)=""
"IX",53.79,53.79,"APATCH",1.4)
S X=0 N I S I=0 F  S I=$O(^PSB(53.79,DA,.5,I)) Q:'I  I ($P($G(^(I,0)),U,4)="PATCH")&($P(^PSB(53.79,DA,0),U,9)="G") S X=1 Q
"IX",53.79,53.79,"APATCH",2)
K ^PSB(53.79,"APATCH",X(1),X(2),DA)
"IX",53.79,53.79,"APATCH",2.4)
S X=0 N I S I=0 F  S I=$O(^PSB(53.79,DA,.5,I)) Q:'I  I $P($G(^(I,0)),U,4)="PATCH" S X=1 Q
"IX",53.79,53.79,"APATCH",2.5)
K ^PSB(53.79,"APATCH")
"IX",53.79,53.79,"APATCH",11.1,0)
^.114IA^2^2
"IX",53.79,53.79,"APATCH",11.1,1,0)
1^F^53.79^.01^^1^F
"IX",53.79,53.79,"APATCH",11.1,2,0)
2^F^53.79^.06^^2^F
"IX",53.79,53.79,"AUID",0)
53.79^AUID^cross reference of dfn, order number, and unique id^R^^R^IR^I^53.79^^^^^S
"IX",53.79,53.79,"AUID",1)
S ^PSB(53.79,"AUID",X(1),$E(X(2),1,30),$E(X(3),1,30),DA)=""
"IX",53.79,53.79,"AUID",2)
K ^PSB(53.79,"AUID",X(1),$E(X(2),1,30),$E(X(3),1,30),DA)
"IX",53.79,53.79,"AUID",2.5)
K ^PSB(53.79,"AUID")
"IX",53.79,53.79,"AUID",11.1,0)
^.114IA^3^3
"IX",53.79,53.79,"AUID",11.1,1,0)
1^F^53.79^.01^^1^F
"IX",53.79,53.79,"AUID",11.1,1,3)

"IX",53.79,53.79,"AUID",11.1,2,0)
2^F^53.79^.11^30^2^F
"IX",53.79,53.79,"AUID",11.1,2,3)

"IX",53.79,53.79,"AUID",11.1,3,0)
3^F^53.79^.26^30^3^F
"IX",53.79,53.79,"AUID",11.1,3,3)

"KRN",19,11586,-1)
0^1
"KRN",19,11586,0)
PSB GUI CONTEXT - USER^BCMA Client Context^^B^^^^^^^^
"KRN",19,11586,99)
59973,28281
"KRN",19,11586,99.1)
62283,51880
"KRN",19,11586,"RPC",0)
^19.05P^56^54
"KRN",19,11586,"RPC",2,0)
PSB FMDATE
"KRN",19,11586,"RPC",4,0)
PSB GETPRNS
"KRN",19,11586,"RPC",5,0)
PSB INSTRUCTOR
"KRN",19,11586,"RPC",7,0)
PSB MEDICATION HISTORY
"KRN",19,11586,"RPC",8,0)
PSB PARAMETER
"KRN",19,11586,"RPC",12,0)
PSB SCANMED
"KRN",19,11586,"RPC",13,0)
PSB SCANPT
"KRN",19,11586,"RPC",14,0)
PSB SERVER CLOCK VARIANCE
"KRN",19,11586,"RPC",15,0)
PSB SUBMIT MISSING DOSE
"KRN",19,11586,"RPC",16,0)
PSB TRANSACTION
"KRN",19,11586,"RPC",17,0)
PSB USERLOAD
"KRN",19,11586,"RPC",18,0)
PSB USERSAVE
"KRN",19,11586,"RPC",19,0)
PSB VALIDATE ESIG
"KRN",19,11586,"RPC",20,0)
PSB VALIDATE ORDER
"KRN",19,11586,"RPC",21,0)
PSB CHECK SERVER
"KRN",19,11586,"RPC",23,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,11586,"RPC",24,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,11586,"RPC",26,0)
PSB GETORDERTAB
"KRN",19,11586,"RPC",27,0)
PSB GETIVPAR
"KRN",19,11586,"RPC",28,0)
PSB PUTIVPAR
"KRN",19,11586,"RPC",29,0)
PSB DEVICE
"KRN",19,11586,"RPC",30,0)
PSB IV ORDER HISTORY
"KRN",19,11586,"RPC",31,0)
PSB BAG DETAIL
"KRN",19,11586,"RPC",32,0)
PSB WARDLIST
"KRN",19,11586,"RPC",33,0)
PSB MAIL
"KRN",19,11586,"RPC",34,0)
PSB ALLERGY
"KRN",19,11586,"RPC",35,0)
PSB GETPROVIDER
"KRN",19,11586,"RPC",37,0)
PSB MOB DRUG LIST
"KRN",19,11586,"RPC",38,0)
PSB MAXDAYS
"KRN",19,11586,"RPC",39,0)
PSB NURS WARDLIST
"KRN",19,11586,"RPC",40,0)
PSB CPRS ORDER
"KRN",19,11586,"RPC",41,0)
ORWUBCMA USERINFO
"KRN",19,11586,"RPC",43,0)
ORBCMA5 GETUDID
"KRN",19,11586,"RPC",44,0)
ORBCMA5 GETIVID
"KRN",19,11586,"RPC",45,0)
PSB VERSION CHECK
"KRN",19,11586,"RPC",46,0)
PSB CHECK IV
"KRN",19,11586,"RPC",47,0)
PSB VITALS
"KRN",19,11586,"RPC",48,0)
PSB VITAL MEAS FILE
"KRN",19,11586,"RPC",49,0)
PSB MED LOG LOOKUP
"KRN",19,11586,"RPC",50,0)
PSB COVERSHEET1
"KRN",19,11586,"RPC",51,0)
PSB UTL XSTATUS SRCH
"KRN",19,11586,"RPC",52,0)
PSB MAN SCAN FAILURE
"KRN",19,11586,"RPC",55,0)
PSB REPORT
"KRN",19,11586,"RPC",56,0)
PSB GETINJECTIONSITE
"KRN",19,11586,"U")
BCMA CLIENT CONTEXT
"KRN",8989.51,34,0)
PSB VDL INCL ON-CALL^Include On Call Meds^0^^INCLUDE ON CALL MEDS ON DUE LIST^0
"KRN",8989.51,34,1)
Y^^Enter 'Y' to have On-Call Meds included in the initial VDL
"KRN",8989.51,34,20,0)
^8989.512^2^2^3030509^^
"KRN",8989.51,34,20,1,0)
Determines wether initial Due List View contains On Call
"KRN",8989.51,34,20,2,0)
medications.
"KRN",8989.51,34,30,0)
^8989.513I^1^1
"KRN",8989.51,34,30,1,0)
1^4
"KRN",8989.51,35,0)
PSB ONLINE^Is BCMA System On-Line^0^^IS BCMA ON-LINE^0
"KRN",8989.51,35,1)
Y
"KRN",8989.51,35,20,0)
^8989.512^2^2^3080416^^^^
"KRN",8989.51,35,20,1,0)
Used by the M Server and/or Application GUI Server administrator to 
"KRN",8989.51,35,20,2,0)
flag all client BCMA processes to stop.
"KRN",8989.51,35,30,0)
^8989.513I^1^1
"KRN",8989.51,35,30,1,0)
1^4
"KRN",8989.51,36,0)
PSB VDL START TIME^Default hours prior to NOW for the VDL^0^^HOURS PRIOR TO NOW FOR VDL^0
"KRN",8989.51,36,1)
N^0:24:0^Enter the number of hours prior to NOW that the VDL will initially display
"KRN",8989.51,36,20,0)
^^2^2^2990323^
"KRN",8989.51,36,20,1,0)
Default number of hours prior to NOW that the VDL will display when 
"KRN",8989.51,36,20,2,0)
initially displayed.
"KRN",8989.51,36,30,0)
^8989.513I^2^2
"KRN",8989.51,36,30,1,0)
1^200
"KRN",8989.51,36,30,2,0)
2^4
"KRN",8989.51,37,0)
PSB VDL INCL CONT^Include Continuous Meds^0^^INCLUDE CONTINUOUS MEDS ON DUE LIST^0
"KRN",8989.51,37,1)
Y^^Enter 'Y' to have Continuous Meds included in the initial VDL
"KRN",8989.51,37,20,0)
^8989.512^2^2^3030509^^
"KRN",8989.51,37,20,1,0)
Determines wheter initial Due List View contains continuous 
"KRN",8989.51,37,20,2,0)
medications.
"KRN",8989.51,37,30,0)
^8989.513I^1^1
"KRN",8989.51,37,30,1,0)
1^4
"KRN",8989.51,39,0)
PSB ROBOT RX^Using Robot RX^0^^USING ROBOT RX^0
"KRN",8989.51,39,1)
Y
"KRN",8989.51,39,20,0)
^8989.512^1^1^3010726^^^
"KRN",8989.51,39,20,1,0)
Parameter should be "yes" if site is using the robot RX.
"KRN",8989.51,39,30,0)
^8989.513I^1^1
"KRN",8989.51,39,30,1,0)
1^4
"KRN",8989.51,49,0)
PSB AUTOUPDATE SERVER^The UNC of the Auto-update Server^0^^UNC OF THE AUTOUPDATE SERVER
"KRN",8989.51,49,1)
F^0:50^Enter a Microsoft UNC for server
"KRN",8989.51,49,20,0)
^8989.512^2^2^3000726^^
"KRN",8989.51,49,20,1,0)
The Microsoft UNC path to the BCMA autoupdate server that will contain
"KRN",8989.51,49,20,2,0)
the source files for the update.
"KRN",8989.51,49,30,0)
^8989.513I^1^1
"KRN",8989.51,49,30,1,0)
1^4
"KRN",8989.51,87,0)
PSB MG AUTOUPDATE^Autoupdate Notification Mail Group^0^^AUTOUPDATE NOTIFICATION MAIL GROUP^0
"KRN",8989.51,87,1)
P^3.8
"KRN",8989.51,87,20,0)
^8989.512^1^1^3000712^
"KRN",8989.51,87,20,1,0)
Mailgroup to notify when updates or update errors occur.
"KRN",8989.51,87,30,0)
^8989.513I^1^1
"KRN",8989.51,87,30,1,0)
1^4
"KRN",8989.51,264,0)
PSB VDL STOP TIME^Default hours after NOW for the VDL^0^zzinstance^HOURS AFTER NOW FOR VDL^0
"KRN",8989.51,264,1)
N^0:24:0^Enter the number of hours after NOW that the VDL will initially display
"KRN",8989.51,264,20,0)
^^2^2^2990323^
"KRN",8989.51,264,20,1,0)
Default number of hours after NOW that the VDL will display when 
"KRN",8989.51,264,20,2,0)
initially displayed.
"KRN",8989.51,264,30,0)
^8989.513I^2^2
"KRN",8989.51,264,30,1,0)
1^200
"KRN",8989.51,264,30,2,0)
2^4
"KRN",8989.51,266,0)
PSB VDL INCL PRN^Include PRN Meds^0^^INCLUDE PRN MEDS ON DUE LIST^0
"KRN",8989.51,266,1)
Y^^Enter 'Y' to have PRN Meds included in the initial VDL
"KRN",8989.51,266,20,0)
^8989.512^1^1^3030509^^^^
"KRN",8989.51,266,20,1,0)
Determines wether initial Due List View contains PRN medications.
"KRN",8989.51,266,30,0)
^8989.513I^3^1
"KRN",8989.51,266,30,3,0)
1^4
"KRN",8989.51,267,0)
PSB VDL INCL ONE-TIME^Include One-Time Meds^0^^INCLUDE ONE-TIME MEDS ON DUE LIST^0
"KRN",8989.51,267,1)
Y^^Enter 'Y' to have One-Time Meds included in the initial VDL
"KRN",8989.51,267,20,0)
^8989.512^2^2^3030509^^
"KRN",8989.51,267,20,1,0)
Determines wether initial Due List View contains One-Time
"KRN",8989.51,267,20,2,0)
medications.
"KRN",8989.51,267,30,0)
^8989.513I^1^1
"KRN",8989.51,267,30,1,0)
1^4
"KRN",8989.51,271,0)
PSB MG DUE LIST ERROR^Due List Error Notification Mail Group^0^^DUE LIST ERRORS MAIL GROUP^0
"KRN",8989.51,271,1)
P^3.8
"KRN",8989.51,271,20,0)
^8989.512^2^2^3060607^^^^
"KRN",8989.51,271,20,1,0)
Mailgroup to notify when an order is unable to be validated and placed 
"KRN",8989.51,271,20,2,0)
on the Due List.
"KRN",8989.51,271,30,0)
^8989.513I^1^1
"KRN",8989.51,271,30,1,0)
1^4
"KRN",8989.51,272,0)
PSB ADMIN ESIG^Require E-Sig to Administer^0^^REQUIRE ESIG TO ADMINISTER^0
"KRN",8989.51,272,1)
Y
"KRN",8989.51,272,20,0)
^^2^2^2990323^^^^
"KRN",8989.51,272,20,1,0)
Determines if a user must supply their electronic signature code prior 
"KRN",8989.51,272,20,2,0)
to administering any medications.
"KRN",8989.51,272,30,0)
^8989.513I^1^1
"KRN",8989.51,272,30,1,0)
1^4
"KRN",8989.51,273,0)
PSB ADMIN BEFORE^Allowed Mins Before Sched Admin^0^^ALLOWED MINS BEFORE SCHED TIME
"KRN",8989.51,273,1)
N^10:240:0^enter a number between 10-240 on even ten minute increments.
"KRN",8989.51,273,2)
K:X#10 X
"KRN",8989.51,273,20,0)
^^2^2^2990325^^
"KRN",8989.51,273,20,1,0)
This parameter contains the number of minutes before a scheduled 
"KRN",8989.51,273,20,2,0)
administration time is allowed without filing a variance.
"KRN",8989.51,273,30,0)
^8989.513I^1^1
"KRN",8989.51,273,30,1,0)
1^4
"KRN",8989.51,274,0)
PSB ADMIN AFTER^Allowed Mins After Sched Admin^0^^ALLOWED MINS AFTER SCHED TIME
"KRN",8989.51,274,1)
N^10:240:0^enter a number between 10-240 on even ten minute increments.
"KRN",8989.51,274,2)
K:X#10 X
"KRN",8989.51,274,20,0)
^8989.512^2^2^3021114^^^^
"KRN",8989.51,274,20,1,0)
This parameter contains the number of minutes after a scheduled 
"KRN",8989.51,274,20,2,0)
administration time is allowed without filing a variance.
"KRN",8989.51,274,30,0)
^8989.513I^1^1
"KRN",8989.51,274,30,1,0)
1^4
"KRN",8989.51,275,0)
PSB ADMIN PRN EFFECT^Allowed Mins to Enter PRN Effect^0^^ALLOWED MINS FOR PRN EFFECT
"KRN",8989.51,275,1)
N^10:960:0^enter a number between 10-960 on even ten minute increments.
"KRN",8989.51,275,2)
K:X#10 X
"KRN",8989.51,275,20,0)
^8989.512^2^2^3110307^^
"KRN",8989.51,275,20,1,0)
The number of minutes allowed to elapse between PRN administration and 
"KRN",8989.51,275,20,2,0)
entry of PRN Effectiveness.
"KRN",8989.51,275,30,0)
^8989.513I^1^1
"KRN",8989.51,275,30,1,0)
1^4
"KRN",8989.51,276,0)
PSB HFS SCRATCH^Scratch HFS Directory^0^^SCRATCH HFS DIRECTORY^0
"KRN",8989.51,276,1)
F^1:50^Enter a valid HFS Directory Name
"KRN",8989.51,276,20,0)
^^2^2^2990323^
"KRN",8989.51,276,20,1,0)
Name of an HFS directory that all BCMA processes will be able to 
"KRN",8989.51,276,20,2,0)
access through ^%ZISH for printing documents.
"KRN",8989.51,276,30,0)
^8989.513I^1^1
"KRN",8989.51,276,30,1,0)
1^4
"KRN",8989.51,278,0)
PSB MG SYSTEM ERROR^System Error Notification Mail Group^0^^SYSTEM ERRORS MAIL GROUP^0
"KRN",8989.51,278,1)
P^3.8
"KRN",8989.51,278,20,0)
^^2^2^2990323^
"KRN",8989.51,278,20,1,0)
Mailgroup to notify when an unexplained error occurs with the 
"KRN",8989.51,278,20,2,0)
software.
"KRN",8989.51,278,30,0)
^8989.513I^1^1
"KRN",8989.51,278,30,1,0)
1^4
"KRN",8989.51,279,0)
PSB MG MISSING DOSE^Missing Dose Notification Mail Group^0^^MISSING DOSE MAIL GROUP^0
"KRN",8989.51,279,1)
P^3.8
"KRN",8989.51,279,20,0)
^8989.512^1^1^3060607^^
"KRN",8989.51,279,20,1,0)
Mailgroup to notify when a missing dose is requested.
"KRN",8989.51,279,30,0)
^8989.513I^2^2
"KRN",8989.51,279,30,1,0)
1^44
"KRN",8989.51,279,30,2,0)
2^4
"KRN",8989.51,281,0)
PSB ADMIN MULTIPLE ONCALL^Allow Multi Admin On-Call^0^^ALLOW MULTIPLE ON CALL ADMINS^0
"KRN",8989.51,281,1)
Y
"KRN",8989.51,281,20,0)
^^2^2^2990323^^^
"KRN",8989.51,281,20,1,0)
Determines if this Division will allow multiple administrations against an
"KRN",8989.51,281,20,2,0)
On-Call order.
"KRN",8989.51,281,30,0)
^8989.513I^1^1
"KRN",8989.51,281,30,1,0)
1^4
"KRN",8989.51,282,0)
PSB PRINTER MISSING DOSE^Missing Dose Printer^0^Printer DEVICE^MISSING DOSE PRINTER^0
"KRN",8989.51,282,1)
P^3.5
"KRN",8989.51,282,20,0)
^^1^1^2990323^
"KRN",8989.51,282,20,1,0)
Device to print to when a missing dose is requested.
"KRN",8989.51,282,30,0)
^8989.513I^2^2
"KRN",8989.51,282,30,1,0)
1^44
"KRN",8989.51,282,30,2,0)
2^4
"KRN",8989.51,283,0)
PSB VDL INCL IV MEDS^Include IV Med Orders^0^^INCLUDE IV MEDS ON DUE LIST^0
"KRN",8989.51,283,1)
Y^^Enter 'Y' to have IV Order Meds included in the initial VDL
"KRN",8989.51,283,20,0)
^^1^1^2990323^
"KRN",8989.51,283,20,1,0)
Determines wether initial Due List View contains IV Medications.
"KRN",8989.51,283,30,0)
^8989.513I^2^2
"KRN",8989.51,283,30,1,0)
1^200
"KRN",8989.51,283,30,2,0)
2^4
"KRN",8989.51,284,0)
PSB VDL INCL UD MEDS^Include Unit Dose Med Orders^0^^INCLUDE UNIT DOSE MEDS ON DUE LIST^0
"KRN",8989.51,284,1)
Y^^Enter 'Y' to have Unit Dose Meds included in the initial VDL
"KRN",8989.51,284,20,0)
^^2^2^2990323^
"KRN",8989.51,284,20,1,0)
Determines wether initial Due List View contains Unit Dose
"KRN",8989.51,284,20,2,0)
medications.
"KRN",8989.51,284,30,0)
^8989.513I^2^2
"KRN",8989.51,284,30,1,0)
1^200
"KRN",8989.51,284,30,2,0)
2^4
"KRN",8989.51,285,0)
PSB VDL INCL BLANKS^Include Blank Addendums at end^0^^INCLUDE BLANKS ADDENDUMS ON DUE LIST^0
"KRN",8989.51,285,1)
Y^^Enter 'Y' to have Addendums print at end of DL
"KRN",8989.51,285,20,0)
^^2^2^2990323^
"KRN",8989.51,285,20,1,0)
Used to flag wether or not to print the blank order requests at the 
"KRN",8989.51,285,20,2,0)
bottom of the printed DUE LIST.
"KRN",8989.51,285,30,0)
^8989.513I^2^2
"KRN",8989.51,285,30,1,0)
1^200
"KRN",8989.51,285,30,2,0)
2^4
"KRN",8989.51,287,0)
PSB SERVER CLOCK VARIANCE^Allowable client-server time variance^0^^ALLOWABLE SERVER CLOCK VARIANCE
"KRN",8989.51,287,1)
N^0:30:0^Enter a number between 0 and 30
"KRN",8989.51,287,20,0)
^^3^3^2990323^
"KRN",8989.51,287,20,1,0)
Used by the client at application startup to ensure that the client 
"KRN",8989.51,287,20,2,0)
clock is within a predetermined number of minutes of the server time 
"KRN",8989.51,287,20,3,0)
before allowing the client to proceed.
"KRN",8989.51,287,30,0)
^8989.513I^1^1
"KRN",8989.51,287,30,1,0)
1^4
"KRN",8989.51,541,0)
PSB PATIENT ID LABEL^Patient ID Display Label^0^^PSB PATIENT ID LABEL
"KRN",8989.51,541,1)
F^0:5
"KRN",8989.51,541,30,0)
^8989.513I^2^2
"KRN",8989.51,541,30,1,0)
800^4.2
"KRN",8989.51,541,30,2,0)
700^4
"KRN",8989.51,548,0)
PSB NON-NURSE VERIFIED PROMPT^Non-Nurse Verified Prompt action^0^^PSB NON-NURSE VERIFIED PROMPT
"KRN",8989.51,548,1)
S^1:N-Allow Admin (No Warning);2:W-Allow Admin after Warning;3:P-Prohibit Administration
"KRN",8989.51,548,2)

"KRN",8989.51,548,30,0)
^8989.513I^1^1
"KRN",8989.51,548,30,1,0)
700^4
"KRN",8989.51,634,-1)
0^1
"KRN",8989.51,634,0)
PSB INJECTION SITE MAX HOURS^Last Injection Site Max Hours^0^^PSB INJECTION SITE MAX HOURS
"KRN",8989.51,634,1)
N^1:72^Enter a number of hours (1-72)
"KRN",8989.51,634,20,0)
^8989.512^2^2^3111107^^
"KRN",8989.51,634,20,1,0)
This will store the number of hours for the Last Injection Site Timeframe 
"KRN",8989.51,634,20,2,0)
on the BCMA Site Parameters screen.
"KRN",8989.51,634,30,0)
^8989.513I^2^2
"KRN",8989.51,634,30,1,0)
800^4.2
"KRN",8989.51,634,30,2,0)
700^4
"KRN",8989.51,4649,0)
PSB DEFAULT BARCODE FORMAT^Default Bar Code Format^0^DEFAULT BARCODE FORMAT^DEFAULT BARCODE FORMAT^0
"KRN",8989.51,4649,1)
S^1:C39;2:128;3:I25
"KRN",8989.51,4649,20,0)
^^1^1^2990731^^^
"KRN",8989.51,4649,20,1,0)
Select the desired bar code format to produce on the Zebra Label Printer.
"KRN",8989.51,4649,30,0)
^8989.513I^1^1
"KRN",8989.51,4649,30,1,0)
1^4
"KRN",8989.51,4659,0)
PSB DEFAULT BARCODE PREFIX^Default Barcode Prefix^0^^DEFAULT BARCODE PREFIX
"KRN",8989.51,4659,1)
F^0:5^Will accept a null or up to 5 alphanumeric characters.
"KRN",8989.51,4659,20,0)
^8989.512^1^1^3021024^^^^
"KRN",8989.51,4659,20,1,0)
Text to prefix when printing a label on the Zebra Barcode Printer.
"KRN",8989.51,4659,30,0)
^8989.513I^1^1
"KRN",8989.51,4659,30,1,0)
1^4
"KRN",8989.51,4693,0)
PSBIV PROVIDER COMMENTS^IV Provider Comments^1^IV Type^IV Provider Comments^0
"KRN",8989.51,4693,1)
S^1:W-Display Warning Message;2:N-NO Warning Message;3:I-Invalid IV Bag
"KRN",8989.51,4693,2)
I X=1!(X=2) W !!?5,"The recommended response for this parameter is 3  I-Invalid IV Bag.",!
"KRN",8989.51,4693,6)
S^1:A;2:P;3:H;4:S;5:C
"KRN",8989.51,4693,30,0)
^8989.513I^1^1
"KRN",8989.51,4693,30,1,0)
1^4
"KRN",8989.52,38,-1)
0^1
"KRN",8989.52,38,0)
PSB DIVISION^BCMA Divisional Parameters^4^
"KRN",8989.52,38,10,0)
^8989.521IA^35^29
"KRN",8989.52,38,10,1,0)
1^PSB ONLINE
"KRN",8989.52,38,10,6,0)
6^PSB ADMIN AFTER
"KRN",8989.52,38,10,7,0)
7^PSB ADMIN BEFORE
"KRN",8989.52,38,10,8,0)
8^PSB ADMIN ESIG
"KRN",8989.52,38,10,9,0)
9^PSB ADMIN MULTIPLE ONCALL
"KRN",8989.52,38,10,10,0)
10^PSB ADMIN PRN EFFECT
"KRN",8989.52,38,10,12,0)
12^PSB HFS SCRATCH
"KRN",8989.52,38,10,13,0)
13^PSB MG DUE LIST ERROR
"KRN",8989.52,38,10,14,0)
14^PSB MG MISSING DOSE
"KRN",8989.52,38,10,15,0)
15^PSB MG SYSTEM ERROR
"KRN",8989.52,38,10,16,0)
16^PSB PRINTER MISSING DOSE
"KRN",8989.52,38,10,17,0)
17^PSB SERVER CLOCK VARIANCE
"KRN",8989.52,38,10,18,0)
18^PSB VDL INCL BLANKS
"KRN",8989.52,38,10,19,0)
19^PSB VDL INCL CONT
"KRN",8989.52,38,10,20,0)
20^PSB VDL INCL IV MEDS
"KRN",8989.52,38,10,21,0)
21^PSB VDL INCL ON-CALL
"KRN",8989.52,38,10,22,0)
22^PSB VDL INCL ONE-TIME
"KRN",8989.52,38,10,23,0)
23^PSB VDL INCL PRN
"KRN",8989.52,38,10,24,0)
24^PSB VDL INCL UD MEDS
"KRN",8989.52,38,10,25,0)
25^PSB VDL START TIME
"KRN",8989.52,38,10,26,0)
26^PSB VDL STOP TIME
"KRN",8989.52,38,10,27,0)
2^PSB DEFAULT BARCODE FORMAT
"KRN",8989.52,38,10,28,0)
3^PSB DEFAULT BARCODE PREFIX
"KRN",8989.52,38,10,29,0)
4^PSB ROBOT RX
"KRN",8989.52,38,10,30,0)
27^PSB AUTOUPDATE SERVER
"KRN",8989.52,38,10,31,0)
28^PSB MG AUTOUPDATE
"KRN",8989.52,38,10,32,0)
29^PSBIV PROVIDER COMMENTS
"KRN",8989.52,38,10,33,0)
30^PSB PATIENT ID LABEL
"KRN",8989.52,38,10,34,0)
31^PSB NON-NURSE VERIFIED PROMPT
"KRN",8989.52,38,10,35,0)
32^PSB INJECTION SITE MAX HOURS
"KRN",8994,691,-1)
0^3
"KRN",8994,691,0)
PSB GETPRNS^GETPRNS^PSBPRN^4^P^^^1^2
"KRN",8994,691,1,0)
^8994.01^6^6^3031114^^
"KRN",8994,691,1,1,0)
Returns all administrations of a PRN order that have NOT had the PRN
"KRN",8994,691,1,2,0)
Effectiveness documented in the current admission or within the hours 
"KRN",8994,691,1,3,0)
defined in PRN documentation site parameter whichever is greater of the 
"KRN",8994,691,1,4,0)
two.  When the PRN medication is administered a flag is set based on the 
"KRN",8994,691,1,5,0)
given PRN Reason.  This flag will dictate whether BCMA will mandate a
"KRN",8994,691,1,6,0)
PAIN SCORE measurement with PRN documentation.
"KRN",8994,691,2,0)
^8994.02A^3^3
"KRN",8994,691,2,1,0)
DFN^1^^1^1
"KRN",8994,691,2,1,1,0)
^^1^1^3010907^
"KRN",8994,691,2,1,1,1,0)
Patient IEN number.
"KRN",8994,691,2,2,0)
PSBORD^1^^0^2
"KRN",8994,691,2,2,1,0)
^8994.021^5^5^3120110^^^^
"KRN",8994,691,2,2,1,1,0)
Order number from Inpatient Medications. If order number is passed then 
"KRN",8994,691,2,2,1,2,0)
returns all PRN effectiveness not documented for that order.
"KRN",8994,691,2,2,1,3,0)
 
"KRN",8994,691,2,2,1,4,0)
If order number is NOT passed, then returns all PRN effectiveness not 
"KRN",8994,691,2,2,1,5,0)
documented for that patient.
"KRN",8994,691,2,3,0)
PSBSIOPI^1^1^0^3
"KRN",8994,691,2,3,1,0)
^^5^5^3120110^
"KRN",8994,691,2,3,1,1,0)
This parameter is a true/false flag (1/0).  If true use the new SI/OP Wp
"KRN",8994,691,2,3,1,2,0)
fields and return data in the Results array to the GUI Client.
"KRN",8994,691,2,3,1,3,0)
 
"KRN",8994,691,2,3,1,4,0)
The field is not required, so a null will convert into a 0, for false,
"KRN",8994,691,2,3,1,5,0)
making this backwards compatible.
"KRN",8994,691,2,"B","DFN",1)

"KRN",8994,691,2,"B","PSBORD",2)

"KRN",8994,691,2,"B","PSBSIOPI",3)

"KRN",8994,691,2,"PARAMSEQ",1,1)

"KRN",8994,691,2,"PARAMSEQ",2,2)

"KRN",8994,691,2,"PARAMSEQ",3,3)

"KRN",8994,691,3,0)
^^25^25^3120221^
"KRN",8994,691,3,1,0)
Results[0] = Number of Nodes.
"KRN",8994,691,3,2,0)
 
"KRN",8994,691,3,3,0)
Results[1]= ^1  Med Log IEN
"KRN",8994,691,3,4,0)
            ^2  Patient IEN
"KRN",8994,691,3,5,0)
            ^3  Patient Location
"KRN",8994,691,3,6,0)
            ^4  Administration Date/Time (Fileman format)
"KRN",8994,691,3,7,0)
            ^5  Action By
"KRN",8994,691,3,8,0)
            ^6  Administration Medication
"KRN",8994,691,3,9,0)
            ^7  PRN Reason
"KRN",8994,691,3,10,0)
            ^8  Orderable item IEN
"KRN",8994,691,3,11,0)
            ^9  Order Number
"KRN",8994,691,3,12,0)
            ^10 PRN Reason Flag
"KRN",8994,691,3,13,0)
 
"KRN",8994,691,3,14,0)
Results[2]= ^1  Special Instructions
"KRN",8994,691,3,15,0)
                ("!"  <- BCMA FLAG may precede Text)
"KRN",8994,691,3,16,0)
 
"KRN",8994,691,3,17,0)
Results[3]= ^1  "DD/ADD/SOL"
"KRN",8994,691,3,18,0)
            ^2  Name of dispense drug/additive/solution
"KRN",8994,691,3,19,0)
            ^3  Dose given
"KRN",8994,691,3,20,0)
            ^4  Unit of administration (free text)
"KRN",8994,691,3,21,0)
 
"KRN",8994,691,3,22,0)
Results[n]= ^1  LITERAL "SI"
"KRN",8994,691,3,23,0)
SI WP text  ^2  Special Instructions long Worprocessing text lines
"KRN",8994,691,3,24,0)
 
"KRN",8994,691,3,25,0)
Results[n]= ^1  "END"
"KRN",8994,692,-1)
0^5
"KRN",8994,692,0)
PSB REPORT^RPC^PSBO^4^S^^^1^3
"KRN",8994,692,1,0)
^8994.01^2^2^3081208^^^^
"KRN",8994,692,1,1,0)
Return the text for the specified report and the user has the option to 
"KRN",8994,692,1,2,0)
print the reports.
"KRN",8994,692,2,0)
^8994.02A^18^18
"KRN",8994,692,2,1,0)
PSBTYPE^1^2^1^1
"KRN",8994,692,2,1,1,0)
^^26^26^3081208^
"KRN",8994,692,2,1,1,1,0)
Contains the character designation for the needed report:
"KRN",8994,692,2,1,1,2,0)
AL: Allergy Request
"KRN",8994,692,2,1,1,3,0)
BL: Bar Code Label
"KRN",8994,692,2,1,1,4,0)
BZ: Bar Code Label
"KRN",8994,692,2,1,1,5,0)
CE: Coversheet - Expired/DC'd/Expiring Orders
"KRN",8994,692,2,1,1,6,0)
CI: Coversheet - IV Overview
"KRN",8994,692,2,1,1,7,0)
CM: Coversheet - Medication Overview
"KRN",8994,692,2,1,1,8,0)
CP: Coversheet - PRN Overview
"KRN",8994,692,2,1,1,9,0)
DL: Due List
"KRN",8994,692,2,1,1,10,0)
DO: Display Order
"KRN",8994,692,2,1,1,11,0)
IV: IV Bag Status
"KRN",8994,692,2,1,1,12,0)
MD: Missing Dose by Ward
"KRN",8994,692,2,1,1,13,0)
MH: Medication Administration History
"KRN",8994,692,2,1,1,14,0)
ML: Medication Log
"KRN",8994,692,2,1,1,15,0)
MM: Missed Medication
"KRN",8994,692,2,1,1,16,0)
MT: Medication Therapy Report
"KRN",8994,692,2,1,1,17,0)
MV: Medication Variance Log
"KRN",8994,692,2,1,1,18,0)
PE: PRN Effectiveness
"KRN",8994,692,2,1,1,19,0)
PF: Patient Record Flag
"KRN",8994,692,2,1,1,20,0)
PI: Patient Inquiry
"KRN",8994,692,2,1,1,21,0)
PM: Patient Medication History
"KRN",8994,692,2,1,1,22,0)
SF: Unable To Scan Detail
"KRN",8994,692,2,1,1,23,0)
ST: Unable To Scan Summary
"KRN",8994,692,2,1,1,24,0)
VT: Cumulative Vitals
"KRN",8994,692,2,1,1,25,0)
WA: Ward Administration Times
"KRN",8994,692,2,1,1,26,0)
XA: Unknown Action Status
"KRN",8994,692,2,2,0)
PSBDFN^1^10^1^2
"KRN",8994,692,2,2,1,0)
^8994.021^1^1^3030317^^
"KRN",8994,692,2,2,1,1,0)
Patient IEN
"KRN",8994,692,2,3,0)
PSBSTRT^1^20^1^3
"KRN",8994,692,2,3,1,0)
^^1^1^3011127^
"KRN",8994,692,2,3,1,1,0)
Internal Fileman Start Date/Time
"KRN",8994,692,2,4,0)
PSBSTOP^1^20^1^4
"KRN",8994,692,2,4,1,0)
^^1^1^3011127^
"KRN",8994,692,2,4,1,1,0)
Fileman Stop Date/Time
"KRN",8994,692,2,5,0)
PSBINCL^1^15^1^5
"KRN",8994,692,2,5,1,0)
^8994.021^8^8^3020904^^^^
"KRN",8994,692,2,5,1,1,0)
Contains the parameters for a Due List in up-arrow pieces.
"KRN",8994,692,2,5,1,2,0)
 
"KRN",8994,692,2,5,1,3,0)
Piece   1: 1/0 Include Continuous Meds
"KRN",8994,692,2,5,1,4,0)
        2: 1/0 Include PRN Meds
"KRN",8994,692,2,5,1,5,0)
        3: 1/0 Include OnCall Meds
"KRN",8994,692,2,5,1,6,0)
        4: 1/0 Include OneTime Meds
"KRN",8994,692,2,5,1,7,0)
        5: 1/0 Include Comments
"KRN",8994,692,2,5,1,8,0)
        6: 1/0 Include Audits
"KRN",8994,692,2,5,1,9,0)
blanks at the end of the report.
"KRN",8994,692,2,6,0)
PSBDEV^1^30^0^6
"KRN",8994,692,2,6,1,0)
^^1^1^3011127^
"KRN",8994,692,2,6,1,1,0)
Contains the name of the device that the report prints to.
"KRN",8994,692,2,7,0)
PSBSORT^1^1^1^7
"KRN",8994,692,2,7,1,0)
^^1^1^3011127^
"KRN",8994,692,2,7,1,1,0)
Sorts the report by patient or by ward
"KRN",8994,692,2,8,0)
PSBOI^1^7^1^8
"KRN",8994,692,2,8,1,0)
^8994.021^1^1^3070604^^^
"KRN",8994,692,2,8,1,1,0)
Order/Orderable Item number. 
"KRN",8994,692,2,9,0)
PSBWLOC^1^30^0^9
"KRN",8994,692,2,9,1,0)
^8994.021^1^1^3080806^^^
"KRN",8994,692,2,9,1,1,0)
Ward Location 
"KRN",8994,692,2,10,0)
PSBWSORT^1^1^0^10
"KRN",8994,692,2,10,1,0)
^^2^2^3011127^
"KRN",8994,692,2,10,1,1,0)
Sort By Patient - "P"
"KRN",8994,692,2,10,1,2,0)
  or By Bed     - "B"
"KRN",8994,692,2,11,0)
PSBFUT^1^1^1^11
"KRN",8994,692,2,11,1,0)
^8994.021^6^6^3030326^^^^
"KRN",8994,692,2,11,1,1,0)
Contains the parameters for Due list in up-arrow pieces
"KRN",8994,692,2,11,1,2,0)
 
"KRN",8994,692,2,11,1,3,0)
Piece   1: 1/0 Include Blanks (Changes/Addendums)
"KRN",8994,692,2,11,1,4,0)
        2: 1/0 Include IV Meds
"KRN",8994,692,2,11,1,5,0)
        3: 1/0 Include Unit Dose Meds
"KRN",8994,692,2,11,1,6,0)
        4: 1/0 Include Future Orders
"KRN",8994,692,2,12,0)
PSBORDNUM^1^^^12
"KRN",8994,692,2,12,1,0)
^8994.021^7^7^3031209^^^^
"KRN",8994,692,2,12,1,1,0)
The PSBORDNUM is the pharmacy order number from the Inpatient Medications
"KRN",8994,692,2,12,1,2,0)
package.
"KRN",8994,692,2,12,1,3,0)
 
"KRN",8994,692,2,12,1,4,0)
Example: 10U or 10V
"KRN",8994,692,2,12,1,5,0)
 
"KRN",8994,692,2,12,1,6,0)
This order number is used to do a lookup of medications by orderable item 
"KRN",8994,692,2,12,1,7,0)
for the medication history report.
"KRN",8994,692,2,13,0)
PSBLIST^2^^0^14
"KRN",8994,692,2,13,1,0)
^^19^19^3070619^
"KRN",8994,692,2,13,1,1,0)
This  OPTIONAL  parameter contains list of data to input for the creating 
"KRN",8994,692,2,13,1,2,0)
of a report.  The report's developer/designer should be aware of
"KRN",8994,692,2,13,1,3,0)
the type of information to be input via this parameter.  For example per 
"KRN",8994,692,2,13,1,4,0)
the BCMA Medication Therapy Report , this parameter will contain a list of
"KRN",8994,692,2,13,1,5,0)
Dispensed Drug(s)/VA Drug Classification(s)/Orderable Items to be used 
"KRN",8994,692,2,13,1,6,0)
per a "Medical Therapy Report".
"KRN",8994,692,2,13,1,7,0)
 Each item in the list will be tagged respectively: "DD"/"VAC"/"OIT"  Each
"KRN",8994,692,2,13,1,8,0)
item will have the appropriate file pointer data as "^"piece #3.
"KRN",8994,692,2,13,1,9,0)
 
"KRN",8994,692,2,13,1,10,0)
example:
"KRN",8994,692,2,13,1,11,0)
 
"KRN",8994,692,2,13,1,12,0)
List[0]=        "MT^OIT^1043"
"KRN",8994,692,2,13,1,13,0)
List[1]=        "MT^OIT^475"
"KRN",8994,692,2,13,1,14,0)
List[2]=        "MT^OIT^464"
"KRN",8994,692,2,13,1,15,0)
List[3]=        "MT^OIT^88"
"KRN",8994,692,2,13,1,16,0)
 
"KRN",8994,692,2,13,1,17,0)
 
"KRN",8994,692,2,13,1,18,0)
 
"KRN",8994,692,2,13,1,19,0)
The data in the list will be filed into SUBFILE #53.692  (MULTIPLE).
"KRN",8994,692,2,14,0)
PSBRCRI^1^^0^13
"KRN",8994,692,2,14,1,0)
^^10^10^3070619^
"KRN",8994,692,2,14,1,1,0)
Optional parameter contains "additional" report criteria.  The Idea 
"KRN",8994,692,2,14,1,2,0)
is to make the first part of the data to designate the purpose of the data
"KRN",8994,692,2,14,1,3,0)
being input.  An example is to send an addition "Query Date" the 
"KRN",8994,692,2,14,1,4,0)
literal "QD^3070419.1200"  could be the input data.  
"KRN",8994,692,2,14,1,5,0)
 
"KRN",8994,692,2,14,1,6,0)
 
"KRN",8994,692,2,14,1,7,0)
Current list of tags:
"KRN",8994,692,2,14,1,8,0)
 
"KRN",8994,692,2,14,1,9,0)
 
"KRN",8994,692,2,14,1,10,0)
"QD" - query date
"KRN",8994,692,2,15,0)
PSBORDNM^^^^12
"KRN",8994,692,2,16,0)
PSBPST^1^5^0^15
"KRN",8994,692,2,16,1,0)
^^2^2^3080806^
"KRN",8994,692,2,16,1,1,0)
IDENTIFIES THE PRIMARY, SECONDARY AND TERTIARY SORT ORDERS FOR THE REPORT 
"KRN",8994,692,2,16,1,2,0)
SEPARATED BY "^".
"KRN",8994,692,2,17,0)
PSBTR^1^10^0^1
"KRN",8994,692,2,17,1,0)
^8994.021^1^1^3081208^^
"KRN",8994,692,2,17,1,1,0)
This field defines what sub-headers will be printed on the report.
"KRN",8994,692,2,18,0)
PSBSIFIL^1^1^0^18
"KRN",8994,692,2,18,1,0)
^8994.021^3^3^3120109^^
"KRN",8994,692,2,18,1,1,0)
Include Special Instructions/Other Print Info on report Yes/No.
"KRN",8994,692,2,18,1,2,0)
0 = No
"KRN",8994,692,2,18,1,3,0)
1 = Yes
"KRN",8994,692,2,"B","PSBDEV",6)

"KRN",8994,692,2,"B","PSBDFN",2)

"KRN",8994,692,2,"B","PSBDL",5)

"KRN",8994,692,2,"B","PSBFUT",11)

"KRN",8994,692,2,"B","PSBINCL",5)

"KRN",8994,692,2,"B","PSBLIST",13)

"KRN",8994,692,2,"B","PSBOI",8)

"KRN",8994,692,2,"B","PSBORDNM",15)

"KRN",8994,692,2,"B","PSBORDNUM",12)

"KRN",8994,692,2,"B","PSBPST",16)

"KRN",8994,692,2,"B","PSBRCRI",14)

"KRN",8994,692,2,"B","PSBSIFIL",18)

"KRN",8994,692,2,"B","PSBSORT",7)

"KRN",8994,692,2,"B","PSBSTOP",4)

"KRN",8994,692,2,"B","PSBSTRT",3)

"KRN",8994,692,2,"B","PSBTR",17)

"KRN",8994,692,2,"B","PSBTYPE",1)

"KRN",8994,692,2,"B","PSBWLOC",9)

"KRN",8994,692,2,"B","PSBWSORT",10)

"KRN",8994,692,2,"PARAMSEQ",1,1)

"KRN",8994,692,2,"PARAMSEQ",1,17)

"KRN",8994,692,2,"PARAMSEQ",2,2)

"KRN",8994,692,2,"PARAMSEQ",3,3)

"KRN",8994,692,2,"PARAMSEQ",4,4)

"KRN",8994,692,2,"PARAMSEQ",5,5)

"KRN",8994,692,2,"PARAMSEQ",6,6)

"KRN",8994,692,2,"PARAMSEQ",7,7)

"KRN",8994,692,2,"PARAMSEQ",8,8)

"KRN",8994,692,2,"PARAMSEQ",8,9)

"KRN",8994,692,2,"PARAMSEQ",9,9)

"KRN",8994,692,2,"PARAMSEQ",10,10)

"KRN",8994,692,2,"PARAMSEQ",11,11)

"KRN",8994,692,2,"PARAMSEQ",12,12)

"KRN",8994,692,2,"PARAMSEQ",12,15)

"KRN",8994,692,2,"PARAMSEQ",13,14)

"KRN",8994,692,2,"PARAMSEQ",14,13)

"KRN",8994,692,2,"PARAMSEQ",15,16)

"KRN",8994,692,2,"PARAMSEQ",18,18)

"KRN",8994,692,3,0)
^8994.03^1^1^3120109^^^^
"KRN",8994,692,3,1,0)
Text of report.
"KRN",8994,1231,-1)
0^1
"KRN",8994,1231,0)
PSB GETORDERTAB^RPC^PSBVDLTB^4^P^^^1^3
"KRN",8994,1231,1,0)
^8994.01^1^1^3111020^^
"KRN",8994,1231,1,1,0)
Gives the client VDL information for the specified patient and time frame.
"KRN",8994,1231,2,0)
^8994.02A^4^4
"KRN",8994,1231,2,1,0)
DFN^1^30^1^1
"KRN",8994,1231,2,1,1,0)
^8994.021^1^1^3070712^^^^
"KRN",8994,1231,2,1,1,1,0)
The patient IEN from ^DPT.
"KRN",8994,1231,2,2,0)
VDL TAB^1^30^1^2
"KRN",8994,1231,2,2,1,0)
^8994.021^1^1^3070712^^^
"KRN",8994,1231,2,2,1,1,0)
The tab from the VDL that is being requested.
"KRN",8994,1231,2,3,0)
VDL DATE^1^30^0^3
"KRN",8994,1231,2,3,1,0)
^8994.021^2^2^3111020^^^^
"KRN",8994,1231,2,3,1,1,0)
The date of the requested data.  If not passed then current date/time are
"KRN",8994,1231,2,3,1,2,0)
used.
"KRN",8994,1231,2,4,0)
PSBSIOPI^1^1^0^4
"KRN",8994,1231,2,4,1,0)
^^5^5^3120110^
"KRN",8994,1231,2,4,1,1,0)
 This parameter is a true/false flag (1/0).  If true use the new SI/OP Wp
"KRN",8994,1231,2,4,1,2,0)
 fields and return data in the Results array to the GUI Client.
"KRN",8994,1231,2,4,1,3,0)
  
"KRN",8994,1231,2,4,1,4,0)
 The field is not required, so a null will convert into a 0, for false,
"KRN",8994,1231,2,4,1,5,0)
 making this backwards compatible.
"KRN",8994,1231,2,"B","DFN",1)

"KRN",8994,1231,2,"B","PSBSIOPI",4)

"KRN",8994,1231,2,"B","VDL DATE",3)

"KRN",8994,1231,2,"B","VDL TAB",2)

"KRN",8994,1231,2,"PARAMSEQ",1,1)

"KRN",8994,1231,2,"PARAMSEQ",2,2)

"KRN",8994,1231,2,"PARAMSEQ",3,3)

"KRN",8994,1231,2,"PARAMSEQ",4,4)

"KRN",8994,1231,3,0)
^8994.03^79^79^3120221^^
"KRN",8994,1231,3,1,0)
 
"KRN",8994,1231,3,2,0)
If a valid list of orders are found they are returned in a block format
"KRN",8994,1231,3,3,0)
with the word 'END' delimiting orders/administrations.  Lines for
"KRN",8994,1231,3,4,0)
subsequent block are numbered sequential.  They are not reset to 1 for
"KRN",8994,1231,3,5,0)
each
"KRN",8994,1231,3,6,0)
block.
"KRN",8994,1231,3,7,0)
 
"KRN",8994,1231,3,8,0)
 
"KRN",8994,1231,3,9,0)
 
"KRN",8994,1231,3,10,0)
  Results[0] =  ^1      The number of lines returned(count)
"KRN",8994,1231,3,11,0)
 
"KRN",8994,1231,3,12,0)
  Results[1] =  ^1      Data for the Unit Dose tab (0=no, 1=yes)
"KRN",8994,1231,3,13,0)
                ^2      Data for the Piggy Back tab (0=no, 1=yes)
"KRN",8994,1231,3,14,0)
                ^3      Data for the IV tab (0=no, 1=yes)
"KRN",8994,1231,3,15,0)
                ^4      Transfer type if there was a patient movement
"KRN",8994,1231,3,16,0)
                ^5      Movement type if there was a patient movement
"KRN",8994,1231,3,17,0)
 
"KRN",8994,1231,3,18,0)
  Results[2] =  ^1      DFN
"KRN",8994,1231,3,19,0)
                ^2      ORDER NUMBER (20V)
"KRN",8994,1231,3,20,0)
                ^3      NUMERIC PORTION OF ORDER NUMBER (20)
"KRN",8994,1231,3,21,0)
                ^4      ALPHA PORTION OF ORDER NUMBER (V)
"KRN",8994,1231,3,22,0)
                ^5      SCHEDULE TYPE (prn/continuous)
"KRN",8994,1231,3,23,0)
                ^6      SCHEDULE (Q4H)
"KRN",8994,1231,3,24,0)
                ^7      SELF MED (SM or HSM)
"KRN",8994,1231,3,25,0)
                ^8      DRUG NAME
"KRN",8994,1231,3,26,0)
                ^9      DOSAGE/FLOW RATE
"KRN",8994,1231,3,27,0)
                ^10     MED ROUTE
"KRN",8994,1231,3,28,0)
                ^11     LAST ACTION DATE/TIME (FM format)
"KRN",8994,1231,3,29,0)
                ^12     MED LOG IEN (blank if no action)
"KRN",8994,1231,3,30,0)
                ^13     LAST ACTION STATUS (this entry)
"KRN",8994,1231,3,31,0)
                ^14     SCHEDULED ADMIN DATE/TIME
"KRN",8994,1231,3,32,0)
                ^15     ORDERABLE ITEM IEN (^ORD(101.43)
"KRN",8994,1231,3,33,0)
                ^16     INJECTABLE (0=no, 1=yes)
"KRN",8994,1231,3,34,0)
                ^17     VARIABLE DOSE (0=no, 1=yes)
"KRN",8994,1231,3,35,0)
                ^18     DOSEAGE FORM
"KRN",8994,1231,3,36,0)
                ^19     VERIFYING NURSE INITIALS (*** if none)
"KRN",8994,1231,3,37,0)
                ^20     LAST ACTION STATUS (whole order)
"KRN",8994,1231,3,38,0)
                ^21     ORDER START DATE/TIME (FM)
"KRN",8994,1231,3,39,0)
                ^22     ORDER STATUS
"KRN",8994,1231,3,40,0)
                ^23     UNIQUE ID OF BAG
"KRN",8994,1231,3,41,0)
                ^24     NURSES IEN
"KRN",8994,1231,3,42,0)
                ^25     TRANSACTION TYPE
"KRN",8994,1231,3,43,0)
                ^26     ORDER STOP DATE (FM)
"KRN",8994,1231,3,44,0)
                ^27     LAST "GIVEN" DATE (FM)
"KRN",8994,1231,3,45,0)
                ^28     GIVEN PATCH (1=yes)
"KRN",8994,1231,3,46,0)
                ^29     OVERRIDE/INTERVENTION REASONS EXIST (0=No;1=Yes)
"KRN",8994,1231,3,47,0)
                ^30     LAST INJECTION SITE TEXT (per Orderable Item)
"KRN",8994,1231,3,48,0)
                ^31     PIGGYBACK TAB- ROTATION TYPE IV ORDER INJECTABLE 
"KRN",8994,1231,3,49,0)
                        FLAG  (0 or null = No ; 1 = Yes)
"KRN",8994,1231,3,50,0)
 
"KRN",8994,1231,3,51,0)
  ^Results[3] = ^1      SPECIAL INSTRUCTIONS (short field)
"KRN",8994,1231,3,52,0)
                        ("!"  <- BCMA FLAG may precede Text)
"KRN",8994,1231,3,53,0)
  ^Results[n] =
"KRN",8994,1231,3,54,0)
   Dispense Drug  ^1     LITERAL "DD"
"KRN",8994,1231,3,55,0)
                  ^2     DISPENSE DRUG IEN
"KRN",8994,1231,3,56,0)
                  ^3     DISPENSE DRUG NAME
"KRN",8994,1231,3,57,0)
                  ^4     UNITS PER DOSE
"KRN",8994,1231,3,58,0)
                  ^5     INACTIVE DATE
"KRN",8994,1231,3,59,0)
  ^Results[n]
"KRN",8994,1231,3,60,0)
   Additive       ^1    LITERAL "ADD"
"KRN",8994,1231,3,61,0)
                  ^2    ADDITIVE IEN
"KRN",8994,1231,3,62,0)
                  ^3    ADDITIVE NAME
"KRN",8994,1231,3,63,0)
                  ^4    STRENGTH
"KRN",8994,1231,3,64,0)
                  ^5    BOTTLE
"KRN",8994,1231,3,65,0)
  ^Results[n]
"KRN",8994,1231,3,66,0)
   Solution       ^1    LITERAL "SOL"
"KRN",8994,1231,3,67,0)
                  ^2    SOLUTION IEN
"KRN",8994,1231,3,68,0)
                  ^3    SOLUTION NAME
"KRN",8994,1231,3,69,0)
                  ^4    VOLUME
"KRN",8994,1231,3,70,0)
  ^Results[n]
"KRN",8994,1231,3,71,0)
   ID list        ^1    LITERAL "ID"
"KRN",8994,1231,3,72,0)
                  ^2    ID NUMBER
"KRN",8994,1231,3,73,0)
                  ^3    ADDITIVE IEN
"KRN",8994,1231,3,74,0)
                  ^...  EACH ADDITIONAL ADDITIVE IEN
"KRN",8994,1231,3,75,0)
  ^Results(n)
"KRN",8994,1231,3,76,0)
   SI WP text     ^1    LITERAL "SI"
"KRN",8994,1231,3,77,0)
                  ^2    SPECIAL INSTRUCTIONS LONG WP TEXT LINES
"KRN",8994,1231,3,78,0)
 
"KRN",8994,1231,3,79,0)
  ^Results[n]     ^1    LITERAL "END" TO INDICATE END OF BLOCK
"KRN",8994,1917,-1)
0^4
"KRN",8994,1917,0)
PSB COVERSHEET1^RPC^PSBCSUTL^4^A^0^^1^3
"KRN",8994,1917,1,0)
^8994.01^133^133^3120313^^
"KRN",8994,1917,1,1,0)
(modified 05/08/2007)
"KRN",8994,1917,1,2,0)
 
"KRN",8994,1917,1,3,0)
PSB COVERSHEET1 is to return order data per patient and construction of 
"KRN",8994,1917,1,4,0)
BCMA Coversheet view as presented by the BCMA-HSC Coversheet Phase II
"KRN",8994,1917,1,5,0)
SRS and SDD documentation.
"KRN",8994,1917,1,6,0)
 
"KRN",8994,1917,1,7,0)
INPUT:  communications area -  "" 
"KRN",8994,1917,1,8,0)
        patient's DFN       -  DFN     (patient ptr.)
"KRN",8994,1917,1,9,0)
                            -  TIME RANGE (24/48/72)
"KRN",8994,1917,1,10,0)
                            -  PSBSIOPI (SI/OPI Word Processing text line)
"KRN",8994,1917,1,11,0)
                                  (true/false flag 1/0 default=0 - Opt)
"KRN",8994,1917,1,12,0)
 
"KRN",8994,1917,1,13,0)
OUTPUT: results data        -  RESULTS array containing order data 
"KRN",8994,1917,1,14,0)
                                per +/-TIME RANGE hours.
"KRN",8994,1917,1,15,0)
 
"KRN",8994,1917,1,16,0)
 
"KRN",8994,1917,1,17,0)
 
"KRN",8994,1917,1,18,0)
 
"KRN",8994,1917,1,19,0)
Example "M" call and results:
"KRN",8994,1917,1,20,0)
 
"KRN",8994,1917,1,21,0)
 
"KRN",8994,1917,1,22,0)
 
"KRN",8994,1917,1,23,0)
D RPC^PSBCSUTL("",783,24,1)
"KRN",8994,1917,1,24,0)
 
"KRN",8994,1917,1,25,0)
RPC Call: PSB COVERSHEET1
"KRN",8994,1917,1,26,0)
Results[0] = 90
"KRN",8994,1917,1,27,0)
Results[1] = 1^0^1^1^COVERSHEET DATA FOLLOWS
"KRN",8994,1917,1,28,0)
Results[2] = ORD^783^85U^85^U^C^Q6H^^NITROGLYCERIN PATCH^200MG 
"KRN",8994,1917,1,29,0)
^EPIDURAL^3070501.115014^^^^455^0^0^PATCH^***^G^3070501.09^A^^^0^3070523.0
"KRN",8994,1917,1,30,0)
718^3070501.115014^1
"KRN",8994,1917,1,31,0)
Results[3] = ORC^!TEST MED THERAPY ANTIANGINALS
"KRN",8994,1917,1,32,0)
Results[4] = DD^2313^NITROGLYCERIN PATCHES 10MG/24HR^1^
"KRN",8994,1917,1,33,0)
Results[5] = 
"KRN",8994,1917,1,34,0)
ADM^3070501.09^^100000746^G^3070501.115014^TEJ^10000000039^^3070501.1500
"KRN",8994,1917,1,35,0)
Results[6] = CMT^THIS SHOULD SHOW ON THE MED THERAPY PER 56   
"KRN",8994,1917,1,36,0)
ANTIANGINALS^^10000000039^TEJ^3070501.115014
"KRN",8994,1917,1,37,0)
Results[7] = ADM^3070506.15^^^^^^^^3070501.1500
"KRN",8994,1917,1,38,0)
Results[8] = ADM^3070506.21^^^^^^^^3070501.1500
"KRN",8994,1917,1,39,0)
Results[9] = ADM^3070507.03^^^^^^^^3070501.1500
"KRN",8994,1917,1,40,0)
Results[10] = ADM^3070507.09^^^^^^^^3070501.1500
"KRN",8994,1917,1,41,0)
Results[11] = ADM^3070507.15^^^^^^^^3070501.1500
"KRN",8994,1917,1,42,0)
Results[12] = ADM^3070507.21^^^^^^^^3070501.1500
"KRN",8994,1917,1,43,0)
Results[13] = ADM^3070508.03^^^^^^^^3070501.1500
"KRN",8994,1917,1,44,0)
Results[14] = ADM^3070508.09^^^^^^^^3070501.1500
"KRN",8994,1917,1,45,0)
Results[15] = END
"KRN",8994,1917,1,46,0)
Results[16] = ORD^783^83U^83^U^C^Q3H^^RANITIDINE TAB^150MG 
"KRN",8994,1917,1,47,0)
^ORAL^3070405.12403^^^^558^0^0^TAB^***^R^3070430.1^A^^^0^3070602.1207^^1
"KRN",8994,1917,1,48,0)
Results[17] = ORC^!TEST THE ADMIN TIMES REPORT W/ DATE RANGE +3DAYS
"KRN",8994,1917,1,49,0)
Results[18] = DD^5094^RANITIDINE 150MG TAB^1^
"KRN",8994,1917,1,50,0)
Results[19] = ADM^3070506.13^^^^^^^^3070430.1000
"KRN",8994,1917,1,51,0)
Results[20] = ADM^3070506.16^^^^^^^^3070430.1000
"KRN",8994,1917,1,52,0)
Results[21] = ADM^3070506.19^^^^^^^^3070430.1000
"KRN",8994,1917,1,53,0)
Results[22] = ADM^3070506.22^^^^^^^^3070430.1000
"KRN",8994,1917,1,54,0)
Results[23] = ADM^3070507.01^^^^^^^^3070430.1000
"KRN",8994,1917,1,55,0)
Results[24] = ADM^3070507.04^^^^^^^^3070430.1000
"KRN",8994,1917,1,56,0)
Results[25] = ADM^3070507.07^^^^^^^^3070430.1000
"KRN",8994,1917,1,57,0)
Results[26] = ADM^3070507.1^^^^^^^^3070430.1000
"KRN",8994,1917,1,58,0)
Results[27] = ADM^3070507.13^^^^^^^^3070430.1000
"KRN",8994,1917,1,59,0)
Results[28] = ADM^3070507.16^^^^^^^^3070430.1000
"KRN",8994,1917,1,60,0)
Results[29] = ADM^3070507.19^^^^^^^^3070430.1000
"KRN",8994,1917,1,61,0)
Results[30] = ADM^3070507.22^^^^^^^^3070430.1000
"KRN",8994,1917,1,62,0)
Results[31] = ADM^3070508.01^^^^^^^^3070430.1000
"KRN",8994,1917,1,63,0)
Results[32] = ADM^3070508.04^^^^^^^^3070430.1000
"KRN",8994,1917,1,64,0)
Results[33] = ADM^3070508.07^^^^^^^^3070430.1000
"KRN",8994,1917,1,65,0)
Results[34] = ADM^3070508.1^^^^^^^^3070430.1000
"KRN",8994,1917,1,66,0)
Results[35] = ADM^3070508.13^^^^^^^^3070430.1000
"KRN",8994,1917,1,67,0)
Results[36] = END
"KRN",8994,1917,1,68,0)
Results[37] = ORD^783^84U^84^U^C^Q3H^^ISOSORBIDE DINITRATE TAB,ORAL^40MG 
"KRN",8994,1917,1,69,0)
^ORAL^^^^^354^0^0^TAB,ORAL^***^^3070501.07^A^^^0^3070603.04^^1
"KRN",8994,1917,1,70,0)
Results[38] = ORC^!TEST MED THERAPY ANTIANGINALS
"KRN",8994,1917,1,71,0)
Results[39] = DD^2191^ISOSORBIDE  20MG TAB ^2^
"KRN",8994,1917,1,72,0)
Results[40] = ADM^3070506.13^^^^^^^^3070501.0700
"KRN",8994,1917,1,73,0)
Results[41] = ADM^3070506.16^^^^^^^^3070501.0700
"KRN",8994,1917,1,74,0)
Results[42] = ADM^3070506.19^^^^^^^^3070501.0700
"KRN",8994,1917,1,75,0)
Results[43] = ADM^3070506.22^^^^^^^^3070501.0700
"KRN",8994,1917,1,76,0)
Results[44] = ADM^3070507.01^^^^^^^^3070501.0700
"KRN",8994,1917,1,77,0)
Results[45] = ADM^3070507.04^^^^^^^^3070501.0700
"KRN",8994,1917,1,78,0)
Results[46] = ADM^3070507.07^^^^^^^^3070501.0700
"KRN",8994,1917,1,79,0)
Results[47] = ADM^3070507.1^^^^^^^^3070501.0700
"KRN",8994,1917,1,80,0)
Results[48] = ADM^3070507.13^^^^^^^^3070501.0700
"KRN",8994,1917,1,81,0)
Results[49] = ADM^3070507.16^^^^^^^^3070501.0700
"KRN",8994,1917,1,82,0)
Results[50] = ADM^3070507.19^^^^^^^^3070501.0700
"KRN",8994,1917,1,83,0)
Results[51] = ADM^3070507.22^^^^^^^^3070501.0700
"KRN",8994,1917,1,84,0)
Results[52] = ADM^3070508.01^^^^^^^^3070501.0700
"KRN",8994,1917,1,85,0)
Results[53] = ADM^3070508.04^^^^^^^^3070501.0700
"KRN",8994,1917,1,86,0)
Results[54] = ADM^3070508.07^^^^^^^^3070501.0700
"KRN",8994,1917,1,87,0)
Results[55] = ADM^3070508.1^^^^^^^^3070501.0700
"KRN",8994,1917,1,88,0)
Results[56] = ADM^3070508.13^^^^^^^^3070501.0700
"KRN",8994,1917,1,89,0)
Results[57] = END
"KRN",8994,1917,1,90,0)
Results[58] = ORD^783^86U^86^U^C^Q3H^^PENTAERYTHRITOL TETRANITRATE 
"KRN",8994,1917,1,91,0)
TAB,ORAL^10MG 
"KRN",8994,1917,1,92,0)
^ORAL^3070501.125733^^^^481^0^0^TAB,ORAL^***^G^3070501.09^A^^^0^3070614.06
"KRN",8994,1917,1,93,0)
11^3070501.125733^1
"KRN",8994,1917,1,94,0)
Results[59] = ORC^!TEST THIS ONE TOO ANTIANGINALS
"KRN",8994,1917,1,95,0)
Results[60] = DD^251^PENTAERYTHRITOL  10MG TAB^1^
"KRN",8994,1917,1,96,0)
Results[61] = 
"KRN",8994,1917,1,97,0)
ADM^3070501.125733^^100000747^G^3070501.125733^TEJ^10000000039^^3070501.15
"KRN",8994,1917,1,98,0)
00
"KRN",8994,1917,1,99,0)
Results[62] = ADM^3070506.15^^^^^^^^3070501.1500
"KRN",8994,1917,1,100,0)
Results[63] = ADM^3070506.18^^^^^^^^3070501.1500
"KRN",8994,1917,1,101,0)
Results[64] = ADM^3070506.21^^^^^^^^3070501.1500
"KRN",8994,1917,1,102,0)
Results[65] = ADM^3070506.24^^^^^^^^3070501.1500
"KRN",8994,1917,1,103,0)
Results[66] = ADM^3070507.03^^^^^^^^3070501.1500
"KRN",8994,1917,1,104,0)
Results[67] = ADM^3070507.06^^^^^^^^3070501.1500
"KRN",8994,1917,1,105,0)
Results[68] = ADM^3070507.09^^^^^^^^3070501.1500
"KRN",8994,1917,1,106,0)
Results[69] = ADM^3070507.12^^^^^^^^3070501.1500
"KRN",8994,1917,1,107,0)
Results[70] = ADM^3070507.15^^^^^^^^3070501.1500
"KRN",8994,1917,1,108,0)
Results[71] = ADM^3070507.18^^^^^^^^3070501.1500
"KRN",8994,1917,1,109,0)
Results[72] = ADM^3070507.21^^^^^^^^3070501.1500
"KRN",8994,1917,1,110,0)
Results[73] = ADM^3070507.24^^^^^^^^3070501.1500
"KRN",8994,1917,1,111,0)
Results[74] = ADM^3070508.03^^^^^^^^3070501.1500
"KRN",8994,1917,1,112,0)
Results[75] = ADM^3070508.06^^^^^^^^3070501.1500
"KRN",8994,1917,1,113,0)
Results[76] = ADM^3070508.09^^^^^^^^3070501.1500
"KRN",8994,1917,1,114,0)
Results[77] = ADM^3070508.12^^^^^^^^3070501.1500
"KRN",8994,1917,1,115,0)
Results[78] = END
"KRN",8994,1917,1,116,0)
Results[79] = ORD^783^56V^56^V^C^^^POTASSIUM (K) LIQUID,ORAL^ 780 
"KRN",8994,1917,1,117,0)
ml/hr^INTRACARDIAC INTRA-ARTICULAR 
"KRN",8994,1917,1,118,0)
INTRAVENOUS^3070125.142403^^^^512^0^0^^***^S^3070423.08^A^^^0^3070525.2204
"KRN",8994,1917,1,119,0)
^^3
"KRN",8994,1917,1,120,0)
Results[80] = ORC^!THERE WILL BE NO ACTION ON THIS ORDER!!  nox)
"KRN",8994,1917,1,121,0)
Results[81] = ORF^CPRS^CPRS^REASON FOR THE CPRS FLAG...
"KRN",8994,1917,1,122,0)
Results[82] = ORF^NOX^No Action Taken On Order
"KRN",8994,1917,1,123,0)
Results[83] = ADD^24^KCL^78 MEQ^
"KRN",8994,1917,1,124,0)
Results[84] = SOL^14^DEXTROSE 5% IN N. SALINE^1000 ML^
"KRN",8994,1917,1,125,0)
Results[85] = ID^783V241^ADD;24^SOL;14
"KRN",8994,1917,1,126,0)
Results[86] = ID^783V240^ADD;24^SOL;14
"KRN",8994,1917,1,127,0)
Results[87] = ID^783V239^ADD;24^SOL;14
"KRN",8994,1917,1,128,0)
Results[88] = ID^783V238^ADD;24^SOL;14
"KRN",8994,1917,1,129,0)
Results[89] = ID^783V237^ADD;24^SOL;14
"KRN",8994,1917,1,130,0)
Results[90] = SI^Watch for next hour for any reaction to this medication 
"KRN",8994,1917,1,131,0)
Results[91] = SI^and stop administration if any side effects are observed
"KRN",8994,1917,1,132,0)
Results[92] = SI^and call Provider immediately for consult.
"KRN",8994,1917,1,133,0)
Results[93] = END
"KRN",8994,1917,2,0)
^8994.02A^4^3
"KRN",8994,1917,2,2,0)
DFN^1^^1^1
"KRN",8994,1917,2,2,1,0)
^8994.021^1^1^3070712^^^^
"KRN",8994,1917,2,2,1,1,0)
DFN is the internal entity number per the patient file (file #2).
"KRN",8994,1917,2,3,0)
HRSBACK^1^^0^2
"KRN",8994,1917,2,3,1,0)
^^2^2^3070712^
"KRN",8994,1917,2,3,1,1,0)
HRSBACK - (optional) The number of hours in the past the coversheet will 
"KRN",8994,1917,2,3,1,2,0)
supply order information for.  [default is 24 hours]
"KRN",8994,1917,2,4,0)
PSBSIOPI^1^1^0^3
"KRN",8994,1917,2,4,1,0)
^8994.021^5^5^3120313^^^
"KRN",8994,1917,2,4,1,1,0)
 This parameter is a true/false flag (1/0).  If true use the new SI/OP Wp
"KRN",8994,1917,2,4,1,2,0)
 fields and return data in the Results array to the GUI Client.
"KRN",8994,1917,2,4,1,3,0)
  
"KRN",8994,1917,2,4,1,4,0)
 The field is not required, so a null will convert into a 0, for false,
"KRN",8994,1917,2,4,1,5,0)
 making this backwards compatible.
"KRN",8994,1917,2,"B","DFN",2)

"KRN",8994,1917,2,"B","HRSBACK",3)

"KRN",8994,1917,2,"B","PSBSIOPI",4)

"KRN",8994,1917,2,"PARAMSEQ",1,2)

"KRN",8994,1917,2,"PARAMSEQ",2,3)

"KRN",8994,1917,2,"PARAMSEQ",3,4)

"KRN",8994,1917,3,0)
^^101^101^3120313^
"KRN",8994,1917,3,1,0)
(modified 05/08/2007)
"KRN",8994,1917,3,2,0)
 
"KRN",8994,1917,3,3,0)
Remote Procedure Call - PSB COVERSHEET1
"KRN",8994,1917,3,4,0)
RESULTS():
"KRN",8994,1917,3,5,0)
The return data will be listed in the RESULTS "global".
"KRN",8994,1917,3,6,0)
 
"KRN",8994,1917,3,7,0)
RESULTS data will presented with "headers":
"KRN",8994,1917,3,8,0)
 
"KRN",8994,1917,3,9,0)
ORD - Order data
"KRN",8994,1917,3,10,0)
 Order specific data
"KRN",8994,1917,3,11,0)
^1  "ORD"-header
"KRN",8994,1917,3,12,0)
^2  Patient's IEN
"KRN",8994,1917,3,13,0)
^3  Order #_Order type
"KRN",8994,1917,3,14,0)
^4  Order #
"KRN",8994,1917,3,15,0)
^5  Order type
"KRN",8994,1917,3,16,0)
^6  Schedule type
"KRN",8994,1917,3,17,0)
^7  Schedule
"KRN",8994,1917,3,18,0)
^8  Self med
"KRN",8994,1917,3,19,0)
^9  Drug name
"KRN",8994,1917,3,20,0)
^10 Dosage/Flow rate
"KRN",8994,1917,3,21,0)
^11 Med route
"KRN",8994,1917,3,22,0)
^12 Last Action Date/Time
"KRN",8994,1917,3,23,0)
^13 ""
"KRN",8994,1917,3,24,0)
^14 ""
"KRN",8994,1917,3,25,0)
^15 ""
"KRN",8994,1917,3,26,0)
^16 Orderable item (IEN)
"KRN",8994,1917,3,27,0)
^17 Injectable?
"KRN",8994,1917,3,28,0)
^18 Variable dose?
"KRN",8994,1917,3,29,0)
^19 Dosage form
"KRN",8994,1917,3,30,0)
^20 Verifying nurse initials (*** if none)
"KRN",8994,1917,3,31,0)
^21 Last action status (whole order)
"KRN",8994,1917,3,32,0)
^22 Order start date/time (FM)
"KRN",8994,1917,3,33,0)
^23 Order status
"KRN",8994,1917,3,34,0)
^24 ""
"KRN",8994,1917,3,35,0)
^25 ""
"KRN",8994,1917,3,36,0)
^26 Transaction type
"KRN",8994,1917,3,37,0)
^27 Order stop date/time (FM)
"KRN",8994,1917,3,38,0)
^28 Last Given Date/Time
"KRN",8994,1917,3,39,0)
^29 Virtual Due List (VDL) tab indicator = "UD":1 "IVPB":2 "IV":3
"KRN",8994,1917,3,40,0)
^30 Override/Intervention reasons/comments exist (0=No;1=Yes) 
"KRN",8994,1917,3,41,0)
 
"KRN",8994,1917,3,42,0)
ORC - Order Comment/Special instruction
"KRN",8994,1917,3,43,0)
^1  "ORC"- header
"KRN",8994,1917,3,44,0)
^2  Special instruction
"KRN",8994,1917,3,45,0)
 
"KRN",8994,1917,3,46,0)
 
"KRN",8994,1917,3,47,0)
ORF - Order Flag
"KRN",8994,1917,3,48,0)
^1  "ORF"- header
"KRN",8994,1917,3,49,0)
^2  type of flag
"KRN",8994,1917,3,50,0)
^3  flag origin
"KRN",8994,1917,3,51,0)
^4  associated comment
"KRN",8994,1917,3,52,0)
 
"KRN",8994,1917,3,53,0)
 
"KRN",8994,1917,3,54,0)
DD  - Dispense Drug
"KRN",8994,1917,3,55,0)
^1  "DD" - header
"KRN",8994,1917,3,56,0)
^2  Dispense drug IEN
"KRN",8994,1917,3,57,0)
^3  Dispense drug name
"KRN",8994,1917,3,58,0)
^4  Units per dose
"KRN",8994,1917,3,59,0)
^5  Inactive date
"KRN",8994,1917,3,60,0)
 
"KRN",8994,1917,3,61,0)
ADD - Additive
"KRN",8994,1917,3,62,0)
^1  "ADD" - header
"KRN",8994,1917,3,63,0)
^2  Additive IEN
"KRN",8994,1917,3,64,0)
^3  Additive name
"KRN",8994,1917,3,65,0)
^4  Strength
"KRN",8994,1917,3,66,0)
^5  Bottle
"KRN",8994,1917,3,67,0)
 
"KRN",8994,1917,3,68,0)
SOL - Solution
"KRN",8994,1917,3,69,0)
^1  "SOL" - header
"KRN",8994,1917,3,70,0)
^2  Solution IEN
"KRN",8994,1917,3,71,0)
^3  Solution name
"KRN",8994,1917,3,72,0)
^4  Volume
"KRN",8994,1917,3,73,0)
 
"KRN",8994,1917,3,74,0)
ID  - Identification
"KRN",8994,1917,3,75,0)
^1  "ID" - header
"KRN",8994,1917,3,76,0)
^2  ID number
"KRN",8994,1917,3,77,0)
^3  Additive IEN
"KRN",8994,1917,3,78,0)
 
"KRN",8994,1917,3,79,0)
ADM - Administration
"KRN",8994,1917,3,80,0)
^1  "ADM" - header
"KRN",8994,1917,3,81,0)
^2  Scheduled admin date/time
"KRN",8994,1917,3,82,0)
^3  Bag id
"KRN",8994,1917,3,83,0)
^4  Med log ien
"KRN",8994,1917,3,84,0)
^5  Action
"KRN",8994,1917,3,85,0)
^6  Date/time
"KRN",8994,1917,3,86,0)
^7  Action by initials
"KRN",8994,1917,3,87,0)
^8  Action by ien
"KRN",8994,1917,3,88,0)
^9  Prn reason
"KRN",8994,1917,3,89,0)
^10 Next Action Date/Time
"KRN",8994,1917,3,90,0)
 
"KRN",8994,1917,3,91,0)
CMT - Comment per administration
"KRN",8994,1917,3,92,0)
^1  "CMT" - header
"KRN",8994,1917,3,93,0)
^2  Comment
"KRN",8994,1917,3,94,0)
^3  Prn effectiveness 
"KRN",8994,1917,3,95,0)
 
"KRN",8994,1917,3,96,0)
SI - WP text for Special Instruction/Other Print Info
"KRN",8994,1917,3,97,0)
^1    Literal "SI"
"KRN",8994,1917,3,98,0)
^2    Special Instruction/Other Print Info text line
"KRN",8994,1917,3,99,0)
 
"KRN",8994,1917,3,100,0)
END - End
"KRN",8994,1917,3,101,0)
^1  "END" - header
"KRN",8994,2933,-1)
0^2
"KRN",8994,2933,0)
PSB GETINJECTIONSITE^RPC^PSBINJEC^2^P^0^^1^2
"KRN",8994,2933,1,0)
^8994.01^4^4^3111020^^
"KRN",8994,2933,1,1,0)
Get the last nn injections site info from the BCMA MEDICATION LOG file 
"KRN",8994,2933,1,2,0)
#53.9.   Get only of specific Orderable Items per patient in reverse
"KRN",8994,2933,1,3,0)
chronology date/time order or All Orderable Items per patient in 
"KRN",8994,2933,1,4,0)
reverse chronology date/time order.
"KRN",8994,2933,2,0)
^8994.02A^5^4
"KRN",8994,2933,2,1,0)
DFN^1^^1^1
"KRN",8994,2933,2,1,1,0)
^8994.021^1^1^3110912^^
"KRN",8994,2933,2,1,1,1,0)
Patient IEN number.
"KRN",8994,2933,2,3,0)
TIME^1^^1^3
"KRN",8994,2933,2,3,1,0)
^^2^2^3111020^
"KRN",8994,2933,2,3,1,1,0)
A time range, in hours, to search backwards through the BCMA MEDICATION 
"KRN",8994,2933,2,3,1,2,0)
LOG file #53.79 for injection site data. 
"KRN",8994,2933,2,4,0)
MAX^1^^1^4
"KRN",8994,2933,2,4,1,0)
^8994.021^2^2^3110912^^
"KRN",8994,2933,2,4,1,1,0)
The maximum number of injection site items to return within the Time 
"KRN",8994,2933,2,4,1,2,0)
Range specified.
"KRN",8994,2933,2,5,0)
PSBOI^1^^0^2
"KRN",8994,2933,2,5,1,0)
^8994.021^1^1^3111020^^^
"KRN",8994,2933,2,5,1,1,0)
Orderable Item IEN.
"KRN",8994,2933,2,"B","DFN",1)

"KRN",8994,2933,2,"B","MAX",4)

"KRN",8994,2933,2,"B","PSBOI",5)

"KRN",8994,2933,2,"B","TIME",3)

"KRN",8994,2933,2,"PARAMSEQ",1,1)

"KRN",8994,2933,2,"PARAMSEQ",2,5)

"KRN",8994,2933,2,"PARAMSEQ",3,3)

"KRN",8994,2933,2,"PARAMSEQ",4,4)

"KRN",8994,2933,3,0)
^^8^8^3120109^
"KRN",8994,2933,3,1,0)
 Results[0] = Number of Nodes.
"KRN",8994,2933,3,2,0)
 Results[n]= ^1  Action Date/Time (Fileman format)
"KRN",8994,2933,3,3,0)
             ^2  Orderable Item IEN
"KRN",8994,2933,3,4,0)
             ^3  Orderable Item Name
"KRN",8994,2933,3,5,0)
             ^4  Injection Site
"KRN",8994,2933,3,6,0)
 
"KRN",8994,2933,3,7,0)
 Results[1]= ^1  -1
"KRN",8994,2933,3,8,0)
             ^2  Error text message, i.e. <<No data to display>>
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"ORD",21,8989.52)
8989.52;21;1;;PAR2E1^XPDTA2;PAR2F1^XPDIA3;PAR2E1^XPDIA3;PAR2F2^XPDIA3;;PAR2DEL^XPDIA3(%)
"ORD",21,8989.52,0)
PARAMETER TEMPLATE
"PKG",536,-1)
1^1
"PKG",536,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",536,20,0)
^9.402P^^
"PKG",536,22,0)
^9.49I^1^1
"PKG",536,22,1,0)
3.0^3040224^3040819^11874
"PKG",536,22,1,"PAH",1,0)
68^3120416^11909
"PKG",536,22,1,"PAH",1,1,0)
^^95^95^3120416
"PKG",536,22,1,"PAH",1,1,1,0)
*************************************************************************
"PKG",536,22,1,"PAH",1,1,2,0)
 IMPORTANT: PATCH PSJ*5*267 MUST BE INSTALLED BEFORE THE INSTALLATION 
"PKG",536,22,1,"PAH",1,1,3,0)
            OF THIS PATCH.
"PKG",536,22,1,"PAH",1,1,4,0)
 
"PKG",536,22,1,"PAH",1,1,5,0)
 BCMA patch PSB*3*68 contains changes that will not function until patch 
"PKG",536,22,1,"PAH",1,1,6,0)
 PSJ*5*267 is installed. Both patches, PSJ*5*267 and PSB*3*68 need to be
"PKG",536,22,1,"PAH",1,1,7,0)
 installed for Inpatient Medications and BCMA to function correctly.
"PKG",536,22,1,"PAH",1,1,8,0)
*************************************************************************
"PKG",536,22,1,"PAH",1,1,9,0)
 
"PKG",536,22,1,"PAH",1,1,10,0)
ATTENTION: This patch includes a new Graphical User Interface (GUI) 
"PKG",536,22,1,"PAH",1,1,11,0)
executable file. Installation of this GUI is required immediately after 
"PKG",536,22,1,"PAH",1,1,12,0)
the KIDS install for the Patch to function.
"PKG",536,22,1,"PAH",1,1,13,0)
 
"PKG",536,22,1,"PAH",1,1,14,0)
This version of BCMA was successfully tested in the field against Wireless
"PKG",536,22,1,"PAH",1,1,15,0)
Medication Administration version 4.8 at Pittsburgh and Loma Linda.
"PKG",536,22,1,"PAH",1,1,16,0)
 
"PKG",536,22,1,"PAH",1,1,17,0)
For retrieval and installation instructions, please see the Client
"PKG",536,22,1,"PAH",1,1,18,0)
Installation Instructions section.
"PKG",536,22,1,"PAH",1,1,19,0)
 
"PKG",536,22,1,"PAH",1,1,20,0)
The Special Instructions and Other Print Info Project addresses 
"PKG",536,22,1,"PAH",1,1,21,0)
enhancements identified during Inpatient Medications Requirements for 
"PKG",536,22,1,"PAH",1,1,22,0)
Special Focus Group Initial Request Analysis (IMR SFG IRA) Phase 
"PKG",536,22,1,"PAH",1,1,23,0)
III/Phase IV, as well as modifications requested by the Bar Code
"PKG",536,22,1,"PAH",1,1,24,0)
Medication Administration (BCMA) and Inpatient Medications workgroups.  
"PKG",536,22,1,"PAH",1,1,25,0)
 
"PKG",536,22,1,"PAH",1,1,26,0)
The Inpatient Pharmacy patch PSJ*5*267 is also being released as part of
"PKG",536,22,1,"PAH",1,1,27,0)
these enhancements.  The projects purpose is to Standardize the character
"PKG",536,22,1,"PAH",1,1,28,0)
length between CPRS Provider's Comment, Inpatient Medications Special
"PKG",536,22,1,"PAH",1,1,29,0)
Instructions, and the IV Pharmacy Other Print Information fields.
"PKG",536,22,1,"PAH",1,1,30,0)
 
"PKG",536,22,1,"PAH",1,1,31,0)
The Inpatient Pharmacy patch PSJ*5*267 will add new fields to Inpatient 
"PKG",536,22,1,"PAH",1,1,32,0)
Medication to support an unlimited amount of text for Special 
"PKG",536,22,1,"PAH",1,1,33,0)
Instructions and Other Print Info (SI/OPI). 
"PKG",536,22,1,"PAH",1,1,34,0)
 
"PKG",536,22,1,"PAH",1,1,35,0)
1. BCMA Remote Procedure Calls (RPC) will be modified to send over the new
"PKG",536,22,1,"PAH",1,1,36,0)
   Inpatient Medications SI/OPI fields in an unlimited format to the BCMA
"PKG",536,22,1,"PAH",1,1,37,0)
   GUI client.
"PKG",536,22,1,"PAH",1,1,38,0)
 
"PKG",536,22,1,"PAH",1,1,39,0)
2. For backwards compatibility, of existing Active orders on file that
"PKG",536,22,1,"PAH",1,1,40,0)
   were using the old fixed length SI/OPI fields, then this information 
"PKG",536,22,1,"PAH",1,1,41,0)
   will be included in the new unlimited format also.
"PKG",536,22,1,"PAH",1,1,42,0)
 
"PKG",536,22,1,"PAH",1,1,43,0)
3. Modify the following reports to print the unlimited SI/OPI information:
"PKG",536,22,1,"PAH",1,1,44,0)
    a. Medication Administration History (MAH) Report
"PKG",536,22,1,"PAH",1,1,45,0)
    b. Display Order detail Report
"PKG",536,22,1,"PAH",1,1,46,0)
    c. Due List Report
"PKG",536,22,1,"PAH",1,1,47,0)
    d. IV Bag Status Report
"PKG",536,22,1,"PAH",1,1,48,0)
    e. Cover Sheet Report - Medication Overview Report
"PKG",536,22,1,"PAH",1,1,49,0)
    f. Cover Sheet Report - PRN Overview Report
"PKG",536,22,1,"PAH",1,1,50,0)
    g. Cover Sheet Report - IV Overview Report
"PKG",536,22,1,"PAH",1,1,51,0)
    h. Cover Sheet Report - Expired/DC'd/Expiring Report
"PKG",536,22,1,"PAH",1,1,52,0)
    i. BCMA Backup System (BCBU) Print MAR for All Wards
"PKG",536,22,1,"PAH",1,1,53,0)
    j. BCMA Backup System (BCBU) Print MAR for Selected Patient
"PKG",536,22,1,"PAH",1,1,54,0)
    k. BCMA Backup System (BCBU) Print MAR for Selected Ward
"PKG",536,22,1,"PAH",1,1,55,0)
 
"PKG",536,22,1,"PAH",1,1,56,0)
4. Add new check box field to allow if the unlimited text will be printed
"PKG",536,22,1,"PAH",1,1,57,0)
   on the following reports:
"PKG",536,22,1,"PAH",1,1,58,0)
    a. Due List Report
"PKG",536,22,1,"PAH",1,1,59,0)
    b. IV Bag Status Report
"PKG",536,22,1,"PAH",1,1,60,0)
    c. Cover Sheet Report - Medication Overview Report
"PKG",536,22,1,"PAH",1,1,61,0)
    d. Cover Sheet Report - PRN Overview Report
"PKG",536,22,1,"PAH",1,1,62,0)
    e. Cover Sheet Report - IV Overview Report
"PKG",536,22,1,"PAH",1,1,63,0)
    f. Cover Sheet Report - Expired/DC'd/Expiring Report
"PKG",536,22,1,"PAH",1,1,64,0)
 
"PKG",536,22,1,"PAH",1,1,65,0)
5. BCMA Client:
"PKG",536,22,1,"PAH",1,1,66,0)
    a. Added window to display unlimited Special Instructions / Other
"PKG",536,22,1,"PAH",1,1,67,0)
       Print Info via menu, right-click, and function key (F6).  This
"PKG",536,22,1,"PAH",1,1,68,0)
       window is also used to display Special Instructions / Other Print
"PKG",536,22,1,"PAH",1,1,69,0)
       Info when an order is flagged in Inpatient Medications and is given
"PKG",536,22,1,"PAH",1,1,70,0)
       in BCMA.
"PKG",536,22,1,"PAH",1,1,71,0)
    b. Fields which displayed Special Instructions / Other Print Info in
"PKG",536,22,1,"PAH",1,1,72,0)
       forms were widened to 80 characters and have vertical scroll.
"PKG",536,22,1,"PAH",1,1,73,0)
    c. Added Last Injections Site column to the Unit Dose VDL to show the 
"PKG",536,22,1,"PAH",1,1,74,0)
       what the last site was per Orderable item.
"PKG",536,22,1,"PAH",1,1,75,0)
    d. Enhanced the Injection Site dialog window to show two 
"PKG",536,22,1,"PAH",1,1,76,0)
       history tables.
"PKG",536,22,1,"PAH",1,1,77,0)
          1) To show the last 4 sites per the medication being given.
"PKG",536,22,1,"PAH",1,1,78,0)
          2) To show last 10 sites per the patient for any medication.
"PKG",536,22,1,"PAH",1,1,79,0)
      The tables above will use a new Division parameter, "Injection Site 
"PKG",536,22,1,"PAH",1,1,80,0)
      History Max Hours", added with this patch that controls how many
"PKG",536,22,1,"PAH",1,1,81,0)
      hours to look back when compiling these history tables.  The default
"PKG",536,22,1,"PAH",1,1,82,0)
      will be initialized to 72 hours, with this patch.
"PKG",536,22,1,"PAH",1,1,83,0)
 
"PKG",536,22,1,"PAH",1,1,84,0)
This Patch also Addresses 3 reported Remedy ticket issues:
"PKG",536,22,1,"PAH",1,1,85,0)
 
"PKG",536,22,1,"PAH",1,1,86,0)
1. After scanning a medication that requires multiple doses
"PKG",536,22,1,"PAH",1,1,87,0)
   or dosage strengths, the multiple dose dialog box's 
"PKG",536,22,1,"PAH",1,1,88,0)
   invalid medication pop-up functionality appears to be broken.
"PKG",536,22,1,"PAH",1,1,89,0)
2. Unable to view all allergies/ADRs on BCMA GUI for patient with
"PKG",536,22,1,"PAH",1,1,90,0)
   numerous allergies/ADRs.
"PKG",536,22,1,"PAH",1,1,91,0)
3. The Patient Record Flag changes from Red to Black if you lock
"PKG",536,22,1,"PAH",1,1,92,0)
   your computer. 
"PKG",536,22,1,"PAH",1,1,93,0)
 
"PKG",536,22,1,"PAH",1,1,94,0)
Please refer to the release notes for a full detailed list and examples 
"PKG",536,22,1,"PAH",1,1,95,0)
of items included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
21
"RTN","PSB3P68")
0^^B55551583^n/a
"RTN","PSB3P68",1,0)
PSB3P68 ;BIRMINGHAM/GN - POST INSTALL FOR PSB3P68 ;2/23/12 4:38pm
"RTN","PSB3P68",2,0)
 ;;3.0;BAR CODE MED ADMIN;**68**;Mar 2004;Build 26
"RTN","PSB3P68",3,0)
 ;
"RTN","PSB3P68",4,0)
 ; Init XPAR parameters DIV & SYS for PSB INJECTION SITE MAX HOURS
"RTN","PSB3P68",5,0)
 ; and submit a background job to build two indexes AINJ & AINJOI
"RTN","PSB3P68",6,0)
 ; for file 53.79.   
"RTN","PSB3P68",7,0)
 ;
"RTN","PSB3P68",8,0)
 ; Direct Programmer mode callable Tag's in this routine:
"RTN","PSB3P68",9,0)
 ;  STATUS - shows user the current status of the background job
"RTN","PSB3P68",10,0)
 ;  QUEUE  - allows user to manuall restart a previous Stopped or 
"RTN","PSB3P68",11,0)
 ;           Errored job and it will resume with where it left off.
"RTN","PSB3P68",12,0)
 ;
"RTN","PSB3P68",13,0)
BEGIN ;
"RTN","PSB3P68",14,0)
 N ENT,DV,T5,T10,T20,NAM,VAL
"RTN","PSB3P68",15,0)
 S T5="",$P(T5," ",5)=" ",T10="",$P(T10," ",10)=" ",T20="",$P(T20," ",20)=" "
"RTN","PSB3P68",16,0)
 S NAM="PSB INJECTION SITE MAX HOURS",VAL=72
"RTN","PSB3P68",17,0)
 D INITSYS(NAM,VAL)
"RTN","PSB3P68",18,0)
 D MES^XPDUTL("")
"RTN","PSB3P68",19,0)
 D MES^XPDUTL("*** PSB*3*68 Post Install Running ***")
"RTN","PSB3P68",20,0)
 D MES^XPDUTL("")
"RTN","PSB3P68",21,0)
 D MES^XPDUTL(" Initialize BCMA parameter PSB INJECTION SITE MAX HOURS...")
"RTN","PSB3P68",22,0)
 D MES^XPDUTL("")
"RTN","PSB3P68",23,0)
 D MES^XPDUTL("   DIV"_T20_T10_"MAX HRS")
"RTN","PSB3P68",24,0)
 D MES^XPDUTL("")
"RTN","PSB3P68",25,0)
 D INITDIV(NAM,VAL,0)    ;before update
"RTN","PSB3P68",26,0)
 D INITDIV(NAM,VAL,1)    ;after update
"RTN","PSB3P68",27,0)
 D MES^XPDUTL("")
"RTN","PSB3P68",28,0)
 H 2
"RTN","PSB3P68",29,0)
 ;
"RTN","PSB3P68",30,0)
QUEUE ;begin of queueing to background to run xref builder
"RTN","PSB3P68",31,0)
 N DA,DIK,ENDTIME,QUIT,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSK,ZTQUEUED,ZTSAVE
"RTN","PSB3P68",32,0)
 ;
"RTN","PSB3P68",33,0)
 ; setup variables and submit Cross Ref builder to Taskman
"RTN","PSB3P68",34,0)
 S ZTRTN=("JOB^PSB3P68")
"RTN","PSB3P68",35,0)
 S ZTDESC="BCMA Injection Site Cross Ref Builder"
"RTN","PSB3P68",36,0)
 S ZTDTH=$$NOW^XLFDT,ZTIO=""
"RTN","PSB3P68",37,0)
 ;check if already running or completed.
"RTN","PSB3P68",38,0)
 I $$CHKSTAT L -^XTMP($$NAMSPC) Q
"RTN","PSB3P68",39,0)
 L -^XTMP($$NAMSPC)
"RTN","PSB3P68",40,0)
 D ^%ZTLOAD
"RTN","PSB3P68",41,0)
 S ZTDESC="BCMA Injection Site Cross Ref Builder"
"RTN","PSB3P68",42,0)
 D MES^XPDUTL(""),MES^XPDUTL(" "_ZTDESC)
"RTN","PSB3P68",43,0)
 I $G(ZTSK) D
"RTN","PSB3P68",44,0)
 . D MES^XPDUTL(""),MES^XPDUTL(" This request queued as Task # "_ZTSK)
"RTN","PSB3P68",45,0)
 . D MES^XPDUTL(""),MES^XPDUTL(" A Mailman message will be sent to you when the Cross Reference Builder")
"RTN","PSB3P68",46,0)
 . D MES^XPDUTL(" completes.")
"RTN","PSB3P68",47,0)
 . D MES^XPDUTL("")
"RTN","PSB3P68",48,0)
 Q
"RTN","PSB3P68",49,0)
 ;
"RTN","PSB3P68",50,0)
JOB ; Entry point for taskman
"RTN","PSB3P68",51,0)
 L +^XTMP($$NAMSPC):10 I '$T D  Q   ;quit if can't get a lock
"RTN","PSB3P68",52,0)
 . S ^XTMP($$NAMSPC,0,"STATUS")="NO LOCK GAINED"_U_$$NOW^XLFDT
"RTN","PSB3P68",53,0)
 . S ^TMP($$NAMSPC,$J,"MSG",1)=""
"RTN","PSB3P68",54,0)
 . S ^TMP($$NAMSPC,$J,"MSG",2)=" Builder did not run, could not lock file."
"RTN","PSB3P68",55,0)
 . D MAIL(ZTDESC)
"RTN","PSB3P68",56,0)
 ;
"RTN","PSB3P68",57,0)
 N PCT,RECS,TLRECS,IEN,ZTSTOP,NAMSPC,BEGTIME,PURGDT,STAT
"RTN","PSB3P68",58,0)
 S NAMSPC=$$NAMSPC
"RTN","PSB3P68",59,0)
 S ZTDESC=$G(ZTDESC,"PSB3P68")
"RTN","PSB3P68",60,0)
 S ^XTMP(NAMSPC,0,"RECS TOTL")=$P($G(^PSB(53.79,0)),U,4)
"RTN","PSB3P68",61,0)
 ;
"RTN","PSB3P68",62,0)
 ;setup XTMP according to stds.
"RTN","PSB3P68",63,0)
 S BEGTIME=$$NOW^XLFDT()
"RTN","PSB3P68",64,0)
 S PURGDT=$$FMADD^XLFDT(BEGTIME,30)
"RTN","PSB3P68",65,0)
 S ^XTMP(NAMSPC,0)=PURGDT_U_BEGTIME_U_ZTDESC
"RTN","PSB3P68",66,0)
 S ^XTMP(NAMSPC,0,"TASKID")=$G(ZTSK,"DIRECT")
"RTN","PSB3P68",67,0)
 S:'$D(^XTMP(NAMSPC,0,"INITIAL TIME")) ^XTMP(NAMSPC,0,"INITIAL TIME")=$$NOW^XLFDT
"RTN","PSB3P68",68,0)
 ;get last run data
"RTN","PSB3P68",69,0)
 D GETLAST
"RTN","PSB3P68",70,0)
 I STAT]"",STAT'["COMPLETED" D
"RTN","PSB3P68",71,0)
 . S ^TMP($$NAMSPC,$J,"MSG",1)=""
"RTN","PSB3P68",72,0)
 . S ^TMP($$NAMSPC,$J,"MSG",2)=" Cross Reference Builder Resuming with IEN "_IEN
"RTN","PSB3P68",73,0)
 . S PCT=100-((RECS/TLRECS)*100\1)
"RTN","PSB3P68",74,0)
 . S ^TMP($$NAMSPC,$J,"MSG",3)=" Job has "_PCT_"% remaining to complete."
"RTN","PSB3P68",75,0)
 . D MAIL(ZTDESC)
"RTN","PSB3P68",76,0)
 . S ^XTMP(NAMSPC,0,"RESTART")="RESTARTED: "_$$NOW^XLFDT
"RTN","PSB3P68",77,0)
 ;
"RTN","PSB3P68",78,0)
 ;init begin time, if not there, and status & stop time fields
"RTN","PSB3P68",79,0)
 S ^XTMP(NAMSPC,0,"STATUS")="RUNNING since"_U_$$NOW^XLFDT
"RTN","PSB3P68",80,0)
 S ^XTMP(NAMSPC,0,"RECS TOTL")=TLRECS
"RTN","PSB3P68",81,0)
 ;
"RTN","PSB3P68",82,0)
 ;start/restart cleanups
"RTN","PSB3P68",83,0)
 S ZTSTOP=0
"RTN","PSB3P68",84,0)
 F  S IEN=$O(^PSB(53.79,IEN),-1) Q:'IEN  D  Q:ZTSTOP
"RTN","PSB3P68",85,0)
 . S DIK="^PSB(53.79,",DIK(1)=".01^AINJ^AINJOI"
"RTN","PSB3P68",86,0)
 . S DA=IEN D EN1^DIK
"RTN","PSB3P68",87,0)
 . S RECS=RECS+1
"RTN","PSB3P68",88,0)
 . ;update and check for stop request after every 2000 processed recs
"RTN","PSB3P68",89,0)
 . I RECS#2000=0 D
"RTN","PSB3P68",90,0)
 . . S:$$S^%ZTLOAD ZTSTOP=1           ;Systems person asked to stop
"RTN","PSB3P68",91,0)
 . . S ^XTMP(NAMSPC,0,"RECS DONE")=RECS
"RTN","PSB3P68",92,0)
 . . S ^XTMP(NAMSPC,0,"LAST IEN")=IEN
"RTN","PSB3P68",93,0)
 S ^XTMP(NAMSPC,0,"RECS DONE")=RECS
"RTN","PSB3P68",94,0)
 S ^XTMP(NAMSPC,0,"LAST IEN")=IEN
"RTN","PSB3P68",95,0)
 ;
"RTN","PSB3P68",96,0)
 ;set proper Exit status
"RTN","PSB3P68",97,0)
 I ZTSTOP D
"RTN","PSB3P68",98,0)
 . S ^XTMP(NAMSPC,0,"STATUS")="STOPPED"_U_$$NOW^XLFDT
"RTN","PSB3P68",99,0)
 E  D
"RTN","PSB3P68",100,0)
 . S ^XTMP(NAMSPC,0,"STATUS")="COMPLETED"_U_$$NOW^XLFDT
"RTN","PSB3P68",101,0)
 ;
"RTN","PSB3P68",102,0)
 N LIN
"RTN","PSB3P68",103,0)
 S LIN=0
"RTN","PSB3P68",104,0)
 K ^TMP(NAMSPC,$J)
"RTN","PSB3P68",105,0)
 ;get last run data
"RTN","PSB3P68",106,0)
 D GETLAST
"RTN","PSB3P68",107,0)
 ;build mailman text for message
"RTN","PSB3P68",108,0)
 S LIN=LIN+1,^TMP(NAMSPC,$J,"MSG",LIN)=ZTDESC_" Status: "_STAT_" "_$$FMTE^XLFDT(ENDTIME)
"RTN","PSB3P68",109,0)
 S LIN=LIN+1,^TMP(NAMSPC,$J,"MSG",LIN)=""
"RTN","PSB3P68",110,0)
 S LIN=LIN+1,^TMP(NAMSPC,$J,"MSG",LIN)=$J("Total Records in file:",30)_$J($FN(TLRECS,","),15)
"RTN","PSB3P68",111,0)
 S LIN=LIN+1,^TMP(NAMSPC,$J,"MSG",LIN)=$J("Records processed:",30)_$J($FN(RECS,","),15)
"RTN","PSB3P68",112,0)
 I STAT'["COMPLETED" D
"RTN","PSB3P68",113,0)
 . S LIN=LIN+1,^TMP(NAMSPC,$J,"MSG",LIN)=""
"RTN","PSB3P68",114,0)
 . S LIN=LIN+1,^TMP(NAMSPC,$J,"MSG",LIN)=$J("Reading file backwards",29)
"RTN","PSB3P68",115,0)
 . S LIN=LIN+1,^TMP(NAMSPC,$J,"MSG",LIN)=$J("Last IEN processed:",30)_$J(IEN,15)
"RTN","PSB3P68",116,0)
 . S PCT=(RECS/TLRECS)*100\1
"RTN","PSB3P68",117,0)
 I STAT["COMPLETED" D
"RTN","PSB3P68",118,0)
 . S PCT=100
"RTN","PSB3P68",119,0)
 . S LIN=LIN+1,^TMP(NAMSPC,$J,"MSG",LIN)=$J("Total elapsed time:",30)_$J($$FMDIFF^XLFDT(ENDTIME,BEGTIME,3),15)
"RTN","PSB3P68",120,0)
 S LIN=LIN+1,^TMP(NAMSPC,$J,"MSG",LIN)=$J("Percent complete:",30)_$J(PCT,14)_"%"
"RTN","PSB3P68",121,0)
 ;send the message
"RTN","PSB3P68",122,0)
 D MAIL(ZTDESC)
"RTN","PSB3P68",123,0)
 L -^XTMP(NAMSPC)
"RTN","PSB3P68",124,0)
 K ^TMP(NAMSPC,$J)
"RTN","PSB3P68",125,0)
 Q
"RTN","PSB3P68",126,0)
 ; 
"RTN","PSB3P68",127,0)
GETLAST ;get last run info  
"RTN","PSB3P68",128,0)
 S IEN=+$G(^XTMP(NAMSPC,0,"LAST IEN"))             ;last ien
"RTN","PSB3P68",129,0)
 S:IEN=0 IEN=999999999
"RTN","PSB3P68",130,0)
 S STAT=$P($G(^XTMP(NAMSPC,0,"STATUS")),U)         ;status
"RTN","PSB3P68",131,0)
 S RECS=+$G(^XTMP(NAMSPC,0,"RECS DONE"))           ;recs processed
"RTN","PSB3P68",132,0)
 S TLRECS=+$G(^XTMP(NAMSPC,0,"RECS TOTL"))         ;tot recs in file
"RTN","PSB3P68",133,0)
 S BEGTIME=$G(^XTMP(NAMSPC,0,"INITIAL TIME"))      ;initial begin time
"RTN","PSB3P68",134,0)
 S ENDTIME=$P($G(^XTMP(NAMSPC,0,"STATUS")),U,2)    ;end time
"RTN","PSB3P68",135,0)
 Q
"RTN","PSB3P68",136,0)
 ;
"RTN","PSB3P68",137,0)
INITSYS(NAM,VAL) ; Init the SYSTEM value
"RTN","PSB3P68",138,0)
 ; Input: NAM = param name
"RTN","PSB3P68",139,0)
 ;        VAL = num of hours
"RTN","PSB3P68",140,0)
 ;
"RTN","PSB3P68",141,0)
 D EN^XPAR("SYS",NAM,1,VAL)
"RTN","PSB3P68",142,0)
 Q
"RTN","PSB3P68",143,0)
 ;
"RTN","PSB3P68",144,0)
INITDIV(NAM,VAL,UPD) ; Init DIVISION value
"RTN","PSB3P68",145,0)
 ; Input: NAM = param name
"RTN","PSB3P68",146,0)
 ;        VAL = num of hours
"RTN","PSB3P68",147,0)
 ;        UPD = 1 to update, else list curr values only
"RTN","PSB3P68",148,0)
 ;
"RTN","PSB3P68",149,0)
 N FOUND S FOUND=0
"RTN","PSB3P68",150,0)
 D:'UPD MES^XPDUTL(" Before update")
"RTN","PSB3P68",151,0)
 D:UPD MES^XPDUTL(" After update")
"RTN","PSB3P68",152,0)
 D MES^XPDUTL("")
"RTN","PSB3P68",153,0)
 ;loop thru all medical divisions and only update those that use BCMA
"RTN","PSB3P68",154,0)
 F DV=0:0 S DV=$O(^DG(40.8,"AD",DV)) Q:'DV  D
"RTN","PSB3P68",155,0)
 . S ENT=DV_";DIC(4,"
"RTN","PSB3P68",156,0)
 . Q:'$$GET^XPAR(ENT,"PSB ONLINE")
"RTN","PSB3P68",157,0)
 . S FOUND=1
"RTN","PSB3P68",158,0)
 . I UPD,+$$GET^XPAR(ENT,NAM,,"E")=0 D EN^XPAR(ENT,NAM,1,VAL)
"RTN","PSB3P68",159,0)
 . D MES^XPDUTL("   "_$E($P(^DIC(4,+ENT,0),U)_T20,1,25)_T10_$$GET^XPAR(ENT,NAM,,"E"))
"RTN","PSB3P68",160,0)
 D:'FOUND MES^XPDUTL(T5_"** NO DIVISIONS FOUND WITH BCMA ONLINE **")
"RTN","PSB3P68",161,0)
 D:'FOUND MES^XPDUTL("   ** NO DIVISIONS FOUND WITH BCMA ONLINE **")
"RTN","PSB3P68",162,0)
 D MES^XPDUTL("")
"RTN","PSB3P68",163,0)
 Q
"RTN","PSB3P68",164,0)
 ;
"RTN","PSB3P68",165,0)
MAIL(HTEXT) ; send the mail message
"RTN","PSB3P68",166,0)
 N XMY,XMDUZ,XMSUB,XMTEXT
"RTN","PSB3P68",167,0)
 S XMY(DUZ)="",XMDUZ="PSB3P68 Post Install"
"RTN","PSB3P68",168,0)
 S XMSUB=HTEXT_" Results"
"RTN","PSB3P68",169,0)
 S XMTEXT="^TMP("""_$$NAMSPC_""",$J,""MSG"","
"RTN","PSB3P68",170,0)
 D ^XMD
"RTN","PSB3P68",171,0)
 K ^TMP($$NAMSPC)
"RTN","PSB3P68",172,0)
 Q
"RTN","PSB3P68",173,0)
 ;
"RTN","PSB3P68",174,0)
CHKSTAT() ;check if job is running
"RTN","PSB3P68",175,0)
 N Y,DUOUT,DTOUT,QUIT
"RTN","PSB3P68",176,0)
 S NAMSPC=$$NAMSPC
"RTN","PSB3P68",177,0)
 S STAT=$G(^XTMP(NAMSPC,0,"STATUS"))
"RTN","PSB3P68",178,0)
 S QUIT=0
"RTN","PSB3P68",179,0)
 L +^XTMP(NAMSPC):3
"RTN","PSB3P68",180,0)
 I '$T D  H 2 Q 1
"RTN","PSB3P68",181,0)
 . D MES^XPDUTL("*** WARNING ***"),MES^XPDUTL("")
"RTN","PSB3P68",182,0)
 . D MES^XPDUTL(NAMSPC_" Cross Reference Builder is already RUNNING ")
"RTN","PSB3P68",183,0)
 . D MES^XPDUTL(" from a previous install and can't be run now.")
"RTN","PSB3P68",184,0)
 . D MES^XPDUTL("")
"RTN","PSB3P68",185,0)
 I STAT["COMPLETED" D  H 2 Q 1
"RTN","PSB3P68",186,0)
 . D MES^XPDUTL("*** WARNING ***"),MES^XPDUTL("")
"RTN","PSB3P68",187,0)
 . D MES^XPDUTL(NAMSPC_" Cross Reference Builder was "_STAT)
"RTN","PSB3P68",188,0)
 . D MES^XPDUTL(" by a previous install and can't run again.")
"RTN","PSB3P68",189,0)
 . D MES^XPDUTL("")
"RTN","PSB3P68",190,0)
 Q QUIT
"RTN","PSB3P68",191,0)
 ;
"RTN","PSB3P68",192,0)
STATUS ;Display status of this job
"RTN","PSB3P68",193,0)
 ;check lock status
"RTN","PSB3P68",194,0)
 N STAT,TIME,JOB,RECS,TLRESC,PCT,RUNNING
"RTN","PSB3P68",195,0)
 L +^XTMP($$NAMSPC):3
"RTN","PSB3P68",196,0)
 I '$T S RUNNING=1
"RTN","PSB3P68",197,0)
 E  S RUNNING=0
"RTN","PSB3P68",198,0)
 L -^XTMP($$NAMSPC)
"RTN","PSB3P68",199,0)
 S STAT=$P(^XTMP($$NAMSPC,0,"STATUS"),U)
"RTN","PSB3P68",200,0)
 S TIME=$P(^XTMP($$NAMSPC,0,"STATUS"),U,2)
"RTN","PSB3P68",201,0)
 S JOB=$P(^XTMP($$NAMSPC,0),U,3)
"RTN","PSB3P68",202,0)
 S RECS=+^XTMP($$NAMSPC,0,"RECS DONE")
"RTN","PSB3P68",203,0)
 S TLRECS=+^XTMP($$NAMSPC,0,"RECS TOTL")
"RTN","PSB3P68",204,0)
 S PCT=(RECS/TLRECS)*100\1
"RTN","PSB3P68",205,0)
 I 'RUNNING,STAT["RUNNING" D  Q
"RTN","PSB3P68",206,0)
 . W !!,JOB,!,"Has errored and quit abruptly.  Please restart Post Install",!
"RTN","PSB3P68",207,0)
 . W !,"  at Programmers prompt '>' type 'D QUEUE^PSB3P68' and press Enter.",!!
"RTN","PSB3P68",208,0)
 W !!,JOB,!,"Status: ",STAT,"   ",$$FMTE^XLFDT(TIME)
"RTN","PSB3P68",209,0)
 W !,PCT,"% complete",!!
"RTN","PSB3P68",210,0)
 Q
"RTN","PSB3P68",211,0)
 ;
"RTN","PSB3P68",212,0)
NAMSPC() ;
"RTN","PSB3P68",213,0)
 Q "PSB3P68"
"RTN","PSBCSUTL")
0^15^B149737589^B145173894
"RTN","PSBCSUTL",1,0)
PSBCSUTL ;BIRMINGHAM/TEJ- BCMA-HSC COVER SHEET UTILITIES ;1/10/12 8:32pm
"RTN","PSBCSUTL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**16,13,38,32,50,60,58,68**;Mar 2004;Build 26
"RTN","PSBCSUTL",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBCSUTL",4,0)
 ;
"RTN","PSBCSUTL",5,0)
 ; Reference/IA
"RTN","PSBCSUTL",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBCSUTL",7,0)
 ; IN5^VADPT/10061
"RTN","PSBCSUTL",8,0)
 ; $$GET^XPAR/2263
"RTN","PSBCSUTL",9,0)
 ; ^%DTC/10000
"RTN","PSBCSUTL",10,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBCSUTL",11,0)
 ; $$GET1^DIQ/2056
"RTN","PSBCSUTL",12,0)
 ; EN1^GMVDCEXT/4251
"RTN","PSBCSUTL",13,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBCSUTL",14,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBCSUTL",15,0)
 ;
"RTN","PSBCSUTL",16,0)
 ;*58 - add 30th piece to Results for Override/Intervention flag 1/0
"RTN","PSBCSUTL",17,0)
 ;*68 - add new parameter to use new SI/OPI word processing fields
"RTN","PSBCSUTL",18,0)
 ;
"RTN","PSBCSUTL",19,0)
 ; ** Warning: PSBSIOPI will be used as a global variable for all down
"RTN","PSBCSUTL",20,0)
 ;    streams calls from this RPC tag call.
"RTN","PSBCSUTL",21,0)
 ;
"RTN","PSBCSUTL",22,0)
RPC(RESULTS,DFN,EXPWIN,PSBSIOPI) ;
"RTN","PSBCSUTL",23,0)
 K RESULTS,^TMP("PSB",$J),^TMP("PSJ",$J)
"RTN","PSBCSUTL",24,0)
 S PSBXWIN=$G(EXPWIN,24)
"RTN","PSBCSUTL",25,0)
 S PSBSIOPI=+$G(PSBSIOPI)   ;*68 init to 0 if not present or 1 if sent
"RTN","PSBCSUTL",26,0)
 S PSBTAB="CVRSHT"
"RTN","PSBCSUTL",27,0)
 N PSBCNT S PSBTRFL=0,PSBDFNX=DFN
"RTN","PSBCSUTL",28,0)
 D PAINCMT(DFN) ;;Correct Comment if Pain Score entered in BCMA was marked "Entered in Error" in Vitals. (PSB*3*50)
"RTN","PSBCSUTL",29,0)
 S RESULTS=$NAME(^TMP("PSB",$J,PSBTAB))
"RTN","PSBCSUTL",30,0)
 K ^TMP("PSB",$J,PSBTAB) S ^TMP("PSB",$J,PSBTAB,0)=1 D LIGHTS(PSBDFNX)
"RTN","PSBCSUTL",31,0)
 S ^TMP("PSB",$J,PSBTAB,0)=1,^TMP("PSB",$J,PSBTAB,1)=^TMP("PSB",$J,PSBTAB,1)
"RTN","PSBCSUTL",32,0)
 Q:$P(^TMP("PSB",$J,PSBTAB,1),U,4)=-1
"RTN","PSBCSUTL",33,0)
 D NOW^%DTC S PSBNOW=+$E(%,1,10),PSBDT=$P(%,".",1)
"RTN","PSBCSUTL",34,0)
 ;set range
"RTN","PSBCSUTL",35,0)
 S PSBWBEG=$$FMADD^XLFDT(PSBNOW,"",-PSBXWIN),PSBWEND=$$FMADD^XLFDT(PSBNOW,"",PSBXWIN)
"RTN","PSBCSUTL",36,0)
 S PSBTBEG=$$FMADD^XLFDT(PSBNOW,"",-12),PSBTEND=$$FMADD^XLFDT(PSBNOW,"",12)
"RTN","PSBCSUTL",37,0)
 S PSBWADM=$$GET^XPAR("DIV","PSB ADMIN BEFORE"),PSBMHBCK=$$GET^XPAR("ALL","PSB MED HIST DAYS BACK",,"B") I +PSBMHBCK=0 S PSBMHBCK=30
"RTN","PSBCSUTL",38,0)
 D NOW^%DTC S PSBWADM=$$FMADD^XLFDT(%,"","",+PSBWADM),PSBMHBCK=$$FMADD^XLFDT(%,-1*(PSBMHBCK))
"RTN","PSBCSUTL",39,0)
 ;use lst movemnt for API
"RTN","PSBCSUTL",40,0)
 S VAIP("D")="LAST" D IN5^VADPT S PSBTRDT=+VAIP(3),PSBTRTYP=$P(VAIP(2),U,2),PSBMVTYP=$P(VAIP(4),U,2) K VAIP
"RTN","PSBCSUTL",41,0)
 S PSBPTTR=$$GET^XPAR("DIV","PSB PATIENT TRANSFER") I PSBPTTR="" S PSBPTTR=72
"RTN","PSBCSUTL",42,0)
 D NOW^%DTC S PSBNTDT=$$FMADD^XLFDT(%,"",-PSBPTTR) I PSBNTDT'>PSBTRDT S PSBTRFL=1
"RTN","PSBCSUTL",43,0)
 S X1=$P(PSBNOW,"."),X2=-3 D C^%DTC
"RTN","PSBCSUTL",44,0)
 D EN^PSJBCMA(PSBDFNX,X,$S(PSBMHBCK<PSBWBEG:PSBMHBCK,PSBWBEG<PSBMHBCK:PSBWBEG,1:PSBMHBCK))
"RTN","PSBCSUTL",45,0)
 ;Devlop Outp
"RTN","PSBCSUTL",46,0)
 S PSBTBOUT=0
"RTN","PSBCSUTL",47,0)
 I ^TMP("PSJ",$J,1,0)>0 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBCSUTL",48,0)
 .S:(PSBTAB'="CVRSHT")&($G(^TMP("PSB",$J,"CVRSHT",2))>0) PSBTBOUT=1
"RTN","PSBCSUTL",49,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX),NOW^%DTC
"RTN","PSBCSUTL",50,0)
 .Q:PSBONX["P"  Q:(PSBOSP<PSBWBEG)&'(PSBONX["V")  ;in rnge?
"RTN","PSBCSUTL",51,0)
 .S (PSBREC,PSBONTAB)=""
"RTN","PSBCSUTL",52,0)
 .S $P(PSBREC,U,1)=PSBDFN ;Dfn
"RTN","PSBCSUTL",53,0)
 .S $P(PSBREC,U,2)=PSBONX ;OrdX 
"RTN","PSBCSUTL",54,0)
 .S $P(PSBREC,U,3)=PSBON ;Ord#
"RTN","PSBCSUTL",55,0)
 .S $P(PSBREC,U,4)=PSBOTYP ;v/u/p
"RTN","PSBCSUTL",56,0)
 .S $P(PSBREC,U,5)=PSBSCHT ;Schtyp
"RTN","PSBCSUTL",57,0)
 .S $P(PSBREC,U,6)=PSBSCH ;Sch
"RTN","PSBCSUTL",58,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"") ; slfmed
"RTN","PSBCSUTL",59,0)
 .S $P(PSBREC,U,8)=PSBOITX ;Drgnm
"RTN","PSBCSUTL",60,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ;Dose
"RTN","PSBCSUTL",61,0)
 .S $P(PSBREC,U,10)=PSBMR ;med route
"RTN","PSBCSUTL",62,0)
 .;Lst Gvn -AOIP xRef
"RTN","PSBCSUTL",63,0)
 .S (PSBCNT,PSBFLAG)=0,(Y,PSBSTUS)="" K PSBHSTA,PSBHSTAX
"RTN","PSBCSUTL",64,0)
 .F XZ=1:1:20 S Y=$O(^PSB(53.79,"AOIP",PSBDFN,PSBOIT,Y),-1),(PSBCNT,PSBFLAG)=0 Q:Y=""  D
"RTN","PSBCSUTL",65,0)
 ..S:Y>0 $P(PSBREC,U,11)=Y
"RTN","PSBCSUTL",66,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",PSBDFN,PSBOIT,Y,X),-1) Q:X=""  D
"RTN","PSBCSUTL",67,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9) S:$G(PSBSTUS)="" PSBSTUS="X" I (PSBSTUS'="N") S PSBFLAG=1,PSBHSTA(Y,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBCSUTL",68,0)
 ...D:PSBSTUS="N"
"RTN","PSBCSUTL",69,0)
 ....S ($P(PSBREC,U,11),Z)=""
"RTN","PSBCSUTL",70,0)
 ....F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBCSUTL",71,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",72,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",73,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBCSUTL",74,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBCSUTL",75,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBCSUTL",76,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBCSUTL",77,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBCSUTL",78,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBCSUTL",79,0)
 .S $P(PSBREC,U,12)="" ;ien - below
"RTN","PSBCSUTL",80,0)
 .S $P(PSBREC,U,13)="" ;sttus - below
"RTN","PSBCSUTL",81,0)
 .S $P(PSBREC,U,14)="" ;admn dte - below
"RTN","PSBCSUTL",82,0)
 .S $P(PSBREC,U,15)=PSBOIT ;OI Pointer
"RTN","PSBCSUTL",83,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;njctble med route flag
"RTN","PSBCSUTL",84,0)
 .;Var dosg
"RTN","PSBCSUTL",85,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBCSUTL",86,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBCSUTL",87,0)
 .S:PSBDOSEF?1"CAP".E!(PSBDOSEF?1"TAB".E)!(PSBDOSEF="PATCH") $P(PSBREC,U,18)=PSBDOSEF ;DosgFrm
"RTN","PSBCSUTL",88,0)
 .D PSJ1^PSBVT(PSBDFN,PSBONX)
"RTN","PSBCSUTL",89,0)
 .S PSBPB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,+$G(PSBIVPSH)),PSBLVIV=0
"RTN","PSBCSUTL",90,0)
 .Q:PSBPB&(PSBOSP<PSBWBEG)
"RTN","PSBCSUTL",91,0)
 .S:(PSBONX["V"&'PSBPB) PSBLVIV=1
"RTN","PSBCSUTL",92,0)
 .S $P(PSBREC,U,19)=$S(PSBVNI]"":PSBVNI,PSBVNI']"":"***") ;VerfNrsInts
"RTN","PSBCSUTL",93,0)
 .S $P(PSBREC,U,20)=PSBSTUS S:$P(PSBREC,U,11)="" $P(PSBREC,U,20)=""  ;LstActn
"RTN","PSBCSUTL",94,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBCSUTL",95,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBCSUTL",96,0)
 .S $P(PSBREC,U,25)=0 I $G(PSBTRFL),$P(PSBREC,U,11)]"",$P(PSBREC,U,11)'<$G(PSBNTDT),$P(PSBREC,U,11)'>$G(PSBTRDT) S $P(PSBREC,U,25)=1
"RTN","PSBCSUTL",97,0)
 .S $P(PSBREC,U,26)=PSBOSP  ;OrdStpDt/Tm
"RTN","PSBCSUTL",98,0)
 .S $P(PSBREC,U,27)=$$LASTG($P(PSBREC,U,1),$P(PSBREC,U,15))
"RTN","PSBCSUTL",99,0)
 .S $P(PSBREC,U,28)=$S((PSBONX["U")&('PSBPB):1,PSBPB:2,(PSBONX["V")&'PSBPB:3,1:"")
"RTN","PSBCSUTL",100,0)
 .;*58 determine if override exists, send 1/0 (true/false)
"RTN","PSBCSUTL",101,0)
 .N PSBARR D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBARR)
"RTN","PSBCSUTL",102,0)
 .I $O(PSBARR(""))="" D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBARR,2)
"RTN","PSBCSUTL",103,0)
 .S $P(PSBREC,U,29)=$S($O(PSBARR(""))]"":1,1:0)
"RTN","PSBCSUTL",104,0)
 .;get all Admn(s) - DD info.
"RTN","PSBCSUTL",105,0)
 .S (PSBDDS,PSBSOLS,PSBADDS,PSBFLAG)="0"
"RTN","PSBCSUTL",106,0)
 .;PSB*3*60 adds additional checks to ensure an expired order is within the coversheet time parameter and an "END" is only added to the temp global after an order is added
"RTN","PSBCSUTL",107,0)
 .I PSBLVIV D XFERBAGS^PSBCSUTY,LVIV^PSBCSUTY I $G(PSBEXPRD) S X1=$O(^TMP("PSB",$J,PSBTAB,""),-1) S:^TMP("PSB",$J,PSBTAB,X1)'="END"&(X1>1) ^TMP("PSB",$J,PSBTAB,X1+1)="END" Q  ;PSB*3*60
"RTN","PSBCSUTL",108,0)
 .D GETADMX^PSBCSUTY
"RTN","PSBCSUTL",109,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBCSUTL",110,0)
 ..I $P(PSBDDA(Y),U,5)=$P(%,".") S PSBFLAG=1  ;drug nactvt
"RTN","PSBCSUTL",111,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<%)  ;nactv
"RTN","PSBCSUTL",112,0)
 ..S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1
"RTN","PSBCSUTL",113,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4),$P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBCSUTL",114,0)
 .;OnCa O PRN
"RTN","PSBCSUTL",115,0)
 .I ("^O^OC^P^"[(U_PSBSCHT_U))!(PSBLVIV) D  S ($P(PSBREC,U,12),$P(PSBREC,U,14))=""  Q
"RTN","PSBCSUTL",116,0)
 ..S (PSBIENX,PSBGOT1)="",PSBADMTM="" F  S PSBADMTM=$O(^PSB(53.79,"AORDX",PSBDFNX,PSBONX,PSBADMTM)) Q:(PSBADMTM="")  D
"RTN","PSBCSUTL",117,0)
 ...Q:(PSBADMTM<PSBMHBCK)&'PSBLVIV
"RTN","PSBCSUTL",118,0)
 ...F  S PSBIENX=$O(^PSB(53.79,"AORDX",PSBDFNX,PSBONX,PSBADMTM,PSBIENX)) Q:PSBIENX=""  D
"RTN","PSBCSUTL",119,0)
 ....S $P(PSBREC,U,12)=PSBIENX,$P(PSBREC,U,14)=PSBADMTM,$P(PSBREC,U,23)=$$GET1^DIQ(53.79,PSBIENX_",","IV UNIQUE ID")
"RTN","PSBCSUTL",120,0)
 ....S PSBQRR=1 I PSBWBEG<PSBOSP D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBADMTM,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1 ;PSB*3*60
"RTN","PSBCSUTL",121,0)
 ..I ('+PSBGOT1)&(PSBOSP'<PSBWBEG) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",122,0)
 ..I ('+PSBGOT1)&($D(PSBADMX(PSBONX)))&(PSBWBEG<PSBOSP) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") ;PSB*3*60
"RTN","PSBCSUTL",123,0)
 ..S PSBGLBX=$O(^TMP("PSB",$J,PSBTAB,""),-1) S:^TMP("PSB",$J,PSBTAB,PSBGLBX)'="END"&(PSBGLBX>1) ^TMP("PSB",$J,PSBTAB,PSBGLBX+1)="END" ;PSB*3*60
"RTN","PSBCSUTL",124,0)
 .;cont - proces AdmnTm
"RTN","PSBCSUTL",125,0)
 .S (PSBYES,PSBODD,PSBYTF)=0 S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBCSUTL",126,0)
 .I PSBYES,PSBADST="" Q
"RTN","PSBCSUTL",127,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBCSUTL",128,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" Q
"RTN","PSBCSUTL",129,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBCSUTL",130,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBCSUTL",131,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBCSUTL",132,0)
 .S:PSBLVIV PSBYES=1
"RTN","PSBCSUTL",133,0)
 .I 'PSBYES,PSBFREQ<1 Q
"RTN","PSBCSUTL",134,0)
 .I (PSBADST="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1(PSBTAB) Q
"RTN","PSBCSUTL",135,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBCSUTL",136,0)
 .I PSBODD,PSBADST'="" Q
"RTN","PSBCSUTL",137,0)
 .S PSBDTX=PSBWBEG\1,PSBGOT1=0
"RTN","PSBCSUTL",138,0)
 .F PSBXX=1:1:2 D  S PSBDTX=$$FMADD^XLFDT(PSBDTX,"",24)  ;incrmnt 1 day!
"RTN","PSBCSUTL",139,0)
 ..F PSBY=1:1:$L(PSBADST,"-") Q:$P(PSBADST,"-",PSBY)=""  D
"RTN","PSBCSUTL",140,0)
 ...S PSB=+(PSBDTX_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBCSUTL",141,0)
 ...I (PSB'<PSBWBEG)&(PSB'>PSBWEND) D  ;wndow?
"RTN","PSBCSUTL",142,0)
 ....D:(PSB'<PSBOST)&(PSB<PSBOSP)    ;actv?
"RTN","PSBCSUTL",143,0)
 .....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ;dt?
"RTN","PSBCSUTL",144,0)
 ......D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",145,0)
 ...S PSB=+(PSBWEND\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBCSUTL",146,0)
 ...I (PSB'<PSBWBEG)&(PSB'>PSBWEND) D  ;wndow?
"RTN","PSBCSUTL",147,0)
 ....D:(PSB'<PSBOST)&(PSB<PSBOSP)    ;actv?
"RTN","PSBCSUTL",148,0)
 .....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ;dt?
"RTN","PSBCSUTL",149,0)
 ......D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",150,0)
 .I ('PSBGOT1)&(PSBOSP'<PSBWBEG) D ADD^PSBVDLU1(PSBREC,PSBOTXT,+(PSBWEND\1_"."_$P(PSBADST,"-")),PSBDDS,PSBSOLS,PSBADDS,"CVRSHT")
"RTN","PSBCSUTL",151,0)
 .K PSBSTUS
"RTN","PSBCSUTL",152,0)
 D EN^PSBVDLPA
"RTN","PSBCSUTL",153,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))]"" S PSBI1=$O(^TMP("PSB",$J,PSBTAB,""),-1) I ^TMP("PSB",$J,PSBTAB,PSBI1)'="END" S ^TMP("PSB",$J,PSBTAB,PSBI1+1)="END"
"RTN","PSBCSUTL",154,0)
 S ^TMP("PSB",$J,PSBTAB,0)=$O(^TMP("PSB",$J,PSBTAB,""),-1)
"RTN","PSBCSUTL",155,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))']"" S $P(^TMP("PSB",$J,PSBTAB,1),U,4)="-1^No orders To display on Coversheet"
"RTN","PSBCSUTL",156,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))]"" S $P(^TMP("PSB",$J,PSBTAB,1),U,4)="1^COVERSHEET DATA FOLLOWS" D ADD^PSBCSUTX
"RTN","PSBCSUTL",157,0)
 D CLEAN
"RTN","PSBCSUTL",158,0)
 Q
"RTN","PSBCSUTL",159,0)
LASTG(PSBPATPT,PSBOIPT) ;LstGvn-(inpt: DFN,OrItm IEN)
"RTN","PSBCSUTL",160,0)
 K PSBHSTG S Y="",LASTG="" F XZ=1:1:20 S Y=$O(^PSB(53.79,"AOIP",PSBPATPT,PSBOIPT,Y),-1),(PSBCNT,PSBFLAG)=0 Q:Y=""  D
"RTN","PSBCSUTL",161,0)
 .S:Y>0 LASTG="",X="" F  S X=$O(^PSB(53.79,"AOIP",PSBPATPT,PSBOIPT,Y,X),-1) Q:X=""  D
"RTN","PSBCSUTL",162,0)
 ..S PSBSTX=$P(^PSB(53.79,X,0),U,9) S:PSBSTX']"" PSBHSTG(Y)=-1 I PSBSTX="G"  S PSBHSTG(Y)="G"
"RTN","PSBCSUTL",163,0)
 ..Q:PSBSTX="N"
"RTN","PSBCSUTL",164,0)
 ..D:(PSBSTX'="G")
"RTN","PSBCSUTL",165,0)
 ...S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBCSUTL",166,0)
 ....I (PSBDATA["Set to 'GIVEN'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",167,0)
 ....I (PSBDATA["STATUS 'GIVEN'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",168,0)
 ....I PSBCNT#2=0,PSBDATA'["'GIVEN'" Q
"RTN","PSBCSUTL",169,0)
 ....I '$D(PSBHSTG($P(PSBDATA,U))) S PSBFLAG=1,PSBHSTG($P(PSBDATA,U))=""
"RTN","PSBCSUTL",170,0)
 I $D(PSBHSTG) S LASTG="" F  S LASTG=$O(PSBHSTG(LASTG),-1) Q:+LASTG=0  Q:PSBHSTG(LASTG)="G"  I PSBHSTG(LASTG)=-1 S LASTG="" Q
"RTN","PSBCSUTL",171,0)
 Q LASTG
"RTN","PSBCSUTL",172,0)
PAINCMT(DFN) ;;Add comment if Pain Score entered in BCMA was marked "Entered in Error" in Vitals.
"RTN","PSBCSUTL",173,0)
 ;;This will run through all the patients appointments, check their comments to see if they had a Pain Vital entered  through BCMA, and check if that Vital was marked "Entered in Error."
"RTN","PSBCSUTL",174,0)
 Q:'$D(^DPT(DFN,0))
"RTN","PSBCSUTL",175,0)
 N PSBCMT,PSBGMR,PSBCMTGLB,PSBIEN,PSBCMTM,PSBVITM,PSBTMDF,PSBBDT,PSBEDT,PSBEFTM,PSBCMFL,PSBEXTM,PSBERFL,PSBPNSC,PSBNOW,PSBDFN,PSBPRNDT,PSBSTRTDT,PSBMDHST,PSBEFFL,PSBCOMMENT,X,X1,X2
"RTN","PSBCSUTL",176,0)
 K ^TMP("PSBGMV",$J)
"RTN","PSBCSUTL",177,0)
 D NOW^%DTC S PSBEDT=%
"RTN","PSBCSUTL",178,0)
 S PSBMDHST=+($$GET^XPAR("ALL","PSB MED HIST DAYS BACK",,"B")) S:+$G(PSBMDHST)=0 PSBMDHST=30
"RTN","PSBCSUTL",179,0)
 S X1=$P(PSBEDT,"."),X2=-(PSBMDHST) D C^%DTC S PSBMDHST=X
"RTN","PSBCSUTL",180,0)
 S PSBSTRTDT=$S($G(PSBSTRT)]0:PSBSTRT,1:PSBMDHST)
"RTN","PSBCSUTL",181,0)
 S PSBPRNDT=PSBSTRTDT F  S PSBPRNDT=$O(^PSB(53.79,"APRN",DFN,PSBPRNDT)) Q:'PSBPRNDT  D
"RTN","PSBCSUTL",182,0)
 .S PSBIEN=0 F  S PSBIEN=$O(^PSB(53.79,"APRN",DFN,PSBPRNDT,PSBIEN)) Q:'PSBIEN  D
"RTN","PSBCSUTL",183,0)
 ..S PSBCMT=0 F  S PSBCMT=$O(^PSB(53.79,PSBIEN,.3,PSBCMT)) Q:'PSBCMT  S PSBCMTGLB=^PSB(53.79,PSBIEN,.3,PSBCMT,0) D
"RTN","PSBCSUTL",184,0)
 ...I $P($G(PSBCMTGLB),U)["Pain Score of" D
"RTN","PSBCSUTL",185,0)
 ....I $E($P($G(PSBCMTGLB),U),1,14)="*Pain Score of" S PSBCMFL=""
"RTN","PSBCSUTL",186,0)
 ....I $E($P($G(PSBCMTGLB),U),1,15)="**Pain Score of" S PSBEFFL=""
"RTN","PSBCSUTL",187,0)
 ....S PSBCMTM=$P($G(PSBCMTGLB),U,3)
"RTN","PSBCSUTL",188,0)
 ....S PSBBDT=$E(PSBCMTM,1,12)
"RTN","PSBCSUTL",189,0)
 ....S PSBEXTM=$$FMTE^XLFDT(PSBBDT,"5Z")
"RTN","PSBCSUTL",190,0)
 ....I '$D(^TMP("PSBGMV",$J)) D EN1^GMVDCEXT("^TMP(""PSBGMV"",$J)",DFN,2,,1,PSBSTRTDT,PSBEDT,,1)
"RTN","PSBCSUTL",191,0)
 ....S PSBGMR=0 F  S PSBGMR=$O(^TMP("PSBGMV",$J,PSBGMR)) Q:PSBGMR=""  I $P(^TMP("PSBGMV",$J,PSBGMR),U,4)="PN" D
"RTN","PSBCSUTL",192,0)
 .....S PSBVITM=$P(^TMP("PSBGMV",$J,PSBGMR),U,5)
"RTN","PSBCSUTL",193,0)
 .....S PSBTMDF=$$FMDIFF^XLFDT(PSBVITM,PSBCMTM,2)
"RTN","PSBCSUTL",194,0)
 .....I PSBTMDF>=-($S($G(DILOCKTM)>0:DILOCKTM,1:3)),PSBTMDF<=$S($G(DILOCKTM)>0:DILOCKTM,1:3) D
"RTN","PSBCSUTL",195,0)
 ......I $P(^TMP("PSBGMV",$J,PSBGMR),U,9)=1 S PSBPNSC=$P(^TMP("PSBGMV",$J,PSBGMR),U,8),PSBERFL=""
"RTN","PSBCSUTL",196,0)
 ..I $D(PSBERFL),'$D(PSBCMFL) S PSBCOMMENT="*Pain Score of "_PSBPNSC_" entered in Vitals via BCMA at "_PSBEXTM_" may have been marked 'Entered in Error'. See Vitals Package for an updated Score." D COMMENT^PSBML(PSBIEN,PSBCOMMENT)
"RTN","PSBCSUTL",197,0)
 ..K PSBCMFL,PSBERFL
"RTN","PSBCSUTL",198,0)
 ..S PSBEFTM=$P($G(^PSB(53.79,PSBIEN,.2)),U,4) Q:PSBEFTM=""
"RTN","PSBCSUTL",199,0)
 ..S PSBBDT=$E(PSBEFTM,1,12)
"RTN","PSBCSUTL",200,0)
 ..S PSBEXTM=$$FMTE^XLFDT(PSBBDT,"5Z")
"RTN","PSBCSUTL",201,0)
 ..D:'$D(^TMP("PSBGMV",$J)) EN1^GMVDCEXT("^TMP(""PSBGMV"",$J)",DFN,2,,1,PSBSTRTDT,PSBEDT,,1)
"RTN","PSBCSUTL",202,0)
 ..S PSBGMR=0 F  S PSBGMR=$O(^TMP("PSBGMV",$J,PSBGMR)) Q:PSBGMR=""  I $P(^TMP("PSBGMV",$J,PSBGMR),U,4)="PN" D
"RTN","PSBCSUTL",203,0)
 ...S PSBVITM=$P(^TMP("PSBGMV",$J,PSBGMR),U,5)
"RTN","PSBCSUTL",204,0)
 ...S PSBTMDF=$$FMDIFF^XLFDT(PSBVITM,PSBEFTM,2)
"RTN","PSBCSUTL",205,0)
 ...I PSBTMDF>=-($S($G(DILOCKTM)>0:DILOCKTM,1:3)),PSBTMDF<=$S($G(DILOCKTM)>0:DILOCKTM,1:3)  D
"RTN","PSBCSUTL",206,0)
 ....I $P(^TMP("PSBGMV",$J,PSBGMR),U,9)=1 S PSBPNSC=$P(^TMP("PSBGMV",$J,PSBGMR),U,8),PSBERFL=""
"RTN","PSBCSUTL",207,0)
 ..I $D(PSBERFL),'$D(PSBEFFL) S PSBCOMMENT="**Pain Score of "_PSBPNSC_" entered in Vitals via BCMA at "_PSBEXTM_" may have been marked 'Entered in Error'. See Vitals Package for an updated Score." D COMMENT^PSBML(PSBIEN,PSBCOMMENT)
"RTN","PSBCSUTL",208,0)
 ..K PSBERFL,PSBEFFL
"RTN","PSBCSUTL",209,0)
 K ^TMP("PSBGMV",$J)
"RTN","PSBCSUTL",210,0)
 Q
"RTN","PSBCSUTL",211,0)
LIGHTS(PSBDFN) ;
"RTN","PSBCSUTL",212,0)
 D RPC^PSBVDLTB(,PSBDFN,"NO TAB",) S PSBTAB="CVRSHT"
"RTN","PSBCSUTL",213,0)
 M ^TMP("PSB",$J,PSBTAB,1)=^TMP("PSB",$J,"NO TAB",1) K ^TMP("PSB",$J,"NO TAB")
"RTN","PSBCSUTL",214,0)
 Q
"RTN","PSBCSUTL",215,0)
CLEAN ;
"RTN","PSBCSUTL",216,0)
 D CLEAN^PSBVT
"RTN","PSBCSUTL",217,0)
 K PSBACT,PSBACTBY,PSBACTDT,PSBACTPT,PSBADDS,PSBBAGID,PSBCHDT,PSBCHKV,PSBCNT1,PSBCNT2,PSBDDS,PSBDFNX,PSBWEND
"RTN","PSBCSUTL",218,0)
 K PSBDT,PSBFLAG,PSBHSTAX,PSBI1,PSBIEN,PSBIENX,PSBLSTS,PSBMAUD,PSBMVTYP,PSBMWC,PSBNOW,PSBNTDT,PSBONMBR,PSBY,PSBXX
"RTN","PSBCSUTL",219,0)
 K PSBONXS,PSBORREC,PSBPDT,PSBPRNRE,PSBPTTR,PSBQR,PSBRDOW,PSBREC,PSBRECHD,PSBSCHBR,PSBSCHTM,PSBSOLS,PSBTAB,PSBADMTM,PSBDTX
"RTN","PSBCSUTL",220,0)
 K PSBTBOUT,PSBTRDT,PSBTRFL,PSBTRTYP,PSBUID,PSBUIDS,PSBX,PSBXIEN,PSBX2,PSBYEA,PSBYEA1,PSBYTF,PSBYES,VAIP,PSBWADM,PSBWBEG
"RTN","PSBCSUTL",221,0)
 K PSBXREC,PSBGOT1,PSBCDT,PSBQUIT,PSBUSED,PSBLST4X,PSBADMX,PSBI2,PSBXXX,PSBI,PSBPB,PSBSHWTB,PSBONTAB,PSBDONE,^TMP("PSJ",$J)
"RTN","PSBCSUTL",222,0)
 K PSBNXTDU,LASTG,LSTTIME,PSBMHBCK,PSBHSTG,PSBNXTDT,NEXTADM,PSBLVIV
"RTN","PSBCSUTL",223,0)
 Q
"RTN","PSBINJEC")
0^17^B24162182^n/a
"RTN","PSBINJEC",1,0)
PSBINJEC ;BIRMINGHAM/GN-LAST INJECTION SITE BROKER ;4/10/12 8:36am
"RTN","PSBINJEC",2,0)
 ;;3.0;BAR CODE MED ADMIN;**68**;Mar 2004;Build 26
"RTN","PSBINJEC",3,0)
 ;
"RTN","PSBINJEC",4,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBINJEC",5,0)
 ;
"RTN","PSBINJEC",6,0)
 ;*******************************************************************
"RTN","PSBINJEC",7,0)
RPC(RESULTS,DFN,PSBOI,TIME,MAX) ;Get Last MAX Injections per Patient by
"RTN","PSBINJEC",8,0)
 ;                       One Orderable Item or ALL Orderable Items
"RTN","PSBINJEC",9,0)
 ;*******************************************************************
"RTN","PSBINJEC",10,0)
 ;
"RTN","PSBINJEC",11,0)
 ; Return Array RESULTS
"RTN","PSBINJEC",12,0)
 ;    RESULTS(0)=nn       nn = total injection line items returned
"RTN","PSBINJEC",13,0)
 ;    RESULTS(n)=string   string = returned injection data
"RTN","PSBINJEC",14,0)
 ;                          (date/time ^ OI ien ^ OI name ^ Inj site)
"RTN","PSBINJEC",15,0)
 ;                or      string = an error line
"RTN","PSBINJEC",16,0)
 ;                          (-1 ^ error text message)
"RTN","PSBINJEC",17,0)
 ; Input Parameters:
"RTN","PSBINJEC",18,0)
 ;     DFN= Patient IEN
"RTN","PSBINJEC",19,0)
 ;   PSBOI= Orderable Item IEN
"RTN","PSBINJEC",20,0)
 ;    TIME= Time range in hours to look back
"RTN","PSBINJEC",21,0)
 ;     MAX = Maximum injections items to be returned
"RTN","PSBINJEC",22,0)
 ;
"RTN","PSBINJEC",23,0)
 ; ** Note: Time and Max work together, which every is reached first,
"RTN","PSBINJEC",24,0)
 ;          then the search ends and returns what was found thus far.
"RTN","PSBINJEC",25,0)
 ;
"RTN","PSBINJEC",26,0)
 N ACDTE,DOSAGE,DSPIVPB,ENDDTE,INJ,INJSITE,IVOK,IVTYPE,INTERMIT,MXTIME
"RTN","PSBINJEC",27,0)
 N ORDIT,ORDITNM,ORDNO,PRMPTINJ,QT,QQ,ROUTE,RR,RTBL,STDROUTE,YY
"RTN","PSBINJEC",28,0)
 K RESULTS
"RTN","PSBINJEC",29,0)
 I '$G(DFN)!('$D(^DPT(DFN))) D  Q
"RTN","PSBINJEC",30,0)
 . D ERR("Error, DFN missing or invalid (param 1)")
"RTN","PSBINJEC",31,0)
 ;
"RTN","PSBINJEC",32,0)
 ;load valid rotation type injection routes table
"RTN","PSBINJEC",33,0)
 D BLDTBL(.RTBL)
"RTN","PSBINJEC",34,0)
 ;
"RTN","PSBINJEC",35,0)
 D:$G(PSBOI) OI        ;by One specific orderable item
"RTN","PSBINJEC",36,0)
 D:'$G(PSBOI) ALL      ;by All orderable items
"RTN","PSBINJEC",37,0)
 Q
"RTN","PSBINJEC",38,0)
 ;               ======== END RPC MAIN ========
"RTN","PSBINJEC",39,0)
 ;
"RTN","PSBINJEC",40,0)
 ;*******************************************************************
"RTN","PSBINJEC",41,0)
OI ;  Get Last MAX Injections per Patient for one Orderable Item only
"RTN","PSBINJEC",42,0)
 ;*******************************************************************
"RTN","PSBINJEC",43,0)
 ;
"RTN","PSBINJEC",44,0)
 ;default the OI call for Time if less than 1 hour to unlimited
"RTN","PSBINJEC",45,0)
 S TIME=+$G(TIME) I TIME<1 S TIME=9999999
"RTN","PSBINJEC",46,0)
 S ENDDTE=$$FMADD^XLFDT($$NOW^XLFDT,,-TIME)
"RTN","PSBINJEC",47,0)
 ;
"RTN","PSBINJEC",48,0)
 ;default the OI call for Max = last 4
"RTN","PSBINJEC",49,0)
 S MAX=+$G(MAX) I MAX<1 S MAX=4
"RTN","PSBINJEC",50,0)
 S (YY,QT)=0
"RTN","PSBINJEC",51,0)
 ;
"RTN","PSBINJEC",52,0)
 ;   reverse date/time loop thru injection by Med, (AINJOI xref)
"RTN","PSBINJEC",53,0)
 ;
"RTN","PSBINJEC",54,0)
 F ACDTE=9999999:0 S ACDTE=$O(^PSB(53.79,"AINJOI",DFN,PSBOI,ACDTE),-1) Q:('ACDTE)!(ACDTE<ENDDTE)  D
"RTN","PSBINJEC",55,0)
 .S INJ=""
"RTN","PSBINJEC",56,0)
 .F  S INJ=$O(^PSB(53.79,"AINJOI",DFN,PSBOI,ACDTE,INJ)) Q:INJ=""!QT  D
"RTN","PSBINJEC",57,0)
 ..S RR=0
"RTN","PSBINJEC",58,0)
 ..F  S RR=$O(^PSB(53.79,"AINJOI",DFN,PSBOI,ACDTE,INJ,RR)) Q:'RR!QT  D
"RTN","PSBINJEC",59,0)
 ...Q:'$$QUALIFY        ;skip this rec, does not qualify
"RTN","PSBINJEC",60,0)
 ...D ADRESULT          ;add rec to Results as a valid inj site rec
"RTN","PSBINJEC",61,0)
 ...I YY=MAX S QT=1     ;quit, max inj sites found
"RTN","PSBINJEC",62,0)
 ;
"RTN","PSBINJEC",63,0)
 I '$D(RESULTS) D ERR("<<No data to display>>")
"RTN","PSBINJEC",64,0)
 Q
"RTN","PSBINJEC",65,0)
 ;
"RTN","PSBINJEC",66,0)
 ;*************************************************************
"RTN","PSBINJEC",67,0)
ALL ;  Get Last MAX Injections per Patient for any Orderable Item
"RTN","PSBINJEC",68,0)
 ;*************************************************************
"RTN","PSBINJEC",69,0)
 ;
"RTN","PSBINJEC",70,0)
 ;default the ALL call for Time if less than 1 hour to Xpar Max
"RTN","PSBINJEC",71,0)
 S TIME=+$G(TIME)
"RTN","PSBINJEC",72,0)
 I TIME<1 S TIME=$$GET^XPAR("ALL","PSB INJECTION SITE MAX HOURS",,"I")
"RTN","PSBINJEC",73,0)
 S ENDDTE=$$FMADD^XLFDT($$NOW^XLFDT,,-TIME)
"RTN","PSBINJEC",74,0)
 ;
"RTN","PSBINJEC",75,0)
 ;default the ALL call for Max = last 4 Injections
"RTN","PSBINJEC",76,0)
 S MAX=+$G(MAX) I MAX<1 S MAX=9999999
"RTN","PSBINJEC",77,0)
 S (YY,QT)=0
"RTN","PSBINJEC",78,0)
 ;
"RTN","PSBINJEC",79,0)
 ;   Reverse date/time loop thru injection xref, (AINJ), ALL MEDS
"RTN","PSBINJEC",80,0)
 ;
"RTN","PSBINJEC",81,0)
 F ACDTE=9999999:0 S ACDTE=$O(^PSB(53.79,"AINJ",DFN,ACDTE),-1) Q:('ACDTE)!(ACDTE<ENDDTE)  D
"RTN","PSBINJEC",82,0)
 .S INJ=""
"RTN","PSBINJEC",83,0)
 .F  S INJ=$O(^PSB(53.79,"AINJ",DFN,ACDTE,INJ)) Q:INJ=""!QT  D
"RTN","PSBINJEC",84,0)
 ..S RR=0
"RTN","PSBINJEC",85,0)
 ..F  S RR=$O(^PSB(53.79,"AINJ",DFN,ACDTE,INJ,RR)) Q:'RR!QT  D
"RTN","PSBINJEC",86,0)
 ...Q:'$$QUALIFY        ;skip this rec, does not qualify
"RTN","PSBINJEC",87,0)
 ...D ADRESULT          ;add rec to Results as a valid inj site rec
"RTN","PSBINJEC",88,0)
 ...I YY=MAX S QT=1     ;quit, max inj sites found
"RTN","PSBINJEC",89,0)
 ;
"RTN","PSBINJEC",90,0)
 I '$D(RESULTS) D ERR("<<No data to display>>")
"RTN","PSBINJEC",91,0)
 Q
"RTN","PSBINJEC",92,0)
 ;
"RTN","PSBINJEC",93,0)
 ;  ----------------- Supporting Tag calls below ------------------
"RTN","PSBINJEC",94,0)
QUALIFY() ; Determine if a record qualifies as a last Injection Site we want
"RTN","PSBINJEC",95,0)
 ;
"RTN","PSBINJEC",96,0)
 ; Function return: 0 = false, this admin record should not be used
"RTN","PSBINJEC",97,0)
 ;                  1 = true, this admin record shold be used
"RTN","PSBINJEC",98,0)
 ;
"RTN","PSBINJEC",99,0)
 ;Quit false, other than a "given type" for action status
"RTN","PSBINJEC",100,0)
 ; h=held,r=refused,n=not given,rm=removed,m=missing dose
"RTN","PSBINJEC",101,0)
 I ",H,R,N,RM,M,"[(","_$P(^PSB(53.79,RR,0),U,9)_",") Q 0
"RTN","PSBINJEC",102,0)
 ;
"RTN","PSBINJEC",103,0)
 S ORDNO=$P(^PSB(53.79,RR,.1),U)
"RTN","PSBINJEC",104,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBINJEC",105,0)
 D EN^PSJBCMA1(DFN,ORDNO,1)
"RTN","PSBINJEC",106,0)
 S IVTYPE=$P($G(^TMP("PSJ1",$J,0)),U,6)
"RTN","PSBINJEC",107,0)
 S INTERMIT=$P($G(^TMP("PSJ1",$J,0)),U,7)
"RTN","PSBINJEC",108,0)
 S PRMPTINJ=$P($G(^TMP("PSJ1",$J,1,0)),U)
"RTN","PSBINJEC",109,0)
 S DSPIVPB=$P($G(^TMP("PSJ1",$J,1,0)),U,2)
"RTN","PSBINJEC",110,0)
 S ORDIT=$P($G(^TMP("PSJ1",$J,2)),U)
"RTN","PSBINJEC",111,0)
 S ORDITNM=$P($G(^TMP("PSJ1",$J,2)),U,2)
"RTN","PSBINJEC",112,0)
 S ROUTE=$P($G(^TMP("PSJ1",$J,1)),U,13)
"RTN","PSBINJEC",113,0)
 S STDROUTE=$P($G(^TMP("PSJ1",$J,1)),U,14)
"RTN","PSBINJEC",114,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBINJEC",115,0)
 ;
"RTN","PSBINJEC",116,0)
 ;   IV Orders
"RTN","PSBINJEC",117,0)
 ;Quit with T/F, is a valid rotation inj type
"RTN","PSBINJEC",118,0)
 I ORDNO["V" Q $$IVROTATN^PSBINJEC(.RTBL,STDROUTE,IVTYPE,INTERMIT)
"RTN","PSBINJEC",119,0)
 ;
"RTN","PSBINJEC",120,0)
 ;   Unit Dose Orders since not an IV
"RTN","PSBINJEC",121,0)
 ;Quit False, if Prompt for Inj is No OR if display on IVPB is Yes
"RTN","PSBINJEC",122,0)
 I 'PRMPTINJ!DSPIVPB Q 0
"RTN","PSBINJEC",123,0)
 ;
"RTN","PSBINJEC",124,0)
 ;Quit True, is a valid rotation inj type
"RTN","PSBINJEC",125,0)
 Q 1
"RTN","PSBINJEC",126,0)
 ;
"RTN","PSBINJEC",127,0)
ADRESULT ; Add line item to Results array
"RTN","PSBINJEC",128,0)
 ; get last dispense, this one has the dosage given by the nurse
"RTN","PSBINJEC",129,0)
 S DOSAGE=""
"RTN","PSBINJEC",130,0)
 I ORDNO["U" D
"RTN","PSBINJEC",131,0)
 .S QQ=99999999 S QQ=$O(^PSB(53.79,RR,.5,QQ),-1)
"RTN","PSBINJEC",132,0)
 .S:QQ DOSAGE=$P($G(^PSB(53.79,RR,.5,QQ,0)),U,4)
"RTN","PSBINJEC",133,0)
 I ORDNO["V" D
"RTN","PSBINJEC",134,0)
 .S QQ=99999999 S QQ=$O(^PSB(53.79,RR,.6,QQ),-1)
"RTN","PSBINJEC",135,0)
 .S:QQ DOSAGE=$P($G(^PSB(53.79,RR,.6,QQ,0)),U,3)
"RTN","PSBINJEC",136,0)
 S INJSITE=$$GET1^DIQ(53.79,RR_",",.16)
"RTN","PSBINJEC",137,0)
 ;
"RTN","PSBINJEC",138,0)
 S YY=YY+1
"RTN","PSBINJEC",139,0)
 S RESULTS(YY)=ACDTE_U_ORDIT_U_ORDITNM_U_DOSAGE_U_ROUTE_U_INJSITE
"RTN","PSBINJEC",140,0)
 S RESULTS(0)=YY
"RTN","PSBINJEC",141,0)
 Q
"RTN","PSBINJEC",142,0)
 ;
"RTN","PSBINJEC",143,0)
ERR(TXT) ; Error msg handler
"RTN","PSBINJEC",144,0)
 S RESULTS(0)=1
"RTN","PSBINJEC",145,0)
 S RESULTS(1)="-1^"_TXT
"RTN","PSBINJEC",146,0)
 Q
"RTN","PSBINJEC",147,0)
 ;
"RTN","PSBINJEC",148,0)
OK(TXT) ; Success msg handler
"RTN","PSBINJEC",149,0)
 S RESULTS(0)=1
"RTN","PSBINJEC",150,0)
 S RESULTS(1)="1^"_TXT
"RTN","PSBINJEC",151,0)
 Q
"RTN","PSBINJEC",152,0)
 ;
"RTN","PSBINJEC",153,0)
IVROTATN(RTAB,STDRT,IVTY,INT) ;  IV of route and type for injection rotations
"RTN","PSBINJEC",154,0)
 N IVOK S IVOK=0
"RTN","PSBINJEC",155,0)
 I STDRT="" Q IVOK
"RTN","PSBINJEC",156,0)
 I IVTY="S",INT=1 S IVOK=1           ;IV type= Syringe & intermittent
"RTN","PSBINJEC",157,0)
 I IVTY="C",INT=1 S IVOK=1           ;IV type= Chemo & intermittent
"RTN","PSBINJEC",158,0)
 I IVOK,'$D(RTAB(STDRT)) S IVOK=0    ;Std Rte NOT mapped
"RTN","PSBINJEC",159,0)
 Q IVOK
"RTN","PSBINJEC",160,0)
 ;
"RTN","PSBINJEC",161,0)
BLDTBL(TBL) ;  Build Rotation table
"RTN","PSBINJEC",162,0)
 N QQ,RT F QQ=1:1 S RT=$P($T(ROUTES+QQ^PSBINJEC),";;",2) Q:RT="END"  S TBL(RT)=""
"RTN","PSBINJEC",163,0)
 Q
"RTN","PSBINJEC",164,0)
 ;
"RTN","PSBINJEC",165,0)
ROUTES ;  Valid Rotation routes for returning admin record injection data
"RTN","PSBINJEC",166,0)
 ;;INTRADERMAL
"RTN","PSBINJEC",167,0)
 ;;INTRAMUSCULAR
"RTN","PSBINJEC",168,0)
 ;;SUBCUTANEOUS
"RTN","PSBINJEC",169,0)
 ;;END
"RTN","PSBO")
0^2^B87103799^B82537040
"RTN","PSBO",1,0)
PSBO ;BIRMINGHAM/EFC - BCMA OUTPUTS ;1/9/12 8:23am
"RTN","PSBO",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13,32,2,25,28,51,50,42,58,68**;Mar 2004;Build 26
"RTN","PSBO",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBO",4,0)
 ;
"RTN","PSBO",5,0)
 ; Reference/IA
"RTN","PSBO",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBO",7,0)
 ; ^ORD(101.24/3429
"RTN","PSBO",8,0)
 ; ^PSDRUG(/221
"RTN","PSBO",9,0)
 ;
"RTN","PSBO",10,0)
 ;*68-Add PSBSIFL as 19th parameter to RPC tag to control printing of
"RTN","PSBO",11,0)
 ;       special instruction/other print info.
"RTN","PSBO",12,0)
 ;*58 - Tag WRAP previously wrapped on a max text limit of 250 char.
"RTN","PSBO",13,0)
 ;       Since the use of Enhanced Order Checks, that limit has to 
"RTN","PSBO",14,0)
 ;       be removed and the length of the input string will be used.
"RTN","PSBO",15,0)
 ;
"RTN","PSBO",16,0)
RPC(RESULTS,PSBTYPE,PSBDFN,PSBSTRT,PSBSTOP,PSBINCL,PSBDEV,PSBSORT,PSBOI,PSBWLOC,PSBWSORT,PSBFUTR,PSBORDNM,PSBRCRI,PSBLIST,PSBPST,PSBTR,PSBDIV,PSBSIFL) ;
"RTN","PSBO",17,0)
 ;
"RTN","PSBO",18,0)
 ; RPC: PSB REPORT
"RTN","PSBO",19,0)
 ;
"RTN","PSBO",20,0)
 ; Description:
"RTN","PSBO",21,0)
 ; Used by the client to create individual patient extracts of
"RTN","PSBO",22,0)
 ; CHUI report options to display on the client.
"RTN","PSBO",23,0)
 ;
"RTN","PSBO",24,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBO",25,0)
 N PSBIENS,PSBRPT,PSBFDA,DIC,PSBANS
"RTN","PSBO",26,0)
 K ^TMP("PSBO",$J) S ^TMP("PSBO",$J,1)="-1^"
"RTN","PSBO",27,0)
 S DFN=PSBDFN
"RTN","PSBO",28,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBO",29,0)
 I PSBDFN'="",PSBTYPE="MH"!(PSBTYPE="WA")!(PSBTYPE="ML")!(PSBTYPE="MT") D PAINCMT^PSBCSUTL(PSBDFN) ;;Add Comment if Pain Score entered in BCMA was marked "Entered in Error" in Vitals.
"RTN","PSBO",30,0)
 I +PSBRPT(0)<1 S ^TMP("PSBO",$J,1)="-1^Error: "_$P(PSBRPT(0),U,2) Q
"RTN","PSBO",31,0)
 S PSBIENS=+PSBRPT(0)_","
"RTN","PSBO",32,0)
 S PSBSTRT(0)=$E($P(PSBSTRT,".",2)_"0000",1,4),PSBSTRT=PSBSTRT\1
"RTN","PSBO",33,0)
 S PSBSTOP(0)=$E($P(PSBSTOP,".",2)_"0000",1,4),PSBSTOP=PSBSTOP\1
"RTN","PSBO",34,0)
 D:$G(PSBDEV)]""
"RTN","PSBO",35,0)
 .D NOW^%DTC
"RTN","PSBO",36,0)
 .I $P(PSBDEV,U,2)="" D VAL^DIE(53.69,PSBIENS,.06,"F",PSBDEV,"PSBRET","PSBFDA")
"RTN","PSBO",37,0)
 .I $P(PSBDEV,U,2)'="" D VAL^DIE(53.69,PSBIENS,.06,"F","`"_$P(PSBDEV,U,2),"PSBRET","PSBFDA")
"RTN","PSBO",38,0)
 .D VAL^DIE(53.69,PSBIENS,.07,"F",$S($P(PSBRCRI,U)="QD":$P(PSBRCRI,U,2),1:%),"PSBRET","PSBFDA")
"RTN","PSBO",39,0)
 D:$G(PSBOI)]"" VAL^DIE(53.69,PSBIENS,.09,"F",PSBOI,"PSBRET","PSBFDA")
"RTN","PSBO",40,0)
 S:($G(PSBSORT)']"")&(PSBTYPE'="XA") PSBSORT="P" D VAL^DIE(53.69,PSBIENS,.11,"F",PSBSORT,"PSBRET","PSBFDA")
"RTN","PSBO",41,0)
 I "^SF"[("^"_PSBTYPE) D VAL^DIE(53.69,PSBIENS,.51,"F",PSBSORT,"PSBRET","PSBFDA")
"RTN","PSBO",42,0)
 S PSBPST=$TR($G(PSBPST),"^",",")
"RTN","PSBO",43,0)
 D VAL^DIE(53.69,PSBIENS,.52,"F",PSBPST,"PSBRET","PSBFDA")
"RTN","PSBO",44,0)
 S PSBTR=$TR($G(PSBTR),"^",",")
"RTN","PSBO",45,0)
 I $G(PSBDIV)]"" D VAL^DIE(53.69,PSBIENS,.04,"F",$G(PSBDIV),"PSBRET","PSBFDA")
"RTN","PSBO",46,0)
 D VAL^DIE(53.69,PSBIENS,2,"F",PSBTR,"PSBRET","PSBFDA")
"RTN","PSBO",47,0)
 D VAL^DIE(53.69,PSBIENS,.12,"F","`"_PSBDFN,"PSBRET","PSBFDA")
"RTN","PSBO",48,0)
 I $G(PSBWLOC)]"" S PSBFDA(53.69,PSBIENS,.13)=PSBWLOC
"RTN","PSBO",49,0)
 D:$G(PSBWSORT)]"" VAL^DIE(53.69,PSBIENS,.15,"F",PSBWSORT,"PSBRET","PSBFDA")
"RTN","PSBO",50,0)
 D VAL^DIE(53.69,PSBIENS,.16,"F",PSBSTRT,"PSBRET","PSBFDA")
"RTN","PSBO",51,0)
 D VAL^DIE(53.69,PSBIENS,.17,"F",PSBSTRT(0),"PSBRET","PSBFDA")
"RTN","PSBO",52,0)
 D VAL^DIE(53.69,PSBIENS,.18,"F",PSBSTOP,"PSBRET","PSBFDA")
"RTN","PSBO",53,0)
 D VAL^DIE(53.69,PSBIENS,.19,"F",PSBSTOP(0),"PSBRET","PSBFDA")
"RTN","PSBO",54,0)
 D:$G(PSBINCL)]""
"RTN","PSBO",55,0)
 .D VAL^DIE(53.69,PSBIENS,.21,"F",+$P(PSBINCL,"^",1),"PSBRET","PSBFDA")
"RTN","PSBO",56,0)
 .D VAL^DIE(53.69,PSBIENS,.22,"F",+$P(PSBINCL,"^",2),"PSBRET","PSBFDA")
"RTN","PSBO",57,0)
 .D VAL^DIE(53.69,PSBIENS,.23,"F",+$P(PSBINCL,"^",3),"PSBRET","PSBFDA")
"RTN","PSBO",58,0)
 .D VAL^DIE(53.69,PSBIENS,.24,"F",+$P(PSBINCL,"^",4),"PSBRET","PSBFDA")
"RTN","PSBO",59,0)
 .D VAL^DIE(53.69,PSBIENS,.28,"F",+$P(PSBINCL,"^",5),"PSBRET","PSBFDA")
"RTN","PSBO",60,0)
 .D VAL^DIE(53.69,PSBIENS,.29,"F",+$P(PSBINCL,"^",6),"PSBRET","PSBFDA")
"RTN","PSBO",61,0)
 D:$G(PSBFUTR)]""
"RTN","PSBO",62,0)
 .D VAL^DIE(53.69,PSBIENS,.25,"F",+$P(PSBFUTR,"^",1),"PSBRET","PSBFDA")
"RTN","PSBO",63,0)
 .D VAL^DIE(53.69,PSBIENS,.26,"F",+$P(PSBFUTR,"^",2),"PSBRET","PSBFDA")
"RTN","PSBO",64,0)
 .D VAL^DIE(53.69,PSBIENS,.27,"F",+$P(PSBFUTR,"^",3),"PSBRET","PSBFDA")
"RTN","PSBO",65,0)
 .D VAL^DIE(53.69,PSBIENS,.41,"F",+$P(PSBFUTR,"^",4),"PSBRET","PSBFDA")
"RTN","PSBO",66,0)
 .D VAL^DIE(53.69,PSBIENS,.61,"F",$TR(PSBFUTR,"^ ","~"),"PSBRET","PSBFDA")
"RTN","PSBO",67,0)
 ;*68 add SIOPI flag when present
"RTN","PSBO",68,0)
 D:$D(PSBSIFL)
"RTN","PSBO",69,0)
 .D VAL^DIE(53.69,PSBIENS,3,"F",PSBSIFL,"PSBRET","PSBFDA")
"RTN","PSBO",70,0)
 D FILE^DIE("","PSBFDA")
"RTN","PSBO",71,0)
 I "^SF"'[("^"_PSBTYPE) I $G(PSBLIST(0),"")]"" D LIST^PSBO1(.PSBLIST)
"RTN","PSBO",72,0)
 I $G(PSBDEV)]"" D PRINT^PSBO1 S RESULTS=$NAME(^TMP("PSBO",$J)) Q
"RTN","PSBO",73,0)
 D HFSOPEN^PSBUTL("RPC") I POP S ^TMP("PSBO",$J,1)="ERROR: UNABLE TO ACCESS HFS DIRECTORY "_$$DEFDIR^%ZISH(),^TMP("PSBO",$J,2)="PLEASE CHECK DIRECTORY WRITE PRIVILEGES." Q
"RTN","PSBO",74,0)
 U IO D DQ(+PSBIENS)
"RTN","PSBO",75,0)
 D HFSCLOSE^PSBUTL("RPC")
"RTN","PSBO",76,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBO",77,0)
 D:$G(PSBDEV)]"" PRINT^PSBO1
"RTN","PSBO",78,0)
 Q
"RTN","PSBO",79,0)
 ;
"RTN","PSBO",80,0)
XQ(PSBTYPE) ; Called via Kernel Menus
"RTN","PSBO",81,0)
 N PSBANS,PSBANS1,PSBRPT,PSBSAVE,DA,DIK,DR,DDSFILE
"RTN","PSBO",82,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBO",83,0)
 I +PSBRPT(0)<1 W !,"Error: ",$P(PSBRPT(0),U,2) S DIR(0)="E" D ^DIR Q
"RTN","PSBO",84,0)
 S DA=+PSBRPT(0),DR="[PSBO "_PSBTYPE_"]",DDSFILE=53.69 D ^DDS
"RTN","PSBO",85,0)
 W @IOF
"RTN","PSBO",86,0)
 I 'PSBSAVE W !,"Cancelling Request..." S DIK="^PSB(53.69," D ^DIK W "Cancelled!"
"RTN","PSBO",87,0)
 D:PSBSAVE
"RTN","PSBO",88,0)
 .;Check Drug to Patient Relationship.
"RTN","PSBO",89,0)
 .I (PSBTYPE="BL")!(PSBTYPE="BZ") S PSBANS="" D CHECK  I PSBANS=0!($D(DIRUT)) W !,"Cancelling Request..." S DIK="^PSB(53.69," D ^DIK W "Cancelled!" Q
"RTN","PSBO",90,0)
 .;Allow "'BROWSER" Device
"RTN","PSBO",91,0)
 .S IOP=$$GET1^DIQ(53.69,DA_",",.06,"I"),PSBSIO=0 I IOP]"" D
"RTN","PSBO",92,0)
 ..S IOP="`"_IOP,%ZIS="N"
"RTN","PSBO",93,0)
 ..D ^%ZIS
"RTN","PSBO",94,0)
 ..I IO=IO(0) S PSBSIO=1
"RTN","PSBO",95,0)
 ..D HOME^%ZIS K IOP
"RTN","PSBO",96,0)
 .I $$GET1^DIQ(53.69,DA_",",.06)["BROWSER"!(PSBSIO=1) S IOP=$$GET1^DIQ(53.69,DA_",",.06)_";132" D ^%ZIS U IO D DQ(DA) D ^%ZISC K IOP Q
"RTN","PSBO",97,0)
 .W @IOF,"Submitting Your Report Request to TaskMan..."
"RTN","PSBO",98,0)
 .S ZTIO=$$GET1^DIQ(53.69,DA_",",.06)
"RTN","PSBO",99,0)
 .S ZTDTH=$P(^PSB(53.69,DA,0),U,7)
"RTN","PSBO",100,0)
 .S ZTDESC="BCMA - "_$$GET1^DIQ(53.69,DA_",",.05)
"RTN","PSBO",101,0)
 .S ZTRTN="DQ^PSBO("_DA_")"
"RTN","PSBO",102,0)
 .D ^%ZTLOAD
"RTN","PSBO",103,0)
 .W "Submitted!",!,"Your Task Number Is: ",$G(ZTSK),!
"RTN","PSBO",104,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",105,0)
 Q
"RTN","PSBO",106,0)
 ;
"RTN","PSBO",107,0)
DQ(PSBRPT) ; Dequeue report from Taskman
"RTN","PSBO",108,0)
 N PSBDFN
"RTN","PSBO",109,0)
 Q:'$D(^PSB(53.69,PSBRPT,0))  ; No Such Report
"RTN","PSBO",110,0)
 S $P(^PSB(53.69,PSBRPT,0),U,8)=$G(ZTSK,"RPC")
"RTN","PSBO",111,0)
 D:$$SETUP @("EN^PSBO"_$P(PSBRPT(0),U,5))
"RTN","PSBO",112,0)
 K ^TMP("PSBO",$J),PSBSIFLG
"RTN","PSBO",113,0)
 S ZTREQ="@"
"RTN","PSBO",114,0)
 Q
"RTN","PSBO",115,0)
 ;
"RTN","PSBO",116,0)
IOM() ; Returns good margin or not
"RTN","PSBO",117,0)
 Q:IOM'<132 1
"RTN","PSBO",118,0)
 W !,"**************************************************************"
"RTN","PSBO",119,0)
 W !,"* SORRY, Your selected DEVICE does not print 132 columns.    *"
"RTN","PSBO",120,0)
 W !,"**************************************************************"
"RTN","PSBO",121,0)
 W !
"RTN","PSBO",122,0)
 Q 0
"RTN","PSBO",123,0)
 ;
"RTN","PSBO",124,0)
VAL(PSBFLDS) ; Validate that fields in PSBFLDS are filled in
"RTN","PSBO",125,0)
 N PSB,PSBFLD,PSBMSG,PSBSTOP,PSBST,PSBDAYS S PSBSTRT=""
"RTN","PSBO",126,0)
 F PSB=1:1 Q:$P(PSBFLDS,";",PSB)=""  S PSBFLD=$P(PSBFLDS,";",PSB),PSBFLD(PSBFLD)=$$GET^DDSVAL(53.69,DA,PSBFLD)
"RTN","PSBO",127,0)
 I $D(PSBFLD(.11)) K:$E(PSBFLD(.11))="P" PSBFLD(.13),PSBFLD(.15) K:$E(PSBFLD(.11))="W" PSBFLD(.12)
"RTN","PSBO",128,0)
 S PSB=""  F  S PSB=$O(PSBFLD(PSB)) Q:PSB=""  D:PSBFLD(PSB)=""
"RTN","PSBO",129,0)
 .I '$D(PSBMSG) S PSBMSG(0)="UNABLE TO FILE REQUEST",PSBMSG(1)=" ",PSBMSG(2)="ERROR: MISSING DATA - ALL FIELDS ARE REQUIRED",PSBMSG(3)=" "
"RTN","PSBO",130,0)
 .D FIELD^DID(53.69,PSB,"","TITLE;LABEL","PSB")
"RTN","PSBO",131,0)
 .S Z="  Missing Field: "_$S(PSB("TITLE")]"":PSB("TITLE"),1:PSB("LABEL"))
"RTN","PSBO",132,0)
 .S PSBMSG($O(PSBMSG(""),-1)+1)=Z
"RTN","PSBO",133,0)
 ; Check Times
"RTN","PSBO",134,0)
 D:$G(PSBFLD(.16))
"RTN","PSBO",135,0)
 .S PSBSTRT=PSBFLD(.16)+$G(PSBFLD(.17))
"RTN","PSBO",136,0)
 .D:$P($$GET1^DIQ(53.69,DA_",",.01),U)["MH"
"RTN","PSBO",137,0)
 ..S PSBDAYS=$$GET1^DIQ(101.24,$$FIND1^DIC(101.24,"","X","ORRP BCMA MAH","B")_",",.42)  ;check maxdays
"RTN","PSBO",138,0)
 ..S:PSBDAYS="" PSBDAYS=7
"RTN","PSBO",139,0)
 ..S X=PSBSTRT\1 D H^%DTC S PSBST=%H+PSBDAYS    ;Determine stop date
"RTN","PSBO",140,0)
 .S PSBSTOP=$S($G(PSBFLD(.18)):PSBFLD(.18),1:PSBFLD(.16))+$G(PSBFLD(.19))
"RTN","PSBO",141,0)
 .I PSBSTOP<PSBSTRT S Y=$O(PSBMSG(""),-1)+1,PSBMSG(Y)="  Date: Stop Date/Time is before Start Date/Time"
"RTN","PSBO",142,0)
 .I $P($$GET1^DIQ(53.69,DA_",",.01),U)["MH" S X=PSBSTOP\1 D H^%DTC I %H>PSBST S Y=$O(PSBMSG(""),-1)+1,PSBMSG(Y)="  The date range cannot exceed "_PSBDAYS_" day(s) as defined in the CPRS 'MAXIMUM DAYS BACK' parameter"
"RTN","PSBO",143,0)
 Q:'$D(PSBMSG)  ; All is well
"RTN","PSBO",144,0)
 D MSG^DDSUTL(.PSBMSG)
"RTN","PSBO",145,0)
 S DDSERROR=1
"RTN","PSBO",146,0)
 Q
"RTN","PSBO",147,0)
 ;
"RTN","PSBO",148,0)
SETUP() ; Setup parameters for the report in PSBRPT
"RTN","PSBO",149,0)
 N PSBWRDL,PSBINDX,PSBWRDA,QQ
"RTN","PSBO",150,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",151,0)
 F X=0,.1,.2,.3,.4,.5,1 S PSBRPT(X)=$G(^PSB(53.69,PSBRPT,X))
"RTN","PSBO",152,0)
 I $D(^PSB(53.69,PSBRPT,2)) M PSBRPT(2)=^PSB(53.69,PSBRPT,2)
"RTN","PSBO",153,0)
 I $D(^PSB(53.69,PSBRPT,3)) M PSBRPT(3)=^PSB(53.69,PSBRPT,3)
"RTN","PSBO",154,0)
 I $D(^PSB(53.69,PSBRPT,4)) M PSBRPT(4)=^PSB(53.69,PSBRPT,4)      ;*68
"RTN","PSBO",155,0)
 S PSBRPT(.52)=$P($G(^PSB(53.69,PSBRPT,.5)),U,2)
"RTN","PSBO",156,0)
 S PSBSIFLG=$P($G(PSBRPT(4)),U)                                   ;*68
"RTN","PSBO",157,0)
 I $P(PSBRPT(0),"-")="ST",PSBRPT(3)]"" Q 1  ;Running a MSF report PSB*3*28
"RTN","PSBO",158,0)
 I $P(PSBRPT(0),"-")="SF",PSBRPT(.52)]"" Q 1  ;Running a MSF report PSB*3*28
"RTN","PSBO",159,0)
 I $P(PSBRPT(.1),U,1)="P" D  I 'PSBDFN Q 0
"RTN","PSBO",160,0)
 .S PSBDFN=+$P(PSBRPT(.1),U,2) Q:'PSBDFN
"RTN","PSBO",161,0)
 .N VA,VADM S DFN=PSBDFN D DEM^VADPT
"RTN","PSBO",162,0)
 .Q:(VADM(1)="")!(VA("PID")="")
"RTN","PSBO",163,0)
 .S ^TMP("PSBO",$J,PSBDFN,0)=VADM(1)_U_VA("PID"),^TMP("PSBO",$J,"B",VADM(1),PSBDFN)=""
"RTN","PSBO",164,0)
 I $P(PSBRPT(.1),U,1)="W" D  I 'PSBWRD Q 0
"RTN","PSBO",165,0)
 .S PSBWRD=$P(PSBRPT(.1),U,3) Q:'PSBWRD  D WARD^NURSUT5("L^"_PSBWRD,.PSBWRDA)
"RTN","PSBO",166,0)
 .S QQ="" F  S QQ=$O(PSBWRDA(PSBWRD,2,QQ)) Q:QQ=""   S PSBWRDL=$P(PSBWRDA(PSBWRD,2,QQ,.01),U,2) D
"RTN","PSBO",167,0)
 ..F PSBDFN=0:0 S PSBDFN=$O(^DPT("CN",PSBWRDL,PSBDFN)) Q:PSBDFN=""  D
"RTN","PSBO",168,0)
 ...Q:($G(PSBDFN)="")!($G(PSBDFN)'>0)
"RTN","PSBO",169,0)
 ...S DFN=PSBDFN D DEM^VADPT
"RTN","PSBO",170,0)
 ...Q:(VADM(1)="")!(VA("PID")="")
"RTN","PSBO",171,0)
 ...S ^TMP("PSBO",$J,PSBDFN,0)=VADM(1)_U_VA("PID")
"RTN","PSBO",172,0)
 ...; Determine Sort or default to Pt Name...
"RTN","PSBO",173,0)
 ...S:$P(PSBRPT(.1),U,5)="P" PSBINDX=VADM(1)
"RTN","PSBO",174,0)
 ...I $P(PSBRPT(.1),U,5)="B" S PSBINDX=$P($G(^DPT(PSBDFN,.101)),U) S:PSBINDX="" PSBINDX="** NO ROOM BED **"
"RTN","PSBO",175,0)
 ...S:$P(PSBRPT(.1),U,5)="" PSBINDX=VADM(1)
"RTN","PSBO",176,0)
 ...S:$G(PSBINDX)="" PSBINDX=VADM(1)
"RTN","PSBO",177,0)
 ...S ^TMP("PSBO",$J,"B",PSBINDX,PSBDFN)=""
"RTN","PSBO",178,0)
 Q 1
"RTN","PSBO",179,0)
 ;
"RTN","PSBO",180,0)
WRAP(X,Y,Z) ; Quick text wrap
"RTN","PSBO",181,0)
 ;
"RTN","PSBO",182,0)
 ; Input Parameters Description:
"RTN","PSBO",183,0)
 ;  X: Left Column of display [Optional]
"RTN","PSBO",184,0)
 ;  Y: Cols to wrap in [Optional]
"RTN","PSBO",185,0)
 ;  Z: Text to wrap [Optional]
"RTN","PSBO",186,0)
 ;
"RTN","PSBO",187,0)
 N PSB
"RTN","PSBO",188,0)
 F  Q:'$L(Z)  D
"RTN","PSBO",189,0)
 .W:$X>X !
"RTN","PSBO",190,0)
 .W:$X<X ?X
"RTN","PSBO",191,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBO",192,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBO",193,0)
 .S:PSB<1 PSB=Y
"RTN","PSBO",194,0)
 .W $E(Z,1,PSB)
"RTN","PSBO",195,0)
 .S Z=$E(Z,PSB+1,$L(Z))
"RTN","PSBO",196,0)
 Q ""
"RTN","PSBO",197,0)
 ;
"RTN","PSBO",198,0)
CHECK ;Beginning of PSB*1*10
"RTN","PSBO",199,0)
 K ^TMP("PSJ",$J)
"RTN","PSBO",200,0)
 N PSBDFN,PSBBAR,PSBDRUG,PSBFLAG,PSBPNM,PSBNDX,PSBX
"RTN","PSBO",201,0)
 S PSBFLAG="",PSBBAR=$P($P($G(^PSB(53.69,DA,.3)),U,1),"~",2)
"RTN","PSBO",202,0)
 S PSBDRUG=$$GET1^DIQ(53.69,DA_",",.31)
"RTN","PSBO",203,0)
 S PSBDFN=$$GET1^DIQ(53.69,DA_",",.12,"I") S:$G(PSBDFN) PSBFLAG=1
"RTN","PSBO",204,0)
 D EN^PSJBCMA(PSBDFN)
"RTN","PSBO",205,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBO",206,0)
 .K Y,PSBORD,PSBPNM,PSBNDX
"RTN","PSBO",207,0)
 .M PSBORD=^TMP("PSJ",$J,PSBX)
"RTN","PSBO",208,0)
 .F PSBNDX=700,850,950  D
"RTN","PSBO",209,0)
 ..F Y=0:0 S Y=$O(PSBORD(PSBNDX,Y)) Q:'Y  D
"RTN","PSBO",210,0)
 ...I $P($G(PSBORD(1)),U,7)'="A" Q
"RTN","PSBO",211,0)
 ...S PSBPNM=$P(PSBORD(PSBNDX,Y,0),U,1)
"RTN","PSBO",212,0)
 ...I PSBNDX=700,PSBPNM=PSBBAR S PSBFLAG=0 Q
"RTN","PSBO",213,0)
 ...I PSBNDX=850,$D(^PSDRUG("A526",PSBBAR,PSBPNM)) S PSBFLAG=0 Q
"RTN","PSBO",214,0)
 ...I PSBNDX=950,$D(^PSDRUG("A527",PSBBAR,PSBPNM)) S PSBFLAG=0
"RTN","PSBO",215,0)
 I PSBFLAG=1 D
"RTN","PSBO",216,0)
 .W !,"Patient is not currently on medication: ",PSBDRUG
"RTN","PSBO",217,0)
 .K DIRUT,DIR
"RTN","PSBO",218,0)
 .S DIR("A")="Do you want to continue"
"RTN","PSBO",219,0)
 .S DIR(0)="Y"
"RTN","PSBO",220,0)
 .D ^DIR
"RTN","PSBO",221,0)
 .S PSBANS=+Y W !
"RTN","PSBO",222,0)
 Q
"RTN","PSBO",223,0)
 ;
"RTN","PSBO",224,0)
PRNEFF(PSBEIECMT,PSBIEN) ;Check for PRN Error comment
"RTN","PSBO",225,0)
 N PSBCMTCH
"RTN","PSBO",226,0)
 I $P($G(PSBRPT(.2)),U,8)=0 S PSBCMTCH=0 F  S PSBCMTCH=$O(^PSB(53.79,PSBIEN,.3,PSBCMTCH)) Q:PSBCMTCH=""  D
"RTN","PSBO",227,0)
 .I $P($G(^PSB(53.79,PSBIEN,.3,PSBCMTCH,0)),U)["**Pain Score of" S PSBEIECMT=" **This Pain Score may have been Entered in Error. See Vitals Package.**"
"RTN","PSBO",228,0)
 Q PSBEIECMT
"RTN","PSBO",229,0)
 ;
"RTN","PSBOCE")
0^9^B83955260^B78332113
"RTN","PSBOCE",1,0)
PSBOCE ;BIRMINGHAM/TEJ-Expired/DC'd/EXPIRING ORDERS REPORT ;1/10/12 8:40pm
"RTN","PSBOCE",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,50,68**;Mar 2004;Build 26
"RTN","PSBOCE",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCE",4,0)
 ;
"RTN","PSBOCE",5,0)
 ; Reference/IA
"RTN","PSBOCE",6,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOCE",7,0)
 ; 
"RTN","PSBOCE",8,0)
 ;*68 - allow SIOPI builder to accomodate more than 1 line for SI array
"RTN","PSBOCE",9,0)
 ;
"RTN","PSBOCE",10,0)
EN ;
"RTN","PSBOCE",11,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR,QQ
"RTN","PSBOCE",12,0)
 S PSBFUTR=$TR(PSBRPT(1),"~",U)
"RTN","PSBOCE",13,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG)=""   ; Ord Status srch crit - "A"ctve, "D"C ed, "E"xpred"
"RTN","PSBOCE",14,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"Expired/DC'd" S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"Expired/DC'd" S:$P(PSBFUTR,U,9) PSBOCRIT=PSBOCRIT_"Expiring Today"
"RTN","PSBOCE",15,0)
 S:$P(PSBFUTR,U,10) PSBOCRIT=PSBOCRIT_"Expiring Tomorrow"
"RTN","PSBOCE",16,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCE",17,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCE",18,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD
"RTN","PSBOCE",19,0)
 S PSBSORT=1
"RTN","PSBOCE",20,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=Y
"RTN","PSBOCE",21,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCE",22,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCE",23,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCE",24,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCE",25,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCE",26,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSBX1X)=""
"RTN","PSBOCE",27,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCE",28,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCE",29,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCE",30,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCE",31,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCE",32,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X)
"RTN","PSBOCE",33,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCE",34,0)
 .S PSBX2X=1
"RTN","PSBOCE",35,0)
 .S (PSBLIST2("Expiring Tomorrow"),PSBLIST2("Expiring Today"),PSBLIST2("Expired/DC'd"),PSBLIST2(" * NO * "))=0
"RTN","PSBOCE",36,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCE",37,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCE",38,0)
 ..I $P(PSBDATA,U)="ORD" D  Q
"RTN","PSBOCE",39,0)
 ...K PSBDRUGN
"RTN","PSBOCE",40,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCE",41,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCE",42,0)
 ...S PSBTB(PSBORDN,PSBTB)=""
"RTN","PSBOCE",43,0)
 ...S PSBSTS=$P(PSBDATA,U,23) S PSBSTS=$S((PSBSTS="A")&(($P(PSBDATA,U,27)>PSBNOWX)):"Active",PSBSTS="H":"On Hold",PSBSTS="D":"Discontinued",PSBSTS="DE":"Discontinued (Edit)",(PSBSTS="E")!($P(PSBDATA,U,27)'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCE",44,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCE",45,0)
 ...S X2=$P(PSBDATA,U,27),X3=$P(PSBNOWX,".")
"RTN","PSBOCE",46,0)
 ...S PSBSTSX=$S((X2<PSBNOWX):"Expired/DC'd",(X3'>X2)&($$FMADD^XLFDT(X3,1)>X2):"Expiring Today",($$FMADD^XLFDT(X3,1)'>X2)&(X2'>$$FMADD^XLFDT(X3,2)):"Expiring Tomorrow",1:" * NO * ")
"RTN","PSBOCE",47,0)
 ...I PSBSTS["Discontinued" S PSBSTSX="Expired/DC'd"
"RTN","PSBOCE",48,0)
 ...S PSBLIST2(PSBSTSX,$P(PSBDATA,U,9),PSBORDN)="" S PSBLIST2(PSBSTSX)=PSBLIST2(PSBSTSX)+1
"RTN","PSBOCE",49,0)
 ...S:PSBOCRIT[PSBSTSX PSBTOT=PSBTOT+1
"RTN","PSBOCE",50,0)
 ...S PSBSCHTY=$P(PSBDATA,U,6)
"RTN","PSBOCE",51,0)
 ...S PSBSCHTY(PSBORDN,PSBSCHTY)=""
"RTN","PSBOCE",52,0)
 ...S PSBSCHD=$P(PSBDATA,U,7) I PSBSCHD="" S PSBSCHD=" "
"RTN","PSBOCE",53,0)
 ...S PSBSCHD(PSBORDN,PSBSCHD)=""
"RTN","PSBOCE",54,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCE",55,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCE",56,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)="" K PSBOMDR(PSBORDN)
"RTN","PSBOCE",57,0)
 ...S PSBNXTX1=$$NEXTADM^PSBCSUTX(PSBX1X,PSBORDN)
"RTN","PSBOCE",58,0)
 ...I PSBSTS["Hold" S PSBNXTX2="Provider Hold"
"RTN","PSBOCE",59,0)
 ...I PSBSTS'["Hold" D 
"RTN","PSBOCE",60,0)
 ....I PSBNOWX>$$FMADD^XLFDT(PSBNXTX1,,,PSBAFT) S PSBNXTX2="MISSED "_PSBNXTX1
"RTN","PSBOCE",61,0)
 ....E  S PSBNXTX2="DUE "_PSBNXTX1
"RTN","PSBOCE",62,0)
 ...S PSBNXTX1=$$FMTDT^PSBOCE1(PSBNXTX1)
"RTN","PSBOCE",63,0)
 ...I ("^P^OC^O"[(U_PSBSCHTY))!(PSBTB="IV")!(PSBSTS["Discontinued")!(PSBSTS["Expired") S:PSBSTS'["Hold" PSBNXTX2=" "
"RTN","PSBOCE",64,0)
 ...S PSBNXTX(PSBORDN,PSBNXTX2)=""
"RTN","PSBOCE",65,0)
 ...; ** SPC INSTR  **
"RTN","PSBOCE",66,0)
 ...S PSBX2X=PSBX2X+1
"RTN","PSBOCE",67,0)
 ...;  *68
"RTN","PSBOCE",68,0)
 ...K ^TMP("PSJBCMA5",$J)
"RTN","PSBOCE",69,0)
 ...I PSBSIFLG D GETSIOPI^PSJBCMA5(PSBX1X,PSBORDN,1)
"RTN","PSBOCE",70,0)
 ...F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)) Q:'QQ  D
"RTN","PSBOCE",71,0)
 ....S PSBSI(PSBORDN,QQ)=^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)
"RTN","PSBOCE",72,0)
 ...;  *68 end
"RTN","PSBOCE",73,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCE",74,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCE",75,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCE",76,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCE",77,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA,U)) D  Q
"RTN","PSBOCE",78,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCE",79,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCE",80,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCE",81,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCE",82,0)
 ..I $P(PSBDATA,U)="END" Q
"RTN","PSBOCE",83,0)
 ..I $P(PSBDATA(PSBX2X+1),U)="ORF" D  Q
"RTN","PSBOCE",84,0)
 ...S PSBX2X=PSBX2X+1 S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCE",85,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCE",86,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D
"RTN","PSBOCE",87,0)
 ...S PSBXID=$P(PSBDATA,U,6)_U_$P(PSBDATA,U,4),PSBADM(PSBORDN,(-1*($P(PSBDATA,U,6))),PSBXID)=PSBDATA
"RTN","PSBOCE",88,0)
 ...I $O(PSBSCHTY(PSBORDN,""))="P" S PSBPRNR(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,9)
"RTN","PSBOCE",89,0)
 ...I $P(PSBDATA,U,3)]"" S PSBBID(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,3)
"RTN","PSBOCE",90,0)
 ...S:PSBXFLG PSBLGD(PSBORDN,"X","INITIALS",$P(PSBDATA,U,8))=""
"RTN","PSBOCE",91,0)
 ...K PSBDATA(PSBX2X)
"RTN","PSBOCE",92,0)
 ...I ($P(PSBDATA(PSBX2X+1),U)="CMT")  F  S PSBDATA=PSBDATA(PSBX2X+1) Q:($P(PSBDATA,U)'="CMT")  D
"RTN","PSBOCE",93,0)
 ....S PSBX2X=PSBX2X+1
"RTN","PSBOCE",94,0)
 ....S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCE",95,0)
 ....K PSBDATA(PSBX2X)
"RTN","PSBOCE",96,0)
 ....S:$P(PSBDATA,U,3)]"" PSBPRNEF(PSBORDN,$P(PSBXID,U,2))=$P(PSBDATA,U,3)
"RTN","PSBOCE",97,0)
 ....I 'PSBCFLG S PSBDATA=PSBDATA(PSBX2X+1) Q
"RTN","PSBOCE",98,0)
 ....I $P(PSBDATA,U,2)'="" D
"RTN","PSBOCE",99,0)
 .....S PSBLGD(PSBORDN,"C","INITIALS",$P(PSBDATA,U,4))=""
"RTN","PSBOCE",100,0)
 .....S PSBCMT(PSBORDN,$P(PSBXID,U,2),(-1*$P(PSBDATA,U,6)),PSBX2X)=PSBDATA
"RTN","PSBOCE",101,0)
 I '$D(PSBLIST2) K PSBLIST,^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCE",102,0)
 D CREATHDR
"RTN","PSBOCE",103,0)
 D SUBHDR
"RTN","PSBOCE",104,0)
 D BLDRPT
"RTN","PSBOCE",105,0)
 D WRTRPT
"RTN","PSBOCE",106,0)
 Q
"RTN","PSBOCE",107,0)
BLDRPT ; Buld RPT DATA
"RTN","PSBOCE",108,0)
 S X0="" K PSBLIST2(" * NO * "),PSBL2ULN
"RTN","PSBOCE",109,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCE",110,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCE",111,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCE",112,0)
 S PSBMORE=5 F PSBX1X="Expired/DC'd","Expiring Today","Expiring Tomorrow" D
"RTN","PSBOCE",113,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_$S(PSBLIST2(PSBX1X)=1:" Order",1:" Orders")_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCE",114,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCE",115,0)
 .Q:PSBOCRIT'[PSBX1X
"RTN","PSBOCE",116,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCE",117,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCE",118,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCE",119,0)
 .K PSBDATA
"RTN","PSBOCE",120,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCE",121,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCE",122,0)
 ..M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"X","INITIALS") M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"C","INITIALS")
"RTN","PSBOCE",123,0)
 ..S PSBDATA(1,1)=$O(PSBTB(PSBX2X,""))
"RTN","PSBOCE",124,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCE",125,0)
 ..S PSBDATA(1,3)=$O(PSBSCHTY(PSBX2X,""))
"RTN","PSBOCE",126,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCE",127,0)
 ..S PSBDATA(1,5)=$O(PSBSCHD(PSBX2X,""))
"RTN","PSBOCE",128,0)
 ..S PSBDATA(1,6)=$O(PSBNXTX(PSBX2X,""))
"RTN","PSBOCE",129,0)
 ..S:PSBDATA(1,6)'["Hold" $P(PSBDATA(1,6)," ",2)=$$FMTDT^PSBOCE1($P(PSBDATA(1,6)," ",2))
"RTN","PSBOCE",130,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCE",131,0)
 ..S PSBDATA(1,8)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCE",132,0)
 ..K PSBSIDAT M PSBSIDAT=PSBSI(PSBX2X)                  ;*68
"RTN","PSBOCE",133,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCE",134,0)
 ..K PSBDATA(2),PSBDATA(3),PSBSILN
"RTN","PSBOCE",135,0)
 ..D BUILDLN^PSBOCE1,SIOPI^PSBOCM(.PSBSIDAT,PSBTAB8,$S(PSBX2X["V":"Other Print Info: ",1:""))
"RTN","PSBOCE",136,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCE",137,0)
 ..K PSB1 I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCE",138,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCE",139,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCE",140,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCE",141,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCE",142,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCE",143,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCE",144,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOCE",145,0)
 ..K PSBRPLN,PSBDATA,PSBSILN
"RTN","PSBOCE",146,0)
 D:+PSBTOT>0 LGD^PSBOCM
"RTN","PSBOCE",147,0)
 Q
"RTN","PSBOCE",148,0)
WRTRPT ;  writ
"RTN","PSBOCE",149,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOCE",150,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),21)
"RTN","PSBOCE",151,0)
 .D FTR
"RTN","PSBOCE",152,0)
 S PSBPGNUM=1
"RTN","PSBOCE",153,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOCE",154,0)
 .I PSBPGNUM'=PSBZ D FTR S PSBPGNUM=PSBZ D HDR,SUBHDR
"RTN","PSBOCE",155,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBOUTP(PSBZ,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCE",156,0)
 ..X PSBOUTP(PSBZ,PSBX2X)
"RTN","PSBOCE",157,0)
 D FTR
"RTN","PSBOCE",158,0)
 K ^XTMP("PSBO",$J,"PSBLIST"),PSBOUTP
"RTN","PSBOCE",159,0)
 Q
"RTN","PSBOCE",160,0)
HDR ;  Hder
"RTN","PSBOCE",161,0)
 W:$Y>1 @IOF
"RTN","PSBOCE",162,0)
 W:$X>1 !
"RTN","PSBOCE",163,0)
 S PSBRPNM="BCMA COVERSHEET EXPIRED/DC'd/EXPIRING ORDERS REPORT"
"RTN","PSBOCE",164,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOCE",165,0)
 .S PSBHDR(0)=PSBRPNM
"RTN","PSBOCE",166,0)
 .S PSBHDR(1)="Order Status(es): --"
"RTN","PSBOCE",167,0)
 .F Y=7,8,9,10 I $P(PSBFUTR,U,Y) S $P(PSBHDR(1),": ",2)=$P(PSBHDR(1),": ",2)_$S(PSBHDR(1)["--":"",1:"/ ")_$P("^^^^^^Expired^DC'd^Expiring Today^Expiring Tomorrow^^^^^^^^",U,Y)_" " S PSBHDR(1)=$TR(PSBHDR(1),"-","")
"RTN","PSBOCE",168,0)
 .I $P(PSBFUTR,U,11) S PSBHDR(2)="Include Action(s)"_$S(PSBCFLG:" & Comments/Reasons",1:"")
"RTN","PSBOCE",169,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR)
"RTN","PSBOCE",170,0)
 Q
"RTN","PSBOCE",171,0)
SUBHDR ;
"RTN","PSBOCE",172,0)
 N PSBAL S PSBAL=$O(PSBHDR("ALERGY",""),-1) S PSBAL=$S((PSBAL/12)>(PSBAL\12):(PSBAL\12)+1,1:(PSBAL\12))
"RTN","PSBOCE",173,0)
 N PSBRE S PSBRE=$O(PSBHDR("REAC",""),-1) S PSBRE=$S((PSBRE/12)>(PSBRE\12):(PSBRE\12)+1,1:(PSBRE\12))
"RTN","PSBOCE",174,0)
 S PSBLNTOT=$O(PSBHDR(""),-1)+9+PSBAL+PSBRE+1
"RTN","PSBOCE",175,0)
 I $G(PSBPGNUM,0)=1 W !,?(PSBTAB8-($L("Total Orders reported: "_+PSBTOT))),"Total Orders reported: "_+PSBTOT,! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCE",176,0)
 W !,$TR($J("",PSBTAB8)," ","_") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCE",177,0)
 W !,$G(PSBHD1,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCE",178,0)
 W !,$G(PSBHD2,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCE",179,0)
 W !,$TR($J("",PSBTAB8)," ","="),! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCE",180,0)
 I $D(NOTE(PSBPGNUM)) W NOTE(PSBPGNUM),!! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCE",181,0)
 Q
"RTN","PSBOCE",182,0)
FTR ;  Footr
"RTN","PSBOCE",183,0)
 D PTFTR^PSBOHDR()
"RTN","PSBOCE",184,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOCE",185,0)
 S PSBPGRM=PSBTAB8-($L(PSBPG))
"RTN","PSBOCE",186,0)
 W !,PSBRPNM,"     ",?(PSBPGRM-($L(PSBDTTM)+3)),PSBDTTM_"  "_PSBPG
"RTN","PSBOCE",187,0)
 Q
"RTN","PSBOCE",188,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOCE",189,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCE",190,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCE",191,0)
 Q PSBPGNUM
"RTN","PSBOCE",192,0)
CREATHDR ;
"RTN","PSBOCE",193,0)
 K PSBHD1,PSBHD2
"RTN","PSBOCE",194,0)
 I IOM'<132 S PSBMORE=4,PSBHD1=$P($T(HD132A),"~",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(H132BLK),";",2)
"RTN","PSBOCE",195,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" K PSBLIST2 Q
"RTN","PSBOCE",196,0)
 ; tabs
"RTN","PSBOCE",197,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOCE",198,0)
 S PSBPGNUM=1
"RTN","PSBOCE",199,0)
 D HDR
"RTN","PSBOCE",200,0)
 Q
"RTN","PSBOCE",201,0)
HD132A ;~ VDL |    Status     |Type|       Medication; Dosage, Route      |    Schedule    |     Next      |   Order Start  |   Order Stop  |
"RTN","PSBOCE",202,0)
 Q
"RTN","PSBOCE",203,0)
HD132B ; Tab |               |    |                                      |                |   Action      |     Date       |    Date       |
"RTN","PSBOCE",204,0)
 Q
"RTN","PSBOCE",205,0)
H132BLK ;;     |               |    |                                      |                |                |               |               |
"RTN","PSBOCE",206,0)
 Q
"RTN","PSBOCI")
0^10^B92815487^B87456425
"RTN","PSBOCI",1,0)
PSBOCI ;BIRMINGHAM/TEJ-COVERSHEET IV OVERVIEW REPORT ;2/15/12 9:34pm
"RTN","PSBOCI",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,62,68**;Mar 2004;Build 26
"RTN","PSBOCI",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCI",4,0)
 ;
"RTN","PSBOCI",5,0)
 ; Reference/IA
"RTN","PSBOCI",6,0)
 ; File 4/10090
"RTN","PSBOCI",7,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOCI",8,0)
 ; 
"RTN","PSBOCI",9,0)
 ;*68 - allow SIOPI builder to accomodate more than 1 line in SI array
"RTN","PSBOCI",10,0)
 ;
"RTN","PSBOCI",11,0)
EN ;
"RTN","PSBOCI",12,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR,QQ
"RTN","PSBOCI",13,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOCI",14,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG,PSBBGX)=""  ; srch crit - "A"ctive,"D"C ed,"E"xpired"
"RTN","PSBOCI",15,0)
 S PSBOCRIT="DEA"
"RTN","PSBOCI",16,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCI",17,0)
 S:$P(PSBFUTR,U,12) PSBBGX=PSBBGX_"I"
"RTN","PSBOCI",18,0)
 S:$P(PSBFUTR,U,13) PSBBGX=PSBBGX_"S"
"RTN","PSBOCI",19,0)
 S:$P(PSBFUTR,U,14) PSBBGX=PSBBGX_"A"
"RTN","PSBOCI",20,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCI",21,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD
"RTN","PSBOCI",22,0)
 S PSBSORT=1
"RTN","PSBOCI",23,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=Y
"RTN","PSBOCI",24,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCI",25,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCI",26,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCI",27,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCI",28,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCI",29,0)
 S (PSBPGNUM,PSBLNTOT)=""
"RTN","PSBOCI",30,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCI",31,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCI",32,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCI",33,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCI",34,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCI",35,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X)
"RTN","PSBOCI",36,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCI",37,0)
 .S PSBX2X=1
"RTN","PSBOCI",38,0)
 .S (PSBLIST2("All Other"),PSBLIST2("Infusing"),PSBLIST2("Stopped"),PSBLIST2(" * NO * "))=0
"RTN","PSBOCI",39,0)
 .K PSBBSO
"RTN","PSBOCI",40,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCI",41,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCI",42,0)
 ..I $P(PSBDATA,U)="ORD" K PSBORDN,PSBDRUGN D  Q
"RTN","PSBOCI",43,0)
 ...S PSBEND=0
"RTN","PSBOCI",44,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCI",45,0)
 ...I (PSBTB'="IV") F PSBX2X=PSBX2X:1 D  Q:PSBEND>0
"RTN","PSBOCI",46,0)
 ....S PSBEND=0 I $P(PSBDATA(PSBX2X),U)="END" S PSBEND=PSBX2X
"RTN","PSBOCI",47,0)
 ...Q:PSBEND>0
"RTN","PSBOCI",48,0)
 ...S PSBSTS1=$P(PSBDATA,U,23)
"RTN","PSBOCI",49,0)
 ...S PSBSTS=$S((PSBSTS1="A")&(($P(PSBDATA,U,27)>PSBNOWX)):"Active",PSBSTS1="H":"On Hold",PSBSTS1="D":"Discontinued",PSBSTS1="DE":"Discontinued (Edit)",(PSBSTS1="E")!($P(PSBDATA,U,27)'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCI",50,0)
 ...S V=$$FMADD^XLFDT(PSBNOWX,,,PSBB4)
"RTN","PSBOCI",51,0)
 ...S PSBSTSX=$S($P(PSBDATA,U,27)'>PSBNOWX:"EXPIRED/DC'd",$P(PSBDATA,U,22)'>V:"ACTIVE",V:"FUTURE",1:" * ERROR * ")
"RTN","PSBOCI",52,0)
 ...I PSBSTSX=" * ERROR * "  F PSBX2X=PSBX2X:1 D  Q:PSBEND>0
"RTN","PSBOCI",53,0)
 ....S PSBEND=0 I $P(PSBDATA(PSBX2X),U)="END" S PSBEND=PSBX2X
"RTN","PSBOCI",54,0)
 ...Q:PSBEND>0
"RTN","PSBOCI",55,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCI",56,0)
 ...S PSBORITX=$P(PSBDATA,U,9)
"RTN","PSBOCI",57,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCI",58,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCI",59,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCI",60,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCI",61,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCI",62,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCI",63,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCI",64,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)=""
"RTN","PSBOCI",65,0)
 ...S X2="A",PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")=" "
"RTN","PSBOCI",66,0)
 ...S PSBBSO(PSBORDN)="" S:$G(PSBSTSX)="ACTIVE" PSBBSO(PSBORDN)="AVAILABLE"
"RTN","PSBOCI",67,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",68,0)
 ..I $P(PSBDATA,U)="ORC" D  Q
"RTN","PSBOCI",69,0)
 ...;  *68
"RTN","PSBOCI",70,0)
 ...K ^TMP("PSJBCMA5",$J)
"RTN","PSBOCI",71,0)
 ...I PSBSIFLG D GETSIOPI^PSJBCMA5(PSBX1X,PSBORDN,1)
"RTN","PSBOCI",72,0)
 ...F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)) Q:'QQ  D
"RTN","PSBOCI",73,0)
 ....S PSBSI(PSBORDN,QQ)=^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)
"RTN","PSBOCI",74,0)
 ...;  *68 end
"RTN","PSBOCI",75,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",76,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA(PSBX2X),U)) D  Q
"RTN","PSBOCI",77,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCI",78,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCI",79,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCI",80,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCI",81,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",82,0)
 ..I $P(PSBDATA,U)="ORF" D  Q
"RTN","PSBOCI",83,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCI",84,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",85,0)
 ..I $P(PSBDATA,U)="ID"  D  Q
"RTN","PSBOCI",86,0)
 ...F PSBX3X=PSBX2X:1 S PSBDATA=PSBDATA(PSBX3X) Q:($P(PSBDATA,U)'="ID")  D
"RTN","PSBOCI",87,0)
 ....S PSBX2X=PSBX3X
"RTN","PSBOCI",88,0)
 ....K X2
"RTN","PSBOCI",89,0)
 ....S X2="A",PSBLIST2("All Other",PSBORITX,PSBORDN,$P(PSBDATA,U,2))=PSBBSO(PSBORDN) I $D(PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")) K PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")
"RTN","PSBOCI",90,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",91,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D  Q
"RTN","PSBOCI",92,0)
 ...I $P(PSBDATA,U,3)]"" D
"RTN","PSBOCI",93,0)
 ....K X2
"RTN","PSBOCI",94,0)
 ....S PSBBID(PSBORDN,$P(PSBDATA,U,3))=""
"RTN","PSBOCI",95,0)
 ....I $P(^PSB(53.79,$P(PSBDATA,U,4),0),U,9)="I" S X2="I",PSBLIST2("Infusing")=PSBLIST2("Infusing")+1,PSBLIST2("Infusing",PSBORITX,PSBORDN,$P(PSBDATA,U,3))="INFUSING"
"RTN","PSBOCI",96,0)
 ....I $P(^PSB(53.79,$P(PSBDATA,U,4),0),U,9)="S" S X2="S",PSBLIST2("Stopped")=PSBLIST2("Stopped")+1,PSBLIST2("Stopped",PSBORITX,PSBORDN,$P(PSBDATA,U,3))="STOPPED"
"RTN","PSBOCI",97,0)
 ....N PSBORIEN,PSBADIT,PSBCMTIT ;Include initials in the Legend for all entries in the audit log and comment subfile - PSB*3*62
"RTN","PSBOCI",98,0)
 ....S PSBORIEN=$P(PSBDATA,U,4)
"RTN","PSBOCI",99,0)
 ....S PSBADIT=0 F  S PSBADIT=$O(^PSB(53.79,PSBORIEN,.9,PSBADIT)) Q:'PSBADIT  I ^PSB(53.79,PSBORIEN,.9,PSBADIT,0)["ACTION STATUS"!(^PSB(53.79,PSBORIEN,.9,PSBADIT,0)["ADMINISTRATION STATUS") D
"RTN","PSBOCI",100,0)
 .....I $P(^PSB(53.79,PSBORIEN,.9,PSBADIT,0),U,5)]"" S PSBLGD(PSBORDN,"INITIALS",$P(^PSB(53.79,PSBORIEN,.9,PSBADIT,0),U,5))=""
"RTN","PSBOCI",101,0)
 ....S PSBCMTIT=0 F  S PSBCMTIT=$O(^PSB(53.79,PSBORIEN,.3,PSBCMTIT)) Q:'PSBCMTIT  D
"RTN","PSBOCI",102,0)
 .....I $P(^PSB(53.79,PSBORIEN,.3,PSBCMTIT,0),U,2)]"" S PSBLGD(PSBORDN,"INITIALS",$P(^PSB(53.79,PSBORIEN,.3,PSBCMTIT,0),U,2))=""
"RTN","PSBOCI",103,0)
 ....S:'$D(X2) X2="A",PSBLIST2("All Other",PSBORITX,PSBORDN,$P(PSBDATA,U,3))=$$GET1^DIQ(53.79,$P(PSBDATA,U,4)_",","ACTION STATUS")
"RTN","PSBOCI",104,0)
 ....I $D(PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")) K PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")
"RTN","PSBOCI",105,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",106,0)
 ..I $P(PSBDATA,U,1)="END" Q
"RTN","PSBOCI",107,0)
 F I="All Other","Infusing","Stopped" S X="",PSBLIST2(I)=0 F  S X=$O(PSBLIST2(I,X)) Q:X=""  S XI="" F  S XI=$O(PSBLIST2(I,X,XI),-1) Q:XI=""  D
"RTN","PSBOCI",108,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(I,X,XI,PSBX2X),-1) Q:PSBX2X=""  S PSBLIST2(I)=PSBLIST2(I)+1  I (PSBBGX[$E(I,1)) S PSBTOT=PSBTOT+1
"RTN","PSBOCI",109,0)
 D CREATHDR
"RTN","PSBOCI",110,0)
 D SUBHDR
"RTN","PSBOCI",111,0)
 D BLDRPT
"RTN","PSBOCI",112,0)
 D WRTRPT
"RTN","PSBOCI",113,0)
 Q
"RTN","PSBOCI",114,0)
BLDRPT ; Bld RPT
"RTN","PSBOCI",115,0)
 K PSBL2ULN
"RTN","PSBOCI",116,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCI",117,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCI",118,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCI",119,0)
 S PSBMORE=5 F PSBX1X="Infusing","Stopped","All Other" D
"RTN","PSBOCI",120,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCI",121,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCI",122,0)
 .Q:PSBBGX'[$E(PSBX1X,1)
"RTN","PSBOCI",123,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCI",124,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCI",125,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCI",126,0)
 .K PSBDATA
"RTN","PSBOCI",127,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCI",128,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  S XI="" F  S XI=$O(PSBLIST2(PSBX1X,X0,PSBX2X,XI)) Q:XI=""  D
"RTN","PSBOCI",129,0)
 ..K PSBDATA(1)
"RTN","PSBOCI",130,0)
 ..S PSBDATA(1,1)=XI
"RTN","PSBOCI",131,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCI",132,0)
 ..S PSBDATA(1,3)=PSBLIST2(PSBX1X,X0,PSBX2X,XI)
"RTN","PSBOCI",133,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCI",134,0)
 ..I "IS"[$E(PSBDATA(1,3),1) S (PSBCHG,PSBDATA(1,5))="",PSBORLST(0)=PSBX2X D RPC^PSBCHKIV(.PSBCHG,PSBXDFN,.PSBORLST)
"RTN","PSBOCI",135,0)
 ..I $D(PSBCHG(0)) I PSBCHG(0)>0 I ($P(PSBCHG(1),U)=PSBX2X)!($P(PSBCHG(1),U,5)=PSBX2X) F X2=0:1 Q:PSBCHG(X2)="END"  I $P(PSBCHG(X2),U)="CD" S PSBDATA(1,5)="Changed Order" Q
"RTN","PSBOCI",136,0)
 ..S PSBDATA(1,6)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCI",137,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCI",138,0)
 ..K PSBSIDAT M PSBSIDAT=PSBSI(PSBX2X)                  ;*68
"RTN","PSBOCI",139,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCI",140,0)
 ..K PSBDATA(2),PSBSILN
"RTN","PSBOCI",141,0)
 ..D BUILDLN^PSBOCI1,SIOPI^PSBOCM(.PSBSIDAT,PSBTAB7,"Other Print Info: ")
"RTN","PSBOCI",142,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCI",143,0)
 ..K PSB1 I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCI",144,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCI",145,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCI",146,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCI",147,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCI",148,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCI",149,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCI",150,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB7),"" "",""-""),!"
"RTN","PSBOCI",151,0)
 ..K PSBRPLN,PSBDATA,PSBSILN
"RTN","PSBOCI",152,0)
 K PSBNO S PSBNO=1 D:+PSBTOT>0 LGD^PSBOCM K PSBNO
"RTN","PSBOCI",153,0)
 Q
"RTN","PSBOCI",154,0)
WRTRPT ;  writ
"RTN","PSBOCI",155,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOCI",156,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),14)
"RTN","PSBOCI",157,0)
 .D PTFTR^PSBOCI1
"RTN","PSBOCI",158,0)
 S PSBPGNUM=1
"RTN","PSBOCI",159,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOCI",160,0)
 .I PSBPGNUM'=PSBZ D PTFTR^PSBOCI1 S PSBPGNUM=PSBZ D HDR,SUBHDR
"RTN","PSBOCI",161,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBOUTP(PSBZ,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCI",162,0)
 ..X PSBOUTP(PSBZ,PSBX2X)
"RTN","PSBOCI",163,0)
 D PTFTR^PSBOCI1
"RTN","PSBOCI",164,0)
 K ^XTMP("PSBO",$J,"PSBLIST"),PSBOUTP
"RTN","PSBOCI",165,0)
 Q
"RTN","PSBOCI",166,0)
HDR ;  Hder
"RTN","PSBOCI",167,0)
 W:$Y>1 @IOF
"RTN","PSBOCI",168,0)
 W:$X>1 !
"RTN","PSBOCI",169,0)
 S PSBRPNM="BCMA COVERSHEET IV OVERVIEW REPORT"
"RTN","PSBOCI",170,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOCI",171,0)
 .S PSBHDR(0)=PSBRPNM
"RTN","PSBOCI",172,0)
 .S PSBHDR(1)="Order Type(s): --"
"RTN","PSBOCI",173,0)
 .F Y=12,13,18 I $P(PSBFUTR,U,Y) S $P(PSBHDR(1),": ",2)=$P(PSBHDR(1),": ",2)_$S(PSBHDR(1)["--":"",1:"/ ")_$P("^^^^^^^^^^^Infusing Bags^Stopped Bags^^^^^All Others",U,Y)_" " S PSBHDR(1)=$TR(PSBHDR(1),"-","")
"RTN","PSBOCI",174,0)
 .I $P(PSBFUTR,U,11) S PSBHDR(2)="Include Action(s)"_$S(PSBCFLG:" & Comments/Reasons",1:"")
"RTN","PSBOCI",175,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR)
"RTN","PSBOCI",176,0)
 Q
"RTN","PSBOCI",177,0)
SUBHDR ;
"RTN","PSBOCI",178,0)
 N PSBAL S PSBAL=$O(PSBHDR("ALERGY",""),-1) S PSBAL=$S((PSBAL/12)>(PSBAL\12):(PSBAL\12)+1,1:(PSBAL\12))
"RTN","PSBOCI",179,0)
 N PSBRE S PSBRE=$O(PSBHDR("REAC",""),-1) S PSBRE=$S((PSBRE/12)>(PSBRE\12):(PSBRE\12)+1,1:(PSBRE\12))
"RTN","PSBOCI",180,0)
 S PSBLNTOT=$O(PSBHDR(""),-1)+9+PSBAL+PSBRE+1
"RTN","PSBOCI",181,0)
 I $G(PSBPGNUM,0)=1 W !,?(PSBTAB7-($L("Total Items reported: "_+PSBTOT))),"Total Items reported: "_+PSBTOT,! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCI",182,0)
 W !,$TR($J("",PSBTAB7)," ","_") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCI",183,0)
 W !,$G(PSBHD1,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCI",184,0)
 W !,$G(PSBHD2,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCI",185,0)
 W !,$TR($J("",PSBTAB7)," ","="),! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCI",186,0)
 I $D(NOTE(PSBPGNUM)) W NOTE(PSBPGNUM),!! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCI",187,0)
 Q
"RTN","PSBOCI",188,0)
PGTOT(X) ;PG Nmbr
"RTN","PSBOCI",189,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCI",190,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCI",191,0)
 Q PSBPGNUM
"RTN","PSBOCI",192,0)
CREATHDR ;
"RTN","PSBOCI",193,0)
 K PSBHD1,PSBHD2
"RTN","PSBOCI",194,0)
 I IOM'<132 S PSBHD1=$P($T(HD132A),"~",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(C132BLK),";",2)
"RTN","PSBOCI",195,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" K PSBLIST2 Q
"RTN","PSBOCI",196,0)
 ; tabs
"RTN","PSBOCI",197,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOCI",198,0)
 S PSBPGNUM=1
"RTN","PSBOCI",199,0)
 D HDR
"RTN","PSBOCI",200,0)
 Q
"RTN","PSBOCI",201,0)
HD132A ;~    Bag ID     |    Order    |       Bag       |   Medication; Infusion Rate, Route  | Bag Info |    Order Start  |    Order Stop  |
"RTN","PSBOCI",202,0)
 Q
"RTN","PSBOCI",203,0)
HD132B ;               |    Status   |     Status      |                                     |          |     Date        |      Date      |
"RTN","PSBOCI",204,0)
 Q
"RTN","PSBOCI",205,0)
C132BLK ;;                |            |                 |                                     |          |                 |                |
"RTN","PSBOCI",206,0)
 Q
"RTN","PSBOCM")
0^4^B85413465^B76599407
"RTN","PSBOCM",1,0)
PSBOCM ;BIRMINGHAM/TEJ-COVERSHEET MEDICATION OVERVIEW REPORT ;1/11/12 2:03pm
"RTN","PSBOCM",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,50,68**;Mar 2004;Build 26
"RTN","PSBOCM",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCM",4,0)
 ;
"RTN","PSBOCM",5,0)
 ; Reference/IA
"RTN","PSBOCM",6,0)
 ; File 4/10090
"RTN","PSBOCM",7,0)
 ; File 200/10060
"RTN","PSBOCM",8,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOCM",9,0)
 ; 
"RTN","PSBOCM",10,0)
 ;*68 - allow SIOPI builder to accomodate more than 1 line in SI array
"RTN","PSBOCM",11,0)
 ;
"RTN","PSBOCM",12,0)
EN ;
"RTN","PSBOCM",13,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR,QQ
"RTN","PSBOCM",14,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOCM",15,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG)=""        ;  Order Status search criteria - "A"ctive, "D"C ed, "E"xpired"
"RTN","PSBOCM",16,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"D" S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"E" S:$P(PSBFUTR,U,5) PSBOCRIT=PSBOCRIT_"A"
"RTN","PSBOCM",17,0)
 S:$P(PSBFUTR,U,4) PSBOCRIT=PSBOCRIT_"F"
"RTN","PSBOCM",18,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCM",19,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCM",20,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD,PSBHDR,PSBSTS
"RTN","PSBOCM",21,0)
 S PSBSORT=1
"RTN","PSBOCM",22,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=$E(Y,1,18)
"RTN","PSBOCM",23,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCM",24,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCM",25,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCM",26,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCM",27,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCM",28,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSBX1X)=""
"RTN","PSBOCM",29,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCM",30,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCM",31,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCM",32,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCM",33,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCM",34,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X)
"RTN","PSBOCM",35,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCM",36,0)
 .S PSBX2X=1
"RTN","PSBOCM",37,0)
 .S PSBLIST2("ACTIVE")=0,PSBLIST2("FUTURE")=0,PSBLIST2("EXPIRED/DC'd")=0,PSBLIST2(" * ERROR * ")=0
"RTN","PSBOCM",38,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCM",39,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCM",40,0)
 ..I $P(PSBDATA,U)="ORD" D  Q
"RTN","PSBOCM",41,0)
 ...K PSBDRUGN
"RTN","PSBOCM",42,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCM",43,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCM",44,0)
 ...S PSBTB(PSBORDN,PSBTB)=""
"RTN","PSBOCM",45,0)
 ...S PSBSTS=$P(PSBDATA,U,23) S PSBSTS=$S((PSBSTS="A")&(($P(PSBDATA,U,27)>PSBNOWX)):"Active",PSBSTS="H":"On Hold",PSBSTS="D":"Discontinued",PSBSTS="DE":"Discontinued (Edit)",(PSBSTS="E")!($P(PSBDATA,U,27)'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCM",46,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCM",47,0)
 ...S PSBSTSX=$S($P(PSBDATA,U,27)'>PSBNOWX:"EXPIRED/DC'd",$$FMADD^XLFDT($P(PSBDATA,U,22),,,-PSBB4)'>PSBNOWX:"ACTIVE",$P(PSBDATA,U,22)>$$FMADD^XLFDT(PSBNOWX,,,PSBB4):"FUTURE",1:" * ERROR * ")
"RTN","PSBOCM",48,0)
 ...S PSBLIST2(PSBSTSX,$P(PSBDATA,U,9),PSBORDN)="" S PSBLIST2(PSBSTSX)=PSBLIST2(PSBSTSX)+1
"RTN","PSBOCM",49,0)
 ...S:PSBOCRIT[$E(PSBSTSX,1) PSBTOT=PSBTOT+1
"RTN","PSBOCM",50,0)
 ...S PSBSCHTY=$P(PSBDATA,U,6)
"RTN","PSBOCM",51,0)
 ...I PSBTB="IV" S PSBSCHTY=" "
"RTN","PSBOCM",52,0)
 ...S PSBSCHTY(PSBORDN,PSBSCHTY)=""
"RTN","PSBOCM",53,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCM",54,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCM",55,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)="" K PSBOMDR(PSBORDN)
"RTN","PSBOCM",56,0)
 ...S PSBSCHD=$P(PSBDATA,U,7) I PSBSCHD="" S PSBSCHD=" "
"RTN","PSBOCM",57,0)
 ...S PSBSCHD(PSBORDN,PSBSCHD)=""
"RTN","PSBOCM",58,0)
 ...S PSBNXTX1=$$NEXTADM^PSBCSUTX(PSBX1X,PSBORDN)
"RTN","PSBOCM",59,0)
 ...I PSBSTS["Hold" S PSBNXTX2="Provider Hold"
"RTN","PSBOCM",60,0)
 ...I PSBSTS'["Hold",(PSBNXTX1]"") D
"RTN","PSBOCM",61,0)
 ....I PSBNOWX>$$FMADD^XLFDT(PSBNXTX1,,,PSBAFT) S PSBNXTX2="MISSED "_PSBNXTX1
"RTN","PSBOCM",62,0)
 ....E  S:+PSBNXTX1>0 PSBNXTX2="DUE "_PSBNXTX1
"RTN","PSBOCM",63,0)
 ...S PSBNXTX1=$$FMTDT^PSBOCE1(PSBNXTX1)
"RTN","PSBOCM",64,0)
 ...I ("^P^OC^O"[("^"_PSBSCHTY))!(PSBTB="IV")!(PSBSTS["Discontinued")!(PSBSTS["Expired") S:PSBSTS'["Hold" PSBNXTX2=" "
"RTN","PSBOCM",65,0)
 ...S PSBNXTX(PSBORDN,$G(PSBNXTX2," "))=""
"RTN","PSBOCM",66,0)
 ...; ** SPECIAL INSTRUCTIONS  **
"RTN","PSBOCM",67,0)
 ...S PSBX2X=PSBX2X+1
"RTN","PSBOCM",68,0)
 ...;  *68
"RTN","PSBOCM",69,0)
 ...K ^TMP("PSJBCMA5",$J)
"RTN","PSBOCM",70,0)
 ...I PSBSIFLG D GETSIOPI^PSJBCMA5(PSBX1X,PSBORDN,1)
"RTN","PSBOCM",71,0)
 ...F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)) Q:'QQ  D
"RTN","PSBOCM",72,0)
 ....S PSBSI(PSBORDN,QQ)=^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)
"RTN","PSBOCM",73,0)
 ...;  *68 end
"RTN","PSBOCM",74,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCM",75,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCM",76,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCM",77,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCM",78,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA(PSBX2X),U)) D  Q
"RTN","PSBOCM",79,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCM",80,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCM",81,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCM",82,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCM",83,0)
 ..I $P(PSBDATA,U)="END" Q
"RTN","PSBOCM",84,0)
 ..I $P(PSBDATA(PSBX2X),U)="ORF" D  Q
"RTN","PSBOCM",85,0)
 ...S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCM",86,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCM",87,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D
"RTN","PSBOCM",88,0)
 ...S PSBXID=$P(PSBDATA,U,6)_U_$P(PSBDATA,U,4),PSBADM(PSBORDN,(-1*($P(PSBDATA,U,6))),PSBXID)=PSBDATA
"RTN","PSBOCM",89,0)
 ...S PSBTEST="" F  S PSBTEST=$O(PSBFLGD(PSBORDN,PSBTEST)) Q:PSBTEST=""  I $P(PSBTEST,":")="NOX" K PSBFLGD(PSBORDN,PSBTEST) Q
"RTN","PSBOCM",90,0)
 ...I $O(PSBSCHTY(PSBORDN,""))="P" S PSBPRNR(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,9)
"RTN","PSBOCM",91,0)
 ...I $P(PSBDATA,U,3)]"" S PSBBID(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,3)
"RTN","PSBOCM",92,0)
 ...S:PSBXFLG PSBLGD(PSBORDN,"X","INITIALS",$P(PSBDATA,U,8))=""
"RTN","PSBOCM",93,0)
 ...K PSBDATA(PSBX2X)
"RTN","PSBOCM",94,0)
 ...I ($P(PSBDATA(PSBX2X+1),U)="CMT")  F  S PSBDATA=PSBDATA(PSBX2X+1) Q:($P(PSBDATA,U)'="CMT")  D
"RTN","PSBOCM",95,0)
 ....S PSBX2X=PSBX2X+1
"RTN","PSBOCM",96,0)
 ....S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCM",97,0)
 ....K PSBDATA(PSBX2X)
"RTN","PSBOCM",98,0)
 ....S:$P(PSBDATA,U,3)]"" PSBPRNEF(PSBORDN,$P(PSBXID,U,2))=$P(PSBDATA,U,3)
"RTN","PSBOCM",99,0)
 ....I 'PSBCFLG S PSBDATA=PSBDATA(PSBX2X+1) Q
"RTN","PSBOCM",100,0)
 ....I $P(PSBDATA,U,2)'="" D
"RTN","PSBOCM",101,0)
 .....S PSBLGD(PSBORDN,"C","INITIALS",$P(PSBDATA,U,4))=""
"RTN","PSBOCM",102,0)
 .....S PSBCMT(PSBORDN,$P(PSBXID,U,2),(-1*$P(PSBDATA,U,6)),PSBX2X)=PSBDATA
"RTN","PSBOCM",103,0)
 I +PSBTOT=0 K PSBLIST,^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCM",104,0)
 D CREATHDR^PSBOCM1
"RTN","PSBOCM",105,0)
 D SUBHDR^PSBOCE
"RTN","PSBOCM",106,0)
 D BLDRPT
"RTN","PSBOCM",107,0)
 D WRTRPT^PSBOCM1
"RTN","PSBOCM",108,0)
 K ^TMP("PSJBCMA5",$J)    ;*68
"RTN","PSBOCM",109,0)
 Q
"RTN","PSBOCM",110,0)
BLDRPT ; Buld REPORT DATA
"RTN","PSBOCM",111,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCM",112,0)
 K PSBL2ULN
"RTN","PSBOCM",113,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCM",114,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCM",115,0)
 S PSBMORE=5 F PSBX1X="ACTIVE","FUTURE","EXPIRED/DC'd"," * ERROR * " D
"RTN","PSBOCM",116,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_$S(PSBLIST2(PSBX1X)=1:" Order",1:" Orders")_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCM",117,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCM",118,0)
 .Q:PSBOCRIT'[$E(PSBX1X,1)
"RTN","PSBOCM",119,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCM",120,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCM",121,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCM",122,0)
 .K PSBDATA
"RTN","PSBOCM",123,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCM",124,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCM",125,0)
 ..M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"X","INITIALS") M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"C","INITIALS")
"RTN","PSBOCM",126,0)
 ..S PSBDATA(1,1)=$O(PSBTB(PSBX2X,""))
"RTN","PSBOCM",127,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCM",128,0)
 ..S PSBDATA(1,3)=$O(PSBSCHTY(PSBX2X,""))
"RTN","PSBOCM",129,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCM",130,0)
 ..S PSBDATA(1,5)=$O(PSBSCHD(PSBX2X,""))
"RTN","PSBOCM",131,0)
 ..S PSBDATA(1,6)=$O(PSBNXTX(PSBX2X,""))
"RTN","PSBOCM",132,0)
 ..S:PSBDATA(1,6)'["Hold" $P(PSBDATA(1,6)," ",2)=$$FMTDT^PSBOCE1($P(PSBDATA(1,6)," ",2))
"RTN","PSBOCM",133,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCM",134,0)
 ..S PSBDATA(1,8)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCM",135,0)
 ..K PSBSIDAT M PSBSIDAT=PSBSI(PSBX2X)               ;*68
"RTN","PSBOCM",136,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCM",137,0)
 ..K PSBDATA(2),PSBDATA(3),PSBSILN
"RTN","PSBOCM",138,0)
 ..D BUILDLN^PSBOCM1,SIOPI(.PSBSIDAT,PSBTAB8,$S(PSBX2X["V":"Other Print Info: ",1:""))
"RTN","PSBOCM",139,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCM",140,0)
 ..K PSB1,X I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCM",141,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCM",142,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCM",143,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCM",144,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCM",145,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCM",146,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCM",147,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOCM",148,0)
 ..K PSBRPLN,PSBDATA,PSBSILN
"RTN","PSBOCM",149,0)
 D:+PSBTOT>0 LGD
"RTN","PSBOCM",150,0)
 Q
"RTN","PSBOCM",151,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOCM",152,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCM",153,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCM",154,0)
 Q PSBPGNUM
"RTN","PSBOCM",155,0)
SIOPI(PSBXSI,TAB,Y) ;create SIOPI text
"RTN","PSBOCM",156,0)
 ;  *68 - modified this tag to handle only WP extra lines
"RTN","PSBOCM",157,0)
 Q:$O(PSBXSI(""))=""
"RTN","PSBOCM",158,0)
 ;
"RTN","PSBOCM",159,0)
 N X,LBL,LBLLN,RMAR,TXT
"RTN","PSBOCM",160,0)
 I $G(Y)="" S Y="Special Instructions: "
"RTN","PSBOCM",161,0)
 ; build label for SI field, then check $L to make a right margin
"RTN","PSBOCM",162,0)
 S LBL="  "_Y
"RTN","PSBOCM",163,0)
 S LBLLN=$L(LBL),RMAR="",$P(RMAR," ",LBLLN+1)=""  ;make margin of " "
"RTN","PSBOCM",164,0)
 K J,TXT,TXT1,TXT2 S J(0)=""
"RTN","PSBOCM",165,0)
 S J=($O(J(""),-1)+1) S PSBSILN(J)="",J(J)="" S J=($O(J(""),-1)+1)
"RTN","PSBOCM",166,0)
 F X=0:0 S X=$O(PSBXSI(X)) Q:'X  D
"RTN","PSBOCM",167,0)
 .I X=1 S TXT=LBL_PSBXSI(X)    ;put label & 1st line together
"RTN","PSBOCM",168,0)
 .E  S TXT=RMAR_PSBXSI(X)      ;all other lines add rmar
"RTN","PSBOCM",169,0)
 .S TXT1=TXT
"RTN","PSBOCM",170,0)
 .I ($L(TXT1)>0),$F(TXT1,"""")>1 D
"RTN","PSBOCM",171,0)
 ..S TXT1=$TR(TXT1,"""","^")
"RTN","PSBOCM",172,0)
 ..I $L(TXT1)+5'<TAB S TXT2=$E(TXT1,TAB-9,999),TXT1=$E(TXT1,1,TAB-10)
"RTN","PSBOCM",173,0)
 ..I $L(TXT1,"^")>1 F Y=1:1:$L(TXT1,"^")-1 S $P(TXT1,"^",Y)=$P(TXT1,"^",Y)_""""
"RTN","PSBOCM",174,0)
 ..I $D(TXT2) I $L(TXT2,"^")>1 F X=1:1:$L(TXT2,"^")-1 S $P(TXT2,"^",X)=$P(TXT2,"^",X)_""""
"RTN","PSBOCM",175,0)
 ..S TXT1=$TR(TXT1,"^","""") I $D(TXT2) S TXT2=$TR(TXT2,"^","""")
"RTN","PSBOCM",176,0)
 .S $E(PSBSILN(J),5,999)=TXT1,J(J)="",J=J+1
"RTN","PSBOCM",177,0)
 .I $D(TXT2) S $E(PSBSILN(J),5,999)=TXT2,J(J)="",J=J+1
"RTN","PSBOCM",178,0)
 S $E(PSBSILN(J),3,999)=" ",J(J)="",J=J+1
"RTN","PSBOCM",179,0)
 Q
"RTN","PSBOCM",180,0)
LGD ; Create Report's Legend
"RTN","PSBOCM",181,0)
 K PSBLGDO
"RTN","PSBOCM",182,0)
 S PSBLGD("ORDER TYPES","C")="Continuous"
"RTN","PSBOCM",183,0)
 S PSBLGD("ORDER TYPES","O")="One Time"
"RTN","PSBOCM",184,0)
 S PSBLGD("ORDER TYPES","OC")="On Call"
"RTN","PSBOCM",185,0)
 S PSBLGD("ORDER TYPES","P")="PRN"
"RTN","PSBOCM",186,0)
 S PSB=0 F  S PSB=$O(PSBLGD("INITIALS",PSB)) Q:+PSB=0  D
"RTN","PSBOCM",187,0)
 .S PSBINIT=$$GET1^DIQ(200,PSB_",","INITIAL"),PSBLGD("INITIALS",$S(PSBINIT']" ":"*n/a*",1:PSBINIT))=$$GET1^DIQ(200,PSB_",","NAME")
"RTN","PSBOCM",188,0)
 .K PSBLGD("INITIALS",PSB)
"RTN","PSBOCM",189,0)
 S PSBPGNUM=$O(PSBOUTP(""),-1),PSBLGDO(0)="REPORT LEGEND"
"RTN","PSBOCM",190,0)
 S PSBLGDO(1)=""
"RTN","PSBOCM",191,0)
 S PSBLGDO(2)=$S($G(PSBNO,0):"",1:"SCHEDULE TYPES")
"RTN","PSBOCM",192,0)
 S PSBLGDO(3)=""
"RTN","PSBOCM",193,0)
 I '$G(PSBNO,0) S X1="",X2=3 F  S X1=$O(PSBLGD("ORDER TYPES",X1)) Q:X1=""  S X2=X2+1,PSBLGDO(X2)=X1,$E(PSBLGDO(X2),5)="- "_PSBLGD("ORDER TYPES",X1)
"RTN","PSBOCM",194,0)
 I $D(PSBLGD("INITIALS")) S $E(PSBLGDO(2),35)="INITIALS" S X1="",X2=3 F  S X1=$O(PSBLGD("INITIALS",X1)) Q:X1=""  S X2=X2+1,$E(PSBLGDO(X2),35)=X1,$E(PSBLGDO(X2),40)="- "_PSBLGD("INITIALS",X1)
"RTN","PSBOCM",195,0)
 S (PSBMORE,X0)=10+($O(PSBLGDO(""),-1))
"RTN","PSBOCM",196,0)
 I (PSBLNTOT+PSBMORE)'<IOSL S PSBLNTOT=PSBTOPHD-2,PSBPGNUM=PSBPGNUM+1
"RTN","PSBOCM",197,0)
 I IOSL<1000 S X2=PSBLNTOT F  Q:X2'<(IOSL-(X0+3))  S PSBOUTP($$PGTOT,PSBLNTOT)="W !",X2=X2+1
"RTN","PSBOCM",198,0)
 S PSBMORE=X0
"RTN","PSBOCM",199,0)
 S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,"""_$TR($J("",IOM)," ","=")_""",!"
"RTN","PSBOCM",200,0)
 F X1=0:1 Q:'$D(PSBLGDO(X1))  S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_$G(PSBLGDO(X1)," ")_""""
"RTN","PSBOCM",201,0)
 S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,"""_$TR($J("",IOM)," ","=")_""",!"
"RTN","PSBOCM",202,0)
 Q
"RTN","PSBOCP")
0^11^B82953642^B77940079
"RTN","PSBOCP",1,0)
PSBOCP ;BIRMINGHAM/TEJ-COVERSHEET PRN OVERVIEW REPORT ;1/10/12 8:42pm
"RTN","PSBOCP",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,50,68**;Mar 2004;Build 26
"RTN","PSBOCP",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCP",4,0)
 ;
"RTN","PSBOCP",5,0)
 ; Reference/IA
"RTN","PSBOCP",6,0)
 ; File 4/10090
"RTN","PSBOCP",7,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOCP",8,0)
 ;
"RTN","PSBOCP",9,0)
 ;*68 - allow SIOPI builder to accomodate more than 1 line in SI array
"RTN","PSBOCP",10,0)
 ;
"RTN","PSBOCP",11,0)
EN ; Entry Point
"RTN","PSBOCP",12,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR,QQ
"RTN","PSBOCP",13,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOCP",14,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG)=""        ;  Order Status search criteria - "A"ctive, "D"C ed, "E"xpired"
"RTN","PSBOCP",15,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"D" S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"E" S:$P(PSBFUTR,U,5) PSBOCRIT=PSBOCRIT_"A"
"RTN","PSBOCP",16,0)
 S:$P(PSBFUTR,U,4) PSBOCRIT=PSBOCRIT_"F"
"RTN","PSBOCP",17,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCP",18,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCP",19,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD
"RTN","PSBOCP",20,0)
 S PSBSORT=1
"RTN","PSBOCP",21,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=Y
"RTN","PSBOCP",22,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCP",23,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCP",24,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCP",25,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCP",26,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCP",27,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSBX1X)=""
"RTN","PSBOCP",28,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCP",29,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCP",30,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCP",31,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCP",32,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCP",33,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X)
"RTN","PSBOCP",34,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCP",35,0)
 .S PSBX2X=1
"RTN","PSBOCP",36,0)
 .S (PSBLIST2("ACTIVE"),PSBLIST2("FUTURE"),PSBLIST2("EXPIRED/DC'd"),PSBLIST2(" * ERROR * "))=0
"RTN","PSBOCP",37,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCP",38,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCP",39,0)
 ..I ($P(PSBDATA,U)="ORD") I $P(PSBDATA,U,6)'="P" F  S PSBX2X=$O(PSBDATA(PSBX2X)) S PSBDATA=PSBDATA(PSBX2X) Q:$P(PSBDATA,U)="END"
"RTN","PSBOCP",40,0)
 ..I ($P(PSBDATA,U)="ORD") K PSBORDN  D  Q
"RTN","PSBOCP",41,0)
 ...K PSBDRUGN
"RTN","PSBOCP",42,0)
 ...S PSBSCHTY="P"
"RTN","PSBOCP",43,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCP",44,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCP",45,0)
 ...S PSBTB(PSBORDN,PSBTB)=""
"RTN","PSBOCP",46,0)
 ...S PSBSTS1=$P(PSBDATA,U,23)
"RTN","PSBOCP",47,0)
 ...S PSBSTS=$S((PSBSTS1="A")&(($P(PSBDATA,U,27)>PSBNOWX)):"Active",PSBSTS1="H":"Hold",PSBSTS1="D":"Discontinued",PSBSTS1="DE":"Discontinued (Edit)",(PSBSTS1="E")!($P(PSBDATA,U,27)'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCP",48,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCP",49,0)
 ...S V=$$FMADD^XLFDT(PSBNOWX,,,PSBB4)
"RTN","PSBOCP",50,0)
 ...S PSBSTSX=$S($P(PSBDATA,U,27)'>PSBNOWX:"EXPIRED/DC'd",$P(PSBDATA,U,22)'>V:"ACTIVE",V:"FUTURE",1:" * ERROR * ")
"RTN","PSBOCP",51,0)
 ...S PSBLIST2(PSBSTSX,$P(PSBDATA,U,9),PSBORDN)="" S PSBLIST2(PSBSTSX)=PSBLIST2(PSBSTSX)+1
"RTN","PSBOCP",52,0)
 ...S:PSBOCRIT[$E(PSBSTSX,1) PSBTOT=PSBTOT+1
"RTN","PSBOCP",53,0)
 ...S PSBSCHTY(PSBORDN,PSBSCHTY)=""
"RTN","PSBOCP",54,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCP",55,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCP",56,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)=""
"RTN","PSBOCP",57,0)
 ...S PSBLSTG=$P(PSBDATA,U,28)
"RTN","PSBOCP",58,0)
 ...I PSBLSTG]"" S PSBLSTG(PSBORDN,$$FMTDT^PSBOCE1($E(PSBLSTG,1,12)))=""
"RTN","PSBOCP",59,0)
 ...S PSBLSTX=$S(PSBLSTG]"":$$LSTX(PSBLSTG,PSBNOWX),1:" ")
"RTN","PSBOCP",60,0)
 ...S PSBLSTX(PSBORDN,PSBLSTX)=""
"RTN","PSBOCP",61,0)
 ...; ** SPECIAL INSTRUCTIONS  **
"RTN","PSBOCP",62,0)
 ...S PSBX2X=PSBX2X+1
"RTN","PSBOCP",63,0)
 ...;  *68
"RTN","PSBOCP",64,0)
 ...K ^TMP("PSJBCMA5",$J)
"RTN","PSBOCP",65,0)
 ...I PSBSIFLG D GETSIOPI^PSJBCMA5(PSBX1X,PSBORDN,1)
"RTN","PSBOCP",66,0)
 ...F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)) Q:'QQ  D
"RTN","PSBOCP",67,0)
 ....S PSBSI(PSBORDN,QQ)=^TMP("PSJBCMA5",$J,PSBX1X,PSBORDN,QQ)
"RTN","PSBOCP",68,0)
 ...;  *68 end
"RTN","PSBOCP",69,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCP",70,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCP",71,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCP",72,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCP",73,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCP",74,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA(PSBX2X),U)) D  Q
"RTN","PSBOCP",75,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCP",76,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCP",77,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCP",78,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCP",79,0)
 ..I $P(PSBDATA,U)="END" Q
"RTN","PSBOCP",80,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCP",81,0)
 ..I $P(PSBDATA(PSBX2X),U)="ORF" D  Q
"RTN","PSBOCP",82,0)
 ...S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCP",83,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCP",84,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCP",85,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D  Q
"RTN","PSBOCP",86,0)
 ...S PSBXID=$P(PSBDATA,U,6)_U_$P(PSBDATA,U,4),PSBADM(PSBORDN,(-1*($P(PSBDATA,U,6))),PSBXID)=PSBDATA
"RTN","PSBOCP",87,0)
 ...I $O(PSBSCHTY(PSBORDN,""))="P" S PSBPRNR(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,9)
"RTN","PSBOCP",88,0)
 ...I $P(PSBDATA,U,3)]"" S PSBBID(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,3)
"RTN","PSBOCP",89,0)
 ...S:PSBXFLG PSBLGD(PSBORDN,"X","INITIALS",$P(PSBDATA,U,8))=""
"RTN","PSBOCP",90,0)
 ...I $P(PSBDATA(PSBX2X+1),U)="CMT"  S PSBX2X=PSBX2X+1 F PSBX3X=PSBX2X:1 S PSBDATA=PSBDATA(PSBX3X) Q:($P(PSBDATA,U)'="CMT")  D
"RTN","PSBOCP",91,0)
 ....S PSBX2X=PSBX3X
"RTN","PSBOCP",92,0)
 ....I $P(PSBDATA,U,3)]"" S PSBPRNEF(PSBORDN,$P(PSBXID,U,2))=$P(PSBDATA,U,3)
"RTN","PSBOCP",93,0)
 ....I PSBCFLG I $P(PSBDATA,U,2)'="" S PSBLGD(PSBORDN,"C","INITIALS",$P(PSBDATA,U,4))="",PSBCMT(PSBORDN,$P(PSBXID,U,2),(-1*$P(PSBDATA,U,6)),PSBX2X)=PSBDATA
"RTN","PSBOCP",94,0)
 I +PSBTOT=0 K PSBLIST,^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCP",95,0)
 D CREATHDR^PSBOCP1
"RTN","PSBOCP",96,0)
 D SUBHDR^PSBOCE
"RTN","PSBOCP",97,0)
 D BLDRPT
"RTN","PSBOCP",98,0)
 D WRTRPT^PSBOCP1
"RTN","PSBOCP",99,0)
 Q
"RTN","PSBOCP",100,0)
BLDRPT ; Buld REPORT DATA
"RTN","PSBOCP",101,0)
 K PSBL2ULN
"RTN","PSBOCP",102,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCP",103,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCP",104,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCP",105,0)
 S PSBMORE=5 F PSBX1X="ACTIVE","FUTURE","EXPIRED/DC'd"," * ERROR * " D
"RTN","PSBOCP",106,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_$S(PSBLIST2(PSBX1X)=1:" Order",1:" Orders")_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCP",107,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCP",108,0)
 .Q:PSBOCRIT'[$E(PSBX1X,1)
"RTN","PSBOCP",109,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCP",110,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCP",111,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCP",112,0)
 .K PSBDATA
"RTN","PSBOCP",113,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCP",114,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCP",115,0)
 ..M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"X","INITIALS") M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"C","INITIALS")
"RTN","PSBOCP",116,0)
 ..S PSBDATA(1,1)=$O(PSBTB(PSBX2X,""))
"RTN","PSBOCP",117,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCP",118,0)
 ..S PSBDATA(1,3)=$O(PSBSCHTY(PSBX2X,""))
"RTN","PSBOCP",119,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCP",120,0)
 ..S PSBDATA(1,5)=$O(PSBLSTG(PSBX2X,""))
"RTN","PSBOCP",121,0)
 ..S PSBDATA(1,6)=$O(PSBLSTX(PSBX2X,""))
"RTN","PSBOCP",122,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCP",123,0)
 ..S PSBDATA(1,8)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCP",124,0)
 ..K PSBSIDAT M PSBSIDAT=PSBSI(PSBX2X)                  ;*68
"RTN","PSBOCP",125,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCP",126,0)
 ..K PSBDATA(2),PSBDATA(3),PSBSILN
"RTN","PSBOCP",127,0)
 ..D BUILDLN,SIOPI^PSBOCM(.PSBSIDAT,PSBTAB8,$S(PSBX2X["V":"Other Print Info:",1:""))
"RTN","PSBOCP",128,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCP",129,0)
 ..K PSB1 I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCP",130,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCP",131,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCP",132,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCP",133,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCP",134,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCP",135,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCP",136,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOCP",137,0)
 ..K PSBRPLN,PSBDATA
"RTN","PSBOCP",138,0)
 D:+PSBTOT>0 LGD^PSBOCM
"RTN","PSBOCP",139,0)
 Q
"RTN","PSBOCP",140,0)
BUILDLN ; Constr recs
"RTN","PSBOCP",141,0)
 K J S J(0)="" F PSBFLD=1:1:8 S J=1 D FORMDAT(PSBFLD) S J($O(PSBRPLN(""),-1))=""
"RTN","PSBOCP",142,0)
 ; Write administration info...
"RTN","PSBOCP",143,0)
 Q:'PSBXFLG
"RTN","PSBOCP",144,0)
 S J=($O(J(""),-1)+1),PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCP",145,0)
 S (N,Y)=""
"RTN","PSBOCP",146,0)
 F  S Y=$O(PSBADM(PSBX2X,Y)) Q:Y']""  D
"RTN","PSBOCP",147,0)
 .F  S N=$O(PSBADM(PSBX2X,Y,N)) Q:N']""  D
"RTN","PSBOCP",148,0)
 ..N PSBEIECMT S PSBEIECMT="" I $D(PSBPRNEF(PSBX2X,$P(N,U,2))),$P($G(PSBRPT(.2)),U,8)=0 S PSBEIECMT=$$PRNEFF^PSBO(PSBEIECMT,$P(N,U,2))
"RTN","PSBOCP",149,0)
 ..I $D(PSBBID(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="BAG ID: "_PSBBID(PSBX2X,$P(N,U,2))
"RTN","PSBOCP",150,0)
 ..S $E(PSBDATA(2,0),25)="ACTION BY: "_$P(PSBADM(PSBX2X,Y,N),U,7)_" "_$$FMTDT^PSBOCE1($E($P(PSBADM(PSBX2X,Y,N),U,6),1,12))
"RTN","PSBOCP",151,0)
 ..S X=$P(PSBADM(PSBX2X,Y,N),U,5) S $E(PSBDATA(2,0),56)="ACTION: "_$S(X="G":"GIVEN",X="R":"REFUSED",X="RM":"REMOVED",X="H":"HELD",X="S":"STOPPED",X="I":"INFUSING",X="C":"COMPLETED",X="M":"MISSING DOSE",X=" ":"*UNKNOWN*",1:" ")
"RTN","PSBOCP",152,0)
 ..I $D(PSBPRNR(PSBX2X)) S $E(PSBDATA(2,0),72)="PRN REASON: "_PSBPRNR(PSBX2X,$P(N,U,2))
"RTN","PSBOCP",153,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(1,132-1,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCP",154,0)
 ..I $D(PSBPRNEF(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="PRN EFFECTIVENESS: "_PSBPRNEF(PSBX2X,$P(N,U,2))_PSBEIECMT
"RTN","PSBOCP",155,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCP",156,0)
 ..I ('PSBCFLG)!('$D(PSBCMT(PSBX2X,$P(N,U,2)))) S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1 Q
"RTN","PSBOCP",157,0)
 ..S X="" F   S X=$O(PSBCMT(PSBX2X,$P(N,U,2),X)) Q:X']""  D
"RTN","PSBOCP",158,0)
 ...N PSBDAT S PSBDAT="" F  S PSBDAT=$O(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT)) Q:PSBDAT']""  D
"RTN","PSBOCP",159,0)
 ....S PSBDATA(2,0)="COMMENT BY: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,5)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,5)_" "_$$FMTDT^PSBOCE1($E($P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,6),1,12)),1:" n/a ")
"RTN","PSBOCP",160,0)
 ....S PSBDATA(2,0)=PSBDATA(2,0)_"  COMMENT: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,2)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X,PSBDAT),U,2),1:" ")
"RTN","PSBOCP",161,0)
 ....I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCP",162,0)
 ..S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCP",163,0)
 Q
"RTN","PSBOCP",164,0)
FORMDAT(FLD) ;
"RTN","PSBOCP",165,0)
 K PSBVAL
"RTN","PSBOCP",166,0)
 Q:'$D(PSBDATA(1,FLD))
"RTN","PSBOCP",167,0)
 S PSBVAL=PSBDATA(1,FLD)
"RTN","PSBOCP",168,0)
 D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCP",169,0)
 I FLD=4 S J=$O(J(""),-1)+1,PSBVAL=PSBDATA(1,4,0) D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCP",170,0)
 Q
"RTN","PSBOCP",171,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOCP",172,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCP",173,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCP",174,0)
 Q PSBPGNUM
"RTN","PSBOCP",175,0)
WRAPPER(X,Y,Z) ;  Text WRAP
"RTN","PSBOCP",176,0)
 N PSB
"RTN","PSBOCP",177,0)
 I ($L(Z)>0),$F(Z,"""")>1 F  Q:$F(Z,"""")'>1  S Z=$TR(Z,"""","^")
"RTN","PSBOCP",178,0)
 F  Q:'$L(Z)  D
"RTN","PSBOCP",179,0)
 .I $L(Z)<Y S $E(PSBRPLN(J),X)=Z S Z="" Q
"RTN","PSBOCP",180,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBOCP",181,0)
 .S:PSB<1 PSB=Y
"RTN","PSBOCP",182,0)
 .S $E(PSBRPLN(J),X)=$E(Z,1,PSB)
"RTN","PSBOCP",183,0)
 .I $L(PSBRPLN(J),"^")>1 F X=1:1:$L(PSBRPLN(J),"^")-1 S $P(PSBRPLN(J),"^",X)=$P(PSBRPLN(J),"^",X)_""""
"RTN","PSBOCP",184,0)
 .S PSBRPLN(J)=$TR(PSBRPLN(J),"^","""")
"RTN","PSBOCP",185,0)
 .S Z=$E(Z,PSB+1,250),J=J+1,J(J)=""
"RTN","PSBOCP",186,0)
 Q ""
"RTN","PSBOCP",187,0)
LSTX(P,O) ;
"RTN","PSBOCP",188,0)
 S DT=$$FMDIFF^XLFDT(O,P,2)
"RTN","PSBOCP",189,0)
 I ((DT\60)<1) Q "0d 0h 1m"
"RTN","PSBOCP",190,0)
 S D=(DT\(60*60*24)) S DT=DT-(D*(60*60*24))
"RTN","PSBOCP",191,0)
 S H=(DT\(60*60)) S DT=DT-(H*(60*60))
"RTN","PSBOCP",192,0)
 S M=((DT+30)\(60)) S DT=DT-(M*(60))
"RTN","PSBOCP",193,0)
 Q D_"d "_H_"h "_M_"m"
"RTN","PSBODL")
0^12^B85139144^B80947318
"RTN","PSBODL",1,0)
PSBODL ;BIRMINGHAM/EFC-DUE LIST ;1/10/12 8:47pm
"RTN","PSBODL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,9,38,32,25,63,68**;Mar 2004;Build 26
"RTN","PSBODL",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified. 
"RTN","PSBODL",4,0)
 ;
"RTN","PSBODL",5,0)
 ; Reference/IA
"RTN","PSBODL",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBODL",7,0)
 ; $$GET^XPAR/2263
"RTN","PSBODL",8,0)
 ; ^XLFDT/10103
"RTN","PSBODL",9,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBODL",10,0)
 ;
"RTN","PSBODL",11,0)
 ;*68 - add call to retrieve New WP Special Instructions/OPI fields
"RTN","PSBODL",12,0)
 ;
"RTN","PSBODL",13,0)
EN ; Prt DL
"RTN","PSBODL",14,0)
 N PSBGBL,PSBHDR,IOINHI,IOINORM,PSBGIVEN,PSBIEN,PSBLGDT,PSBEVDT,DFN,PSBFLAG
"RTN","PSBODL",15,0)
 S X="IOINHI;IOINORM" D ENDR^%ZISS S X=""
"RTN","PSBODL",16,0)
 I '$D(^TMP("PSBO",$J,"B")) S ^TMP("PSBO",$J,"B","EMPTY")=""
"RTN","PSBODL",17,0)
 S PSBGBL="^TMP(""PSBO"",$J,""B"")"
"RTN","PSBODL",18,0)
 I $G(PSBRPT(.4)) S $P(PSBRPT(.2),U,8)=1
"RTN","PSBODL",19,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,1)'="PSBO"!($QS(PSBGBL,2)'=$J)  D
"RTN","PSBODL",20,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBODL",21,0)
 .K PSBHDR
"RTN","PSBODL",22,0)
 .S PSBHDR(1)="MEDICATION DUE LIST for "
"RTN","PSBODL",23,0)
 .S (Y,PSBEVDT)=$P(PSBRPT(.1),U,6) D D^DIQ S Z=Y,PSBHDR(1)=PSBHDR(1)_Y_"@" S Y=$P(PSBRPT(.1),U,7) S PSBHDR(1)=PSBHDR(1)_$E(Y_"0000",2,5)
"RTN","PSBODL",24,0)
 .S PSBEVDT2=$P(PSBRPT(.1),U,6) S Y=$P(PSBRPT(.1),U,9) S:Y]"" PSBHDR(1)=PSBHDR(1)_" to "_Z_"@"_$E(Y_"0000",2,5)
"RTN","PSBODL",25,0)
 .S PSBHDR(2)="Schedule Type(s): --"
"RTN","PSBODL",26,0)
 .F Y=1:1:4 I $P(PSBRPT(.2),U,Y) S $P(PSBHDR(2),": ",2)=$P(PSBHDR(2),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("Continuous^PRN^On-Call^One-Time",U,Y)_" " S PSBHDR(2)=$TR(PSBHDR(2),"-","")
"RTN","PSBODL",27,0)
 .S PSBHDR(3)="Order Type(s): --"
"RTN","PSBODL",28,0)
 .F Y=6,7,8 I $P(PSBRPT(.2),U,Y) S $P(PSBHDR(3),": ",2)=$P(PSBHDR(3),": ",2)_$S(PSBHDR(3)["--":"",1:"/ ")_$P("^^^^^IV^Unit Dose^Future Orders",U,Y)_" " S PSBHDR(3)=$TR(PSBHDR(3),"-","")
"RTN","PSBODL",29,0)
 .I $QS(PSBGBL,4)="EMPTY" D  Q
"RTN","PSBODL",30,0)
 ..S X="" F  S X=$O(PSBHDR(X)) Q:X=""  D  W !!?10,"** NO DATA FOR ENTIRE NURSE/WARD LOCATION **",! Q
"RTN","PSBODL",31,0)
 ...W !,PSBHDR(X)
"RTN","PSBODL",32,0)
 .D PRINT(DFN)
"RTN","PSBODL",33,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J)
"RTN","PSBODL",34,0)
 Q
"RTN","PSBODL",35,0)
PRINT(DFN) ;^TMP($J.
"RTN","PSBODL",36,0)
 N PSBGBL,PSBOSTRT,PSBOSTOP,PSBINDX,PSBTYPE,PSBSCH,PSBSCHT
"RTN","PSBODL",37,0)
 N PSBMED,PSBORD,PSB,PSBX,PSBY,PSBZ,PSBSTOP,PSBSTRT,PSBSM,PSBNUM,PSBAT
"RTN","PSBODL",38,0)
 N PSBADMIN,PSBADM,PSBSTAT,PSBWFLAG,PSBODATE
"RTN","PSBODL",39,0)
 W $$HDR()
"RTN","PSBODL",40,0)
 S PSBOSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBODL",41,0)
 S PSBOSTOP=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9)
"RTN","PSBODL",42,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBODL",43,0)
 D EN^PSJBCMA(DFN,PSBOSTRT,"")
"RTN","PSBODL",44,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT **",!,$$BLANKS(),$$FTR^PSBODL1() Q
"RTN","PSBODL",45,0)
 S PSBI1=0 F  S PSBODATE=$$FMADD^XLFDT(PSBEVDT,PSBI1) Q:PSBODATE>PSBEVDT2  Q:PSBODATE=-1  D  ;Quit if Date is not valid Fileman Date added in PSB*3*63
"RTN","PSBODL",46,0)
 .S PSBI1=1
"RTN","PSBODL",47,0)
 .S Y=PSBODATE D D^DIQ
"RTN","PSBODL",48,0)
 .W !!,"Administration Date: "_Y,!
"RTN","PSBODL",49,0)
 .S PSBINDX=0
"RTN","PSBODL",50,0)
 .F  S PSBINDX=$O(^TMP("PSJ",$J,PSBINDX)) Q:'PSBINDX  D
"RTN","PSBODL",51,0)
 ..S PSBTYPE=$P(^TMP("PSJ",$J,PSBINDX,0),U,3),PSBTYPE=$E(PSBTYPE,$L(PSBTYPE))
"RTN","PSBODL",52,0)
 ..Q:PSBTYPE=""!(PSBTYPE="P")  ; No Pend this ver
"RTN","PSBODL",53,0)
 ..S PSBSTAT=^TMP("PSJ",$J,PSBINDX,1)
"RTN","PSBODL",54,0)
 ..I $P(PSBSTAT,U,7)["D"!($P(PSBSTAT,U,7)="E")!($P(PSBSTAT,U,8)) Q
"RTN","PSBODL",55,0)
 ..Q:PSBTYPE="U"&('$P(PSBRPT(.2),U,7))
"RTN","PSBODL",56,0)
 ..Q:PSBTYPE="V"&('$P(PSBRPT(.2),U,6))
"RTN","PSBODL",57,0)
 ..S PSBTYPE=$S(PSBTYPE="U":"UD-",PSBTYPE="V":"IV-",1:"**")
"RTN","PSBODL",58,0)
 ..S Y=$P(PSBSTAT,U,2)
"RTN","PSBODL",59,0)
 ..Q:Y="C"&('$P(PSBRPT(.2),U,1))
"RTN","PSBODL",60,0)
 ..Q:Y="P"&('$P(PSBRPT(.2),U,2))
"RTN","PSBODL",61,0)
 ..Q:Y="OC"&('$P(PSBRPT(.2),U,3))
"RTN","PSBODL",62,0)
 ..Q:Y="O"&('$P(PSBRPT(.2),U,4))
"RTN","PSBODL",63,0)
 ..S PSBSCHT=Y
"RTN","PSBODL",64,0)
 ..S:PSBSCHT="" PSBSCHT="*"
"RTN","PSBODL",65,0)
 ..S PSBMED=$P(^TMP("PSJ",$J,PSBINDX,3),U,2)
"RTN","PSBODL",66,0)
 ..S PSBORD=$P(^TMP("PSJ",$J,PSBINDX,0),U,3)
"RTN","PSBODL",67,0)
 ..S ^TMP("PSB",$J,"B",PSBTYPE,PSBSCHT,PSBMED,PSBORD)=""
"RTN","PSBODL",68,0)
 .I '$D(^TMP("PSB",$J,"B")) W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT **",!,$$BLANKS(),$$FTR^PSBODL1() Q
"RTN","PSBODL",69,0)
 .S PSBGBL=$NAME(^TMP("PSB",$J,"B")),PSBWFLAG=0
"RTN","PSBODL",70,0)
 .F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:($QS(PSBGBL,1)'="PSB")!($QS(PSBGBL,2)'=$J)!($QS(PSBGBL,3)'="B")  D
"RTN","PSBODL",71,0)
 ..K PSBORD,PSBFUTRO
"RTN","PSBODL",72,0)
 ..S PSBTYPE=$QS(PSBGBL,4)
"RTN","PSBODL",73,0)
 ..S PSBSCHT=$QS(PSBGBL,5)
"RTN","PSBODL",74,0)
 ..S PSBMED=$QS(PSBGBL,6)
"RTN","PSBODL",75,0)
 ..S PSBORD=$QS(PSBGBL,7)
"RTN","PSBODL",76,0)
 ..D CLEAN^PSBVT
"RTN","PSBODL",77,0)
 ..D PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBODL",78,0)
 ..;*68 begin
"RTN","PSBODL",79,0)
 ..K ^TMP("PSJBCMA5",$J,DFN,PSBONX)
"RTN","PSBODL",80,0)
 ..D GETSIOPI^PSJBCMA5(DFN,PSBONX,1)
"RTN","PSBODL",81,0)
 ..;*68 end
"RTN","PSBODL",82,0)
 ..D NOW^%DTC S PSBNOW=%
"RTN","PSBODL",83,0)
 ..Q:PSBOSP<PSBOSTRT
"RTN","PSBODL",84,0)
 ..Q:(PSBOSP<PSBOSTRT)&(PSBSCHT'="O")
"RTN","PSBODL",85,0)
 ..Q:(PSBOSP'>PSBNOW)
"RTN","PSBODL",86,0)
 ..S (PSBYES,PSBODD,PSBDAYB,PSBSCBR)=0
"RTN","PSBODL",87,0)
 ..S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1,PSBDAYB=1
"RTN","PSBODL",88,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBSCBR=1
"RTN","PSBODL",89,0)
 ..I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBODL",90,0)
 ...D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBODL",91,0)
 ..I PSBSCHT="OC" S PSBYES=1
"RTN","PSBODL",92,0)
 ..I PSBSCHT="P" S PSBYES=1
"RTN","PSBODL",93,0)
 ..I "PCS"'[PSBIVT S PSBYES=1
"RTN","PSBODL",94,0)
 ..I PSBIVT["S",PSBISYR'=1 S PSBYES=1
"RTN","PSBODL",95,0)
 ..I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 S PSBYES=1
"RTN","PSBODL",96,0)
 ..I PSBIVT["C",PSBCHEMT="A" S PSBYES=1
"RTN","PSBODL",97,0)
 ..I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBODL",98,0)
 ..I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBODL",99,0)
 ..I PSBSCHT="P" S PSBFREQ=1440
"RTN","PSBODL",100,0)
 ..I PSBSCHT="O" S PSBFREQ=1440
"RTN","PSBODL",101,0)
 ..I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBODL",102,0)
 ..S PSBVALB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH)
"RTN","PSBODL",103,0)
 ..I 'PSBDAYB,'PSBSCBR,PSBSCHT="C",PSBVALB="1",PSBADST'="",PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBODL",104,0)
 ..I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBODL",105,0)
 ..I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBODL",106,0)
 ..I PSBADST'="" D
"RTN","PSBODL",107,0)
 ...F PSBY=1:1:$L(PSBADST,"-")  D
"RTN","PSBODL",108,0)
 ....D:($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N)
"RTN","PSBODL",109,0)
 .....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBODL",110,0)
 ..I PSBSCHT="C",PSBOTYP="U",$G(PSBOST)<$G(PSBOSTRT) Q:'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ,)  ;Add check for QOD schedules in PSB*3*63
"RTN","PSBODL",111,0)
 ..I PSBSCHT="C",$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH),'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ) Q
"RTN","PSBODL",112,0)
 ..I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBODL",113,0)
 ...S (PSBGVN,X,Y)=""
"RTN","PSBODL",114,0)
 ...F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBODL",115,0)
 ....F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBODL",116,0)
 .....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBODL",117,0)
 ..S PSBRMN=1
"RTN","PSBODL",118,0)
 ..I PSBSCHT="O" D
"RTN","PSBODL",119,0)
 ...Q:(PSBOST'=PSBOSP)
"RTN","PSBODL",120,0)
 ...Q:(PSBOSP<PSBOSTRT)
"RTN","PSBODL",121,0)
 ...Q:((%'>PSBOST)!(%'=PSBOST))
"RTN","PSBODL",122,0)
 ...S PSBRMN=0
"RTN","PSBODL",123,0)
 ..Q:'PSBRMN
"RTN","PSBODL",124,0)
 ..I PSBOST>$$FMADD^XLFDT(PSBNOW,"","",+($$GET^XPAR("DIV","PSB ADMIN BEFORE"))) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE)="" Q
"RTN","PSBODL",125,0)
 ..I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBODL",126,0)
 ...S (PSBGVN,X,Y)=""
"RTN","PSBODL",127,0)
 ...F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBODL",128,0)
 ....F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBODL",129,0)
 .....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBODL",130,0)
 ..S PSBLGDT="",X=""
"RTN","PSBODL",131,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X),-1) Q:'X  D  Q:PSBLGDT
"RTN","PSBODL",132,0)
 ...S PSBIEN=""
"RTN","PSBODL",133,0)
 ...F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X,PSBIEN),-1) Q:PSBIEN=""  D  Q:PSBLGDT
"RTN","PSBODL",134,0)
 ....S:$P($G(^PSB(53.79,PSBIEN,0)),U,9)="G" PSBLGDT=X
"RTN","PSBODL",135,0)
 ..S PSBADMIN="" K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBODL",136,0)
 ..I PSBSCHT="C" D  Q:PSBADMIN=""
"RTN","PSBODL",137,0)
 ...S PSBX=PSBADST,PSBFLAG=1
"RTN","PSBODL",138,0)
 ...D:PSBX=""
"RTN","PSBODL",139,0)
 ....I PSBIVT="C",PSBCHEMT="A" S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",140,0)
 ....I PSBIVT="C",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",141,0)
 ....I PSBIVT="S",PSBISYR'=1 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",142,0)
 ....I "HA"[PSBIVT S:PSBIVT]"" PSBX="0000",PSBFLAG=0
"RTN","PSBODL",143,0)
 ...I ((PSBIVT="S")!(PSBIVT="C")),(PSBISYR=1) S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",144,0)
 ...I (PSBIVT="C"),(PSBCHEMT="P") S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",145,0)
 ...I PSBOTYP="U",PSBX="0000" S PSBX=""
"RTN","PSBODL",146,0)
 ...I PSBIVT="P" S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",147,0)
 ...I PSBX="" S:($G(PSBFREQ)>29)!(PSBFREQ="D") PSBX=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBODATE)
"RTN","PSBODL",148,0)
 ...E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBX
"RTN","PSBODL",149,0)
 ...D:PSBX'=""
"RTN","PSBODL",150,0)
 ....F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBX=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBODL",151,0)
 .....F PSBY=1:1:$L(PSBX,"-")  D
"RTN","PSBODL",152,0)
 ......S PSBAT=+(PSBODATE_"."_$P(PSBX,"-",PSBY))
"RTN","PSBODL",153,0)
 ......I PSBFLAG Q:PSBAT<PSBOSTRT!(PSBAT>PSBOSTOP)
"RTN","PSBODL",154,0)
 ......D VAL^PSBMLVAL(.PSBZ,DFN,PSBON,PSBOTYP,PSBAT)
"RTN","PSBODL",155,0)
 ......I (PSBZ(0)<0)&(PSBCNT=1) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE,PSBAT)="" Q
"RTN","PSBODL",156,0)
 ......I (PSBAT'["."),($G(PSBORD)["V") I (PSBOST<PSBOSTOP),(PSBOST'<PSBOSTRT) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE,PSBAT)="" Q
"RTN","PSBODL",157,0)
 ......Q:+PSBZ(0)<0
"RTN","PSBODL",158,0)
 ......I $G(PSBOST)'>$G(PSBAT) D
"RTN","PSBODL",159,0)
 .......Q:($G(PSBOSP)'>$G(PSBAT))
"RTN","PSBODL",160,0)
 .......S PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL",161,0)
 ......E  I ($P($G(PSBOST),".")'>$P($G(PSBAT),"."))&($P($G(PSBAT),".",2)="") S PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL",162,0)
 ...I +$G(PSBFREQ)>0,$G(PSBFREQ)<30,PSBADMIN'="0000" S PSBADMIN="Due every "_$G(PSBFREQ)_" minutes."
"RTN","PSBODL",163,0)
 ..I $Y>(IOSL-(12+($L(PSBADMIN)/27))) W !?(IOM-36\2),"(Medications Continued on Next Page)",$$FTR^PSBODL1(),$$HDR()
"RTN","PSBODL",164,0)
 ..I PSBSM S PSBSM=$S(PSBSMX:"H",1:"")_"SM"
"RTN","PSBODL",165,0)
 ..E  S PSBSM=""
"RTN","PSBODL",166,0)
 ..W !,$J(PSBSM,3),?6,PSBTYPE,$E(PSBSCHT,1,4),?12 S PSBWFLAG=1
"RTN","PSBODL",167,0)
 ..S X="",Y=0
"RTN","PSBODL",168,0)
 ..D WRAPPUP^PSBODL1
"RTN","PSBODL",169,0)
 .I '$G(PSBWFLAG) W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBODL",170,0)
 .W $$BLANKS(),$$FTR^PSBODL1()
"RTN","PSBODL",171,0)
 .S PSBORD=$O(^TMP("PSBO",$J,DFN,""),-1)
"RTN","PSBODL",172,0)
 .I +$G(PSBORD)>0,$P(PSBRPT(.4),U,1),$D(^TMP("PSBO",$J,DFN,PSBORD)) D EN^PSBODL1
"RTN","PSBODL",173,0)
 I $G(PSBODATE)=-1 W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **",$$BLANKS(),$$FTR^PSBODL1() ;Add no medications message, blank lines and footer to patients for invalid Fileman date in PSB*3*63
"RTN","PSBODL",174,0)
 ;
"RTN","PSBODL",175,0)
 K ^TMP("PSJBCMA5",$J)
"RTN","PSBODL",176,0)
 Q
"RTN","PSBODL",177,0)
HDR() ;
"RTN","PSBODL",178,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBODL",179,0)
 W !,"Self",?85,"Last",?100,"Start",?110,"Stop",?120,"Verifying"
"RTN","PSBODL",180,0)
 W !,"Med",?6,"Sched",?14,"Medication",?50,"Dose",?78,"Route",?85,"Given",?100,"Date",?110,"Date",?120,"Rph/Rn"
"RTN","PSBODL",181,0)
 W !,?100,"@Time",?110,"@Time"
"RTN","PSBODL",182,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",183,0)
 Q ""
"RTN","PSBODL",184,0)
BLANKS() ;
"RTN","PSBODL",185,0)
 Q:'$P(PSBRPT(.2),U,5) ""
"RTN","PSBODL",186,0)
 W !
"RTN","PSBODL",187,0)
 D:$Y>(IOSL-26)
"RTN","PSBODL",188,0)
 .W ?(IOM-42\2),"(Changes/Addendums to Orders on Next Page)"
"RTN","PSBODL",189,0)
 .W $$FTR^PSBODL1(),$$HDR() ; New page - no room for blanks
"RTN","PSBODL",190,0)
 I IOSL<100 F  Q:$Y>(IOSL-26)  W !
"RTN","PSBODL",191,0)
 W ?(IOM-28\2),"Changes/Addendums to orders"
"RTN","PSBODL",192,0)
 F X=1:1:4 D
"RTN","PSBODL",193,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",194,0)
 .W !!?3,"CON ___ PRN ___"
"RTN","PSBODL",195,0)
 .W ?20,"Drug: ",$TR($J("",22)," ","_")
"RTN","PSBODL",196,0)
 .W ?50,"Give: ",$TR($J("",42)," ","_")
"RTN","PSBODL",197,0)
 .W ?100,"Start: _________ Stop: _________"
"RTN","PSBODL",198,0)
 .W !?20,"Spec"
"RTN","PSBODL",199,0)
 .W !?3,"OT  ___ OC  ___"
"RTN","PSBODL",200,0)
 .W ?20,"Inst: ",$TR($J("",72)," ","_")
"RTN","PSBODL",201,0)
 .W ?100,"Initials: ______ Date: _________"
"RTN","PSBODL",202,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",203,0)
 Q ""
"RTN","PSBODL1")
0^13^B43970993^B38252588
"RTN","PSBODL1",1,0)
PSBODL1 ;BIRMINGHAM/VRN-DUE LIST ;1/10/12 8:47pm
"RTN","PSBODL1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,9,32,28,68**;Mar 2004;Build 26
"RTN","PSBODL1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified. 
"RTN","PSBODL1",4,0)
 ;
"RTN","PSBODL1",5,0)
 ;*68 - print New unlimited Wp Special Instructions/OPI fields
"RTN","PSBODL1",6,0)
 ;
"RTN","PSBODL1",7,0)
EN ;
"RTN","PSBODL1",8,0)
 N QQ
"RTN","PSBODL1",9,0)
 S PSBFOHDR=0
"RTN","PSBODL1",10,0)
 S PSBORD=0 F  S PSBORD=$O(^TMP("PSBO",$J,DFN,PSBORD)) Q:PSBORD=""  S PSBTYPE=$O(^TMP("PSBO",$J,DFN,PSBORD,"")) D
"RTN","PSBODL1",11,0)
 .D CLEAN^PSBVT
"RTN","PSBODL1",12,0)
 .D PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBODL1",13,0)
 .I PSBSCHT="C" D  Q:PSBADMIN=""
"RTN","PSBODL1",14,0)
 ..S PSBX=PSBADST,PSBFLAG=1
"RTN","PSBODL1",15,0)
 ..I PSBX="",PSBONX["V",PSBIVT'="P" S PSBFLAG=0
"RTN","PSBODL1",16,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBODL1",17,0)
 ..S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBODL1",18,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBODL1",19,0)
 ..I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P"  Q
"RTN","PSBODL1",20,0)
 ..I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBODL1",21,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBODL1",22,0)
 ..I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBODL1",23,0)
 ..I PSBODD,PSBADST'="" Q
"RTN","PSBODL1",24,0)
 ..D:PSBX=""
"RTN","PSBODL1",25,0)
 ...I PSBIVT="C",PSBCHEMT="A" S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",26,0)
 ...I PSBIVT="C",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",27,0)
 ...I PSBIVT="S",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",28,0)
 ...I "HA"[PSBIVT S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",29,0)
 ..I ("SC"[PSBIVT),(PSBISYR=1) S PSBX=""
"RTN","PSBODL1",30,0)
 ..I (PSBIVT="C"),(PSBCHEMT="P") S PSBX=""
"RTN","PSBODL1",31,0)
 ..I PSBOTYP="U",PSBX="0000" S PSBX=""
"RTN","PSBODL1",32,0)
 ..I PSBIVT="P",$G(PSBX)=0 S PSBX=""
"RTN","PSBODL1",33,0)
 ..I PSBX="" S PSBX=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT)
"RTN","PSBODL1",34,0)
 ..E  K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBX
"RTN","PSBODL1",35,0)
 ..S PSBADMIN=""
"RTN","PSBODL1",36,0)
 ..F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBX=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBODL1",37,0)
 ...F PSBY=1:1:$L(PSBX,"-")  D
"RTN","PSBODL1",38,0)
 ....Q:($P(PSBX,"-",PSBY)'?2N)&($P(PSBX,"-",PSBY)'?4N)
"RTN","PSBODL1",39,0)
 ....S PSBAT=+(PSBODATE_"."_$P(PSBX,"-",PSBY))
"RTN","PSBODL1",40,0)
 ....I PSBFLAG Q:PSBAT<PSBOSTRT!(PSBAT>PSBOSTOP)  ; Report Window
"RTN","PSBODL1",41,0)
 ....D VAL^PSBMLVAL(.PSBZ,DFN,PSBONX,PSBTYPE,PSBAT)
"RTN","PSBODL1",42,0)
 ....S:$G(PSBFREQ)>29 PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL1",43,0)
 ....S:$G(PSBFREQ)<30 PSBADMIN="Due every "_$G(PSBFREQ)_" minutes."
"RTN","PSBODL1",44,0)
 .I PSBSCHT'="C" S PSBADMIN=PSBADST
"RTN","PSBODL1",45,0)
 .; Get LAST GIVEN date/time
"RTN","PSBODL1",46,0)
 .S PSBLGDT="",X=""
"RTN","PSBODL1",47,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X),-1) Q:'X  D  Q:PSBLGDT
"RTN","PSBODL1",48,0)
 ..S PSBIEN=""
"RTN","PSBODL1",49,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X,PSBIEN),-1) Q:PSBIEN=""  D  Q:PSBLGDT
"RTN","PSBODL1",50,0)
 ...S:"MHNR"'[$P($G(^PSB(53.79,PSBIEN,0)),U,9) PSBLGDT=X
"RTN","PSBODL1",51,0)
 .I $Y>(IOSL-12) I $Y<(IOSL-4) W !?(IOM-36\2),"(Medications Continued on Next Page)",$$FTR(),$$HDR()
"RTN","PSBODL1",52,0)
 .I PSBSM S PSBSM=$S(PSBSMX:"H",1:"")_"SM"
"RTN","PSBODL1",53,0)
 .E  S PSBSM=""
"RTN","PSBODL1",54,0)
 .I 'PSBFOHDR S PSBFOHDR=1 W $$HDR()
"RTN","PSBODL1",55,0)
 .W !,$J(PSBSM,3),?6,PSBTYPE,$E(PSBSCHT,1,4),?12 S PSBWFLAG=1
"RTN","PSBODL1",56,0)
 .S X="",Y=0
"RTN","PSBODL1",57,0)
 .W $$WRAP(14,34,PSBOITX)
"RTN","PSBODL1",58,0)
 .S PSBADM="Give: "_PSBDOSE_"  "_PSBSCH
"RTN","PSBODL1",59,0)
 .W $$WRAP(50,27,PSBADM)
"RTN","PSBODL1",60,0)
 .W $$WRAP(78,6,PSBMR)
"RTN","PSBODL1",61,0)
 .W ?85 I PSBLGDT W $E(PSBLGDT,4,5),"/",$E(PSBLGDT,6,7),"/",$E(PSBLGDT,2,3) W "@",$E($P(PSBLGDT,".",2)_"0000",1,4)
"RTN","PSBODL1",62,0)
 .W ?100,$P($TR($$FMTE^XLFDT(PSBOST,2),"@"," ")," ")
"RTN","PSBODL1",63,0)
 .W ?110,$P($TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")," ")
"RTN","PSBODL1",64,0)
 .W ?120,$S(PSBVPHI]"":PSBVPHI,1:"***"),"/",$S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBODL1",65,0)
 .W !,?100,"@"_$P(PSBOSTX,"  ",2),?110,"@"_$P(PSBOSPX,"  ",2)
"RTN","PSBODL1",66,0)
 .W IOINHI  ; To Highlight the Dispense Drugs...
"RTN","PSBODL1",67,0)
 .I $D(PSBDDA) S Y=0 F  S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODL1",68,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<PSBNOW)
"RTN","PSBODL1",69,0)
 ..W !?14,"*",$$WRAP(15,33,$P(PSBDDA(Y),U,3)_" ("_+$P(PSBDDA(Y),U,2)_")")
"RTN","PSBODL1",70,0)
 .I $D(PSBADA) S Y=0 F  S Y=$O(PSBADA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBADA(Y),U,3)_" ("_$P(PSBADA(Y),U,4)_")")
"RTN","PSBODL1",71,0)
 .I $D(PSBSOLA) S Y=0 F  S Y=$O(PSBSOLA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBSOLA(Y),U,3)_" ("_$P(PSBSOLA(Y),U,4)_")")
"RTN","PSBODL1",72,0)
 .W IOINORM ; Highlight Off
"RTN","PSBODL1",73,0)
 .S PSBADM=$S(PSBADMIN]"":"Admin Times: "_PSBADMIN,1:"")
"RTN","PSBODL1",74,0)
 .W:PSBADM]"" $$WRAP(50,27,PSBADM)
"RTN","PSBODL1",75,0)
 .;*68 begin
"RTN","PSBODL1",76,0)
 .I PSBSIFLG,'$G(^TMP("PSJBCMA5",$J,DFN,PSBORD)) D
"RTN","PSBODL1",77,0)
 ..W !?14,"Special Instructions:",?36,"<None Entered.>",DFN,U,PSBORD,"<"
"RTN","PSBODL1",78,0)
 .D:PSBSIFLG
"RTN","PSBODL1",79,0)
 ..F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)) Q:'QQ  D
"RTN","PSBODL1",80,0)
 ...W:QQ=1 !?14,"Special Instructions:",?36,^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)
"RTN","PSBODL1",81,0)
 ...W:QQ>1 !?36,^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)
"RTN","PSBODL1",82,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",83,0)
 I '$G(PSBWFLAG) W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBODL1",84,0)
 W:PSBFOHDR $$BLANKS(),$$FTR()
"RTN","PSBODL1",85,0)
 K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBODL1",86,0)
 Q
"RTN","PSBODL1",87,0)
 ;
"RTN","PSBODL1",88,0)
WRAPPUP ;Do wrapping per PSBODL (Due List Report)
"RTN","PSBODL1",89,0)
 ;
"RTN","PSBODL1",90,0)
 W $$WRAP(14,34,PSBMED)
"RTN","PSBODL1",91,0)
 S PSBADM="Give: "_PSBDOSE_"  "_PSBSCH
"RTN","PSBODL1",92,0)
 W $$WRAP(50,27,PSBADM),?78,$$WRAP(78,6,PSBMR)
"RTN","PSBODL1",93,0)
 W ?85 D:PSBLGDT
"RTN","PSBODL1",94,0)
 .W $E(PSBLGDT,4,5),"/",$E(PSBLGDT,6,7),"/",$E(PSBLGDT,2,3),"@",$E($P(PSBLGDT,".",2)_"0000",1,4)
"RTN","PSBODL1",95,0)
 W ?100,$P($TR($$FMTE^XLFDT(PSBOST,2),"@"," ")," "),?110,$P($TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")," "),?120,$S(PSBVPHI]"":PSBVPHI,1:"***"),"/"
"RTN","PSBODL1",96,0)
 W $S(PSBVNI]"":PSBVNI,1:"***"),!,?100,"@"_$P(PSBOSTX,"  ",2),?110,"@"_$P(PSBOSPX,"  ",2)
"RTN","PSBODL1",97,0)
 W IOINHI
"RTN","PSBODL1",98,0)
 I $D(PSBDDA) S Y=0 F  S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODL1",99,0)
 .Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<PSBNOW)
"RTN","PSBODL1",100,0)
 .W !?14,"*",$$WRAP(15,33,$P(PSBDDA(Y),U,3)) ;_" ("_+$P(PSBDDA(Y),U,2)_")")
"RTN","PSBODL1",101,0)
 I $D(PSBADA) S Y=0 F  S Y=$O(PSBADA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBADA(Y),U,3)) ;_" ("_$P(PSBADA(Y),U,4)_")")
"RTN","PSBODL1",102,0)
 I $D(PSBSOLA) S Y=0 F  S Y=$O(PSBSOLA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBSOLA(Y),U,3)) ;_" ("_$P(PSBSOLA(Y),U,4)_")")
"RTN","PSBODL1",103,0)
 W IOINORM ; Hlight Off
"RTN","PSBODL1",104,0)
 S PSBADM=$S(PSBADMIN]"":"Admin Times: "_PSBADMIN,1:"")
"RTN","PSBODL1",105,0)
 W:PSBADM]"" $$WRAP(50,27,PSBADM)
"RTN","PSBODL1",106,0)
 ;*68 begin
"RTN","PSBODL1",107,0)
 I PSBSIFLG,'$G(^TMP("PSJBCMA5",$J,DFN,PSBORD)) W !?14,"Special Instructions:",?36,"<None Entered.>"
"RTN","PSBODL1",108,0)
 D:PSBSIFLG
"RTN","PSBODL1",109,0)
 .F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)) Q:'QQ  D
"RTN","PSBODL1",110,0)
 ..W:QQ=1 !?14,"Special Instructions:"
"RTN","PSBODL1",111,0)
 ..W:QQ>1 !
"RTN","PSBODL1",112,0)
 ..W ?36,^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)
"RTN","PSBODL1",113,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",114,0)
 Q
"RTN","PSBODL1",115,0)
 ;
"RTN","PSBODL1",116,0)
WRAP(X,Y,Z) ; Quick text wrap
"RTN","PSBODL1",117,0)
 F  Q:'$L(Z)  D
"RTN","PSBODL1",118,0)
 .W:$X>X !
"RTN","PSBODL1",119,0)
 .W:$X<X ?X
"RTN","PSBODL1",120,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBODL1",121,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBODL1",122,0)
 .S:PSB<1 PSB=Y
"RTN","PSBODL1",123,0)
 .W $E(Z,1,PSB)
"RTN","PSBODL1",124,0)
 .S Z=$E(Z,PSB+1,255)
"RTN","PSBODL1",125,0)
 Q ""
"RTN","PSBODL1",126,0)
 ;
"RTN","PSBODL1",127,0)
FTR() ; [Extrinsic] Page footer
"RTN","PSBODL1",128,0)
 ;
"RTN","PSBODL1",129,0)
 ; Sub Module Description:
"RTN","PSBODL1",130,0)
 ; (No Description Available)
"RTN","PSBODL1",131,0)
 ;
"RTN","PSBODL1",132,0)
 I (IOSL<100) F  Q:$Y>(IOSL-10)  W !
"RTN","PSBODL1",133,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBODL1",134,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBODL1",135,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBODL1",136,0)
 Q ""
"RTN","PSBODL1",137,0)
 ;
"RTN","PSBODL1",138,0)
HDR() ; Page Header
"RTN","PSBODL1",139,0)
 Q:'PSBFOHDR ""
"RTN","PSBODL1",140,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBODL1",141,0)
 W !
"RTN","PSBODL1",142,0)
 W !
"RTN","PSBODL1",143,0)
 W !,?(IOM-28\2),"*****   FUTURE ORDERS   *****"
"RTN","PSBODL1",144,0)
 W !
"RTN","PSBODL1",145,0)
 W !,"Self",?85,"Last",?100,"Start",?110,"Stop",?120,"Verifying"
"RTN","PSBODL1",146,0)
 W !,"Med",?6,"Sched",?14,"Medication",?50,"Dose",?78,"Route",?85,"Given",?100,"Date",?110,"Date",?120,"Rph/Rn"
"RTN","PSBODL1",147,0)
 W !,?100,"@Time",?110,"@Time"
"RTN","PSBODL1",148,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",149,0)
 Q ""
"RTN","PSBODL1",150,0)
 ;
"RTN","PSBODL1",151,0)
BLANKS() ; [Extrinsic] Print blanks at end of printout for changes
"RTN","PSBODL1",152,0)
 Q:'$P(PSBRPT(.2),U,5) ""
"RTN","PSBODL1",153,0)
 W !
"RTN","PSBODL1",154,0)
 I $Y>(IOSL-26) W ?(IOM-42\2),"(Changes/Addendums to Orders on Next Page)" W $$FTR(),$$HDR() ; Not enough space - new page
"RTN","PSBODL1",155,0)
 I IOSL<100 F  Q:$Y>(IOSL-26)  W !
"RTN","PSBODL1",156,0)
 W ?(IOM-28\2),"Changes/Addendums to orders"
"RTN","PSBODL1",157,0)
 F X=1:1:4 D
"RTN","PSBODL1",158,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",159,0)
 .W !!?3,"CON ___ PRN ___",?20,"Drug: ",$TR($J("",22)," ","_"),?50,"Give: ",$TR($J("",42)," ","_"),?100,"Start: _________ Stop: _________"
"RTN","PSBODL1",160,0)
 .W !?20,"Spec"
"RTN","PSBODL1",161,0)
 .W !?3,"OT  ___ OC  ___",?20,"Inst: ",$TR($J("",72)," ","_"),?100,"Initials: ______ Date: _________"
"RTN","PSBODL1",162,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",163,0)
 Q ""
"RTN","PSBODL1",164,0)
 ;
"RTN","PSBODO")
0^3^B36995822^B34073273
"RTN","PSBODO",1,0)
PSBODO ;BRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;1/30/12 1:13pm
"RTN","PSBODO",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,21,24,38,58,68**;Mar 2004;Build 26
"RTN","PSBODO",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBODO",4,0)
 ;
"RTN","PSBODO",5,0)
 ; Reference/IA
"RTN","PSBODO",6,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBODO",7,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBODO",8,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBODO",9,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBODO",10,0)
 ;
"RTN","PSBODO",11,0)
 ;*68 - add ability to print new WP Special Instructions/OPI fields
"RTN","PSBODO",12,0)
 ;*58 - add sections to display Prv Override comments and Rph
"RTN","PSBODO",13,0)
 ;      Interventions to this report for (critical drug/drug and all
"RTN","PSBODO",14,0)
 ;      adverse reactions/allergies)
"RTN","PSBODO",15,0)
EN ;
"RTN","PSBODO",16,0)
 ;
"RTN","PSBODO",17,0)
 ; Description:
"RTN","PSBODO",18,0)
 ; Returns a display for a selected order when double clicked on the VDL
"RTN","PSBODO",19,0)
 ;
"RTN","PSBODO",20,0)
 N PSBGBL,DFN
"RTN","PSBODO",21,0)
 S PSBGBL=$NAME(^TMP("PSBO",$J,"B"))
"RTN","PSBODO",22,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,2)'=$J  Q:$QS(PSBGBL,1)'["PSBO"  D
"RTN","PSBODO",23,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBODO",24,0)
 .D DISPORD
"RTN","PSBODO",25,0)
 Q
"RTN","PSBODO",26,0)
 ;
"RTN","PSBODO",27,0)
DISPORD ;
"RTN","PSBODO",28,0)
 N PSBGBL,PSBOI,PSBHDR,PSJGLO,LINE,PSBPRV,PSBPV,PSBRPH,PSBRH,PSBOVR,I,X,Y
"RTN","PSBODO",29,0)
 S PSBOI=$$GET1^DIQ(53.69,PSBRPT_",",.09)
"RTN","PSBODO",30,0)
 D EN^PSJBCMA2(DFN,PSBOI)
"RTN","PSBODO",31,0)
 S PSJGLO="^TMP(""PSJ"""_","_$J
"RTN","PSBODO",32,0)
 D CLEAN^PSBVT
"RTN","PSBODO",33,0)
 D PSJ1^PSBVT(DFN,PSBOI)
"RTN","PSBODO",34,0)
 S PSBHDR(1)="BCMA - Display Order" D PT^PSBOHDR(DFN,.PSBHDR) W !
"RTN","PSBODO",35,0)
 I '$G(PSBONX) W !,"Invalid Order"
"RTN","PSBODO",36,0)
 D:$G(PSBONX)
"RTN","PSBODO",37,0)
 .W !,"Orderable Item: ",PSBOITX
"RTN","PSBODO",38,0)
 .I PSBONX["V" W !,"Infusion Rate:  ",PSBIFR
"RTN","PSBODO",39,0)
 .I PSBONX'["V" W !,"Dosage Ordered: ",PSBDOSE
"RTN","PSBODO",40,0)
 .W ?40,"Start:    ",PSBOSTX
"RTN","PSBODO",41,0)
 .W !?40,"Stop:     ",PSBOSPX
"RTN","PSBODO",42,0)
 .W !,"Med Route:      ",PSBMR
"RTN","PSBODO",43,0)
 .W !,"Schedule Type:  ",PSBSCHTX
"RTN","PSBODO",44,0)
 .I PSBONX'["V" W ?40,"Self Med: ",PSBSMX
"RTN","PSBODO",45,0)
 .W:PSBSM !?40,"Hosp Sup: ",PSBSMX
"RTN","PSBODO",46,0)
 .W:PSBSCH'="" !,"Schedule: ",PSBSCH
"RTN","PSBODO",47,0)
 .I PSBONX'["V" W !,"Admin Times:    ",PSBADST
"RTN","PSBODO",48,0)
 .I PSBONX["V",((PSBIVT="P")!(PSBISYR=1)) W !,"Admin Times:    ",PSBADST
"RTN","PSBODO",49,0)
 .W !,"Provider: ",PSBMDX
"RTN","PSBODO",50,0)
 .;*68 change
"RTN","PSBODO",51,0)
 .W !,"Special Instructions/Other Print Info:"
"RTN","PSBODO",52,0)
 .K ^TMP("PSJBCMA5",$J)
"RTN","PSBODO",53,0)
 .D GETSIOPI^PSJBCMA5(DFN,PSBONX,1)
"RTN","PSBODO",54,0)
 .F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,PSBONX,QQ)) Q:'QQ  D
"RTN","PSBODO",55,0)
 ..W !,^TMP("PSJBCMA5",$J,DFN,PSBONX,QQ)
"RTN","PSBODO",56,0)
 .K ^TMP("PSJBCMA5",$J)
"RTN","PSBODO",57,0)
 .;*68 end
"RTN","PSBODO",58,0)
 .;*58 override/intervention section * * *
"RTN","PSBODO",59,0)
 .S PSBOVR=0
"RTN","PSBODO",60,0)
 .D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBPRV)
"RTN","PSBODO",61,0)
 .D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBRPH,2)
"RTN","PSBODO",62,0)
 .S PSBPV=$S($D(PSBPRV)>1:1,1:0)
"RTN","PSBODO",63,0)
 .S PSBRH=$S($D(PSBRPH)>1:1,1:0)
"RTN","PSBODO",64,0)
 .I 'PSBPV,PSBRH D DSPPRV(.PSBPRV,132,2,26,1) S PSBOVR=1
"RTN","PSBODO",65,0)
 .I PSBPV D DSPPRV(.PSBPRV,132,2,26) S PSBOVR=1
"RTN","PSBODO",66,0)
 .I PSBPV,'PSBRH D DSPRPH(.PSBRPH,132,2,26,1) S PSBOVR=1
"RTN","PSBODO",67,0)
 .I PSBRH D DSPRPH(.PSBRPH,132,2,26) S PSBOVR=1
"RTN","PSBODO",68,0)
 .I PSBOVR W !,$TR($J("",75)," ","-")
"RTN","PSBODO",69,0)
 .;*58 end override/intervention section * * *
"RTN","PSBODO",70,0)
 .;
"RTN","PSBODO",71,0)
 .W !
"RTN","PSBODO",72,0)
 .I $D(PSBDDA(1)) D
"RTN","PSBODO",73,0)
 ..W !,"Dispense Drugs",!,"Drug Name",?40,"Units",?50,"Inactive Date"
"RTN","PSBODO",74,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",75,0)
 ..F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODO",76,0)
 ...S X=$P(PSBDDA(Y),U,4)
"RTN","PSBODO",77,0)
 ...W !,$P(PSBDDA(Y),U,3),?40,$S(X]"":X,1:1)
"RTN","PSBODO",78,0)
 ...S X=$P(PSBDDA(Y),U,5) Q:'X
"RTN","PSBODO",79,0)
 ...W ?50,$E(X,4,5),"/",$E(X,6,7),"/",(1700+$E(X,1,3))
"RTN","PSBODO",80,0)
 .I $D(PSBADA(1)) D
"RTN","PSBODO",81,0)
 ..W !!,"Additives",!,"Name",?40,"Strength"
"RTN","PSBODO",82,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",83,0)
 ..F Y=0:0 S Y=$O(PSBADA(Y)) Q:'Y  D
"RTN","PSBODO",84,0)
 ...W !,$P(PSBADA(Y),U,3),?40,$P(PSBADA(Y),U,4)
"RTN","PSBODO",85,0)
 .I $D(PSBSOLA(1)) D
"RTN","PSBODO",86,0)
 ..W !!,"Solution",!,"Name",?40,"Volume"
"RTN","PSBODO",87,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",88,0)
 ..F Y=0:0 S Y=$O(PSBSOLA(Y)) Q:'Y  D
"RTN","PSBODO",89,0)
 ...W !,$P(PSBSOLA(Y),U,3),?40,$P(PSBSOLA(Y),U,4)
"RTN","PSBODO",90,0)
 .I $P(@(PSJGLO_","_0_")"),U,1)'=-1 D
"RTN","PSBODO",91,0)
 ..W !,$TR($J("",75)," ","-")
"RTN","PSBODO",92,0)
 ..W !,"Pharmacy Activity Log: "
"RTN","PSBODO",93,0)
 ..F I=1:1:$P(@(PSJGLO_","_0_")"),U,4) D
"RTN","PSBODO",94,0)
 ...W !?9,"Date:  ",$$FMTE^XLFDT($P(@(PSJGLO_","_I_","_1_")"),U,1)),?35,"User:  ",$P(@(PSJGLO_","_I_","_1_")"),U,2)
"RTN","PSBODO",95,0)
 ...W !?5,"Activity:  ",$P(@(PSJGLO_","_I_","_1_")"),U,4)
"RTN","PSBODO",96,0)
 ...I $D(@(PSJGLO_","_I_","_2_")")) W !?8,"Field:  ",$P(@(PSJGLO_","_I_","_1_")"),U,3),!?5,"Old Data:  ",@(PSJGLO_","_I_","_2_")")
"RTN","PSBODO",97,0)
 ...I $D(@(PSJGLO_","_I_","_3_")")) W !?7,"Reason:  ",@(PSJGLO_","_I_","_3_")")
"RTN","PSBODO",98,0)
 ...W !
"RTN","PSBODO",99,0)
 W !!
"RTN","PSBODO",100,0)
 D CLEAN^PSBVT K @(PSJGLO_")")
"RTN","PSBODO",101,0)
 Q
"RTN","PSBODO",102,0)
 ;
"RTN","PSBODO",103,0)
DSPPRV(ARR,LN,IND,ALGN,NONE) ; Display Provider (CPRS) override reasons
"RTN","PSBODO",104,0)
 ; ARR  = array with provider override text.
"RTN","PSBODO",105,0)
 ; LN   = total width of report writable area.      (opt, 132 default)
"RTN","PSBODO",106,0)
 ; IND  = indent for both left and right margins.      (opt,0 default)
"RTN","PSBODO",107,0)
 ; ALGN = align colon on this column.                (opt, 25 default)
"RTN","PSBODO",108,0)
 ; NONE = display empty Provider override msg.        (opt, 0 default)
"RTN","PSBODO",109,0)
 ;
"RTN","PSBODO",110,0)
 N CAT,QQ,OC,HDG,CTRTAB,TMPONX,LINE,L1,L2,XX
"RTN","PSBODO",111,0)
 S LN=+$G(LN,132),IND=+$G(IND),ALGN=$G(ALGN,25),NONE=$G(NONE,0)
"RTN","PSBODO",112,0)
 S LN=LN-(IND*2)    ;adj writeable area by both L & R margins
"RTN","PSBODO",113,0)
 ;provider heading
"RTN","PSBODO",114,0)
 W !!?IND,$TR($J("",LN)," ","=")
"RTN","PSBODO",115,0)
 S HDG="** Current Provider Overrides for this order **"
"RTN","PSBODO",116,0)
 S CTRTAB=(LN-$L(HDG))/2
"RTN","PSBODO",117,0)
 W !?CTRTAB,HDG
"RTN","PSBODO",118,0)
 W !?IND,$TR($J("",LN)," ","="),!
"RTN","PSBODO",119,0)
 ;
"RTN","PSBODO",120,0)
 ;special scenario when NO Prv overrides, but Rph Interventions do
"RTN","PSBODO",121,0)
 I NONE W !?IND,"No Provider Overrides to display.",! Q
"RTN","PSBODO",122,0)
 ;
"RTN","PSBODO",123,0)
 ;provider body text
"RTN","PSBODO",124,0)
 S TMPONX=$O(ARR("PROV",DFN,"")) I TMPONX D
"RTN","PSBODO",125,0)
 .S QQ="" F  S QQ=$O(ARR("PROV",DFN,+TMPONX,QQ)) Q:QQ=""  D
"RTN","PSBODO",126,0)
 ..S LINE=ARR("PROV",DFN,+TMPONX,QQ),XX=$F(LINE,":")
"RTN","PSBODO",127,0)
 ..S L1=$J($E(LINE,1,XX),ALGN),L2=$E(LINE,XX+1,$L(LINE))
"RTN","PSBODO",128,0)
 ..W !?IND,L1,L2
"RTN","PSBODO",129,0)
 .W !
"RTN","PSBODO",130,0)
 S CAT=0 F  S CAT=$O(ARR("PROVR",DFN,+TMPONX,CAT)) Q:'CAT  D
"RTN","PSBODO",131,0)
 .S OC=0 F  S OC=$O(ARR("PROVR",DFN,+TMPONX,CAT,OC)) Q:'OC  D
"RTN","PSBODO",132,0)
 ..S LINE=ARR("PROVR",DFN,+TMPONX,CAT,OC,0),XX=$F(LINE,":")
"RTN","PSBODO",133,0)
 ..S L1=$J($E(LINE,1,XX),ALGN),L2=$E(LINE,XX+1,$L(LINE))
"RTN","PSBODO",134,0)
 ..W !,?IND,$$WRAP^PSBO(IND,LN,LINE),!
"RTN","PSBODO",135,0)
 Q
"RTN","PSBODO",136,0)
 ;
"RTN","PSBODO",137,0)
DSPRPH(ARR,LN,IND,ALGN,NONE) ; Display Pharmacist Interventions
"RTN","PSBODO",138,0)
 ; ARR  = array with Pharmacist intervention text.               (opt)
"RTN","PSBODO",139,0)
 ; LN   = total width of report writable area.       (opt,132 default)
"RTN","PSBODO",140,0)
 ; IND  = indent for both left and right margins.     (opt, 0 default)
"RTN","PSBODO",141,0)
 ; ALGN = align colon on this column.                (opt. 25 default)
"RTN","PSBODO",142,0)
 ; NONE = display empty Pharmacist intervention msg.  (opt, 0 default)
"RTN","PSBODO",143,0)
 ;
"RTN","PSBODO",144,0)
 N FLD,WP,WPTAG,WPLIN,HDG,INT,CTRTAB,LINE,L1,L2,XX
"RTN","PSBODO",145,0)
 S LN=+$G(LN,132),IND=+$G(IND),ALGN=$G(ALGN,25),NONE=$G(NONE,0)
"RTN","PSBODO",146,0)
 S LN=LN-(IND*2)         ;adj writeable area by both L & R margins
"RTN","PSBODO",147,0)
 ;
"RTN","PSBODO",148,0)
 ;pharmacist heading
"RTN","PSBODO",149,0)
 W !?IND,$TR($J("",LN)," ","=")
"RTN","PSBODO",150,0)
 S HDG="** Current Pharmacist Interventions for this order **"
"RTN","PSBODO",151,0)
 S CTRTAB=(LN-$L(HDG))/2
"RTN","PSBODO",152,0)
 W !?CTRTAB,HDG
"RTN","PSBODO",153,0)
 W !?IND,$TR($J("",LN)," ","="),!
"RTN","PSBODO",154,0)
 ;
"RTN","PSBODO",155,0)
 ;special scenario when NO Rph interventions, but Prv overrides do
"RTN","PSBODO",156,0)
 I NONE W !?IND,"No Pharmacist Interventions to display.",! Q
"RTN","PSBODO",157,0)
 ;
"RTN","PSBODO",158,0)
 ;pharmacist body text
"RTN","PSBODO",159,0)
 F INT=0:0 S INT=$O(ARR(DFN,PSBONX,INT)) Q:'INT  D
"RTN","PSBODO",160,0)
 .F FLD=0:0 S FLD=$O(ARR(DFN,PSBONX,INT,FLD)) Q:'FLD  D
"RTN","PSBODO",161,0)
 ..I FLD<1000 D
"RTN","PSBODO",162,0)
 ...S LINE=ARR(DFN,PSBONX,INT,FLD),XX=$F(LINE,":")
"RTN","PSBODO",163,0)
 ...S L1=$J($E(LINE,1,XX),ALGN),L2=$E(LINE,XX+1,$L(LINE))
"RTN","PSBODO",164,0)
 ...W !?IND,L1,L2
"RTN","PSBODO",165,0)
 ..I FLD>1000 D
"RTN","PSBODO",166,0)
 ...S (WP,WPLIN,WPTAG)="",LIN1=1
"RTN","PSBODO",167,0)
 ...F  S WP=$O(ARR(DFN,PSBONX,INT,FLD,WP)) Q:WP=""  D
"RTN","PSBODO",168,0)
 ....S LINE=ARR(DFN,PSBONX,INT,FLD,WP)
"RTN","PSBODO",169,0)
 ....I WP<1 D                          ;field Hdg line
"RTN","PSBODO",170,0)
 .....S LINE=$J(LINE,ALGN) W !?IND,LINE
"RTN","PSBODO",171,0)
 ....E  D                              ;detail WP lines
"RTN","PSBODO",172,0)
 .....I 'LIN1 W !
"RTN","PSBODO",173,0)
 .....W ?IND+ALGN,LINE
"RTN","PSBODO",174,0)
 .....S LIN1=0
"RTN","PSBODO",175,0)
 .W !
"RTN","PSBODO",176,0)
 W !
"RTN","PSBODO",177,0)
 Q
"RTN","PSBOIV")
0^14^B83398690^B78135572
"RTN","PSBOIV",1,0)
PSBOIV ;BIRMINGHAM/TEJ-IV BAG STATUS REPORT ;1/10/12 10:59am
"RTN","PSBOIV",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32,68**;Mar 2004;Build 26
"RTN","PSBOIV",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOIV",4,0)
 ;
"RTN","PSBOIV",5,0)
 ; Reference/IA
"RTN","PSBOIV",6,0)
 ; File 52.6/436
"RTN","PSBOIV",7,0)
 ; File 52.7/437
"RTN","PSBOIV",8,0)
 ; File 4/10090
"RTN","PSBOIV",9,0)
 ; File 2/10035 
"RTN","PSBOIV",10,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOIV",11,0)
 ; 
"RTN","PSBOIV",12,0)
 ;*68 - change to accomodate unlimited lines for SIOPI array
"RTN","PSBOIV",13,0)
 ;
"RTN","PSBOIV",14,0)
EN ; Entry
"RTN","PSBOIV",15,0)
 N PSB1,PSBFUTR,PSBSI,QQ
"RTN","PSBOIV",16,0)
 K PSBSRTBY,PSBOCRIT,PSBACRIT,NO S PSBCFLG=0
"RTN","PSBOIV",17,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOIV",18,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOIV",19,0)
 S PSBDTST=+$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBOIV",20,0)
 S PSBDTSP=+$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOIV",21,0)
 S PSBOCRIT=""        ;  Ord Sttus "A"ctive, "D"C ed, "E"xprd"
"RTN","PSBOIV",22,0)
 S:$P(PSBFUTR,U,5) PSBOCRIT=PSBOCRIT_"A"
"RTN","PSBOIV",23,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"D"
"RTN","PSBOIV",24,0)
 S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"E"
"RTN","PSBOIV",25,0)
 S PSBACRIT=""        ;  Actn Sttus "C"ompl, "I"nfusi, "M"issng, "S"tpped, "H"ld, "R"efsd", "N"o Actn
"RTN","PSBOIV",26,0)
 S:$P(PSBFUTR,U,12) PSBACRIT=PSBACRIT_"I"
"RTN","PSBOIV",27,0)
 S:$P(PSBFUTR,U,13) PSBACRIT=PSBACRIT_"S"
"RTN","PSBOIV",28,0)
 S:$P(PSBFUTR,U,14) PSBACRIT=PSBACRIT_"C"
"RTN","PSBOIV",29,0)
 S:$P(PSBFUTR,U,15) PSBACRIT=PSBACRIT_"N"
"RTN","PSBOIV",30,0)
 S:$P(PSBFUTR,U,16) PSBACRIT=PSBACRIT_"M"
"RTN","PSBOIV",31,0)
 S:$P(PSBFUTR,U,17) PSBACRIT=PSBACRIT_"H"
"RTN","PSBOIV",32,0)
 S:$P(PSBFUTR,U,18) PSBACRIT=PSBACRIT_"R"
"RTN","PSBOIV",33,0)
 D NOW^%DTC S (Y,PSBXNOW)=% D DD^%DT S:PSBDTSP=0 PSBDTSP=Y S PSBDTTM=Y
"RTN","PSBOIV",34,0)
 I +PSBDTST=0 S PSBDTST=X S PSBDTST=$$FMADD^XLFDT(PSBDTST,-3)_".0000"
"RTN","PSBOIV",35,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSB1)=""
"RTN","PSBOIV",36,0)
 K PSBLIST,PSBLIST2,PSBBGS,PSBNOX
"RTN","PSBOIV",37,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOIV",38,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOIV",39,0)
 S PSB1=$O(PSBLIST("")) I +PSB1'=0  K ^TMP("PSJ",$J) D EN^PSJBCMA(PSB1,PSBDTST,PSBDTST)
"RTN","PSBOIV",40,0)
 I ^TMP("PSJ",$J,1,0)'=-1 D
"RTN","PSBOIV",41,0)
 .S PINX=0 F  S PINX=$O(^TMP("PSJ",$J,PINX)) Q:+PINX'>0  D
"RTN","PSBOIV",42,0)
 ..S PSB2=$P(^TMP("PSJ",$J,PINX,0),U,3)
"RTN","PSBOIV",43,0)
 ..I PSB2["V" D  Q
"RTN","PSBOIV",44,0)
 ...; flter critri
"RTN","PSBOIV",45,0)
 ...D CLEAN^PSBVT,PSJ1^PSBVT(PSB1,PSB2)
"RTN","PSBOIV",46,0)
 ...Q:$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,$G(PSBIVPSH,0))
"RTN","PSBOIV",47,0)
 ...Q:PSBOST>PSBDTSP
"RTN","PSBOIV",48,0)
 ...I "DE"'[PSBOSTS I PSBOSP'>PSBXNOW S PSBOSTS="E"
"RTN","PSBOIV",49,0)
 ...Q:PSBOCRIT'[PSBOSTS  ;incl ord stat crit
"RTN","PSBOIV",50,0)
 ...Q:(PSBOSP<PSBXNOW)&(PSBOCRIT'["E")&(PSBOSTS'="D")
"RTN","PSBOIV",51,0)
 ...S PSBLIST2(PSB2,"OStart")=PSBOST
"RTN","PSBOIV",52,0)
 ...S PSBLIST2(PSB2,"OStop")=PSBOSP
"RTN","PSBOIV",53,0)
 ...S PSBLIST2(PSB2,"OStatus")=$S((PSBOSTS="D"):"Discontinued",(PSBOSTS="DE"):"Discontinued (Edit)",PSBXNOW>PSBOSP:"Expired",PSBOSTS="A":"Active",PSBOSTS="H":"On Hold",1:PSBOSTS)
"RTN","PSBOIV",54,0)
 ...;  *68
"RTN","PSBOIV",55,0)
 ...K ^TMP("PSJBCMA5",$J)
"RTN","PSBOIV",56,0)
 ...I PSBSIFLG D GETSIOPI^PSJBCMA5(PSB1,PSB2,1)
"RTN","PSBOIV",57,0)
 ...F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSB1,PSB2,QQ)) Q:'QQ  D
"RTN","PSBOIV",58,0)
 ....S PSBSI(PSB2,QQ)=^TMP("PSJBCMA5",$J,PSB1,PSB2,QQ)
"RTN","PSBOIV",59,0)
 ...;  *68 end
"RTN","PSBOIV",60,0)
 ...M PSBLIST2(PSB2,"ADD")=PSBADA
"RTN","PSBOIV",61,0)
 ...M PSBLIST2(PSB2,"SOL")=PSBSOLA
"RTN","PSBOIV",62,0)
 ...D EN^PSBPOIV(PSB1,PSB2)
"RTN","PSBOIV",63,0)
 ...I +$O(^TMP("PSBAR",$J,""))>0 S X="" F  S X=$O(^TMP("PSBAR",$J,X)) Q:+X=0  S PSBBGS(PSB2,X)=$P(^TMP("PSBAR",$J,X),U,2)
"RTN","PSBOIV",64,0)
 ...D:PSBACRIT["N"
"RTN","PSBOIV",65,0)
 ....S NO=1
"RTN","PSBOIV",66,0)
 ....I $D(PSBBGS(PSB2))  S X="" F  S X=$O(PSBBGS(PSB2,X)) Q:+X=0  I PSBBGS(PSB2,X)'="" S NO=0 Q
"RTN","PSBOIV",67,0)
 ....I $D(^PSB(53.79,"AORDX",PSB1,PSB2)) S NO=0 Q
"RTN","PSBOIV",68,0)
 ...I $G(NO,0) I PSBOSTS="A" S PSBNOX(PSB2)="",PSBTOT=PSBTOT+1 Q
"RTN","PSBOIV",69,0)
 ...I $D(^PSB(53.79,"AUID",PSB1,PSB2)) M PSBBGS(PSB2)=^PSB(53.79,"AUID",PSB1,PSB2)
"RTN","PSBOIV",70,0)
 ...; Get X - "ASSOC BAGS"
"RTN","PSBOIV",71,0)
 ...S X="" F  S X=$O(PSBBGS(PSB2,X)) Q:+X=0  I $G(PSBBGS(PSB2,X),"")'=""  D
"RTN","PSBOIV",72,0)
 ....S Y="" F  S Y=$O(^PSB(53.79,"AUID",PSB1,Y)) Q:Y=""  D  Q:Y="DONE"
"RTN","PSBOIV",73,0)
 .....I $D(^PSB(53.79,"AUID",PSB1,Y,X)) S PSBBGS(PSB2,X,$O(^PSB(53.79,"AUID",PSB1,Y,X,"")))="" S Y="DONE"
"RTN","PSBOIV",74,0)
 ...S X="" F  S X=$O(PSBBGS(PSB2,X)) Q:+X=0  I $O(PSBBGS(PSB2,X,""))="" K PSBBGS(PSB2,X)
"RTN","PSBOIV",75,0)
 ...S PSB3="" F  S PSB3=$O(PSBBGS(PSB2,PSB3)) Q:PSB3=""  D
"RTN","PSBOIV",76,0)
 ....S PSB4="" F  S PSB4=$O(PSBBGS(PSB2,PSB3,PSB4)) Q:+PSB4=0  D
"RTN","PSBOIV",77,0)
 .....I ($$GET1^DIQ(53.79,PSB4_",",.06,"I")'>PSBDTST)!($$GET1^DIQ(53.79,PSB4_",",.06,"I")'<PSBDTSP) K PSBBGS(PSB2,PSB3) Q
"RTN","PSBOIV",78,0)
 .....I PSBACRIT'[$$GET1^DIQ(53.79,PSB4_",",.09,"I") K PSBBGS(PSB2,PSB3) Q
"RTN","PSBOIV",79,0)
 .....S PSBBSTS(PSB2,PSB3,$$GET1^DIQ(53.79,PSB4_",",.09))=$$GET1^DIQ(53.79,PSB4_",",.06,"I"),PSBTOT=PSBTOT+1
"RTN","PSBOIV",80,0)
 .....I "SI"[$$GET1^DIQ(53.79,PSB4_",",.09,"I") I PSBXNOW>$$FMADD^XLFDT($$GET1^DIQ(53.79,PSB4_",",.06,"I"),,24) S PSB24HR(PSB2,PSB3)=""
"RTN","PSBOIV",81,0)
 .....I PSBCFLG S PSB5=0 F  S PSB5=$O(^PSB(53.79,PSB4,.3,PSB5)) Q:+PSB5=0  D
"RTN","PSBOIV",82,0)
 ......I $P(^PSB(53.79,PSB4,.3,PSB5,0),U,3)=$$GET1^DIQ(53.79,PSB4_",",.06,"I") S PSBCMNT(PSB2,PSB3)="Comment: "_$P(^PSB(53.79,PSB4,.3,PSB5,0),U)
"RTN","PSBOIV",83,0)
 S INX="" F  S INX=$O(PSBLIST2(INX)) Q:INX=""  I '$D(PSBBGS(INX))&'$D(PSBNOX(INX)) K PSBLIST2(INX)
"RTN","PSBOIV",84,0)
 I +PSBTOT=0 K PSBLIST
"RTN","PSBOIV",85,0)
 S Y=PSBDTST D DD^%DT S Y1=Y S Y=PSBDTSP D DD^%DT S Y2=Y
"RTN","PSBOIV",86,0)
 D CREATHDR
"RTN","PSBOIV",87,0)
 D SUBHDR^PSBOIV1
"RTN","PSBOIV",88,0)
 D BLDRPT
"RTN","PSBOIV",89,0)
 D WRTRPT
"RTN","PSBOIV",90,0)
 K PSBSILN,PSBOUTP,PSBLIST2,PSBCMNT,PSBNOX
"RTN","PSBOIV",91,0)
 Q
"RTN","PSBOIV",92,0)
BLDRPT ; Buld Reprt
"RTN","PSBOIV",93,0)
 S (PSB2,PSB3,PSB4)=""
"RTN","PSBOIV",94,0)
 S PSBTOPHD=PSBLNTOT
"RTN","PSBOIV",95,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOIV",96,0)
 .S PSBOUTP(0,14)="W !!,""<<<< NO DATA TO DISPLAY >>>>"",!!"
"RTN","PSBOIV",97,0)
 S PSBTOT1=0
"RTN","PSBOIV",98,0)
 K PSBDATA
"RTN","PSBOIV",99,0)
 K J S J=1
"RTN","PSBOIV",100,0)
 F  S PSB2=$O(PSBLIST2(PSB2)) Q:+PSB2=0  D
"RTN","PSBOIV",101,0)
 .S PSBORDX="" S PSBORDX=PSB2
"RTN","PSBOIV",102,0)
 .S PSBDATA(1)=$$FMTDT^PSBOIV1($E(PSBLIST2(PSB2,"OStart"),1,12))
"RTN","PSBOIV",103,0)
 .S PSBDATA(2)=$$FMTDT^PSBOIV1($E(PSBLIST2(PSB2,"OStop"),1,12))
"RTN","PSBOIV",104,0)
 .S PSBDATA(3)=PSBLIST2(PSB2,"OStatus")
"RTN","PSBOIV",105,0)
 .M PSBDATA(4,"ADD")=PSBLIST2(PSB2,"ADD") I $D(PSBDATA(4,"ADD",1)) S PSBDATA(4)="MED"
"RTN","PSBOIV",106,0)
 .M PSBDATA(4,"SOL")=PSBLIST2(PSB2,"SOL") I $D(PSBDATA(4,"SOL",1)) S PSBDATA(4)="MED"
"RTN","PSBOIV",107,0)
 .; Bag(s)
"RTN","PSBOIV",108,0)
 .I $D(PSBNOX(PSB2)) S PSBFLGD(PSB2," * No Action Taken On Order * ")=""
"RTN","PSBOIV",109,0)
 .I '$D(PSBNOX(PSB2))!(PSBACRIT["N")  F  S PSB3=$O(PSBBGS(PSB2,PSB3)) Q:+PSB3=0  D
"RTN","PSBOIV",110,0)
 ..S PSBDATA(5,PSB3)=PSB3
"RTN","PSBOIV",111,0)
 ..S PSBDATA(6,PSB3)=$O(PSBBSTS(PSB2,PSB3,""))
"RTN","PSBOIV",112,0)
 ..I $D(PSB24HR(PSB2,PSB3)) S PSBDATA(7,PSB3)=">24h"
"RTN","PSBOIV",113,0)
 ..I '$D(PSBNOX(PSB2)) S PSBDATA(8,PSB3)=$$FMTDT^PSBOIV1($E(PSBBSTS(PSB2,PSB3,PSBDATA(6,PSB3)),1,12))
"RTN","PSBOIV",114,0)
 ..E  S PSBDATA(8,PSB3)="No Action On Order"
"RTN","PSBOIV",115,0)
 .K PSBOPDAT M PSBOPDAT=PSBSI(PSB2)               ;*68
"RTN","PSBOIV",116,0)
 .S PSBTOT1=PSBTOT1+1
"RTN","PSBOIV",117,0)
 .K PSBRPLN,PSBSILN
"RTN","PSBOIV",118,0)
 .D BUILDLN,SIOPI^PSBOCM(.PSBOPDAT,PSBTAB8,"Other Print Info: ")
"RTN","PSBOIV",119,0)
 .I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+4 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOIV",120,0)
 .S (PSB1,PSB)="" I $D(PSBFLGD(PSB2)) F  S PSB=$O(PSBFLGD(PSB2,PSB)) Q:PSB=""  I ($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOIV",121,0)
 .S PSBCNT=PSBTOT1_"  ("_PSB2_") "_PSB1,$E(PSBCNT,IOM)="|"
"RTN","PSBOIV",122,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBCNT_""""
"RTN","PSBOIV",123,0)
 .F N=$O(PSBRPLN("")):1:$O(PSBRPLN(""),-1)  D
"RTN","PSBOIV",124,0)
 ..S PSB1X=0 S PSB1X=(($L(PSBRPLN(N),"""")-1)\2) I ($E(PSBRPLN(N),(PSBTAB8)+PSB1X)']" ") S $E(PSBRPLN(N),(PSBTAB8)+PSB1X)="|"
"RTN","PSBOIV",125,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(N)_""""
"RTN","PSBOIV",126,0)
 .K PSBRPLN,PSBDATA
"RTN","PSBOIV",127,0)
 .S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOIV",128,0)
 ..S PSB1X=0 S PSB1X=(($L(PSBSILN(I),"""")-1)\2)
"RTN","PSBOIV",129,0)
 ..I ($E(PSBSILN(I),(PSBTAB8)+PSB1X)']" ") S $E(PSBSILN(I),(PSBTAB8)+PSB1X)="|"
"RTN","PSBOIV",130,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOIV",131,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOIV",132,0)
 Q
"RTN","PSBOIV",133,0)
BUILDLN ; Constr recs
"RTN","PSBOIV",134,0)
 K J,LN S J(0)="" F PSBFLD=1:1:3 I $G(PSBDATA(PSBFLD))]"" S J=1 D FORMDAT^PSBOIV1(PSBFLD) S J=1
"RTN","PSBOIV",135,0)
 F X=1:1 Q:'$D(PSBDATA(4,"ADD",X))  D
"RTN","PSBOIV",136,0)
 .S PSBDATA(4)=$P(PSBDATA(4,"ADD",X),U,3)
"RTN","PSBOIV",137,0)
 .D FORMDAT^PSBOIV1(4)
"RTN","PSBOIV",138,0)
 .S J=$O(J(""),-1)+1
"RTN","PSBOIV",139,0)
 F X=1:1 Q:'$D(PSBDATA(4,"SOL",X))  D
"RTN","PSBOIV",140,0)
 .S PSBDATA(4)=$P(PSBDATA(4,"SOL",X),U,3)
"RTN","PSBOIV",141,0)
 .D FORMDAT^PSBOIV1(4)
"RTN","PSBOIV",142,0)
 .S J=$O(J(""),-1)+1
"RTN","PSBOIV",143,0)
 F PSBFLD=5:1:8 I $D(PSBDATA(PSBFLD)) K J S J=1 D
"RTN","PSBOIV",144,0)
 .S X="" F  S X=$O(PSBDATA(PSBFLD,X)) Q:+X=0  D
"RTN","PSBOIV",145,0)
 ..S PSBDATA(PSBFLD)=PSBDATA(PSBFLD,X)
"RTN","PSBOIV",146,0)
 ..I PSBFLD=5 S LN(X,J)=""
"RTN","PSBOIV",147,0)
 ..D:PSBFLD'=8 FORMDAT^PSBOIV1(PSBFLD)
"RTN","PSBOIV",148,0)
 ..S J=$O(J(""),-1)+1
"RTN","PSBOIV",149,0)
 ..I (PSBCFLG&(PSBFLD=5)),($D(PSBCMNT(PSB2,X))) D WRAPPER^PSBOIV1(PSBTAB4+1,(PSBTAB8-PSBTAB4)-1,PSBCMNT(PSB2,X)),WRAPPER^PSBOIV1(PSBTAB4+1,PSBTAB8-PSBTAB4," ")
"RTN","PSBOIV",150,0)
 .I PSBFLD=5 F J=1:1:$O(J(""),-1) S PREVLN(J)=$G(PSBRPLN(J),"")
"RTN","PSBOIV",151,0)
 .I PSBFLD'=5 I $D(PREVLN) S X="" F  S X=$O(LN(X)) Q:X=""  S J=$O(LN(X,"")) D:$D(PSBDATA(PSBFLD,X))
"RTN","PSBOIV",152,0)
 ..S $E(PREVLN(J),@("PSBTAB"_(PSBFLD-1))+1,@("PSBTAB"_(PSBFLD)))=PSBDATA(PSBFLD,X)
"RTN","PSBOIV",153,0)
 I $D(PREVLN) F J=1:1:$O(PREVLN(""),-1) S PSBRPLN(J)=PREVLN(J)
"RTN","PSBOIV",154,0)
 K PREVLN,LN
"RTN","PSBOIV",155,0)
 Q
"RTN","PSBOIV",156,0)
WRTRPT ;
"RTN","PSBOIV",157,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOIV",158,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),14)
"RTN","PSBOIV",159,0)
 .D FTR
"RTN","PSBOIV",160,0)
 S PSBPGNUM=1
"RTN","PSBOIV",161,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOIV",162,0)
 .I PSBPGNUM'=PSBZ D FTR S PSBPGNUM=PSBZ D HDR,SUBHDR^PSBOIV1
"RTN","PSBOIV",163,0)
 .S PSB2="" F  S PSB2=$O(PSBOUTP(PSBZ,PSB2)) Q:PSB2=""  D
"RTN","PSBOIV",164,0)
 ..X PSBOUTP(PSBZ,PSB2)
"RTN","PSBOIV",165,0)
 D FTR
"RTN","PSBOIV",166,0)
 Q
"RTN","PSBOIV",167,0)
HDR ;
"RTN","PSBOIV",168,0)
 W:$Y>1 @IOF
"RTN","PSBOIV",169,0)
 W:$X>1 !
"RTN","PSBOIV",170,0)
 S PSBRPNM="BCMA IV BAG STATUS REPORT"
"RTN","PSBOIV",171,0)
 S LN=0
"RTN","PSBOIV",172,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOIV",173,0)
 .S LN=LN+1,PSBHDR(LN)=PSBRPNM_" for "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" to "_$$FMTE^XLFDT($P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9))
"RTN","PSBOIV",174,0)
 .S LN=LN+1,PSBHDR(LN)="Order Status(es): --"
"RTN","PSBOIV",175,0)
 .F Y=5,7,8 I $P(PSBFUTR,U,Y) S $P(PSBHDR(LN),": ",2)=$P(PSBHDR(LN),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("^^^^Active^^DC'd^Expired^^^^^^^^^^",U,Y)_" " S PSBHDR(LN)=$TR(PSBHDR(LN),"-","")
"RTN","PSBOIV",176,0)
 .S LN=LN+1,PSBHDR(LN)="Bag Status(es): --"
"RTN","PSBOIV",177,0)
 .F Y=12:1:18 I $P(PSBFUTR,U,Y) S $P(PSBHDR(LN),": ",2)=$P(PSBHDR(LN),": ",2)_$S(PSBHDR(LN)["--":"",1:"/ ")_$P("^^^^^^^^^^^Infusing^Stopped^Completed^No Action Taken^Missing Dose^Held^Refused",U,Y)_" " S PSBHDR(LN)=$TR(PSBHDR(LN),"-","")
"RTN","PSBOIV",178,0)
 .I PSBCFLG S LN=LN+1,PSBHDR(LN)="Include Comments/Reasons"
"RTN","PSBOIV",179,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR) W !
"RTN","PSBOIV",180,0)
 Q
"RTN","PSBOIV",181,0)
FTR ;
"RTN","PSBOIV",182,0)
 I (IOSL<100) F  Q:$Y>(IOSL-5)  W !,?(IOM-1),"|"
"RTN","PSBOIV",183,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOIV",184,0)
 S PSBPGRM=PSBTAB8-($L(PSBPG))
"RTN","PSBOIV",185,0)
 D PTFTR^PSBOHDR()
"RTN","PSBOIV",186,0)
 W !,PSBRPNM,"     ",?(PSBPGRM-($L(PSBDTTM)+3)),PSBDTTM_"  "_PSBPG
"RTN","PSBOIV",187,0)
 Q
"RTN","PSBOIV",188,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOIV",189,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) S PSBPGNUM=PSBPGNUM+1,PSBLNTOT=PSBTOPHD S PSBMORE=$S(PSBMORE>(IOSL-(PSBTOPHD)):(IOSL-(PSBTOPHD)),1:PSBMORE)
"RTN","PSBOIV",190,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOIV",191,0)
 Q PSBPGNUM
"RTN","PSBOIV",192,0)
CREATHDR ;
"RTN","PSBOIV",193,0)
 K PSBHD1,PSBHD2
"RTN","PSBOIV",194,0)
 I IOM'<132 S PSBMORE=4,PSBHD1=$P($T(HD132A),";",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(H132BLK),";",2)
"RTN","PSBOIV",195,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" K PSBLIST2 Q
"RTN","PSBOIV",196,0)
 ; reset tabs
"RTN","PSBOIV",197,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOIV",198,0)
 S PSBPGNUM=1
"RTN","PSBOIV",199,0)
 D HDR
"RTN","PSBOIV",200,0)
 Q
"RTN","PSBOIV",201,0)
HD132A ;     Order       |       Order       |    Order     |     Medication      |      Bag UID      |    Bag    |     | Action Date/Time |
"RTN","PSBOIV",202,0)
 Q
"RTN","PSBOIV",203,0)
HD132B ;   Start Date    |      Stop Date    |    Status    |                     |                   |   Status  |     |                  |
"RTN","PSBOIV",204,0)
 Q
"RTN","PSBOIV",205,0)
H132BLK ;;
"RTN","PSBOIV",206,0)
 Q
"RTN","PSBOMH")
0^5^B83165444^B85302995
"RTN","PSBOMH",1,0)
PSBOMH ;BIRMINGHAM/EFC-MAH ;2/17/12 8:19am
"RTN","PSBOMH",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,9,38,57,67,68**;Mar 2004;Build 26
"RTN","PSBOMH",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBOMH",4,0)
 ;
"RTN","PSBOMH",5,0)
 ; Reference/IA
"RTN","PSBOMH",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMH",7,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBOMH",8,0)
 ; File 200/10060
"RTN","PSBOMH",9,0)
 ; ^DIWP/10011
"RTN","PSBOMH",10,0)
 ;
"RTN","PSBOMH",11,0)
 ;*68 - remove old special instruction text encoding, defer to PSBOMH2
"RTN","PSBOMH",12,0)
 ;
"RTN","PSBOMH",13,0)
EN ; Called from DQ^PSBO
"RTN","PSBOMH",14,0)
 N PSBGBL,DFN
"RTN","PSBOMH",15,0)
 S PSBGBL=$NAME(^TMP("PSBO",$J,"B"))
"RTN","PSBOMH",16,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,2)'=$J  Q:$QS(PSBGBL,1)'["PSBO"  D
"RTN","PSBOMH",17,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBOMH",18,0)
 .S (PSBSTRT,X)=$P(PSBRPT(.1),U,6) D H^%DTC S PSBSTH=%H
"RTN","PSBOMH",19,0)
 .S (PSBSTOP,X)=$P(PSBRPT(.1),U,8)+.235959 D H^%DTC S PSBSPH=%H
"RTN","PSBOMH",20,0)
 .S PSBCNT=0 F I=PSBSTH:1:PSBSPH S PSBAR(I)=PSBSTH+((PSBCNT\7)*7),PSBCNT=PSBCNT+1
"RTN","PSBOMH",21,0)
 .D EN1
"RTN","PSBOMH",22,0)
 K PSBCNT,PSBAR Q
"RTN","PSBOMH",23,0)
EN1 ; Expects DFN,STRT,STOP
"RTN","PSBOMH",24,0)
 N PSBGBL,PSBHDR,PSBX,PSBFLAG,PSBHLDFL,PSBADST1,PSBOST1
"RTN","PSBOMH",25,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOMH",26,0)
 S PSBEVDT=PSBSTRT
"RTN","PSBOMH",27,0)
 D EN^PSJBCMA(DFN,PSBSTRT)
"RTN","PSBOMH",28,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 D PT^PSBOHDR(DFN,.PSBHDR) W !!,"****NO MEDICATIONS FOUND****" Q  ; No Ord
"RTN","PSBOMH",29,0)
 S PSBX=""
"RTN","PSBOMH",30,0)
 F  S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:PSBX=""  D
"RTN","PSBOMH",31,0)
 .Q:$P(^TMP("PSJ",$J,PSBX,0),U,3)?.N1"P"  ; No Pnd
"RTN","PSBOMH",32,0)
 .Q:$P(^TMP("PSJ",$J,PSBX,1),U,5)<PSBSTRT!($P(^TMP("PSJ",$J,PSBX,1),U,4)>PSBSTOP)  ;display orders active in date range of report
"RTN","PSBOMH",33,0)
 .S X=$P(^TMP("PSJ",$J,PSBX,1),U,2)
"RTN","PSBOMH",34,0)
 .S ^TMP("PSB",$J,"ORDERS",$P(^TMP("PSJ",$J,PSBX,0),U,3))=X
"RTN","PSBOMH",35,0)
 I '$D(^TMP("PSB",$J,"ORDERS")) D PT^PSBOHDR(DFN,.PSBHDR) W !!,"****NO MEDICATIONS FOUND****" Q    ; No Orders
"RTN","PSBOMH",36,0)
 S PSBMHND="PSBOMH"
"RTN","PSBOMH",37,0)
 ; Act on Orders
"RTN","PSBOMH",38,0)
 S PSBX="" F  S PSBX=$O(^TMP("PSB",$J,"ORDERS",PSBX)) Q:PSBX=""  S PSBTYPE=^(PSBX) D
"RTN","PSBOMH",39,0)
 .S:PSBTYPE'="C" PSBTYPE="P"
"RTN","PSBOMH",40,0)
 .D CLEAN^PSBVT
"RTN","PSBOMH",41,0)
 .D PSJ1^PSBVT(DFN,PSBX)
"RTN","PSBOMH",42,0)
 .S X1=((PSBEVDT)\1)  S X2=-1  D C^%DTC  S PSBCNTST=X
"RTN","PSBOMH",43,0)
 .S X1=((PSBSTOP)\1)  S X2=1  D C^%DTC  S PSBXSTOP=X
"RTN","PSBOMH",44,0)
 .S PSBVALB=""
"RTN","PSBOMH",45,0)
 .S PSBVALB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH)
"RTN","PSBOMH",46,0)
 .S PSBZ=""
"RTN","PSBOMH",47,0)
 .S X1=PSBXSTOP,X2=PSBCNTST D ^%DTC S PSBNCT=X
"RTN","PSBOMH",48,0)
 .F PSBZ=1:1:PSBNCT S X1=PSBCNTST  S X2=1  D C^%DTC  S PSBCNTST=X  D
"RTN","PSBOMH",49,0)
 ..I (PSBX["V")!(PSBX'["V")  D
"RTN","PSBOMH",50,0)
 ...I PSBCNTST'>(PSBOST\1) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",51,0)
 ...;add check for admin time before start time in PSB*3*57
"RTN","PSBOMH",52,0)
 ...S PSBADST1=$E($P($G(PSBADST),"-",$L($G(PSBADST),"-"))_"00",1,4),PSBOST1=$E($P(PSBOST,".",2)_"0000",1,4) ;PSB*3*67
"RTN","PSBOMH",53,0)
 ...I PSBCNTST=(PSBOST\1)&(PSBADST1>PSBOST1) K ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST) ;PSB*3*67
"RTN","PSBOMH",54,0)
 ...I PSBCNTST=(PSBOST\1),'$P($G(PSBADST),"-") K ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST) ;PSB*3*67
"RTN","PSBOMH",55,0)
 ...I PSBCNTST>(PSBOSP\1) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",56,0)
 ...I PSBCNTST=(PSBOSP\1)&($G(^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST))) K ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",57,0)
 ..S PSBDODD=""
"RTN","PSBOMH",58,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBDODD=1
"RTN","PSBOMH",59,0)
 ..I ((PSBX'["V")!(PSBVALB="1")),((PSBDODD="1")&(PSBADST'="")) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""
"RTN","PSBOMH",60,0)
 ..I ((PSBX'["V")!(PSBVALB="1")),('$$OKAY^PSBVDLU1(PSBOST,PSBCNTST,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)) S ^TMP("PSB",$J,"ORDERS",PSBONX,"NTDUE",PSBCNTST)=""  ;W t TMP
"RTN","PSBOMH",61,0)
 .S (PSBYES,PSBODD,PSBFLAG,PSBYTFN,PSBDAYN)=0
"RTN","PSBOMH",62,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1,PSBDAYN=1
"RTN","PSBOMH",63,0)
 .I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" Q 
"RTN","PSBOMH",64,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTFN=1
"RTN","PSBOMH",65,0)
 .I (PSBFREQ="O")!(PSBTYPE="P") S PSBYES=1
"RTN","PSBOMH",66,0)
 .I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOMH",67,0)
 .;flg / admn t
"RTN","PSBOMH",68,0)
 .S:PSBONX["U" PSBFLAG=1
"RTN","PSBOMH",69,0)
 .I PSBIVT="A" S PSBADST="0000"
"RTN","PSBOMH",70,0)
 .I PSBIVT="H" S PSBADST="0000"
"RTN","PSBOMH",71,0)
 .I PSBIVT="C",PSBCHEMT="P" S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",72,0)
 .I PSBIVT="C",PSBISYR=1 S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",73,0)
 .I PSBIVT="C",PSBCHEMT="A" S PSBADST="0000"
"RTN","PSBOMH",74,0)
 .I PSBIVT="C",PSBISYR=0 S PSBADST="0000"
"RTN","PSBOMH",75,0)
 .I PSBIVT="P",($G(PSBADST)=0) S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",76,0)
 .I PSBIVT="P" S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",77,0)
 .I PSBIVT="S",PSBISYR=0 S PSBADST="0000"
"RTN","PSBOMH",78,0)
 .I PSBIVT="S",PSBISYR=1 S:PSBADST="" PSBFLAG=1
"RTN","PSBOMH",79,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOMH",80,0)
 .I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBOMH",81,0)
 .S (PSBEE,PSBZZ)=0
"RTN","PSBOMH",82,0)
 .I (PSBVALB="1")!(PSBX'["V") D  Q:(PSBEE!PSBZZ)=1
"RTN","PSBOMH",83,0)
 ..I PSBSCHT="C",PSBYTFN="1",PSBADST=""  S PSBEE=1
"RTN","PSBOMH",84,0)
 ..I PSBSCHT="C",PSBDAYN'="1",PSBYTFN'="1",PSBADST'="",PSBFREQ<1  S PSBZZ=1
"RTN","PSBOMH",85,0)
 .I 'PSBODD,PSBFLAG,PSBTYPE="C",PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBSTOP)
"RTN","PSBOMH",86,0)
 .E  I PSBADST'="" K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOMH",87,0)
 .;Calc adm/frq
"RTN","PSBOMH",88,0)
 .S PSBDT=PSBSTRT
"RTN","PSBOMH",89,0)
 .K PSBO,^UTILITY($J)
"RTN","PSBOMH",90,0)
 .F X=1:1:8 S PSBO(X)=""
"RTN","PSBOMH",91,0)
 .S DIWL=0,DIWR=32,DIWF="C32"
"RTN","PSBOMH",92,0)
 .S X=$P(PSBOSTX," ")_"          "_$P(PSBOSPX," ") D ^DIWP
"RTN","PSBOMH",93,0)
 .S X="@"_$P(PSBOSTX," ",3)_"              @"_$P(PSBOSPX," ",3)_"   " D ^DIWP
"RTN","PSBOMH",94,0)
 .S X="" D ^DIWP
"RTN","PSBOMH",95,0)
 .S X=PSBOITX D ^DIWP
"RTN","PSBOMH",96,0)
 .; DD,SOL,ADD
"RTN","PSBOMH",97,0)
 .S X=""
"RTN","PSBOMH",98,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  S X=X_$S(X]"":", ",1:"")_$P(PSBDDA(Y),U,3)
"RTN","PSBOMH",99,0)
 .F Y=0:0 S Y=$O(PSBADA(Y)) Q:'Y  S X=X_$S(X]"":", ",1:"")_$P(PSBADA(Y),U,3)_" "_$P(PSBADA(Y),U,4)_$P(PSBADA(Y),U,5)
"RTN","PSBOMH",100,0)
 .F Y=0:0 S Y=$O(PSBSOLA(Y)) Q:'Y  S X=X_$S(X]"":", ",1:"")_$P(PSBSOLA(Y),U,3)_" "_$P(PSBSOLA(Y),U,4)
"RTN","PSBOMH",101,0)
 .S X=" "_X,DIWF="I2C32" D ^DIWP S DIWF="C32"
"RTN","PSBOMH",102,0)
 .S PSBTXT=" Give: "_PSBDOSE_" "_PSBMRAB_" "_PSBSCH_" "_PSBIFR
"RTN","PSBOMH",103,0)
 .F  S PSBWORD=$P(PSBTXT," ",1),PSBTXT=$P(PSBTXT," ",2,250) D  Q:PSBTXT=""
"RTN","PSBOMH",104,0)
 ..F  Q:'$L(PSBWORD)  S X=$E(PSBWORD,1,30),PSBWORD=$E(PSBWORD,30,250) D ^DIWP
"RTN","PSBOMH",105,0)
 .K ^TMP("PSJ",$J) D EN^PSJBCMA2(DFN,PSBX) I ^TMP("PSJ",$J,0)'=-1 D   ;get activity log
"RTN","PSBOMH",106,0)
 ..S (PSBDISX,PSBHLDX)=0 F I=1:1:$P(^TMP("PSJ",$J,0),U,4) S X=$G(^TMP("PSJ",$J,I,1)) D  ;loop activities
"RTN","PSBOMH",107,0)
 ...Q:X["EDITED"!(X["VERIF")  ;
"RTN","PSBOMH",108,0)
 ...S:$P(X,U,4)["PLACED ON HOLD" PSBHLDFL=1 ;Set Hold Flag
"RTN","PSBOMH",109,0)
 ...S:$P(X,U,4)["TAKEN OFF HOLD" PSBHLDFL=0 ;Remove Hold Flag
"RTN","PSBOMH",110,0)
 ...S Z=0
"RTN","PSBOMH",111,0)
 ...I X'["OFF HOLD",X'["UNHOLD",X'["REINSTATE" S Z=1 ; inc iv's
"RTN","PSBOMH",112,0)
 ...S PSBHLDX=PSBHLDX+$S(Z>0:1,1:0)
"RTN","PSBOMH",113,0)
 ...S $P(PSBHLD(PSBHLDX),U,$S(Z>0:1,1:11))=^TMP("PSJ",$J,I,1)  ;set up for multiple on hold entries save start & stop as pair if exists 
"RTN","PSBOMH",114,0)
 ..F PSBHLDX=1:1 S X=$G(PSBHLD(PSBHLDX)) Q:'X  D  ;if a hold index - process 
"RTN","PSBOMH",115,0)
 ...S PSBHLDN=$P(PSBHLD(PSBHLDX),U,1),PSBHLDF=$P(PSBHLD(PSBHLDX),U,11)  ;get on/off hold, dates, IEN number(for UD orders) of person. 
"RTN","PSBOMH",116,0)
 ...Q:PSBHLDN>PSBSTOP  Q:(PSBHLDF<PSBSTRT)&(PSBHLDF'="") 
"RTN","PSBOMH",117,0)
 ...F PSBHLDT=PSBSTRT\1:1:PSBSTOP\1 I (PSBHLDT'<(PSBHLDN\1)),(PSBHLDT'>PSBSTOP) D
"RTN","PSBOMH",118,0)
 ....I X["DISCONTINUED" K ^TMP("PSB",$J,"ORDERS",PSBONX,"HOLD",PSBHLDT) S ^TMP("PSB",$J,"ORDERS",PSBONX,"DISC",PSBHLDT)=""
"RTN","PSBOMH",119,0)
 ....I (X["HOLD")&($G(PSBHLDFL))&((PSBHLDN\1)'>PSBHLDT)&((PSBHLDF'<PSBHLDT)!(PSBHLDF="")) S ^TMP("PSB",$J,"ORDERS",PSBONX,"HOLD",PSBHLDT)="" ;Check additional flag for PSB*3*57
"RTN","PSBOMH",120,0)
 ....I X["REINSTATE" K ^TMP("PSB",$J,"ORDERS",PSBONX,"DISC",PSBHLDT) I PSBOSTS="H" S ^TMP("PSB",$J,"ORDERS",PSBONX,"HOLD",PSBHLDT)=""
"RTN","PSBOMH",121,0)
 ...F PSBHLDXP=1:10:$P(PSBHLD(PSBHLDX),U,11)]""+10 D
"RTN","PSBOMH",122,0)
 ....S PSBDESC=$P(PSBHLD(PSBHLDX),U,PSBHLDXP+3),X=$S(PSBDESC["DISCONTINUE":"***",1:"")
"RTN","PSBOMH",123,0)
 ....S X=" "_X_PSBDESC D ^DIWP  ;output activity text 
"RTN","PSBOMH",124,0)
 ....S X="",PSBHLDI=$P(PSBHLD(PSBHLDX),U,PSBHLDXP+4) I PSBHLDI'="" S X=$$GET1^DIQ(200,PSBHLDI,"INITIAL")
"RTN","PSBOMH",125,0)
 ....S:X="" X="99" ;no init present
"RTN","PSBOMH",126,0)
 ....I X'="99" S X=" "_X D ^DIWP   ;get init & store
"RTN","PSBOMH",127,0)
 ....S Y=$P(PSBHLD(PSBHLDX),U,PSBHLDXP) D DD^%DT S X=Y D ^DIWP  ;format hold date / write 
"RTN","PSBOMH",128,0)
 ..K PSBHLD,PSBHLDF,PSBHLDN,PSBHLDT,PSBHLDX,PSBHLDXP,PSBHLDI,PSBDISX,PSBDISC,PSBDISXP,PSBDISI,PSBDIST,PSBDISN,PSBDESC
"RTN","PSBOMH",129,0)
 .F X=0:0 S X=$O(^UTILITY($J,"W",0,X)) Q:'X  S PSBO(X)=$G(^(X,0)) D
"RTN","PSBOMH",130,0)
 .S X=$O(PSBO(""),-1) S X=$S(X<8:8,1:X+1)
"RTN","PSBOMH",131,0)
 .S PSBO(X)=" RPH: "_PSBVPHI_"  RN: "_PSBVNI
"RTN","PSBOMH",132,0)
 .S PSBVAL=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH)
"RTN","PSBOMH",133,0)
 .I PSBODD="1",PSBADST'="" D
"RTN","PSBOMH",134,0)
 ..I (PSBVAL="1")!(PSBX'["V") D   ;checks iv/pb and u dose
"RTN","PSBOMH",135,0)
 ...S PSBO(X+1)=""
"RTN","PSBOMH",136,0)
 ...S PSBO(X+2)="NOTE - ODD SCHEDULE NO LONGER",PSBO(X+3)="       ALLOWS ADMIN TIMES."
"RTN","PSBOMH",137,0)
 .K ^UTILITY($J)
"RTN","PSBOMH",138,0)
 .M ^TMP("PSB",$J,"ORDERS",PSBX,"INST")=PSBO
"RTN","PSBOMH",139,0)
 .D:PSBTYPE="C"
"RTN","PSBOMH",140,0)
 ..F  D  Q:PSBDT>PSBSTOP
"RTN","PSBOMH",141,0)
 ...S X=PSBDT D H^%DTC S PSBWEEK=%H
"RTN","PSBOMH",142,0)
 ...S ^TMP("PSB",$J,PSBWEEK,PSBONX)=""
"RTN","PSBOMH",143,0)
 ...; Odd schd - msg
"RTN","PSBOMH",144,0)
 ...S PSBIDOW=0 I PSBONX["U"!("PCS"[PSBIVT) S PSBIDOW=1
"RTN","PSBOMH",145,0)
 ...I PSBADST="",PSBIDOW,(PSBODD) D
"RTN","PSBOMH",146,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",0)=7
"RTN","PSBOMH",147,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",1)="odd"
"RTN","PSBOMH",148,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",2)="sched"
"RTN","PSBOMH",149,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",3)=$E(PSBSCH,1,5)
"RTN","PSBOMH",150,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",4)="no"
"RTN","PSBOMH",151,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",5)="fixed"
"RTN","PSBOMH",152,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",6)="admin"
"RTN","PSBOMH",153,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",7)="times"
"RTN","PSBOMH",154,0)
 ...I PSBADST'="",PSBADST'="0000",+$G(PSBFREQ)>0,+$G(PSBFREQ)<45 D
"RTN","PSBOMH",155,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",0)=5
"RTN","PSBOMH",156,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",1)="Due"
"RTN","PSBOMH",157,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",2)="every"
"RTN","PSBOMH",158,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",3)=$E(PSBFREQ,1,5)
"RTN","PSBOMH",159,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",4)="mins."
"RTN","PSBOMH",160,0)
 ....S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",5)=" "
"RTN","PSBOMH",161,0)
 ...S PSBATCNT=0    ; # times to print...
"RTN","PSBOMH",162,0)
 ...I PSBADST'="",((+$G(PSBFREQ)>44)!(PSBFREQ="")!(PSBADST="0000")) F PSBXX=0:1  Q:$G(^TMP("PSB",$J,"GETADMIN",PSBXX))=""  D
"RTN","PSBOMH",163,0)
 ....S PSBADST2=$G(^TMP("PSB",$J,"GETADMIN",PSBXX))
"RTN","PSBOMH",164,0)
 ....F Y=1:1:$L(PSBADST2,"-") D
"RTN","PSBOMH",165,0)
 .....Q:($P(PSBADST2,"-",Y)'?2N)&($P(PSBADST2,"-",Y)'?4N)  S PSBATCNT=PSBATCNT+1,^TMP("PSB",$J,"ORDERS",PSBONX,"AT",PSBATCNT)=$P(PSBADST2,"-",Y)
"RTN","PSBOMH",166,0)
 ...I PSBADST'="",PSBFREQ>44 S ^TMP("PSB",$J,"ORDERS",PSBONX,"AT",0)=PSBATCNT
"RTN","PSBOMH",167,0)
 ...S ^TMP("PSB",$J,PSBWEEK,"SORT",PSBTYPE,PSBOITX,PSBX)=""
"RTN","PSBOMH",168,0)
 ...F PSBDOW=0:1:6 D  Q:X>(PSBSTOP-1)
"RTN","PSBOMH",169,0)
 ....S %H=PSBWEEK+PSBDOW D YMD^%DTC
"RTN","PSBOMH",170,0)
 ....S ^TMP("PSB",$J,PSBWEEK,PSBONX,X,0)=0
"RTN","PSBOMH",171,0)
 ....I '$D(^TMP("PSB",$J,PSBWEEK,"HDR",X)) S ^TMP("PSB",$J,PSBWEEK,"HDR",X)=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3))
"RTN","PSBOMH",172,0)
 ...S %H=PSBWEEK+7 D YMD^%DTC S PSBDT=X
"RTN","PSBOMH",173,0)
 .D:PSBTYPE'="C"
"RTN","PSBOMH",174,0)
 ..S X=PSBDT D H^%DTC S PSBWEEK=%H
"RTN","PSBOMH",175,0)
 ..S (^TMP("PSB",$J,PSBWEEK,PSBONX),^TMP("PSB",$J,PSBWEEK,PSBONX,"AT",0))="",^TMP("PSB",$J,PSBWEEK,"SORT",PSBTYPE,PSBOITX,PSBX)=""
"RTN","PSBOMH",176,0)
 D EN^PSBOMH1,EN^PSBOMH2
"RTN","PSBOMH",177,0)
 Q
"RTN","PSBOMH",178,0)
INSTR S PSBINIT=PSBINIT_"*"
"RTN","PSBOMH",179,0)
 S PSBNAME=PSBNAME_"/"_$P(^PSB(53.79,PSBIEN,.9,$P(PSBDT,"."),0),U,3)_"  "_$$GET1^DIQ(53.79,PSBIEN_",",.06)
"RTN","PSBOMH",180,0)
 Q
"RTN","PSBOMH",181,0)
 ;
"RTN","PSBOMH2")
0^6^B46571592^B39219364
"RTN","PSBOMH2",1,0)
PSBOMH2 ;BIRMINGHAM/EFC-MAH ;4/12/12 9:46am
"RTN","PSBOMH2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,20,27,26,67,68**;Mar 2004;Build 26
"RTN","PSBOMH2",3,0)
 ;
"RTN","PSBOMH2",4,0)
 ; Reference/IA
"RTN","PSBOMH2",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMH2",6,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBOMH2",7,0)
 ;
"RTN","PSBOMH2",8,0)
 ;*68 - Add ability to get special instructions at end of each orders
"RTN","PSBOMH2",9,0)
 ;      grid and print in free space before next orders grid, check
"RTN","PSBOMH2",10,0)
 ;      for page overflow each line of word processing text.
"RTN","PSBOMH2",11,0)
 ;
"RTN","PSBOMH2",12,0)
EN ;
"RTN","PSBOMH2",13,0)
 ; Okay, let's print this puppy
"RTN","PSBOMH2",14,0)
 S PSBWEEK=0
"RTN","PSBOMH2",15,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",16,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT","C"))
"RTN","PSBOMH2",17,0)
 ..D CONT
"RTN","PSBOMH2",18,0)
 ;
"RTN","PSBOMH2",19,0)
 ; Now the PRN/One Time/On-Call Sheets
"RTN","PSBOMH2",20,0)
 S PSBWEEK=0
"RTN","PSBOMH2",21,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",22,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT","P"))
"RTN","PSBOMH2",23,0)
 ..D PRN
"RTN","PSBOMH2",24,0)
 ;
"RTN","PSBOMH2",25,0)
 D LEGEND
"RTN","PSBOMH2",26,0)
 Q
"RTN","PSBOMH2",27,0)
 ;
"RTN","PSBOMH2",28,0)
CONT ;
"RTN","PSBOMH2",29,0)
 N SILN,SITXT
"RTN","PSBOMH2",30,0)
 S PSBHDR(1)="Continuing/PRN/Stat/One Time Medication/Treatment Record (VAF 10-2970 B, C, D)"
"RTN","PSBOMH2",31,0)
 W $$HDR()
"RTN","PSBOMH2",32,0)
 S PSBDRUG=""
"RTN","PSBOMH2",33,0)
 F  S PSBDRUG=$O(^TMP("PSB",$J,PSBWEEK,"SORT","C",PSBDRUG)) Q:PSBDRUG=""  D
"RTN","PSBOMH2",34,0)
 .S PSBORD=""
"RTN","PSBOMH2",35,0)
 .F  S PSBORD=$O(^TMP("PSB",$J,PSBWEEK,"SORT","C",PSBDRUG,PSBORD)) Q:'PSBORD  D
"RTN","PSBOMH2",36,0)
 ..;S X="",PSBNAF=0 F  S X=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,X)) Q:X=""  I ^TMP("PSB",$J,PSBWEEK,PSBORD,X,0)'=0 S PSBNAF=1  ; check for data
"RTN","PSBOMH2",37,0)
 ..;D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBOMH2",38,0)
 ..;S X=PSBOST D H^%DTC S PSBOSTH=%H
"RTN","PSBOMH2",39,0)
 ..;S X=PSBOSP D H^%DTC S PSBOSPH=%H
"RTN","PSBOMH2",40,0)
 ..;I PSBNAF=0 Q
"RTN","PSBOMH2",41,0)
 ..;I PSBNAF=0,$G(PSBAR(PSBOSTH))'=PSBWEEK,$G(PSBAR(PSBOSPH))'=PSBWEEK Q  ; no data for this week and neither start or stop date is this week
"RTN","PSBOMH2",42,0)
 ..S PSBCNT=8
"RTN","PSBOMH2",43,0)
 ..S:$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)>PSBCNT PSBCNT=$O(^(""),-1)
"RTN","PSBOMH2",44,0)
 ..S:$O(^TMP("PSB",$J,"ORDERS",PSBORD,"AT",""),-1)>PSBCNT PSBCNT=$O(^(""),-1)
"RTN","PSBOMH2",45,0)
 ..W:$Y>(IOSL-PSBCNT-4) $$HDR()
"RTN","PSBOMH2",46,0)
 ..F PSBLINE=1:1:PSBCNT D
"RTN","PSBOMH2",47,0)
 ...D CHKPAGE                ;*68 convert overflow logic to a tag call
"RTN","PSBOMH2",48,0)
 ...W !,$G(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",PSBLINE))
"RTN","PSBOMH2",49,0)
 ...W ?32,"| ",$G(^TMP("PSB",$J,"ORDERS",PSBORD,"AT",PSBLINE))
"RTN","PSBOMH2",50,0)
 ...S PSBDAY=0,PSBCOL=0
"RTN","PSBOMH2",51,0)
 ...F  S PSBDAY=$O(^TMP("PSB",$J,PSBWEEK,"HDR",PSBDAY)) Q:'PSBDAY  D
"RTN","PSBOMH2",52,0)
 ....W ?(40+(PSBCOL*13)),"|" ;Remove space, PSB*3*67
"RTN","PSBOMH2",53,0)
 ....S Y=$G(^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDAY,PSBLINE))
"RTN","PSBOMH2",54,0)
 ....;Write space when status does not contain >, PSB*3*67
"RTN","PSBOMH2",55,0)
 ....I ($L($P(Y,U,2))'=5)!($P(Y,U,3)'="RM"),($P(Y,U,3)'[">") W " "
"RTN","PSBOMH2",56,0)
 ....W $P(Y,U,3)
"RTN","PSBOMH2",57,0)
 ....W $E($P($P(Y,U,1)_"0000",".",2),1,4)," "
"RTN","PSBOMH2",58,0)
 ....W $P(Y,U,2)
"RTN","PSBOMH2",59,0)
 ....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"HOLD",PSBDAY)),(PSBLINE=PSBCNT) W "HOLD"  ;output hold status
"RTN","PSBOMH2",60,0)
 ....I '$D(^TMP("PSB",$J,"ORDERS",PSBORD,"DISC",PSBDAY))&'$D(^TMP("PSB",$J,"ORDERS",PSBORD,"HOLD",PSBDAY)) D
"RTN","PSBOMH2",61,0)
 .....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"NTDUE",PSBDAY)),(PSBLINE=PSBCNT) W "***"  ;write *** when day no due
"RTN","PSBOMH2",62,0)
 ....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"DISC",PSBDAY)),(PSBLINE=PSBCNT) W "***"   ;output discontinued status
"RTN","PSBOMH2",63,0)
 ....S PSBCOL=PSBCOL+1
"RTN","PSBOMH2",64,0)
 ..D SIOPI                     ;*68 get and print SI lines, if exist
"RTN","PSBOMH2",65,0)
 ..W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",66,0)
 Q
"RTN","PSBOMH2",67,0)
 ;
"RTN","PSBOMH2",68,0)
PRN ;
"RTN","PSBOMH2",69,0)
 S PSBHDR(1)="Continuing/PRN/Stat/One Time Medication/Treatment Record (VAF 10-2970 B, C, D)"
"RTN","PSBOMH2",70,0)
 W $$HDR(1)
"RTN","PSBOMH2",71,0)
 S PSBDRUG=""
"RTN","PSBOMH2",72,0)
 F  S PSBDRUG=$O(^TMP("PSB",$J,PSBWEEK,"SORT","P",PSBDRUG)) Q:PSBDRUG=""  D
"RTN","PSBOMH2",73,0)
 .S PSBORD=""
"RTN","PSBOMH2",74,0)
 .F  S PSBORD=$O(^TMP("PSB",$J,PSBWEEK,"SORT","P",PSBDRUG,PSBORD)) Q:'PSBORD  D
"RTN","PSBOMH2",75,0)
 ..S PSBCNT=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",""),-1)
"RTN","PSBOMH2",76,0)
 ..D:PSBCNT<$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)
"RTN","PSBOMH2",77,0)
 ...S PSBCNT=$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)
"RTN","PSBOMH2",78,0)
 ..S:PSBCNT<8 PSBCNT=8  ; Minimum space for order
"RTN","PSBOMH2",79,0)
 ..W:$Y>(IOSL-PSBCNT-4) $$HDR(1)
"RTN","PSBOMH2",80,0)
 ..F PSBLINE=1:1:PSBCNT D
"RTN","PSBOMH2",81,0)
 ...D CHKPAGE                  ;*68 move overflow page logic to a tag
"RTN","PSBOMH2",82,0)
 ...W !,$G(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",PSBLINE))
"RTN","PSBOMH2",83,0)
 ...W ?32,"| ",$G(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",PSBLINE))
"RTN","PSBOMH2",84,0)
 ..D SIOPI                     ;*68 get and print SI lines, if exist
"RTN","PSBOMH2",85,0)
 ..W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",86,0)
 Q
"RTN","PSBOMH2",87,0)
 ;
"RTN","PSBOMH2",88,0)
LEGEND ;
"RTN","PSBOMH2",89,0)
 ;print the initials - name legend as an extra page  ;
"RTN","PSBOMH2",90,0)
 ;I '$D(^TMP("PSB",$J,"LEGEND")) K ^TMP("PSJ",$J),^TMP("PSB",$J) Q  ;
"RTN","PSBOMH2",91,0)
 D PT^PSBOHDR(DFN,.PSBHDR)  ;
"RTN","PSBOMH2",92,0)
 W !!,"Initial - Name Legend",!  ;
"RTN","PSBOMH2",93,0)
 I $D(^TMP("PSB",$J,"LEGEND"))  D
"RTN","PSBOMH2",94,0)
 .S X=$Q(^TMP("PSB",$J,"LEGEND",""))
"RTN","PSBOMH2",95,0)
 .F  W $S($QS(X,4)[99:"",1:$QS(X,4)),?10,$QS(X,5),! S X=$Q(@X) Q:$QS(X,3)'="LEGEND"  ;
"RTN","PSBOMH2",96,0)
 W !!,"Status Codes",!,"C - Completed",!,"G - Given",!,"H - Held",!,"I - Infusing",!,"M - Missing Dose Requested",!,"R - Refused",!,"RM - Removed",!,"S - Stopped",!  ;
"RTN","PSBOMH2",97,0)
 W "> - Scheduled administration times for the order have been changed",!,"*** - Medication Not Due",! ;add changed Admin time message, PSB*3*67
"RTN","PSBOMH2",98,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOMH2",99,0)
 Q
"RTN","PSBOMH2",100,0)
 ;
"RTN","PSBOMH2",101,0)
HDR(PRN) ;
"RTN","PSBOMH2",102,0)
 ; PRN = TRUE IF DISPLAYING PRN MED (OPTIONAL)
"RTN","PSBOMH2",103,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBOMH2",104,0)
 W !,"Start Date",?20,"Stop Date",?32,"| ",$S('$G(PRN):"Admin",1:"Action Status")
"RTN","PSBOMH2",105,0)
 I '$G(PRN) F X=0:1:6 W ?(40+(X*13)),"|"
"RTN","PSBOMH2",106,0)
 W !,"and Time",?20,"and Time",?32,"| ",$S('$G(PRN):"Times",1:"Action Date/Times")
"RTN","PSBOMH2",107,0)
 D:'$G(PRN)
"RTN","PSBOMH2",108,0)
 .S PSBCOL=0,X=0 F  S X=$O(^TMP("PSB",$J,PSBWEEK,"HDR",X)) Q:'X  D
"RTN","PSBOMH2",109,0)
 ..W ?(40+(PSBCOL*13)),"| ",$E(X,4,5),"/",$E(X,6,7),"/",(1700+$E(X,1,3))
"RTN","PSBOMH2",110,0)
 ..S PSBCOL=PSBCOL+1
"RTN","PSBOMH2",111,0)
 D:$G(PRN)
"RTN","PSBOMH2",112,0)
 .W ?76,"PRN Reason"
"RTN","PSBOMH2",113,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",114,0)
 Q ""
"RTN","PSBOMH2",115,0)
 ;
"RTN","PSBOMH2",116,0)
PSBCK1(PSBCHK) ;                   
"RTN","PSBOMH2",117,0)
 I PSBCHK="A" D
"RTN","PSBOMH2",118,0)
 .S TEST=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH2",119,0)
 .D PSBOUT^PSBOMH1(TEST,PSBINIT)
"RTN","PSBOMH2",120,0)
 .S X=$P(^PSB(53.79,PSBIEN,0),U,6)_U_PSBINIT_U_"G"_U_PSBIEN
"RTN","PSBOMH2",121,0)
 I PSBCHK="B" D
"RTN","PSBOMH2",122,0)
 .S TESTB=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH2",123,0)
 .D PSBOUT^PSBOMH1(TESTB,PSBINIT)
"RTN","PSBOMH2",124,0)
 .S X=$P(^PSB(53.79,PSBIEN,0),U,6)_U_PSBINIT_U_$P(^(0),U,9)_U_PSBIEN
"RTN","PSBOMH2",125,0)
 S PSBCHK=""
"RTN","PSBOMH2",126,0)
 Q
"RTN","PSBOMH2",127,0)
 ;
"RTN","PSBOMH2",128,0)
PSBENT(PSBTIS) ;
"RTN","PSBOMH2",129,0)
 S PSBNAME="",PSBNAME=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:NAME")
"RTN","PSBOMH2",130,0)
 S ^TMP("PSB",$J,"LEGEND",$S($G(PSBTIS)="":99,1:PSBTIS),PSBNAME)=""
"RTN","PSBOMH2",131,0)
 Q
"RTN","PSBOMH2",132,0)
 ;
"RTN","PSBOMH2",133,0)
PSBSTIV ;
"RTN","PSBOMH2",134,0)
 S YB="" F  S YB=$O(PSBAUD(YB)) Q:YB=""  D
"RTN","PSBOMH2",135,0)
 .S Z="" F  S Z=$O(^PSB(53.79,PSBIEN,.9,Z)) Q:Z=""  I Z'=0  D
"RTN","PSBOMH2",136,0)
 ..I $P(PSBAUD(YB),U,1)=$P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1)  D
"RTN","PSBOMH2",137,0)
 ...I $P(^PSB(53.79,PSBIEN,.9,Z,0),"^",3)["Instruct"  D
"RTN","PSBOMH2",138,0)
 ....I $P(PSBAUD(YB),U,2)'["*"  S $P(PSBAUD(YB),U,2)=$P(PSBAUD(YB),U,2)_"*"
"RTN","PSBOMH2",139,0)
 ....D PSBOUT^PSBOMH1($P(PSBAUD(YB),U,1),$P(PSBAUD(YB),U,2))
"RTN","PSBOMH2",140,0)
 Q
"RTN","PSBOMH2",141,0)
 ;
"RTN","PSBOMH2",142,0)
PSBCTAR ;
"RTN","PSBOMH2",143,0)
 S YC="" F  S YC=$O(PSBTAR(YC)) Q:YC=""  D
"RTN","PSBOMH2",144,0)
 .S Z="" F  S Z=$O(^PSB(53.79,PSBIEN,.9,Z)) Q:Z=""  I Z'=0  D
"RTN","PSBOMH2",145,0)
 ..I $P(PSBTAR(YC),U,1)=$P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1)  D
"RTN","PSBOMH2",146,0)
 ...I $P(^PSB(53.79,PSBIEN,.9,Z,0),"^",3)["Instruct"  D
"RTN","PSBOMH2",147,0)
 ....S $P(PSBTAR(YC),U,2)=$P(PSBTAR(YC),U,2)_"*"
"RTN","PSBOMH2",148,0)
 ....D PSBOUT^PSBOMH1($P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1),$P(PSBTAR(YC),U,2))
"RTN","PSBOMH2",149,0)
 Q
"RTN","PSBOMH2",150,0)
 ;
"RTN","PSBOMH2",151,0)
SIOPI ;Get and print SI/OPI Wp text *68
"RTN","PSBOMH2",152,0)
 K ^TMP("PSJBCMA5",$J,DFN)
"RTN","PSBOMH2",153,0)
 S SILN=$$GETSIOPI^PSJBCMA5(DFN,PSBORD,1)
"RTN","PSBOMH2",154,0)
 I SILN F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)) Q:'QQ  D
"RTN","PSBOMH2",155,0)
 .S SITXT=^TMP("PSJBCMA5",$J,DFN,PSBORD,QQ)
"RTN","PSBOMH2",156,0)
 .I SILN=1,SITXT="" Q
"RTN","PSBOMH2",157,0)
 .D CHKPAGE I QQ=1 W !," Special Instructions:"
"RTN","PSBOMH2",158,0)
 .D CHKPAGE W !," ",SITXT
"RTN","PSBOMH2",159,0)
 K ^TMP("PSJBCMA5",$J,DFN)
"RTN","PSBOMH2",160,0)
 Q
"RTN","PSBOMH2",161,0)
 ;
"RTN","PSBOMH2",162,0)
CHKPAGE ;check for page full and print overflow msgs and new page headers *68
"RTN","PSBOMH2",163,0)
 I IOSL>24,$Y>$S(PSBCNT<13:(IOSL-PSBCNT-4),(PSBCNT-PSBLINE=12):(IOSL-12),1:(IOSL-12)) D
"RTN","PSBOMH2",164,0)
 .W !!?(IOM-35\2),"*** CONTINUED ON NEXT PAGE ***"
"RTN","PSBOMH2",165,0)
 .W $$HDR()
"RTN","PSBOMH2",166,0)
 .W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***",!
"RTN","PSBOMH2",167,0)
 Q
"RTN","PSBPRN")
0^8^B32147222^B24812606
"RTN","PSBPRN",1,0)
PSBPRN ;BIRMINGHAM/EFC-BCMA PRN FUNCTIONS ;2/15/12 9:26pm
"RTN","PSBPRN",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,3,13,61,68**;Mar 2004;Build 26
"RTN","PSBPRN",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBPRN",4,0)
 ;
"RTN","PSBPRN",5,0)
 ;Reference/IA
"RTN","PSBPRN",6,0)
 ;DEM^VADPT/10061
"RTN","PSBPRN",7,0)
 ;INP^VADPT/10061
"RTN","PSBPRN",8,0)
 ;$$GET1^DIQ/2056
"RTN","PSBPRN",9,0)
 ;GETSIOPI^PSJBCMA5/5763
"RTN","PSBPRN",10,0)
 ;
"RTN","PSBPRN",11,0)
 ;*68 - add call to add special instructions (SI) entries to the
"RTN","PSBPRN",12,0)
 ;      ^TMP("PSB")  global that ends up in the RESULTS ARRAY of
"RTN","PSBPRN",13,0)
 ;      RPC PSB GETPRNS.
"RTN","PSBPRN",14,0)
 ;      and add new parameter to GETPRNS tag to use new SI/OPI word
"RTN","PSBPRN",15,0)
 ;      processing fields.
"RTN","PSBPRN",16,0)
 ;
"RTN","PSBPRN",17,0)
 ; ** Warning: PSBSIOPI will be used as a global variable for all down
"RTN","PSBPRN",18,0)
 ;    streams calls from this RPC tag call.
"RTN","PSBPRN",19,0)
 ;
"RTN","PSBPRN",20,0)
EN ;
"RTN","PSBPRN",21,0)
 Q
"RTN","PSBPRN",22,0)
 ;
"RTN","PSBPRN",23,0)
EDIT ; Edit Medication Log PRN Effectiveness
"RTN","PSBPRN",24,0)
 NEW DFN ;* Undef DFN at EDIT+7^PSBPRN (NOIS: HUN-0699-21494)
"RTN","PSBPRN",25,0)
 W !! S DA=""
"RTN","PSBPRN",26,0)
 S DIC="^DPT(",DIC(0)="AEQM",DIC("A")="Select Patient Name: "
"RTN","PSBPRN",27,0)
 D ^DIC K DIC Q:+Y<1
"RTN","PSBPRN",28,0)
 S DFN=+Y
"RTN","PSBPRN",29,0)
 D EDIT1
"RTN","PSBPRN",30,0)
 K DFN,DA
"RTN","PSBPRN",31,0)
 G EDIT
"RTN","PSBPRN",32,0)
 ;
"RTN","PSBPRN",33,0)
EDIT1 ;
"RTN","PSBPRN",34,0)
 S %DT="AEQ",%DT("A")="Select Date to Begin Searching Back From: "
"RTN","PSBPRN",35,0)
 S %DT("B")="Today"
"RTN","PSBPRN",36,0)
 W !! D ^%DT Q:+Y<1  S PSBDT=Y
"RTN","PSBPRN",37,0)
 F  D  Q:'PSBDT
"RTN","PSBPRN",38,0)
 .W @IOF,!,"Searching Date " S Y=PSBDT D D^DIQ W Y
"RTN","PSBPRN",39,0)
 .W !," #  Medication",?45,"St",?50,"D/T Given",?75,"Int"
"RTN","PSBPRN",40,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBPRN",41,0)
 .S PSBSRCH=PSBDT+.9,PSBCNT=0
"RTN","PSBPRN",42,0)
 .K PSBTMP
"RTN","PSBPRN",43,0)
 .F  S PSBSRCH=$O(^PSB(53.79,"APRN",DFN,PSBSRCH),-1) Q:'PSBSRCH!(PSBSRCH<PSBDT)  D
"RTN","PSBPRN",44,0)
 ..S PSBIEN=""
"RTN","PSBPRN",45,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"APRN",DFN,PSBSRCH,PSBIEN),-1) Q:'PSBIEN  D
"RTN","PSBPRN",46,0)
 ...Q:$P($G(^PSB(53.79,PSBIEN,.2)),U,2)]""
"RTN","PSBPRN",47,0)
 ...Q:$P($G(^PSB(53.79,PSBIEN,0)),U,9)'="G"
"RTN","PSBPRN",48,0)
 ...S PSBCNT=PSBCNT+1,PSBTMP(PSBCNT)=PSBIEN
"RTN","PSBPRN",49,0)
 ...I $Y>19 W ! S DIR(0)="E" D ^DIR W @IOF,!,"Searching Date " S Y=PSBDT D D^DIQ W Y,!," #  Medication",?45,"St",?50,"D/T Given",?75,"Int",!,$TR($J("",IOM)," ","-")
"RTN","PSBPRN",50,0)
 ...W !,$J(PSBCNT,2),". "
"RTN","PSBPRN",51,0)
 ...W ?5,$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBPRN",52,0)
 ...W ?45,$P(^PSB(53.79,PSBIEN,0),U,9)
"RTN","PSBPRN",53,0)
 ...W ?50,$$GET1^DIQ(53.79,PSBIEN_",",.06)
"RTN","PSBPRN",54,0)
 ...W ?75,$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBPRN",55,0)
 .I PSBCNT W ! S DIR(0)="NO^1:"_PSBCNT_":0" D ^DIR S:Y DA=PSBTMP(Y),PSBDT="" Q:Y
"RTN","PSBPRN",56,0)
 .I 'PSBCNT W !!?5,"No Meds Found!"
"RTN","PSBPRN",57,0)
 .S X1=PSBDT,X2=-1 D C^%DTC S (PSBDT,Y)=X D D^DIQ
"RTN","PSBPRN",58,0)
 .W !!,"Continue With ",Y
"RTN","PSBPRN",59,0)
 .S %=1 D YN^DICN I %'=1 S PSBDT=0
"RTN","PSBPRN",60,0)
 I DA S DDSFILE=53.79,DR="[PSB PRN EFFECTIVENESS]" D ^DDS S %=2 W !,"Edit another entry" D YN^DICN G:%=1 EDIT1
"RTN","PSBPRN",61,0)
 K PSBCNT,PSBDT,PSBIEN,PSBSRCH,PSBTMP,DA,DR,DDSFILE
"RTN","PSBPRN",62,0)
 Q
"RTN","PSBPRN",63,0)
 ;
"RTN","PSBPRN",64,0)
GETPRNS(RESULTS,DFN,PSBORD,PSBSIOPI) ; Get the PRN's for a pt needing effectiveness
"RTN","PSBPRN",65,0)
 ;
"RTN","PSBPRN",66,0)
 ; RPC PSB GETPRNS
"RTN","PSBPRN",67,0)
 ;
"RTN","PSBPRN",68,0)
 ; Description:
"RTN","PSBPRN",69,0)
 ; Returns all administrations of a PRN order that have NOT had
"RTN","PSBPRN",70,0)
 ; the PRN Effectiveness documented BASED ON THE TRANSFER DATE AND SITE PARAM
"RTN","PSBPRN",71,0)
 ;
"RTN","PSBPRN",72,0)
 N PSBIEN,PSBSTOP
"RTN","PSBPRN",73,0)
 K ^TMP("PSB",$J),RESULTS
"RTN","PSBPRN",74,0)
 S PSBSIOPI=+$G(PSBSIOPI)   ;*68 init to 0 if not present or 1 if sent
"RTN","PSBPRN",75,0)
 ;
"RTN","PSBPRN",76,0)
 Q:$$DISCHRGD(DFN)
"RTN","PSBPRN",77,0)
 ;
"RTN","PSBPRN",78,0)
 D INP^VADPT S PSBTRDT=+VAIN(7)
"RTN","PSBPRN",79,0)
 S PSBHOUR=$$GET^XPAR("DIV","PSB PRN DOCUMENTATION") I PSBHOUR="" S PSBHOUR=72
"RTN","PSBPRN",80,0)
 D NOW^%DTC S PSBSTRT=%,PSBPRNDT=$$FMADD^XLFDT(PSBSTRT,"",-PSBHOUR)
"RTN","PSBPRN",81,0)
 ;
"RTN","PSBPRN",82,0)
 ;Use the (OLDER) value of PSBPRNDT(site param) or PSBTRDT(admission)
"RTN","PSBPRN",83,0)
 I PSBPRNDT>PSBTRDT S PSBPRNDT=PSBTRDT
"RTN","PSBPRN",84,0)
 S PSBSTRT="" F  S PSBSTRT=$O(^PSB(53.79,"APRN",DFN,PSBSTRT),-1) Q:(PSBSTRT<PSBPRNDT)  D
"RTN","PSBPRN",85,0)
 .S PSBIEN=""
"RTN","PSBPRN",86,0)
 .F  S PSBIEN=$O(^PSB(53.79,"APRN",DFN,PSBSTRT,PSBIEN),-1) Q:'PSBIEN  D
"RTN","PSBPRN",87,0)
 ..Q:(PSBORD'="")&($P(^PSB(53.79,PSBIEN,.1),U)'=PSBORD)  ;  Not the right order
"RTN","PSBPRN",88,0)
 ..I ($P(^PSB(53.79,PSBIEN,0),U,9)'="G")&($P(^PSB(53.79,PSBIEN,0),U,9)'="RM") Q    ; Med was never given
"RTN","PSBPRN",89,0)
 ..Q:$P($G(^PSB(53.79,PSBIEN,.2)),U,2)]""  ; Already entered
"RTN","PSBPRN",90,0)
 ..S PSBX=PSBIEN_U_DFN,PSBIENS=PSBIEN_","
"RTN","PSBPRN",91,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.02)
"RTN","PSBPRN",92,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.06,"I")
"RTN","PSBPRN",93,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.07)
"RTN","PSBPRN",94,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.08)
"RTN","PSBPRN",95,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.21)
"RTN","PSBPRN",96,0)
 ..D PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBIENS,.11))
"RTN","PSBPRN",97,0)
 ..S PSBX=PSBX_U_PSBOIT_U_PSBONX
"RTN","PSBPRN",98,0)
 ..S PSBX=PSBX_U_$$GET1^DIQ(53.79,PSBIENS,.27)
"RTN","PSBPRN",99,0)
 ..S Y=$O(^TMP("PSB",$J,""),-1)+1
"RTN","PSBPRN",100,0)
 ..S ^TMP("PSB",$J,Y)=PSBX
"RTN","PSBPRN",101,0)
 ..;Special instructions
"RTN","PSBPRN",102,0)
 ..S Y=Y+1,^TMP("PSB",$J,Y)=PSBOTXT
"RTN","PSBPRN",103,0)
 ..F PSBZ=.5,.6,.7 F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBIEN,PSBZ,PSBY)) Q:'PSBY  D
"RTN","PSBPRN",104,0)
 ...S PSBDD=$S(PSBZ=.5:53.795,PSBZ=.6:53.796,1:53.797)
"RTN","PSBPRN",105,0)
 ...S PSBSOL=$S(PSBZ=.5:"DD",PSBZ=.6:"ADD",1:"SOL")
"RTN","PSBPRN",106,0)
 ...Q:'$D(^PSB(53.79,PSBIEN,PSBZ,PSBY))
"RTN","PSBPRN",107,0)
 ...S PSBUNIT=$$GET1^DIQ(PSBDD,PSBY_","_PSBIEN_",",.03)
"RTN","PSBPRN",108,0)
 ...S PSBUNFR=$$GET1^DIQ(PSBDD,PSBY_","_PSBIEN_",",.04)
"RTN","PSBPRN",109,0)
 ...I PSBUNIT>0&(PSBUNIT<1) S PSBUNIT="0"_+PSBUNIT ;add leading 0 for a decimal value less than 1 - PSB*3*61
"RTN","PSBPRN",110,0)
 ...S Y=Y+1
"RTN","PSBPRN",111,0)
 ...S ^TMP("PSB",$J,Y)=PSBSOL_U_$$GET1^DIQ(PSBDD,PSBY_","_PSBIEN_",",.01)_U_PSBUNIT_U_PSBUNFR
"RTN","PSBPRN",112,0)
 ..D:PSBSIOPI GETSI(DFN,PSBONX,.Y)     ;*68 get spec inst/oth prt info
"RTN","PSBPRN",113,0)
 ..S Y=Y+1,^TMP("PSB",$J,Y)="END"
"RTN","PSBPRN",114,0)
 S ^TMP("PSB",$J,0)=+$O(^TMP("PSB",$J,""),-1)
"RTN","PSBPRN",115,0)
 S RESULTS=$NAME(^TMP("PSB",$J))
"RTN","PSBPRN",116,0)
 K PSBTRDT,PSBHOUR,PSBPRNDT
"RTN","PSBPRN",117,0)
 D CLEAN^PSBVT
"RTN","PSBPRN",118,0)
 Q
"RTN","PSBPRN",119,0)
 ;
"RTN","PSBPRN",120,0)
DISCHRGD(DFN) ; Patient Discharged OR Deceased?
"RTN","PSBPRN",121,0)
 ;
"RTN","PSBPRN",122,0)
 S DISCHRGD=0
"RTN","PSBPRN",123,0)
 ;
"RTN","PSBPRN",124,0)
 D DEM^VADPT ;check for date of death entry
"RTN","PSBPRN",125,0)
 I VADM(6)]"" S DISCHRGD=1,^TMP("PSB",$J,0)=0 K VADM
"RTN","PSBPRN",126,0)
 ;
"RTN","PSBPRN",127,0)
 I DISCHRGD=0 D  ;check for discharge if they're not dead
"RTN","PSBPRN",128,0)
 .D INP^VADPT
"RTN","PSBPRN",129,0)
 .I VAIN(1)']"" S DISCHRGD=1,^TMP("PSB",$J,0)=0 K VAIN
"RTN","PSBPRN",130,0)
 ;
"RTN","PSBPRN",131,0)
 I DISCHRGD D  ;setup results and clean up
"RTN","PSBPRN",132,0)
 .S RESULTS=$NAME(^TMP("PSB",$J))
"RTN","PSBPRN",133,0)
 .K PSBTRDT,PSBHOUR,PSBPRNDT
"RTN","PSBPRN",134,0)
 .D CLEAN^PSBVT
"RTN","PSBPRN",135,0)
 ;
"RTN","PSBPRN",136,0)
 Q DISCHRGD
"RTN","PSBPRN",137,0)
 ;
"RTN","PSBPRN",138,0)
GETSI(DFN,ORD,PSB) ;Get Special Instructions/Other Print Info from IM   ;*68
"RTN","PSBPRN",139,0)
 ;
"RTN","PSBPRN",140,0)
 ; This Tag will load the SIOPI WP text into the TMP global used by
"RTN","PSBPRN",141,0)
 ; the PSB GETPRNS RPC, which ends up in the RESULTS array passed
"RTN","PSBPRN",142,0)
 ; back to the BCMA GUI.
"RTN","PSBPRN",143,0)
 ;
"RTN","PSBPRN",144,0)
 N QQ
"RTN","PSBPRN",145,0)
 K ^TMP("PSJBCMA5",$J,DFN,ORD)
"RTN","PSBPRN",146,0)
 D GETSIOPI^PSJBCMA5(DFN,ORD,1)
"RTN","PSBPRN",147,0)
 Q:'$D(^TMP("PSJBCMA5",$J,DFN,ORD))
"RTN","PSBPRN",148,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,ORD,QQ)) Q:'QQ  D
"RTN","PSBPRN",149,0)
 .S PSB=PSB+1
"RTN","PSBPRN",150,0)
 .S ^TMP("PSB",$J,PSB)="SI^"_^TMP("PSJBCMA5",$J,DFN,ORD,QQ)
"RTN","PSBPRN",151,0)
 K ^TMP("PSJBCMA5",$J,DFN,ORD)
"RTN","PSBPRN",152,0)
 Q
"RTN","PSBRPC3")
0^1^B309181^B309153
"RTN","PSBRPC3",1,0)
PSBRPC3 ;BIRMINGHAM/VRN - BCMA RPC BROKER CALLS ;1/10/12 9:17am
"RTN","PSBRPC3",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,16,13,10,32,28,42,58,68**;Mar 2004;Build 26
"RTN","PSBRPC3",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBRPC3",4,0)
 ;
"RTN","PSBRPC3",5,0)
GUICHK(RESULTS,DUMMY) ;
"RTN","PSBRPC3",6,0)
 ;
"RTN","PSBRPC3",7,0)
 ; RPC : PSB VERSION CHECK
"RTN","PSBRPC3",8,0)
 ;
"RTN","PSBRPC3",9,0)
 K RESULTS
"RTN","PSBRPC3",10,0)
 N PSBCURR,PSBPREV,PSBCNT
"RTN","PSBRPC3",11,0)
 S PSBCURR="3.0.68.*",PSBPREV="",PSBCNT=0
"RTN","PSBRPC3",12,0)
 S PSBCNT=PSBCNT+1
"RTN","PSBRPC3",13,0)
 S RESULTS(PSBCNT)=PSBCURR_U_PSBPREV
"RTN","PSBRPC3",14,0)
 S RESULTS(0)=PSBCNT
"RTN","PSBRPC3",15,0)
 Q
"RTN","PSBRPC3",16,0)
 ;
"RTN","PSBVDLPB")
0^19^B99542907^B89830861
"RTN","PSBVDLPB",1,0)
PSBVDLPB ;BIRMINGHAM/EFC-BCMA IV VIRTUAL DUE ;4/10/12 12:33pm
"RTN","PSBVDLPB",2,0)
 ;;3.0;BAR CODE MED ADMIN;**11,13,38,32,58,68**;Mar 2004;Build 26
"RTN","PSBVDLPB",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLPB",4,0)
 ;
"RTN","PSBVDLPB",5,0)
 ; Reference/IA
"RTN","PSBVDLPB",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLPB",7,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLPB",8,0)
 ; File 200/10060
"RTN","PSBVDLPB",9,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBVDLPB",10,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBVDLPB",11,0)
 ;
"RTN","PSBVDLPB",12,0)
 ;*58 - add 29th piece to Results for Override/Intervention flag 1/0
"RTN","PSBVDLPB",13,0)
 ;*68 - add 30th piece to Results for Last Injection Site and
"RTN","PSBVDLPB",14,0)
 ;    - add 31st piece to Results for Piggyback tab to know the IV
"RTN","PSBVDLPB",15,0)
 ;      order is rotation type injectable.
"RTN","PSBVDLPB",16,0)
 ;
"RTN","PSBVDLPB",17,0)
EN(DFN,PSBDT) ; Default Order List Return for Today
"RTN","PSBVDLPB",18,0)
 ;
"RTN","PSBVDLPB",19,0)
 ; RPC: PSB GETORDERLIST
"RTN","PSBVDLPB",20,0)
 ;
"RTN","PSBVDLPB",21,0)
 ; Description:
"RTN","PSBVDLPB",22,0)
 ; Returns the current IV order set for today to display on the
"RTN","PSBVDLPB",23,0)
 ; client VDL
"RTN","PSBVDLPB",24,0)
 ;
"RTN","PSBVDLPB",25,0)
 ;
"RTN","PSBVDLPB",26,0)
 N PSBDATA,PSBTBOUT
"RTN","PSBVDLPB",27,0)
 S PSBTBOUT=0,PSBDOADD=0
"RTN","PSBVDLPB",28,0)
 S:PSBTAB="PBTAB" PSBDOADD=1
"RTN","PSBVDLPB",29,0)
 ;
"RTN","PSBVDLPB",30,0)
 ;This routine now re-uses the ^TMP("PSJ",$J global built in PSBVDLTB
"RTN","PSBVDLPB",31,0)
 ;
"RTN","PSBVDLPB",32,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 Q  ; No orders
"RTN","PSBVDLPB",33,0)
 ;
"RTN","PSBVDLPB",34,0)
 N RTBL D BLDTBL^PSBINJEC(.RTBL)  ;build valid IV rotable inj *68
"RTN","PSBVDLPB",35,0)
 ;
"RTN","PSBVDLPB",36,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBVDLPB",37,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBVDLPB",38,0)
 .;
"RTN","PSBVDLPB",39,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLPB",40,0)
 .;
"RTN","PSBVDLPB",41,0)
 .Q:PSBONX["P"  ;     No Pending Orders
"RTN","PSBVDLPB",42,0)
 .Q:'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH)
"RTN","PSBVDLPB",43,0)
 .Q:PSBOST>PSBWADM  ; Order Start Date/Time > admin window
"RTN","PSBVDLPB",44,0)
 .Q:PSBOSP<PSBWBEG  ; For all Order Stop Date/Time < vdl window
"RTN","PSBVDLPB",45,0)
 .Q:PSBOSTS["D"  ;     Is it DC'd
"RTN","PSBVDLPB",46,0)
 .Q:PSBNGF  ;  Is it marked DO NOT GIVE!
"RTN","PSBVDLPB",47,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLPB",48,0)
 .;
"RTN","PSBVDLPB",49,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",50,0)
 .Q:PSBOSP<%
"RTN","PSBVDLPB",51,0)
 .;
"RTN","PSBVDLPB",52,0)
 .; include Active, Renewed, ReInstated and On Call
"RTN","PSBVDLPB",53,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call)
"RTN","PSBVDLPB",54,0)
 .Q:PSBSCHT'="O"&((PSBOSTS'="A")&(PSBOSTS'="R")&(PSBOSTS'="RE")&(PSBOSTS'="O")&(PSBOSTS'="H"))
"RTN","PSBVDLPB",55,0)
 .;
"RTN","PSBVDLPB",56,0)
 .; Is One Time Given
"RTN","PSBVDLPB",57,0)
 .;
"RTN","PSBVDLPB",58,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLPB",59,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",60,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",61,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBONX)&($P(^PSB(53.79,Y,0),U,9)="G") PSBGVN=1,(X,Y)=0
"RTN","PSBVDLPB",62,0)
 .;
"RTN","PSBVDLPB",63,0)
 .; How long does One Time remain on VDL ?
"RTN","PSBVDLPB",64,0)
 .S PSBRMN=1
"RTN","PSBVDLPB",65,0)
 .I PSBSCHT="O",PSBOSP'=PSBOST,%>PSBOSP S PSBRMN=0
"RTN","PSBVDLPB",66,0)
 .Q:'PSBRMN
"RTN","PSBVDLPB",67,0)
 .;
"RTN","PSBVDLPB",68,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLPB",69,0)
 .;
"RTN","PSBVDLPB",70,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLPB",71,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",72,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",73,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBON)&($P(^PSB(53.79,Y,0),U,9)="G") PSBGVN=1,(X,Y)=0
"RTN","PSBVDLPB",74,0)
 .;
"RTN","PSBVDLPB",75,0)
 .S PSBSTRT=PSBOST ; Order Start Date/Time
"RTN","PSBVDLPB",76,0)
 .S PSBSTOP=PSBOSP ; Order Stop Date/Time
"RTN","PSBVDLPB",77,0)
 .;
"RTN","PSBVDLPB",78,0)
 .S PSBREC=""
"RTN","PSBVDLPB",79,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLPB",80,0)
 .S $P(PSBREC,U,2)=PSBONX ; Order
"RTN","PSBVDLPB",81,0)
 .S $P(PSBREC,U,3)=+PSBON ; order ien
"RTN","PSBVDLPB",82,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLPB",83,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLPB",84,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLPB",85,0)
 .S Y=""
"RTN","PSBVDLPB",86,0)
 .S:PSBSM Y="SM"
"RTN","PSBVDLPB",87,0)
 .S:PSBHSM Y="HSM"
"RTN","PSBVDLPB",88,0)
 .S $P(PSBREC,U,7)=Y ; self med
"RTN","PSBVDLPB",89,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLPB",90,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLPB",91,0)
 .S $P(PSBREC,U,10)=PSBMR ;med route
"RTN","PSBVDLPB",92,0)
 .; Last Given from the AOIP X-Ref - not given status not excepted
"RTN","PSBVDLPB",93,0)
 .S (YZ,PSBSTUS,PSBADMER)="" K PSBHSTA,PSBHSTAX
"RTN","PSBVDLPB",94,0)
 .F XZ=1:1:20 S YZ=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ),-1),(PSBCNT,PSBFLAG)=0 Q:YZ=""  D
"RTN","PSBVDLPB",95,0)
 ..S:YZ>0 $P(PSBREC,U,11)=YZ
"RTN","PSBVDLPB",96,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ,X),-1) Q:X=""  D
"RTN","PSBVDLPB",97,0)
 ...K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLPB",98,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLPB",99,0)
 ...I $G(PSBSTUS)="" S:'$G(PSBLCK) PSBSTUS="X" I $G(PSBLCK) S PSBADMER=1 D
"RTN","PSBVDLPB",100,0)
 ....K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLPB",101,0)
 ....S PSBPARM6=X,Y=$P(^PSB(53.79,X,.1),U,3) D DD^%DT S PSBPARM3=Y,Y=$P(^PSB(53.79,X,0),U,6) D DD^%DT S PSBPARM5=Y
"RTN","PSBVDLPB",102,0)
 ....S PSBPARM7=$P(^PSB(53.79,X,0),U,7) S PSBPARM7="( # "_PSBPARM7_" ) "_$$GET1^DIQ(200,PSBPARM7_",",.01)
"RTN","PSBVDLPB",103,0)
 ....K PSBXTMP S PSBXTMP=PSBONX
"RTN","PSBVDLPB",104,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBPARM6_",",.11))
"RTN","PSBVDLPB",105,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,PSBPARM3_" admin's ACTION STATUS is ""UNKNOWN"".",PSBSCH,PSBPARM5,PSBPARM6,PSBPARM7) ;  SEND AN E-MAIL
"RTN","PSBVDLPB",106,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXTMP)  ;Reset Variables
"RTN","PSBVDLPB",107,0)
 ....S X=PSBPARM6 K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLPB",108,0)
 ...K PSBLCK S:(PSBSTUS']"") PSBSTUS="U"  I PSBSTUS'="N",($G(PSBSTUS)'="X") S PSBFLAG=1,PSBHSTA(YZ,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBVDLPB",109,0)
 ...D:PSBSTUS="N"
"RTN","PSBVDLPB",110,0)
 ....S $P(PSBREC,U,11)=""
"RTN","PSBVDLPB",111,0)
 ....S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBVDLPB",112,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",113,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",114,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBVDLPB",115,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBVDLPB",116,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBVDLPB",117,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBVDLPB",118,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBVDLPB",119,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBVDLPB",120,0)
 .S $P(PSBREC,U,12)=""  ;med log ien inserted below for actual date
"RTN","PSBVDLPB",121,0)
 .S $P(PSBREC,U,13)=""  ;med log status inserted below for actual date
"RTN","PSBVDLPB",122,0)
 .S $P(PSBREC,U,14)="" ;admin date inserted below
"RTN","PSBVDLPB",123,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLPB",124,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;Set injectable med route flag
"RTN","PSBVDLPB",125,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLPB",126,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLPB",127,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLPB",128,0)
 .S $P(PSBREC,U,18)=PSBIVT  ;IV TYPE - dosage form
"RTN","PSBVDLPB",129,0)
 .S $P(PSBREC,U,20)=$S((PSBSTUS="X")!(PSBSTUS="N"):"",1:PSBSTUS) ;last action status
"RTN","PSBVDLPB",130,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLPB",131,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLPB",132,0)
 .S $P(PSBREC,U,26)=PSBSTOP
"RTN","PSBVDLPB",133,0)
 .S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL(DFN,PSBOIT)
"RTN","PSBVDLPB",134,0)
 .;*58 determine if override exists, send 1/0 (true/false)
"RTN","PSBVDLPB",135,0)
 .N PSBARR D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBARR)
"RTN","PSBVDLPB",136,0)
 .I $O(PSBARR(""))="" D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBARR,2)
"RTN","PSBVDLPB",137,0)
 .S $P(PSBREC,U,29)=$S($O(PSBARR(""))]"":1,1:0)
"RTN","PSBVDLPB",138,0)
 .;*68 inject rotation flag, send 1/0 (true/false)
"RTN","PSBVDLPB",139,0)
 .I PSBONX["V" D
"RTN","PSBVDLPB",140,0)
 ..N STDRTE S STDRTE=$$GET1^DIQ(51.2,PSBMRIEN,10)
"RTN","PSBVDLPB",141,0)
 ..S $P(PSBREC,U,31)=$$IVROTATN^PSBINJEC(.RTBL,STDRTE,PSBIVT,PSBISYR)
"RTN","PSBVDLPB",142,0)
 ..;*68 if param 31 is 1 then go get last injection site for param 30
"RTN","PSBVDLPB",143,0)
 ..I $P(PSBREC,U,31)=1 D
"RTN","PSBVDLPB",144,0)
 ...N LI D RPC^PSBINJEC(.LI,DFN,PSBOIT,9999999,1)
"RTN","PSBVDLPB",145,0)
 ...S $P(PSBREC,U,30)=$P(LI(1),U,6)   ;if no inj's, 6th will be null
"RTN","PSBVDLPB",146,0)
 .;
"RTN","PSBVDLPB",147,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLPB",148,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",149,0)
 .S (PSBDDS,PSBSOLS,PSBADDS)="0"
"RTN","PSBVDLPB",150,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLPB",151,0)
 ..Q:$P(PSBDDA(Y),U,4)&($P(PSBDDA(Y),U,4)<%)  ; Inactive
"RTN","PSBVDLPB",152,0)
 ..S:$P(PSBDDA(Y),U,3)="" $P(PSBDDA(Y),U,3)=1
"RTN","PSBVDLPB",153,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,3)
"RTN","PSBVDLPB",154,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLPB",155,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLPB",156,0)
 .S PSBQRR=0
"RTN","PSBVDLPB",157,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D  Q
"RTN","PSBVDLPB",158,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",159,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",160,0)
 .;
"RTN","PSBVDLPB",161,0)
 .; IV's - don't worry about admin times if blank
"RTN","PSBVDLPB",162,0)
 .I PSBONX["V","PSC"'[PSBIVT,PSBADST="" D  Q
"RTN","PSBVDLPB",163,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",164,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",165,0)
 .;
"RTN","PSBVDLPB",166,0)
 .; Now we deal with only continuous
"RTN","PSBVDLPB",167,0)
 .; process admintimes
"RTN","PSBVDLPB",168,0)
 .S (PSBYES,PSBODD,PSBYTF)=0
"RTN","PSBVDLPB",169,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBVDLPB",170,0)
 .I PSBYES,PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLPB",171,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBVDLPB",172,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLPB",173,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLPB",174,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBVDLPB",175,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBVDLPB",176,0)
 .I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBVDLPB",177,0)
 .S PSBADMIN=PSBADST
"RTN","PSBVDLPB",178,0)
 .I (PSBADMIN="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1("PBTAB") Q  ;calculate admin times based on frequency
"RTN","PSBVDLPB",179,0)
 .; No admin times, MAYDAY MAYDAY!!
"RTN","PSBVDLPB",180,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBVDLPB",181,0)
 .I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBVDLPB",182,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLPB",183,0)
 .; build all orders for both days.
"RTN","PSBVDLPB",184,0)
 .F PSBY=1:1 Q:$P(PSBADMIN,"-",PSBY)=""  D
"RTN","PSBVDLPB",185,0)
 ..;For invalid admin times
"RTN","PSBVDLPB",186,0)
 ..I ($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N) D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBVDLPB",187,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLPB",188,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",189,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",190,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",191,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",192,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",193,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",194,0)
 ..;
"RTN","PSBVDLPB",195,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLPB",196,0)
 ..;
"RTN","PSBVDLPB",197,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLPB",198,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",199,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",200,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",201,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",202,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",203,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",204,0)
 ;
"RTN","PSBVDLPB",205,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLPB",206,0)
 D:PSBDOADD VNURSE^PSBVDLU1("PBTAB")
"RTN","PSBVDLPB",207,0)
 Q
"RTN","PSBVDLPB",208,0)
 ;
"RTN","PSBVDLTB")
0^16^B13695318^B12630766
"RTN","PSBVDLTB",1,0)
PSBVDLTB ;BIRMINGHAM/EFC-BCMA VIRTUAL DUE LIST FUNCTIONS (CONT) ;1/10/12 8:33pm
"RTN","PSBVDLTB",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,4,16,68**;Mar 2004;Build 26
"RTN","PSBVDLTB",3,0)
 ;
"RTN","PSBVDLTB",4,0)
 ; Reference/IA
"RTN","PSBVDLTB",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLTB",6,0)
 ; IN5^VADPT/10061
"RTN","PSBVDLTB",7,0)
 ; DEM^VADPT/10061
"RTN","PSBVDLTB",8,0)
 ; INP^VADPT/10061
"RTN","PSBVDLTB",9,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBVDLTB",10,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLTB",11,0)
 ; 
"RTN","PSBVDLTB",12,0)
 ;*68 - add new parameter to use new SI/OPI word processing fields
"RTN","PSBVDLTB",13,0)
 ;
"RTN","PSBVDLTB",14,0)
 ; ** Warning: PSBSIOPI will be used as a global variable for all down
"RTN","PSBVDLTB",15,0)
 ;    streams calls from this RPC tag call.
"RTN","PSBVDLTB",16,0)
 ;
"RTN","PSBVDLTB",17,0)
RPC(RESULTS,DFN,PSBTAB,PSBDT,PSBSIOPI) ;
"RTN","PSBVDLTB",18,0)
 K RESULTS,^TMP("PSB",$J),^TMP("PSJ",$J)
"RTN","PSBVDLTB",19,0)
 S PSBSIOPI=+$G(PSBSIOPI)   ;*68 init to 0 if not present or 1 if sent
"RTN","PSBVDLTB",20,0)
 N PSBCNT
"RTN","PSBVDLTB",21,0)
 S PSBTRFL=0
"RTN","PSBVDLTB",22,0)
 S RESULTS=$NAME(^TMP("PSB",$J,PSBTAB))
"RTN","PSBVDLTB",23,0)
 ;
"RTN","PSBVDLTB",24,0)
 Q:$$DISCHRGD(DFN)
"RTN","PSBVDLTB",25,0)
 ;
"RTN","PSBVDLTB",26,0)
 S PSBNOW=+$G(PSBDT)
"RTN","PSBVDLTB",27,0)
 I 'PSBNOW D NOW^%DTC S PSBNOW=+$E(%,1,10),PSBDT=$P(%,".",1)
"RTN","PSBVDLTB",28,0)
 ; use fileman function to determine window
"RTN","PSBVDLTB",29,0)
 S PSBWBEG=$$FMADD^XLFDT(PSBNOW,"",-12)
"RTN","PSBVDLTB",30,0)
 S PSBWEND=$$FMADD^XLFDT(PSBNOW,"",12)
"RTN","PSBVDLTB",31,0)
 ;
"RTN","PSBVDLTB",32,0)
 ; Create variable for valid order start date/time against admin window
"RTN","PSBVDLTB",33,0)
 S PSBWADM=$$GET^XPAR("DIV","PSB ADMIN BEFORE")
"RTN","PSBVDLTB",34,0)
 D NOW^%DTC S PSBWADM=$$FMADD^XLFDT(%,"","",+PSBWADM)
"RTN","PSBVDLTB",35,0)
 ;
"RTN","PSBVDLTB",36,0)
 ; use last movement for API
"RTN","PSBVDLTB",37,0)
 S VAIP("D")="LAST" D IN5^VADPT S PSBTRDT=+VAIP(3),PSBTRTYP=$P(VAIP(2),U,2),PSBMVTYP=$P(VAIP(4),U,2) K VAIP
"RTN","PSBVDLTB",38,0)
 ;
"RTN","PSBVDLTB",39,0)
 ;Get patient transfer notification timeframe to determine pop-up box
"RTN","PSBVDLTB",40,0)
 S PSBPTTR=$$GET^XPAR("DIV","PSB PATIENT TRANSFER") I PSBPTTR="" S PSBPTTR=72
"RTN","PSBVDLTB",41,0)
 D NOW^%DTC S PSBNTDT=$$FMADD^XLFDT(%,"",-PSBPTTR) I PSBNTDT'>PSBTRDT S PSBTRFL=1
"RTN","PSBVDLTB",42,0)
 ;determine order type and load to table
"RTN","PSBVDLTB",43,0)
 ;
"RTN","PSBVDLTB",44,0)
 ; Setup the ^TMP("PSJ",$J global for use below 
"RTN","PSBVDLTB",45,0)
 ; Passing PSBDT as 3rd parameter turns off the V.1.0 One-Time lookback
"RTN","PSBVDLTB",46,0)
 D EN^PSJBCMA(DFN,PSBNOW,PSBDT)
"RTN","PSBVDLTB",47,0)
 ;initialize tabs
"RTN","PSBVDLTB",48,0)
 D TABINIT
"RTN","PSBVDLTB",49,0)
 ;
"RTN","PSBVDLTB",50,0)
 ;The following calls must be made in the order below since the ^TMP global is reused
"RTN","PSBVDLTB",51,0)
 D EN^PSBVDLUD(DFN,PSBDT),EN^PSBVDLPB(DFN,PSBDT),EN^PSBVDLIV(DFN,PSBDT)
"RTN","PSBVDLTB",52,0)
 S $P(PSBATAB,U,1)=$S($D(^TMP("PSB",$J,"UDTAB",2))>0:1,1:0)
"RTN","PSBVDLTB",53,0)
 S $P(PSBATAB,U,2)=$S($D(^TMP("PSB",$J,"PBTAB",2))>0:1,1:0)
"RTN","PSBVDLTB",54,0)
 S $P(PSBATAB,U,3)=$S($D(^TMP("PSB",$J,"IVTAB",2))>0:1,1:0)
"RTN","PSBVDLTB",55,0)
 S:PSBTAB="UDTAB" PSBCNT=$O(^TMP("PSB",$J,"UDTAB",""),-1)
"RTN","PSBVDLTB",56,0)
 S:PSBTAB="IVTAB" PSBCNT=$O(^TMP("PSB",$J,"IVTAB",""),-1)
"RTN","PSBVDLTB",57,0)
 S:PSBTAB="PBTAB" PSBCNT=$O(^TMP("PSB",$J,"PBTAB",""),-1)
"RTN","PSBVDLTB",58,0)
 I PSBTAB="NO TAB" D
"RTN","PSBVDLTB",59,0)
 .S ^TMP("PSB",$J,PSBTAB,0)=1
"RTN","PSBVDLTB",60,0)
 .S ^TMP("PSB",$J,PSBTAB,1)=PSBATAB
"RTN","PSBVDLTB",61,0)
 E  D
"RTN","PSBVDLTB",62,0)
 .I $G(PSBCNT)>0 S ^TMP("PSB",$J,PSBTAB,0)=PSBCNT
"RTN","PSBVDLTB",63,0)
 .I $G(PSBCNT)>1 S ^TMP("PSB",$J,PSBTAB,1)=PSBATAB_U_$S(PSBTRFL:PSBTRTYP_U_PSBMVTYP,1:"")
"RTN","PSBVDLTB",64,0)
 .I $G(PSBCNT)'>1 S ^TMP("PSB",$J,PSBTAB,1)=PSBATAB_U_^TMP("PSB",$J,PSBTAB,1)
"RTN","PSBVDLTB",65,0)
 F X="UDTAB","PBTAB","IVTAB" I X'=PSBTAB K ^TMP("PSB",$J,X)
"RTN","PSBVDLTB",66,0)
 D CLEAN^PSBVT K ^TMP("PSJ",$J),PSBATAB,PSBWADM,PSBWBEG,PSBWEND,PSBNOW,PSBTRDT,PSBPTTR,PSBTRFL,PSBNTDT,PSBTRTYP,PSBMVTYP
"RTN","PSBVDLTB",67,0)
 Q
"RTN","PSBVDLTB",68,0)
 ;
"RTN","PSBVDLTB",69,0)
TABINIT ;
"RTN","PSBVDLTB",70,0)
 F PSBX="UDTAB","PBTAB","IVTAB" D
"RTN","PSBVDLTB",71,0)
 .K ^TMP("PSB",$J,PSBX)
"RTN","PSBVDLTB",72,0)
 .S ^TMP("PSB",$J,PSBX,0)=1
"RTN","PSBVDLTB",73,0)
 .S ^TMP("PSB",$J,PSBX,1)="-1^No Administration(s) due at this time." Q
"RTN","PSBVDLTB",74,0)
 Q
"RTN","PSBVDLTB",75,0)
 ;
"RTN","PSBVDLTB",76,0)
DISCHRGD(DFN) ; Patient Discharged OR Deceased?
"RTN","PSBVDLTB",77,0)
 ;
"RTN","PSBVDLTB",78,0)
 S DISCHRGD=0
"RTN","PSBVDLTB",79,0)
 D DEM^VADPT I VADM(6)]"" S DISCHRGD=1 K VADM D  Q DISCHRGD
"RTN","PSBVDLTB",80,0)
 .F PSBX="UDTAB","PBTAB","IVTAB","NO TAB" D
"RTN","PSBVDLTB",81,0)
 ..K ^TMP("PSB",$J,PSBX)
"RTN","PSBVDLTB",82,0)
 ..S ^TMP("PSB",$J,PSBX,0)=1,^TMP("PSB",$J,PSBX,1)="0^0^0^-1^A ""DATE OF DEATH"" has been logged for this patient."
"RTN","PSBVDLTB",83,0)
 D INP^VADPT I VAIN(1)']"" S DISCHRGD=1 K VAIN D  Q DISCHRGD
"RTN","PSBVDLTB",84,0)
 .F PSBX="UDTAB","PBTAB","IVTAB","NO TAB" D
"RTN","PSBVDLTB",85,0)
 ..K ^TMP("PSB",$J,PSBX)
"RTN","PSBVDLTB",86,0)
 ..S ^TMP("PSB",$J,PSBX,0)=1,^TMP("PSB",$J,PSBX,1)="0^0^0^-1^The selected patient has been DISCHARGED."
"RTN","PSBVDLTB",87,0)
 Q DISCHRGD
"RTN","PSBVDLTB",88,0)
 ;
"RTN","PSBVDLU1")
0^7^B63529398^B56720920
"RTN","PSBVDLU1",1,0)
PSBVDLU1 ;BIRMINGHAM/EFC-VIRTUAL DUE LIST (VDL) UTILITIES ;1/10/12 8:34pm
"RTN","PSBVDLU1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13,32,68**;Mar 2004;Build 26
"RTN","PSBVDLU1",3,0)
 ;
"RTN","PSBVDLU1",4,0)
 ; Reference/IA
"RTN","PSBVDLU1",5,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBVDLU1",6,0)
 ; GETSIOPI^PSJBCMA5/5763
"RTN","PSBVDLU1",7,0)
 ;
"RTN","PSBVDLU1",8,0)
 ;*68 - add call to add special instructions (SI) entries to the
"RTN","PSBVDLU1",9,0)
 ;      ^TMP("PSB")  global that ends up in the RESULTS ARRAY of
"RTN","PSBVDLU1",10,0)
 ;      RPC PSB GETORDERTAB.
"RTN","PSBVDLU1",11,0)
 ;
"RTN","PSBVDLU1",12,0)
ODDSCH(PSBTABX) ;
"RTN","PSBVDLU1",13,0)
 I (PSBOST'<PSBWBEG)&(PSBOST'>PSBWEND) D ADD(PSBREC,PSBOTXT,PSBOST,PSBDDS,PSBSOLS,PSBADDS,PSBTABX)  ;Include start date/time as admin
"RTN","PSBVDLU1",14,0)
 S PSBQUIT=0,PSBCDT=PSBOST F  S PSBCDT=$$FMADD^XLFDT(PSBCDT,"","",PSBFREQ) Q:PSBQUIT=1  D
"RTN","PSBVDLU1",15,0)
 .I $P(PSBCDT,".",2)="" S PSBCDT=PSBCDT-1_".24"
"RTN","PSBVDLU1",16,0)
 .I PSBCDT>PSBWEND S PSBQUIT=1 Q
"RTN","PSBVDLU1",17,0)
 .I PSBCDT'<PSBWBEG,PSBCDT<PSBOSP D ADD(PSBREC,PSBOTXT,PSBCDT,PSBDDS,PSBSOLS,PSBADDS,PSBTABX) Q
"RTN","PSBVDLU1",18,0)
 Q
"RTN","PSBVDLU1",19,0)
GETFREQ(PSBDFN,PSBORDN) ;
"RTN","PSBVDLU1",20,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",21,0)
 D EN^PSJBCMA1(PSBDFN,PSBORDN,1)
"RTN","PSBVDLU1",22,0)
 S PSBFREQ=$P(^TMP("PSJ1",$J,4),U,11)
"RTN","PSBVDLU1",23,0)
 S PSBSCHBR=$P(^TMP("PSJ1",$J,2),"^",5)
"RTN","PSBVDLU1",24,0)
 I $$PSBDCHK1^PSBVT1(PSBSCHBR) S PSBFREQ=""
"RTN","PSBVDLU1",25,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",26,0)
 Q PSBFREQ
"RTN","PSBVDLU1",27,0)
 ;
"RTN","PSBVDLU1",28,0)
GETADMIN(PSBDFN,PSBORDN,PSBSTRT,PSBFREQ,PSBEVDT) ;
"RTN","PSBVDLU1",29,0)
 ;Determine administration times of an odd schedule for today
"RTN","PSBVDLU1",30,0)
 N PSBADMIN
"RTN","PSBVDLU1",31,0)
 K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBVDLU1",32,0)
 D EN^PSJBCMA1(PSBDFN,PSBORDN,1)
"RTN","PSBVDLU1",33,0)
 S PSBADMIN=$P(^TMP("PSJ1",$J,4),U,9),PSBFREQ=$P(^TMP("PSJ1",$J,4),U,11),^TMP("PSB",$J,"GETADMIN",0)=PSBADMIN
"RTN","PSBVDLU1",34,0)
 I $E(PSBFREQ)'?1N K ^TMP("PSJ1",$J) Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",35,0)
 I PSBFREQ=0 K ^TMP("PSJ1",$J) Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",36,0)
 I PSBSTRT'<PSBEVDT S PSBADMIN=$E($P(PSBSTRT,".",2)_"0000",1,4),^TMP("PSB",$J,"GETADMIN",0)=PSBADMIN
"RTN","PSBVDLU1",37,0)
 S PSBCDT=PSBSTRT,(PSBADTMX,PSBQUIT)=0 F  S PSBCDT=$$FMADD^XLFDT(PSBCDT,"","",PSBFREQ) D  Q:PSBQUIT=1
"RTN","PSBVDLU1",38,0)
 .I $P(PSBCDT,".",2)="" S PSBCDT=PSBCDT-1_".24"
"RTN","PSBVDLU1",39,0)
 .I (PSBCDT\1)>(PSBEVDT\1) S PSBQUIT=1 Q
"RTN","PSBVDLU1",40,0)
 .I (PSBCDT\1)=(PSBEVDT\1) S PSBADMIN=PSBADMIN_$S(PSBADMIN="":"",1:"-")_$E($P(PSBCDT,".",2)_"0000",1,4)
"RTN","PSBVDLU1",41,0)
 .S ^TMP("PSB",$J,"GETADMIN",PSBADTMX)=PSBADMIN
"RTN","PSBVDLU1",42,0)
 .S:($L(PSBADMIN)+5)>255 PSBADTMX=PSBADTMX+1,PSBADMIN=""
"RTN","PSBVDLU1",43,0)
 K ^TMP("PSJ1",$J),PSBADTMX
"RTN","PSBVDLU1",44,0)
 Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",45,0)
 ;
"RTN","PSBVDLU1",46,0)
ADD(PSBREC,PSBSI,PSBDT,PSBDD,PSBSOL,PSBADD,PSBTAB) ;
"RTN","PSBVDLU1",47,0)
 ;
"RTN","PSBVDLU1",48,0)
 ; Description: Add order to ^TMP("PSB",$J,PSBTAB,...) for RPC Return RESULTS
"RTN","PSBVDLU1",49,0)
 ;
"RTN","PSBVDLU1",50,0)
 ; PSBREC=order hdr from above
"RTN","PSBVDLU1",51,0)
 ; PSBSI=special instructions
"RTN","PSBVDLU1",52,0)
 ; PSBDT=admin date/time
"RTN","PSBVDLU1",53,0)
 ; PSBDD=Dispense Drugs
"RTN","PSBVDLU1",54,0)
 ; PSBSOL=Solutions
"RTN","PSBVDLU1",55,0)
 ; PSBADD=Additives
"RTN","PSBVDLU1",56,0)
 ;
"RTN","PSBVDLU1",57,0)
 N PSB
"RTN","PSBVDLU1",58,0)
 S PSBDT=$E(PSBDT,1,12),PSBQR=0
"RTN","PSBVDLU1",59,0)
 S PSB=$O(^TMP("PSB",$J,PSBTAB,""),-1) ; Get next node
"RTN","PSBVDLU1",60,0)
 S $P(PSBREC,U,14)=PSBDT ; Admin Time sits in ^14
"RTN","PSBVDLU1",61,0)
 I $P(PSBREC,U,5)'="O" S X=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT,0)) D:X
"RTN","PSBVDLU1",62,0)
 .S $P(PSBREC,U,12)=X
"RTN","PSBVDLU1",63,0)
 .K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLU1",64,0)
 .S PSBSTUS=$P(^PSB(53.79,X,0),U,9),$P(PSBREC,U,13)=$S(PSBSTUS="N":"",(PSBSTUS="")&$G(PSBLCK):"U",1:PSBSTUS),$P(PSBREC,U,23)=$P(^PSB(53.79,X,0),U,10),$P(PSBREC,U,24)=$P(^PSB(53.79,X,0),U,7)
"RTN","PSBVDLU1",65,0)
 .I $D(^PSB(53.79,X)) I PSBDOSEF="PATCH",PSBSTUS="G",PSBDT=$P(^PSB(53.79,X,.1),U,3),PSBQRR=0 S PSBQR=1
"RTN","PSBVDLU1",66,0)
 .I PSBSTUS="G",$G(PSBFLAG) D CHECK ;Get the correct dispense drug
"RTN","PSBVDLU1",67,0)
 I ($P(PSBREC,U,5)="O") D
"RTN","PSBVDLU1",68,0)
 .S X=$O(^PSB(53.79,"AORDX",DFN,PSBONX,"")) Q:X=""
"RTN","PSBVDLU1",69,0)
 .S Y=$O(^PSB(53.79,"AORDX",DFN,PSBONX,X,"")) Q:Y=""  S $P(PSBREC,U,12)=Y
"RTN","PSBVDLU1",70,0)
 .K PSBLCK L +^PSB(53.79,Y):1  I  L -^PSB(53.79,Y) S PSBLCK=1
"RTN","PSBVDLU1",71,0)
 .S PSBSTUS=$P(^PSB(53.79,Y,0),U,9),$P(PSBREC,U,13)=$S(PSBSTUS="N":"",(PSBSTUS="")&$G(PSBLCK):"U",1:PSBSTUS),$P(PSBREC,U,24)=$P(^PSB(53.79,Y,0),U,7)
"RTN","PSBVDLU1",72,0)
 .I $D(^PSB(53.79,Y)) I PSBDOSEF="PATCH",PSBSTUS="G",PSBDT=$P(^PSB(53.79,Y,.1),U,3),PSBQRR=0 S PSBQR=1
"RTN","PSBVDLU1",73,0)
 .I PSBSTUS="G",$G(PSBFLAG) D CHECK
"RTN","PSBVDLU1",74,0)
 Q:PSBQR=1
"RTN","PSBVDLU1",75,0)
 S $P(PSBREC,U,25)=0 I $G(PSBTRFL),$P(PSBREC,U,11)]"",$P(PSBREC,U,11)'<$G(PSBNTDT),$P(PSBREC,U,11)'>$G(PSBTRDT) S $P(PSBREC,U,25)=1
"RTN","PSBVDLU1",76,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBREC ; Order Hdr
"RTN","PSBVDLU1",77,0)
 I $P(PSBREC,U,12)]"" S PSBONVDL($P(PSBREC,U,12))=""
"RTN","PSBVDLU1",78,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSI ; Special Instructions
"RTN","PSBVDLU1",79,0)
 ; add dispense drugs
"RTN","PSBVDLU1",80,0)
 I $D(PSBDDA) S X="" F  S X=$O(PSBDDA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBDDA(X)
"RTN","PSBVDLU1",81,0)
 S PSBCHDT=0
"RTN","PSBVDLU1",82,0)
 I (PSBTAB'["CVRSHT"),(PSBONX["V"),(PSBOSTS="D"),($G(PSBFOR)="") D  Q  ;get infusing bag from DCed but not DEed orders
"RTN","PSBVDLU1",83,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBVDLU1",84,0)
 .D INFUSING^PSBVDLU2 I PSBCOMP=0 Q
"RTN","PSBVDLU1",85,0)
 .I $D(PSBSOLA) S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSOLA(X)
"RTN","PSBVDLU1",86,0)
 .I $D(PSBADA) S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBADA(X)
"RTN","PSBVDLU1",87,0)
 .S X="" F  S X=$O(PSBPORA(PSBONX,X)) S PSBUID=$P(PSBPORA(PSBONX,X),U,1) Q:PSBUID]""  Q:X=""
"RTN","PSBVDLU1",88,0)
 .I PSBUID["P" Q
"RTN","PSBVDLU1",89,0)
 .I PSBUID["WS" D
"RTN","PSBVDLU1",90,0)
 ..S PSBNODE=$O(^PSB(53.79,"AUID",DFN,X,PSBUID,""))
"RTN","PSBVDLU1",91,0)
 ..S PSBUIDA(PSBUID)="ID"_U_PSBUID
"RTN","PSBVDLU1",92,0)
 ..S X=0 F  S X=$O(^PSB(53.79,PSBNODE,.6,X)) Q:'X  S PSBUIDA(PSBUID)=PSBUIDA(PSBUID)_U_"ADD;"_$P(^PSB(53.79,PSBNODE,.6,X,0),U,1)
"RTN","PSBVDLU1",93,0)
 ..S X=0 F  S X=$O(^PSB(53.79,PSBNODE,.7,X)) Q:'X  S PSBUIDA(PSBUID)=PSBUIDA(PSBUID)_U_"SOL;"_$P(^PSB(53.79,PSBNODE,.7,X,0),U,1)
"RTN","PSBVDLU1",94,0)
 .S PSBSONX=PSBONX
"RTN","PSBVDLU1",95,0)
 .I '$D(PSBUIDA(PSBUID)) S PSBCKOR="" F  S PSBCKOR=$O(PSBPORA(PSBSONX,PSBCKOR)) Q:PSBCKOR=""  D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBCKOR) Q:$D(PSBUIDA(PSBUID))
"RTN","PSBVDLU1",96,0)
 .S PSBONX=PSBSONX
"RTN","PSBVDLU1",97,0)
 .S:$D(PSBUIDA(PSBUID)) PSB=PSB+2,^TMP("PSB",$J,PSBTAB,PSB-1)=PSBUIDA(PSBUID),^TMP("PSB",$J,PSBTAB,PSB)="END"
"RTN","PSBVDLU1",98,0)
 .D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$O(PSBPORA("")))
"RTN","PSBVDLU1",99,0)
 ; add additives
"RTN","PSBVDLU1",100,0)
 I $D(PSBADA) S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBADA(X)
"RTN","PSBVDLU1",101,0)
 ; add solutions
"RTN","PSBVDLU1",102,0)
 I $D(PSBSOLA) S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S $P(PSBSOLA(X),U,5)="",PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSOLA(X)
"RTN","PSBVDLU1",103,0)
 I PSBONX["V" D EN^PSBPOIV(DFN,PSBONX)  ; get bags
"RTN","PSBVDLU1",104,0)
 I $D(^TMP("PSBAR",$J)) S PSBUID=DFN_"V"_99999 F  S PSBUID=$O(^TMP("PSBAR",$J,PSBUID),-1) Q:PSBUID=""  D
"RTN","PSBVDLU1",105,0)
 .S PSBUIDS=^TMP("PSBAR",$J,PSBUID)
"RTN","PSBVDLU1",106,0)
 .I $P(PSBUIDS,U,1)="I",$P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S" Q  ; bag has invalid IV parameter, is not infusing or stopped
"RTN","PSBVDLU1",107,0)
 .I $P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S",$P(PSBUIDS,U,8)'="" Q  ; label is no longer valid, bag is not infusing or stopped
"RTN","PSBVDLU1",108,0)
 .I $P(PSBUIDS,U,2)="C" Q  ; bag is completed
"RTN","PSBVDLU1",109,0)
 .I $P(PSBUIDS,U,2)="G" Q  ; bag is given (PBTAB)
"RTN","PSBVDLU1",110,0)
 .S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=$P(PSBUIDS,U,10,999)
"RTN","PSBVDLU1",111,0)
 K ^TMP("PSBAR",$J)
"RTN","PSBVDLU1",112,0)
 D:PSBSIOPI GETSI(DFN,PSBONX,PSBTAB)                    ;*68
"RTN","PSBVDLU1",113,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)="END"
"RTN","PSBVDLU1",114,0)
 S ^TMP("PSB",$J,PSBTAB,0)=PSB
"RTN","PSBVDLU1",115,0)
 Q
"RTN","PSBVDLU1",116,0)
 ;
"RTN","PSBVDLU1",117,0)
CHECK S FILE=53.795,PSBNODE=.5,PSBIENS=X_","
"RTN","PSBVDLU1",118,0)
 F I=0:0 S I=$O(^PSB(53.79,X,PSBNODE,I)) Q:'I  S $P(PSBDDS,U,3,4)=$$GET1^DIQ(FILE,I_","_PSBIENS,.01,"I")_U_$$GET1^DIQ(FILE,I_","_PSBIENS,.01)
"RTN","PSBVDLU1",119,0)
 Q
"RTN","PSBVDLU1",120,0)
 ;
"RTN","PSBVDLU1",121,0)
VNURSE(PSBTAB) ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLU1",122,0)
 F PSBLP=1:1:$P(^TMP("PSB",$J,PSBTAB,0),U,1) S X=^TMP("PSB",$J,PSBTAB,PSBLP) I $P(X,U)=DFN D
"RTN","PSBVDLU1",123,0)
 .K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",124,0)
 .D PSJ1^PSBVT(DFN,$P(X,U,2))
"RTN","PSBVDLU1",125,0)
 .S $P(^TMP("PSB",$J,PSBTAB,PSBLP),U,19)=$S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBVDLU1",126,0)
 K PSBLP,PSBTAB
"RTN","PSBVDLU1",127,0)
 Q
"RTN","PSBVDLU1",128,0)
 ;
"RTN","PSBVDLU1",129,0)
OKAY(PSBSTRT,PSBADMIN,PSBSCH,PSBORDER,PSBDRUG,PSBFREQ,PSBOSTS) ;
"RTN","PSBVDLU1",130,0)
 ;
"RTN","PSBVDLU1",131,0)
 ; Description: Determines if an order schedule is valid for
"RTN","PSBVDLU1",132,0)
 ;  the date in PSBADMIN (i.e. Q4D, is it valid today)
"RTN","PSBVDLU1",133,0)
 ;
"RTN","PSBVDLU1",134,0)
 ; PSBSTRT:  Start Date of order (Time ignored)
"RTN","PSBVDLU1",135,0)
 ; PSBADMIN: Date of administration to check (Time ignored)
"RTN","PSBVDLU1",136,0)
 ; PSBSCH:  Schedule (i.e. MO-WE-FR@0900 or Q48H...)
"RTN","PSBVDLU1",137,0)
 ; PSBORDER: Order reference
"RTN","PSBVDLU1",138,0)
 ; PSBDRUG:  Drug ordered (Orderable Item)
"RTN","PSBVDLU1",139,0)
 ; PSBOSTS: The status of the order
"RTN","PSBVDLU1",140,0)
 ;
"RTN","PSBVDLU1",141,0)
 N PSBOKAY,PSBDAYS,PSBDOW
"RTN","PSBVDLU1",142,0)
 S PSBOSTS=$G(PSBOSTS)
"RTN","PSBVDLU1",143,0)
 ;
"RTN","PSBVDLU1",144,0)
 S PSBOKAY=0  ; Default Flag
"RTN","PSBVDLU1",145,0)
 I PSBFREQ'="",PSBFREQ'="D",PSBFREQ'>1440 Q 1
"RTN","PSBVDLU1",146,0)
 ;PRN and ONE TIMES show everyday
"RTN","PSBVDLU1",147,0)
 I (PSBSCHT="P")!(PSBSCHT="O") Q 1
"RTN","PSBVDLU1",148,0)
 S PSBDAYS=$$DAYS(PSBSCH)
"RTN","PSBVDLU1",149,0)
 ;
"RTN","PSBVDLU1",150,0)
 I PSBDAYS=1 S PSBOKAY=1 Q PSBOKAY  ; Order is everyday
"RTN","PSBVDLU1",151,0)
 ;
"RTN","PSBVDLU1",152,0)
 ; find out if today is a good day for multi days
"RTN","PSBVDLU1",153,0)
 S PSBOKAY=0,PSBRDTE=PSBSTRT
"RTN","PSBVDLU1",154,0)
 S PSBADBR=PSBADMIN\1
"RTN","PSBVDLU1",155,0)
 S PSBENR=(PSBADMIN\1)+1
"RTN","PSBVDLU1",156,0)
 I PSBDAYS>1 D  Q PSBOKAY
"RTN","PSBVDLU1",157,0)
 .I PSBADBR=(PSBSTRT\1) S PSBOKAY=1
"RTN","PSBVDLU1",158,0)
 .F  S PSBRDTE=$$FMADD^XLFDT(PSBRDTE,"","",PSBFREQ) Q:PSBRDTE>PSBENR  D
"RTN","PSBVDLU1",159,0)
 ..I $P(PSBRDTE,".",2)="" S PSBRDTE=PSBRDTE-1_".24"
"RTN","PSBVDLU1",160,0)
 ..I PSBRDTE\1=PSBADBR S PSBOKAY=1
"RTN","PSBVDLU1",161,0)
 ..I PSBOKAY="1" Q
"RTN","PSBVDLU1",162,0)
 ;
"RTN","PSBVDLU1",163,0)
 ; Try the MO-WE-FR@0800 thing as last resort
"RTN","PSBVDLU1",164,0)
 S X=PSBADMIN D H^%DTC I %Y=-1 D  Q PSBOKAY  ; Error
"RTN","PSBVDLU1",165,0)
 .S PSBOKAY=0
"RTN","PSBVDLU1",166,0)
 .Q:PSBOSTS="E"
"RTN","PSBVDLU1",167,0)
 .Q:$G(PSBMHND)="PSBOMH"
"RTN","PSBVDLU1",168,0)
 .D ERROR^PSBMLU($G(PSBORDER,"UNKNOWN"),$G(PSBDRUG,""),DFN,"Unable to determine schedule "_PSBSCH,PSBSCH)
"RTN","PSBVDLU1",169,0)
 S PSBDOW=$P("SU^MO^TU^WE^TH^FR^SA",U,%Y+1)
"RTN","PSBVDLU1",170,0)
 I $F(PSBSCH,PSBDOW)>0 S PSBOKAY=1 Q PSBOKAY
"RTN","PSBVDLU1",171,0)
 S PSBOKAY=0
"RTN","PSBVDLU1",172,0)
 Q PSBOKAY
"RTN","PSBVDLU1",173,0)
 ;
"RTN","PSBVDLU1",174,0)
DAYS(PSB) ; Return days between doses (-1: error, 1:everyday 2: QOD...)
"RTN","PSBVDLU1",175,0)
 ;
"RTN","PSBVDLU1",176,0)
 ; Is it a PRN
"RTN","PSBVDLU1",177,0)
 I PSB?.E1"PRN".E Q 1  ; Straight PRN - As Needed
"RTN","PSBVDLU1",178,0)
 ;
"RTN","PSBVDLU1",179,0)
 S PSB=$TR(PSB," ","")
"RTN","PSBVDLU1",180,0)
 I PSB?2.4N.E Q 1
"RTN","PSBVDLU1",181,0)
 S X=PSBFREQ/1440 Q X
"RTN","PSBVDLU1",182,0)
 ;
"RTN","PSBVDLU1",183,0)
 Q
"RTN","PSBVDLU1",184,0)
 ;
"RTN","PSBVDLU1",185,0)
LAST ;
"RTN","PSBVDLU1",186,0)
 S PSBCC=0
"RTN","PSBVDLU1",187,0)
 S ZZ="" F  S ZZ=$O(^PSB(53.79,X,.3,ZZ),-1) Q:'ZZ  Q:PSBFLAG=1  S PSBDATA2=$G(^(ZZ,0)) D
"RTN","PSBVDLU1",188,0)
 .S PSBCC=PSBCC+1
"RTN","PSBVDLU1",189,0)
 .I (PSBCC=2)!($P($P(PSBDATA2,U)," ")="Refused:")!($P($P(PSBDATA2,U)," ")="Held:") S $P(PSBREC,U,11)=$P(PSBDATA2,U,3),PSBFLAG=1
"RTN","PSBVDLU1",190,0)
 Q
"RTN","PSBVDLU1",191,0)
 ;
"RTN","PSBVDLU1",192,0)
GETSI(DFN,ORD,TAB) ;Get Special Instructions/Other Print Info from IM   ;*68
"RTN","PSBVDLU1",193,0)
 ;
"RTN","PSBVDLU1",194,0)
 ; This Tag will load the SIOPI WP text into the TMP global used by
"RTN","PSBVDLU1",195,0)
 ; the PSB GETORDERTAB RPC, which ends up in the RESULTS array passed
"RTN","PSBVDLU1",196,0)
 ; back to the BCMA GUI.
"RTN","PSBVDLU1",197,0)
 ;
"RTN","PSBVDLU1",198,0)
 N QQ
"RTN","PSBVDLU1",199,0)
 K ^TMP("PSJBCMA5",$J,DFN,ORD)
"RTN","PSBVDLU1",200,0)
 D GETSIOPI^PSJBCMA5(DFN,ORD,1)
"RTN","PSBVDLU1",201,0)
 Q:'$D(^TMP("PSJBCMA5",$J,DFN,ORD))
"RTN","PSBVDLU1",202,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,DFN,ORD,QQ)) Q:'QQ  D
"RTN","PSBVDLU1",203,0)
 .S PSB=PSB+1
"RTN","PSBVDLU1",204,0)
 .S ^TMP("PSB",$J,TAB,PSB)="SI^"_^TMP("PSJBCMA5",$J,DFN,ORD,QQ)
"RTN","PSBVDLU1",205,0)
 K ^TMP("PSJBCMA5",$J,DFN,ORD)
"RTN","PSBVDLU1",206,0)
 Q
"RTN","PSBVDLUD")
0^18^B85273287^B82540618
"RTN","PSBVDLUD",1,0)
PSBVDLUD ;BIRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;2/1/12 10:27am
"RTN","PSBVDLUD",2,0)
 ;;3.0;BAR CODE MED ADMIN;**11,13,38,32,58,68**;Mar 2004;Build 26
"RTN","PSBVDLUD",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLUD",4,0)
 ;
"RTN","PSBVDLUD",5,0)
 ; Reference/IA
"RTN","PSBVDLUD",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLUD",7,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLUD",8,0)
 ; GETPROVL^PSGSICH1/5653
"RTN","PSBVDLUD",9,0)
 ; INTRDIC^PSGSICH1/5654
"RTN","PSBVDLUD",10,0)
 ;
"RTN","PSBVDLUD",11,0)
 ;*58 - add 29th piece to Results for Override/Intervention flag 1/0
"RTN","PSBVDLUD",12,0)
 ;*68 - add 30th piece to Results for Last Injection Site
"RTN","PSBVDLUD",13,0)
 ;
"RTN","PSBVDLUD",14,0)
EN(DFN,PSBDT) ;
"RTN","PSBVDLUD",15,0)
 ;
"RTN","PSBVDLUD",16,0)
 ;
"RTN","PSBVDLUD",17,0)
 ; Description:
"RTN","PSBVDLUD",18,0)
 ; Returns the current unit dose order set for today to display
"RTN","PSBVDLUD",19,0)
 ; on the client VDL
"RTN","PSBVDLUD",20,0)
 ;
"RTN","PSBVDLUD",21,0)
 N PSBDATA,PSBTBOUT
"RTN","PSBVDLUD",22,0)
 S PSBTBOUT=0
"RTN","PSBVDLUD",23,0)
 ;
"RTN","PSBVDLUD",24,0)
 ;This routine now re-uses the ^TMP("PSJ",$J global built in PSBVDLTB
"RTN","PSBVDLUD",25,0)
 ;
"RTN","PSBVDLUD",26,0)
 G:$G(^TMP("PSJ",$J,1,0))=-1 1
"RTN","PSBVDLUD",27,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBVDLUD",28,0)
 .S:(PSBTAB'="UDTAB")&($G(^TMP("PSB",$J,"UDTAB",2))>0) PSBTBOUT=1
"RTN","PSBVDLUD",29,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBVDLUD",30,0)
 .;
"RTN","PSBVDLUD",31,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLUD",32,0)
 .;
"RTN","PSBVDLUD",33,0)
 .Q:PSBONX["V"  ;No IVs on UD tab
"RTN","PSBVDLUD",34,0)
 .Q:PSBONX["P"  ;     No Pending Orders
"RTN","PSBVDLUD",35,0)
 .Q:PSBOST>PSBWADM  ; Order Start Date/Time > admin window
"RTN","PSBVDLUD",36,0)
 .Q:PSBOSP<PSBWBEG  ; For Non one-times Order Stop Date/Time < vdl window
"RTN","PSBVDLUD",37,0)
 .Q:PSBOSTS["D"  ;     Is it DC'd
"RTN","PSBVDLUD",38,0)
 .Q:PSBNGF  ;         Is it marked DO NOT GIVE!
"RTN","PSBVDLUD",39,0)
 .Q:PSBIVPSH
"RTN","PSBVDLUD",40,0)
 .;
"RTN","PSBVDLUD",41,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLUD",42,0)
 .;
"RTN","PSBVDLUD",43,0)
 .D NOW^%DTC
"RTN","PSBVDLUD",44,0)
 .Q:PSBOSP<%
"RTN","PSBVDLUD",45,0)
 .;
"RTN","PSBVDLUD",46,0)
 .; include Active, Renewed, ReInstated and On Call
"RTN","PSBVDLUD",47,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call)
"RTN","PSBVDLUD",48,0)
 .I PSBSCHT'="O",PSBOSTS'="A",PSBOSTS'="H",PSBOSTS'="R",PSBOSTS'="RE",PSBOSTS'="O" Q
"RTN","PSBVDLUD",49,0)
 .;
"RTN","PSBVDLUD",50,0)
 .; Is One Time Given
"RTN","PSBVDLUD",51,0)
 .;
"RTN","PSBVDLUD",52,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLUD",53,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLUD",54,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLUD",55,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLUD",56,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLUD",57,0)
 .;
"RTN","PSBVDLUD",58,0)
 .; How long does One Time remain on VDL ??
"RTN","PSBVDLUD",59,0)
 .S PSBRMN=1
"RTN","PSBVDLUD",60,0)
 .I PSBSCHT="O",PSBOSP'=PSBOST&(%>PSBOSP) S PSBRMN=0
"RTN","PSBVDLUD",61,0)
 .Q:'PSBRMN
"RTN","PSBVDLUD",62,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLUD",63,0)
 .;
"RTN","PSBVDLUD",64,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLUD",65,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLUD",66,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLUD",67,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLUD",68,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLUD",69,0)
 .;
"RTN","PSBVDLUD",70,0)
 .S PSBREC=""
"RTN","PSBVDLUD",71,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLUD",72,0)
 .S $P(PSBREC,U,2)=PSBONX ; order
"RTN","PSBVDLUD",73,0)
 .S $P(PSBREC,U,3)=PSBON ; order ien
"RTN","PSBVDLUD",74,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLUD",75,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLUD",76,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLUD",77,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"") ; self med
"RTN","PSBVDLUD",78,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLUD",79,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLUD",80,0)
 .S $P(PSBREC,U,10)=PSBMR ; med route
"RTN","PSBVDLUD",81,0)
 .; Last Given from the AOIP X-Ref - not given status not excepted
"RTN","PSBVDLUD",82,0)
 .S (PSBCNT,PSBFLAG)=0,(YZ,PSBSTUS,PSBADMER)="" K PSBHSTA,PSBHSTAX
"RTN","PSBVDLUD",83,0)
 .F XZ=1:1:20 S YZ=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ),-1),(PSBCNT,PSBFLAG)=0 Q:YZ=""  D
"RTN","PSBVDLUD",84,0)
 ..S:YZ>0 $P(PSBREC,U,11)=YZ
"RTN","PSBVDLUD",85,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ,X),-1) Q:X=""  D
"RTN","PSBVDLUD",86,0)
 ...K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLUD",87,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLUD",88,0)
 ...I $G(PSBSTUS)="" S:'$G(PSBLCK) PSBSTUS="X" I $G(PSBLCK) S PSBADMER=1 D
"RTN","PSBVDLUD",89,0)
 ....K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLUD",90,0)
 ....S PSBPARM6=X,Y=$P(^PSB(53.79,X,.1),U,3) D DD^%DT S PSBPARM3=Y,Y=$P(^PSB(53.79,X,0),U,6) D DD^%DT S PSBPARM5=Y
"RTN","PSBVDLUD",91,0)
 ....S PSBPARM7=$P(^PSB(53.79,X,0),U,7) S PSBPARM7="( # "_PSBPARM7_" ) "_$$GET1^DIQ(200,PSBPARM7_",",.01)
"RTN","PSBVDLUD",92,0)
 ....K PSBXTMP S PSBXTMP=PSBONX
"RTN","PSBVDLUD",93,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBPARM6_",",.11))
"RTN","PSBVDLUD",94,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,PSBPARM3_" admin's ACTION STATUS is ""UNKNOWN"".",PSBSCH,PSBPARM5,PSBPARM6,PSBPARM7) ;  SEND AN E-MAIL
"RTN","PSBVDLUD",95,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXTMP)  ;Reset Variables
"RTN","PSBVDLUD",96,0)
 ....S X=PSBPARM6 K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLUD",97,0)
 ...K PSBLCK S:(PSBSTUS']"") PSBSTUS="U"  I PSBSTUS'="N",($G(PSBSTUS)'="X") S PSBFLAG=1,PSBHSTA(YZ,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBVDLUD",98,0)
 ...D:PSBSTUS="N"
"RTN","PSBVDLUD",99,0)
 ....S $P(PSBREC,U,11)=""
"RTN","PSBVDLUD",100,0)
 ....S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBVDLUD",101,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLUD",102,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLUD",103,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBVDLUD",104,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBVDLUD",105,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBVDLUD",106,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBVDLUD",107,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBVDLUD",108,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBVDLUD",109,0)
 .S $P(PSBREC,U,12)=""  ;med log ien inserted below for actual date
"RTN","PSBVDLUD",110,0)
 .S $P(PSBREC,U,13)=""  ;med log status inserted below for actual date
"RTN","PSBVDLUD",111,0)
 .S $P(PSBREC,U,14)="" ; admin date inserted below
"RTN","PSBVDLUD",112,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLUD",113,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;med route injectable flag
"RTN","PSBVDLUD",114,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLUD",115,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLUD",116,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLUD",117,0)
 .S:PSBDOSEF?1"CAP".E!(PSBDOSEF?1"TAB".E)!(PSBDOSEF="PATCH")!(PSBDOSEF="GUM,CHEWABLE") $P(PSBREC,U,18)=PSBDOSEF   ;dosage form, add Gum,Chewable for HD208693
"RTN","PSBVDLUD",118,0)
 .S $P(PSBREC,U,20)=$S((PSBSTUS="X")!(PSBSTUS="N"):"",1:PSBSTUS) ; last action status
"RTN","PSBVDLUD",119,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLUD",120,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLUD",121,0)
 .S $P(PSBREC,U,26)=PSBOSP
"RTN","PSBVDLUD",122,0)
 .S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL(DFN,PSBOIT)
"RTN","PSBVDLUD",123,0)
 .;*58 determine if override or intervn exists, send 1/0 (true/false)
"RTN","PSBVDLUD",124,0)
 .N PSBARR D GETPROVL^PSGSICH1(DFN,PSBONX,.PSBARR)
"RTN","PSBVDLUD",125,0)
 .I $O(PSBARR(""))="" D INTRDIC^PSGSICH1(DFN,PSBONX,.PSBARR,2)
"RTN","PSBVDLUD",126,0)
 .S $P(PSBREC,U,29)=$S($O(PSBARR(""))]"":1,1:0)
"RTN","PSBVDLUD",127,0)
 .;*68 add last injection site
"RTN","PSBVDLUD",128,0)
 .K LI D RPC^PSBINJEC(.LI,DFN,PSBOIT,9999999,1)
"RTN","PSBVDLUD",129,0)
 .S $P(PSBREC,U,30)=$P(LI(1),U,6)   ;if no inj's, 6th will be null
"RTN","PSBVDLUD",130,0)
 .;
"RTN","PSBVDLUD",131,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLUD",132,0)
 .D NOW^%DTC
"RTN","PSBVDLUD",133,0)
 .S (PSBDDS,PSBSOLS,PSBADDS,PSBFLAG)="0"
"RTN","PSBVDLUD",134,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLUD",135,0)
 ..I $P(PSBDDA(Y),U,5)=$P(%,".") S PSBFLAG=1 ;If drug was inactivated
"RTN","PSBVDLUD",136,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<%)  ; Inactive
"RTN","PSBVDLUD",137,0)
 ..S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1
"RTN","PSBVDLUD",138,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4)
"RTN","PSBVDLUD",139,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLUD",140,0)
 .;
"RTN","PSBVDLUD",141,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLUD",142,0)
 .S PSBQRR=0
"RTN","PSBVDLUD",143,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"UDTAB") Q
"RTN","PSBVDLUD",144,0)
 .;
"RTN","PSBVDLUD",145,0)
 .; Now we deal with only continuous
"RTN","PSBVDLUD",146,0)
 .; process admintimes
"RTN","PSBVDLUD",147,0)
 .; Display an order on the VDL based on the frequency received from IPM **PSB*2.0*3
"RTN","PSBVDLUD",148,0)
 .S (PSBYES,PSBODD,PSBYTF)=0
"RTN","PSBVDLUD",149,0)
 .I PSBSCH="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"No Schedule on this order")
"RTN","PSBVDLUD",150,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBVDLUD",151,0)
 .I PSBYES,PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLUD",152,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBVDLUD",153,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLUD",154,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLUD",155,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBVDLUD",156,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBVDLUD",157,0)
 .I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBVDLUD",158,0)
 .I (PSBADST="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1("UDTAB") Q  ;calculate admin times based on frequency
"RTN","PSBVDLUD",159,0)
 .; No admin times, MAYDAY MAYDAY!!
"RTN","PSBVDLUD",160,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBVDLUD",161,0)
 .I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBVDLUD",162,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLUD",163,0)
 .; build all orders for both days.
"RTN","PSBVDLUD",164,0)
 .F PSBY=1:1 Q:$P(PSBADST,"-",PSBY)=""  D
"RTN","PSBVDLUD",165,0)
 ..;For invalid admin times
"RTN","PSBVDLUD",166,0)
 ..I ($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N) D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBVDLUD",167,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLUD",168,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBVDLUD",169,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLUD",170,0)
 ...D:(PSB'<PSBOST)&(PSB<PSBOSP)  ; Make sure this time is active
"RTN","PSBVDLUD",171,0)
 ....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLUD",172,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",173,0)
 ..;
"RTN","PSBVDLUD",174,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLUD",175,0)
 ..;
"RTN","PSBVDLUD",176,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLUD",177,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBVDLUD",178,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLUD",179,0)
 ...D:(PSB'<PSBOST)&(PSB<PSBOSP)  ; Make sure this time is active
"RTN","PSBVDLUD",180,0)
 ....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLUD",181,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",182,0)
 .K PSBSTUS
"RTN","PSBVDLUD",183,0)
1 K PSBREC D EN^PSBVDLPA
"RTN","PSBVDLUD",184,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLUD",185,0)
 D:PSBTAB="UDTAB" VNURSE^PSBVDLU1("UDTAB")
"RTN","PSBVDLUD",186,0)
 D CLEAN^PSBVT
"RTN","PSBVDLUD",187,0)
 Q
"RTN","PSBVDLUD",188,0)
 ;
"RTN","PSBVT")
0^20^B79719168^B77039096
"RTN","PSBVT",1,0)
PSBVT ;BIRMINGHAM/EFC-BCMA ORDER VARIABLES UTILITY ;4/10/12 1:00pm
"RTN","PSBVT",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,38,68**;Mar 2004;Build 26
"RTN","PSBVT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBVT",4,0)
 ;
"RTN","PSBVT",5,0)
 ; Reference/IA
"RTN","PSBVT",6,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBVT",7,0)
 ; ^TMP("PSJ",$J/2828
"RTN","PSBVT",8,0)
 ;
"RTN","PSBVT",9,0)
 ;*68 Define New Variable (IEN from Med Route file) in Tag PSJ which
"RTN","PSBVT",10,0)
 ;    uses the TMP global built by a previous call to PSJBCMA Api.
"RTN","PSBVT",11,0)
 ;
"RTN","PSBVT",12,0)
PSJ(PSBX1) ;
"RTN","PSBVT",13,0)
 S ^TMP("TK PSJ",PSBX1)=""
"RTN","PSBVT",14,0)
 S PSBSCRT="^TMP(""PSB"",$J,""PSBORDA"")"
"RTN","PSBVT",15,0)
 K @PSBSCRT M @PSBSCRT=^TMP("PSJ",$J,PSBX1)
"RTN","PSBVT",16,0)
 S PSBDFN=DFN
"RTN","PSBVT",17,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",0))
"RTN","PSBVT",18,0)
 S PSBON=+$P(PSBSCRT,U,3)  ; ord num w/o type
"RTN","PSBVT",19,0)
 S PSBONX=$P(PSBSCRT,U,3)  ; ord num w/  type "U" or "V"
"RTN","PSBVT",20,0)
 S PSBOTYP=$E(PSBONX,$L(PSBONX))
"RTN","PSBVT",21,0)
 S PSBPONX=$P(PSBSCRT,U,4)  ; prev ord num
"RTN","PSBVT",22,0)
 S PSBFON=$P(PSBSCRT,U,5)  ; foll ord num
"RTN","PSBVT",23,0)
 S PSBIVT=$P(PSBSCRT,U,6)  ; IV type
"RTN","PSBVT",24,0)
 S PSBISYR=$P(PSBSCRT,U,7)  ; intermit syrg
"RTN","PSBVT",25,0)
 S PSBCHEMT=$P(PSBSCRT,U,8)  ; chemo type
"RTN","PSBVT",26,0)
 S PSBCPRS=$P(PSBSCRT,U,9)  ; ords file entry (CPRS order #)
"RTN","PSBVT",27,0)
 S PSBFOR=$P(PSBSCRT,U,10)  ; reason for foll order
"RTN","PSBVT",28,0)
 Q:PSBSCRT=-1
"RTN","PSBVT",29,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",1))
"RTN","PSBVT",30,0)
 S PSBMR=$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,2) ;med rt
"RTN","PSBVT",31,0)
 S PSBMRAB=$P(PSBSCRT,U,1) ;med rt abbr
"RTN","PSBVT",32,0)
 S PSBMRIEN=+$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,4) ;med rt ien *68
"RTN","PSBVT",33,0)
 S PSBNJECT=+$G(^TMP("PSB",$J,"PSBORDA",1,0))  ;Inj site
"RTN","PSBVT",34,0)
 S PSBIVPSH=+$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,3) ;IV PUSH
"RTN","PSBVT",35,0)
 S PSBSCHT=$P(PSBSCRT,U,2)  ; sched type conversion
"RTN","PSBVT",36,0)
 S PSBSCH=$P(PSBSCRT,U,3)  ; sched
"RTN","PSBVT",37,0)
 S PSBOST=$P(PSBSCRT,U,4)  ; strt dte FM
"RTN","PSBVT",38,0)
 S PSBOSP=$P(PSBSCRT,U,5)  ; stp dte FM
"RTN","PSBVT",39,0)
 S PSBADST=$P(PSBSCRT,U,6)  ; admin times strin in NNNN- format
"RTN","PSBVT",40,0)
 S PSBOSTS=$P(PSBSCRT,U,7)  ; status
"RTN","PSBVT",41,0)
 S PSBNGF=$P(PSBSCRT,U,8)  ; not to be given flag
"RTN","PSBVT",42,0)
 S PSBOSCHT=$P(PSBSCRT,U,9)  ; origin sched type
"RTN","PSBVT",43,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",2))
"RTN","PSBVT",44,0)
 S PSBDOSE=$P(PSBSCRT,U,1)  ; dosage ordered
"RTN","PSBVT",45,0)
 S PSBIFR=$P(PSBSCRT,U,2)  ; infusn rate
"RTN","PSBVT",46,0)
 S PSBSM=$P(PSBSCRT,U,3)  ; self med
"RTN","PSBVT",47,0)
 S PSBHSM=$P(PSBSCRT,U,4)  ; hospital supplied self med
"RTN","PSBVT",48,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",3))
"RTN","PSBVT",49,0)
 S PSBOIT=$P(PSBSCRT,U,1)  ; order item IEN - > ^ORD(101.43)
"RTN","PSBVT",50,0)
 S PSBOITX=$P(PSBSCRT,U,2)  ; order item (expanded)_" "_dosage form
"RTN","PSBVT",51,0)
 I PSBOITX="" S PSBOITX="ZZZZ NO ORDERABLE ITEM"
"RTN","PSBVT",52,0)
 S PSBDOSEF=$P(PSBSCRT,U,3)  ; dosage form
"RTN","PSBVT",53,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",4))
"RTN","PSBVT",54,0)
 S PSBOTXT=PSBSCRT  ; special inst/other print info
"RTN","PSBVT",55,0)
 ; get disp drug
"RTN","PSBVT",56,0)
 I $G(^TMP("PSB",$J,"PSBORDA",700,0)) F PSBX2=1:1:^TMP("PSB",$J,"PSBORDA",700,0) M PSBDDA(PSBX2)=^TMP("PSB",$J,"PSBORDA",700,PSBX2,0) S PSBDDA(PSBX2)="DD^"_PSBDDA(PSBX2) ; # of DDrug
"RTN","PSBVT",57,0)
 ;     "DD"^dispensed drug IEN -> ^PSDRUG() DRUG^dispensed drug name^units per dose^inactive date
"RTN","PSBVT",58,0)
 ; build unique id list
"RTN","PSBVT",59,0)
 ; add addits
"RTN","PSBVT",60,0)
 I $D(^TMP("PSB",$J,"PSBORDA",800)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",800,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",61,0)
 .S PSBUIDA(PSBX2)="ID^"_PSBX2 F J=1:1:^TMP("PSB",$J,"PSBORDA",800,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"ADD;"_$P(^TMP("PSB",$J,"PSBORDA",800,PSBX2,J),U,1)
"RTN","PSBVT",62,0)
 ; add solutions
"RTN","PSBVT",63,0)
 I $D(^TMP("PSB",$J,"PSBORDA",900)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",900,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",64,0)
 .I '$D(PSBUIDA(PSBX2)) S PSBUIDA(PSBX2)="ID^"_PSBX2
"RTN","PSBVT",65,0)
 .F J=1:1:^TMP("PSB",$J,"PSBORDA",900,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"SOL;"_$P(^TMP("PSB",$J,"PSBORDA",900,PSBX2,J),U,1)
"RTN","PSBVT",66,0)
 ;     "ID"   ^   (piece 2,3,)... = type;IEN of each add/sol for this ID ex. "SOL;4"
"RTN","PSBVT",67,0)
 ; get addits
"RTN","PSBVT",68,0)
 I $G(^TMP("PSB",$J,"PSBORDA",850,0)) F PSBX2=1:1:^TMP("PSB",$J,"PSBORDA",850,0) D
"RTN","PSBVT",69,0)
 .M PSBADA(PSBX2)=^TMP("PSB",$J,"PSBORDA",850,PSBX2,0)  ; number od additives (exists only for IV)
"RTN","PSBVT",70,0)
 .S PSBADA(PSBX2)="ADD^"_PSBADA(PSBX2)
"RTN","PSBVT",71,0)
 .S PSBBAGS=$P(PSBADA(PSBX2),U,5) I PSBBAGS'="" S PSBBAG=" IN BAG "_$P(PSBBAGS,",",1) F I=2:1 S X=$P(PSBBAGS,",",I) Q:X=""  S PSBBAG=PSBBAG_" AND "_X
"RTN","PSBVT",72,0)
 .S:PSBBAGS'="" $P(PSBADA(PSBX2),U,5)=PSBBAG,$P(PSBADA(PSBX2),U,6)=PSBBAGS
"RTN","PSBVT",73,0)
 ;     "ADD"^additive IEN -> ^PS(52.6) IV ADDITIVES^additive name^strength ^bottle
"RTN","PSBVT",74,0)
 ; get soluts
"RTN","PSBVT",75,0)
 I $G(^TMP("PSB",$J,"PSBORDA",950,0)) F PSBX2=1:1:^TMP("PSB",$J,"PSBORDA",950,0) M PSBSOLA(PSBX2)=^TMP("PSB",$J,"PSBORDA",950,PSBX2,0) S PSBSOLA(PSBX2)="SOL^"_PSBSOLA(PSBX2)  ; # of SOL
"RTN","PSBVT",76,0)
 ;   "SOL"^solution IEN -> ^PS(52.7) IV SOLUTIONS^solution name^volume
"RTN","PSBVT",77,0)
 K ^TMP("PSB",$J,"PSBORDA"),PSBX1,PSBX2
"RTN","PSBVT",78,0)
 Q
"RTN","PSBVT",79,0)
 ;
"RTN","PSBVT",80,0)
PSJ1(PSBPAR1,PSBPAR2) ; set the variables for an individual order
"RTN","PSBVT",81,0)
 S ^TMP("TK PSJ1",PSBPAR1,PSBPAR2)=""
"RTN","PSBVT",82,0)
 ;     PSBPAR1 = DFN
"RTN","PSBVT",83,0)
 ;     PSBPAR2 = ORDNER NUMBER 
"RTN","PSBVT",84,0)
 S PSBSCRT="^TMP(""PSB"",$J,""PSBORDA"")"
"RTN","PSBVT",85,0)
 K @PSBSCRT
"RTN","PSBVT",86,0)
 N PSBX
"RTN","PSBVT",87,0)
 K ^TMP("PSJ1",$J) D EN^PSJBCMA1(PSBPAR1,PSBPAR2,1)
"RTN","PSBVT",88,0)
 M @PSBSCRT=^TMP("PSJ1",$J) K ^TMP("PSJ1",$J)
"RTN","PSBVT",89,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",0))
"RTN","PSBVT",90,0)
 S PSBDFN=PSBPAR1
"RTN","PSBVT",91,0)
 S PSBON=+$P(PSBSCRT,U,3)  ; ord num w/o type
"RTN","PSBVT",92,0)
 S PSBONX=$P(PSBSCRT,U,3)  ; ord num w/  type "U" or "V"
"RTN","PSBVT",93,0)
 S PSBOTYP=$E(PSBONX,$L(PSBONX))
"RTN","PSBVT",94,0)
 S PSBPONX=$P(PSBSCRT,U,4)  ; prev ord num
"RTN","PSBVT",95,0)
 S PSBFON=$P(PSBSCRT,U,5)  ; foll ord num
"RTN","PSBVT",96,0)
 S PSBIVT=$P(PSBSCRT,U,6)  ; IV type
"RTN","PSBVT",97,0)
 S PSBISYR=$P(PSBSCRT,U,7)  ; intermit syrg
"RTN","PSBVT",98,0)
 S PSBCHEMT=$P(PSBSCRT,U,8)  ; chemo type
"RTN","PSBVT",99,0)
 S PSBCPRS=$P(PSBSCRT,U,0)  ; ord file entry (CPRS order #)
"RTN","PSBVT",100,0)
 Q:PSBSCRT=-1
"RTN","PSBVT",101,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",1))
"RTN","PSBVT",102,0)
 S PSBMD=$P(PSBSCRT,U,1)  ; prov IEN -> ^VA(200)
"RTN","PSBVT",103,0)
 S PSBMDX=$P(PSBSCRT,U,2)  ; prov name
"RTN","PSBVT",104,0)
 S PSBMR=$P(PSBSCRT,U,3)  ; med rt IEN -> ^PS(51.2)
"RTN","PSBVT",105,0)
 I $G(PSBMR)'="" S PSBMR=$P(PSBSCRT,U,13)  ;med rt
"RTN","PSBVT",106,0)
 S PSBMRAB=$P(PSBSCRT,U,4)  ;med rt abbr
"RTN","PSBVT",107,0)
 S PSBNJECT=+$G(^TMP("PSB",$J,"PSBORDA",1,0))  ;Inj site
"RTN","PSBVT",108,0)
 S PSBIVPSH=+$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,2)  ;IV PUSH
"RTN","PSBVT",109,0)
 S PSBSM=$P(PSBSCRT,U,5)  ; self med
"RTN","PSBVT",110,0)
 S PSBSMX=$P(PSBSCRT,U,6)  ; expnd to YES/NO
"RTN","PSBVT",111,0)
 S PSBHSM=$P(PSBSCRT,U,7)  ; hospital supplied self med
"RTN","PSBVT",112,0)
 S PSBHSMX=$P(PSBSCRT,U,8)  ; expnd to YES/NO
"RTN","PSBVT",113,0)
 S PSBNGF=$P(PSBSCRT,U,9)  ; not to be given flag
"RTN","PSBVT",114,0)
 S PSBOSTS=$P(PSBSCRT,U,10)  ; ord status
"RTN","PSBVT",115,0)
 S PSBOSTSX=$P(PSBSCRT,U,11)  ; ord status expans
"RTN","PSBVT",116,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",2))
"RTN","PSBVT",117,0)
 S PSBOIT=$P(PSBSCRT,U,1)  ; orderable item IEN -> ^ORD(101.43) ORDERABLE ITEM
"RTN","PSBVT",118,0)
 S PSBOITX=$P(PSBSCRT,U,2)  ; orderable item (expaned)_" "_ dosage form
"RTN","PSBVT",119,0)
 I PSBOITX="" S PSBOITX="ZZZZ NO ORDERABLE ITEM"
"RTN","PSBVT",120,0)
 S PSBDOSE=$P(PSBSCRT,U,3)  ; dosage ordered
"RTN","PSBVT",121,0)
 S PSBIFR=$P(PSBSCRT,U,4)  ; infusion rate
"RTN","PSBVT",122,0)
 S PSBSCH=$P(PSBSCRT,U,5)  ; sched
"RTN","PSBVT",123,0)
 S PSBDOSEF=$P(PSBSCRT,U,6)  ; dosage form
"RTN","PSBVT",124,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",3))
"RTN","PSBVT",125,0)
 S PSBOTXT=$P(PSBSCRT,U,1)  ; UD special inst or IV other print info
"RTN","PSBVT",126,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",4))
"RTN","PSBVT",127,0)
 S PSBSCHT=$P(PSBSCRT,U,1)  ; sched type conversion
"RTN","PSBVT",128,0)
 S PSBSCHTX=$P(PSBSCRT,U,2)  ; sched type expansion
"RTN","PSBVT",129,0)
 S PSBLDT=$P(PSBSCRT,U,3)  ; log-in date FM
"RTN","PSBVT",130,0)
 S PSBLDTX=$P(PSBSCRT,U,4)  ; exp MM/DD/YYYY HH:MM
"RTN","PSBVT",131,0)
 S PSBOST=$P(PSBSCRT,U,5)  ; start date FM
"RTN","PSBVT",132,0)
 S PSBOSTX=$P(PSBSCRT,U,6)  ; exp MM/DD/YYYY HH:MM
"RTN","PSBVT",133,0)
 S PSBOSP=$P(PSBSCRT,U,7)  ; stop date FM
"RTN","PSBVT",134,0)
 S PSBOSPX=$P(PSBSCRT,U,8) ; exp MM/DD/YYYY HH:MM
"RTN","PSBVT",135,0)
 S PSBADST=$P(PSBSCRT,U,9)  ; admin times string in NNNN- format
"RTN","PSBVT",136,0)
 S PSBOSCHT=$P(PSBSCRT,U,10)  ; original schedule type
"RTN","PSBVT",137,0)
 S PSBFREQ=$P(PSBSCRT,U,11)  ; frequency
"RTN","PSBVT",138,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",5))
"RTN","PSBVT",139,0)
 S PSBVN=$P(PSBSCRT,U,1)  ; verify nurse IEN -> ^VA(200)
"RTN","PSBVT",140,0)
 S PSBVNX=$P(PSBSCRT,U,2)  ; nurse name
"RTN","PSBVT",141,0)
 S PSBVNI=$P(PSBSCRT,U,3) ; nurse initials
"RTN","PSBVT",142,0)
 S PSBVPH=$P(PSBSCRT,U,4)  ; verify pharm IEN -> ^VA(200)
"RTN","PSBVT",143,0)
 S PSBVPHX=$P(PSBSCRT,U,5)  ; pharm name
"RTN","PSBVT",144,0)
 S PSBVPHI=$P(PSBSCRT,U,6)  ; pharm initials
"RTN","PSBVT",145,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",6))
"RTN","PSBVT",146,0)
 S PSBRMRK=$G(PSBSCRT)
"RTN","PSBVT",147,0)
 ;If DayOFWeek set frequen to NULL
"RTN","PSBVT",148,0)
 I $$PSBDCHK1^PSBVT1(PSBSCH) S PSBFREQ=""
"RTN","PSBVT",149,0)
 ; get dispensed drug
"RTN","PSBVT",150,0)
 I $G(^TMP("PSB",$J,"PSBORDA",700,0)) F PSBX=1:1:^TMP("PSB",$J,"PSBORDA",700,0) M PSBDDA(PSBX)=^TMP("PSB",$J,"PSBORDA",700,PSBX,0) S PSBDDA(PSBX)="DD^"_PSBDDA(PSBX) ; # of DDrug
"RTN","PSBVT",151,0)
 ;     "DD"^dispensed drug IEN -> ^PSDRUG() DRUG^dispensed drug name^units per dose^inactive date
"RTN","PSBVT",152,0)
 ; build unique id list
"RTN","PSBVT",153,0)
 ; add addits
"RTN","PSBVT",154,0)
 I $D(^TMP("PSB",$J,"PSBORDA",800)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",800,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",155,0)
 .S PSBUIDA(PSBX2)="ID^"_PSBX2 F J=1:1:^TMP("PSB",$J,"PSBORDA",800,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"ADD;"_$P(^TMP("PSB",$J,"PSBORDA",800,PSBX2,J),U,1)
"RTN","PSBVT",156,0)
 ; add soluts
"RTN","PSBVT",157,0)
 I $D(^TMP("PSB",$J,"PSBORDA",900)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",900,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",158,0)
 .I '$D(PSBUIDA(PSBX2)) S PSBUIDA(PSBX2)="ID^"_PSBX2
"RTN","PSBVT",159,0)
 .F J=1:1:^TMP("PSB",$J,"PSBORDA",900,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"SOL;"_$P(^TMP("PSB",$J,"PSBORDA",900,PSBX2,J),U,1)
"RTN","PSBVT",160,0)
 ;     "ID"   ^   (piece 2,3),... = type;IEN of each add/sol for this ID ex. "SOL;4"
"RTN","PSBVT",161,0)
 ; get addits
"RTN","PSBVT",162,0)
 I $G(^TMP("PSB",$J,"PSBORDA",850,0)) F PSBX=1:1:^TMP("PSB",$J,"PSBORDA",850,0) D
"RTN","PSBVT",163,0)
 .M PSBADA(PSBX)=^TMP("PSB",$J,"PSBORDA",850,PSBX,0)  ; num of addits
"RTN","PSBVT",164,0)
 .S PSBADA(PSBX)="ADD^"_PSBADA(PSBX)
"RTN","PSBVT",165,0)
 .S PSBBAGS=$P(PSBADA(PSBX),U,5) I PSBBAGS'="" S PSBBAG=" IN BAG "_$P(PSBBAGS,",",1) D
"RTN","PSBVT",166,0)
 ..F I=2:1 S X=$P(PSBBAGS,",",I) Q:X=""  S PSBBAG=PSBBAG_" AND "_X
"RTN","PSBVT",167,0)
 .S:PSBBAGS'="" $P(PSBADA(PSBX),U,5)=PSBBAG
"RTN","PSBVT",168,0)
 ;     "ADD"^additive IEN -> ^PS(52.6) IV ADDITIVES^additive name^strength^bottle
"RTN","PSBVT",169,0)
 ; get soluts
"RTN","PSBVT",170,0)
 I $G(^TMP("PSB",$J,"PSBORDA",950,0)) F PSBX=1:1:^TMP("PSB",$J,"PSBORDA",950,0) M PSBSOLA(PSBX)=^TMP("PSB",$J,"PSBORDA",950,PSBX,0) S PSBSOLA(PSBX)="SOL^"_PSBSOLA(PSBX)  ; # of SOLs
"RTN","PSBVT",171,0)
 ;   "SOL"   ^   solution IEN -> ^PS(52.7) IV SOLUTIONS^solution name^volume
"RTN","PSBVT",172,0)
 ; get label
"RTN","PSBVT",173,0)
 I $D(^TMP("PSB",$J,"PSBORDA",1000)) M PSBLBLA=^TMP("PSB",$J,"PSBORDA",1000)
"RTN","PSBVT",174,0)
 K ^TMP("PSB",$J,"PSBORDA")
"RTN","PSBVT",175,0)
 Q
"RTN","PSBVT",176,0)
 ;
"RTN","PSBVT",177,0)
LACTION ; get last action info
"RTN","PSBVT",178,0)
 S (PSBLADT,PSBLAIEN,PSBLASTS)=""
"RTN","PSBVT",179,0)
 I '$D(^PSB(53.79,"AORDX",PSBDFN,PSBONX)) Q
"RTN","PSBVT",180,0)
 S PSBLADT=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,""),-1)
"RTN","PSBVT",181,0)
 S PSBLAIEN=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBLADT,""))
"RTN","PSBVT",182,0)
 S PSBLASTS=$P(^PSB(53.79,PSBLAIEN,0),U,9)
"RTN","PSBVT",183,0)
 Q
"RTN","PSBVT",184,0)
 ;
"RTN","PSBVT",185,0)
CLEAN ;
"RTN","PSBVT",186,0)
 K PSBONX,PSBPONX,PSBFON,PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMD,PSBMDX,PSBMR,PSBMRAB,PSBSM,PSBSMX,PSBHSM,PSBHSMX
"RTN","PSBVT",187,0)
 K PSBDFN,PSBNGF,PSBOSTS,PSBOSTSX,PSBOIT,PSBOITX,PSBDOSE,PSBIFR,PSBSCH,PSBDOSEF,PSBOTXT,PSBSCHT,PSBSCHTX
"RTN","PSBVT",188,0)
 K PSBLDT,PSBLDTX,PSBOST,PSBOSTX,PSBOSP,PSBOSPX,PSBADST,PSBOSCHT,PSBFREQ,PSBVN,PSBVNX,PSBVNI
"RTN","PSBVT",189,0)
 K PSBVPH,PSBVPHX,PSBVPHI,PSBDDA,PSBADA,PSBSOLA,PSBUIDA,PSBCPRS,PSBON,PSBRMRK,PSBNJECT,PSBIVPSH
"RTN","PSBVT",190,0)
 K PSBLADT,PSBLAIEN,PSBLASTS,PSBBAG,PSBBAGS,PSBLBLA,PSBFOR,PSBSCRT
"RTN","PSBVT",191,0)
 K PSBMRIEN   ;*68
"RTN","PSBVT",192,0)
 Q
"VER")
8.0^22.0
"^DD",53.69,53.69,3,0)
INCLUDE SPECIAL INSTRUCTIONS^S^0:No;1:Yes;^4;1^Q
"^DD",53.69,53.69,3,.1)
Include Special Instructions/Other Print Info
"^DD",53.69,53.69,3,3)
Should special instructions/other print info be included on the report?
"^DD",53.69,53.69,3,21,0)
^^2^2^3120123^
"^DD",53.69,53.69,3,21,1,0)
Special Instructions/Other Print Info can be included on the report by 
"^DD",53.69,53.69,3,21,2,0)
answering Yes.  Answer No, to exclude it from the report.
"^DD",53.69,53.69,3,"DT")
3120123
"^DD",53.79,53.79,.01,0)
PATIENT NAME^RP2'^DPT(^0;1^Q
"^DD",53.79,53.79,.01,1,0)
^.1^^-1
"^DD",53.79,53.79,.01,1,1,0)
53.79^B
"^DD",53.79,53.79,.01,1,1,1)
S ^PSB(53.79,"B",$E(X,1,30),DA)=""
"^DD",53.79,53.79,.01,1,1,2)
K ^PSB(53.79,"B",$E(X,1,30),DA)
"^DD",53.79,53.79,.01,3)

"^DD",53.79,53.79,.01,21,0)
^^2^2^2990731^^^
"^DD",53.79,53.79,.01,21,1,0)
This field contains a pointer to the PATIENT File (#2) and is the patient
"^DD",53.79,53.79,.01,21,2,0)
that received the medication.
"^DD",53.79,53.79,.01,"DT")
3110921
"^DD",53.79,53.79,.06,0)
ACTION DATE/TIME^RD^^0;6^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",53.79,53.79,.06,1,0)
^.1^^-1
"^DD",53.79,53.79,.06,1,1,0)
53.79^AADT^MUMPS
"^DD",53.79,53.79,.06,1,1,1)
S ^PSB(53.79,"AADT",$P(^PSB(53.79,DA,0),U),X,DA)=""
"^DD",53.79,53.79,.06,1,1,2)
Q
"^DD",53.79,53.79,.06,1,1,"%D",0)
^.101^3^3^3020517^^^^
"^DD",53.79,53.79,.06,1,1,"%D",1,0)
Creates a cross reference by patient for administration times
"^DD",53.79,53.79,.06,1,1,"%D",2,0)
 
"^DD",53.79,53.79,.06,1,1,"%D",3,0)
  ^PSB(53.79,"AADT",dfn,administration d/t,DA)=""
"^DD",53.79,53.79,.06,1,1,"DT")
3020429
"^DD",53.79,53.79,.06,1,2,0)
53.79^AOIP1^MUMPS^^^^^^G
"^DD",53.79,53.79,.06,1,2,1)
I $P(^PSB(53.79,DA,0),U,8) S ^PSB(53.79,"AOIP",$P(^PSB(53.79,DA,0),U),$P(^PSB(53.79,DA,0),U,8),X,DA)=""
"^DD",53.79,53.79,.06,1,2,2)
I $P(^PSB(53.79,DA,0),U,8) K ^PSB(53.79,"AOIP",$P(^PSB(53.79,DA,0),U),$P(^PSB(53.79,DA,0),U,8),X,DA)
"^DD",53.79,53.79,.06,1,2,"%D",0)
^.101^6^6^3020410^^
"^DD",53.79,53.79,.06,1,2,"%D",1,0)
Creates a cross reference by patient for orderable items and
"^DD",53.79,53.79,.06,1,2,"%D",2,0)
administration date/time
"^DD",53.79,53.79,.06,1,2,"%D",3,0)
 
"^DD",53.79,53.79,.06,1,2,"%D",4,0)
  ^PSB(53.79,"AOIP",dfn,orderable item,administration d/t,DA)=""
"^DD",53.79,53.79,.06,1,2,"%D",5,0)
 
"^DD",53.79,53.79,.06,1,2,"%D",6,0)
Same as field ADMINISTRATION MEDICATION (#.08)
"^DD",53.79,53.79,.06,1,2,"DT")
2990427
"^DD",53.79,53.79,.06,1,4,0)
53.79^AU06^MUMPS
"^DD",53.79,53.79,.06,1,4,1)
D AUDIT^PSBUTL(DA,53.79,.06,X,"S")
"^DD",53.79,53.79,.06,1,4,2)
D AUDIT^PSBUTL(DA,53.79,.06,X,"K")
"^DD",53.79,53.79,.06,1,4,"%D",0)
^.101^1^1^3020412^^^^
"^DD",53.79,53.79,.06,1,4,"%D",1,0)
Creates an entry in this items audit log whenever changed or deleted.
"^DD",53.79,53.79,.06,1,4,"DT")
2990409
"^DD",53.79,53.79,.06,1,8,0)
^^TRIGGER^53.79^.14
"^DD",53.79,53.79,.06,1,8,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X I $P($G(^PSB(53.79,DA,.1)),U,2)="C"&($P($G(^(.1)),U,3)]"") I X S X=DIV S Y(1)=$S($D(^PSB(53.79,D0,.1)):^(.1),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y X ^DD(53.79,.06,1,8,1.1) X ^DD(53.79,.06,1,8,1.4)
"^DD",53.79,53.79,.06,1,8,1.1)
S X=DIV X ^DD(53.79,.06,1,8,49.2) S X1=Y(1) S Y=$E(X1_"000",9,10)-$E(X_"000",9,10)*60+$E(X1_"00000",11,12)-$E(X_"00000",11,12),X2=X,X=$P(X,".",1)'=$P(X1,".",1) D ^%DTC:X S X=X*1440+Y
"^DD",53.79,53.79,.06,1,8,1.4)
S DIH=$S($D(^PSB(53.79,DIV(0),.1)):^(.1),1:""),DIV=X S $P(^(.1),U,4)=DIV,DIH=53.79,DIG=.14 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",53.79,53.79,.06,1,8,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X I $P($G(^PSB(53.79,DA,.1)),U,2)="C"&($P($G(^(.1)),U,3)]"") I X S X=DIV S Y(1)=$S($D(^PSB(53.79,D0,.1)):^(.1),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X="" X ^DD(53.79,.06,1,8,2.4)
"^DD",53.79,53.79,.06,1,8,2.4)
S DIH=$S($D(^PSB(53.79,DIV(0),.1)):^(.1),1:""),DIV=X S $P(^(.1),U,4)=DIV,DIH=53.79,DIG=.14 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",53.79,53.79,.06,1,8,49.2)
S Y(2)=$S($D(^PSB(53.79,D0,.1)):^(.1),1:"") S X=DIV,Y(1)=X S X=$P(Y(2),U,3)
"^DD",53.79,53.79,.06,1,8,"CREATE CONDITION")
I $P($G(^PSB(53.79,DA,.1)),U,2)="C"&($P($G(^(.1)),U,3)]"")
"^DD",53.79,53.79,.06,1,8,"CREATE VALUE")
MINUTES(#.06,#.13)
"^DD",53.79,53.79,.06,1,8,"DELETE CONDITION")
I $P($G(^PSB(53.79,DA,.1)),U,2)="C"&($P($G(^(.1)),U,3)]"")
"^DD",53.79,53.79,.06,1,8,"DELETE VALUE")
@
"^DD",53.79,53.79,.06,1,8,"DT")
2990314
"^DD",53.79,53.79,.06,1,8,"FIELD")
#.14
"^DD",53.79,53.79,.06,21,0)
^.001^1^1^3020711^^^^
"^DD",53.79,53.79,.06,21,1,0)
Fileman Date/Time containing the actual time the med was administered.
"^DD",53.79,53.79,.06,"DT")
3110921
"^DD",53.79,53.79,.08,0)
ADMINISTRATION MEDICATION^RP50.7'^PS(50.7,^0;8^Q
"^DD",53.79,53.79,.08,1,0)
^.1
"^DD",53.79,53.79,.08,1,1,0)
53.79^AOIP^MUMPS
"^DD",53.79,53.79,.08,1,1,1)
I $P(^PSB(53.79,DA,0),U,6) S ^PSB(53.79,"AOIP",$P(^PSB(53.79,DA,0),U),X,+$P(^PSB(53.79,DA,0),U,6),DA)=""
"^DD",53.79,53.79,.08,1,1,2)
I $P(^PSB(53.79,DA,0),U,6) K ^PSB(53.79,"AOIP",$P(^PSB(53.79,DA,0),U),X,+$P(^PSB(53.79,DA,0),U,6),DA)
"^DD",53.79,53.79,.08,1,1,"%D",0)
^.101^6^6^3020430^^
"^DD",53.79,53.79,.08,1,1,"%D",1,0)
Creates a cross reference by patient for orderable items and
"^DD",53.79,53.79,.08,1,1,"%D",2,0)
administration date/time
"^DD",53.79,53.79,.08,1,1,"%D",3,0)
 
"^DD",53.79,53.79,.08,1,1,"%D",4,0)
  ^PSB(53.79,"AOIP",dfn,orderable item,administration d/t,DA)=""
"^DD",53.79,53.79,.08,1,1,"%D",5,0)
 
"^DD",53.79,53.79,.08,1,1,"%D",6,0)
Same as Field ADMINISTRATION DATE/TIME (#.06)
"^DD",53.79,53.79,.08,1,1,"DT")
2990427
"^DD",53.79,53.79,.08,21,0)
^^2^2^2990805^
"^DD",53.79,53.79,.08,21,1,0)
Pointer to ORDERABLE ITEM (#50.7) containing the medication entered for
"^DD",53.79,53.79,.08,21,2,0)
the order.
"^DD",53.79,53.79,.08,"DT")
3110921
"^DD",53.79,53.79,.16,0)
INJECTION SITE^F^^.1;6^K:$L(X)>30!($L(X)<1) X
"^DD",53.79,53.79,.16,1,0)
^.1^^-1
"^DD",53.79,53.79,.16,1,1,0)
53.79^AU16^MUMPS
"^DD",53.79,53.79,.16,1,1,1)
D AUDIT^PSBUTL(DA,53.79,.16,X,"S")
"^DD",53.79,53.79,.16,1,1,2)
D AUDIT^PSBUTL(DA,53.79,.16,X,"K")
"^DD",53.79,53.79,.16,1,1,"%D",0)
^.101^1^1^3010504^^
"^DD",53.79,53.79,.16,1,1,"%D",1,0)
Creates an entry in this items audit log whenever changed or deleted.
"^DD",53.79,53.79,.16,1,1,"DT")
2990409
"^DD",53.79,53.79,.16,3)
Answer must be 1-30 characters in length.
"^DD",53.79,53.79,.16,21,0)
^^2^2^2990805^
"^DD",53.79,53.79,.16,21,1,0)
Free text field containing the injection site of medication that are
"^DD",53.79,53.79,.16,21,2,0)
injected.
"^DD",53.79,53.79,.16,"DT")
3110921
"BLD",8247,6)
^55
**END**
**END**
