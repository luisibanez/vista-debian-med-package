EMERGENCY Released PSB*3*74 SEQ #59
Extracted from mail message
**KIDS**:PSB*3.0*74^

**INSTALL NAME**
PSB*3.0*74
"BLD",9174,0)
PSB*3.0*74^BAR CODE MED ADMIN^0^3121025^y
"BLD",9174,1,0)
^^9^9^3121025^
"BLD",9174,1,1,0)
This Patch Addresses 3 issues:
"BLD",9174,1,2,0)
 
"BLD",9174,1,3,0)
1.  A broker error occurs when attempting to open BCMA (Bar Code
"BLD",9174,1,4,0)
    Medication Administration) for a patient who has and Intravenous
"BLD",9174,1,5,0)
    Piggyback (IVPB) medication with an unknown Action Status. 
"BLD",9174,1,6,0)
2.  The header on several reports do not delineate a patient's room
"BLD",9174,1,7,0)
    number with a colon.
"BLD",9174,1,8,0)
3.  The BCMA Missed Medications Report does not contain meds that
"BLD",9174,1,9,0)
    are held or refused when run in VistA.
"BLD",9174,4,0)
^9.64PA^^
"BLD",9174,6.3)
5
"BLD",9174,"KRN",0)
^9.67PA^779.2^20
"BLD",9174,"KRN",.4,0)
.4
"BLD",9174,"KRN",.401,0)
.401
"BLD",9174,"KRN",.402,0)
.402
"BLD",9174,"KRN",.403,0)
.403
"BLD",9174,"KRN",.5,0)
.5
"BLD",9174,"KRN",.84,0)
.84
"BLD",9174,"KRN",3.6,0)
3.6
"BLD",9174,"KRN",3.8,0)
3.8
"BLD",9174,"KRN",9.2,0)
9.2
"BLD",9174,"KRN",9.8,0)
9.8
"BLD",9174,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",9174,"KRN",9.8,"NM",1,0)
PSBVT^^0^B80815673
"BLD",9174,"KRN",9.8,"NM",2,0)
PSBOMM2^^0^B40365491
"BLD",9174,"KRN",9.8,"NM",3,0)
PSBOHDR^^0^B25654134
"BLD",9174,"KRN",9.8,"NM","B","PSBOHDR",3)

"BLD",9174,"KRN",9.8,"NM","B","PSBOMM2",2)

"BLD",9174,"KRN",9.8,"NM","B","PSBVT",1)

"BLD",9174,"KRN",19,0)
19
"BLD",9174,"KRN",19.1,0)
19.1
"BLD",9174,"KRN",101,0)
101
"BLD",9174,"KRN",409.61,0)
409.61
"BLD",9174,"KRN",771,0)
771
"BLD",9174,"KRN",779.2,0)
779.2
"BLD",9174,"KRN",870,0)
870
"BLD",9174,"KRN",8989.51,0)
8989.51
"BLD",9174,"KRN",8989.52,0)
8989.52
"BLD",9174,"KRN",8994,0)
8994
"BLD",9174,"KRN","B",.4,.4)

"BLD",9174,"KRN","B",.401,.401)

"BLD",9174,"KRN","B",.402,.402)

"BLD",9174,"KRN","B",.403,.403)

"BLD",9174,"KRN","B",.5,.5)

"BLD",9174,"KRN","B",.84,.84)

"BLD",9174,"KRN","B",3.6,3.6)

"BLD",9174,"KRN","B",3.8,3.8)

"BLD",9174,"KRN","B",9.2,9.2)

"BLD",9174,"KRN","B",9.8,9.8)

"BLD",9174,"KRN","B",19,19)

"BLD",9174,"KRN","B",19.1,19.1)

"BLD",9174,"KRN","B",101,101)

"BLD",9174,"KRN","B",409.61,409.61)

"BLD",9174,"KRN","B",771,771)

"BLD",9174,"KRN","B",779.2,779.2)

"BLD",9174,"KRN","B",870,870)

"BLD",9174,"KRN","B",8989.51,8989.51)

"BLD",9174,"KRN","B",8989.52,8989.52)

"BLD",9174,"KRN","B",8994,8994)

"BLD",9174,"QDEF")
^^^^^^^^^^YES
"BLD",9174,"QUES",0)
^9.62^^
"BLD",9174,"REQB",0)
^9.611^3^3
"BLD",9174,"REQB",1,0)
PSB*3.0*68^2
"BLD",9174,"REQB",2,0)
PSB*3.0*42^2
"BLD",9174,"REQB",3,0)
PSB*3.0*62^2
"BLD",9174,"REQB","B","PSB*3.0*42",2)

"BLD",9174,"REQB","B","PSB*3.0*62",3)

"BLD",9174,"REQB","B","PSB*3.0*68",1)

"MBREQ")
0
"PKG",550,-1)
1^1
"PKG",550,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",550,20,0)
^9.402P^^
"PKG",550,22,0)
^9.49I^1^1
"PKG",550,22,1,0)
3.0^3040224^3040311^66481
"PKG",550,22,1,"PAH",1,0)
74^3121025
"PKG",550,22,1,"PAH",1,1,0)
^^9^9^3121025
"PKG",550,22,1,"PAH",1,1,1,0)
This Patch Addresses 3 issues:
"PKG",550,22,1,"PAH",1,1,2,0)
 
"PKG",550,22,1,"PAH",1,1,3,0)
1.  A broker error occurs when attempting to open BCMA (Bar Code
"PKG",550,22,1,"PAH",1,1,4,0)
    Medication Administration) for a patient who has and Intravenous
"PKG",550,22,1,"PAH",1,1,5,0)
    Piggyback (IVPB) medication with an unknown Action Status. 
"PKG",550,22,1,"PAH",1,1,6,0)
2.  The header on several reports do not delineate a patient's room
"PKG",550,22,1,"PAH",1,1,7,0)
    number with a colon.
"PKG",550,22,1,"PAH",1,1,8,0)
3.  The BCMA Missed Medications Report does not contain meds that
"PKG",550,22,1,"PAH",1,1,9,0)
    are held or refused when run in VistA.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSBOHDR")
0^3^B25654134^B25151951
"RTN","PSBOHDR",1,0)
PSBOHDR ;BIRMINGHAM/EFC - REPORT HEADERS ;5/28/10 2:51pm
"RTN","PSBOHDR",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,13,42,74**;Mar 2004;Build 5
"RTN","PSBOHDR",3,0)
 ;
"RTN","PSBOHDR",4,0)
 ; Reference/IA
"RTN","PSBOHDR",5,0)
 ; EN6^GMRVUTL/1120
"RTN","PSBOHDR",6,0)
 ; WARD^NURSUT5/3052
"RTN","PSBOHDR",7,0)
 ; IN5^VADPT/10061
"RTN","PSBOHDR",8,0)
 ; DEM^VADPT/10061
"RTN","PSBOHDR",9,0)
 ;
"RTN","PSBOHDR",10,0)
PT(DFN,PSBHDR,PSBCONT,PSBDT) ;
"RTN","PSBOHDR",11,0)
 ; DFN:     Patient File IEN
"RTN","PSBOHDR",12,0)
 ; PSBCONT: True if this is a continuation page
"RTN","PSBOHDR",13,0)
 ; PSBDT:   Date of Pt Information (Default to DT)
"RTN","PSBOHDR",14,0)
 W:$Y>1 @IOF
"RTN","PSBOHDR",15,0)
 W:$X>1 !
"RTN","PSBOHDR",16,0)
 S:'$G(PSBDT) PSBDT=DT
"RTN","PSBOHDR",17,0)
 ; BUILD PSBHDR WITH ALL HEADER STUFF
"RTN","PSBOHDR",18,0)
 D:'$D(PSBHDR("NAME"))
"RTN","PSBOHDR",19,0)
 .S VAIP("D")="LAST"
"RTN","PSBOHDR",20,0)
 .D DEM^VADPT,IN5^VADPT
"RTN","PSBOHDR",21,0)
 .S PSBHDR("NAME")=VADM(1)
"RTN","PSBOHDR",22,0)
 .S PSBHDR("SSN")=VA("PID")
"RTN","PSBOHDR",23,0)
 .S PSBHDR("DOB")=$P(VADM(3),U,2)
"RTN","PSBOHDR",24,0)
 .S PSBHDR("AGE")=VADM(4)
"RTN","PSBOHDR",25,0)
 .S PSBHDR("SEX")=$P(VADM(5),U,2)
"RTN","PSBOHDR",26,0)
 .S PSBHDR("MVMTTYPE")=$P(VAIP(2),U,2)
"RTN","PSBOHDR",27,0)
 .S PSBHDR("MVMTLAST")=$P(VAIP(3),U,2)
"RTN","PSBOHDR",28,0)
 .S PSBHDR("WARD")=$P(VAIP(5),U,2)
"RTN","PSBOHDR",29,0)
 .S PSBHDR("ROOM")=$P(VAIP(6),U,2)
"RTN","PSBOHDR",30,0)
 .S PSBHDR("DX")=VAIP(9)
"RTN","PSBOHDR",31,0)
 .K VAIP,VADM,VA
"RTN","PSBOHDR",32,0)
 .;
"RTN","PSBOHDR",33,0)
 .;IHS/MSC/PLS - Call Vitals lookup based on agency code
"RTN","PSBOHDR",34,0)
 .;  and PCC Vitals package usage flag "BEHOVM USE VMSR"=1
"RTN","PSBOHDR",35,0)
 .I $G(DUZ("AG"))="I",$$GET^XPAR("ALL","BEHOVM USE VMSR") D
"RTN","PSBOHDR",36,0)
 ..S X=+$P($$VITAL^APSPFUNC(DFN,"HT"),U,2)
"RTN","PSBOHDR",37,0)
 ..S X=$$VITCHT^APSPFUNC(X)\1,PSBHDR("HEIGHT")=$S(X:X_"cm",1:"*")
"RTN","PSBOHDR",38,0)
 ..S X=+$P($$VITAL^APSPFUNC(DFN,"WT"),U,2)
"RTN","PSBOHDR",39,0)
 ..S X=$$VITCWT^APSPFUNC(X)\1,PSBHDR("WEIGHT")=$S(X:X_"kg",1:"*")
"RTN","PSBOHDR",40,0)
 .E  D
"RTN","PSBOHDR",41,0)
 ..S GMRVSTR="HT" D EN6^GMRVUTL
"RTN","PSBOHDR",42,0)
 ..S X=+$P(X,U,8) S:X X=X*2.54\1 S PSBHDR("HEIGHT")=$S(X:X_"cm",1:"*")
"RTN","PSBOHDR",43,0)
 ..S GMRVSTR="WT" D EN6^GMRVUTL
"RTN","PSBOHDR",44,0)
 ..S X=+$P(X,U,8) S:X X=X*.45\1 S PSBHDR("WEIGHT")=$S(X:X_"kg",1:"*")
"RTN","PSBOHDR",45,0)
 .;
"RTN","PSBOHDR",46,0)
 .N PSBADRX D ALLR^PSBALL(.PSBADRX,DFN) S X=0,Y=""
"RTN","PSBOHDR",47,0)
 .F  S X=$O(PSBADRX(X)) Q:'X  D
"RTN","PSBOHDR",48,0)
 ..Q:$P(PSBADRX(X),U,1)'="ADR"  S Z=$P(PSBADRX(X),U,2) Q:Z=""
"RTN","PSBOHDR",49,0)
 ..I $L(Y_Z)>(IOM-22) S PSBHDR("REAC",$O(PSBHDR("REAC",""),-1)+1)=Y,Y=""
"RTN","PSBOHDR",50,0)
 ..S Y=Y_$S(Y]"":", ",1:"")_$P(PSBADRX(X),U,2)
"RTN","PSBOHDR",51,0)
 .S:Y]"" PSBHDR("REAC",$O(PSBHDR("REAC",""),-1)+1)=Y
"RTN","PSBOHDR",52,0)
 .I '$D(PSBHDR("REAC")) S PSBHDR("REAC",1)="No ADRs on file."
"RTN","PSBOHDR",53,0)
 .D PSBALG
"RTN","PSBOHDR",54,0)
 .K GMRAL,GMRVSTR,GMRA,PSBARX
"RTN","PSBOHDR",55,0)
 .D NOW^%DTC S Y=+$E(%,1,12) D D^DIQ S PSBHDR("DATE")="Run Date: "_Y
"RTN","PSBOHDR",56,0)
 .S PSBHDR("PAGE")=0
"RTN","PSBOHDR",57,0)
 W $C(13),$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",58,0)
 W !,$G(PSBHDR(0))
"RTN","PSBOHDR",59,0)
 W !,$G(PSBHDR(1)),?(IOM-$L(PSBHDR("DATE"))),PSBHDR("DATE")
"RTN","PSBOHDR",60,0)
 S PSBHDR("PAGE")=PSBHDR("PAGE")+1
"RTN","PSBOHDR",61,0)
 W !,$G(PSBHDR(2)),?(IOM-10),$J("Page: "_PSBHDR("PAGE"),10)
"RTN","PSBOHDR",62,0)
 F X=3:1 Q:'$D(PSBHDR(X))  W !,PSBHDR(X)  ; More Lines If Needed
"RTN","PSBOHDR",63,0)
 I $G(PSBCONT) W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOHDR",64,0)
 W !!,"Patient:",?10,PSBHDR("NAME")
"RTN","PSBOHDR",65,0)
 W ?40,$$GET^XPAR("ALL","PSB PATIENT ID LABEL")_":",?51,PSBHDR("SSN")
"RTN","PSBOHDR",66,0)
 W ?75,"DOB:",?82,PSBHDR("DOB")," (",PSBHDR("AGE"),")"
"RTN","PSBOHDR",67,0)
 D:'$G(PSBCONT)
"RTN","PSBOHDR",68,0)
 .W !,"Sex: ",?10,PSBHDR("SEX"),?40,"Ht/Wt:     ",PSBHDR("HEIGHT"),"/",PSBHDR("WEIGHT"),?75,"Ward: ",?82,PSBHDR("WARD")," Rm: ",PSBHDR("ROOM") ;added colon to Rm, PSB*3*74
"RTN","PSBOHDR",69,0)
 .W !,"Dx:",?10,PSBHDR("DX"),?40,"Last Mvmt: ",PSBHDR("MVMTLAST"),?75,"Type:  ",PSBHDR("MVMTTYPE")
"RTN","PSBOHDR",70,0)
 .; Reactions/Allergies
"RTN","PSBOHDR",71,0)
 .W !!,"ADRs:"
"RTN","PSBOHDR",72,0)
 .F X=0:0 S X=$O(PSBHDR("REAC",X)) Q:'X  W:$X>12 ! W ?12,PSBHDR("REAC",X)
"RTN","PSBOHDR",73,0)
 .W !!,"Allergies:"
"RTN","PSBOHDR",74,0)
 .F X=0:0 S X=$O(PSBHDR("ALERGY",X)) Q:'X  W:$X>12 ! W ?12,PSBHDR("ALERGY",X)
"RTN","PSBOHDR",75,0)
 .; Local Mods Allowed Here and showup only on First Page
"RTN","PSBOHDR",76,0)
 .; Immunizations
"RTN","PSBOHDR",77,0)
 .;D SHOT80^ASFSHOTF
"RTN","PSBOHDR",78,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",79,0)
 Q
"RTN","PSBOHDR",80,0)
 ;
"RTN","PSBOHDR",81,0)
WARD(PSBWP,PSBHDR,PSBCONT,PSBDT) ; 
"RTN","PSBOHDR",82,0)
 ; WARD:    Nurse Location File IEN
"RTN","PSBOHDR",83,0)
 ; PSBCONT: True if this is a continuation page
"RTN","PSBOHDR",84,0)
 ; PSBDT:   Date of Pt Information (Default to DT)
"RTN","PSBOHDR",85,0)
 N PSBWRDA
"RTN","PSBOHDR",86,0)
 S:'$G(PSBDT) PSBDT=DT
"RTN","PSBOHDR",87,0)
 I '$D(PSBHDR("DATE")) D NOW^%DTC S Y=+$E(%,1,12) D D^DIQ S PSBHDR("DATE")="Run Date: "_Y
"RTN","PSBOHDR",88,0)
 S:'$D(PSBHDR("PAGE")) PSBHDR("PAGE")=0
"RTN","PSBOHDR",89,0)
 W:$Y>1 @IOF
"RTN","PSBOHDR",90,0)
 W:$X>0 !
"RTN","PSBOHDR",91,0)
 W $TR($J("",IOM)," ","="),!,$G(PSBHDR(0)),!,$G(PSBHDR(1)),?(IOM-$L(PSBHDR("DATE"))),PSBHDR("DATE")
"RTN","PSBOHDR",92,0)
 S PSBHDR("PAGE")=PSBHDR("PAGE")+1
"RTN","PSBOHDR",93,0)
 W !,$G(PSBHDR(2)),?(IOM-10),$J("Page: "_PSBHDR("PAGE"),10)
"RTN","PSBOHDR",94,0)
 F X=3:1 Q:'$D(PSBHDR(X))  W !,PSBHDR(X)  ; More Lines If Needed
"RTN","PSBOHDR",95,0)
 I $G(PSBCONT) W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOHDR",96,0)
 D WARD^NURSUT5("L^"_PSBWP,.PSBWRDA)
"RTN","PSBOHDR",97,0)
 W !!,"Ward Location: "_$P(PSBWRDA(PSBWP,.01),U,2)
"RTN","PSBOHDR",98,0)
 S X="Division: "_$P(PSBWRDA(PSBWP,.02),U,2)
"RTN","PSBOHDR",99,0)
 W ?(IOM-$L(X)),X,!,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",100,0)
 Q
"RTN","PSBOHDR",101,0)
 ;
"RTN","PSBOHDR",102,0)
PSBALG ;
"RTN","PSBOHDR",103,0)
 S YA=""
"RTN","PSBOHDR",104,0)
 K PSBAL,GMRALA
"RTN","PSBOHDR",105,0)
 S PSBLIST=""
"RTN","PSBOHDR",106,0)
 D ALLR^PSBALL(.GMRALA,DFN)
"RTN","PSBOHDR",107,0)
 S X="" F  S X=$O(GMRALA(X)) Q:X=""  D
"RTN","PSBOHDR",108,0)
 .I $P(GMRALA(X),U,1)["ALL" D
"RTN","PSBOHDR",109,0)
 ..S PSBAL($P(GMRALA(X),U,2))=""
"RTN","PSBOHDR",110,0)
 S XAB="" F  S XAB=$O(PSBAL(XAB)) Q:XAB=""  D
"RTN","PSBOHDR",111,0)
 .S Z=XAB
"RTN","PSBOHDR",112,0)
 .I $L(YA_Z)>(IOM-22) S PSBHDR("ALERGY",$O(PSBHDR("ALERGY",""),-1)+1)=YA,YA=""
"RTN","PSBOHDR",113,0)
 .S YA=YA_$S(YA]"":", ",1:"")_XAB
"RTN","PSBOHDR",114,0)
 S:YA]"" PSBHDR("ALERGY",$O(PSBHDR("ALERGY",""),-1)+1)=YA
"RTN","PSBOHDR",115,0)
 I '$D(PSBHDR("ALERGY")) S PSBHDR("ALERGY",1)="No Allergies on file."
"RTN","PSBOHDR",116,0)
 Q
"RTN","PSBOHDR",117,0)
 ;
"RTN","PSBOHDR",118,0)
PTFTR() ; [Extrinsic] Patient Page footer
"RTN","PSBOHDR",119,0)
 ;
"RTN","PSBOHDR",120,0)
 I (IOSL<100) F  Q:$Y>(IOSL-6)  W !
"RTN","PSBOHDR",121,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOHDR",122,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBOHDR",123,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBOHDR",124,0)
 I $G(PSBUNK) S X="Note:  ??  Indicates an administration with an *UNKNOWN* Action Status" W !!,X
"RTN","PSBOHDR",125,0)
 Q ""
"RTN","PSBOHDR",126,0)
 ;
"RTN","PSBOMM2")
0^2^B40365491^B40308817
"RTN","PSBOMM2",1,0)
PSBOMM2 ;BIRMINGHAM/EFC-MISSED MEDS ;Mar 2004
"RTN","PSBOMM2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**26,32,51,62,74**;Mar 2004;Build 5
"RTN","PSBOMM2",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOMM2",4,0)
 ;
"RTN","PSBOMM2",5,0)
MISSED(PSBADMN,PSBEDIT,PSBXDT) ;
"RTN","PSBOMM2",6,0)
 N PSBMISD,PSBAUDT,PSBSTRT2
"RTN","PSBOMM2",7,0)
 S PSBSTRT2=(PSBXDT\1) F  D  Q:PSBODD  S PSBSTRT2=$$FMADD^XLFDT(PSBSTRT2,1) Q:PSBSTRT2>PSBSTOP
"RTN","PSBOMM2",8,0)
 .F Y=1:1:$L(PSBADMN,"-") S PSBDT=+("."_$P(PSBADMN,"-",Y))+(PSBSTRT2) D
"RTN","PSBOMM2",9,0)
 ..S PSBMISD=$$CHECK(PSBDT)
"RTN","PSBOMM2",10,0)
 ..;Check Audited Admin Times for Missed Med
"RTN","PSBOMM2",11,0)
 ..I PSBMISD F I=1:1:$P(PSBOACTL(0),U,4) I $P($G(PSBOACTL(I,1)),U,3)["ADMIN TIMES" D  Q:'PSBMISD
"RTN","PSBOMM2",12,0)
 ...Q:$P(PSBOACTL(I,1),U)<PSBSTRT2
"RTN","PSBOMM2",13,0)
 ...Q:$P(PSBOACTL(I,1),U)>((PSBSTOP\1)+.2400)  ;Check Audits for the entire day - PSB*3*62
"RTN","PSBOMM2",14,0)
 ...Q:$P(PSBOACTL(I,1),U)<PSBDT
"RTN","PSBOMM2",15,0)
 ...S PSBAUDT=+("."_$P(PSBOACTL(I,2),"-",Y))+(PSBSTRT2\1)
"RTN","PSBOMM2",16,0)
 ...S PSBMISD=$$CHECK(PSBAUDT),PSBEDIT=1
"RTN","PSBOMM2",17,0)
 ..I PSBMISD D
"RTN","PSBOMM2",18,0)
 ...Q:'$$OKAY^PSBVDLU1(PSBOST,PSBSTRT2,PSBSCH,PSBONX,$P(^TMP("PSJ",$J,PSBX,3),U,2),PSBFREQ,PSBOSTS)
"RTN","PSBOMM2",19,0)
 ...S:'$D(^TMP("PSB",$J,DFN,PSBDT,"* "_PSBOITX,PSBONX)) ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)=""
"RTN","PSBOMM2",20,0)
 ...D UDCONT
"RTN","PSBOMM2",21,0)
 Q
"RTN","PSBOMM2",22,0)
CHECK(PSBDT) ;
"RTN","PSBOMM2",23,0)
 I PSBDT<PSBOST Q 0 ; Order Start Date
"RTN","PSBOMM2",24,0)
 I PSBDT'<PSBOSP Q 0 ; Order Stop Date
"RTN","PSBOMM2",25,0)
 I PSBDT<PSBSTRT Q 0 ; Report Window
"RTN","PSBOMM2",26,0)
 I PSBDT>PSBSTOP Q 0 ; Report Window
"RTN","PSBOMM2",27,0)
 I $D(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT)) D  Q:PSBSTUS'="N" $G(PART,0)
"RTN","PSBOMM2",28,0)
 .K PART S PSBIX=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT,"")),PSBSTUS=$P(^PSB(53.79,PSBIX,0),U,9)
"RTN","PSBOMM2",29,0)
 .I PSBOCRIT[PSBOSTS D:(PSBACRIT[PSBSTUS)  Q
"RTN","PSBOMM2",30,0)
 ..I (PSBSTUS="G")&$D(^PSB(53.79,PSBIX,.5)) D
"RTN","PSBOMM2",31,0)
 ...S X=0 F  S X=$O(^PSB(53.79,PSBIX,.5,X)) Q:+X=0  D
"RTN","PSBOMM2",32,0)
 ....I $P(^PSB(53.79,PSBIX,.5,X,0),U,2)>$P(^PSB(53.79,PSBIX,.5,X,0),U,3) D  S PSBOITX=$E(PSBOITX,3,999)
"RTN","PSBOMM2",33,0)
 .....S PSBOITX="* "_PSBOITX S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X")="Units Ordered: "_$P(^PSB(53.79,PSBIX,.5,X,0),U,2)_"   Units Given: "_$P(^PSB(53.79,PSBIX,.5,X,0),U,3)_"    Admin. Status: * Partial (Given)"
"RTN","PSBOMM2",34,0)
 .....S PART=1
"RTN","PSBOMM2",35,0)
 .....D:PSBINCC GCMNTS(PSBIX)
"RTN","PSBOMM2",36,0)
 ..I PSBSTUS'="G"  I PSBACRIT[PSBSTUS S PART=1 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X")="Admin. Status: ("_$S(PSBSTUS="":" *UNKNOWN* ",PSBSTUS="M":"Missing Dose",PSBSTUS="H":"Held",PSBSTUS="R":"Refused")_")" D:PSBINCC GCMNTS(PSBIX)
"RTN","PSBOMM2",37,0)
 Q 1
"RTN","PSBOMM2",38,0)
UDCONT ;
"RTN","PSBOMM2",39,0)
 S PSBFLAG=0,J=1
"RTN","PSBOMM2",40,0)
 K ^TMP("PSB1",$J)
"RTN","PSBOMM2",41,0)
 F I=1:1:$P(PSBOACTL(0),U,4) D
"RTN","PSBOMM2",42,0)
 . I $P($G(PSBOACTL(I,1)),U,4)["ON HOLD"!($P($G(PSBOACTL(I,1)),U,4)="HOLD") S ^TMP("PSB1",$J,DFN,J)="HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12)
"RTN","PSBOMM2",43,0)
 . I $P($G(PSBOACTL(I,1)),U,4)["TAKEN OFF HOLD"!($P($G(PSBOACTL(I,1)),U,4)["UNHOLD") S $P(^TMP("PSB1",$J,DFN,J),U,3)="OFF HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12),J=J+1
"RTN","PSBOMM2",44,0)
 D:$D(^TMP("PSB1",$J,DFN))&($P(PSBOACTL(0),U,4)'=1)
"RTN","PSBOMM2",45,0)
 .S J=0 F  S J=$O(^TMP("PSB1",$J,DFN,J)) Q:'J  Q:PSBFLAG  D
"RTN","PSBOMM2",46,0)
 ..S PSBHDDT=$P(^TMP("PSB1",$J,DFN,J),U,2)
"RTN","PSBOMM2",47,0)
 ..S PSBHDST=$P(^TMP("PSB1",$J,DFN,J),U)
"RTN","PSBOMM2",48,0)
 ..S PSBOFDT=$P(^TMP("PSB1",$J,DFN,J),U,4)
"RTN","PSBOMM2",49,0)
 ..S PSBOFST=$P(^TMP("PSB1",$J,DFN,J),U,3)
"RTN","PSBOMM2",50,0)
 ..I PSBDT>PSBHDDT,PSBHDST="HOLD",PSBOFST'="" I PSBDT<PSBOFDT,PSBOFST="OFF HOLD" S PSBFLAG=2,PSBUNHD=PSBOFDT
"RTN","PSBOMM2",51,0)
 ..I PSBDT>PSBHDDT,PSBHDST="HOLD",PSBOFST="" S PSBFLAG=1
"RTN","PSBOMM2",52,0)
 K PSBCNT,TMP("PSB1",$J)
"RTN","PSBOMM2",53,0)
 S PSBOITX2=PSBOITX
"RTN","PSBOMM2",54,0)
 I $D(^TMP("PSB",$J,DFN,PSBDT,"* "_PSBOITX,PSBONX)) S PSBOITX="* "_PSBOITX
"RTN","PSBOMM2",55,0)
 I PSBFLAG=1 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$DTFMT(PSBHDDT)
"RTN","PSBOMM2",56,0)
 I PSBFLAG=2 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$DTFMT(PSBHDDT)_"  "_"(Off Hold) "_$$DTFMT(PSBUNHD)
"RTN","PSBOMM2",57,0)
 S PSBOITX=PSBOITX2
"RTN","PSBOMM2",58,0)
 Q
"RTN","PSBOMM2",59,0)
 ;
"RTN","PSBOMM2",60,0)
UDONE ;
"RTN","PSBOMM2",61,0)
 S PSBFLAG=0,J=1
"RTN","PSBOMM2",62,0)
 F I=1:1:$P(PSBOACTL(0),U,4) D
"RTN","PSBOMM2",63,0)
 .I $P($G(PSBOACTL(I,1)),U,4)["ON HOLD"!($P($G(PSBOACTL(I,1)),U,4)="HOLD") S ^TMP("PSB1",$J,DFN,J)="HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12)
"RTN","PSBOMM2",64,0)
 .I $P($G(PSBOACTL(I,1)),U,4)["TAKEN OFF HOLD"!($P($G(PSBOACTL(I,1)),U,4)["UNHOLD") S $P(^TMP("PSB1",$J,DFN,J),U,3)="OFF HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12),J=J+1
"RTN","PSBOMM2",65,0)
 D:$D(^TMP("PSB1",$J,DFN))&($P(PSBOACTL(0),U,4)'=1)
"RTN","PSBOMM2",66,0)
 .S J="" F  S J=$O(^TMP("PSB1",$J,DFN,J)) Q:'J  Q:PSBFLAG  D
"RTN","PSBOMM2",67,0)
 ..S PSBHDDT=$P(^TMP("PSB1",$J,DFN,J),U,2)
"RTN","PSBOMM2",68,0)
 ..S PSBHDST=$P(^TMP("PSB1",$J,DFN,J),U)
"RTN","PSBOMM2",69,0)
 ..S PSBOFDT=$P(^TMP("PSB1",$J,DFN,J),U,4)
"RTN","PSBOMM2",70,0)
 ..S PSBOFST=$P(^TMP("PSB1",$J,DFN,J),U,3)
"RTN","PSBOMM2",71,0)
 ..I PSBOSTS="A",PSBHDST="HOLD",PSBOFST'="",'$D(^TMP("PSB1",$J,DFN,J+1)) I PSBSTOP>PSBOFDT,PSBOFST="OFF HOLD" S PSBFLAG=2,PSBUNHD=PSBOFDT
"RTN","PSBOMM2",72,0)
 ..I PSBOSTS="A",PSBHDST="HOLD",PSBOFST'="",PSBOFDT'<PSBSTOP S PSBFLAG=1
"RTN","PSBOMM2",73,0)
 ..I PSBOSTS="H",PSBHDST="HOLD",'$D(^TMP("PSB1",$J,DFN,J+1)) S PSBFLAG=1
"RTN","PSBOMM2",74,0)
 K PSBCNT,^TMP("PSB1",$J)
"RTN","PSBOMM2",75,0)
 S PSBOITX2=PSBOITX
"RTN","PSBOMM2",76,0)
 I $D(^TMP("PSB",$J,DFN,PSBDT,"* "_PSBOITX,PSBONX)) S PSBOITX="* "_PSBOITX
"RTN","PSBOMM2",77,0)
 I PSBFLAG=1 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$DTFMT(PSBHDDT)
"RTN","PSBOMM2",78,0)
 I PSBFLAG=2 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$DTFMT(PSBHDDT)_"  "_"(Off Hold) "_$$DTFMT(PSBUNHD)
"RTN","PSBOMM2",79,0)
 S PSBOITX=PSBOITX2
"RTN","PSBOMM2",80,0)
 Q
"RTN","PSBOMM2",81,0)
GCMNTS(XIEN) ;
"RTN","PSBOMM2",82,0)
 Q:'$D(^PSB(53.79,XIEN,.3,1))
"RTN","PSBOMM2",83,0)
 N X
"RTN","PSBOMM2",84,0)
 S X=$O(^PSB(53.79,XIEN,.3,""),-1) Q:+X=0  S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,.3)="Comment: "_$P(^PSB(53.79,XIEN,.3,X,0),U)
"RTN","PSBOMM2",85,0)
 Q
"RTN","PSBOMM2",86,0)
PARTG1(XIEN) ;
"RTN","PSBOMM2",87,0)
 I $D(^PSB(53.79,XIEN)) D
"RTN","PSBOMM2",88,0)
 .S PSBSTUS=$P(^PSB(53.79,XIEN,0),U,9)
"RTN","PSBOMM2",89,0)
 .I PSBOCRIT[PSBOSTS I PSBACRIT[PSBSTUS D  S PSBEXST=1 Q
"RTN","PSBOMM2",90,0)
 ..I (PSBSTUS="G")&$D(^PSB(53.79,XIEN,.5)) D
"RTN","PSBOMM2",91,0)
 ...S X=0 F  S X=$O(^PSB(53.79,XIEN,.5,X)) Q:+X=0  D
"RTN","PSBOMM2",92,0)
 ....I $P(^PSB(53.79,XIEN,.5,X,0),U,2)>$P(^PSB(53.79,XIEN,.5,X,0),U,3) D  S PSBOITX=$E(PSBOITX,3,999),PSBGVN=0
"RTN","PSBOMM2",93,0)
 .....S PSBOITX="* "_PSBOITX S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X")="Units Ordered: "_$P(^PSB(53.79,XIEN,.5,X,0),U,2)_"   Units Given: "_$P(^PSB(53.79,XIEN,.5,X,0),U,3)_"    Admin. Status: * Partial (Given)"
"RTN","PSBOMM2",94,0)
 .....I PSBINCC D GCMNTS(XIEN)
"RTN","PSBOMM2",95,0)
 ..I PSBSTUS'="G" D  S PSBGVN=0
"RTN","PSBOMM2",96,0)
 ...I PSBACRIT[PSBSTUS S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X")="Admin. Status: ("_$S(PSBSTUS="":" *UNKNOWN* ",PSBSTUS="M":"Missing Dose",PSBSTUS="H":"Held",PSBSTUS="R":"Refused")_")"
"RTN","PSBOMM2",97,0)
 ...I PSBINCC D GCMNTS(XIEN)
"RTN","PSBOMM2",98,0)
 Q
"RTN","PSBOMM2",99,0)
LN1 ;
"RTN","PSBOMM2",100,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMM2",101,0)
 Q
"RTN","PSBOMM2",102,0)
DEFLT ;
"RTN","PSBOMM2",103,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOMM2",104,0)
 Q:PSBRPT(1)]""
"RTN","PSBOMM2",105,0)
 S PSBFUTR="^^^^1^^1^1^^^^^^^^1^1^1"  ;default MM Report settings Per GUI MM report...
"RTN","PSBOMM2",106,0)
 S X01=""
"RTN","PSBOMM2",107,0)
 D RPC^PSBPAR(.X01,"GETPAR","ALL","PSB RPT INCL COMMENTS")
"RTN","PSBOMM2",108,0)
 S $P(PSBRPT(.2),U,8)=+X01(0)
"RTN","PSBOMM2",109,0)
 K PSBSTOP S PSBSTOP=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9)
"RTN","PSBOMM2",110,0)
 Q
"RTN","PSBOMM2",111,0)
DTFMT(DT) ;
"RTN","PSBOMM2",112,0)
 N Y,X
"RTN","PSBOMM2",113,0)
 I +DT'>0 S DTFMT=DT Q DTFMT
"RTN","PSBOMM2",114,0)
 S Y=DT,X=$E($P(Y,".",2)_"0000",1,4)
"RTN","PSBOMM2",115,0)
 S DTFMT=$TR($J(+$E(Y,4,5),2)_"/"_$J(+$E(Y,6,7),2)_"/"_($E(Y,1,3)+1700)," ","0")_"@"_X
"RTN","PSBOMM2",116,0)
 Q DTFMT
"RTN","PSBVT")
0^1^B80815673^B79719168
"RTN","PSBVT",1,0)
PSBVT ;BIRMINGHAM/EFC-BCMA ORDER VARIABLES UTILITY ;4/10/12 1:00pm
"RTN","PSBVT",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,38,68,74**;Mar 2004;Build 5
"RTN","PSBVT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBVT",4,0)
 ;
"RTN","PSBVT",5,0)
 ; Reference/IA
"RTN","PSBVT",6,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBVT",7,0)
 ; ^TMP("PSJ",$J/2828
"RTN","PSBVT",8,0)
 ;
"RTN","PSBVT",9,0)
 ;*68 Define New Variable (IEN from Med Route file) in Tag PSJ which
"RTN","PSBVT",10,0)
 ;    uses the TMP global built by a previous call to PSJBCMA Api.
"RTN","PSBVT",11,0)
 ;
"RTN","PSBVT",12,0)
PSJ(PSBX1) ;
"RTN","PSBVT",13,0)
 S ^TMP("TK PSJ",PSBX1)=""
"RTN","PSBVT",14,0)
 S PSBSCRT="^TMP(""PSB"",$J,""PSBORDA"")"
"RTN","PSBVT",15,0)
 K @PSBSCRT M @PSBSCRT=^TMP("PSJ",$J,PSBX1)
"RTN","PSBVT",16,0)
 S PSBDFN=DFN
"RTN","PSBVT",17,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",0))
"RTN","PSBVT",18,0)
 S PSBON=+$P(PSBSCRT,U,3)  ; ord num w/o type
"RTN","PSBVT",19,0)
 S PSBONX=$P(PSBSCRT,U,3)  ; ord num w/  type "U" or "V"
"RTN","PSBVT",20,0)
 S PSBOTYP=$E(PSBONX,$L(PSBONX))
"RTN","PSBVT",21,0)
 S PSBPONX=$P(PSBSCRT,U,4)  ; prev ord num
"RTN","PSBVT",22,0)
 S PSBFON=$P(PSBSCRT,U,5)  ; foll ord num
"RTN","PSBVT",23,0)
 S PSBIVT=$P(PSBSCRT,U,6)  ; IV type
"RTN","PSBVT",24,0)
 S PSBISYR=$P(PSBSCRT,U,7)  ; intermit syrg
"RTN","PSBVT",25,0)
 S PSBCHEMT=$P(PSBSCRT,U,8)  ; chemo type
"RTN","PSBVT",26,0)
 S PSBCPRS=$P(PSBSCRT,U,9)  ; ords file entry (CPRS order #)
"RTN","PSBVT",27,0)
 S PSBFOR=$P(PSBSCRT,U,10)  ; reason for foll order
"RTN","PSBVT",28,0)
 Q:PSBSCRT=-1
"RTN","PSBVT",29,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",1))
"RTN","PSBVT",30,0)
 S PSBMR=$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,2) ;med rt
"RTN","PSBVT",31,0)
 S PSBMRAB=$P(PSBSCRT,U,1) ;med rt abbr
"RTN","PSBVT",32,0)
 S PSBMRIEN=+$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,4) ;med rt ien *68
"RTN","PSBVT",33,0)
 S PSBNJECT=+$G(^TMP("PSB",$J,"PSBORDA",1,0))  ;Inj site
"RTN","PSBVT",34,0)
 S PSBIVPSH=+$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,3) ;IV PUSH
"RTN","PSBVT",35,0)
 S PSBSCHT=$P(PSBSCRT,U,2)  ; sched type conversion
"RTN","PSBVT",36,0)
 S PSBSCH=$P(PSBSCRT,U,3)  ; sched
"RTN","PSBVT",37,0)
 S PSBOST=$P(PSBSCRT,U,4)  ; strt dte FM
"RTN","PSBVT",38,0)
 S PSBOSP=$P(PSBSCRT,U,5)  ; stp dte FM
"RTN","PSBVT",39,0)
 S PSBADST=$P(PSBSCRT,U,6)  ; admin times strin in NNNN- format
"RTN","PSBVT",40,0)
 S PSBOSTS=$P(PSBSCRT,U,7)  ; status
"RTN","PSBVT",41,0)
 S PSBNGF=$P(PSBSCRT,U,8)  ; not to be given flag
"RTN","PSBVT",42,0)
 S PSBOSCHT=$P(PSBSCRT,U,9)  ; origin sched type
"RTN","PSBVT",43,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",2))
"RTN","PSBVT",44,0)
 S PSBDOSE=$P(PSBSCRT,U,1)  ; dosage ordered
"RTN","PSBVT",45,0)
 S PSBIFR=$P(PSBSCRT,U,2)  ; infusn rate
"RTN","PSBVT",46,0)
 S PSBSM=$P(PSBSCRT,U,3)  ; self med
"RTN","PSBVT",47,0)
 S PSBHSM=$P(PSBSCRT,U,4)  ; hospital supplied self med
"RTN","PSBVT",48,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",3))
"RTN","PSBVT",49,0)
 S PSBOIT=$P(PSBSCRT,U,1)  ; order item IEN - > ^ORD(101.43)
"RTN","PSBVT",50,0)
 S PSBOITX=$P(PSBSCRT,U,2)  ; order item (expanded)_" "_dosage form
"RTN","PSBVT",51,0)
 I PSBOITX="" S PSBOITX="ZZZZ NO ORDERABLE ITEM"
"RTN","PSBVT",52,0)
 S PSBDOSEF=$P(PSBSCRT,U,3)  ; dosage form
"RTN","PSBVT",53,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",4))
"RTN","PSBVT",54,0)
 S PSBOTXT=PSBSCRT  ; special inst/other print info
"RTN","PSBVT",55,0)
 ; get disp drug
"RTN","PSBVT",56,0)
 I $G(^TMP("PSB",$J,"PSBORDA",700,0)) F PSBX2=1:1:^TMP("PSB",$J,"PSBORDA",700,0) M PSBDDA(PSBX2)=^TMP("PSB",$J,"PSBORDA",700,PSBX2,0) S PSBDDA(PSBX2)="DD^"_PSBDDA(PSBX2) ; # of DDrug
"RTN","PSBVT",57,0)
 ;     "DD"^dispensed drug IEN -> ^PSDRUG() DRUG^dispensed drug name^units per dose^inactive date
"RTN","PSBVT",58,0)
 ; build unique id list
"RTN","PSBVT",59,0)
 ; add addits
"RTN","PSBVT",60,0)
 I $D(^TMP("PSB",$J,"PSBORDA",800)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",800,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",61,0)
 .S PSBUIDA(PSBX2)="ID^"_PSBX2 F J=1:1:^TMP("PSB",$J,"PSBORDA",800,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"ADD;"_$P(^TMP("PSB",$J,"PSBORDA",800,PSBX2,J),U,1)
"RTN","PSBVT",62,0)
 ; add solutions
"RTN","PSBVT",63,0)
 I $D(^TMP("PSB",$J,"PSBORDA",900)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",900,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",64,0)
 .I '$D(PSBUIDA(PSBX2)) S PSBUIDA(PSBX2)="ID^"_PSBX2
"RTN","PSBVT",65,0)
 .F J=1:1:^TMP("PSB",$J,"PSBORDA",900,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"SOL;"_$P(^TMP("PSB",$J,"PSBORDA",900,PSBX2,J),U,1)
"RTN","PSBVT",66,0)
 ;     "ID"   ^   (piece 2,3,)... = type;IEN of each add/sol for this ID ex. "SOL;4"
"RTN","PSBVT",67,0)
 ; get addits
"RTN","PSBVT",68,0)
 I $G(^TMP("PSB",$J,"PSBORDA",850,0)) F PSBX2=1:1:^TMP("PSB",$J,"PSBORDA",850,0) D
"RTN","PSBVT",69,0)
 .M PSBADA(PSBX2)=^TMP("PSB",$J,"PSBORDA",850,PSBX2,0)  ; number od additives (exists only for IV)
"RTN","PSBVT",70,0)
 .S PSBADA(PSBX2)="ADD^"_PSBADA(PSBX2)
"RTN","PSBVT",71,0)
 .S PSBBAGS=$P(PSBADA(PSBX2),U,5) I PSBBAGS'="" S PSBBAG=" IN BAG "_$P(PSBBAGS,",",1) F I=2:1 S X=$P(PSBBAGS,",",I) Q:X=""  S PSBBAG=PSBBAG_" AND "_X
"RTN","PSBVT",72,0)
 .S:PSBBAGS'="" $P(PSBADA(PSBX2),U,5)=PSBBAG,$P(PSBADA(PSBX2),U,6)=PSBBAGS
"RTN","PSBVT",73,0)
 ;     "ADD"^additive IEN -> ^PS(52.6) IV ADDITIVES^additive name^strength ^bottle
"RTN","PSBVT",74,0)
 ; get soluts
"RTN","PSBVT",75,0)
 I $G(^TMP("PSB",$J,"PSBORDA",950,0)) F PSBX2=1:1:^TMP("PSB",$J,"PSBORDA",950,0) M PSBSOLA(PSBX2)=^TMP("PSB",$J,"PSBORDA",950,PSBX2,0) S PSBSOLA(PSBX2)="SOL^"_PSBSOLA(PSBX2)  ; # of SOL
"RTN","PSBVT",76,0)
 ;   "SOL"^solution IEN -> ^PS(52.7) IV SOLUTIONS^solution name^volume
"RTN","PSBVT",77,0)
 K ^TMP("PSB",$J,"PSBORDA"),PSBX1,PSBX2
"RTN","PSBVT",78,0)
 Q
"RTN","PSBVT",79,0)
 ;
"RTN","PSBVT",80,0)
PSJ1(PSBPAR1,PSBPAR2) ; set the variables for an individual order
"RTN","PSBVT",81,0)
 S ^TMP("TK PSJ1",PSBPAR1,PSBPAR2)=""
"RTN","PSBVT",82,0)
 ;     PSBPAR1 = DFN
"RTN","PSBVT",83,0)
 ;     PSBPAR2 = ORDNER NUMBER 
"RTN","PSBVT",84,0)
 S PSBSCRT="^TMP(""PSB"",$J,""PSBORDA"")"
"RTN","PSBVT",85,0)
 K @PSBSCRT
"RTN","PSBVT",86,0)
 N PSBX
"RTN","PSBVT",87,0)
 K ^TMP("PSJ1",$J) D EN^PSJBCMA1(PSBPAR1,PSBPAR2,1)
"RTN","PSBVT",88,0)
 M @PSBSCRT=^TMP("PSJ1",$J) K ^TMP("PSJ1",$J)
"RTN","PSBVT",89,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",0))
"RTN","PSBVT",90,0)
 S PSBDFN=PSBPAR1
"RTN","PSBVT",91,0)
 S PSBON=+$P(PSBSCRT,U,3)  ; ord num w/o type
"RTN","PSBVT",92,0)
 S PSBONX=$P(PSBSCRT,U,3)  ; ord num w/  type "U" or "V"
"RTN","PSBVT",93,0)
 S PSBOTYP=$E(PSBONX,$L(PSBONX))
"RTN","PSBVT",94,0)
 S PSBPONX=$P(PSBSCRT,U,4)  ; prev ord num
"RTN","PSBVT",95,0)
 S PSBFON=$P(PSBSCRT,U,5)  ; foll ord num
"RTN","PSBVT",96,0)
 S PSBIVT=$P(PSBSCRT,U,6)  ; IV type
"RTN","PSBVT",97,0)
 S PSBISYR=$P(PSBSCRT,U,7)  ; intermit syrg
"RTN","PSBVT",98,0)
 S PSBCHEMT=$P(PSBSCRT,U,8)  ; chemo type
"RTN","PSBVT",99,0)
 S PSBCPRS=$P(PSBSCRT,U,0)  ; ord file entry (CPRS order #)
"RTN","PSBVT",100,0)
 Q:PSBSCRT=-1
"RTN","PSBVT",101,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",1))
"RTN","PSBVT",102,0)
 S PSBMD=$P(PSBSCRT,U,1)  ; prov IEN -> ^VA(200)
"RTN","PSBVT",103,0)
 S PSBMDX=$P(PSBSCRT,U,2)  ; prov name
"RTN","PSBVT",104,0)
 S PSBMR=$P(PSBSCRT,U,3)  ; med rt IEN -> ^PS(51.2)
"RTN","PSBVT",105,0)
 I $G(PSBMR)'="" S PSBMR=$P(PSBSCRT,U,13)  ;med rt
"RTN","PSBVT",106,0)
 S PSBMRAB=$P(PSBSCRT,U,4)  ;med rt abbr
"RTN","PSBVT",107,0)
 S PSBMRIEN=+$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,4) ;med rt ien added in PSB*3*74
"RTN","PSBVT",108,0)
 S PSBNJECT=+$G(^TMP("PSB",$J,"PSBORDA",1,0))  ;Inj site
"RTN","PSBVT",109,0)
 S PSBIVPSH=+$P($G(^TMP("PSB",$J,"PSBORDA",1,0)),U,2)  ;IV PUSH
"RTN","PSBVT",110,0)
 S PSBSM=$P(PSBSCRT,U,5)  ; self med
"RTN","PSBVT",111,0)
 S PSBSMX=$P(PSBSCRT,U,6)  ; expnd to YES/NO
"RTN","PSBVT",112,0)
 S PSBHSM=$P(PSBSCRT,U,7)  ; hospital supplied self med
"RTN","PSBVT",113,0)
 S PSBHSMX=$P(PSBSCRT,U,8)  ; expnd to YES/NO
"RTN","PSBVT",114,0)
 S PSBNGF=$P(PSBSCRT,U,9)  ; not to be given flag
"RTN","PSBVT",115,0)
 S PSBOSTS=$P(PSBSCRT,U,10)  ; ord status
"RTN","PSBVT",116,0)
 S PSBOSTSX=$P(PSBSCRT,U,11)  ; ord status expans
"RTN","PSBVT",117,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",2))
"RTN","PSBVT",118,0)
 S PSBOIT=$P(PSBSCRT,U,1)  ; orderable item IEN -> ^ORD(101.43) ORDERABLE ITEM
"RTN","PSBVT",119,0)
 S PSBOITX=$P(PSBSCRT,U,2)  ; orderable item (expaned)_" "_ dosage form
"RTN","PSBVT",120,0)
 I PSBOITX="" S PSBOITX="ZZZZ NO ORDERABLE ITEM"
"RTN","PSBVT",121,0)
 S PSBDOSE=$P(PSBSCRT,U,3)  ; dosage ordered
"RTN","PSBVT",122,0)
 S PSBIFR=$P(PSBSCRT,U,4)  ; infusion rate
"RTN","PSBVT",123,0)
 S PSBSCH=$P(PSBSCRT,U,5)  ; sched
"RTN","PSBVT",124,0)
 S PSBDOSEF=$P(PSBSCRT,U,6)  ; dosage form
"RTN","PSBVT",125,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",3))
"RTN","PSBVT",126,0)
 S PSBOTXT=$P(PSBSCRT,U,1)  ; UD special inst or IV other print info
"RTN","PSBVT",127,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",4))
"RTN","PSBVT",128,0)
 S PSBSCHT=$P(PSBSCRT,U,1)  ; sched type conversion
"RTN","PSBVT",129,0)
 S PSBSCHTX=$P(PSBSCRT,U,2)  ; sched type expansion
"RTN","PSBVT",130,0)
 S PSBLDT=$P(PSBSCRT,U,3)  ; log-in date FM
"RTN","PSBVT",131,0)
 S PSBLDTX=$P(PSBSCRT,U,4)  ; exp MM/DD/YYYY HH:MM
"RTN","PSBVT",132,0)
 S PSBOST=$P(PSBSCRT,U,5)  ; start date FM
"RTN","PSBVT",133,0)
 S PSBOSTX=$P(PSBSCRT,U,6)  ; exp MM/DD/YYYY HH:MM
"RTN","PSBVT",134,0)
 S PSBOSP=$P(PSBSCRT,U,7)  ; stop date FM
"RTN","PSBVT",135,0)
 S PSBOSPX=$P(PSBSCRT,U,8) ; exp MM/DD/YYYY HH:MM
"RTN","PSBVT",136,0)
 S PSBADST=$P(PSBSCRT,U,9)  ; admin times string in NNNN- format
"RTN","PSBVT",137,0)
 S PSBOSCHT=$P(PSBSCRT,U,10)  ; original schedule type
"RTN","PSBVT",138,0)
 S PSBFREQ=$P(PSBSCRT,U,11)  ; frequency
"RTN","PSBVT",139,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",5))
"RTN","PSBVT",140,0)
 S PSBVN=$P(PSBSCRT,U,1)  ; verify nurse IEN -> ^VA(200)
"RTN","PSBVT",141,0)
 S PSBVNX=$P(PSBSCRT,U,2)  ; nurse name
"RTN","PSBVT",142,0)
 S PSBVNI=$P(PSBSCRT,U,3) ; nurse initials
"RTN","PSBVT",143,0)
 S PSBVPH=$P(PSBSCRT,U,4)  ; verify pharm IEN -> ^VA(200)
"RTN","PSBVT",144,0)
 S PSBVPHX=$P(PSBSCRT,U,5)  ; pharm name
"RTN","PSBVT",145,0)
 S PSBVPHI=$P(PSBSCRT,U,6)  ; pharm initials
"RTN","PSBVT",146,0)
 S PSBSCRT=$G(^TMP("PSB",$J,"PSBORDA",6))
"RTN","PSBVT",147,0)
 S PSBRMRK=$G(PSBSCRT)
"RTN","PSBVT",148,0)
 ;If DayOFWeek set frequen to NULL
"RTN","PSBVT",149,0)
 I $$PSBDCHK1^PSBVT1(PSBSCH) S PSBFREQ=""
"RTN","PSBVT",150,0)
 ; get dispensed drug
"RTN","PSBVT",151,0)
 I $G(^TMP("PSB",$J,"PSBORDA",700,0)) F PSBX=1:1:^TMP("PSB",$J,"PSBORDA",700,0) M PSBDDA(PSBX)=^TMP("PSB",$J,"PSBORDA",700,PSBX,0) S PSBDDA(PSBX)="DD^"_PSBDDA(PSBX) ; # of DDrug
"RTN","PSBVT",152,0)
 ;     "DD"^dispensed drug IEN -> ^PSDRUG() DRUG^dispensed drug name^units per dose^inactive date
"RTN","PSBVT",153,0)
 ; build unique id list
"RTN","PSBVT",154,0)
 ; add addits
"RTN","PSBVT",155,0)
 I $D(^TMP("PSB",$J,"PSBORDA",800)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",800,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",156,0)
 .S PSBUIDA(PSBX2)="ID^"_PSBX2 F J=1:1:^TMP("PSB",$J,"PSBORDA",800,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"ADD;"_$P(^TMP("PSB",$J,"PSBORDA",800,PSBX2,J),U,1)
"RTN","PSBVT",157,0)
 ; add soluts
"RTN","PSBVT",158,0)
 I $D(^TMP("PSB",$J,"PSBORDA",900)) S PSBX2="" F  S PSBX2=$O(^TMP("PSB",$J,"PSBORDA",900,PSBX2)) Q:PSBX2=""!(PSBX2="ERROR")  D
"RTN","PSBVT",159,0)
 .I '$D(PSBUIDA(PSBX2)) S PSBUIDA(PSBX2)="ID^"_PSBX2
"RTN","PSBVT",160,0)
 .F J=1:1:^TMP("PSB",$J,"PSBORDA",900,PSBX2,0) S PSBUIDA(PSBX2)=PSBUIDA(PSBX2)_"^"_"SOL;"_$P(^TMP("PSB",$J,"PSBORDA",900,PSBX2,J),U,1)
"RTN","PSBVT",161,0)
 ;     "ID"   ^   (piece 2,3),... = type;IEN of each add/sol for this ID ex. "SOL;4"
"RTN","PSBVT",162,0)
 ; get addits
"RTN","PSBVT",163,0)
 I $G(^TMP("PSB",$J,"PSBORDA",850,0)) F PSBX=1:1:^TMP("PSB",$J,"PSBORDA",850,0) D
"RTN","PSBVT",164,0)
 .M PSBADA(PSBX)=^TMP("PSB",$J,"PSBORDA",850,PSBX,0)  ; num of addits
"RTN","PSBVT",165,0)
 .S PSBADA(PSBX)="ADD^"_PSBADA(PSBX)
"RTN","PSBVT",166,0)
 .S PSBBAGS=$P(PSBADA(PSBX),U,5) I PSBBAGS'="" S PSBBAG=" IN BAG "_$P(PSBBAGS,",",1) D
"RTN","PSBVT",167,0)
 ..F I=2:1 S X=$P(PSBBAGS,",",I) Q:X=""  S PSBBAG=PSBBAG_" AND "_X
"RTN","PSBVT",168,0)
 .S:PSBBAGS'="" $P(PSBADA(PSBX),U,5)=PSBBAG
"RTN","PSBVT",169,0)
 ;     "ADD"^additive IEN -> ^PS(52.6) IV ADDITIVES^additive name^strength^bottle
"RTN","PSBVT",170,0)
 ; get soluts
"RTN","PSBVT",171,0)
 I $G(^TMP("PSB",$J,"PSBORDA",950,0)) F PSBX=1:1:^TMP("PSB",$J,"PSBORDA",950,0) M PSBSOLA(PSBX)=^TMP("PSB",$J,"PSBORDA",950,PSBX,0) S PSBSOLA(PSBX)="SOL^"_PSBSOLA(PSBX)  ; # of SOLs
"RTN","PSBVT",172,0)
 ;   "SOL"   ^   solution IEN -> ^PS(52.7) IV SOLUTIONS^solution name^volume
"RTN","PSBVT",173,0)
 ; get label
"RTN","PSBVT",174,0)
 I $D(^TMP("PSB",$J,"PSBORDA",1000)) M PSBLBLA=^TMP("PSB",$J,"PSBORDA",1000)
"RTN","PSBVT",175,0)
 K ^TMP("PSB",$J,"PSBORDA")
"RTN","PSBVT",176,0)
 Q
"RTN","PSBVT",177,0)
 ;
"RTN","PSBVT",178,0)
LACTION ; get last action info
"RTN","PSBVT",179,0)
 S (PSBLADT,PSBLAIEN,PSBLASTS)=""
"RTN","PSBVT",180,0)
 I '$D(^PSB(53.79,"AORDX",PSBDFN,PSBONX)) Q
"RTN","PSBVT",181,0)
 S PSBLADT=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,""),-1)
"RTN","PSBVT",182,0)
 S PSBLAIEN=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBLADT,""))
"RTN","PSBVT",183,0)
 S PSBLASTS=$P(^PSB(53.79,PSBLAIEN,0),U,9)
"RTN","PSBVT",184,0)
 Q
"RTN","PSBVT",185,0)
 ;
"RTN","PSBVT",186,0)
CLEAN ;
"RTN","PSBVT",187,0)
 K PSBONX,PSBPONX,PSBFON,PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMD,PSBMDX,PSBMR,PSBMRAB,PSBSM,PSBSMX,PSBHSM,PSBHSMX
"RTN","PSBVT",188,0)
 K PSBDFN,PSBNGF,PSBOSTS,PSBOSTSX,PSBOIT,PSBOITX,PSBDOSE,PSBIFR,PSBSCH,PSBDOSEF,PSBOTXT,PSBSCHT,PSBSCHTX
"RTN","PSBVT",189,0)
 K PSBLDT,PSBLDTX,PSBOST,PSBOSTX,PSBOSP,PSBOSPX,PSBADST,PSBOSCHT,PSBFREQ,PSBVN,PSBVNX,PSBVNI
"RTN","PSBVT",190,0)
 K PSBVPH,PSBVPHX,PSBVPHI,PSBDDA,PSBADA,PSBSOLA,PSBUIDA,PSBCPRS,PSBON,PSBRMRK,PSBNJECT,PSBIVPSH
"RTN","PSBVT",191,0)
 K PSBLADT,PSBLAIEN,PSBLASTS,PSBBAG,PSBBAGS,PSBLBLA,PSBFOR,PSBSCRT
"RTN","PSBVT",192,0)
 K PSBMRIEN   ;*68
"RTN","PSBVT",193,0)
 Q
"VER")
8.0^22.0
"BLD",9174,6)
^59
**END**
**END**
