KIDS Distribution saved on Nov 17, 2011@15:02:43
PSB*3.0*48
**KIDS**:PSB*3.0*48^

**INSTALL NAME**
PSB*3.0*48
"BLD",8456,0)
PSB*3.0*48^BAR CODE MED ADMIN^0^3111117^y
"BLD",8456,1,0)
^^19^19^3111110^^
"BLD",8456,1,1,0)
This patch addresses the following issues:
"BLD",8456,1,2,0)
 
"BLD",8456,1,3,0)
(1) Future medication orders are showing on the Bar Code Medication
"BLD",8456,1,4,0)
Administration Backup System (BCBU) medication administration record
"BLD",8456,1,5,0)
(MAR) as current medications and user's agree that asterisk's should be 
"BLD",8456,1,6,0)
displaying in the administration time fields until the actual start 
"BLD",8456,1,7,0)
dates have been reached. (2) Held medications are currently being
"BLD",8456,1,8,0)
displayed on the BCBU MAR Print option Print MAR for a Selected Patient
"BLD",8456,1,9,0)
and user's feel that this is confusing and that held meds should not be
"BLD",8456,1,10,0)
displayed on the BCBU MAR report any longer. (3) A prompt and help message
"BLD",8456,1,11,0)
in VistA under the BCMA Backup System [PSB BCBU WRKSTN MAIN] option name
"BLD",8456,1,12,0)
is currently not displaying properly or consistent among the three BCBU
"BLD",8456,1,13,0)
MAR print options Print MAR for All Wards, Print MAR for Selected Patient,
"BLD",8456,1,14,0)
and Print MAR for Selected Ward. (4) While using the Print MAR for
"BLD",8456,1,15,0)
Selected Ward option under the option name BCMA Backup System (Wrkstn)
"BLD",8456,1,16,0)
[PSB BCBU WRKSTN MAIN] the system is currently producing an error if a
"BLD",8456,1,17,0)
patient has no Room or Bed assigned to them when trying to use the
"BLD",8456,1,18,0)
Room/Bed option for the sort question 'Sort Patients by [N]ame or 
"BLD",8456,1,19,0)
[R]oom/Bed?'.
"BLD",8456,4,0)
^9.64PA^^
"BLD",8456,6)
1^
"BLD",8456,6.3)
9
"BLD",8456,"ABPKG")
n
"BLD",8456,"KRN",0)
^9.67PA^779.2^20
"BLD",8456,"KRN",.4,0)
.4
"BLD",8456,"KRN",.401,0)
.401
"BLD",8456,"KRN",.402,0)
.402
"BLD",8456,"KRN",.403,0)
.403
"BLD",8456,"KRN",.5,0)
.5
"BLD",8456,"KRN",.84,0)
.84
"BLD",8456,"KRN",3.6,0)
3.6
"BLD",8456,"KRN",3.8,0)
3.8
"BLD",8456,"KRN",9.2,0)
9.2
"BLD",8456,"KRN",9.8,0)
9.8
"BLD",8456,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",8456,"KRN",9.8,"NM",1,0)
ALPBPPAT^^0^B22283739
"BLD",8456,"KRN",9.8,"NM",2,0)
ALPBPALL^^0^B26374660
"BLD",8456,"KRN",9.8,"NM",3,0)
ALPBPWRD^^0^B51543358
"BLD",8456,"KRN",9.8,"NM",4,0)
ALPBFRM1^^0^B63576803
"BLD",8456,"KRN",9.8,"NM","B","ALPBFRM1",4)

"BLD",8456,"KRN",9.8,"NM","B","ALPBPALL",2)

"BLD",8456,"KRN",9.8,"NM","B","ALPBPPAT",1)

"BLD",8456,"KRN",9.8,"NM","B","ALPBPWRD",3)

"BLD",8456,"KRN",19,0)
19
"BLD",8456,"KRN",19.1,0)
19.1
"BLD",8456,"KRN",101,0)
101
"BLD",8456,"KRN",409.61,0)
409.61
"BLD",8456,"KRN",771,0)
771
"BLD",8456,"KRN",779.2,0)
779.2
"BLD",8456,"KRN",870,0)
870
"BLD",8456,"KRN",8989.51,0)
8989.51
"BLD",8456,"KRN",8989.52,0)
8989.52
"BLD",8456,"KRN",8994,0)
8994
"BLD",8456,"KRN","B",.4,.4)

"BLD",8456,"KRN","B",.401,.401)

"BLD",8456,"KRN","B",.402,.402)

"BLD",8456,"KRN","B",.403,.403)

"BLD",8456,"KRN","B",.5,.5)

"BLD",8456,"KRN","B",.84,.84)

"BLD",8456,"KRN","B",3.6,3.6)

"BLD",8456,"KRN","B",3.8,3.8)

"BLD",8456,"KRN","B",9.2,9.2)

"BLD",8456,"KRN","B",9.8,9.8)

"BLD",8456,"KRN","B",19,19)

"BLD",8456,"KRN","B",19.1,19.1)

"BLD",8456,"KRN","B",101,101)

"BLD",8456,"KRN","B",409.61,409.61)

"BLD",8456,"KRN","B",771,771)

"BLD",8456,"KRN","B",779.2,779.2)

"BLD",8456,"KRN","B",870,870)

"BLD",8456,"KRN","B",8989.51,8989.51)

"BLD",8456,"KRN","B",8989.52,8989.52)

"BLD",8456,"KRN","B",8994,8994)

"BLD",8456,"QDEF")
^^^^NO^^^^^^NO
"BLD",8456,"QUES",0)
^9.62^^
"BLD",8456,"REQB",0)
^9.611^2^2
"BLD",8456,"REQB",1,0)
PSB*3.0*29^2
"BLD",8456,"REQB",2,0)
PSB*3.0*37^2
"BLD",8456,"REQB","B","PSB*3.0*29",1)

"BLD",8456,"REQB","B","PSB*3.0*37",2)

"MBREQ")
0
"PKG",550,-1)
1^1
"PKG",550,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",550,20,0)
^9.402P^^
"PKG",550,22,0)
^9.49I^1^1
"PKG",550,22,1,0)
3.0^3040224^3040311^66481
"PKG",550,22,1,"PAH",1,0)
48^3111117^718
"PKG",550,22,1,"PAH",1,1,0)
^^19^19^3111117
"PKG",550,22,1,"PAH",1,1,1,0)
This patch addresses the following issues:
"PKG",550,22,1,"PAH",1,1,2,0)
 
"PKG",550,22,1,"PAH",1,1,3,0)
(1) Future medication orders are showing on the Bar Code Medication
"PKG",550,22,1,"PAH",1,1,4,0)
Administration Backup System (BCBU) medication administration record
"PKG",550,22,1,"PAH",1,1,5,0)
(MAR) as current medications and user's agree that asterisk's should be 
"PKG",550,22,1,"PAH",1,1,6,0)
displaying in the administration time fields until the actual start 
"PKG",550,22,1,"PAH",1,1,7,0)
dates have been reached. (2) Held medications are currently being
"PKG",550,22,1,"PAH",1,1,8,0)
displayed on the BCBU MAR Print option Print MAR for a Selected Patient
"PKG",550,22,1,"PAH",1,1,9,0)
and user's feel that this is confusing and that held meds should not be
"PKG",550,22,1,"PAH",1,1,10,0)
displayed on the BCBU MAR report any longer. (3) A prompt and help message
"PKG",550,22,1,"PAH",1,1,11,0)
in VistA under the BCMA Backup System [PSB BCBU WRKSTN MAIN] option name
"PKG",550,22,1,"PAH",1,1,12,0)
is currently not displaying properly or consistent among the three BCBU
"PKG",550,22,1,"PAH",1,1,13,0)
MAR print options Print MAR for All Wards, Print MAR for Selected Patient,
"PKG",550,22,1,"PAH",1,1,14,0)
and Print MAR for Selected Ward. (4) While using the Print MAR for
"PKG",550,22,1,"PAH",1,1,15,0)
Selected Ward option under the option name BCMA Backup System (Wrkstn)
"PKG",550,22,1,"PAH",1,1,16,0)
[PSB BCBU WRKSTN MAIN] the system is currently producing an error if a
"PKG",550,22,1,"PAH",1,1,17,0)
patient has no Room or Bed assigned to them when trying to use the
"PKG",550,22,1,"PAH",1,1,18,0)
Room/Bed option for the sort question 'Sort Patients by [N]ame or 
"PKG",550,22,1,"PAH",1,1,19,0)
[R]oom/Bed?'.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","ALPBFRM1")
0^4^B63576803
"RTN","ALPBFRM1",1,0)
ALPBFRM1 ;OIFO-DALLAS MW,SED,KC -STANDARD PRINT FORMATTING UTIL;01/01/03
"RTN","ALPBFRM1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**8,48**;Mar 2004;Build 9
"RTN","ALPBFRM1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ALPBFRM1",4,0)
 ;
"RTN","ALPBFRM1",5,0)
F132(DATA,DAYS,MLCNT,RESULTS,ALPPAT) ; format data into a 132-column
"RTN","ALPBFRM1",6,0)
 ; output array...
"RTN","ALPBFRM1",7,0)
 ; DATA = an array containing a specific order node for a selected
"RTN","ALPBFRM1",8,0)
 ;        patient in file 53.7
"RTN","ALPBFRM1",9,0)
 ; DAYS = a number that represents the number of initial boxes
"RTN","ALPBFRM1",10,0)
 ;        (1 box = 1 day) to add to lines 4-10 (max=7 -- note that
"RTN","ALPBFRM1",11,0)
 ;        this is usually a 3-day MAR, but a 7-day MAR could be
"RTN","ALPBFRM1",12,0)
 ;        returned from this format utility)
"RTN","ALPBFRM1",13,0)
 ; MLCNT = Number of Med-log entries to print with orders
"RTN","ALPBFRM1",14,0)
 ; RESULTS = an array passed by reference into which the formatted
"RTN","ALPBFRM1",15,0)
 ;           entry is set up returns a formatted array in RESULTS
"RTN","ALPBFRM1",16,0)
 ;           (note: total line count is returned at RESULTS(0))
"RTN","ALPBFRM1",17,0)
 I $D(DATA)="" Q
"RTN","ALPBFRM1",18,0)
 ;
"RTN","ALPBFRM1",19,0)
 N ALPBADM,ALPBDAYS,ALPBDRUG,ALPBIBOX,ALPBNBOX,ALPBPBOX,ALPBSTOP,ALPBTEXT,ALPBTIME,ALPBX,DATE,LINE,BOLDON,BOLDOFF,X,ALPBPRNG,ALPBFLG,ALPBPRN,ALPBMLC,ALPBTSTART
"RTN","ALPBFRM1",20,0)
 ; to use BOLD, comment out the next line and remove comments from
"RTN","ALPBFRM1",21,0)
 ; the following five lines...
"RTN","ALPBFRM1",22,0)
 S BOLDON="<<",BOLDOFF=">>"
"RTN","ALPBFRM1",23,0)
 ;S X="IOINHI;IOINORM"
"RTN","ALPBFRM1",24,0)
 ;D ENDR^%ZISS
"RTN","ALPBFRM1",25,0)
 ;S BOLDON=$G(IOINHI)
"RTN","ALPBFRM1",26,0)
 ;S BOLDOFF=$G(IOINORM)
"RTN","ALPBFRM1",27,0)
 ;D KILL^%ZISS
"RTN","ALPBFRM1",28,0)
 ;
"RTN","ALPBFRM1",29,0)
 ;S MLCNT=$S(+$P($G(^ALPB(53.71,1,2)),U,4)>0:+$P(^ALPB(53.71,1,2),U,4),1:1)
"RTN","ALPBFRM1",30,0)
 I $G(DAYS)="" S DAYS=3
"RTN","ALPBFRM1",31,0)
 I DAYS>7 S DAYS=7
"RTN","ALPBFRM1",32,0)
 S DATE=$$DT^XLFDT()
"RTN","ALPBFRM1",33,0)
 D FDATES^ALPBUTL(DATE,DAYS,.ALPBDAYS)
"RTN","ALPBFRM1",34,0)
 ; get administration timing (needed for formatting various lines)
"RTN","ALPBFRM1",35,0)
 S ALPBX=$P($G(DATA(4)),"^",4)
"RTN","ALPBFRM1",36,0)
 I ALPBX="" S ALPBADM=0
"RTN","ALPBFRM1",37,0)
 I ALPBX'="" D
"RTN","ALPBFRM1",38,0)
 .S ALPBADM=0
"RTN","ALPBFRM1",39,0)
 .F I=1:1 Q:$P(ALPBX,"-",I)=""  D
"RTN","ALPBFRM1",40,0)
 ..S ALPBADM(I)=$P(ALPBX,"-",I)
"RTN","ALPBFRM1",41,0)
 ..S ALPBADM=ALPBADM+1
"RTN","ALPBFRM1",42,0)
 ; line 1...
"RTN","ALPBFRM1",43,0)
 S RESULTS(1)=""
"RTN","ALPBFRM1",44,0)
 S RESULTS(1)=$$PAD^ALPBUTL(RESULTS(1),66)_"Admin"
"RTN","ALPBFRM1",45,0)
 ; line 2...
"RTN","ALPBFRM1",46,0)
 S RESULTS(2)="Start"
"RTN","ALPBFRM1",47,0)
 S RESULTS(2)=$$PAD^ALPBUTL(RESULTS(2),25)_"Stop"
"RTN","ALPBFRM1",48,0)
 S RESULTS(2)=$$PAD^ALPBUTL(RESULTS(2),66)_"Times"
"RTN","ALPBFRM1",49,0)
 S RESULTS(2)=$$PAD^ALPBUTL(RESULTS(2),74)_ALPBDAYS(0)
"RTN","ALPBFRM1",50,0)
 I DAYS=3 S RESULTS(2)=RESULTS(2)_"   Notes"
"RTN","ALPBFRM1",51,0)
 ; line 3...
"RTN","ALPBFRM1",52,0)
 S RESULTS(3)=$$REPEAT^XLFSTR("-",132)
"RTN","ALPBFRM1",53,0)
 ; line 4...
"RTN","ALPBFRM1",54,0)
 ; start and stop date/times...
"RTN","ALPBFRM1",55,0)
 S RESULTS(4)=$S($P($G(DATA(1)),"^")'="":$$FMTE^XLFDT($P(DATA(1),"^")),1:"Not on file")
"RTN","ALPBFRM1",56,0)
 S RESULTS(4)=$$PAD^ALPBUTL(RESULTS(4),25)_$S($P($G(DATA(1)),"^",2)'="":$$FMTE^XLFDT($P(DATA(1),"^",2)),1:"Not on file")
"RTN","ALPBFRM1",57,0)
 ;
"RTN","ALPBFRM1",58,0)
 ; end of fixed line format, continue...
"RTN","ALPBFRM1",59,0)
 S LINE=4
"RTN","ALPBFRM1",60,0)
 ; get drug(s)...
"RTN","ALPBFRM1",61,0)
 I +$O(DATA(7,0)) D
"RTN","ALPBFRM1",62,0)
 .S LINE=LINE+1
"RTN","ALPBFRM1",63,0)
 .S RESULTS(LINE)=""
"RTN","ALPBFRM1",64,0)
 .S ALPBX=0
"RTN","ALPBFRM1",65,0)
 .F  S ALPBX=$O(DATA(7,ALPBX)) Q:'ALPBX  D
"RTN","ALPBFRM1",66,0)
 ..S ALPBDRUG=$G(BOLDON)_$P(DATA(7,ALPBX,0),"^",2)_$G(BOLDOFF)
"RTN","ALPBFRM1",67,0)
 ..;S RESULTS(LINE)=$G(RESULTS(LINE))_$P(DATA(7,ALPBX,0),"^",2)
"RTN","ALPBFRM1",68,0)
 ..S RESULTS(LINE)=$G(RESULTS(LINE))_ALPBDRUG
"RTN","ALPBFRM1",69,0)
 ..K ALPBDRUG
"RTN","ALPBFRM1",70,0)
 ..I +$O(DATA(7,ALPBX)) S LINE=LINE+1
"RTN","ALPBFRM1",71,0)
 ; any additives...
"RTN","ALPBFRM1",72,0)
 I +$O(DATA(8,0)) D
"RTN","ALPBFRM1",73,0)
 .S LINE=LINE+1
"RTN","ALPBFRM1",74,0)
 .S RESULTS(LINE)=" Additive(s): "
"RTN","ALPBFRM1",75,0)
 .S ALPBX=0
"RTN","ALPBFRM1",76,0)
 .F  S ALPBX=$O(DATA(8,ALPBX)) Q:'ALPBX  D
"RTN","ALPBFRM1",77,0)
 ..S ALPBDRUG=$P(DATA(8,ALPBX,0),"^",2)
"RTN","ALPBFRM1",78,0)
 ..; if UNITS is not already contained in ADDITIVE NAME, add it...
"RTN","ALPBFRM1",79,0)
 ..I $P(DATA(8,ALPBX,0),"^",3)'=""&(ALPBDRUG'[$P(DATA(8,ALPBX,0),"^",3)) S ALPBDRUG=ALPBDRUG_" "_$P(DATA(8,ALPBX,0),"^",3)
"RTN","ALPBFRM1",80,0)
 ..S ALPBDRUG=$G(BOLDON)_ALPBDRUG_$G(BOLDOFF)
"RTN","ALPBFRM1",81,0)
 ..S RESULTS(LINE)=RESULTS(LINE)_ALPBDRUG
"RTN","ALPBFRM1",82,0)
 ..K ALPBDRUG
"RTN","ALPBFRM1",83,0)
 ..I +$O(DATA(8,ALPBX)) D
"RTN","ALPBFRM1",84,0)
 ...S LINE=LINE+1
"RTN","ALPBFRM1",85,0)
 ...S RESULTS(LINE)=" "
"RTN","ALPBFRM1",86,0)
 ...S RESULTS(LINE)=$$PAD^ALPBUTL(RESULTS(LINE),14)
"RTN","ALPBFRM1",87,0)
 .K ALPBX
"RTN","ALPBFRM1",88,0)
 ; any solutions...
"RTN","ALPBFRM1",89,0)
 I +$O(DATA(9,0)) D
"RTN","ALPBFRM1",90,0)
 .S LINE=LINE+1
"RTN","ALPBFRM1",91,0)
 .S RESULTS(LINE)=" Solution(s): "
"RTN","ALPBFRM1",92,0)
 .S ALPBX=0
"RTN","ALPBFRM1",93,0)
 .F  S ALPBX=$O(DATA(9,ALPBX)) Q:'ALPBX  D
"RTN","ALPBFRM1",94,0)
 ..S ALPBDRUG=$P(DATA(9,ALPBX,0),"^",2)
"RTN","ALPBFRM1",95,0)
 ..; if UNITS is not already contained in SOLUTION NAME, add it...
"RTN","ALPBFRM1",96,0)
 ..I $P(DATA(9,ALPBX,0),"^",3)'=""&(ALPBDRUG'[$P(DATA(9,ALPBX,0),"^",3)) S ALPBDRUG=ALPBDRUG_" "_$P(DATA(9,ALPBX,0),"^",3)
"RTN","ALPBFRM1",97,0)
 ..S ALPBDRUG=$G(BOLDON)_ALPBDRUG_$G(BOLDOFF)
"RTN","ALPBFRM1",98,0)
 ..S RESULTS(LINE)=RESULTS(LINE)_ALPBDRUG
"RTN","ALPBFRM1",99,0)
 ..K ALPBDRUG
"RTN","ALPBFRM1",100,0)
 ..I +$O(DATA(9,ALPBX)) D
"RTN","ALPBFRM1",101,0)
 ...S LINE=LINE+1
"RTN","ALPBFRM1",102,0)
 ...S RESULTS(LINE)=" "
"RTN","ALPBFRM1",103,0)
 ...S RESULTS(LINE)=$$PAD^ALPBUTL(RESULTS(LINE),14)
"RTN","ALPBFRM1",104,0)
 .K ALPBX
"RTN","ALPBFRM1",105,0)
 ; give ($P(DATA(4),"^",1)=DOSAGE  $P(DATA(4),"^",2)=ROUTE  $P(DATA(4),"^",3)=SCHEDULE)...
"RTN","ALPBFRM1",106,0)
 S LINE=LINE+1
"RTN","ALPBFRM1",107,0)
 S RESULTS(LINE)="        Give: "_$P($G(DATA(4)),"^")_" "_$P($G(DATA(4)),"^",2)_" "_$P($G(DATA(4)),"^",3)
"RTN","ALPBFRM1",108,0)
 ;Set PRN Flag
"RTN","ALPBFRM1",109,0)
 S ALPBPRNG=0
"RTN","ALPBFRM1",110,0)
 S:$P($G(DATA(4)),"^",3)["PRN" ALPBPRNG=1
"RTN","ALPBFRM1",111,0)
 ;
"RTN","ALPBFRM1",112,0)
 ; provider comments, special instructions, and other print info...
"RTN","ALPBFRM1",113,0)
 I +$O(DATA(5,0)) D
"RTN","ALPBFRM1",114,0)
 .K ALPBCMNT
"RTN","ALPBFRM1",115,0)
 .M ALPBCMNT=DATA(5)
"RTN","ALPBFRM1",116,0)
 .S ALPBCOL=60
"RTN","ALPBFRM1",117,0)
 .D FTEXT^ALPBFRMU(ALPBCOL,.ALPBCMNT,.ALPBTEXT)
"RTN","ALPBFRM1",118,0)
 .K ALPBCMNT
"RTN","ALPBFRM1",119,0)
 .S ALPBX=0
"RTN","ALPBFRM1",120,0)
 .F  S ALPBX=$O(ALPBTEXT(ALPBX)) Q:'ALPBX  D
"RTN","ALPBFRM1",121,0)
 ..S ALPBLINE=ALPBTEXT(ALPBX,0)
"RTN","ALPBFRM1",122,0)
 ..S LINE=LINE+1
"RTN","ALPBFRM1",123,0)
 ..S RESULTS(LINE)=ALPBLINE
"RTN","ALPBFRM1",124,0)
 .K ALPBCOL,ALPBLINE,ALPBTEXT,ALPBX
"RTN","ALPBFRM1",125,0)
 ;S LINE=LINE+1,RESULTS(LINE)=""
"RTN","ALPBFRM1",126,0)
 ;
"RTN","ALPBFRM1",127,0)
 ; provider, pharmacist or entry person, and verifier...
"RTN","ALPBFRM1",128,0)
 S LINE=LINE+1
"RTN","ALPBFRM1",129,0)
 S RESULTS(LINE)="    Provider: "_$P($G(DATA(2)),"^")
"RTN","ALPBFRM1",130,0)
 S LINE=LINE+1
"RTN","ALPBFRM1",131,0)
 S RESULTS(LINE)="RPh/Entry by: "_$P($G(DATA(2)),"^",2)
"RTN","ALPBFRM1",132,0)
 I $P($G(DATA(2)),"^",3)'="" D
"RTN","ALPBFRM1",133,0)
 .S LINE=LINE+1
"RTN","ALPBFRM1",134,0)
 .S RESULTS(LINE)=" Verified by: "_$P(DATA(2),"^",3)
"RTN","ALPBFRM1",135,0)
 ; order number and type...
"RTN","ALPBFRM1",136,0)
 S LINE=LINE+1
"RTN","ALPBFRM1",137,0)
 S RESULTS(LINE)="     Order #: "_$P(DATA(0),"^")
"RTN","ALPBFRM1",138,0)
 S RESULTS(LINE)=$$PAD^ALPBUTL(RESULTS(LINE),25)_"Type: "_$$OTYP^ALPBUTL($P($G(DATA(3)),"^"))
"RTN","ALPBFRM1",139,0)
 ; order status...
"RTN","ALPBFRM1",140,0)
 S LINE=LINE+1
"RTN","ALPBFRM1",141,0)
 S RESULTS(LINE)="      Status: "_$P($P(DATA(0),"^",3),"~",2)
"RTN","ALPBFRM1",142,0)
 ;
"RTN","ALPBFRM1",143,0)
 ; med log data...
"RTN","ALPBFRM1",144,0)
 S LINE=LINE+1
"RTN","ALPBFRM1",145,0)
 S RESULTS(LINE)="BCMA MEDICATION LOG HISTORY"
"RTN","ALPBFRM1",146,0)
 ;I $G(MLDATE)'="" S RESULTS(LINE)=RESULTS(LINE)_" (since "_$$FMTE^XLFDT(MLDATE)_")"
"RTN","ALPBFRM1",147,0)
 I +$O(DATA(10,0))=0 D
"RTN","ALPBFRM1",148,0)
 .S LINE=LINE+1
"RTN","ALPBFRM1",149,0)
 .S RESULTS(LINE)=" No Medication Log entries are on file for this order."
"RTN","ALPBFRM1",150,0)
 I +$O(DATA(10,0)) D
"RTN","ALPBFRM1",151,0)
 .S LINE=LINE+1
"RTN","ALPBFRM1",152,0)
 .S RESULTS(LINE)=" Log Date"
"RTN","ALPBFRM1",153,0)
 .S RESULTS(LINE)=$$PAD^ALPBUTL(RESULTS(LINE),16)_"Message"
"RTN","ALPBFRM1",154,0)
 .S RESULTS(LINE)=$$PAD^ALPBUTL(RESULTS(LINE),31)_"Log Entry Person"
"RTN","ALPBFRM1",155,0)
 .I $O(DATA(10,"IMLOG",0))="" D
"RTN","ALPBFRM1",156,0)
 ..S LINE=LINE+1
"RTN","ALPBFRM1",157,0)
 ..S RESULTS(LINE)=" No entries since the above date are on file."
"RTN","ALPBFRM1",158,0)
 .;S ALPBMDT=MLDATE
"RTN","ALPBFRM1",159,0)
 .S ALPBMDT=0,ALPBMLC=1
"RTN","ALPBFRM1",160,0)
 .F  S ALPBMDT=$O(DATA(10,"IMLOG",ALPBMDT)) Q:'ALPBMDT!(ALPBMLC>MLCNT)  D
"RTN","ALPBFRM1",161,0)
 ..S ALPBX=0
"RTN","ALPBFRM1",162,0)
 ..F  S ALPBX=$O(DATA(10,"IMLOG",ALPBMDT,ALPBX)) Q:'ALPBX!(ALPBMLC>MLCNT)  D
"RTN","ALPBFRM1",163,0)
 ...S LINE=LINE+1,ALPBMLC=ALPBMLC+1
"RTN","ALPBFRM1",164,0)
 ...S RESULTS(LINE)=" "_$$FDATE^ALPBUTL($P(DATA(10,ALPBX,0),"^",1))
"RTN","ALPBFRM1",165,0)
 ...S RESULTS(LINE)=$$PAD^ALPBUTL(RESULTS(LINE),16)_$P(DATA(10,ALPBX,0),"^",3)
"RTN","ALPBFRM1",166,0)
 ...S RESULTS(LINE)=$$PAD^ALPBUTL(RESULTS(LINE),31)_$S($P(DATA(10,ALPBX,0),"^",2)'="":$P(DATA(10,ALPBX,0),"^",2),1:"<not on file")
"RTN","ALPBFRM1",167,0)
 ..K ALPBX
"RTN","ALPBFRM1",168,0)
 .K ALPBMDT,ALPBMLC
"RTN","ALPBFRM1",169,0)
 ;
"RTN","ALPBFRM1",170,0)
 ; BCMA LAST ACTION
"RTN","ALPBFRM1",171,0)
 I +$G(ALPPAT)>0 D
"RTN","ALPBFRM1",172,0)
 .S ALPBX=0
"RTN","ALPBFRM1",173,0)
 .F  S ALPBX=$O(DATA(7,ALPBX)) Q:'ALPBX  D
"RTN","ALPBFRM1",174,0)
 ..S ALPDRUG=$P(DATA(7,ALPBX,0),"^",1),ALPBDNM=$P(DATA(7,ALPBX,0),"^",2)
"RTN","ALPBFRM1",175,0)
 ..Q:+ALPDRUG'>0
"RTN","ALPBFRM1",176,0)
 ..S ALPLACT=$$LACT^ALPBUTL3(ALPPAT,ALPDRUG)
"RTN","ALPBFRM1",177,0)
 ..I ALPLACT'="" D
"RTN","ALPBFRM1",178,0)
 ...S LINE=LINE+1,RESULTS(LINE)=$$REPEAT^XLFSTR("-",75)
"RTN","ALPBFRM1",179,0)
 ...S LINE=LINE+1
"RTN","ALPBFRM1",180,0)
 ...S RESULTS(LINE)="Last action for "_ALPBDNM_"  "_" was "_$P(ALPLACT,"^",3)_" on "_$$FDATE^ALPBUTL($P(ALPLACT,"^",1))
"RTN","ALPBFRM1",181,0)
 ...S RESULTS(LINE)=RESULTS(LINE)_" By "_$S($P(ALPLACT,"^",2)'="":$P(ALPLACT,"^",2),1:"<not on file>")
"RTN","ALPBFRM1",182,0)
 K ALPLACT,ALPDRUG,ALPBX
"RTN","ALPBFRM1",183,0)
 ;
"RTN","ALPBFRM1",184,0)
 I LINE<11 F I=1:1 Q:LINE=11  D
"RTN","ALPBFRM1",185,0)
 .S LINE=LINE+1
"RTN","ALPBFRM1",186,0)
 .S RESULTS(LINE)=""
"RTN","ALPBFRM1",187,0)
 ;
"RTN","ALPBFRM1",188,0)
 ; now add admin times and initial boxes to lines 4-10 as required
"RTN","ALPBFRM1",189,0)
 ; by number of administration times...
"RTN","ALPBFRM1",190,0)
 S ALPBIBOX="______|"
"RTN","ALPBFRM1",191,0)
 S ALPBNBOX="******|"
"RTN","ALPBFRM1",192,0)
 I +$G(ALPBADM)=0 S ALPBADM=8
"RTN","ALPBFRM1",193,0)
 ;S ALPBPRN=ALPBADM+4
"RTN","ALPBFRM1",194,0)
 S ALPBTSTART=$P($G(DATA(1)),"^",1)
"RTN","ALPBFRM1",195,0)
 S ALPBSTOP=$P($G(DATA(1)),"^",2)
"RTN","ALPBFRM1",196,0)
 F I=1:1:ALPBADM D
"RTN","ALPBFRM1",197,0)
 .S ALPBPRN=I+3
"RTN","ALPBFRM1",198,0)
 .S ALPBADMT=$G(ALPBADM(I))
"RTN","ALPBFRM1",199,0)
 .I ALPBADMT="" S ALPBADMT="    "
"RTN","ALPBFRM1",200,0)
 .I '$D(RESULTS(I+3)) D
"RTN","ALPBFRM1",201,0)
 ..S RESULTS(I+3)=" "
"RTN","ALPBFRM1",202,0)
 ..S LINE=LINE+1
"RTN","ALPBFRM1",203,0)
 .S RESULTS(I+3)=$$PAD^ALPBUTL(RESULTS(I+3),65)_"| "
"RTN","ALPBFRM1",204,0)
 .S RESULTS(I+3)=RESULTS(I+3)_$S($L(ALPBADMT)=2:ALPBADMT_"00",1:ALPBADMT)
"RTN","ALPBFRM1",205,0)
 .S RESULTS(I+3)=$$PAD^ALPBUTL(RESULTS(I+3),74)_"|"
"RTN","ALPBFRM1",206,0)
 .F J=1:1:DAYS D
"RTN","ALPBFRM1",207,0)
 ..S ALPBDAY=ALPBDAYS(J)_"."_ALPBADMT
"RTN","ALPBFRM1",208,0)
 ..S ALPBPBOX=ALPBIBOX
"RTN","ALPBFRM1",209,0)
 ..;prints asterisks in boxes if start date is in the future
"RTN","ALPBFRM1",210,0)
 ..;and if the stop date has already expired
"RTN","ALPBFRM1",211,0)
 ..I ALPBDAY<ALPBTSTART S ALPBPBOX=ALPBNBOX
"RTN","ALPBFRM1",212,0)
 ..I ALPBDAY>ALPBSTOP S ALPBPBOX=ALPBNBOX
"RTN","ALPBFRM1",213,0)
 ..;I ALPBDAY=ALPBSTOP!(ALPBDAY>ALPBSTOP) S ALPBPBOX=ALPBNBOX
"RTN","ALPBFRM1",214,0)
 ..S RESULTS(I+3)=RESULTS(I+3)_ALPBPBOX
"RTN","ALPBFRM1",215,0)
 .K ALPBADMT,ALPBPBOX,ALPBDAY
"RTN","ALPBFRM1",216,0)
 K ALPBIBOX,ALPBNBOX
"RTN","ALPBFRM1",217,0)
 ; if PRN med, add line for documenting effectiveness...
"RTN","ALPBFRM1",218,0)
 I +ALPBPRNG D
"RTN","ALPBFRM1",219,0)
 .S ALPBFLG=0,ALPBPRN=ALPBPRN+1
"RTN","ALPBFRM1",220,0)
 .S:'$D(RESULTS(ALPBPRN)) RESULTS(ALPBPRN)=" ",ALPBFLG=1
"RTN","ALPBFRM1",221,0)
 .S RESULTS(ALPBPRN)=$$PAD^ALPBUTL(RESULTS(ALPBPRN),63)_"  PRN Effectiveness:_____________"
"RTN","ALPBFRM1",222,0)
 .S:ALPBFLG LINE=LINE+1
"RTN","ALPBFRM1",223,0)
 S LINE=LINE+1
"RTN","ALPBFRM1",224,0)
 S RESULTS(LINE)=$$REPEAT^XLFSTR("-",132)
"RTN","ALPBFRM1",225,0)
 S RESULTS(0)=LINE
"RTN","ALPBFRM1",226,0)
 Q
"RTN","ALPBPALL")
0^2^B26374660
"RTN","ALPBPALL",1,0)
ALPBPALL ;OIFO-DALLAS MW,SED,KC-PRINT 3-DAY MAR BCMA BACLUP REPORT FOR ALL WARDS ;01/01/03
"RTN","ALPBPALL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**8,29,48**;Mar 2004;Build 9
"RTN","ALPBPALL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ALPBPALL",4,0)
 ;
"RTN","ALPBPALL",5,0)
 ; based on original code by FD@NJHCS, May 2002
"RTN","ALPBPALL",6,0)
 ; 
"RTN","ALPBPALL",7,0)
 W !,"Inpatient Pharmacy Orders for all wards"
"RTN","ALPBPALL",8,0)
 ;
"RTN","ALPBPALL",9,0)
 ; get all or just current orders?...
"RTN","ALPBPALL",10,0)
 S DIR(0)="SA^A:ALL;C:CURRENT"
"RTN","ALPBPALL",11,0)
 S DIR("A")="Report [A]LL or [C]URRENT orders? "
"RTN","ALPBPALL",12,0)
 S DIR("B")="CURRENT"
"RTN","ALPBPALL",13,0)
 S DIR("?")="[A]LL=all orders in the file, [C]URRENT=orders not yet expired."
"RTN","ALPBPALL",14,0)
 W ! D ^DIR K DIR
"RTN","ALPBPALL",15,0)
 I $D(DIRUT) K DIRUT,DTOUT,X,Y Q
"RTN","ALPBPALL",16,0)
 S ALPBOTYP=Y
"RTN","ALPBPALL",17,0)
 ;
"RTN","ALPBPALL",18,0)
 ; print how many days MAR?...
"RTN","ALPBPALL",19,0)
 S DIR(0)="NA^1:7"
"RTN","ALPBPALL",20,0)
 S DIR("A")="Print how many days MAR? "
"RTN","ALPBPALL",21,0)
 S DIR("B")=$$DEFDAYS^ALPBUTL()
"RTN","ALPBPALL",22,0)
 S DIR("?")="The default is shown; please select a number 1 to 7."
"RTN","ALPBPALL",23,0)
 W ! D ^DIR K DIR
"RTN","ALPBPALL",24,0)
 I $D(DIRUT) K ALPBOTYP,DIRUT,DTOUT,X,Y Q
"RTN","ALPBPALL",25,0)
 S ALPBDAYS=+Y
"RTN","ALPBPALL",26,0)
 ;
"RTN","ALPBPALL",27,0)
 ; BCMA Med Log info for how many ?...
"RTN","ALPBPALL",28,0)
 S DIR(0)="NA^1:99"
"RTN","ALPBPALL",29,0)
 S DIR("B")=$$DEFML^ALPBUTL3()
"RTN","ALPBPALL",30,0)
 S DIR("A")="Select how many BCMA Medication Log history: "
"RTN","ALPBPALL",31,0)
 S DIR("A",1)=" "
"RTN","ALPBPALL",32,0)
 S DIR("?",1)="Select a number of BCMA Medication log entries"
"RTN","ALPBPALL",33,0)
 S DIR("?",2)="for each of the patient's orders"
"RTN","ALPBPALL",34,0)
 S DIR("?")="They are listed by the most current entry first"
"RTN","ALPBPALL",35,0)
 D ^DIR K DIR
"RTN","ALPBPALL",36,0)
 I $D(DIRUT) K ALPBOTYP,ALPBWARD,DIRUT,DTOUT,X,Y Q
"RTN","ALPBPALL",37,0)
 S ALPBMLOG=Y
"RTN","ALPBPALL",38,0)
 ;
"RTN","ALPBPALL",39,0)
 S %ZIS="Q"
"RTN","ALPBPALL",40,0)
 S %ZIS("B")=$$DEFPRT^ALPBUTL()
"RTN","ALPBPALL",41,0)
 I %ZIS("B")="" K %ZIS("B")
"RTN","ALPBPALL",42,0)
 W ! D ^%ZIS K %ZIS
"RTN","ALPBPALL",43,0)
 I POP K POP Q
"RTN","ALPBPALL",44,0)
 ;
"RTN","ALPBPALL",45,0)
 ; output not queued...
"RTN","ALPBPALL",46,0)
 I '$D(IO("Q")) D
"RTN","ALPBPALL",47,0)
 .U IO
"RTN","ALPBPALL",48,0)
 .D DQ
"RTN","ALPBPALL",49,0)
 .I IO'=IO(0) D ^%ZISC
"RTN","ALPBPALL",50,0)
 ;
"RTN","ALPBPALL",51,0)
 ; set up the task...
"RTN","ALPBPALL",52,0)
 I $D(IO("Q")) D
"RTN","ALPBPALL",53,0)
 .S ZTRTN="DQ^ALPBPALL"
"RTN","ALPBPALL",54,0)
 .S ZTDESC="PSB INPT PHARM ORDER FOR ALL WARDS"
"RTN","ALPBPALL",55,0)
 .S ZTIO=ION
"RTN","ALPBPALL",56,0)
 .S ZTSAVE("ALPBMLOG")=""
"RTN","ALPBPALL",57,0)
 .S ZTSAVE("ALPBOTYP")=""
"RTN","ALPBPALL",58,0)
 .S ZTSAVE("ALPBDAYS")=""
"RTN","ALPBPALL",59,0)
 .D ^%ZTLOAD
"RTN","ALPBPALL",60,0)
 .D HOME^%ZIS
"RTN","ALPBPALL",61,0)
 .W !,$S($G(ZTSK):"Task number "_ZTSK_" queued.",1:"ERROR -- NOT QUEUED!")
"RTN","ALPBPALL",62,0)
 .K IO("Q"),ZTSK
"RTN","ALPBPALL",63,0)
 K ALPBDAYS,ALPBMLOG,ALPBOTYP
"RTN","ALPBPALL",64,0)
 Q
"RTN","ALPBPALL",65,0)
 ;
"RTN","ALPBPALL",66,0)
DQ ; output entry point...
"RTN","ALPBPALL",67,0)
 K ^TMP($J)
"RTN","ALPBPALL",68,0)
 ;
"RTN","ALPBPALL",69,0)
 ; set report date...MOD 11/03/03 SED
"RTN","ALPBPALL",70,0)
 S ALPBRDAT=$S(ALPBOTYP="C":$$NOW^XLFDT(),1:"")
"RTN","ALPBPALL",71,0)
 ;
"RTN","ALPBPALL",72,0)
 ; loop through ward cross reference in 53.7...
"RTN","ALPBPALL",73,0)
 S ALPBWARD=""
"RTN","ALPBPALL",74,0)
 F  S ALPBWARD=$O(^ALPB(53.7,"AW",ALPBWARD)) Q:ALPBWARD=""  D
"RTN","ALPBPALL",75,0)
 .S ALPBPTN=""
"RTN","ALPBPALL",76,0)
 .F  S ALPBPTN=$O(^ALPB(53.7,"AW",ALPBWARD,ALPBPTN)) Q:ALPBPTN=""  D
"RTN","ALPBPALL",77,0)
 ..S ALPBIEN=0
"RTN","ALPBPALL",78,0)
 ..F  S ALPBIEN=$O(^ALPB(53.7,"AW",ALPBWARD,ALPBPTN,ALPBIEN)) Q:'ALPBIEN  D
"RTN","ALPBPALL",79,0)
 ...D ORDS^ALPBUTL(ALPBIEN,ALPBRDAT,.ALPBORDS)
"RTN","ALPBPALL",80,0)
 ...I +ALPBORDS(0)'>0 K ALPBORDS Q
"RTN","ALPBPALL",81,0)
 ...S ALPBOIEN=0
"RTN","ALPBPALL",82,0)
 ...F  S ALPBOIEN=$O(ALPBORDS(ALPBOIEN)) Q:'ALPBOIEN  D
"RTN","ALPBPALL",83,0)
 ....S ALPBDATA=$G(^ALPB(53.7,ALPBIEN,2,ALPBOIEN,1))
"RTN","ALPBPALL",84,0)
 ....I ALPBOTYP="C"&($P(ALPBDATA,U,2)<ALPBRDAT) K ALPBDATA Q
"RTN","ALPBPALL",85,0)
 ....S ALPBOCT=$P($G(^ALPB(53.7,ALPBIEN,2,ALPBOIEN,3)),U,1)
"RTN","ALPBPALL",86,0)
 ....S:$P($G(^ALPB(53.7,ALPBIEN,2,ALPBOIEN,4)),U,3)["PRN" ALPBOCT=ALPBOCT_"P"
"RTN","ALPBPALL",87,0)
 ....S ALPBORDN=ALPBORDS(ALPBOIEN)
"RTN","ALPBPALL",88,0)
 ....S ALPBOST=$$STAT2^ALPBUTL1(ALPBORDS(ALPBOIEN,2))
"RTN","ALPBPALL",89,0)
 ....I '$D(^TMP($J,ALPBWARD,ALPBPTN)) S ^TMP($J,ALPBWARD,ALPBPTN)=ALPBIEN
"RTN","ALPBPALL",90,0)
 ....S ^TMP($J,ALPBWARD,ALPBPTN,ALPBOCT,ALPBOST,ALPBORDN)=ALPBOIEN
"RTN","ALPBPALL",91,0)
 ....K ALPBDATA,ALPBORDN,ALPBOST,ALPBOCT
"RTN","ALPBPALL",92,0)
 ...K ALPBOIEN,ALPBORDS
"RTN","ALPBPALL",93,0)
 ..K ALPBIEN
"RTN","ALPBPALL",94,0)
 .K ALPBPTN
"RTN","ALPBPALL",95,0)
 K ALPBWARD
"RTN","ALPBPALL",96,0)
 ;
"RTN","ALPBPALL",97,0)
 ; process through our sorted list...
"RTN","ALPBPALL",98,0)
 S ALPBPG=0
"RTN","ALPBPALL",99,0)
 S ALPBWARD=""
"RTN","ALPBPALL",100,0)
 F  S ALPBWARD=$O(^TMP($J,ALPBWARD)) Q:ALPBWARD=""  D
"RTN","ALPBPALL",101,0)
 .S ALPBPTN=""
"RTN","ALPBPALL",102,0)
 .F  S ALPBPTN=$O(^TMP($J,ALPBWARD,ALPBPTN)) Q:ALPBPTN=""  D
"RTN","ALPBPALL",103,0)
 ..S ALPBIEN=+^TMP($J,ALPBWARD,ALPBPTN)
"RTN","ALPBPALL",104,0)
 ..S ALPBPDAT(0)=$G(^ALPB(53.7,ALPBIEN,0))
"RTN","ALPBPALL",105,0)
 ..M ALPBPDAT(1)=^ALPB(53.7,ALPBIEN,1)
"RTN","ALPBPALL",106,0)
 ..; paginate between patients...
"RTN","ALPBPALL",107,0)
 ..I ALPBPG=0 D PAGE
"RTN","ALPBPALL",108,0)
 ..S ALPBOCT=""
"RTN","ALPBPALL",109,0)
 ..F  S ALPBOCT=$O(^TMP($J,ALPBWARD,ALPBPTN,ALPBOCT)) Q:ALPBOCT=""  D
"RTN","ALPBPALL",110,0)
 ...S ALPBOST=""
"RTN","ALPBPALL",111,0)
 ...F  S ALPBOST=$O(^TMP($J,ALPBWARD,ALPBPTN,ALPBOCT,ALPBOST)) Q:ALPBOST=""  D
"RTN","ALPBPALL",112,0)
 ....S ALPBORDN=""
"RTN","ALPBPALL",113,0)
 ....F  S ALPBORDN=$O(^TMP($J,ALPBWARD,ALPBPTN,ALPBOCT,ALPBOST,ALPBORDN)) Q:ALPBORDN=""  D
"RTN","ALPBPALL",114,0)
 .....S ALPBOIEN=^TMP($J,ALPBWARD,ALPBPTN,ALPBOCT,ALPBOST,ALPBORDN)
"RTN","ALPBPALL",115,0)
 .....; get and print this order's data...
"RTN","ALPBPALL",116,0)
 .....M ALPBDATA=^ALPB(53.7,ALPBIEN,2,ALPBOIEN)
"RTN","ALPBPALL",117,0)
 .....D F132^ALPBFRM1(.ALPBDATA,ALPBDAYS,ALPBMLOG,.ALPBFORM,ALPBIEN)
"RTN","ALPBPALL",118,0)
 .....I $Y+ALPBFORM(0)>IOSL D PAGE
"RTN","ALPBPALL",119,0)
 .....S ALPBX=0
"RTN","ALPBPALL",120,0)
 .....F  S ALPBX=$O(ALPBFORM(ALPBX)) Q:'ALPBX  W !,ALPBFORM(ALPBX)
"RTN","ALPBPALL",121,0)
 .....K ALPBDATA,ALPBFORM,ALPBOIEN,ALPBX
"RTN","ALPBPALL",122,0)
 ....K ALPBORDN
"RTN","ALPBPALL",123,0)
 ...K ALPBOST
"RTN","ALPBPALL",124,0)
 ..K ALPBIEN,ALPBPDAT,ALPBOCT
"RTN","ALPBPALL",125,0)
 ..S ALPBPG=0
"RTN","ALPBPALL",126,0)
    ..; print footer at end of this patient's record...
"RTN","ALPBPALL",127,0)
 ..D FOOT^ALPBFRMU
"RTN","ALPBPALL",128,0)
 ..;Print a blank page between patients
"RTN","ALPBPALL",129,0)
 ..W @IOF
"RTN","ALPBPALL",130,0)
 .K ALPBPTN
"RTN","ALPBPALL",131,0)
 ;
"RTN","ALPBPALL",132,0)
 K ALPBDAYS,ALPBMLOG,ALPBOTYP,ALPBPG,ALPBRDAT,ALPBWARD,^TMP($J)
"RTN","ALPBPALL",133,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ALPBPALL",134,0)
 Q
"RTN","ALPBPALL",135,0)
 ;
"RTN","ALPBPALL",136,0)
PAGE ; paginate and print header for a patient...
"RTN","ALPBPALL",137,0)
 W @IOF
"RTN","ALPBPALL",138,0)
 ; increment page count...
"RTN","ALPBPALL",139,0)
 S ALPBPG=ALPBPG+1
"RTN","ALPBPALL",140,0)
 D HDR^ALPBFRMU(.ALPBPDAT,ALPBPG,.ALPBHDR)
"RTN","ALPBPALL",141,0)
 S ALPBX=0
"RTN","ALPBPALL",142,0)
 F  S ALPBX=$O(ALPBHDR(ALPBX)) Q:'ALPBX  W !,ALPBHDR(ALPBX)
"RTN","ALPBPALL",143,0)
 K ALPBHDR,ALPBX
"RTN","ALPBPALL",144,0)
 Q
"RTN","ALPBPPAT")
0^1^B22283739
"RTN","ALPBPPAT",1,0)
ALPBPPAT ;OIFO-DALLAS MW,SED,KC-PRINT 3-DAY MAR BCBU BACKUP REPORT FOR A SELECTED PATIENT ;01/01/03
"RTN","ALPBPPAT",2,0)
 ;;3.0;BAR CODE MED ADMIN;**8,48**;Mar 2004;Build 9
"RTN","ALPBPPAT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ALPBPPAT",4,0)
 ; 
"RTN","ALPBPPAT",5,0)
 ; NOTE: this routine is designed for hard-copy output. 
"RTN","ALPBPPAT",6,0)
 ;  Output is formatted for 132-column printing.
"RTN","ALPBPPAT",7,0)
 ;
"RTN","ALPBPPAT",8,0)
 F  D  Q:$D(DIRUT)
"RTN","ALPBPPAT",9,0)
 .W !!,"Inpatient Pharmacy Orders for a selected patient"
"RTN","ALPBPPAT",10,0)
 .S DIR(0)="PAO^53.7:QEMZ"
"RTN","ALPBPPAT",11,0)
 .S DIR("A")="Select PATIENT NAME: "
"RTN","ALPBPPAT",12,0)
 .D ^DIR K DIR
"RTN","ALPBPPAT",13,0)
 .I $D(DIRUT) K X,Y Q
"RTN","ALPBPPAT",14,0)
 .S ALPBIEN=+Y
"RTN","ALPBPPAT",15,0)
 .S ALPBPTN=Y(0,0)
"RTN","ALPBPPAT",16,0)
 .; get all or just current orders?...
"RTN","ALPBPPAT",17,0)
 .S DIR(0)="SA^A:ALL;C:CURRENT"
"RTN","ALPBPPAT",18,0)
 .S DIR("A")="Report [A]LL or [C]URRENT orders? "
"RTN","ALPBPPAT",19,0)
 .S DIR("B")="CURRENT"
"RTN","ALPBPPAT",20,0)
 .S DIR("?")="[A]LL=all orders in the file, [C]URRENT=orders not yet expired."
"RTN","ALPBPPAT",21,0)
 .W ! D ^DIR K DIR
"RTN","ALPBPPAT",22,0)
 .I $D(DIRUT) K DIRUT,DTOUT,X,Y Q
"RTN","ALPBPPAT",23,0)
 .S ALPBOTYP=Y
"RTN","ALPBPPAT",24,0)
 .;
"RTN","ALPBPPAT",25,0)
 .; print how many days MAR?...
"RTN","ALPBPPAT",26,0)
 .S DIR(0)="NA^1:7"
"RTN","ALPBPPAT",27,0)
 .S DIR("A")="Print how many days MAR? "
"RTN","ALPBPPAT",28,0)
 .S DIR("B")=$$DEFDAYS^ALPBUTL()
"RTN","ALPBPPAT",29,0)
 .S DIR("?")="The default is shown; please select a number 1 to 7."
"RTN","ALPBPPAT",30,0)
 .W ! D ^DIR K DIR
"RTN","ALPBPPAT",31,0)
 .I $D(DIRUT) K ALPBOTYP,DIRUT,DTOUT,X,Y Q
"RTN","ALPBPPAT",32,0)
 .S ALPBDAYS=+Y
"RTN","ALPBPPAT",33,0)
 .;
"RTN","ALPBPPAT",34,0)
 .; BCMA Med Log info for how many ?...
"RTN","ALPBPPAT",35,0)
 .S DIR(0)="NA^1:99"
"RTN","ALPBPPAT",36,0)
 .S DIR("B")=$$DEFML^ALPBUTL3()
"RTN","ALPBPPAT",37,0)
 .S DIR("A")="Select how many BCMA Medication Log history: "
"RTN","ALPBPPAT",38,0)
 .S DIR("A",1)=" "
"RTN","ALPBPPAT",39,0)
 .S DIR("?",1)="Select a number of BCMA Medication log entries"
"RTN","ALPBPPAT",40,0)
 .S DIR("?",2)="for each of the patient's orders"
"RTN","ALPBPPAT",41,0)
 .S DIR("?")="They are listed by the most current entry first"
"RTN","ALPBPPAT",42,0)
 .D ^DIR K DIR
"RTN","ALPBPPAT",43,0)
 .I $D(DIRUT) K ALPBOTYP,ALPBWARD,DIRUT,DTOUT,X,Y Q
"RTN","ALPBPPAT",44,0)
 .S ALPBMLOG=Y
"RTN","ALPBPPAT",45,0)
 .;
"RTN","ALPBPPAT",46,0)
 .S %ZIS="Q"
"RTN","ALPBPPAT",47,0)
 .S %ZIS("B")=$$DEFPRT^ALPBUTL()
"RTN","ALPBPPAT",48,0)
 .I %ZIS("B")="" K %ZIS("B")
"RTN","ALPBPPAT",49,0)
 .W ! D ^%ZIS K %ZIS
"RTN","ALPBPPAT",50,0)
 .I POP D  Q
"RTN","ALPBPPAT",51,0)
 ..K ALPBIEN,ALPBPTN,POP
"RTN","ALPBPPAT",52,0)
 .;
"RTN","ALPBPPAT",53,0)
 .; output not queued...
"RTN","ALPBPPAT",54,0)
 .I '$D(IO("Q")) D
"RTN","ALPBPPAT",55,0)
 ..U IO
"RTN","ALPBPPAT",56,0)
 ..D DQ
"RTN","ALPBPPAT",57,0)
 ..I IO'=IO(0) D ^%ZISC
"RTN","ALPBPPAT",58,0)
 .;
"RTN","ALPBPPAT",59,0)
 .; set up the Task...
"RTN","ALPBPPAT",60,0)
 .I $D(IO("Q")) D
"RTN","ALPBPPAT",61,0)
 ..S ZTRTN="DQ^ALPBPPAT"
"RTN","ALPBPPAT",62,0)
 ..S ZTIO=ION
"RTN","ALPBPPAT",63,0)
 ..S ZTDESC="PSB INPT PHARM ORDERS FOR "_ALPBPTN
"RTN","ALPBPPAT",64,0)
 ..S ZTSAVE("ALPBDAYS")=""
"RTN","ALPBPPAT",65,0)
 ..S ZTSAVE("ALPBIEN")=""
"RTN","ALPBPPAT",66,0)
 ..S ZTSAVE("ALPBMLOG")=""
"RTN","ALPBPPAT",67,0)
 ..S ZTSAVE("ALPBOTYP")=""
"RTN","ALPBPPAT",68,0)
 ..D ^%ZTLOAD
"RTN","ALPBPPAT",69,0)
 ..D HOME^%ZIS
"RTN","ALPBPPAT",70,0)
 ..W !!,$S(+$G(ZTSK):"Task "_ZTSK_" queued.",1:"ERROR: NOT QUEUED!")
"RTN","ALPBPPAT",71,0)
 ..K IO("Q"),ZTSK
"RTN","ALPBPPAT",72,0)
 .;
"RTN","ALPBPPAT",73,0)
 .K ALPBDAYS,ALPBIEN,ALPBMLOG,ALPBOTYP,ALPBPTN,X,Y
"RTN","ALPBPPAT",74,0)
 K DIRUT,DTOUT,X,Y
"RTN","ALPBPPAT",75,0)
 Q
"RTN","ALPBPPAT",76,0)
 ;
"RTN","ALPBPPAT",77,0)
DQ ; output entry point...
"RTN","ALPBPPAT",78,0)
 K ^TMP($J)
"RTN","ALPBPPAT",79,0)
 ;
"RTN","ALPBPPAT",80,0)
 ; set report date...
"RTN","ALPBPPAT",81,0)
 S ALPBRDAT=$$NOW^XLFDT()
"RTN","ALPBPPAT",82,0)
 S ALPBPT(0)=$G(^ALPB(53.7,ALPBIEN,0))
"RTN","ALPBPPAT",83,0)
 M ALPBPT(1)=^ALPB(53.7,ALPBIEN,1)
"RTN","ALPBPPAT",84,0)
 S ALPBPG=1
"RTN","ALPBPPAT",85,0)
 D HDR^ALPBFRMU(.ALPBPT,ALPBPG,.ALPBHDR)
"RTN","ALPBPPAT",86,0)
 F I=1:1:ALPBHDR(0) W !,ALPBHDR(I)
"RTN","ALPBPPAT",87,0)
 K ALPBHDR
"RTN","ALPBPPAT",88,0)
 ;
"RTN","ALPBPPAT",89,0)
 ; loop through orders and sort by order status...
"RTN","ALPBPPAT",90,0)
 S ALPBOIEN=0
"RTN","ALPBPPAT",91,0)
 F  S ALPBOIEN=$O(^ALPB(53.7,ALPBIEN,2,ALPBOIEN)) Q:'ALPBOIEN  D
"RTN","ALPBPPAT",92,0)
 .M ALPBDATA=^ALPB(53.7,ALPBIEN,2,ALPBOIEN)
"RTN","ALPBPPAT",93,0)
 .; if report type is "C"urrent, stop date is less than
"RTN","ALPBPPAT",94,0)
 .; report date, and medication is marked 'HD' or HELD then quit...
"RTN","ALPBPPAT",95,0)
 .I ALPBOTYP="C" D  Q:'$D(ALPBDATA)
"RTN","ALPBPPAT",96,0)
 ..I $$STAT^ALPBUTL1($E($P(ALPBDATA(0),U,3),1,2))["on hold" K ALPBDATA Q
"RTN","ALPBPPAT",97,0)
 ..I $G(ALPBDATA(1))="" K ALPBDATA Q
"RTN","ALPBPPAT",98,0)
 ..I $P(ALPBDATA(1),U,2)<ALPBRDAT K ALPBDATA Q
"RTN","ALPBPPAT",99,0)
 .S ALPBORDN=$P(ALPBDATA(0),U)
"RTN","ALPBPPAT",100,0)
 .S ALPBOCT=$P($G(ALPBDATA(3)),U,1)
"RTN","ALPBPPAT",101,0)
 .S:$P($G(ALPBDATA(4)),U,3)["PRN" ALPBOCT=ALPBOCT_"P"
"RTN","ALPBPPAT",102,0)
 .S ALPBOST=$$STAT2^ALPBUTL1($P($G(ALPBDATA(0),"XX"),U,3))
"RTN","ALPBPPAT",103,0)
 .S ^TMP($J,ALPBOCT,ALPBOST,ALPBORDN)=ALPBOIEN
"RTN","ALPBPPAT",104,0)
 .K ALPBDATA,ALPBOST,ALPBOCT
"RTN","ALPBPPAT",105,0)
 ;
"RTN","ALPBPPAT",106,0)
 ; loop through the sorted orders...
"RTN","ALPBPPAT",107,0)
 S ALPBOCT=""
"RTN","ALPBPPAT",108,0)
 F  S ALPBOCT=$O(^TMP($J,ALPBOCT)) Q:ALPBOCT=""  D
"RTN","ALPBPPAT",109,0)
 .S ALPBOST=""
"RTN","ALPBPPAT",110,0)
 .F  S ALPBOST=$O(^TMP($J,ALPBOCT,ALPBOST)) Q:ALPBOST=""  D
"RTN","ALPBPPAT",111,0)
 ..S ALPBORDN=""
"RTN","ALPBPPAT",112,0)
 ..F  S ALPBORDN=$O(^TMP($J,ALPBOCT,ALPBOST,ALPBORDN)) Q:ALPBORDN=""  D
"RTN","ALPBPPAT",113,0)
 ...S ALPBOIEN=^TMP($J,ALPBOCT,ALPBOST,ALPBORDN)
"RTN","ALPBPPAT",114,0)
 ...M ALPBDATA=^ALPB(53.7,ALPBIEN,2,ALPBOIEN)
"RTN","ALPBPPAT",115,0)
 ...W !
"RTN","ALPBPPAT",116,0)
 ...D F132^ALPBFRM1(.ALPBDATA,ALPBDAYS,ALPBMLOG,.ALPBFORM,ALPBIEN)
"RTN","ALPBPPAT",117,0)
 ...; paginate?...
"RTN","ALPBPPAT",118,0)
 ...I $Y+ALPBFORM(0)=IOSL!($Y+ALPBFORM(0)>IOSL) D
"RTN","ALPBPPAT",119,0)
 ....W @IOF
"RTN","ALPBPPAT",120,0)
 ....S ALPBPG=ALPBPG+1
"RTN","ALPBPPAT",121,0)
 ....D HDR^ALPBFRMU(.ALPBPT,ALPBPG,.ALPBHDR)
"RTN","ALPBPPAT",122,0)
 ....F I=1:1:ALPBHDR(0) W !,ALPBHDR(I)
"RTN","ALPBPPAT",123,0)
 ....W !
"RTN","ALPBPPAT",124,0)
 ....K ALPBHDR
"RTN","ALPBPPAT",125,0)
 ...F I=1:1:ALPBFORM(0) W !,ALPBFORM(I)
"RTN","ALPBPPAT",126,0)
 ...K ALPBDATA,ALPBFORM
"RTN","ALPBPPAT",127,0)
 ..K ALPBORDN
"RTN","ALPBPPAT",128,0)
 .K ALPBOST
"RTN","ALPBPPAT",129,0)
 K ALPBOCT
"RTN","ALPBPPAT",130,0)
 ;
"RTN","ALPBPPAT",131,0)
 ; print footer at end of this patient's record...
"RTN","ALPBPPAT",132,0)
 D FOOT^ALPBFRMU
"RTN","ALPBPPAT",133,0)
 ;
"RTN","ALPBPPAT",134,0)
 K ALPBDAYS,ALPBMLOG,ALPBOIEN,ALPBORDN,ALPBOST,ALPBOTYP,ALPBPG,ALPBPT,ALPBRDAT,^TMP($J)
"RTN","ALPBPPAT",135,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ALPBPPAT",136,0)
 ;
"RTN","ALPBPPAT",137,0)
 ; write form feed at end if output device is a printer...
"RTN","ALPBPPAT",138,0)
 I $E(IOST)="P" W @IOF
"RTN","ALPBPPAT",139,0)
 Q
"RTN","ALPBPWRD")
0^3^B51543358
"RTN","ALPBPWRD",1,0)
ALPBPWRD ;OIFO-DALLAS MW,SED,KC-PRINT 3-DAY MAR BCMA BCBU REPORT FOR A SELECTED WARD ;01/01/03
"RTN","ALPBPWRD",2,0)
 ;;3.0;BAR CODE MED ADMIN;**8,37,48**;Mar 2004;Build 9
"RTN","ALPBPWRD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ALPBPWRD",4,0)
 ; 
"RTN","ALPBPWRD",5,0)
 ; NOTE: this routine is designed for hard-copy output.
"RTN","ALPBPWRD",6,0)
 ;      Output is formatted for 132-column printing.
"RTN","ALPBPWRD",7,0)
 ; 
"RTN","ALPBPWRD",8,0)
 F  D  Q:$D(DIRUT)
"RTN","ALPBPWRD",9,0)
 .W !,"Inpatient Pharmacy Orders for a selected ward"
"RTN","ALPBPWRD",10,0)
 .S DIR(0)="FAO^2:10"
"RTN","ALPBPWRD",11,0)
 .S DIR("A")="Select WARD: "
"RTN","ALPBPWRD",12,0)
 .S DIR("?")="^D WARDLIST^ALPBUTL(""C"")"
"RTN","ALPBPWRD",13,0)
 .D ^DIR K DIR
"RTN","ALPBPWRD",14,0)
 .I $D(DIRUT) Q
"RTN","ALPBPWRD",15,0)
 .D WARDSEL^ALPBUTL(Y,.ALPBSEL)
"RTN","ALPBPWRD",16,0)
 .I +$G(ALPBSEL(0))=0 D  Q
"RTN","ALPBPWRD",17,0)
 ..W $C(7)
"RTN","ALPBPWRD",18,0)
 ..W "  ??"
"RTN","ALPBPWRD",19,0)
 ..D WARDLIST^ALPBUTL("C")
"RTN","ALPBPWRD",20,0)
 ..K ALPBSEL
"RTN","ALPBPWRD",21,0)
 .I +$G(ALPBSEL(0))=1 D
"RTN","ALPBPWRD",22,0)
 ..S ALPBWARD=ALPBSEL(1)
"RTN","ALPBPWRD",23,0)
 ..W "   ",ALPBWARD
"RTN","ALPBPWRD",24,0)
 ..K ALPBSEL
"RTN","ALPBPWRD",25,0)
 .I +$G(ALPBSEL(0))>1 D  I $D(DIRUT) K DIRUT,DTOUT,X,Y Q
"RTN","ALPBPWRD",26,0)
 ..S ALPBX=0
"RTN","ALPBPWRD",27,0)
 ..F  S ALPBX=$O(ALPBSEL(ALPBX)) Q:'ALPBX  W !?2,$J(ALPBX,2),"  ",ALPBSEL(ALPBX)
"RTN","ALPBPWRD",28,0)
 ..K ALPBX
"RTN","ALPBPWRD",29,0)
 ..S DIR(0)="NA^1:"_ALPBSEL(0)
"RTN","ALPBPWRD",30,0)
 ..S DIR("A")="Select Ward from the list (1-"_ALPBSEL(0)_"): "
"RTN","ALPBPWRD",31,0)
 ..W ! D ^DIR K DIR
"RTN","ALPBPWRD",32,0)
 ..I $D(DIRUT) K ALPBSEL Q
"RTN","ALPBPWRD",33,0)
 ..S ALPBWARD=ALPBSEL(+Y)
"RTN","ALPBPWRD",34,0)
 ..K ALPBSEL
"RTN","ALPBPWRD",35,0)
 .;
"RTN","ALPBPWRD",36,0)
 .; get all or just current orders?...
"RTN","ALPBPWRD",37,0)
 .S DIR(0)="SA^A:ALL;C:CURRENT"
"RTN","ALPBPWRD",38,0)
 .S DIR("A")="Report [A]LL or [C]URRENT orders? "
"RTN","ALPBPWRD",39,0)
 .S DIR("B")="CURRENT"
"RTN","ALPBPWRD",40,0)
 .S DIR("?")="[A]LL=all orders in the file, [C]URRENT=orders not yet expired."
"RTN","ALPBPWRD",41,0)
 .W ! D ^DIR K DIR
"RTN","ALPBPWRD",42,0)
 .I $D(DIRUT) K ALPBWARD,DIRUT,DTOUT,X,Y Q
"RTN","ALPBPWRD",43,0)
 .S ALPBOTYP=Y
"RTN","ALPBPWRD",44,0)
 .;
"RTN","ALPBPWRD",45,0)
 .;SORT BY NAME OR ROOM/BED     added 6/23/05
"RTN","ALPBPWRD",46,0)
 .S DIR(0)="SA^N:Name;R:Room/Bed"
"RTN","ALPBPWRD",47,0)
 .S DIR("A")="Sort Patients by [N]ame or [R]oom/Bed? "
"RTN","ALPBPWRD",48,0)
 .S DIR("B")="Room/bed"
"RTN","ALPBPWRD",49,0)
 .S DIR("?")="Sort by [N]ame or [R]oom Bed"
"RTN","ALPBPWRD",50,0)
 .W ! D ^DIR K DIR
"RTN","ALPBPWRD",51,0)
 .I $D(DIRUT) K ALPBWARD,DIRUT,DTOUT,X,Y Q
"RTN","ALPBPWRD",52,0)
 .S ALPBSORT=Y
"RTN","ALPBPWRD",53,0)
 .;
"RTN","ALPBPWRD",54,0)
 .; print how many days MAR?...
"RTN","ALPBPWRD",55,0)
 .S DIR(0)="NA^1:7"
"RTN","ALPBPWRD",56,0)
 .S DIR("A")="Print how many days MAR? "
"RTN","ALPBPWRD",57,0)
 .S DIR("B")=$$DEFDAYS^ALPBUTL()
"RTN","ALPBPWRD",58,0)
 .S DIR("?")="The default is shown; please select a number 1 to 7."
"RTN","ALPBPWRD",59,0)
 .W ! D ^DIR K DIR
"RTN","ALPBPWRD",60,0)
 .I $D(DIRUT) K ALPBOTYP,DIRUT,DTOUT,X,Y Q
"RTN","ALPBPWRD",61,0)
 .S ALPBDAYS=+Y
"RTN","ALPBPWRD",62,0)
 .;
"RTN","ALPBPWRD",63,0)
 .; BCMA Med Log info for how many ?...
"RTN","ALPBPWRD",64,0)
 .S DIR(0)="NA^1:99"
"RTN","ALPBPWRD",65,0)
 .S DIR("B")=$$DEFML^ALPBUTL3()
"RTN","ALPBPWRD",66,0)
 .S DIR("A")="Select how many BCMA Medication Log history: "
"RTN","ALPBPWRD",67,0)
 .S DIR("A",1)=" "
"RTN","ALPBPWRD",68,0)
 .S DIR("?",1)="Select a number of BCMA Medication log entries"
"RTN","ALPBPWRD",69,0)
 .S DIR("?",2)="for each of the patient's orders"
"RTN","ALPBPWRD",70,0)
 .S DIR("?")="They are listed by the most current entry first"
"RTN","ALPBPWRD",71,0)
 .D ^DIR K DIR
"RTN","ALPBPWRD",72,0)
 .I $D(DIRUT) K ALPBOTYP,ALPBWARD,DIRUT,DTOUT,X,Y Q
"RTN","ALPBPWRD",73,0)
 .S ALPBMLOG=Y
"RTN","ALPBPWRD",74,0)
 .;
"RTN","ALPBPWRD",75,0)
 .S %ZIS="Q"
"RTN","ALPBPWRD",76,0)
 .S %ZIS("B")=$$DEFPRT^ALPBUTL()
"RTN","ALPBPWRD",77,0)
 .I %ZIS("B")="" K %ZIS("B")
"RTN","ALPBPWRD",78,0)
 .W ! D ^%ZIS K %ZIS
"RTN","ALPBPWRD",79,0)
 .I POP D  Q
"RTN","ALPBPWRD",80,0)
 ..W $C(7)
"RTN","ALPBPWRD",81,0)
 ..K ALPBMLOG,ALPBOTYP,ALPBWARD,POP
"RTN","ALPBPWRD",82,0)
 .;
"RTN","ALPBPWRD",83,0)
 .; output not queued...
"RTN","ALPBPWRD",84,0)
 .I '$D(IO("Q")) D
"RTN","ALPBPWRD",85,0)
 ..U IO
"RTN","ALPBPWRD",86,0)
 ..D DQ
"RTN","ALPBPWRD",87,0)
 ..I IO'=IO(0) D ^%ZISC
"RTN","ALPBPWRD",88,0)
 .;
"RTN","ALPBPWRD",89,0)
 .; set up the Task...
"RTN","ALPBPWRD",90,0)
 .I $D(IO("Q")) D
"RTN","ALPBPWRD",91,0)
 ..S ZTRTN="DQ^ALPBPWRD"
"RTN","ALPBPWRD",92,0)
 ..S ZTDESC="PSB INPT PHARM ORDERS FOR WARD "_ALPBWARD
"RTN","ALPBPWRD",93,0)
 ..S ZTSAVE("ALPBDAYS")=""
"RTN","ALPBPWRD",94,0)
 ..S ZTSAVE("ALPBWARD")=""
"RTN","ALPBPWRD",95,0)
 ..S ZTSAVE("ALPBMLOG")=""
"RTN","ALPBPWRD",96,0)
 ..S ZTSAVE("ALPBOTYP")=""
"RTN","ALPBPWRD",97,0)
 ..S ZTSAVE("ALPBSORT")=""
"RTN","ALPBPWRD",98,0)
 ..S ZTIO=ION
"RTN","ALPBPWRD",99,0)
 ..D ^%ZTLOAD
"RTN","ALPBPWRD",100,0)
 ..D HOME^%ZIS
"RTN","ALPBPWRD",101,0)
 ..W !,$S($G(ZTSK):"Task number "_ZTSK_" queued.",1:"ERROR -- NOT QUEUED!")
"RTN","ALPBPWRD",102,0)
 ..K IO("Q"),ZTSK
"RTN","ALPBPWRD",103,0)
 .K ALPBDAYS,ALPBMLOG,ALPBOTYP,ALPBWARD
"RTN","ALPBPWRD",104,0)
 K DIRUT,DTOUT,X,Y
"RTN","ALPBPWRD",105,0)
 Q
"RTN","ALPBPWRD",106,0)
 ;
"RTN","ALPBPWRD",107,0)
DQ ; output entry point...
"RTN","ALPBPWRD",108,0)
 K ^TMP($J)
"RTN","ALPBPWRD",109,0)
 ;
"RTN","ALPBPWRD",110,0)
 ; set report date...  SED 11/4/03
"RTN","ALPBPWRD",111,0)
 S ALPBRDAT=$S(ALPBOTYP="C":$$NOW^XLFDT(),1:"")
"RTN","ALPBPWRD",112,0)
 ;
"RTN","ALPBPWRD",113,0)
 ; loop through ward cross reference in 53.7...
"RTN","ALPBPWRD",114,0)
 S ALPBPTN=""
"RTN","ALPBPWRD",115,0)
 F  S ALPBPTN=$O(^ALPB(53.7,"AW",ALPBWARD,ALPBPTN)) Q:ALPBPTN=""  D
"RTN","ALPBPWRD",116,0)
 .S ALPBIEN=0
"RTN","ALPBPWRD",117,0)
 .F  S ALPBIEN=$O(^ALPB(53.7,"AW",ALPBWARD,ALPBPTN,ALPBIEN)) Q:'ALPBIEN  D
"RTN","ALPBPWRD",118,0)
 ..D ORDS^ALPBUTL(ALPBIEN,ALPBRDAT,.ALPBORDS)
"RTN","ALPBPWRD",119,0)
 ..I +ALPBORDS(0)'>0 K ALPBORDS Q
"RTN","ALPBPWRD",120,0)
 ..I $G(ALPBPDAT(0))="" S ALPBPDAT(0)=$G(^ALPB(53.7,ALPBIEN,0))
"RTN","ALPBPWRD",121,0)
 ..S ALPBOIEN=0
"RTN","ALPBPWRD",122,0)
 ..F  S ALPBOIEN=$O(ALPBORDS(ALPBOIEN)) Q:'ALPBOIEN  D
"RTN","ALPBPWRD",123,0)
 ...S ALPBDATA=$G(^ALPB(53.7,ALPBIEN,2,ALPBOIEN,1))
"RTN","ALPBPWRD",124,0)
 ...S ALPBOCT=$P($G(^ALPB(53.7,ALPBIEN,2,ALPBOIEN,3)),U,1)
"RTN","ALPBPWRD",125,0)
 ...S:$P($G(^ALPB(53.7,ALPBIEN,2,ALPBOIEN,4)),U,3)["PRN" ALPBOCT=ALPBOCT_"P"
"RTN","ALPBPWRD",126,0)
 ...; if report is for "C"urrent, check stop date and quit if
"RTN","ALPBPWRD",127,0)
 ...; stop date is less than report date...
"RTN","ALPBPWRD",128,0)
 ...I ALPBOTYP="C"&($P(ALPBDATA,U,2)<ALPBRDAT) K ALPBDATA Q
"RTN","ALPBPWRD",129,0)
 ...S ALPBORDN=ALPBORDS(ALPBOIEN)
"RTN","ALPBPWRD",130,0)
 ...S ALPBOST=$$STAT2^ALPBUTL1(ALPBORDS(ALPBOIEN,2))
"RTN","ALPBPWRD",131,0)
 ...I '$D(^TMP($J,ALPBPTN)) S ^TMP($J,ALPBPTN)=ALPBIEN
"RTN","ALPBPWRD",132,0)
 ...S ^TMP($J,ALPBPTN,ALPBOCT,ALPBOST,ALPBORDN)=ALPBOIEN
"RTN","ALPBPWRD",133,0)
 ...K ALPBDATA,ALPBORDN,ALPBOST
"RTN","ALPBPWRD",134,0)
 ..K ALPBOIEN,ALPBORDS,ALPBPDAT
"RTN","ALPBPWRD",135,0)
 .K ALPBIEN
"RTN","ALPBPWRD",136,0)
 K ALPBPTN
"RTN","ALPBPWRD",137,0)
 ;
"RTN","ALPBPWRD",138,0)
 ; Sort by Patient Name or room/bed capability added 6/23/05 KFOX
"RTN","ALPBPWRD",139,0)
 S ALPBPG=0
"RTN","ALPBPWRD",140,0)
 S ALPBPTN=""
"RTN","ALPBPWRD",141,0)
 I ALPBSORT="N" D
"RTN","ALPBPWRD",142,0)
 .F  S ALPBPTN=$O(^TMP($J,ALPBPTN)) Q:ALPBPTN=""  S ALPBIEN=^TMP($J,ALPBPTN) D PRT
"RTN","ALPBPWRD",143,0)
 ;SORT BY ROOM/BED
"RTN","ALPBPWRD",144,0)
 I ALPBSORT="R" D
"RTN","ALPBPWRD",145,0)
 .S ALPBD="",ALPRM=""
"RTN","ALPBPWRD",146,0)
 .F  S ALPBPTN=$O(^TMP($J,ALPBPTN)) Q:ALPBPTN=""  D  Q:ALPBPTN=""
"RTN","ALPBPWRD",147,0)
 ..I ALPBPTN="BCBU" S ALPBPTN=$O(^TMP($J,ALPBPTN)) ;SKIP "BCBU" SUBSCRIBE
"RTN","ALPBPWRD",148,0)
 ..I ALPBPTN="" Q  ;PSB*3*37 Stop null subscript when "BCBU" is the last entry in ^TMP
"RTN","ALPBPWRD",149,0)
 ..S ALPBIEN=^TMP($J,ALPBPTN) S ALPRM=$P($G(^ALPB(53.7,ALPBIEN,0)),"^",6),ALPBD=$P($G(^ALPB(53.7,ALPBIEN,0)),"^",7)
"RTN","ALPBPWRD",150,0)
 ..S:$TR(ALPBD,"""","")="" ALPBD="NONE" S:$TR(ALPRM,"""","")="" ALPRM="NONE" ;INCASE NO ROOM AND BED YET
"RTN","ALPBPWRD",151,0)
 ..S ^TMP($J,"BCBU",ALPRM,ALPRM,ALPBD,ALPBPTN)=ALPBIEN
"RTN","ALPBPWRD",152,0)
 .S ALPRM1="" F  S ALPRM1=$O(^TMP($J,"BCBU",ALPRM1)) Q:ALPRM1=""  D
"RTN","ALPBPWRD",153,0)
 ..S ALPRM="" F  S ALPRM=$O(^TMP($J,"BCBU",ALPRM1,ALPRM)) Q:ALPRM=""  D
"RTN","ALPBPWRD",154,0)
 ...S ALPBD="" F  S ALPBD=$O(^TMP($J,"BCBU",ALPRM1,ALPRM,ALPBD)) Q:ALPBD=""  D
"RTN","ALPBPWRD",155,0)
 ....S ALPBPTN="" F  S ALPBPTN=$O(^TMP($J,"BCBU",ALPRM1,ALPRM,ALPBD,ALPBPTN)) Q:ALPBPTN=""  D
"RTN","ALPBPWRD",156,0)
 .....S ALPBIEN=$G(^TMP($J,"BCBU",ALPRM1,ALPRM,ALPBD,ALPBPTN))  D PRT
"RTN","ALPBPWRD",157,0)
 D DONE
"RTN","ALPBPWRD",158,0)
 Q
"RTN","ALPBPWRD",159,0)
PRT S ALPBPDAT(0)=$G(^ALPB(53.7,ALPBIEN,0))
"RTN","ALPBPWRD",160,0)
 M ALPBPDAT(1)=^ALPB(53.7,ALPBIEN,1)
"RTN","ALPBPWRD",161,0)
 I ALPBPG=0 D PAGE
"RTN","ALPBPWRD",162,0)
 S ALPBOCT=""
"RTN","ALPBPWRD",163,0)
 F  S ALPBOCT=$O(^TMP($J,ALPBPTN,ALPBOCT)) Q:ALPBOCT=""  D
"RTN","ALPBPWRD",164,0)
 .S ALPBOST=""
"RTN","ALPBPWRD",165,0)
 .F  S ALPBOST=$O(^TMP($J,ALPBPTN,ALPBOCT,ALPBOST)) Q:ALPBOST=""  D
"RTN","ALPBPWRD",166,0)
 ..S ALPBORDN=""
"RTN","ALPBPWRD",167,0)
 ..F  S ALPBORDN=$O(^TMP($J,ALPBPTN,ALPBOCT,ALPBOST,ALPBORDN)) Q:ALPBORDN=""  D
"RTN","ALPBPWRD",168,0)
 ...S ALPBOIEN=^TMP($J,ALPBPTN,ALPBOCT,ALPBOST,ALPBORDN)
"RTN","ALPBPWRD",169,0)
 ...; get and print this order's data...
"RTN","ALPBPWRD",170,0)
 ...M ALPBDATA=^ALPB(53.7,ALPBIEN,2,ALPBOIEN)
"RTN","ALPBPWRD",171,0)
 ...D F132^ALPBFRM1(.ALPBDATA,ALPBDAYS,ALPBMLOG,.ALPBFORM,ALPBIEN)
"RTN","ALPBPWRD",172,0)
 ...;D F132^ALPBFRM1(.ALPBDATA,ALPBDAYS,.ALPBFORM)
"RTN","ALPBPWRD",173,0)
 ...I $Y+ALPBFORM(0)=IOSL!($Y+ALPBFORM(0)>IOSL) D PAGE
"RTN","ALPBPWRD",174,0)
 ...F ALPBX=1:1:ALPBFORM(0) W !,ALPBFORM(ALPBX)
"RTN","ALPBPWRD",175,0)
 ...K ALPBDATA,ALPBFORM,ALPBOIEN,ALPBX
"RTN","ALPBPWRD",176,0)
 ..K ALPBORDN
"RTN","ALPBPWRD",177,0)
 .K ALPBOST
"RTN","ALPBPWRD",178,0)
 K ALPBOCT
"RTN","ALPBPWRD",179,0)
 ; print footer at end of this patient's record...
"RTN","ALPBPWRD",180,0)
 I $Y+10>IOSL D PAGE
"RTN","ALPBPWRD",181,0)
 W !!
"RTN","ALPBPWRD",182,0)
 D FOOT^ALPBFRMU
"RTN","ALPBPWRD",183,0)
 ;Print a blank page between patient
"RTN","ALPBPWRD",184,0)
 W @IOF
"RTN","ALPBPWRD",185,0)
 S ALPBPG=0
"RTN","ALPBPWRD",186,0)
 K ALPBPDAT
"RTN","ALPBPWRD",187,0)
 Q
"RTN","ALPBPWRD",188,0)
 ;K ALPBIEN,ALPBPDAT KILLING ALPBIEN WILL BREAK SORT BY ROOM/BED
"RTN","ALPBPWRD",189,0)
 ;
"RTN","ALPBPWRD",190,0)
DONE ;   
"RTN","ALPBPWRD",191,0)
 K ALPBDAYS,ALPBMLOG,ALPBOTYP,ALPBPG,ALPBPTN,ALPBRDAT,ALPBWARD,^TMP($J),ALPRM,ALPRM1,ALPBD,ALPBIEN,ALPBSORT
"RTN","ALPBPWRD",192,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ALPBPWRD",193,0)
 Q
"RTN","ALPBPWRD",194,0)
 ;
"RTN","ALPBPWRD",195,0)
PAGE ; print page header for patient...
"RTN","ALPBPWRD",196,0)
 W @IOF
"RTN","ALPBPWRD",197,0)
 S ALPBPG=ALPBPG+1
"RTN","ALPBPWRD",198,0)
 D HDR^ALPBFRMU(.ALPBPDAT,ALPBPG,.ALPBHDR)
"RTN","ALPBPWRD",199,0)
 F ALPBX=1:1:ALPBHDR(0) W !,ALPBHDR(ALPBX)
"RTN","ALPBPWRD",200,0)
 K ALPBHDR,ALPBX
"RTN","ALPBPWRD",201,0)
 Q
"VER")
8.0^22.0
**END**
**END**
