Released FH*5.5*21 SEQ #23
Extracted from mail message
**KIDS**:FH*5.5*21^

**INSTALL NAME**
FH*5.5*21
"BLD",7968,0)
FH*5.5*21^DIETETICS^0^3101129^y
"BLD",7968,1,0)
^^1^1^3090520^
"BLD",7968,1,1,0)
ADDRESSES GENERAL NUTRITION AND FOOD SERVICE ISSUES
"BLD",7968,4,0)
^9.64PA^^
"BLD",7968,6.3)
6
"BLD",7968,"ABPKG")
n
"BLD",7968,"KRN",0)
^9.67PA^779.2^20
"BLD",7968,"KRN",.4,0)
.4
"BLD",7968,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7968,"KRN",.401,0)
.401
"BLD",7968,"KRN",.402,0)
.402
"BLD",7968,"KRN",.403,0)
.403
"BLD",7968,"KRN",.5,0)
.5
"BLD",7968,"KRN",.84,0)
.84
"BLD",7968,"KRN",3.6,0)
3.6
"BLD",7968,"KRN",3.8,0)
3.8
"BLD",7968,"KRN",9.2,0)
9.2
"BLD",7968,"KRN",9.8,0)
9.8
"BLD",7968,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7968,"KRN",9.8,"NM",1,0)
FHASM2B^^0^B6154572
"BLD",7968,"KRN",9.8,"NM",2,0)
FHWADM^^0^B26331626
"BLD",7968,"KRN",9.8,"NM",3,0)
FHPATM^^0^B15438175
"BLD",7968,"KRN",9.8,"NM","B","FHASM2B",1)

"BLD",7968,"KRN",9.8,"NM","B","FHPATM",3)

"BLD",7968,"KRN",9.8,"NM","B","FHWADM",2)

"BLD",7968,"KRN",19,0)
19
"BLD",7968,"KRN",19,"NM",0)
^9.68A^^
"BLD",7968,"KRN",19.1,0)
19.1
"BLD",7968,"KRN",101,0)
101
"BLD",7968,"KRN",409.61,0)
409.61
"BLD",7968,"KRN",771,0)
771
"BLD",7968,"KRN",779.2,0)
779.2
"BLD",7968,"KRN",870,0)
870
"BLD",7968,"KRN",8989.51,0)
8989.51
"BLD",7968,"KRN",8989.52,0)
8989.52
"BLD",7968,"KRN",8994,0)
8994
"BLD",7968,"KRN","B",.4,.4)

"BLD",7968,"KRN","B",.401,.401)

"BLD",7968,"KRN","B",.402,.402)

"BLD",7968,"KRN","B",.403,.403)

"BLD",7968,"KRN","B",.5,.5)

"BLD",7968,"KRN","B",.84,.84)

"BLD",7968,"KRN","B",3.6,3.6)

"BLD",7968,"KRN","B",3.8,3.8)

"BLD",7968,"KRN","B",9.2,9.2)

"BLD",7968,"KRN","B",9.8,9.8)

"BLD",7968,"KRN","B",19,19)

"BLD",7968,"KRN","B",19.1,19.1)

"BLD",7968,"KRN","B",101,101)

"BLD",7968,"KRN","B",409.61,409.61)

"BLD",7968,"KRN","B",771,771)

"BLD",7968,"KRN","B",779.2,779.2)

"BLD",7968,"KRN","B",870,870)

"BLD",7968,"KRN","B",8989.51,8989.51)

"BLD",7968,"KRN","B",8989.52,8989.52)

"BLD",7968,"KRN","B",8994,8994)

"BLD",7968,"QUES",0)
^9.62^^
"BLD",7968,"REQB",0)
^9.611^1^1
"BLD",7968,"REQB",1,0)
FH*5.5*8^2
"BLD",7968,"REQB","B","FH*5.5*8",1)

"MBREQ")
0
"PKG",122,-1)
1^1
"PKG",122,0)
DIETETICS^FH^Dietetics System
"PKG",122,20,0)
^9.402P^^
"PKG",122,22,0)
^9.49I^1^1
"PKG",122,22,1,0)
5.5^3050202^3050308^33227
"PKG",122,22,1,"PAH",1,0)
21^3101129
"PKG",122,22,1,"PAH",1,1,0)
^^1^1^3101129
"PKG",122,22,1,"PAH",1,1,1,0)
ADDRESSES GENERAL NUTRITION AND FOOD SERVICE ISSUES
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","FHASM2B")
0^1^B6154572^B5467504
"RTN","FHASM2B",1,0)
FHASM2B ; HISC/REL - Target Weight - Geriatric ;6/1/89  16:17
"RTN","FHASM2B",2,0)
 ;;5.5;DIETETICS;**8,21**;Jan 28, 2005;Build 6
"RTN","FHASM2B",3,0)
 ; Target Weight for Geriatrics
"RTN","FHASM2B",4,0)
 ; Journal of Amer. Medical Assn., Vol. 172, p. 658, by
"RTN","FHASM2B",5,0)
 ; Master & Lasser. Used for people ages 65 to 94.
"RTN","FHASM2B",6,0)
 ; Full source information:
"RTN","FHASM2B",7,0)
 ; Tables of Average Weight and Height of Americans Aged 65 to 94 years
"RTN","FHASM2B",8,0)
 ; Relationship Of Weight And Height To Survival
"RTN","FHASM2B",9,0)
 ; By Arthur M. Master, M.D., Richard P. Lasser, M.D., and Gloria Beckman, B.A., New York
"RTN","FHASM2B",10,0)
 ; J.A.M.A., Feb. 13, 1960 Vol. 172, No. 7 pages 658 to 662
"RTN","FHASM2B",11,0)
G1 S OFF=$S(SEX="M":H1-61,1:H1-45),A1=$P($T(GM1+OFF),";",$S(AGE<70:4,AGE<75:5,AGE<80:6,AGE<85:7,AGE<90:8,1:9))
"RTN","FHASM2B",12,0)
 G:A1'["*" G2
"RTN","FHASM2B",13,0)
 S A2=+A1,A1=$P($T(GM1+OFF),";",$S(A2=1:4,A2=2:5,A2=3:6,A2=4:7,1:8))
"RTN","FHASM2B",14,0)
 W *7,!!,"No data for your Age Group, the ",$S(A2=1:"65-69",A2=2:"70-74",A2=3:"75-79",A2=4:"80-84",1:"85-89")," Group was used."
"RTN","FHASM2B",15,0)
G2 S W1=$P(A1,"-",1),W2=+$P(A1,"-",2),W3=+$J(W1+W2/2,0,0)
"RTN","FHASM2B",16,0)
 S X1=$S(FHU'="M":W1,1:+$J(W1/2.2,0,1)),X2=$S(FHU'="M":W2,1:+$J(W2/2.2,0,1)),X3=$S(FHU'="M":W3,1:+$J(W3/2.2,0,1))
"RTN","FHASM2B",17,0)
G3 W !!,"Select Target Weight (",X1,"-",X2,") ",X3,$S(FHU'="M":" lb",1:" kg"),"// " R X:DTIME I '$T!(X["^") S IBW="^" Q
"RTN","FHASM2B",18,0)
 I X="" S IBW=W3 Q
"RTN","FHASM2B",19,0)
 D WGT^FHASM1 I Y<1 D WGP^FHASM1 G G3
"RTN","FHASM2B",20,0)
 S IBW=+Y I IBW<W1!(IBW>W2) S METH="E"
"RTN","FHASM2B",21,0)
 Q
"RTN","FHASM2B",22,0)
GM1 ;;61;128-156;125-153;123-151;3*;3*;3*
"RTN","FHASM2B",23,0)
 ;;62;130-158;127-155;125-153;122-148;4*;4*
"RTN","FHASM2B",24,0)
 ;;63;131-161;129-157;127-155;122-150;120-146;5*
"RTN","FHASM2B",25,0)
 ;;64;134-164;131-161;129-157;124-152;122-148;5*
"RTN","FHASM2B",26,0)
 ;;65;136-166;134-164;130-160;127-155;125-153;117-143
"RTN","FHASM2B",27,0)
 ;;66;139-169;137-167;133-163;130-158;128-156;120-146
"RTN","FHASM2B",28,0)
 ;;67;140-172;140-170;136-166;132-162;130-160;122-150
"RTN","FHASM2B",29,0)
 ;;68;143-175;142-174;139-169;135-165;133-163;126-154
"RTN","FHASM2B",30,0)
 ;;69;147-179;146-178;142-174;139-169;137-167;130-153
"RTN","FHASM2B",31,0)
 ;;70;150-184;148-182;146-178;143-175;140-172;134-164
"RTN","FHASM2B",32,0)
 ;;71;155-189;152-186;149-183;148-180;144-176;139-169
"RTN","FHASM2B",33,0)
 ;;72;159-195;156-190;154-188;153-187;148-182;5*
"RTN","FHASM2B",34,0)
 ;;73;164-200;160-196;158-192;3*;3*;3*
"RTN","FHASM2B",35,0)
GW1 ;;58;120-146;112-138;111-135;3*;3*;3*
"RTN","FHASM2B",36,0)
 ;;59;121-147;114-140;112-136;100-122;99-121;5*
"RTN","FHASM2B",37,0)
 ;;60;122-148;116-142;113-139;106-130;102-124;5*
"RTN","FHASM2B",38,0)
 ;;61;123-151;118-144;115-141;109-133;104-128;5*
"RTN","FHASM2B",39,0)
 ;;62;125-153;121-147;118-144;112-136;108-132;107-131
"RTN","FHASM2B",40,0)
 ;;63;127-155;123-151;121-147;115-141;112-136;107-131
"RTN","FHASM2B",41,0)
 ;;64;130-158;126-154;123-151;119-145;115-141;109-132
"RTN","FHASM2B",42,0)
 ;;65;132-162;130-158;126-154;122-150;120-146;112-136
"RTN","FHASM2B",43,0)
 ;;66;136-166;132-162;128-157;126-154;124-152;116-142
"RTN","FHASM2B",44,0)
 ;;67;140-170;136-166;131-161;130-158;128-156;5*
"RTN","FHASM2B",45,0)
 ;;68;143-175;140-170;2*;2*;2*;2*
"RTN","FHASM2B",46,0)
 ;;69;148-180;144-176;2*;2*;2*;2*
"RTN","FHPATM")
0^3^B15438175^B13051908
"RTN","FHPATM",1,0)
FHPATM ; HISC/REL/JH - Patient Movements ;4/2/98  14:53
"RTN","FHPATM",2,0)
 ;;5.5;DIETETICS;**21**;Jan 28, 2005;Build 6
"RTN","FHPATM",3,0)
 ;Integration Agreements added FH*5.5*21 SLC/GDU
"RTN","FHPATM",4,0)
 ;GLOBAL REFERENCE  FIELD REFERECE                        DBIA
"RTN","FHPATM",5,0)
 ;^DG(405.4,D0      .01 NAME 0;1                          1380
"RTN","FHPATM",6,0)
 ;^DGPM(APTT1,DFN,                                        2090
"RTN","FHPATM",7,0)
 ;^DGPM(APTT2,DFN,                                        2090
"RTN","FHPATM",8,0)
 ;^DGPM(APTT4,DFN,                                        2090
"RTN","FHPATM",9,0)
 ;^DGPM(APID,DFN,INVERSE DATE_AS,DA                       2090
"RTN","FHPATM",10,0)
 ;^DGPM(DO,0        .03 PATIENT 0;3                       2090
"RTN","FHPATM",11,0)
 ;                  .06 WARD LOCATION 0;6                 2090
"RTN","FHPATM",12,0)
 ;                  .07 ROOM-BED 0;7                      2090
"RTN","FHPATM",13,0)
 ;                  .14 ADMISSION/CHECK-IN MOVEMENT 0;14  2090
"RTN","FHPATM",14,0)
 ;                  .18 MAS MOVEMENT 0;18                 2090
"RTN","FHPATM",15,0)
 ;^DIC(42,DO,0)     .015 DIVISION 0;11                    10039
"RTN","FHPATM",16,0)
 S DAT=0 D HDR
"RTN","FHPATM",17,0)
P1 S %DT="AEXT",%DT("A")="START with DATE@TIME: " W ! D ^%DT G:Y<1 KIL S DAT=Y
"RTN","FHPATM",18,0)
 I DAT>NOW W "  [ Date cannot be in Future ]" G P1
"RTN","FHPATM",19,0)
 S X1=DT,X2=-5 D C^%DTC I DAT<X W "  [ DATE MORE THAN 5 DAYS IN PAST ]" G P1
"RTN","FHPATM",20,0)
 D DIVISION^VAUTOMA
"RTN","FHPATM",21,0)
P2 W ! K IOP S %ZIS="MQ",%ZIS("A")="Select LIST Printer: " D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHPATM",22,0)
 I $D(IO("Q")) S FHPGM="F0^FHPATM",FHLST="DAT^DT^VAUTD*" D EN2^FH G KIL
"RTN","FHPATM",23,0)
 U IO D F0,NOTE D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHPATM",24,0)
F0 D HDR W !!?5,"Name",?24,"ID#",?35,"Date/Time",?49,"FROM Ward-Bed",?65,"TO Ward-Bed"
"RTN","FHPATM",25,0)
 W !!?26,"--- A D M I S S I O N S ---",! S NOD="ATT1" D FND
"RTN","FHPATM",26,0)
 W !!?26,"--- D I S C H A R G E S ---",! S NOD="ATT3" D FND
"RTN","FHPATM",27,0)
 W !!?27,"--- T R A N S F E R S ---",! S NOD="ATT2" D FND W ! Q
"RTN","FHPATM",28,0)
HDR S H1="" I DAT S DTP=DAT D DTP^FH S H1=DTP_" to "
"RTN","FHPATM",29,0)
 W:$E(IOST,1,2)="C-" @IOF W !?23,"P A T I E N T   M O V E M E N T S"
"RTN","FHPATM",30,0)
 I $D(VAUTD) D
"RTN","FHPATM",31,0)
 . W !,"Division:  " I $D(VAUTD)=1 W "ALL" Q
"RTN","FHPATM",32,0)
 . N N F N=0:0 S N=$O(VAUTD(N)) Q:'N  W VAUTD(N)  W:$O(VAUTD(N))>0 ", "
"RTN","FHPATM",33,0)
 D NOW^%DTC S (DTP,NOW)=%,DT=NOW\1 D DTP^FH S H1=H1_DTP W !!?(80-$L(H1)\2),H1 Q
"RTN","FHPATM",34,0)
FND S NX=DAT-.0000005
"RTN","FHPATM",35,0)
F1 S NX=$O(^DGPM(NOD,NX)) Q:NX<1!(NX'<NOW)
"RTN","FHPATM",36,0)
 F DA=0:0 S DA=$O(^DGPM(NOD,NX,DA)) Q:DA=""  S X1=$G(^DGPM(DA,0)),NOWRD=0 D PRT
"RTN","FHPATM",37,0)
 G F1
"RTN","FHPATM",38,0)
PRT S DFN=+$P(X1,"^",3),ADM=$P(X1,"^",14),XT=$P(X1,"^",18) Q:ADM<1  D P0
"RTN","FHPATM",39,0)
 Q
"RTN","FHPATM",40,0)
P0 Q:'$D(^DPT(DFN,0))  S Y(0)=^(0) D PID^FHDPA I NOD="ATT1",XT=40 Q
"RTN","FHPATM",41,0)
 I NOD="ATT3",XT=41!(XT=42)!(XT=46)!(XT=47) Q
"RTN","FHPATM",42,0)
 S FH7R=0 D GET Q:NOD="ATT1"&TW=""  S:'FH7R FH7R=0 Q:'$G(VAUTD)&'$D(VAUTD(FH7R))
"RTN","FHPATM",43,0)
 W !,$E($P(Y(0),"^",1),1,21),?23,BID
"RTN","FHPATM",44,0)
 W ?32,$J(+$E(NX,6,7),2),"-",$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",+$E(NX,4,5))
"RTN","FHPATM",45,0)
 I NX#1 S I2=+$E(NX_"0",9,10) W $J($S(I2>12:I2-12,1:I2),3),":",$E(NX_"000",11,12),$S(I2>11:"pm",1:"am")
"RTN","FHPATM",46,0)
 W ?48,FW,?65,TW W:NOWRD="*" ?79,NOWRD Q
"RTN","FHPATM",47,0)
GET S (FW,FR)="" I NOD="ATT3" S (TW,TR)="" D LST G G1
"RTN","FHPATM",48,0)
 S TW=$P(X1,"^",6),TR=$P(X1,"^",7) I NOD="ATT1" Q:'TW  S NOWRD=$O(^FH(119.6,"AW",TW,0)) S:'NOWRD NOWRD="*" G G1
"RTN","FHPATM",49,0)
 S FW=TW,FR=TR
"RTN","FHPATM",50,0)
 I "^1^2^3^25^26^43^45^"[("^"_XT_"^") S TW=$S(XT=2!(XT=26):"AUTH LEAVE",XT=3!(XT=25):"UA LEAVE",XT=1:"ON PASS",XT=43!(XT=45):"ASIH OTHER",1:TW),TR=""
"RTN","FHPATM",51,0)
 I "^22^23^24^25^26^44^"[("^"_XT_"^") S FW=$S(XT=24!(XT=25):"AUTH LEAVE",XT=22!(XT=26):"UA LEAVE",XT=23:"PASS",XT=44:"ASIH OTHER",1:FW),FR=""
"RTN","FHPATM",52,0)
 I "^4^13^14^45^"[("^"_XT_"^") D LST
"RTN","FHPATM",53,0)
G1 S:FW FH7R=$P($G(^DIC(42,FW,0)),"^",11) I 'FH7R,TW S FH7R=$P($G(^DIC(42,TW,0)),"^",11)
"RTN","FHPATM",54,0)
 S:FW FW=$O(^FH(119.6,"AW",FW,0)) S:FW FW=$P($G(^FH(119.6,FW,0)),U) S SW=TW S:TW TW=$O(^FH(119.6,"AW",TW,0))
"RTN","FHPATM",55,0)
 I TW S TW=$P($G(^FH(119.6,TW,0)),U)
"RTN","FHPATM",56,0)
 E  S:SW TW=$P(^DIC(42,SW,0),U),NOWRD="*"
"RTN","FHPATM",57,0)
 S:FR FR=$P(^DG(405.4,FR,0),"^",1) S:TR TR=$P(^DG(405.4,TR,0),"^",1)
"RTN","FHPATM",58,0)
 S FW=FW_" "_FR,TW=TW_" "_TR Q  ;S FW=$E(FW,1,14-$L(FR))_" "_FR,TW=$E(TW,1,14-$L(TR))_" "_TR Q
"RTN","FHPATM",59,0)
LST S TRN=9999999.9999999-$E(NX,1,14)
"RTN","FHPATM",60,0)
 F TRN=TRN:0 S TRN=$O(^DGPM("APID",DFN,TRN)) Q:TRN=""  F T0=0:0 S T0=$O(^DGPM("APID",DFN,TRN,T0)) Q:T0=""  I T0'=DA S X=$G(^DGPM(T0,0)),FW=$P(X,"^",6),FR=$P(X,"^",7) G:FW L1
"RTN","FHPATM",61,0)
L1 S:"^43^45^"[("^"_$P(X,"^",18)_"^") FR="",FW="ASIH OTHER" Q
"RTN","FHPATM",62,0)
NOTE W !!,"* Denotes that there is no associated Ward in the Dietetic Ward File!" Q
"RTN","FHPATM",63,0)
KIL G KILL^XUSCLEAN
"RTN","FHWADM")
0^2^B26331626^B26287048
"RTN","FHWADM",1,0)
FHWADM ; HISC/REL - Set up admission ;12/4/00  10:35
"RTN","FHWADM",2,0)
 ;;5.5;DIETETICS;**5,8,21**;Jan 28, 2005;Build 6
"RTN","FHWADM",3,0)
 ; Changes necessary for new file #115 design:
"RTN","FHWADM",4,0)
 ; The .01 (1 piece of 0 node) for inpatients is now "P"_DFN (ie P7623)
"RTN","FHWADM",5,0)
 ; Therefore this file is no longer DINUMed to file #2.
"RTN","FHWADM",6,0)
 N FHWF S FHWF=$S($D(^ORD(101)):1,1:0)
"RTN","FHWADM",7,0)
 S FHZ115="P"_DFN D ADD^FHOMDPA
"RTN","FHWADM",8,0)
 I '$D(^FHPT(FHDFN,"A",0)) S ^FHPT(FHDFN,"A",0)="^115.01^^"
"RTN","FHWADM",9,0)
 D UPALFP  ;update food pref's based on allergy data
"RTN","FHWADM",10,0)
 D OPM  ;cancel any existing outpatient meals
"RTN","FHWADM",11,0)
 D NOW^%DTC S (FHNOW,FHX3,X)=$S($D(^DGPM(ADM,0)):$P(^(0),"^",1),1:%)
"RTN","FHWADM",12,0)
 I $D(^FHPT(FHDFN,"A",ADM)) S $P(^(ADM,0),"^",1)=X G:$G(^DPT(DFN,.105))'=ADM KIL G UPD
"RTN","FHWADM",13,0)
 S $P(^FHPT(FHDFN,"A",0),"^",3)=ADM,$P(^(0),"^",4)=$P(^(0),"^",4)+1
"RTN","FHWADM",14,0)
 S ^FHPT(FHDFN,"A",ADM,0)=X_"^^^^^^^^"
"RTN","FHWADM",15,0)
 S FHX1=$G(^DPT(DFN,.108)),FHX2=""
"RTN","FHWADM",16,0)
 I FHX1 S FHX1=$O(^FH(119.6,"AR",FHX1,0))
"RTN","FHWADM",17,0)
 I 'FHX1  S FHX1=$G(^DPT(DFN,.1)) I FHX1'="" S FHX1=$O(^DIC(42,"B",FHX1,0)) S:FHX1 FHX1=$O(^FH(119.6,"AW",FHX1,0))
"RTN","FHWADM",18,0)
 S FHX1=$G(^FH(119.6,+FHX1,0))
"RTN","FHWADM",19,0)
 S FHX2=$P(FHX1,"^",16),FHX1=$P(FHX1,"^",15) I 'FHX1,FHX2'="Y" G UPD
"RTN","FHWADM",20,0)
 S X=$S(FHX3>%:FHX3,1:%)
"RTN","FHWADM",21,0)
 S ^FHPT(FHDFN,"A",ADM,"AC",X,0)=X_"^1",^FHPT(FHDFN,"A",ADM,"AC",0)="^115.14^"_X_"^1",^FHPT(FHDFN,"A",ADM,"DI",0)="^115.02A^1^1"
"RTN","FHWADM",22,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",2)=1
"RTN","FHWADM",23,0)
 I 'FHX1 S ^FHPT(FHDFN,"A",ADM,"DI",1,0)="1^^^^^^X^^"_X_"^^"_DUZ_"^"_% S EVT="D^O^1" D ^FHORX G UPD
"RTN","FHWADM",24,0)
 S FHX2=$P($G(^FH(111,FHX1,0)),"^",5)
"RTN","FHWADM",25,0)
 S ^FHPT(FHDFN,"A",ADM,"DI",1,0)="1^"_FHX1_"^^^^^^T^"_X_"^^"_DUZ_"^"_%_"^"_FHX2
"RTN","FHWADM",26,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",5)="T" S EVT="D^O^1" D ^FHORX
"RTN","FHWADM",27,0)
 I 'FHWF S FHOR=FHX1_"^^^^" D ADD K FHOR G UPD
"RTN","FHWADM",28,0)
 S FHNEW="D;"_ADM_";"_1_";"_X_";;;;T;;"_FHX1_";;;;",D1=X,D2="" D NOW^%DTC S NOW=%,FHPV=DUZ,FHOR=FHX1_"^^^^" D DO^FHWOR2
"RTN","FHWADM",29,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",14)="" D WRD D MSG^XQOR("FH EVSEND OR",.MSG) K D1,D2,FHPV,FHNEW,MSG,NOW S $P(^FHPT(FHDFN,"A",ADM,"DI",1,0),"^",15)=6 D ADD K FHOR G KIL
"RTN","FHWADM",30,0)
UPD S $P(^FHPT(FHDFN,"A",ADM,0),"^",14)="" D WRD G KIL
"RTN","FHWADM",31,0)
WRD ; Update Room/Bed & Ward for current admission
"RTN","FHWADM",32,0)
 N FHWRD,FHRMB,WARD D DID^FHDPA Q:WARD=""  S ADM=$G(^DPT("CN",WARD,DFN)) Q:'ADM
"RTN","FHWADM",33,0)
 I '$D(^FHPT(FHDFN,"A",ADM,0)) Q
"RTN","FHWADM",34,0)
 S WARD=$P(^FHPT(FHDFN,"A",ADM,0),"^",8),EVT="L^"_$S(WARD:"T",1:"A")_"^^"_WARD_"~"_$P(^(0),"^",9) I WARD'=FHWRD G NEW
"RTN","FHWADM",35,0)
 I $P(^FHPT(FHDFN,"A",ADM,0),"^",9)'=FHRMB S $P(^(0),"^",9)=FHRMB S EVT=EVT_"~"_FHWRD_"~"_FHRMB D ^FHORX
"RTN","FHWADM",36,0)
 Q
"RTN","FHWADM",37,0)
NEW ; New Ward
"RTN","FHWADM",38,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",8,9)=FHWRD_"^"_FHRMB
"RTN","FHWADM",39,0)
 K:WARD ^FHPT("AW",WARD,FHDFN) I FHWRD S ^FHPT("AW",FHWRD,FHDFN)=ADM S EVT=EVT_"~"_FHWRD_"~"_FHRMB D ^FHORX
"RTN","FHWADM",40,0)
 ; Update Type of Service
"RTN","FHWADM",41,0)
 S FHX3=$P($G(^FH(119.6,+FHWRD,0)),"^",10) S:FHX3="" FHX3="TCD" I FHX3[$P(^FHPT(FHDFN,"A",ADM,0),"^",5) Q
"RTN","FHWADM",42,0)
 S FHX3=$S($L(FHX3)=1:FHX3,FHX3["D":"D",1:"C"),$P(^FHPT(FHDFN,"A",ADM,0),"^",5)=FHX3
"RTN","FHWADM",43,0)
 S FHX2=$P(^FHPT(FHDFN,"A",ADM,0),"^",2) I FHX2,$P($G(^FHPT(FHDFN,"A",ADM,"DI",+FHX2,0)),"^",8)'="" S $P(^(0),"^",8)=FHX3
"RTN","FHWADM",44,0)
 Q
"RTN","FHWADM",45,0)
ADD ; Add diet associated Diet Restriction
"RTN","FHWADM",46,0)
 D NOW^%DTC S NOW=%
"RTN","FHWADM",47,0)
 S DPAT=$O(^FH(111.1,"AB",FHOR,0))
"RTN","FHWADM",48,0)
 D UPD^FHMTK7
"RTN","FHWADM",49,0)
 K COM,DPAT,EVT,FP,L,LN,LP,LS,M,M1,M2,MEAL,N,NM,NO,NUM,NX,OPAT,P,PP,PNN,PNO,R1,SF,SP,X3,^TMP($J),Z
"RTN","FHWADM",50,0)
 Q
"RTN","FHWADM",51,0)
UPALFP ;Update Food Preferences for all Patient's based on Allergies
"RTN","FHWADM",52,0)
 I FHDFN="" Q
"RTN","FHWADM",53,0)
 K FHMISS D ALG^FHCLN I '$O(^TMP($J,"FHGMRAL","")) Q
"RTN","FHWADM",54,0)
 F FHGMRN=0:0 S FHGMRN=$O(^TMP($J,"FHGMRAL",FHGMRN)) Q:FHGMRN=""  D UPDFP^FHWGMR
"RTN","FHWADM",55,0)
 K ^TMP($J,"FHGMRAL"),^TMP($J,"FHMISS"),FHGMRN,FHMSAL,FHMSFP,FHMSPT
"RTN","FHWADM",56,0)
 Q
"RTN","FHWADM",57,0)
OPM ; Delete any future outpatient meals orders upon patient admission
"RTN","FHWADM",58,0)
 I '$D(^FHPT(FHDFN,"OP")),'$D(^FHPT(FHDFN,"SM")),'$D(^FHPT(FHDFN,"GM")) Q
"RTN","FHWADM",59,0)
 S X1=DT,X2=-1 D C^%DTC S FHDT=X_.999
"RTN","FHWADM",60,0)
 F FHRMDT=FHDT:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  D CANRM
"RTN","FHWADM",61,0)
 F FHSM=FHDT:0 S FHSM=$O(^FHPT(FHDFN,"SM",FHSM)) Q:FHSM'>0  D CANSM
"RTN","FHWADM",62,0)
 F FHGM=FHDT:0 S FHGM=$O(^FHPT(FHDFN,"GM",FHGM)) Q:FHGM'>0  D CANGM
"RTN","FHWADM",63,0)
 Q
"RTN","FHWADM",64,0)
CANRM ;
"RTN","FHWADM",65,0)
 D CANRM^FHOMRC1
"RTN","FHWADM",66,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,12)
"RTN","FHWADM",67,0)
 S FHMPNUM=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,6)
"RTN","FHWADM",68,0)
 S FHDT2=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,1)
"RTN","FHWADM",69,0)
 S FILL="R;"_FHMPNUM_";"_FHDT2_";"_FHDT2_";;"
"RTN","FHWADM",70,0)
 D CAN
"RTN","FHWADM",71,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,1)) D CNAO100,CANAO^FHOMRC1
"RTN","FHWADM",72,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) D CNEL100,CANEL^FHOMRC1
"RTN","FHWADM",73,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,3)) D CNTF100,CANTF^FHOMRC1
"RTN","FHWADM",74,0)
 Q
"RTN","FHWADM",75,0)
CNAO100 ;Backdoor message to update file #100 with AO cancel order
"RTN","FHWADM",76,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,1)),U,4),FILL="A;"_FHRNUM D CAN Q
"RTN","FHWADM",77,0)
CNEL100 ;Backdoor message to update file #100 with EL cancel order
"RTN","FHWADM",78,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,2)),U,5),FILL="E;"_FHRNUM D CAN Q
"RTN","FHWADM",79,0)
CNTF100 ;Backdoor message to update file #100 with TF cancel order
"RTN","FHWADM",80,0)
 S FHORN=$P($G(^FHPT(FHDFN,"OP",FHRNUM,3)),U,4),FILL="T;"_FHRNUM D CAN Q
"RTN","FHWADM",81,0)
 ;
"RTN","FHWADM",82,0)
CANSM ;
"RTN","FHWADM",83,0)
 S FHSTAT="C",(DA,FHDA)=FHSM,DA(1)=FHDFN
"RTN","FHWADM",84,0)
 I $G(FHORN)="" S FHORN=$P($G(^FHPT(FHDFN,"SM",FHDA,0)),U,12)
"RTN","FHWADM",85,0)
 I '$D(^FHPT(DA(1),"SM",DA,0)) Q
"RTN","FHWADM",86,0)
 S DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHWADM",87,0)
 S DR="1////^S X=FHSTAT;14////^S X=FHORN;11.5////^S X=FHSTAT" D ^DIE
"RTN","FHWADM",88,0)
 S FHZN=$G(^FHPT(FHDFN,"SM",FHDA,0))
"RTN","FHWADM",89,0)
 S FHACT="C",FHOPTY="S",FHOPDT=FHDA D SETSM^FHOMRO2
"RTN","FHWADM",90,0)
CNSM100 ;Backdoor message to update file #100 with SM cancel order
"RTN","FHWADM",91,0)
 S FHORN=$P($G(^FHPT(FHDFN,"SM",FHDA,0)),U,12),FILL="S;"_FHDA D CAN
"RTN","FHWADM",92,0)
 ;if an SM E/L Tray exists cancel that too:
"RTN","FHWADM",93,0)
CNSMEL S FHORN=$P($G(^FHPT(FHDFN,"SM",FHDA,1)),U,4) I FHORN="" Q
"RTN","FHWADM",94,0)
 S FILL="G;"_FHDA D CAN Q
"RTN","FHWADM",95,0)
 ;
"RTN","FHWADM",96,0)
CANGM ;
"RTN","FHWADM",97,0)
 S FHSTAT="C",(DA,FHDA)=FHGM,DA(1)=FHDFN
"RTN","FHWADM",98,0)
 S DIE="^FHPT("_DA(1)_",""GM"","
"RTN","FHWADM",99,0)
 S DR="8////^S X=FHSTAT;9////^S X=DUZ" D ^DIE
"RTN","FHWADM",100,0)
 S FHZN=$G(^FHPT(FHDFN,"GM",FHDA,0))
"RTN","FHWADM",101,0)
 S FHACT="C",FHOPTY="G",FHOPDT=FHDA D SETGM^FHOMRO2 ;set event
"RTN","FHWADM",102,0)
 Q
"RTN","FHWADM",103,0)
CAN ;
"RTN","FHWADM",104,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHWADM",105,0)
 D MSHCA^FHOMUTL,EVSEND^FHWOR
"RTN","FHWADM",106,0)
 Q
"RTN","FHWADM",107,0)
KIL ;
"RTN","FHWADM",108,0)
 K %,%H,%I,DIC,DIE,DIR,FHDT,FHDT2,FHRMDT,FHRNUM,FHNOW,FHX1,FHX2,FHX3
"RTN","FHWADM",109,0)
 K FHRMB,FHWRD,X Q
"VER")
8.0^22.0
"BLD",7968,6)
^23
**END**
**END**
