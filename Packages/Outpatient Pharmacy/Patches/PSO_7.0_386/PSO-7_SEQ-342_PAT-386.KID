Released PSO*7*386 SEQ #342
Extracted from mail message
**KIDS**:PSO*7.0*386^

**INSTALL NAME**
PSO*7.0*386
"BLD",8411,0)
PSO*7.0*386^OUTPATIENT PHARMACY^0^3120724^y
"BLD",8411,1,0)
^^139^139^3120724^
"BLD",8411,1,1,0)
The Pharmacy Legacy Enhancements (PLE) Increment 9 Release includes the 
"BLD",8411,1,2,0)
following modifications to the Outpatient Pharmacy V. 7.0 application:
"BLD",8411,1,3,0)
 
"BLD",8411,1,4,0)
1. Prescription HOLD/UNHOLD Functionality
"BLD",8411,1,5,0)
   --------------------------------------
"BLD",8411,1,6,0)
   a.  The HOLD REASON field (#99) of the PRESCRIPTION file (#52) has the
"BLD",8411,1,7,0)
       following set of codes, which is presented to the PSORPH key holder
"BLD",8411,1,8,0)
       during prescription 'HOLD' process:
"BLD",8411,1,9,0)
 
"BLD",8411,1,10,0)
       '1 INSUFFICIENT QTY IN STOCK'
"BLD",8411,1,11,0)
       '2 DRUG-DRUG INTERACTION'
"BLD",8411,1,12,0)
       '3 PATIENT REACTION'
"BLD",8411,1,13,0)
       '4 PHYSICIAN TO BE CONTACTED'
"BLD",8411,1,14,0)
       '5 ALLERGY REACTIONS'
"BLD",8411,1,15,0)
       '6 DRUG REACTION'
"BLD",8411,1,16,0)
       '7 BAD ADDRESS'
"BLD",8411,1,17,0)
       '8 PER PATIENT REQUEST'
"BLD",8411,1,18,0)
       '99 OTHER--SEE COMMENTS'
"BLD",8411,1,19,0)
  
"BLD",8411,1,20,0)
        As per the recommendation of the Pharmacy User Group the 
"BLD",8411,1,21,0)
        following changes were made to the set of codes:
"BLD",8411,1,22,0)
 
"BLD",8411,1,23,0)
        The following new codes were added:
"BLD",8411,1,24,0)
        '9 CONSULT/PRIOR APPROVAL NEEDED'
"BLD",8411,1,25,0)
        '98 OTHER/TECH (NON-CLINICAL)'
"BLD",8411,1,26,0)
        
"BLD",8411,1,27,0)
        The following code descriptions were modified:
"BLD",8411,1,28,0)
        '4 PHYSICIAN TO BE CONTACTED' to '4 PROVIDER TO BE CONTACTED'
"BLD",8411,1,29,0)
        '6 DRUG REACTION' to '6 ADVERSE DRUG REACTION'
"BLD",8411,1,30,0)
        '99 OTHER--SEE COMMENTS' to 'OTHER/RPH (CLINICAL)'
"BLD",8411,1,31,0)
 
"BLD",8411,1,32,0)
        The following codes were removed as they were redundant and code
"BLD",8411,1,33,0)
        '6 ADVERSE DRUG REACTION' to be used in its place:
"BLD",8411,1,34,0)
        '3 PATIENT REACTION' 
"BLD",8411,1,35,0)
        '5 ALLERGY REACTIONS' 
"BLD",8411,1,36,0)
 
"BLD",8411,1,37,0)
        Note:
"BLD",8411,1,38,0)
        A post-install routine has been included in this patch that will
"BLD",8411,1,39,0)
        convert the historical data of codes '3' and '5' to code '6'. 
"BLD",8411,1,40,0)
 
"BLD",8411,1,41,0)
        On complete installation of this patch, the HOLD REASON field 
"BLD",8411,1,42,0)
        (#99) of the PRESCRIPTION file (#52) will have the following set
"BLD",8411,1,43,0)
        of codes:
"BLD",8411,1,44,0)
        '1 INSUFFICIENT QTY IN STOCK'
"BLD",8411,1,45,0)
        '2 DRUG-DRUG INTERACTION'
"BLD",8411,1,46,0)
        '4 PROVIDER TO BE CONTACTED'
"BLD",8411,1,47,0)
        '6 ADVERSE DRUG REACTION'
"BLD",8411,1,48,0)
        '7 BAD ADDRESS'
"BLD",8411,1,49,0)
        '8 PER PATIENT REQUEST'
"BLD",8411,1,50,0)
        '9 CONSULT/PRIOR APPROVAL NEEDED'
"BLD",8411,1,51,0)
        '98 OTHER/TECH (NON-CLINICAL)'
"BLD",8411,1,52,0)
        '99 OTHER/RPH (CLINICAL)'
"BLD",8411,1,53,0)
 
"BLD",8411,1,54,0)
   b. New Security Key PSO TECH ADV for pharmacy technicians
"BLD",8411,1,55,0)
      A new security key called PSO TECH ADV has been created, which 
"BLD",8411,1,56,0)
      will allow a user to HOLD a prescription using one of the following
"BLD",8411,1,57,0)
      HOLD reasons, which are a subset of the hold reasons that are
"BLD",8411,1,58,0)
      available to the PSORPH key holders in item (a) above:
"BLD",8411,1,59,0)
 
"BLD",8411,1,60,0)
      '1 INSUFFICIENT QTY IN STOCK'
"BLD",8411,1,61,0)
      '7 BAD ADDRESS'
"BLD",8411,1,62,0)
      '8 PER PATIENT REQUEST'
"BLD",8411,1,63,0)
      '98 OTHER/TECH (NON-CLINICAL)'
"BLD",8411,1,64,0)
 
"BLD",8411,1,65,0)
      The PSO TECH ADV key holders will be able to remove a prescription
"BLD",8411,1,66,0)
      from HOLD only for the above hold reasons whether they were put 
"BLD",8411,1,67,0)
      on HOLD by the PSORPH key holder or by the PSO TECH ADV key holder.
"BLD",8411,1,68,0)
 
"BLD",8411,1,69,0)
   c. UNHOLD Comments
"BLD",8411,1,70,0)
      The UNHOLD action has been modified to display the original hold 
"BLD",8411,1,71,0)
      reason along with the hold comments (if any) as seen in the example
"BLD",8411,1,72,0)
      below:
"BLD",8411,1,73,0)
      
"BLD",8411,1,74,0)
+---------------------------------------------------------------------+
"BLD",8411,1,75,0)
| Select Action: Next Screen// UH   UH  UNHOLD                        |
"BLD",8411,1,76,0)
| Nature of Order: WRITTEN//        W                                 |
"BLD",8411,1,77,0)
|                                                                     |
"BLD",8411,1,78,0)
| HOLD COMMENTS: HOLD COMMENTS ENTERED BY THE USER MANUALLY. (REASON: |
"BLD",8411,1,79,0)
|                BAD ADDRESS) on MAY 10, 2012                         |
"BLD",8411,1,80,0)
|                                                                     |
"BLD",8411,1,81,0)
| UNHOLD COMMENTS:                                                    |
"BLD",8411,1,82,0)
+---------------------------------------------------------------------+
"BLD",8411,1,83,0)
 
"BLD",8411,1,84,0)
   d. Rx Activity Log
"BLD",8411,1,85,0)
      All activities related to HOLD/UNHOLD action on a prescription will
"BLD",8411,1,86,0)
      be captured in the activity log as seen below:
"BLD",8411,1,87,0)
 
"BLD",8411,1,88,0)
     
"BLD",8411,1,89,0)
+---------------------------------------------------------------------+
"BLD",8411,1,90,0)
| Activity Log:                                                       |
"BLD",8411,1,91,0)
| #   Date        Reason         Rx Ref         Initiator Of Activity |
"BLD",8411,1,92,0)
| ...                                                                 |
"BLD",8411,1,93,0)
| 8   05/10/12    HOLD           REFILL 1       USER,PHARMACY         |
"BLD",8411,1,94,0)
| Comments: Rx placed on HOLD (Reason: BAD ADDRESS) and removed from  |
"BLD",8411,1,95,0)
|           SUSPENSE - HOLD COMMENTS ENTERED BY THE USER MANUALLY.    |
"BLD",8411,1,96,0)
| ...                                                                 |
"BLD",8411,1,97,0)
| 9   05/10/12    UNHOLD         REFILL 1       USER,PHARMACY         |
"BLD",8411,1,98,0)
| Comments: Rx Removed from HOLD - UNHOLD COMMENTS ENTERED BY THE USER|
"BLD",8411,1,99,0)
|           WHEN REMOVING THE RX FROM HOLD.                           |
"BLD",8411,1,100,0)
+---------------------------------------------------------------------+
"BLD",8411,1,101,0)
 
"BLD",8411,1,102,0)
 
"BLD",8411,1,103,0)
2. Flagging/Unflagging of a pending renewal order
"BLD",8411,1,104,0)
   ----------------------------------------------
"BLD",8411,1,105,0)
   The flagging/unflagging functionality was limited to new pending orders
"BLD",8411,1,106,0)
   only from Computerized Patient Record System (CPRS) V. 3.0. Changes
"BLD",8411,1,107,0)
   were made to extend this functionality to pending renewal orders from
"BLD",8411,1,108,0)
   CPRS as well.
"BLD",8411,1,109,0)
   Note: Flagging/Unflagging is a functionality for the pharmacist (PSORPH
"BLD",8411,1,110,0)
         key holders) only.
"BLD",8411,1,111,0)
 
"BLD",8411,1,112,0)
3. Non-holders of PSORPH key were able to unflag pending orders
"BLD",8411,1,113,0)
   ------------------------------------------------------------
"BLD",8411,1,114,0)
   The action FL (Flag/Unflag) is blocked for users without the PSORPH
"BLD",8411,1,115,0)
   key when finishing a new pending order. However, if the user selected 
"BLD",8411,1,116,0)
   FN (Finish) to finish a new flagged pending order the software was
"BLD",8411,1,117,0)
   allowing the user to unflag the pending order. This has been changed
"BLD",8411,1,118,0)
   to no longer allow non-holders of the PSORPH key to unflag pending 
"BLD",8411,1,119,0)
   orders.
"BLD",8411,1,120,0)
 
"BLD",8411,1,121,0)
4. Non PSORPH key holder access to Edit/DC actions
"BLD",8411,1,122,0)
   -----------------------------------------------
"BLD",8411,1,123,0)
   When processing pending new/renewal orders from CPRS, a non PSORPH key
"BLD",8411,1,124,0)
   holder could use the actions 'Edit' or 'Discontinue' on the order, 
"BLD",8411,1,125,0)
   which should not be allowed. This functionality has been disabled.
"BLD",8411,1,126,0)
 
"BLD",8411,1,127,0)
5. COMMENT field (#.05) in the ACTIVITY LOG sub-file (#52.3) of the 
"BLD",8411,1,128,0)
   PRESCRIPTION file (#52)
"BLD",8411,1,129,0)
   ----------------------------------------------------------------
"BLD",8411,1,130,0)
   The length of this field has been increased from 75 to 100 characters
"BLD",8411,1,131,0)
   long to accommodate HOLD and UNHOLD comments.
"BLD",8411,1,132,0)
  
"BLD",8411,1,133,0)
6. PSO52API API (Application Programming Interface)
"BLD",8411,1,134,0)
   ------------------------------------------------
"BLD",8411,1,135,0)
   This API was modified to check if the prescription's expiration date 
"BLD",8411,1,136,0)
   is in the past. If it is and the current prescription status is not
"BLD",8411,1,137,0)
   DISCONTINUED, DELETED, or EXPIRED, the API will update the prescription
"BLD",8411,1,138,0)
   status to EXPIRED. The API will also send updates to CPRS and Health
"BLD",8411,1,139,0)
   Data Repository (HDR) of the status change.
"BLD",8411,4,0)
^9.64PA^52^1
"BLD",8411,4,52,0)
52
"BLD",8411,4,52,2,0)
^9.641^52.3^2
"BLD",8411,4,52,2,52,0)
PRESCRIPTION  (File-top level)
"BLD",8411,4,52,2,52,1,0)
^9.6411^99^1
"BLD",8411,4,52,2,52,1,99,0)
HOLD REASON
"BLD",8411,4,52,2,52.3,0)
ACTIVITY LOG  (sub-file)
"BLD",8411,4,52,2,52.3,1,0)
^9.6411^.05^1
"BLD",8411,4,52,2,52.3,1,.05,0)
COMMENT
"BLD",8411,4,52,222)
y^y^p^^^^n^^n
"BLD",8411,4,52,224)

"BLD",8411,4,"APDD",52,52)

"BLD",8411,4,"APDD",52,52,99)

"BLD",8411,4,"APDD",52,52.3)

"BLD",8411,4,"APDD",52,52.3,.05)

"BLD",8411,4,"B",52,52)

"BLD",8411,6.3)
4
"BLD",8411,"ABPKG")
n
"BLD",8411,"INID")
^y
"BLD",8411,"INIT")
PSO386P
"BLD",8411,"KRN",0)
^9.67PA^779.2^20
"BLD",8411,"KRN",.4,0)
.4
"BLD",8411,"KRN",.401,0)
.401
"BLD",8411,"KRN",.402,0)
.402
"BLD",8411,"KRN",.403,0)
.403
"BLD",8411,"KRN",.5,0)
.5
"BLD",8411,"KRN",.84,0)
.84
"BLD",8411,"KRN",3.6,0)
3.6
"BLD",8411,"KRN",3.8,0)
3.8
"BLD",8411,"KRN",9.2,0)
9.2
"BLD",8411,"KRN",9.8,0)
9.8
"BLD",8411,"KRN",9.8,"NM",0)
^9.68A^12^12
"BLD",8411,"KRN",9.8,"NM",1,0)
PSOHLD^^0^B80803768
"BLD",8411,"KRN",9.8,"NM",2,0)
PSOHLDA^^0^B7186036
"BLD",8411,"KRN",9.8,"NM",3,0)
PSO52API^^0^B71395456
"BLD",8411,"KRN",9.8,"NM",4,0)
PSOLMUTL^^0^B13307787
"BLD",8411,"KRN",9.8,"NM",5,0)
PSOORRNW^^0^B20831236
"BLD",8411,"KRN",9.8,"NM",6,0)
PSOLMRN^^0^B821442
"BLD",8411,"KRN",9.8,"NM",7,0)
PSO386P^^0^B345440
"BLD",8411,"KRN",9.8,"NM",8,0)
PSOORAL2^^0^B19047765
"BLD",8411,"KRN",9.8,"NM",9,0)
PSORXVW1^^0^B71614057
"BLD",8411,"KRN",9.8,"NM",10,0)
PSORXPR1^^0^B10534780
"BLD",8411,"KRN",9.8,"NM",11,0)
PSOORNE4^^0^B81172924
"BLD",8411,"KRN",9.8,"NM",12,0)
PSOORNEW^^0^B78892061
"BLD",8411,"KRN",9.8,"NM","B","PSO386P",7)

"BLD",8411,"KRN",9.8,"NM","B","PSO52API",3)

"BLD",8411,"KRN",9.8,"NM","B","PSOHLD",1)

"BLD",8411,"KRN",9.8,"NM","B","PSOHLDA",2)

"BLD",8411,"KRN",9.8,"NM","B","PSOLMRN",6)

"BLD",8411,"KRN",9.8,"NM","B","PSOLMUTL",4)

"BLD",8411,"KRN",9.8,"NM","B","PSOORAL2",8)

"BLD",8411,"KRN",9.8,"NM","B","PSOORNE4",11)

"BLD",8411,"KRN",9.8,"NM","B","PSOORNEW",12)

"BLD",8411,"KRN",9.8,"NM","B","PSOORRNW",5)

"BLD",8411,"KRN",9.8,"NM","B","PSORXPR1",10)

"BLD",8411,"KRN",9.8,"NM","B","PSORXVW1",9)

"BLD",8411,"KRN",19,0)
19
"BLD",8411,"KRN",19,"NM",0)
^9.68A^^
"BLD",8411,"KRN",19.1,0)
19.1
"BLD",8411,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",8411,"KRN",19.1,"NM",1,0)
PSO TECH ADV^^0
"BLD",8411,"KRN",19.1,"NM","B","PSO TECH ADV",1)

"BLD",8411,"KRN",101,0)
101
"BLD",8411,"KRN",101,"NM",0)
^9.68A^9^9
"BLD",8411,"KRN",101,"NM",1,0)
PSO LM RENEW MENU^^0
"BLD",8411,"KRN",101,"NM",2,0)
PSO LM FLAG^^4^
"BLD",8411,"KRN",101,"NM",3,0)
PSO LM RENEW ACCEPT^^4^
"BLD",8411,"KRN",101,"NM",4,0)
PSO LM RENEW EDIT^^4^
"BLD",8411,"KRN",101,"NM",5,0)
PSO LM DISCONTINUE^^4^
"BLD",8411,"KRN",101,"NM",6,0)
PSO LM BYPASS^^4^
"BLD",8411,"KRN",101,"NM",7,0)
PSO LM ACCEPT^^0
"BLD",8411,"KRN",101,"NM",8,0)
PSO LM ACCEPT ORDER^^4^
"BLD",8411,"KRN",101,"NM",9,0)
PSO LM EDIT^^4^
"BLD",8411,"KRN",101,"NM","B","PSO LM ACCEPT",7)

"BLD",8411,"KRN",101,"NM","B","PSO LM ACCEPT ORDER",8)

"BLD",8411,"KRN",101,"NM","B","PSO LM BYPASS",6)

"BLD",8411,"KRN",101,"NM","B","PSO LM DISCONTINUE",5)

"BLD",8411,"KRN",101,"NM","B","PSO LM EDIT",9)

"BLD",8411,"KRN",101,"NM","B","PSO LM FLAG",2)

"BLD",8411,"KRN",101,"NM","B","PSO LM RENEW ACCEPT",3)

"BLD",8411,"KRN",101,"NM","B","PSO LM RENEW EDIT",4)

"BLD",8411,"KRN",101,"NM","B","PSO LM RENEW MENU",1)

"BLD",8411,"KRN",409.61,0)
409.61
"BLD",8411,"KRN",771,0)
771
"BLD",8411,"KRN",779.2,0)
779.2
"BLD",8411,"KRN",870,0)
870
"BLD",8411,"KRN",8989.51,0)
8989.51
"BLD",8411,"KRN",8989.52,0)
8989.52
"BLD",8411,"KRN",8994,0)
8994
"BLD",8411,"KRN","B",.4,.4)

"BLD",8411,"KRN","B",.401,.401)

"BLD",8411,"KRN","B",.402,.402)

"BLD",8411,"KRN","B",.403,.403)

"BLD",8411,"KRN","B",.5,.5)

"BLD",8411,"KRN","B",.84,.84)

"BLD",8411,"KRN","B",3.6,3.6)

"BLD",8411,"KRN","B",3.8,3.8)

"BLD",8411,"KRN","B",9.2,9.2)

"BLD",8411,"KRN","B",9.8,9.8)

"BLD",8411,"KRN","B",19,19)

"BLD",8411,"KRN","B",19.1,19.1)

"BLD",8411,"KRN","B",101,101)

"BLD",8411,"KRN","B",409.61,409.61)

"BLD",8411,"KRN","B",771,771)

"BLD",8411,"KRN","B",779.2,779.2)

"BLD",8411,"KRN","B",870,870)

"BLD",8411,"KRN","B",8989.51,8989.51)

"BLD",8411,"KRN","B",8989.52,8989.52)

"BLD",8411,"KRN","B",8994,8994)

"BLD",8411,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8411,"QUES",0)
^9.62^^
"BLD",8411,"REQB",0)
^9.611^4^4
"BLD",8411,"REQB",1,0)
PSO*7.0*385^2
"BLD",8411,"REQB",2,0)
PSO*7.0*387^2
"BLD",8411,"REQB",3,0)
PSO*7.0*384^2
"BLD",8411,"REQB",4,0)
PSO*7.0*367^2
"BLD",8411,"REQB","B","PSO*7.0*367",4)

"BLD",8411,"REQB","B","PSO*7.0*384",3)

"BLD",8411,"REQB","B","PSO*7.0*385",1)

"BLD",8411,"REQB","B","PSO*7.0*387",2)

"FIA",52)
PRESCRIPTION
"FIA",52,0)
^PSRX(
"FIA",52,0,0)
52Is
"FIA",52,0,1)
y^y^p^^^^n^^n
"FIA",52,0,10)

"FIA",52,0,11)

"FIA",52,0,"RLRO")

"FIA",52,0,"VR")
7.0^PSO
"FIA",52,52)
1
"FIA",52,52,99)

"FIA",52,52.3)
1
"FIA",52,52.3,.05)

"INIT")
PSO386P
"KRN",19.1,644,-1)
0^1
"KRN",19.1,644,0)
PSO TECH ADV^Outpatient Pharmacy Technician
"KRN",19.1,644,1,0)
^19.11^1^1^3120718^^^^
"KRN",19.1,644,1,1,0)
This security key should be used by pharmacy technicians to HOLD and UNHOLD prescriptions using a subset of the HOLD reasons available to PSORPH key holders.
"KRN",101,3781,-1)
4^5
"KRN",101,3781,0)
PSO LM DISCONTINUE
"KRN",101,3792,-1)
4^6
"KRN",101,3792,0)
PSO LM BYPASS
"KRN",101,3794,-1)
4^9
"KRN",101,3794,0)
PSO LM EDIT
"KRN",101,3802,-1)
0^7
"KRN",101,3802,0)
PSO LM ACCEPT^ACCEPT ORDER FOR FINISH^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3802,4)
25^3
"KRN",101,3802,10,0)
^101.01PA^3^3
"KRN",101,3802,10,1,0)
3794^ED^21^
"KRN",101,3802,10,1,"^")
PSO LM EDIT
"KRN",101,3802,10,2,0)
3803^AC^11^
"KRN",101,3802,10,2,"^")
PSO LM ACCEPT ORDER
"KRN",101,3802,10,3,0)
3781^DC^31^
"KRN",101,3802,10,3,"^")
PSO LM DISCONTINUE
"KRN",101,3802,15)

"KRN",101,3802,24)
I $$ACTIONS1^PSOLMUTL
"KRN",101,3802,26)
D A^PSOORUT3,SHOW^VALM S:$G(PSOACT)["E" XQORM("#")=$O(^ORD(101,"B","PSO LM PENDING EDIT",0))_"^1:15" S:XQORM("B")="Quit" XQORM("B")="Edit"
"KRN",101,3802,99)
60100,54840
"KRN",101,3803,-1)
4^8
"KRN",101,3803,0)
PSO LM ACCEPT ORDER
"KRN",101,3812,-1)
4^4
"KRN",101,3812,0)
PSO LM RENEW EDIT
"KRN",101,3813,-1)
4^3
"KRN",101,3813,0)
PSO LM RENEW ACCEPT
"KRN",101,3814,-1)
0^1
"KRN",101,3814,0)
PSO LM RENEW MENU^Rx Renew^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3814,4)
26
"KRN",101,3814,10,0)
^101.01PA^5^5
"KRN",101,3814,10,1,0)
3813^AC^^
"KRN",101,3814,10,1,"^")
PSO LM RENEW ACCEPT
"KRN",101,3814,10,2,0)
3812^ED^^
"KRN",101,3814,10,2,"^")
PSO LM RENEW EDIT
"KRN",101,3814,10,3,0)
3781^DC^^
"KRN",101,3814,10,3,"^")
PSO LM DISCONTINUE
"KRN",101,3814,10,4,0)
3792^BY^^
"KRN",101,3814,10,4,"^")
PSO LM BYPASS
"KRN",101,3814,10,5,0)
5658^FL^^
"KRN",101,3814,10,5,"^")
PSO LM FLAG
"KRN",101,3814,15)
K PSOLM
"KRN",101,3814,20)
S PSOLM=1
"KRN",101,3814,24)
I $$PKIACT^PSOLMUTL
"KRN",101,3814,26)
D A^PSOORUT3,SHOW^VALM S:$G(PSOACT)["E" XQORM("#")=$O(^ORD(101,"B","PSO LM RNEW EDIT",0))_"^1:"_$S($G(PSOREEDT):10,1:8)
"KRN",101,3814,99)
62607,43308
"KRN",101,5658,-1)
4^2
"KRN",101,5658,0)
PSO LM FLAG
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
386^3120724^10000000058
"PKG",141,22,1,"PAH",1,1,0)
^^139^139^3120724
"PKG",141,22,1,"PAH",1,1,1,0)
The Pharmacy Legacy Enhancements (PLE) Increment 9 Release includes the 
"PKG",141,22,1,"PAH",1,1,2,0)
following modifications to the Outpatient Pharmacy V. 7.0 application:
"PKG",141,22,1,"PAH",1,1,3,0)
 
"PKG",141,22,1,"PAH",1,1,4,0)
1. Prescription HOLD/UNHOLD Functionality
"PKG",141,22,1,"PAH",1,1,5,0)
   --------------------------------------
"PKG",141,22,1,"PAH",1,1,6,0)
   a.  The HOLD REASON field (#99) of the PRESCRIPTION file (#52) has the
"PKG",141,22,1,"PAH",1,1,7,0)
       following set of codes, which is presented to the PSORPH key holder
"PKG",141,22,1,"PAH",1,1,8,0)
       during prescription 'HOLD' process:
"PKG",141,22,1,"PAH",1,1,9,0)
 
"PKG",141,22,1,"PAH",1,1,10,0)
       '1 INSUFFICIENT QTY IN STOCK'
"PKG",141,22,1,"PAH",1,1,11,0)
       '2 DRUG-DRUG INTERACTION'
"PKG",141,22,1,"PAH",1,1,12,0)
       '3 PATIENT REACTION'
"PKG",141,22,1,"PAH",1,1,13,0)
       '4 PHYSICIAN TO BE CONTACTED'
"PKG",141,22,1,"PAH",1,1,14,0)
       '5 ALLERGY REACTIONS'
"PKG",141,22,1,"PAH",1,1,15,0)
       '6 DRUG REACTION'
"PKG",141,22,1,"PAH",1,1,16,0)
       '7 BAD ADDRESS'
"PKG",141,22,1,"PAH",1,1,17,0)
       '8 PER PATIENT REQUEST'
"PKG",141,22,1,"PAH",1,1,18,0)
       '99 OTHER--SEE COMMENTS'
"PKG",141,22,1,"PAH",1,1,19,0)
  
"PKG",141,22,1,"PAH",1,1,20,0)
        As per the recommendation of the Pharmacy User Group the 
"PKG",141,22,1,"PAH",1,1,21,0)
        following changes were made to the set of codes:
"PKG",141,22,1,"PAH",1,1,22,0)
 
"PKG",141,22,1,"PAH",1,1,23,0)
        The following new codes were added:
"PKG",141,22,1,"PAH",1,1,24,0)
        '9 CONSULT/PRIOR APPROVAL NEEDED'
"PKG",141,22,1,"PAH",1,1,25,0)
        '98 OTHER/TECH (NON-CLINICAL)'
"PKG",141,22,1,"PAH",1,1,26,0)
        
"PKG",141,22,1,"PAH",1,1,27,0)
        The following code descriptions were modified:
"PKG",141,22,1,"PAH",1,1,28,0)
        '4 PHYSICIAN TO BE CONTACTED' to '4 PROVIDER TO BE CONTACTED'
"PKG",141,22,1,"PAH",1,1,29,0)
        '6 DRUG REACTION' to '6 ADVERSE DRUG REACTION'
"PKG",141,22,1,"PAH",1,1,30,0)
        '99 OTHER--SEE COMMENTS' to 'OTHER/RPH (CLINICAL)'
"PKG",141,22,1,"PAH",1,1,31,0)
 
"PKG",141,22,1,"PAH",1,1,32,0)
        The following codes were removed as they were redundant and code
"PKG",141,22,1,"PAH",1,1,33,0)
        '6 ADVERSE DRUG REACTION' to be used in its place:
"PKG",141,22,1,"PAH",1,1,34,0)
        '3 PATIENT REACTION' 
"PKG",141,22,1,"PAH",1,1,35,0)
        '5 ALLERGY REACTIONS' 
"PKG",141,22,1,"PAH",1,1,36,0)
 
"PKG",141,22,1,"PAH",1,1,37,0)
        Note:
"PKG",141,22,1,"PAH",1,1,38,0)
        A post-install routine has been included in this patch that will
"PKG",141,22,1,"PAH",1,1,39,0)
        convert the historical data of codes '3' and '5' to code '6'. 
"PKG",141,22,1,"PAH",1,1,40,0)
 
"PKG",141,22,1,"PAH",1,1,41,0)
        On complete installation of this patch, the HOLD REASON field 
"PKG",141,22,1,"PAH",1,1,42,0)
        (#99) of the PRESCRIPTION file (#52) will have the following set
"PKG",141,22,1,"PAH",1,1,43,0)
        of codes:
"PKG",141,22,1,"PAH",1,1,44,0)
        '1 INSUFFICIENT QTY IN STOCK'
"PKG",141,22,1,"PAH",1,1,45,0)
        '2 DRUG-DRUG INTERACTION'
"PKG",141,22,1,"PAH",1,1,46,0)
        '4 PROVIDER TO BE CONTACTED'
"PKG",141,22,1,"PAH",1,1,47,0)
        '6 ADVERSE DRUG REACTION'
"PKG",141,22,1,"PAH",1,1,48,0)
        '7 BAD ADDRESS'
"PKG",141,22,1,"PAH",1,1,49,0)
        '8 PER PATIENT REQUEST'
"PKG",141,22,1,"PAH",1,1,50,0)
        '9 CONSULT/PRIOR APPROVAL NEEDED'
"PKG",141,22,1,"PAH",1,1,51,0)
        '98 OTHER/TECH (NON-CLINICAL)'
"PKG",141,22,1,"PAH",1,1,52,0)
        '99 OTHER/RPH (CLINICAL)'
"PKG",141,22,1,"PAH",1,1,53,0)
 
"PKG",141,22,1,"PAH",1,1,54,0)
   b. New Security Key PSO TECH ADV for pharmacy technicians
"PKG",141,22,1,"PAH",1,1,55,0)
      A new security key called PSO TECH ADV has been created, which 
"PKG",141,22,1,"PAH",1,1,56,0)
      will allow a user to HOLD a prescription using one of the following
"PKG",141,22,1,"PAH",1,1,57,0)
      HOLD reasons, which are a subset of the hold reasons that are
"PKG",141,22,1,"PAH",1,1,58,0)
      available to the PSORPH key holders in item (a) above:
"PKG",141,22,1,"PAH",1,1,59,0)
 
"PKG",141,22,1,"PAH",1,1,60,0)
      '1 INSUFFICIENT QTY IN STOCK'
"PKG",141,22,1,"PAH",1,1,61,0)
      '7 BAD ADDRESS'
"PKG",141,22,1,"PAH",1,1,62,0)
      '8 PER PATIENT REQUEST'
"PKG",141,22,1,"PAH",1,1,63,0)
      '98 OTHER/TECH (NON-CLINICAL)'
"PKG",141,22,1,"PAH",1,1,64,0)
 
"PKG",141,22,1,"PAH",1,1,65,0)
      The PSO TECH ADV key holders will be able to remove a prescription
"PKG",141,22,1,"PAH",1,1,66,0)
      from HOLD only for the above hold reasons whether they were put 
"PKG",141,22,1,"PAH",1,1,67,0)
      on HOLD by the PSORPH key holder or by the PSO TECH ADV key holder.
"PKG",141,22,1,"PAH",1,1,68,0)
 
"PKG",141,22,1,"PAH",1,1,69,0)
   c. UNHOLD Comments
"PKG",141,22,1,"PAH",1,1,70,0)
      The UNHOLD action has been modified to display the original hold 
"PKG",141,22,1,"PAH",1,1,71,0)
      reason along with the hold comments (if any) as seen in the example
"PKG",141,22,1,"PAH",1,1,72,0)
      below:
"PKG",141,22,1,"PAH",1,1,73,0)
      
"PKG",141,22,1,"PAH",1,1,74,0)
+---------------------------------------------------------------------+
"PKG",141,22,1,"PAH",1,1,75,0)
| Select Action: Next Screen// UH   UH  UNHOLD                        |
"PKG",141,22,1,"PAH",1,1,76,0)
| Nature of Order: WRITTEN//        W                                 |
"PKG",141,22,1,"PAH",1,1,77,0)
|                                                                     |
"PKG",141,22,1,"PAH",1,1,78,0)
| HOLD COMMENTS: HOLD COMMENTS ENTERED BY THE USER MANUALLY. (REASON: |
"PKG",141,22,1,"PAH",1,1,79,0)
|                BAD ADDRESS) on MAY 10, 2012                         |
"PKG",141,22,1,"PAH",1,1,80,0)
|                                                                     |
"PKG",141,22,1,"PAH",1,1,81,0)
| UNHOLD COMMENTS:                                                    |
"PKG",141,22,1,"PAH",1,1,82,0)
+---------------------------------------------------------------------+
"PKG",141,22,1,"PAH",1,1,83,0)
 
"PKG",141,22,1,"PAH",1,1,84,0)
   d. Rx Activity Log
"PKG",141,22,1,"PAH",1,1,85,0)
      All activities related to HOLD/UNHOLD action on a prescription will
"PKG",141,22,1,"PAH",1,1,86,0)
      be captured in the activity log as seen below:
"PKG",141,22,1,"PAH",1,1,87,0)
 
"PKG",141,22,1,"PAH",1,1,88,0)
     
"PKG",141,22,1,"PAH",1,1,89,0)
+---------------------------------------------------------------------+
"PKG",141,22,1,"PAH",1,1,90,0)
| Activity Log:                                                       |
"PKG",141,22,1,"PAH",1,1,91,0)
| #   Date        Reason         Rx Ref         Initiator Of Activity |
"PKG",141,22,1,"PAH",1,1,92,0)
| ...                                                                 |
"PKG",141,22,1,"PAH",1,1,93,0)
| 8   05/10/12    HOLD           REFILL 1       USER,PHARMACY         |
"PKG",141,22,1,"PAH",1,1,94,0)
| Comments: Rx placed on HOLD (Reason: BAD ADDRESS) and removed from  |
"PKG",141,22,1,"PAH",1,1,95,0)
|           SUSPENSE - HOLD COMMENTS ENTERED BY THE USER MANUALLY.    |
"PKG",141,22,1,"PAH",1,1,96,0)
| ...                                                                 |
"PKG",141,22,1,"PAH",1,1,97,0)
| 9   05/10/12    UNHOLD         REFILL 1       USER,PHARMACY         |
"PKG",141,22,1,"PAH",1,1,98,0)
| Comments: Rx Removed from HOLD - UNHOLD COMMENTS ENTERED BY THE USER|
"PKG",141,22,1,"PAH",1,1,99,0)
|           WHEN REMOVING THE RX FROM HOLD.                           |
"PKG",141,22,1,"PAH",1,1,100,0)
+---------------------------------------------------------------------+
"PKG",141,22,1,"PAH",1,1,101,0)
 
"PKG",141,22,1,"PAH",1,1,102,0)
 
"PKG",141,22,1,"PAH",1,1,103,0)
2. Flagging/Unflagging of a pending renewal order
"PKG",141,22,1,"PAH",1,1,104,0)
   ----------------------------------------------
"PKG",141,22,1,"PAH",1,1,105,0)
   The flagging/unflagging functionality was limited to new pending orders
"PKG",141,22,1,"PAH",1,1,106,0)
   only from Computerized Patient Record System (CPRS) V. 3.0. Changes
"PKG",141,22,1,"PAH",1,1,107,0)
   were made to extend this functionality to pending renewal orders from
"PKG",141,22,1,"PAH",1,1,108,0)
   CPRS as well.
"PKG",141,22,1,"PAH",1,1,109,0)
   Note: Flagging/Unflagging is a functionality for the pharmacist (PSORPH
"PKG",141,22,1,"PAH",1,1,110,0)
         key holders) only.
"PKG",141,22,1,"PAH",1,1,111,0)
 
"PKG",141,22,1,"PAH",1,1,112,0)
3. Non-holders of PSORPH key were able to unflag pending orders
"PKG",141,22,1,"PAH",1,1,113,0)
   ------------------------------------------------------------
"PKG",141,22,1,"PAH",1,1,114,0)
   The action FL (Flag/Unflag) is blocked for users without the PSORPH
"PKG",141,22,1,"PAH",1,1,115,0)
   key when finishing a new pending order. However, if the user selected 
"PKG",141,22,1,"PAH",1,1,116,0)
   FN (Finish) to finish a new flagged pending order the software was
"PKG",141,22,1,"PAH",1,1,117,0)
   allowing the user to unflag the pending order. This has been changed
"PKG",141,22,1,"PAH",1,1,118,0)
   to no longer allow non-holders of the PSORPH key to unflag pending 
"PKG",141,22,1,"PAH",1,1,119,0)
   orders.
"PKG",141,22,1,"PAH",1,1,120,0)
 
"PKG",141,22,1,"PAH",1,1,121,0)
4. Non PSORPH key holder access to Edit/DC actions
"PKG",141,22,1,"PAH",1,1,122,0)
   -----------------------------------------------
"PKG",141,22,1,"PAH",1,1,123,0)
   When processing pending new/renewal orders from CPRS, a non PSORPH key
"PKG",141,22,1,"PAH",1,1,124,0)
   holder could use the actions 'Edit' or 'Discontinue' on the order, 
"PKG",141,22,1,"PAH",1,1,125,0)
   which should not be allowed. This functionality has been disabled.
"PKG",141,22,1,"PAH",1,1,126,0)
 
"PKG",141,22,1,"PAH",1,1,127,0)
5. COMMENT field (#.05) in the ACTIVITY LOG sub-file (#52.3) of the 
"PKG",141,22,1,"PAH",1,1,128,0)
   PRESCRIPTION file (#52)
"PKG",141,22,1,"PAH",1,1,129,0)
   ----------------------------------------------------------------
"PKG",141,22,1,"PAH",1,1,130,0)
   The length of this field has been increased from 75 to 100 characters
"PKG",141,22,1,"PAH",1,1,131,0)
   long to accommodate HOLD and UNHOLD comments.
"PKG",141,22,1,"PAH",1,1,132,0)
  
"PKG",141,22,1,"PAH",1,1,133,0)
6. PSO52API API (Application Programming Interface)
"PKG",141,22,1,"PAH",1,1,134,0)
   ------------------------------------------------
"PKG",141,22,1,"PAH",1,1,135,0)
   This API was modified to check if the prescription's expiration date 
"PKG",141,22,1,"PAH",1,1,136,0)
   is in the past. If it is and the current prescription status is not
"PKG",141,22,1,"PAH",1,1,137,0)
   DISCONTINUED, DELETED, or EXPIRED, the API will update the prescription
"PKG",141,22,1,"PAH",1,1,138,0)
   status to EXPIRED. The API will also send updates to CPRS and Health
"PKG",141,22,1,"PAH",1,1,139,0)
   Data Repository (HDR) of the status change.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","PSO386P")
0^7^B345440^n/a
"RTN","PSO386P",1,0)
PSO386P ;BIR/MR - HOLD REASON conversion post-install routine; 05/31/12 1:16pm
"RTN","PSO386P",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**386**;DEC 1997;Build 4
"RTN","PSO386P",3,0)
 ;
"RTN","PSO386P",4,0)
 N RXIEN,HLDREA
"RTN","PSO386P",5,0)
 F HLDREA=3,5 D
"RTN","PSO386P",6,0)
 . S RXIEN=0
"RTN","PSO386P",7,0)
 . F  S RXIEN=$O(^PSRX("AH",HLDREA,RXIEN)) Q:'RXIEN  D
"RTN","PSO386P",8,0)
 . . I '$G(^PSRX(RXIEN,"H")) Q
"RTN","PSO386P",9,0)
 . . S $P(^PSRX(RXIEN,"H"),"^",1)=6
"RTN","PSO386P",10,0)
 . . S ^PSRX("AH",6,RXIEN)=""
"RTN","PSO386P",11,0)
 . . K ^PSRX("AH",HLDREA,RXIEN)
"RTN","PSO386P",12,0)
 Q
"RTN","PSO52API")
0^3^B71395456^B65813054
"RTN","PSO52API",1,0)
PSO52API ;BHAM ISC/SAB- Encap II API to return Rx data ;04/07/05 10:30 am
"RTN","PSO52API",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**213,229,252,387,386**;DEC 1997;Build 4
"RTN","PSO52API",3,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSO52API",4,0)
 ;
"RTN","PSO52API",5,0)
RX(DFN,LIST,IEN,RX,NODE,SDATE,EDATE) ;
"RTN","PSO52API",6,0)
 ;DFN: IEN from the PATIENT file (#2) [REQUIRED]
"RTN","PSO52API",7,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSO52API",8,0)
 ;IEN: Internal prescription number [optional]
"RTN","PSO52API",9,0)
 ;RX#: RX # field (#.01) of the PRESCRIPTION file (#52) [optional]
"RTN","PSO52API",10,0)
 ;NODE: Determines data elements returned [optional]
"RTN","PSO52API",11,0)
 ;SDATE: Start Date [optional]
"RTN","PSO52API",12,0)
 ;EDATE: End Date [optional]
"RTN","PSO52API",13,0)
 ;
"RTN","PSO52API",14,0)
 Q:'$G(DFN)  Q:$G(LIST)=""
"RTN","PSO52API",15,0)
 N DA,DR,PST,DIC,DIQ,ND,LK,DTE,DAT,I,X,D0 K ^TMP($J,LIST) S ^TMP($J,LIST,DFN,0)=0
"RTN","PSO52API",16,0)
 I $G(IEN) D PROCESS G CLEAN
"RTN","PSO52API",17,0)
 I $G(RX)]"",'$G(IEN) S IEN=$O(^PSRX("B",RX,0)) D  G CLEAN
"RTN","PSO52API",18,0)
 .I 'IEN S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",19,0)
 .D PROCESS
"RTN","PSO52API",20,0)
 D DATE
"RTN","PSO52API",21,0)
CLEAN F I=0:0 S I=$O(^TMP($J,LIST,DFN,I)) Q:'I  S ^TMP($J,LIST,DFN,0)=^TMP($J,LIST,DFN,0)+1
"RTN","PSO52API",22,0)
 I ^TMP($J,LIST,DFN,0)=0 S ^TMP($J,LIST,DFN,0)="-1^NO DATA FOUND"
"RTN","PSO52API",23,0)
 K DA,DR,DIC,ND,DAT,PST,LK,DIQ,DTE,I,X
"RTN","PSO52API",24,0)
 Q
"RTN","PSO52API",25,0)
PROCESS ;
"RTN","PSO52API",26,0)
 I DFN'=$P($G(^PSRX(IEN,0)),"^",2) S ^TMP($J,LIST,IEN,0)="-1^NO DATA FOUND (MISMATCHED PATIENT)" Q
"RTN","PSO52API",27,0)
 I $G(^PSRX(IEN,0))']"" S ^TMP($J,LIST,IEN,0)="-1^NO RX DATA FOUND" Q
"RTN","PSO52API",28,0)
 ;
"RTN","PSO52API",29,0)
 ; - Rx Auto Expiration
"RTN","PSO52API",30,0)
 N RXSTS,RXEXPDT
"RTN","PSO52API",31,0)
 S RXSTS=+$G(^PSRX(IEN,"STA")),RXEXPDT=$$GET1^DIQ(52,IEN,26,"I")
"RTN","PSO52API",32,0)
 I (RXSTS<11)!(RXSTS=16),(RXEXPDT<DT) D
"RTN","PSO52API",33,0)
 .S RXSTS=11 N DIE,DIC,DR,DA,STAT,PHARMST,COMM
"RTN","PSO52API",34,0)
 .S DIE=52,DA=IEN,DR="100////11" D ^DIE K DIE,DIC,DR
"RTN","PSO52API",35,0)
 .D ECAN^PSOUTL(IEN)
"RTN","PSO52API",36,0)
 .S STAT="SC",PHARMST="ZE",COMM="Medication Expired on "_$$FMTE^XLFDT(RXEXPDT,2)
"RTN","PSO52API",37,0)
 .D EN^PSOHLSN1(IEN,STAT,PHARMST,COMM)
"RTN","PSO52API",38,0)
 ; 
"RTN","PSO52API",39,0)
 I $G(NODE)']"" D ZE,TW,TH,MI,ST,RF,CM,AT,LB,PT^PSO52B,SD^PSO52B,TB^PSO52B,OI^PSO52B,MLT^PSO52B S DAT="I" D IB Q
"RTN","PSO52API",40,0)
 D ST F LK=1:1:$L(NODE,",") S DAT=$P(NODE,",",LK),ND=$P(DAT,"^") D
"RTN","PSO52API",41,0)
 .I ND=0 D ZE Q
"RTN","PSO52API",42,0)
 .I ND=2 D ZE,TW Q
"RTN","PSO52API",43,0)
 .I ND=3 D TW,TH Q
"RTN","PSO52API",44,0)
 .I ND="R" D RF Q
"RTN","PSO52API",45,0)
 .I ND="I" D IB Q
"RTN","PSO52API",46,0)
 .I ND="P" D PT^PSO52B Q
"RTN","PSO52API",47,0)
 .I ND="O" D OI^PSO52B Q
"RTN","PSO52API",48,0)
 .I ND="T" D TB^PSO52B Q
"RTN","PSO52API",49,0)
 .I ND="L" D LB Q
"RTN","PSO52API",50,0)
 .I ND="S" D SD^PSO52B Q
"RTN","PSO52API",51,0)
 .I ND="M" D MI Q
"RTN","PSO52API",52,0)
 .I ND="C" D CM Q
"RTN","PSO52API",53,0)
 .I ND="A" D AT Q
"RTN","PSO52API",54,0)
 .I ND="ST" D ST Q
"RTN","PSO52API",55,0)
 .I ND="ICD" D MLT^PSO52B Q
"RTN","PSO52API",56,0)
 .S ^TMP($J,LIST,DFN,IEN,"INVALID REQUEST",ND)="Invalid Data Requested"
"RTN","PSO52API",57,0)
 Q
"RTN","PSO52API",58,0)
ZE ;zero
"RTN","PSO52API",59,0)
 K PST S DIC=52,DA=IEN,DR=".01:9;10.3;10.6;11;16;17" D DIQ
"RTN","PSO52API",60,0)
 F DR=.01,1,2,3,4,5,6,6.5,7,8,9,10.3,10.6,11,16,17 D
"RTN","PSO52API",61,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",62,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52API",63,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",64,0)
 Q
"RTN","PSO52API",65,0)
TW ;two
"RTN","PSO52API",66,0)
 Q:'$D(^PSRX(IEN,2))
"RTN","PSO52API",67,0)
 K PST S DIC=52,DA=IEN,DR="20:31;32.1;32.2;32.3;104" D DIQ
"RTN","PSO52API",68,0)
 F DR=20,21,22,23,24,25,26,27,28,29,30,31,32.1,32.2,32.3,104 D
"RTN","PSO52API",69,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",70,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52API",71,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",72,0)
 Q
"RTN","PSO52API",73,0)
TH ;three
"RTN","PSO52API",74,0)
 Q:'$D(^PSRX(IEN,3))
"RTN","PSO52API",75,0)
 K PST S DIC=52,DA=IEN,DR="12;26.1;34.1;101;102;102.1;102.2;109;112" D DIQ
"RTN","PSO52API",76,0)
 F DR=12,26.1,34.1,101,102,102.1,102.2,109,112 D
"RTN","PSO52API",77,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",78,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")
"RTN","PSO52API",79,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",80,0)
 Q
"RTN","PSO52API",81,0)
MI ;sig
"RTN","PSO52API",82,0)
 I $P($G(^PSRX(IEN,"SIG")),"^",2) D  Q
"RTN","PSO52API",83,0)
 .I '$O(^PSRX(IEN,"SIG1",0)) S ^TMP($J,LIST,DFN,IEN,"M",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",84,0)
 .F I=0:0 S I=$O(^PSRX(IEN,"SIG1",I)) Q:'I  S ^TMP($J,LIST,DFN,IEN,"M",I,0)=^PSRX(IEN,"SIG1",I,0),^TMP($J,LIST,DFN,IEN,"M",0)=$G(^TMP($J,LIST,DFN,IEN,"M",0))+1
"RTN","PSO52API",85,0)
 I $P($G(^PSRX(IEN,"SIG")),"^")']"" S ^TMP($J,LIST,DFN,IEN,"M",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",86,0)
 S X=$P($G(^PSRX(IEN,"SIG")),"^") D SIG^PSOHELP S ^TMP($J,LIST,DFN,IEN,"M",1,0)=$E(INS1,2,9999999),^TMP($J,LIST,DFN,IEN,"M",0)=1
"RTN","PSO52API",87,0)
 K X,INS1
"RTN","PSO52API",88,0)
 Q
"RTN","PSO52API",89,0)
ST ;status
"RTN","PSO52API",90,0)
 I DT>$P(^PSRX(IEN,2),"^",6),$P(^PSRX(IEN,"STA"),"^")<11 D
"RTN","PSO52API",91,0)
 .N PSOEXRX,PSOEXSTA,ORN,PIFN,PSUSD,PRFDT,PDA,PSST
"RTN","PSO52API",92,0)
 .S PSOEXRX=IEN D EN2^PSOMAUEX K PSOEXRX,PSONM,PSONMX
"RTN","PSO52API",93,0)
 K PST S DIC=52,DA=IEN,DR=".01;100" D DIQ
"RTN","PSO52API",94,0)
 I PST(52,DA,100,"E")="DRUG INTERACTIONS" S PST(52,DA,100,"E")="NON-VERIFIED"
"RTN","PSO52API",95,0)
 S ^TMP($J,LIST,DFN,IEN,100)=PST(52,DA,100,"I")_"^"_PST(52,DA,100,"E")
"RTN","PSO52API",96,0)
 S ^TMP($J,LIST,"B",PST(52,DA,.01,"E"),IEN)=""
"RTN","PSO52API",97,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",98,0)
 Q
"RTN","PSO52API",99,0)
RF ;refill
"RTN","PSO52API",100,0)
 I '$O(^PSRX(IEN,1,0)) S ^TMP($J,LIST,DFN,IEN,"RF",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",101,0)
 I $P($G(DAT),"^",3) S DA(52.1)=$P(DAT,"^",3) D RFD K DA,DR,PST,DIC,DIQ Q
"RTN","PSO52API",102,0)
 F RF=0:0 S RF=$O(^PSRX(IEN,1,RF)) Q:'RF  S DA(52.1)=RF D RFD
"RTN","PSO52API",103,0)
 K DA,DR,PST,DIC,DIQ,RF
"RTN","PSO52API",104,0)
 Q
"RTN","PSO52API",105,0)
RFD K PST S DR(52.1)=".01:8;10.1;12;13;14;15;17",DIC=52,DA=IEN,DR=52 D DIQ
"RTN","PSO52API",106,0)
 I $P($G(DAT),"^",3),'$G(PST(52.1,DA(52.1),.01,"I")) S ^TMP($J,LIST,DFN,IEN,"RF",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",107,0)
 S ^TMP($J,LIST,DFN,IEN,"RF",0)=$G(^TMP($J,LIST,DFN,IEN,"RF",0))+1
"RTN","PSO52API",108,0)
 F DR=.01,1,1.1,1.2,2,3,4,5,6,7,8,10.1,12,13,14,15,17 D
"RTN","PSO52API",109,0)
 .I PST(52.1,DA(52.1),DR,"E")'=PST(52.1,DA(52.1),DR,"I") S ^TMP($J,LIST,DFN,IEN,"RF",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")_"^"_PST(52.1,DA(52.1),DR,"E") Q
"RTN","PSO52API",110,0)
 .S ^TMP($J,LIST,DFN,IEN,"RF",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")
"RTN","PSO52API",111,0)
 Q
"RTN","PSO52API",112,0)
IB ;ib ori
"RTN","PSO52API",113,0)
 I $P($G(DAT),"^",2)="R" D IBR Q
"RTN","PSO52API",114,0)
 I $G(^PSRX(IEN,"IB"))']"" S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",115,0)
 K PST S DIC=52,DA=IEN,DR="105;106;106.5;106.6" D DIQ
"RTN","PSO52API",116,0)
 F DR=105,106,106.5,106.6 D
"RTN","PSO52API",117,0)
 .I PST(52,DA,DR,"E")'=PST(52,DA,DR,"I") S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"I")_"^"_PST(52,DA,DR,"E") Q
"RTN","PSO52API",118,0)
 .S ^TMP($J,LIST,DFN,IEN,DR)=PST(52,DA,DR,"E")
"RTN","PSO52API",119,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",120,0)
 I $P($G(DAT),"^",2)="" D IBR Q
"RTN","PSO52API",121,0)
 Q
"RTN","PSO52API",122,0)
IBR ;ib ref
"RTN","PSO52API",123,0)
 I '$O(^PSRX(IEN,1,0)) S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",124,0)
 I $P($G(DAT),"^",2)="R",$P($G(DAT),"^",3) S DA(52.1)=$P(DAT,"^",3) D IBS K DA,DR,PST,DIC,DIQ Q
"RTN","PSO52API",125,0)
 N IB F IB=0:0 S IB=$O(^PSRX(IEN,1,IB)) Q:'IB  S DA(52.1)=IB D IBS
"RTN","PSO52API",126,0)
 I '$G(^TMP($J,LIST,DFN,IEN,"IB",0)) K ^TMP($J,LIST,DFN,IEN,"IB") S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND"
"RTN","PSO52API",127,0)
 K DA,DR,PST,DIC,DIQ,IB
"RTN","PSO52API",128,0)
 Q
"RTN","PSO52API",129,0)
IBS I $P($G(DAT),"^",3),'$G(^PSRX(IEN,1,DA(52.1),"IB")) S ^TMP($J,LIST,DFN,IEN,"IB",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",130,0)
 I '$D(^PSRX(IEN,1,DA(52.1),"IB")) S ^TMP($J,LIST,DFN,IEN,"IB",DA(52.1),0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",131,0)
 K PST S DR(52.1)="9;9.1",DIC=52,DA=IEN,DR=52 D DIQ
"RTN","PSO52API",132,0)
 S ^TMP($J,LIST,DFN,IEN,"IB",0)=$G(^TMP($J,LIST,DFN,IEN,"IB",0))+1
"RTN","PSO52API",133,0)
 F DR=9,9.1 D
"RTN","PSO52API",134,0)
 .I PST(52.1,DA(52.1),DR,"E")'=PST(52.1,DA(52.1),DR,"I") S ^TMP($J,LIST,DFN,IEN,"IB",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")_"^"_PST(52.1,DA(52.1),DR,"E") Q
"RTN","PSO52API",135,0)
 .S ^TMP($J,LIST,DFN,IEN,"IB",DA(52.1),DR)=PST(52.1,DA(52.1),DR,"I")
"RTN","PSO52API",136,0)
 Q
"RTN","PSO52API",137,0)
CM ;cmop
"RTN","PSO52API",138,0)
 I '$O(^PSRX(IEN,4,0)) S ^TMP($J,LIST,DFN,IEN,"C",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",139,0)
 N CM F CM=0:0 S CM=$O(^PSRX(IEN,4,CM)) Q:'CM  S DA(52.01)=CM D CMP
"RTN","PSO52API",140,0)
 K DA,DR,PST,DIC,DIQ,CM
"RTN","PSO52API",141,0)
 Q
"RTN","PSO52API",142,0)
CMP S ^TMP($J,LIST,DFN,IEN,"C",0)=$G(^TMP($J,LIST,DFN,IEN,"C",0))+1
"RTN","PSO52API",143,0)
 K PST S DR(52.01)="2;3;4",DIC=52,DA=IEN,DR=400 D DIQ
"RTN","PSO52API",144,0)
 F DR=2,3,4 D
"RTN","PSO52API",145,0)
 .I PST(52.01,DA(52.01),DR,"E")'=PST(52.01,DA(52.01),DR,"I") S ^TMP($J,LIST,DFN,IEN,"C",DA(52.01),DR)=PST(52.01,DA(52.01),DR,"I")_"^"_PST(52.01,DA(52.01),DR,"E") Q
"RTN","PSO52API",146,0)
 .S ^TMP($J,LIST,DFN,IEN,"C",DA(52.01),DR)=PST(52.01,DA(52.01),DR,"I")
"RTN","PSO52API",147,0)
 Q
"RTN","PSO52API",148,0)
AT ;activity log
"RTN","PSO52API",149,0)
 I '$O(^PSRX(IEN,"A",0)) S ^TMP($J,LIST,DFN,IEN,"A",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",150,0)
 N AT F AT=0:0 S AT=$O(^PSRX(IEN,"A",AT)) Q:'AT  S DA(52.3)=AT D ATP
"RTN","PSO52API",151,0)
 K DA,DR,PST,DIC,DIQ,AT
"RTN","PSO52API",152,0)
 Q
"RTN","PSO52API",153,0)
ATP K PST S DR(52.3)=".01;.02;.03;.04;.05" S DIC=52,DA=IEN,DR=40 D DIQ
"RTN","PSO52API",154,0)
 S ^TMP($J,LIST,DFN,IEN,"A",0)=$G(^TMP($J,LIST,DFN,IEN,"A",0))+1
"RTN","PSO52API",155,0)
 F DR=.01,.02,.03,.04,.05 D
"RTN","PSO52API",156,0)
 .I DR=.04 S ^TMP($J,LIST,DFN,IEN,"A",DA(52.3),DR)=PST(52.3,DA(52.3),DR,"E") Q
"RTN","PSO52API",157,0)
 .I PST(52.3,DA(52.3),DR,"E")'=PST(52.3,DA(52.3),DR,"I") S ^TMP($J,LIST,DFN,IEN,"A",DA(52.3),DR)=PST(52.3,DA(52.3),DR,"I")_"^"_PST(52.3,DA(52.3),DR,"E") Q
"RTN","PSO52API",158,0)
 .S ^TMP($J,LIST,DFN,IEN,"A",DA(52.3),DR)=PST(52.3,DA(52.3),DR,"I")
"RTN","PSO52API",159,0)
 Q
"RTN","PSO52API",160,0)
LB ;label log
"RTN","PSO52API",161,0)
 I '$O(^PSRX(IEN,"L",0)) S ^TMP($J,LIST,DFN,IEN,"L",0)="-1^NO DATA FOUND" Q
"RTN","PSO52API",162,0)
 N LB F LB=0:0 S LB=$O(^PSRX(IEN,"L",LB)) Q:'LB  S DA(52.032)=LB D LBP
"RTN","PSO52API",163,0)
 K DA,DR,PST,DIC,DIQ,LB
"RTN","PSO52API",164,0)
 Q
"RTN","PSO52API",165,0)
LBP S ^TMP($J,LIST,DFN,IEN,"L",0)=$G(^TMP($J,LIST,DFN,IEN,"L",0))+1
"RTN","PSO52API",166,0)
 K PST S DR(52.032)=".01;1;2;3;4" S DIC=52,DA=IEN,DR=32 D DIQ
"RTN","PSO52API",167,0)
 F DR=.01,1,2,3,4 D
"RTN","PSO52API",168,0)
 .I DR=1 S ^TMP($J,LIST,DFN,IEN,"L",DA(52.032),DR)=PST(52.032,DA(52.032),DR,"E") Q
"RTN","PSO52API",169,0)
 .I PST(52.032,DA(52.032),DR,"E")'=PST(52.032,DA(52.032),DR,"I") S ^TMP($J,LIST,DFN,IEN,"L",DA(52.032),DR)=PST(52.032,DA(52.032),DR,"I")_"^"_PST(52.032,DA(52.032),DR,"E") Q
"RTN","PSO52API",170,0)
 .S ^TMP($J,LIST,DFN,IEN,"L",DA(52.032),DR)=PST(52.032,DA(52.032),DR,"I")
"RTN","PSO52API",171,0)
 K DA,DR,PST,DIC,DIQ
"RTN","PSO52API",172,0)
 Q
"RTN","PSO52API",173,0)
DATE ;date range
"RTN","PSO52API",174,0)
 I $G(SDATE) S DTE=SDATE-1 D  Q
"RTN","PSO52API",175,0)
 .I $G(EDATE) D  Q
"RTN","PSO52API",176,0)
 ..F  S DTE=$O(^PS(55,DFN,"P","A",DTE)) Q:'DTE!(DTE>EDATE)  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DTE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",177,0)
 .F  S DTE=$O(^PS(55,DFN,"P","A",DTE)) Q:'DTE  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DTE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",178,0)
 I $G(EDATE),'$G(SDATE) S DTE=DT-1 D  Q
"RTN","PSO52API",179,0)
 .F  S DTE=$O(^PS(55,DFN,"P","A",DTE)) Q:'DTE!(DTE>EDATE)  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DTE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",180,0)
 S DTE=DT-1 F  S DTE=$O(^PS(55,DFN,"P","A",DTE)) Q:'DTE  F IEN=0:0 S IEN=$O(^PS(55,DFN,"P","A",DTE,IEN)) Q:'IEN  D:$P($G(^PSRX(IEN,"STA")),"^")'=13 PROCESS
"RTN","PSO52API",181,0)
 Q
"RTN","PSO52API",182,0)
PROF(DFN,LIST,SDATE,EDATE) ;
"RTN","PSO52API",183,0)
 D ^PSO52AP1
"RTN","PSO52API",184,0)
 Q
"RTN","PSO52API",185,0)
DIQ ;process fields
"RTN","PSO52API",186,0)
 S DIQ="PST",DIQ(0)="IE" D EN^DIQ1
"RTN","PSO52API",187,0)
 Q
"RTN","PSOHLD")
0^1^B80803768^B56482932
"RTN","PSOHLD",1,0)
PSOHLD ;BIR/SAB - hold unhold functionality ; 7/23/09 1:16pm
"RTN","PSOHLD",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,16,21,24,27,32,55,82,114,130,166,148,268,281,298,358,353,385,386**;DEC 1997;Build 4
"RTN","PSOHLD",3,0)
 ;External reference to ^DD(52-DBIA 999,  VA(200-DBIA 224, NA^ORX1-DBIA 2186,
"RTN","PSOHLD",4,0)
 ; L, UL, PSOL, and PSOUL^PSSLOCK-DBIA 2789, ^%DTC-DBIA 10000, ^DIE-DBIA 10018, ^DIR-DBIA 10026,
"RTN","PSOHLD",5,0)
 ; ^DIK-DBIA 10013, ^VALM1-DBIA 10016, ^XUSEC(-DBIA 10076
"RTN","PSOHLD",6,0)
UHLD ; Rx Unhold
"RTN","PSOHLD",7,0)
 N REASON,RXIEN
"RTN","PSOHLD",8,0)
 I '$D(PSOPAR) D ^PSOLSET G:'$D(PSOPAR) EX
"RTN","PSOHLD",9,0)
 I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSOHLD",10,0)
 I $G(PSONACT) W $C(7),$C(7) S VALMSG="No Pharmacy Orderable Item !",VALMBCK="" Q
"RTN","PSOHLD",11,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSOHLD",12,0)
 K PSOPLCK D PSOL^PSSLOCK(DA) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D ULP Q
"RTN","PSOHLD",13,0)
 S Y(0)=^PSRX(DA,0),STA=+$G(^("STA"))
"RTN","PSOHLD",14,0)
 I STA=16 S VALMSG="Placed on HOLD by Provider!" K Y,STA D PSOUL^PSSLOCK(DA) D ULP S VALMBCK="" Q
"RTN","PSOHLD",15,0)
 I STA'=3!(('$D(^XUSEC("PSORPH",DUZ)))&('$D(^XUSEC("PSO TECH ADV",DUZ)))) S VALMSG="Invalid Action Selection!",VALMBCK="" K Y,STA D PSOUL^PSSLOCK(DA) D ULP Q
"RTN","PSOHLD",16,0)
 S REASON=$$GET1^DIQ(52,DA,99,"I")
"RTN","PSOHLD",17,0)
 I ('$D(^XUSEC("PSORPH",DUZ))),",1,7,8,98,"'[(","_REASON_",") D  K Y,STA D PSOUL^PSSLOCK(DA) D ULP Q
"RTN","PSOHLD",18,0)
 . S VALMSG="The HOLD can only be removed by a pharmacist",VALMBCK=""
"RTN","PSOHLD",19,0)
 D FULL^VALM1 K DIR,DTOUT,DUOUT,DIRUT D NOOR I $D(DIRUT) D ULP G EX
"RTN","PSOHLD",20,0)
 I DT>$P(^PSRX(DA,2),"^",6) D  D ULP G EX
"RTN","PSOHLD",21,0)
 .S VALMSG="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11
"RTN","PSOHLD",22,0)
 .S ^PSRX(DA,"H")="",COMM="Medication Expired on "_$E($P(^(2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM,"") K COMM
"RTN","PSOHLD",23,0)
EN S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I,RSDT=$P(^(I,0),"^")
"RTN","PSOHLD",24,0)
 S RXIEN=DA
"RTN","PSOHLD",25,0)
 ; - Asking for UNHOLD Comments
"RTN","PSOHLD",26,0)
 N HLDCOM
"RTN","PSOHLD",27,0)
 S HLDCOM=$$GET1^DIQ(52,RXIEN,99.1)_" (REASON: "_$$GET1^DIQ(52,RXIEN,99)_") on "_$$GET1^DIQ(52,RXIEN,99.2)
"RTN","PSOHLD",28,0)
 W !!,"HOLD COMMENTS: " F I=1:1 Q:HLDCOM=""  W ?15,$E(HLDCOM,1,65),! S HLDCOM=$E(HLDCOM,66,999)
"RTN","PSOHLD",29,0)
 K DIR,DUOUT,DTOUT S DIR(0)="FO^3:200",DIR("A")="UNHOLD COMMENTS" D ^DIR I $D(DTOUT)!$D(DUOUT) D ULP G EX
"RTN","PSOHLD",30,0)
 S OTHCOM=X
"RTN","PSOHLD",31,0)
 ;
"RTN","PSOHLD",32,0)
 K Y I RXF D  I $D(Y) D ULP G EX
"RTN","PSOHLD",33,0)
 .N DA,DIE S DA(1)=RXIEN,DA=RXF,DIE="^PSRX("_DA(1)_",1,",PSOUNHLD=1
"RTN","PSOHLD",34,0)
 .S RLDT=$P(^PSRX(DA(1),1,DA,0),"^",18)
"RTN","PSOHLD",35,0)
 .I 'RLDT D
"RTN","PSOHLD",36,0)
 ..I RSDT<DT D  ;353 Do not display a past date for refill date'
"RTN","PSOHLD",37,0)
 ...N Y,TD S Y=DT X ^DD("DD") S TD=Y
"RTN","PSOHLD",38,0)
 ...S DR=".01R///^S X=TD"
"RTN","PSOHLD",39,0)
 ...D ^DIE
"RTN","PSOHLD",40,0)
 ..S DR=".01R;2"
"RTN","PSOHLD",41,0)
 ..D ^DIE
"RTN","PSOHLD",42,0)
 ..I $D(Y) D  ;User quit the UNHOLD process
"RTN","PSOHLD",43,0)
 ...I RSDT<DT D  ;reset refill date
"RTN","PSOHLD",44,0)
 ....N Y,TD S Y=RSDT X ^DD("DD") S TD=Y
"RTN","PSOHLD",45,0)
 ....S DR=".01R///^S X=TD"
"RTN","PSOHLD",46,0)
 ....D ^DIE
"RTN","PSOHLD",47,0)
 .S ZD(RXIEN)=$P(^PSRX(DA(1),1,DA,0),"^")
"RTN","PSOHLD",48,0)
 .K PSOUNHLD Q:$D(Y)  S PSORX("FILL DATE")=$P(^PSRX(DA(1),1,DA,0),"^"),DA=PSDA K DA(1)
"RTN","PSOHLD",49,0)
 ;
"RTN","PSOHLD",50,0)
 ;PSO*7*298 Require an entry into fill date
"RTN","PSOHLD",51,0)
 S ACT=1,DIE="^PSRX(",FDT=$S($P(^PSRX(RXIEN,2),"^",2):$P(^PSRX(RXIEN,2),"^",2),1:DT)
"RTN","PSOHLD",52,0)
 S RLDT=$P(^PSRX(RXIEN,2),"^",13),DR="",RLDTP1=$P(RLDT,".",1)
"RTN","PSOHLD",53,0)
 I 'RXF&'RLDT S DR="22R//^S X=FDT;11;Q;"
"RTN","PSOHLD",54,0)
 I RLDT&($P(^PSRX(RXIEN,2),"^",2)="") S DR="22R//^S X=RLDTP1;11;Q;"
"RTN","PSOHLD",55,0)
 S DR=DR_"100///0;101///^S X=$S(RXF:$G(ZD(RXIEN)),1:$P(^PSRX(RXIEN,2),""^"",2))"
"RTN","PSOHLD",56,0)
 ;
"RTN","PSOHLD",57,0)
 D ^DIE K FDT I $D(Y) S VALMBCK="R" D ULP G EX
"RTN","PSOHLD",58,0)
 ;
"RTN","PSOHLD",59,0)
 ; - Saving UNHOLD COMMENTS in the Refill REMARKS field.
"RTN","PSOHLD",60,0)
 I $G(OTHCOM)'="" D
"RTN","PSOHLD",61,0)
 . N DA,DIE,DR S DA(1)=RXIEN,DA=RXF,DIE="^PSRX("_DA(1)_",1,",DR="3///"_$E($TR(OTHCOM,";",","),1,60) D ^DIE
"RTN","PSOHLD",62,0)
 ; - Logging Rx Activity Log
"RTN","PSOHLD",63,0)
 D RXACT(RXIEN,"U",,$G(OTHCOM))
"RTN","PSOHLD",64,0)
 ; 
"RTN","PSOHLD",65,0)
 S COMM="Medication Removed from Hold by Pharmacy" D EN^PSOHLSN1(RXIEN,"OE","",COMM,PSONOOR) K COMM,PSONOOR
"RTN","PSOHLD",66,0)
 S PSORX("FILL DATE")=$S('RXF:$P(^PSRX(RXIEN,2),"^",2),1:ZD(RXIEN)) I $G(^PSRX(RXIEN,"H")) K ^PSRX("AH",$P(^PSRX(RXIEN,"H"),"^"),DA)
"RTN","PSOHLD",67,0)
 S ^PSRX(RXIEN,"H")=""
"RTN","PSOHLD",68,0)
 ;D ACT^PSOHLDA
"RTN","PSOHLD",69,0)
 S (NEW1,NEW11)="^^"
"RTN","PSOHLD",70,0)
 S (RXF,RXFL(RXIEN))=0 F JJ=0:0 S JJ=$O(^PSRX(RXIEN,1,JJ)) Q:'JJ  S (RXFL(RXIEN),RXF)=JJ
"RTN","PSOHLD",71,0)
 I $G(PSXSYS) D UNHOLD^PSOCMOPA I $G(XFLAG) D ULP G EX
"RTN","PSOHLD",72,0)
 I $G(RXIEN) D RELC I $G(PSOHRL) D ULP G EX
"RTN","PSOHLD",73,0)
 I PSORX("FILL DATE")>DT,$P(PSOPAR,"^",6) D S^PSORXL,EX,ULP Q
"RTN","PSOHLD",74,0)
 S PCOMH(RXIEN)="Medication Removed from Hold by Pharmacy"
"RTN","PSOHLD",75,0)
 I $G(RXIEN) S RXRH(RXIEN)=RXIEN
"RTN","PSOHLD",76,0)
 I $P($G(^PSRX(RXIEN,2)),"^",15)'="" S $P(^PSRX(RXIEN,2),"^",14)=1,RXRP(RXIEN)=1,$P(RXRP(RXIEN),"^",2)=$P($G(^PSRX(RXIEN,0)),"^",18) ; MARK PRESCRIPTION AND LABEL AS BEING REPRINTED WHEN UNHOLDING A RETURNED TO STOCK PRESCRIPTION
"RTN","PSOHLD",77,0)
 ;
"RTN","PSOHLD",78,0)
 ; - Submitting Rx to ECME
"RTN","PSOHLD",79,0)
 N ACTION
"RTN","PSOHLD",80,0)
 I $$SUBMIT^PSOBPSUT(RXIEN,+$G(RXFL(RXIEN))) D  I ACTION="Q"!(ACTION="^") D ULP G EX
"RTN","PSOHLD",81,0)
 . N RX,RFL S RX=RXIEN,RFL=+$G(RXFL(RXIEN))
"RTN","PSOHLD",82,0)
 . N DA S ACTION=""
"RTN","PSOHLD",83,0)
 . D ECMESND^PSOBPSU1(RX,RFL,,$S(RFL:"RF",1:"OF"))
"RTN","PSOHLD",84,0)
 . ; Quit if there is an unresolved TRICARE/CHAMPVA non-billable reject code, PSO*7*358
"RTN","PSOHLD",85,0)
 . I $$PSOET^PSOREJP3(RX,RFL) S ACTION="Q" Q
"RTN","PSOHLD",86,0)
 . I $$FIND^PSOREJUT(RX,RFL) D
"RTN","PSOHLD",87,0)
 . . S ACTION=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","IOQ","Q")
"RTN","PSOHLD",88,0)
 ;
"RTN","PSOHLD",89,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=RXIEN_"," D ULP G EX
"RTN","PSOHLD",90,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOHLD",91,0)
 I $L(PSORX("PSOL",PSOX2))+$L(RXIEN)<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_RXIEN_","
"RTN","PSOHLD",92,0)
 E  S PSORX("PSOL",PSOX2+1)=RXIEN_","
"RTN","PSOHLD",93,0)
 ; 
"RTN","PSOHLD",94,0)
 D ULP
"RTN","PSOHLD",95,0)
EX D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) D ^PSOBUILD
"RTN","PSOHLD",96,0)
 K PSOHRL,PSOMSG,PSOPLCK,ST,PSL,PSNP,IR,NOW,DR,NEW1,NEW11,RTN,DA,PPL,RXN,RX0,RXS,DIK,RXP,FLD,ACT,DIE,DIC,DIR,DIE,X,Y,DIRUT,DUOUT,SUSPT,C,D0,LFD,I,RFDATE,DI,DQ,%,RFN,XFLAG
"RTN","PSOHLD",97,0)
 K HRX,PSHLD,PSOLIST,PSORX("FILL DATE"),STA,QTY,RFDT,PSORX0,PSRXN,RXF,JJ Q
"RTN","PSOHLD",98,0)
 ;
"RTN","PSOHLD",99,0)
HLD ;
"RTN","PSOHLD",100,0)
 I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSOHLD",101,0)
 I $G(PSONACT) W $C(7),$C(7) S VALMSG="No Pharmacy Orderable Item !",VALMBCK="" Q
"RTN","PSOHLD",102,0)
 I '$D(^XUSEC("PSORPH",DUZ))&'$D(^XUSEC("PSO TECH ADV",DUZ)) S VALMSG="Invalid Action Selection!",VALMBCK="" Q
"RTN","PSOHLD",103,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient."),VALMBCK="" K PSOPLCK Q
"RTN","PSOHLD",104,0)
 K PSOPLCK D PSOL^PSSLOCK(DA) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D ULP Q
"RTN","PSOHLD",105,0)
 S Y(0)=^PSRX(DA,0),STA=+$G(^("STA")) I DT>$P(^PSRX(DA,2),"^",6) D  D ULP G D1
"RTN","PSOHLD",106,0)
 .S VALMSG="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3),VALMBCK="R"
"RTN","PSOHLD",107,0)
 .I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11 D
"RTN","PSOHLD",108,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM) K COMM
"RTN","PSOHLD",109,0)
 S ST=$P("ERROR^ACTIVE^NON-VERIFIED^REFILL^HOLD^NON-VERIFIED^SUSPENDED^^^^^DONE^EXPIRED^DISCONTINUED^DELETED^DISCONTINUED^DISCONTINUED (EDIT)^PROVIDER HOLD^","^",STA+2)
"RTN","PSOHLD",110,0)
 I STA,STA'>4!(STA>11) D  D ULP G D1
"RTN","PSOHLD",111,0)
 .S VALMSG="Rx: "_$P(Y(0),"^")_" is currently in a status of "_ST,VALMBCK="R" K ST,Y Q
"RTN","PSOHLD",112,0)
 D FULL^VALM1 D NOOR I $D(DIRUT) D ULP G D1
"RTN","PSOHLD",113,0)
 D HLD^PSOCMOPA I $G(XFLAG) K XFLAG D ULP G D1
"RTN","PSOHLD",114,0)
 K DIR S DIR("A")=$P(^DD(52,99,0),"^"),DIR(0)="52,99"
"RTN","PSOHLD",115,0)
 ; A reduced set of HOLD REASON CODEs is available for Pharmacy Techs
"RTN","PSOHLD",116,0)
 I '$D(^XUSEC("PSORPH",DUZ)) D
"RTN","PSOHLD",117,0)
 . S DIR(0)="S^1:INSUFFICIENT QTY IN STOCK;7:BAD ADDRESS;8:PER PATIENT REQUEST;98:OTHER/TECH (NON-CLINICAL)"
"RTN","PSOHLD",118,0)
 . S DIR("L",1)="Enter reason medication is placed in a 'Hold' status."
"RTN","PSOHLD",119,0)
 . S DIR("L",2)="Choose from:"
"RTN","PSOHLD",120,0)
 . S DIR("L",3)="1        INSUFFICIENT QTY IN STOCK"
"RTN","PSOHLD",121,0)
 . S DIR("L",4)="7        BAD ADDRESS"
"RTN","PSOHLD",122,0)
 . S DIR("L",5)="8        PER PATIENT REQUEST"
"RTN","PSOHLD",123,0)
 . S DIR("L")="98       OTHER/TECH (NON-CLINICAL)"
"RTN","PSOHLD",124,0)
 ;
"RTN","PSOHLD",125,0)
 D ^DIR S FLD(99)=Y I $D(DUOUT)!($D(DIRUT)) K DIRUT,DUOUT,DIR D ULP G D1
"RTN","PSOHLD",126,0)
 I ($G(FLD(99))=98!($G(FLD(99))=99)) K DIR S DIR("A")=$P(^DD(52,99.1,0),"^"),DIR(0)="52,99.1" D ^DIR S FLD(99.1)=Y G AR
"RTN","PSOHLD",127,0)
 E  K DIR S DIR(0)="FO^10:100",DIR("A")="HOLD COMMENTS" D ^DIR S FLD(99.1)=Y
"RTN","PSOHLD",128,0)
AR I $D(DUOUT)!($D(DTOUT)) K DIRUT,DUOUT,DIR S VALMBCK="R" D ULP G D1
"RTN","PSOHLD",129,0)
 F PI=1:1 Q:$P(PPL,",",PI)=""  S DA=$P(PPL,",",PI) D H S DA=PSDA K PSDA D:$D(PSORX("PSOL")) RMP^PSOHLDA
"RTN","PSOHLD",130,0)
 K PI D ^PSOBUILD
"RTN","PSOHLD",131,0)
 D ULP
"RTN","PSOHLD",132,0)
D1 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) K PSOMSG,PSOPLCK,RFN,DIR,RSDT,FLD,DA,ACT,X,Y,DIRUT,DUOUT,DTOUT,DIROUT
"RTN","PSOHLD",133,0)
 Q
"RTN","PSOHLD",134,0)
 ;
"RTN","PSOHLD",135,0)
H ; - Rx HOLD update
"RTN","PSOHLD",136,0)
 D HOLD^PSOHLDA
"RTN","PSOHLD",137,0)
 Q
"RTN","PSOHLD",138,0)
 ;
"RTN","PSOHLD",139,0)
FLD N DA K DIR S DIR("A")=$P(^DD(52,99,0),"^"),DIR(0)="52,99" D ^DIR Q:$D(DUOUT)!($D(DIRUT))  S FLD(99)=Y
"RTN","PSOHLD",140,0)
 S COMM=Y(0)
"RTN","PSOHLD",141,0)
 I $G(FLD(99))=99 K DIR S DIR("A")=$P(^DD(52,99.1,0),"^"),DIR(0)="52,99.1" D ^DIR Q:$D(DUOUT)!($D(DIRUT))  S (FLD(99.1),COMM)=Y Q
"RTN","PSOHLD",142,0)
 E  S FLD(99.1)=""
"RTN","PSOHLD",143,0)
 Q
"RTN","PSOHLD",144,0)
NOOR ;ask nature of order
"RTN","PSOHLD",145,0)
 K DIR,DTOUT,DTOUT,DIRUT I $T(NA^ORX1)]""  D  Q
"RTN","PSOHLD",146,0)
 .S PSONOOR=$$NA^ORX1("W",0,"B","Nature of Order",0,"WPSDIVR"_$S(+$G(^VA(200,DUZ,"PS")):"E",1:""))
"RTN","PSOHLD",147,0)
 .I +PSONOOR S PSONOOR=$P(PSONOOR,"^",3) Q
"RTN","PSOHLD",148,0)
 .S DIRUT=1 K PSONOOR
"RTN","PSOHLD",149,0)
 S DIR("A")="Nature of Order: ",DIR("B")="WRITTEN"
"RTN","PSOHLD",150,0)
 S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONE;S:SERVICE CORRECTED;D:DUPLICATE;I:POLICY;R:SERVICE REJECTED"_$S(+$G(^VA(200,DUZ,"PS")):";E:PROVIDER ENTERED",1:"")
"RTN","PSOHLD",151,0)
NOORX D ^DIR K DIR,DTOUT,DTOUT Q:$D(DIRUT)  S PSONOOR=Y
"RTN","PSOHLD",152,0)
 Q
"RTN","PSOHLD",153,0)
ULP ;
"RTN","PSOHLD",154,0)
 D UL^PSSLOCK(+$G(PSODFN))
"RTN","PSOHLD",155,0)
 Q
"RTN","PSOHLD",156,0)
RELC ;
"RTN","PSOHLD",157,0)
 S (PSOHRL,PSOHTX)=0  F PSOHT=0:0 S PSOHT=$O(^PSRX(DA,1,PSOHT)) Q:'PSOHT  S:$D(^PSRX(DA,1,PSOHT,0)) PSOHTX=PSOHT
"RTN","PSOHLD",158,0)
 I $G(PSOHTX) S PSOHRL=$S($P($G(^PSRX(DA,1,PSOHTX,0)),"^",18):1,1:0)
"RTN","PSOHLD",159,0)
 I '$G(PSOHTX) S PSOHRL=$S($P($G(^PSRX(DA,2)),"^",13):1,1:0)
"RTN","PSOHLD",160,0)
 K PSOHTX,PSOHT
"RTN","PSOHLD",161,0)
 Q
"RTN","PSOHLD",162,0)
RXACT(RX,ACTION,REASON,OTHCOM,SUS) ; Adds HOLD/UNHOLD comments to the Rx Activity Log
"RTN","PSOHLD",163,0)
 N RFL,X,DIC,DA,DD,DO,DR,DINUM,Y,DLAYGO,COMM
"RTN","PSOHLD",164,0)
 S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOHLD",165,0)
 I ACTION="H" S COMM="Rx placed on HOLD (Reason: "_REASON_")"_$S(+$G(SUS):" and removed from SUSPENSE",1:"")
"RTN","PSOHLD",166,0)
 I ACTION="U" S COMM="Rx removed from HOLD"
"RTN","PSOHLD",167,0)
 S DA(1)=RX,DIC="^PSRX("_RX_",""A"",",DLAYGO=52.3,DIC(0)="L" S:$G(OTHCOM)'="" OTHCOM=$TR(OTHCOM,";",","),COMM=COMM_" -"
"RTN","PSOHLD",168,0)
 S DIC("DR")=".02///"_ACTION_";.03////"_DUZ_";.04///"_$S((RFL>5):RFL+1,1:RFL)_";.05///"_COMM_$S($G(OTHCOM)'="":";4///"_OTHCOM,1:"")
"RTN","PSOHLD",169,0)
 S X=$$NOW^XLFDT() D FILE^DICN
"RTN","PSOHLD",170,0)
 Q
"RTN","PSOHLDA")
0^2^B7186036^B10014334
"RTN","PSOHLDA",1,0)
PSOHLDA ;BIR/MFR - HOLD/UNHOLD functionality (cont.) ;07/15/96
"RTN","PSOHLDA",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,225,386**;DEC 1997;Build 4
"RTN","PSOHLDA",3,0)
 ;
"RTN","PSOHLDA",4,0)
HOLD ;hold function
"RTN","PSOHLDA",5,0)
 I $P($G(^PSRX(DA,"STA")),"^")=3 Q
"RTN","PSOHLDA",6,0)
 S RSDT=$S($P(^PSRX(DA,2),"^",13):$P(^PSRX(DA,3),"^"),1:"@"),(PSUS,ACT,RXF,RFN,I)=0 F  S I=$O(^PSRX(DA,1,I)) Q:'I  D
"RTN","PSOHLDA",7,0)
 .S RXF=I,RFN=RFN+1 S:RFN=1 RSDT=$S('$P(^PSRX(DA,1,I,0),"^",18):$P(^PSRX(DA,2),"^",2),1:$P(^PSRX(DA,1,I,0),"^"))
"RTN","PSOHLDA",8,0)
 .I RFN>1,'$P(^PSRX(DA,1,I,0),"^",18) S RSDT=$P(^PSRX(DA,1,RXF-1,0),"^") Q
"RTN","PSOHLDA",9,0)
 .S:RFN>1 RSDT=$P(^PSRX(DA,1,RXF,0),"^")
"RTN","PSOHLDA",10,0)
 I RXF D
"RTN","PSOHLDA",11,0)
 .S (PSDA,DA(1))=DA,DA=RXF,DIE="^PSRX("_DA(1)_",1,",DR="4" D ^DIE
"RTN","PSOHLDA",12,0)
 .S $P(^PSRX(DA(1),1,DA,0),"^",3)=$S($G(FLD(99.1))]"":$E(FLD(99.1),1,60),1:"")
"RTN","PSOHLDA",13,0)
 .S DA=PSDA K DA(1)
"RTN","PSOHLDA",14,0)
 S DIE="^PSRX(",DR=$S('RXF&('$P(^PSRX(DA,2),"^",13)):"22///@;",1:"")_"99///"_FLD(99)_";99.1///^S X=FLD(99.1);99.2///"_DT_";100///3;101///"_RSDT D ^DIE Q:$D(Y)
"RTN","PSOHLDA",15,0)
 S:$G(PSOHD) VALMSG="RX# "_$P(^PSRX(DA,0),"^")_" has been placed in a hold status."
"RTN","PSOHLDA",16,0)
 K RXRS(DA)
"RTN","PSOHLDA",17,0)
 I +$G(PSDA) S DA=$O(^PS(52.5,"B",PSDA,0)) I DA S:$P($G(^PS(52.5,DA,"P")),"^")=0 PSUS=1 S DIK="^PS(52.5," D ^DIK K DA,DIK
"RTN","PSOHLDA",18,0)
 S:+$G(PSDA) DA=PSDA D RXACT^PSOHLD(DA,"H",$$GET1^DIQ(52,DA,99),$$GET1^DIQ(52,DA,99.1),$G(PSUS))
"RTN","PSOHLDA",19,0)
 S PSOHNX=+$P($G(^PSRX(+$G(DA),"H")),"^") D
"RTN","PSOHLDA",20,0)
 .I $G(PSOHNX),$P($G(^PSRX(DA,"H")),"^",2)'="" S COMM=$P($G(^("H")),"^",2) Q
"RTN","PSOHLDA",21,0)
 .S COMM="Medication placed on Hold "_$E(DT,4,5)_"-"_$E(DT,6,7)_"-"_$E(DT,2,3)
"RTN","PSOHLDA",22,0)
 D EN^PSOHLSN1(DA,"OH","",COMM,PSONOOR) K COMM,PSOHNX
"RTN","PSOHLDA",23,0)
 ;
"RTN","PSOHLDA",24,0)
 ; - Closes any OPEN/UNRESOLVED REJECTs and Reverses ECME Claim
"RTN","PSOHLDA",25,0)
 D REVERSE^PSOBPSU1(DA,+$G(RXF),"HLD",2)
"RTN","PSOHLDA",26,0)
 ;
"RTN","PSOHLDA",27,0)
 K PSUS,RXF,I,FDA,DIC,DIE,DR,Y,X,%,%I,%H,RSDT
"RTN","PSOHLDA",28,0)
 Q
"RTN","PSOHLDA",29,0)
 ;
"RTN","PSOHLDA",30,0)
RMP ;remove Rx if found in array PSORX("PSOL")
"RTN","PSOHLDA",31,0)
 Q:'$G(DA)
"RTN","PSOHLDA",32,0)
 N I,J,K,PSOX2,PSOX3,PSOX9 S I=0
"RTN","PSOHLDA",33,0)
 F  S I=$O(PSORX("PSOL",I)) Q:'I  S PSOX2=PSORX("PSOL",I) D:PSOX2[(DA_",")
"RTN","PSOHLDA",34,0)
 .S PSOX9="",K=0 F J=1:1 S PSOX3=$P(PSOX2,",",J) Q:'PSOX3  D
"RTN","PSOHLDA",35,0)
 ..I PSOX3=DA,$P($G(^PSRX(DA,"STA")),"^")=3 S K=1 Q
"RTN","PSOHLDA",36,0)
 ..S PSOX9=PSOX9_$S('PSOX9:"",1:",")_PSOX3
"RTN","PSOHLDA",37,0)
 .I K S:PSOX9]"" PSORX("PSOL",I)=PSOX9_"," K:PSOX9="" PSORX("PSOL",I) D:$D(BBRX(I)) RMB
"RTN","PSOHLDA",38,0)
 Q
"RTN","PSOHLDA",39,0)
RMB ;remove Rx if found in array BBRX()
"RTN","PSOHLDA",40,0)
 S PSOX2=BBRX(I) D:PSOX2[(DA_",")
"RTN","PSOHLDA",41,0)
 .S PSOX9="" F J=1:1 S PSOX3=$P(PSOX2,",",J) Q:'PSOX3  S:PSOX3'=DA PSOX9=PSOX9_$S('PSOX9:"",1:",")_PSOX3
"RTN","PSOHLDA",42,0)
 .S:PSOX9]"" BBRX(I)=PSOX9_"," K:PSOX9="" BBRX(I)
"RTN","PSOHLDA",43,0)
 Q
"RTN","PSOLMRN")
0^6^B821442^B567748
"RTN","PSOLMRN",1,0)
PSOLMRN ;ISC-BHAM/SAB - displays renewal rxs ;04/21/1995
"RTN","PSOLMRN",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,46,84,225,386**;DEC 1997;Build 4
"RTN","PSOLMRN",3,0)
EN ; -- main entry point for PSO LM RENEW LIST
"RTN","PSOLMRN",4,0)
 S VALMCNT=PSOPF,PSOLM=1
"RTN","PSOLMRN",5,0)
 D EN^VALM("PSO LM RENEW LIST")
"RTN","PSOLMRN",6,0)
 Q
"RTN","PSOLMRN",7,0)
 ;
"RTN","PSOLMRN",8,0)
HDR ; -- header code
"RTN","PSOLMRN",9,0)
 K ^TMP("PSOHDR",$J) D HDR^PSOLMUTL
"RTN","PSOLMRN",10,0)
 Q
"RTN","PSOLMRN",11,0)
 ;
"RTN","PSOLMRN",12,0)
INIT ; -- init variables and list array
"RTN","PSOLMRN",13,0)
 ;F LINE=1:1:30 D SET^VALM10(LINE,LINE_"     Line number "_LINE)
"RTN","PSOLMRN",14,0)
 S VALMCNT=PSOPF,PSOLM=1
"RTN","PSOLMRN",15,0)
 I $G(ORD),$$GET1^DIQ(52.41,ORD,102,"I") S VALM("TITLE")="FL-"_VALM("TITLE")
"RTN","PSOLMRN",16,0)
 D RV^PSONFI Q
"RTN","PSOLMRN",17,0)
 ;
"RTN","PSOLMRN",18,0)
HELP ; -- help code
"RTN","PSOLMRN",19,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOLMRN",20,0)
 Q
"RTN","PSOLMRN",21,0)
 ;
"RTN","PSOLMRN",22,0)
EXIT ; -- exit code
"RTN","PSOLMRN",23,0)
 I $G(Y)=-1!($G(Y)="Q") S PSOQUIT=1
"RTN","PSOLMRN",24,0)
 I $G(Y)="Q",$P($G(Y(1)),"^",3)="QU" S PSOQQ=1
"RTN","PSOLMRN",25,0)
 K FLAGLINE D CLEAN^VALM10
"RTN","PSOLMRN",26,0)
 Q
"RTN","PSOLMRN",27,0)
 ;
"RTN","PSOLMRN",28,0)
EXPND ; -- expand code
"RTN","PSOLMRN",29,0)
 Q
"RTN","PSOLMRN",30,0)
 ;
"RTN","PSOLMUTL")
0^4^B13307787^B11386551
"RTN","PSOLMUTL",1,0)
PSOLMUTL ;BIR/SAB - listman utilities ;03/07/95
"RTN","PSOLMUTL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**19,46,84,99,131,132,148,268,225,305,386**;DEC 1997;Build 4
"RTN","PSOLMUTL",3,0)
 ;External reference FULL^VALM1 supported by dbia 10116
"RTN","PSOLMUTL",4,0)
 ;External reference $$SETSTR^VALM1 supported by dbia 10116
"RTN","PSOLMUTL",5,0)
 ;External reference EN2^GMRAPEMO supported by dbia 190
"RTN","PSOLMUTL",6,0)
 ;External reference to ^ORD(101 supported by DBIA 872
"RTN","PSOLMUTL",7,0)
 ;External reference to RE^VALM4 supported by dbia 10120
"RTN","PSOLMUTL",8,0)
 ;
"RTN","PSOLMUTL",9,0)
EN W @IOF S VALMCNT=0
"RTN","PSOLMUTL",10,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) W $C(7),!!?5,"Site parameter must be defined!",! G INITQ
"RTN","PSOLMUTL",11,0)
 D EN^PSOLMPI
"RTN","PSOLMUTL",12,0)
INITQ Q
"RTN","PSOLMUTL",13,0)
HDR ;patient med profile display
"RTN","PSOLMUTL",14,0)
 K VALMHDR S HDR=^TMP("PSOHDR",$J,1,0)
"RTN","PSOLMUTL",15,0)
 S:^TMP("PSOHDR",$J,8,0) X=IORVON_"<A>"_IORVOFF,HDR=$$SETSTR^VALM1(X,HDR,80-$L(X),80) S VALMHDR(1)=HDR
"RTN","PSOLMUTL",16,0)
 I '(^TMP("PSOHDR",$J,8,0)) S PSONOAL="" D ALLERGY^PSOORUT2 I PSONOAL'="" D  K PSONOAL
"RTN","PSOLMUTL",17,0)
 .S X=IORVON_"<NO ALLERGY ASSESSMENT>"_IORVOFF,HDR=$$SETSTR^VALM1(X,HDR,80-$L(X),80) S VALMHDR(1)=HDR
"RTN","PSOLMUTL",18,0)
 S HDR="  PID: "_^TMP("PSOHDR",$J,2,0)
"RTN","PSOLMUTL",19,0)
 S VALMHDR(2)=$$SETSTR^VALM1("Ht(cm): "_^TMP("PSOHDR",$J,7,0),HDR,52,27)
"RTN","PSOLMUTL",20,0)
 S HDR="  DOB: "_^TMP("PSOHDR",$J,3,0)_" ("_^TMP("PSOHDR",$J,4,0)_")"
"RTN","PSOLMUTL",21,0)
 S VALMHDR(3)=$$SETSTR^VALM1(" Wt(kg): "_^TMP("PSOHDR",$J,6,0),HDR,51,28)
"RTN","PSOLMUTL",22,0)
 S HDR="  SEX: "_$E(^TMP("PSOHDR",$J,5,0),1,44)
"RTN","PSOLMUTL",23,0)
 S VALMHDR(4)=HDR
"RTN","PSOLMUTL",24,0)
 S $P(VALMHDR(4)," ",30)="  "_$E(^TMP("PSOHDR",$J,5,0),48,80)
"RTN","PSOLMUTL",25,0)
 Q:$G(PS)="VIEW"!($G(PS)="DELETE")
"RTN","PSOLMUTL",26,0)
 S VALMHDR(5)=$G(^TMP("PSOHDR",$J,9,0))
"RTN","PSOLMUTL",27,0)
 S VALMHDR(6)=$G(^TMP("PSOHDR",$J,10,0))
"RTN","PSOLMUTL",28,0)
 Q
"RTN","PSOLMUTL",29,0)
 ;
"RTN","PSOLMUTL",30,0)
NEWALL(DFN) ; Enter Allergy info.
"RTN","PSOLMUTL",31,0)
 N PSOID D FULL^VALM1,EN2^GMRAPEM0,^PSOORUT2 S VALMBCK="R"
"RTN","PSOLMUTL",32,0)
 Q
"RTN","PSOLMUTL",33,0)
NEWSEL ;allows order selection by number instead of action
"RTN","PSOLMUTL",34,0)
 S Y=$P(XQORNOD(0),"=",2) N VALMCNT D NEWSEL^PSOORNE2
"RTN","PSOLMUTL",35,0)
 Q
"RTN","PSOLMUTL",36,0)
EDTSEL ;allows edit selection by number instead of action - active orders
"RTN","PSOLMUTL",37,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOOREDT
"RTN","PSOLMUTL",38,0)
 Q
"RTN","PSOLMUTL",39,0)
SELAL ;selection of allergy by number instead of action - select allergy
"RTN","PSOLMUTL",40,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D SELAL^PSOORDA
"RTN","PSOLMUTL",41,0)
 Q
"RTN","PSOLMUTL",42,0)
EDTNEW ;allows edit selection by number instead of action - new orders
"RTN","PSOLMUTL",43,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOORNE1
"RTN","PSOLMUTL",44,0)
 Q
"RTN","PSOLMUTL",45,0)
EDTRNEW ;allows edit selection by number instead of action - renew orders
"RTN","PSOLMUTL",46,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOORNE4
"RTN","PSOLMUTL",47,0)
 Q
"RTN","PSOLMUTL",48,0)
EDTPEN ;allows edit selection by number instead of action - pending orders
"RTN","PSOLMUTL",49,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2),SEDT=1 G EDTSEL^PSOORNEW
"RTN","PSOLMUTL",50,0)
 Q
"RTN","PSOLMUTL",51,0)
HLDHDR ;keeps patient's header info
"RTN","PSOLMUTL",52,0)
 S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSOLMUTL",53,0)
 Q
"RTN","PSOLMUTL",54,0)
 ;
"RTN","PSOLMUTL",55,0)
BYPASS S:$G(PSOFDR) SIGOK=1 S Y=-1,VALMBCK="Q"
"RTN","PSOLMUTL",56,0)
 Q
"RTN","PSOLMUTL",57,0)
ACTIONS() ;screen actions on active orders
"RTN","PSOLMUTL",58,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",59,0)
 N DIC,X,Y K DIC,Y S DIC="^ORD(101,"_DA(1)_",10,",X=DA,DIC(0)="ZN" D ^DIC Q:Y<0 0
"RTN","PSOLMUTL",60,0)
 S Y=Y(0,0)
"RTN","PSOLMUTL",61,0)
 I Y="PSO REFILL" Q $S(PSOACT["R":1,1:0)
"RTN","PSOLMUTL",62,0)
 I Y="PSO RENEW" Q $S(PSOACT["N":1,1:0)
"RTN","PSOLMUTL",63,0)
 I Y="PSO REPRINT" Q $S(PSOACT["P":1,1:0)
"RTN","PSOLMUTL",64,0)
 I Y="PSO EDIT ORDERS" Q $S(PSOACT["E":1,1:0)
"RTN","PSOLMUTL",65,0)
 I Y="PSO RELEASE" Q $S(PSOACT["L":1,1:0)
"RTN","PSOLMUTL",66,0)
 I Y="PSO PARTIAL" Q $S(PSOACT["T":1,1:0)
"RTN","PSOLMUTL",67,0)
 I Y="PSO CANCEL" Q $S(PSOACT["D":1,1:0)
"RTN","PSOLMUTL",68,0)
 I Y="PSO HOLD" Q $S(PSOACT["H":1,1:0)
"RTN","PSOLMUTL",69,0)
 I Y="PSO UNHOLD" Q $S(PSOACT["U":1,1:0)
"RTN","PSOLMUTL",70,0)
 I Y="PSO LM BACKDOOR COPY" Q $S(PSOACT["C":1,1:0)
"RTN","PSOLMUTL",71,0)
 I Y="PSO VERIFY" Q $S(PSOACT["V":1,1:0)
"RTN","PSOLMUTL",72,0)
 I Y="PSO ACTIVITY LOGS" Q 1
"RTN","PSOLMUTL",73,0)
 Q 1
"RTN","PSOLMUTL",74,0)
ACTIONS1() ;screen actions on pending orders
"RTN","PSOLMUTL",75,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",76,0)
 N DIC,X,Y K DIC,Y S DIC="^ORD(101,"_DA(1)_",10,",X=DA,DIC(0)="ZN" D ^DIC Q:Y<0 0
"RTN","PSOLMUTL",77,0)
 S Y=Y(0,0)
"RTN","PSOLMUTL",78,0)
 I Y="PSO LM DISCONTINUE" Q $S(PSOACT["D":1,1:0)
"RTN","PSOLMUTL",79,0)
 I Y="PSO LM EDIT" Q $S(PSOACT["E":1,1:0)
"RTN","PSOLMUTL",80,0)
 I Y="PSO LM FINISH" Q $S(PSOACT["F":1,1:0)
"RTN","PSOLMUTL",81,0)
 I Y="PSO LM FLAG" Q $S(PSOACT["X":1,1:0)
"RTN","PSOLMUTL",82,0)
 Q 1
"RTN","PSOLMUTL",83,0)
PKIACT() ;screen actions on pending orders DEA/PKI proj.
"RTN","PSOLMUTL",84,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",85,0)
 N DIC,X,Y K DIC,Y S DIC="^ORD(101,"_DA(1)_",10,",X=DA,DIC(0)="ZN" D ^DIC Q:Y<0 0
"RTN","PSOLMUTL",86,0)
 S Y=Y(0,0)
"RTN","PSOLMUTL",87,0)
 I Y="PSO LM DISCONTINUE" Q $S(PSOACT["D":1,1:0)
"RTN","PSOLMUTL",88,0)
 I Y="PSO LM RENEW EDIT" Q $S(PSOACT["E":1,1:0)
"RTN","PSOLMUTL",89,0)
 I Y="PSO LM FLAG",'$G(PSOFDR) Q 0
"RTN","PSOLMUTL",90,0)
 I Y="PSO LM FLAG",$G(PSOFDR) Q $S(PSOACT["X":1,1:0)
"RTN","PSOLMUTL",91,0)
 Q 1
"RTN","PSOLMUTL",92,0)
RFDSP ;screen action to toggle display of prescriptions between LAST FILL date and LAST RELEASE Date.
"RTN","PSOLMUTL",93,0)
 S PSORFG='$G(PSORFG)
"RTN","PSOLMUTL",94,0)
 I '$D(PSOSD) D ^PSOBUILD
"RTN","PSOLMUTL",95,0)
 D ^PSOORUT2,BLD^PSOORUT1
"RTN","PSOLMUTL",96,0)
 K VALMHDR
"RTN","PSOLMUTL",97,0)
 D RE^VALM4
"RTN","PSOLMUTL",98,0)
 Q
"RTN","PSOORAL2")
0^8^B19047765^B19960223
"RTN","PSOORAL2",1,0)
PSOORAL2 ;BHAM-ISC/SAB -build listman activity logs con't ;04/28/95
"RTN","PSOORAL2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**258,260,386**;DEC 1997;Build 4
"RTN","PSOORAL2",3,0)
RF ;refill log
"RTN","PSOORAL2",4,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Refill Log:"
"RTN","PSOORAL2",5,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#  Log Date   Refill Date  Qty               Routing  Lot #       Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL2",6,0)
 S (RF,PL)=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S PL=PL+1
"RTN","PSOORAL2",7,0)
 I 'PL S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Refills For this  Prescription" Q
"RTN","PSOORAL2",8,0)
 F N=0:0 S N=$O(^PSRX(DA,1,N)) Q:'N  S P1=^(N,0) D
"RTN","PSOORAL2",9,0)
 .S DTT=$P(P1,"^",8)\1 D DAT S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"   "
"RTN","PSOORAL2",10,0)
 .S DTT=$P(P1,"^"),$P(RN," ",10)=" " D DAT
"RTN","PSOORAL2",11,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"     "_$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)_"  "_$S($P(P1,"^",2)="M":"Mail",1:"Window")_" "_$P(P1,"^",6)_$E(RN,$L($P(P1,"^",6))+1,12)
"RTN","PSOORAL2",12,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_$E($S($D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16)
"RTN","PSOORAL2",13,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"Unknown"),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_$E("        ",$L(PSDIV)+1,8)_"  "
"RTN","PSOORAL2",14,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"Dispensed: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")_"  "
"RTN","PSOORAL2",15,0)
 .S RTS=$S($P(P1,"^",16):" Returned to Stock: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" Released: "_$S($$RXRLDT^PSOBPSUT(DA,N):$$FMTE^XLFDT($$RXRLDT^PSOBPSUT(DA,N)\1,2),1:""))
"RTN","PSOORAL2",16,0)
 .I $$STATUS^PSOBPSUT(DA,N)'="",$$RXRLDT^PSOBPSUT(DA,N) S RTS=RTS_"  NDC: "_$$GETNDC^PSONDCUT(DA,N)
"RTN","PSOORAL2",17,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RTS S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Remarks: "_$P(P1,"^",3)
"RTN","PSOORAL2",18,0)
 K RTS Q
"RTN","PSOORAL2",19,0)
PAR ;partial log
"RTN","PSOORAL2",20,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Partial Fills:"
"RTN","PSOORAL2",21,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Log Date   Date     Qty              Routing    Lot #        Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL2",22,0)
 I '$O(^PSRX(DA,"P",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Partials for this Prescription" Q
"RTN","PSOORAL2",23,0)
 S N=0 F  S N=$O(^PSRX(DA,"P",N)) Q:'N  S P1=^(N,0),DTT=$P(P1,"^",8)\1 D DAT D
"RTN","PSOORAL2",24,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"  ",QTY=$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)
"RTN","PSOORAL2",25,0)
 .S DTT=$P(P1,"^") D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"  "_QTY_"  "
"RTN","PSOORAL2",26,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"UNKNOWN"),PSDIV=PSDIV_$E("        ",$L(PSDIV)+1,8)
"RTN","PSOORAL2",27,0)
 .S MW=$S($P(P1,"^",2)="M":"Mail",1:"Window"),MW=MW_$E("          ",$L(MW)+1,10)
"RTN","PSOORAL2",28,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_MW_"  "_$P(P1,"^",6)_$E("            ",$L($P(P1,"^",6))+1,10)_$E($S($D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16)
"RTN","PSOORAL2",29,0)
 .S RTS=$S($P(P1,"^",16):" RETURNED TO STOCK: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" RELEASED: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:""))
"RTN","PSOORAL2",30,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_" "_RTS ;_"      Entry By: "_$P(^VA(200,$P(P1,"^",7),0),"^")
"RTN","PSOORAL2",31,0)
 .S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  REMARKS: "_$P(P1,"^",3) K RTS
"RTN","PSOORAL2",32,0)
 Q
"RTN","PSOORAL2",33,0)
HLD ;hold info
"RTN","PSOORAL2",34,0)
 S DTT=$P(^PSRX(DA,"H"),"^",3) D DAT S HLDR=$$GET1^DIQ(52,DA,99)
"RTN","PSOORAL2",35,0)
 S $P(RN," ",60)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Reason: "_HLDR_$E(RN,$L("Hold Reason: "_HLDR)+1,60)_"Hold Date: "_DAT
"RTN","PSOORAL2",36,0)
 I $P($G(^PSRX(DA,"H")),"^",2)]"" D
"RTN","PSOORAL2",37,0)
 . N HLDCOMM S HLDCOMM=$P(^PSRX(DA,"H"),"^",2)
"RTN","PSOORAL2",38,0)
 . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Comments: "_$E(HLDCOMM,1,65),HLDCOMM=$E(HLDCOMM,66,999)
"RTN","PSOORAL2",39,0)
 . F  Q:HLDCOMM=""  D
"RTN","PSOORAL2",40,0)
 . . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="               "_$E(HLDCOMM,1,65),HLDCOMM=$E(HLDCOMM,66,999)
"RTN","PSOORAL2",41,0)
 K RN,DAT,DTT,HLDR
"RTN","PSOORAL2",42,0)
 Q
"RTN","PSOORAL2",43,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSOORAL2",44,0)
 Q
"RTN","PSOORNE4")
0^11^B81172924^B68513696
"RTN","PSOORNE4",1,0)
PSOORNE4 ;BIR/SAB-display renew RXs from backdoor ;07/29/96
"RTN","PSOORNE4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,32,36,46,75,96,103,99,117,131,225,386**;DEC 1997;Build 4
"RTN","PSOORNE4",3,0)
 ;^SC DBIA-10040;^PS(50.7-2223;^PS(50.606-2174;^PS(50.607-2221;^PS(51.2-2226;^PSDRUG-221;^PS(55-2228
"RTN","PSOORNE4",4,0)
 ;External reference to EN1^ORCFLAG supported by DBIA 3620
"RTN","PSOORNE4",5,0)
 ;
"RTN","PSOORNE4",6,0)
EN(PSONEW) N FLD,LST,VALMCNT
"RTN","PSOORNE4",7,0)
EN1 K PSOQUIT D:$G(PSONEW("ENT"))'>0  I $G(PSORENW("POE"))=1 S PSOREEDT=1 D SV
"RTN","PSOORNE4",8,0)
 .S PSOREEDT=1 D SV
"RTN","PSOORNE4",9,0)
 .K PSONEW("DOSE"),PSONEW("UNITS"),PSONEW("DOSE ORDERED"),PSONEW("ROUTE")
"RTN","PSOORNE4",10,0)
 .K PSONEW("SCHEDULE"),PSONEW("DURATION"),PSONEW("CONJUNCTION"),PSONEW("NOUN"),PSONEW("VERB"),PSOPRC,PSONEW("ODOSE")
"RTN","PSOORNE4",11,0)
RDD D DSPL,^PSOLMRN D:$G(PKI1)=2 DCP^PSOPKIV1 I $G(PSORX("FN")) S VALMBCK="Q" K PSOREEDT Q
"RTN","PSOORNE4",12,0)
 G:'$G(PSOQUIT) RDD
"RTN","PSOORNE4",13,0)
 Q
"RTN","PSOORNE4",14,0)
EDT D KV^PSOVER1 S DIR("A")="Select Field to Edit by number",DIR(0)="LO^1:"_$S($G(PSOREEDT):10,1:8)
"RTN","PSOORNE4",15,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) D KV^PSOVER1 S VALMBCK="" Q
"RTN","PSOORNE4",16,0)
EDTSEL S PSOLM=1,(PSONEW("DFLG"),PSONEW("FIELD"),PSONEW3)=0
"RTN","PSOORNE4",17,0)
 I +Y S LST=Y D HLDHDR^PSOLMUTL S PSOEDT=1 D  Q:$G(PSODIR("DFLG"))!($G(PSODIR("QFLG")))
"RTN","PSOORNE4",18,0)
 .F FLD=1:1:$L(LST,",") Q:$P(LST,",",FLD)']""  D @(+$P(LST,",",FLD)) Q:$G(PSODIR("DFLG"))!($G(PSODIR("QFLG")))
"RTN","PSOORNE4",19,0)
 E  S VALMBCK="" D FULL^VALM1
"RTN","PSOORNE4",20,0)
 Q
"RTN","PSOORNE4",21,0)
ACP ; Renewal Accept
"RTN","PSOORNE4",22,0)
 N DIR,Y,DIRUT,DUOUT,DTOUT,DIR S Y=0
"RTN","PSOORNE4",23,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 D  Q:$D(DIRUT)!'Y  D EN1^ORCFLAG(+$P($G(^PS(52.41,ORD,0)),"^")) H 1
"RTN","PSOORNE4",24,0)
 . D FULL^VALM1
"RTN","PSOORNE4",25,0)
 . I '$D(^XUSEC("PSORPH",DUZ)) D  S Y=0 Q
"RTN","PSOORNE4",26,0)
 . . S DIR("A",1)="Order must be unflagged by a pharmacist before it can be finished."
"RTN","PSOORNE4",27,0)
 . . S DIR("A",2)=""
"RTN","PSOORNE4",28,0)
 . . S DIR(0)="E",DIR("A")="Enter RETURN to continue" W !,$C(7) D ^DIR
"RTN","PSOORNE4",29,0)
 . . S VALMBCK="R"
"RTN","PSOORNE4",30,0)
 . D FULL^VALM1
"RTN","PSOORNE4",31,0)
 . S DIR("A",1)="This Order is flagged. In order to finish it"
"RTN","PSOORNE4",32,0)
 . S DIR("A",2)="you must unflag it first."
"RTN","PSOORNE4",33,0)
 . S DIR("A",3)=""
"RTN","PSOORNE4",34,0)
 . S DIR(0)="Y",DIR("A")="Unflag Order",DIR("B")="NO"
"RTN","PSOORNE4",35,0)
 . W ! D ^DIR I $D(DIRUT)!'Y S VALMBCK="Q"
"RTN","PSOORNE4",36,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 Q
"RTN","PSOORNE4",37,0)
 ;
"RTN","PSOORNE4",38,0)
 I $G(PKI1)=1 D REA^PSOPKIV1 G:$G(PSONEW("QFLG"))=1 PKI
"RTN","PSOORNE4",39,0)
 D INST2^PSORENW S PSOFROM1=1 D:$D(^XUSEC("PSORPH",DUZ))!('$P(PSOPAR,"^",2)) VER
"RTN","PSOORNE4",40,0)
 K PSOFROM1
"RTN","PSOORNE4",41,0)
PKI I $G(PSONEW("QFLG")) S POERR("DFLG")=1,VALMBCK="R" K PSONEW2 Q
"RTN","PSOORNE4",42,0)
 I PSONEW("ENT")>0,$G(NEWDOSE) K NEWDOSE G EN1 Q
"RTN","PSOORNE4",43,0)
 S PSORX("FN")=1 D EN^PSORN52(.PSONEW)
"RTN","PSOORNE4",44,0)
 D RNPSOSD^PSOUTIL,ACP1^PSOORNE6,^PSOBUILD S VALMBCK="Q"
"RTN","PSOORNE4",45,0)
 Q
"RTN","PSOORNE4",46,0)
VER1(PSONEW) ;
"RTN","PSOORNE4",47,0)
VER S (PSONEW("DFLG"),PSONEW("QFLG"))=0 I PSONEW("ENT")=0 D  K PSOORRNW,PSOFROM1 I PSONEW("DFLG")=1 S (PSONEW("QFLG"),POERR("DFLG"))=1 Q
"RTN","PSOORNE4",48,0)
 .S (PSOREEDT,PSOORRNW)=1 W !!,"Dosing Instruction Missing!!",!
"RTN","PSOORNE4",49,0)
 .S PSONEW("IRXN")=PSONEW("OIRXN") K VALMSG D FULL^VALM1 W !,"Drug: "_PSODRUG("NAME") D
"RTN","PSOORNE4",50,0)
 ..I $O(SIG(0)) D  Q
"RTN","PSOORNE4",51,0)
 ...F I=1:1 Q:$G(SIG(I))']""  W !,SIG(I)
"RTN","PSOORNE4",52,0)
 ..I $P($G(^PSRX(PSONEW("OIRXN"),"SIG")),"^")]"" S X=$P(^PSRX(PSONEW("OIRXN"),"SIG"),"^") D SIGONE^PSOHELP W !,$E($G(INS1),2,250)
"RTN","PSOORNE4",53,0)
 .K DIRUT W ! D DOSE^PSODIR(.PSONEW) Q:$G(PSONEW("DFLG"))  D EN^PSOFSIG(.PSONEW)
"RTN","PSOORNE4",54,0)
 .I PSONEW("ENT")>0,$O(SIG(0)) S (SIGOK,NEWDOSE)=1
"RTN","PSOORNE4",55,0)
 .I '$G(SPEED),PSONEW("DFLG")=1 S VALMSG="Renewal Request Cancelled!" W:$G(SPEED) !,"Renewal Request Cancelled!" Q:$G(PSONEW("DFLG"))
"RTN","PSOORNE4",56,0)
 .I +$G(PSONEW("ENT"))'>0 K DIRUT Q
"RTN","PSOORNE4",57,0)
 .D INS^PSODIR(.PSONEW),EN^PSOFSIG(.PSONEW),SINS^PSODIR(.PSONEW):$G(^PS(55,PSODFN,"LAN"))
"RTN","PSOORNE4",58,0)
 .S:'$G(SPEED)&(PSONEW("DFLG")=1) VALMSG="Renewal Request Cancelled!" W:$G(SPEED)&(PSONEW("DFLG")=1) !,"Renewal Request Cancelled!"
"RTN","PSOORNE4",59,0)
 .I $G(SPEED),'$G(PSONEW("DFLG")) D KV^PSOVER1 S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR,KV^PSOVER1 K X,Y
"RTN","PSOORNE4",60,0)
 I +$G(PSONEW("ENT"))'>0 G VER
"RTN","PSOORNE4",61,0)
 D STOP^PSORENW1 I +$G(PSEXDT) D  S PSORENW("QFLG")=1
"RTN","PSOORNE4",62,0)
 .S Y=PSORENW("FILL DATE") X ^DD("DD") S VALMSG=Y_" fill date is past expiration date "
"RTN","PSOORNE4",63,0)
 .S Y=$P(PSEXDT,"^",2) X ^DD("DD") S VALMSG=VALMSG_Y_"."
"RTN","PSOORNE4",64,0)
 Q
"RTN","PSOORNE4",65,0)
DSPL G:$G(PSONEW("ENT"))>0 DSP
"RTN","PSOORNE4",66,0)
 S PSONEW("ENT")=0 F I=0:0 S I=$O(^PSRX(PSONEW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSONEW("OIRXN"),6,I,0) D
"RTN","PSOORNE4",67,0)
 .S PSONEW("ENT")=PSONEW("ENT")+1,PSONEW("DOSE",PSONEW("ENT"))=$P(DOSE,"^")
"RTN","PSOORNE4",68,0)
 .S PSONEW("UNITS",PSONEW("ENT"))=$P(DOSE,"^",3),PSONEW("DOSE ORDERED",PSONEW("ENT"))=$P(DOSE,"^",2),PSONEW("ROUTE",PSONEW("ENT"))=$P(DOSE,"^",7)
"RTN","PSOORNE4",69,0)
 .S PSONEW("SCHEDULE",PSONEW("ENT"))=$P(DOSE,"^",8),PSONEW("DURATION",PSONEW("ENT"))=$P(DOSE,"^",5),PSONEW("CONJUNCTION",PSONEW("ENT"))=$P(DOSE,"^",6)
"RTN","PSOORNE4",70,0)
 .S PSONEW("NOUN",PSONEW("ENT"))=$P(DOSE,"^",4),PSONEW("VERB",PSONEW("ENT"))=$P(DOSE,"^",9)
"RTN","PSOORNE4",71,0)
 .I $G(^PSRX(PSONEW("OIRXN"),6,I,1))]"" S PSONEW("ODOSE",PSONEW("ENT"))=^PSRX(PSONEW("OIRXN"),6,I,1)
"RTN","PSOORNE4",72,0)
 .K DOSE
"RTN","PSOORNE4",73,0)
DSP D ^PSOORUT2 K ^TMP("PSOPO",$J) S IEN=0
"RTN","PSOORNE4",74,0)
 D:$G(PSONEW("PENDING ORDER")) LMDISP^PSOORFI5(+PSONEW("PENDING ORDER"))
"RTN","PSOORNE4",75,0)
 D:$G(PKI1) L1^PSOPKIV1
"RTN","PSOORNE4",76,0)
 D DIN^PSONFI(PSODRUG("OI"),$S($G(PSODRUG("IEN")):PSODRUG("IEN"),1:""))
"RTN","PSOORNE4",77,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                 Rx#: "_PSONEW("NRX #")
"RTN","PSOORNE4",78,0)
 I +$G(PSODRUG("OI")) D
"RTN","PSOORNE4",79,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="      Orderable Item: "_$P(^PS(50.7,+$G(PSODRUG("OI")),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_NFIO
"RTN","PSOORNE4",80,0)
 .S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNE4",81,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="     "_$S($D(^PSDRUG("AQ",PSODRUG("IEN"))):"      CMOP ",1:"           ")_"Drug: "_PSODRUG("NAME")_NFID
"RTN","PSOORNE4",82,0)
 S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNE4",83,0)
 S:$G(PSONEW("TN"))]"" IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="          Trade Name: "_$G(PSONEW("TN"))
"RTN","PSOORNE4",84,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="      Patient Status: "_$P(PSONEW("PTST NODE"),"^"),PSONEW("PATIENT STATUS")=$P(PSONEW("PTST NODE"),"^")
"RTN","PSOORNE4",85,0)
 S (PSOID,Y)=PSONEW("ISSUE DATE") X ^DD("DD") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (1)     Issue Date: "_Y
"RTN","PSOORNE4",86,0)
 S Y=PSONEW("FILL DATE") X ^DD("DD") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (2)      Fill Date: "_Y
"RTN","PSOORNE4",87,0)
 I PSONEW("ENT")=0 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=$S($G(PSOREEDT):"  (9)",1:"     ")_"         Dosage:" G PAT
"RTN","PSOORNE4",88,0)
 F I=1:1:PSONEW("ENT") D
"RTN","PSOORNE4",89,0)
 .I '$G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOORNE4",90,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=$S($G(PSOREEDT)&(I'>1):"  (9)",1:"     ")_"         Dosage: "_$S($E(PSONEW("DOSE",I),1)="."&($G(PSONEW("DOSE ORDERED",I))):"0",1:"")_PSONEW("DOSE",I)
"RTN","PSOORNE4",91,0)
 .S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_$S($G(PSONEW("UNITS",I))]"":" ("_$P(^PS(50.607,PSONEW("UNITS",I),0),"^")_")",1:"")
"RTN","PSOORNE4",92,0)
 .I $P($G(^PS(55,PSODFN,"LAN")),"^"),'$G(PSONEW("DOSE ORDERED",I)) D
"RTN","PSOORNE4",93,0)
 ..S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Oth. Lang. Dosage: "_$G(PSONEW("ODOSE",I))
"RTN","PSOORNE4",94,0)
 .I $G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" D
"RTN","PSOORNE4",95,0)
 ..S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOORNE4",96,0)
 ..S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="      Dispense Units: "_$S($E($G(PSONEW("DOSE ORDERED",I)),1)=".":"0",1:"")_$G(PSONEW("DOSE ORDERED",I))
"RTN","PSOORNE4",97,0)
 ..S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Noun: "_$G(PSONEW("NOUN",I))
"RTN","PSOORNE4",98,0)
 .I $G(PSONEW("ROUTE",I)) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Route: "_$P(^PS(51.2,PSONEW("ROUTE",I),0),"^")
"RTN","PSOORNE4",99,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="            Schedule: "_PSONEW("SCHEDULE",I)
"RTN","PSOORNE4",100,0)
 .I $G(PSONEW("DURATION",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="           *Duration: "_$G(PSONEW("DURATION",I))
"RTN","PSOORNE4",101,0)
 .I $G(PSONEW("CONJUNCTION",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="         Conjunction: "_$S($G(PSONEW("CONJUNCTION",I))="A":"AND",$G(PSONEW("CONJUNCTION",I))="T":"THEN",$G(PSONEW("CONJUNCTION",I))="X":"EXCEPT",1:"")
"RTN","PSOORNE4",102,0)
PAT S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=$S($G(PSOREEDT):" (10)",1:"     ")_"Pat Instruction:" D INS2^PSOBKDED
"RTN","PSOORNE4",103,0)
 S RXN=PSONEW("OIRXN") D INST1^PSORENW
"RTN","PSOORNE4",104,0)
 ;I $O(PRC(0)) D PC1^PSOORNE5
"RTN","PSOORNE4",105,0)
 K RXN S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                 SIG:"
"RTN","PSOORNE4",106,0)
 I $G(SIGOK),$O(SIG(0)) D  K SG,MIG
"RTN","PSOORNE4",107,0)
 .F I=0:0 S I=$O(SIG(I)) Q:'I  F SG=1:1:$L(SIG(I)) D
"RTN","PSOORNE4",108,0)
 ..S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(SIG(I)," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",21)=" "
"RTN","PSOORNE4",109,0)
 ..S:$P(SIG(I)," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(SIG(I)," ",SG)
"RTN","PSOORNE4",110,0)
 E  D
"RTN","PSOORNE4",111,0)
 .S X=$S($G(PSONEW("SIG"))]"":PSONEW("SIG"),1:$P($G(^PSRX(PSONEW("OIRXN"),"SIG")),"^")) D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOORNE4",112,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",21)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNE4",113,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="         Days Supply: "_PSONEW("DAYS SUPPLY")_$S($L(PSONEW("DAYS SUPPLY"))=1:" ",1:"")
"RTN","PSOORNE4",114,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                 QTY"_$S($G(PSODRUG("UNIT"))]"":" ("_PSODRUG("UNIT")_")",1:" (  )")_": "_PSONEW("QTY")
"RTN","PSOORNE4",115,0)
 I $D(^PSDRUG("AQ",PSODRUG("IEN"))),$P($G(^PSDRUG(PSODRUG("IEN"),5)),"^")]"" D
"RTN","PSOORNE4",116,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNE4",117,0)
 .S ^TMP("PSOPO",$J,IEN,0)="            QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^")
"RTN","PSOORNE4",118,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (3)   # of Refills: "_PSONEW("# OF REFILLS")_$S($L(PSONEW("# OF REFILLS"))=1:" ",1:"")
"RTN","PSOORNE4",119,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (4)        Routing: "_$S($G(PSORENW("MAIL/WINDOW"))["W":"WINDOW",1:"MAIL")
"RTN","PSOORNE4",120,0)
 S:$G(PSONEW("METHOD OF PICK-UP"))]""&($P(PSOPAR,"^",12)) IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="    Method of Pickup: "_PSONEW("METHOD OF PICK-UP")
"RTN","PSOORNE4",121,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (5)         Clinic: "_$S($G(PSONEW("CLINIC")):$P(^SC(PSONEW("CLINIC"),0),"^"),1:"")
"RTN","PSOORNE4",122,0)
 S $P(RN," ",31)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (6)       Provider: "_PSONEW("PROVIDER NAME")_$E(RN,$L(PSONEW("PROVIDER NAME"))+1,31) K RN
"RTN","PSOORNE4",123,0)
 I $G(PSONEW("COSIGNING PROVIDER"))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,PSONEW("COSIGNING PROVIDER"),0),"^")
"RTN","PSOORNE4",124,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (7)         Copies: "_$S($G(PSONEW("COPIES")):PSONEW("COPIES"),1:1)
"RTN","PSOORNE4",125,0)
RMK S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (8)        Remarks: "_$S($G(PSONEW("REMARKS"))]"":PSONEW("REMARKS"),1:"")
"RTN","PSOORNE4",126,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Entry By: "_$P(^VA(200,DUZ,0),"^")_$E(RN,$L($P(^VA(200,DUZ,0),"^"))+1,35)
"RTN","PSOORNE4",127,0)
 I $G(PSOFDR) S ^TMP("PSOPO",$J,IEN,0)="   Entry By: "_$P(^VA(200,$P(OR0,"^",4),0),"^")_$E(RN,$L($P(^VA(200,$P(OR0,"^",4),0),"^"))+1,35)
"RTN","PSOORNE4",128,0)
 D NOW^%DTC S PSONEW("LOGIN DATE")=$S($P($G(OR0),"^",6):$P($G(OR0),"^",6),1:%) K %,X S Y=PSONEW("LOGIN DATE") X ^DD("DD")
"RTN","PSOORNE4",129,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"Entry Date: "_$P(Y,"@")_" "_$P(Y,"@",2) K RN
"RTN","PSOORNE4",130,0)
 S (VALMCNT,PSOPF)=IEN
"RTN","PSOORNE4",131,0)
 Q
"RTN","PSOORNE4",132,0)
1 D 1^PSOBKDED Q
"RTN","PSOORNE4",133,0)
2 D 2^PSOBKDED Q
"RTN","PSOORNE4",134,0)
3 D 9^PSOBKDED Q
"RTN","PSOORNE4",135,0)
4 D 12^PSOBKDED Q
"RTN","PSOORNE4",136,0)
5 D 5^PSOBKDED Q
"RTN","PSOORNE4",137,0)
6 D 4^PSOBKDED Q
"RTN","PSOORNE4",138,0)
7 D 11^PSOBKDED Q
"RTN","PSOORNE4",139,0)
8 D 13^PSOBKDED Q
"RTN","PSOORNE4",140,0)
9 W !!,"Drug: "_PSODRUG("NAME") S PSOORRNW=1 D DOSE1^PSOORED5(.PSONEW)
"RTN","PSOORNE4",141,0)
 I $G(PSONEW("DFLG")) S PSODIR("DFLG")=1,VALMBCK="Q" Q
"RTN","PSOORNE4",142,0)
 D SV Q
"RTN","PSOORNE4",143,0)
10 D INS^PSODIR(.PSONEW),SINS^PSODIR(.PSONEW) D SV Q
"RTN","PSOORNE4",144,0)
SV D SV^PSOORNE5 Q
"RTN","PSOORNEW")
0^12^B78892061^B74656936
"RTN","PSOORNEW",1,0)
PSOORNEW ;BIR/SAB - display orders from oerr ;6/19/06 3:53pm
"RTN","PSOORNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,55,46,71,90,94,106,131,133,143,237,222,258,206,225,251,386**;DEC 1997;Build 4
"RTN","PSOORNEW",3,0)
 ;^PS(50.7 -2223
"RTN","PSOORNEW",4,0)
 ;^PSDRUG -221
"RTN","PSOORNEW",5,0)
 ;^PS(50.606 -2174
"RTN","PSOORNEW",6,0)
 ;^PS(55 -2228
"RTN","PSOORNEW",7,0)
 ;EN1^ORCFLAG -3620
"RTN","PSOORNEW",8,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOORNEW",9,0)
 ;
"RTN","PSOORNEW",10,0)
 ;PSO*237 quit Finish if Today > Issue date + 365
"RTN","PSOORNEW",11,0)
 ;
"RTN","PSOORNEW",12,0)
DSPL I $G(PSODSPL) S VALMBCK="Q" K PSODSPL,PSOANSQD Q
"RTN","PSOORNEW",13,0)
 Q:'$D(PSOLMC)  K ^TMP("PSOPO",$J) S PSOLMC=PSOLMC+1
"RTN","PSOORNEW",14,0)
 I $D(CLOZPAT) S PSONEW("DAYS SUPPLY")=$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),1:7) G OI
"RTN","PSOORNEW",15,0)
 S PSONEW("DAYS SUPPLY")=$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),+$G(^PS(55,PSODFN,"PS"))&($P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3))&('$G(PSONEW("DAYS SUPPLY"))):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3),1:30)
"RTN","PSOORNEW",16,0)
OI I '$G(PSODRUG("OI")) D
"RTN","PSOORNEW",17,0)
 .S (OI,PSODRUG("OI"))=$P(OR0,"^",8),PSODRUG("OIN")=$P(^PS(50.7,$P(OR0,"^",8),0),"^"),OID=$P(OR0,"^",9)
"RTN","PSOORNEW",18,0)
 .I $P($G(OR0),"^",9) S POERR=1,DREN=$P(OR0,"^",9) D DRG^PSOORDRG K POERR
"RTN","PSOORNEW",19,0)
 I '$D(CLOZPAT) I $G(PSODRUG("DEA"))["A",$G(PSODRUG("DEA"))'["B"!($G(PSODRUG("DEA"))["F") S PSONEW("# OF REFILLS")=0
"RTN","PSOORNEW",20,0)
 I $D(CLOZPAT) S PSONEW("# OF REFILLS")=$S($D(PSONEW("# OF REFILLS")):PSONEW("# OF REFILLS"),$G(CLOZPAT)=2&($P(OR0,"^",11)>2):3,$G(CLOZPAT)&($P(OR0,"^",11)>1):1,1:0)
"RTN","PSOORNEW",21,0)
 S IEN=0 D OBX^PSOORFI1,DIN^PSONFI(PSODRUG("OI"),$S($G(PSODRUG("IEN")):PSODRUG("IEN"),1:""))
"RTN","PSOORNEW",22,0)
 D LMDISP^PSOORFI5(+$G(ORD)) ; Display Flag/Unflag Information
"RTN","PSOORNEW",23,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="*(1) Orderable Item: "_$P(^PS(50.7,PSODRUG("OI"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_NFIO
"RTN","PSOORNEW",24,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNEW",25,0)
 K LST I $G(PSODRUG("NAME"))]"" D  G PT
"RTN","PSOORNEW",26,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)"_$S($D(^PSDRUG("AQ",PSODRUG("IEN"))):"      CMOP ",1:"           ")_"Drug: "_PSODRUG("NAME")_NFID
"RTN","PSOORNEW",27,0)
 .S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNEW",28,0)
 .I $P($G(^PSDRUG(PSODRUG("IEN"),0)),"^",10)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Drug Message:" D DRGMSG
"RTN","PSOORNEW",29,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)           Drug: No Dispense Drug Selected"
"RTN","PSOORNEW",30,0)
PT D DOSE2^PSOORFI4
"RTN","PSOORNEW",31,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (4)   Pat Instruct:" D:$O(PSONEW("SIG",0)) INST^PSOORFI4
"RTN","PSOORNEW",32,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  Provider Comments:" S TY=3 D INST^PSOORFI1
"RTN","PSOORNEW",33,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Instructions:" S TY=2 D INST^PSOORFI1
"RTN","PSOORNEW",34,0)
 K PSOELSE S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                SIG:"
"RTN","PSOORNEW",35,0)
 F I=0:0 S I=$O(SIG(I)) Q:'I  S SIG=SIG(I) D
"RTN","PSOORNEW",36,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNEW",37,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (5) Patient Status: "_$P($G(^PS(53,+PSONEW("PATIENT STATUS"),0)),"^")
"RTN","PSOORNEW",38,0)
 K PSOELSE I $G(PSONEW("ISSUE DATE"))']"" S PSOELSE=1 S IEN=IEN+1,(PSOID,Y)=$E($P(OR0,"^",6),1,7) X ^DD("DD") S PSONEW("ISSUE DATE")=Y,^TMP("PSOPO",$J,IEN,0)=" (4)     Issue Date: "_Y
"RTN","PSOORNEW",39,0)
 I '$G(PSOELSE) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (6)     Issue Date: "_PSONEW("ISSUE DATE")
"RTN","PSOORNEW",40,0)
 K PSOELSE I $G(PSORX("FILL DATE"))']"" S PSOELSE=1 D
"RTN","PSOORNEW",41,0)
 .S (Y,PSORX("FILL DATE"))=$S($E($P(OR0,"^",6),1,7)<DT:DT,1:$E($P(OR0,"^",6),1,7)) X ^DD("DD") S PSONEW("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"                  (5) Fill Date: "_Y
"RTN","PSOORNEW",42,0)
 I '$G(PSOELSE) S Y=PSORX("FILL DATE") X ^DD("DD") S PSORX("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"       (7) Fill Date: "_PSORX("FILL DATE")
"RTN","PSOORNEW",43,0)
 I $P(OR0,"^",18) S IEN=IEN+1,Y=$P(OR0,"^",18) X ^DD("DD") S $P(^TMP("PSOPO",$J,IEN,0)," ",39)="Effective Date: "_Y
"RTN","PSOORNEW",44,0)
 I $D(CLOZPAT) D ELIG^PSOORFI2 S:'$D(PSONEW("QTY")) PSONEW("QTY")=0
"RTN","PSOORNEW",45,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (8)    Days Supply: "_PSONEW("DAYS SUPPLY")
"RTN","PSOORNEW",46,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"               (9)   QTY"_$S($P($G(^PSDRUG(+$G(PSODRUG("IEN")),660)),"^",8)]"":" ("_$P($G(^PSDRUG(+PSODRUG("IEN"),660)),"^",8)_")",1:" (  )")
"RTN","PSOORNEW",47,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_": "_$S($G(PSONEW("QTY"))]"":PSONEW("QTY"),1:$P(OR0,"^",10))
"RTN","PSOORNEW",48,0)
 I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),5)),"^")]"" D
"RTN","PSOORNEW",49,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNEW",50,0)
 .S ^TMP("PSOPO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^") K RN
"RTN","PSOORNEW",51,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Provider ordered "_+$P(OR0,"^",11)_" refills"
"RTN","PSOORNEW",52,0)
 D:$D(CLOZPAT) PQTY^PSOORFI4
"RTN","PSOORNEW",53,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(10)   # of Refills: "_$S($G(PSONEW("# OF REFILLS"))]"":PSONEW("# OF REFILLS"),1:$P(OR0,"^",11))_"               (11)   Routing: "_$S($G(PSONEW("MAIL/WINDOW"))="M":"MAIL",1:"WINDOW")
"RTN","PSOORNEW",54,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(12)         Clinic: "_PSORX("CLINIC")
"RTN","PSOORNEW",55,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(13)       Provider: "_PSONEW("PROVIDER NAME")
"RTN","PSOORNEW",56,0)
 I $P($G(^VA(200,$S($G(PSONEW("PROVIDER")):PSONEW("PROVIDER"),1:$P(OR0,"^",5)),"PS")),"^",7)&($P($G(^("PS")),"^",8)) D
"RTN","PSOORNEW",57,0)
 .S IEN=IEN+1,PSONEW("COSIGNING PROVIDER")=$S($G(PSONEW("COSIGNING PROVIDER")):PSONEW("COSIGNING PROVIDER"),1:$P(^("PS"),"^",8))
"RTN","PSOORNEW",58,0)
 .S ^TMP("PSOPO",$J,IEN,0)="       Cos-Provider: "_$P(^VA(200,PSONEW("COSIGNING PROVIDER"),0),"^")
"RTN","PSOORNEW",59,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(14)         Copies: "_$S($G(PSONEW("COPIES")):PSONEW("COPIES"),1:1)
"RTN","PSOORNEW",60,0)
 S PSONEW("REMARKS")=$S($G(PSONEW("REMARKS"))]"":PSONEW("REMARKS"),$P(OR0,"^",17)="C":"Administered in Clinic.",1:"")
"RTN","PSOORNEW",61,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(15)        Remarks:"
"RTN","PSOORNEW",62,0)
 I $G(PSONEW("REMARKS"))]"" D
"RTN","PSOORNEW",63,0)
 .F SG=1:1:$L(PSONEW("REMARKS")) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(PSONEW("REMARKS")," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " D
"RTN","PSOORNEW",64,0)
 ..S:$P(PSONEW("REMARKS")," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(PSONEW("REMARKS")," ",SG)
"RTN","PSOORNEW",65,0)
 I $G(PSOSIGFL)!(PSODRUG("OI")'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSORX("CLERK CODE")=$P(^VA(200,DUZ,0),"^"),VALMSG="This change will create a new prescription!"
"RTN","PSOORNEW",66,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Entry By: "_$P(^VA(200,PSONEW("CLERK CODE"),0),"^")_$E(RN,$L($P(^VA(200,PSONEW("CLERK CODE"),0),"^"))+1,35)
"RTN","PSOORNEW",67,0)
 S Y=$P(OR0,"^",12) X ^DD("DD") S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"Entry Date: "_$E($P(OR0,"^",12),4,5)_"/"_$E($P(OR0,"^",12),6,7)_"/"_$E($P(OR0,"^",12),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSOORNEW",68,0)
 I PSOLMC<2 D ^PSOLMPO1 S VALMBCK="Q",PSOLMC=0
"RTN","PSOORNEW",69,0)
 S:PSOLMC>1 VALMBCK="R"
"RTN","PSOORNEW",70,0)
 Q
"RTN","PSOORNEW",71,0)
ORCHK D PROVCOM^PSOORFI4,ORCHK^PSOORFI4
"RTN","PSOORNEW",72,0)
 Q
"RTN","PSOORNEW",73,0)
EDT D KV S DIR("A",1)="* Indicates which fields will create an new Order",DIR("A")="Select Field to Edit by number",DIR(0)="LO^1:15" D ^DIR Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOORNEW",74,0)
EDTSEL N LST,FLD,OUT D KV S OUT=0
"RTN","PSOORNEW",75,0)
 I +Y S LST=Y D FULL^VALM1 N PSODOSE M PSODOSE=PSONEW D  G DSPL
"RTN","PSOORNEW",76,0)
 .F FLD=1:1:$L(LST,",") Q:$P(LST,",",FLD)']""!(OUT)  D @(+$P(LST,",",FLD)) D:$P(LST,",",FLD)=8 REF D KV
"RTN","PSOORNEW",77,0)
 E  S VALMBCK="" Q
"RTN","PSOORNEW",78,0)
 Q
"RTN","PSOORNEW",79,0)
ACP ;
"RTN","PSOORNEW",80,0)
 N DIR,Y S Y=0
"RTN","PSOORNEW",81,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 D  Q:$D(DIRUT)!'Y  D EN1^ORCFLAG(+$P($G(^PS(52.41,ORD,0)),"^")) H 1
"RTN","PSOORNEW",82,0)
 . D FULL^VALM1
"RTN","PSOORNEW",83,0)
 . I '$D(^XUSEC("PSORPH",DUZ)) D  S Y=0 Q
"RTN","PSOORNEW",84,0)
 . . S DIR("A",1)="Order must be unflagged by a pharmacist before it can be finished."
"RTN","PSOORNEW",85,0)
 . . S DIR("A",2)=""
"RTN","PSOORNEW",86,0)
 . . S DIR(0)="E",DIR("A")="Enter RETURN to continue" W !,$C(7) D ^DIR
"RTN","PSOORNEW",87,0)
 . . S VALMBCK="R"
"RTN","PSOORNEW",88,0)
 . D KV
"RTN","PSOORNEW",89,0)
 . S DIR("A",1)="This Order is flagged. In order to finish it"
"RTN","PSOORNEW",90,0)
 . S DIR("A",2)="you must unflag it first."
"RTN","PSOORNEW",91,0)
 . S DIR("A",3)=""
"RTN","PSOORNEW",92,0)
 . S DIR(0)="Y",DIR("A")="Unflag Order",DIR("B")="NO"
"RTN","PSOORNEW",93,0)
 . W ! D ^DIR I $D(DIRUT)!'Y S VALMBCK="Q"
"RTN","PSOORNEW",94,0)
 I $G(ORD),+$P($G(^PS(52.41,+ORD,0)),"^",23)=1 Q
"RTN","PSOORNEW",95,0)
 ;
"RTN","PSOORNEW",96,0)
 I $D(CLOZPAT),+$G(PSONEW("QTY"))=0 S VALMSG="Unable to calculate the quantity, enter a quantity" G DSPL
"RTN","PSOORNEW",97,0)
 S (PSODIR("DFLG"),PSORX("DFLG"),PSODIR("QFLD"))=0,ACP=1 D ORCHK
"RTN","PSOORNEW",98,0)
 G:$G(PSONEW("QFLG")) DSPL
"RTN","PSOORNEW",99,0)
 I $G(PSODIR("DFLG"))!$G(PSORX("DFLG")) Q
"RTN","PSOORNEW",100,0)
 I $G(PSONEW("FLD"))!($G(PSODRUG("NAME"))']"")!('$O(SIG(0))) G DSPL
"RTN","PSOORNEW",101,0)
 I $G(PSODRUG("NAME"))]"",'$G(ORCHK)!($G(ORDRG)'=PSODRUG("NAME")) D  I $G(PSORX("DFLG")) D CLEAN^PSOVER1 G DSPL
"RTN","PSOORNEW",102,0)
 . D POST^PSODRG S:'$G(PSORX("DFLG")) ORCHK=1,ORDRG=PSODRUG("NAME")
"RTN","PSOORNEW",103,0)
 D:$$DS^PSSDSAPI&('$G(PSORX("DFLG"))) DOSCK^PSODOSUT("N") I $G(PSORX("DFLG")) D CLEAN^PSOVER1 G DSPL
"RTN","PSOORNEW",104,0)
 I '$D(PSONEW("RX #")) S PSOFROM="NEW",RTN=$S($P($G(PSOPAR),"^",7):"AUTO^PSONRXN",1:"MANUAL^PSONRXN") D @RTN Q:PSONEW("QFLG")  I '$P($G(PSOPAR),"^",7) S PSOX=PSONEW("RX #") D CHECK^PSONRXN
"RTN","PSOORNEW",105,0)
 D RXNCHK^PSOORNE1 I $G(PSONEW("QFLG")) S PSONEW("DFLG")=1 Q
"RTN","PSOORNEW",106,0)
 I DT>$$FMADD^XLFDT($P(OR0,"^",6),365) D EXPR^PSONEW2 G DSPL
"RTN","PSOORNEW",107,0)
 D STOP^PSONEW2,DISPLAY^PSONEW2,^PSONEWF
"RTN","PSOORNEW",108,0)
 I $G(PSOCPZ("DFLG")) W !!,"No action taken!",! K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR,KV K PSOCPZ("DFLG"),DRET,PSOANSQD S VALMBCK="Q" Q
"RTN","PSOORNEW",109,0)
 ;
"RTN","PSOORNEW",110,0)
 K PSOCPZ("DFLG") D KV S DIR(0)="Y",DIR("A")="Are you sure you want to Accept this Order",DIR("B")="NO" D ^DIR I $D(DIRUT) D KV K DRET,PSOANSQ,PSOANSQD S VALMBCK="Q" Q
"RTN","PSOORNEW",111,0)
 D KV I 'Y K PSOANSQ G DSPL
"RTN","PSOORNEW",112,0)
 I $G(PSONEW("MAIL/WINDOW"))["W" D:$P($G(PSOPAR),"^",12)  S BINGCRT="Y",BINGRTE="W",PSORX("MAIL/WINDOW")="WINDOW" K RTN
"RTN","PSOORNEW",113,0)
 .W ! K DIR,DIRUT S DIR(0)="52,35O"
"RTN","PSOORNEW",114,0)
 .S:$G(PSORX("METHOD OF PICK-UP"))]"" DIR("B")=PSORX("METHOD OF PICK-UP") D ^DIR I $D(DIRUT) K DIR,DIRUT Q
"RTN","PSOORNEW",115,0)
 .S (PSONEW("METHOD OF PICK-UP"),PSORX("METHOD OF PICK-UP"))=Y K X,Y
"RTN","PSOORNEW",116,0)
 S PSONEW("POE")=1 D EN^PSON52(.PSONEW) G:$G(PSONEW("DFLG")) ABORT D DCORD^PSONEW2
"RTN","PSOORNEW",117,0)
 D NPSOSD^PSOUTIL(.PSONEW),FULL^VALM1 K PSORX("MAIL/WINDOW")
"RTN","PSOORNEW",118,0)
 D EOJ^PSONEW
"RTN","PSOORNEW",119,0)
ABORT S VALMBCK="Q",DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to Continue" D ^DIR,CLEAN^PSOVER1,KV
"RTN","PSOORNEW",120,0)
 Q
"RTN","PSOORNEW",121,0)
KV K DIRUT,DUOUT,DTOUT,DIR
"RTN","PSOORNEW",122,0)
 Q
"RTN","PSOORNEW",123,0)
REF D REF^PSOORFI4
"RTN","PSOORNEW",124,0)
 Q
"RTN","PSOORNEW",125,0)
1 N PSOBDR,PSOBDRG S PSOBDRG=1 D 1^PSOORNW2 Q  ;oi
"RTN","PSOORNEW",126,0)
 ;
"RTN","PSOORNEW",127,0)
4 D INS^PSOORNW2 Q
"RTN","PSOORNEW",128,0)
 ;
"RTN","PSOORNEW",129,0)
3 D DOSE^PSOORED4(.PSONEW) Q
"RTN","PSOORNEW",130,0)
 ;
"RTN","PSOORNEW",131,0)
6 D 4^PSOORNW2 Q  ;idt
"RTN","PSOORNEW",132,0)
 ;
"RTN","PSOORNEW",133,0)
7 D 5^PSOORNW2 Q  ;fdt
"RTN","PSOORNEW",134,0)
 ;
"RTN","PSOORNEW",135,0)
5 D 3^PSOORNW2 Q  ;pstat
"RTN","PSOORNEW",136,0)
 ;
"RTN","PSOORNEW",137,0)
13 D 12^PSOORNW2 Q  ;doc
"RTN","PSOORNEW",138,0)
 ;
"RTN","PSOORNEW",139,0)
12 D 11^PSOORNW2 Q  ;cli
"RTN","PSOORNEW",140,0)
 ;
"RTN","PSOORNEW",141,0)
2 N PSOCSIG I '$G(PSOBDRG) N PSOBDR,PSOBDRG S PSOBDRG=1
"RTN","PSOORNEW",142,0)
 D 2^PSOORNW1 Q:$G(PSOQFLG)  D EN^PSODIAG  ;drg/ICD
"RTN","PSOORNEW",143,0)
 I $G(PSOCSIG) K PSOCSIG G 3
"RTN","PSOORNEW",144,0)
 Q
"RTN","PSOORNEW",145,0)
 ;
"RTN","PSOORNEW",146,0)
9 D 8^PSOORNW2 Q  ;qty
"RTN","PSOORNEW",147,0)
 ;
"RTN","PSOORNEW",148,0)
8 D 7^PSOORNW2 Q  ;ds
"RTN","PSOORNEW",149,0)
 ;
"RTN","PSOORNEW",150,0)
10 D 9^PSOORNW2 Q  ;#rfs
"RTN","PSOORNEW",151,0)
 ;
"RTN","PSOORNEW",152,0)
14 D 13^PSOORNW2 Q  ;cop
"RTN","PSOORNEW",153,0)
 ;
"RTN","PSOORNEW",154,0)
11 D 10^PSOORNW2 Q  ;m/w
"RTN","PSOORNEW",155,0)
 ;
"RTN","PSOORNEW",156,0)
15 D 14^PSOORNW2 Q  ;rem
"RTN","PSOORNEW",157,0)
 ;
"RTN","PSOORNEW",158,0)
DRGMSG ;
"RTN","PSOORNEW",159,0)
 F SG=1:1:$L($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " D
"RTN","PSOORNEW",160,0)
 .S:$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG)
"RTN","PSOORNEW",161,0)
 K SG
"RTN","PSOORNEW",162,0)
 Q
"RTN","PSOORNEW",163,0)
 ;
"RTN","PSOORRNW")
0^5^B20831236^B24262987
"RTN","PSOORRNW",1,0)
PSOORRNW ;BIR/SAB-finish OP renew orders from OE/RR ; 4/26/11 2:20pm
"RTN","PSOORRNW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,51,46,71,94,130,131,146,206,225,384,386**;DEC 1997;Build 4
"RTN","PSOORRNW",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORRNW",4,0)
 ;External reference to ^PS(50.607 supported by DBIA 2221
"RTN","PSOORRNW",5,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORRNW",6,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOORRNW",7,0)
 S PSORENXX=$P($G(OR0),"^",21),PSOFROM="NEW" K PRC,PHI
"RTN","PSOORRNW",8,0)
 I $G(PSORENXX) D PSOL^PSSLOCK(PSORENXX) I '$G(PSOMSG) D  K DIR,PSOMSG W ! S DIR("A")="Press Return to continue",DIR(0)="E" D ^DIR K DIR W ! Q
"RTN","PSOORRNW",9,0)
 .I $P($G(PSOMSG),"^",2)'="" W $C(7),!!,$P(PSOMSG,"^",2) Q
"RTN","PSOORRNW",10,0)
 .W $C(7),!!,"Another person is editing Rx "_$P($G(^PSRX(PSORENXX,0)),"^")
"RTN","PSOORRNW",11,0)
 K PSOMSG N OI,VALMCNT K POERR("DFLG") D FULL^VALM1 S (PSORX("DFLG"),PSORENW("DFLG"))=0,(PSORNW("FILL DATE"),PSORENW("FILL DATE"))=DT
"RTN","PSOORRNW",12,0)
 S Y=DT X ^DD("DD") S PSORX("FILL DATE")=Y K Y
"RTN","PSOORRNW",13,0)
 ;
"RTN","PSOORRNW",14,0)
 W !!,"Now Renewing Rx # "_$P(^PSRX($P(OR0,"^",21),0),"^")_"   Drug: "_$P($G(^PSDRUG($P(^PSRX($P(OR0,"^",21),0),"^",6),0)),"^"),! H 2
"RTN","PSOORRNW",15,0)
 I $P($G(^PSRX($P(OR0,"^",21),"OR1")),"^",4) D  D PROCESSX^PSORENW0 D UL Q
"RTN","PSOORRNW",16,0)
 .W !!,"Cannot Renew Rx # "_$P(^PSRX($P(OR0,"^",21),0),"^"),!," Drug: "_$P($G(^PSDRUG($P(^PSRX($P(OR0,"^",21),0),"^",6),0)),"^")_"."
"RTN","PSOORRNW",17,0)
 .W !,"This Rx has already been RENEWED ("_$P(^PSRX($P(^PSRX($P(OR0,"^",21),"OR1"),"^",4),0),"^")_").",!
"RTN","PSOORRNW",18,0)
 .S ACOM="Duplicate Renewal Request. Order rejected by Pharmacy.",PSONOOR="D" D DE^PSOORFI2 K ACOM,POERR("COMM"),POERR("PLACER"),POERR("STAT")
"RTN","PSOORRNW",19,0)
 I '$G(PSOTPBFG) D DSPL^PSOTPCAN(ORD)
"RTN","PSOORRNW",20,0)
 S (PSORX("PROVIDER NAME"),PSORENW("PROVIDER NAME"))=$P(^VA(200,$P(OR0,"^",5),0),"^"),PSORENW("NOO")=$P(OR0,"^",7)
"RTN","PSOORRNW",21,0)
 S PSORENW("PROVIDER")=$P(OR0,"^",5),PSORENW("MAIL/WINDOW")=$S($P(OR0,"^",17)="M":"M",1:"W")
"RTN","PSOORRNW",22,0)
 ;I $O(^PSRX($P(OR0,"^",21),"PRC",0)) F I=0:0 S I=$O(^PSRX($P(OR0,"^",21),"PRC",I)) Q:'I  S PRC(I)=^PSRX($P(OR0,"^",21),"PRC",I,0)
"RTN","PSOORRNW",23,0)
 K II F I=0:0 S I=$O(^PS(52.41,ORD,1,I)) Q:'I  S DOSE=$G(^PS(52.41,ORD,1,I,1)),DOSE1=$G(^(2)) D 
"RTN","PSOORRNW",24,0)
 .S II=$G(II)+1
"RTN","PSOORRNW",25,0)
 .S PSORENW("DOSE",II)=$P(DOSE1,"^"),PSORENW("DOSE ORDERED",II)=$P(DOSE1,"^",2),PSORENW("UNITS",II)=$P(DOSE,"^",9),PSORENW("NOUN",II)=$P(DOSE,"^",5)
"RTN","PSOORRNW",26,0)
 .S:$P(DOSE,"^",9) UNITS=$P(^PS(50.607,$P(DOSE,"^",9),0),"^")
"RTN","PSOORRNW",27,0)
 .S PSORENW("VERB",II)=$P(DOSE,"^",10),PSORENW("ROUTE",II)=$P(DOSE,"^",8)
"RTN","PSOORRNW",28,0)
 .S ROUTE=$S($P(DOSE,"^",8):$$GET1^DIQ(^PS(51.2,$P(DOSE,"^",8),0),"^"),1:"") ;PSO*7*384
"RTN","PSOORRNW",29,0)
 .S PSORENW("SCHEDULE",II)=$P(DOSE,"^"),PSORENW("DURATION",II)=$P(DOSE,"^",2)
"RTN","PSOORRNW",30,0)
 .I $P(DOSE,"^",6)]"" S PSORENW("CONJUNCTION",II)=$S($P(DOSE,"^",6)="S":"T",$P(DOSE,"^",6)="X":"X",1:"A")
"RTN","PSOORRNW",31,0)
 S PSORENW("ENT")=+$G(II) K II,I
"RTN","PSOORRNW",32,0)
 F DR=1:1:PSORENW("ENT") I $G(PSORENW("DURATION",DR))]"" D
"RTN","PSOORRNW",33,0)
 .S DUR1=PSORENW("DURATION",DR)
"RTN","PSOORRNW",34,0)
 .S PSORENW("DURATION",DR)=$S($E(DUR1,1)'?.N:$E(DUR1,2,99)_$E(DUR1,1),1:DUR1)
"RTN","PSOORRNW",35,0)
 D ^PSORENW1,CHECK^PSORENW0 I PSORENW("DFLG") D KLIB^PSORENW1 D PROCESSX^PSORENW0 D UL Q
"RTN","PSOORRNW",36,0)
 D FILDATE^PSORENW0,DRUG^PSORENW0 I PSORENW("DFLG")!$G(PSORX("DFLG")) D KLIB^PSORENW1 D PROCESSX^PSORENW0 D UL Q
"RTN","PSOORRNW",37,0)
 D RXN^PSORENW0 I PSORENW("DFLG") D KLIB^PSORENW1 D PROCESSX^PSORENW0 D UL Q
"RTN","PSOORRNW",38,0)
 D STOP^PSORENW1,INIT^PSORENW3
"RTN","PSOORRNW",39,0)
 I $G(PSOORRNW) D
"RTN","PSOORRNW",40,0)
 .S PSORENW("ISSUE DATE")=$S(PSORENW("FILL DATE")>DT:DT,PSORENW("FILL DATE")<$E($P(OR0,"^",6),1,7):PSORENW("FILL DATE"),1:$E($P(OR0,"^",6),1,7))
"RTN","PSOORRNW",41,0)
 .S PSORENW("# OF REFILLS")=+$P(OR0,"^",11),PSOFDR=1
"RTN","PSOORRNW",42,0)
 .S PSORENW("CLERK CODE")=$P(OR0,"^",4),PSORX("CLERK CODE")=$P(^VA(200,$P(OR0,"^",4),0),"^")
"RTN","PSOORRNW",43,0)
 ;D CHK
"RTN","PSOORRNW",44,0)
 S PSOFXRN=0,PSOFXRNX=1
"RTN","PSOORRNW",45,0)
 S PSORENW("POE")=$S($G(^PS(52.41,ORD,"POE"))=1:1,'$O(^PSRX($P(OR0,"^",21),6,0)):1,1:"")
"RTN","PSOORRNW",46,0)
 S PSORENW("PENDING ORDER")=ORD
"RTN","PSOORRNW",47,0)
 D EN^PSOORNE4(.PSORENW) K PSORENW,PSORX("FILL DATE")
"RTN","PSOORRNW",48,0)
 I '$G(PSOFXRN) D UL
"RTN","PSOORRNW",49,0)
 D KLIB^PSORENW1
"RTN","PSOORRNW",50,0)
 K PSOFXRN,PSOFXRNX
"RTN","PSOORRNW",51,0)
 Q
"RTN","PSOORRNW",52,0)
CHK ;check for valid # of refills
"RTN","PSOORRNW",53,0)
 I $G(PSODRUG("DEA"))]"" D
"RTN","PSOORRNW",54,0)
 .S PSOCS=0 K DIR,DIC,PSOX
"RTN","PSOORRNW",55,0)
 .F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSOCS,"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSOCS,"^",2)=1
"RTN","PSOORRNW",56,0)
 .;PSO*7*206
"RTN","PSOORRNW",57,0)
 .S PSOMAX=$S(PSOCS:5,1:11) I PSODRUG("DEA")["A"&(PSODRUG("DEA")'["B")!(PSODRUG("DEA")["F")!(PSODRUG("DEA")[1)!(PSODRUG("DEA")[2) S PSOMAX=0
"RTN","PSOORRNW",58,0)
 E  S PSOMAX=$P(OR0,"^",11)
"RTN","PSOORRNW",59,0)
 S RXPT=+$P(PSORENW("RX0"),"^",3) I $G(^PS(53,RXPT,0))]"" D
"RTN","PSOORRNW",60,0)
 .S PSORENW("# OF REFILLS")=$S(+$P(OR0,"^",11)>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:+$P(OR0,"^",11)),PSOX=+$P(^PS(53,RXPT,0),"^",4)
"RTN","PSOORRNW",61,0)
 .S PSORENW("# OF REFILLS")=$S(PSORENW("# OF REFILLS")>PSOMAX:PSOMAX,1:PSORENW("# OF REFILLS"))
"RTN","PSOORRNW",62,0)
 .S PSOMAX=$S(PSOMAX>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:PSOMAX) K RXPT
"RTN","PSOORRNW",63,0)
 E  D
"RTN","PSOORRNW",64,0)
 . I $G(PSOMAX) S PSORENW("# OF REFILLS")=$S(+$P(OR0,"^",11)>PSOMAX:PSOMAX,1:+$P(OR0,"^",11))
"RTN","PSOORRNW",65,0)
 Q
"RTN","PSOORRNW",66,0)
 ;
"RTN","PSOORRNW",67,0)
EDTPEN ;edit front door renews
"RTN","PSOORRNW",68,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOORNE4
"RTN","PSOORRNW",69,0)
 Q
"RTN","PSOORRNW",70,0)
UL I $G(PSORENXX) D PSOUL^PSSLOCK(PSORENXX)
"RTN","PSOORRNW",71,0)
 K PSORENXX
"RTN","PSOORRNW",72,0)
 Q
"RTN","PSORXPR1")
0^10^B10534780^B11372879
"RTN","PSORXPR1",1,0)
PSORXPR1 ;BHAM ISC/SAB -  CONTINUATION OF VIEW PRESCRIPTION ; 10/01/92
"RTN","PSORXPR1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**258,386**;DEC 1997;Build 4
"RTN","PSORXPR1",3,0)
RF D HEAD F N=0:0 S N=$O(^PSRX(DA,1,N)) Q:'N  S P1=^(N,0) D  Q:$D(DIRUT)
"RTN","PSORXPR1",4,0)
 .D CON:$Y>20 Q:$D(DIRUT)  D:FFX HEAD W !,N,?3 S DTT=$P(P1,"^",8)\1 D DAT W DAT,?12
"RTN","PSORXPR1",5,0)
 .S DTT=$P(P1,"^") D DAT W DAT,?22,$P(P1,"^",4),?36
"RTN","PSORXPR1",6,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"UNKNOWN"),X=$P(P1,"^",2),X=$F("MWIBD",X)-1 W:X $P("M^W^INP","^",X),?40,$P(P1,"^",6),?52,$E($S($D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16),?70,PSDIV
"RTN","PSORXPR1",7,0)
 .W !," DISPENSED: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")
"RTN","PSORXPR1",8,0)
 .W ?$X+10,$S($P(P1,"^",16):" RETURNED TO STOCK: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" RELEASED: "_$S($P(P1,"^",18):$E($P(P1,"^",18),4,5)_"/"_$E($P(P1,"^",18),6,7)_"/"_$E($P(P1,"^",18),2,3),1:""))
"RTN","PSORXPR1",9,0)
 .W:$P(P1,"^",3)'="" !?5,"REMARKS: ",$P(P1,"^",3),!
"RTN","PSORXPR1",10,0)
 Q
"RTN","PSORXPR1",11,0)
PAR I $O(^PSRX(DA,"P",0)) D CON:$Y>20 Q:$D(DIRUT)  D PARL S N=0 F  S N=$O(^PSRX(DA,"P",N)) Q:'N  S P1=^(N,0) D  Q:$D(DIRUT)
"RTN","PSORXPR1",12,0)
 .D CON:$Y>20 Q:$D(DIRUT)  D:FFX PAR W !,N,?3 S DTT=$P(P1,"^",8)\1 D DAT W DAT,?14
"RTN","PSORXPR1",13,0)
 .S DTT=$P(P1,"^") D DAT W DAT,?27,$P(P1,"^",4),?32
"RTN","PSORXPR1",14,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"UNKNOWN"),X=$P(P1,"^",2),X=$F("MWIBD",X)-1 W:X $P("MAIL^WINDOW^INPATIENT","^",X)
"RTN","PSORXPR1",15,0)
 .W ?40,$P(P1,"^",6),?52,$E($S($D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16),?70,PSDIV
"RTN","PSORXPR1",16,0)
 .W ?$X+10,$S($P(P1,"^",16):" RETURNED TO STOCK: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" RELEASED: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:""))
"RTN","PSORXPR1",17,0)
 .W:$P(P1,"^",3)'="" !?5,"REMARKS: ",$P(P1,"^",3)
"RTN","PSORXPR1",18,0)
 Q
"RTN","PSORXPR1",19,0)
HLD ;prints hold info
"RTN","PSORXPR1",20,0)
 S DTT=$P(^PSRX(DA,"H"),"^",3) D DAT S HLDR=$$GET1^DIQ(52,DA,99)
"RTN","PSORXPR1",21,0)
 W !!,"HOLD REASON: "_HLDR,?60,"HOLD DATE: "_DAT W:$P(^PSRX(DA,"H"),"^",2)]"" !,"HOLD COMMENTS: "_$P(^PSRX(DA,"H"),"^",2)
"RTN","PSORXPR1",22,0)
 K DAT,DTT,HLDR
"RTN","PSORXPR1",23,0)
 Q
"RTN","PSORXPR1",24,0)
HEAD I FFX W @IOF
"RTN","PSORXPR1",25,0)
 W !,"#",?3,"LOG DATE",?12,"REF DATE",?22,"QTY",?35,"ROUT",?40,"LOT #",?52,"PHARMACIST",?70,"DIVISION",! F I=1:1:79 W "="
"RTN","PSORXPR1",26,0)
 S FFX=0 W ! Q
"RTN","PSORXPR1",27,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSORXPR1",28,0)
 Q
"RTN","PSORXPR1",29,0)
PARL I FFX W @IOF
"RTN","PSORXPR1",30,0)
 W !,"PARTIAL FILLS:",!,"#",?3,"LOG DATE",?14,"DATE",?27,"QTY",?32,"ROUTING",?40,"LOT #",?55,"PHARMACIST",?70,"DIVISION",! F I=1:1:79 W "="
"RTN","PSORXPR1",31,0)
 S FFX=0 W ! Q
"RTN","PSORXPR1",32,0)
CON K DTOUT,DIRUT,DUOUT,DIR S DIR(0)="E" D ^DIR S FFX=1 Q
"RTN","PSORXVW1")
0^9^B71614057^B71843058
"RTN","PSORXVW1",1,0)
PSORXVW1 ;BIR/SAB-view prescription con't ; 12/4/07 12:28pm
"RTN","PSORXVW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**35,47,46,71,99,117,156,193,210,148,258,260,240,281,359,354,367,386**;DEC 1997;Build 4
"RTN","PSORXVW1",3,0)
 ;External reference to ^DD(52 supported by DBIA 999
"RTN","PSORXVW1",4,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSORXVW1",5,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSORXVW1",6,0)
 ;
"RTN","PSORXVW1",7,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",6) D
"RTN","PSORXVW1",8,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(^PSRX(RXN,"OR1"),"^",6) D ^DIC
"RTN","PSORXVW1",9,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="           Filled By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",10,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",7) D
"RTN","PSORXVW1",11,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(^PSRX(RXN,"OR1"),"^",7) D ^DIC
"RTN","PSORXVW1",12,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Checked By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",13,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(RX0,"^",16) D ^DIC
"RTN","PSORXVW1",14,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Entry By: "_$P(Y,"^",2)_$E(RN,$L($P(Y,"^",2))+1,35)
"RTN","PSORXVW1",15,0)
 S Y=$P(RX2,"^") X ^DD("DD")
"RTN","PSORXVW1",16,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"Entry Date: "_$E($P(RX2,"^"),4,5)_"/"_$E($P(RX2,"^"),6,7)_"/"_$E($P(RX2,"^"),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSORXVW1",17,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" " ;,IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",18,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Original Fill Released: " I $P(RX2,"^",13) S DTT=$P(RX2,"^",13) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT K DAT,DTT
"RTN","PSORXVW1",19,0)
 I $P(RX2,"^",15) S DTT=$P(RX2,"^",15) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"(Returned to Stock "_DAT_")" K DAT,DTT
"RTN","PSORXVW1",20,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"      Routing: "_$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW1",21,0)
 I $G(^PSRX(DA,"H"))]"",$P(^("STA"),"^")=3 D HLD
"RTN","PSORXVW1",22,0)
 D RF,PAR,ACT,COPAY^PSORXVW2,LBL,ECME^PSOORAL1,^PSORXVW2:$O(^PSRX(DA,4,0))
"RTN","PSORXVW1",23,0)
 Q
"RTN","PSORXVW1",24,0)
ACT ;activity log
"RTN","PSORXVW1",25,0)
 N CNT
"RTN","PSORXVW1",26,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Activity Log:"
"RTN","PSORXVW1",27,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Reason         Rx Ref         Initiator Of Activity",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",28,0)
 I '$O(^PSRX(DA,"A",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO Activity to report" Q
"RTN","PSORXVW1",29,0)
 S CNT=0
"RTN","PSORXVW1",30,0)
 F N=0:0 S N=$O(^PSRX(DA,"A",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D DAT D
"RTN","PSORXVW1",31,0)
 .I $P(P1,"^",2)="M" Q
"RTN","PSORXVW1",32,0)
 .S IEN=IEN+1,CNT=CNT+1,^TMP("PSOAL",$J,IEN,0)=CNT_"   "_DAT_"    ",$P(RN," ",15)=" ",REA=$P(P1,"^",2)
"RTN","PSORXVW1",33,0)
 .S REA=$F("HUCELPRWSIVDABXGKNM",REA)-1
"RTN","PSORXVW1",34,0)
 .I REA D
"RTN","PSORXVW1",35,0)
 ..S STA=$P("HOLD^UNHOLD^DISCONTINUED^EDIT^RENEWED^PARTIAL^REINSTATE^REPRINT^SUSPENSE^RETURNED^INTERVENTION^DELETED^DRUG INTERACTION^PROCESSED^X-INTERFACE^PATIENT INSTR.^PKI/DEA^DISP COMPLETED^ECME^","^",REA)
"RTN","PSORXVW1",36,0)
 ..S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA_$E(RN,$L(STA)+1,15)
"RTN","PSORXVW1",37,0)
 .E  S $P(STA," ",15)=" ",^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA
"RTN","PSORXVW1",38,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSORXVW1",39,0)
 .S RFT=$S(RF>0&(RF<6):"REFILL "_RF,RF=6:"PARTIAL",RF>6:"REFILL "_(RF-1),1:"ORIGINAL")
"RTN","PSORXVW1",40,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(P1,"^",3) D ^DIC
"RTN","PSORXVW1",41,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$E(RN,$L(RFT)+1,15)_$S(+Y:$P(Y,"^",2),1:$P(P1,"^",3))
"RTN","PSORXVW1",42,0)
 .;S:$P(P1,"^",5)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(P1,"^",5)
"RTN","PSORXVW1",43,0)
 .I $P(P1,"^",5)]"" N PSOACBRK,PSOACBRV D
"RTN","PSORXVW1",44,0)
 ..S PSOACBRV=$P(P1,"^",5)
"RTN","PSORXVW1",45,0)
 ..;PSO*7*240 Use fileman to format
"RTN","PSORXVW1",46,0)
 ..K ^UTILITY($J,"W") S X="Comments: "_PSOACBRV,(DIWR,DIWL)=1,DIWF="C80" D ^DIWP F I=1:1:^UTILITY($J,"W",1) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$G(^UTILITY($J,"W",1,I,0))
"RTN","PSORXVW1",47,0)
 .I $G(^PSRX(DA,"A",N,1))]"" S IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",5)=$P(^PSRX(DA,"A",N,1),"^") I $P(^PSRX(DA,"A",N,1),"^",2)]"" S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_":"_$P(^PSRX(DA,"A",N,1),"^",2)
"RTN","PSORXVW1",48,0)
 .I $O(^PSRX(DA,"A",N,2,0)) F I=0:0 S I=$O(^PSRX(RXN,"A",N,2,I)) Q:'I  S MIG=^PSRX(RXN,"A",N,2,I,0) D
"RTN","PSORXVW1",49,0)
 ..S:MIG["Mail Tracking Info.: " IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",9)=" "
"RTN","PSORXVW1",50,0)
 ..F SG=1:1:$L(MIG) S:$L(^TMP("PSOAL",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",9)=" " S:$P(MIG," ",SG)'="" ^TMP("PSOAL",$J,IEN,0)=$G(^TMP("PSOAL",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSORXVW1",51,0)
 K MIG,SG,I,^UTILITY($J,"W"),DIWF,DIWL,DIWR
"RTN","PSORXVW1",52,0)
 Q
"RTN","PSORXVW1",53,0)
LBL ;label log
"RTN","PSORXVW1",54,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Label Log:"
"RTN","PSORXVW1",55,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Rx Ref                    Printed By",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",56,0)
 I '$O(^PSRX(DA,"L",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Labels printed." Q
"RTN","PSORXVW1",57,0)
 F L1=0:0 S L1=$O(^PSRX(DA,"L",L1)) Q:'L1  S LBL=^PSRX(DA,"L",L1,0),DTT=$P(^(0),"^") D DAT D
"RTN","PSORXVW1",58,0)
 . S $P(RN," ",26)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=L1_"   "_DAT_"    ",RFT=$S($P(LBL,"^",2):"REFILL "_$P(LBL,"^",2),1:"ORIGINAL"),RFT=RFT_$E(RN,$L(RFT)+1,26)
"RTN","PSORXVW1",59,0)
 . K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(LBL,"^",4) D ^DIC
"RTN","PSORXVW1",60,0)
 . S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$P(Y,"^",2),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(LBL,"^",3)
"RTN","PSORXVW1",61,0)
 . N FDAMGDOC S FDAMGDOC=$P($G(^PSRX(DA,"L",L1,"FDA")),"^")
"RTN","PSORXVW1",62,0)
 . I FDAMGDOC'="" D
"RTN","PSORXVW1",63,0)
 . . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="FDA Med Guide: "_$E(FDAMGDOC,1,61)
"RTN","PSORXVW1",64,0)
 . . I $L(FDAMGDOC)>61 D
"RTN","PSORXVW1",65,0)
 . . . F  Q:$E(FDAMGDOC,62,999)=""  D
"RTN","PSORXVW1",66,0)
 . . . . S FDAMGDOC=$E(FDAMGDOC,62,999),IEN=IEN+1
"RTN","PSORXVW1",67,0)
 . . . . S ^TMP("PSOAL",$J,IEN,0)=$E(FDAMGDOC,1,61)
"RTN","PSORXVW1",68,0)
 K DIC,X,Y Q
"RTN","PSORXVW1",69,0)
 ;
"RTN","PSORXVW1",70,0)
RF ;refill log
"RTN","PSORXVW1",71,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Refill Log:"
"RTN","PSORXVW1",72,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#  Log Date   Refill Date  Qty               Routing  Lot #       Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",73,0)
 S (RF,PL)=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S PL=PL+1
"RTN","PSORXVW1",74,0)
 I 'PL S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Refills For this  Prescription" Q
"RTN","PSORXVW1",75,0)
 F N=0:0 S N=$O(^PSRX(DA,1,N)) Q:'N  S P1=^(N,0) D
"RTN","PSORXVW1",76,0)
 .S DTT=$P(P1,"^",8)\1 D DAT S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"   "
"RTN","PSORXVW1",77,0)
 .S DTT=$P(P1,"^"),$P(RN," ",10)=" " D DAT
"RTN","PSORXVW1",78,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"     "_$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)_"  "_$S($P(P1,"^",2)="M":"Mail",1:"Window")_" "_$P(P1,"^",6)_$E(RN,$L($P(P1,"^",6))+1,12)
"RTN","PSORXVW1",79,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(P1,"^",5) D ^DIC
"RTN","PSORXVW1",80,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_$E($S(+Y:$P(Y,"^",2),1:""),1,16) K DIC,X,Y
"RTN","PSORXVW1",81,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"Unknown"),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_$E("        ",$L(PSDIV)+1,8)_"  "
"RTN","PSORXVW1",82,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"Dispensed: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")_"  "
"RTN","PSORXVW1",83,0)
 .S RTS=$S($P(P1,"^",16):" Returned to Stock: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" Released: "_$S($$RXRLDT^PSOBPSUT(DA,N):$$FMTE^XLFDT($$RXRLDT^PSOBPSUT(DA,N)\1,2),1:""))
"RTN","PSORXVW1",84,0)
 .I $$STATUS^PSOBPSUT(DA,N)'="",$$RXRLDT^PSOBPSUT(DA,N) S RTS=RTS_"  NDC: "_$$GETNDC^PSONDCUT(DA,N)
"RTN","PSORXVW1",85,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RTS
"RTN","PSORXVW1",86,0)
 .S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Remarks: "_$P(P1,"^",3)
"RTN","PSORXVW1",87,0)
 K RTS Q
"RTN","PSORXVW1",88,0)
PAR ;partial log
"RTN","PSORXVW1",89,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Partial Fills:"
"RTN","PSORXVW1",90,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Log Date   Date     Qty              Routing    Lot #        Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",91,0)
 I '$O(^PSRX(DA,"P",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Partials for this Prescription" Q
"RTN","PSORXVW1",92,0)
 S N=0 F  S N=$O(^PSRX(DA,"P",N)) Q:'N  S P1=^(N,0),DTT=$P(P1,"^",8)\1 D DAT D
"RTN","PSORXVW1",93,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"  ",QTY=$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)
"RTN","PSORXVW1",94,0)
 .S DTT=$P(P1,"^") D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"  "_QTY_"  "
"RTN","PSORXVW1",95,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"UNKNOWN"),PSDIV=PSDIV_$E("        ",$L(PSDIV)+1,8)
"RTN","PSORXVW1",96,0)
 .S MW=$S($P(P1,"^",2)="M":"Mail",1:"Window"),MW=MW_$E("          ",$L(MW)+1,10)
"RTN","PSORXVW1",97,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(P1,"^",16) D ^DIC
"RTN","PSORXVW1",98,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_MW_"  "_$P(P1,"^",6)_$E("            ",$L($P(P1,"^",6))+1,10)_$E($S(+Y:$P(Y,"^",2),1:""),1,16)
"RTN","PSORXVW1",99,0)
 .S RTS=$S($P(P1,"^",16):" RETURNED TO STOCK: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" RELEASED: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:""))
"RTN","PSORXVW1",100,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(P1,"^",7) D ^DIC
"RTN","PSORXVW1",101,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_" "_RTS ;_"      Entry By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",102,0)
 .S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  REMARKS: "_$P(P1,"^",3) K RTS
"RTN","PSORXVW1",103,0)
 Q
"RTN","PSORXVW1",104,0)
HLD ;hold info
"RTN","PSORXVW1",105,0)
 S DTT=$P(^PSRX(DA,"H"),"^",3) D DAT S HLDR=$$GET1^DIQ(52,DA,99)
"RTN","PSORXVW1",106,0)
 S $P(RN," ",60)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Reason: "_HLDR_$E(RN,$L("Hold Reason: "_HLDR)+1,60)_"Hold Date: "_DAT
"RTN","PSORXVW1",107,0)
 I $P($G(^PSRX(DA,"H")),"^",2)]"" D
"RTN","PSORXVW1",108,0)
 . N HLDCOMM S HLDCOMM=$P(^PSRX(DA,"H"),"^",2)
"RTN","PSORXVW1",109,0)
 . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Comments: "_$E(HLDCOMM,1,65),HLDCOMM=$E(HLDCOMM,66,999)
"RTN","PSORXVW1",110,0)
 . F  Q:HLDCOMM=""  D
"RTN","PSORXVW1",111,0)
 . . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="               "_$E(HLDCOMM,1,65),HLDCOMM=$E(HLDCOMM,66,999)
"RTN","PSORXVW1",112,0)
 K RN,DAT,DTT,HLDR
"RTN","PSORXVW1",113,0)
 Q
"RTN","PSORXVW1",114,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSORXVW1",115,0)
 Q
"RTN","PSORXVW1",116,0)
INST ;formats instruction from front door
"RTN","PSORXVW1",117,0)
 I $O(^PSRX(DA,"PI",0)) D
"RTN","PSORXVW1",118,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        Instructions:"
"RTN","PSORXVW1",119,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PI",T)) Q:'T  D                  ;PSO*210
"RTN","PSORXVW1",120,0)
 ..S MIG=^PSRX(RXN,"PI",T,0)
"RTN","PSORXVW1",121,0)
 ..D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW1",122,0)
 K T,TY,MIG,SG
"RTN","PSORXVW1",123,0)
 Q
"RTN","PSORXVW1",124,0)
PC ;displays provider comments
"RTN","PSORXVW1",125,0)
 I $O(^PSRX(DA,"PRC",0)) D
"RTN","PSORXVW1",126,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Provider Comments:"
"RTN","PSORXVW1",127,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PRC",T)) Q:'T  D                 ;PSO*210
"RTN","PSORXVW1",128,0)
 ..S MIG=^PSRX(RXN,"PRC",T,0)
"RTN","PSORXVW1",129,0)
 ..D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW1",130,0)
 K T,TY,MIG,SG
"RTN","PSORXVW1",131,0)
 Q
"RTN","PSORXVW1",132,0)
DOSE ;displays dosing instruction for both simple and complex Rxs.
"RTN","PSORXVW1",133,0)
 D DOSE^PSORXVW2
"RTN","PSORXVW1",134,0)
 Q
"RTN","PSORXVW1",135,0)
 ;
"RTN","PSORXVW1",136,0)
HLP ; Help Text for the VIEW PRESCRIPTION prompt
"RTN","PSORXVW1",137,0)
 W !," A prescription number or ECME number may be entered.  To look-up a"
"RTN","PSORXVW1",138,0)
 W !," prescription by the ECME number, please enter ""E."" followed by the ECME"
"RTN","PSORXVW1",139,0)
 W !," number with or without any leading zeros."
"RTN","PSORXVW1",140,0)
 W !!,"  Or just",!
"RTN","PSORXVW1",141,0)
 D LKP("?")
"RTN","PSORXVW1",142,0)
 Q 
"RTN","PSORXVW1",143,0)
 ;
"RTN","PSORXVW1",144,0)
LKP(INPUT) ; - Peforms Lookup on the PRESCRIPTION file
"RTN","PSORXVW1",145,0)
 N DIC,X,Y
"RTN","PSORXVW1",146,0)
 S DIC="^PSRX(",DIC(0)="QE",D="B",X=INPUT
"RTN","PSORXVW1",147,0)
 S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")'=13"
"RTN","PSORXVW1",148,0)
 D IX^DIC
"RTN","PSORXVW1",149,0)
 Q Y
"UP",52,52.3,-1)
52^A
"UP",52,52.3,0)
52.3
"VER")
8.0^22.0
"^DD",52,52,99,0)
HOLD REASON^RS^1:INSUFFICIENT QTY IN STOCK;2:DRUG-DRUG INTERACTION;4:PROVIDER TO BE CONTACTED;6:ADVERSE DRUG REACTION;7:BAD ADDRESS;8:PER PATIENT REQUEST;9:CONSULT/PRIOR APPROVAL NEEDED;98:OTHER/TECH (NON-CLINICAL);99:OTHER/RPH (CLINICAL);^H;1^Q
"^DD",52,52,99,1,0)
^.1^^-1
"^DD",52,52,99,1,1,0)
52^AH
"^DD",52,52,99,1,1,1)
S ^PSRX("AH",$E(X,1,30),DA)=""
"^DD",52,52,99,1,1,2)
K ^PSRX("AH",$E(X,1,30),DA)
"^DD",52,52,99,3)
Enter reason medication is placed in a 'Hold' status.
"^DD",52,52,99,21,0)
^.001^1^1^3120502^^^^
"^DD",52,52,99,21,1,0)
This field tells why the prescription was put on hold.
"^DD",52,52,99,23,0)
^.001^1^1^3120502^^^^
"^DD",52,52,99,23,1,0)
Enter reason medication is being placed in a 'Hold' status.
"^DD",52,52,99,"DT")
3120531
"^DD",52,52.3,.05,0)
COMMENT^RF^^0;5^K:$L(X)>100!($L(X)<1) X
"^DD",52,52.3,.05,3)
Answer must be 1-100 characters in length.
"^DD",52,52.3,.05,21,0)
^^1^1^2920115^
"^DD",52,52.3,.05,21,1,0)
Any additional comments.
"^DD",52,52.3,.05,23,0)
^^1^1^2920115^
"^DD",52,52.3,.05,23,1,0)
(Required) Free Text.
"^DD",52,52.3,.05,"DT")
3120618
"BLD",8411,6)
^342
**END**
**END**
