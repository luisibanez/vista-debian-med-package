Released PSO*7*401 SEQ #340
Extracted from mail message
**KIDS**:PSO*7.0*401^

**INSTALL NAME**
PSO*7.0*401
"BLD",8910,0)
PSO*7.0*401^OUTPATIENT PHARMACY^0^3120409^y
"BLD",8910,1,0)
^^2^2^3120409^
"BLD",8910,1,1,0)
Error occurs when the Drug Class is not defined in the VA DRUG CLASS 
"BLD",8910,1,2,0)
file (#50.605).
"BLD",8910,4,0)
^9.64PA^^
"BLD",8910,6.3)
10
"BLD",8910,"KRN",0)
^9.67PA^779.2^20
"BLD",8910,"KRN",.4,0)
.4
"BLD",8910,"KRN",.401,0)
.401
"BLD",8910,"KRN",.402,0)
.402
"BLD",8910,"KRN",.403,0)
.403
"BLD",8910,"KRN",.5,0)
.5
"BLD",8910,"KRN",.84,0)
.84
"BLD",8910,"KRN",3.6,0)
3.6
"BLD",8910,"KRN",3.8,0)
3.8
"BLD",8910,"KRN",9.2,0)
9.2
"BLD",8910,"KRN",9.8,0)
9.8
"BLD",8910,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8910,"KRN",9.8,"NM",1,0)
PSODGAL1^^0^B23109209
"BLD",8910,"KRN",9.8,"NM","B","PSODGAL1",1)

"BLD",8910,"KRN",19,0)
19
"BLD",8910,"KRN",19.1,0)
19.1
"BLD",8910,"KRN",101,0)
101
"BLD",8910,"KRN",409.61,0)
409.61
"BLD",8910,"KRN",771,0)
771
"BLD",8910,"KRN",779.2,0)
779.2
"BLD",8910,"KRN",870,0)
870
"BLD",8910,"KRN",8989.51,0)
8989.51
"BLD",8910,"KRN",8989.52,0)
8989.52
"BLD",8910,"KRN",8994,0)
8994
"BLD",8910,"KRN","B",.4,.4)

"BLD",8910,"KRN","B",.401,.401)

"BLD",8910,"KRN","B",.402,.402)

"BLD",8910,"KRN","B",.403,.403)

"BLD",8910,"KRN","B",.5,.5)

"BLD",8910,"KRN","B",.84,.84)

"BLD",8910,"KRN","B",3.6,3.6)

"BLD",8910,"KRN","B",3.8,3.8)

"BLD",8910,"KRN","B",9.2,9.2)

"BLD",8910,"KRN","B",9.8,9.8)

"BLD",8910,"KRN","B",19,19)

"BLD",8910,"KRN","B",19.1,19.1)

"BLD",8910,"KRN","B",101,101)

"BLD",8910,"KRN","B",409.61,409.61)

"BLD",8910,"KRN","B",771,771)

"BLD",8910,"KRN","B",779.2,779.2)

"BLD",8910,"KRN","B",870,870)

"BLD",8910,"KRN","B",8989.51,8989.51)

"BLD",8910,"KRN","B",8989.52,8989.52)

"BLD",8910,"KRN","B",8994,8994)

"BLD",8910,"QDEF")
^^^^NO^^^^^^NO
"BLD",8910,"QUES",0)
^9.62^^
"BLD",8910,"REQB",0)
^9.611^1^1
"BLD",8910,"REQB",1,0)
PSO*7.0*251^2
"BLD",8910,"REQB","B","PSO*7.0*251",1)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,20,0)
^9.402P^^
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
401^3120409
"PKG",206,22,1,"PAH",1,1,0)
^^2^2^3120409
"PKG",206,22,1,"PAH",1,1,1,0)
Error occurs when the Drug Class is not defined in the VA DRUG CLASS 
"PKG",206,22,1,"PAH",1,1,2,0)
file (#50.605).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSODGAL1")
0^1^B23109209^B18486423
"RTN","PSODGAL1",1,0)
PSODGAL1 ;BIR/LC,SAB-enhanced DRUG ALLERGY REACTION CHECKING ;12/09/07  02:22
"RTN","PSODGAL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**251,401**;DEC 1997;Build 10
"RTN","PSODGAL1",3,0)
 ;External reference to ^GMRADPT supported by DBIA 10099
"RTN","PSODGAL1",4,0)
 ;External reference to ORCHK^GMRAOR supported by DBIA 2378
"RTN","PSODGAL1",5,0)
 ;External reference to $P(^GMR(120.8,LP,3),"^",3) supp. by DBIA 2214
"RTN","PSODGAL1",6,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSODGAL1",7,0)
 ;External reference to EN1^GMRAOR2 supported by DBIA 2422
"RTN","PSODGAL1",8,0)
 ;External reference to GETDATA^GMRAOR supported by DBIA 4847
"RTN","PSODGAL1",9,0)
 ;External reference to ^TMP("GMRAOC" supported by DBIA 4848
"RTN","PSODGAL1",10,0)
 ;External reference to ^XUSEC("PSORPH" supported by DBIA 10076
"RTN","PSODGAL1",11,0)
 ;
"RTN","PSODGAL1",12,0)
 N PSOACK,DFN K ^TMP($J,"PSODRCLS"),DSPLQ,PSOMDC S DFN=PSODFN
"RTN","PSODGAL1",13,0)
 I $D(PSODRUG("NDF")) S NDF=$P(PSODRUG("NDF"),"A"),TYP=$P(PSODRUG("NDF"),"A",2),PTR=NDF_"."_TYP
"RTN","PSODGAL1",14,0)
 I $G(NDF) D CHK K NDF,PTR,TYP
"RTN","PSODGAL1",15,0)
 I '$G(NDF) D CHK1
"RTN","PSODGAL1",16,0)
 I $D(PSODRUG("VA CLASS")) D CLASS
"RTN","PSODGAL1",17,0)
 ;I $G(PSOACK)=1!$G(^TMP($J,"PSODRCLS",0))]"" D
"RTN","PSODGAL1",18,0)
 I $G(PSOACK)=1!$O(^TMP($J,"PSODRCLS",0)) D
"RTN","PSODGAL1",19,0)
 .I '$D(^XUSEC("PSORPH",DUZ)),'$D(PSOMDC) K DIR S DIR(0)="E",DIR("?")="Press Return to continue",DIR("A")="Press Return to continue" D ^DIR K DIR,DUOUT,DIRUT Q
"RTN","PSODGAL1",20,0)
 .S DIR("?",1)="Answer 'YES' if you DO want to enter a intervention for this medication,"
"RTN","PSODGAL1",21,0)
 .S DIR("?")="       'NO' if you DON'T want to enter a intervention for this medication,"
"RTN","PSODGAL1",22,0)
 .S DIR(0)="Y",DIR("A")="Do you want to Intervene? ",DIR("B")="Y" W ! D ^DIR
"RTN","PSODGAL1",23,0)
 .Q:'Y  D ^PSORXI
"RTN","PSODGAL1",24,0)
 K DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,DSPLQ
"RTN","PSODGAL1",25,0)
 K PSOACK,GMRAING,I,APTR,GMRA,GMRAL,LP,PSOMDC
"RTN","PSODGAL1",26,0)
 K ^TMP($J,"PSODRCLS")
"RTN","PSODGAL1",27,0)
 Q
"RTN","PSODGAL1",28,0)
 ;
"RTN","PSODGAL1",29,0)
CHK ;matched to ndf
"RTN","PSODGAL1",30,0)
 K ^TMP("PSODAI",$J) S PSOACK=$$ORCHK^GMRAOR(DFN,"DR",PTR) D:$G(PSOACK)=1 
"RTN","PSODGAL1",31,0)
 .S ^TMP("PSODAI",$J,0)=1
"RTN","PSODGAL1",32,0)
 .S I=0 F  S I=$O(GMRAING(I)) Q:'I  S ^TMP("PSODAI",$J,I,0)=GMRAING(I)
"RTN","PSODGAL1",33,0)
 D:$G(PSOACK) DSPLY
"RTN","PSODGAL1",34,0)
 Q
"RTN","PSODGAL1",35,0)
CHK1 ;not matched to ndf
"RTN","PSODGAL1",36,0)
 K ^TMP("PSODAI",$J)
"RTN","PSODGAL1",37,0)
 S GMRA="0^0^001" D EN1^GMRADPT F LP=0:0 S LP=$O(GMRAL(LP)) Q:'LP!($G(PSOACK))  D:$D(^GMR(120.8,LP,0))
"RTN","PSODGAL1",38,0)
 .S:'$G(PSOACK) APTR=$P(^GMR(120.8,LP,0),"^",3)
"RTN","PSODGAL1",39,0)
 .I $P(APTR,";",2)="PSDRUG(",$P(APTR,";")=PSODRUG("IEN") S PSOACK=1
"RTN","PSODGAL1",40,0)
 .Q:$D(^XUSEC("PSORPH",DUZ))  S:$G(PSOACK)=1 ^TMP("PSODAI",$J,0)=1
"RTN","PSODGAL1",41,0)
 D:$G(PSOACK) DSPLY
"RTN","PSODGAL1",42,0)
 Q
"RTN","PSODGAL1",43,0)
DSPLY ;
"RTN","PSODGAL1",44,0)
 I '$G(DSPLQ) D
"RTN","PSODGAL1",45,0)
 .W $C(7),!,"A Drug-Allergy Reaction exists for this medication and/or class!",!
"RTN","PSODGAL1",46,0)
 .W !,"Drug: "_PSODRUG("NAME")
"RTN","PSODGAL1",47,0)
 .I $O(GMRAING(0)) D
"RTN","PSODGAL1",48,0)
 ..W !,?6,"Ingredients: ",?19 S I=0
"RTN","PSODGAL1",49,0)
 ..F  S I=$O(GMRAING(I)) Q:'I  W:$X+$L($G(GMRAING(I)))+2>IOM !?19 W $G(GMRAING(I))_", "
"RTN","PSODGAL1",50,0)
 S DSPLQ=1
"RTN","PSODGAL1",51,0)
 Q
"RTN","PSODGAL1",52,0)
 ;
"RTN","PSODGAL1",53,0)
CLASS ;
"RTN","PSODGAL1",54,0)
 N CPT,CLCHK,CT,AGNL,CC,GMRA,LEN S LEN=4
"RTN","PSODGAL1",55,0)
 I $E(PSODRUG("VA CLASS"),1,4)="CN10" S LEN=5 ;look at 5 chars if ANALGESICS
"RTN","PSODGAL1",56,0)
 K ^TMP($J,"PSODRCLS")
"RTN","PSODGAL1",57,0)
 I $T(GETDATA^GMRAOR)]"" G CLASS2 ; CHECK FOR EXISTENCE OF NEW ENTRY POINT BEFORE USING
"RTN","PSODGAL1",58,0)
 S CLCHK=""
"RTN","PSODGAL1",59,0)
 S GMRA="0^0^111" D EN1^GMRADPT F CC=0:0 S CC=$O(GMRAL(CC)) Q:'CC  D
"RTN","PSODGAL1",60,0)
 .K AGNL D EN1^GMRAOR2(CC,"AGNL")
"RTN","PSODGAL1",61,0)
 .I $D(AGNL("V")) F CT=0:1 S CPT=$O(AGNL("V",CT)) Q:'CPT  I $E($P($G(AGNL("V",CPT)),"^"),1,LEN)=$E(PSODRUG("VA CLASS"),1,LEN) D
"RTN","PSODGAL1",62,0)
 ..S CLCHK=$G(CLCHK)+1,^TMP($J,"PSODRCLS",CLCHK)=$P($G(AGNL("V",CPT)),"^")_" "_$P($G(AGNL("V",CPT)),"^",2)
"RTN","PSODGAL1",63,0)
 G CLASSDSP
"RTN","PSODGAL1",64,0)
CLASS2 ;
"RTN","PSODGAL1",65,0)
 N RET
"RTN","PSODGAL1",66,0)
 S RET=$$DRCL(DFN)
"RTN","PSODGAL1",67,0)
 I '$G(RET) Q
"RTN","PSODGAL1",68,0)
 S CLCHK="",CT="" F  S CT=$O(GMRADRCL(CT)) Q:CT=""  D
"RTN","PSODGAL1",69,0)
 .I $E(PSODRUG("VA CLASS"),1,LEN)=$E(CT,1,LEN) S CLCHK=$G(CLCHK)+1,^TMP($J,"PSODRCLS",CLCHK)=CT_" "_$P(GMRADRCL(CT),"^",2)
"RTN","PSODGAL1",70,0)
CLASSDSP ;
"RTN","PSODGAL1",71,0)
 I '$D(^TMP($J,"PSODRCLS")) Q
"RTN","PSODGAL1",72,0)
 W:'$G(PSOACK) $C(7),!,"A Drug-Allergy Reaction exists for this medication and/or class!",!,!,"Drug: "_PSODRUG("NAME")
"RTN","PSODGAL1",73,0)
 I $O(^TMP($J,"PSODRCLS",0)) W !?6,"Drug Class: "
"RTN","PSODGAL1",74,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=58,DIWF=""
"RTN","PSODGAL1",75,0)
 S CT="" F  S CT=$O(^TMP($J,"PSODRCLS",CT)) Q:CT=""  S X=^TMP($J,"PSODRCLS",CT)_", " D ^DIWP
"RTN","PSODGAL1",76,0)
 F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?18,^UTILITY($J,"W",1,ZX,0),!
"RTN","PSODGAL1",77,0)
 K ^UTILITY($J,"W"),DIWL,DIWR,DIWF,CT,ZX
"RTN","PSODGAL1",78,0)
 Q
"RTN","PSODGAL1",79,0)
 ;
"RTN","PSODGAL1",80,0)
DRCL(DFN) ;
"RTN","PSODGAL1",81,0)
 N RET S RET=0 K GMRADRCL D GETDATA^GMRAOR(DFN)
"RTN","PSODGAL1",82,0)
 Q:'$D(^TMP("GMRAOC",$J,"APC")) 0
"RTN","PSODGAL1",83,0)
 N GMRACL S GMRACL="" F  S GMRACL=$O(^TMP("GMRAOC",$J,"APC",GMRACL)) Q:'$L(GMRACL)  D
"RTN","PSODGAL1",84,0)
 .N GMRANM,GMRALOC S GMRALOC=^TMP("GMRAOC",$J,"APC",GMRACL) I '$O(^PS(50.605,"B",GMRACL,0)) S PSOMDC(GMRACL)="" Q
"RTN","PSODGAL1",85,0)
 .S GMRANM=$P(^PS(50.605,+$O(^PS(50.605,"B",GMRACL,0)),0),U,2)
"RTN","PSODGAL1",86,0)
 .S GMRADRCL(GMRACL)=GMRACL_U_GMRANM_" ("_GMRALOC_")",RET=RET+1
"RTN","PSODGAL1",87,0)
 I $D(PSOMDC) D
"RTN","PSODGAL1",88,0)
 .W !!,"Warning: The following drug class does not exist in the VA DRUG CLASS"
"RTN","PSODGAL1",89,0)
 .W !,"file (#50.605). Please do a manual Drug-Allergy order check and notify"
"RTN","PSODGAL1",90,0)
 .W !,"the pharmacy ADPAC for follow up.",!
"RTN","PSODGAL1",91,0)
 .S PSOMDC="" F  S PSOMDC=$O(PSOMDC(PSOMDC)) Q:PSOMDC=""  W !,"VA Drug Class: "_PSOMDC
"RTN","PSODGAL1",92,0)
 .W ! S DIR("A")="Press Return to continue",DIR(0)="E",DIR("?")="Press Return to continue" D ^DIR K DIR W !
"RTN","PSODGAL1",93,0)
 K ^TMP("GMRAOC",$J)
"RTN","PSODGAL1",94,0)
 Q RET
"VER")
8.0^22.0
"BLD",8910,6)
^340
**END**
**END**
