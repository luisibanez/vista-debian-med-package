Released PSO*7*367 SEQ #332
Extracted from mail message
**KIDS**:PSO*7.0*367^

**INSTALL NAME**
PSO*7.0*367
"BLD",7497,0)
PSO*7.0*367^OUTPATIENT PHARMACY^0^3120208^y
"BLD",7497,1,0)
^^196^196^3120208^^^^
"BLD",7497,1,1,0)
his patch contains software modifications to the Outpatient Pharmacy (OP)
"BLD",7497,1,2,0)
V. 7.0 application to support the Food and Drug Administration (FDA) 
"BLD",7497,1,3,0)
Medication Guides - Increment 3 project. The project objective is to allow
"BLD",7497,1,4,0)
pharmacy staff to retrieve the FDA Medication Guide for prescription items
"BLD",7497,1,5,0)
that contain FDA approved information that can help patients avoid adverse
"BLD",7497,1,6,0)
events. The FDA requires that Medication Guides be included with certain
"BLD",7497,1,7,0)
prescribed drugs and biological products when the Agency determines that:
"BLD",7497,1,8,0)
 
"BLD",7497,1,9,0)
 . Certain information is necessary to prevent serious adverse effects 
"BLD",7497,1,10,0)
 . Patient decision-making should be advised by information about a known
"BLD",7497,1,11,0)
   serious side effect with a product, or 
"BLD",7497,1,12,0)
 . Patient adherence to directions for the use of a product is essential
"BLD",7497,1,13,0)
   to its effectiveness. 
"BLD",7497,1,14,0)
 
"BLD",7497,1,15,0)
The features in the FDA Medication Guides project are being delivered in
"BLD",7497,1,16,0)
incremental releases. This patch is part of the Increment 3 release, which
"BLD",7497,1,17,0)
is the last planned release. The features included in this release are:
"BLD",7497,1,18,0)
 
"BLD",7497,1,19,0)
 . Ability to create and maintain a list of FDA Medication Guide printers
"BLD",7497,1,20,0)
   for a specific pharmacy division.
"BLD",7497,1,21,0)
 
"BLD",7497,1,22,0)
 . Automatic printing of FDA Medication Guide along with prescription 
"BLD",7497,1,23,0)
   labels.
"BLD",7497,1,24,0)
 
"BLD",7497,1,25,0)
 . Ability to reprint the FDA Medication Guide when reprinting a 
"BLD",7497,1,26,0)
   prescription label.
"BLD",7497,1,27,0)
 
"BLD",7497,1,28,0)
 . Ability to change the FDA Medication Guide printer at any point of the
"BLD",7497,1,29,0)
   dispensing process, similar to changing the label printer.
"BLD",7497,1,30,0)
 
"BLD",7497,1,31,0)
 . Ability to reprint the FDA Medication Guide for any given prescription
"BLD",7497,1,32,0)
   fill or the latest FDA Mediation Guide available for the medication on
"BLD",7497,1,33,0)
   the prescription.
"BLD",7497,1,34,0)
  
"BLD",7497,1,35,0)
 . Identification on the label document that an FDA Medication Guide was
"BLD",7497,1,36,0)
   printed as well and needs to be collated to the documentation before
"BLD",7497,1,37,0)
   being handed over to the patient.
"BLD",7497,1,38,0)
 
"BLD",7497,1,39,0)
 . Changes to the prescription label activity logs showing which specific
"BLD",7497,1,40,0)
   FDA Medication Guide document printed along with the label.
"BLD",7497,1,41,0)
 
"BLD",7497,1,42,0)
 . Changes to the Consolidated Mail Outpatient Pharmacy (CMOP) Event log
"BLD",7497,1,43,0)
   showing which specific FDA Medication Guide document was available 
"BLD",7497,1,44,0)
   for the medication when the prescription fill was transmitted to CMOP.
"BLD",7497,1,45,0)
 
"BLD",7497,1,46,0)
 . Introduction of a PC based Java software component to enable the
"BLD",7497,1,47,0)
   automatic printing of an FDA Medication Guide from within VistA. The
"BLD",7497,1,48,0)
   software does not require any direct user interaction. The software 
"BLD",7497,1,49,0)
   identifies a request from VistA for a specific FDA Medication Guide
"BLD",7497,1,50,0)
   and automatically sends it to the FDA Medication Guide printer
"BLD",7497,1,51,0)
   selected by the user within VistA when dispensing the medication.
"BLD",7497,1,52,0)
 
"BLD",7497,1,53,0)
 . Ability to update the Windows network printer name for a specific
"BLD",7497,1,54,0)
   device through the Kernel application. Once the pharmacist selects a
"BLD",7497,1,55,0)
   printer to print the FDA Medication Guide Vista will retrieve the 
"BLD",7497,1,56,0)
   Windows name for the printer and will pass it on to the Java
"BLD",7497,1,57,0)
   application responsible for printing the document.
"BLD",7497,1,58,0)
    
"BLD",7497,1,59,0)
Below is a list of all the applications involved in this release along
"BLD",7497,1,60,0)
with their patch number:
"BLD",7497,1,61,0)
  
"BLD",7497,1,62,0)
   APPLICATION/VERSION                                    PATCH
"BLD",7497,1,63,0)
   -----------------------------------------------------------------
"BLD",7497,1,64,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0    PSX*2*70
"BLD",7497,1,65,0)
   NATIONAL DRUG FILE (NDF) V. 4.0                        PSN*4*264
"BLD",7497,1,66,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                        PSO*7*367
"BLD",7497,1,67,0)
   KERNEL V. 8.0                                          XU*8*566
"BLD",7497,1,68,0)
   
"BLD",7497,1,69,0)
The following modifications are included in this patch (PSO*7*367):
"BLD",7497,1,70,0)
 
"BLD",7497,1,71,0)
1. Site Parameter Enter/Edit [PSO SITE PARAMETERS] option
"BLD",7497,1,72,0)
   ------------------------------------------------------
"BLD",7497,1,73,0)
   Two new parameters are being introduced in this option: 
"BLD",7497,1,74,0)
   a) FDA MED GUIDE PRINT SERVER URL: this field is used to store the
"BLD",7497,1,75,0)
      Uniform Resource Locator (URL) for the Print Server where the Java
"BLD",7497,1,76,0)
      application responsible for automatically printing of the FDA
"BLD",7497,1,77,0)
      Medication Guides for the division was installed 
"BLD",7497,1,78,0)
      (e.g.,'http://10.4.21.22/'). This field is required for the FDA
"BLD",7497,1,79,0)
      Medication Guide functionality to work properly.
"BLD",7497,1,80,0)
   b) FDA MED GUIDE PRINTER: This is a multiple field used to store a
"BLD",7497,1,81,0)
      list of printers used for printing FDA Medication Guide document 
"BLD",7497,1,82,0)
      for the division. There are two fields in the multiple: 1) FDA
"BLD",7497,1,83,0)
      MED GUIDE PRINTER, which is a pointer to the DEVICE file (#3.5).
"BLD",7497,1,84,0)
      Only devices with a content in the WINDOWS NETWORK PRINTER NAME
"BLD",7497,1,85,0)
      field (#75) are selectable, and 2) DEFAULT PRINTER, which 
"BLD",7497,1,86,0)
      indicates whether the printer selected is to be used as the 
"BLD",7497,1,87,0)
      default printer for the division. Only one printer can be set as
"BLD",7497,1,88,0)
      default printer for each division. This field is not required.
"BLD",7497,1,89,0)
      The printers in this multiple will be displayed for selection
"BLD",7497,1,90,0)
      when the user logs into a division. If there is a printer set as
"BLD",7497,1,91,0)
      the default printer, it will be set as the default printer.
"BLD",7497,1,92,0)
   
"BLD",7497,1,93,0)
  
"BLD",7497,1,94,0)
2. Outpatient Pharmacy Manager [PSO MANAGER] option
"BLD",7497,1,95,0)
   ------------------------------------------------
"BLD",7497,1,96,0)
   When logging into a division, after selecting the Profile and Label
"BLD",7497,1,97,0)
   printers, the user will be prompt to select an FDA Medication Guide
"BLD",7497,1,98,0)
   printer for the current session. If the division selected has a list
"BLD",7497,1,99,0)
   of FDA Medication Guide printers they will be displayed (see below),
"BLD",7497,1,100,0)
   however the user will be able to select other printers as well. The
"BLD",7497,1,101,0)
   HOME and NULL DEVICE are selectable at this point.
"BLD",7497,1,102,0)
 
"BLD",7497,1,103,0)
   Select OPTION NAME: PSO MANAGER       Outpatient Pharmacy Manager
"BLD",7497,1,104,0)
   Outpatient Pharmacy software - Version 
"BLD",7497,1,105,0)
 
"BLD",7497,1,106,0)
   Division:    DIVISION 999 
"BLD",7497,1,107,0)
 
"BLD",7497,1,108,0)
          You are logged on under the DIVISION division.
"BLD",7497,1,109,0)
 
"BLD",7497,1,110,0)
   Select PROFILE PRINTER: HOME//   GENERIC INCOMING TELNET
"BLD",7497,1,111,0)
 
"BLD",7497,1,112,0)
   Select LABEL PRINTER: HOME//   GENERIC INCOMING TELNET
"BLD",7497,1,113,0)
 
"BLD",7497,1,114,0)
   OK to assume label alignment is correct? YES// 
"BLD",7497,1,115,0)
 
"BLD",7497,1,116,0)
   DIVISIONS's FDA Medication Guide Printer(s) on file:
"BLD",7497,1,117,0)
 
"BLD",7497,1,118,0)
     FDA MED GUIDE PRINTER (Default)
"BLD",7497,1,119,0)
 
"BLD",7497,1,120,0)
   Select FDA MED GUIDE PRINTER: FDA MED GUIDE PRINTER//
"BLD",7497,1,121,0)
  
"BLD",7497,1,122,0)
3. Complete Orders from [OERR PSO LMOE FINISH] option
"BLD",7497,1,123,0)
   Patient Prescription Processing [PSO LM BACKDOOR ORDERS] option
"BLD",7497,1,124,0)
   ---------------------------------------------------------------
"BLD",7497,1,125,0)
   There are a few enhancements being added to the prescription processing
"BLD",7497,1,126,0)
   options regarding the printing of FDA Medication Guides. Among them:
"BLD",7497,1,127,0)
  
"BLD",7497,1,128,0)
   a) The FDA Medication Guide document will print automatically for
"BLD",7497,1,129,0)
      prescriptions, if there is one available.
"BLD",7497,1,130,0)
 
"BLD",7497,1,131,0)
   b) Users will have the ability to change the FDA Medication Guide 
"BLD",7497,1,132,0)
      printer in the same way they change the label and profile printers
"BLD",7497,1,133,0)
      today.
"BLD",7497,1,134,0)
 
"BLD",7497,1,135,0)
   c) When queuing labels to print, if there is at least one prescription
"BLD",7497,1,136,0)
      with an FDA Medication Guide associated, it will require a valid FDA
"BLD",7497,1,137,0)
      Medication Guide printer to be entered. This is similar to requiring
"BLD",7497,1,138,0)
      a valid printer for the label printer.
"BLD",7497,1,139,0)
 
"BLD",7497,1,140,0)
   d) The actual label document will contain a note under the barcode,
"BLD",7497,1,141,0)
      before the PMI document, that says "Read FDA MED Guide". Such note
"BLD",7497,1,142,0)
      should indicate to the pharmacist that an FDA Medication Guide
"BLD",7497,1,143,0)
      document has been printed for the prescription and should be handed
"BLD",7497,1,144,0)
      to the patient.
"BLD",7497,1,145,0)
 
"BLD",7497,1,146,0)
   e) The Label Log and CMOP Event Log will both list the FDA Medication
"BLD",7497,1,147,0)
      Guide document name (.pdf) associated with each fill.
"BLD",7497,1,148,0)
   
"BLD",7497,1,149,0)
   f) Users will have the ability to reprint the FDA Medication Guide for
"BLD",7497,1,150,0)
      past prescription fills or the latest FDA Medication Guide available
"BLD",7497,1,151,0)
      for the prescription via a new action RM - Reprint FDA Medication
"BLD",7497,1,152,0)
      Guide under the OTH - Other OP Actions menu.
"BLD",7497,1,153,0)
       
"BLD",7497,1,154,0)
4. Print from Suspense File [PSO PNDLBL] option
"BLD",7497,1,155,0)
   --------------------------------------------
"BLD",7497,1,156,0)
   In order to run this option users will be required to enter a valid FDA
"BLD",7497,1,157,0)
   Medication Guide printer. All prescriptions that prints a label via
"BLD",7497,1,158,0)
   this option and that have an FDA Medication Guide associated will have
"BLD",7497,1,159,0)
   the documente printed as well in the designated printer.
"BLD",7497,1,160,0)
 
"BLD",7497,1,161,0)
5. Pull Early from Suspense [PSO PNDRX] option
"BLD",7497,1,162,0)
   -------------------------------------------
"BLD",7497,1,163,0)
   If the prescription being pulled from suspense has an FDA Medication
"BLD",7497,1,164,0)
   Guide associated the user will be required to enter a valid FDA
"BLD",7497,1,165,0)
   Medication Guide printer to where the document will be printed for
"BLD",7497,1,166,0)
   the prescription.
"BLD",7497,1,167,0)
 
"BLD",7497,1,168,0)
6. Change Label Printer [PSO CHANGE PRINTER] option
"BLD",7497,1,169,0)
   ------------------------------------------------
"BLD",7497,1,170,0)
   This option is used by users to change the profile and label printers
"BLD",7497,1,171,0)
   after having logged on to a pharmacy division. It is being modified to
"BLD",7497,1,172,0)
   allow users to change the FDA Medication Guide printer as well.
"BLD",7497,1,173,0)
   
"BLD",7497,1,174,0)
7. Reprint an Outpatient Rx Label [PSO RXRPT] option
"BLD",7497,1,175,0)
   -------------------------------------------------
"BLD",7497,1,176,0)
   If the prescription selected to reprinted the label has an FDA 
"BLD",7497,1,177,0)
   Medication Guide associated, this option will ask whether the user also
"BLD",7497,1,178,0)
   wants to reprint the FDA Medication Guide. If they answer YES, a valid
"BLD",7497,1,179,0)
   FDA Medication Guide printer will be required for the user to proceed
"BLD",7497,1,180,0)
   with the reprinting of the label and FDA Medication Guide.
"BLD",7497,1,181,0)
 
"BLD",7497,1,182,0)
8. Label/Profile Monitor Reprint [PSO B] option
"BLD",7497,1,183,0)
   Reprint External Batches [PSO INTERFACE REPRINT] option
"BLD",7497,1,184,0)
   Reprint Batches from Suspense [PSO PNDRPT] option
"BLD",7497,1,185,0)
   -------------------------------------------------------
"BLD",7497,1,186,0)
   These options are used for reprinting batches of labels that may have 
"BLD",7497,1,187,0)
   jammed on the printer. When reprinting labels via one of these options
"BLD",7497,1,188,0)
   users will be prompted if they also want to reprint the FDA Medication
"BLD",7497,1,189,0)
   Guide. If they answer YES, a valid FDA Medication Guide printer will be
"BLD",7497,1,190,0)
   required for the user to proceed with the reprinting of the label and
"BLD",7497,1,191,0)
   FDA Medication Guide, if one is available.
"BLD",7497,1,192,0)
 
"BLD",7497,1,193,0)
9. The background process that calculates suspense days now rounds any
"BLD",7497,1,194,0)
   partial day to the next full day. This modification was moved from 
"BLD",7497,1,195,0)
   patch PSO*7*385 into this patch due to routine overlap and to avoid
"BLD",7497,1,196,0)
   patch dependency.
"BLD",7497,4,0)
^9.64PA^52^2
"BLD",7497,4,52,0)
52
"BLD",7497,4,52,2,0)
^9.641^52.032^2
"BLD",7497,4,52,2,52.01,0)
CMOP EVENT  (sub-file)
"BLD",7497,4,52,2,52.01,1,0)
^9.6411^35^1
"BLD",7497,4,52,2,52.01,1,35,0)
FDA MED GUIDE FILENAME
"BLD",7497,4,52,2,52.032,0)
LABEL DATE/TIME  (sub-file)
"BLD",7497,4,52,2,52.032,1,0)
^9.6411^35^1
"BLD",7497,4,52,2,52.032,1,35,0)
FDA MED GUIDE FILENAME
"BLD",7497,4,52,222)
y^y^p^^^^n^^n
"BLD",7497,4,52,224)

"BLD",7497,4,59,0)
59
"BLD",7497,4,59,2,0)
^9.641^59^2
"BLD",7497,4,59,2,59,0)
OUTPATIENT SITE  (File-top level)
"BLD",7497,4,59,2,59,1,0)
^9.6411^134^1
"BLD",7497,4,59,2,59,1,134,0)
FDA MED GUIDE PRINT SERVER URL
"BLD",7497,4,59,2,59.0135,0)
FDA MED GUIDE PRINTER  (sub-file)
"BLD",7497,4,59,2,59.0135,1,0)
^9.6411^^0
"BLD",7497,4,59,222)
y^y^p^^^^n^^n
"BLD",7497,4,59,224)

"BLD",7497,4,"APDD",52,52.01)

"BLD",7497,4,"APDD",52,52.01,35)

"BLD",7497,4,"APDD",52,52.032)

"BLD",7497,4,"APDD",52,52.032,35)

"BLD",7497,4,"APDD",59,59)

"BLD",7497,4,"APDD",59,59,134)

"BLD",7497,4,"APDD",59,59.0135)

"BLD",7497,4,"B",52,52)

"BLD",7497,4,"B",59,59)

"BLD",7497,6.3)
62
"BLD",7497,"KRN",0)
^9.67PA^779.2^20
"BLD",7497,"KRN",.4,0)
.4
"BLD",7497,"KRN",.401,0)
.401
"BLD",7497,"KRN",.402,0)
.402
"BLD",7497,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",7497,"KRN",.402,"NM",1,0)
PSO SITE    FILE #59^59^0
"BLD",7497,"KRN",.402,"NM","B","PSO SITE    FILE #59",1)

"BLD",7497,"KRN",.403,0)
.403
"BLD",7497,"KRN",.5,0)
.5
"BLD",7497,"KRN",.84,0)
.84
"BLD",7497,"KRN",3.6,0)
3.6
"BLD",7497,"KRN",3.8,0)
3.8
"BLD",7497,"KRN",9.2,0)
9.2
"BLD",7497,"KRN",9.8,0)
9.8
"BLD",7497,"KRN",9.8,"NM",0)
^9.68A^29^24
"BLD",7497,"KRN",9.8,"NM",2,0)
PSORXL^^0^B123167297
"BLD",7497,"KRN",9.8,"NM",3,0)
PSORXVW1^^0^B71843058
"BLD",7497,"KRN",9.8,"NM",5,0)
PSOLSET^^0^B30523749
"BLD",7497,"KRN",9.8,"NM",6,0)
PSOLLL8^^0^B29282471
"BLD",7497,"KRN",9.8,"NM",7,0)
PSOLLL4^^0^B13004061
"BLD",7497,"KRN",9.8,"NM",8,0)
PSOFDAMG^^0^B14147162
"BLD",7497,"KRN",9.8,"NM",10,0)
PSORXVW2^^0^B44714099
"BLD",7497,"KRN",9.8,"NM",11,0)
PSOFDAUT^^0^B23106089
"BLD",7497,"KRN",9.8,"NM",12,0)
PSOORAL1^^0^B61027800
"BLD",7497,"KRN",9.8,"NM",13,0)
PSORXRPT^^0^B40880121
"BLD",7497,"KRN",9.8,"NM",14,0)
PSORXRP1^^0^B27055758
"BLD",7497,"KRN",9.8,"NM",15,0)
PSOLBL1^^0^B31448686
"BLD",7497,"KRN",9.8,"NM",16,0)
PSOLBLN^^0^B63565356
"BLD",7497,"KRN",9.8,"NM",18,0)
PSOSULB1^^0^B46991126
"BLD",7497,"KRN",9.8,"NM",19,0)
PSOB^^0^B24452523
"BLD",7497,"KRN",9.8,"NM",20,0)
PSOBMST^^0^B15843228
"BLD",7497,"KRN",9.8,"NM",21,0)
PSOEXRST^^0^B45659223
"BLD",7497,"KRN",9.8,"NM",23,0)
PSORXRP2^^0^B35963491
"BLD",7497,"KRN",9.8,"NM",24,0)
PSOLLL1^^0^B72361773
"BLD",7497,"KRN",9.8,"NM",25,0)
PSOSURST^^0^B37361776
"BLD",7497,"KRN",9.8,"NM",26,0)
PSOLBL^^0^B76752756
"BLD",7497,"KRN",9.8,"NM",27,0)
PSOLLLI^^0^B87322904
"BLD",7497,"KRN",9.8,"NM",28,0)
PSOLBL2^^0^B36346864
"BLD",7497,"KRN",9.8,"NM",29,0)
PSOLBLN1^^0^B41952754
"BLD",7497,"KRN",9.8,"NM","B","PSOB",19)

"BLD",7497,"KRN",9.8,"NM","B","PSOBMST",20)

"BLD",7497,"KRN",9.8,"NM","B","PSOEXRST",21)

"BLD",7497,"KRN",9.8,"NM","B","PSOFDAMG",8)

"BLD",7497,"KRN",9.8,"NM","B","PSOFDAUT",11)

"BLD",7497,"KRN",9.8,"NM","B","PSOLBL",26)

"BLD",7497,"KRN",9.8,"NM","B","PSOLBL1",15)

"BLD",7497,"KRN",9.8,"NM","B","PSOLBL2",28)

"BLD",7497,"KRN",9.8,"NM","B","PSOLBLN",16)

"BLD",7497,"KRN",9.8,"NM","B","PSOLBLN1",29)

"BLD",7497,"KRN",9.8,"NM","B","PSOLLL1",24)

"BLD",7497,"KRN",9.8,"NM","B","PSOLLL4",7)

"BLD",7497,"KRN",9.8,"NM","B","PSOLLL8",6)

"BLD",7497,"KRN",9.8,"NM","B","PSOLLLI",27)

"BLD",7497,"KRN",9.8,"NM","B","PSOLSET",5)

"BLD",7497,"KRN",9.8,"NM","B","PSOORAL1",12)

"BLD",7497,"KRN",9.8,"NM","B","PSORXL",2)

"BLD",7497,"KRN",9.8,"NM","B","PSORXRP1",14)

"BLD",7497,"KRN",9.8,"NM","B","PSORXRP2",23)

"BLD",7497,"KRN",9.8,"NM","B","PSORXRPT",13)

"BLD",7497,"KRN",9.8,"NM","B","PSORXVW1",3)

"BLD",7497,"KRN",9.8,"NM","B","PSORXVW2",10)

"BLD",7497,"KRN",9.8,"NM","B","PSOSULB1",18)

"BLD",7497,"KRN",9.8,"NM","B","PSOSURST",25)

"BLD",7497,"KRN",19,0)
19
"BLD",7497,"KRN",19.1,0)
19.1
"BLD",7497,"KRN",101,0)
101
"BLD",7497,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",7497,"KRN",101,"NM",1,0)
PSO LM HIDDEN OTHER #2^^2
"BLD",7497,"KRN",101,"NM",2,0)
PSO LM REPRINT FDA MED GUIDE^^0
"BLD",7497,"KRN",101,"NM","B","PSO LM HIDDEN OTHER #2",1)

"BLD",7497,"KRN",101,"NM","B","PSO LM REPRINT FDA MED GUIDE",2)

"BLD",7497,"KRN",409.61,0)
409.61
"BLD",7497,"KRN",771,0)
771
"BLD",7497,"KRN",779.2,0)
779.2
"BLD",7497,"KRN",870,0)
870
"BLD",7497,"KRN",8989.51,0)
8989.51
"BLD",7497,"KRN",8989.52,0)
8989.52
"BLD",7497,"KRN",8994,0)
8994
"BLD",7497,"KRN","B",.4,.4)

"BLD",7497,"KRN","B",.401,.401)

"BLD",7497,"KRN","B",.402,.402)

"BLD",7497,"KRN","B",.403,.403)

"BLD",7497,"KRN","B",.5,.5)

"BLD",7497,"KRN","B",.84,.84)

"BLD",7497,"KRN","B",3.6,3.6)

"BLD",7497,"KRN","B",3.8,3.8)

"BLD",7497,"KRN","B",9.2,9.2)

"BLD",7497,"KRN","B",9.8,9.8)

"BLD",7497,"KRN","B",19,19)

"BLD",7497,"KRN","B",19.1,19.1)

"BLD",7497,"KRN","B",101,101)

"BLD",7497,"KRN","B",409.61,409.61)

"BLD",7497,"KRN","B",771,771)

"BLD",7497,"KRN","B",779.2,779.2)

"BLD",7497,"KRN","B",870,870)

"BLD",7497,"KRN","B",8989.51,8989.51)

"BLD",7497,"KRN","B",8989.52,8989.52)

"BLD",7497,"KRN","B",8994,8994)

"BLD",7497,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7497,"QUES",0)
^9.62^^
"BLD",7497,"REQB",0)
^9.611^13^6
"BLD",7497,"REQB",2,0)
PSO*7.0*343^2
"BLD",7497,"REQB",3,0)
PSO*7.0*336^2
"BLD",7497,"REQB",5,0)
PSO*7.0*338^2
"BLD",7497,"REQB",10,0)
XU*8.0*566^2
"BLD",7497,"REQB",12,0)
PSO*7.0*354^2
"BLD",7497,"REQB",13,0)
PSO*7.0*379^2
"BLD",7497,"REQB","B","PSO*7.0*336",3)

"BLD",7497,"REQB","B","PSO*7.0*338",5)

"BLD",7497,"REQB","B","PSO*7.0*343",2)

"BLD",7497,"REQB","B","PSO*7.0*354",12)

"BLD",7497,"REQB","B","PSO*7.0*379",13)

"BLD",7497,"REQB","B","XU*8.0*566",10)

"FIA",52)
PRESCRIPTION
"FIA",52,0)
^PSRX(
"FIA",52,0,0)
52Is
"FIA",52,0,1)
y^y^p^^^^n^^n
"FIA",52,0,10)

"FIA",52,0,11)

"FIA",52,0,"RLRO")

"FIA",52,0,"VR")
7.0^PSO
"FIA",52,52)
1
"FIA",52,52.01)
1
"FIA",52,52.01,35)

"FIA",52,52.032)
1
"FIA",52,52.032,35)

"FIA",59)
OUTPATIENT SITE
"FIA",59,0)
^PS(59,
"FIA",59,0,0)
59I
"FIA",59,0,1)
y^y^p^^^^n^^n
"FIA",59,0,10)

"FIA",59,0,11)

"FIA",59,0,"RLRO")

"FIA",59,0,"VR")
7.0^PSO
"FIA",59,59)
1
"FIA",59,59,134)

"FIA",59,59,135)

"FIA",59,59.0135)
0
"IX",59,59.0135,"AFDA1",0)
59.0135^AFDA1^Enforces only 1 default Med Guide Printer per Division.^MU^^F^IR^I^59.0135^^^^^A
"IX",59,59.0135,"AFDA1",.1,0)
^^3^3^3110823^
"IX",59,59.0135,"AFDA1",.1,1,0)
This cross-reference ensures that only one printer can be set as the 
"IX",59,59.0135,"AFDA1",.1,2,0)
default printer for printing FDA Medication Guide per division. It sets 
"IX",59,59.0135,"AFDA1",.1,3,0)
this field to null for every other printer in the multiple.
"IX",59,59.0135,"AFDA1",1)
N I F I=0:0 S I=$O(^PS(59,DA(1),"FDA",I)) Q:'I  S:I'=DA $P(^PS(59,DA(1),"FDA",I,0),"^",2)=""
"IX",59,59.0135,"AFDA1",1.4)

"IX",59,59.0135,"AFDA1",2)
Q
"IX",59,59.0135,"AFDA1",11.1,0)
^.114IA^1^1
"IX",59,59.0135,"AFDA1",11.1,1,0)
1^F^59.0135^.02^1^^F
"KRN",.402,1379,-1)
0^1
"KRN",.402,1379,0)
PSO SITE^3120201.0913^^59^^^3120201
"KRN",.402,1379,"DIAB",1,1,59.0135,0)
ALL
"KRN",.402,1379,"DR",1,59)
.01:.06;1008;.07:.081;2004;.09:.091;.1:.18;.2:.52;3:5;2008;6:7;105;105.1;105.2;2006;2007;8;100;101;109;1000;1001;1002;2001;2002;1003;1004;1005;1006;2005;2030;2035;134;135;
"KRN",.402,1379,"DR",2,59.0135)
.01:.02
"KRN",.402,1379,"DR",2,59.02008)
.01;S DIE("NO^")="BACK";1;K DIE("NO^");
"KRN",.402,1379,"DR",2,59.08)
.01;1;
"KRN",.402,1379,"DR",3,59.20081)
.01:1;
"KRN",101,3844,-1)
2^1
"KRN",101,3844,0)
PSO LM HIDDEN OTHER #2^Other OP Actions^^M^11856^^^^^^^141
"KRN",101,3844,10,0)
^101.01PA^6^6
"KRN",101,3844,10,6,0)
5797^RM^^
"KRN",101,3844,10,6,"^")
PSO LM REPRINT FDA MED GUIDE
"KRN",101,5797,-1)
0^2
"KRN",101,5797,0)
PSO LM REPRINT FDA MED GUIDE^Reprint FDA Medication Guide^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5797,4)
^^^RM
"KRN",101,5797,15)
Q
"KRN",101,5797,20)
D REPRTMG^PSOFDAMG
"KRN",101,5797,99)
62321,32066
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
367^3120208^10000000021
"PKG",141,22,1,"PAH",1,1,0)
^^196^196^3120208
"PKG",141,22,1,"PAH",1,1,1,0)
his patch contains software modifications to the Outpatient Pharmacy (OP)
"PKG",141,22,1,"PAH",1,1,2,0)
V. 7.0 application to support the Food and Drug Administration (FDA) 
"PKG",141,22,1,"PAH",1,1,3,0)
Medication Guides - Increment 3 project. The project objective is to allow
"PKG",141,22,1,"PAH",1,1,4,0)
pharmacy staff to retrieve the FDA Medication Guide for prescription items
"PKG",141,22,1,"PAH",1,1,5,0)
that contain FDA approved information that can help patients avoid adverse
"PKG",141,22,1,"PAH",1,1,6,0)
events. The FDA requires that Medication Guides be included with certain
"PKG",141,22,1,"PAH",1,1,7,0)
prescribed drugs and biological products when the Agency determines that:
"PKG",141,22,1,"PAH",1,1,8,0)
 
"PKG",141,22,1,"PAH",1,1,9,0)
 . Certain information is necessary to prevent serious adverse effects 
"PKG",141,22,1,"PAH",1,1,10,0)
 . Patient decision-making should be advised by information about a known
"PKG",141,22,1,"PAH",1,1,11,0)
   serious side effect with a product, or 
"PKG",141,22,1,"PAH",1,1,12,0)
 . Patient adherence to directions for the use of a product is essential
"PKG",141,22,1,"PAH",1,1,13,0)
   to its effectiveness. 
"PKG",141,22,1,"PAH",1,1,14,0)
 
"PKG",141,22,1,"PAH",1,1,15,0)
The features in the FDA Medication Guides project are being delivered in
"PKG",141,22,1,"PAH",1,1,16,0)
incremental releases. This patch is part of the Increment 3 release, which
"PKG",141,22,1,"PAH",1,1,17,0)
is the last planned release. The features included in this release are:
"PKG",141,22,1,"PAH",1,1,18,0)
 
"PKG",141,22,1,"PAH",1,1,19,0)
 . Ability to create and maintain a list of FDA Medication Guide printers
"PKG",141,22,1,"PAH",1,1,20,0)
   for a specific pharmacy division.
"PKG",141,22,1,"PAH",1,1,21,0)
 
"PKG",141,22,1,"PAH",1,1,22,0)
 . Automatic printing of FDA Medication Guide along with prescription 
"PKG",141,22,1,"PAH",1,1,23,0)
   labels.
"PKG",141,22,1,"PAH",1,1,24,0)
 
"PKG",141,22,1,"PAH",1,1,25,0)
 . Ability to reprint the FDA Medication Guide when reprinting a 
"PKG",141,22,1,"PAH",1,1,26,0)
   prescription label.
"PKG",141,22,1,"PAH",1,1,27,0)
 
"PKG",141,22,1,"PAH",1,1,28,0)
 . Ability to change the FDA Medication Guide printer at any point of the
"PKG",141,22,1,"PAH",1,1,29,0)
   dispensing process, similar to changing the label printer.
"PKG",141,22,1,"PAH",1,1,30,0)
 
"PKG",141,22,1,"PAH",1,1,31,0)
 . Ability to reprint the FDA Medication Guide for any given prescription
"PKG",141,22,1,"PAH",1,1,32,0)
   fill or the latest FDA Mediation Guide available for the medication on
"PKG",141,22,1,"PAH",1,1,33,0)
   the prescription.
"PKG",141,22,1,"PAH",1,1,34,0)
  
"PKG",141,22,1,"PAH",1,1,35,0)
 . Identification on the label document that an FDA Medication Guide was
"PKG",141,22,1,"PAH",1,1,36,0)
   printed as well and needs to be collated to the documentation before
"PKG",141,22,1,"PAH",1,1,37,0)
   being handed over to the patient.
"PKG",141,22,1,"PAH",1,1,38,0)
 
"PKG",141,22,1,"PAH",1,1,39,0)
 . Changes to the prescription label activity logs showing which specific
"PKG",141,22,1,"PAH",1,1,40,0)
   FDA Medication Guide document printed along with the label.
"PKG",141,22,1,"PAH",1,1,41,0)
 
"PKG",141,22,1,"PAH",1,1,42,0)
 . Changes to the Consolidated Mail Outpatient Pharmacy (CMOP) Event log
"PKG",141,22,1,"PAH",1,1,43,0)
   showing which specific FDA Medication Guide document was available 
"PKG",141,22,1,"PAH",1,1,44,0)
   for the medication when the prescription fill was transmitted to CMOP.
"PKG",141,22,1,"PAH",1,1,45,0)
 
"PKG",141,22,1,"PAH",1,1,46,0)
 . Introduction of a PC based Java software component to enable the
"PKG",141,22,1,"PAH",1,1,47,0)
   automatic printing of an FDA Medication Guide from within VistA. The
"PKG",141,22,1,"PAH",1,1,48,0)
   software does not require any direct user interaction. The software 
"PKG",141,22,1,"PAH",1,1,49,0)
   identifies a request from VistA for a specific FDA Medication Guide
"PKG",141,22,1,"PAH",1,1,50,0)
   and automatically sends it to the FDA Medication Guide printer
"PKG",141,22,1,"PAH",1,1,51,0)
   selected by the user within VistA when dispensing the medication.
"PKG",141,22,1,"PAH",1,1,52,0)
 
"PKG",141,22,1,"PAH",1,1,53,0)
 . Ability to update the Windows network printer name for a specific
"PKG",141,22,1,"PAH",1,1,54,0)
   device through the Kernel application. Once the pharmacist selects a
"PKG",141,22,1,"PAH",1,1,55,0)
   printer to print the FDA Medication Guide Vista will retrieve the 
"PKG",141,22,1,"PAH",1,1,56,0)
   Windows name for the printer and will pass it on to the Java
"PKG",141,22,1,"PAH",1,1,57,0)
   application responsible for printing the document.
"PKG",141,22,1,"PAH",1,1,58,0)
    
"PKG",141,22,1,"PAH",1,1,59,0)
Below is a list of all the applications involved in this release along
"PKG",141,22,1,"PAH",1,1,60,0)
with their patch number:
"PKG",141,22,1,"PAH",1,1,61,0)
  
"PKG",141,22,1,"PAH",1,1,62,0)
   APPLICATION/VERSION                                    PATCH
"PKG",141,22,1,"PAH",1,1,63,0)
   -----------------------------------------------------------------
"PKG",141,22,1,"PAH",1,1,64,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0    PSX*2*70
"PKG",141,22,1,"PAH",1,1,65,0)
   NATIONAL DRUG FILE (NDF) V. 4.0                        PSN*4*264
"PKG",141,22,1,"PAH",1,1,66,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                        PSO*7*367
"PKG",141,22,1,"PAH",1,1,67,0)
   KERNEL V. 8.0                                          XU*8*566
"PKG",141,22,1,"PAH",1,1,68,0)
   
"PKG",141,22,1,"PAH",1,1,69,0)
The following modifications are included in this patch (PSO*7*367):
"PKG",141,22,1,"PAH",1,1,70,0)
 
"PKG",141,22,1,"PAH",1,1,71,0)
1. Site Parameter Enter/Edit [PSO SITE PARAMETERS] option
"PKG",141,22,1,"PAH",1,1,72,0)
   ------------------------------------------------------
"PKG",141,22,1,"PAH",1,1,73,0)
   Two new parameters are being introduced in this option: 
"PKG",141,22,1,"PAH",1,1,74,0)
   a) FDA MED GUIDE PRINT SERVER URL: this field is used to store the
"PKG",141,22,1,"PAH",1,1,75,0)
      Uniform Resource Locator (URL) for the Print Server where the Java
"PKG",141,22,1,"PAH",1,1,76,0)
      application responsible for automatically printing of the FDA
"PKG",141,22,1,"PAH",1,1,77,0)
      Medication Guides for the division was installed 
"PKG",141,22,1,"PAH",1,1,78,0)
      (e.g.,'http://10.4.21.22/'). This field is required for the FDA
"PKG",141,22,1,"PAH",1,1,79,0)
      Medication Guide functionality to work properly.
"PKG",141,22,1,"PAH",1,1,80,0)
   b) FDA MED GUIDE PRINTER: This is a multiple field used to store a
"PKG",141,22,1,"PAH",1,1,81,0)
      list of printers used for printing FDA Medication Guide document 
"PKG",141,22,1,"PAH",1,1,82,0)
      for the division. There are two fields in the multiple: 1) FDA
"PKG",141,22,1,"PAH",1,1,83,0)
      MED GUIDE PRINTER, which is a pointer to the DEVICE file (#3.5).
"PKG",141,22,1,"PAH",1,1,84,0)
      Only devices with a content in the WINDOWS NETWORK PRINTER NAME
"PKG",141,22,1,"PAH",1,1,85,0)
      field (#75) are selectable, and 2) DEFAULT PRINTER, which 
"PKG",141,22,1,"PAH",1,1,86,0)
      indicates whether the printer selected is to be used as the 
"PKG",141,22,1,"PAH",1,1,87,0)
      default printer for the division. Only one printer can be set as
"PKG",141,22,1,"PAH",1,1,88,0)
      default printer for each division. This field is not required.
"PKG",141,22,1,"PAH",1,1,89,0)
      The printers in this multiple will be displayed for selection
"PKG",141,22,1,"PAH",1,1,90,0)
      when the user logs into a division. If there is a printer set as
"PKG",141,22,1,"PAH",1,1,91,0)
      the default printer, it will be set as the default printer.
"PKG",141,22,1,"PAH",1,1,92,0)
   
"PKG",141,22,1,"PAH",1,1,93,0)
  
"PKG",141,22,1,"PAH",1,1,94,0)
2. Outpatient Pharmacy Manager [PSO MANAGER] option
"PKG",141,22,1,"PAH",1,1,95,0)
   ------------------------------------------------
"PKG",141,22,1,"PAH",1,1,96,0)
   When logging into a division, after selecting the Profile and Label
"PKG",141,22,1,"PAH",1,1,97,0)
   printers, the user will be prompt to select an FDA Medication Guide
"PKG",141,22,1,"PAH",1,1,98,0)
   printer for the current session. If the division selected has a list
"PKG",141,22,1,"PAH",1,1,99,0)
   of FDA Medication Guide printers they will be displayed (see below),
"PKG",141,22,1,"PAH",1,1,100,0)
   however the user will be able to select other printers as well. The
"PKG",141,22,1,"PAH",1,1,101,0)
   HOME and NULL DEVICE are selectable at this point.
"PKG",141,22,1,"PAH",1,1,102,0)
 
"PKG",141,22,1,"PAH",1,1,103,0)
   Select OPTION NAME: PSO MANAGER       Outpatient Pharmacy Manager
"PKG",141,22,1,"PAH",1,1,104,0)
   Outpatient Pharmacy software - Version 
"PKG",141,22,1,"PAH",1,1,105,0)
 
"PKG",141,22,1,"PAH",1,1,106,0)
   Division:    DIVISION 999 
"PKG",141,22,1,"PAH",1,1,107,0)
 
"PKG",141,22,1,"PAH",1,1,108,0)
          You are logged on under the DIVISION division.
"PKG",141,22,1,"PAH",1,1,109,0)
 
"PKG",141,22,1,"PAH",1,1,110,0)
   Select PROFILE PRINTER: HOME//   GENERIC INCOMING TELNET
"PKG",141,22,1,"PAH",1,1,111,0)
 
"PKG",141,22,1,"PAH",1,1,112,0)
   Select LABEL PRINTER: HOME//   GENERIC INCOMING TELNET
"PKG",141,22,1,"PAH",1,1,113,0)
 
"PKG",141,22,1,"PAH",1,1,114,0)
   OK to assume label alignment is correct? YES// 
"PKG",141,22,1,"PAH",1,1,115,0)
 
"PKG",141,22,1,"PAH",1,1,116,0)
   DIVISIONS's FDA Medication Guide Printer(s) on file:
"PKG",141,22,1,"PAH",1,1,117,0)
 
"PKG",141,22,1,"PAH",1,1,118,0)
     FDA MED GUIDE PRINTER (Default)
"PKG",141,22,1,"PAH",1,1,119,0)
 
"PKG",141,22,1,"PAH",1,1,120,0)
   Select FDA MED GUIDE PRINTER: FDA MED GUIDE PRINTER//
"PKG",141,22,1,"PAH",1,1,121,0)
  
"PKG",141,22,1,"PAH",1,1,122,0)
3. Complete Orders from [OERR PSO LMOE FINISH] option
"PKG",141,22,1,"PAH",1,1,123,0)
   Patient Prescription Processing [PSO LM BACKDOOR ORDERS] option
"PKG",141,22,1,"PAH",1,1,124,0)
   ---------------------------------------------------------------
"PKG",141,22,1,"PAH",1,1,125,0)
   There are a few enhancements being added to the prescription processing
"PKG",141,22,1,"PAH",1,1,126,0)
   options regarding the printing of FDA Medication Guides. Among them:
"PKG",141,22,1,"PAH",1,1,127,0)
  
"PKG",141,22,1,"PAH",1,1,128,0)
   a) The FDA Medication Guide document will print automatically for
"PKG",141,22,1,"PAH",1,1,129,0)
      prescriptions, if there is one available.
"PKG",141,22,1,"PAH",1,1,130,0)
 
"PKG",141,22,1,"PAH",1,1,131,0)
   b) Users will have the ability to change the FDA Medication Guide 
"PKG",141,22,1,"PAH",1,1,132,0)
      printer in the same way they change the label and profile printers
"PKG",141,22,1,"PAH",1,1,133,0)
      today.
"PKG",141,22,1,"PAH",1,1,134,0)
 
"PKG",141,22,1,"PAH",1,1,135,0)
   c) When queuing labels to print, if there is at least one prescription
"PKG",141,22,1,"PAH",1,1,136,0)
      with an FDA Medication Guide associated, it will require a valid FDA
"PKG",141,22,1,"PAH",1,1,137,0)
      Medication Guide printer to be entered. This is similar to requiring
"PKG",141,22,1,"PAH",1,1,138,0)
      a valid printer for the label printer.
"PKG",141,22,1,"PAH",1,1,139,0)
 
"PKG",141,22,1,"PAH",1,1,140,0)
   d) The actual label document will contain a note under the barcode,
"PKG",141,22,1,"PAH",1,1,141,0)
      before the PMI document, that says "Read FDA MED Guide". Such note
"PKG",141,22,1,"PAH",1,1,142,0)
      should indicate to the pharmacist that an FDA Medication Guide
"PKG",141,22,1,"PAH",1,1,143,0)
      document has been printed for the prescription and should be handed
"PKG",141,22,1,"PAH",1,1,144,0)
      to the patient.
"PKG",141,22,1,"PAH",1,1,145,0)
 
"PKG",141,22,1,"PAH",1,1,146,0)
   e) The Label Log and CMOP Event Log will both list the FDA Medication
"PKG",141,22,1,"PAH",1,1,147,0)
      Guide document name (.pdf) associated with each fill.
"PKG",141,22,1,"PAH",1,1,148,0)
   
"PKG",141,22,1,"PAH",1,1,149,0)
   f) Users will have the ability to reprint the FDA Medication Guide for
"PKG",141,22,1,"PAH",1,1,150,0)
      past prescription fills or the latest FDA Medication Guide available
"PKG",141,22,1,"PAH",1,1,151,0)
      for the prescription via a new action RM - Reprint FDA Medication
"PKG",141,22,1,"PAH",1,1,152,0)
      Guide under the OTH - Other OP Actions menu.
"PKG",141,22,1,"PAH",1,1,153,0)
       
"PKG",141,22,1,"PAH",1,1,154,0)
4. Print from Suspense File [PSO PNDLBL] option
"PKG",141,22,1,"PAH",1,1,155,0)
   --------------------------------------------
"PKG",141,22,1,"PAH",1,1,156,0)
   In order to run this option users will be required to enter a valid FDA
"PKG",141,22,1,"PAH",1,1,157,0)
   Medication Guide printer. All prescriptions that prints a label via
"PKG",141,22,1,"PAH",1,1,158,0)
   this option and that have an FDA Medication Guide associated will have
"PKG",141,22,1,"PAH",1,1,159,0)
   the documente printed as well in the designated printer.
"PKG",141,22,1,"PAH",1,1,160,0)
 
"PKG",141,22,1,"PAH",1,1,161,0)
5. Pull Early from Suspense [PSO PNDRX] option
"PKG",141,22,1,"PAH",1,1,162,0)
   -------------------------------------------
"PKG",141,22,1,"PAH",1,1,163,0)
   If the prescription being pulled from suspense has an FDA Medication
"PKG",141,22,1,"PAH",1,1,164,0)
   Guide associated the user will be required to enter a valid FDA
"PKG",141,22,1,"PAH",1,1,165,0)
   Medication Guide printer to where the document will be printed for
"PKG",141,22,1,"PAH",1,1,166,0)
   the prescription.
"PKG",141,22,1,"PAH",1,1,167,0)
 
"PKG",141,22,1,"PAH",1,1,168,0)
6. Change Label Printer [PSO CHANGE PRINTER] option
"PKG",141,22,1,"PAH",1,1,169,0)
   ------------------------------------------------
"PKG",141,22,1,"PAH",1,1,170,0)
   This option is used by users to change the profile and label printers
"PKG",141,22,1,"PAH",1,1,171,0)
   after having logged on to a pharmacy division. It is being modified to
"PKG",141,22,1,"PAH",1,1,172,0)
   allow users to change the FDA Medication Guide printer as well.
"PKG",141,22,1,"PAH",1,1,173,0)
   
"PKG",141,22,1,"PAH",1,1,174,0)
7. Reprint an Outpatient Rx Label [PSO RXRPT] option
"PKG",141,22,1,"PAH",1,1,175,0)
   -------------------------------------------------
"PKG",141,22,1,"PAH",1,1,176,0)
   If the prescription selected to reprinted the label has an FDA 
"PKG",141,22,1,"PAH",1,1,177,0)
   Medication Guide associated, this option will ask whether the user also
"PKG",141,22,1,"PAH",1,1,178,0)
   wants to reprint the FDA Medication Guide. If they answer YES, a valid
"PKG",141,22,1,"PAH",1,1,179,0)
   FDA Medication Guide printer will be required for the user to proceed
"PKG",141,22,1,"PAH",1,1,180,0)
   with the reprinting of the label and FDA Medication Guide.
"PKG",141,22,1,"PAH",1,1,181,0)
 
"PKG",141,22,1,"PAH",1,1,182,0)
8. Label/Profile Monitor Reprint [PSO B] option
"PKG",141,22,1,"PAH",1,1,183,0)
   Reprint External Batches [PSO INTERFACE REPRINT] option
"PKG",141,22,1,"PAH",1,1,184,0)
   Reprint Batches from Suspense [PSO PNDRPT] option
"PKG",141,22,1,"PAH",1,1,185,0)
   -------------------------------------------------------
"PKG",141,22,1,"PAH",1,1,186,0)
   These options are used for reprinting batches of labels that may have 
"PKG",141,22,1,"PAH",1,1,187,0)
   jammed on the printer. When reprinting labels via one of these options
"PKG",141,22,1,"PAH",1,1,188,0)
   users will be prompted if they also want to reprint the FDA Medication
"PKG",141,22,1,"PAH",1,1,189,0)
   Guide. If they answer YES, a valid FDA Medication Guide printer will be
"PKG",141,22,1,"PAH",1,1,190,0)
   required for the user to proceed with the reprinting of the label and
"PKG",141,22,1,"PAH",1,1,191,0)
   FDA Medication Guide, if one is available.
"PKG",141,22,1,"PAH",1,1,192,0)
 
"PKG",141,22,1,"PAH",1,1,193,0)
9. The background process that calculates suspense days now rounds any
"PKG",141,22,1,"PAH",1,1,194,0)
   partial day to the next full day. This modification was moved from 
"PKG",141,22,1,"PAH",1,1,195,0)
   patch PSO*7*385 into this patch due to routine overlap and to avoid
"PKG",141,22,1,"PAH",1,1,196,0)
   patch dependency.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
24
"RTN","PSOB")
0^19^B24452523^B19570340
"RTN","PSOB",1,0)
PSOB ;BHAM ISC/CCG - black line resolver ; 07/18/96  8:49 am
"RTN","PSOB",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,60,193,367**;DEC 1997;Build 62
"RTN","PSOB",3,0)
 I '$D(PSOPAR) D ^PSOLSET Q:'$G(PSOPAR)
"RTN","PSOB",4,0)
 S (CC,PSOCLC,PDUZ)=DUZ,PSOBOUT=0
"RTN","PSOB",5,0)
 N PSODISP,PSOMGREP
"RTN","PSOB",6,0)
 I '$O(^PS(52.9,0)) W !!,"THE LABEL/PROFILE MONITOR LIST IS EMPTY.",!! Q
"RTN","PSOB",7,0)
 K DIR,DIRUT
"RTN","PSOB",8,0)
 I $P(PSOPAR,"^",30),$$GET1^DIQ(59,PSOSITE_",",105,"I")=2.4 D  I $D(DIRUT) Q
"RTN","PSOB",9,0)
 .S DIR("A")="Do you want to resend to Dispensing System Device",DIR(0)="Y",DIR("B")="No"
"RTN","PSOB",10,0)
 .D ^DIR K DIR I $D(DIRUT) Q
"RTN","PSOB",11,0)
 .S PSODISP=Y
"RTN","PSOB",12,0)
 ;
"RTN","PSOB",13,0)
 K DIR,DIRUT
"RTN","PSOB",14,0)
 I $$GET1^DIQ(59,PSOSITE,134)'="" D  I $D(DIRUT) Q
"RTN","PSOB",15,0)
 . W ! S DIR("A")="Reprint the FDA Medication Guide",DIR(0)="Y",DIR("B")="No"
"RTN","PSOB",16,0)
 . D ^DIR K DIR Q:$D(DIRUT)  S PSOMGREP=Y
"RTN","PSOB",17,0)
 ;
"RTN","PSOB",18,0)
PT W ! S DIC="^PS(52.9,",DIC("A")="ENTER FAILED OUTPUT DEVICE NUMBER OR NAME: ",DIC(0)="QEAZM" D ^DIC K DIC G END:Y=-1 S PSOBIO=+Y,PSOBPT=Y(0)
"RTN","PSOB",19,0)
RX1 S DIC("A")="ENTER LAST USABLE LABEL/PROFILE : ",DIC="^PS(52.9,PSOBIO,1,",DIC(0)="EQAMZ" D ^DIC G:"^"[X END G:Y=-1 RX1 S PSOBY=Y,PSODPT=Y(0,0),PSODPT(0)=Y(0) K DIC
"RTN","PSOB",20,0)
 I 'X S DA(1)=+Y,DIC("A")="ENTER LAST USABLE Rx: ",DIC="^PS(52.9,PSOBIO,1,DA(1),2,",DIC(0)="EQAMZ" D ^DIC G:"^"[X END G:Y=-1 RX1 D  G:$G(PSOBOUT) END
"RTN","PSOB",21,0)
 .S PSOBR=+PSOBPT,Y(0)=PSODPT(0),Y(0,0)=PSODPT,Y=+PSOBY_"^"_$P(Y,"^",2) D RX08 S PSOBR1=PSOBR K DIC
"RTN","PSOB",22,0)
 S PSOBR=+Y D RX08 G:$G(PSOBOUT) END S PSOBR1=PSOBR
"RTN","PSOB",23,0)
RX2 S DIC="^PS(52.9,PSOBIO,1,",DIC(0)="EQAMZ",DIC("A")="ENTER NEXT USABLE LABEL/PROFILE ('RETURN' FOR REMAINDER OF THE QUEUE):",DIC("S")="I +PSOBR1'>Y" D ^DIC K DIC("S") G:X="^" END
"RTN","PSOB",24,0)
 I X="" S PSOBR2=$P(^PS(52.9,PSOBIO,1,0),"^",3) S:$D(^PS(52.9,PSOBIO,1,PSOBR2,2)) PSOBR2=PSOBR2_"^"_($P(^PS(52.9,PSOBIO,1,PSOBR2,2,0),"^",3)+1) G SET
"RTN","PSOB",25,0)
 G:Y=-1 RX2 S PSOBR=$P(Y,"^") D RX08 S PSOBR2=PSOBR I +PSOBR1=+PSOBR2,$P(PSOBR1,"^",2)>$P(PSOBR2,"^",2) W !!,"THE ENDING RX# DOES NOT FOLLOW THE BEGINNING RX#.  PLEASE TRY AGAIN.",!!! G RX1
"RTN","PSOB",26,0)
SET N PSOBAR1,PSOBAR0,PSOBARS,IOS
"RTN","PSOB",27,0)
 K ZTSK,%ZIS S DIC="^%ZIS(1,",(PSOIOS,DA)=PSOBPT,DR=".01;3",DIQ="DPTR",DIQ(0)="I" D EN^DIQ1
"RTN","PSOB",28,0)
 S DPTRS=$G(DPTR(3.5,DA,3,DIQ(0))),PSOIS=PSOIOS,%ZIS("A")="PRINT ON DEVICE:  ",%ZIS("B")=$S($G(DPTR(3.5,DA,.01,DIQ(0)))'="":$G(DPTR(3.5,DA,.01,DIQ(0))),1:""),%ZIS="QMN" D ^%ZIS
"RTN","PSOB",29,0)
 K %ZIS G:POP END
"RTN","PSOB",30,0)
 I $E(IOST,1,2)="C-" W $C(7),!,"Output MUST be sent to a printer !!",! G SET
"RTN","PSOB",31,0)
 S ZTIO=ION,PSOIOS=IOS,DA=IOST(0)
"RTN","PSOB",32,0)
 S DIC="^%ZIS(2,",DR="61;60",DIQ="DPTRS1",DIQ(0)="I" D EN^DIQ1
"RTN","PSOB",33,0)
 S PSOBAR0="" I $G(DPTRS1(3.2,DA,61,DIQ(0)))'="" S PSOBAR0=$G(DPTRS1(3.2,DA,61,DIQ(0)))
"RTN","PSOB",34,0)
 S PSOBAR1="" I $G(DPTRS1(3.2,DA,60,DIQ(0)))'="" S PSOBAR1=$G(DPTRS1(3.2,DA,60,DIQ(0)))
"RTN","PSOB",35,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",19) S PSOBFLAG=1 D LASK^PSOLSET K PSOBFLAG
"RTN","PSOB",36,0)
 ;
"RTN","PSOB",37,0)
 ; Asking FDA Med Guide printer
"RTN","PSOB",38,0)
 I $G(PSOMGREP),$$GET1^DIQ(59,PSOSITE,134)'="" N FDAPRT S FDAPRT="" D  I FDAPRT="^"!($G(PSOFDAPT)="") G END
"RTN","PSOB",39,0)
 . F  D  Q:FDAPRT'=""
"RTN","PSOB",40,0)
 . . S FDAPRT=$$SELPRT^PSOFDAUT($P($G(PSOFDAPT),"^"))
"RTN","PSOB",41,0)
 . . I FDAPRT="" W $C(7),!,"You must select a valid FDA Medication Guide printer."
"RTN","PSOB",42,0)
 . I FDAPRT'="",(FDAPRT'="^") S PSOFDAPT=FDAPRT
"RTN","PSOB",43,0)
 ;
"RTN","PSOB",44,0)
 S ZTRTN="PSOBMST",ZTDTH=$H,ZTDESC="BLACK LINE RESOLVER",(ZTSAVE("PSOBR1"),ZTSAVE("PSOBR2"),ZTSAVE("PSOBIO"),ZTSAVE("CC"),ZTSAVE("PDUZ"),ZTSAVE("PSOPAR"),ZTSAVE("PSOSITE"),ZTSAVE("PSODIV"))=""
"RTN","PSOB",45,0)
 S (ZTSAVE("PSOIOS"),ZTSAVE("PSOBAR0"),ZTSAVE("PSOBAR1"),ZTSAVE("PSOBARS"),ZTSAVE("PSOSYS"))="",ZTSAVE("PSODISP")="",ZTSAVE("PSOMGREP")="",ZTSAVE("PSOFDAPT")=""
"RTN","PSOB",46,0)
 D ^%ZTLOAD I $G(ZTSK) W !,"Task Queued #"_ZTSK_" !!",!
"RTN","PSOB",47,0)
END D ^%ZISC K PSOIS,ZTSK,%ZIS,CC,DIC,IOP,I,POP,PSOB,PSOBIO,PSOBPT,PSOBR,PSOBR1,PSOBR2,PSOBRX,PSODPT,X,Y,PSOBOUT,DPTR,DPTRS,DPTRS1,DIQ,DIQ(0),DA,DR Q
"RTN","PSOB",48,0)
RX08 I $P(Y(0),"^",2)="L" S:(X'=$P(Y,"^",2))&($O(^PSRX("B",X,0))) Y=+Y_"^"_$O(^PSRX("B",X,0)) S PSOBR=PSOBR_"^"_$O(^PS(52.9,PSOBIO,1,"C",$P(Y,"^",2),PSOBR,0)),PSOBRX=$P(Y,"^",2)
"RTN","PSOB",49,0)
 E  S PSOBR=PSOBR_"^",PSOBRX="" S:$D(^PS(52.9,PSOBIO,1,PSOBR,2,0)) PSOBR=PSOBR_$P(^(0),"^",3),PSOBRX=^($P(PSOBR2,"^",2),0)
"RTN","PSOB",50,0)
 Q:($P(PSOBR,"^",2))!('$D(^PS(52.9,PSOBIO,1,+PSOBR,2,0)))
"RTN","PSOB",51,0)
 S PSOB="^" F I=0:0 S I=$O(^PS(52.9,PSOBIO,1,+PSOBR,2,I)) Q:'I  S PSOB=PSOB_$P(^PSRX($P(^(I,0),"^"),0),"^")_"^"
"RTN","PSOB",52,0)
 I $P(PSOB,"^",3)="" S PSOBR=+PSOBR_"^"_$P(^PS(52.9,PSOBIO,1,+PSOBR,2,0),"^",3) Q
"RTN","PSOB",53,0)
 I $P(Y(0),"^",2)="P" S PSOBR=+PSOBR_"^" Q
"RTN","PSOB",54,0)
RX05 W !,"ENTER RX# OF LAST USABLE SCRIPT FOR "_$P(^DPT(+Y(0),0),"^")_": " R X:DTIME I '$T!(X["^") S PSOBOUT=1 Q
"RTN","PSOB",55,0)
 D:X="?" LIST G:"^"[X RX05 I PSOB'[(U_X_"^") W !!,"???" G RX05
"RTN","PSOB",56,0)
 S PSOBR=+PSOBR_"^"_($O(^PS(52.9,PSOBIO,1,"C",$O(^PSRX("B",X,0)),+PSOBR,0))) Q
"RTN","PSOB",57,0)
LIST W !! F I=2:1 Q:$P(PSOB,"^",I)=""  W !,?5,I-1,"              ",$P(PSOB,"^",I)
"RTN","PSOB",58,0)
RL W !,"CHOOSE 1-",I-2," : " R X:DTIME G:(X<1)!(X>(I-2)) RL S X=$P(PSOB,"^",X+1) Q
"RTN","PSOBMST")
0^20^B15843228^B15703875
"RTN","PSOBMST",1,0)
PSOBMST ;BIR/LAW-black line resolver ;03/6/98
"RTN","PSOBMST",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,71,193,367**;DEC 1997;Build 62
"RTN","PSOBMST",3,0)
 ;master program launched by psob
"RTN","PSOBMST",4,0)
 S PSOBMST="",PSOBP1=+PSOBR1,PSOBR1=+$P(PSOBR1,"^",2),PSOBP2=+PSOBR2,PSOBR2=+$P(PSOBR2,"^",2),(NEW1,NEW11)="",PSOBRX=PSOBR1
"RTN","PSOBMST",5,0)
 F ZI=PSOBP1-1:0 S ZI=$O(^PS(52.9,PSOBIO,1,ZI)) Q:('ZI)!(PSOBP2<ZI)  S (PSOBX,PSOBX1)="",P=$S($P(^(ZI,0),"^",2)="P":U,1:",") D J D PRF:(P=U)&(ZI'=PSOBP1),LBL:(P'=U)&(PSOBX'="") S PSOBRX=0
"RTN","PSOBMST",6,0)
 D ^%ZISC K CC,EXDT,I,II,IOP,J,JJ,K,L,LBL,NEW1,NEW11,P,PI,POP,PPL,PSCAP,PSOSITE,PSOBIO,PSOBMST,PSOBP1,PSOBP2,PSOBR1,PSOBR2,PSOBRX,PSOBX,PSOBLALL,PSOBX1,REF,RX,WARN,X,Y,ZI,ZY,%ZIS,PSODIV,PDUZ,PSOBXPRT,BBB,BBBB,PBXRF S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOBMST",7,0)
J Q:'$D(^PS(52.9,PSOBIO,1,ZI,2))  F J=PSOBRX:0 S J=$O(^PS(52.9,PSOBIO,1,ZI,2,J)) Q:('J)!((ZI=PSOBP2)&(J=PSOBR2))  D SET
"RTN","PSOBMST",8,0)
 Q
"RTN","PSOBMST",9,0)
SET I ($L(PSOBX)+$L(^PS(52.9,PSOBIO,1,ZI,2,J,0))+1)<245 S PSOBX=PSOBX_+^(0)_P S:$P(^(0),"^",2) PSOBXPRT($P(^(0),"^"))=$P(^(0),"^",2) S:$P(^(0),"^",3)'="" PBXRF($P(^(0),"^"))=$P(^(0),"^",3)
"RTN","PSOBMST",10,0)
 E  S PSOBX1=PSOBX1_+^PS(52.9,PSOBIO,1,ZI,2,J,0)_P S:$P(^(0),"^",2) PSOBXPRT($P(^(0),"^"))=$P(^(0),"^",2) S:$P(^(0),"^",3)'="" PBXRF($P(^(0),"^"))=$P(^(0),"^",3)
"RTN","PSOBMST",11,0)
 Q
"RTN","PSOBMST",12,0)
PRF Q:(ZI=PSOBP2)&((PSOBR2=0)!($D(^PS(52.9,PSOBIO,1,ZI,2,PSOBR2,0))))  S:PSOBX'="" NEW1="^"_PSOBX S:PSOBX1'="" NEW11="^"_PSOBX1
"RTN","PSOBMST",13,0)
 S DFN=$P(^PS(52.9,PSOBIO,1,ZI,0),"^"),PSODTCUT=$P(^(0),"^",4),PSOPRPAS=$P(^(0),"^",6),PFIO=IO,%ZIS="",IOP=PFIO D ^%ZIS D START^PSOPRF S (NEW1,NEW11)="" K DFN,PSODTCUT,PSOPRPAS,IOP Q
"RTN","PSOBMST",14,0)
LBL S PPL=PSOBX,PSOSITE=$P(^PS(52.9,PSOBIO,1,ZI,0),"^",7),REPRINT=1 S:$P(^(0),"^",5)'="" COPIES=$P(^(0),"^",5) S:$P(^(0),"^",6)'="" SIDE=$P(^(0),"^",6) I $D(^(1)),^(1)'="" S RXY=^(1)
"RTN","PSOBMST",15,0)
 S IOP=IO,%ZIS="" D ^%ZIS K IOP D EN01
"RTN","PSOBMST",16,0)
 F L=1:1 S LBL=$P(PPL,",",L) Q:(LBL="")&(L'<$L(PPL,","))  D UPDT
"RTN","PSOBMST",17,0)
 I $G(PSOBX1)'="" S PSOBX=PSOBX1 S PSOBX1="" G LBL
"RTN","PSOBMST",18,0)
 K PPL,PSOSITE,REPRINT,RXP,RXY,COPIES,SIDE Q
"RTN","PSOBMST",19,0)
UPDT ;
"RTN","PSOBMST",20,0)
 S BBB=0 F BBBB=0:0 S BBBB=$O(^PSRX(LBL,1,BBBB)) Q:'BBBB  S BBB=BBBB S:BBBB>5 BBB=BBBB+1
"RTN","PSOBMST",21,0)
 S K=1,II=0 F JJ=0:0 S JJ=$O(^PSRX(LBL,"A",JJ)) Q:'JJ  S II=JJ,K=K+1
"RTN","PSOBMST",22,0)
 S II=II+1 S:'($D(^PSRX(LBL,"A",0))#2) ^(0)="^52.3DA^^^" S ^(0)=$P(^(0),"^",1,2)_"^"_II_"^"_K,^PSRX(LBL,"A",II,0)=DT_"^W^"_PDUZ_"^"_$S($G(PSOBXPRT(LBL)):6,$D(PBXRF(LBL)):PBXRF(LBL),1:BBB)_"^"_"GROUP REPRINT" D  Q
"RTN","PSOBMST",23,0)
 .I $G(PBXRF(LBL))>5,'$G(PSOBXPRT(LBL)) S $P(^PSRX(LBL,"A",II,0),"^",4)=($G(PBXRF(LBL))+1)
"RTN","PSOBMST",24,0)
EN01 I $D(PSOIOS),PSOIOS]"" D DEVBAR
"RTN","PSOBMST",25,0)
 I $G(PSOBAR0)]"",$G(PSOBAR1)]"",$D(^PS(59,PSOSITE,1)) S PSOBARS=1
"RTN","PSOBMST",26,0)
 K PSOCPN,PSOLBLCP
"RTN","PSOBMST",27,0)
 I $G(PSODISP) D ^PSOLBL4
"RTN","PSOBMST",28,0)
 G:'$D(PPL)!($P(PSOPAR,"^",30)=2) OUT
"RTN","PSOBMST",29,0)
 F PI=1:1 Q:$P(PPL,",",PI)=""  S RX=$P(PPL,",",PI) D
"RTN","PSOBMST",30,0)
 .S PSOBLALL=1,RXRP(RX)=1_"^"_$G(COPIES)_"^"_$S($G(SIDE):1,1:0)
"RTN","PSOBMST",31,0)
 .I $G(PSOMGREP) S RXRP(RX,"MG")=1
"RTN","PSOBMST",32,0)
 .S:$G(PSOBXPRT(RX)) RXPR(RX)=PSOBXPRT(RX)
"RTN","PSOBMST",33,0)
 .S:$D(PBXRF(RX)) RXFL(RX)=PBXRF(RX) D C^PSOLBL
"RTN","PSOBMST",34,0)
 .K RXRP(+$G(PSOBLRX)),RXPR(+$G(PSOBLRX)),RXFL(+$G(PSOBLRX))
"RTN","PSOBMST",35,0)
 .K PSOBLRX,RXP
"RTN","PSOBMST",36,0)
OUT K PSOCPN,PSOLBLCP,RXRP,RXPR,RXFL,PSOBLRX,RXP,RX
"RTN","PSOBMST",37,0)
 Q
"RTN","PSOBMST",38,0)
DEVBAR ;get the barcode parameters
"RTN","PSOBMST",39,0)
 N DA,DR,DPTR,DPTRS,DPTRS1,DIQ,DIC
"RTN","PSOBMST",40,0)
 S DIC="^%ZIS(1,",DA=PSOIOS,DR="3",DIQ="DPTR",DIQ(0)="I" D EN^DIQ1
"RTN","PSOBMST",41,0)
 S DPTRS=$G(DPTR(3.5,DA,3,DIQ(0)))
"RTN","PSOBMST",42,0)
 S DIC="^%ZIS(2,",DA=DPTRS,DR="61;60",DIQ="DPTRS1",DIQ(0)="I" D EN^DIQ1
"RTN","PSOBMST",43,0)
 S PSOBAR0="" I $G(DPTRS1(3.2,DA,61,DIQ(0)))'="" S PSOBAR0=$G(DPTRS1(3.2,DA,61,DIQ(0)))
"RTN","PSOBMST",44,0)
 S PSOBAR1="" I $G(DPTRS1(3.2,DA,60,DIQ(0)))'="" S PSOBAR1=$G(DPTRS1(3.2,DA,60,DIQ(0)))
"RTN","PSOBMST",45,0)
 Q
"RTN","PSOEXRST")
0^21^B45659223^B43903662
"RTN","PSOEXRST",1,0)
PSOEXRST ;BIR/RTR-Reprint/View HL7 Interface batch ;1/1/96
"RTN","PSOEXRST",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**26,367**;DEC 1997;Build 62
"RTN","PSOEXRST",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOEXRST",4,0)
VW D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) G END
"RTN","PSOEXRST",5,0)
START W !!,"Enter a date/time range to see all batches sent to the External Interface."
"RTN","PSOEXRST",6,0)
BEG K ^TMP($J,"PSOHLRES"),^TMP($J,"PSOHLSPR"),^UTILITY($J,"PSOHLEPT"),PSOOUT,DTOUT,PSOLISTY
"RTN","PSOEXRST",7,0)
 W ! K %DT S %DT="AEXT",%DT("A")="Start date/time: " D ^%DT K %DT G:Y<0!($D(DTOUT)) END
"RTN","PSOEXRST",8,0)
 S (%DT(0),BEGDATE)=Y
"RTN","PSOEXRST",9,0)
 W ! S %DT="AEXT",%DT("A")="End date/time: " D ^%DT K %DT G:Y<0!($D(DTOUT)) END
"RTN","PSOEXRST",10,0)
 S ENDDATE=Y
"RTN","PSOEXRST",11,0)
 S BEGDATE=BEGDATE-.0001,ENDDATE=$S('$P(ENDDATE,".",2):ENDDATE_".9999",1:ENDDATE+.0001),RECNT=1
"RTN","PSOEXRST",12,0)
 W !!,"Gathering batches, please wait...",! H 1
"RTN","PSOEXRST",13,0)
 F ZZZ=BEGDATE:0 S ZZZ=$O(^PS(52.51,"AS",ZZZ)) Q:'ZZZ!(ZZZ>ENDDATE)  D
"RTN","PSOEXRST",14,0)
 . F XXX=0:0 S XXX=$O(^PS(52.51,"AS",ZZZ,PSOSITE,XXX)) Q:'XXX  D
"RTN","PSOEXRST",15,0)
 . . S ^TMP($J,"PSOHLRES",RECNT,ZZZ,PSOSITE,XXX)="",RECNT=RECNT+1
"RTN","PSOEXRST",16,0)
 I '$D(^TMP($J,"PSOHLRES")) W $C(7),!!,"There are no printed batches found for that date/time range!",! G BEG
"RTN","PSOEXRST",17,0)
 ;
"RTN","PSOEXRST",18,0)
 H 1 W @IOF W !?1,"BATCH",?10,"QUEUED TO PRINT ON:",?40,"PRINTED BY:",?56,$E($P($G(^PS(59,PSOSITE,0)),"^"),1,23),!
"RTN","PSOEXRST",19,0)
 S $P(AA,"-",78)="" W AA,!
"RTN","PSOEXRST",20,0)
 F AAA=0:0 S AAA=$O(^TMP($J,"PSOHLRES",AAA)) Q:'AAA!($G(PSOOUT))  D
"RTN","PSOEXRST",21,0)
 . S PSIDATE=$O(^TMP($J,"PSOHLRES",AAA,0)),PSODUZ=$O(^TMP($J,"PSOHLRES",AAA,PSIDATE,PSOSITE,0))
"RTN","PSOEXRST",22,0)
 . D ZZNAME S Y=PSIDATE X ^DD("DD") S PSODATE=Y,PSOUSER=$S($D(^VA(200,PSODUZ,0)):$P($G(^(0)),"^"),1:"UNKNOWN")
"RTN","PSOEXRST",23,0)
 . D:($Y+5)>IOSL  Q:$G(PSOOUT)  W !?2,AAA,?10,PSODATE,?40,PSOUSER
"RTN","PSOEXRST",24,0)
 . . W ! K DIR S DIR(0)="E" D ^DIR K DIR S:'Y PSOOUT=1
"RTN","PSOEXRST",25,0)
 . . I Y W @IOF W !?1,"BATCH",?10,"QUEUED TO PRINT ON:",?40,"PRINTED BY:",?56,$E($P($G(^PS(59,PSOSITE,0)),"^"),1,23),!,AA
"RTN","PSOEXRST",26,0)
 I $G(PSOOUT),Y="" G END
"RTN","PSOEXRST",27,0)
 ;
"RTN","PSOEXRST",28,0)
 S RECNT=RECNT-1,PSOOUT=0 W ! K DIR
"RTN","PSOEXRST",29,0)
 S DIR("A")="Select Batch(s) to "_$S($G(PSOEXVW):"view",1:"reprint"),DIR(0)="L^1:"_RECNT D ^DIR
"RTN","PSOEXRST",30,0)
 K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) W !!?3,"Nothing chosen to "_$S($G(PSOEXVW):"view",1:"reprint"),! G START
"RTN","PSOEXRST",31,0)
 S COUNT=1 F ZZ=1:1:$L(Y) S ZZZ=$E(Y,ZZ) I ZZZ="," S COUNT=COUNT+1
"RTN","PSOEXRST",32,0)
 S COUNT=COUNT-1 F JJ=1:1:COUNT S RR=$P(Y,",",JJ),^TMP($J,"PSOHLSPR",RR)=""
"RTN","PSOEXRST",33,0)
YLOOP I $G(Y(1)) F PSYLOOP=0:0 S PSYLOOP=$O(Y(PSYLOOP)) Q:'PSYLOOP  D
"RTN","PSOEXRST",34,0)
 . S COUNT=1 F ZZ=1:1:$L(Y(PSYLOOP)) S ZZZ=$E(Y(PSYLOOP),ZZ) I ZZZ="," S COUNT=COUNT+1
"RTN","PSOEXRST",35,0)
 . S COUNT=COUNT-1 F JJ=1:1:COUNT S RR=$P(Y(PSYLOOP),",",JJ),^TMP($J,"PSOHLSPR",RR)=""
"RTN","PSOEXRST",36,0)
 W !!,"Batches selected for "_$S($G(PSOEXVW):"Viewing",1:"Reprint")_" are:",!
"RTN","PSOEXRST",37,0)
 F ZZZ=0:0 S ZZZ=$O(^TMP($J,"PSOHLSPR",ZZZ)) Q:'ZZZ  D
"RTN","PSOEXRST",38,0)
 . S PSIDATE=$O(^TMP($J,"PSOHLRES",ZZZ,0)),PSODUZ=$O(^TMP($J,"PSOHLRES",ZZZ,PSIDATE,PSOSITE,0))
"RTN","PSOEXRST",39,0)
 . S Y=PSIDATE X ^DD("DD") S PSODATE=Y,PSOUSER=$S($D(^VA(200,PSODUZ,0)):$P($G(^(0)),"^"),1:"UNKNOWN")
"RTN","PSOEXRST",40,0)
 . W !,"Batch ",ZZZ," Queued for ",PSODATE," by ",PSOUSER
"RTN","PSOEXRST",41,0)
 ;
"RTN","PSOEXRST",42,0)
 W ! K DIR,DIRUT
"RTN","PSOEXRST",43,0)
 I $$GET1^DIQ(59,PSOSITE,134)'="" D  I $D(DIRUT) G END
"RTN","PSOEXRST",44,0)
 . S DIR("A")="Reprint the FDA Medication Guide",DIR(0)="Y",DIR("B")="No"
"RTN","PSOEXRST",45,0)
 . S PSOMGREP=0 D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S PSOMGREP=Y
"RTN","PSOEXRST",46,0)
 ;
"RTN","PSOEXRST",47,0)
 K PSOLISTY I $G(PSOEXVW) S Y=1 G VWPASS
"RTN","PSOEXRST",48,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Before Reprinting, would you like a list of these prescriptions" D ^DIR K DIR I Y["^"!($D(DTOUT)) W !!?3,"Nothing queued to reprint!",! G START
"RTN","PSOEXRST",49,0)
VWPASS I Y W ! S PSOLISTY=1 S DIR(0)="SB^S:SCREEN;P:PRINTER",DIR("A")="Print list to the screen or to a printer",DIR("B")="Screen" D ^DIR K DIR I $D(DIRUT) W !!?3,"Nothing queued to print!",! G START
"RTN","PSOEXRST",50,0)
 I $G(PSOLISTY),Y="P" D ^PSOEXBCH G START
"RTN","PSOEXRST",51,0)
 I $G(PSOLISTY) D LIST I $G(PSOOUT)!($G(PSOEXVW)) G START
"RTN","PSOEXRST",52,0)
 K DIR W ! S DIR(0)="Y",DIR("B")="Y",DIR("A")="Are you sure you want to Reprint labels" D ^DIR K DIR I Y'=1 W !!,"Nothing queued to Reprint!",! G START
"RTN","PSOEXRST",53,0)
QUE D GETPPL^PSOEXBCH
"RTN","PSOEXRST",54,0)
 K PSOEXREX
"RTN","PSOEXRST",55,0)
 I '$D(PPLX) W !!,"No Active Labels to Reprint!",! G START
"RTN","PSOEXRST",56,0)
 F ZPPL=0:0 S ZPPL=$O(PPLX(ZPPL)) Q:'ZPPL!($G(PSOEXREX))  D
"RTN","PSOEXRST",57,0)
 . K PPL,RXPR S PPL=PPLX(ZPPL)
"RTN","PSOEXRST",58,0)
 . F PPLPAR=0:0 S PPLPAR=$O(RXPRX(ZPPL,PPLPAR)) Q:'PPLPAR  D
"RTN","PSOEXRST",59,0)
 . . S RXPR(PPLPAR)=RXPRX(ZPPL,PPLPAR)
"RTN","PSOEXRST",60,0)
 . D RACT
"RTN","PSOEXRST",61,0)
 . S PSOEXREP=1 D @$S($P($G(PSOPAR),"^",26):"^PSORXL",1:"Q^PSORXL")
"RTN","PSOEXRST",62,0)
 I '$G(PSOEXREX) W !!,"LABEL(S) QUEUED TO PRINT!",!
"RTN","PSOEXRST",63,0)
 ;W ! K %DT D NOW^%DTC S %DT="REAX",%DT(0)=%,%DT("B")="NOW",%DT("A")="Queue labels to reprint at what time: " D ^%DT K %DT I $D(DTOUT)!(Y<0) W !!?3,"Nothing queued to reprint!",! G START
"RTN","PSOEXRST",64,0)
 ;S PSOSUREP=1,PSORTIME=Y
"RTN","PSOEXRST",65,0)
 ;W ! S %ZIS("A")="REPRINT LABEL DEVICE: ",%ZIS("B")="",%ZIS="MQN" D ^%ZIS I POP!($E(IOST)["C") G START
"RTN","PSOEXRST",66,0)
 ;F J=0,1 S @("PSOBAR"_J)="" I $D(^%ZIS(2,^%ZIS(1,IOS,"SUBTYPE"),"BAR"_J)) S @("PSOBAR"_J)=^("BAR"_J)
"RTN","PSOEXRST",67,0)
 ;S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",19)
"RTN","PSOEXRST",68,0)
 ;S PSOREDEV=ION
"RTN","PSOEXRST",69,0)
 ;S ZTRTN="BEG^PSOSUSRP",ZTDTH=PSORTIME,ZTIO=PSOREDEV,ZTDESC="REPRINT LABELS FROM SUSPENSE"
"RTN","PSOEXRST",70,0)
 ;F GG="PSOPAR","PSOSYS","PSOSITE","PSOSUREP","PSOBARS","PSOBAR0","PSOBAR1" S:$D(@GG) ZTSAVE(GG)=""
"RTN","PSOEXRST",71,0)
 ;F NNN=0:0 S NNN=$O(^TMP($J,"PSORESPR",NNN)) Q:'NNN  D
"RTN","PSOEXRST",72,0)
 ;.S PSRDATE=$O(^TMP($J,"PSORES",NNN,0)),PSRDUZ=$O(^TMP($J,"PSORES",NNN,PSRDATE,0)),PSRDIV=$O(^TMP($J,"PSORES",NNN,PSRDATE,PSRDUZ,0))
"RTN","PSOEXRST",73,0)
 ;.S ^UTILITY($J,"PSOREPT",PSRDATE,PSRDUZ,PSRDIV)=""
"RTN","PSOEXRST",74,0)
 ;S ZTSAVE("^UTILITY($J,""PSOREPT"",")="" D ^%ZTLOAD
"RTN","PSOEXRST",75,0)
 ;W !!,"REPRINTED LABELS QUEUED TO PRINT!",!
"RTN","PSOEXRST",76,0)
END K ^TMP($J,"PSOHLRES"),^TMP($J,"PSOHLSPR"),%DT,%ZIS,AA,AAA,BEGDATE,COUNT,DUOUT,DTOUT,ENDDATE,GG,INRX,JJ,LLL,MMM
"RTN","PSOEXRST",77,0)
 K NNN,POP,PSIDATE,PSODATE,PSODUZ,PSOREDEV,PSORTIME,PSOSUREP,PSOUSER,PSYLOOP,NM1,NM2,NM3,HLZNAME,ZZNAME,PSOEXREP
"RTN","PSOEXRST",78,0)
 K ZPPL,PPLPAR,RXPR,HLZZNAME,HLZZDRUG,HLZZDRUL,PSRDATE,PSRDIV,PSOLISTY,PSRDUZ,RECNT,REDT,REDUZ,RR,SS,XXX,ZZ,ZZZ
"RTN","PSOEXRST",79,0)
 K ZZNM,ZZNM1,ZZZ,PSOEXVW,PSEXSTAT,PSX,PPL,PPLX,RXPRX,RXPR,PSOEXREX,PSOMGREP
"RTN","PSOEXRST",80,0)
 D ^%ZISC Q
"RTN","PSOEXRST",81,0)
 ;
"RTN","PSOEXRST",82,0)
LIST F LLL=0:0 S LLL=$O(^TMP($J,"PSOHLSPR",LLL)) Q:'LLL!($G(PSOOUT))  D GETN D
"RTN","PSOEXRST",83,0)
 .W ! S DIR(0)="E" D ^DIR K DIR S:'Y PSOOUT=1 Q:$G(PSOOUT)  D HEAD S REDT=$O(^TMP($J,"PSOHLRES",LLL,0)),REDUZ=$O(^TMP($J,"PSOHLRES",LLL,REDT,PSOSITE,0)) F SS=0:0 S SS=$O(^PS(52.51,"AS",REDT,PSOSITE,REDUZ,SS)) Q:'SS!($G(PSOOUT))  D
"RTN","PSOEXRST",84,0)
 ..D:($Y+5)>IOSL HEADONE Q:$G(PSOOUT)  I $D(^PS(52.51,SS,0)),$P($G(^(0)),"^",11)=PSOSITE S INRX=$P(^(0),"^") I $D(^PSRX(INRX,0)) D
"RTN","PSOEXRST",85,0)
 ...;D STAT
"RTN","PSOEXRST",86,0)
 ...S HLZZNAME=$P($G(^DPT(+$P($G(^PSRX(INRX,0)),"^",2),0)),"^")
"RTN","PSOEXRST",87,0)
 ...S HLZZDRUG=$P($G(^PSDRUG(+$P($G(^PSRX(INRX,0)),"^",6),0)),"^"),HLZZDRUL=$L($G(HLZZDRUG))
"RTN","PSOEXRST",88,0)
 ...W !,$P(^PSRX(INRX,0),"^"),?13,$G(HLZZNAME)
"RTN","PSOEXRST",89,0)
 ...I +$G(HLZZDRUL)<37 W ?44,$G(HLZZDRUG) Q
"RTN","PSOEXRST",90,0)
 ...W !?38,$G(HLZZDRUG)
"RTN","PSOEXRST",91,0)
 I $G(PSOOUT),(Y="") Q
"RTN","PSOEXRST",92,0)
 S PSOOUT=0 I Y'=0 W !,"END OF LIST"
"RTN","PSOEXRST",93,0)
 Q
"RTN","PSOEXRST",94,0)
HEAD W @IOF W !,"RX #",?13,"PATIENT NAME",?44,"BATCH ",LLL,! F ZZZZ=1:1:78 W "-"
"RTN","PSOEXRST",95,0)
 Q
"RTN","PSOEXRST",96,0)
HEADONE S DIR(0)="E" D ^DIR K DIR I 'Y S PSOOUT=1 Q
"RTN","PSOEXRST",97,0)
 W @IOF W !,"RX #",?13,"PATIENT NAME",?44,"BATCH ",LLL,! F ZZZZ=1:1:78 W "-"
"RTN","PSOEXRST",98,0)
 Q
"RTN","PSOEXRST",99,0)
GETN S NM1=$O(^TMP($J,"PSOHLRES",LLL,0)),NM2=$O(^TMP($J,"PSOHLRES",LLL,NM1,PSOSITE,0)),NM3=$O(^PS(52.51,"AS",NM1,PSOSITE,NM2,0))
"RTN","PSOEXRST",100,0)
 S HLZNAME=$P($G(^DPT(+$P($G(^PS(52.51,+$G(NM3),0)),"^",2),0)),"^")
"RTN","PSOEXRST",101,0)
 Q
"RTN","PSOEXRST",102,0)
ZZNAME S ZZNM=+$O(^PS(52.51,"AS",PSIDATE,PSOSITE,PSODUZ,0)),ZZNM1=+$P($G(^PS(52.51,ZZNM,0)),"^",2)
"RTN","PSOEXRST",103,0)
 S ZZNAME=$P($G(^DPT(ZZNM1,0)),"^")
"RTN","PSOEXRST",104,0)
 Q
"RTN","PSOEXRST",105,0)
VIEW ;
"RTN","PSOEXRST",106,0)
 S PSOEXVW=1 G VW
"RTN","PSOEXRST",107,0)
 ;
"RTN","PSOEXRST",108,0)
STAT ;
"RTN","PSOEXRST",109,0)
 S PSX=$P($G(^PSRX(INRX,"STA")),"^")
"RTN","PSOEXRST",110,0)
 S PSEXSTAT=$S(PSX=0:"ACTIVE",PSX=1:"NON-VERIFIED",PSX=3:"HOLD",PSX=4:"DRUG INTERACTION",PSX=5:"SUSPENDED",PSX=11:"EXPIRED",PSX=12!(PSX=14):"DISCONTINUED",PSX=13:"DELETED",PSX=15:"DISCONTINUED (EDIT)",PSX=16:"PROVIDER HOLD",1:"")
"RTN","PSOEXRST",111,0)
 Q
"RTN","PSOEXRST",112,0)
RACT ;Set activity log
"RTN","PSOEXRST",113,0)
 N WW,WRX,WRX,WFILL,WWW,WIR
"RTN","PSOEXRST",114,0)
 F WW=1:1 S WRX=$P(PPL,",",WW) Q:'WRX  D:$G(WRX)
"RTN","PSOEXRST",115,0)
 .I '$G(RXPR(WRX)) S WFILL=0 F WWW=0:0 S WWW=$O(^PSRX(WRX,1,WWW)) Q:'WWW  S WFILL=WWW S:WWW>5 WFILL=WWW+1
"RTN","PSOEXRST",116,0)
 .S WIR=0 F WWW=0:0 S WWW=$O(^PSRX(WRX,"A",WWW)) Q:'WWW  S WIR=WWW
"RTN","PSOEXRST",117,0)
 .S WIR=WIR+1,^PSRX(WRX,"A",0)="^52.3DA^"_WIR_"^"_WIR
"RTN","PSOEXRST",118,0)
 .D NOW^%DTC S ^PSRX(WRX,"A",WIR,0)=%_"^W^"_+$G(DUZ)_"^"_$S($G(RXPR(WRX)):6,1:$G(WFILL))_"^"_"Reprint "_$S($G(RXPR(WRX)):"(PARTIAL) ",1:"")_"(Originally sent to External Interface)"
"RTN","PSOEXRST",119,0)
 Q
"RTN","PSOFDAMG")
0^8^B14147162^B1007173
"RTN","PSOFDAMG",1,0)
PSOFDAMG ;BHAM ISC/MR - FDA Medication Guide ;11/10/09 3:44pm
"RTN","PSOFDAMG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**343,367**;DEC 1997;Build 62
"RTN","PSOFDAMG",3,0)
 ;External reference EN^PSNFDAMG supported by DBIA 5517
"RTN","PSOFDAMG",4,0)
 ;External reference ^PSDRUG supported by DBIA 221
"RTN","PSOFDAMG",5,0)
 ;External reference to DEVICE file (#3.5) supported by DBIA 5718
"RTN","PSOFDAMG",6,0)
 ;
"RTN","PSOFDAMG",7,0)
DISPLAY ; Display the FDA Medication Guide
"RTN","PSOFDAMG",8,0)
 ; Note: RX0 is a global variable (assumed as such by most hidden actions)
"RTN","PSOFDAMG",9,0)
 N DRGIEN,VAPRDIEN
"RTN","PSOFDAMG",10,0)
 S DRGIEN=+$P($G(RX0),"^",6)
"RTN","PSOFDAMG",11,0)
 I '$D(^PSDRUG(DRGIEN,0)) W $C(7),!,"Invalid Drug" D WAIT^VALM1 Q
"RTN","PSOFDAMG",12,0)
 S VAPRDIEN=+$P($G(^PSDRUG(DRGIEN,"ND")),"^",3)
"RTN","PSOFDAMG",13,0)
 I 'VAPRDIEN W $C(7),!!,$$GET1^DIQ(50,DRGIEN,.01)_" not matched to the National Drug File (NDF)" D WAIT^VALM1 Q
"RTN","PSOFDAMG",14,0)
 ;
"RTN","PSOFDAMG",15,0)
 D FULL^VALM1 D EN^PSNFDAMG(VAPRDIEN)
"RTN","PSOFDAMG",16,0)
 Q
"RTN","PSOFDAMG",17,0)
 ;
"RTN","PSOFDAMG",18,0)
PRINTMG(RXIEN,PRINTER) ; This API is used to automatically print FDA Med Guides along with Rx labels.
"RTN","PSOFDAMG",19,0)
 ; Input: (r) RXIEN   - Pointer to the DRUG file (#50)
"RTN","PSOFDAMG",20,0)
 ;        (r) PRINTER - Windows Printer Network Name (e.g., '\\vhaistfpc4\IST-HP4525-1')
"RTN","PSOFDAMG",21,0)
 ;
"RTN","PSOFDAMG",22,0)
 ;Output: ERROR (2 pieces)
"RTN","PSOFDAMG",23,0)
 ;        P1 - 0: Success / 1:Error
"RTN","PSOFDAMG",24,0)
 ;        P2 - Error Message (when P1 = 1) (e.g. "No FDA Med Guide on file", "Invalid Printer Name", etc.)
"RTN","PSOFDAMG",25,0)
 ;
"RTN","PSOFDAMG",26,0)
 N PRTSVURL,FDAMGURL,FDAMGFN,STATUS,RXNUM,PATNAM
"RTN","PSOFDAMG",27,0)
 ;
"RTN","PSOFDAMG",28,0)
 I '$$MGONFILE^PSOFDAUT(RXIEN) Q "1^No FDA Med Guide Available"
"RTN","PSOFDAMG",29,0)
 I $G(PRINTER)="" Q "1^Invalid Printer"
"RTN","PSOFDAMG",30,0)
 I $$GET1^DIQ(59,PSOSITE,134)="" Q "1^FDA Med Guide automatic printing functionality turned OFF"
"RTN","PSOFDAMG",31,0)
 ;
"RTN","PSOFDAMG",32,0)
 ; Concatenating/Encoding the Web Server URL to the FDA Med Guide file name
"RTN","PSOFDAMG",33,0)
 S FDAMGFN=$P($$MGONFILE^PSOFDAUT(RXIEN),"^",2)
"RTN","PSOFDAMG",34,0)
 S RXNUM=$$GET1^DIQ(52,RXIEN,.01)
"RTN","PSOFDAMG",35,0)
 S PATNAM=$$GET1^DIQ(52,RXIEN,2)
"RTN","PSOFDAMG",36,0)
 S FDAMGURL=$$ENCODE^XTHCURL($$GET1^DIQ(59.7,1,100)_FDAMGFN_"^"_RXNUM_"^"_PATNAM_"^"_PRINTER_"^")
"RTN","PSOFDAMG",37,0)
 ;
"RTN","PSOFDAMG",38,0)
 S PRTSVURL=$$GET1^DIQ(59,PSOSITE,134)_"Eep9qUmT="
"RTN","PSOFDAMG",39,0)
 ;
"RTN","PSOFDAMG",40,0)
 ;Invoking Kernel HTTP Toolkit
"RTN","PSOFDAMG",41,0)
 S STATUS=$$GETURL^XTHC10(PRTSVURL_FDAMGURL,30)
"RTN","PSOFDAMG",42,0)
 I (+STATUS'=200) Q "1^"_$P(STATUS,"^",2)
"RTN","PSOFDAMG",43,0)
 ;
"RTN","PSOFDAMG",44,0)
 Q 0
"RTN","PSOFDAMG",45,0)
 ;
"RTN","PSOFDAMG",46,0)
REPRTMG ; Entry point for Reprint FDA Medication Guide
"RTN","PSOFDAMG",47,0)
 ; Note: The PSOSITE variable is assumed to be set with the Pharmacy Division IEN
"RTN","PSOFDAMG",48,0)
 ;
"RTN","PSOFDAMG",49,0)
 N RXIEN,DRGIEN,VAPRDIEN,PRTSVURL,FDAMGURL,FDAMGFN,PRINTER,STATUS
"RTN","PSOFDAMG",50,0)
 ;
"RTN","PSOFDAMG",51,0)
 S RXIEN=$P(PSOLST(ORN),"^",2)
"RTN","PSOFDAMG",52,0)
 S DRGIEN=+$P($G(RX0),"^",6)
"RTN","PSOFDAMG",53,0)
 I '$D(^PSDRUG(DRGIEN,0)) W $C(7),!!,"Invalid Drug" D WAIT^VALM1 Q
"RTN","PSOFDAMG",54,0)
 S VAPRDIEN=+$P($G(^PSDRUG(DRGIEN,"ND")),"^",3)
"RTN","PSOFDAMG",55,0)
 I 'VAPRDIEN W $C(7),!!,$$GET1^DIQ(50,DRGIEN,.01)_" not matched to the National Drug File (NDF)" D WAIT^VALM1 Q
"RTN","PSOFDAMG",56,0)
 I '$$MGONFILE^PSOFDAUT(RXIEN) W $C(7),!!,"No FDA Medication Guide on file for this Rx." D WAIT^VALM1 Q
"RTN","PSOFDAMG",57,0)
 I $$GET1^DIQ(59,PSOSITE,134)="" W $C(7),!!,"FDA Med Guide automatic printing functionality is turned OFF for this site." D WAIT^VALM1 Q
"RTN","PSOFDAMG",58,0)
 ;
"RTN","PSOFDAMG",59,0)
 D FULL^VALM1
"RTN","PSOFDAMG",60,0)
 ;
"RTN","PSOFDAMG",61,0)
 ; Printer Selection
"RTN","PSOFDAMG",62,0)
 F  D  Q:$P(PRINTER,"^",2)'=""!(PRINTER="^")
"RTN","PSOFDAMG",63,0)
 . S PRINTER=$$SELPRT^PSOFDAUT($P($G(PSOFDAPT),"^")) Q:PRINTER="^"
"RTN","PSOFDAMG",64,0)
 . I $P(PRINTER,"^",2)="" W $C(7),!,"You must select a valid FDA Medication Guide printer."
"RTN","PSOFDAMG",65,0)
 I PRINTER="^" D WAIT^VALM1 Q
"RTN","PSOFDAMG",66,0)
 ;
"RTN","PSOFDAMG",67,0)
 S PSOFDAPT=PRINTER
"RTN","PSOFDAMG",68,0)
 ;
"RTN","PSOFDAMG",69,0)
 W !,"Select FDA Medication Guide to reprint:",!
"RTN","PSOFDAMG",70,0)
 S FDAMGFN=$$FDAMGDOC^PSOFDAUT(RXIEN) I FDAMGFN="^" D WAIT^VALM1 Q
"RTN","PSOFDAMG",71,0)
 ;
"RTN","PSOFDAMG",72,0)
 ; Concatenating/Encoding the Web Server URL to the FDA Med Guide file name
"RTN","PSOFDAMG",73,0)
 S RXNUM=$$GET1^DIQ(52,RXIEN,.01)
"RTN","PSOFDAMG",74,0)
 S PATNAM=$$GET1^DIQ(52,RXIEN,2)
"RTN","PSOFDAMG",75,0)
 S FDAMGURL=$$ENCODE^XTHCURL($$GET1^DIQ(59.7,1,100)_FDAMGFN_"^"_RXNUM_"^"_PATNAM_"^"_$P(PSOFDAPT,"^",2)_"^")
"RTN","PSOFDAMG",76,0)
 ;
"RTN","PSOFDAMG",77,0)
 S PRTSVURL=$$GET1^DIQ(59,+$G(PSOSITE),134)_"Eep9qUmT="
"RTN","PSOFDAMG",78,0)
 ;
"RTN","PSOFDAMG",79,0)
 ;Invoking Kernel HTTP Toolkit //Zaleplon_(Sonata)_(2007).pdf
"RTN","PSOFDAMG",80,0)
 S STATUS=$$GETURL^XTHC10(PRTSVURL_FDAMGURL,30)
"RTN","PSOFDAMG",81,0)
 I (+STATUS=200) D
"RTN","PSOFDAMG",82,0)
 . W !!,"FDA Medication Guide sent to printer."
"RTN","PSOFDAMG",83,0)
 I (+STATUS=-1) W !!,"Unable to reprint FDA Medication Guide (",$P(STATUS,"^",2),")."
"RTN","PSOFDAMG",84,0)
 N DIR W ! D WAIT^VALM1
"RTN","PSOFDAMG",85,0)
 Q
"RTN","PSOFDAUT")
0^11^B23106089^n/a
"RTN","PSOFDAUT",1,0)
PSOFDAUT ;BIRM/MFR - FDA Med Guide Utilities ; 07 Jun 2005  8:39 PM
"RTN","PSOFDAUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**367**;DEC 1997;Build 62
"RTN","PSOFDAUT",3,0)
 ;External reference to $$FDAMG^PSNAPIS supported by DBIA 2531
"RTN","PSOFDAUT",4,0)
 ;
"RTN","PSOFDAUT",5,0)
SELPRT(DEFAULT) ; FDA Med Guide Printer Selection
"RTN","PSOFDAUT",6,0)
 ;Input: DEFAULT - Default Printer Name 
"RTN","PSOFDAUT",7,0)
 ;Return Variable: SELPRT: Selected Printer Name ^ Windows Network Printer Name
"RTN","PSOFDAUT",8,0)
 ;
"RTN","PSOFDAUT",9,0)
 N SELPRT,NTWRKNAM,DEFPRT,%ZIS,VALID,DEVIEN,PRTLST,I
"RTN","PSOFDAUT",10,0)
 ;
"RTN","PSOFDAUT",11,0)
 ; If FDA MG PRINT SERVER is not present quits (FDA MG Functionality is OFF)
"RTN","PSOFDAUT",12,0)
 I $$GET1^DIQ(59,PSOSITE,134)="" Q "^"
"RTN","PSOFDAUT",13,0)
 ;
"RTN","PSOFDAUT",14,0)
 S SELPRT=$G(DEFAULT) D ^%ZISC
"RTN","PSOFDAUT",15,0)
 I SELPRT'="" D
"RTN","PSOFDAUT",16,0)
 . S DEFPRT=SELPRT
"RTN","PSOFDAUT",17,0)
 E  D
"RTN","PSOFDAUT",18,0)
 . S DEFPRT=$$DEFPRT(PSOSITE)
"RTN","PSOFDAUT",19,0)
 ;
"RTN","PSOFDAUT",20,0)
 D PRTLST(PSOSITE,.PRTLST)
"RTN","PSOFDAUT",21,0)
 I $O(PRTLST(0)) D
"RTN","PSOFDAUT",22,0)
 . W !!,$$GET1^DIQ(59,PSOSITE,.01),"'s FDA Medication Guide Printer(s) on file:",!
"RTN","PSOFDAUT",23,0)
 . F I=0:0 S I=$O(PRTLST(I)) Q:'I  W !?5,$P(PRTLST(I),"^",2)
"RTN","PSOFDAUT",24,0)
 ;
"RTN","PSOFDAUT",25,0)
PRT ; Printer prompt
"RTN","PSOFDAUT",26,0)
 S %ZIS="MNQ",%ZIS("A")="Select FDA MED GUIDE PRINTER: "
"RTN","PSOFDAUT",27,0)
 S:$G(DEFPRT)'="" %ZIS("B")=$P(DEFPRT,"^") W ! D ^%ZIS K %ZIS,IO("Q"),IOP I POP Q "^"
"RTN","PSOFDAUT",28,0)
 S VALID=1
"RTN","PSOFDAUT",29,0)
 I (IO'=IO(0)) D  I 'VALID D ^%ZISC G PRT
"RTN","PSOFDAUT",30,0)
 . S DEVIEN=IOS,NTWRKNAM=$$GET1^DIQ(3.5,IOS,75)
"RTN","PSOFDAUT",31,0)
 . I (NTWRKNAM=""&(" "_ION_" "'[" NULL ")) D  S VALID=0 Q
"RTN","PSOFDAUT",32,0)
 . . W !,"This device cannot be used for printing FDA Medication Guides."
"RTN","PSOFDAUT",33,0)
 . . W !,"Please, contact your IRM and ask them to update the Windows"
"RTN","PSOFDAUT",34,0)
 . . W !,"Network Printer Name for this device.",$C(7)
"RTN","PSOFDAUT",35,0)
 . E  D
"RTN","PSOFDAUT",36,0)
 . . S SELPRT=ION_"^"_NTWRKNAM
"RTN","PSOFDAUT",37,0)
 ;
"RTN","PSOFDAUT",38,0)
 ; HOME device selected
"RTN","PSOFDAUT",39,0)
 I (IO=IO(0)) S SELPRT=""
"RTN","PSOFDAUT",40,0)
 ;
"RTN","PSOFDAUT",41,0)
 D ^%ZISC
"RTN","PSOFDAUT",42,0)
 ;
"RTN","PSOFDAUT",43,0)
 Q SELPRT
"RTN","PSOFDAUT",44,0)
 ;
"RTN","PSOFDAUT",45,0)
PRTLST(SITE,PRTLST) ; Returns the List of FDA Medication Guide Printer for the Division
"RTN","PSOFDAUT",46,0)
 ; Input:  (r) SITE   - Site IEN (#59)
"RTN","PSOFDAUT",47,0)
 ; Output:     PRTLST - Array containing list of FDA Med Guides Printers for the Division
"RTN","PSOFDAUT",48,0)
 N PRT,CNT
"RTN","PSOFDAUT",49,0)
 S CNT=0
"RTN","PSOFDAUT",50,0)
 F PRT=0:0 S PRT=$O(^PS(59,+$G(SITE),"FDA",PRT)) Q:'PRT  D
"RTN","PSOFDAUT",51,0)
 . S CNT=CNT+1
"RTN","PSOFDAUT",52,0)
 . S PRTLST(CNT)=$$GET1^DIQ(59.0135,PRT_","_+$G(SITE)_",",.01)_"^"_$$GET1^DIQ(59.0135,PRT_","_+$G(SITE)_",",.01)
"RTN","PSOFDAUT",53,0)
 . S:$$GET1^DIQ(59.0135,PRT_","_+$G(SITE)_",",.02,"I") PRTLST(CNT)=PRTLST(CNT)_" (Default)"
"RTN","PSOFDAUT",54,0)
 Q
"RTN","PSOFDAUT",55,0)
 ;
"RTN","PSOFDAUT",56,0)
DEFPRT(SITE) ; Returns the Default FDA Medication Guide Printer for the Division
"RTN","PSOFDAUT",57,0)
 ; Input:  (r) SITE   - Site IEN (#59)
"RTN","PSOFDAUT",58,0)
 ; Output:     DEFPRT - Device Name or blank (no Default)
"RTN","PSOFDAUT",59,0)
 N PRT,DEFPRT
"RTN","PSOFDAUT",60,0)
 S DEFPRT=""
"RTN","PSOFDAUT",61,0)
 F PRT=0:0 S PRT=$O(^PS(59,+$G(SITE),"FDA",PRT)) Q:'PRT  D
"RTN","PSOFDAUT",62,0)
 . I $P($G(^PS(59,+$G(SITE),"FDA",PRT,0)),"^",2) D
"RTN","PSOFDAUT",63,0)
 . . S PRTIEN=$$GET1^DIQ(59.0135,PRT_","_+$G(SITE)_",",.01,"I") I 'PRTIEN Q
"RTN","PSOFDAUT",64,0)
 . . I $$GET1^DIQ(3.5,PRTIEN,75)="" Q
"RTN","PSOFDAUT",65,0)
 . . S DEFPRT=$$GET1^DIQ(3.5,PRTIEN,.01)_"^"_$$GET1^DIQ(3.5,PRTIEN,75)
"RTN","PSOFDAUT",66,0)
 Q DEFPRT
"RTN","PSOFDAUT",67,0)
 ;
"RTN","PSOFDAUT",68,0)
FDAMGDOC(RXIEN) ; Lists all FDA Med Guides for a specific Rx & Return Selection
"RTN","PSOFDAUT",69,0)
 ; Input:  (r) RXIEN    - Prescription IEN (#52)
"RTN","PSOFDAUT",70,0)
 ; Output:     FDAMGDOC - FDA Med Guide PDF file name or blank, "^" (no selection)
"RTN","PSOFDAUT",71,0)
 ;
"RTN","PSOFDAUT",72,0)
ASK ; Prompt for FDA Medication Guide Selection
"RTN","PSOFDAUT",73,0)
 N MGLST,DIR,DIRUT,DUOUT,DTOUT
"RTN","PSOFDAUT",74,0)
 D FDAMGLST(RXIEN,1,.MGLST) D HELP W !
"RTN","PSOFDAUT",75,0)
 S DIR(0)="FO",DIR("A")="Select FDA Med Guide (1-"_$O(MGLST(999),-1)_")"
"RTN","PSOFDAUT",76,0)
 S (DIR("?"),DIR("??"))="^D HELP^PSOFDAUT" D ^DIR
"RTN","PSOFDAUT",77,0)
 I $D(DIRUT)!$D(DUOUT)!$D(DTOUT) Q "^"
"RTN","PSOFDAUT",78,0)
 I '$D(MGLST(X)) W ?40,"Invalid selection.",$C(7) G ASK
"RTN","PSOFDAUT",79,0)
 W "    ",$P(MGLST(X),"^",2)
"RTN","PSOFDAUT",80,0)
 Q $P(MGLST(X),"^",2)
"RTN","PSOFDAUT",81,0)
 ;
"RTN","PSOFDAUT",82,0)
HELP ; List FDA Med Guides and prompt for selection
"RTN","PSOFDAUT",83,0)
 N INDEX,XX
"RTN","PSOFDAUT",84,0)
 S XX="",$P(XX,"-",81)=""
"RTN","PSOFDAUT",85,0)
 W !,XX,!," # FL",?7,"FDA MED GUIDE FILE NAME",?64,"TYPE",?72,"DATE",!,XX
"RTN","PSOFDAUT",86,0)
 S INDEX=0 F  S INDEX=$O(MGLST(INDEX)) Q:'INDEX  D
"RTN","PSOFDAUT",87,0)
 . W:'$O(MGLST(INDEX)) !
"RTN","PSOFDAUT",88,0)
 . W !,$J(INDEX,2),?3,$J($P(MGLST(INDEX),"^"),2),?7,$P(MGLST(INDEX),"^",2)
"RTN","PSOFDAUT",89,0)
 . W ?64,$P(MGLST(INDEX),"^",3),?72,$P(MGLST(INDEX),"^",4)
"RTN","PSOFDAUT",90,0)
 Q
"RTN","PSOFDAUT",91,0)
 ;
"RTN","PSOFDAUT",92,0)
FDAMGLST(RXIEN,ADDLST,MGLST) ; Return a list of all FDA Med Guides for a specific Rx
"RTN","PSOFDAUT",93,0)
 ; Input:  (r) RXIEN  - Prescription IEN (#52)
"RTN","PSOFDAUT",94,0)
 ;         (o) ADDLST - Add Latest FDA Med Guide to the list? (Default: 0 (No))
"RTN","PSOFDAUT",95,0)
 ; Output:     MGLST  - Array containing list of FDA Med Guides for the Rx (By Reference)
"RTN","PSOFDAUT",96,0)
 N A,B,Z,LBL,CMP,FDAMG,RFL,DRGIEN,NDFIEN,FILL,INDEX,TMPLST,MGDATE
"RTN","PSOFDAUT",97,0)
 ;
"RTN","PSOFDAUT",98,0)
 K TMPLST
"RTN","PSOFDAUT",99,0)
 ; Window Fills
"RTN","PSOFDAUT",100,0)
 S LBL=0 F  S LBL=$O(^PSRX(RXIEN,"L",LBL)) Q:'LBL  D
"RTN","PSOFDAUT",101,0)
 . S FDAMG=$G(^PSRX(RXIEN,"L",LBL,"FDA")) I FDAMG="" Q
"RTN","PSOFDAUT",102,0)
 . S Z=$G(^PSRX(RXIEN,"L",LBL,0)) S FILL=+$P(Z,"^",2) I (FILL>20) S FILL="P"_(99-FILL)
"RTN","PSOFDAUT",103,0)
 . S MGDATE=$$GET1^DIQ(52.032,LBL_","_RXIEN_",",.01,"I")\1
"RTN","PSOFDAUT",104,0)
 . S TMPLST(MGDATE,FILL)=FILL_"^"_FDAMG_"^"_$S(FILL["P":"PARTIAL",1:"WINDOW")_"^"_$$FMTE^XLFDT(MGDATE,"2ZM")
"RTN","PSOFDAUT",105,0)
 ;
"RTN","PSOFDAUT",106,0)
 ; CMOP Fills
"RTN","PSOFDAUT",107,0)
 S CMP=0 F  S CMP=$O(^PSRX(RXIEN,4,CMP)) Q:'CMP  D
"RTN","PSOFDAUT",108,0)
 . S FDAMG=$G(^PSRX(RXIEN,4,CMP,"FDA")) I FDAMG="" Q
"RTN","PSOFDAUT",109,0)
 . S Z=$G(^PSRX(RXIEN,4,CMP,0)) Q:'+Z
"RTN","PSOFDAUT",110,0)
 . S MGDATE=$$GET1^DIQ(550.2,+Z,5,"I")\1
"RTN","PSOFDAUT",111,0)
 .  S TMPLST(MGDATE,+$P(Z,"^",3))=+$P(Z,"^",3)_"^"_FDAMG_"^CMOP^"_$$FMTE^XLFDT(MGDATE,"2ZM")
"RTN","PSOFDAUT",112,0)
 ;
"RTN","PSOFDAUT",113,0)
 ; - Moving from TMPLST to MGLST
"RTN","PSOFDAUT",114,0)
 K MGLST S INDEX=0,(A,B)=""
"RTN","PSOFDAUT",115,0)
 F  S A=$O(TMPLST(A)) Q:A=""  F  S B=$O(TMPLST(A,B)) Q:B=""  D
"RTN","PSOFDAUT",116,0)
 . S INDEX=INDEX+1,MGLST(INDEX)=TMPLST(A,B)
"RTN","PSOFDAUT",117,0)
 ;
"RTN","PSOFDAUT",118,0)
 ; - Adding 'LATEST' FDA Med Guide
"RTN","PSOFDAUT",119,0)
 I $G(ADDLST) D
"RTN","PSOFDAUT",120,0)
 . S DRGIEN=$$GET1^DIQ(52,RXIEN,6,"I"),NDFIEN=$$GET1^DIQ(50,DRGIEN,22,"I")
"RTN","PSOFDAUT",121,0)
 . I ($$FDAMG^PSNAPIS(NDFIEN)'="") D
"RTN","PSOFDAUT",122,0)
 . . S INDEX=INDEX+1,MGLST(INDEX)="^"_$$FDAMG^PSNAPIS(NDFIEN)_"^LATEST"
"RTN","PSOFDAUT",123,0)
 ;
"RTN","PSOFDAUT",124,0)
 Q
"RTN","PSOFDAUT",125,0)
 ;
"RTN","PSOFDAUT",126,0)
MGONFILE(RXIEN) ; Is there an FDA Med Guide on File for the Prescription
"RTN","PSOFDAUT",127,0)
 ; Input: (r) RXIEN   - Pointer to the PRESCRIPTION file (#52)
"RTN","PSOFDAUT",128,0)
 ;Output: 1^FDA Med Guide Document Name / 0 (no)
"RTN","PSOFDAUT",129,0)
 ;
"RTN","PSOFDAUT",130,0)
 N DRGIEN,NDFIEN,FDAMGFN
"RTN","PSOFDAUT",131,0)
 I '$D(^PSRX(RXIEN)) Q 0
"RTN","PSOFDAUT",132,0)
 S DRGIEN=$P($G(^PSRX(RXIEN,0)),"^",6)
"RTN","PSOFDAUT",133,0)
 I '$D(^PSDRUG(DRGIEN)) Q 0
"RTN","PSOFDAUT",134,0)
 S NDFIEN=+$P($G(^PSDRUG(DRGIEN,"ND")),"^",3) I 'NDFIEN Q 0
"RTN","PSOFDAUT",135,0)
 S FDAMGFN=$$FDAMG^PSNAPIS(NDFIEN) I FDAMGFN="" Q 0
"RTN","PSOFDAUT",136,0)
 Q ("1^"_FDAMGFN)
"RTN","PSOLBL")
0^26^B76752756^B76752756
"RTN","PSOLBL",1,0)
PSOLBL ;BIR/SAB/RTR - BOTTLE LABEL ;11/20/08 12:14pm
"RTN","PSOLBL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,19,30,36,47,71,92,120,157,244,206,225,303,266,326,251,387,379,367**;DEC 1997;Build 62
"RTN","PSOLBL",3,0)
 ;DBIAs PSDRUG-221, PS(55-2228, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097
"RTN","PSOLBL",4,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5425
"RTN","PSOLBL",5,0)
 ;External reference to ^DIC(5 supported by DBIA 4293
"RTN","PSOLBL",6,0)
 ;External reference to ^SC( supported by DBIA 2675
"RTN","PSOLBL",7,0)
 ;External reference to XTYPE^IBARX supported by DBIA 125
"RTN","PSOLBL",8,0)
 ;External reference to %ZIS(2 supported by DBIA 812
"RTN","PSOLBL",9,0)
 ;
"RTN","PSOLBL",10,0)
 ;*244 rem test for part fill when testing status > 11
"RTN","PSOLBL",11,0)
 ;
"RTN","PSOLBL",12,0)
DQ I $D(PSOIOS),PSOIOS]"" D DEVBAR^PSOBMST
"RTN","PSOLBL",13,0)
 I $G(PSOBAR0)]"",$G(PSOBAR1)]"",$D(^PS(59,PSOSITE,1)) S PSOBARS=1
"RTN","PSOLBL",14,0)
DQ1 D ^PSOLBL4
"RTN","PSOLBL",15,0)
 I $G(IOST(0)),$D(^%ZIS(2,IOST(0),55,"B","LL")) G ^PSOLLLI
"RTN","PSOLBL",16,0)
 G:'$D(PPL) HLEX G:($P($G(PSOPAR),"^",30)=2)&('$G(PSOEXREP)) HLEX K RXFLX S PSOCKHN=","_$G(PPL) S PSRESOLV=+PPL D CHECK F PI=1:1  D  S RX=$P(PPL,",",PI) D C Q:$G(PSOLAPPL)  D:$G(PSDFNFLG) TRAIL^PSOLBL2 K RXP,REPRINT
"RTN","PSOLBL",17,0)
 .S (PSDFNFLG,PSOLAPPL)=0 S NEXTRX=$P(PPL,",",(PI+1)) I NEXTRX=""!(NEXTRX=",") S PSOLAPPL=1 Q
"RTN","PSOLBL",18,0)
 .I PSOPDFN'=$P(^PSRX(NEXTRX,0),"^",2) S PSDFNFLG=1,PSOPDFN=$P(^PSRX(NEXTRX,0),"^",2) Q
"RTN","PSOLBL",19,0)
 I $P(^PS(59,PSOSITE,1),"^",28) D ^PSOLBLN2
"RTN","PSOLBL",20,0)
 D:'$P(^PS(59,PSOSITE,1),"^",28) ^PSOLBLS
"RTN","PSOLBL",21,0)
DQ5 I $D(^TMP($J,"PSOCP",DFN)),'$P(^PS(59,PSOSITE,1),"^",28) D INV^PSOCPE
"RTN","PSOLBL",22,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM
"RTN","PSOLBL",23,0)
 K ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ,A,LINE,DAYS,DATE,DRUG,EXPDT,II,LOT,MW,PI,PRTFL,PS55,PS55X,PSCAP,PSCLN,PSI,PSMP,PSOBARS,PSOBLRX,RXF,RXSTA,SIG,VRPH,PSOSCOPI
"RTN","PSOLBL",24,0)
 K ^TMP($J,"PSOCP",+$G(PSOCPN)),REF,PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA S:'$G(PSOSUREP)&('$G(PSOSUSPR)) ZTREQ="@" Q
"RTN","PSOLBL",25,0)
C I $G(IOST(0)),$D(^%ZIS(2,IOST(0),55,"B","LL")) G C^PSOLLLI
"RTN","PSOLBL",26,0)
 U IO S X=$S('$P(^PS(59,PSOSITE,1),"^",28):132,1:158) X ^%ZOSF("RM") Q:'$D(^PSRX(RX,0))
"RTN","PSOLBL",27,0)
 S:$G(PSOBLALL) PSOBLRX=RX K LINE
"RTN","PSOLBL",28,0)
 S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLBL",29,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 S:'$G(RXRP(RX)) RXRP(RX)=1 S:$G(PSOMGREP) RXRP(RX,"MG")=1
"RTN","PSOLBL",30,0)
 S RXY=^PSRX(RX,0),RXSTA=$P(^PSRX(RX,"STA"),"^") I RXSTA>11 D AL("QT") K RXY,RXP,REPRINT Q         ;*244
"RTN","PSOLBL",31,0)
 I RXSTA=3 D AL("QT") K RXY,RXP,REPRINT Q
"RTN","PSOLBL",32,0)
 I $G(RXPR(RX)),'$D(^PSRX(RX,"P",RXP,0)) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",33,0)
 I $P($G(RXFL(RX)),"^"),'$D(^PSRX(RX,1,$P($G(RXFL(RX)),"^"),0)) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",34,0)
 I $G(PSODBQ)!($G(RXRS(RX))) S RR=$O(^PS(52.5,"B",RX,0)) Q:'RR  I $G(^PS(52.5,RR,"P"))=1 K RXY,RXP,REPRINT Q
"RTN","PSOLBL",35,0)
 I $G(RXRS(RX))!($G(PSOPULL)) S PSOSXQ=0 N DR,DA,DIE D  I $G(PSOSXQ) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",36,0)
 .S DA=$O(^PS(52.5,"B",RX,0)) Q:'DA  S A=$P($G(^PS(52.5,DA,0)),"^",7) Q:A=""
"RTN","PSOLBL",37,0)
 .I A="Q" S DIE="^PS(52.5,",DR="3////P" D ^DIE Q
"RTN","PSOLBL",38,0)
 .K RXRS(RX) S PSOSXQ=1
"RTN","PSOLBL",39,0)
 I $G(PSRESOLV)=RX D ENLBL^PSOBSET K PSRESOLV
"RTN","PSOLBL",40,0)
 I RXSTA'=4 D:$G(PSOSUSPR) AREC^PSOSUTL D:$G(PSOPULL)!($G(RXRS(RX))) AREC1^PSOSUTL D:$G(PSOSUREP) AREC^PSOSUSRP D:$G(PSXREP) AREC^PSXSRP
"RTN","PSOLBL",41,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^") I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLBL",42,0)
 S RXN=$P(RXY,"^"),ISD=$P(RXY,"^",13),RXF=0,DFN=+$P(RXY,"^",2),SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLBL",43,0)
 S PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLBL",44,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0) S FDT=$P(^PSRX(RX,2),"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLBL",45,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLBL",46,0)
 S (EXPDT,EXDT)=$P(^PSRX(RX,2),"^",6),EXDT=$S('EXDT:"",1:$E(EXDT,4,5)_"/"_$E(EXDT,6,7)_"/"_($E(EXDT,1,3)+1700))
"RTN","PSOLBL",47,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLBL",48,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSOLBL",49,0)
 .S PSOCKHA=","_RX_","
"RTN","PSOLBL",50,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSOLBL",51,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSOLBL",52,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSOLBL",53,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSOLBL",54,0)
 I $O(^PSRX(RX,1,0)),$G(RXFL(RX))'=0 S $P(^PSRX(RX,3),"^",6)="" K ^PSRX(RX,"DAI"),^PSRX(RX,"DRI")
"RTN","PSOLBL",55,0)
 I '$G(RXP),'$O(^PSRX(RX,1,0)) S RXFL(RX)=0
"RTN","PSOLBL",56,0)
 I '$G(RXP) D OSET I '$O(^PSRX(RX,1,0))!($G(RXFL(RX))=0) G ORIG
"RTN","PSOLBL",57,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP),'$G(RXFL(RX)) S XTYPE=1 D REF G STA
"RTN","PSOLBL",58,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP),$G(RXFL(RX)) G STA
"RTN","PSOLBL",59,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSOLBL",60,0)
ORIG S TECH=$P($G(^VA(200,+$P(^PSRX(RX,0),"^",16),0)),"^"),QTY=$P(^PSRX(RX,0),"^",7),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT S SSNPN=""
"RTN","PSOLBL",61,0)
 S DAYS=$P(^PSRX(RX,0),"^",8),MFG="________",LOT="________"
"RTN","PSOLBL",62,0)
STA S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLBL",63,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLBL",64,0)
 S SIDE=$S($P($G(RXRP(RX)),"^",3):1,1:0)
"RTN","PSOLBL",65,0)
 I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLBL",66,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLBL",67,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLBL",68,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLBL",69,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBL",70,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLBL",71,0)
 .;PSO*7*266
"RTN","PSOLBL",72,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBL",73,0)
 I MW="W" S PSMP=$G(^PSRX(RX,"MP")) I PSMP]"" D
"RTN","PSOLBL",74,0)
 .N PSJ S PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLBL",75,0)
 .K PSMP(PSI)
"RTN","PSOLBL",76,0)
 S X=$S($D(^PS(55,DFN,0)):^(0),1:""),PSCAP=$P(X,"^",2),PS55=$P($G(X),"^",3),PS55X=$P($G(X),"^",5)
"RTN","PSOLBL",77,0)
 I (($G(PS55X)]"")&(PS55>1)&(PS55X<DT)) S PS55=0
"RTN","PSOLBL",78,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLBL",79,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLBL",80,0)
 I ($G(PSMP(1))']""&($G(PS55)=2)) S PSMP(1)=$G(SSNPN)
"RTN","PSOLBL",81,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLBL",82,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["W")!(DEA[1)!(DEA[2) PRTFL=0
"RTN","PSOLBL",83,0)
 S VRPH=$P(^PSRX(RX,2),"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$S($D(^SC(PSCLN,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLBL",84,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLBL",85,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S COPAYVAR="CHAMPUS" G LBL
"RTN","PSOLBL",86,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSOLBL",87,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) D SNO G LBL
"RTN","PSOLBL",88,0)
 I $P($G(^PSDRUG(+$G(PSOLBLDR),0)),"^",3)["I"!($P($G(^(0)),"^",3)["S")!($P($G(^(0)),"^",3)["N") D SNO G LBL
"RTN","PSOLBL",89,0)
 I $P(^PSRX(RX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSOLBL",90,0)
 I $G(PSOLBLCP)="" D IBCP
"RTN","PSOLBL",91,0)
 N PSOQI S PSOQI=$G(^PSRX(RX,"IBQ")) I $G(PSOLBLCP)=0 D SNO G LBL
"RTN","PSOLBL",92,0)
 I $G(PSOLBLCP)=1 I $P(PSOQI,"^",2)!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLBL",93,0)
 I $G(PSOLBLCP)=2 I $P(PSOQI,"^")!($P(PSOQI,"^",2))!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLBL",94,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") D SNO G LBL
"RTN","PSOLBL",95,0)
 S PSOCPN=$P(^PSRX(RX,0),"^",2),INRX=$P(^(0),"^") I $G(^TMP($J,"PSOCP",PSOCPN))="" S ^(PSOCPN)=PSOCPN
"RTN","PSOLBL",96,0)
 S ^TMP($J,"PSOCP",PSOCPN,INRX)=INRX_"^"_$$ZZ^PSOSUTL(RX)_"^"_+$G(DAYS) S COPAYVAR="COPAY" K ZDRUG
"RTN","PSOLBL",97,0)
LBL ;
"RTN","PSOLBL",98,0)
 S PSOSCOPI=$G(COPIES)
"RTN","PSOLBL",99,0)
 G ^PSOLBLD:$P(^PSRX(RX,"STA"),"^")=4!($$DS^PSSDSAPI&'$G(RXF)&'$G(RXP)&$G(^PS(52.4,RX,1)))  ;critical drug interaction status or dose warning and not a refill or partial - print warning label
"RTN","PSOLBL",100,0)
 D ^PSOLBLD:$D(^PSRX(RX,"DRI"))&('$G(RXF))&('$G(RXP)) S COPIES=PSOSCOPI ;print warning label for critical and significant interactions
"RTN","PSOLBL",101,0)
 D:$P($G(^PSRX(RX,3)),"^",6)&('$G(RXF))&('$G(RXP)) ^PSOLBLD1
"RTN","PSOLBL",102,0)
 G ^PSOLBL1:'$P(^PS(59,PSOSITE,1),"^",28)
"RTN","PSOLBL",103,0)
 I $$DS^PSSDSAPI,'$G(RXF),'$G(RXP) Q:$D(^PS(52.4,RX,1))  ;already printed warning label above, quit if dose warning and don't print bottle label
"RTN","PSOLBL",104,0)
 Q:(($P(^PSRX(RX,"STA"),"^")=4!($P($G(^PSRX(RX,"DRI")),"^",1)[1))&('$G(RXF))&('$G(RXP)))  ;if signficant warning (DRI node piece 1 contains only 2's) continue to print bottle label
"RTN","PSOLBL",105,0)
 S COPIES=PSOSCOPI S:'$G(COPIES) COPIES=1 G ^PSOLBLN
"RTN","PSOLBL",106,0)
REF F XXX=0:0 S XXX=$O(^PSRX(RX,XTYPE,XXX)) Q:+XXX'>0  D
"RTN","PSOLBL",107,0)
 .S TECH=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLBL",108,0)
 .S QTY=$P(^PSRX(RX,XTYPE,XXX,0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT S SSNPN=""
"RTN","PSOLBL",109,0)
 .S DAYS=$P(^PSRX(RX,XTYPE,XXX,0),"^",10),LOT="________",MFG="________"
"RTN","PSOLBL",110,0)
 Q
"RTN","PSOLBL",111,0)
CHECK S PSDFNFLG=0,PSOZERO=$P(PPL,","),PSOPDFN=$P(^PSRX(PSOZERO,0),"^",2)
"RTN","PSOLBL",112,0)
 Q
"RTN","PSOLBL",113,0)
OSET D OSET^PSOLBL1
"RTN","PSOLBL",114,0)
 Q
"RTN","PSOLBL",115,0)
DOUB Q:'$D(RXFL(RX))  I +$G(RXFL(RX))-PSOCKHNX<0 Q
"RTN","PSOLBL",116,0)
 S RXFLX(RX)=$G(RXFL(RX)),RXFL(RX)=$G(RXFL(RX))-PSOCKHNX
"RTN","PSOLBL",117,0)
 Q
"RTN","PSOLBL",118,0)
AL(T) N I,IR,RF,USR,TY,DES S USR=""
"RTN","PSOLBL",119,0)
 I T="UT" D
"RTN","PSOLBL",120,0)
 .N J,RX S USR=$G(DUZ),TY="B",DES="Label never queued to print by User"
"RTN","PSOLBL",121,0)
 .F J=1:1  S RX=+$P(PPL,",",J) Q:'RX  D AL1
"RTN","PSOLBL",122,0)
 I T="QT" D
"RTN","PSOLBL",123,0)
 .S I=+$P(^PSRX(RX,"STA"),"^"),TY=$S((I=3)!(I=16):"H",I=13:"D",1:"C")
"RTN","PSOLBL",124,0)
 .S DES=I_" "_$S((I=3)!(I=16):"HOLD"_$S(I=16:"(PROVIDER)",1:""),(I=12)!(I=14)!(I=15):"DISCONTINUED"_$S(I=14:"(PROVIDER)",I=15:"(EDIT)",1:""),I=13:"DELETED",1:"")
"RTN","PSOLBL",125,0)
 .S DES="Queued label terminated - "_DES D AL1
"RTN","PSOLBL",126,0)
 K %,%H,%I Q
"RTN","PSOLBL",127,0)
AL1 S (IR,I,RF)=0 F  S I=$O(^PSRX(RX,1,I)) Q:'I  S RF=I S:I>5 RF=I+1
"RTN","PSOLBL",128,0)
 S I=0 F  S I=$O(^PSRX(RX,"A",I)) Q:'I  S IR=I
"RTN","PSOLBL",129,0)
 S IR=IR+1,^PSRX(RX,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOLBL",130,0)
 D NOW^%DTC S ^PSRX(RX,"A",IR,0)=%_"^"_TY_"^"_USR_"^"_$S($G(RXPR(RX)):6,1:RF)_"^"_DES
"RTN","PSOLBL",131,0)
 Q
"RTN","PSOLBL",132,0)
IBCP N X,Y,PSOJJ,PSOLL
"RTN","PSOLBL",133,0)
 S PSOLBLCP="",X=$P($G(^PS(59,+$G(PSOSITE),"IB")),"^")_"^"_$G(DFN) D XTYPE^IBARX
"RTN","PSOLBL",134,0)
 S PSOJJ="" F  S PSOJJ=$O(Y(PSOJJ)) Q:'PSOJJ  S PSOLL="" F  S PSOLL=$O(Y(PSOJJ,PSOLL)) Q:PSOLL=""  S:PSOLL>0 PSOLBLCP=PSOLL
"RTN","PSOLBL",135,0)
 I '$G(PSOLBLCP) S PSOLBLCP=0
"RTN","PSOLBL",136,0)
 Q
"RTN","PSOLBL",137,0)
SNO S COPAYVAR="NO COPAY" Q
"RTN","PSOLBL1")
0^15^B31448686^B28929017
"RTN","PSOLBL1",1,0)
PSOLBL1 ;BHAM ISC/SAB - PRINTS LABEL ;1/20/93 14:25
"RTN","PSOLBL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**107,110,225,326,367**;DEC 1997;Build 62
"RTN","PSOLBL1",3,0)
START S COPIES=COPIES-1
"RTN","PSOLBL1",4,0)
 W $C(13) S $X=0 W "VA (119)",?10,$E(DT,4,5),"/",$E(DT,6,7),"/",$E(DT,2,3) W:('SIDE)&(PRTFL) ?40,"PLEASE REFER ONLY TO '",$S(REF:"1. REFILL REQUEST",1:"2. RENEWAL ORDER"),"'" W:+$G(RXP) ?100,"(PARTIAL)" W:$D(REPRINT) ?110,"(REPRINT)"
"RTN","PSOLBL1",5,0)
 W !,$P(PS,"^",2) W:('SIDE)&(PRTFL) ?40,"INSTRUCTION ON REVERSE SIDE OF THIS FORM" W:'SIDE ?102,"(Filled at ",$P(PS2,"^",2),")"
"RTN","PSOLBL1",6,0)
 W !,$P(PS,"^",7),", ",STATE,"  ",$P(PS,"^",5) W:'SIDE ?83,"*** ",$P(PS2,"^")," ***"
"RTN","PSOLBL1",7,0)
 W !,?22,$S(MW["C":"CERTIFIED MAIL",1:"") W:'SIDE ?38,SSNP,?69,"RX: ",RXN
"RTN","PSOLBL1",8,0)
 W !,?2,PNM W:'SIDE ?38,PNM,?64,"EXPIRES: ",EXDT W:('SIDE)&(PRTFL) ?83,"INDICATE ANY ADDRESS CHANGES"
"RTN","PSOLBL1",9,0)
 W !,?2,$S($D(PSMP(1)):PSMP(1),1:VAPA(1)) W:'SIDE ?38,$E(VAPA(1),1,25),?64,"REFILLS: ",REF ;W:('SIDE)&(PRTFL) ?83,LINE 
"RTN","PSOLBL1",10,0)
 W:('SIDE)&(PRTFL) ?83,"_____PERM.   _____TEMP." W:'PRTFL ?83,"* A 'NEW' RX IS REQUIRED.        *"
"RTN","PSOLBL1",11,0)
 S ADDR(3)=VAPA(4)_", "_$P($G(^DIC(5,+$P(VAPA(5),"^"),0)),"^",2)_"  "_VAPA(6),ADDR(2)="" S:VAPA(2)]"" ADDR(2)=VAPA(2)_" "_VAPA(3)
"RTN","PSOLBL1",12,0)
 I ADDR(2)="" S ADDR(2)=ADDR(3),ADDR(3)=""
"RTN","PSOLBL1",13,0)
 S ADDR(5)=$E(VAPA(4),1,13)_", "_$P($G(^DIC(5,+$P(VAPA(5),"^"),0)),"^",2)_"  "_VAPA(6)
"RTN","PSOLBL1",14,0)
 W !,?2,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$E(ADDR(2),1,35)) W:'SIDE ?38,$S($G(ADDR(3))="":ADDR(5),1:$E(ADDR(2),1,24)),?62,$S(RFLMSG]"":"*",1:" "),"LST FILL: "
"RTN","PSOLBL1",15,0)
 W:'SIDE $G(PSOLASTF)
"RTN","PSOLBL1",16,0)
 I 'SIDE W:PRTFL ?83,"ADDRESS: ",$E(LINE,1,23) W:'PRTFL ?83,"********** PLEASE NOTE ***********"
"RTN","PSOLBL1",17,0)
 W !,?2,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:ADDR(3)) I 'SIDE W ?38,$S(ADDR(3)'="":ADDR(5),1:""),?64,"ROUTING: ",$S(MW="REGULAR":"MAIL",1:MW) W:PRTFL ?83,"CITY/STATE/ZIP: ",$E(LINE,1,16) W:'PRTFL ?83,"* THIS RX CAN NOT BE 'RENEWED'.  *"
"RTN","PSOLBL1",18,0)
 ;NEW LABEL WHITE SPACE
"RTN","PSOLBL1",19,0)
 I +$G(PSOBARS),'SIDE,$P(PSOPAR,"^",19)'=1 S X="S",X2=PSOINST_"-"_RX W !,?40 S X1=$X W @PSOBAR1,X2,@PSOBAR0,$C(13),!,$S($G(PS55)=2:"***DO NOT MAIL***",1:"**CRITICAL MEDICAL SHIPMENT**")
"RTN","PSOLBL1",20,0)
 E  F NLWS=1:1:5 W ! W:NLWS=5 $S($G(PS55)=2:"***DO NOT MAIL***",1:"**CRITICAL MEDICAL SHIPMENT**")
"RTN","PSOLBL1",21,0)
 ; Printing FDA Medication Guide (if there's one)
"RTN","PSOLBL1",22,0)
 I $$MGONFILE^PSOFDAUT(RX) D
"RTN","PSOLBL1",23,0)
 . W ?83,"Read FDA Med Guide"
"RTN","PSOLBL1",24,0)
 . I $G(REPRINT),'$D(RXRP(RX,"MG")) Q 
"RTN","PSOLBL1",25,0)
 . N FDAMG S FDAMG=$$PRINTMG^PSOFDAMG(RX,$P($G(PSOFDAPT),"^",2))
"RTN","PSOLBL1",26,0)
 W !
"RTN","PSOLBL1",27,0)
 ;
"RTN","PSOLBL1",28,0)
 W !,?8,"VA Medical Center" I 'SIDE W ?38,INT(1)
"RTN","PSOLBL1",29,0)
 W !,$P(PS,"^"),"  ",$P(PS,"^",3),"-",$P(PS,"^",4) W:'SIDE ?38,INT(2) I 'SIDE W:PRTFL ?83 W:'PRTFL ?83,"* PLEASE CONTACT YOUR PHYSICIAN. *"
"RTN","PSOLBL1",30,0)
 W !,?4,RXN,?15,$E(DATE,4,5),"/",$E(DATE,6,7),"/",$E(DATE,2,3),"   (",RXF+1," OF ",1+$P(RXY,"^",9),")" I 'SIDE W ?38,INT(3) W:(PRTFL)&('REF) ?83,"***** FOR PHYSICIAN USE ONLY *****" W:'PRTFL ?83,"**********************************"
"RTN","PSOLBL1",31,0)
 W !,PNM,?29,"#",$P(RXY,"^",7)
"RTN","PSOLBL1",32,0)
 W:'SIDE ?38,"CAP: ",$S(PSCAP:"**NON-SFTY**",1:"SAFETY")," WARN:",WARN,?68,$E(DATE,4,5),"/",$E(DATE,6,7),"/",$E(DATE,2,3)," " S I1=$P($H,",",2)\60 W:'SIDE I1\60,":",(I1#60\10)_(I1#10) W:('SIDE)&(PRTFL) ?83,"SIGNATURE : ",$E(LINE,1,20)
"RTN","PSOLBL1",33,0)
SIG F DR=1:1:$S(SGC<5:4,1:6) D SIG1
"RTN","PSOLBL1",34,0)
 I SGC>4 F I=1:1:22 W ! I I>22-SGC S DR=DR+1,X=$S($D(SGY(DR)):SGY(DR),1:"") W X W:'SIDE ?38,X
"RTN","PSOLBL1",35,0)
 ;I SGC>4 F I=1:1:$S($P($G(PSOPAR),"^",10):22,1:16) W ! I I>($S($P($G(PSOPAR),"^",10):28,1:22)-SGC) S DR=DR+1,X=$S($D(SGY(DR)):SGY(DR),1:"") W X W:'SIDE ?38,X
"RTN","PSOLBL1",36,0)
 W !?3,$E(PHYS,1,14),?25,"(",$P(RXY,"^",16),"/",$S($D(VRPH):VRPH,1:" "),")" W:'SIDE ?38,DRUG,?38+$L(DRUG)," (QTY:",$P(RXY,"^",7)," DAYS:",$P(RXY,"^",8)," FILL: ",RXF+1," OF ",1+$P(RXY,"^",9)," ISD:",ISD,")"
"RTN","PSOLBL1",37,0)
 W !,DRUG W:'SIDE ?38,PHYS,?62,RFLMSG,?100,PATST,"  ",PSCLN
"RTN","PSOLBL1",38,0)
 I $D(PSOBARS),PSOBARS W $C(13),# S $X=0
"RTN","PSOLBL1",39,0)
 E  W !
"RTN","PSOLBL1",40,0)
 I COPIES>0 S SIDE=1 G START
"RTN","PSOLBL1",41,0)
 ;STORE LABEL PRINT NODE
"RTN","PSOLBL1",42,0)
 D NOW^%DTC S NOW=% K %,%H,%I S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOLBL1",43,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLBL1",44,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLBL1",45,0)
 S ^PSRX(RX,"L",IR,0)=NOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLBL1",46,0)
 ;Storing FDA Medication Guide filename in the Prescription file
"RTN","PSOLBL1",47,0)
 I $$MGONFILE^PSOFDAUT(RX) D
"RTN","PSOLBL1",48,0)
 . I $G(RXRP(RX)),'$G(RXRP(RX,"MG")) Q
"RTN","PSOLBL1",49,0)
 . S ^PSRX(RX,"L",IR,"FDA")=$P($$MGONFILE^PSOFDAUT(RX),"^",2)
"RTN","PSOLBL1",50,0)
 S ^PSRX(RX,"TYPE")=0 K RXF,IR,FDA,NOW,I
"RTN","PSOLBL1",51,0)
 I '$D(PSSPND),$P(PSOPAR,"^",18) D CHCK2^PSOTRLBL
"RTN","PSOLBL1",52,0)
END K PSCLN,%DT,ADDR,DATE,DEA,DR,DR1,DRX,DRUG,FDT,SGY,RXY,RXZ,RYY,RFLMSG,RFL,%H,COPIES,DOB,DRUG,LIM,LMI,LINE,PS,PS1,PS2,INT,ISD,I1,MW,MAIL,STATE,SIDE,SSNP,SS,ST,ST1,PATST,PRTFL,PHYS,PNM,S,SL,SGC,PSMP,PSI,PSJ,VRPH,REPRINT,PS55,PS55X Q
"RTN","PSOLBL1",53,0)
 Q
"RTN","PSOLBL1",54,0)
 ;
"RTN","PSOLBL1",55,0)
SIG1 S X=$S($D(SGY(DR)):SGY(DR),1:"") W !,X
"RTN","PSOLBL1",56,0)
 I 'SIDE W ?38,X I PRTFL W ?83 W:DR=1 ?83,$S('REF:"PRINT NAME: "_$E(LINE,1,25),1:"") W:DR=2 "DATE: ",$E(LINE,1,10) W:(DR=2)&('REF) " DEA# ",$E(LINE,1,6) W:(DR=3)&('REF) "Refills: 0 1 2 3 4 5 6 7 8 9 10 11"
"RTN","PSOLBL1",57,0)
 Q
"RTN","PSOLBL1",58,0)
 ;
"RTN","PSOLBL1",59,0)
OSET I $G(RXFL(RX))']""!($G(RXFL(RX))=0) D  Q
"RTN","PSOLBL1",60,0)
 .S TECH=$P($G(^VA(200,+$P(^PSRX(RX,0),"^",16),0)),"^"),QTY=$P(^PSRX(RX,0),"^",7),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT S SSNPN=""
"RTN","PSOLBL1",61,0)
 .S DAYS=$P(^PSRX(RX,0),"^",8),MFG="________",LOT="________"
"RTN","PSOLBL1",62,0)
 I '$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLBL1",63,0)
 S TECH=$S($D(^VA(200,+$P(^PSRX(RX,1,RXFL(RX),0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLBL1",64,0)
 S QTY=$P(^PSRX(RX,1,RXFL(RX),0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,1,RXFL(RX),0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT S SSNPN=""
"RTN","PSOLBL1",65,0)
 S DAYS=$P(^PSRX(RX,1,RXFL(RX),0),"^",10),LOT="________",MFG="________"
"RTN","PSOLBL1",66,0)
 Q
"RTN","PSOLBL2")
0^28^B36346864^B34647042
"RTN","PSOLBL2",1,0)
PSOLBL2 ;BIR/SAB-LABEL OUTPUT CONT. ;11/18/92 19:15
"RTN","PSOLBL2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**16,19,30,71,92,117,135,326,367**;DEC 1997;Build 62
"RTN","PSOLBL2",3,0)
 ;External reference to ^PS(51 supported by DBIA 2224
"RTN","PSOLBL2",4,0)
 ;External reference to ^PS(54 supported by DBIA 2227
"RTN","PSOLBL2",5,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLBL2",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOLBL2",7,0)
 ;External reference to ^DPT supported by DBIA 3097
"RTN","PSOLBL2",8,0)
 ;External reference to GMRADPT supported by DBIA 10099
"RTN","PSOLBL2",9,0)
 I $P($G(^PSRX(RX,"SIG")),"^",2) K SGY D ^PSOLBL3 G SIGOLD
"RTN","PSOLBL2",10,0)
 D SIG
"RTN","PSOLBL2",11,0)
QUIT K SIG,E,F,S Q
"RTN","PSOLBL2",12,0)
SIG K OT S SGY="" F P=1:1:$L(SIG," ") S X=$P(SIG," ",P) D:X]""
"RTN","PSOLBL2",13,0)
 .I $D(^PS(51,"A",X)) D
"RTN","PSOLBL2",14,0)
 ..I $P($G(^PS(55,DFN,"LAN")),"^") S OT=$O(^PS(51,"B",X,0)) I OT,$P($G(^PS(51,OT,4)),"^")]"" S X=$P(^PS(51,OT,4),"^") K OT Q
"RTN","PSOLBL2",15,0)
 ..S %=^PS(51,"A",X),X=$P(%,"^") I $P(%,"^",2)]"" S Y=$P(SIG," ",P-1),Y=$E(Y,$L(Y)) S:Y>1 X=$P(%,"^",2)
"RTN","PSOLBL2",16,0)
 .S SGY=SGY_X_" "
"RTN","PSOLBL2",17,0)
 S X="",SGC=1 F J=1:1 S Z=$P(SGY," ",J) S:Z="" SGY(SGC)=X Q:Z=""  S:$L(X)+$L(Z)'<$S($P(PSOPAR,"^",28):46,1:34) SGY(SGC)=X,SGC=SGC+1,X="" S X=X_Z_" "
"RTN","PSOLBL2",18,0)
SIGOLD I '$P(PSOPAR,"^",28) D  K NHC
"RTN","PSOLBL2",19,0)
 .K DIC,DR,DIQ,NHC S DIC=2,DA=DFN,DR=148,DIQ="NHC",DIQ(0)="I"
"RTN","PSOLBL2",20,0)
 .D EN^DIQ1 K DIC,DR,DIQ
"RTN","PSOLBL2",21,0)
 .I NHC(2,DFN,148,"I")="Y"!($P($G(^PS(55,DFN,40)),"^")) S SGC=SGC+1,SGY(SGC)="Expiration:________ Mfg:_________"
"RTN","PSOLBL2",22,0)
 ;
"RTN","PSOLBL2",23,0)
DPT S X=$S($D(^DPT(DFN,0))#2:^(0),1:""),DOB=$P(X,"^",3),L=$E(X,1)
"RTN","PSOLBL2",24,0)
 S Y=$P(X,"^",9),PNM=$P(X,"^") D PID^VADPT S SS="",SSNP=""
"RTN","PSOLBL2",25,0)
 I $P(PSOPAR,"^",28) K SIG,E,F,S Q
"RTN","PSOLBL2",26,0)
GMRA X "N X S X=""GMRADPT"" X ^%ZOSF(""TEST"") Q" I '$T S (INT(1),INT(2),INT(3))="" Q
"RTN","PSOLBL2",27,0)
 S GMRA="0^1^111" D ^GMRADPT S I1=1,INT(1)="ALLERGIES: ",(INT(2),INT(3))="" F I=0:0 S I=$O(GMRAL(I)) Q:I'>0  S AL=$P(GMRAL(I),U,2) S:$L(INT(I1))+$L(AL)>42 I1=I1+1,INT(I1)="" S INT(I1)=INT(I1)_AL_", "
"RTN","PSOLBL2",28,0)
 ;K GMRA,GMRAL Q
"RTN","PSOLBL2",29,0)
 Q
"RTN","PSOLBL2",30,0)
SIGPH S SIGPH=SIG,X="",SGCPH=1 F J=1:1:100 S Z=$P(SIGPH," ",J) S:Z="" SIGPH(SGCPH)=X S:$L(X)+$L(Z)'<34 SIGPH(SGCPH)=X,SGCPH=SGCPH+1,X="" S X=X_Z_" "
"RTN","PSOLBL2",31,0)
 Q
"RTN","PSOLBL2",32,0)
WARN W:'$G(PSOBLALL) @IOF W ?54,PNM,!,?54,"Rx# ",RXN,!,?54,DRUG,!,?54,"DRUG WARNING:" S DIWL=55,DIWR=100,DIWF="W" F WW=1:1 Q:$P(WARN,",",WW,99)=""  S PSOWARN=$P(WARN,",",WW) D:$D(^PS(54,PSOWARN,0))
"RTN","PSOLBL2",33,0)
 .K ^UTILITY($J,"W") F AA=0:0 S AA=$O(^PS(54,PSOWARN,1,AA)) Q:'AA  S X=^(AA,0) D ^DIWP D ^DIWW
"RTN","PSOLBL2",34,0)
 K WW,PSOWARN,AA W:$G(PSOBLALL) @IOF Q
"RTN","PSOLBL2",35,0)
REP ;LEFT SIDE ONLY REPRINT FOR NEW LABEL STOCK
"RTN","PSOLBL2",36,0)
 K PSOSTLK,ZTKDRUG I $L($T(PSOSTALK^PSOTALK1)) D PSOSTALK^PSOTALK1 S PSOSTLK=1 ; PRINT SCRIPTALK LABEL IF APPLICABLE
"RTN","PSOLBL2",37,0)
 S ZTKDRUG="XXXXXX   SCRIPTALK RX   XXXXXX"
"RTN","PSOLBL2",38,0)
 S Y=DATE X ^DD("DD") S DATE=Y S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLBL2",39,0)
 S PSZIP=$P(PS,"^",5) S PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLBL2",40,0)
 W "VAMC ",$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP),?102,"(REPRINT)" W:$G(RXP) "(PARTIAL)" W !,$P(PS2,"^",2),"  ",$P(PS,"^",3),"-",$P(PS,"^",4),"   ",TECH
"RTN","PSOLBL2",41,0)
 W !,"Rx# ",RXN,"  ",DATE,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9),!,PNM
"RTN","PSOLBL2",42,0)
 F DR=1:1 Q:$G(SGY(DR))=""  D:DR=4!(DR=7)!(DR=10)!(DR=13)  W !,$G(SGY(DR))
"RTN","PSOLBL2",43,0)
 .F GG=1:1:27 W !
"RTN","PSOLBL2",44,0)
 I DR>4 S KK=$S(DR=5!(DR=8)!(DR=11):2,(DR=6)!(DR=9)!(DR=12):1,1:0) I KK F HH=1:1:KK W !
"RTN","PSOLBL2",45,0)
 I DR=2 W !!
"RTN","PSOLBL2",46,0)
 I DR=3 W !
"RTN","PSOLBL2",47,0)
 W ! S PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8) W $G(PHYS),!,"Qty: "_$G(QTY),"  ",$G(PSDU),$S($G(PSDU)="":"      ",1:" "),$S($G(NURSE):"Mfg______Exp______",1:"")
"RTN","PSOLBL2",48,0)
 I $G(PSOSTLK) W !,$S($G(PSOTALK)&('$G(PSOTREP)):ZTKDRUG,1:DRUG)
"RTN","PSOLBL2",49,0)
 I '$G(PSOSTLK) W !,DRUG
"RTN","PSOLBL2",50,0)
 K PSDU W !!,$P(PS,"^",2),!,$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP),!!!!,"FORWARDING SERVICE REQUESTED",!
"RTN","PSOLBL2",51,0)
 I "C"[$E(MW) W ?21,"CERTIFIED MAIL",!
"RTN","PSOLBL2",52,0)
 E  W !
"RTN","PSOLBL2",53,0)
 W !,$S($G(PS55)=2:"***DO NOT MAIL***",1:"***CRITICAL MEDICAL SHIPMENT***")
"RTN","PSOLBL2",54,0)
 ;
"RTN","PSOLBL2",55,0)
 ; Printing FDA Medication Guide (if there's one)
"RTN","PSOLBL2",56,0)
 I $$MGONFILE^PSOFDAUT(+$G(RX)) D
"RTN","PSOLBL2",57,0)
 . W ?83,"Read FDA Med Guide"
"RTN","PSOLBL2",58,0)
 . I $G(REPRINT),'$D(RXRP(RX,"MG")) Q 
"RTN","PSOLBL2",59,0)
 . N FDAMG S FDAMG=$$PRINTMG^PSOFDAMG(RX,$P($G(PSOFDAPT),"^",2))
"RTN","PSOLBL2",60,0)
 ;
"RTN","PSOLBL2",61,0)
 W !!!,PNM,!,$S($D(PSMP(1)):PSMP(1),1:VAPA(1)),!,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$G(ADDR(2))),!,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:$G(ADDR(3))),!,$S($D(PSMP(4)):PSMP(4),$D(PSMP(1)):"",1:$G(ADDR(4)))
"RTN","PSOLBL2",62,0)
 W @IOF Q
"RTN","PSOLBL2",63,0)
MUL ;
"RTN","PSOLBL2",64,0)
 I $G(PSOBARS),$P($G(PSOPAR),"^",19) W:J=1 !!! W:J=2 !
"RTN","PSOLBL2",65,0)
 E  W:J=1 !!!!!!!!! W:J=2 !!!!!!!! W:J=3 !!!!!! W:J=4 !!!! W:J=5 !!
"RTN","PSOLBL2",66,0)
 W !,"Use the label above to mail the computer",!,"copies back to us. Apply enough postage",!,"to your envelope to ensure delivery."
"RTN","PSOLBL2",67,0)
 Q
"RTN","PSOLBL2",68,0)
MULT W !,"Use the label above to mail the computer",?54,"(",PSLN,")",!,"copies back to us. Apply enough postage",?60,"PATIENT'S SIGNATURE   "_$E(DT,4,5),"/",$E(DT,6,7),"/",($E(DT,1,3)+1700),!,"to your envelope to ensure delivery."
"RTN","PSOLBL2",69,0)
 Q
"RTN","PSOLBL2",70,0)
PRINT S (PSONOPR,PSOWSTOP,PSOASTOP)=0 F CCC=1:1 Q:$G(PSONOPR)  D
"RTN","PSOLBL2",71,0)
 .W ?54,$G(^TMP($J,"PSOWPT",CCC)) S:'$O(^(CCC)) PSOWSTOP=1
"RTN","PSOLBL2",72,0)
 .W ?102,$G(^TMP($J,"PSOAPT",CCC)),! S:'$O(^(CCC)) PSOASTOP=1
"RTN","PSOLBL2",73,0)
 .I PSOWSTOP,PSOASTOP S PSONOPR=1
"RTN","PSOLBL2",74,0)
 K ^TMP($J,"PSOWARN"),^TMP($J,"ALWA"),^TMP($J,"PSOWPT"),^TMP($J,"PSOAPT"),PSONKA,PSONULL,WWW,GMRA,GMRAL,PSOWARN,JJJ,WCNT,RRR,ALG,ALCNT,EEE,FFF,PSOLG,PSOLGA,PSORY,CCC,PSONOPR,PSOWSTOP,PSOASTOP W @IOF
"RTN","PSOLBL2",75,0)
 Q
"RTN","PSOLBL2",76,0)
KILL K PSCLN,DATE,DR,RXY,RFLMSG,COPIES,DRUG,LMI,LINE,INT,ISD,I1,MW,STATE,SIDE,SGY,PATST,PRTFL,PHYS,SGC,VRPH,NLWS,Y,TECH,LFLDT,EXPDT,COPAYVAR,NURSE,X,X1,X2,PSCAP,LOT,DIFF,DAYS,ZZ,GG,HH,KK,ULN,PSZIP,PSOHZIP,PSOPROV,PSMP,REPRINT,PS55,PS55X
"RTN","PSOLBL2",77,0)
 K PSOLBLDR,PSOLBLPS,OSIG,OSGY
"RTN","PSOLBL2",78,0)
 Q
"RTN","PSOLBL2",79,0)
TRAIL I $P(^PS(59,PSOSITE,1),"^",28) D ^PSOLBLN2
"RTN","PSOLBL2",80,0)
 D:'$P(^PS(59,PSOSITE,1),"^",28) ^PSOLBLS I $D(^TMP($J,"PSOCP",DFN)),'$P(^PS(59,PSOSITE,1),"^",28) D INV^PSOCPE
"RTN","PSOLBL2",81,0)
 K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,TECH,COPAYVAR,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PARST,PDA,PS,PS1,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,PNM,ADDR,PSODBQ,PSOLASTF
"RTN","PSOLBL2",82,0)
 K ^TMP($J,"PSOCP",+$G(PSOCPN)),PSDFNFLG,PSOLAPPL
"RTN","PSOLBL2",83,0)
 I '$G(PSOBLALL) K PSOCPN,PSOLBLCP
"RTN","PSOLBL2",84,0)
 Q
"RTN","PSOLBLN")
0^16^B63565356^B62602237
"RTN","PSOLBLN",1,0)
PSOLBLN ;BIR/RTR - NEW PRINTS LABEL ;11/18/92
"RTN","PSOLBLN",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**16,36,71,107,110,117,135,233,251,387,379,367**;DEC 1997;Build 62
"RTN","PSOLBLN",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLBLN",4,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOLBLN",5,0)
 ;External reference to ^VA(200 supported by DBIA 224
"RTN","PSOLBLN",6,0)
 ;External reference to ^SC( supported by DBIA 254
"RTN","PSOLBLN",7,0)
 K PSOSTLK,ZTKDRUG I $L($T(PSOSTALK^PSOTALK1)) D PSOSTALK^PSOTALK1 S PSOSTLK=1 ; PRINT SCRIPTALK LABEL IF APPLICABLE
"RTN","PSOLBLN",8,0)
 I $G(IOS),$G(PSOBARS) I $G(PSOBAR0)=""!($G(PSOBAR1)="") S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOLBLN",9,0)
 I $G(DFN) D ADD^VADPT
"RTN","PSOLBLN",10,0)
 I '$G(COPIES) S COPIES=""
"RTN","PSOLBLN",11,0)
 S ADDR(33)=$G(VAPA(4))_", "_$P($G(VAPA(5)),"^",2)_"  "_$S($G(VAPA(11))]"":$P($G(VAPA(11)),"^",2),1:$G(VAPA(6))),ADDR(22)=""
"RTN","PSOLBLN",12,0)
 S:$G(VAPA(2))]"" ADDR(22)=$G(VAPA(2))_" "_$G(VAPA(3)),ADDR(22)=$E(ADDR(22),1,46) S:ADDR(22)="" ADDR(22)=ADDR(33),ADDR(33)=""
"RTN","PSOLBLN",13,0)
 S ADDR(4)=$S(ADDR(33)="":ADDR(22),1:ADDR(33)) I $G(VAPA(2))="",$G(VAPA(3))="" S ADDR(2)=ADDR(4),ADDR(3)="",ADDR(4)="" G ST
"RTN","PSOLBLN",14,0)
 I $G(VAPA(2))'="",$G(VAPA(3))="" S ADDR(2)=VAPA(2),ADDR(3)=ADDR(4),ADDR(4)="" G ST
"RTN","PSOLBLN",15,0)
 I $G(VAPA(2))="",$G(VAPA(3))'="" S ADDR(2)=VAPA(3),ADDR(3)=ADDR(4),ADDR(4)="" G ST
"RTN","PSOLBLN",16,0)
 S ADDR(2)=$G(VAPA(2)),ADDR(3)=$G(VAPA(3))
"RTN","PSOLBLN",17,0)
ST I $P($G(^PSRX(RX,3)),"^",3) S PSOPROV=+$P(^(0),"^",4) S PSOPROV=$S($G(RXP):+$P($G(RXP),"^",17),$G(RXF):+$P($G(^PSRX(RX,1,RXF,0)),"^",17),1:PSOPROV) S:'$G(PSOPROV) PSOPROV=+$P(^PSRX(RX,0),"^",4) D
"RTN","PSOLBLN",18,0)
 .I +$P($G(^VA(200,PSOPROV,"PS")),"^",7) S:'$P($G(PHYS),"/",2) PHYS=$G(PHYS)_"/"_+$P($G(^PSRX(RX,3)),"^",3)
"RTN","PSOLBLN",19,0)
 ;
"RTN","PSOLBLN",20,0)
 S:$G(PSOBLALL) PSOBLRX=RX
"RTN","PSOLBLN",21,0)
 S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLBLN",22,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 S:'$G(RXRP(RX)) RXRP(RX)=1
"RTN","PSOLBLN",23,0)
 S RXY=^PSRX(RX,0),RXSTA=$P(^PSRX(RX,"STA"),"^")
"RTN","PSOLBLN",24,0)
 S RXN=$P(RXY,"^"),ISD=$P(RXY,"^",13),RXF=0,DFN=+$P(RXY,"^",2),SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLBLN",25,0)
 S PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLBLN",26,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0) S FDT=$P(^PSRX(RX,2),"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLBLN",27,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLBLN",28,0)
 S (EXPDT,EXDT)=$P(^PSRX(RX,2),"^",6),EXDT=$S('EXDT:"",1:$E(EXDT,4,5)_"/"_$E(EXDT,6,7)_"/"_($E(EXDT,1,3)+1700))
"RTN","PSOLBLN",29,0)
 S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLBLN",30,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLBLN",31,0)
  I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLBLN",32,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLBLN",33,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLBLN",34,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLBLN",35,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBLN",36,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLBLN",37,0)
 .;PSO*7*266
"RTN","PSOLBLN",38,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBLN",39,0)
 I MW="W" S PSMP=$G(^PSRX(RX,"MP")) I PSMP]"" D
"RTN","PSOLBLN",40,0)
 .N PSJ S PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLBLN",41,0)
 .K PSMP(PSI)
"RTN","PSOLBLN",42,0)
 S X=$S($D(^PS(55,DFN,0)):^(0),1:""),PSCAP=$P(X,"^",2),PS55=$P($G(X),"^",3),PS55X=$P($G(X),"^",5)
"RTN","PSOLBLN",43,0)
 I (($G(PS55X)]"")&(PS55>1)&(PS55X<DT)) S PS55=0
"RTN","PSOLBLN",44,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLBLN",45,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLBLN",46,0)
 I ($G(PSMP(1))']""&($G(PS55)=2)) S PSMP(1)=$G(SSNPN)
"RTN","PSOLBLN",47,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLBLN",48,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["W")!(DEA[1)!(DEA[2) PRTFL=0
"RTN","PSOLBLN",49,0)
 S VRPH=$P(^PSRX(RX,2),"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$S($D(^SC(PSCLN,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLBLN",50,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLBLN",51,0)
 ;
"RTN","PSOLBLN",52,0)
 S COPIES=COPIES-1,$P(ULN,"_",34)="",PSOTRAIL=1 I $G(SIDE) D REP^PSOLBL2 G REP
"RTN","PSOLBLN",53,0)
 S (Y,X1)=EXPDT X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y,X2=DT D ^%DTC S DIFF=X
"RTN","PSOLBLN",54,0)
 S Y=DATE X ^DD("DD") S DATE=Y D NOW^%DTC S Y=% X ^DD("DD") S NOW=Y
"RTN","PSOLBLN",55,0)
 S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLBLN",56,0)
 S PSZIP=$P(PS,"^",5) S PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLBLN",57,0)
L1 W ?3,"VAMC ",$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP),?54,"VAMC ",$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP),?102 W $S($D(REPRINT)&($G(PSOBLALL)):"(GROUP REPRINT)",$D(REPRINT):"(REPRINT)",1:"") W:$G(RXP) "(PARTIAL)"
"RTN","PSOLBLN",58,0)
 W !?3,$P(PS2,"^",2),"  ",$P(PS,"^",3),"-",$P(PS,"^",4),"   ",TECH,?54,$P(PS2,"^",2),"  ",$P(PS,"^",3),"-",$P(PS,"^",4),"   ",TECH,?102,$P(PS2,"^",2)," ",TECH," ",NOW
"RTN","PSOLBLN",59,0)
 W !,"Rx# ",RXN,"  ",DATE,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9),?54,"Rx# ",RXN,"  ",DATE,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9),?102,"Rx# ",RXN,"  ",DATE,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9)
"RTN","PSOLBLN",60,0)
 W !,PNM,"  ",$G(SSNPN),?54,PNM,"  ",$G(SSNPN),?102,PNM,"  ",$G(SSNPN)
"RTN","PSOLBLN",61,0)
 F DR=1:1 Q:$G(SGY(DR))=""  D:DR=4!(DR=7)!(DR=10)!(DR=13)  W !,$G(SGY(DR)),?54,$G(SGY(DR)),?102,$S($G(OSGY(DR))]"":OSGY(DR),1:$G(SGY(DR)))
"RTN","PSOLBLN",62,0)
 .F GG=1:1:27 W !
"RTN","PSOLBLN",63,0)
 I DR>4 S KK=$S(DR=5!(DR=8)!(DR=11):2,(DR=6)!(DR=9)!(DR=12):1,1:0) I KK F HH=1:1:KK W !
"RTN","PSOLBLN",64,0)
 I DR=2 W !!
"RTN","PSOLBLN",65,0)
 I DR=3 W !
"RTN","PSOLBLN",66,0)
 W !,$G(PHYS),?54,$G(PHYS),?102,$G(PHYS)
"RTN","PSOLBLN",67,0)
 S PSMF=$S($G(NURSE):"Mfg______Exp______",1:""),PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8),PSDU=$S(PSDU="":"      "_PSMF,1:PSDU_" "_PSMF)
"RTN","PSOLBLN",68,0)
 W !,"Qty: "_$G(QTY),"  ",$G(PSDU),?54,"Qty: "_$G(QTY),"  ",$G(PSDU),?102,"Qty: "_$G(QTY),"  ",$G(PSDU)
"RTN","PSOLBLN",69,0)
 S ZTKDRUG="XXXXXX   SCRIPTALK RX   XXXXXX"
"RTN","PSOLBLN",70,0)
 I '$G(PSOSTLK) K PSDU,PSMF W !,DRUG,?54,DRUG,?102,DRUG
"RTN","PSOLBLN",71,0)
 I $G(PSOSTLK) K PSDU,PSMF W !,$S($G(PSOSTALK):ZTKDRUG,1:DRUG),?54,DRUG,?102,DRUG
"RTN","PSOLBLN",72,0)
 I $P(RXY,"^",9)-RXF'>0 D ^PSOLBLN1 G L13
"RTN","PSOLBLN",73,0)
 G:DIFF<30 L11
"RTN","PSOLBLN",74,0)
 W !?54,$P(RXY,"^",9)-RXF," Refills remain prior to ",EXPDT,?102,"Mfg "_$G(MFG)_" Lot# "_$G(LOT) G L12
"RTN","PSOLBLN",75,0)
L11 W !?54,"Last fill prior to ",$G(EXPDT),?102,"Mfg "_$G(MFG)_" Lot# "_$G(LOT)
"RTN","PSOLBLN",76,0)
L12 W !,$P(PS,"^",2),?54,$S($L($G(COPAYVAR)):$G(COPAYVAR)_"     ",1:""),"Days Supply: ",$G(DAYS),?102,"Tech__________RPh_________",!,$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP)
"RTN","PSOLBLN",77,0)
 ;send a CR for OPTIFIL (P-MT661BC)
"RTN","PSOLBLN",78,0)
 I $G(PSOBARS),$P(PSOPAR,"^",19)'=1 S X="S",X2=PSOINST_"-"_RX S X1=$X W ?54,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0 W:IOST["P-MT661BC" !
"RTN","PSOLBLN",79,0)
 E  W !!!
"RTN","PSOLBLN",80,0)
 W !,"FORWARDING SERVICE REQUESTED"
"RTN","PSOLBLN",81,0)
 ;
"RTN","PSOLBLN",82,0)
 ; Printing FDA Medication Guide (if there's one)
"RTN","PSOLBLN",83,0)
 I $$MGONFILE^PSOFDAUT(RX) D
"RTN","PSOLBLN",84,0)
 . W ?102,"Read FDA Med Guide"
"RTN","PSOLBLN",85,0)
 . I $G(REPRINT),'$D(RXRP(RX,"MG")) Q 
"RTN","PSOLBLN",86,0)
 . N FDAMG S FDAMG=$$PRINTMG^PSOFDAMG(RX,$P($G(PSOFDAPT),"^",2))
"RTN","PSOLBLN",87,0)
 ;
"RTN","PSOLBLN",88,0)
 W:"C"[$E(MW) !,?21,"CERTIFIED MAIL" W !?54,$G(VAPA(1))
"RTN","PSOLBLN",89,0)
 W !,$S($G(PS55)=2:"***DO NOT MAIL***",1:"***CRITICAL MEDICAL SHIPMENT***"),?54,$G(ADDR(2)),?102,"Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL")
"RTN","PSOLBLN",90,0)
 W !?54,$G(ADDR(3)),?102,"Days supply: ",$G(DAYS)," Cap: ",$S(PSCAP:"**NON-SFTY**",1:"SAFETY")
"RTN","PSOLBLN",91,0)
 W !?54,$G(ADDR(4)),?102,"Isd: ",ISD," Exp: ",EXPDT
"RTN","PSOLBLN",92,0)
 W !,PNM,?54,"*Indicate address change on back of this form",?102,"Last Fill: ",$G(PSOLASTF)
"RTN","PSOLBLN",93,0)
 W !,$S($D(PSMP(1)):PSMP(1),1:$G(VAPA(1))),?54,"[ ] Permanent",?102,"Pat. Stat ",PATST," Clinic: ",PSCLN
"RTN","PSOLBLN",94,0)
 W !,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$G(ADDR(2))),?54,"[ ] Temporary until ",$S($P($G(VAPA(10)),"^",2)]"":$P($G(VAPA(10)),"^",2),1:"__/__/__"),?102,$S($G(WARN)'="":"DRUG WARNING "_$G(WARN),1:"")
"RTN","PSOLBLN",95,0)
 W !,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:$G(ADDR(3))),!,$S($D(PSMP(4)):PSMP(4),$D(PSMP(1)):"",1:$G(ADDR(4))),?54,"Signature",ULN
"RTN","PSOLBLN",96,0)
 I $G(PSOBARS) S X="S",X2=PSOINST_"-"_RX S X1=$X W ?102,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN",97,0)
L13 I $G(WARN)'="",'$G(PSOBLALL) I '$G(PSDFNFLG),'$G(PSOLAPPL) D WARN^PSOLBL2
"RTN","PSOLBLN",98,0)
 W @IOF
"RTN","PSOLBLN",99,0)
REP I COPIES>0 S SIDE=1 G ST
"RTN","PSOLBLN",100,0)
 D NOW^%DTC S NOW=% K %,%H,%I I $G(RXF)="" S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOLBLN",101,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLBLN",102,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLBLN",103,0)
 S ^PSRX(RX,"L",IR,0)=NOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),$G(PCOMH(RX))]"":PCOMH(RX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLBLN",104,0)
 N PSOBADR,PSOTEMP
"RTN","PSOLBLN",105,0)
 S PSOBADR=$$CHKRX^PSOBAI(RX)
"RTN","PSOLBLN",106,0)
 I $G(PSOBADR) S PSOTEMP=$P(PSOBADR,"^",2),PSOBADR=$P(PSOBADR,"^")
"RTN","PSOLBLN",107,0)
 I $G(PSOBADR),'$G(PSOTEMP) D
"RTN","PSOLBLN",108,0)
 .S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLBLN",109,0)
 .S ^PSRX(RX,"L",IR,0)=NOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_"ROUTING="_$G(MW)_" (BAD ADDRESS)"_"^"_PDUZ
"RTN","PSOLBLN",110,0)
 ;Storing FDA Medication Guide filename in the Prescription file
"RTN","PSOLBLN",111,0)
 I $$MGONFILE^PSOFDAUT(RX) D
"RTN","PSOLBLN",112,0)
 . I $G(RXRP(RX)),'$G(RXRP(RX,"MG")) Q
"RTN","PSOLBLN",113,0)
 . S ^PSRX(RX,"L",IR,"FDA")=$P($$MGONFILE^PSOFDAUT(RX),"^",2)
"RTN","PSOLBLN",114,0)
 S ^PSRX(RX,"TYPE")=0 K RXF,IR,FDA,NOW,I,PCOMH(RX)
"RTN","PSOLBLN",115,0)
 I $G(WARN)'="" I $G(PSDFNFLG)!($G(PSOLAPPL)) D ALLWARN^PSOLBLN1
"RTN","PSOLBLN",116,0)
 I $G(WARN)="" I $G(PSDFNFLG)!($G(PSOLAPPL)) D ALL^PSOLBLS
"RTN","PSOLBLN",117,0)
 I $G(PSOBLALL) D:$G(WARN)="" ALL^PSOLBLS D:$G(WARN)'="" ALLWARN^PSOLBLN1
"RTN","PSOLBLN",118,0)
 I '$D(PSSPND),$P(PSOPAR,"^",18) I $G(PSDFNFLG)!($G(PSOLAPPL))!($G(PSOBLALL)) D CHCK2^PSOTRLBL
"RTN","PSOLBLN",119,0)
 D:$G(PSOBLALL) TRAIL^PSOLBL2
"RTN","PSOLBLN",120,0)
END ;
"RTN","PSOLBLN",121,0)
 I $D(RXFLX(RX)) S RXFL(RX)=$G(RXFLX(RX)) K RXFLX
"RTN","PSOLBLN",122,0)
 D KILL^PSOLBL2 Q
"RTN","PSOLBLN1")
0^29^B41952754^B39273947
"RTN","PSOLBLN1",1,0)
PSOLBLN1 ;BIR/BHW - NEW LABEL CONTINUED ;03/14/94
"RTN","PSOLBLN1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**5,30,71,107,110,162,367**;DEC 1997;Build 62
"RTN","PSOLBLN1",3,0)
 ;External reference to ^PS(54 supported by DBIA 2227
"RTN","PSOLBLN1",4,0)
START W !,?54,$S($L($G(COPAYVAR)):$G(COPAYVAR)_"     ",1:""),"Days Supply: ",$G(DAYS),?102,"Mfg "_$G(MFG)_" Lot# "_$G(LOT)
"RTN","PSOLBLN1",5,0)
 I 'PRTFL G NORENW
"RTN","PSOLBLN1",6,0)
 ;NO REFILLS
"RTN","PSOLBLN1",7,0)
 W !,$P(PS,"^",2),?102,"Tech__________RPh__________"
"RTN","PSOLBLN1",8,0)
 W !,$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP)
"RTN","PSOLBLN1",9,0)
 I $G(PSOBARS),$P(PSOPAR,"^",19)'=1 S X="S",X2=PSOINST_"-"_RX S X1=$X W ?54,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN1",10,0)
 E  W !!!!
"RTN","PSOLBLN1",11,0)
 W "FORWARDING SERVICE REQUESTED",?54,"* NO REFILLS REMAINING ** PHYSICIAN USE ONLY *"
"RTN","PSOLBLN1",12,0)
 ;
"RTN","PSOLBLN1",13,0)
  ; Printing FDA Medication Guide (if there's one)
"RTN","PSOLBLN1",14,0)
 I $$MGONFILE^PSOFDAUT(RX) D
"RTN","PSOLBLN1",15,0)
 . W ?102,"Read FDA Med Guide"
"RTN","PSOLBLN1",16,0)
 . I $G(REPRINT),'$D(RXRP(RX,"MG")) Q 
"RTN","PSOLBLN1",17,0)
 . N FDAMG S FDAMG=$$PRINTMG^PSOFDAMG(RX,$P($G(PSOFDAPT),"^",2))
"RTN","PSOLBLN1",18,0)
 ;
"RTN","PSOLBLN1",19,0)
 W ! W:"C"[$E(MW) ?21,"CERTIFIED MAIL" W ?54,"*Signature:____________________________SC NSC*"
"RTN","PSOLBLN1",20,0)
 W !,?54,"*Print Name:",ULN,"*",! W $S($G(PS55)=2:"***DO NOT MAIL***",1:"***CRITICAL MEDICAL SHIPMENT***") W ?54,"*DEA or VA#_________________Date_____________*",?102,"Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL")
"RTN","PSOLBLN1",21,0)
 W !,?54,"*Refills: 0 1 2 3 4 5 6 7 8 9 10 11",?99,"*",?102,"Days Supply: ",$G(DAYS)," Cap: ",$S(PSCAP:"**NON-SFTY**",1:"SAFETY")
"RTN","PSOLBLN1",22,0)
 W !,?54,"***** To be filled in VA Pharmacies only *****",?102,"Isd: ",ISD," Exp: ",EXPDT,!,PNM,?54,$G(VAPA(1)),?102,"Last Fill: ",$G(PSOLASTF)
"RTN","PSOLBLN1",23,0)
 W !,$S($D(PSMP(1)):PSMP(1),1:VAPA(1)),?54,$G(ADDR(2)),?102,"Pat. Stat ",PATST," Clinic: ",PSCLN
"RTN","PSOLBLN1",24,0)
 W !,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$G(ADDR(2))),?54,$G(ADDR(3)),?102,$S($G(WARN)'="":"DRUG WARNING "_$G(WARN),1:"")
"RTN","PSOLBLN1",25,0)
 W !,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:$G(ADDR(3))),?54,$G(ADDR(4))
"RTN","PSOLBLN1",26,0)
 W !,$S($D(PSMP(4)):PSMP(4),$D(PSMP(1)):"",1:$G(ADDR(4))),?54,"*Indicate address change on back of this form",!,?54,"[ ] Permanent [ ] Temporary until ",$S($P($G(VAPA(10)),"^",2)]"":$P($G(VAPA(10)),"^",2),1:"__/__/__")
"RTN","PSOLBLN1",27,0)
 I $G(PSOBARS) S X="S",X2=PSOINST_"-"_RX S X1=$X W ?102,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN1",28,0)
 Q
"RTN","PSOLBLN1",29,0)
NORENW ;NO RENEW
"RTN","PSOLBLN1",30,0)
 W !,$P(PS,"^",2),?102,"Tech__________RPH__________"
"RTN","PSOLBLN1",31,0)
 W !,$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP)
"RTN","PSOLBLN1",32,0)
 I $G(PSOBARS),$P(PSOPAR,"^",19)'=1 S X="S",X2=PSOINST_"-"_RX S X1=$X W ?54,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN1",33,0)
 E  W !!!!
"RTN","PSOLBLN1",34,0)
 W "FORWARDING SERVICE REQUESTED",?54,"*** This prescription CANNOT be renewed ***",! W:"C"[$E(MW) ?21,"CERTIFIED MAIL" W ?54,"*",?96,"*",!,?54,"*     A NEW PRESCRIPTION IS REQUIRED      *"
"RTN","PSOLBLN1",35,0)
 W !,$S($G(PS55)=2:"***DO NOT MAIL***",1:"***CRITICAL MEDICAL SHIPMENT***"),?54,"*",?96,"*",!,?54,"***** Please contact your physician *******"
"RTN","PSOLBLN1",36,0)
 W !,?54,$G(VAPA(1)),?102,"Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL"),!,?54,$G(ADDR(2)),?102,"Days supply: ",$G(DAYS)," Cap: ",$S(PSCAP:"**NON-SFTY**",1:"SAFETY")
"RTN","PSOLBLN1",37,0)
 W !,PNM,?54,$G(ADDR(3)),?102,"Isd: ",ISD," Exp: ",EXPDT
"RTN","PSOLBLN1",38,0)
 W !,$S($D(PSMP(1)):PSMP(1),1:VAPA(1)),?54,$G(ADDR(4)),?102,"Last Fill: ",$G(PSOLASTF)
"RTN","PSOLBLN1",39,0)
 W !,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$G(ADDR(2))),?54,"*Indicate address change on back of this form",?102,"Pat. Stat ",PATST," Clinic: ",PSCLN
"RTN","PSOLBLN1",40,0)
 W !,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:$G(ADDR(3))),?54,"[ ] Permanent [ ] Temporary until ",$S($P($G(VAPA(10)),"^",2)]"":$P($G(VAPA(10)),"^",2),1:"__/__/__"),?102,$S($G(WARN)'="":"DRUG WARNING "_$G(WARN),1:"")
"RTN","PSOLBLN1",41,0)
 W !,$S($D(PSMP(4)):PSMP(4),$D(PSMP(1)):"",1:$G(ADDR(4))) I $G(PSOBARS) S X="S",X2=PSOINST_"-"_RX S X1=$X W ?102,@PSOBAR1,X2,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN1",42,0)
 Q
"RTN","PSOLBLN1",43,0)
ALLWARN ;ALLERGIES WITH DRUG WARNING
"RTN","PSOLBLN1",44,0)
 I $G(PSOBLALL),$P(PPL,",",PI+1)'="" D WARN^PSOLBL2 Q
"RTN","PSOLBLN1",45,0)
 K ^TMP($J,"PSOWARN"),^TMP($J,"PSOWPT"),^TMP($J,"PSOAPT"),PSONKA,PSONULL
"RTN","PSOLBLN1",46,0)
 X "N X S X=""GMRADPT"" X ^%ZOSF(""TEST"") Q" I '$T D WARN^PSOLBL2 Q
"RTN","PSOLBLN1",47,0)
 F WWW=1:1 Q:$P(WARN,",",WWW,99)=""  S PSOWARN=$P(WARN,",",WWW) D:$D(^PS(54,PSOWARN,0))
"RTN","PSOLBLN1",48,0)
 . ;BHW;Modify Loop to use $O instead of 1:1
"RTN","PSOLBLN1",49,0)
 . S JJJ=0
"RTN","PSOLBLN1",50,0)
 . F  S JJJ=$O(^PS(54,PSOWARN,1,JJJ)) Q:('JJJ)  D
"RTN","PSOLBLN1",51,0)
 . . I $D(^PS(54,PSOWARN,1,JJJ,0)) S ^TMP($J,"PSOWARN",PSOWARN,JJJ)=^PS(54,PSOWARN,1,JJJ,0)
"RTN","PSOLBLN1",52,0)
 . . Q
"RTN","PSOLBLN1",53,0)
 . Q
"RTN","PSOLBLN1",54,0)
 S ^TMP($J,"PSOWPT",1)=PNM,^(2)="Rx# "_RXN,^(3)=DRUG,^(4)="DRUG WARNING:"
"RTN","PSOLBLN1",55,0)
 S WCNT=4 F WWW=0:0 S WWW=$O(^TMP($J,"PSOWARN",WWW)) Q:'WWW  F RRR=0:0 S RRR=$O(^TMP($J,"PSOWARN",WWW,RRR)) Q:'RRR  S WCNT=WCNT+1 S ^TMP($J,"PSOWPT",WCNT)=^TMP($J,"PSOWARN",WWW,RRR)
"RTN","PSOLBLN1",56,0)
 K ^TMP($J,"ALWA")
"RTN","PSOLBLN1",57,0)
 S GMRA="0^0^111" D ^GMRADPT I $G(GMRAL) F PSORY=0:0 S PSORY=$O(GMRAL(PSORY)) Q:'PSORY  S ^TMP($J,"ALWA",$S($P(GMRAL(PSORY),"^",4):1,1:2),$S('$P(GMRAL(PSORY),"^",5):1,1:2),$P(GMRAL(PSORY),"^",7),$P(GMRAL(PSORY),"^",2))=""
"RTN","PSOLBLN1",58,0)
 S ^TMP($J,"PSOAPT",1)=$G(PNM)_"  "_$G(SSNP),^(2)="",^(3)="Verified Allergies",^(4)="------------------"
"RTN","PSOLBLN1",59,0)
 S ALCNT=4,EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"ALWA",1,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"ALWA",1,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_PSOLGA
"RTN","PSOLBLN1",60,0)
 I EEE S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",61,0)
 I 'EEE D
"RTN","PSOLBLN1",62,0)
 .I $G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_"NKA",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",63,0)
 .E  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",64,0)
 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="Non-Verified Allergies",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="----------------------"
"RTN","PSOLBLN1",65,0)
 S EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"ALWA",2,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"ALWA",2,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=EEE+1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_PSOLGA
"RTN","PSOLBLN1",66,0)
 I EEE S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",67,0)
 I 'EEE D
"RTN","PSOLBLN1",68,0)
 .I $G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_"NKA",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",69,0)
 .E  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)=""
"RTN","PSOLBLN1",70,0)
 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="Verified Adverse Reactions",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="--------------------------"
"RTN","PSOLBLN1",71,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"ALWA",1,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"ALWA",1,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_PSOLGA
"RTN","PSOLBLN1",72,0)
 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="Non-Verified Adverse Reactions",ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="------------------------------"
"RTN","PSOLBLN1",73,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"ALWA",2,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"ALWA",2,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",ALCNT)="  "_PSOLGA
"RTN","PSOLBLN1",74,0)
PRT D PRINT^PSOLBL2
"RTN","PSOLBLN1",75,0)
 Q
"RTN","PSOLLL1")
0^24^B72361773^B70535351
"RTN","PSOLLL1",1,0)
PSOLLL1 ;BIR/BHW - LASER LABELS ;10/24/2002
"RTN","PSOLLL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,141,135,162,161,233,200,264,326,338,367**;DEC 1997;Build 62
"RTN","PSOLLL1",3,0)
 ;
"RTN","PSOLLL1",4,0)
 ;Reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLLL1",5,0)
 ;Reference ^VA(200,D0,"PS" supported by DBIA 224
"RTN","PSOLLL1",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOLLL1",7,0)
 ;
"RTN","PSOLLL1",8,0)
ST I $P($G(^PSRX(RX,3)),"^",3) S PSOPROV=+$P(^(0),"^",4),PSOPROV=$S($G(RXP):+$P($G(RXP),"^",17),$G(RXF):+$P($G(^PSRX(RX,1,RXF,0)),"^",17),1:PSOPROV) S:'$G(PSOPROV) PSOPROV=+$P(^PSRX(RX,0),"^",4) D
"RTN","PSOLLL1",9,0)
 . I +$P($G(^VA(200,PSOPROV,"PS")),"^",7) S:'$P($G(PHYS),"/",2) PHYS=$G(PHYS)_"/"_+$P($G(^PSRX(RX,3)),"^",3)
"RTN","PSOLLL1",10,0)
 S $P(ULN,"_",34)="",PSOTRAIL=1
"RTN","PSOLLL1",11,0)
 S (Y,X1)=EXPDT X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y,X2=DT D ^%DTC S DIFF=X
"RTN","PSOLLL1",12,0)
 S Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSOLLL1",13,0)
 S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLLL1",14,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",15,0)
L1 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSOLLL1",16,0)
 I 'SIGF,'SIGM,'PMIM K PSOSTLK,ZTKDRUG I $L($T(PSOSTALK^PSOTALK1)) D PSOSTALK^PSOTALK1 D  S PSOSTLK=1 ; PRINT ONE SCRIPTALK LABEL IF APPLICABLE
"RTN","PSOLLL1",17,0)
 .D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLL1",18,0)
 S T="VAMC "_$P(PS,"^",7)_", "_STATE_" "_$G(PSOHZIP) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",19,0)
 S T=$P(PS2,"^",2)_"  "_TECH_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",20,0)
 S PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8)
"RTN","PSOLLL1",21,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSOLLL1",22,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",23,0)
 S T="Rx# "_RXN_"  " S:SIGF!($G(FILLCONT)) T=" " D PRINT(T,1)
"RTN","PSOLLL1",24,0)
 D STRT^PSOLLU1("RX#",T,.L) S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX
"RTN","PSOLLL1",25,0)
 S DR=$G(SIGF("DR"))
"RTN","PSOLLL1",26,0)
 S T="  "_DATE_"  "_$S('SIGF:"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),1:"(label continued)") S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",27,0)
 S PSOX=OPSOX,T=PNM S:SIGF!($G(FILLCONT)) T=" " I T'=" " D PRINT(T,1)
"RTN","PSOLLL1",28,0)
 I DR>1 S PSOX=OPSOX,T="Rx# "_RXN_"  (label continued)" D PRINT(T)
"RTN","PSOLLL1",29,0)
 D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",30,0)
 S OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX,PSOY=PSOY-PSOYI,T="  "_$G(SSNPN) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",31,0)
 S PSOX=OPSOX,LENGTH=0,PTEXT="",SIGF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",32,0)
 N DP,TEXTP,TEXTL,MORE
"RTN","PSOLLL1",33,0)
 I 'SIGM,'$G(FILLCONT) D COUNTSG^PSOLLLW
"RTN","PSOLLL1",34,0)
 S DR=SIGF("DR")
"RTN","PSOLLL1",35,0)
 I DR>1,'$D(NSGY(DR,4)) D
"RTN","PSOLLL1",36,0)
 .F I=4:-1:1 Q:$D(NSGY(DR,I))  S T=" " D PRINT(T) ; BOTTOM-JUSTIFY CONTINUED BOTTLE SIG JUST ABOVE 'DISCARD' LINE
"RTN","PSOLLL1",37,0)
 F I=1:1 Q:'$D(NSGY(DR,I))  S TEXT=NSGY(DR,I) D PRINT(TEXT)
"RTN","PSOLLL1",38,0)
 I I>4,$D(NSGY(DR,5)) S SIGF=1,SIGF("DR")=DR+1
"RTN","PSOLLL1",39,0)
 I $G(PSOIO("BLF"))]"" X PSOIO("BLF")
"RTN","PSOLLL1",40,0)
 S PSOY=PSODY-PSOYI,PSOFONT=PSODFONT
"RTN","PSOLLL1",41,0)
 I SIGF G WARN:'SIGM&('$G(FILLCONT)),CONT
"RTN","PSOLLL1",42,0)
 I '$D(NSGY) G CONT
"RTN","PSOLLL1",43,0)
 K NSGY,^TMP($J,"PSOSIG",RX)
"RTN","PSOLLL1",44,0)
 D NOW^%DTC S X1=X,X2=365 D C^%DTC S Y=X X ^DD("DD")
"RTN","PSOLLL1",45,0)
 S DEA=$P($G(^PSDRUG($P(RXY,"^",6),0)),"^",3),T=""
"RTN","PSOLLL1",46,0)
 I DEA'["S" S T="Discard after "_$S(DEA[0!(DEA["M"):"_________",1:Y)_"__________   "
"RTN","PSOLLL1",47,0)
 S T=T_"Mfr_________" D PRINT(T)
"RTN","PSOLLL1",48,0)
 S PSOY=PSOY-5
"RTN","PSOLLL1",49,0)
 D  S PSOFONT="F8"  D PRINT(T)
"RTN","PSOLLL1",50,0)
 . S NOR=$P(RXY,"^",9)-RXF
"RTN","PSOLLL1",51,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL" Q
"RTN","PSOLLL1",52,0)
 . I NOR=0 S T="NO REFILLS LEFT" Q
"RTN","PSOLLL1",53,0)
 . S T="May refill "_NOR_"X by "_EXPDT
"RTN","PSOLLL1",54,0)
 S PPHYS=$G(PHYS)
"RTN","PSOLLL1",55,0)
 S XFONT=$E(PSOQFONT,2,99)
"RTN","PSOLLL1",56,0)
 S TEXT="Qty: " D STRT^PSOLLU1("SIG",TEXT,.L) S Q(1)=L(XFONT)
"RTN","PSOLLL1",57,0)
 S TEXT=" "_PSDU D STRT^PSOLLU1("SIG",TEXT,.L) S Q(2)=L(XFONT)
"RTN","PSOLLL1",58,0)
 S TEXT="       "_$G(PHYS) D STRT^PSOLLU1("SIG",TEXT,.L) S Q(3)=L(XFONT)
"RTN","PSOLLL1",59,0)
 S TEXT=$G(QTY) D STRT^PSOLLU1("SIG",TEXT,.L) S LENGTH=Q(1)+Q(2)+Q(3)+L(XFONT+2),Q(4)=L(XFONT+2)
"RTN","PSOLLL1",60,0)
 I LENGTH>3 F I=$L(PHYS)-1:-1:1 S PPHYS=$E(PHYS,1,I),TEXT="       "_PPHYS D STRT^PSOLLU1("SIG",TEXT,.L) I Q(1)+Q(2)+Q(4)+L(XFONT)<3.3 Q 
"RTN","PSOLLL1",61,0)
 S PSOFONT=PSOTFONT,OPSOX=PSOX,PSOX=PSOX+(Q(1)*300),PSOY=PSOQY-PSOYI,T=$G(QTY) D PRINT(T)
"RTN","PSOLLL1",62,0)
 S PSOX=OPSOX,PSOFONT=PSOQFONT,PSOY=PSOY-PSOYI,T="Qty: " D PRINT(T)
"RTN","PSOLLL1",63,0)
 S PSOX=PSOX+(Q(1)+Q(4)*300),PSOY=PSOY-PSOYI,T=" "_$G(PSDU)_"       "_$G(PPHYS) D PRINT(T)
"RTN","PSOLLL1",64,0)
 S PSOFONT=PSOTFONT,PSOX=OPSOX,PSOY=PSOTY-PSOYI,T=DRUG D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",65,0)
 I L($E(PSOFONT,2,99))>3 S PSOFONT=$S(PSOFONT="F12":"F10",PSOFONT="F10":"F9",PSOFONT="F9":F8,PSOFONT="F8":"F6")
"RTN","PSOLLL1",66,0)
 S ZTKDRUG="XXXXXX   SCRIPTALK RX   XXXXXX"
"RTN","PSOLLL1",67,0)
 I $G(PSOSTLK) S T=$S($G(PSOSTALK):ZTKDRUG,1:DRUG)
"RTN","PSOLLL1",68,0)
 D PRINT(T,1)
"RTN","PSOLLL1",69,0)
 I SIGM G CONT
"RTN","PSOLLL1",70,0)
 S ^PSRX(RX,"TYPE")=0
"RTN","PSOLLL1",71,0)
WARN ;PRINT WARNING LABELS
"RTN","PSOLLL1",72,0)
 I $G(PSOIO("WLI"))]"" X PSOIO("WLI")
"RTN","PSOLLL1",73,0)
 ; IF <5 WARNINGS, PRINT LABELS BOTTOM-JUSTIFIED
"RTN","PSOLLL1",74,0)
 K PSOWLBL
"RTN","PSOLLL1",75,0)
 S PSOLAN=$P($G(^PS(55,DFN,"LAN")),"^",2)
"RTN","PSOLLL1",76,0)
 S WARN5=WARN F  Q:$L(WARN5,",")>4  S WARN5=" ,"_WARN5
"RTN","PSOLLL1",77,0)
 F WWW=1:1:5 S PSOWARN=$P(WARN5,",",WWW) I PSOWARN'="" D
"RTN","PSOLLL1",78,0)
 . I PSOWARN["N" D NEWWARN^PSOLLLW Q
"RTN","PSOLLL1",79,0)
 . D WARN54^PSOLLLW
"RTN","PSOLLL1",80,0)
 ;RETURN MAIL
"RTN","PSOLLL1",81,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"") I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLL1",82,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",83,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",84,0)
 I $G(PSOIO("RMI"))]"" X PSOIO("RMI")
"RTN","PSOLLL1",85,0)
 S PSOYI=$G(PSOHYI,40),OFONT=PSOFONT,PSOFONT=$G(PSOHFONT)
"RTN","PSOLLL1",86,0)
 S BLNKLIN="",$P(BLNKLIN," ",40)=" "
"RTN","PSOLLL1",87,0)
 S T="Attn: (119)"_BLNKLIN_$$FMTE^XLFDT(DT) D PRINT(T,0)
"RTN","PSOLLL1",88,0)
 S T=$G(VASTREET) D PRINT(T,0)
"RTN","PSOLLL1",89,0)
 S T=$P(PS,"^",7)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(T,0)
"RTN","PSOLLL1",90,0)
 S PSOY=PSOY+PSOYI,T=$S(PS55=2:"***DO NOT MAIL***",1:"") I T'="" D PRINT(T,0)
"RTN","PSOLLL1",91,0)
 I T'="***DO NOT MAIL***" S T=$S(PS55[0!(PS55[3)!(PS55=""):"REGULAR MAIL",1:"CERTIFIED MAIL") S T=T_"-"_$G(MAILCOM) S:$L(T)>25 PSOFONT="F8" D PRINT(T,0)
"RTN","PSOLLL1",92,0)
 S PSOFONT=OFONT
"RTN","PSOLLL1",93,0)
 S T=PNM
"RTN","PSOLLL1",94,0)
 S PSOY=PSOY+PSOYI,PSOYI=PSORYI D PRINT(T,0)
"RTN","PSOLLL1",95,0)
 I $G(VAPA(1))=""!(PS55=2) G W
"RTN","PSOLLL1",96,0)
 ; ADD CHECK FOR BAD ADDRESS INDICATOR OR FOREIGN ADDRESS
"RTN","PSOLLL1",97,0)
 N PSOBADR,PSOTEMP,PSOFORGN,I
"RTN","PSOLLL1",98,0)
 S PSOBADR=0,PSOTEMP=0
"RTN","PSOLLL1",99,0)
 S PSOFORGN=$P($G(VAPA(25)),"^",2) I PSOFORGN'="",PSOFORGN'["UNITED STATES" S PSOFORGN=1
"RTN","PSOLLL1",100,0)
 I 'PSOFORGN S PSOBADR=$$BADADR^DGUTL3(DFN)
"RTN","PSOLLL1",101,0)
 I 'PSOFORGN,PSOBADR S PSOTEMP=$$CHKTEMP^PSOBAI(DFN)
"RTN","PSOLLL1",102,0)
 F I=1:1:3 I $G(VAPA(I))]"" D
"RTN","PSOLLL1",103,0)
 . S T="" I I=1,'PSOFORGN,PSOBADR,'$G(PSOTEMP) S T="** BAD ADDRESS INDICATED **"
"RTN","PSOLLL1",104,0)
 . I I=1,T="",PSOFORGN S T="*** FOREIGN ADDRESS ***"
"RTN","PSOLLL1",105,0)
 . I T="" I 'PSOFORGN I 'PSOBADR!$G(PSOTEMP) S T=$G(VAPA(I))
"RTN","PSOLLL1",106,0)
 . D STRT^PSOLLU1("ML",T,.L) I L($E(PSOFONT,2,99))<2.37 D PRINT(T,0) Q
"RTN","PSOLLL1",107,0)
 . F F=12,10,9,8,6 I L(F)<2.37 S OFONT=PSOFONT,PSOFONT="F"_F D PRINT(T,0) S PSOFONT=OFONT Q
"RTN","PSOLLL1",108,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",109,0)
 S T="" I 'PSOFORGN I 'PSOBADR!$G(PSOTEMP) S T=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSOLLL1",110,0)
 D PRINT(T,0)
"RTN","PSOLLL1",111,0)
W ;
"RTN","PSOLLL1",112,0)
 S T=$S(MW="WINDOW":"WINDOW -",1:"MAIL -")
"RTN","PSOLLL1",113,0)
 N XFONT
"RTN","PSOLLL1",114,0)
 S OFONT=PSOFONT,PSOYI=$G(PSOTYI,40),PSOFONT=PSOTFONT,XFONT=$E(PSOFONT,2,99),PSOY=PSOTY
"RTN","PSOLLL1",115,0)
 I T["WINDOW" D
"RTN","PSOLLL1",116,0)
 . I $G(^PSRX(RX,"MP"))'="" S PSOY=PSOY-PSOYI ; START 1 LINE HIGHER IF METHOD OF PICK-UP
"RTN","PSOLLL1",117,0)
 . S OPSOX=PSOX D PRINT(T,1) S PSOX=PSOX+200,PSOY=PSOY-PSOYI
"RTN","PSOLLL1",118,0)
 . S T=$G(^PSRX(RX,"MP")) I T="" S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSOLLL1",119,0)
 . N FIRST
"RTN","PSOLLL1",120,0)
 . S FIRST=1
"RTN","PSOLLL1",121,0)
 . D STRT^PSOLLU1("ML",T,.L)
"RTN","PSOLLL1",122,0)
 . I L(XFONT)<1.75 D PRINT(T,0) S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSOLLL1",123,0)
 . F F=10,9,8,6 I L(F)<4.5 Q
"RTN","PSOLLL1",124,0)
 . S XFONT=F,PSOFONT="F"_F,PSOYI=$S(PSOFONT="F12":40,PSOFONT="F10":35,PSOFONT="F9":30,PSOFONT="F8":25,1:20)
"RTN","PSOLLL1",125,0)
 . F J=$L(T," "):-1:1 S PTEXT=$P(T," ",1,J) D STRT^PSOLLU1("ML",PTEXT,.L) D  Q:T=""
"RTN","PSOLLL1",126,0)
 .. I FIRST I L(XFONT)<1.75 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT="",FIRST=0,PSOX=OPSOX,PSOY=PSOY+20 Q
"RTN","PSOLLL1",127,0)
 .. I 'FIRST I L(XFONT)<2.3 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT=""
"RTN","PSOLLL1",128,0)
 . D:PTEXT]"" PRINT(PTEXT,0)
"RTN","PSOLLL1",129,0)
 I T="MAIL -" D PRINT(T,1)
"RTN","PSOLLL1",130,0)
 S PSOFONT=OFONT
"RTN","PSOLLL1",131,0)
CONT I $G(SIDE) G BARC:'L5,CONT2
"RTN","PSOLLL1",132,0)
 I $G(COPIES)>1 G BARC
"RTN","PSOLLL1",133,0)
 I 'L2!PFM D ^PSOLLL2 S L2=1
"RTN","PSOLLL1",134,0)
 I 'L3 D ^PSOLLL3 S L3=1
"RTN","PSOLLL1",135,0)
 I 'L4!PMIM S PIMI=0 D ^PSOLLL4 S L4=1
"RTN","PSOLLL1",136,0)
 I L5 W @IOF G CONT2
"RTN","PSOLLL1",137,0)
BARC I $G(BOTTLBL) G BARCE ; ONLY PRINT BARCODE ON 1ST BOTTLE LABEL
"RTN","PSOLLL1",138,0)
 S BOTTLBL=1
"RTN","PSOLLL1",139,0)
 I $G(PSOIO("BLBC"))]"" X PSOIO("BLBC") I $G(NOBARC) G BARCE
"RTN","PSOLLL1",140,0)
 S X2=PSOINST_"-"_RX W X2
"RTN","PSOLLL1",141,0)
 I $G(PSOIO("EBLBC"))]"" X PSOIO("EBLBC")
"RTN","PSOLLL1",142,0)
BARCE W @IOF
"RTN","PSOLLL1",143,0)
COPY I SIGF S SIGM=1 G L1 ; NEED TO FINISH PRINTING CONTINUED BOTTLE LABEL
"RTN","PSOLLL1",144,0)
 S FILLCONT=0 I PFM!PMIM S FILLCONT=1 G L1
"RTN","PSOLLL1",145,0)
 I $G(COPIES)>1 D  G L1
"RTN","PSOLLL1",146,0)
 . S COPIES=COPIES-1
"RTN","PSOLLL1",147,0)
 . S (SIGM,PFM,PMIM,L2,L3,L4,L5,BOTTLBL)=0
"RTN","PSOLLL1",148,0)
 . K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLL1",149,0)
 . F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLL1",150,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLLL1",151,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL1",152,0)
 S ^PSRX(RX,"L",IR,0)=PSOFNOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),$G(PCOMH(RX))]"":PCOMH(RX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLLL1",153,0)
 ;
"RTN","PSOLLL1",154,0)
 ;Storing FDA Medication Guide filename in the Prescription file
"RTN","PSOLLL1",155,0)
 I $$MGONFILE^PSOFDAUT(RX) D
"RTN","PSOLLL1",156,0)
 . I $G(RXRP(RX)),'$G(RXRP(RX,"MG")) Q
"RTN","PSOLLL1",157,0)
 . S ^PSRX(RX,"L",IR,"FDA")=$P($$MGONFILE^PSOFDAUT(RX),"^",2)
"RTN","PSOLLL1",158,0)
 ;
"RTN","PSOLLL1",159,0)
 N PSOBADR,PSOTEMP
"RTN","PSOLLL1",160,0)
 S PSOBADR=$$CHKRX^PSOBAI(RX)
"RTN","PSOLLL1",161,0)
 I $G(PSOBADR) S PSOTEMP=$P(PSOBADR,"^",2),PSOBADR=$P(PSOBADR,"^")
"RTN","PSOLLL1",162,0)
 I $G(PSOBADR),'$G(PSOTEMP) D
"RTN","PSOLLL1",163,0)
 .S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL1",164,0)
 .S ^PSRX(RX,"L",IR,0)=PSOFNOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_"ROUTING="_$G(MW)_" (BAD ADDRESS)"_"^"_PDUZ
"RTN","PSOLLL1",165,0)
 S L5=1
"RTN","PSOLLL1",166,0)
CONT2 I SIGF S SIGM=1 G L1 ; MORE BOTTLE LABEL SIG TO PRINT
"RTN","PSOLLL1",167,0)
 I PMIM G CONT ; MORE PMI INFO TO PRINT
"RTN","PSOLLL1",168,0)
 I $G(PSOBLALL)=1,$P(PPL,",",PI+1)="" D TRAIL
"RTN","PSOLLL1",169,0)
 Q
"RTN","PSOLLL1",170,0)
PRINT(T,B) ;
"RTN","PSOLLL1",171,0)
 S BOLD=$G(B)
"RTN","PSOLLL1",172,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",173,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL1",174,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",175,0)
 W T,!
"RTN","PSOLLL1",176,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",177,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL1",178,0)
 Q
"RTN","PSOLLL1",179,0)
TRAIL I $G(SIDE) G END
"RTN","PSOLLL1",180,0)
 D ^PSOLLL5
"RTN","PSOLLL1",181,0)
 D ^PSOLLLH
"RTN","PSOLLL1",182,0)
 D ^PSOLLL6
"RTN","PSOLLL1",183,0)
 I '$P($G(^PS(59,PSOSITE,1)),"^",18) Q
"RTN","PSOLLL1",184,0)
 I '$G(REPRINT) D ^PSOLLL7
"RTN","PSOLLL1",185,0)
END I '$P(PSOPAR,"^",31) Q
"RTN","PSOLLL1",186,0)
 W @IOF
"RTN","PSOLLL1",187,0)
 I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSOLLL1",188,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",189,0)
 S T="NEXT PATIENT"
"RTN","PSOLLL1",190,0)
 S PSOX=1100-(L($E(PSOFONT,2,99))*300/2)
"RTN","PSOLLL1",191,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",192,0)
 W T,!
"RTN","PSOLLL1",193,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",194,0)
 Q
"RTN","PSOLLL1",195,0)
 ;
"RTN","PSOLLL4")
0^7^B13004061^B11100322
"RTN","PSOLLL4",1,0)
PSOLLL4 ;BHAM/JLC - LASER LABELS PRINT PMI ;12/13/02
"RTN","PSOLLL4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,135,161,338,367**;DEC 1997;Build 62
"RTN","PSOLLL4",3,0)
 ;
"RTN","PSOLLL4",4,0)
 ;Reference to PSNPPIO supported by DBIA 3794
"RTN","PSOLLL4",5,0)
 ;
"RTN","PSOLLL4",6,0)
 S FLAG=$$EN^PSNPPIO(+$P(RXY,"^",6),.MSG)
"RTN","PSOLLL4",7,0)
EN I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSOLLL4",8,0)
 ;
"RTN","PSOLLL4",9,0)
 ; Printing FDA Medication Guide (if there's one)
"RTN","PSOLLL4",10,0)
 I 'L4,$$MGONFILE^PSOFDAUT(RX) D
"RTN","PSOLLL4",11,0)
 . D PRINT^PSOLLL1("Read FDA Med Guide",1) S PSOY=PSOY+PSOYI-25
"RTN","PSOLLL4",12,0)
 . I $G(REPRINT),'$D(RXRP(RX,"MG")) Q 
"RTN","PSOLLL4",13,0)
 . I $$GET1^DIQ(59,PSOSITE,134)="" Q 
"RTN","PSOLLL4",14,0)
 . I $P($G(PSOFDAPT),"^",2)="" Q
"RTN","PSOLLL4",15,0)
 . S RXFDAMG(RX)=""
"RTN","PSOLLL4",16,0)
 ;
"RTN","PSOLLL4",17,0)
 I '$G(PMIM) D MOREWARN
"RTN","PSOLLL4",18,0)
 S T=PNM_"  Rx#: "_RXN_"   "_DRUG D PRINT(T,0) S PSOY=PSOY+PSOYI-25
"RTN","PSOLLL4",19,0)
 S CONT=0 I PMIM S CONT=1 D PRINT(PMIF("T"),PMIF("H")) G CONT
"RTN","PSOLLL4",20,0)
 I 'FLAG D PRINT(MSG) Q
"RTN","PSOLLL4",21,0)
 S T=^TMP($J,"PSNPMI",0)_": "_$G(^TMP($J,"PSNPMI","F",1,0)) D PRINT(T,1) S PSOY=PSOY+PSOYI-25
"RTN","PSOLLL4",22,0)
 S T=$G(^TMP($J,"PSNPMI","C",1,0)) I T]"" D PRINT(T,1) S PSOY=PSOY+PSOYI-25
"RTN","PSOLLL4",23,0)
CONT S XFONT=$E(PSOFONT,2,99),(CNT,OUT,PMIM)=0
"RTN","PSOLLL4",24,0)
 K A F A="W","U","H","S","M","P","I","O","N","D","R" S CNT=CNT+1,A(CNT)=A
"RTN","PSOLLL4",25,0)
 F J=PMIF("A"):1 Q:$G(A(J))=""  S A=A(J) I $D(^TMP($J,"PSNPMI",A,1,0)) S HDR=$S(PMIF("A")=1:1,PMIF("B")=1:1,J=PMIF("A"):0,1:1),LENGTH=0,PTEXT="" D  Q:OUT  S PSOY=PSOY+PSOYI-25
"RTN","PSOLLL4",26,0)
 . F B=PMIF("B"):1 Q:'$D(^TMP($J,"PSNPMI",A,B,0))  S TEXT=^(0) D  Q:OUT
"RTN","PSOLLL4",27,0)
 .. F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSOLLL4",28,0)
 .. F I=PMIF("I"):1:$L(TEXT," ") D STRT^PSOLLU1("FULL",$P(TEXT," ",I)_" ",.L) D  Q:OUT
"RTN","PSOLLL4",29,0)
 ... I LENGTH+L(XFONT)<8.1 S PTEXT=PTEXT_$P(TEXT," ",I)_" ",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL4",30,0)
 ... S LENGTH=0,I=I-1
"RTN","PSOLLL4",31,0)
 ... I HDR D  Q
"RTN","PSOLLL4",32,0)
 .... I PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1
"RTN","PSOLLL4",33,0)
 .... D PRINT(PTEXT,1) S PTEXT="",HDR=0
"RTN","PSOLLL4",34,0)
 ... I PSOY>(PSOYM+25) S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1 Q
"RTN","PSOLLL4",35,0)
 ... D PRINT(PTEXT,0) S PTEXT=""
"RTN","PSOLLL4",36,0)
 .. I 'PMIM F I="I","B" S PMIF(I)=1
"RTN","PSOLLL4",37,0)
 . I 'PMIM S PMIF("B")=1
"RTN","PSOLLL4",38,0)
 . I OUT S PMIF("T")=PTEXT,PMIF("H")=HDR
"RTN","PSOLLL4",39,0)
 . Q:OUT  I HDR,PTEXT[":" D  Q
"RTN","PSOLLL4",40,0)
 .. I PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1,PMIF("T")=PTEXT,PMIF("H")=HDR Q
"RTN","PSOLLL4",41,0)
 .. I PTEXT]"" D PRINT(PTEXT,1)
"RTN","PSOLLL4",42,0)
 . I PTEXT]"",PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1,PMIF("T")=PTEXT,PMIF("H")=HDR Q
"RTN","PSOLLL4",43,0)
 . I PTEXT]"" D PRINT(PTEXT,0)
"RTN","PSOLLL4",44,0)
 Q
"RTN","PSOLLL4",45,0)
PRINT(T,HDR) ;
"RTN","PSOLLL4",46,0)
 ; Input: T - text to be printed
"RTN","PSOLLL4",47,0)
 ;        HDR - 0-no / 1-yes
"RTN","PSOLLL4",48,0)
 ;
"RTN","PSOLLL4",49,0)
 S HDR=+$G(HDR)
"RTN","PSOLLL4",50,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL4",51,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL4",52,0)
 I HDR,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL4",53,0)
 I HDR D  G PRINT2
"RTN","PSOLLL4",54,0)
 . W $P(T,":"),":"
"RTN","PSOLLL4",55,0)
 . I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL4",56,0)
 . W $P(T,":",2,99)
"RTN","PSOLLL4",57,0)
 W T
"RTN","PSOLLL4",58,0)
PRINT2 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL4",59,0)
 W ! Q
"RTN","PSOLLL4",60,0)
 ;
"RTN","PSOLLL4",61,0)
MOREWARN ; SEE ID MORE THAN 5 WARNINGS AND PRINT REMAINDER, IF SO
"RTN","PSOLLL4",62,0)
 N LEN,LEN2,I,J,PSOWARN,NEWWARN,PRE
"RTN","PSOLLL4",63,0)
 S LEN=$L($G(WARN),",") I LEN<6,'$G(PSOWLBL) Q
"RTN","PSOLLL4",64,0)
 S NEWWARN=$G(PSOWLBL)_$P(WARN,",",6,99)
"RTN","PSOLLL4",65,0)
 I $E(NEWWARN,$L(NEWWARN))="," S NEWWARN=$E(NEWWARN,1,$L(NEWWARN)-1) I NEWWARN="" Q
"RTN","PSOLLL4",66,0)
 S T="Additional Warnings:" D PRINT(T,1)
"RTN","PSOLLL4",67,0)
 F I=1:1:$L(NEWWARN,",") S PSOWARN=$P(NEWWARN,",",I) D
"RTN","PSOLLL4",68,0)
 .S PRE=PSOWARN_": ",LEN2=$L(PRE)
"RTN","PSOLLL4",69,0)
 .S TEXT=$$WTEXT^PSSWRNA(PSOWARN,PSOLAN) I TEXT'="" D
"RTN","PSOLLL4",70,0)
 ..I $L(TEXT)<100 S T=PRE_TEXT D PRINT(T) Q
"RTN","PSOLLL4",71,0)
 ..S PTEXT="" F J=1:1:$L(TEXT," ") S PTEXT=PTEXT_$P(TEXT," ",J)_" " D
"RTN","PSOLLL4",72,0)
 ...I $L(PTEXT)>90 D
"RTN","PSOLLL4",73,0)
 ....S T=PRE_PTEXT D PRINT(T) S PRE=$E("      ",1,LEN2),PTEXT=""
"RTN","PSOLLL4",74,0)
 ..I PTEXT'="" S T=$G(PRE)_PTEXT D PRINT(T) S PTEXT=""
"RTN","PSOLLL4",75,0)
 I PTEXT'="" S T=$G(PRE)_PTEXT D PRINT(T) S PTEXT=""
"RTN","PSOLLL4",76,0)
 S PSOY=PSOY+PSOYI
"RTN","PSOLLL4",77,0)
 K PSOWLBL
"RTN","PSOLLL4",78,0)
 Q
"RTN","PSOLLL8")
0^6^B29282471^B28083638
"RTN","PSOLLL8",1,0)
PSOLLL8 ;BIR/JLC - LASER LABEL - CRITICAL INTERACTION ;12/13/02
"RTN","PSOLLL8",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,251,387,367**;DEC 1997;Build 62
"RTN","PSOLLL8",3,0)
 ;Reference to PS(56 supported by DBIA 2229
"RTN","PSOLLL8",4,0)
 ;Reference to PSDRUG supported by DBIA 221
"RTN","PSOLLL8",5,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5424
"RTN","PSOLLL8",6,0)
 ;
"RTN","PSOLLL8",7,0)
 S HOLDCOPY=COPIES
"RTN","PSOLLL8",8,0)
START ;
"RTN","PSOLLL8",9,0)
 ;
"RTN","PSOLLL8",10,0)
 I $G(PSOIO("CDII"))]"" X PSOIO("CDII")
"RTN","PSOLLL8",11,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL8",12,0)
 K PSOSERV N PSODOSEW,PSODRGI,PSRXSET S (PSODOSEW,PSODRGI)=0
"RTN","PSOLLL8",13,0)
 S COPIES=COPIES-1,Y=$P(^PSRX(RX,2),"^",6) X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y
"RTN","PSOLLL8",14,0)
 S Y=DATE X ^DD("DD") S DATE1=Y D NOW^%DTC S Y=% X ^DD("DD") S NOW=Y
"RTN","PSOLLL8",15,0)
 I '$D(^PS(52.4,RX,0)),$P(^PSRX(RX,"STA"),"^")=4 D UNKNOWN Q
"RTN","PSOLLL8",16,0)
 I '$G(RXRP(RX)) S T=$P(PS2,"^",2)_" "_"("_$P(RXY,"^",16)_"/"_$S(+$G(VRPH):VRPH,1:" ")_")"_" "_$P(NOW,":",1,2) D PRINT(T)
"RTN","PSOLLL8",17,0)
2 ;
"RTN","PSOLLL8",18,0)
 I $D(^PSRX(RX,"DRI")) D M1 S SCRIPT=$P(^PSRX(RX,"DRI"),"^",2),SEV=$P(^PSRX(RX,"DRI"),"^") F X=1:1 S RXX(X)=$P(SCRIPT,",",X),SEV(X)=$P(SEV,",",X) Q:RXX(X)=""  D
"RTN","PSOLLL8",19,0)
 .S:SEV(X)=1 PSOSERV=1
"RTN","PSOLLL8",20,0)
 .S T=$P($G(^PSRX(RXX(X),0)),"^")_"  "_$S(SEV(X)=1:"CRITICAL",SEV(X)=2:"SIGNIFICANT",1:"UNKNOWN")_" INTERACTION   "_$P(^PSDRUG($P(^PSRX(RXX(X),0),"^",6),0),"^") S:SEV(X)=1 PSODRGI=1 D PRINT(T)
"RTN","PSOLLL8",21,0)
 I '$D(^PSRX(RX,"DRI")),$D(^PS(52.4,RX,0)) S SCRIPT=$P(^PS(52.4,RX,0),"^",10),SEV=$P(^PS(52.4,RX,0),"^",9) D M2:SCRIPT="" I SCRIPT'="" D M1 F X=1:1 S RXX(X)=$P(SCRIPT,",",X),SEV(X)=$P(SEV,",",X) Q:RXX(X)=""  D
"RTN","PSOLLL8",22,0)
 .S:SEV(X)=1 PSOSERV=1
"RTN","PSOLLL8",23,0)
 .S T=$P($G(^PSRX(RXX(X),0)),"^")_"     "_$S(SEV(X)=1:"CRITICAL",SEV(X)=2:"SIGNIFICANT",1:"UNKNOWN")_" INTERACTION    "_$P(^PSDRUG($P(^PSRX(RXX(X),0),"^",6),0),"^") S:SEV(X)=1 PSODRGI=1 D PRINT(T)
"RTN","PSOLLL8",24,0)
 I $$DS^PSSDSAPI,($D(^PS(52.4,RX,1))) S T="",T=$P(^PS(52.4,RX,1),"^") D  D:T'="" PRINT(T)
"RTN","PSOLLL8",25,0)
 . S T=$S(T=3:"MAX SINGLE DOSE & DAILY DOSE RANGE",T=2:"MAX SINGLE DOSE",T=1:"DAILY DOSE RANGE",1:""),PSODOSEW=1
"RTN","PSOLLL8",26,0)
 S T="This prescription was entered by: "_TECH_"." D PRINT(T)
"RTN","PSOLLL8",27,0)
 S T="This prescription "_$S('$G(PSOSERV):"may require",1:"requires")_" "_$S('$G(PSOSERV):"reviewing",1:"intervention")_" by a pharmacist." D PRINT(T)
"RTN","PSOLLL8",28,0)
 S T=DATE1_"  Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)) D PRINT(T)
"RTN","PSOLLL8",29,0)
 S T=PNM_"  "_SSNP D PRINT(T)
"RTN","PSOLLL8",30,0)
 F SSG=1:1 Q:$G(SGY(SSG))=""  S T=SGY(SSG) D PRINT(T)
"RTN","PSOLLL8",31,0)
 S T="Qty: "_$G(QTY)_"   "_$G(PHYS) D PRINT(T)
"RTN","PSOLLL8",32,0)
 S T="Tech__________RPh__________" D PRINT(T)
"RTN","PSOLLL8",33,0)
 S T=DRUG D PRINT(T)
"RTN","PSOLLL8",34,0)
 S T="Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL") D PRINT(T)
"RTN","PSOLLL8",35,0)
 S T="Days supply: "_$G(DAYS)_" Cap: "_$S(PSCAP:"**NON-SFTY**",1:"SAFETY") D PRINT(T)
"RTN","PSOLLL8",36,0)
 S T="Isd: "_ISD_" Exp: "_EXPDT D PRINT(T)
"RTN","PSOLLL8",37,0)
 S T="Last Fill: "_$G(PSOFLAST) D PRINT(T)
"RTN","PSOLLL8",38,0)
 S T="Pat. Stat "_PATST_" Clinic: "_PSCLN D PRINT(T)
"RTN","PSOLLL8",39,0)
 W @IOF
"RTN","PSOLLL8",40,0)
 I COPIES>0 G START
"RTN","PSOLLL8",41,0)
 S COPIES=HOLDCOPY K HOLDCOPY
"RTN","PSOLLL8",42,0)
STORE ;LABEL PRINT NODE
"RTN","PSOLLL8",43,0)
 D NOW^%DTC S NOW=% K %,%H,%I I $G(RXF)="" S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOLLL8",44,0)
 F IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLLL8",45,0)
 ;S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR,^PSRX(RX,"L",IR,0)=NOW_"^"_RXF_"^"_$S($G(PCOMX)]"":$G(PCOMX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_" Drug-Drug interaction"_$S($G(RXRP(RX)):" (Reprint)",1:"")_"^"_PDUZ_"^1"
"RTN","PSOLLL8",46,0)
 S IR=IR+1,PSRXSET="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL8",47,0)
 S PSRXSET=NOW_"^"_RXF_"^"_$S($G(PCOMX)]"":$G(PCOMX),1:"From RX number "_$P(^PSRX(RX,0),"^"))
"RTN","PSOLLL8",48,0)
 S PSRXSET=PSRXSET_$S(PSODRGI&(PSODOSEW)&$$DS^PSSDSAPI:" Drug-Drug interaction/dose warning",PSODRGI:" Drug-Drug interaction",PSODOSEW&$$DS^PSSDSAPI:" Dose Warning",1:"")_$S($G(RXRP(RX)):" (Reprint)",1:"")_"^"_PDUZ_"^1"
"RTN","PSOLLL8",49,0)
 S ^PSRX(RX,"L",IR,0)=PSRXSET
"RTN","PSOLLL8",50,0)
 ;
"RTN","PSOLLL8",51,0)
 ;Storing FDA Medication Guide filename in the Prescription file
"RTN","PSOLLL8",52,0)
 I $$MGONFILE^PSOFDAUT(RX) D
"RTN","PSOLLL8",53,0)
 . I $G(RXRP(RX)),'$G(RXRP(RX,"MG")) Q
"RTN","PSOLLL8",54,0)
 . S ^PSRX(RX,"L",IR,"FDA")=$P($$MGONFILE^PSOFDAUT(RX),"^",2)
"RTN","PSOLLL8",55,0)
 ; 
"RTN","PSOLLL8",56,0)
 K:$D(^PS(52.4,RX,0)) RXF,IR,FDA,NOW,I
"RTN","PSOLLL8",57,0)
END K:$D(^PS(52.4,RX,0)) PSCLN,DATE1,DRUG,RFLMSG,COPIES,DRUG,LMI,LINE,PS,PS1,PS2,INT,ISD,I1,MW,STATE,SIDE,SGY,PATST,PRTFL,PHYS,SGC,VRPH,NLWS,X1,X2,X,Y,TECH,EXPDT,NURSE,SEV,SCRIPT,RXX,SGY,SER,SSG,RXY,SIGPH,PS55,PS55X K PSOSERV
"RTN","PSOLLL8",58,0)
 Q
"RTN","PSOLLL8",59,0)
UNKNOWN S PSOY=PSOY+(3*PSOYI),T="",$P(T,"*",100)="" D PRINT(T)
"RTN","PSOLLL8",60,0)
 S T="THIS PRESCRIPTION HAS CAUSED A DRUG-DRUG INTERACTION " D PRINT(T)
"RTN","PSOLLL8",61,0)
 S T="",$P(T,"*",100)="" D PRINT(T)
"RTN","PSOLLL8",62,0)
 S T="PRESCRIPTION # "_$P(^PSRX(RX,0),"^")_"  "_$P(^PSDRUG($P(^PSRX(RX,0),"^",6),0),"^") D PRINT(T)
"RTN","PSOLLL8",63,0)
 S T="The above prescription has a status of PENDING due to a DRUG-DRUG INTERACTION." D PRINT(T)
"RTN","PSOLLL8",64,0)
 S T=PNM_"  "_SSNP D PRINT(T)
"RTN","PSOLLL8",65,0)
 S T=$P(PS2,"^",2)_" ("_$P(RXY,"^",16)_"/"_$S(+$G(VRPH):VRPH,1:" ")_")"_" "_$P($P(NOW,":",1,2),"@") D PRINT(T)
"RTN","PSOLLL8",66,0)
 S T=RXN_"  "_DATE1_" Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)) D PRINT(T)
"RTN","PSOLLL8",67,0)
 F SSG=1:1 Q:$G(SGY(SSG))=""  S T=SGY(SSG) D PRINT(T)
"RTN","PSOLLL8",68,0)
 S PSOY=PSOY+PSOYI,T="Please review printouts of all labels for this patient that follow." D PRINT(T),STORE
"RTN","PSOLLL8",69,0)
 W @IOF K PSCLN,DATE1,DRUG,RFLMSG,COPIES,DRUG,LMI,LINE,PS,PS1,PS2,INT,ISD,I1,MW,STATE,SIDE,SIGPH,SGY,PATST,PRTFL,PHYS,SGC,VRPH,NLWS,X1,X2,X,Y,TECH,EXPDT,NURSE,SEV,SCRIPT,RXX,SGY,SER,SSG,RXY,PSOSERV Q
"RTN","PSOLLL8",70,0)
 ;
"RTN","PSOLLL8",71,0)
PRINT(T) ;
"RTN","PSOLLL8",72,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL8",73,0)
 W T,!
"RTN","PSOLLL8",74,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL8",75,0)
 Q
"RTN","PSOLLL8",76,0)
 ;
"RTN","PSOLLL8",77,0)
M1 ;
"RTN","PSOLLL8",78,0)
 S PSOY=PSOY+PSOYI,T="Rx# "_RXN_" has caused a DRUG-DRUG INTERACTION with the following prescription(s):" D PRINT(T)
"RTN","PSOLLL8",79,0)
 Q 
"RTN","PSOLLL8",80,0)
M2 ;
"RTN","PSOLLL8",81,0)
 S PSOY=PSOY+PSOYI,T="",T="Rx# "_RXN D PRINT(T)
"RTN","PSOLLL8",82,0)
 Q
"RTN","PSOLLLI")
0^27^B87322904^B82644773
"RTN","PSOLLLI",1,0)
PSOLLLI ;BIR/JLC - LASER LABELS INITIALIZATION ;11/20/08 12:17pm
"RTN","PSOLLLI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,157,189,161,244,200,206,225,303,266,326,251,387,367**;DEC 1997;Build 62
"RTN","PSOLLLI",3,0)
 ;DBIAs PSDRUG-221, PS(55-2228, SC-10040, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097, ^TMP($J,"PSNPPIO"-3794
"RTN","PSOLLLI",4,0)
 ;External reference to DRUG^PSSWRNA supported by DBIA 4449
"RTN","PSOLLLI",5,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5425
"RTN","PSOLLLI",6,0)
 ;External reference to ^DIC(5 supported by DBIA 4293
"RTN","PSOLLLI",7,0)
 ;External reference to ^SC( supported by DBIA 2675
"RTN","PSOLLLI",8,0)
 ;External reference to $$DS^PSSDSAPI supported by DBIA 5425
"RTN","PSOLLLI",9,0)
 ;
"RTN","PSOLLLI",10,0)
 ;*244 remove test for partial fill when testing status > 11
"RTN","PSOLLLI",11,0)
 ;
"RTN","PSOLLLI",12,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",13,0)
DQ1 I '$D(PPL) G HLEX
"RTN","PSOLLLI",14,0)
 I $P($G(PSOPAR),"^",30)=2,'$G(PSOEXREP) G HLEX
"RTN","PSOLLLI",15,0)
 K RXFLX,RXFDAMG S PSOCKHN=","_$G(PPL),PSRESOLV=+PPL D CHECK
"RTN","PSOLLLI",16,0)
 S PSOINT=1 F PI=1:1 S RX=$P(PPL,",",PI) Q:RX=""  D
"RTN","PSOLLLI",17,0)
 . S RXY=$G(^PSRX(RX,0)) Q:RXY=""  I PSOPDFN'=$P(RXY,"^",2),'PSOINT D TRAIL^PSOLLL1 S PSOPDFN=$P(RXY,"^",2)
"RTN","PSOLLLI",18,0)
 . K RXP,REPRINT D C
"RTN","PSOLLLI",19,0)
 I 'PSOINT D TRAIL^PSOLLL1
"RTN","PSOLLLI",20,0)
 ;
"RTN","PSOLLLI",21,0)
 ; Printing FDA Medication Guides
"RTN","PSOLLLI",22,0)
 N FDARX,FDAMG
"RTN","PSOLLLI",23,0)
 S FDARX="" F  S FDARX=$O(RXFDAMG(FDARX)) Q:FDARX=""  D
"RTN","PSOLLLI",24,0)
 . S FDAMG=$$PRINTMG^PSOFDAMG(FDARX,$P($G(PSOFDAPT),"^",2))
"RTN","PSOLLLI",25,0)
 ;
"RTN","PSOLLLI",26,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1,RXP,REPRINT
"RTN","PSOLLLI",27,0)
 K SGY,OSGY,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM,ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ
"RTN","PSOLLLI",28,0)
 K DATE,DR,DRUG,LINE,MW,PRTFL,VRPH,EXPDT,X2,DIFF,DAYS,PSZIP,PSOHZIP,PS55,PS55X,REF
"RTN","PSOLLLI",29,0)
 K ^TMP($J,"PSNPMI"),^TMP($J,"PSOCP",+$G(PSOCPN)),PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA
"RTN","PSOLLLI",30,0)
 I '$G(PSOSUREP),'$G(PSOSUSPR) S ZTREQ="@"
"RTN","PSOLLLI",31,0)
 Q
"RTN","PSOLLLI",32,0)
 ;
"RTN","PSOLLLI",33,0)
C N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",34,0)
 U IO Q:'$D(^PSRX(RX,0))  S RXY=^(0),RX2=^(2),RXSTA=^("STA") K SGY,OSGY
"RTN","PSOLLLI",35,0)
 S (SIGM,PFM,PMIM,L2,L3,L4,L5,FILLCONT,BOTTLBL)=0
"RTN","PSOLLLI",36,0)
 K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLLI",37,0)
 F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLLI",38,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y,Y=PSOFNOW X ^DD("DD") S PSONOWT=Y
"RTN","PSOLLLI",39,0)
 S:$G(PSOBLALL) PSOBLRX=RX S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLLLI",40,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 I '$G(RXRP(RX)) S RXRP(RX)=1 S:$G(PSOMGREP) RXRP(RX,"MG")=1
"RTN","PSOLLLI",41,0)
 S A=$P(RXSTA,"^") I A>11 D AL^PSOLBL("QT") K RXP,REPRINT Q      ;*244
"RTN","PSOLLLI",42,0)
 I A=3 D AL^PSOLBL("QT") K RXP,REPRINT Q
"RTN","PSOLLLI",43,0)
 I $G(RXPR(RX)),'$D(^PSRX(RX,"P",RXP,0)) K RXP,REPRINT Q
"RTN","PSOLLLI",44,0)
 I $P($G(RXFL(RX)),"^"),'$D(^PSRX(RX,1,$P($G(RXFL(RX)),"^"),0)) K RXP,REPRINT Q
"RTN","PSOLLLI",45,0)
 I $G(PSODBQ)!($G(RXRS(RX))) S RR=$O(^PS(52.5,"B",RX,0)) Q:'RR  I $G(^PS(52.5,RR,"P"))=1 K RXP,REPRINT Q
"RTN","PSOLLLI",46,0)
 I $G(RXRS(RX))!($G(PSOPULL)) S PSOSXQ=0 N DR,DA,DIE D  I $G(PSOSXQ) K RXP,REPRINT Q
"RTN","PSOLLLI",47,0)
 . S DA=$O(^PS(52.5,"B",RX,0)) Q:'DA
"RTN","PSOLLLI",48,0)
 . S A=$P($G(^PS(52.5,DA,0)),"^",7) I A="" Q
"RTN","PSOLLLI",49,0)
 . I A="Q" S DIE="^PS(52.5,",DR="3////P" D ^DIE Q
"RTN","PSOLLLI",50,0)
 . K RXRS(RX) S PSOSXQ=1
"RTN","PSOLLLI",51,0)
 I $G(PSRESOLV)=RX D ENLBL^PSOBSET K PSRESOLV
"RTN","PSOLLLI",52,0)
 I $P(RXSTA,"^")'=4 D
"RTN","PSOLLLI",53,0)
 . I $G(PSOSUSPR) D AREC^PSOSUTL
"RTN","PSOLLLI",54,0)
 . I $G(PSOPULL)!($G(RXRS(RX))) D AREC1^PSOSUTL
"RTN","PSOLLLI",55,0)
 . I $G(PSOSUREP) D AREC^PSOSUSRP
"RTN","PSOLLLI",56,0)
 . I $G(PSXREP) D AREC^PSXSRP
"RTN","PSOLLLI",57,0)
  S RXY=^PSRX(RX,0),RX2=^(2),RXSTA=^("STA")
"RTN","PSOLLLI",58,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOLLLI",59,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLLLI",60,0)
 S RXN=$P(RXY,"^"),DFN=+$P(RXY,"^",2),PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLLLI",61,0)
 S ISD=$P(RXY,"^",13),RXF=0,SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLLLI",62,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0)
"RTN","PSOLLLI",63,0)
 S FDT=$P(RX2,"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLLLI",64,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLI",65,0)
 S EXPDT=$P(RX2,"^",6),EXDT=$S('EXPDT:"",1:$E(EXPDT,4,5)_"/"_$E(EXPDT,6,7)_"/"_($E(EXPDT,1,3)+1700))
"RTN","PSOLLLI",66,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLLLI",67,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSOLLLI",68,0)
 .S PSOCKHA=","_RX_","
"RTN","PSOLLLI",69,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSOLLLI",70,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSOLLLI",71,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSOLLLI",72,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSOLLLI",73,0)
 I $O(^PSRX(RX,1,0)),$G(RXFL(RX))'=0 S $P(^PSRX(RX,3),"^",6)="" K ^PSRX(RX,"DAI"),^PSRX(RX,"DRI")
"RTN","PSOLLLI",74,0)
 I '$G(RXP),'$O(^PSRX(RX,1,0)) S RXFL(RX)=0
"RTN","PSOLLLI",75,0)
 I '$G(RXP) D OSET I '$O(^PSRX(RX,1,0))!($G(RXFL(RX))=0) G ORIG
"RTN","PSOLLLI",76,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP) D  G STA
"RTN","PSOLLLI",77,0)
 . I '$G(RXFL(RX)) S XTYPE=1 D REF
"RTN","PSOLLLI",78,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSOLLLI",79,0)
ORIG S TECH=$P($G(^VA(200,+$P(RXY,"^",16),0)),"^"),PHYS=$S($D(^VA(200,+$P(RXY,"^",4),0)):$P(^(0),"^"),1:"UKN")
"RTN","PSOLLLI",80,0)
 S DAYS=$P(RXY,"^",8),QTY=$P(RXY,"^",7)
"RTN","PSOLLLI",81,0)
 D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",82,0)
STA ;
"RTN","PSOLLLI",83,0)
 S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLLLI",84,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLLLI",85,0)
 S WARN=$$DRUG^PSSWRNA(+$P(RXY,"^",6),+$P(RXY,"^",2))
"RTN","PSOLLLI",86,0)
 S SIDE=$S($P($G(RXRP(RX)),"^",3):1,1:0)
"RTN","PSOLLLI",87,0)
 I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLLLI",88,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLLLI",89,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLLLI",90,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLLLI",91,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",92,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",93,0)
 .;PSO*7*266
"RTN","PSOLLLI",94,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",95,0)
 I MW="W",$G(^PSRX(RX,"MP"))]"" D
"RTN","PSOLLLI",96,0)
 .N PSJ S PSMP=^PSRX(RX,"MP"),PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLLLI",97,0)
 .K PSMP(PSI)
"RTN","PSOLLLI",98,0)
 ;New mail codes for CMOP
"RTN","PSOLLLI",99,0)
 S MAILCOM=""
"RTN","PSOLLLI",100,0)
 S X=$G(^PS(55,DFN,0)),PSCAP=$P(X,"^",2),PS55=$P(X,"^",3),PS55X=$P(X,"^",5)
"RTN","PSOLLLI",101,0)
 I PS55X]"",PS55>1,PS55X<DT S PS55=0
"RTN","PSOLLLI",102,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLLLI",103,0)
 S MAILCOM=$P($G(^PS(59,PSOSITE,9)),"^")
"RTN","PSOLLLI",104,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLLLI",105,0)
 I $G(PSMP(1))="",$G(PS55)=2 S PSMP(1)=$G(SSNPN)
"RTN","PSOLLLI",106,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLLLI",107,0)
 S (X,PSOFLAST)=$G(PSOLASTF) I X?1N.E D ^%DT X ^DD("DD") S PSOFLAST=Y
"RTN","PSOLLLI",108,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["W")!(DEA[1)!(DEA[2) PRTFL=0
"RTN","PSOLLLI",109,0)
 S VRPH=$P(RX2,"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$G(^SC(PSCLN,0)),PSCLN=$S($P(PSCLN,"^",2)'="":$P(PSCLN,"^",2),1:$E($P(PSCLN,"^"),1,7)) I PSCLN="" S PSCLN="UNKNOWN"
"RTN","PSOLLLI",110,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLLLI",111,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S COPAYVAR="CHAMPUS" G LBL
"RTN","PSOLLLI",112,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSOLLLI",113,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) D SNO G LBL
"RTN","PSOLLLI",114,0)
 I DEA["I"!(DEA["S")!(DEA["N") D SNO G LBL
"RTN","PSOLLLI",115,0)
 I $P(^PSRX(RX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSOLLLI",116,0)
 I $G(PSOLBLCP)="" D IBCP
"RTN","PSOLLLI",117,0)
 N PSOQI S PSOQI=$G(^PSRX(RX,"IBQ"))
"RTN","PSOLLLI",118,0)
 I $G(PSOLBLCP)=0 D SNO G LBL
"RTN","PSOLLLI",119,0)
 I $G(PSOLBLCP)=1 I $P(PSOQI,"^",2)!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLLLI",120,0)
 I $G(PSOLBLCP)=2 I $P(PSOQI,"^")!($P(PSOQI,"^",2))!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLLLI",121,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") D SNO G LBL
"RTN","PSOLLLI",122,0)
 S PSOCPN=$P(RXY,"^",2),INRX=$P(RXY,"^")
"RTN","PSOLLLI",123,0)
 I $G(^TMP($J,"PSOCP",PSOCPN))="" S ^(PSOCPN)=PSOCPN
"RTN","PSOLLLI",124,0)
 S ^TMP($J,"PSOCP",PSOCPN,INRX)=INRX_"^"_$$ZZ^PSOSUTL(RX)_"^"_+$G(DAYS),COPAYVAR="COPAY" K ZDRUG
"RTN","PSOLLLI",125,0)
LBL I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLLI",126,0)
 ;
"RTN","PSOLLLI",127,0)
 N PSODDFLG,PSODWARN,PSOSIGNIF S PSODWARN=0 D
"RTN","PSOLLLI",128,0)
 .I $D(^PSRX(RX,"DRI")),$P(^PSRX(RX,"DRI"),"^")[1 S PSODWARN=1 ;must have a critical drug interaction to print tech warning label
"RTN","PSOLLLI",129,0)
 .I '$D(^PSRX(RX,"DRI")),$D(^PS(52.4,RX,0)),$P(^PS(52.4,RX,0),"^",9)[1 S PSODWARN=1 ;must have a critical drug interaction to print tech warning label
"RTN","PSOLLLI",130,0)
 .I $D(^PS(52.4,RX,0)),$P(^PS(52.4,RX,0),"^",9)'[1,$P(^PS(52.4,RX,0),"^",9)[2 S PSOSIGNIF=1
"RTN","PSOLLLI",131,0)
 .I $$DS^PSSDSAPI,($D(^PS(52.4,RX,1))) S PSODWARN=1 ;dose warnings should print a tech warning label
"RTN","PSOLLLI",132,0)
 ;
"RTN","PSOLLLI",133,0)
 G ^PSOLLL8:($P(RXSTA,"^")=4!$G(PSODWARN))&'$G(RXF)&'$G(RXP) ;print warning label for critical interaction and dose warnings
"RTN","PSOLLLI",134,0)
 I '$G(PSODGETA) D ^PSOLLL8:$D(^PSRX(RX,"DRI"))&('$G(RXF))&('$G(RXP)) ;print warning label for significant interactions
"RTN","PSOLLLI",135,0)
 I '$G(PSODGETA),$G(PSOSIGNIF),$D(^PSRX(RX,"DRI"))&('$G(RXF))&('$G(RXP)) S PSODGETA=1 D C
"RTN","PSOLLLI",136,0)
 K PSODGETA
"RTN","PSOLLLI",137,0)
 I $$DS^PSSDSAPI,'$G(RXF),'$G(RXP) Q:$D(^PS(52.4,RX,1))  ;already printed warning label above, quit if dose warning and don't print bottle label
"RTN","PSOLLLI",138,0)
 Q:(($P(^PSRX(RX,"STA"),"^")=4!($P($G(^PSRX(RX,"DRI")),"^",1)[1))&('$G(RXF))&('$G(RXP)))
"RTN","PSOLLLI",139,0)
 ;
"RTN","PSOLLLI",140,0)
LBL2 ;
"RTN","PSOLLLI",141,0)
 I $P($G(^PSRX(RX,3)),"^",6),'$G(RXF),'$G(RXP) D ^PSOLLL9
"RTN","PSOLLLI",142,0)
 S PSOINT=0 G ^PSOLLL1
"RTN","PSOLLLI",143,0)
REF F XXX=0:0 S XXX=$O(^PSRX(RX,XTYPE,XXX)) Q:+XXX'>0  D
"RTN","PSOLLLI",144,0)
 .S TECH=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",145,0)
 .S QTY=$P(^PSRX(RX,XTYPE,XXX,0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",146,0)
 .S DAYS=$P(^PSRX(RX,XTYPE,XXX,0),"^",10)
"RTN","PSOLLLI",147,0)
 Q
"RTN","PSOLLLI",148,0)
CHECK S PSDFNFLG=0,PSOZERO=$P(PPL,","),PSOPDFN=$P(^PSRX(PSOZERO,0),"^",2)
"RTN","PSOLLLI",149,0)
 Q
"RTN","PSOLLLI",150,0)
OSET ;
"RTN","PSOLLLI",151,0)
 N A
"RTN","PSOLLLI",152,0)
 I $G(RXFL(RX))']""!($G(RXFL(RX))=0) D  Q
"RTN","PSOLLLI",153,0)
 .S A=^PSRX(RX,0)
"RTN","PSOLLLI",154,0)
 .S TECH=$P($G(^VA(200,+$P(A,"^",16),0)),"^"),QTY=$P(A,"^",7),PHYS=$S($D(^VA(200,+$P(A,"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",155,0)
 .S DAYS=$P(A,"^",8)
"RTN","PSOLLLI",156,0)
 I '$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",157,0)
 S A=^PSRX(RX,1,RXFL(RX),0)
"RTN","PSOLLLI",158,0)
 S TECH=$S($D(^VA(200,+$P(A,"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",159,0)
 S QTY=$P(A,"^",4),PHYS=$S($D(^VA(200,+$P(A,"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",160,0)
 S DAYS=$P(A,"^",10)
"RTN","PSOLLLI",161,0)
 Q
"RTN","PSOLLLI",162,0)
DOUB ;
"RTN","PSOLLLI",163,0)
 Q:'$D(RXFL(RX))
"RTN","PSOLLLI",164,0)
 I +$G(RXFL(RX))-PSOCKHNX<0 Q
"RTN","PSOLLLI",165,0)
 S RXFLX(RX)=$G(RXFL(RX))
"RTN","PSOLLLI",166,0)
 S RXFL(RX)=$G(RXFL(RX))-PSOCKHNX
"RTN","PSOLLLI",167,0)
 Q
"RTN","PSOLLLI",168,0)
IBCP ;
"RTN","PSOLLLI",169,0)
 N X,Y,PSOJJ,PSOLL
"RTN","PSOLLLI",170,0)
 S PSOLBLCP=""
"RTN","PSOLLLI",171,0)
 S X=$P($G(^PS(59,+$G(PSOSITE),"IB")),"^")_"^"_$G(DFN) D XTYPE^IBARX
"RTN","PSOLLLI",172,0)
 S PSOJJ="" F  S PSOJJ=$O(Y(PSOJJ)) Q:'PSOJJ  S PSOLL="" F  S PSOLL=$O(Y(PSOJJ,PSOLL)) Q:PSOLL=""  S:PSOLL>0 PSOLBLCP=PSOLL
"RTN","PSOLLLI",173,0)
 I '$G(PSOLBLCP) S PSOLBLCP=0
"RTN","PSOLLLI",174,0)
 Q
"RTN","PSOLLLI",175,0)
SNO ;
"RTN","PSOLLLI",176,0)
 S COPAYVAR="NO COPAY"
"RTN","PSOLLLI",177,0)
 Q
"RTN","PSOLSET")
0^5^B30523749^B30029461
"RTN","PSOLSET",1,0)
PSOLSET ;BHAM ISC/SAB - site parameter set up ;12/03/92
"RTN","PSOLSET",2,0)
VERS ;;7.0;OUTPATIENT PHARMACY;**10,22,32,40,120,247,359,367**;DEC 1997;Build 62
"RTN","PSOLSET",3,0)
 ;Reference to ^PS(59.7 supported by DBIA 694
"RTN","PSOLSET",4,0)
 ;Reference to ^PSX(550 supported by DBIA 2230
"RTN","PSOLSET",5,0)
 ;Reference to ^%ZIS(2 supported by DBIA 3435
"RTN","PSOLSET",6,0)
 ;
"RTN","PSOLSET",7,0)
 I '$D(DUZ) W !,$C(7),"DUZ Number must be defined !!",! G LEAVE
"RTN","PSOLSET",8,0)
 W !,"Outpatient Pharmacy software - Version "_$P($T(VERS),";",3)
"RTN","PSOLSET",9,0)
 I $D(^XTMP("PSO_V7 INSTALL",0)) W !!,"Outpatient Pharmacy software is being installed.  PLEASE TRY LATER!",! G LEAVE
"RTN","PSOLSET",10,0)
 S PSOBAR1="",PSOBARS=0 ;make sure we have one
"RTN","PSOLSET",11,0)
 S PSOCNT=0 F I=0:0 S I=$O(^PS(59,I)) Q:'I  S PSOCNT=PSOCNT+1,Y=I
"RTN","PSOLSET",12,0)
 G DIV1:PSOCNT W !,$C(7) S DIR("A",1)="Site parameters must be specified for at least one site."
"RTN","PSOLSET",13,0)
 S DIR("A",2)="This is usually done by the package Co-ordinator.",DIR("A")="Do you want to continue:  ",DIR("B")="YES",DIR(0)="SA^Y:YES;N:NO",DIR("?")="Enter Y to edit site parameters or N to exit." D ^DIR
"RTN","PSOLSET",14,0)
 G LEAVE:"Y"'[$E(X)
"RTN","PSOLSET",15,0)
 W ! D ^PSOSITED G PSOLSET
"RTN","PSOLSET",16,0)
DIV1 G:PSOCNT=1 DIV3 S DIR(0)="Y",DIR("?")="Enter 'Y' to select Division or 'N' to EXIT"
"RTN","PSOLSET",17,0)
DIV2 I PSOCNT>1 W ! S DIC("A")="Division: ",DIC=59,DIC(0)="AEMQ"
"RTN","PSOLSET",18,0)
 S:$G(PSOVEX)'=1 DIC("S")="I $S('$D(^PS(59,+Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0)"
"RTN","PSOLSET",19,0)
 D ^DIC K DIC G:$D(DUOUT)!($D(DTOUT)) LEAVE
"RTN","PSOLSET",20,0)
 I +Y<0 W $C(7),! S DIR("A",1)="A 'DIVISION' must be selected!",DIR("A")="Do you want to try again",DIR("B")="YES" D ^DIR G:'Y LEAVE G DIV2
"RTN","PSOLSET",21,0)
DIV3 K DIR S PSOSITE=+Y W:PSOCNT>1 !!?10,"You are logged on under the ",$P(^PS(59,PSOSITE,0),"^")," division.",! S PSOPAR=$G(^PS(59,PSOSITE,1)),PSOPAR7=$G(^PS(59,PSOSITE,"IB")),PSOSYS=$G(^PS(59.7,1,40.1)) D CUTDATE^PSOFUNC
"RTN","PSOLSET",22,0)
 S PSOPINST=$P($G(^PS(59,PSOSITE,"INI")),"^")
"RTN","PSOLSET",23,0)
 S (SITE,DA)=$P(^XMB(1,1,"XUS"),"^",17),DIC="4",DIQ(0)="IE",DR=".01;99",DIQ="PSXUTIL" D EN^DIQ1 S S3=$G(PSXUTIL(4,SITE,99,"I")),S2=$G(PSXUTIL(4,SITE,.01,"E")) K DA,DIC,DIQ(0),DR
"RTN","PSOLSET",24,0)
 S PSXSYS=+$O(^PSX(550,"C",""))_"^"_$G(S3)_"^"_$G(S2),PSOINST=S3
"RTN","PSOLSET",25,0)
 K S3,S2,S1,PSXUTIL
"RTN","PSOLSET",26,0)
 I $G(PSXSYS) D
"RTN","PSOLSET",27,0)
 .K:($P($G(^PSX(550,+PSXSYS,0)),"^",2)'="A") PSXSYS
"RTN","PSOLSET",28,0)
 .S Y=$$VERSION^XPDUTL("PSO") I Y>6.0 S PSXVER=1
"RTN","PSOLSET",29,0)
 E  K PSXSYS
"RTN","PSOLSET",30,0)
 S PSODIV=$S(($P(PSOSYS,"^",2))&('$P(PSOSYS,"^",3)):0,1:1)
"RTN","PSOLSET",31,0)
 I $D(DUZ),$D(^VA(200,+DUZ,0)) S PSOCLC=DUZ
"RTN","PSOLSET",32,0)
PLBL ; Profile Printer Selection
"RTN","PSOLSET",33,0)
 I $P(PSOPAR,"^",8) D
"RTN","PSOLSET",34,0)
 .S %ZIS="MNQ",%ZIS("A")="Select PROFILE PRINTER: " S:$G(PSOCLBL)&($D(PSOPROP)) %ZIS("B")=PSOPROP
"RTN","PSOLSET",35,0)
 .D ^%ZIS K %ZIS,IO("Q"),IOP Q:POP  S PSOPROP=ION D ^%ZISC
"RTN","PSOLSET",36,0)
LBL ; Label Printer Selection
"RTN","PSOLSET",37,0)
 S %ZIS="MNQ",%ZIS("A")="Select LABEL PRINTER: " S:$G(PSOCLBL)&($D(PSOLAP))!($G(SUSPT)) %ZIS("B")=$S($G(SUSPT):PSLION,1:PSOLAP)
"RTN","PSOLSET",38,0)
 D ^%ZIS K %ZIS,IO("Q"),IOP S:POP PSOQUIT=1 G:POP FDAPRT S @$S($G(SUSPT):"PSLION",1:"PSOLAP")=ION,PSOPIOST=$G(IOST(0))
"RTN","PSOLSET",39,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOLSET",40,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",19),PSOIOS=IOS D ^%ZISC
"RTN","PSOLSET",41,0)
LASK I $G(PSOPIOST),$D(^%ZIS(2,PSOPIOST,55,"B","LL")) G FDAPRT
"RTN","PSOLSET",42,0)
 K DIR S DIR("A")="OK to assume label alignment is correct",DIR("B")="YES",DIR(0)="Y"
"RTN","PSOLSET",43,0)
 S DIR("?")="Enter Y if labels are aligned, N if they need to be aligned."
"RTN","PSOLSET",44,0)
 D ^DIR S:$D(DIRUT) PSOQUIT=1 G:Y!($D(DIRUT)) FDAPRT
"RTN","PSOLSET",45,0)
P2 S IOP=$G(PSOLAP) D ^%ZIS K IOP I POP W $C(7),!?5,"Printer is busy.",! G LASK
"RTN","PSOLSET",46,0)
 U IO(0) W !,"Align labels so that a perforation is at the top of the",!,"print head and the left side is at column zero."
"RTN","PSOLSET",47,0)
 W ! K DIR,DIRUT,DUOUT,DTOUT S DIR(0)="E" D ^DIR K DIR,DTOUT,DUOUT I $D(DIRUT) D ^%ZISC G FDAPRT
"RTN","PSOLSET",48,0)
 D ^PSOLBLT D ^%ZISC
"RTN","PSOLSET",49,0)
 K DIRUT,DIR S DIR("A")="Is this correct",DIR("B")="YES",DIR(0)="Y"
"RTN","PSOLSET",50,0)
 S DIR("?")="Enter Y if labels are aligned correctly, N if they need to be aligned."
"RTN","PSOLSET",51,0)
 D ^DIR S:$D(DIRUT) PSOQUIT=1 G:Y!($D(DIRUT)) FDAPRT
"RTN","PSOLSET",52,0)
 G P2
"RTN","PSOLSET",53,0)
 ;
"RTN","PSOLSET",54,0)
FDAPRT ; FDA Med Guide Printer Selection
"RTN","PSOLSET",55,0)
 I $G(PSOBFLAG) G EXIT
"RTN","PSOLSET",56,0)
 N FDAPRT
"RTN","PSOLSET",57,0)
 S FDAPRT=$$SELPRT^PSOFDAUT($P($G(PSOFDAPT),"^")) I FDAPRT="^" G EXIT
"RTN","PSOLSET",58,0)
 S PSOFDAPT=FDAPRT
"RTN","PSOLSET",59,0)
 G EXIT
"RTN","PSOLSET",60,0)
 ; 
"RTN","PSOLSET",61,0)
LEAVE S XQUIT="" G FINAL
"RTN","PSOLSET",62,0)
Q W !?10,$C(7),"Default printer for labels must be entered." G LBL
"RTN","PSOLSET",63,0)
 ;
"RTN","PSOLSET",64,0)
EXIT D ^%ZISC Q:$G(PSOCLBL)
"RTN","PSOLSET",65,0)
 D:'$G(PSOBFLAG) GROUP K I,IOP,X,Y,%ZIS,DIC,J,DIR,X,Y,DTOUT,DIROUT,DIRUT,DUOUT Q
"RTN","PSOLSET",66,0)
 ;
"RTN","PSOLSET",67,0)
FINAL ;exit action from main menu - kill and quit
"RTN","PSOLSET",68,0)
 K SITE,PSOCP,PSNP,PSL,PRCA,PSLION,PSOPINST
"RTN","PSOLSET",69,0)
 K GROUPCNT,DISGROUP,PSOCAP,PSOINST,PSOION,PSONULBL,PSOSITE7,PFIO,PSOIOS,X,Y,PSOSYS,PSODIV,PSOPAR,PSOPAR7,PSOLAP,PSOPROP,PSOCLC,PSOCNT
"RTN","PSOLSET",70,0)
 K PSODTCUT,PSOSITE,PSOPRPAS,PSOBAR1,PSOBAR0,PSOBARS,SIG,DIR,DIRUT,DTOUT,DIROUT,DUOUT,I,%ZIS,DIC,J,PSOREL,PSOFDAPT
"RTN","PSOLSET",71,0)
 Q
"RTN","PSOLSET",72,0)
GROUP ;display group
"RTN","PSOLSET",73,0)
 S GROUPCNT=0,AGROUP="" I $D(^PS(59.3,0)) F  S AGROUP=$O(^PS(59.3,"B",AGROUP)) Q:AGROUP=""  D
"RTN","PSOLSET",74,0)
 .S GROUPCNT=GROUPCNT+1 I GROUPCNT=1 S AGROUP1=AGROUP
"RTN","PSOLSET",75,0)
 S:GROUPCNT=1 GRPNME=AGROUP1,II="" G:GROUPCNT>1 GROUP1
"RTN","PSOLSET",76,0)
 Q:'$D(GRPNME)  F  S II=$O(^PS(59.3,"B",GRPNME,II)) Q:II=""  S DISGROUP=II
"RTN","PSOLSET",77,0)
 K AGROUP,AGROUP1,GRPNME,II
"RTN","PSOLSET",78,0)
 Q
"RTN","PSOLSET",79,0)
GROUP1 W ! S DIC("A")="Bingo Board Display: ",DIC=59.3,DIC(0)="AEMQZ",DIR(0)="Y",DIR("?")="Enter 'Y' to select Bingo Board Display or 'N' to EXIT"
"RTN","PSOLSET",80,0)
 S:$P($G(^PS(59,PSOSITE,1)),"^",20) DIC("B")=$P($G(^PS(59,PSOSITE,1)),"^",20)
"RTN","PSOLSET",81,0)
 D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOLSET",82,0)
 I +Y<0 W $C(7) S DIR("A",1)="A 'BINGO BOARD DISPLAY' should be selected!",DIR("A")="Do you want to try again",DIR("B")="YES",DIR("?")="A display group must be defined in order to run Bingo Board." D ^DIR Q:"Y"'[$E(X)  G GROUP
"RTN","PSOLSET",83,0)
 S DISGROUP=+Y
"RTN","PSOLSET",84,0)
 K DIR,DIC,AGROUP,AGROUP1,GRPNME,II
"RTN","PSOLSET",85,0)
 Q
"RTN","PSOORAL1")
0^12^B61027800^B57889178
"RTN","PSOORAL1",1,0)
PSOORAL1 ;BHAM ISC/SAB - Build Listman activity logs ; 12/4/07 12:25pm
"RTN","PSOORAL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**71,156,148,247,240,287,354,367**;DEC 1997;Build 62
"RTN","PSOORAL1",3,0)
 N RX0,VALMCNT K DIR,DTOUT,DUOUT,DIRUT,^TMP("PSOAL",$J) S DA=$P(PSOLST(ORN),"^",2),RX0=^PSRX(DA,0),J=DA,RX2=$G(^(2)),R3=$G(^(3)),CMOP=$O(^PSRX(DA,4,0))
"RTN","PSOORAL1",4,0)
 S IEN=0,DIR(0)="LO^1:"_$S(CMOP:8,1:7),DIR("A",1)=" ",DIR("A",2)="Select Activity Log by  number",DIR("A",3)="1.  Refill      2.  Partial      3.  Activity     4.  Labels"
"RTN","PSOORAL1",5,0)
 S DIR("A")=$S(CMOP:"5.  Copay       6.  ECME         7.  CMOP Events  8.  All Logs",1:"5.  Copay       6.  ECME         7.  All Logs")
"RTN","PSOORAL1",6,0)
 S DIR("B")=$S(CMOP:8,1:7) D ^DIR S PSOELSE=+Y I +Y S Y=$S(CMOP&(Y[8):"1,2,3,4,5,6,7",'CMOP&(Y[7):"1,2,3,4,5,6",1:Y) S ACT=Y D FULL^VALM1 D
"RTN","PSOORAL1",7,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Rx #: "_$P(RX0,"^")_"   Original Fill Released: " I $P(RX2,"^",13) S DTT=$P(RX2,"^",13) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT K DAT,DTT
"RTN","PSOORAL1",8,0)
 .I $P(RX2,"^",15) S DTT=$P(RX2,"^",15) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"(Returned to Stock "_DAT_")" K DAT,DTT
"RTN","PSOORAL1",9,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Routing: "_$S($P(RX0,"^",11)="W":"Window",1:"Mail")_$S($P($G(^PSRX(DA,"OR1")),"^",5):"      Finished by: "_$P(^VA(200,$P(^PSRX(DA,"OR1"),"^",5),0),"^"),1:"")
"RTN","PSOORAL1",10,0)
 .D:$G(^PSRX(DA,"H"))]""&($P(PSOLST(ORN),"^",3)="HOLD") HLD^PSOORAL2
"RTN","PSOORAL1",11,0)
 .F LOG=1:1:$L(ACT,",") Q:$P(ACT,",",LOG)']""  S LBL=$P(ACT,",",LOG) D @$S(LBL=1:"RF^PSOORAL2",LBL=2:"PAR^PSOORAL2",LBL=3:"ACT",LBL=5:"COPAY",LBL=6:"ECME",LBL=7:"^PSORXVW2",1:"LBL")
"RTN","PSOORAL1",12,0)
 I 'PSOELSE S VALMBCK="" K PSOELSE Q 
"RTN","PSOORAL1",13,0)
 K ST0,RFL,RFLL,RFL1,II,J,N,PHYS,L1,DIRUT,PSDIV,PSEXDT,MED,M1,FFX,DTT,DAT,R3,RTN,SIG,STA,P1,PL,P0,Z0,Z1,EXDT,IFN,DIR,DUOUT,DTOUT,PSOELSE
"RTN","PSOORAL1",14,0)
 K LBL,I,RFDATE,%H,%I,RN,RFT
"RTN","PSOORAL1",15,0)
 S PSOAL=IEN K IEN,ACT,LBL,LOG D EN^PSOORAL S VALMBCK="R"
"RTN","PSOORAL1",16,0)
 Q
"RTN","PSOORAL1",17,0)
ACT ;activity log
"RTN","PSOORAL1",18,0)
 N CNT
"RTN","PSOORAL1",19,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Activity Log:"
"RTN","PSOORAL1",20,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Reason         Rx Ref         Initiator Of Activity",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL1",21,0)
 I '$O(^PSRX(DA,"A",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO Activity to report" Q
"RTN","PSOORAL1",22,0)
 S CNT=0
"RTN","PSOORAL1",23,0)
 F N=0:0 S N=$O(^PSRX(DA,"A",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D DAT D
"RTN","PSOORAL1",24,0)
 .I $P(P1,"^",2)="M" Q
"RTN","PSOORAL1",25,0)
 .S IEN=IEN+1,CNT=CNT+1,^TMP("PSOAL",$J,IEN,0)=CNT_"   "_DAT_"    ",$P(RN," ",15)=" ",REA=$P(P1,"^",2),REA=$F("HUCELPRWSIVDABXGKN",REA)-1
"RTN","PSOORAL1",26,0)
 .I REA D
"RTN","PSOORAL1",27,0)
 ..S STA=$P("HOLD^UNHOLD^DISCONTINUED^EDIT^RENEWED^PARTIAL^REINSTATE^REPRINT^SUSPENSE^RETURNED^INTERVENTION^DELETED^DRUG INTERACTION^PROCESSED^X-INTERFACE^PATIENT INSTR.^PKI/DEA^DISP COMPLETED^","^",REA)
"RTN","PSOORAL1",28,0)
 ..S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA_$E(RN,$L(STA)+1,15)
"RTN","PSOORAL1",29,0)
 .E  S $P(STA," ",15)=" ",^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA
"RTN","PSOORAL1",30,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSOORAL1",31,0)
 .S RFT=$S(RF>0&(RF<6):"REFILL "_RF,RF=6:"PARTIAL",RF>6:"REFILL "_(RF-1),1:"ORIGINAL")
"RTN","PSOORAL1",32,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$E(RN,$L(RFT)+1,15)_$S($D(^VA(200,+$P(P1,"^",3),0)):$P(^(0),"^"),1:$P(P1,"^",3))
"RTN","PSOORAL1",33,0)
 .;S:$P(P1,"^",5)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(P1,"^",5)
"RTN","PSOORAL1",34,0)
 .I $P(P1,"^",5)]"" N PSOACBRK,PSOACBRV D
"RTN","PSOORAL1",35,0)
 ..S PSOACBRV=$P(P1,"^",5)
"RTN","PSOORAL1",36,0)
 ..;PSO*7*240 Use fileman for parsing
"RTN","PSOORAL1",37,0)
 ..K ^UTILITY($J,"W") S X="Comments: "_PSOACBRV,(DIWR,DIWL)=1,DIWF="C80" D ^DIWP F I=1:1:^UTILITY($J,"W",1) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$G(^UTILITY($J,"W",1,I,0))
"RTN","PSOORAL1",38,0)
 .I $P($G(^PSRX(DA,"A",N,1)),"^")]"" S IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",5)=$P($G(^PSRX(DA,"A",N,1)),"^") I $P($G(^PSRX(DA,"A",N,1)),"^",2)]"" S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_":"_$P($G(^PSRX(DA,"A",N,1)),"^",2)
"RTN","PSOORAL1",39,0)
 .I $O(^PSRX(DA,"A",N,2,0)) F I=0:0 S I=$O(^PSRX(DA,"A",N,2,I)) Q:'I  S MIG=^PSRX(DA,"A",N,2,I,0) D
"RTN","PSOORAL1",40,0)
 ..S:MIG["Mail Tracking Info.: " IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",9)=" "
"RTN","PSOORAL1",41,0)
 ..F SG=1:1:$L(MIG) S:$L(^TMP("PSOAL",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",9)=" " S:$P(MIG," ",SG)'="" ^TMP("PSOAL",$J,IEN,0)=$G(^TMP("PSOAL",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORAL1",42,0)
 K MIG,SG,I,^UTILITY($J,"W"),DIWF,DIWL,DIWR
"RTN","PSOORAL1",43,0)
 Q
"RTN","PSOORAL1",44,0)
LBL ;label log
"RTN","PSOORAL1",45,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Label Log:"
"RTN","PSOORAL1",46,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Rx Ref                    Printed By",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL1",47,0)
 I '$O(^PSRX(DA,"L",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Labels printed." Q
"RTN","PSOORAL1",48,0)
 F L1=0:0 S L1=$O(^PSRX(DA,"L",L1)) Q:'L1  S LBL=^PSRX(DA,"L",L1,0),DTT=$P(^(0),"^") D DAT D
"RTN","PSOORAL1",49,0)
 . S $P(RN," ",26)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=L1_"   "_DAT_"    ",RFT=$S($P(LBL,"^",2):"REFILL "_$P(LBL,"^",2),1:"ORIGINAL"),RFT=RFT_$E(RN,$L(RFT)+1,26)
"RTN","PSOORAL1",50,0)
 . S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$P($G(^VA(200,$P(LBL,"^",4),0)),"^"),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(LBL,"^",3)
"RTN","PSOORAL1",51,0)
 . N FDAMGDOC S FDAMGDOC=$G(^PSRX(DA,"L",L1,"FDA"))
"RTN","PSOORAL1",52,0)
 . I FDAMGDOC'="" D
"RTN","PSOORAL1",53,0)
 . . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="FDA Med Guide: "_$E(FDAMGDOC,1,61)
"RTN","PSOORAL1",54,0)
 . . I $L(FDAMGDOC)>61 D
"RTN","PSOORAL1",55,0)
 . . . F  Q:$E(FDAMGDOC,62,999)=""  D
"RTN","PSOORAL1",56,0)
 . . . . S FDAMGDOC=$E(FDAMGDOC,62,999),IEN=IEN+1
"RTN","PSOORAL1",57,0)
 . . . . S ^TMP("PSOAL",$J,IEN,0)=$E(FDAMGDOC,1,61)
"RTN","PSOORAL1",58,0)
 Q
"RTN","PSOORAL1",59,0)
 ;
"RTN","PSOORAL1",60,0)
COPAY ;Copay activity log
"RTN","PSOORAL1",61,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Copay Activity Log:"
"RTN","PSOORAL1",62,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Reason               Rx Ref         Initiator Of Activity",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL1",63,0)
 I '$O(^PSRX(DA,"COPAY",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO Copay activity to report" Q
"RTN","PSOORAL1",64,0)
 F N=0:0 S N=$O(^PSRX(DA,"COPAY",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D DAT D
"RTN","PSOORAL1",65,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"    ",$P(RN," ",21)=" ",REA=$P(P1,"^",2),REA=$F("ARICE",REA)-1
"RTN","PSOORAL1",66,0)
 .I REA D
"RTN","PSOORAL1",67,0)
 ..S STA=$P("ANNUAL CAP REACHED^COPAY RESET^IB-INITIATED COPAY^REMOVE COPAY CHARGE^RX EDITED^","^",REA)
"RTN","PSOORAL1",68,0)
 ..S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA_$E(RN,$L(STA)+1,21)
"RTN","PSOORAL1",69,0)
 .E  S $P(STA," ",21)=" ",^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA
"RTN","PSOORAL1",70,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSOORAL1",71,0)
 .S RFT=$S(RF>0:"REFILL "_RF,1:"ORIGINAL")
"RTN","PSOORAL1",72,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$E(RN,$L(RFT)+1,15)_$S($D(^VA(200,+$P(P1,"^",3),0)):$P(^(0),"^"),1:$P(P1,"^",3))
"RTN","PSOORAL1",73,0)
 .S:$P(P1,"^",5)]""!($P(P1,"^",6)]"")!($P(P1,"^",7)]"") IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comment: "_$P(P1,"^",5)
"RTN","PSOORAL1",74,0)
 .I $P(P1,"^",6)]"" S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"  Old value="_$P(P1,"^",6)_"   New value="_$P(P1,"^",7)
"RTN","PSOORAL1",75,0)
 Q
"RTN","PSOORAL1",76,0)
 ;
"RTN","PSOORAL1",77,0)
ECME ; ECME activity log
"RTN","PSOORAL1",78,0)
 N N,P1,RFT,PSOACBRK,PSOACBRV,MIG,SG,I,NOTFND,CNT,LINE
"RTN","PSOORAL1",79,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="ECME Log:"
"RTN","PSOORAL1",80,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date/Time           Rx Ref          Initiator Of Activity"
"RTN","PSOORAL1",81,0)
 S IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL1",82,0)
 S NOTFND=1,I=0 F  S I=$O(^PSRX(DA,"A",I)) Q:'I  S Z=$G(^PSRX(DA,"A",I,0)) I $P(Z,"^",2)="M" S NOTFND=0 Q
"RTN","PSOORAL1",83,0)
 I NOTFND S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO ECME Activity to report" Q
"RTN","PSOORAL1",84,0)
 S CNT=0
"RTN","PSOORAL1",85,0)
 F N=0:0 S N=$O(^PSRX(DA,"A",N)) Q:'N  S P1=^(N,0) D
"RTN","PSOORAL1",86,0)
 .I $P(P1,"^",2)'="M" Q
"RTN","PSOORAL1",87,0)
 .S IEN=IEN+1,CNT=CNT+1
"RTN","PSOORAL1",88,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSOORAL1",89,0)
 .S LINE=CNT,$E(LINE,5)=$$FMTE^XLFDT($P(P1,"^"),2),$E(LINE,25)=$S(RF:"REFILL "_RF,1:"ORIGINAL")
"RTN","PSOORAL1",90,0)
 .S $E(LINE,41)=$$GET1^DIQ(200,+$P(P1,"^",3),.01)
"RTN","PSOORAL1",91,0)
 .S ^TMP("PSOAL",$J,IEN,0)=LINE
"RTN","PSOORAL1",92,0)
 .I $P(P1,"^",5)]"" D
"RTN","PSOORAL1",93,0)
 ..S PSOACBRV=$P(P1,"^",5)
"RTN","PSOORAL1",94,0)
 ..;PSO*7*240 Use fileman for parsing
"RTN","PSOORAL1",95,0)
 ..K ^UTILITY($J,"W") S X="Comments: "_PSOACBRV,(DIWR,DIWL)=1,DIWF="C80" D ^DIWP F I=1:1:^UTILITY($J,"W",1) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$G(^UTILITY($J,"W",1,I,0))
"RTN","PSOORAL1",96,0)
 .I $O(^PSRX(DA,"A",N,2,0)) F I=0:0 S I=$O(^PSRX(DA,"A",N,2,I)) Q:'I  S MIG=^PSRX(DA,"A",N,2,I,0) D
"RTN","PSOORAL1",97,0)
 ..F SG=1:1:$L(MIG) D
"RTN","PSOORAL1",98,0)
 ...S:$L(^TMP("PSOAL",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",9)=" "
"RTN","PSOORAL1",99,0)
 ...S:$P(MIG," ",SG)'="" ^TMP("PSOAL",$J,IEN,0)=$G(^TMP("PSOAL",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORAL1",100,0)
 D DISPREJ
"RTN","PSOORAL1",101,0)
 K ^UTILITY($J,"W"),DIWR,DIWF,DIWL
"RTN","PSOORAL1",102,0)
 Q
"RTN","PSOORAL1",103,0)
 ;
"RTN","PSOORAL1",104,0)
DISPREJ  ;
"RTN","PSOORAL1",105,0)
 N LN,SEQ,REJ,PRI,VAR,X,X1,X2,I,RFT
"RTN","PSOORAL1",106,0)
 I '$D(^PSRX(DA,"REJ")) Q
"RTN","PSOORAL1",107,0)
 S PRI="PSOAL",$P(LN,"=",80)="",SEQ=0
"RTN","PSOORAL1",108,0)
 S IEN=$G(IEN)+1,^TMP(PRI,$J,IEN,0)=" "
"RTN","PSOORAL1",109,0)
 S IEN=IEN+1,^TMP(PRI,$J,IEN,0)="ECME REJECT Log:"
"RTN","PSOORAL1",110,0)
 S IEN=IEN+1,^TMP(PRI,$J,IEN,0)="#  Date/Time Rcvd    Rx Ref    Reject Type     STATUS     Date/Time Resolved"
"RTN","PSOORAL1",111,0)
 S IEN=IEN+1,^TMP(PRI,$J,IEN,0)=LN
"RTN","PSOORAL1",112,0)
 F REJ=0:0 S REJ=$O(^PSRX(DA,"REJ",REJ)) Q:'REJ  D
"RTN","PSOORAL1",113,0)
 . S VAR=$G(^PSRX(DA,"REJ",REJ,0))
"RTN","PSOORAL1",114,0)
 . S RFT=+$P(VAR,"^",4)
"RTN","PSOORAL1",115,0)
 . S SEQ=SEQ+1,X=SEQ,$E(X,4)=$$FMTE^XLFDT($P(VAR,"^",2),2),$E(X,22)=$S(RFT:"REFILL "_RFT,1:"ORIGINAL")
"RTN","PSOORAL1",116,0)
 . S $E(X,32)=$S(+VAR=79:"REFILL TOO SOON",+VAR=88:"DUR",1:$E($$EXP^PSOREJP1($P(VAR,"^",1)),1,15))  ;can't + default because values can be 07, 08, etc.
"RTN","PSOORAL1",117,0)
 . S $E(X,48)=$S($P(VAR,"^",5):"RESOLVED",1:"UNRESOLVED")
"RTN","PSOORAL1",118,0)
 . S:$P(VAR,"^",6) $E(X,59)=$$FMTE^XLFDT($P(VAR,"^",6),2)
"RTN","PSOORAL1",119,0)
 . ; S:$P(VAR,"^",14) $E(X,67)="(RE-OPENED)"
"RTN","PSOORAL1",120,0)
 . S IEN=IEN+1,^TMP(PRI,$J,IEN,0)=X
"RTN","PSOORAL1",121,0)
 . I $P(VAR,"^",5) D
"RTN","PSOORAL1",122,0)
 . . S IEN=IEN+1,X=$$GET1^DIQ(52.25,REJ_","_DA,12)
"RTN","PSOORAL1",123,0)
 . . S X1=$$GET1^DIQ(52.25,REJ_","_DA,13) S:X1'="" X=X1_" ("_X_")"
"RTN","PSOORAL1",124,0)
 . . F I=1:1 Q:X=""  D
"RTN","PSOORAL1",125,0)
 . . . S ^TMP(PRI,$J,IEN,0)=$S(I=1:"Comments: ",1:"          ")_$E(X,1,69)
"RTN","PSOORAL1",126,0)
 . . . S X=$E(X,70,999) S:X'="" IEN=IEN+1
"RTN","PSOORAL1",127,0)
 Q
"RTN","PSOORAL1",128,0)
 ;
"RTN","PSOORAL1",129,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSOORAL1",130,0)
 Q
"RTN","PSORXL")
0^2^B123167297^B108590607
"RTN","PSORXL",1,0)
PSORXL ;BHAM ISC/SAB - action to be taken on prescriptions ;10/15/08 2:12pm
"RTN","PSORXL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,21,24,32,47,135,148,287,334,251,354,367**;DEC 1997;Build 62
"RTN","PSORXL",3,0)
 ;External reference to File #50 supported by DBIA 221
"RTN","PSORXL",4,0)
 ;External references CHPUS^IBACUS and TRI^IBACUS supported by DBIA 2030
"RTN","PSORXL",5,0)
 I $G(PSOTRVV),$G(PPL) S PSORX("PSOL",1)=PPL K PPL
"RTN","PSORXL",6,0)
 N SLBL,PSOSONE,PSOKLRXS,PSOSKIP S PSOSKIP=1
"RTN","PSORXL",7,0)
 S:'$G(PPL) PPL=$G(PSORX("PSOL",1)) G:$P(PSOPAR,"^",26) P
"RTN","PSORXL",8,0)
LBL ;
"RTN","PSORXL",9,0)
 I $G(PPL) N PSOCKDC S PSOCKDC=1 D ECME^PSORXL1 I '$G(PPL) S PPL="" G RXSQUIT  ;*334 ;don't prompt to print labels for DC'ed Rx's
"RTN","PSORXL",10,0)
 W !! S DIR("A",1)="Label Printer: "_$S($G(SUSPT):PSLION,1:$G(PSOLAP))
"RTN","PSORXL",11,0)
 I $$GET1^DIQ(59,PSOSITE,134)'="" D
"RTN","PSORXL",12,0)
 . I $G(PSOFDAPT)="" S PSOFDAPT=$$DEFPRT^PSOFDAUT(PSOSITE)
"RTN","PSORXL",13,0)
 . S DIR("A",2)="FDA Med Guide Printer: "_$S($G(PSOFDAPT)="":"HOME",1:$P(PSOFDAPT,"^"))
"RTN","PSORXL",14,0)
 S DIR("A")="LABEL: QUEUE/CHANGE PRINTER"_$S($P(PSOPAR,"^",23):"/HOLD",1:"")_$S($P(PSOPAR,"^",24):"/SUSPEND",1:"")_$S($P(PSOPAR,"^",26):"/LABEL",1:"")_" or '^' to bypass "
"RTN","PSORXL",15,0)
 S DIR("?",1)="Enter 'Q' to queue labels to print",DIR("?")="Enter '^' to bypass label functions",DIR("?",4)="Enter 'S' to suspend labels to print later"
"RTN","PSORXL",16,0)
 S DIR("?",2)="Enter 'H' to hold label until Rx can be filled",DIR("?",3)="Enter 'P' for Rx profile"
"RTN","PSORXL",17,0)
 S DIR("?",5)="Enter 'C' to select another label printer"
"RTN","PSORXL",18,0)
 S:$P(PSOPAR,"^",26) DIR("?",5)="Enter 'L' to print labels without queuing"
"RTN","PSORXL",19,0)
TRI ;Tricare
"RTN","PSORXL",20,0)
 S X="IBACUS" X ^%ZOSF("TEST") K X I '$T G PASS
"RTN","PSORXL",21,0)
 I '$$TRI^IBACUS() G PASS
"RTN","PSORXL",22,0)
 I '$D(PSORX("PSOL",1))!($G(PSOSUREP))!($G(PSOEXREP)) G PASS
"RTN","PSORXL",23,0)
 N GGG,PBILL,PSTRD,PSTRDZ,PSTRF,PSTRP,TRXI,TRIRX,PSTRIVAR,VV,VVV,VVCT
"RTN","PSORXL",24,0)
 D DEV^PSOCPTRI
"RTN","PSORXL",25,0)
 K ^TMP($J,"PSONOB"),^TMP($J,"PSOBILL")
"RTN","PSORXL",26,0)
 S VVCT=0 F VV=0:0 S VV=$O(PSORX("PSOL",VV)) Q:'VV  F VVV=1:1 S TRXI=$P(PSORX("PSOL",VV),",",VVV) Q:'TRXI  D
"RTN","PSORXL",27,0)
 .I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSORXL",28,0)
 .I $P($G(^PSRX(+TRXI,"STA")),"^")=3 Q
"RTN","PSORXL",29,0)
 .S PSTRP=$P($G(^PSRX(+TRXI,0)),"^",2),PSTRD=+$G(PSOSITE),PSTRDZ=+$G(DUZ)
"RTN","PSORXL",30,0)
 .S PSTRF=0 F GGG=0:0 S GGG=$O(^PSRX(+TRXI,1,GGG)) Q:'GGG  S PSTRF=GGG
"RTN","PSORXL",31,0)
 .S VVCT=VVCT+1
"RTN","PSORXL",32,0)
 .I $G(RXRP(TRXI))!($G(RXPR(TRXI)))!($G(RXRH(TRXI))) S ^TMP($J,"PSONOB",VVCT)=TRXI Q
"RTN","PSORXL",33,0)
 .S PBILL=$$CHPUS^IBACUS(PSTRP,DT,TRXI,PSTRF,PSOLAP,PSTRD,PSTRDZ) S ^TMP($J,$S($G(PBILL):"PSOBILL",1:"PSONOB"),VVCT)=TRXI
"RTN","PSORXL",34,0)
 I '$D(^TMP($J,"PSOBILL")) K ^TMP($J,"PSONOB") G PASS
"RTN","PSORXL",35,0)
 I '$D(^TMP($J,"PSONOB")),$D(^TMP($J,"PSOBILL")) S (Y,LBL)="H" G H1
"RTN","PSORXL",36,0)
 ;If some Rx's are billable, and some are not
"RTN","PSORXL",37,0)
SETP K PSORX("PSOL"),PPL S VVCT=1 F VV=0:0 S VV=$O(^TMP($J,$S($G(PSTRIVAR):"PSONOB",1:"PSOBILL"),VV)) Q:'VV  S TRIRX=^TMP($J,$S($G(PSTRIVAR):"PSONOB",1:"PSOBILL"),VV) I +TRIRX D
"RTN","PSORXL",38,0)
 .I $G(PSORX("PSOL",1))="" S PSORX("PSOL",1)=TRIRX_"," Q
"RTN","PSORXL",39,0)
 .I $L(PSORX("PSOL",VVCT))+$L(TRIRX)<220 S PSORX("PSOL",VVCT)=PSORX("PSOL",VVCT)_TRIRX_"," Q
"RTN","PSORXL",40,0)
 .S VVCT=VVCT+1 S PSORX("PSOL",VVCT)=TRIRX_","
"RTN","PSORXL",41,0)
 I '$G(PSTRIVAR) S (Y,LBL)="H" S PSOKLRXS=1 K PSORSAVE,PSOPSAVE,PSOHSAVE D RSAVE D H1 D RREST K PSORSAVE,PSOPSAVE,PSOHSAVE K PSOKLRXS S PSTRIVAR=1 G SETP
"RTN","PSORXL",42,0)
 K ^TMP($J,"PSONOB") S PPL=$G(PSORX("PSOL",1))
"RTN","PSORXL",43,0)
PASS ;
"RTN","PSORXL",44,0)
 I $E($G(DIR("A")),1,6)'="LABEL:" D RESDIR^PSOCPTRI
"RTN","PSORXL",45,0)
 S DIR(0)="SA^P:PROFILE;Q:QUEUE;C:CHANGE PRINTER"_$S($P(PSOPAR,"^",23):";H:HOLD",1:"")_$S($P(PSOPAR,"^",24):";S:SUSPENSE",1:"")_$S($P(PSOPAR,"^",26):";L:PRINT",1:""),DIR("B")="Q" D ^DIR D  G:$D(DIRUT)!($D(DUOUT)) EX
"RTN","PSORXL",46,0)
 .I $D(DIRUT)!($D(DUOUT)) D AL^PSOLBL("UT") I $G(PSOEXREP) S PSOEXREX=1
"RTN","PSORXL",47,0)
 .I $G(PSOPULL) I $D(DIRUT)!($D(DUOUT)) S PSOQFLAG=1
"RTN","PSORXL",48,0)
 S:$G(PSOBEDT) NOPP=Y
"RTN","PSORXL",49,0)
 I $G(Y)="C" K PSOCLBL,%ZIS("B") S PSOCLBL=1 D @$S('$D(PSOPAR):"^PSOLSET",1:"PLBL^PSOLSET") K PSOCLBL G LBL
"RTN","PSORXL",50,0)
 I $G(Y)="Q",$D(RXRS),'$G(PSOPULL) D PPLADD^PSOSUPOE
"RTN","PSORXL",51,0)
 I $G(PSXSYS),($G(Y)'="H"),($G(Y)'="P"),('$G(PSOEXREP)) S LBL=Y,(RXLTOP,PPL1)=1 S:'$G(PSOPULL) SLBL=Y D A^PSOCMOP G:'$G(PPL) D1
"RTN","PSORXL",52,0)
 K DIR S LBL=Y S:'$G(PSOPULL) SLBL=Y G Q:Y="Q",S:Y="S",H1:Y="H",P:Y="L" I Y="P" W ! S PSDFN=DFN,PSFROM="" D ^PSODSPL K PSDFN,PSFROM G LBL
"RTN","PSORXL",53,0)
EX I $D(DUOUT)!$D(DIRUT) K BINGCRT,BINGRTE,BBRX,BBFLG S:$D(RXRS) SLBL="^" G:$D(RXRS) RXS K DIR,X,DIRUT,DUOUT,ACT,Y,DTOUT,PPL,REPRINT S NOBG=1 G RXSQUIT  ;*334
"RTN","PSORXL",54,0)
Q S PPL1=1 G:$G(PPL)']"" D1 S PSNP=0,PSL=1 D  I $G(PSOFROM)="NEW",$P(PSOPAR,"^",8) S PSNP=1
"RTN","PSORXL",55,0)
 .Q:'$P(PSOPAR,"^",8)!($G(PSONOPRT))
"RTN","PSORXL",56,0)
 .F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL!($G(PSNP))  I '$O(^PSRX(SLPPL,1,0)),'$D(RXPR(SLPPL)) S PSNP=1
"RTN","PSORXL",57,0)
 I $G(PSOLAP)]"",$G(PSOLAP)'=ION G Q2
"RTN","PSORXL",58,0)
Q1 W ! K POP S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A")
"RTN","PSORXL",59,0)
 G:$G(POP)&($G(PSPARTXX)) RXSQUIT G:$G(POP)&($G(PSOSONE)) RXSQ D:$G(POP)&($G(PSONOPRT))
"RTN","PSORXL",60,0)
 .S PSOQFLAG=1
"RTN","PSORXL",61,0)
 G:$G(PSOQFLAG) RXSQUIT G:POP!(IO=IO(0)) LBL S PSOLAP=ION  ;*334
"RTN","PSORXL",62,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSORXL",63,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",10)
"RTN","PSORXL",64,0)
 D ^%ZISC S PSL=0
"RTN","PSORXL",65,0)
Q2 ; Checking FDA Med Guide printer
"RTN","PSORXL",66,0)
 I ($$GET1^DIQ(59,PSOSITE,134)="")!($G(PSOEXREP)&'$G(PSOMGREP))!'$$FDARX(PPL)!($G(PSOSKIP)&($G(PSOFDAPT)'="")) G QLBL
"RTN","PSORXL",67,0)
 I $G(PSOEXREP),'$G(PSOMGREP) G QLBL
"RTN","PSORXL",68,0)
 N FDAPRT S FDAPRT=""
"RTN","PSORXL",69,0)
 F  D  Q:FDAPRT'=""!(FDAPRT="^")
"RTN","PSORXL",70,0)
 . S FDAPRT=$$SELPRT^PSOFDAUT($P($G(PSOFDAPT),"^"))
"RTN","PSORXL",71,0)
 . I FDAPRT="" W $C(7),!,"You must select a valid FDA Medication Guide printer."
"RTN","PSORXL",72,0)
 I FDAPRT="^"!(FDAPRT="") G LBL
"RTN","PSORXL",73,0)
 S PSOFDAPT=FDAPRT
"RTN","PSORXL",74,0)
 ;
"RTN","PSORXL",75,0)
QLBL I $G(PSXSYS),('$G(RXLTOP)),('$G(PSOEXREP)) D RXL^PSOCMOP G:'$G(PPL) D1
"RTN","PSORXL",76,0)
 ;
"RTN","PSORXL",77,0)
 ;- Submitting list of Rx to ECME for DUR/79 REJECT check and possible submission to 3rd Pary Payer
"RTN","PSORXL",78,0)
 D ECME^PSORXL1 I '$G(PPL) W !!,"No Label(s) printed.",!! S PSOQFLAG=1 G RXSQUIT  ;*334
"RTN","PSORXL",79,0)
 ;
"RTN","PSORXL",80,0)
 S ZTRTN="DQ^PSOLBL",ZTIO=$S($G(SUSPT):PSLION,1:PSOLAP),ZTDTH=$S($G(PSOTIME):PSOTIME,1:$H),PDUZ=DUZ,OPAIO=ZTIO
"RTN","PSORXL",81,0)
 S ZTDESC="Outpatient Pharmacy "_$S($G(SUSPT):"SUSPENSE ",$G(DG):"DRUG INTERACTION ",1:"")_"LABELS OUTPUT ROUTINE"
"RTN","PSORXL",82,0)
 F G="PPL1","PSOSYS","DFN","PSOPAR","PDUZ","PCOMX",$S($G(SUSPT):"PFION",1:"PSOLAP"),"PPL" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",83,0)
 F G="RXY","PSOSITE","COPIES","SIDE","PSOSUSPR","PSOBARS","PSOBAR1","PSOBAR0","PSODELE" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",84,0)
 F G="PSOPULL","PSTAT","PSODBQ","PSOEXREP","PSOTREP","PSOFDAPT","PSOMGREP" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",85,0)
 S ZTSAVE("PSORX(")="",ZTSAVE("RXRP(")="",ZTSAVE("RXPR(")="",ZTSAVE("RXRS(")="",ZTSAVE("RXFL(")="",ZTSAVE("PCOMH(")=""
"RTN","PSORXL",86,0)
 D ^%ZISC,^%ZTLOAD K:$G(PSOSONE) RXRS
"RTN","PSORXL",87,0)
 I $D(ZTSK)&('$G(SUSPT))&('$G(PSOEXREP)) D
"RTN","PSORXL",88,0)
 . W !!,"LABEL(S) QUEUED TO PRINT",!!
"RTN","PSORXL",89,0)
 . D OPAI
"RTN","PSORXL",90,0)
 K OPAIO
"RTN","PSORXL",91,0)
 G:$G(PSPARTXX) RXSQUIT K G,PDUZ K:'$G(SUSPT) ZTSK G:$G(DG) RXSQUIT  ;*334
"RTN","PSORXL",92,0)
 G:'$G(PSNP) QUEUP G:$G(PSOPRFLG) QUEUP S HOLDRPAS=$G(PSOPRPAS),PSOPRPAS=$P(PSOPAR,"^",13)
"RTN","PSORXL",93,0)
PLBL S PSOION=ION
"RTN","PSORXL",94,0)
 I '$D(PSOPROP)!($G(PSOPROP)=ION) W $C(7),!,"PROFILES MUST BE SENT TO PRINTER !!",! K IOP,%ZIS,IO("Q"),POP S %ZIS="MNQ",%ZIS("A")="Select PROFILE DEVICE: " D ^%ZIS K %ZIS("A") G:POP QUEUP G:$E(IOST)["C"!(PSOION=ION) PLBL S PSOPROP=ION
"RTN","PSORXL",95,0)
QPRF S ZTRTN="DQ^PSOPRF",ZTIO=PSOPROP,ZTDESC="Outpatient Pharmacy "_$S($G(SUSPT):"SUSPENSE ",1:"")_"PATIENT PROFILES",ZTDTH=$S($G(PSOTIME):PSOTIME,1:$H)
"RTN","PSORXL",96,0)
 F G="PSOPAR","PSODTCUT","PSOPRPAS","DFN","PSOSITE","NEW1","NEW11","PSOBMST","PFIO","PPL" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",97,0)
 D ^%ZTLOAD W:$D(ZTSK)&('$G(SUSPT))&('$G(PSOEXREP)) !,"PROFILE IS QUEUED TO PRINT",!! K G K:'$G(SUSPT) ZTSK D ^%ZISC
"RTN","PSORXL",98,0)
QUEUP D:$G(POP)&($G(PSONOPRT))  G:$G(PSOQFLAG) RXSQUIT S PSNP=0,PSOPRPAS=$G(HOLDRPAS) K:PSOPRPAS']"" PSOPRPAS K HOLDRPAS G D1  ;*334
"RTN","PSORXL",99,0)
 .S PSOQFLAG=1
"RTN","PSORXL",100,0)
 Q
"RTN","PSORXL",101,0)
 ;
"RTN","PSORXL",102,0)
S G S^PSORXL1
"RTN","PSORXL",103,0)
SUS S X="IBACUS" X ^%ZOSF("TEST") K X I '$T G SUSL1
"RTN","PSORXL",104,0)
 N TRIDA S TRIDA=DA I '$$TRI^IBACUS() S DA=TRIDA G SUSL1
"RTN","PSORXL",105,0)
 I $G(RXRP(TRIDA))!($G(RXPR(TRIDA)))!($G(RXRH(TRIDA))) S DA=TRIDA G SUSL1
"RTN","PSORXL",106,0)
 N PBILL,PSTRD,PSTRDZ,PSTRF,PSTRP,GGG
"RTN","PSORXL",107,0)
 D DEV^PSOCPTRI
"RTN","PSORXL",108,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSORXL",109,0)
 S PSTRP=$P($G(^PSRX(+TRIDA,0)),"^",2),PSTRD=+$G(PSOSITE),PSTRDZ=+$G(DUZ)
"RTN","PSORXL",110,0)
 S PSTRF=0 F GGG=0:0 S GGG=$O(^PSRX(+TRIDA,1,GGG)) Q:'GGG  S PSTRF=GGG
"RTN","PSORXL",111,0)
 S PBILL=$$CHPUS^IBACUS(PSTRP,DT,TRIDA,PSTRF,PSOLAP,PSTRD,PSTRDZ)
"RTN","PSORXL",112,0)
 I '$G(PBILL) S DA=TRIDA G SUSL1
"RTN","PSORXL",113,0)
 S FLD(99)="99",FLD(99.1)="Awaiting CHAMPUS billing approval"
"RTN","PSORXL",114,0)
 N RSDT,ACT,PSUS,RXF,RFN,I,PSDA,NOW,IR,FDA
"RTN","PSORXL",115,0)
 S DA=TRIDA D H^PSOCPTRH
"RTN","PSORXL",116,0)
 Q
"RTN","PSORXL",117,0)
SUSL1 G SUS^PSORXL1
"RTN","PSORXL",118,0)
H1 S PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",PPL1))
"RTN","PSORXL",119,0)
 D:'$D(^TMP($J,"PSOBILL")) NOOR^PSOHLD I $D(DIRUT) K DIRUT G PSORXL
"RTN","PSORXL",120,0)
 I $D(^TMP($J,"PSOBILL")) S FLD(99)="99",FLD(99.1)="Awaiting CHAMPUS billing approval" G H
"RTN","PSORXL",121,0)
 G:$G(PPL)']"" D1 D FLD^PSOHLD I $D(DUOUT)!($D(DIRUT)) K DIRUT,DUOUT,FLD,DIR G LBL
"RTN","PSORXL",122,0)
H K SPPL G:$D(DTOUT) D1 S SPPL="" F PI=1:1 Q:$P(PPL,",",PI)=""  D
"RTN","PSORXL",123,0)
 .S DA=$P(PPL,",",PI) I $P(^PSRX(DA,"STA"),"^")<10,$P(^("STA"),"^")'=4 D @$S($D(^TMP($J,"PSOBILL")):"H^PSOCPTRH",1:"H^PSOHLD") Q
"RTN","PSORXL",124,0)
 .I $P(^PSRX(DA,"STA"),"^")=4 S SPPL=SPPL_DA_"," Q
"RTN","PSORXL",125,0)
 I $G(SPPL)]"" D
"RTN","PSORXL",126,0)
 .W !!,$C(7),"Drug Interaction Rx(s) " F I=1:1 Q:$P(SPPL,",",I)=""  W $P(^PSRX($P(SPPL,",",I),0),"^")_", "
"RTN","PSORXL",127,0)
 .S PPL=SPPL,DG=1 D Q K DG,SPPL
"RTN","PSORXL",128,0)
D1 K RXLTOP I $G(PPL1),$O(PSORX("PSOL",$G(PPL1))) S PPL1=$O(PSORX("PSOL",PPL1)),PPL=PSORX("PSOL",PPL1) G @$S(LBL="H":"H",LBL="L":"P1",1:"QLBL")
"RTN","PSORXL",129,0)
RXS I $D(RXRS),'$G(PSOKLRXS) I $G(SLBL)="H"!($G(SLBL)="S")!($G(SLBL)="^")!($G(SLBL)="") D  G:$G(PPL)'="" Q
"RTN","PSORXL",130,0)
 .K PPL,PSORX("PSOL") S PSOSONE=1 D PPLADD^PSOSUPOE
"RTN","PSORXL",131,0)
 .Q:$G(PPL)=""  W !!,"You have selected the following Rx(s) to be pulled from suspense:",!
"RTN","PSORXL",132,0)
 .F RXSS=0:0 S RXSS=$O(RXRS(RXSS)) Q:'RXSS  W !," Rx # ",$P($G(^PSRX(+$G(RXSS),0)),"^"),?23,$P($G(^PSDRUG(+$P($G(^PSRX(+$G(RXSS),0)),"^",6),0)),"^")
"RTN","PSORXL",133,0)
 .K DIR W ! S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you still want to pull these Rx(s) from suspense" D ^DIR K DIR I Y'=1 W !!,"Rx(s) will remain in Suspense!",! D RESET^PSOSUPOE K RXRS,PPL
"RTN","PSORXL",134,0)
RXSQUIT K:'$G(PSOKLRXS) RXRS K ^TMP($J,"PSOBILL"),RXPR,RXRP,RXRH,RXSS,LBL,PPL1,PPL,DIR,%DT,%,SD,COUNT,EXDT,L,PDUZ,REF,REPRINT,RFDATE,RFL1,RFLL,RXN,WARN,ZY,FLD,PI,ZD,ACT,X,Y,DIRUT,DUOUT,DTOUT,DIROUT Q  ;*334 ADDED TAG NAME
"RTN","PSORXL",135,0)
P S PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",1)) G:$G(PPL)']"" D1
"RTN","PSORXL",136,0)
 I $G(PSOLAP)']"" W ! K POP,ZTSK S %ZIS="M",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS K %ZIS("A") G:POP LBL S PSOLAP=ION
"RTN","PSORXL",137,0)
 S IOP=PSOLAP D ^%ZIS
"RTN","PSORXL",138,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSORXL",139,0)
P1 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",10),PDUZ=DUZ D DQ1^PSOLBL,^%ZISC
"RTN","PSORXL",140,0)
 G:'$P(PSOPAR,"^",8)!(+$G(REPRINT))!($G(PSOFROM)'="NEW") D1 I $G(PSOPROP)']"" S PSOION=ION,%ZIS="M",%ZIS("A")="Select PROFILE DEVICE: " D ^%ZIS K %ZIS("A") G:POP D1 S PSOPROP=ION
"RTN","PSORXL",141,0)
 S IOP=PSOPROP D ^%ZIS D DQ^PSOPRF,^%ZISC G D1
"RTN","PSORXL",142,0)
 Q
"RTN","PSORXL",143,0)
RXSQ K RXRS G RXS
"RTN","PSORXL",144,0)
 Q
"RTN","PSORXL",145,0)
FDARX(PPL) ; Check if any Rx to be printed has an FDA Med Guide
"RTN","PSORXL",146,0)
 N FDARX,FDARXIEN,I S FDARX=0
"RTN","PSORXL",147,0)
 F I=1:1:$L($G(PPL),",") D  Q:FDARX
"RTN","PSORXL",148,0)
 . S FDARXIEN=+$P(PPL,",",I) I 'FDARXIEN Q
"RTN","PSORXL",149,0)
 . I $D(RXRP(FDARXIEN)),'$D(RXRP(FDARXIEN,"MG")) Q
"RTN","PSORXL",150,0)
 . I FDARXIEN,$$MGONFILE^PSOFDAUT(FDARXIEN) S FDARX=1
"RTN","PSORXL",151,0)
 Q FDARX
"RTN","PSORXL",152,0)
 ;
"RTN","PSORXL",153,0)
RSAVE N PMX
"RTN","PSORXL",154,0)
 S PMX="" F  S PMX=$O(RXRP(PMX)) Q:PMX=""  S PSORSAVE(PMX)=RXRP(PMX)
"RTN","PSORXL",155,0)
 S PMX="" F  S PMX=$O(RXPR(PMX)) Q:PMX=""  S PSOPSAVE(PMX)=RXPR(PMX)
"RTN","PSORXL",156,0)
 S PMX="" F  S PMX=$O(RXRH(PMX)) Q:PMX=""  S PSOHSAVE(PMX)=RXRH(PMX)
"RTN","PSORXL",157,0)
 Q
"RTN","PSORXL",158,0)
RREST N PMXZ
"RTN","PSORXL",159,0)
 S PMXZ="" F  S PMXZ=$O(PSORSAVE(PMXZ)) Q:PMXZ=""  S RXRP(PMXZ)=PSORSAVE(PMXZ)
"RTN","PSORXL",160,0)
 S PMXZ="" F  S PMXZ=$O(PSOPSAVE(PMXZ)) Q:PMXZ=""  S RXPR(PMXZ)=PSOPSAVE(PMXZ)
"RTN","PSORXL",161,0)
 S PMXZ="" F  S PMXZ=$O(PSOHSAVE(PMXZ)) Q:PMXZ=""  S RXRH(PMXZ)=PSOHSAVE(PMXZ)
"RTN","PSORXL",162,0)
 Q
"RTN","PSORXL",163,0)
 ;
"RTN","PSORXL",164,0)
OPAI ;This section of code will display where an RX is routed.
"RTN","PSORXL",165,0)
 ;To determine where an RX will be routed, check:
"RTN","PSORXL",166,0)
 ;1) if the drug for the RX is associated with an ADD device in
"RTN","PSORXL",167,0)
 ;   file #50 and if the printer is in the DISPENSING SYSTEM 
"RTN","PSORXL",168,0)
 ;   PRINTER multiple sub-file #59.02008. If it is then the RX 
"RTN","PSORXL",169,0)
 ;   will display as being routed to that device.  
"RTN","PSORXL",170,0)
 ;2) Otherwise, the category of the ADD associated with the
"RTN","PSORXL",171,0)
 ;   printer in sub-file #59.20081 will be used to determine 
"RTN","PSORXL",172,0)
 ;   where the RX will be routed and the ADD displayed.
"RTN","PSORXL",173,0)
 ;
"RTN","PSORXL",174,0)
 N DIC,X,Y,PN,II,RX,DEV,DDEV,ADD,DAT,DAT1,PDAT,DRG,DRG0,OPAI,CSB,RTE,FLG
"RTN","PSORXL",175,0)
 N ZTIO,MTH,NPPL
"RTN","PSORXL",176,0)
 I ($G(OPAIO)="")!($G(PPL)="") Q
"RTN","PSORXL",177,0)
 S DIC=3.5,DIC(0)="",X=OPAIO D ^DIC K DIC,X Q:Y=-1  S ZTIO=+Y
"RTN","PSORXL",178,0)
 S FLG=1,DEV=0,PN=$O(^PS(59,PSOSITE,"P","B",ZTIO,"")) I PN="" Q 
"RTN","PSORXL",179,0)
 I '$P($G(PSOPAR),"^",30) Q
"RTN","PSORXL",180,0)
 I $$GET1^DIQ(59,PSOSITE_",",105,"I")'=2.4 Q
"RTN","PSORXL",181,0)
 ;
"RTN","PSORXL",182,0)
 ;ADD array built base on category.
"RTN","PSORXL",183,0)
 ; if category is not "S" then 
"RTN","PSORXL",184,0)
 ;               ADD(category)=ADD name^dns^port^inactive date
"RTN","PSORXL",185,0)
 ; if category is "S" then (Category "S" can be multiple)
"RTN","PSORXL",186,0)
 ;               ADD(category,ADD name)=ADD name^dns^port^inactive date
"RTN","PSORXL",187,0)
 ;Array OPAI will be used to display the data on the screen.
"RTN","PSORXL",188,0)
 ;               OPAI(ADD name)=ADD name^dns^port^inactive date
"RTN","PSORXL",189,0)
 ;               OPAI(ADD name,RX)=drug
"RTN","PSORXL",190,0)
 ;
"RTN","PSORXL",191,0)
 F  S DEV=$O(^PS(59,PSOSITE,"P",PN,"OPAI",DEV)) Q:'DEV  D
"RTN","PSORXL",192,0)
 .S DAT=$G(^PS(59,PSOSITE,"P",PN,"OPAI",DEV,0)) I $P(DAT,"^",2)="" Q
"RTN","PSORXL",193,0)
 .S DAT1=$$ADDCHK^PSOHLDS($P(DAT,"^"))
"RTN","PSORXL",194,0)
 .I DAT1 D
"RTN","PSORXL",195,0)
 ..I $P(DAT,"^",2)'="S" S ADD($P(DAT,"^",2))=$P(DAT1,"^",2,99) Q
"RTN","PSORXL",196,0)
 ..S ADD($P(DAT,"^",2),$P(DAT1,"^",2))=$P(DAT1,"^",2,99)
"RTN","PSORXL",197,0)
 S NPPL=""
"RTN","PSORXL",198,0)
 F II=1:1:$L(PPL,",") S RX=$P(PPL,",",II) D:RX'=""
"RTN","PSORXL",199,0)
 .I $G(RXRP(RX,"RP")) Q 
"RTN","PSORXL",200,0)
 .S PDAT=$G(^PSRX(RX,0)),DRG=$P(PDAT,"^",6),RTE=$$RTE()
"RTN","PSORXL",201,0)
 .S DRG0=$G(^PSDRUG(+DRG,0)),DDEV=$G(^PSDRUG(+DRG,"OPAI",PSOSITE,0))
"RTN","PSORXL",202,0)
 .I $S($P(PSOPAR,"^",30)=3:1,$P(PSOPAR,"^",30)=4:1,1:0),'$$GET1^DIQ(50,DRG,28,"I") Q
"RTN","PSORXL",203,0)
 .S NPPL=NPPL_","_RX,DAT1=$$ADDCHK^PSOHLDS($S(RTE="W":$P(DDEV,"^",2),RTE="M":$P(DDEV,"^",3),1:"")) I DAT1 D  Q
"RTN","PSORXL",204,0)
 ..D SETOP($P(DAT1,"^",2,99),$P(PDAT,"^"),$P(DRG0,"^"))
"RTN","PSORXL",205,0)
 .I $D(ADD("A")) D SETOP(ADD("A"),$P(PDAT,"^"),$P(DRG0,"^")) Q
"RTN","PSORXL",206,0)
 .S CSB=+$P(DRG0,"^",3),CSB=$S((CSB>0)&(CSB<6):"CS",1:"NCS")
"RTN","PSORXL",207,0)
 .I $D(ADD(CSB)) D SETOP(ADD(CSB),$P(PDAT,"^"),$P(DRG0,"^")) Q
"RTN","PSORXL",208,0)
 .I $D(ADD(RTE_CSB)) D SETOP(ADD(RTE_CSB),$P(PDAT,"^"),$P(DRG0,"^")) Q
"RTN","PSORXL",209,0)
 .S MTH=$S(RTE="W":"WIND",RTE="M":"MAIL",1:"")
"RTN","PSORXL",210,0)
 .I MTH'="",$D(ADD(MTH)) D SETOP(ADD(MTH),$P(PDAT,"^"),$P(DRG0,"^"))
"RTN","PSORXL",211,0)
 .S FLG=0
"RTN","PSORXL",212,0)
 I FLG Q  ;nothing found to print
"RTN","PSORXL",213,0)
 I ($D(OPAI))!($D(ADD("S"))) W !,"PRESCRIPTIONS SENT TO:" D
"RTN","PSORXL",214,0)
 .S DEV="" F  S DEV=$O(OPAI(DEV)) Q:DEV=""  W !?3,DEV D  W !
"RTN","PSORXL",215,0)
 ..S RX=0 F  S RX=$O(OPAI(DEV,RX)) Q:'RX  W !?5,RX,?20,$P(OPAI(DEV,RX),"^")
"RTN","PSORXL",216,0)
 I $D(ADD("S")) W !,"STORAGE DEVICES" S II="" D
"RTN","PSORXL",217,0)
 .F  S II=$O(ADD("S",II)) Q:II=""  W !?3,II I $D(OPAI) ;W ?20,"The above Prescriptions"
"RTN","PSORXL",218,0)
 .F II=1:1:$L(NPPL,",") S RX=$P(NPPL,",",II) D:RX'=""
"RTN","PSORXL",219,0)
 ..Q:$G(RXRP(RX,"RP"))  S PDAT=$G(^PSRX(RX,0)),DRG=$P($G(^PSDRUG(+$P(PDAT,"^",6),0)),"^")
"RTN","PSORXL",220,0)
 ..W !?5,$P(PDAT,"^"),?20,DRG
"RTN","PSORXL",221,0)
 .W !
"RTN","PSORXL",222,0)
 Q
"RTN","PSORXL",223,0)
 ;
"RTN","PSORXL",224,0)
SETOP(DINF,DRX,DDRG) ; Set OPAI array
"RTN","PSORXL",225,0)
 N DNAM
"RTN","PSORXL",226,0)
 S DNAM=$P(DINF,"^"),OPAI(DNAM)=DINF,OPAI(DNAM,DRX)=DDRG,FLG=0
"RTN","PSORXL",227,0)
 Q
"RTN","PSORXL",228,0)
 ;
"RTN","PSORXL",229,0)
RTE() ; get route for RX
"RTN","PSORXL",230,0)
 N FP,FPN,LRF,MW,XX
"RTN","PSORXL",231,0)
 S FP=$S($G(RXPR(RX)):"P",1:"F")
"RTN","PSORXL",232,0)
 I '$G(RXPR(RX)) S LRF=0 F XX=0:0 S XX=$O(^PSRX(RX,1,XX)) Q:'XX  I +^(XX,0) S LRF=XX
"RTN","PSORXL",233,0)
 I '$G(RXPR(RX)),$G(RXFL(RX))'="" S LRF=$S($G(RXFL(RX))=0:0,$D(^PSRX(RX,1,+$G(RXFL(RX)),0)):+$G(RXFL(RX)),1:$G(LRF))
"RTN","PSORXL",234,0)
 S FPN=$S($G(RXPR(RX)):RXPR(RX),1:$G(LRF))
"RTN","PSORXL",235,0)
 I FP="F"&('FPN) S MW=$P($G(^PSRX(RX,0)),"^",11)       ;original
"RTN","PSORXL",236,0)
 I FP="F"&(FPN) S MW=$P($G(^PSRX(RX,1,FPN,0)),"^",2)   ;refill
"RTN","PSORXL",237,0)
 I FP="P"&(FPN) S MW=$P($G(^PSRX(RX,"P",FPN,0)),"^",2) ;partial
"RTN","PSORXL",238,0)
 Q $G(MW)
"RTN","PSORXRP1")
0^14^B27055758^B25369368
"RTN","PSORXRP1",1,0)
PSORXRP1 ;BIR/SAB-rx speed reprint listman ;03/06/95
"RTN","PSORXRP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,120,156,148,367**;DEC 1997;Build 62
"RTN","PSORXRP1",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORXRP1",4,0)
SEL N PSODISP,PSOMGREP,VALMCNT I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSORXRP1",5,0)
 S RXCNT=0 K PSOFDR,DIR,DUOUT,DIRUT S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR S LST=Y I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" Q
"RTN","PSORXRP1",6,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,PSOREPX I +LST S PSOOELSE=1 D
"RTN","PSORXRP1",7,0)
 .D FULL^VALM1 K DIR S DIR("A")="Number of Copies? ",DIR(0)="N^1:99:0",DIR("?")="Enter the number of copies you want (1 TO 99)",DIR("B")=1
"RTN","PSORXRP1",8,0)
 .D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S COPIES=Y
"RTN","PSORXRP1",9,0)
 .K DIR S DIR("A")="Print adhesive portion of label only? ",DIR(0)="Y",DIR("B")="No",DIR("?",1)="If entire label, including trailers are to print press RETURN for default."
"RTN","PSORXRP1",10,0)
 .S DIR("?")="Else if only bottle and mailing labels are to print enter Y or YES." D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S SIDE=Y
"RTN","PSORXRP1",11,0)
 .I $P(PSOPAR,"^",30),$$GET1^DIQ(59,PSOSITE_",",105,"I")=2.4 D  Q:$G(PSOREPX)
"RTN","PSORXRP1",12,0)
 ..K DIR,DIRUT S DIR("A")="Do you want to resend to Dispensing System Device",DIR(0)="Y",DIR("B")="No"
"RTN","PSORXRP1",13,0)
 ..D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S PSODISP=$S(Y:0,1:1)
"RTN","PSORXRP1",14,0)
 .I $$GET1^DIQ(59,PSOSITE,134)'="" D  Q:$D(DIRUT) 
"RTN","PSORXRP1",15,0)
 ..K DIR,DIRUT S DIR("A")="Reprint the FDA Medication Guide",DIR(0)="Y",DIR("B")="No"
"RTN","PSORXRP1",16,0)
 ..D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S PSOMGREP=Y
"RTN","PSORXRP1",17,0)
 .K DIRUT,DIR S DIR("A")="Comments: ",DIR(0)="FA^5:60",DIR("?")="5-60 characters input required for activity log." S:$G(PCOMX)]"" DIR("B")=$G(PCOMX)
"RTN","PSORXRP1",18,0)
 .D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S (PCOM,PCOMX)=Y
"RTN","PSORXRP1",19,0)
 .S PSOCLC=DUZ
"RTN","PSORXRP1",20,0)
 .F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""  S ORN=$P(LST,",",ORD),QFLG=0 D:+PSOLST(ORN)=52 RX
"RTN","PSORXRP1",21,0)
 .S VALMBCK="R"
"RTN","PSORXRP1",22,0)
 I $G(PSOREPX) S VALMBCK="R",VALMSG="No Labels Reprinted."
"RTN","PSORXRP1",23,0)
 K PSOREPX
"RTN","PSORXRP1",24,0)
 I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSORXRP1",25,0)
 D ^PSOBUILD
"RTN","PSORXRP1",26,0)
 K PSOMSG,PSORPSRX,QFLG,%,DIR,DUOUT,DTOUT,DIROUT,DIRUT,PCOM,PCOMX,C,I,J,JJJ,K,RX,RXF,X,Y,Z,P,PDA,PSPRXN,COPIES,SIDE,PPL,REPRINT,PSOOELSE,ORD,LST,ORN D KVA^VADPT
"RTN","PSORXRP1",27,0)
 Q
"RTN","PSORXRP1",28,0)
 ;
"RTN","PSORXRP1",29,0)
RX ;process reprint request
"RTN","PSORXRP1",30,0)
 Q:$P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^")>11
"RTN","PSORXRP1",31,0)
 I $$LMREJ^PSOREJU1($P(PSOLST(ORN),"^",2)) W $C(7),!!,"Rx "_$$GET1^DIQ(52,$P(PSOLST(ORN),"^",2),.01)_" has OPEN/UNRESOLVED 3rd Party Payer Rejects!" K DIR D PAUSE^VALM1 Q
"RTN","PSORXRP1",32,0)
 S PSORPSRX=$P(PSOLST(ORN),"^",2) D PSOL^PSSLOCK(PSORPSRX) I '$G(PSOMSG) W $C(7),!!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing Rx "_$P($G(^PSRX(PSORPSRX,0)),"^")),! D PAUSE^VALM1 K PSORPSRX,PSOMSG Q
"RTN","PSORXRP1",33,0)
 S RX=$P(PSOLST(ORN),"^",2),STA=$P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^") D CHK I $G(QFLG) D ULR Q
"RTN","PSORXRP1",34,0)
 S RXF=0,ZD(RX)=DT,REPRINT=1
"RTN","PSORXRP1",35,0)
 S RXRP($P(PSOLST(ORN),"^",2))=1_"^"_COPIES_"^"_SIDE
"RTN","PSORXRP1",36,0)
 I $G(PSODISP)=1 S RXRP($P(PSOLST(ORN),"^",2),"RP")=1
"RTN","PSORXRP1",37,0)
 I $G(PSOMGREP)=1 S RXRP($P(PSOLST(ORN),"^",2),"MG")=1
"RTN","PSORXRP1",38,0)
 S RXFL($P(PSOLST(ORN),"^",2))=0 F ZZZ=0:0 S ZZZ=$O(^PSRX($P(PSOLST(ORN),"^",2),1,ZZZ)) Q:'ZZZ  S RXFL($P(PSOLST(ORN),"^",2))=ZZZ
"RTN","PSORXRP1",39,0)
 K ZZZ
"RTN","PSORXRP1",40,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=RX_"," S ST="" D ACT1,ULR Q
"RTN","PSORXRP1",41,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORXRP1",42,0)
 I $L(PSORX("PSOL",PSOX2))+$L(RX)<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_RX_","
"RTN","PSORXRP1",43,0)
 E  S PSORX("PSOL",PSOX2+1)=RX_","
"RTN","PSORXRP1",44,0)
 S ST="" D ACT1
"RTN","PSORXRP1",45,0)
 D ULR
"RTN","PSORXRP1",46,0)
 Q
"RTN","PSORXRP1",47,0)
CHK ;check for valid reprint
"RTN","PSORXRP1",48,0)
 I DT>$P(^PSRX(RX,2),"^",6) D  S QFLG=1 Q
"RTN","PSORXRP1",49,0)
 .I $P(^PSRX(RX,"STA"),"^")<11 S $P(^PSRX(RX,"STA"),"^")=11 D
"RTN","PSORXRP1",50,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(RX,2),6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(RX,"SC","ZE",COMM) K COMM
"RTN","PSORXRP1",51,0)
 S DFN=PSODFN D DEM^VADPT I $P(VADM(6),"^",2)]"" D  S QFLG=1 Q
"RTN","PSORXRP1",52,0)
 .S $P(^PSRX(RX,"STA"),"^")=12,PCOM="Patient Expired "_$P(VADM(6),"^",2),ST="C" D EN^PSOHLSN1(RX,"OD","",PCOM,"A")
"RTN","PSORXRP1",53,0)
 .D ACT1
"RTN","PSORXRP1",54,0)
 I $D(RXPR($P(PSOLST(ORN),"^",2)))!$D(RXRP($P(PSOLST(ORN),"^",2))) S QFLG=1 Q
"RTN","PSORXRP1",55,0)
 D VALID Q:$G(QFLG)
"RTN","PSORXRP1",56,0)
 S X=$O(^PS(52.5,"B",RX,0)) I X,'$G(^PS(52.5,X,"P")) S QFLG=1 Q
"RTN","PSORXRP1",57,0)
 I $G(X)'>0 G GOOD
"RTN","PSORXRP1",58,0)
 I $P($G(^PS(52.5,X,0)),"^",7)']"" G GOOD
"RTN","PSORXRP1",59,0)
 I $P($G(^PS(52.5,X,0)),"^",7)="Q" K X,XX S QFLG=1 Q
"RTN","PSORXRP1",60,0)
 I $P($G(^PS(52.5,X,0)),"^",7)="L" K X,XX S QFLG=1 Q
"RTN","PSORXRP1",61,0)
GOOD K X
"RTN","PSORXRP1",62,0)
 I $D(^PS(52.4,RX)) S QFLG=1 Q
"RTN","PSORXRP1",63,0)
 I $D(^PS(52.4,"AREF",PSODFN,RX)) S QFLG=1 Q
"RTN","PSORXRP1",64,0)
 I $G(PSODIV),$D(^PSRX(RX,2)),+$P(^(2),"^",9),+$P(^(2),"^",9)'=PSOSITE S PSPOP=0,PSPRXN=RX D CHK1^PSOUTLA I $G(POERR)&(PSPOP) S QFLG=1 Q
"RTN","PSORXRP1",65,0)
 I STA=3!(STA=4)!(STA=12) S QFLG=1 Q
"RTN","PSORXRP1",66,0)
 Q
"RTN","PSORXRP1",67,0)
ACT1 S RXF=0 F J=0:0 S J=$O(^PSRX(RX,1,J)) Q:'J  S RXF=J S:J>5 RXF=J+1
"RTN","PSORXRP1",68,0)
 S IR=0 F J=0:0 S J=$O(^PSRX(RX,"A",J)) Q:'J  S IR=J
"RTN","PSORXRP1",69,0)
 S IR=IR+1,^PSRX(RX,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXRP1",70,0)
 D NOW^%DTC S ^PSRX(RX,"A",IR,0)=%_"^"_$S($G(ST)'="C":"W",1:"C")_"^"_DUZ_"^"_RXF_"^"_PCOM_$S($G(ST)'="C":" ("_COPIES_" COPIES)",1:""),PCOMX=PCOM K PC,IR,PS,XX,%,%H,%I,RXF
"RTN","PSORXRP1",71,0)
 S:$P(^PSRX(RX,2),"^",15)&($G(ST)'="C") $P(^PSRX(RX,2),"^",14)=1
"RTN","PSORXRP1",72,0)
 Q
"RTN","PSORXRP1",73,0)
VALID ;check for rx in label array
"RTN","PSORXRP1",74,0)
 I $O(PSORX("PSOL",0)) D
"RTN","PSORXRP1",75,0)
 .F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  I PSORX("PSOL",PSOX1)[RX_"," S QFLG=1 Q
"RTN","PSORXRP1",76,0)
 Q
"RTN","PSORXRP1",77,0)
ULR ;
"RTN","PSORXRP1",78,0)
 I $G(PSORPSRX) D PSOUL^PSSLOCK(PSORPSRX)
"RTN","PSORXRP1",79,0)
 Q
"RTN","PSORXRP2")
0^23^B35963491^B33732214
"RTN","PSORXRP2",1,0)
PSORXRP2 ;BIR/SAB-main menu entry reprint of a Rx label ;10/5/07 7:45am
"RTN","PSORXRP2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,120,138,135,156,185,280,251,367**;DEC 1997;Build 62
"RTN","PSORXRP2",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORXRP2",4,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSORXRP2",5,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORXRP2",6,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) G KILL
"RTN","PSORXRP2",7,0)
LRP N PSODISP,PSOMGREP
"RTN","PSORXRP2",8,0)
 K REPRINT W !! S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")<10",DIC="^PSRX(",DIC("A")="Reprint Prescription Label: ",DIC(0)="QEAZ" D ^DIC K P,DIC("A") I Y<0!("^"[X) K PCOM,PCOMX G KILL
"RTN","PSORXRP2",9,0)
 S (PPL,DA,RX,PSORPRX)=+Y,PDA=Y(0),RXF=0,ZD(DA)=DT,REPRINT=1,STA=+$G(^PSRX(+Y,"STA"))
"RTN","PSORXRP2",10,0)
 D PSOL^PSSLOCK(PSORPRX) I '$G(PSOMSG) W !!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),! K PSOMSG G LRP
"RTN","PSORXRP2",11,0)
 I $P(^PSRX(RX,"STA"),"^")=14 W $C(7),!,"Cannot Reprint! Discontinued by Provider." D ULR,KILL Q
"RTN","PSORXRP2",12,0)
 I $P(^PSRX(RX,"STA"),"^")=15 W $C(7),!,"Cannot Reprint! Discontinued due to editing." D ULR,KILL Q
"RTN","PSORXRP2",13,0)
 I $P(^PSRX(RX,"STA"),"^")=16 W $C(7),!,"Cannot Reprint! Placed on HOLD by Provider." D ULR,KILL Q
"RTN","PSORXRP2",14,0)
 I DT>$P(^PSRX(RX,2),"^",6) D  D ULR,KILL G LRP
"RTN","PSORXRP2",15,0)
 .W !,$C(7),"Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11 D
"RTN","PSORXRP2",16,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM) K COMM
"RTN","PSORXRP2",17,0)
 S DFN=$P(PDA,"^",2) D DEM^VADPT I $P(VADM(6),"^",2)]"" D  G LRP
"RTN","PSORXRP2",18,0)
 .W $C(7),!!,$P(^DPT($P(PDA,"^",2),0),"^")_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSORXRP2",19,0)
 .S $P(^PSRX(RX,"STA"),"^")=12,PCOM="Patient Expired "_$P(VADM(6),"^",2),ST="C" D EN^PSOHLSN1(RX,"OD","",PCOM,"A")
"RTN","PSORXRP2",20,0)
 .D ACT1,ULR,KILL
"RTN","PSORXRP2",21,0)
 S X=$O(^PS(52.5,"B",DA,0)) I X,'$G(^PS(52.5,X,"P")) W !,$C(7),"Rx may NOT be printed using this option, use SUSPENSE FUNCTIONS Options." K X D ULR,KILL G LRP
"RTN","PSORXRP2",22,0)
 I $G(X)'>0 G GOOD
"RTN","PSORXRP2",23,0)
 S XX=$P($G(^PS(52.5,X,0)),U,7) I $G(XX)']"" G GOOD
"RTN","PSORXRP2",24,0)
 I $G(XX)="Q" W !,"RX CAN NOT BE PRINTED using this option, use SUSPENSE FUNCTIONS Options." K X,XX D ULR,KILL G LRP
"RTN","PSORXRP2",25,0)
 I $G(XX)="L" W !,"RX is being transmitted to the CMOP and can not be reprinted now." K X,XX D ULR,KILL G LRP
"RTN","PSORXRP2",26,0)
GOOD K X
"RTN","PSORXRP2",27,0)
 I $D(^PS(52.4,DA)) W !,"Prescription is Non-Verified",!! D ULR,KILL G LRP
"RTN","PSORXRP2",28,0)
 S DFN=$P(^PSRX(DA,0),"^",2) I $D(^PS(52.4,"AREF",DFN,DA)) W !,"Prescription is waiting for others to be verified",!! D ULR,KILL G LRP
"RTN","PSORXRP2",29,0)
 I $G(PSODIV),$D(^PSRX(DA,2)),+$P(^(2),"^",9),+$P(^(2),"^",9)'=PSOSITE S PSPOP=0,PSPRXN=DA D CHK1^PSOUTLA I PSPOP D ULR,KILL G LRP
"RTN","PSORXRP2",30,0)
 I STA=3 W !?3,"Prescription is on Hold" D ULR,KILL G LRP
"RTN","PSORXRP2",31,0)
 I STA=4 W !?3,"Prescription is Pending Due to Drug Interactions" D ULR,KILL G LRP
"RTN","PSORXRP2",32,0)
 I STA=12 W !?3,"Prescription is Discontinued" D ULR,KILL G LRP
"RTN","PSORXRP2",33,0)
 I $G(^PS(55,"ASTALK",DFN)) W !,"Patient is a ScripTalk patient. Use ScripTalk label for prescription bottle.",!
"RTN","PSORXRP2",34,0)
 D ICN^PSODPT(DFN)
"RTN","PSORXRP2",35,0)
 S COPIES=$S($P(PDA,"^",18)]"":$P(PDA,"^",18),1:1)
"RTN","PSORXRP2",36,0)
 K DIR S DIR("A")="Number of Copies? ",DIR("B")=COPIES,DIR(0)="N^1:99:0",DIR("?")="Enter the number of copies you want (1 TO 99)"
"RTN","PSORXRP2",37,0)
 D ^DIR K DIR I $D(DIRUT) D ULR,KILL G LRP
"RTN","PSORXRP2",38,0)
 S COPIES=Y
"RTN","PSORXRP2",39,0)
 K DIR S DIR("A")="Print adhesive portion of label only? ",DIR(0)="Y",DIR("B")="No",DIR("?",1)="If entire label, including trailers are to print press RETURN for default."
"RTN","PSORXRP2",40,0)
 S DIR("?")="Else if only bottle and mailing labels are to print enter Y or YES." D ^DIR K DIR I $D(DUOUT) D ULR,KILL G LRP
"RTN","PSORXRP2",41,0)
 I $D(DIRUT) D ULR G KILL
"RTN","PSORXRP2",42,0)
 S SIDE=Y
"RTN","PSORXRP2",43,0)
 I $P(PSOPAR,"^",30),$$GET1^DIQ(59,PSOSITE_",",105,"I")=2.4 D
"RTN","PSORXRP2",44,0)
 .I $S($P(PSOPAR,"^",30)=3:1,$P(PSOPAR,"^",30)=4:1,1:0),'$$GET1^DIQ(50,$P(PDA,"^",6),28,"I") Q
"RTN","PSORXRP2",45,0)
 .K DIR,DIRUT S DIR("A")="Do you want to resend to Dispensing System Device",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR Q:$D(DIRUT)  S PSODISP=$S(Y:0,1:1)
"RTN","PSORXRP2",46,0)
 I $D(DIRUT) D ULR,KILL G LRP
"RTN","PSORXRP2",47,0)
 ;
"RTN","PSORXRP2",48,0)
 ; FDA Medication Guide Reprint
"RTN","PSORXRP2",49,0)
 I $$GET1^DIQ(59,PSOSITE,134)'="",$$MGONFILE^PSOFDAUT(DA) D  I $D(DIRUT) D ULR,KILL G LRP
"RTN","PSORXRP2",50,0)
 . K DIR,DIRUT S DIR("A")="Reprint the FDA Medication Guide",DIR(0)="Y",DIR("B")="No"
"RTN","PSORXRP2",51,0)
 . D ^DIR K DIR Q:$D(DIRUT)  S PSOMGREP=Y
"RTN","PSORXRP2",52,0)
 ; 
"RTN","PSORXRP2",53,0)
 D ACT I $D(DIRUT) D ULR,KILL G LRP
"RTN","PSORXRP2",54,0)
 I $D(PCOM) D ULR,KILL G LRP
"RTN","PSORXRP2",55,0)
 F I=1,2,4,6,7,9,13,16 S P(I)=$P(PDA,"^",I)
"RTN","PSORXRP2",56,0)
 S P(6)=+P(6) I $D(^PSRX(DA,"TN")),^("TN")]"" S P(6)=^("TN")
"RTN","PSORXRP2",57,0)
 W !!,"Rx # "_P(1),?23,$E(P(13),4,5)_"/"_$E(P(13),6,7)_"/"_$E(P(13),2,3),!,$S($D(^DPT(+P(2),0)):$P(^(0),"^"),1:"Not on File"),?30,"#"_P(7),!
"RTN","PSORXRP2",58,0)
 I $P($G(^PSRX(DA,"SIG")),"^",2) S D=0 D  K D,FSIG
"RTN","PSORXRP2",59,0)
 .D FSIG^PSOUTLA("R",DA,75) F  S D=$O(FSIG(D)) W !,FSIG(D) Q:'$O(FSIG(D))
"RTN","PSORXRP2",60,0)
 E  D EN3^PSOUTLA1(DA,75) S D=0 F  S D=$O(BSIG(D)) W !,BSIG(D) Q:'$O(BSIG(D))
"RTN","PSORXRP2",61,0)
 K D,BSIG
"RTN","PSORXRP2",62,0)
 ;PSO*7*280 If Trade name, don't lookup in ^PSDRUG
"RTN","PSORXRP2",63,0)
 W !!,$S($G(^PSRX(DA,"TN"))]"":P(6),(P(6)=+P(6))&$D(^PSDRUG(P(6),0)):$P(^(0),"^"),1:P(6)),! S PHYS=$S($D(^VA(200,+P(4),0)):$P(^(0),"^"),1:"Unknown") W PHYS K PHYS
"RTN","PSORXRP2",64,0)
 W ?25,$S($D(^VA(200,+P(16),0)):$P(^(0),"^"),1:"Unknown"),!,"# of Refills: "_$G(P(9))
"RTN","PSORXRP2",65,0)
 I $G(RX) D
"RTN","PSORXRP2",66,0)
 .S RXRP(RX)=1_"^"_COPIES_"^"_SIDE
"RTN","PSORXRP2",67,0)
 .I $G(PSOMGREP)=1 S RXRP(RX,"MG")=1
"RTN","PSORXRP2",68,0)
 .I $G(PSODISP)=1 S RXRP(RX,"RP")=1
"RTN","PSORXRP2",69,0)
 .S RXFL(RX)=0 F ZZZ=0:0 S ZZZ=$O(^PSRX(RX,1,ZZZ)) Q:'ZZZ  S RXFL(RX)=ZZZ
"RTN","PSORXRP2",70,0)
 D @$S($P($G(PSOPAR),"^",26):"^PSORXL",1:"Q^PSORXL") K PSPOP,PPL,COPIES,SIDE,REPRINT,PCOM,IOP,PSL,PSNP,ZZZ,RXFL(+$G(RX)) D ULR,KILL G LRP
"RTN","PSORXRP2",71,0)
 ;
"RTN","PSORXRP2",72,0)
ACT K DIR S DIR("A")="Comments: ",DIR(0)="FA^5:60",DIR("?")="5-60 characters input required for activity log." S:$G(PCOMX)]"" DIR("B")=$G(PCOMX)
"RTN","PSORXRP2",73,0)
 D ^DIR K DIR Q:$D(DIRUT)!($D(DIROUT))  S (PCOM,PCOMX)=X
"RTN","PSORXRP2",74,0)
 I '$D(PSOCLC) S PSOCLC=DUZ
"RTN","PSORXRP2",75,0)
ACT1 S RXF=0 F J=0:0 S J=$O(^PSRX(DA,1,J)) Q:'J  S RXF=J S:J>5 RXF=J+1
"RTN","PSORXRP2",76,0)
 S IR=0 F J=0:0 S J=$O(^PSRX(DA,"A",J)) Q:'J  S IR=J
"RTN","PSORXRP2",77,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXRP2",78,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^"_$S($G(ST)'="C":"W",1:"C")_"^"_DUZ_"^"_RXF_"^"_PCOM_$S($G(ST)'="C":" ("_COPIES_" COPIES)",1:""),PCOMX=PCOM K PC,IR,PS,PCOM,XX,%,%H,%I,RXF
"RTN","PSORXRP2",79,0)
 S:$P(^PSRX(DA,2),"^",15)&($G(ST)'="C") $P(^PSRX(DA,2),"^",14)=1
"RTN","PSORXRP2",80,0)
 Q
"RTN","PSORXRP2",81,0)
 ;
"RTN","PSORXRP2",82,0)
KILL K %,DIR,DUOUT,DTOUT,DIROUT,DIRUT,C,DA,DIC,I,J,JJJ,K,RX,RXF,X,Y,Z,ZD,DFN,P,PDA,PSPRXN,COPIES,SIDE,PPL,REPRINT,PSXSTAT,PSORPRX,PSOMSG D KVA^VADPT Q
"RTN","PSORXRP2",83,0)
 ;
"RTN","PSORXRP2",84,0)
ULR ;
"RTN","PSORXRP2",85,0)
 I $G(PSORPRX) D PSOUL^PSSLOCK(PSORPRX)
"RTN","PSORXRP2",86,0)
 Q
"RTN","PSORXRPT")
0^13^B40880121^B37714980
"RTN","PSORXRPT",1,0)
PSORXRPT ;BIR/SAB-reprint of a prescription label ;9/20/07 9:40am
"RTN","PSORXRPT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,21,27,34,120,138,156,148,280,367**;DEC 1997;Build 62
"RTN","PSORXRPT",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORXRPT",4,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORXRPT",5,0)
BCK I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSORXRPT",6,0)
 N PSODISP,PSOMGREP S PSORPLRX=$P(PSOLST(ORN),"^",2)
"RTN","PSORXRPT",7,0)
 I $$LMREJ^PSOREJU1(PSORPLRX,,.VALMSG,.VALMBCK) Q
"RTN","PSORXRPT",8,0)
 D PSOL^PSSLOCK(PSORPLRX) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG Q
"RTN","PSORXRPT",9,0)
 I $G(POERR) K QFLG D  I $G(QFLG) D ULR G KILL
"RTN","PSORXRPT",10,0)
 .D FULL^VALM1 S X=$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),Y=$P(PSOLST(ORN),"^",2)_"^"_X,Y(0)=$G(^PSRX($P(PSOLST(ORN),"^",2),0))
"RTN","PSORXRPT",11,0)
 .I $D(RXPR($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="A Partial Rx has been requested!",QFLG=1 Q
"RTN","PSORXRPT",12,0)
 .I $D(RXRP($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="A Reprint Label has been requested!",QFLG=1 Q
"RTN","PSORXRPT",13,0)
 .I $D(RXRS($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="Rx is being pulled from suspense!",QFLG=1 Q
"RTN","PSORXRPT",14,0)
 .S RX=$P(PSOLST(ORN),"^",2) D VALID^PSORXRP1 S:$G(QFLG) VALMBCK="",VALMSG="A New Label has been requested already!"
"RTN","PSORXRPT",15,0)
 S (PPL,DA,RX)=+Y,PDA=Y(0),RXF=0,ZD(DA)=DT,REPRINT=1,STA=+$G(^PSRX(+Y,"STA"))
"RTN","PSORXRPT",16,0)
 I $P(^PSRX(RX,"STA"),"^")=14 S VALMBCK="",VALMSG="Cannot Reprint! Discontinued by Provider.",QFLG=1 D ULR,KILL Q
"RTN","PSORXRPT",17,0)
 I $P(^PSRX(RX,"STA"),"^")=15 S VALMBCK="",VALMSG="Cannot Reprint! Discontinued due to editing.",QFLG=1 D ULR,KILL Q
"RTN","PSORXRPT",18,0)
 I $P(^PSRX(RX,"STA"),"^")=16 S VALMBCK="",VALMSG="Cannot Reprint! Placed on HOLD by Provider.",QFLG=1 D ULR,KILL Q
"RTN","PSORXRPT",19,0)
 I DT>$P(^PSRX(RX,2),"^",6) D  G PAUSE
"RTN","PSORXRPT",20,0)
 .W !,$C(7),"Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11 D
"RTN","PSORXRPT",21,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM) K COMM
"RTN","PSORXRPT",22,0)
 S DFN=$P(PDA,"^",2) D DEM^VADPT I $P(VADM(6),"^",2)]"" D  G PAUSE
"RTN","PSORXRPT",23,0)
 .W $C(7),!!,$P(^DPT($P(PDA,"^",2),0),"^")_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSORXRPT",24,0)
 .S $P(^PSRX(RX,"STA"),"^")=12,PCOM="Patient Expired "_$P(VADM(6),"^",2),ST="C" D EN^PSOHLSN1(RX,"OD","",PCOM,"A")
"RTN","PSORXRPT",25,0)
 .D ACT1,ULR,KILL
"RTN","PSORXRPT",26,0)
 S X=$O(^PS(52.5,"B",DA,0)) I X,'$G(^PS(52.5,X,"P")) W !,$C(7),"RX MAY NOT BE PRINTED using this option, use SUSPENSE FUNCTIONS Options." K X G PAUSE
"RTN","PSORXRPT",27,0)
 S PSX=0 F J=0:0 S J=$O(^PSRX(DA,1,J)) Q:'J  S PSX=J
"RTN","PSORXRPT",28,0)
 K X
"RTN","PSORXRPT",29,0)
 I $D(^PS(52.4,DA)) W !,"Prescription is Non-Verified",!! G PAUSE
"RTN","PSORXRPT",30,0)
 S DFN=$P(^PSRX(DA,0),"^",2) I $D(^PS(52.4,"AREF",DFN,DA)) W !,"Prescription is waiting for others to be verified",!! G PAUSE
"RTN","PSORXRPT",31,0)
 I $G(PSODIV),$D(^PSRX(DA,2)),+$P(^(2),"^",9),+$P(^(2),"^",9)'=PSOSITE S PSPOP=0,PSPRXN=DA D CHK1^PSOUTLA G:$G(POERR)&(PSPOP) PAUSE G:PSPOP PAUSE
"RTN","PSORXRPT",32,0)
 I STA=3 W !?3,"Prescription is on Hold" G PAUSE
"RTN","PSORXRPT",33,0)
 I STA=4 W !?3,"Prescription is Pending Due to Drug Interactions" G PAUSE
"RTN","PSORXRPT",34,0)
 I STA=12 W !?3,"Prescription is Discontinued" G PAUSE
"RTN","PSORXRPT",35,0)
 S COPIES=$S($P(PDA,"^",18)]"":$P(PDA,"^",18),1:1)
"RTN","PSORXRPT",36,0)
 K DIR S DIR("A")="Number of Copies? ",DIR("B")=COPIES,DIR(0)="N^1:99:0",DIR("?")="Enter the number of copies you want (1 to 99)"
"RTN","PSORXRPT",37,0)
 D ^DIR K DIR I $D(DIRUT) D ULR G KILL
"RTN","PSORXRPT",38,0)
 S COPIES=Y
"RTN","PSORXRPT",39,0)
 K DIR S DIR("A")="Print adhesive portion of label only",DIR(0)="Y",DIR("B")="No",DIR("?",1)="If entire label, including trailers are to print press RETURN for default."
"RTN","PSORXRPT",40,0)
 S DIR("?")="Else if only bottle and mailing labels are to print enter Y or YES." D ^DIR K DIR I $D(DUOUT) D ULR,KILL G PAUSE
"RTN","PSORXRPT",41,0)
 I $D(DIRUT) D ULR G KILL
"RTN","PSORXRPT",42,0)
 S SIDE=Y
"RTN","PSORXRPT",43,0)
 ;
"RTN","PSORXRPT",44,0)
 ; Dispensing System Device Resend
"RTN","PSORXRPT",45,0)
 I $P(PSOPAR,"^",30),$$GET1^DIQ(59,PSOSITE_",",105,"I")=2.4 D
"RTN","PSORXRPT",46,0)
 .I $S($P(PSOPAR,"^",30)=3:1,$P(PSOPAR,"^",30)=4:1,1:0),'$$GET1^DIQ(50,$P(PDA,"^",6),28,"I") Q
"RTN","PSORXRPT",47,0)
 .K DIR,DIRUT S DIR("A")="Do you want to resend to Dispensing System Device",DIR(0)="Y",DIR("B")="No"
"RTN","PSORXRPT",48,0)
 .D ^DIR K DIR Q:$D(DIRUT)  S PSODISP=$S(Y:0,1:1)
"RTN","PSORXRPT",49,0)
 I $D(DIRUT) D ULR G KILL
"RTN","PSORXRPT",50,0)
 ;
"RTN","PSORXRPT",51,0)
 ; FDA Medication Guide Reprint
"RTN","PSORXRPT",52,0)
 I $$GET1^DIQ(59,PSOSITE,134)'="",$$MGONFILE^PSOFDAUT($P(PSOLST(ORN),"^",2)) D  I $D(DIRUT) D ULR,KILL G PAUSE
"RTN","PSORXRPT",53,0)
 . K DIR,DIRUT S DIR("A")="Reprint the FDA Medication Guide",DIR(0)="Y",DIR("B")="No"
"RTN","PSORXRPT",54,0)
 . D ^DIR K DIR Q:$D(DIRUT)  S PSOMGREP=Y
"RTN","PSORXRPT",55,0)
 ;
"RTN","PSORXRPT",56,0)
 D ACT I $D(DIRUT) D ULR,KILL G PAUSE
"RTN","PSORXRPT",57,0)
 Q:$G(POERR)&($D(PCOM))  G PAUSE:$D(PCOM)
"RTN","PSORXRPT",58,0)
 F I=1,2,4,6,7,9,13,16 S P(I)=$P(PDA,"^",I)
"RTN","PSORXRPT",59,0)
 S P(6)=+P(6) I $D(^PSRX(DA,"TN")),^("TN")]"" S P(6)=^("TN")
"RTN","PSORXRPT",60,0)
 W !!,"Rx # "_P(1),?23,$E(P(13),4,5)_"/"_$E(P(13),6,7)_"/"_$E(P(13),2,3),!,$S($D(^DPT(+P(2),0)):$P(^(0),"^"),1:"Not on File"),?30,"#"_P(7),!
"RTN","PSORXRPT",61,0)
 I $P($G(^PSRX(DA,"SIG")),"^",2) S D=0 D  K D,FSIG
"RTN","PSORXRPT",62,0)
 .D FSIG^PSOUTLA("R",DA,75) F  S D=$O(FSIG(D)) W !,FSIG(D) Q:'$O(FSIG(D))
"RTN","PSORXRPT",63,0)
 E  D EN3^PSOUTLA1(DA,75) S D=0 F  S D=$O(BSIG(D)) W !,BSIG(D) Q:'$O(BSIG(D))
"RTN","PSORXRPT",64,0)
 K D,BSIG
"RTN","PSORXRPT",65,0)
 ;PSO*7*280 If trade name is used Stop the DRUG Lookup.
"RTN","PSORXRPT",66,0)
 W !!,$S($G(^PSRX(DA,"TN"))]"":P(6),(P(6)=+P(6))&$D(^PSDRUG(P(6),0)):$P(^(0),"^"),1:P(6)),! S PHYS=$S($D(^VA(200,+P(4),0)):$P(^(0),"^"),1:"Unknown") W PHYS K PHYS
"RTN","PSORXRPT",67,0)
 W ?25,$S($D(^VA(200,+P(16),0)):$P(^(0),"^"),1:"Unknown"),!,"# of Refills: "_$G(P(9))
"RTN","PSORXRPT",68,0)
 I $G(RX) S RXFL(RX)=0 F ZZZ=0:0 S ZZZ=$O(^PSRX(RX,1,ZZZ)) Q:'ZZZ  S RXFL(RX)=ZZZ
"RTN","PSORXRPT",69,0)
 K PSOELSE I '$G(POERR) S PSOELSE=1 D @$S($P($G(PSOPAR),"^",26):"^PSORXL",1:"Q^PSORXL")
"RTN","PSORXRPT",70,0)
 I '$G(PSOELSE) D
"RTN","PSORXRPT",71,0)
 .S RXRP($P(PSOLST(ORN),"^",2))=1_"^"_COPIES_"^"_SIDE
"RTN","PSORXRPT",72,0)
 .I $G(PSODISP)=1 S RXRP($P(PSOLST(ORN),"^",2),"RP")=1
"RTN","PSORXRPT",73,0)
 .I $G(PSOMGREP)=1 S RXRP($P(PSOLST(ORN),"^",2),"MG")=1
"RTN","PSORXRPT",74,0)
 .I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=DA_"," Q
"RTN","PSORXRPT",75,0)
 .F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORXRPT",76,0)
 .I $L(PSORX("PSOL",PSOX2))+$L(DA)<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_DA_","
"RTN","PSORXRPT",77,0)
 .E  S PSORX("PSOL",PSOX2+1)=DA_","
"RTN","PSORXRPT",78,0)
 K PCOMX,PSPOP,PPL,COPIES,SIDE,PCOM,IOP,PSL,PSNP,PSOELSE,ZZZ
"RTN","PSORXRPT",79,0)
PAUSE K RX,PPL,ZD(+$G(DA)),DA I $G(POERR) K DIR,DIRUT,DUOUT,DTOUT S DIR(0)="E",DIR("A",1)=" ",DIR("A")="Press Return to Continue" D ^DIR K DIR,DIRUT,DUOUT,DTOUT S VALMBCK="R"
"RTN","PSORXRPT",80,0)
 D ULR K PSORPLRX
"RTN","PSORXRPT",81,0)
 Q
"RTN","PSORXRPT",82,0)
 ;
"RTN","PSORXRPT",83,0)
ACT K DIR S DIR("A")="Comments: ",DIR(0)="FA^5:60",DIR("?")="5-60 characters input required for activity log." S:$G(PCOMX)]"" DIR("B")=$G(PCOMX)
"RTN","PSORXRPT",84,0)
 D ^DIR K DIR Q:$D(DIRUT)!($D(DIROUT))  S (PCOM,PCOMX)=X
"RTN","PSORXRPT",85,0)
 I '$D(PSOCLC) S PSOCLC=DUZ
"RTN","PSORXRPT",86,0)
ACT1 S RXF=0 F J=0:0 S J=$O(^PSRX(DA,1,J)) Q:'J  S RXF=J S:J>5 RXF=J+1
"RTN","PSORXRPT",87,0)
 S IR=0 F J=0:0 S J=$O(^PSRX(DA,"A",J)) Q:'J  S IR=J
"RTN","PSORXRPT",88,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXRPT",89,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^"_$S($G(ST)'="C":"W",1:"C")_"^"_DUZ_"^"_RXF_"^"_PCOM_$S($G(ST)'="C":" ("_COPIES_" COPIES)",1:""),PCOMX=PCOM K PC,IR,PS,PCOM,XX,%,%H,%I,RXF
"RTN","PSORXRPT",90,0)
 S:$P(^PSRX(DA,2),"^",15)&($G(ST)'="C") $P(^PSRX(DA,2),"^",14)=1
"RTN","PSORXRPT",91,0)
 Q
"RTN","PSORXRPT",92,0)
 ;
"RTN","PSORXRPT",93,0)
KILL K QFLG,%,DIR,DUOUT,DTOUT,DIROUT,DIRUT,PCOM,PCOMX,C,DA,DIC,I,J,JJJ,K,RX,RXF,X,Y,Z,DFN,P,PDA,PSPRXN,COPIES,SIDE,PPL,REPRINT,PSOMSG,PSORPLRX D KVA^VADPT Q
"RTN","PSORXRPT",94,0)
 ;
"RTN","PSORXRPT",95,0)
ULR ;
"RTN","PSORXRPT",96,0)
 I $G(PSORPLRX) D PSOUL^PSSLOCK(PSORPLRX)
"RTN","PSORXRPT",97,0)
 Q
"RTN","PSORXVW1")
0^3^B71843058^B67852891
"RTN","PSORXVW1",1,0)
PSORXVW1 ;BIR/SAB-view prescription con't ; 12/4/07 12:28pm
"RTN","PSORXVW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**35,47,46,71,99,117,156,193,210,148,258,260,240,281,359,354,367**;DEC 1997;Build 62
"RTN","PSORXVW1",3,0)
 ;External reference to ^DD(52 supported by DBIA 999
"RTN","PSORXVW1",4,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSORXVW1",5,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSORXVW1",6,0)
 ;
"RTN","PSORXVW1",7,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",6) D
"RTN","PSORXVW1",8,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(^PSRX(RXN,"OR1"),"^",6) D ^DIC
"RTN","PSORXVW1",9,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="           Filled By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",10,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",7) D
"RTN","PSORXVW1",11,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(^PSRX(RXN,"OR1"),"^",7) D ^DIC
"RTN","PSORXVW1",12,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Checked By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",13,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(RX0,"^",16) D ^DIC
"RTN","PSORXVW1",14,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Entry By: "_$P(Y,"^",2)_$E(RN,$L($P(Y,"^",2))+1,35)
"RTN","PSORXVW1",15,0)
 S Y=$P(RX2,"^") X ^DD("DD")
"RTN","PSORXVW1",16,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"Entry Date: "_$E($P(RX2,"^"),4,5)_"/"_$E($P(RX2,"^"),6,7)_"/"_$E($P(RX2,"^"),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSORXVW1",17,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" " ;,IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",18,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Original Fill Released: " I $P(RX2,"^",13) S DTT=$P(RX2,"^",13) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT K DAT,DTT
"RTN","PSORXVW1",19,0)
 I $P(RX2,"^",15) S DTT=$P(RX2,"^",15) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"(Returned to Stock "_DAT_")" K DAT,DTT
"RTN","PSORXVW1",20,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"      Routing: "_$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW1",21,0)
 I $G(^PSRX(DA,"H"))]"",$P(^("STA"),"^")=3 D HLD
"RTN","PSORXVW1",22,0)
 D RF,PAR,ACT,COPAY^PSORXVW2,LBL,ECME^PSOORAL1,^PSORXVW2:$O(^PSRX(DA,4,0))
"RTN","PSORXVW1",23,0)
 Q
"RTN","PSORXVW1",24,0)
ACT ;activity log
"RTN","PSORXVW1",25,0)
 N CNT
"RTN","PSORXVW1",26,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Activity Log:"
"RTN","PSORXVW1",27,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Reason         Rx Ref         Initiator Of Activity",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",28,0)
 I '$O(^PSRX(DA,"A",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO Activity to report" Q
"RTN","PSORXVW1",29,0)
 S CNT=0
"RTN","PSORXVW1",30,0)
 F N=0:0 S N=$O(^PSRX(DA,"A",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D DAT D
"RTN","PSORXVW1",31,0)
 .I $P(P1,"^",2)="M" Q
"RTN","PSORXVW1",32,0)
 .S IEN=IEN+1,CNT=CNT+1,^TMP("PSOAL",$J,IEN,0)=CNT_"   "_DAT_"    ",$P(RN," ",15)=" ",REA=$P(P1,"^",2)
"RTN","PSORXVW1",33,0)
 .S REA=$F("HUCELPRWSIVDABXGKNM",REA)-1
"RTN","PSORXVW1",34,0)
 .I REA D
"RTN","PSORXVW1",35,0)
 ..S STA=$P("HOLD^UNHOLD^DISCONTINUED^EDIT^RENEWED^PARTIAL^REINSTATE^REPRINT^SUSPENSE^RETURNED^INTERVENTION^DELETED^DRUG INTERACTION^PROCESSED^X-INTERFACE^PATIENT INSTR.^PKI/DEA^DISP COMPLETED^ECME^","^",REA)
"RTN","PSORXVW1",36,0)
 ..S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA_$E(RN,$L(STA)+1,15)
"RTN","PSORXVW1",37,0)
 .E  S $P(STA," ",15)=" ",^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA
"RTN","PSORXVW1",38,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSORXVW1",39,0)
 .S RFT=$S(RF>0&(RF<6):"REFILL "_RF,RF=6:"PARTIAL",RF>6:"REFILL "_(RF-1),1:"ORIGINAL")
"RTN","PSORXVW1",40,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(P1,"^",3) D ^DIC
"RTN","PSORXVW1",41,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$E(RN,$L(RFT)+1,15)_$S(+Y:$P(Y,"^",2),1:$P(P1,"^",3))
"RTN","PSORXVW1",42,0)
 .;S:$P(P1,"^",5)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(P1,"^",5)
"RTN","PSORXVW1",43,0)
 .I $P(P1,"^",5)]"" N PSOACBRK,PSOACBRV D
"RTN","PSORXVW1",44,0)
 ..S PSOACBRV=$P(P1,"^",5)
"RTN","PSORXVW1",45,0)
 ..;PSO*7*240 Use fileman to format
"RTN","PSORXVW1",46,0)
 ..K ^UTILITY($J,"W") S X="Comments: "_PSOACBRV,(DIWR,DIWL)=1,DIWF="C80" D ^DIWP F I=1:1:^UTILITY($J,"W",1) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$G(^UTILITY($J,"W",1,I,0))
"RTN","PSORXVW1",47,0)
 .I $G(^PSRX(DA,"A",N,1))]"" S IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",5)=$P(^PSRX(DA,"A",N,1),"^") I $P(^PSRX(DA,"A",N,1),"^",2)]"" S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_":"_$P(^PSRX(DA,"A",N,1),"^",2)
"RTN","PSORXVW1",48,0)
 .I $O(^PSRX(DA,"A",N,2,0)) F I=0:0 S I=$O(^PSRX(RXN,"A",N,2,I)) Q:'I  S MIG=^PSRX(RXN,"A",N,2,I,0) D
"RTN","PSORXVW1",49,0)
 ..S:MIG["Mail Tracking Info.: " IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",9)=" "
"RTN","PSORXVW1",50,0)
 ..F SG=1:1:$L(MIG) S:$L(^TMP("PSOAL",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",9)=" " S:$P(MIG," ",SG)'="" ^TMP("PSOAL",$J,IEN,0)=$G(^TMP("PSOAL",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSORXVW1",51,0)
 K MIG,SG,I,^UTILITY($J,"W"),DIWF,DIWL,DIWR
"RTN","PSORXVW1",52,0)
 Q
"RTN","PSORXVW1",53,0)
LBL ;label log
"RTN","PSORXVW1",54,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Label Log:"
"RTN","PSORXVW1",55,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Rx Ref                    Printed By",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",56,0)
 I '$O(^PSRX(DA,"L",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Labels printed." Q
"RTN","PSORXVW1",57,0)
 F L1=0:0 S L1=$O(^PSRX(DA,"L",L1)) Q:'L1  S LBL=^PSRX(DA,"L",L1,0),DTT=$P(^(0),"^") D DAT D
"RTN","PSORXVW1",58,0)
 . S $P(RN," ",26)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=L1_"   "_DAT_"    ",RFT=$S($P(LBL,"^",2):"REFILL "_$P(LBL,"^",2),1:"ORIGINAL"),RFT=RFT_$E(RN,$L(RFT)+1,26)
"RTN","PSORXVW1",59,0)
 . K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(LBL,"^",4) D ^DIC
"RTN","PSORXVW1",60,0)
 . S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$P(Y,"^",2),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(LBL,"^",3)
"RTN","PSORXVW1",61,0)
 . N FDAMGDOC S FDAMGDOC=$P($G(^PSRX(DA,"L",L1,"FDA")),"^")
"RTN","PSORXVW1",62,0)
 . I FDAMGDOC'="" D
"RTN","PSORXVW1",63,0)
 . . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="FDA Med Guide: "_$E(FDAMGDOC,1,61)
"RTN","PSORXVW1",64,0)
 . . I $L(FDAMGDOC)>61 D
"RTN","PSORXVW1",65,0)
 . . . F  Q:$E(FDAMGDOC,62,999)=""  D
"RTN","PSORXVW1",66,0)
 . . . . S FDAMGDOC=$E(FDAMGDOC,62,999),IEN=IEN+1
"RTN","PSORXVW1",67,0)
 . . . . S ^TMP("PSOAL",$J,IEN,0)=$E(FDAMGDOC,1,61)
"RTN","PSORXVW1",68,0)
 K DIC,X,Y Q
"RTN","PSORXVW1",69,0)
 ;
"RTN","PSORXVW1",70,0)
RF ;refill log
"RTN","PSORXVW1",71,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Refill Log:"
"RTN","PSORXVW1",72,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#  Log Date   Refill Date  Qty               Routing  Lot #       Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",73,0)
 S (RF,PL)=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S PL=PL+1
"RTN","PSORXVW1",74,0)
 I 'PL S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Refills For this  Prescription" Q
"RTN","PSORXVW1",75,0)
 F N=0:0 S N=$O(^PSRX(DA,1,N)) Q:'N  S P1=^(N,0) D
"RTN","PSORXVW1",76,0)
 .S DTT=$P(P1,"^",8)\1 D DAT S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"   "
"RTN","PSORXVW1",77,0)
 .S DTT=$P(P1,"^"),$P(RN," ",10)=" " D DAT
"RTN","PSORXVW1",78,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"     "_$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)_"  "_$S($P(P1,"^",2)="M":"Mail",1:"Window")_" "_$P(P1,"^",6)_$E(RN,$L($P(P1,"^",6))+1,12)
"RTN","PSORXVW1",79,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(P1,"^",5) D ^DIC
"RTN","PSORXVW1",80,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_$E($S(+Y:$P(Y,"^",2),1:""),1,16) K DIC,X,Y
"RTN","PSORXVW1",81,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"Unknown"),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_$E("        ",$L(PSDIV)+1,8)_"  "
"RTN","PSORXVW1",82,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"Dispensed: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")_"  "
"RTN","PSORXVW1",83,0)
 .S RTS=$S($P(P1,"^",16):" Returned to Stock: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" Released: "_$S($$RXRLDT^PSOBPSUT(DA,N):$$FMTE^XLFDT($$RXRLDT^PSOBPSUT(DA,N)\1,2),1:""))
"RTN","PSORXVW1",84,0)
 .I $$STATUS^PSOBPSUT(DA,N)'="",$$RXRLDT^PSOBPSUT(DA,N) S RTS=RTS_"  NDC: "_$$GETNDC^PSONDCUT(DA,N)
"RTN","PSORXVW1",85,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RTS
"RTN","PSORXVW1",86,0)
 .S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Remarks: "_$P(P1,"^",3)
"RTN","PSORXVW1",87,0)
 K RTS Q
"RTN","PSORXVW1",88,0)
PAR ;partial log
"RTN","PSORXVW1",89,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Partial Fills:"
"RTN","PSORXVW1",90,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Log Date   Date     Qty              Routing    Lot #        Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",91,0)
 I '$O(^PSRX(DA,"P",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Partials for this Prescription" Q
"RTN","PSORXVW1",92,0)
 S N=0 F  S N=$O(^PSRX(DA,"P",N)) Q:'N  S P1=^(N,0),DTT=$P(P1,"^",8)\1 D DAT D
"RTN","PSORXVW1",93,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"  ",QTY=$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)
"RTN","PSORXVW1",94,0)
 .S DTT=$P(P1,"^") D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"  "_QTY_"  "
"RTN","PSORXVW1",95,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"UNKNOWN"),PSDIV=PSDIV_$E("        ",$L(PSDIV)+1,8)
"RTN","PSORXVW1",96,0)
 .S MW=$S($P(P1,"^",2)="M":"Mail",1:"Window"),MW=MW_$E("          ",$L(MW)+1,10)
"RTN","PSORXVW1",97,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(P1,"^",16) D ^DIC
"RTN","PSORXVW1",98,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_MW_"  "_$P(P1,"^",6)_$E("            ",$L($P(P1,"^",6))+1,10)_$E($S(+Y:$P(Y,"^",2),1:""),1,16)
"RTN","PSORXVW1",99,0)
 .S RTS=$S($P(P1,"^",16):" RETURNED TO STOCK: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" RELEASED: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:""))
"RTN","PSORXVW1",100,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(P1,"^",7) D ^DIC
"RTN","PSORXVW1",101,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_" "_RTS ;_"      Entry By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",102,0)
 .S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  REMARKS: "_$P(P1,"^",3) K RTS
"RTN","PSORXVW1",103,0)
 Q
"RTN","PSORXVW1",104,0)
HLD ;hold info
"RTN","PSORXVW1",105,0)
 S DTT=$P(^PSRX(DA,"H"),"^",3) D DAT S HLDR=$P(^DD(52,99,0),"^",3),HLDR=$S($P(^PSRX(DA,"H"),"^")'>8:$P(HLDR,";",$P(^PSRX(DA,"H"),"^")),1:$P(HLDR,";",9)),HLDR=$P(HLDR,":",2)
"RTN","PSORXVW1",106,0)
 S $P(RN," ",60)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Reason: "_HLDR_$E(RN,$L("Hold Reason: "_HLDR)+1,60)_"Hold Date: "_DAT S:$P(^PSRX(DA,"H"),"^",2)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Comments: "_$P(^PSRX(DA,"H"),"^",2)
"RTN","PSORXVW1",107,0)
 K RN,DAT,DTT,HLDR
"RTN","PSORXVW1",108,0)
 Q
"RTN","PSORXVW1",109,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSORXVW1",110,0)
 Q
"RTN","PSORXVW1",111,0)
INST ;formats instruction from front door
"RTN","PSORXVW1",112,0)
 I $O(^PSRX(DA,"PI",0)) D
"RTN","PSORXVW1",113,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        Instructions:"
"RTN","PSORXVW1",114,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PI",T)) Q:'T  D                  ;PSO*210
"RTN","PSORXVW1",115,0)
 ..S MIG=^PSRX(RXN,"PI",T,0)
"RTN","PSORXVW1",116,0)
 ..D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW1",117,0)
 K T,TY,MIG,SG
"RTN","PSORXVW1",118,0)
 Q
"RTN","PSORXVW1",119,0)
PC ;displays provider comments
"RTN","PSORXVW1",120,0)
 I $O(^PSRX(DA,"PRC",0)) D
"RTN","PSORXVW1",121,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Provider Comments:"
"RTN","PSORXVW1",122,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PRC",T)) Q:'T  D                 ;PSO*210
"RTN","PSORXVW1",123,0)
 ..S MIG=^PSRX(RXN,"PRC",T,0)
"RTN","PSORXVW1",124,0)
 ..D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW1",125,0)
 K T,TY,MIG,SG
"RTN","PSORXVW1",126,0)
 Q
"RTN","PSORXVW1",127,0)
DOSE ;displays dosing instruction for both simple and complex Rxs.
"RTN","PSORXVW1",128,0)
 D DOSE^PSORXVW2
"RTN","PSORXVW1",129,0)
 Q
"RTN","PSORXVW1",130,0)
 ;
"RTN","PSORXVW1",131,0)
HLP ; Help Text for the VIEW PRESCRIPTION prompt
"RTN","PSORXVW1",132,0)
 W !," A prescription number or ECME number may be entered.  To look-up a"
"RTN","PSORXVW1",133,0)
 W !," prescription by the ECME number, please enter ""E."" followed by the ECME"
"RTN","PSORXVW1",134,0)
 W !," number with or without any leading zeros."
"RTN","PSORXVW1",135,0)
 W !!,"  Or just",!
"RTN","PSORXVW1",136,0)
 D LKP("?")
"RTN","PSORXVW1",137,0)
 Q 
"RTN","PSORXVW1",138,0)
 ;
"RTN","PSORXVW1",139,0)
LKP(INPUT) ; - Peforms Lookup on the PRESCRIPTION file
"RTN","PSORXVW1",140,0)
 N DIC,X,Y
"RTN","PSORXVW1",141,0)
 S DIC="^PSRX(",DIC(0)="QE",D="B",X=INPUT
"RTN","PSORXVW1",142,0)
 S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")'=13"
"RTN","PSORXVW1",143,0)
 D IX^DIC
"RTN","PSORXVW1",144,0)
 Q Y
"RTN","PSORXVW2")
0^10^B44714099^B41122049
"RTN","PSORXVW2",1,0)
PSORXVW2 ;ISC-BIRM/PDW - view cmop activity logs ;08 Dec 1999 12:48 PM
"RTN","PSORXVW2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**33,71,117,152,148,367**;DEC 1997;Build 62
"RTN","PSORXVW2",3,0)
 ; External Referrence to file # 550.2 granted by DBIA 2231
"RTN","PSORXVW2",4,0)
 ;External reference to ^PS(50.607 supported by DBIA 2221
"RTN","PSORXVW2",5,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSORXVW2",6,0)
 ;External reference to File ^PS(55 supported by DBIA 2228
"RTN","PSORXVW2",7,0)
 ;External reference to VA(200 supported by DBIA 10060
"RTN","PSORXVW2",8,0)
 ;get data from event multiple
"RTN","PSORXVW2",9,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" "
"RTN","PSORXVW2",10,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="CMOP Event Log:",IEN=IEN+1
"RTN","PSORXVW2",11,0)
 S ^TMP("PSOAL",$J,IEN,0)="Date/Time             Rx Ref  TRN-Order       Stat             Comments",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW2",12,0)
 F PSXA=0:0 S PSXA=$O(^PSRX(DA,4,PSXA)) Q:'PSXA  S PSX4=^(PSXA,0) D FIX D
"RTN","PSORXVW2",13,0)
 . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$$DATE(DA,$P(PSX4,"^",3))_"         "_$S('PSXFIL:"Orig",1:"Ref "_$G(PSXFIL))_"    "_$G(PSXBREF)
"RTN","PSORXVW2",14,0)
 . S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"            "_$G(PSXT)_"    "_$S($G(PSXTST)=3:$E($P($G(PSXCAN),"^"),1,35),$G(PSXNDC)'="":"NDC: "_PSXNDC,1:"")
"RTN","PSORXVW2",15,0)
 . I PSXCAR'=""!(PSXID'="") D
"RTN","PSORXVW2",16,0)
 . . N X S X="Carrier: "_$E(PSXCAR,1,21)
"RTN","PSORXVW2",17,0)
 . . S X=$$SETSTR^VALM1("Pkg ID: ",X,32,8)
"RTN","PSORXVW2",18,0)
 . . S X=X_PSXID
"RTN","PSORXVW2",19,0)
 . . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=X
"RTN","PSORXVW2",20,0)
 . ; FDA Medication Guide
"RTN","PSORXVW2",21,0)
 . N FDAMGDOC S FDAMGDOC=$G(^PSRX(DA,4,PSXA,"FDA"))
"RTN","PSORXVW2",22,0)
 . I FDAMGDOC'="" D
"RTN","PSORXVW2",23,0)
 . . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="FDA Med Guide: "_$E(FDAMGDOC,1,61)
"RTN","PSORXVW2",24,0)
 . . I $L(FDAMGDOC)>61 D
"RTN","PSORXVW2",25,0)
 . . . F  Q:$E(FDAMGDOC,62,999)=""  D
"RTN","PSORXVW2",26,0)
 . . . . S FDAMGDOC=$E(FDAMGDOC,62,999),IEN=IEN+1
"RTN","PSORXVW2",27,0)
 . . . . S ^TMP("PSOAL",$J,IEN,0)=$E(FDAMGDOC,1,61)
"RTN","PSORXVW2",28,0)
 D:$O(^PSRX(DA,5,0))
"RTN","PSORXVW2",29,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" "
"RTN","PSORXVW2",30,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="CMOP Lot#/Expiration Date Log:",IEN=IEN+1
"RTN","PSORXVW2",31,0)
 .S ^TMP("PSOAL",$J,IEN,0)="Rx Ref               Lot #               Expiration Date"
"RTN","PSORXVW2",32,0)
 .S IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW2",33,0)
 .F PSXZ=0:0 S PSXZ=$O(^PSRX(DA,5,PSXZ)) Q:PSXZ']""  S PSXLOT=^(PSXZ,0) D
"RTN","PSORXVW2",34,0)
 ..S EXPDT=$P(PSXLOT,U,2)
"RTN","PSORXVW2",35,0)
 ..S EXPDT=$E(EXPDT,4,5)_"/"_$E(EXPDT,6,7)_"/"_$E(EXPDT,2,3)
"RTN","PSORXVW2",36,0)
 ..S RXREF=$P(PSXLOT,U,3)
"RTN","PSORXVW2",37,0)
 ..S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$S(RXREF=0:"Orig",RXREF>0:"Ref "_RXREF,1:"")_"               "_$P(PSXLOT,U)_"              "_EXPDT
"RTN","PSORXVW2",38,0)
FINI K ANS,Y,%,I,Z,PSXLOT,PSXL,PSX4,F,PSXA,C,ER,PSXFIL,PSX4,PSXREA,PSXVID
"RTN","PSORXVW2",39,0)
 K PSXREL,PSXTRDT,PSXT,PSXLOC,DTOUT,DUOUT,PSXSEQ,PSXA,PSXML,P,I1,I2
"RTN","PSORXVW2",40,0)
 K PSXP,PSXE,PSXE1,PSXERR,PSXBAT,ZD1,ZD2,ZDT,RXREF,PSXZ,PSXTST,PSXTCAN
"RTN","PSORXVW2",41,0)
 K PSXRDT,PSXNDC,PSXM,PSXL1,PSXCAN,PSX1,EXPDT,PSXBREF,RXREF1
"RTN","PSORXVW2",42,0)
 K PSXCAR,PSXID
"RTN","PSORXVW2",43,0)
 Q
"RTN","PSORXVW2",44,0)
FIX ; translate data
"RTN","PSORXVW2",45,0)
 S PSXBAT=$P(PSX4,U),PSXSEQ=$P(PSX4,U,2)
"RTN","PSORXVW2",46,0)
 S PSXFIL=$P(PSX4,U,3),PSXTST=$P(PSX4,U,4)
"RTN","PSORXVW2",47,0)
 S PSXBREF=$G(PSXBAT)_"-"_$G(PSXSEQ)
"RTN","PSORXVW2",48,0)
 S PSXZT=$P(PSX4,U,5),PSXZT1=$P(PSXZT,"."),PSXZT2=$P(PSXZT,".",2)
"RTN","PSORXVW2",49,0)
 I $G(PSXZT)']"" K PSXZT,PSXZT1,PSXZT2 G F1
"RTN","PSORXVW2",50,0)
 S PSXZT2=$E(PSXZT2,1,4)
"RTN","PSORXVW2",51,0)
 S PSXZT1=$E(PSXZT1,4,5)_"/"_$E(PSXZT1,6,7)_"/"_$E(PSXZT1,2,3)
"RTN","PSORXVW2",52,0)
 S PSXTCAN=PSXZT1_"@"_PSXZT2 K PSXZT1,PSXZT2,PSXZT
"RTN","PSORXVW2",53,0)
F1 S PSXNDC=$P(PSX4,U,8)
"RTN","PSORXVW2",54,0)
 S PSXCAN=$G(^PSRX(DA,4,PSXA,1))
"RTN","PSORXVW2",55,0)
 S PSXCAR=$P(PSXCAN,U,3)
"RTN","PSORXVW2",56,0)
 S PSXID=$P(PSXCAN,U,4)
"RTN","PSORXVW2",57,0)
 ; get cmop site
"RTN","PSORXVW2",58,0)
 S I1=PSXBAT   ; S I1=$O(^PSX(550.2,"B",PSXBAT,""))
"RTN","PSORXVW2",59,0)
P1 ; get transmission d/t
"RTN","PSORXVW2",60,0)
 S ZDT=$P(^PSX(550.2,I1,0),U,6),ZD1=$P(ZDT,"."),ZD2=$P(ZDT,".",2)
"RTN","PSORXVW2",61,0)
 S ZD2=$E(ZD2,1,4)
"RTN","PSORXVW2",62,0)
 S ZD1=$E(ZD1,4,5)_"/"_$E(ZD1,6,7)_"/"_$E(ZD1,2,3)
"RTN","PSORXVW2",63,0)
 S PSXTRDT=ZD1_"@"_ZD2
"RTN","PSORXVW2",64,0)
Q1 S:PSXTST=0 PSXT="TRAN"
"RTN","PSORXVW2",65,0)
 S PSXRDT="Not Released"
"RTN","PSORXVW2",66,0)
 I PSXTST=1 D
"RTN","PSORXVW2",67,0)
 .I PSXFIL>0,('$D(^PSRX(DA,1,PSXFIL,0))) S PSXT="Disp Refill Deleted" Q
"RTN","PSORXVW2",68,0)
 .S PSX1=$S(PSXFIL=0:$P(^PSRX(DA,2),"^",13),1:$P(^PSRX(DA,1,PSXFIL,0),"^",18))
"RTN","PSORXVW2",69,0)
 .Q:PSX1']""
"RTN","PSORXVW2",70,0)
 .I PSX1'["." S PSXRDT=$E(PSX1,4,5)_"/"_$E(PSX1,6,7)_"/"_$E(PSX1,2,3) G SKIP
"RTN","PSORXVW2",71,0)
 .S ZR=PSX1,ZR1=$P(ZR,"."),ZR2=$P(ZR,".",2)
"RTN","PSORXVW2",72,0)
 .S ZR2=$E(ZR2,1,4)
"RTN","PSORXVW2",73,0)
 .S PSXRDT=$E(ZR1,4,5)_"/"_$E(ZR1,6,7)_"/"_$E(ZR1,2,3)_"@"_ZR2
"RTN","PSORXVW2",74,0)
 .K ZR,ZR1,ZR2
"RTN","PSORXVW2",75,0)
SKIP .S PSXT="DISP"
"RTN","PSORXVW2",76,0)
 S:PSXTST=2 PSXT="RTRN"
"RTN","PSORXVW2",77,0)
 S:PSXTST=3 PSXT="NDISP"
"RTN","PSORXVW2",78,0)
 Q
"RTN","PSORXVW2",79,0)
 ;
"RTN","PSORXVW2",80,0)
COPAY ;Copay activity log
"RTN","PSORXVW2",81,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Copay Activity Log:"
"RTN","PSORXVW2",82,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Reason               Rx Ref         Initiator Of Activity",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW2",83,0)
 I '$O(^PSRX(DA,"COPAY",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO Copay activity to report" Q
"RTN","PSORXVW2",84,0)
 F N=0:0 S N=$O(^PSRX(DA,"COPAY",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D DAT^PSORXVW1 D
"RTN","PSORXVW2",85,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"    ",$P(RN," ",21)=" ",REA=$P(P1,"^",2),REA=$F("ARICE",REA)-1
"RTN","PSORXVW2",86,0)
 .I REA D
"RTN","PSORXVW2",87,0)
 ..S STA=$P("ANNUAL CAP REACHED^COPAY RESET^IB-INITIATED COPAY^REMOVE COPAY CHARGE^RX EDITED^","^",REA)
"RTN","PSORXVW2",88,0)
 ..S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA_$E(RN,$L(STA)+1,21)
"RTN","PSORXVW2",89,0)
 .E  S $P(STA," ",21)=" ",^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA
"RTN","PSORXVW2",90,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSORXVW2",91,0)
 .S RFT=$S(RF>0:"REFILL "_RF,1:"ORIGINAL")
"RTN","PSORXVW2",92,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$E(RN,$L(RFT)+1,15)_$S($D(^VA(200,+$P(P1,"^",3),0)):$P(^(0),"^"),1:$P(P1,"^",3))
"RTN","PSORXVW2",93,0)
 .S:$P(P1,"^",5)]""!($P(P1,"^",6)]"")!($P(P1,"^",7)]"") IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comment: "_$P(P1,"^",5)
"RTN","PSORXVW2",94,0)
 .I $P(P1,"^",6)]"" S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"  Old value="_$P(P1,"^",6)_"   New value="_$P(P1,"^",7)
"RTN","PSORXVW2",95,0)
 Q
"RTN","PSORXVW2",96,0)
DOSE ;displays dosing instruction for both simple and complex Rxs.
"RTN","PSORXVW2",97,0)
 I '$O(^PSRX(DA,6,0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              Dosage: " Q
"RTN","PSORXVW2",98,0)
 F I=0:0 S I=$O(^PSRX(DA,6,I)) Q:'I  S DOSE=^PSRX(DA,6,I,0) D DOSE1
"RTN","PSORXVW2",99,0)
 K DOSE
"RTN","PSORXVW2",100,0)
 Q
"RTN","PSORXVW2",101,0)
DOSE1 ;
"RTN","PSORXVW2",102,0)
 I '$P(DOSE,"^",2),$P(DOSE,"^",9)]"" S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                Verb: "_$P(DOSE,"^",9)
"RTN","PSORXVW2",103,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             *Dosage: "_$S($E($P(DOSE,"^"),1)="."&($P(DOSE,"^",2)):"0",1:"")_$P(DOSE,"^")_$S($P(DOSE,"^",3):$P(^PS(50.607,$P(DOSE,"^",3),0),"^"),1:"")
"RTN","PSORXVW2",104,0)
 I '$P(DOSE,"^",2),$P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Oth. Lang. Dosage: "_$G(^PSRX(DA,6,I,1))
"RTN","PSORXVW2",105,0)
 I $P(DOSE,"^",2),$P(DOSE,"^",9)]"" S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                Verb: "_$P(DOSE,"^",9)
"RTN","PSORXVW2",106,0)
 I $P(DOSE,"^",2) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="      Dispense Units: "_$S($E($P(DOSE,"^",2),1)=".":"0",1:"")_$P(DOSE,"^",2)
"RTN","PSORXVW2",107,0)
 I $P(DOSE,"^",2) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                Noun: "_$P(DOSE,"^",4)
"RTN","PSORXVW2",108,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              *Route: "_$S($P(DOSE,"^",7):$P(^PS(51.2,$P(DOSE,"^",7),0),"^"),1:"")
"RTN","PSORXVW2",109,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="           *Schedule: "_$P(DOSE,"^",8)
"RTN","PSORXVW2",110,0)
 I $P(DOSE,"^",5)]"" S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="           *Duration: "_$P(DOSE,"^",5)_" ("_$S($P(DOSE,"^",5)["M":"MINUTES",$P(DOSE,"^",5)["H":"HOURS",$P(DOSE,"^",5)["L":"MONTHS",$P(DOSE,"^",5)["W":"WEEKS",1:"DAYS")_")"
"RTN","PSORXVW2",111,0)
 I $P(DOSE,"^",6)]"" S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        *Conjunction: "_$S($P(DOSE,"^",6)="A":"AND",$P(DOSE,"^",6)="T":"THEN",$P(DOSE,"^",6)="E":"EXCEPT",1:"")
"RTN","PSORXVW2",112,0)
 Q
"RTN","PSORXVW2",113,0)
 ;
"RTN","PSORXVW2",114,0)
DATE(RX,RFL) ;
"RTN","PSORXVW2",115,0)
 I $G(PSXTST)=3,$G(PSXTCAN)'="" Q PSXTCAN
"RTN","PSORXVW2",116,0)
 I $G(PSXTST)=1 Q $G(PSXRDT)
"RTN","PSORXVW2",117,0)
 I $G(PSXTST)=3,'RFL,$$GET1^DIQ(52,RX,32.1,"I") Q $$FMTE^XLFDT($$GET1^DIQ(52,RX,32.1,"I"),2)
"RTN","PSORXVW2",118,0)
 I $G(PSXTST)=3,RFL,$$GET1^DIQ(52.1,RFL_","_RX,5,"I") Q $$FMTE^XLFDT($$GET1^DIQ(52.1,RFL_","_RX,32.1,"I"),2)
"RTN","PSORXVW2",119,0)
 Q $G(PSXTRDT)
"RTN","PSORXVW2",120,0)
 ;
"RTN","PSORXVW2",121,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSORXVW2",122,0)
 Q
"RTN","PSOSULB1")
0^18^B46991126^B43045275
"RTN","PSOSULB1",1,0)
PSOSULB1 ;BHAM ISC/RTR,SAB-Print suspended labels  cont. ;10/10/96
"RTN","PSOSULB1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,200,264,289,367**;DEC 1997;Build 62
"RTN","PSOSULB1",3,0)
 ;Reference to $$INSUR^IBBAPI supported by IA 4419
"RTN","PSOSULB1",4,0)
 ;Reference to $$DEA^IBNCPDP controlled subscription by IA 4299
"RTN","PSOSULB1",5,0)
 ;
"RTN","PSOSULB1",6,0)
DEV D:'$D(PSOPAR) ^PSOLSET G:'$D(PSOPAR) DEV S PSOION=ION
"RTN","PSOSULB1",7,0)
 N X S X="PSXRSUS" X ^%ZOSF("TEST") G:($T)&($G(PSXSYS))&($D(^XUSEC("PSXCMOPMGR",DUZ)))&($D(^XUSEC("PSX XMIT",DUZ))) ^PSXRSUS
"RTN","PSOSULB1",8,0)
DEV1 I '$P(PSOPAR,"^",8) G START
"RTN","PSOSULB1",9,0)
 N PSOPROP,PFIO W $C(7),!!,"PROFILES MUST BE SENT TO PRINTER !!",! K IOP,%ZIS,IO("Q"),POP S %ZIS="MNQ",%ZIS("A")="Select PROFILE Device: " D ^%ZIS K %ZIS("A") G:POP EXIT^PSOSULBL G:$E(IOST)["C"!(PSOION=ION) DEV S PSOPROP=ION D ^%ZISC
"RTN","PSOSULB1",10,0)
START I $G(PSOCUTDT)']"" S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X,PSOPRPAS=$P(PSOPAR,"^",7)
"RTN","PSOSULB1",11,0)
ASK K ^TMP($J),PSOSU,PSOSUSPR S PFIOQ=0,PDUZ=DUZ W !
"RTN","PSOSULB1",12,0)
 S %DT="AEX",%DT("A")="Print labels through date: ",%DT("B")="TODAY" D ^%DT K %DT D:Y<0 MESS G:Y<0 EXIT^PSOSULBL S PRTDT=Y
"RTN","PSOSULB1",13,0)
 I '$O(^PS(52.5,"C",0))!($O(^(0))>PRTDT) W $C(7),!!,"NOTHING THRU DATE TO PRINT" G ASK
"RTN","PSOSULB1",14,0)
 W ! K DIR S DIR("A")="Sort by Patient Name, ID#, or DEA Special Handling",DIR(0)="SB^P:PATIENT NAME;I:IDENTIFICATION NUMBER;D:DEA SPECIAL HANDLING"
"RTN","PSOSULB1",15,0)
 S DIR("?")="Enter 'P' to sort the labels alphabetically by name, enter 'I' to sort by identification number, enter 'D' to sort by DEA Special Handling."
"RTN","PSOSULB1",16,0)
 S DIR("?",1)="Sorting by DEA Special Handling will print the labels in three groups. The",DIR("?",2)="first will contain labels with drugs marked with an A or C in the DEA Special"
"RTN","PSOSULB1",17,0)
 S DIR("?",3)="Handling field, indicating NARCOTICS AND ALCOHOLICS, and CONTROLLED SUBSTANCES-",DIR("?",4)="NON NARCOTIC. The second group will contain ones marked with an S, indicating"
"RTN","PSOSULB1",18,0)
 S DIR("?",5)="SUPPLY, and all others will print in the third group.",DIR("?",6)=""
"RTN","PSOSULB1",19,0)
 D ^DIR K DIR D:$D(DIRUT) MESS G:$D(DIRUT) EXIT^PSOSULBL S PSRT=$S(Y="D":"D",Y="P":1,1:0)
"RTN","PSOSULB1",20,0)
 I Y="D" W ! K DIR S DIR(0)="SB^P:PATIENT NAME;I:IDENTIFICATION NUMBER",DIR("A")="Within DEA Special Handling, sort by Patient Name or ID#" D ^DIR K DIR D:$D(DIRUT) MESS G:$D(DIRUT) EXIT^PSOSULBL S PSRTONE=Y
"RTN","PSOSULB1",21,0)
 S X1=PRTDT,X2=$P(PSOPAR,"^",27) D C^%DTC S XDATE=X K IOP,POP,IO("Q"),ZTSK
"RTN","PSOSULB1",22,0)
PRLBL W ! S %ZIS("A")="Printer 'LABEL' Device: ",%ZIS("B")="",%ZIS="MQN" D ^%ZIS S PSLION=ION I POP S IOP=PSOION D ^%ZIS D MESS G EXIT^PSOSULBL
"RTN","PSOSULB1",23,0)
 I $E(IOST)'["P" D MESSL G PRLBL
"RTN","PSOSULB1",24,0)
 ;
"RTN","PSOSULB1",25,0)
FDAPRT ; Selects FDA Medication Guide Printer
"RTN","PSOSULB1",26,0)
 I $$GET1^DIQ(59,PSOSITE,134)'="" N FDAPRT S FDAPRT="" D  I FDAPRT="^"!($G(PSOFDAPT)="") G EXIT^PSOSULBL
"RTN","PSOSULB1",27,0)
 . F  D  Q:FDAPRT'=""
"RTN","PSOSULB1",28,0)
 . . S FDAPRT=$$SELPRT^PSOFDAUT($P($G(PSOFDAPT),"^"))
"RTN","PSOSULB1",29,0)
 . . I FDAPRT="" W $C(7),!,"You must select a valid FDA Medication Guide printer."
"RTN","PSOSULB1",30,0)
 . I FDAPRT'="",(FDAPRT'="^") S PSOFDAPT=FDAPRT
"RTN","PSOSULB1",31,0)
 ;
"RTN","PSOSULB1",32,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOSULB1",33,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",19)
"RTN","PSOSULB1",34,0)
 K PSOION D ^%ZISC I $D(IO("Q")) K IO("Q")
"RTN","PSOSULB1",35,0)
QUE K %DT,PSOTIME,PSOOUT D NOW^%DTC S %DT="REAX",%DT(0)=%,%DT("B")="NOW",%DT("A")="Queue to run at what time: " D ^%DT K %DT I $D(DTOUT)!(Y<0) D MESS G EXIT^PSOSULBL
"RTN","PSOSULB1",36,0)
 S (PSOSUSPR,PSODBQ)=1,PSOTIME=Y
"RTN","PSOSULB1",37,0)
 S ZTRTN="BEG^PSOSULBL",ZTDESC="PRINT LABELS FROM SUSPENSE",ZTIO=PSLION,ZTDTH=PSOTIME
"RTN","PSOSULB1",38,0)
 F G="PSOPAR","PSOSYS","PSOSUSPR","PSODBQ","PSRT","PSRTONE","PSOPROP","PSLION","PFIO","PSOBARS","PSODTCUT","PSOPRPAS","PRTDT","PDUZ","PSOBAR0","PSOBAR1","PSOSITE","XDATE","PSOTIME","PSOFDAPT" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOSULB1",39,0)
 D ^%ZTLOAD W !!,"PRINT FROM SUSPENSE JOB QUEUED!",! D ^%ZISC G EXIT^PSOSULBL
"RTN","PSOSULB1",40,0)
 ;G:PSRT'="D" BEG^PSOSULBL
"RTN","PSOSULB1",41,0)
MESS W $C(7),!!?3,"NOTHING QUEUED TO PRINT!",! Q
"RTN","PSOSULB1",42,0)
MESSL W $C(7),!?3,"LABELS MUST BE SENT TO A PRINTER!",! Q
"RTN","PSOSULB1",43,0)
BAIMAIL     ;Send mail message
"RTN","PSOSULB1",44,0)
 S:'$G(PDUZ) PDUZ=+$G(DUZ)
"RTN","PSOSULB1",45,0)
 K ^TMP("PSOM",$J)
"RTN","PSOSULB1",46,0)
 N SEQ,XMY,XMDUZ,XMSUB,XMTEXT,SEQ,NAME,PSSN,RX,FILL,FIRST
"RTN","PSOSULB1",47,0)
 S SEQ=1
"RTN","PSOSULB1",48,0)
 S XMY(PDUZ)=""
"RTN","PSOSULB1",49,0)
 S XMY("G.PSO EXTERNAL DISPENSE ALERTS")=""
"RTN","PSOSULB1",50,0)
 S XMDUZ="OUTPATIENT PHARMACY PACKAGE"
"RTN","PSOSULB1",51,0)
 S XMSUB="BAD ADDRESS SUSPENSE NOT PRINTED"
"RTN","PSOSULB1",52,0)
 I $G(PSOSITE) S XMSUB=$$GET1^DIQ(59,PSOSITE,.06)_" "_XMSUB
"RTN","PSOSULB1",53,0)
 S ^TMP("PSOM",$J,SEQ)="The following prescriptions with a routing of mail were not printed/sent to",SEQ=SEQ+1
"RTN","PSOSULB1",54,0)
 S ^TMP("PSOM",$J,SEQ)="external interface due to the BAD ADDRESS INDICATOR being set and no active",SEQ=SEQ+1
"RTN","PSOSULB1",55,0)
 S ^TMP("PSOM",$J,SEQ)="temporary address, or the patient has an active MAIL status of DO NOT MAIL, or",SEQ=SEQ+1
"RTN","PSOSULB1",56,0)
 S ^TMP("PSOM",$J,SEQ)="the patient has a foreign address:",SEQ=SEQ+1
"RTN","PSOSULB1",57,0)
 S NAME="" F  S NAME=$O(^TMP("PSOSM",$J,NAME)) Q:NAME=""  D
"RTN","PSOSULB1",58,0)
 .S PSSN="" F  S PSSN=$O(^TMP("PSOSM",$J,NAME,PSSN)) Q:PSSN=""  D
"RTN","PSOSULB1",59,0)
 ..S ^TMP("PSOM",$J,SEQ)="",SEQ=SEQ+1
"RTN","PSOSULB1",60,0)
 ..S ^TMP("PSOM",$J,SEQ)=NAME_"   "_PSSN,FIRST=1
"RTN","PSOSULB1",61,0)
 ..S RX=0 F  S RX=$O(^TMP("PSOSM",$J,NAME,PSSN,RX)) Q:'RX  S FILL="" F  S FILL=$O(^TMP("PSOSM",$J,NAME,PSSN,RX,FILL)) Q:FILL=""  D
"RTN","PSOSULB1",62,0)
 ...I FIRST D  S FIRST=0
"RTN","PSOSULB1",63,0)
 ....S ^TMP("PSOM",$J,SEQ)=^TMP("PSOM",$J,SEQ)_"   ("_$G(^TMP("PSOSM",$J,NAME,PSSN,RX,FILL))_")"
"RTN","PSOSULB1",64,0)
 ....S SEQ=SEQ+1
"RTN","PSOSULB1",65,0)
 ...S ^TMP("PSOM",$J,SEQ)="  "_$P(^PSRX(RX,0),"^")_" ("_FILL_")  "_$P($G(^PSDRUG($P(^PSRX(RX,0),"^",6),0)),"^"),SEQ=SEQ+1
"RTN","PSOSULB1",66,0)
 S ^TMP("PSOM",$J,SEQ+1)=""
"RTN","PSOSULB1",67,0)
 S XMTEXT="^TMP(""PSOM"",$J," N DIFROM D ^XMD K XMSUB,XMTEXT,XMY,XMDUZ
"RTN","PSOSULB1",68,0)
 Q
"RTN","PSOSULB1",69,0)
 ;Description: 
"RTN","PSOSULB1",70,0)
 ;This function determines whether the RX SUSPENSE has a DAYS SUPPLY HOLD
"RTN","PSOSULB1",71,0)
 ;condition.
"RTN","PSOSULB1",72,0)
 ;Input: REC = Pointer to Suspense file (#52.5)
"RTN","PSOSULB1",73,0)
 ;Returns: 1 or 0
"RTN","PSOSULB1",74,0)
 ;1 (one) if 3/4 of days supply has elapsed.
"RTN","PSOSULB1",75,0)
 ;0 (zero) is returned if 3/4 of days supply has not elapsed. 
"RTN","PSOSULB1",76,0)
 ;
"RTN","PSOSULB1",77,0)
DSH(REC) ; ePharmacy - verify that 3/4 days supply has elapsed before printing from suspense
"RTN","PSOSULB1",78,0)
 N PSINSUR,PSARR,SHDT,DSHOLD,DSHDT,PS0,COMM,DIE,DA,DR,RXIEN,RFL,DAYSSUP,LSTFIL,PTDFN,IBINS,DRG
"RTN","PSOSULB1",79,0)
 N DEA,DEAOK,ICD,SFN,SDT
"RTN","PSOSULB1",80,0)
 S DSHOLD=1,PS0=^PS(52.5,REC,0),RXIEN=$P(PS0,U,1),RFL=$P(PS0,U,13)
"RTN","PSOSULB1",81,0)
 S LSTFIL=$$LSTRFL^PSOBPSU1(RXIEN),PTDFN=$$GET1^DIQ(52,RXIEN,"2","I")
"RTN","PSOSULB1",82,0)
 S IBSTAT=$$INSUR^IBBAPI(PTDFN,,"E",.IBINS,"1"),DRG=$$GET1^DIQ(52,RXIEN,"6","I")
"RTN","PSOSULB1",83,0)
 S (DEA,ICD)="",DEA=$$GET1^DIQ(50,DRG,3)
"RTN","PSOSULB1",84,0)
 I $D(^PSRX(RXIEN,"ICD",1,0)) S ICD=^PSRX(RXIEN,"ICD",1,0)
"RTN","PSOSULB1",85,0)
 ;
"RTN","PSOSULB1",86,0)
 ; Don't hold Rx where the previous fill was not ebillable
"RTN","PSOSULB1",87,0)
 I $$STATUS^BPSOSRX(RXIEN,LSTFIL-1)="" Q DSHOLD
"RTN","PSOSULB1",88,0)
 ; Don't hold when the Rx has SC/EI flagged
"RTN","PSOSULB1",89,0)
 I ICD[1 Q DSHOLD
"RTN","PSOSULB1",90,0)
 ; Don't hold rx if DEA special Handling code is non billable (i.e. has M or 0 (zero) or (I, S, N, and/or 9)) without an E
"RTN","PSOSULB1",91,0)
 S DEAOK=$$DEA^IBNCPDP(DEA) I 'DEAOK Q DSHOLD
"RTN","PSOSULB1",92,0)
 ; Don't hold for zero fill renewals
"RTN","PSOSULB1",93,0)
 I 'LSTFIL,$$GET1^DIQ(52,RXIEN_",","PRIOR FILL DATE",,,)="" Q DSHOLD
"RTN","PSOSULB1",94,0)
 ; Don't hold if no insurance
"RTN","PSOSULB1",95,0)
 I 'IBSTAT!(IBSTAT=-1) Q DSHOLD
"RTN","PSOSULB1",96,0)
 ;
"RTN","PSOSULB1",97,0)
 S DSHDT=$$DSHDT(RXIEN) ; 3/4 of days supply date
"RTN","PSOSULB1",98,0)
 I DSHDT>DT S DSHOLD=0 D
"RTN","PSOSULB1",99,0)
 . I DSHDT'=$P(PS0,U,14) D  ; Update Suspense Hold Date and Activity Log
"RTN","PSOSULB1",100,0)
 . . S COMM="3/4 of Days Supply SUSPENSE HOLD until "_$$FMTE^XLFDT(DSHDT,"2D")_"."
"RTN","PSOSULB1",101,0)
 . . S DAYSSUP=$$LFDS(RXIEN)
"RTN","PSOSULB1",102,0)
 . . D RXACT^PSOBPSU2(RXIEN,RFL,COMM,"S",+$G(DUZ)) ; Update Activity Log
"RTN","PSOSULB1",103,0)
 . . S DR="10///^S X=DSHDT",DIE="^PS(52.5,",DA=REC D ^DIE ; File Suspense Hold Date
"RTN","PSOSULB1",104,0)
 . . N DA,DIE,DR,PSOX,SFN,INDT,DEAD,SUB,XOK,OLD,X,II
"RTN","PSOSULB1",105,0)
 . . S DA=REC,DIE="^PS(52.5,",DR=".02///"_DSHDT D ^DIE
"RTN","PSOSULB1",106,0)
 . . S SFN=REC,DEAD=0,INDT=DSHDT D CHANGE^PSOSUCH1(RXIEN,RFL)
"RTN","PSOSULB1",107,0)
 Q DSHOLD
"RTN","PSOSULB1",108,0)
 ;
"RTN","PSOSULB1",109,0)
 ;Description:
"RTN","PSOSULB1",110,0)
 ;This function determines the date that 3/4 of the days supply for the
"RTN","PSOSULB1",111,0)
 ;last refill will occur.
"RTN","PSOSULB1",112,0)
 ;Input: RXIEN = Prescription file #52 IEN
"RTN","PSOSULB1",113,0)
 ;Returns: DATE/TIME value
"RTN","PSOSULB1",114,0)
DSHDT(RXIEN) ;
"RTN","PSOSULB1",115,0)
 N FILLDT,DAYSSUP,DSH34
"RTN","PSOSULB1",116,0)
 I '$D(^PSRX(RXIEN,0)) Q -1
"RTN","PSOSULB1",117,0)
 S FILLDT=$$LDPFDT(RXIEN) ; Last Dispensed Date or Prior Fill Date for renewal
"RTN","PSOSULB1",118,0)
 S DAYSSUP=$$LFDS(RXIEN) ; Days Supply of Last Refill
"RTN","PSOSULB1",119,0)
 S DSH34=DAYSSUP*.75 ; 3/4 of Days Supply
"RTN","PSOSULB1",120,0)
 S:DSH34["." DSH34=(DSH34+1)\1
"RTN","PSOSULB1",121,0)
 Q $$FMADD^XLFDT(FILLDT,DSH34) ; Return today plus 3/4 of Days Supply date
"RTN","PSOSULB1",122,0)
 ;
"RTN","PSOSULB1",123,0)
 ; Description: This function returns the DAYS SUPPLY for the Latest Fill
"RTN","PSOSULB1",124,0)
 ; for a Prescription
"RTN","PSOSULB1",125,0)
 ; Input: RXIEN = Prescription file #52 IEN
"RTN","PSOSULB1",126,0)
 ; Returns: DAYS SUPPLY for the latest fill
"RTN","PSOSULB1",127,0)
 ;          -1 if RXIEN is not valid
"RTN","PSOSULB1",128,0)
LFDS(RXIEN) ;
"RTN","PSOSULB1",129,0)
 N RXFIL
"RTN","PSOSULB1",130,0)
 Q:'$D(^PSRX(RXIEN)) -1
"RTN","PSOSULB1",131,0)
 S RXFIL=$$LSTRFL^PSOBPSU1(RXIEN)
"RTN","PSOSULB1",132,0)
 Q $S(RXFIL=0:$P(^PSRX(RXIEN,0),U,8),1:$P(^PSRX(RXIEN,1,RXFIL,0),U,10))
"RTN","PSOSULB1",133,0)
 ;
"RTN","PSOSULB1",134,0)
LDPFDT(RXIEN) ; Returns PRIOR FILL DATE if renewal otherwise LAST DISPENSED DATE or -1 if not valid
"RTN","PSOSULB1",135,0)
 Q $S('$D(^PSRX(RXIEN)):-1,$$PRFDT(RXIEN):$$PRFDT(RXIEN),1:$$LDT(RXIEN))
"RTN","PSOSULB1",136,0)
 ;
"RTN","PSOSULB1",137,0)
PRFDT(RXIEN) ; Returns PRIOR FILL DATE in internal format
"RTN","PSOSULB1",138,0)
 Q $$GET1^DIQ(52,RXIEN_",","PRIOR FILL DATE","I",,)
"RTN","PSOSULB1",139,0)
 ;
"RTN","PSOSULB1",140,0)
LDT(RXIEN) ; Returns LAST DISPENSED DATE in internal format
"RTN","PSOSULB1",141,0)
 Q $$GET1^DIQ(52,RXIEN_",","LAST DISPENSED DATE","I",,)
"RTN","PSOSURST")
0^25^B37361776^B31910797
"RTN","PSOSURST",1,0)
PSOSURST ;BIR/RTR-Reset and Reprint from Suspense ; 7/20/96
"RTN","PSOSURST",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,367**;DEC 1997;Build 62
"RTN","PSOSURST",3,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) G END
"RTN","PSOSURST",4,0)
 N X S X="PSXRPPL1" X ^%ZOSF("TEST") K X G:'$T START
"RTN","PSOSURST",5,0)
 G:$G(PSXSYS)&($D(^XUSEC("PSXCMOPMGR",DUZ)))&($D(^XUSEC("PSX XMIT",DUZ))) ^PSXRPPL1
"RTN","PSOSURST",6,0)
START W !!,"Enter a date range to see all batches printed from suspense within those dates."
"RTN","PSOSURST",7,0)
BEG K ^TMP($J,"PSORES"),^TMP($J,"PSORESPR"),^UTILITY($J,"PSOREPT"),PSOOUT,DTOUT,PSOLISTY
"RTN","PSOSURST",8,0)
 W ! K %DT S %DT="AEX",%DT("A")="Start date: " D ^%DT K %DT G:Y<0!($D(DTOUT)) END S (%DT(0),BEGDATE)=Y W ! S %DT="AEX",%DT("A")="End date: " D ^%DT K %DT G:Y<0!($D(DTOUT)) END S ENDDATE=Y
"RTN","PSOSURST",9,0)
 S BEGDATE=BEGDATE-.0001,ENDDATE=ENDDATE+.9999,RECNT=1 W !!,"Gathering batches, please wait...",! H 1
"RTN","PSOSURST",10,0)
 F ZZZ=BEGDATE:0 S ZZZ=$O(^PS(52.5,"AS",ZZZ)) Q:'ZZZ!(ZZZ>ENDDATE)  F XXX=0:0 S XXX=$O(^PS(52.5,"AS",ZZZ,XXX)) Q:'XXX  F MMM=0:0 S MMM=$O(^PS(52.5,"AS",ZZZ,XXX,MMM)) Q:'MMM  D
"RTN","PSOSURST",11,0)
 .I MMM=$G(PSOSITE) S ^TMP($J,"PSORES",RECNT,ZZZ,XXX,MMM)="",RECNT=RECNT+1
"RTN","PSOSURST",12,0)
 I '$D(^TMP($J,"PSORES")) W $C(7),!!,"There are no printed batches found for that date range!",! G BEG
"RTN","PSOSURST",13,0)
 H 1 W @IOF W !?1,"BATCH",?10,"QUEUED TO PRINT ON:",?40,"PRINTED BY:",?56,$E($P($G(^PS(59,PSOSITE,0)),"^"),1,23),! F AA=1:1:78 W "-"
"RTN","PSOSURST",14,0)
 W ! F AAA=0:0 S AAA=$O(^TMP($J,"PSORES",AAA)) Q:'AAA!($G(PSOOUT))  S PSIDATE=$O(^TMP($J,"PSORES",AAA,0)),PSODUZ=$O(^TMP($J,"PSORES",AAA,PSIDATE,0)) D
"RTN","PSOSURST",15,0)
 .S Y=PSIDATE X ^DD("DD") S PSODATE=Y,PSOUSER=$S($D(^VA(200,PSODUZ,0)):$P($G(^(0)),"^"),1:"UNKNOWN") D:($Y+5)>IOSL  Q:$G(PSOOUT)  W !?2,AAA,?10,PSODATE,?40,PSOUSER
"RTN","PSOSURST",16,0)
 ..W ! K DIR S DIR(0)="E" D ^DIR K DIR S:'Y PSOOUT=1 I Y W @IOF W !?1,"BATCH",?10,"QUEUED TO PRINT ON:",?40,"PRINTED BY:",?56,$E($P($G(^PS(59,PSOSITE,0)),"^"),1,23),! F AA=1:1:78 W "-"
"RTN","PSOSURST",17,0)
 I $G(PSOOUT),Y="" G END
"RTN","PSOSURST",18,0)
 S RECNT=RECNT-1,PSOOUT=0 W ! K DIR S DIR("A")="Select Batch(s) to reprint",DIR(0)="L^1:"_RECNT D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) W !!?3,"Nothing queued to print!",! G START
"RTN","PSOSURST",19,0)
 S COUNT=1 F ZZ=1:1:$L(Y) S ZZZ=$E(Y,ZZ) I ZZZ="," S COUNT=COUNT+1
"RTN","PSOSURST",20,0)
 S COUNT=COUNT-1 F JJ=1:1:COUNT S RR=$P(Y,",",JJ),^TMP($J,"PSORESPR",RR)=""
"RTN","PSOSURST",21,0)
YLOOP I $G(Y(1)) F PSYLOOP=0:0 S PSYLOOP=$O(Y(PSYLOOP)) Q:'PSYLOOP  D
"RTN","PSOSURST",22,0)
 .S COUNT=1 F ZZ=1:1:$L(Y(PSYLOOP)) S ZZZ=$E(Y(PSYLOOP),ZZ) I ZZZ="," S COUNT=COUNT+1
"RTN","PSOSURST",23,0)
 .S COUNT=COUNT-1 F JJ=1:1:COUNT S RR=$P(Y(PSYLOOP),",",JJ),^TMP($J,"PSORESPR",RR)=""
"RTN","PSOSURST",24,0)
 W !!,"Batches selected for Reprint are:",! F ZZZ=0:0 S ZZZ=$O(^TMP($J,"PSORESPR",ZZZ)) Q:'ZZZ  D
"RTN","PSOSURST",25,0)
 .S PSIDATE=$O(^TMP($J,"PSORES",ZZZ,0)),PSODUZ=$O(^TMP($J,"PSORES",ZZZ,PSIDATE,0)) S Y=PSIDATE X ^DD("DD") S PSODATE=Y,PSOUSER=$S($D(^VA(200,PSODUZ,0)):$P($G(^(0)),"^"),1:"UNKNOWN")
"RTN","PSOSURST",26,0)
 .W !,"Batch ",ZZZ," Queued for ",PSODATE," by ",PSOUSER
"RTN","PSOSURST",27,0)
 ;
"RTN","PSOSURST",28,0)
 I $$GET1^DIQ(59,PSOSITE,134)'="" D  I $D(DIRUT)!($D(DTOUT)) W !!?3,"Nothing queued to print!",! G START
"RTN","PSOSURST",29,0)
 . W ! K DIR,DIRUT S DIR("A")="Reprint the FDA Medication Guide",DIR(0)="Y",DIR("B")="No"
"RTN","PSOSURST",30,0)
 . D ^DIR K DIR I $D(DIRUT)!($D(DTOUT)) Q
"RTN","PSOSURST",31,0)
 . S PSOMGREP=Y
"RTN","PSOSURST",32,0)
 ;
"RTN","PSOSURST",33,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Before Reprinting, would you like a list of these prescriptions" D ^DIR K DIR I Y["^"!($D(DTOUT)) W !!?3,"Nothing queued to print!",! G START
"RTN","PSOSURST",34,0)
 I Y W ! S PSOLISTY=1 S DIR(0)="SB^S:SCREEN;P:PRINTER",DIR("A")="Print list to the screen or to a printer",DIR("B")="Screen" D ^DIR K DIR I $D(DIRUT) W !!?3,"Nothing queued to print!",! G START
"RTN","PSOSURST",35,0)
 I $G(PSOLISTY),Y="P" D ^PSOSUBCH G START
"RTN","PSOSURST",36,0)
 I $G(PSOLISTY) D LIST I $G(PSOOUT) G START
"RTN","PSOSURST",37,0)
QUE W ! K %DT D NOW^%DTC S %DT="REAX",%DT(0)=%,%DT("B")="NOW",%DT("A")="Queue labels to reprint at what time: " D ^%DT K %DT I $D(DTOUT)!(Y<0) W !!?3,"Nothing queued to print!",! G START
"RTN","PSOSURST",38,0)
 S PSOSUREP=1,PSORTIME=Y
"RTN","PSOSURST",39,0)
 W ! S %ZIS("A")="REPRINT LABEL DEVICE: ",%ZIS("B")="",%ZIS="MQN" D ^%ZIS I POP!($E(IOST)["C") W !!?3,"Nothing queued to print!",! G START
"RTN","PSOSURST",40,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOSURST",41,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",19)
"RTN","PSOSURST",42,0)
 S PSOREDEV=ION
"RTN","PSOSURST",43,0)
 ;
"RTN","PSOSURST",44,0)
 ; Asking FDA Med Guide printer
"RTN","PSOSURST",45,0)
 I $G(PSOMGREP),$$GET1^DIQ(59,PSOSITE,134)'="" N FDAPRT S FDAPRT="" D  I FDAPRT="^"!($G(PSOFDAPT)="") W !!?3,"Nothing queued to print!",! G START
"RTN","PSOSURST",46,0)
 . F  D  Q:FDAPRT'=""
"RTN","PSOSURST",47,0)
 . . S FDAPRT=$$SELPRT^PSOFDAUT($P($G(PSOFDAPT),"^"))
"RTN","PSOSURST",48,0)
 . . I FDAPRT="" W $C(7),!,"You must select a valid FDA Medication Guide printer."
"RTN","PSOSURST",49,0)
 . I FDAPRT'="",(FDAPRT'="^") S PSOFDAPT=FDAPRT
"RTN","PSOSURST",50,0)
 ;
"RTN","PSOSURST",51,0)
 S ZTRTN="BEG^PSOSUSRP",ZTDTH=PSORTIME,ZTIO=PSOREDEV,ZTDESC="REPRINT LABELS FROM SUSPENSE"
"RTN","PSOSURST",52,0)
 F GG="PSOPAR","PSOSYS","PSOSITE","PSOSUREP","PSOMGREP","PSOBARS","PSOBAR0","PSOBAR1","PSOFDAPT" S:$D(@GG) ZTSAVE(GG)=""
"RTN","PSOSURST",53,0)
 F NNN=0:0 S NNN=$O(^TMP($J,"PSORESPR",NNN)) Q:'NNN  D
"RTN","PSOSURST",54,0)
 .S PSRDATE=$O(^TMP($J,"PSORES",NNN,0)),PSRDUZ=$O(^TMP($J,"PSORES",NNN,PSRDATE,0)),PSRDIV=$O(^TMP($J,"PSORES",NNN,PSRDATE,PSRDUZ,0))
"RTN","PSOSURST",55,0)
 .S ^UTILITY($J,"PSOREPT",PSRDATE,PSRDUZ,PSRDIV)=""
"RTN","PSOSURST",56,0)
 S ZTSAVE("^UTILITY($J,""PSOREPT"",")="" D ^%ZTLOAD
"RTN","PSOSURST",57,0)
 W !!,"REPRINTED LABELS QUEUED TO PRINT!",!
"RTN","PSOSURST",58,0)
END K ^TMP($J,"PSORES"),^TMP($J,"PSORESPR"),^UTILITY($J,"PSOREPT"),%DT,%ZIS,AA,AAA,BEGDATE,COUNT,DUOUT,DTOUT
"RTN","PSOSURST",59,0)
 K ENDDATE,GG,INRX,JJ,LLL,MMM,NNN,POP,PSIDATE,PSODATE,PSODUZ,PSOREDEV,PSORTIME,PSOSUREP,PSOUSER,PSYLOOP,PSOMGREP
"RTN","PSOSURST",60,0)
 K PSRDATE,PSRDIV,PSOLISTY,PSRDUZ,RECNT,REDT,REDUZ,RR,SS,XXX,ZZ,ZZZ,ZZZ D ^%ZISC Q
"RTN","PSOSURST",61,0)
LIST F LLL=0:0 S LLL=$O(^TMP($J,"PSORESPR",LLL)) Q:'LLL!($G(PSOOUT))  D
"RTN","PSOSURST",62,0)
 .W ! S DIR(0)="E" D ^DIR K DIR S:'Y PSOOUT=1 Q:$G(PSOOUT)  D HEAD S REDT=$O(^TMP($J,"PSORES",LLL,0)),REDUZ=$O(^TMP($J,"PSORES",LLL,REDT,0)) F SS=0:0 S SS=$O(^PS(52.5,"AS",REDT,REDUZ,PSOSITE,SS)) Q:'SS!($G(PSOOUT))  D
"RTN","PSOSURST",63,0)
 ..F GG=0:0 S GG=$O(^PS(52.5,"AS",REDT,REDUZ,PSOSITE,SS,GG)) Q:'GG!($G(PSOOUT))  D:($Y+5)>IOSL HEADONE Q:$G(PSOOUT)  I $D(^PS(52.5,GG,0)),$P($G(^(0)),"^",6)=PSOSITE S INRX=$P(^(0),"^") I $D(^PSRX(INRX,0)) D
"RTN","PSOSURST",64,0)
 ...W !,$P(^PSRX(INRX,0),"^"),?20,$P($G(^DPT(+$P(^PSRX(INRX,0),"^",2),0)),"^"),?60,$S($P($G(^PS(52.5,GG,0)),"^",5):"(PARTIAL)",$P($G(^(0)),"^",12):"(REPRINT)",1:"")
"RTN","PSOSURST",65,0)
 I $G(PSOOUT),(Y="") Q
"RTN","PSOSURST",66,0)
 S PSOOUT=0 I Y'=0 W !,"END OF LIST"
"RTN","PSOSURST",67,0)
 Q
"RTN","PSOSURST",68,0)
HEAD W @IOF W !,"RX #",?20,"PATIENT NAME",?60,"BATCH ",LLL,! F ZZZZ=1:1:78 W "-"
"RTN","PSOSURST",69,0)
 Q
"RTN","PSOSURST",70,0)
HEADONE S DIR(0)="E" D ^DIR K DIR I 'Y S PSOOUT=1 Q
"RTN","PSOSURST",71,0)
 W @IOF W !,"RX #",?20,"PATIENT NAME",?60,"BATCH ",LLL,! F ZZZZ=1:1:78 W "-"
"RTN","PSOSURST",72,0)
 Q
"UP",52,52.01,-1)
52^4
"UP",52,52.01,0)
52.01
"UP",52,52.032,-1)
52^L
"UP",52,52.032,0)
52.032
"UP",59,59.0135,-1)
59^FDA
"UP",59,59.0135,0)
59.0135
"VER")
8.0^22.0
"^DD",52,52.01,35,0)
FDA MED GUIDE FILENAME^F^^FDA;1^K:$L(X)>100!($L(X)<1) X
"^DD",52,52.01,35,3)
Answer must be 1-100 characters in length.
"^DD",52,52.01,35,21,0)
^^2^2^3110823^
"^DD",52,52.01,35,21,1,0)
This field contains the filename of the FDA Medication Guide for the drug 
"^DD",52,52.01,35,21,2,0)
in this prescription at the time the fill was transmitted to CMOP.
"^DD",52,52.01,35,"DT")
3110823
"^DD",52,52.032,35,0)
FDA MED GUIDE FILENAME^F^^FDA;1^K:$L(X)>100!($L(X)<1) X
"^DD",52,52.032,35,3)
Answer must be 1-100 characters in length.
"^DD",52,52.032,35,21,0)
^^3^3^3110610^
"^DD",52,52.032,35,21,1,0)
This field contains the filename of the FDA Medication Guide for the drug
"^DD",52,52.032,35,21,2,0)
in this prescription at the time the label for the specific fill was
"^DD",52,52.032,35,21,3,0)
printed.
"^DD",52,52.032,35,"DT")
3110823
"^DD",59,59,134,0)
FDA MED GUIDE PRINT SERVER URL^F^^FDAS;1^K:$L(X)>50!($L(X)<10) X
"^DD",59,59,134,3)
Answer must be 10-50 characters in length.
"^DD",59,59,134,21,0)
^.001^7^7^3111209^^^^
"^DD",59,59,134,21,1,0)
This is the Uniform Resource Locator(URL) and Port Number for the Print 
"^DD",59,59,134,21,2,0)
Server running the Java Application responsible for automatically 
"^DD",59,59,134,21,3,0)
printing of the Food and Drug Administration(FDA) Medication Guides for 
"^DD",59,59,134,21,4,0)
the division (e.g., 'http://10.4.21.22:8092/'). 
"^DD",59,59,134,21,5,0)
 
"^DD",59,59,134,21,6,0)
If you do not want to use the FDA Medication Guide automatic printing 
"^DD",59,59,134,21,7,0)
functionality do not populate this field.
"^DD",59,59,134,"DT")
3111209
"^DD",59,59,135,0)
FDA MED GUIDE PRINTER^59.0135IP^^FDA;0
"^DD",59,59,135,21,0)
^.001^2^2^3110817^^^
"^DD",59,59,135,21,1,0)
This sub-file contains a list of printers used for printing FDA Medication
"^DD",59,59,135,21,2,0)
Guides for this division.
"^DD",59,59,135,23,0)
^.001^5^5^3110817^^^
"^DD",59,59,135,23,1,0)
The list of printers in this sub-file will be presented to the users when 
"^DD",59,59,135,23,2,0)
selecting a printer for printing FDA Medication Guides for the division.
"^DD",59,59,135,23,3,0)
If the sub-file does not contain any records the user will be presented
"^DD",59,59,135,23,4,0)
with entries from the DEVICE file (#3.5) that have a WINDOWS NETWORK
"^DD",59,59,135,23,5,0)
PRINTER NAME field (#75) content.
"^DD",59,59.0135,0)
FDA MED GUIDE PRINTER SUB-FIELD^^.02^2
"^DD",59,59.0135,0,"DT")
3111114
"^DD",59,59.0135,0,"IX","B",59.0135,.01)

"^DD",59,59.0135,0,"NM","FDA MED GUIDE PRINTER")

"^DD",59,59.0135,0,"UP")
59
"^DD",59,59.0135,.01,0)
FDA MED GUIDE PRINTER^M*P3.5'^%ZIS(1,^0;1^S DIC("S")="I $P($G(^%ZIS(1,+Y,""WIN"")),U)'=""""" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",59,59.0135,.01,1,0)
^.1
"^DD",59,59.0135,.01,1,1,0)
59.0135^B
"^DD",59,59.0135,.01,1,1,1)
S ^PS(59,DA(1),"FDA","B",$E(X,1,30),DA)=""
"^DD",59,59.0135,.01,1,1,2)
K ^PS(59,DA(1),"FDA","B",$E(X,1,30),DA)
"^DD",59,59.0135,.01,3)
Enter the FDA Medication Guide printer for the division.
"^DD",59,59.0135,.01,12)
Only devices with a Windows Network Printer Name are allowed.
"^DD",59,59.0135,.01,12.1)
S DIC("S")="I $P($G(^%ZIS(1,+Y,""WIN"")),U)'="""""
"^DD",59,59.0135,.01,21,0)
^^2^2^3111114^^^^
"^DD",59,59.0135,.01,21,1,0)
This is the printer used to print FDA Medication Guides for the 
"^DD",59,59.0135,.01,21,2,0)
division.
"^DD",59,59.0135,.01,23,0)
^^2^2^3111114^^
"^DD",59,59.0135,.01,23,1,0)
Only entries in the DEVICE file (#3.5) with a WINDOWS PRINTER NETWORK 
"^DD",59,59.0135,.01,23,2,0)
NAME (#75) field content can be selected.
"^DD",59,59.0135,.01,"DT")
3111114
"^DD",59,59.0135,.02,0)
DEFAULT PRINTER^S^1:YES;^0;2^Q
"^DD",59,59.0135,.02,3)
Indicate whether the printer is the default FDA Medication Guide Printer for the division.
"^DD",59,59.0135,.02,21,0)
^^2^2^3110823^
"^DD",59,59.0135,.02,21,1,0)
This field indicates whether the printer will be used as the default 
"^DD",59,59.0135,.02,21,2,0)
printer when printing FDA Medication Guide for the division.
"^DD",59,59.0135,.02,23,0)
^^2^2^3110823^
"^DD",59,59.0135,.02,23,1,0)
Only one entry in the sub-file can have this field set to '1' as there 
"^DD",59,59.0135,.02,23,2,0)
can only be one default printer.
"^DD",59,59.0135,.02,"DT")
3111025
"BLD",7497,6)
^332
**END**
**END**
