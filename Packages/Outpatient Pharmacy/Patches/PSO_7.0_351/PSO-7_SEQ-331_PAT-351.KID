Released PSO*7*351 SEQ #331
Extracted from mail message
**KIDS**:PSO*7.0*351^

**INSTALL NAME**
PSO*7.0*351
"BLD",7663,0)
PSO*7.0*351^OUTPATIENT PHARMACY^0^3100205^y
"BLD",7663,1,0)
^^1^1^3100205^^
"BLD",7663,1,1,0)
The RXD-3 segment for a "partial" in Outpatient Pharmacy has a date missing.
"BLD",7663,4,0)
^9.64PA^^
"BLD",7663,6.3)
1
"BLD",7663,"ABPKG")
n
"BLD",7663,"KRN",0)
^9.67PA^779.2^20
"BLD",7663,"KRN",.4,0)
.4
"BLD",7663,"KRN",.401,0)
.401
"BLD",7663,"KRN",.402,0)
.402
"BLD",7663,"KRN",.403,0)
.403
"BLD",7663,"KRN",.5,0)
.5
"BLD",7663,"KRN",.84,0)
.84
"BLD",7663,"KRN",3.6,0)
3.6
"BLD",7663,"KRN",3.8,0)
3.8
"BLD",7663,"KRN",9.2,0)
9.2
"BLD",7663,"KRN",9.8,0)
9.8
"BLD",7663,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7663,"KRN",9.8,"NM",1,0)
PSOHLDS1^^0^B48714780
"BLD",7663,"KRN",9.8,"NM","B","PSOHLDS1",1)

"BLD",7663,"KRN",19,0)
19
"BLD",7663,"KRN",19,"NM",0)
^9.68A^^
"BLD",7663,"KRN",19.1,0)
19.1
"BLD",7663,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7663,"KRN",101,0)
101
"BLD",7663,"KRN",101,"NM",0)
^9.68A^^
"BLD",7663,"KRN",409.61,0)
409.61
"BLD",7663,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",7663,"KRN",771,0)
771
"BLD",7663,"KRN",771,"NM",0)
^9.68A^^
"BLD",7663,"KRN",779.2,0)
779.2
"BLD",7663,"KRN",779.2,"NM",0)
^9.68A^^
"BLD",7663,"KRN",870,0)
870
"BLD",7663,"KRN",870,"NM",0)
^9.68A^^
"BLD",7663,"KRN",8989.51,0)
8989.51
"BLD",7663,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",7663,"KRN",8989.52,0)
8989.52
"BLD",7663,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",7663,"KRN",8994,0)
8994
"BLD",7663,"KRN","B",.4,.4)

"BLD",7663,"KRN","B",.401,.401)

"BLD",7663,"KRN","B",.402,.402)

"BLD",7663,"KRN","B",.403,.403)

"BLD",7663,"KRN","B",.5,.5)

"BLD",7663,"KRN","B",.84,.84)

"BLD",7663,"KRN","B",3.6,3.6)

"BLD",7663,"KRN","B",3.8,3.8)

"BLD",7663,"KRN","B",9.2,9.2)

"BLD",7663,"KRN","B",9.8,9.8)

"BLD",7663,"KRN","B",19,19)

"BLD",7663,"KRN","B",19.1,19.1)

"BLD",7663,"KRN","B",101,101)

"BLD",7663,"KRN","B",409.61,409.61)

"BLD",7663,"KRN","B",771,771)

"BLD",7663,"KRN","B",779.2,779.2)

"BLD",7663,"KRN","B",870,870)

"BLD",7663,"KRN","B",8989.51,8989.51)

"BLD",7663,"KRN","B",8989.52,8989.52)

"BLD",7663,"KRN","B",8994,8994)

"BLD",7663,"QUES",0)
^9.62^^
"BLD",7663,"REQB",0)
^9.611^1^1
"BLD",7663,"REQB",1,0)
PSO*7.0*336^2
"BLD",7663,"REQB","B","PSO*7.0*336",1)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
351^3100205
"PKG",141,22,1,"PAH",1,1,0)
^^1^1^3100205
"PKG",141,22,1,"PAH",1,1,1,0)
The RXD-3 segment for a "partial" in Outpatient Pharmacy has a date missing.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSOHLDS1")
0^1^B48714780^B48838303
"RTN","PSOHLDS1",1,0)
PSOHLDS1 ;BIR/LC,PWC-Build HL7 Segments for Automated Interface ; 2/5/10 10:01am
"RTN","PSOHLDS1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**156,232,255,200,305,336,351**;DEC 1997;Build 1
"RTN","PSOHLDS1",3,0)
 ;HLFNC       supp. by DBIA 10106
"RTN","PSOHLDS1",4,0)
 ;PSNAPIS     supp. by DBIA 2531
"RTN","PSOHLDS1",5,0)
 ;VASITE      supp. by DBIA 10112
"RTN","PSOHLDS1",6,0)
 ;VADPT       supp. by DBIA 10061
"RTN","PSOHLDS1",7,0)
 ;EN^DIQ1     supp. by DBIA 100
"RTN","PSOHLDS1",8,0)
 ;EN^VAFHLZTA supp. by DBIA 758
"RTN","PSOHLDS1",9,0)
 ;PSDRUG      supp. by DBIA 221
"RTN","PSOHLDS1",10,0)
 ;PS(50.607   supp. by DBIA 2221
"RTN","PSOHLDS1",11,0)
 ;PS(55       supp. by DBIA 2228
"RTN","PSOHLDS1",12,0)
 ;DPT         supp. by DBIA 3097
"RTN","PSOHLDS1",13,0)
 ;SC          supp. by DBIA 10040
"RTN","PSOHLDS1",14,0)
 ;VA(200      supp. by DBIA 10060
"RTN","PSOHLDS1",15,0)
 ;SCMSVUT5    supp. by DBIA 4347
"RTN","PSOHLDS1",16,0)
 ;BLDPID^VAFCQRY supp. by DBIA 3630
"RTN","PSOHLDS1",17,0)
 ;MAKEIT^VAFHLU  supp. by DBIA 4346
"RTN","PSOHLDS1",18,0)
 ;
"RTN","PSOHLDS1",19,0)
 ;*232 allow for Do Not Mail
"RTN","PSOHLDS1",20,0)
 ;*255 move NTEPMI to PSOHLDS4.  fix "MP" node test to '=""
"RTN","PSOHLDS1",21,0)
 ;*305 send  Notice of Privacy Practices in NTE9 - Modified to NTE9 as NTE8 already exist
"RTN","PSOHLDS1",22,0)
 ;
"RTN","PSOHLDS1",23,0)
START ;
"RTN","PSOHLDS1",24,0)
 D GETDATA
"RTN","PSOHLDS1",25,0)
 D PID(.PSI),PV1(.PSI),PV2(.PSI),IAM^PSOHLDS4(.PSI),ORC^PSOHLDS4(.PSI)
"RTN","PSOHLDS1",26,0)
 D NTE^PSOHLDS2,RXE^PSOHLDS2(.PSI),RXD^PSOHLDS2(.PSI)
"RTN","PSOHLDS1",27,0)
 D NTEPMI^PSOHLDS4(.PSI),NTE9^PSOHLDS2(.PSI),RXR^PSOHLDS2(.PSI)                ;*255
"RTN","PSOHLDS1",28,0)
 ; clean up data set by GETDATA
"RTN","PSOHLDS1",29,0)
 K EBY,EBY1,EFDT,EXDT,FDT,PVDR,PVDR1,CSINER,CSINER1,SITE,SITADD,SITPHN
"RTN","PSOHLDS1",30,0)
 K VPHARMID,VPHARM,DEAID,MW,QTY,DASPLY,OLAN,OTHLAN,PRIORDT,RFRM,NFLD,WARN
"RTN","PSOHLDS1",31,0)
 K PSOXN,PSOXN2,PSND1,PSND2,PRODUCT,PSOPROD,UNIT,VANAME,DISPDT,PSONDC
"RTN","PSOHLDS1",32,0)
 K DRUG
"RTN","PSOHLDS1",33,0)
 Q
"RTN","PSOHLDS1",34,0)
GETDATA ; this is the place to set all data needed for several segments
"RTN","PSOHLDS1",35,0)
 I $G(FP)="F"&('$G(FPN)) D    ;original
"RTN","PSOHLDS1",36,0)
 . S FDT=$P(^PSRX(IRXN,2),"^",2),VPHARMID=$P(^(2),"^",10),DISPDT=$P(^(2),"^",5),EXDT=$P(^(2),"^",6),PSONDC=$P(^(2),"^",7)
"RTN","PSOHLDS1",37,0)
 . S PVDR=$P(^PSRX(IRXN,0),"^",4),QTY=$P(^(0),"^",7),DASPLY=$P(^(0),"^",8),MW=$P(^(0),"^",11),EBY=$P(^(0),"^",16)
"RTN","PSOHLDS1",38,0)
 I $G(FP)="F"&($G(FPN)) D    ;refill
"RTN","PSOHLDS1",39,0)
 . S FDT=$P(^PSRX(IRXN,1,FPN,0),"^"),MW=$P(^(0),"^",2),QTY=$P(^(0),"^",4),DASPLY=$P(^(0),"^",10),DISPDT=$P(^(0),"^",19),EXDT=$S($P(^(0),"^",15):$P(^(0),"^",15),1:$P(^PSRX(IRXN,2),"^",6))
"RTN","PSOHLDS1",40,0)
 . S VPHARMID=$S($P(^PSRX(IRXN,1,FPN,0),"^",5)'="":$P(^(0),"^",5),1:$P(^PSRX(IRXN,2),"^",10))
"RTN","PSOHLDS1",41,0)
 . S EBY=$S($P(^PSRX(IRXN,1,FPN,0),"^",5):$P(^(0),"^",5),1:$P(^(0),"^",7)),PVDR=$P(^(0),"^",17),PSONDC=$S($P($G(^PSRX(IRXN,1,FPN,1)),"^",3):$P(^(1),"^",3),1:$P(^PSRX(IRXN,2),"^",7))
"RTN","PSOHLDS1",42,0)
 I $G(FP)="P"&($G(FPN)) D  ;partial
"RTN","PSOHLDS1",43,0)
 . S FDT=$P(^PSRX(IRXN,"P",FPN,0),"^"),MW=$P(^(0),"^",2),QTY=$P(^(0),"^",4),DASPLY=$P(^(0),"^",10),DISPDT=FDT,PVDR=$P(^(0),"^",17),EXDT=$P(^PSRX(IRXN,2),"^",6)
"RTN","PSOHLDS1",44,0)
 . S EBY=$S($P(^PSRX(IRXN,"P",FPN,0),"^",5):$P(^(0),"^",5),1:$P(^(0),"^",7)),VPHARMID=$S($P(^(0),"^",5)'="":$P(^(0),"^",5),1:$P(^PSRX(IRXN,2),"^",10)),PVDR=$P(^PSRX(IRXN,"P",FPN,0),"^",17)
"RTN","PSOHLDS1",45,0)
 . S PSONDC=$S($P(^PSRX(IRXN,"P",FPN,0),"^",12):$P(^(0),"^",12),1:$P(^PSRX(IRXN,2),"^",7))
"RTN","PSOHLDS1",46,0)
 S EFDT=$P(^PSRX(IRXN,2),"^",2) S:$G(EFDT) EFDT=$$HLDATE^HLFNC(EFDT,"DT")
"RTN","PSOHLDS1",47,0)
 S ISDT=$P(^PSRX(IRXN,0),"^",13) S:$G(ISDT) ISDT=$$HLDATE^HLFNC(ISDT,"DT")
"RTN","PSOHLDS1",48,0)
 S DEAID=$$GET1^DIQ(200,PVDR_",",53.2)
"RTN","PSOHLDS1",49,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=VPHARMID D ^DIC
"RTN","PSOHLDS1",50,0)
 S VPHARM=$S(+Y:$$HLNAME^HLFNC($P(Y,"^",2)),1:"""""") K DIC,X,Y
"RTN","PSOHLDS1",51,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=EBY D ^DIC
"RTN","PSOHLDS1",52,0)
 S EBY1=$S(+Y:$$HLNAME^HLFNC($P(Y,"^",2)),1:"""""") K DIC,X,Y
"RTN","PSOHLDS1",53,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=PVDR D ^DIC
"RTN","PSOHLDS1",54,0)
 S PVDR1=$S(+Y:$$HLNAME^HLFNC($P(Y,"^",2)),1:"""""") K DIC,X,Y
"RTN","PSOHLDS1",55,0)
 S PRIORDT=$P(^PSRX(IRXN,3),"^",4),PRIORDT=$$HLDATE^HLFNC(PRIORDT,"DT")
"RTN","PSOHLDS1",56,0)
 S FDT=$$HLDATE^HLFNC(FDT,"DT")
"RTN","PSOHLDS1",57,0)
 S:$G(DISPDT) DISPDT=$$HLDATE^HLFNC(DISPDT,"DT")
"RTN","PSOHLDS1",58,0)
 S:$G(EXDT) EXDT=$$HLDATE^HLFNC(EXDT,"DT")
"RTN","PSOHLDS1",59,0)
 S FIN=$P(^PSRX(IRXN,"OR1"),"^",5)
"RTN","PSOHLDS1",60,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=FIN D ^DIC
"RTN","PSOHLDS1",61,0)
 S FIN1=$S(+Y:$$HLNAME^HLFNC($P(Y,"^",2)),1:"""""") K DIC,X,Y
"RTN","PSOHLDS1",62,0)
 S SITE=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOHLDS1",63,0)
 S PSZIP=$P(SITE,"^",5) S PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOHLDS1",64,0)
 S CLN=+$P(^PSRX(IRXN,0),"^",5),CLN1=$S($D(^SC(CLN,0)):$P(^(0),"^",1),1:"UNKNOWN")
"RTN","PSOHLDS1",65,0)
 S CSINER=$P(^PSRX(IRXN,3),"^",3)
"RTN","PSOHLDS1",66,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=CSINER D ^DIC
"RTN","PSOHLDS1",67,0)
 S CSINER1=$S(+Y:$$HLNAME^HLFNC($P(Y,"^",2)),1:"""""") K DIC,X,Y
"RTN","PSOHLDS1",68,0)
 D 6^VADPT
"RTN","PSOHLDS1",69,0)
 S X=$S($D(^PS(55,DFN,0)):^(0),1:""),CAP=$P(X,"^",2)
"RTN","PSOHLDS1",70,0)
 D MW(X,.MW,.MP)                                              ;PSO*232
"RTN","PSOHLDS1",71,0)
 I (($P(^PSRX(IRXN,"STA"),"^")>0)&($P(^("STA"),"^")'=2)&('$G(PSODBQ)))!'$G(^PSRX(IRXN,"IB")) S COPAY="NO COPAY"
"RTN","PSOHLDS1",72,0)
 E  S COPAY="COPAY"
"RTN","PSOHLDS1",73,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0)
"RTN","PSOHLDS1",74,0)
 S DATE=$$HLDATE^HLFNC(FDT) D NOW^%DTC S NOW=$$HLDATE^HLFNC(%,"TS")
"RTN","PSOHLDS1",75,0)
 S OLAN=$P($G(^PS(55,DFN,"LAN")),"^",2),OTLAN="N" I OLAN=2 S OTLAN="Y"
"RTN","PSOHLDS1",76,0)
 S CSUB1=$$GET1^DIQ(50,IDGN_",",3),CSUB="N" I $E(CSUB1,1)>1&($E(CSUB1,1)<6) S CSUB="Y"
"RTN","PSOHLDS1",77,0)
 S SCTALK=+$G(^PS(55,"ASTALK",$P(^PSRX(IRXN,0),"^",2)))
"RTN","PSOHLDS1",78,0)
 K DIC,DR,DIQ S DA=$P($$SITE^VASITE(),"^") I DA D
"RTN","PSOHLDS1",79,0)
 .K PSOINST S DIC=4,DIQ(0)="I",DR=99,DIQ="PSOINST" D EN^DIQ1
"RTN","PSOHLDS1",80,0)
 .S PSOINST=PSOINST(4,DA,99,"I") K DIC,DA,DR,DIQ,PSOINST(4)
"RTN","PSOHLDS1",81,0)
 S DRUG=$$ZZ^PSOSUTL(IRXN),DEA=$P(^PSDRUG(IDGN,0),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOHLDS1",82,0)
 S PSND1=$P($G(^PSDRUG(IDGN,"ND")),"^"),PSND2=$P($G(^("ND")),"^",2),PSND3=$P($G(^("ND")),"^",3)
"RTN","PSOHLDS1",83,0)
 K PSOXN,PSOXN2,PSOPROD
"RTN","PSOHLDS1",84,0)
 I PSND1,PSND3 D
"RTN","PSOHLDS1",85,0)
 .S PSOPROD=$$PROD2^PSNAPIS(PSND1,PSND3),VANAME=$P($G(PSOPROD),"^",1)
"RTN","PSOHLDS1",86,0)
 .I $T(^PSNAPIS)]"" S PSOXN=$$DFSU^PSNAPIS(PSND1,PSND3),UNIT=$P($G(PSOXN),"^",6) S PSOXN=$P($G(PSOXN),"^",5) S PSOXN2=$$PROD2^PSNAPIS(PSND1,PSND3) Q
"RTN","PSOHLDS1",87,0)
 .S PSOXN2=$G(^PSNDF(PSND1,5,PSND3,2))
"RTN","PSOHLDS1",88,0)
 .S PRODUCT=$G(^PSNDF(PSND1,5,PSND3,0))
"RTN","PSOHLDS1",89,0)
 .I $G(PRODUCT)'="" S PSOXN=+$P($G(^PSNDF(PSND1,2,+$P(PRODUCT,"^",2),3,+$P(PRODUCT,"^",3),4,+$P(PRODUCT,"^",4),0)),"^"),UNIT=$P($G(^PS(50.607,PSOXN,0)),"^")
"RTN","PSOHLDS1",90,0)
 S NFLD=0,UU="" F  S UU=$O(^PSRX(IRXN,1,UU)) Q:UU=""  S:$D(^PSRX(IRXN,1,UU,0)) NFLD=NFLD+1
"RTN","PSOHLDS1",91,0)
 S NRFL=$P(^PSRX(IRXN,0),"^",9),RFRM=(NRFL-NFLD)
"RTN","PSOHLDS1",92,0)
 Q
"RTN","PSOHLDS1",93,0)
PID(PSI) ;patient ID segment
"RTN","PSOHLDS1",94,0)
 Q:'$D(DFN)!$D(PAS)
"RTN","PSOHLDS1",95,0)
 S HLFS=HL1("FS"),HLECH=HL1("ECH"),HLQ=HL1("Q"),HLVER=HL1("VER")
"RTN","PSOHLDS1",96,0)
 K PSPID,PSPID1
"RTN","PSOHLDS1",97,0)
 D BLDPID^VAFCQRY(DFN,"","3,5,7,8,11,13",.PSPID,.HL1,.ERR)
"RTN","PSOHLDS1",98,0)
 ; put PID in format needed for segment parser
"RTN","PSOHLDS1",99,0)
 S PSPID=PSPID(1) K PSPID(1)
"RTN","PSOHLDS1",100,0)
 S (X,Y)=1 F  S X=+$O(PSPID(X)) Q:'X  S PSPID(Y)=PSPID(X),Y=Y+1 K PSPID(X)
"RTN","PSOHLDS1",101,0)
 ;parse PID into individual fields
"RTN","PSOHLDS1",102,0)
 K PRSEPID D SEGPRSE^SCMSVUT5("PSPID","PRSEPID",HL1("FS"))
"RTN","PSOHLDS1",103,0)
 ; parse address into individual components
"RTN","PSOHLDS1",104,0)
 K ADDSEQ D SEQPRSE^SCMSVUT5($NA(PRSEPID(11)),"ADDSEQ",HL1("ECH"))
"RTN","PSOHLDS1",105,0)
 ; build ZTA (Temporary Address)
"RTN","PSOHLDS1",106,0)
 K X2 S X2=$$EN^VAFHLZTA(DFN,"1,2,3,4,5,6,7,",1)
"RTN","PSOHLDS1",107,0)
 ; parse X2 (ZTA) into individual fields if temp add. exists
"RTN","PSOHLDS1",108,0)
 D:'$$CHKTEMP^PSOBAI(DFN)
"RTN","PSOHLDS1",109,0)
 . N BADA S BADA=$$CHKRX^PSOBAI(IRXN)
"RTN","PSOHLDS1",110,0)
 . I $P(BADA,"^"),'$P(BADA,"^",2),ADDSEQ(1,7)'["VAB" S BADA=$$GET1^DIQ(2,DFN_",",.121,"I") S:BADA ADDSEQ(1,7)="VAB"_BADA
"RTN","PSOHLDS1",111,0)
 D:$$CHKTEMP^PSOBAI(DFN)
"RTN","PSOHLDS1",112,0)
 . K PRSEZTA D SEGPRSE^SCMSVUT5("X2","PRSEZTA",HL1("FS"))
"RTN","PSOHLDS1",113,0)
 . ; parse temporary address into individual components
"RTN","PSOHLDS1",114,0)
 . K TMPADD D SEQPRSE^SCMSVUT5($NA(PRSEZTA(5)),"TMPADD",HL1("ECH"))
"RTN","PSOHLDS1",115,0)
 . ; add temporary address as next repitition in PID segment
"RTN","PSOHLDS1",116,0)
 . S SPOT=1+$O(ADDSEQ(""),-1)
"RTN","PSOHLDS1",117,0)
 . M ADDSEQ(SPOT)=TMPADD(1)
"RTN","PSOHLDS1",118,0)
 . S ADDSEQ(SPOT,7)="C"
"RTN","PSOHLDS1",119,0)
 . S ADDSEQ(SPOT,9)=PRSEZTA(6)
"RTN","PSOHLDS1",120,0)
 . S ADDSEQ(SPOT,12,1)=PRSEZTA(3)
"RTN","PSOHLDS1",121,0)
 . S ADDSEQ(SPOT,12,2)=PRSEZTA(4)
"RTN","PSOHLDS1",122,0)
 . ;move address sequence back into parse PID segment
"RTN","PSOHLDS1",123,0)
 ; rebuild PID segment
"RTN","PSOHLDS1",124,0)
 K PRSEPID(11) M PRSEPID(11)=ADDSEQ
"RTN","PSOHLDS1",125,0)
 K PSPID1 D MAKEIT^VAFHLU("PID",.PRSEPID,.PSPID1,.PSPID1)
"RTN","PSOHLDS1",126,0)
 ;put rebuilt PID into format used by $$EN^VAFCQRY
"RTN","PSOHLDS1",127,0)
 K PSPID S PSPID(1)=PSPID1
"RTN","PSOHLDS1",128,0)
 S X=0,Y=2 F  S X=+$O(PSPID1(X)) Q:'X  S PSPID(Y)=PSPID1(X) S Y=Y+1
"RTN","PSOHLDS1",129,0)
 S CNT=0 F I=1:1 Q:'$D(PSPID(I))  D
"RTN","PSOHLDS1",130,0)
 . I I=1 S ^TMP("PSO",$J,PSI)=PSPID(I) Q
"RTN","PSOHLDS1",131,0)
 . S CNT=CNT+1 S ^TMP("PSO",$J,PSI,CNT)=PSPID(I)
"RTN","PSOHLDS1",132,0)
 S PSI=PSI+1
"RTN","PSOHLDS1",133,0)
 S PAS=1
"RTN","PSOHLDS1",134,0)
 K PSPID,PSPID1,PRSEPID,PRSEZTA,SPOT,TMPADD,ADDSEQ
"RTN","PSOHLDS1",135,0)
 Q
"RTN","PSOHLDS1",136,0)
PV1(PSI) ;patient visit segment
"RTN","PSOHLDS1",137,0)
 Q:'$D(DFN)!$D(PAS1)
"RTN","PSOHLDS1",138,0)
 N PV1  ;hardcoded to letter O for Outpatient (Patient class)
"RTN","PSOHLDS1",139,0)
 S PV1="PV1"_FS_FS_"O"_FS
"RTN","PSOHLDS1",140,0)
 S ^TMP("PSO",$J,PSI)=PV1
"RTN","PSOHLDS1",141,0)
 S PSI=PSI+1,PAS1=1
"RTN","PSOHLDS1",142,0)
 Q
"RTN","PSOHLDS1",143,0)
PV2(PSI) ;patient visit segment (additional information)
"RTN","PSOHLDS1",144,0)
 ;PATIENT STATUS AND COPAY
"RTN","PSOHLDS1",145,0)
 Q:'$D(DFN)!$D(PAS2)
"RTN","PSOHLDS1",146,0)
 N PV2 S PV2=""
"RTN","PSOHLDS1",147,0)
 S $P(PV2,"|",24)=$P($G(^PS(53,+$P($G(^PSRX(IRXN,0)),"^",3),0)),"^",2)_"~"_COPAY_FS
"RTN","PSOHLDS1",148,0)
 S ^TMP("PSO",$J,PSI)="PV2|"_PV2
"RTN","PSOHLDS1",149,0)
 S PSI=PSI+1,PAS2=1
"RTN","PSOHLDS1",150,0)
 Q
"RTN","PSOHLDS1",151,0)
 ;
"RTN","PSOHLDS1",152,0)
MW(PS55,MW,MP) ;Return Mail/Window and MP expanded text               ;PSO*232
"RTN","PSOHLDS1",153,0)
 I MW="W"!(MW="") D                   ;*255
"RTN","PSOHLDS1",154,0)
 . S MP=$S($P($G(^PSRX(IRXN,"MP")),"^")'="":$P(^("MP"),"^"),1:"""""")
"RTN","PSOHLDS1",155,0)
 . S MW="WINDOW"
"RTN","PSOHLDS1",156,0)
 I MW="M" D
"RTN","PSOHLDS1",157,0)
 . S MP=""""""
"RTN","PSOHLDS1",158,0)
 . S PS55=$P(PS55,"^",3)
"RTN","PSOHLDS1",159,0)
 . S MW=$S(PS55=1:"CERTIFIED MAIL",PS55=2:"DO NOT MAIL",1:"REGULAR MAIL")
"RTN","PSOHLDS1",160,0)
 Q
"VER")
8.0^22.0
"BLD",7663,6)
^331
**END**
**END**
