Released PSO*7*333 SEQ #349
Extracted from mail message
**KIDS**:PSO*7.0*333^

**INSTALL NAME**
PSO*7.0*333
"BLD",8899,0)
PSO*7.0*333^OUTPATIENT PHARMACY^0^3111116^y
"BLD",8899,1,0)
^^3^3^3111116^
"BLD",8899,1,1,0)
This patch contains a fix for the issues summarized below:
"BLD",8899,1,2,0)
 1. Undefined error during OPAI HL7 generation for Other Language Sig.
"BLD",8899,1,3,0)
 2. Noun missing from sig on label when Print from Suspense
"BLD",8899,4,0)
^9.64PA^^0
"BLD",8899,6.3)
6
"BLD",8899,"ABPKG")
n
"BLD",8899,"KRN",0)
^9.67PA^779.2^20
"BLD",8899,"KRN",.4,0)
.4
"BLD",8899,"KRN",.401,0)
.401
"BLD",8899,"KRN",.402,0)
.402
"BLD",8899,"KRN",.403,0)
.403
"BLD",8899,"KRN",.5,0)
.5
"BLD",8899,"KRN",.84,0)
.84
"BLD",8899,"KRN",3.6,0)
3.6
"BLD",8899,"KRN",3.8,0)
3.8
"BLD",8899,"KRN",9.2,0)
9.2
"BLD",8899,"KRN",9.8,0)
9.8
"BLD",8899,"KRN",9.8,"NM",0)
^9.68A^2^1
"BLD",8899,"KRN",9.8,"NM",2,0)
PSOSPSIG^^0^B64067993
"BLD",8899,"KRN",9.8,"NM","B","PSOSPSIG",2)

"BLD",8899,"KRN",19,0)
19
"BLD",8899,"KRN",19.1,0)
19.1
"BLD",8899,"KRN",101,0)
101
"BLD",8899,"KRN",409.61,0)
409.61
"BLD",8899,"KRN",771,0)
771
"BLD",8899,"KRN",779.2,0)
779.2
"BLD",8899,"KRN",870,0)
870
"BLD",8899,"KRN",8989.51,0)
8989.51
"BLD",8899,"KRN",8989.52,0)
8989.52
"BLD",8899,"KRN",8994,0)
8994
"BLD",8899,"KRN","B",.4,.4)

"BLD",8899,"KRN","B",.401,.401)

"BLD",8899,"KRN","B",.402,.402)

"BLD",8899,"KRN","B",.403,.403)

"BLD",8899,"KRN","B",.5,.5)

"BLD",8899,"KRN","B",.84,.84)

"BLD",8899,"KRN","B",3.6,3.6)

"BLD",8899,"KRN","B",3.8,3.8)

"BLD",8899,"KRN","B",9.2,9.2)

"BLD",8899,"KRN","B",9.8,9.8)

"BLD",8899,"KRN","B",19,19)

"BLD",8899,"KRN","B",19.1,19.1)

"BLD",8899,"KRN","B",101,101)

"BLD",8899,"KRN","B",409.61,409.61)

"BLD",8899,"KRN","B",771,771)

"BLD",8899,"KRN","B",779.2,779.2)

"BLD",8899,"KRN","B",870,870)

"BLD",8899,"KRN","B",8989.51,8989.51)

"BLD",8899,"KRN","B",8989.52,8989.52)

"BLD",8899,"KRN","B",8994,8994)

"BLD",8899,"QDEF")
^^^^NO^^^^^^NO
"BLD",8899,"QUES",0)
^9.62^^
"BLD",8899,"REQB",0)
^9.611^1^1
"BLD",8899,"REQB",1,0)
PSO*7.0*117^2
"BLD",8899,"REQB","B","PSO*7.0*117",1)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,20,0)
^9.402P^^
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
333^3111116
"PKG",206,22,1,"PAH",1,1,0)
^^3^3^3111116
"PKG",206,22,1,"PAH",1,1,1,0)
This patch contains a fix for the issues summarized below:
"PKG",206,22,1,"PAH",1,1,2,0)
 1. Undefined error during OPAI HL7 generation for Other Language Sig.
"PKG",206,22,1,"PAH",1,1,3,0)
 2. Noun missing from sig on label when Print from Suspense
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSOSPSIG")
0^2^B64067993^B63360791
"RTN","PSOSPSIG",1,0)
PSOSPSIG ;BIR/RTR,SAB-Parse out and create other lang. Sig ;9/24/01
"RTN","PSOSPSIG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**117,333**;DEC 1997;Build 6
"RTN","PSOSPSIG",3,0)
 ;PSSORPH - DBIA 3234 ;^PS(50.606 - DBIA 2174 ;^PS(50.7 - DBIA 2223
"RTN","PSOSPSIG",4,0)
 ;^PS(51.2 - DBIA 2226 ;^PS(51 - DBIA 2224 ;^PSDRUG - DBIA 221
"RTN","PSOSPSIG",5,0)
 ;^PS(59.7 - DBIA 694 ;^PS(51.1 - DBIA 2225
"RTN","PSOSPSIG",6,0)
 ;
"RTN","PSOSPSIG",7,0)
EN(PSOFX) ;
"RTN","PSOSPSIG",8,0)
 K SIG9,PSNOUN,PSOROUTE,SIG0 S OI=$P($G(^PSRX(RX,"OR1")),"^") Q:'$G(OI)
"RTN","PSOSPSIG",9,0)
 S (FND,TODOSE)=0 F WW=0:0 S WW=$O(PSOFX("DOSE",WW)) Q:'WW  S TODOSE=WW
"RTN","PSOSPSIG",10,0)
 S:TODOSE FND=1 Q:'TODOSE  S SIGDS=+$P($G(^PS(50.7,OI,0)),"^",2)
"RTN","PSOSPSIG",11,0)
 S PREP=$S($P($G(^PS(50.606,SIGDS,"MISC1")),"^",2)]"":$P(^PS(50.606,SIGDS,"MISC1"),"^",2),1:$P($G(^PS(50.606,SIGDS,"MISC")),"^",3))
"RTN","PSOSPSIG",12,0)
 S RTCNT=0 K RTC,RTCA,RTCF F SSS=1:1:TODOSE D
"RTN","PSOSPSIG",13,0)
 .S SIG0(SSS)=$S($G(PSOFX("DOSE ORDERED",SSS))'="":$G(PSOFX("DOSE ORDERED",SSS)),1:$G(PSOFX("DOSE",SSS))) ;local dosage check
"RTN","PSOSPSIG",14,0)
 .I $G(PSOFX("DOSE ORDERED",SSS))="" S LODS=$O(^PSDRUG($P(^PSRX(RX,0),"^",6),"DOS2","B",SIG0(SSS),0)) I LODS D
"RTN","PSOSPSIG",15,0)
 ..S:$P(^PSDRUG($P(^PSRX(RX,0),"^",6),"DOS2",LODS,0),"^",4)]"" PSOFX("DOSE ORDERED",SSS)=$P(^PSDRUG($P(^PSRX(RX,0),"^",6),"DOS2",LODS,0),"^",4) K LODS
"RTN","PSOSPSIG",16,0)
 .S VERBX(SSS)=$S($G(PSOFX("VERB",SSS))]""&($P($G(^PS(50.606,SIGDS,"MISC1")),"^")]""):$P(^PS(50.606,SIGDS,"MISC1"),"^"),1:$G(PSOFX("VERB",SSS)))
"RTN","PSOSPSIG",17,0)
 .I $G(PSOFX("NOUN",SSS))]"" D NON
"RTN","PSOSPSIG",18,0)
 .S RTC=+$G(PSOFX("ROUTE",SSS)) I RTC S:'RTCNT RTCA=RTC S RTCNT=RTCNT+1
"RTN","PSOSPSIG",19,0)
 .I RTCNT>1,$G(RTC),$G(RTC)'=$G(RTCA) S RTCF=1
"RTN","PSOSPSIG",20,0)
 .S PSOROUTE(SSS)=$S($P($G(^PS(51.2,+$G(PSOFX("ROUTE",SSS)),0)),"^",7)]"":$P(^(0),"^",7),$P($G(^(0)),"^",2)]"":$P(^(0),"^",2),$P($G(^(0)),"^",3)]"":$P(^(0),"^",3),1:$P($G(^(0)),"^"))
"RTN","PSOSPSIG",21,0)
 .S MEDEXP(SSS)=$S($P($G(^PS(51.2,+$G(PSOFX("ROUTE",SSS)),0)),"^",2)="":0,1:1)
"RTN","PSOSPSIG",22,0)
 .S PDAYS(SSS)=$G(PSOFX("DURATION",SSS))
"RTN","PSOSPSIG",23,0)
 .I $G(PSOFX("DURATION",SSS))]"",($E(PSOFX("DURATION",SSS),$L(PSOFX("DURATION",SSS)))'?1A) S PDAYS(SSS)=PDAYS(SSS)_"D"
"RTN","PSOSPSIG",24,0)
 .S FOR=$O(^PS(59.7,"AOTH","FOR","")) S FOR=$S(FOR]"":FOR,1:"FOR")
"RTN","PSOSPSIG",25,0)
 .S PSDUR(SSS)=$S($G(PDAYS(SSS))']"":"NULL",1:FOR_" "_$E($G(PDAYS(SSS)),1,($L($G(PDAYS(SSS)))-1))) D  I PSDUR(SSS)'="NULL" S PSDUR(SSS)=PSDUR(SSS)_" "_INTERVAL
"RTN","PSOSPSIG",26,0)
 ..I PSDUR(SSS)'="NULL" S INTERVAL=$E(PDAYS(SSS),$L(PDAYS(SSS))),INTERVAL=$S(INTERVAL="D":"DAYS",INTERVAL="W":"WEEKS",INTERVAL="H":"HOURS",INTERVAL="L":"MONTHS",INTERVAL="M":"MINUTES",INTERVAL="S":"SECONDS",1:"") D
"RTN","PSOSPSIG",27,0)
 ...Q:$G(INTERVAL)']""  S INTERVAL=$O(^PS(59.7,"AOTH",INTERVAL,""))
"RTN","PSOSPSIG",28,0)
 ...I $G(PSOFX("DURATION",SSS)),$G(PSOFX("DURATION",SSS))'>1 S INTERVAL=$E(INTERVAL,1,($L(INTERVAL)-1))
"RTN","PSOSPSIG",29,0)
 F GGG=1:1:TODOSE S ZSCHED(GGG)=$G(PSOFX("SCHEDULE",GGG)) D
"RTN","PSOSPSIG",30,0)
 .I $G(ZSCHED(GGG))="" S SCHED(GGG)="" Q
"RTN","PSOSPSIG",31,0)
 .S SGLFLAG=0 F WW=0:0 S WW=$O(^PS(51.1,"B",ZSCHED(GGG),WW)) Q:'WW!($G(SGLFLAG))  D
"RTN","PSOSPSIG",32,0)
 ..I $G(^PS(51.1,WW,3))]"" S SCHED(GGG)=^(3),SGLFLAG=1 Q
"RTN","PSOSPSIG",33,0)
 ..I $P($G(^PS(51.1,WW,0)),"^",8)'="" S SCHED(GGG)=$P($G(^(0)),"^",8),SGLFLAG=1
"RTN","PSOSPSIG",34,0)
 .Q:$G(SGLFLAG)
"RTN","PSOSPSIG",35,0)
 .I $O(^PS(51,"B",ZSCHED(GGG),0)) S IN=$O(^PS(51,"B",ZSCHED(GGG),0)) I $P($G(^PS(51,IN,4)),"^")]"" S SCHED(GGG)=$P(^PS(51,IN,4),"^") K IN Q
"RTN","PSOSPSIG",36,0)
 .I $G(^PS(51,"A",ZSCHED(GGG)))'="" S SCHED(GGG)=$P(^(ZSCHED(GGG)),"^") Q
"RTN","PSOSPSIG",37,0)
 .K IN S ZZSB=0 F ZZS=1:1:$L(ZSCHED(GGG)) S SZZ=$E(ZSCHED(GGG),ZZS) I SZZ=" " S ZZSB=ZZSB+1
"RTN","PSOSPSIG",38,0)
 .S ZZSB=ZZSB+1
"RTN","PSOSPSIG",39,0)
 .K SCHHOLD F GGGZ=1:1:ZZSB S (SDL,SCHHOLD(GGGZ))=$P(ZSCHED(GGG)," ",GGGZ) D
"RTN","PSOSPSIG",40,0)
 ..Q:$G(SDL)=""
"RTN","PSOSPSIG",41,0)
 ..S SGLFLAG=0 F WW=0:0 S WW=$O(^PS(51.1,"B",SDL,WW)) Q:'WW!($G(SGLFLAG))  D
"RTN","PSOSPSIG",42,0)
 ...I $G(^PS(51.1,WW,3))]"" S SCHED(GGG)=^(3),SCHHOLD(GGGZ)=^(3),SGLFLAG=1 Q
"RTN","PSOSPSIG",43,0)
 ...I $P($G(^PS(51.1,WW,0)),"^",8)]"" S SCHHOLD(GGGZ)=$P($G(^(0)),"^",8),SGLFLAG=1
"RTN","PSOSPSIG",44,0)
 ..Q:$G(SGLFLAG)
"RTN","PSOSPSIG",45,0)
 ..I $G(^PS(51,"A",SDL))]"" S IN=$O(^PS(51,"B",SDL,0)) D:IN  Q
"RTN","PSOSPSIG",46,0)
 ...S SCHHOLD(GGGZ)=$S($G(^PS(51,IN,4))]"":^PS(51,IN,4),1:$P(^PS(51,"A",SDL),"^"))
"RTN","PSOSPSIG",47,0)
 .S SCHED(GGG)="",SGLFLAG=0 F WW=1:1:ZZSB S SCHED(GGG)=SCHED(GGG)_$S($G(SGLFLAG):" ",1:"")_$G(SCHHOLD(WW)),SGLFLAG=1
"RTN","PSOSPSIG",48,0)
 S (RTC,RTCA,PSOBDCT)=0 F FFF=0:0 S FFF=$O(SIG0(FFF)) Q:'FFF  D
"RTN","PSOSPSIG",49,0)
 .K PSOSG1,PSOSG2 S VERB=$G(VERBX(FFF)) D VERB D:$G(PSNOUN(FFF))'=""&('$G(PSOSG1)) SSS
"RTN","PSOSPSIG",50,0)
 .D FRAC
"RTN","PSOSPSIG",51,0)
 .S SIG2(FFF)=$S($G(VERB)'=""&('$G(PSOSG1)):$G(VERB)_" ",1:"")_$S($G(PSOFX("DOSE ORDERED",FFF))'="":$S($G(PSOFRAC)'="":$G(PSOFRAC),1:$G(PSOFX("DOSE ORDERED",FFF)))_" ",1:$G(PSOFX("DOSE",FFF))_" ")
"RTN","PSOSPSIG",52,0)
 .S PSOBDCT=PSOBDCT+1
"RTN","PSOSPSIG",53,0)
 .K PSOFRAC,PSOFRACX
"RTN","PSOSPSIG",54,0)
 .I RTC>0,$G(PSOROUTE(FFF))'="",'$G(RTCF) S RTCA=1
"RTN","PSOSPSIG",55,0)
 .I $G(PSOROUTE(FFF))'="" S RTC=RTC+1
"RTN","PSOSPSIG",56,0)
 .S SIG2(FFF)=SIG2(FFF)_$S($G(PSNOUN(FFF))'=""&('$G(PSOSG2)):$G(PSNOUN(FFF))_" ",1:"")_$S(PREP'=""&($G(MEDEXP(FFF)))&('RTCA):PREP_" ",1:"")
"RTN","PSOSPSIG",57,0)
 .S SIG2(FFF)=SIG2(FFF)_$S(PSOROUTE(FFF)'=""&('RTCA):PSOROUTE(FFF)_" ",1:"")
"RTN","PSOSPSIG",58,0)
 .S SIG2(FFF)=SIG2(FFF)_$S(SCHED(FFF)'="":SCHED(FFF)_$S($G(PSDUR(FFF))="NULL"&($G(PSOFX("CONJUNCTION",FFF))="")&('$O(SIG0(FFF))):"",1:" "),1:"")
"RTN","PSOSPSIG",59,0)
 .S PSOCJ=$E($G(PSOFX("CONJUNCTION",FFF)))
"RTN","PSOSPSIG",60,0)
 .S CON=$S($G(PSOCJ)="A":"AND",$G(PSOCJ)="T":"THEN",$G(PSOCJ)="S":"THEN",$G(PSOCJ)="X":"EXCEPT",1:"") I CON]"" S CON=$O(^PS(59.7,"AOTH",CON,""))
"RTN","PSOSPSIG",61,0)
 .S SIG2(FFF)=SIG2(FFF)_$S(PSDUR(FFF)'="NULL":PSDUR(FFF)_$S($G(PSOFX("CONJUNCTION",FFF))=""&('$O(SIG0(FFF))):"",1:", "),1:"")_CON
"RTN","PSOSPSIG",62,0)
 .K PSOSG1,PSOSG2
"RTN","PSOSPSIG",63,0)
 .K PSOUCS S SIG2(FFF)=$$UPPER(SIG2(FFF)) K PSOUCS
"RTN","PSOSPSIG",64,0)
 S PSODCT="" F  S PSODCT=$O(PSOFX("SIG",PSODCT)) Q:PSODCT=""  S PSOBDCT=PSOBDCT+1 S SIG2(PSOBDCT)=$G(PSOFX("SIG",PSODCT)) K PSOUCS S SIG2(PSOBDCT)=$$UPPER(SIG2(PSOBDCT)) K PSOUCS
"RTN","PSOSPSIG",65,0)
STUFF ;
"RTN","PSOSPSIG",66,0)
 S DCOUNT=0
"RTN","PSOSPSIG",67,0)
 I '$D(SIG2(1)) G QUIT
"RTN","PSOSPSIG",68,0)
 I '$O(SIG2(1)),$L(SIG2(1))<71 S SIG9(1)=SIG2(1)
"RTN","PSOSPSIG",69,0)
 S (VAR,VAR1)="",II=1
"RTN","PSOSPSIG",70,0)
 F FF=0:0 S FF=$O(SIG2(FF)) Q:'FF  S CT=0 F NN=1:1:$L(SIG2(FF)) I $E(SIG2(FF),NN)=" "!($L(SIG2(FF))=NN) S CT=CT+1 D  I $L(VAR)>70 S SIG9(II)=LIM_" ",II=II+1,VAR=VAR1
"RTN","PSOSPSIG",71,0)
 .S VAR1=$P(SIG2(FF)," ",(CT))
"RTN","PSOSPSIG",72,0)
 .S LIM=VAR
"RTN","PSOSPSIG",73,0)
 .S VAR=$S(VAR="":VAR1,1:VAR_" "_VAR1)
"RTN","PSOSPSIG",74,0)
 I $G(VAR)'="" S SIG9(II)=VAR
"RTN","PSOSPSIG",75,0)
QUIT K SSS,TT,DCOUNT,PREP,VERB,FFF,GGG,SIGDS,SIGRT,PSOROUTE,PSOSG1,PSOSG2 Q
"RTN","PSOSPSIG",76,0)
SIG1 ;
"RTN","PSOSPSIG",77,0)
 F FFF=0:0 S FFF=$O(SIG0(FFF)) Q:'FFF  S SIG2(FFF)=SIG0(FFF)
"RTN","PSOSPSIG",78,0)
 Q
"RTN","PSOSPSIG",79,0)
DAYS I +$E($P(SIG1(TT),"^",2))!($E($P(SIG1(TT),"^",2))=0) S $P(SIG1(TT),"^",2)="D"_$P(SIG1(TT),"^",2)
"RTN","PSOSPSIG",80,0)
 Q
"RTN","PSOSPSIG",81,0)
NON ;
"RTN","PSOSPSIG",82,0)
 S NN=PSOFX("NOUN",SSS)
"RTN","PSOSPSIG",83,0)
 S NOUN=$O(^PS(50.606,SIGDS,"NOUN","B",NN,0)) I NOUN S PSNOUN(SSS)=$S($G(^PS(50.606,SIGDS,"NOUN",NOUN,1))]"":^PS(50.606,SIGDS,"NOUN",NOUN,1),1:NN) K NN Q
"RTN","PSOSPSIG",84,0)
 N PSONN S PSONN=NN K NN,NOUN D DOSE^PSSORPH(.XDOSE,$P(^PSRX(RX,0),"^",6),"O") I $P($G(XDOSE("DD",$P(^PSRX(RX,0),"^",6))),"^",9)="" S PSNOUN(SSS)=PSONN Q  ;*333
"RTN","PSOSPSIG",85,0)
 S NN=$P(XDOSE("DD",$P(^PSRX(RX,0),"^",6)),"^",9),NOUN=$O(^PS(50.606,SIGDS,"NOUN","B",NN,0))
"RTN","PSOSPSIG",86,0)
 I NOUN S PSNOUN(SSS)=$S($G(^PS(50.606,SIGDS,"NOUN",NOUN,1))]"":^PS(50.606,SIGDS,"NOUN",NOUN,1),1:NN)
"RTN","PSOSPSIG",87,0)
 K XDOSE,NN Q
"RTN","PSOSPSIG",88,0)
VERB ;Check if verb and noun need to be added to SIG
"RTN","PSOSPSIG",89,0)
 K PSOLCS,PSOUCS,PSOISL,PSOVL
"RTN","PSOSPSIG",90,0)
 I $G(VERB)'="" S PSOVL=$L(VERB),PSOISL=$E($G(SIG0(FFF)),1,$G(PSOVL)) I $G(PSOISL)'="" D
"RTN","PSOSPSIG",91,0)
 .S PSOUCS=VERB
"RTN","PSOSPSIG",92,0)
 .S PSOUCS=$$UPPER(PSOUCS) I PSOUCS=PSOISL S PSOSG1=1 Q
"RTN","PSOSPSIG",93,0)
 .S PSOUCS=$$LOWER(PSOUCS) I PSOUCS=PSOISL S PSOSG1=1 Q
"RTN","PSOSPSIG",94,0)
 .S PSOUCS=$$UPPER($E(PSOUCS,1))_$$LOWER($E(PSOUCS,2,99)) I PSOUCS=PSOISL S PSOSG1=1 Q
"RTN","PSOSPSIG",95,0)
 I $G(PSNOUN(FFF))="" G VERBEX
"RTN","PSOSPSIG",96,0)
 S PSOISL=$G(SIG0(FFF)) I $G(PSOISL)="" G VERBEX
"RTN","PSOSPSIG",97,0)
 S PSOVL=$F(PSNOUN(FFF),"(")
"RTN","PSOSPSIG",98,0)
 I $G(PSOVL)>2 S PSOUCS=$E(PSNOUN(FFF),1,(PSOVL-2))
"RTN","PSOSPSIG",99,0)
 I $G(PSOVL)'>2 S PSOUCS=PSNOUN(FFF)
"RTN","PSOSPSIG",100,0)
 I $G(PSOISL)'="" D
"RTN","PSOSPSIG",101,0)
 .S PSOUCS=$$UPPER(PSOUCS) I PSOISL[PSOUCS S PSOSG2=1 Q
"RTN","PSOSPSIG",102,0)
 .S PSOUCS=$$LOWER(PSOUCS) I PSOISL[PSOUCS S PSOSG2=1 Q
"RTN","PSOSPSIG",103,0)
 .S PSOUCS=$$UPPER($E(PSOUCS,1))_$$LOWER($E(PSOUCS,2,99)) I PSOISL[PSOUCS S PSOSG2=1
"RTN","PSOSPSIG",104,0)
VERBEX K PSOLCS,PSOUCS,PSOISL,PSOVL Q
"RTN","PSOSPSIG",105,0)
 ;
"RTN","PSOSPSIG",106,0)
UPPER(PSOUCS) ;
"RTN","PSOSPSIG",107,0)
 Q $TR(PSOUCS,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSOSPSIG",108,0)
 ;
"RTN","PSOSPSIG",109,0)
LOWER(PSOLCS) ;
"RTN","PSOSPSIG",110,0)
 Q $TR(PSOLCS,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","PSOSPSIG",111,0)
 Q
"RTN","PSOSPSIG",112,0)
 ;
"RTN","PSOSPSIG",113,0)
SSS ;
"RTN","PSOSPSIG",114,0)
 K PSOFNL,PSOFNLF,PSOFNLX
"RTN","PSOSPSIG",115,0)
 Q:$G(PSNOUN(FFF))=""
"RTN","PSOSPSIG",116,0)
 Q:$L(PSNOUN(FFF))'>3
"RTN","PSOSPSIG",117,0)
 Q:'$G(PSOFX("DOSE ORDERED",FFF))
"RTN","PSOSPSIG",118,0)
 S PSOFNL=$E(PSNOUN(FFF),($L(PSNOUN(FFF))-2),$L(PSNOUN(FFF)))
"RTN","PSOSPSIG",119,0)
 I $G(PSOFNL)="(S)"!($G(PSOFNL)="(s)") D
"RTN","PSOSPSIG",120,0)
 .I $G(PSOFX("DOSE ORDERED",FFF))'>1 S PSNOUN(FFF)=$E(PSNOUN(FFF),1,($L(PSNOUN(FFF))-3))
"RTN","PSOSPSIG",121,0)
 .I $G(PSOFX("DOSE ORDERED",FFF))>1 S PSNOUN(FFF)=$E(PSNOUN(FFF),1,($L(PSNOUN(FFF))-3))_$E(PSOFNL,2)
"RTN","PSOSPSIG",122,0)
 Q
"RTN","PSOSPSIG",123,0)
FRAC ;
"RTN","PSOSPSIG",124,0)
 K PSOFRAC,PSOFRACX,PSOFRAC1,PSOFRAC2
"RTN","PSOSPSIG",125,0)
 I $G(PSOFX("DOSE ORDERED",FFF))="" Q
"RTN","PSOSPSIG",126,0)
 I $G(PSOFX("DOSE ORDERED",FFF))'["." S (PSOFRAC1,PSOFRAC)=$G(PSOFX("DOSE ORDERED",FFF)) D NUM D  G FRACQ
"RTN","PSOSPSIG",127,0)
 .I $G(PSOFRAC1)=$G(PSOFRAC) K PSOFRAC,PSOFRAC1 Q
"RTN","PSOSPSIG",128,0)
 .S PSOFRAC=$G(PSOFRAC1)
"RTN","PSOSPSIG",129,0)
 S PSOFRAC1=$P(PSOFX("DOSE ORDERED",FFF),"."),PSOFRAC2=$P(PSOFX("DOSE ORDERED",FFF),".",2)
"RTN","PSOSPSIG",130,0)
 S PSOFRACX="."_$G(PSOFRAC2)
"RTN","PSOSPSIG",131,0)
 S PSOFRAC=$S(PSOFRACX=".5":"ONE-HALF",PSOFRACX=".25":"ONE-FOURTH",PSOFRACX=".33":"ONE-THIRD",PSOFRACX=".34":"ONE-THIRD",PSOFRACX=".50":"ONE-HALF",PSOFRACX=".66":"TWO-THIRDS",PSOFRACX=".67":"TWO-THIRDS",PSOFRACX=".75":"THREE-FOURTHS",1:PSOFRACX)
"RTN","PSOSPSIG",132,0)
 S PSOFRAC9=$O(^PS(59.7,"AOTH",PSOFRAC,"")) I PSOFRAC9]"" S PSOFRAC=PSOFRAC9
"RTN","PSOSPSIG",133,0)
 K PSOFRAC9
"RTN","PSOSPSIG",134,0)
 I $G(PSOFRAC)="" K PSOFRAC G FRACQ
"RTN","PSOSPSIG",135,0)
 I $G(PSOFRAC1)'="",+$G(PSOFRAC1) D
"RTN","PSOSPSIG",136,0)
 .D NUM S AND=$O(^PS(59.7,"AOTH","AND",""))
"RTN","PSOSPSIG",137,0)
 .S PSOFRAC=$G(PSOFRAC1)_" "_$S(AND]"":AND,1:"AND")_" "_$S($E($G(PSOFRAC),1)=".":"0",1:"")_$G(PSOFRAC)
"RTN","PSOSPSIG",138,0)
 I $E($G(PSOFRAC),1)="." S PSOFRAC="0"_$G(PSOFRAC)
"RTN","PSOSPSIG",139,0)
FRACQ K PSOFRAC1,PSOFRAC2,AND
"RTN","PSOSPSIG",140,0)
 Q
"RTN","PSOSPSIG",141,0)
NUM ;
"RTN","PSOSPSIG",142,0)
 Q:$G(PSOFRAC1)=""
"RTN","PSOSPSIG",143,0)
 S PSOFRAC1=$S(PSOFRAC1="1":"ONE",PSOFRAC1="2":"TWO",PSOFRAC1="3":"THREE",PSOFRAC1="4":"FOUR",PSOFRAC1="5":"FIVE",PSOFRAC1="6":"SIX",PSOFRAC1="7":"SEVEN",PSOFRAC1="8":"EIGHT",PSOFRAC1="9":"NINE",PSOFRAC1="10":"TEN",1:PSOFRAC1)
"RTN","PSOSPSIG",144,0)
 S PSOFRAC9=$O(^PS(59.7,"AOTH",PSOFRAC1,"")) I PSOFRAC9]"" S PSOFRAC1=PSOFRAC9
"RTN","PSOSPSIG",145,0)
 K PSOFRAC9
"RTN","PSOSPSIG",146,0)
 Q
"VER")
8.0^22.0
"BLD",8899,6)
^349
**END**
**END**
