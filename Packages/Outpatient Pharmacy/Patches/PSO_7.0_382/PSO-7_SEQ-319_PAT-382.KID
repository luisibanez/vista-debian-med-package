Released PSO*7*382 SEQ #319
Extracted from mail message
**KIDS**:PSO*7.0*382^

**INSTALL NAME**
PSO*7.0*382
"BLD",7994,0)
PSO*7.0*382^OUTPATIENT PHARMACY^0^3110502^y
"BLD",7994,1,0)
^^19^19^3110426^
"BLD",7994,1,1,0)
This patch addresses a request made by the Health Resource Center (HRC) 
"BLD",7994,1,2,0)
to Outpatient Pharmacy V. 7.0 to provide a new standalone option similar
"BLD",7994,1,3,0)
to that of ePharmacy Medication Profile (View Only) [PSO PMP] option for
"BLD",7994,1,4,0)
the Compensation and Record Interchange (CAPRI) system. The Medication
"BLD",7994,1,5,0)
Profile and Refill [PSO HRC PROFILE/REFILL] option will allow users both
"BLD",7994,1,6,0)
to view a patient's medication profile and to refill prescriptions.
"BLD",7994,1,7,0)
 
"BLD",7994,1,8,0)
The patch also corrects the following two issues found in ePharmacy 
"BLD",7994,1,9,0)
Medication Profile (View Only) [PSO PMP] option.
"BLD",7994,1,10,0)
1. The calculation of remaining refills on the medication profile screen. 
"BLD",7994,1,11,0)
   Routine PSOPMP1 was modified to fix the issue.
"BLD",7994,1,12,0)
 
"BLD",7994,1,13,0)
2. When selecting multiple items to be displayed from the medication 
"BLD",7994,1,14,0)
   profile list, only the first selection is displayed. Routine PSOPMP0
"BLD",7994,1,15,0)
   was modified so that all selected items are displayed.
"BLD",7994,1,16,0)
 
"BLD",7994,1,17,0)
Integration Control Registration #4595 was modified to grant the CAPRI 
"BLD",7994,1,18,0)
package access to the Medication Profile and Refill [PSO HRC PROFILE/
"BLD",7994,1,19,0)
REFILL] option.
"BLD",7994,4,0)
^9.64PA^^
"BLD",7994,6.3)
9
"BLD",7994,"ABPKG")
n
"BLD",7994,"KRN",0)
^9.67PA^779.2^20
"BLD",7994,"KRN",.4,0)
.4
"BLD",7994,"KRN",.401,0)
.401
"BLD",7994,"KRN",.402,0)
.402
"BLD",7994,"KRN",.403,0)
.403
"BLD",7994,"KRN",.5,0)
.5
"BLD",7994,"KRN",.84,0)
.84
"BLD",7994,"KRN",3.6,0)
3.6
"BLD",7994,"KRN",3.8,0)
3.8
"BLD",7994,"KRN",9.2,0)
9.2
"BLD",7994,"KRN",9.8,0)
9.8
"BLD",7994,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",7994,"KRN",9.8,"NM",1,0)
PSOPMP0^^0^B81752801
"BLD",7994,"KRN",9.8,"NM",2,0)
PSOPMP1^^0^B29384339
"BLD",7994,"KRN",9.8,"NM",3,0)
PSOMPHRC^^0^B21119230
"BLD",7994,"KRN",9.8,"NM",4,0)
PSOREF0^^0^B37449897
"BLD",7994,"KRN",9.8,"NM","B","PSOMPHRC",3)

"BLD",7994,"KRN",9.8,"NM","B","PSOPMP0",1)

"BLD",7994,"KRN",9.8,"NM","B","PSOPMP1",2)

"BLD",7994,"KRN",9.8,"NM","B","PSOREF0",4)

"BLD",7994,"KRN",19,0)
19
"BLD",7994,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",7994,"KRN",19,"NM",1,0)
PSO HRC PROFILE/REFILL^^0
"BLD",7994,"KRN",19,"NM","B","PSO HRC PROFILE/REFILL",1)

"BLD",7994,"KRN",19.1,0)
19.1
"BLD",7994,"KRN",101,0)
101
"BLD",7994,"KRN",101,"NM",0)
^9.68A^15^15
"BLD",7994,"KRN",101,"NM",1,0)
PSO HRC MENU^^0
"BLD",7994,"KRN",101,"NM",2,0)
PSO HRC PAT INFO MENU^^0
"BLD",7994,"KRN",101,"NM",3,0)
PSO HRC PATIENT INFORMATION^^0
"BLD",7994,"KRN",101,"NM",4,0)
PSO ALLERGY/HRC LIST MENU^^0
"BLD",7994,"KRN",101,"NM",5,0)
PSO DETAILED ALLERGY/HRC LIST^^0
"BLD",7994,"KRN",101,"NM",6,0)
PSO HRC REFILL MENU^^0
"BLD",7994,"KRN",101,"NM",7,0)
PSO HRC SELECT^^0
"BLD",7994,"KRN",101,"NM",8,0)
PSO PMP CHANGE VIEW^^4^
"BLD",7994,"KRN",101,"NM",9,0)
PSO PMP SIG DISPLAY^^4^
"BLD",7994,"KRN",101,"NM",10,0)
PSO PMP STATUS GROUP^^4^
"BLD",7994,"KRN",101,"NM",11,0)
PSO SPEED REFILL^^4^
"BLD",7994,"KRN",101,"NM",12,0)
PSO SELECT ALLERGY^^4^
"BLD",7994,"KRN",101,"NM",13,0)
PSO LM EXIT2^^4^
"BLD",7994,"KRN",101,"NM",14,0)
PSO REFILL^^4^
"BLD",7994,"KRN",101,"NM",15,0)
PSO ACTIVITY LOGS^^4^
"BLD",7994,"KRN",101,"NM","B","PSO ACTIVITY LOGS",15)

"BLD",7994,"KRN",101,"NM","B","PSO ALLERGY/HRC LIST MENU",4)

"BLD",7994,"KRN",101,"NM","B","PSO DETAILED ALLERGY/HRC LIST",5)

"BLD",7994,"KRN",101,"NM","B","PSO HRC MENU",1)

"BLD",7994,"KRN",101,"NM","B","PSO HRC PAT INFO MENU",2)

"BLD",7994,"KRN",101,"NM","B","PSO HRC PATIENT INFORMATION",3)

"BLD",7994,"KRN",101,"NM","B","PSO HRC REFILL MENU",6)

"BLD",7994,"KRN",101,"NM","B","PSO HRC SELECT",7)

"BLD",7994,"KRN",101,"NM","B","PSO LM EXIT2",13)

"BLD",7994,"KRN",101,"NM","B","PSO PMP CHANGE VIEW",8)

"BLD",7994,"KRN",101,"NM","B","PSO PMP SIG DISPLAY",9)

"BLD",7994,"KRN",101,"NM","B","PSO PMP STATUS GROUP",10)

"BLD",7994,"KRN",101,"NM","B","PSO REFILL",14)

"BLD",7994,"KRN",101,"NM","B","PSO SELECT ALLERGY",12)

"BLD",7994,"KRN",101,"NM","B","PSO SPEED REFILL",11)

"BLD",7994,"KRN",409.61,0)
409.61
"BLD",7994,"KRN",409.61,"NM",0)
^9.68A^4^4
"BLD",7994,"KRN",409.61,"NM",1,0)
PSO HRC MAIN^^0
"BLD",7994,"KRN",409.61,"NM",2,0)
PSO HRC REFILL^^0
"BLD",7994,"KRN",409.61,"NM",3,0)
PSO HRC DETAILED ALLERGY^^0
"BLD",7994,"KRN",409.61,"NM",4,0)
PSO HRC Patient Information^^0
"BLD",7994,"KRN",409.61,"NM","B","PSO HRC DETAILED ALLERGY",3)

"BLD",7994,"KRN",409.61,"NM","B","PSO HRC MAIN",1)

"BLD",7994,"KRN",409.61,"NM","B","PSO HRC Patient Information",4)

"BLD",7994,"KRN",409.61,"NM","B","PSO HRC REFILL",2)

"BLD",7994,"KRN",771,0)
771
"BLD",7994,"KRN",779.2,0)
779.2
"BLD",7994,"KRN",870,0)
870
"BLD",7994,"KRN",8989.51,0)
8989.51
"BLD",7994,"KRN",8989.52,0)
8989.52
"BLD",7994,"KRN",8994,0)
8994
"BLD",7994,"KRN","B",.4,.4)

"BLD",7994,"KRN","B",.401,.401)

"BLD",7994,"KRN","B",.402,.402)

"BLD",7994,"KRN","B",.403,.403)

"BLD",7994,"KRN","B",.5,.5)

"BLD",7994,"KRN","B",.84,.84)

"BLD",7994,"KRN","B",3.6,3.6)

"BLD",7994,"KRN","B",3.8,3.8)

"BLD",7994,"KRN","B",9.2,9.2)

"BLD",7994,"KRN","B",9.8,9.8)

"BLD",7994,"KRN","B",19,19)

"BLD",7994,"KRN","B",19.1,19.1)

"BLD",7994,"KRN","B",101,101)

"BLD",7994,"KRN","B",409.61,409.61)

"BLD",7994,"KRN","B",771,771)

"BLD",7994,"KRN","B",779.2,779.2)

"BLD",7994,"KRN","B",870,870)

"BLD",7994,"KRN","B",8989.51,8989.51)

"BLD",7994,"KRN","B",8989.52,8989.52)

"BLD",7994,"KRN","B",8994,8994)

"BLD",7994,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7994,"QUES",0)
^9.62^^
"BLD",7994,"REQB",0)
^9.611^3^2
"BLD",7994,"REQB",2,0)
PSO*7.0*306^2
"BLD",7994,"REQB",3,0)
PSO*7.0*276^2
"BLD",7994,"REQB","B","PSO*7.0*276",3)

"BLD",7994,"REQB","B","PSO*7.0*306",2)

"KRN",19,13841,-1)
0^1
"KRN",19,13841,0)
PSO HRC PROFILE/REFILL^Medication Profile and Refill^^A^^^^^^^^OUTPATIENT PHARMACY^^1
"KRN",19,13841,1,0)
^^3^3^3110329^
"KRN",19,13841,1,1,0)
This is a standalone option created for the Compensation and Pension
"KRN",19,13841,1,2,0)
Record Interchange (CAPRI) system by Outpatient Pharmacy. It allows
"KRN",19,13841,1,3,0)
a user to view a patient's medication profile and refill prescriptions.
"KRN",19,13841,20)
D EN^PSOMPHRC
"KRN",19,13841,"U")
MEDICATION PROFILE AND REFILL
"KRN",101,3785,-1)
4^14
"KRN",101,3785,0)
PSO REFILL
"KRN",101,3801,-1)
4^15
"KRN",101,3801,0)
PSO ACTIVITY LOGS
"KRN",101,3817,-1)
4^12
"KRN",101,3817,0)
PSO SELECT ALLERGY
"KRN",101,3830,-1)
4^11
"KRN",101,3830,0)
PSO SPEED REFILL
"KRN",101,3837,-1)
4^13
"KRN",101,3837,0)
PSO LM EXIT2
"KRN",101,5627,-1)
4^10
"KRN",101,5627,0)
PSO PMP STATUS GROUP
"KRN",101,5628,-1)
4^9
"KRN",101,5628,0)
PSO PMP SIG DISPLAY
"KRN",101,5630,-1)
4^8
"KRN",101,5630,0)
PSO PMP CHANGE VIEW
"KRN",101,5864,-1)
0^1
"KRN",101,5864,0)
PSO HRC MENU^Patient Medication Profile^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5864,4)
26^4^^HRC
"KRN",101,5864,10,0)
^101.01PA^5^5
"KRN",101,5864,10,1,0)
5630^CV^1^
"KRN",101,5864,10,1,"^")
PSO PMP CHANGE VIEW
"KRN",101,5864,10,2,0)
5627^GS^2^
"KRN",101,5864,10,2,"^")
PSO PMP STATUS GROUP
"KRN",101,5864,10,3,0)
3830^RF^4^^^Refill
"KRN",101,5864,10,3,"^")
PSO SPEED REFILL
"KRN",101,5864,10,4,0)
5628^SIG^5^
"KRN",101,5864,10,4,"^")
PSO PMP SIG DISPLAY
"KRN",101,5864,10,5,0)
5865^PI^3^
"KRN",101,5864,10,5,"^")
PSO HRC PATIENT INFORMATION
"KRN",101,5864,24)

"KRN",101,5864,26)
D SHOW^VALM,HDR^PSOPMP0,INT^PSOMPHRC S XQORM("#")=$O(^ORD(101,"B","PSO HRC SELECT",""))_"^1:"_VALMCNT,XQORM("??")="D HELP^VALM2,HDR^PSOPMP0"
"KRN",101,5864,28)
Select:
"KRN",101,5864,99)
62187,54660
"KRN",101,5865,-1)
0^3
"KRN",101,5865,0)
PSO HRC PATIENT INFORMATION^Patient Information^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5865,4)
^^^PI
"KRN",101,5865,20)
D PI^PSOMPHRC
"KRN",101,5865,99)
62126,56391
"KRN",101,5866,-1)
0^2
"KRN",101,5866,0)
PSO HRC PAT INFO MENU^Patient Information Menu^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5866,4)
40^4
"KRN",101,5866,10,0)
^101.01PA^3^2
"KRN",101,5866,10,2,0)
3837^EX^2^
"KRN",101,5866,10,2,"^")
PSO LM EXIT2
"KRN",101,5866,10,3,0)
5867^DD^1^
"KRN",101,5866,10,3,"^")
PSO DETAILED ALLERGY/HRC LIST
"KRN",101,5866,20)

"KRN",101,5866,26)
D SHOW^VALM
"KRN",101,5866,28)
Select Action:
"KRN",101,5866,99)
62147,61844
"KRN",101,5867,-1)
0^5
"KRN",101,5867,0)
PSO DETAILED ALLERGY/HRC LIST^Detailed Allergy/ADR List^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5867,15)
D EXIT^PSOLMDA
"KRN",101,5867,20)
D DD^PSOMPHRC
"KRN",101,5867,99)
62147,61724
"KRN",101,5868,-1)
0^4
"KRN",101,5868,0)
PSO ALLERGY/HRC LIST MENU^ALLERGY/HRC LIST MENU^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5868,4)
40^4
"KRN",101,5868,10,0)
^101.01PA^1^1
"KRN",101,5868,10,1,0)
3817^SA^^
"KRN",101,5868,10,1,"^")
PSO SELECT ALLERGY
"KRN",101,5868,26)
D A^PSOORUT3,SHOW^VALM S XQORM("#")=$O(^ORD(101,"B","PSO LM SELECT ALLERGY",0))_"^1:"_PSOALL
"KRN",101,5868,99)
62131,50723
"KRN",101,5870,-1)
0^7
"KRN",101,5870,0)
PSO HRC SELECT^Select a prescription^^A^^^^^^^^
"KRN",101,5870,4)
^^^SP
"KRN",101,5870,20)
D SEL^PSOMPHRC
"KRN",101,5870,99)
62145,55900
"KRN",101,5871,-1)
0^6
"KRN",101,5871,0)
PSO HRC REFILL MENU^HRC Medication Profile Refill Menu^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5871,4)
26^4
"KRN",101,5871,10,0)
^101.01PA^2^2
"KRN",101,5871,10,1,0)
3785^RF^1^
"KRN",101,5871,10,1,"^")
PSO REFILL
"KRN",101,5871,10,2,0)
3801^AL^2^^^Activity Logs
"KRN",101,5871,10,2,"^")
PSO ACTIVITY LOGS
"KRN",101,5871,24)
I $$ACTIONS^PSOMPHRC
"KRN",101,5871,26)
D A^PSOORUT3,SHOW^VALM S:$G(PSOACT)["E" XQORM("#")=$O(^ORD(101,"B","PSO LM EDIT SELECT ORDER",0))_"^1:21"
"KRN",101,5871,28)
Select Action:
"KRN",101,5871,99)
62188,42832
"KRN",409.61,778,-1)
0^1
"KRN",409.61,778,0)
PSO HRC MAIN^1^^80^8^19^0^1^^PSO HRC MENU^Patient Medication Profile^1^^1
"KRN",409.61,778,1)
^PSO PMP HIDDEN ACTIONS MENU
"KRN",409.61,778,"ARRAY")
 ^TMP("PSOPMP0",$J)
"KRN",409.61,778,"FNL")
D EXIT^PSOPMP0
"KRN",409.61,778,"HDR")
D HDR^PSOPMP0,HDRF^PSOMPHRC
"KRN",409.61,778,"HLP")
D HELP^PSOPMP0
"KRN",409.61,778,"INIT")
D INIT^PSOMPHRC
"KRN",409.61,779,-1)
0^4
"KRN",409.61,779,0)
PSO HRC Patient Information^1^^80^7^21^1^1^^PSO HRC PAT INFO MENU^Patient Information^2^^1
"KRN",409.61,779,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,779,"ARRAY")
 ^TMP("PSOPI",$J)
"KRN",409.61,779,"FNL")
D EXIT^PSOLMPI
"KRN",409.61,779,"HDR")
D HDR^PSOLMPI
"KRN",409.61,779,"HLP")
D HELP^PSOLMPI
"KRN",409.61,779,"INIT")
D INIT^PSOLMPI
"KRN",409.61,780,-1)
0^3
"KRN",409.61,780,0)
PSO HRC DETAILED ALLERGY^1^^80^6^20^1^1^^PSO ALLERGY/HRC LIST MENU^DETAILED ALLERGY LIST^2^^1
"KRN",409.61,780,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,780,"ARRAY")
 ^TMP("PSODA",$J)
"KRN",409.61,780,"FNL")
D EXIT^PSOLMDA
"KRN",409.61,780,"HDR")
D HDR^PSOLMDA
"KRN",409.61,780,"HLP")
D HELP^PSOLMDA
"KRN",409.61,780,"INIT")
D INIT^PSOLMDA
"KRN",409.61,782,-1)
0^2
"KRN",409.61,782,0)
PSO HRC REFILL^1^^80^6^20^1^1^^PSO HRC REFILL MENU^Rx Refill Activity^1^^1
"KRN",409.61,782,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,782,"ARRAY")
 ^TMP("PSOAO",$J)
"KRN",409.61,782,"FNL")
D EXIT^PSOLMLST
"KRN",409.61,782,"HDR")
D HDR^PSOLMUTL
"KRN",409.61,782,"HLP")
D HELP^PSOLMLST
"KRN",409.61,782,"INIT")
D INIT^PSOLMLST
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;LME1^XPDIA1;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
382^3110502
"PKG",141,22,1,"PAH",1,1,0)
^^19^19^3110502
"PKG",141,22,1,"PAH",1,1,1,0)
This patch addresses a request made by the Health Resource Center (HRC) 
"PKG",141,22,1,"PAH",1,1,2,0)
to Outpatient Pharmacy V. 7.0 to provide a new standalone option similar
"PKG",141,22,1,"PAH",1,1,3,0)
to that of ePharmacy Medication Profile (View Only) [PSO PMP] option for
"PKG",141,22,1,"PAH",1,1,4,0)
the Compensation and Record Interchange (CAPRI) system. The Medication
"PKG",141,22,1,"PAH",1,1,5,0)
Profile and Refill [PSO HRC PROFILE/REFILL] option will allow users both
"PKG",141,22,1,"PAH",1,1,6,0)
to view a patient's medication profile and to refill prescriptions.
"PKG",141,22,1,"PAH",1,1,7,0)
 
"PKG",141,22,1,"PAH",1,1,8,0)
The patch also corrects the following two issues found in ePharmacy 
"PKG",141,22,1,"PAH",1,1,9,0)
Medication Profile (View Only) [PSO PMP] option.
"PKG",141,22,1,"PAH",1,1,10,0)
1. The calculation of remaining refills on the medication profile screen. 
"PKG",141,22,1,"PAH",1,1,11,0)
   Routine PSOPMP1 was modified to fix the issue.
"PKG",141,22,1,"PAH",1,1,12,0)
 
"PKG",141,22,1,"PAH",1,1,13,0)
2. When selecting multiple items to be displayed from the medication 
"PKG",141,22,1,"PAH",1,1,14,0)
   profile list, only the first selection is displayed. Routine PSOPMP0
"PKG",141,22,1,"PAH",1,1,15,0)
   was modified so that all selected items are displayed.
"PKG",141,22,1,"PAH",1,1,16,0)
 
"PKG",141,22,1,"PAH",1,1,17,0)
Integration Control Registration #4595 was modified to grant the CAPRI 
"PKG",141,22,1,"PAH",1,1,18,0)
package access to the Medication Profile and Refill [PSO HRC PROFILE/
"PKG",141,22,1,"PAH",1,1,19,0)
REFILL] option.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSOMPHRC")
0^3^B21119230^n/a
"RTN","PSOMPHRC",1,0)
PSOMPHRC ;BIRM/JAM - Patient Medication Profile for HRC - Listmanager ;02/01/11
"RTN","PSOMPHRC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**382**;DEC 1997;Build 9
"RTN","PSOMPHRC",3,0)
 ;Reference to ^DISV supported by DBIA 510
"RTN","PSOMPHRC",4,0)
 ;Standalone option provided to CAPRI supported by DBIA 4595
"RTN","PSOMPHRC",5,0)
 ;
"RTN","PSOMPHRC",6,0)
EN ;Menu option entry point
"RTN","PSOMPHRC",7,0)
 N PSOEXPDC,PSOEXDCE,PSOSRTBY,PSORDER,PSOSIGDP,PSOSTSGP,PSOSTORD,PSORDCNT,PSOSTSEQ,PSORDSEQ,PSOCHNG
"RTN","PSOMPHRC",8,0)
 N GRPLN,DIC,Y,DFN,HIGHLN,LASTLINE,VALMCNT,DFN,PSOQIT,WARD,PSODFN,PSOHRC
"RTN","PSOMPHRC",9,0)
 ;
"RTN","PSOMPHRC",10,0)
 ; -- Division selection
"RTN","PSOMPHRC",11,0)
 I '$G(PSOSITE) D ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"Pharmacy Division Must be Selected!",! G EXIT
"RTN","PSOMPHRC",12,0)
 S PSOHRC=1
"RTN","PSOMPHRC",13,0)
 ;
"RTN","PSOMPHRC",14,0)
PAT ; -- Patient selection 
"RTN","PSOMPHRC",15,0)
 D EN^PSOPATLK S Y=PSOPTLK
"RTN","PSOMPHRC",16,0)
 I +Y'>0 G EXIT
"RTN","PSOMPHRC",17,0)
 S DFN=+Y,PSOQIT=0
"RTN","PSOMPHRC",18,0)
 D DEM^VADPT I +VADM(6) D  G PAT
"RTN","PSOMPHRC",19,0)
 .W !?10,$C(7),VADM(1)_" ("_VA("PID")_") DIED ON "_$P(VADM(6),"^",2),!
"RTN","PSOMPHRC",20,0)
 S WARD=$$GET1^DIQ(2,DFN,.1) I WARD]"" D  G:PSOQIT PAT
"RTN","PSOMPHRC",21,0)
 .W !!?10,$C(7),VADM(1)_" ("_VA("PID")_")"
"RTN","PSOMPHRC",22,0)
 .W !?10,$C(7),"Patient is an Inpatient on Ward "_WARD_" !!"
"RTN","PSOMPHRC",23,0)
 .W ! D DIR
"RTN","PSOMPHRC",24,0)
 S PSODFN=DFN D CHKADDR^PSOBAI(DFN,1,1)  ;bad address flag/update
"RTN","PSOMPHRC",25,0)
 ;build listman screen ^TMP("PSOPI",$J, for patient information display
"RTN","PSOMPHRC",26,0)
 D ^PSOORUT2,^PSOBUILD
"RTN","PSOMPHRC",27,0)
 D LST(PSOSITE,DFN)
"RTN","PSOMPHRC",28,0)
 G PAT
"RTN","PSOMPHRC",29,0)
 Q
"RTN","PSOMPHRC",30,0)
 ;
"RTN","PSOMPHRC",31,0)
LST(SITE,PSODFN) ; -- ListManager entry point
"RTN","PSOMPHRC",32,0)
 ; Loading Division/User preferences
"RTN","PSOMPHRC",33,0)
 D LOAD^PSOPMPPF(SITE,DUZ)
"RTN","PSOMPHRC",34,0)
 W !,"Please wait..."
"RTN","PSOMPHRC",35,0)
 D EN^VALM("PSO HRC MAIN")
"RTN","PSOMPHRC",36,0)
 D FULL^VALM1
"RTN","PSOMPHRC",37,0)
 D EXIT
"RTN","PSOMPHRC",38,0)
 Q
"RTN","PSOMPHRC",39,0)
 ;
"RTN","PSOMPHRC",40,0)
INIT ; -- rebuild ^TMP("PSOPMP0",$J and PSOLST array from ^TMP("PSOPMP0",$J
"RTN","PSOMPHRC",41,0)
 N NUM,RX,CNT,TYP
"RTN","PSOMPHRC",42,0)
 D INIT^PSOPMP0
"RTN","PSOMPHRC",43,0)
INT ; rebuild PSOLST only
"RTN","PSOMPHRC",44,0)
 K PSOLST
"RTN","PSOMPHRC",45,0)
 S (NUM,CNT)=0
"RTN","PSOMPHRC",46,0)
 F  S NUM=$O(^TMP("PSOPMP0",$J,NUM)) Q:'NUM  D
"RTN","PSOMPHRC",47,0)
 .F TYP="RX","PEN","NVA" S RX=$G(^TMP("PSOPMP0",$J,NUM,TYP))  I RX'="" D
"RTN","PSOMPHRC",48,0)
 ..S CNT=CNT+1,PSOLST(CNT)=$S(TYP="RX":52,TYP="PEN":52.41,1:55.05)_"^"_RX_"^"_$P($$STSINFO^PSOPMP1(RX),"^",2)
"RTN","PSOMPHRC",49,0)
 S PSOCNT=CNT
"RTN","PSOMPHRC",50,0)
 Q
"RTN","PSOMPHRC",51,0)
 ;
"RTN","PSOMPHRC",52,0)
HDR ; -- header code
"RTN","PSOMPHRC",53,0)
 S VALMHDR(1)="This is a test header for PSO HRC REFILL SELECTION."
"RTN","PSOMPHRC",54,0)
 S VALMHDR(2)="This is the second line"
"RTN","PSOMPHRC",55,0)
 Q
"RTN","PSOMPHRC",56,0)
 ;
"RTN","PSOMPHRC",57,0)
HDRF ; -- rebuild listman array for Speed refill
"RTN","PSOMPHRC",58,0)
 I $G(PSOHRCF) D INIT^PSOPMP0
"RTN","PSOMPHRC",59,0)
 K PSOHRCF
"RTN","PSOMPHRC",60,0)
 Q
"RTN","PSOMPHRC",61,0)
 ;
"RTN","PSOMPHRC",62,0)
SEL ; -- Process selection of RX entries
"RTN","PSOMPHRC",63,0)
 N PSOSEL,PSOLIS,TYPE,XQORM,ORD,TITLE,XX
"RTN","PSOMPHRC",64,0)
 S PSOLIS=$P(XQORNOD(0),"=",2) I 'PSOLIS S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOMPHRC",65,0)
 S TITLE=VALM("TITLE")
"RTN","PSOMPHRC",66,0)
 F XX=1:1:$L(PSOLIS,",") Q:$P(PSOLIS,",",XX)']""  D
"RTN","PSOMPHRC",67,0)
 .S PSOSEL=+$P(PSOLIS,",",XX) I 'PSOSEL S VALMSG="Invalid selection!" Q
"RTN","PSOMPHRC",68,0)
 .S TYPE=$O(^TMP("PSOPMP0",$J,PSOSEL,0)) I TYPE="" S VALMSG="Invalid selection!" Q
"RTN","PSOMPHRC",69,0)
 .S ORD=$G(^TMP("PSOPMP0",$J,PSOSEL,TYPE))
"RTN","PSOMPHRC",70,0)
 .I 'ORD S VALMSG="Invalid selection!" Q
"RTN","PSOMPHRC",71,0)
 .D INT
"RTN","PSOMPHRC",72,0)
 .;
"RTN","PSOMPHRC",73,0)
 .; -- Regular prescription
"RTN","PSOMPHRC",74,0)
 .I TYPE="RX" D  S VALMBCK="R" D REF^PSOPMP0
"RTN","PSOMPHRC",75,0)
 .. N STAT,PROACT,LINE,TITLE
"RTN","PSOMPHRC",76,0)
 .. S (Y,ORN)=PSOSEL,COPY=1
"RTN","PSOMPHRC",77,0)
 .. D NEWSEL^PSOORNE2,INIT
"RTN","PSOMPHRC",78,0)
 .. S STAT=$$GET1^DIQ(52,$P(PSOLST(ORN),"^",2),100,"I"),PSOACT=$S('STAT:"R",1:""),VALMSG="Enter ?? for more actions"
"RTN","PSOMPHRC",79,0)
 .. D LG
"RTN","PSOMPHRC",80,0)
 .;
"RTN","PSOMPHRC",81,0)
 .; -- Pending Order
"RTN","PSOMPHRC",82,0)
 .I TYPE="PEN" D  S VALMBCK="R" D REF^PSOPMP0
"RTN","PSOMPHRC",83,0)
 .. N PSOACTOV,OR0,OLVLM,LINE,TITLE
"RTN","PSOMPHRC",84,0)
 .. S OR0=^PS(52.41,ORD,0),PSOACTOV=1,OLVLM=$$ADPL()
"RTN","PSOMPHRC",85,0)
 .. D PENHDR^PSOPMP1(PSODFN),DSPL^PSOORFI1
"RTN","PSOMPHRC",86,0)
 .. I OLVLM S ^DISV(+$G(DUZ),"VALMMENU",$P(OLVLM,"^",2))=OLVLM
"RTN","PSOMPHRC",87,0)
 .;
"RTN","PSOMPHRC",88,0)
 .; -- Non-VA Order
"RTN","PSOMPHRC",89,0)
 .I TYPE="NVA" D
"RTN","PSOMPHRC",90,0)
 .. N LINE,TITLE D EN^PSONVAVW(PSODFN,ORD)
"RTN","PSOMPHRC",91,0)
 .;
"RTN","PSOMPHRC",92,0)
 S VALMBCK="R",VALM("TITLE")=TITLE
"RTN","PSOMPHRC",93,0)
 Q
"RTN","PSOMPHRC",94,0)
 ;
"RTN","PSOMPHRC",95,0)
ACTIONS() ; -- screen actions on active orders
"RTN","PSOMPHRC",96,0)
 N DIC,X,Y
"RTN","PSOMPHRC",97,0)
 K DIC,Y S DIC="^ORD(101,"_DA(1)_",10,",X=DA,DIC(0)="ZN" D ^DIC Q:Y<0 0
"RTN","PSOMPHRC",98,0)
 S Y=Y(0,0)
"RTN","PSOMPHRC",99,0)
 I Y="PSO REFILL" Q $S(PSOACT["R":1,1:0)
"RTN","PSOMPHRC",100,0)
 Q 1
"RTN","PSOMPHRC",101,0)
 ;
"RTN","PSOMPHRC",102,0)
ADPL() ; -- disable actions for pending orders
"RTN","PSOMPHRC",103,0)
 N DIC,X,Y,OLVAL,PRCT
"RTN","PSOMPHRC",104,0)
 S DIC="^ORD(101,",X="PSO PENDING ORDER MENU",DIC(0)="ZN" D ^DIC Q:Y<0 ""
"RTN","PSOMPHRC",105,0)
 S PRCT=+Y_";ORD(101,",OLVAL=$G(^DISV(+$G(DUZ),"VALMMENU",PRCT)) I OLVAL="" Q ""
"RTN","PSOMPHRC",106,0)
 I 'OLVAL Q 0_"^"_PRCT
"RTN","PSOMPHRC",107,0)
 S ^DISV(+$G(DUZ),"VALMMENU",PRCT)=0
"RTN","PSOMPHRC",108,0)
 Q 1_"^"_PRCT
"RTN","PSOMPHRC",109,0)
 ;
"RTN","PSOMPHRC",110,0)
PI ; -- entry point for PSO HRC Patient Information
"RTN","PSOMPHRC",111,0)
 I '$D(^TMP("PSOPI",$J)) D ^PSOORUT2
"RTN","PSOMPHRC",112,0)
 D EN^VALM("PSO HRC Patient Information")
"RTN","PSOMPHRC",113,0)
 S VALMBCK="R"
"RTN","PSOMPHRC",114,0)
 Q 
"RTN","PSOMPHRC",115,0)
DD ; -- entry point for PSO HRC DETAILED ALLERGY
"RTN","PSOMPHRC",116,0)
 D EN^VALM("PSO HRC DETAILED ALLERGY")
"RTN","PSOMPHRC",117,0)
 Q
"RTN","PSOMPHRC",118,0)
 ;
"RTN","PSOMPHRC",119,0)
LG ; -- entry point for PSO HRC REFILL
"RTN","PSOMPHRC",120,0)
 S (VALMCNT,PSOPF)=$O(^TMP("PSOAO",$J,"A"),-1)
"RTN","PSOMPHRC",121,0)
 D EN^VALM("PSO HRC REFILL")
"RTN","PSOMPHRC",122,0)
 Q
"RTN","PSOMPHRC",123,0)
DIR ; -- Dir call
"RTN","PSOMPHRC",124,0)
  N DIR,X,Y
"RTN","PSOMPHRC",125,0)
  S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do You Want To Continue" D ^DIR K DIR
"RTN","PSOMPHRC",126,0)
  S:'Y PSOQIT=1
"RTN","PSOMPHRC",127,0)
  K DIRUT,DTOUT,DUOUT
"RTN","PSOMPHRC",128,0)
  Q
"RTN","PSOMPHRC",129,0)
EXIT ;
"RTN","PSOMPHRC",130,0)
 K ^TMP("PSOPMP0",$J),^TMP("PSOPMPSR",$J),^TMP("PSODA",$J),^TMP("PSONVAVW",$J)
"RTN","PSOMPHRC",131,0)
 K COPY,DA,PSOCNT,PSONEW,ORN,PSOACT,PSOPF,PSOHRCF
"RTN","PSOMPHRC",132,0)
 D KVA^VADPT,PTX^PSORX1,EOJ^PSORX1
"RTN","PSOMPHRC",133,0)
 Q
"RTN","PSOMPHRC",134,0)
 ;
"RTN","PSOMPHRC",135,0)
HELP Q
"RTN","PSOPMP0")
0^1^B81752801^B77858526
"RTN","PSOPMP0",1,0)
PSOPMP0 ;BIRM/MFR - Patient Medication Profile - Listmanager ;10/28/06
"RTN","PSOPMP0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260,281,303,289,382**;DEC 1997;Build 9
"RTN","PSOPMP0",3,0)
 ;Reference to EN1^GMRADPT supported by IA #10099
"RTN","PSOPMP0",4,0)
 ;Reference to EN6^GMRVUTL supported by IA #1120
"RTN","PSOPMP0",5,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSOPMP0",6,0)
 ;
"RTN","PSOPMP0",7,0)
EN ;Menu option entry point
"RTN","PSOPMP0",8,0)
 N PSOEXPDC,PSOEXDCE,PSOSRTBY,PSORDER,PSOSIGDP,PSOSTSGP,PSOSTORD,PSORDCNT,PSOSTSEQ,PSORDSEQ,PSOCHNG
"RTN","PSOPMP0",9,0)
 N GRPLN,DIC,Y,DFN,GRPLN,HIGHLN,LASTLINE,VALMCNT
"RTN","PSOPMP0",10,0)
 ;
"RTN","PSOPMP0",11,0)
 ;Division selection
"RTN","PSOPMP0",12,0)
 I '$G(PSOSITE) D ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"Pharmacy Division Must be Selected!",! G EXIT
"RTN","PSOPMP0",13,0)
 ;
"RTN","PSOPMP0",14,0)
 ;Patient selection
"RTN","PSOPMP0",15,0)
 W !! S DIC=2,DIC(0)="QEAM" D ^DIC G EXIT:Y<0  S DFN=+Y
"RTN","PSOPMP0",16,0)
 S PSODFN=DFN D CHKADDR^PSOBAI(DFN,1,1)  ;bad address flag/update
"RTN","PSOPMP0",17,0)
 D LST(PSOSITE,DFN)
"RTN","PSOPMP0",18,0)
 Q
"RTN","PSOPMP0",19,0)
 ;
"RTN","PSOPMP0",20,0)
LST(SITE,PSODFN) ;ListManager entry point
"RTN","PSOPMP0",21,0)
 ; Loading Division/User preferences
"RTN","PSOPMP0",22,0)
 D LOAD^PSOPMPPF(SITE,DUZ)
"RTN","PSOPMP0",23,0)
 W !,"Please wait..."
"RTN","PSOPMP0",24,0)
 D EN^VALM("PSO PMP MAIN")
"RTN","PSOPMP0",25,0)
 D FULL^VALM1
"RTN","PSOPMP0",26,0)
 G EXIT
"RTN","PSOPMP0",27,0)
 ;
"RTN","PSOPMP0",28,0)
HDR      ;Header
"RTN","PSOPMP0",29,0)
 N LINE,POS,LINE1,LINE2,LINE3,LINE4,WT,WTDT,HT,HTDT,VADM,DFN,PNAME,DOB,SEX,X,GMRAL,ADVREA
"RTN","PSOPMP0",30,0)
 K VADM S DFN=PSODFN D DEM^VADPT
"RTN","PSOPMP0",31,0)
 S PNAME=VADM(1)
"RTN","PSOPMP0",32,0)
 S DOB=$S(+VADM(3):$P(VADM(3),"^",2)_" ("_$G(VADM(4))_")",1:"UNKNOWN")
"RTN","PSOPMP0",33,0)
 S SEX=$P(VADM(5),"^",2)
"RTN","PSOPMP0",34,0)
 S (WT,X)="",GMRVSTR="WT" D EN6^GMRVUTL I X'="" S WT=$J($P(X,"^",8)/2.2,6,2),WTDT=$$DAT^PSOPMP1($P(X,"^")\1,"/",1)
"RTN","PSOPMP0",35,0)
 S (HT,X)="",GMRVSTR="HT" D EN6^GMRVUTL I X'="" S HT=$J($P(X,"^",8)*2.54,6,2),HTDT=$$DAT^PSOPMP1($P(X,"^")\1,"/",1)
"RTN","PSOPMP0",36,0)
 S LINE1=PNAME
"RTN","PSOPMP0",37,0)
 S LINE1=$$ALLERGY^PSOPMP1(LINE1,DFN)
"RTN","PSOPMP0",38,0)
 S LINE2="  PID: "_$P(VADM(2),"^",2),$E(LINE2,50)="HEIGHT(cm): "_$S(HT'="":HT_" ("_HTDT_")",1:"NOT AVAILABLE")
"RTN","PSOPMP0",39,0)
 S LINE3="  DOB: "_DOB,$E(LINE3,50)="WEIGHT(kg): "_$S(WT'="":WT_" ("_WTDT_")",1:"NOT AVAILABLE")
"RTN","PSOPMP0",40,0)
 S LINE4="  SEX: "_SEX,$E(LINE4,43)="EXP/CANCEL CUTOFF: "_PSOEXDCE_" DAYS"
"RTN","PSOPMP0",41,0)
 ;
"RTN","PSOPMP0",42,0)
 K VALMHDR S VALMHDR(1)=LINE1,VALMHDR(2)=LINE2,VALMHDR(3)=LINE3,VALMHDR(4)=LINE4
"RTN","PSOPMP0",43,0)
 D SETHDR^PSOPMP1()
"RTN","PSOPMP0",44,0)
 Q
"RTN","PSOPMP0",45,0)
 ;
"RTN","PSOPMP0",46,0)
INIT ;Populates the Body section for ListMan
"RTN","PSOPMP0",47,0)
 K ^TMP("PSOPMP0",$J),^TMP("PSOPMPSR",$J)
"RTN","PSOPMP0",48,0)
 D SETSORT(PSOSRTBY),SETLINE
"RTN","PSOPMP0",49,0)
 S VALMSG="Select the entry # to view or ?? for more actions"
"RTN","PSOPMP0",50,0)
 Q
"RTN","PSOPMP0",51,0)
 ;
"RTN","PSOPMP0",52,0)
SETLINE ;Sets the line to be displayed in ListMan
"RTN","PSOPMP0",53,0)
 N TYPE,STS,SUB,SEQ,LINE,Z,TOTAL,I,X,X1,ORDCNT,LBL,LN,IENSUB,GROUP,GRP,QTYL
"RTN","PSOPMP0",54,0)
 I '$D(^TMP("PSOPMPSR",$J)) D  Q
"RTN","PSOPMP0",55,0)
 . F I=1:1:6 S ^TMP("PSOPMP0",$J,I,0)=""
"RTN","PSOPMP0",56,0)
 . S ^TMP("PSOPMP0",$J,7,0)="                    No prescriptions found for this patient."
"RTN","PSOPMP0",57,0)
 . S VALMCNT=1
"RTN","PSOPMP0",58,0)
 ;
"RTN","PSOPMP0",59,0)
 ;Resetting list to NORMAL video attributes
"RTN","PSOPMP0",60,0)
 F I=1:1:$G(LASTLINE) D RESTORE^VALM10(I)
"RTN","PSOPMP0",61,0)
 K GRPLN,HIGHLN
"RTN","PSOPMP0",62,0)
 ;Building the list (line by line)
"RTN","PSOPMP0",63,0)
 S (GROUP,STS,SUB)="",LINE=0 K ^TMP("PSOPMP0",$J)
"RTN","PSOPMP0",64,0)
 F  S GROUP=$O(^TMP("PSOPMPSR",$J,GROUP)) Q:GROUP=""  D
"RTN","PSOPMP0",65,0)
 . S GRP=$P(GROUP,"^")
"RTN","PSOPMP0",66,0)
 . I GRP'["R"!('PSOSTSGP&($O(^TMP("PSOPMPSR",$J,GROUP),-1)'="")) D
"RTN","PSOPMP0",67,0)
 . . D GROUP^PSOPMP1($P(GROUP,"^",2),+$G(^TMP("PSOPMPSR",$J,GROUP)),.LINE)
"RTN","PSOPMP0",68,0)
 . F  S STS=$O(^TMP("PSOPMPSR",$J,GROUP,STS)) Q:STS=""  D
"RTN","PSOPMP0",69,0)
 . . I STS'="<NULL>" D
"RTN","PSOPMP0",70,0)
 . . . D GROUP^PSOPMP1($P(STS,"^",2),+$G(^TMP("PSOPMPSR",$J,GROUP,STS)),.LINE)
"RTN","PSOPMP0",71,0)
 . . F  S SUB=$O(^TMP("PSOPMPSR",$J,GROUP,STS,SUB),$S(PSORDER="A":1,1:-1)) Q:SUB=""  D
"RTN","PSOPMP0",72,0)
 . . . S Z=$G(^TMP("PSOPMPSR",$J,GROUP,STS,SUB))
"RTN","PSOPMP0",73,0)
 . . . S X1="",SEQ=$G(SEQ)+1,X1=$J(SEQ,3)
"RTN","PSOPMP0",74,0)
 . . . S QTYL=$L($P(Z,"^",4)) S:QTYL<5 QTYL=5
"RTN","PSOPMP0",75,0)
 . . . I GRP["R"!(GRP["T") S $E(X1,5)=$P(Z,"^",2),$E(X1,19)=$E($P(Z,"^",3),1,(32-QTYL))
"RTN","PSOPMP0",76,0)
 . . . I GRP["P"!(GRP["N") S $E(X1,5)=$P(Z,"^",3)
"RTN","PSOPMP0",77,0)
 . . . I GRP["N" S $E(X1,49)="Date Documented:"
"RTN","PSOPMP0",78,0)
 . . . I GRP'["N" S $E(X1,52-QTYL)=$J($P(Z,"^",4),QTYL),$E(X1,53)=$P(Z,"^",5),$E(X1,57)=$P(Z,"^",6)
"RTN","PSOPMP0",79,0)
 . . . S $E(X1,66)=$P(Z,"^",7)
"RTN","PSOPMP0",80,0)
 . . . S $E(X1,74)=$J($P(Z,"^",8),3),$E(X1,78)=$J($P(Z,"^",9),3)
"RTN","PSOPMP0",81,0)
 . . . S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X1,HIGHLN(LINE)=""
"RTN","PSOPMP0",82,0)
 . . . S IENSUB=$S(GRP["R"!(GRP["T"):"RX",GRP["P":"PEN",1:"NVA")
"RTN","PSOPMP0",83,0)
 . . . S ^TMP("PSOPMP0",$J,SEQ,IENSUB)=$P(Z,"^")
"RTN","PSOPMP0",84,0)
 . . . I IENSUB="PEN"&($P($G(^PS(52.41,+$P(Z,"^"),0)),"^",23)=1) S ^TMP("PSOPMP0",$J,LINE,"RV")=1
"RTN","PSOPMP0",85,0)
 . . . I $G(PSOSIGDP) D SETSIG^PSOPMP1($S(GRP["R"!(GRP["T"):"R",GRP["P":"P",1:"N"),+Z,.LINE,PSODFN)
"RTN","PSOPMP0",86,0)
 ;
"RTN","PSOPMP0",87,0)
 ;Saving NORMAL video attributes to be reset later
"RTN","PSOPMP0",88,0)
 I LINE>$G(LASTLINE) D
"RTN","PSOPMP0",89,0)
 . F I=($G(LASTLINE)+1):1:LINE D SAVE^VALM10(I)
"RTN","PSOPMP0",90,0)
 . S LASTLINE=LINE
"RTN","PSOPMP0",91,0)
 D VIDEO^PSOPMP1()
"RTN","PSOPMP0",92,0)
 S VALMCNT=+$G(LINE) D RV^PSOPMP1
"RTN","PSOPMP0",93,0)
 Q
"RTN","PSOPMP0",94,0)
 ;
"RTN","PSOPMP0",95,0)
SETSORT(FIELD) ;Sets the data sorted by the FIELD specified
"RTN","PSOPMP0",96,0)
 N SEQ,RX,RXNUM,DRUG,DRNAME,QTY,STATUS,STS,ISSDT,DOCDAT,LSTFD,REFREM,DAYSUP,SIG,Z,ORD,GRPCNT,GROUP,RFRX,OI,PSOBADR
"RTN","PSOPMP0",97,0)
 K ^TMP("PSOPMPSR",$J)
"RTN","PSOPMP0",98,0)
 ;Loading prescription (file #55)
"RTN","PSOPMP0",99,0)
 S SEQ=0
"RTN","PSOPMP0",100,0)
 F  S SEQ=$O(^PS(55,PSODFN,"P",SEQ)) Q:'SEQ  D
"RTN","PSOPMP0",101,0)
 . S RX=+$G(^PS(55,PSODFN,"P",SEQ,0)) I 'RX!($G(^PSRX(RX,0))="") Q
"RTN","PSOPMP0",102,0)
 . I $$FILTER^PSOPMP1(RX) Q
"RTN","PSOPMP0",103,0)
 . S RXNUM=$$GET1^DIQ(52,RX,.01)
"RTN","PSOPMP0",104,0)
 . S DRUG=$$GET1^DIQ(52,RX,6,"I")
"RTN","PSOPMP0",105,0)
 . S DRNAME=$$GET1^DIQ(50,DRUG,.01)
"RTN","PSOPMP0",106,0)
 . S QTY=$$GET1^DIQ(52,RX,7)
"RTN","PSOPMP0",107,0)
 . S STATUS=$$STSINFO^PSOPMP1(RX)
"RTN","PSOPMP0",108,0)
 . S ISSDT=$$ISSDT^PSOPMP1(RX,"R")
"RTN","PSOPMP0",109,0)
 . S LSTFD=$$LSTFD^PSOPMP1(RX)
"RTN","PSOPMP0",110,0)
 . S REFREM=$$REFREM^PSOPMP1(RX)
"RTN","PSOPMP0",111,0)
 . S DAYSUP=$$GET1^DIQ(52,RX,8)
"RTN","PSOPMP0",112,0)
 . S PSOBADR=$O(^PSRX(RX,"L",9999),-1)
"RTN","PSOPMP0",113,0)
 . I PSOBADR'="" S PSOBADR=$G(^PSRX(RX,"L",PSOBADR,0)) I PSOBADR["(BAD ADDRESS)" S PSOBADR="B"
"RTN","PSOPMP0",114,0)
 . I PSOBADR'="B" S PSOBADR=""
"RTN","PSOPMP0",115,0)
 . S Z="",$P(Z,"^")=RX,$P(Z,"^",2)=RXNUM_$$COPAY^PSOPMP1(RX)_$$ECME^PSOBPSUT(RX),$P(Z,"^",3)=$E(DRNAME,1,30)
"RTN","PSOPMP0",116,0)
 . S $P(Z,"^",4)=QTY,$P(Z,"^",5)=$P(STATUS,"^",3)_$$CMOP^PSOPMP1(DRUG,RX)_PSOBADR,$P(Z,"^",6)=$P(ISSDT,"^",2)
"RTN","PSOPMP0",117,0)
 . S $P(Z,"^",7)=$P(LSTFD,"^",2),$P(Z,"^",8)=REFREM,$P(Z,"^",9)=DAYSUP
"RTN","PSOPMP0",118,0)
 . S SORT=$S(FIELD="RX":RXNUM_" ",FIELD="DR":DRNAME_RXNUM,FIELD="ID":+ISSDT_RXNUM_" ",FIELD="LF":+LSTFD_RXNUM_" ")
"RTN","PSOPMP0",119,0)
 . S STS="<NULL>" I $G(PSOSTSGP) S STS=$P(STATUS,"^")_"^"_$P(STATUS,"^",2)
"RTN","PSOPMP0",120,0)
 . S GROUP=$P(PSORDSEQ("R"),"^")_"R^"_$P(PSORDSEQ("R"),"^",2)
"RTN","PSOPMP0",121,0)
 . I $$FIND^PSOREJUT(RX,,,"79,88") S GROUP=$P(PSORDSEQ("T"),"^")_"T^"_$P(PSORDSEQ("T"),"^",2),STS="<NULL>"
"RTN","PSOPMP0",122,0)
 . S ^TMP("PSOPMPSR",$J,GROUP,STS,SORT)=Z
"RTN","PSOPMP0",123,0)
 . S GRPCNT(GROUP)=$G(GRPCNT(GROUP))+1,GRPCNT(GROUP,STS)=$G(GRPCNT(GROUP,STS))+1
"RTN","PSOPMP0",124,0)
 ;
"RTN","PSOPMP0",125,0)
 S GROUP=""
"RTN","PSOPMP0",126,0)
 F  S GROUP=$O(GRPCNT(GROUP)) Q:GROUP=""  D
"RTN","PSOPMP0",127,0)
 . S ^TMP("PSOPMPSR",$J,GROUP)=$G(GRPCNT(GROUP))
"RTN","PSOPMP0",128,0)
 . S STS="" F  S STS=$O(GRPCNT(GROUP,STS)) Q:STS=""  D
"RTN","PSOPMP0",129,0)
 . . S ^TMP("PSOPMPSR",$J,GROUP,STS)=GRPCNT(GROUP,STS)
"RTN","PSOPMP0",130,0)
 ;
"RTN","PSOPMP0",131,0)
 ;Loading pending orders (file #52.41)
"RTN","PSOPMP0",132,0)
 S ORD=0,GROUP=$P(PSORDSEQ("P"),"^")_"P^"_$P(PSORDSEQ("P"),"^",2)
"RTN","PSOPMP0",133,0)
 F  S ORD=$O(^PS(52.41,"P",PSODFN,ORD)) Q:'ORD  D
"RTN","PSOPMP0",134,0)
 . S TYPE=$$GET1^DIQ(52.41,ORD,2,"I")
"RTN","PSOPMP0",135,0)
 . I TYPE="DC"!(TYPE="DE")!(TYPE="HD") Q
"RTN","PSOPMP0",136,0)
 . S DRNAME="",DRUG=+$$GET1^DIQ(52.41,ORD,11,"I") I DRUG S DRNAME=$$GET1^DIQ(50,DRUG,.01)
"RTN","PSOPMP0",137,0)
 . I DRNAME="" D  Q:DRNAME=""
"RTN","PSOPMP0",138,0)
 . . S OI=$$GET1^DIQ(52.41,ORD,8,"I") I 'OI Q
"RTN","PSOPMP0",139,0)
 . . S DRNAME=$$GET1^DIQ(50.7,OI,.01)_" "_$$GET1^DIQ(50.7,OI,.02)
"RTN","PSOPMP0",140,0)
 . S QTY=$$GET1^DIQ(52.41,ORD,12)
"RTN","PSOPMP0",141,0)
 . S STATUS=$$GET1^DIQ(52.41,ORD,2,"I")
"RTN","PSOPMP0",142,0)
 . S ISSDT=$$ISSDT^PSOPMP1(ORD,"P")
"RTN","PSOPMP0",143,0)
 . S REFREM=$$GET1^DIQ(52.41,ORD,13)
"RTN","PSOPMP0",144,0)
 . S DAYSUP=$$GET1^DIQ(52.41,ORD,101)
"RTN","PSOPMP0",145,0)
 . S RFRX="" I STATUS="RF" S RFRX=$$GET1^DIQ(52.41,ORD,21,"I") I RFRX S RFRX=$$GET1^DIQ(52,RFRX,.01)
"RTN","PSOPMP0",146,0)
 . S Z="",$P(Z,"^")=ORD,$P(Z,"^",3)=$E(DRNAME,1,45),$P(Z,"^",4)=QTY,$P(Z,"^",5)=$E(STATUS,1,2)_$$CMOP^PSOPMP1(DRUG)
"RTN","PSOPMP0",147,0)
 . S $P(Z,"^",6)=$S(RFRX'="":"Rx#: "_RFRX,1:$P(ISSDT,"^",2)),$P(Z,"^",8)=REFREM,$P(Z,"^",9)=DAYSUP
"RTN","PSOPMP0",148,0)
 . S SORT=$S(FIELD="RX":DRNAME_ORD,FIELD="DR":DRNAME_ORD,FIELD="ID":+ISSDT_ORD,FIELD="LF":+ISSDT_ORD)
"RTN","PSOPMP0",149,0)
 . S ^TMP("PSOPMPSR",$J,GROUP,"<NULL>",SORT)=Z
"RTN","PSOPMP0",150,0)
 . S GRPCNT(GROUP)=$G(GRPCNT(GROUP))+1
"RTN","PSOPMP0",151,0)
 S:$G(GRPCNT(GROUP)) ^TMP("PSOPMPSR",$J,GROUP)=$G(GRPCNT(GROUP))
"RTN","PSOPMP0",152,0)
 ;
"RTN","PSOPMP0",153,0)
 ;Loading Non-VA Med orders (file #55, sub-file #55.05)
"RTN","PSOPMP0",154,0)
 S ORD=0,GROUP=$P(PSORDSEQ("N"),"^")_"N^"_$P(PSORDSEQ("N"),"^",2)
"RTN","PSOPMP0",155,0)
 F  S ORD=$O(^PS(55,PSODFN,"NVA",ORD)) Q:'ORD  D
"RTN","PSOPMP0",156,0)
 . I $$GET1^DIQ(55.05,ORD_","_PSODFN,5,"I") Q
"RTN","PSOPMP0",157,0)
 . S DRNAME=$$GET1^DIQ(55.05,ORD_","_PSODFN,1)
"RTN","PSOPMP0",158,0)
 . I DRNAME="" D  Q:DRNAME=""
"RTN","PSOPMP0",159,0)
 . . S OI=$$GET1^DIQ(55.05,ORD_","_PSODFN,.01,"I") I 'OI Q
"RTN","PSOPMP0",160,0)
 . . S DRNAME=$$GET1^DIQ(50.7,OI,.01)_" "_$$GET1^DIQ(50.7,OI,.02)
"RTN","PSOPMP0",161,0)
 . S DOCDAT=$P($$GET1^DIQ(55.05,ORD_","_PSODFN_",",11,"I"),".")
"RTN","PSOPMP0",162,0)
 . S Z="",$P(Z,"^")=ORD,$P(Z,"^",3)=$E(DRNAME,1,38),$P(Z,"^",7)=$$DAT^PSOPMP1(DOCDAT,"-")
"RTN","PSOPMP0",163,0)
 . S SORT=$S(FIELD="RX":DRNAME_ORD,FIELD="DR":DRNAME_ORD,FIELD="ID":DOCDAT_ORD,FIELD="LF":DOCDAT_ORD)
"RTN","PSOPMP0",164,0)
 . S ^TMP("PSOPMPSR",$J,GROUP,"<NULL>",SORT)=Z
"RTN","PSOPMP0",165,0)
 . S GRPCNT(GROUP)=$G(GRPCNT(GROUP))+1
"RTN","PSOPMP0",166,0)
 ;
"RTN","PSOPMP0",167,0)
 S:$G(GRPCNT(GROUP)) ^TMP("PSOPMPSR",$J,GROUP)=$G(GRPCNT(GROUP))
"RTN","PSOPMP0",168,0)
 Q
"RTN","PSOPMP0",169,0)
 ;
"RTN","PSOPMP0",170,0)
RX ;Sort by Rx
"RTN","PSOPMP0",171,0)
 D SORT("RX")
"RTN","PSOPMP0",172,0)
 Q
"RTN","PSOPMP0",173,0)
DR ;Sort by Drug
"RTN","PSOPMP0",174,0)
 D SORT("DR")
"RTN","PSOPMP0",175,0)
 Q
"RTN","PSOPMP0",176,0)
ID ;Sort by Issue Date
"RTN","PSOPMP0",177,0)
 D SORT("ID")
"RTN","PSOPMP0",178,0)
 Q
"RTN","PSOPMP0",179,0)
LF ;Sort by Last Fill Date
"RTN","PSOPMP0",180,0)
 D SORT("LF")
"RTN","PSOPMP0",181,0)
 Q
"RTN","PSOPMP0",182,0)
 ;
"RTN","PSOPMP0",183,0)
SORT(FIELD) ;Sort entries by FIELD
"RTN","PSOPMP0",184,0)
 I PSOSRTBY=FIELD S PSORDER=$S(PSORDER="A":"D",1:"A")
"RTN","PSOPMP0",185,0)
 E  S PSOSRTBY=FIELD,PSORDER="A"
"RTN","PSOPMP0",186,0)
 D REF
"RTN","PSOPMP0",187,0)
 Q
"RTN","PSOPMP0",188,0)
 ;
"RTN","PSOPMP0",189,0)
REF ;Screen Refresh
"RTN","PSOPMP0",190,0)
 W ?52,"Please wait..." D INIT,HDR S VALMBCK="R"
"RTN","PSOPMP0",191,0)
 Q
"RTN","PSOPMP0",192,0)
GS ;Group by Status
"RTN","PSOPMP0",193,0)
 W ?52,"Please wait..." S PSOSTSGP=$S($G(PSOSTSGP):0,1:1) D INIT,HDR S VALMBCK="R"
"RTN","PSOPMP0",194,0)
 Q
"RTN","PSOPMP0",195,0)
SIG ;Display SIG
"RTN","PSOPMP0",196,0)
 W ?52,"Please wait..." S PSOSIGDP=$S($G(PSOSIGDP):0,1:1) D INIT,HDR S VALMBCK="R"
"RTN","PSOPMP0",197,0)
 I 'PSOSIGDP S VALMBG=VALMBG\2
"RTN","PSOPMP0",198,0)
 I PSOSIGDP S VALMBG=VALMBG*2-1
"RTN","PSOPMP0",199,0)
 S:VALMBG>(VALMCNT-10) VALMBG=VALMCNT-10 S:VALMBG<1 VALMBG=1
"RTN","PSOPMP0",200,0)
 Q
"RTN","PSOPMP0",201,0)
PI ;Patient Information
"RTN","PSOPMP0",202,0)
 D EN^PSOLMPI S VALMBCK="R"
"RTN","PSOPMP0",203,0)
 Q
"RTN","PSOPMP0",204,0)
CV ;Change View
"RTN","PSOPMP0",205,0)
 D LST^PSOPMPPF(SITE,DUZ) W !?52,"Please wait..." D INIT,HDR
"RTN","PSOPMP0",206,0)
 S VALMBG=1,VALMBCK="R"
"RTN","PSOPMP0",207,0)
 Q
"RTN","PSOPMP0",208,0)
 ;
"RTN","PSOPMP0",209,0)
SEL ;Process selection of one entry
"RTN","PSOPMP0",210,0)
 N PSOSEL,TYPE,XQORM,ORD,TITLE,PSOLIS,XX
"RTN","PSOPMP0",211,0)
 S PSOLIS=$P(XQORNOD(0),"=",2) I 'PSOLIS S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOPMP0",212,0)
 F XX=1:1:$L(PSOLIS,",") Q:$P(PSOLIS,",",XX)']""  D
"RTN","PSOPMP0",213,0)
 .S PSOSEL=+$P(PSOLIS,",",XX) I 'PSOSEL S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOPMP0",214,0)
 .S TYPE=$O(^TMP("PSOPMP0",$J,PSOSEL,0)) I TYPE="" S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOPMP0",215,0)
 .S ORD=$G(^TMP("PSOPMP0",$J,PSOSEL,TYPE))
"RTN","PSOPMP0",216,0)
 .I 'ORD S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOPMP0",217,0)
 .S TITLE=VALM("TITLE")
"RTN","PSOPMP0",218,0)
 .;
"RTN","PSOPMP0",219,0)
 .;Regular prescription
"RTN","PSOPMP0",220,0)
 .I TYPE="RX" D  S VALMBCK="R" D REF
"RTN","PSOPMP0",221,0)
 .. N PSOVDA,PSOSAVE,DA,PS
"RTN","PSOPMP0",222,0)
 .. S (PSOVDA,DA)=ORD,PS="REJECTMP"
"RTN","PSOPMP0",223,0)
 .. N LINE,TITLE,PSODFN D DP^PSORXVW
"RTN","PSOPMP0",224,0)
 .;
"RTN","PSOPMP0",225,0)
 .;Pending Order
"RTN","PSOPMP0",226,0)
 .I TYPE="PEN" D  S VALMBCK="R" D REF
"RTN","PSOPMP0",227,0)
 .. N PSOACTOV,OR0
"RTN","PSOPMP0",228,0)
 .. S OR0=^PS(52.41,ORD,0),PSOACTOV=""
"RTN","PSOPMP0",229,0)
 .. N LINE,TITLE D PENHDR^PSOPMP1(PSODFN),DSPL^PSOORFI1
"RTN","PSOPMP0",230,0)
 .;
"RTN","PSOPMP0",231,0)
 .;Pending Order
"RTN","PSOPMP0",232,0)
 .I TYPE="NVA" D
"RTN","PSOPMP0",233,0)
 .. N LINE,TITLE D EN^PSONVAVW(PSODFN,ORD)
"RTN","PSOPMP0",234,0)
 .;
"RTN","PSOPMP0",235,0)
 S VALMBCK="R",VALM("TITLE")=TITLE
"RTN","PSOPMP0",236,0)
 Q
"RTN","PSOPMP0",237,0)
 ;
"RTN","PSOPMP0",238,0)
EXIT ;
"RTN","PSOPMP0",239,0)
 K ^TMP("PSOPMP0",$J),^TMP("PSOPMPSR",$J)
"RTN","PSOPMP0",240,0)
 Q
"RTN","PSOPMP0",241,0)
 ;
"RTN","PSOPMP0",242,0)
HELP Q
"RTN","PSOPMP1")
0^2^B29384339^B29406474
"RTN","PSOPMP1",1,0)
PSOPMP1 ;BIRM/MFR - Patient Medication Profile - Listmanager ;04/28/05
"RTN","PSOPMP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260,285,281,303,289,276,382**;DEC 1997;Build 9
"RTN","PSOPMP1",3,0)
 ;Reference to ^PSDRUG("AQ" supported by IA 3165
"RTN","PSOPMP1",4,0)
 ;Reference to EN1^GMRADPT supported by IA 10099
"RTN","PSOPMP1",5,0)
 ;Reference to ^PSXOPUTL supported by IA 2200
"RTN","PSOPMP1",6,0)
 ;
"RTN","PSOPMP1",7,0)
VIDEO() ; - Changes the Video Attributes for the list
"RTN","PSOPMP1",8,0)
 ;
"RTN","PSOPMP1",9,0)
 ; - Highlighting the PRESCRIPTION line if SIG is displayed
"RTN","PSOPMP1",10,0)
 I $G(PSOSIGDP) D
"RTN","PSOPMP1",11,0)
 . F I=1:1:LINE D
"RTN","PSOPMP1",12,0)
 . . I $D(HIGHLN(I)) D CNTRL^VALM10(I,1,80,IOINHI,IOINORM)
"RTN","PSOPMP1",13,0)
 ;
"RTN","PSOPMP1",14,0)
 ; - Highlighting the group lines (order type and status)
"RTN","PSOPMP1",15,0)
 I $D(GRPLN) D
"RTN","PSOPMP1",16,0)
 . S LN=0 F I=1:1 S LN=$O(GRPLN(LN)) Q:'LN  D
"RTN","PSOPMP1",17,0)
 . . S LBL=GRPLN(LN),POS=41-($L(LBL)\2)
"RTN","PSOPMP1",18,0)
 . . D CNTRL^VALM10(LN,1,POS-1,IOUON_IOINHI,IOINORM)
"RTN","PSOPMP1",19,0)
 . . D CNTRL^VALM10(LN,POS,$L(LBL),IORVON_IOINHI,IORVOFF_IOINORM)
"RTN","PSOPMP1",20,0)
 . . D CNTRL^VALM10(LN,POS+$L(LBL),81-POS-$L(LBL),IOUON_IOINHI,IOINORM)
"RTN","PSOPMP1",21,0)
 Q
"RTN","PSOPMP1",22,0)
 ;
"RTN","PSOPMP1",23,0)
RV ;reverse video for flagged pending orders
"RTN","PSOPMP1",24,0)
 N PSLIST S PSLIST=0 F PSLIST=1:1:VALMCNT D
"RTN","PSOPMP1",25,0)
 .Q:'$D(^TMP("PSOPMP0",$J,PSLIST,"RV"))
"RTN","PSOPMP1",26,0)
 .I $D(^TMP("PSOPMP0",$J,PSLIST,"RV")) D CNTRL^VALM10(PSLIST,1,3,IORVON,IORVOFF,0) Q
"RTN","PSOPMP1",27,0)
 Q
"RTN","PSOPMP1",28,0)
 ;
"RTN","PSOPMP1",29,0)
SETHDR() ; - Displays the Header Line
"RTN","PSOPMP1",30,0)
 N HDR,ORD,POS
"RTN","PSOPMP1",31,0)
 ;
"RTN","PSOPMP1",32,0)
 ; - Line 1
"RTN","PSOPMP1",33,0)
 S $E(HDR,57)="ISSUE",$E(HDR,66)="LAST",$E(HDR,74)="REF",$E(HDR,78)="DAY"
"RTN","PSOPMP1",34,0)
 S $E(HDR,81)="" D INSTR^VALM1(IORVON_HDR_IOINORM,1,6)
"RTN","PSOPMP1",35,0)
 ; - Line 2
"RTN","PSOPMP1",36,0)
 S HDR="  #",$E(HDR,5)="Rx#",$E(HDR,19)="DRUG",$E(HDR,49)="QTY",$E(HDR,53)="ST"
"RTN","PSOPMP1",37,0)
 S $E(HDR,57)="DATE",$E(HDR,66)="FILL",$E(HDR,74)="REM",$E(HDR,78)="SUP"
"RTN","PSOPMP1",38,0)
 S $E(HDR,81)="" D INSTR^VALM1(IORVON_HDR_IOINORM,1,7)
"RTN","PSOPMP1",39,0)
 S ORD=$S(PSORDER="A":"[^]",1:"[v]")
"RTN","PSOPMP1",40,0)
 S:PSOSRTBY="RX" POS=9 S:PSOSRTBY="DR" POS=24 S:PSOSRTBY="ID" POS=61 S:PSOSRTBY="LF" POS=70
"RTN","PSOPMP1",41,0)
 D INSTR^VALM1(IOINHI_IORVON_ORD_IOINORM,POS,7)
"RTN","PSOPMP1",42,0)
 Q
"RTN","PSOPMP1",43,0)
 ;
"RTN","PSOPMP1",44,0)
SETSIG(TYPE,RX,LINE,DFN) ; Set the SIG line
"RTN","PSOPMP1",45,0)
 N FSIG,L,X,DIWL,DIWR
"RTN","PSOPMP1",46,0)
 ;
"RTN","PSOPMP1",47,0)
 I TYPE="N" D  Q
"RTN","PSOPMP1",48,0)
 . K ^UTILITY($J,"W")
"RTN","PSOPMP1",49,0)
 . S X=$$SCHED^PSONVNEW($$GET1^DIQ(55.05,RX_","_DFN,4)),DIWL=1,DIWR=71 D ^DIWP
"RTN","PSOPMP1",50,0)
 . F L=1:1 Q:'$D(^UTILITY($J,"W",1,L))  D
"RTN","PSOPMP1",51,0)
 . . S X="" S:L=1 $E(X,5)="SIG:" S $E(X,10)=^UTILITY($J,"W",1,L,0)
"RTN","PSOPMP1",52,0)
 . . S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X
"RTN","PSOPMP1",53,0)
 ;
"RTN","PSOPMP1",54,0)
 D FSIG^PSOUTLA(TYPE,+RX,71)
"RTN","PSOPMP1",55,0)
 F L=1:1 Q:'$D(FSIG(L))  D
"RTN","PSOPMP1",56,0)
 . S X="" S:L=1 $E(X,5)="SIG:" S $E(X,10)=FSIG(L)
"RTN","PSOPMP1",57,0)
 . S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X
"RTN","PSOPMP1",58,0)
 Q
"RTN","PSOPMP1",59,0)
 ;
"RTN","PSOPMP1",60,0)
GROUP(LBL,CNT,LINE) ; Sets a group delimiter line
"RTN","PSOPMP1",61,0)
 N X,POS
"RTN","PSOPMP1",62,0)
 S LBL=LBL_$S(PSORDCNT:" ("_CNT_" order"_$S(CNT>1:"s",1:"")_")",1:"")
"RTN","PSOPMP1",63,0)
 S POS=41-($L(LBL)\2)
"RTN","PSOPMP1",64,0)
 S X="",$P(X," ",81)="",$E(X,POS,POS-1+$L(LBL))=LBL
"RTN","PSOPMP1",65,0)
 S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X,GRPLN(LINE)=LBL
"RTN","PSOPMP1",66,0)
 Q
"RTN","PSOPMP1",67,0)
 ;
"RTN","PSOPMP1",68,0)
PENHDR(DFN) ; Sets the Header in the ^TMP("PSOHDR",$J) global for displaying individual Pending Order
"RTN","PSOPMP1",69,0)
 N VADM,WT,HT,PSOERR,GMRA
"RTN","PSOPMP1",70,0)
 K ^TMP("PSOHDR",$J) D ^VADPT,ADD^VADPT
"RTN","PSOPMP1",71,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1),^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSOPMP1",72,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSOPMP1",73,0)
 S POERR=1 D RE^PSODEM K PSOERR
"RTN","PSOPMP1",74,0)
 S ^TMP("PSOHDR",$J,6,0)=$S(+$P(WT,"^",8):$J($P(WT,"^",9),6)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSOPMP1",75,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$J($P(HT,"^",9),6)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSOPMP1",76,0)
 S GMRA="0^0^111" D EN1^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSOPMP1",77,0)
 Q
"RTN","PSOPMP1",78,0)
 ;
"RTN","PSOPMP1",79,0)
FILTER(RX) ; - Filter Rx's that should not be displayed
"RTN","PSOPMP1",80,0)
 I $$GET1^DIQ(52,RX,26,"I")<PSOEXPDC Q 1
"RTN","PSOPMP1",81,0)
 I $$GET1^DIQ(52,RX,26.1,"I"),$$GET1^DIQ(52,RX,26.1,"I")<PSOEXPDC,$$GET1^DIQ(52,RX,100,"I")>11,$$GET1^DIQ(52,RX,100,"I")'=16 Q 1
"RTN","PSOPMP1",82,0)
 I $$GET1^DIQ(52,RX,100,"I")=""!($$GET1^DIQ(52,RX,100,"I")=13) Q 1
"RTN","PSOPMP1",83,0)
 I $$GET1^DIQ(52,RX,.01)="" Q 1
"RTN","PSOPMP1",84,0)
 Q 0
"RTN","PSOPMP1",85,0)
 ;
"RTN","PSOPMP1",86,0)
STSINFO(RX) ; Returns the Rx Status MNEMONIC^NAME
"RTN","PSOPMP1",87,0)
 ; Input: RX - Prescription IEN (#52)
"RTN","PSOPMP1",88,0)
 ;Output: Status Mnemonic ("A","DC",etc.)^Status Name ("ACTIVE","DISCONTINUED",etc.)
"RTN","PSOPMP1",89,0)
 ;
"RTN","PSOPMP1",90,0)
 N STS
"RTN","PSOPMP1",91,0)
 I '$D(^PSRX(RX,"STA")) Q ""
"RTN","PSOPMP1",92,0)
 S STS=$$GET1^DIQ(52,RX,100,"I")
"RTN","PSOPMP1",93,0)
 I STS=0 Q:$$GET1^DIQ(52,RX,26,"I")>DT PSOSTSEQ("A") Q PSOSTSEQ("E")
"RTN","PSOPMP1",94,0)
 I STS=1 Q PSOSTSEQ("N")
"RTN","PSOPMP1",95,0)
 I STS=3 Q PSOSTSEQ("H")
"RTN","PSOPMP1",96,0)
 I STS=5 Q PSOSTSEQ("S")
"RTN","PSOPMP1",97,0)
 I STS=11 Q PSOSTSEQ("E")
"RTN","PSOPMP1",98,0)
 I STS=12 Q PSOSTSEQ("DC")
"RTN","PSOPMP1",99,0)
 I STS=14 Q PSOSTSEQ("DP")
"RTN","PSOPMP1",100,0)
 I STS=15 Q PSOSTSEQ("DE")
"RTN","PSOPMP1",101,0)
 I STS=16 Q PSOSTSEQ("PH")
"RTN","PSOPMP1",102,0)
 Q "99^UNKNOWN^??"
"RTN","PSOPMP1",103,0)
 ; 
"RTN","PSOPMP1",104,0)
ISSDT(IEN,TYPE) ; Returns the Rx ISSUE DATE formatted MM-DD-YY
"RTN","PSOPMP1",105,0)
 ;Input: RX   - Prescription IEN (#52)
"RTN","PSOPMP1",106,0)
 ;       TYPE - "R":Regular Rx, "P":Pending order
"RTN","PSOPMP1",107,0)
 N ISSDT
"RTN","PSOPMP1",108,0)
 I TYPE="R" S ISSDT=$$GET1^DIQ(52,IEN,1,"I")
"RTN","PSOPMP1",109,0)
 I TYPE="P" S ISSDT=$$GET1^DIQ(52.41,IEN,6,"I")
"RTN","PSOPMP1",110,0)
 I ISSDT'="" S ISSDT=ISSDT\1
"RTN","PSOPMP1",111,0)
 ;
"RTN","PSOPMP1",112,0)
 Q (ISSDT_"^"_$$DAT(ISSDT,"-"))
"RTN","PSOPMP1",113,0)
 ;
"RTN","PSOPMP1",114,0)
LSTFD(RX) ; Returns the Rx LAST FILL DATE formatted MM-DD-YY[R], where [R] = Returned to Stock
"RTN","PSOPMP1",115,0)
 ;Input: RX  - Prescription IEN (#52)
"RTN","PSOPMP1",116,0)
 N LSTFD,RTSTK,RFL
"RTN","PSOPMP1",117,0)
 S LSTFD=$$GET1^DIQ(52,RX,101,"I")\1 I LSTFD="" Q ""
"RTN","PSOPMP1",118,0)
 I '$$LSTRFL^PSOBPSU1(RX) D
"RTN","PSOPMP1",119,0)
 . I $$GET1^DIQ(52,RX,32.1,"I") S RTSTK="R"
"RTN","PSOPMP1",120,0)
 E  S RFL=0 F  S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  D
"RTN","PSOPMP1",121,0)
 . I $$RXFLDT^PSOBPSUT(RX,RFL)'=LSTFD Q
"RTN","PSOPMP1",122,0)
 . I $$GET1^DIQ(52.1,RFL_","_RX,14,"I") S RTSTK="R"
"RTN","PSOPMP1",123,0)
 ;
"RTN","PSOPMP1",124,0)
 Q (LSTFD_"^"_$$DAT(LSTFD,"-")_$G(RTSTK))
"RTN","PSOPMP1",125,0)
 ;
"RTN","PSOPMP1",126,0)
REFREM(RX) ; - Returns the number of refills remaining
"RTN","PSOPMP1",127,0)
 N REFREM,RFL
"RTN","PSOPMP1",128,0)
 S REFREM=+$$GET1^DIQ(52,RX,9),RFL=0
"RTN","PSOPMP1",129,0)
 F  S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  S REFREM=REFREM-1
"RTN","PSOPMP1",130,0)
 Q $S(REFREM<0:0,1:REFREM)
"RTN","PSOPMP1",131,0)
 ;
"RTN","PSOPMP1",132,0)
 ;
"RTN","PSOPMP1",133,0)
DAT(FMDT,SEP,Y4) ; - Formats FM dates to MM/DD/YY (SEP: Separator:"/","-",etc...)
"RTN","PSOPMP1",134,0)
 ;Input: (r) FMDT - Fileman Date
"RTN","PSOPMP1",135,0)
 ;       (r) SEP  - Separator
"RTN","PSOPMP1",136,0)
 ;       (o) Y4   - 4 digits year flag
"RTN","PSOPMP1",137,0)
 I $G(FMDT)="" Q ""
"RTN","PSOPMP1",138,0)
 I '$E(FMDT,6,7)!'$E(FMDT,4,7) Q $$UP^XLFSTR($TR($$FMTE^XLFDT(FMDT)," ","-"))
"RTN","PSOPMP1",139,0)
 Q ($E(FMDT,4,5)_SEP_$E(FMDT,6,7)_SEP_$S($G(Y4):$E(FMDT,1,3)+1700,1:$E(FMDT,2,3)))
"RTN","PSOPMP1",140,0)
 ;
"RTN","PSOPMP1",141,0)
COPAY(RX) ; Returns "$" is Rx has a copay and "" if not
"RTN","PSOPMP1",142,0)
 Q $S($G(^PSRX(RX,"IB")):"$",1:"")  ;*276
"RTN","PSOPMP1",143,0)
 ;
"RTN","PSOPMP1",144,0)
CMOP(DRUG,RX) ; Returns the CMOP indicator (">", "T", etc)
"RTN","PSOPMP1",145,0)
 N CMOP,X,DA,PSXZ
"RTN","PSOPMP1",146,0)
 S CMOP="" I $D(^PSDRUG("AQ",DRUG)) S CMOP=">"
"RTN","PSOPMP1",147,0)
 I $G(RX) S DA=RX D ^PSXOPUTL I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S CMOP="T"
"RTN","PSOPMP1",148,0)
 Q CMOP
"RTN","PSOPMP1",149,0)
 ;
"RTN","PSOPMP1",150,0)
ALLERGY(LINE,DFN,POS) ; also called from PSONVAVW & PSOPMP0
"RTN","PSOPMP1",151,0)
 ; Input:  LINE - (r) text to concatenate allergy information to
"RTN","PSOPMP1",152,0)
 ;         DFN - (r) patient IEN used for ^GMRADTP
"RTN","PSOPMP1",153,0)
 ;         POS - (o) position # to include text
"RTN","PSOPMP1",154,0)
 ;Output: LINE - modified text
"RTN","PSOPMP1",155,0)
 N ALLERGY,PSONOAL
"RTN","PSOPMP1",156,0)
 S (PSONOAL,ALLERGY)=""
"RTN","PSOPMP1",157,0)
 D EN1^GMRADPT
"RTN","PSOPMP1",158,0)
 I GMRAL S ALLERGY="<A>"
"RTN","PSOPMP1",159,0)
 E  D ALLERGY^PSOORUT2 I PSONOAL'="" S ALLERGY="<NO ALLERGY ASSESSMENT>"
"RTN","PSOPMP1",160,0)
 S ALLERGY=IORVON_ALLERGY_IORVOFF_IOINORM
"RTN","PSOPMP1",161,0)
 I '$G(POS) S POS=80-$L(ALLERGY)
"RTN","PSOPMP1",162,0)
 S LINE=$$SETSTR^VALM1(ALLERGY,LINE,POS,80)
"RTN","PSOPMP1",163,0)
 Q LINE
"RTN","PSOREF0")
0^4^B37449897^B36690483
"RTN","PSOREF0",1,0)
PSOREF0 ;IHS/JCM - REFILL CON'T ; 1/18/05 8:23am
"RTN","PSOREF0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**14,152,180,186,204,306,382**;DEC 1997;Build 9
"RTN","PSOREF0",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOREF0",4,0)
 ;
"RTN","PSOREF0",5,0)
 ;PSO*186 add check for DEA Special handling field refill restrictions
"RTN","PSOREF0",6,0)
PROCESS ;
"RTN","PSOREF0",7,0)
 K PSODF S PSOREF("RX0")=^PSRX(PSOREF("IRXN"),0),PSOREF("RX2")=^(2),PSOREF("RX3")=^(3),PSOREF("STA")=+$G(^("STA")),PSOREF("SIG")=$P($G(^("SIG")),"^"),PSOREF("PSODFN")=$P(PSOREF("RX0"),"^",2)
"RTN","PSOREF0",8,0)
 S PSOREF("DAYS SUPPLY")=$P(PSOREF("RX0"),"^",8)
"RTN","PSOREF0",9,0)
 I $D(PSORX("BAR CODE")),PSODFN'=PSOREF("PSODFN") D NEWPT
"RTN","PSOREF0",10,0)
 W !,"Now refilling Rx# ",$P(PSOREF("RX0"),"^")_"   Drug: "_$P(^PSDRUG($P(PSOREF("RX0"),"^",6),0),"^")
"RTN","PSOREF0",11,0)
 K ZD(PSOREF("IRXN"))   ;*306
"RTN","PSOREF0",12,0)
 S PSOREF("DFLG")=0 D DSPLY G:PSOREF("DFLG") PROCESSX
"RTN","PSOREF0",13,0)
 I $G(PSOHRC) S PSOREF("QS")="S",PSOREF("MAIL/WINDOW")="M",PSORX("MAIL/WINDOW")="M",PSOHRCF=1 K VALMHDR
"RTN","PSOREF0",14,0)
 D CHECK G:$G(PSODF) PROCESS G:PSOREF("DFLG") PROCESSX D EN^PSOR52(.PSOREF)
"RTN","PSOREF0",15,0)
 S:$G(PSOREF("MAIL/WINDOW"))["W" BINGRTE="W",BINGCRT=1
"RTN","PSOREF0",16,0)
PROCESSX D:$G(PSOREF("OLD FILL DATE"))]"" SUSDATEK^PSOUTIL(.PSOREF)
"RTN","PSOREF0",17,0)
 Q
"RTN","PSOREF0",18,0)
DSPLY ;W !!,$P(PSOREF("RX0"),"^"),?12," ",$P(^PSDRUG($P(PSOREF("RX0"),"^",6),0),"^"),?45," SIG: "_PSOREF("SIG"),?60," QTY: ",$P(PSOREF("RX0"),"^",7)
"RTN","PSOREF0",19,0)
 K FSIG,BSIG I $P($G(^PSRX(PSOREF("IRXN"),"SIG")),"^",2) D FSIG^PSOUTLA("R",PSOREF("IRXN"),54) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSOREF0",20,0)
 K FSIG,PSREV I '$P($G(^PSRX(PSOREF("IRXN"),"SIG")),"^",2) D EN2^PSOUTLA1(PSOREF("IRXN"),54)
"RTN","PSOREF0",21,0)
 W !!,"Qty: ",$P(PSOREF("RX0"),"^",7),?19,"Sig: ",$G(BSIG(1))
"RTN","PSOREF0",22,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?24,$G(BSIG(PSREV))
"RTN","PSOREF0",23,0)
 K BSIG,PSREV
"RTN","PSOREF0",24,0)
DSPLYX Q
"RTN","PSOREF0",25,0)
CHECK ;
"RTN","PSOREF0",26,0)
 I '$P(PSOPAR,"^",11),$G(^PSDRUG($P(PSOREF("RX0"),"^",6),"I"))]"",DT>$G(^("I")) D  G CKQ
"RTN","PSOREF0",27,0)
 .W $C(7),!!," *** Drug is inactive for Rx # "_$P(PSOREF("RX0"),"^")_" cannot be refilled ***",!
"RTN","PSOREF0",28,0)
 I '$D(PSORX("BAR CODE")),PSOREF("PSODFN")'=PSODFN W !!,?5,$C(7),"Can't refill Rx # "_$P(PSOREF("RX0"),"^")_", it is not for this patient." G CKQ
"RTN","PSOREF0",29,0)
 S (PSOX,PSOY,STA)=""
"RTN","PSOREF0",30,0)
 I $G(PSOSD) F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S PSOX=$O(PSOSD(STA,PSOX)) Q:PSOX']""!(PSOREF("DFLG"))  I PSOREF("IRXN")=+PSOSD(STA,PSOX) S PSOY=PSOSD(STA,PSOX) I $P(PSOY,"^",4)]"" D
"RTN","PSOREF0",31,0)
 . S PSOREF("DFLG")=1 W:'$G(PSOERR) !,$C(7),"Cannot refill Rx # "_$P(PSOREF("RX0"),"^") S PSOREA=$P(PSOY,"^",4),PSOSTAT=PSOREF("STA")
"RTN","PSOREF0",32,0)
 . D STATUS^PSOUTIL(PSOREA,PSOSTAT) K PSOREA,PSOSTAT
"RTN","PSOREF0",33,0)
 . Q
"RTN","PSOREF0",34,0)
 I PSOY="" W !,$C(7),"Cannot refill, Rx is discontinued or expired.  Later Rx may exist.",! D  I $G(PSODF) Q
"RTN","PSOREF0",35,0)
 .D LOOK^PSOREF2 I $G(PSODF) Q
"RTN","PSOREF0",36,0)
 .S PSOREF("DFLG")=1
"RTN","PSOREF0",37,0)
 K PSOX,PSOY G:PSOREF("DFLG") CHECKX
"RTN","PSOREF0",38,0)
 I $O(^PS(52.5,"B",PSOREF("IRXN"),0)),'$G(^PS(52.5,+$O(^PS(52.5,"B",PSOREF("IRXN"),0)),"P")) W !,$C(7),"Rx is in suspense and cannot be refilled" S PSOREF("DFLG")=1 G CHECKX
"RTN","PSOREF0",39,0)
 ;
"RTN","PSOREF0",40,0)
 S PSOREF("RXSTATUS")=PSOREF("STA")
"RTN","PSOREF0",41,0)
 I PSOREF("RXSTATUS"),PSOREF("RXSTATUS")'=6 D  G CHECKX
"RTN","PSOREF0",42,0)
 . S PSOY=";"_PSOREF("RXSTATUS"),PSOX=$P(^DD(52,100,0),"^",3),PSOY=$F(PSOX,PSOY),PSOY=$P($E(PSOX,PSOY,999),";",1)
"RTN","PSOREF0",43,0)
 . W !,$C(7),"Rx is in "_PSOY_" status, cannot be refilled" S PSOREF("DFLG")=1
"RTN","PSOREF0",44,0)
 D CHKDIV G:PSOREF("DFLG") CHECKX
"RTN","PSOREF0",45,0)
 D NUMBER I PSOREF("NUMBER")>$P(PSOREF("RX0"),"^",9) W !?5,"Can't refill, no refills remaining." S PSOREF("DFLG")=1 G CHECKX
"RTN","PSOREF0",46,0)
 ;
"RTN","PSOREF0",47,0)
 ;PSO*7*186  check DEA, SPEC HNDLG field, in case changed, and apply
"RTN","PSOREF0",48,0)
 N PSODRG,PSODEA,PSODAY
"RTN","PSOREF0",49,0)
 S PSODRG=$G(^PSDRUG($P(PSOREF("RX0"),U,6),0)),PSODEA=$P(PSODRG,U,3)
"RTN","PSOREF0",50,0)
 S PSODAY=$P(PSOREF("RX0"),U,8)
"RTN","PSOREF0",51,0)
 I $$DEACHK^PSOUTLA1(PSOREF("IRXN"),PSODEA,PSODAY) D  G CHECKX
"RTN","PSOREF0",52,0)
 . W $C(7),!!,"This drug has been changed, No refills allowed",!
"RTN","PSOREF0",53,0)
 . S PSOREF("DFLG")=1
"RTN","PSOREF0",54,0)
 ;
"RTN","PSOREF0",55,0)
 D DATES
"RTN","PSOREF0",56,0)
CHECKX Q
"RTN","PSOREF0",57,0)
CKQ ;
"RTN","PSOREF0",58,0)
 S PSOREF("DFLG")=1 D PAUSE^VALM1 G CHECKX
"RTN","PSOREF0",59,0)
 Q
"RTN","PSOREF0",60,0)
 ;
"RTN","PSOREF0",61,0)
CHKDIV G:$P(PSOREF("RX2"),"^",9)=+PSOSITE CHKDIVX
"RTN","PSOREF0",62,0)
 W !?5,$C(7),"RX # ",$P(PSOREF("RX0"),"^")," is for (",$P(^PS(59,$P(PSOREF("RX2"),"^",9),0),"^"),") division."
"RTN","PSOREF0",63,0)
 I '$P($G(PSOSYS),"^",2) S (PSOREF("DFLG"),PSOMHV)=1 W !,"********* Not Refilled *********" G CHKDIVX
"RTN","PSOREF0",64,0)
 D:$P($G(PSOSYS),"^",3) DIR
"RTN","PSOREF0",65,0)
CHKDIVX Q
"RTN","PSOREF0",66,0)
 ;
"RTN","PSOREF0",67,0)
NUMBER K PSOX,PSOY S PSOREF("# OF REFILLS")=0
"RTN","PSOREF0",68,0)
 I $G(^PSRX(PSOREF("IRXN"),1,0))]"" F PSOX=0:0 S PSOX=$O(^PSRX(PSOREF("IRXN"),1,PSOX)) Q:'PSOX  S PSOREF("# OF REFILLS")=PSOX
"RTN","PSOREF0",69,0)
 S PSOREF("NUMBER")=PSOREF("# OF REFILLS")+1
"RTN","PSOREF0",70,0)
 Q
"RTN","PSOREF0",71,0)
 ;
"RTN","PSOREF0",72,0)
DATES S PSOREF("STOP DATE")=$P(PSOREF("RX2"),"^",6) D NEXT^PSOUTIL(.PSOREF)
"RTN","PSOREF0",73,0)
 D:$G(PSOBBC("QFLG"))&($P(PSOPAR,"^",6)) EDATE Q:$G(PSOREF("DFLG"))
"RTN","PSOREF0",74,0)
 S PSOREF("FILL DATE")=$S($G(PSOREF("FILL DATE")):PSOREF("FILL DATE"),1:DT)
"RTN","PSOREF0",75,0)
 I $P(PSOPAR,"^",6),PSOREF("FILL DATE")<$P(PSOREF("RX3"),"^",2) D SUSDATE^PSOUTIL(.PSOREF)
"RTN","PSOREF0",76,0)
 ;
"RTN","PSOREF0",77,0)
 I PSOREF("FILL DATE")>PSOREF("STOP DATE") D
"RTN","PSOREF0",78,0)
 . W !!?5,$C(7),"Can't refill, Refill Date ",$E(PSOREF("FILL DATE"),4,5),"/",$E(PSOREF("FILL DATE"),6,7),"/"
"RTN","PSOREF0",79,0)
 . W $E(PSOREF("FILL DATE"),2,3)," is past Expiration Date ",$E(PSOREF("STOP DATE"),4,5),"/",$E(PSOREF("STOP DATE"),6,7),"/"
"RTN","PSOREF0",80,0)
 . W $E(PSOREF("STOP DATE"),2,3) S PSOREF("DFLG")=1
"RTN","PSOREF0",81,0)
EDATE S PSOREF("LAST REFILL DATE")=$P(PSOREF("RX3"),"^",1)
"RTN","PSOREF0",82,0)
 I PSOREF("LAST REFILL DATE"),PSOREF("FILL DATE")=PSOREF("LAST REFILL DATE") D  G DATESX
"RTN","PSOREF0",83,0)
 . W !?5,"Can't refill, Fill Date already exists for ",$E(PSOREF("FILL DATE"),4,5),"/",$E(PSOREF("FILL DATE"),6,7),"/",$E(PSOREF("FILL DATE"),2,3)
"RTN","PSOREF0",84,0)
 . S PSOREF("DFLG")=1
"RTN","PSOREF0",85,0)
 I PSOREF("LAST REFILL DATE"),PSOREF("FILL DATE")<PSOREF("LAST REFILL DATE") D  G DATESX
"RTN","PSOREF0",86,0)
 . W !?5,"Can't refill, later Refill Date already exists for ",$E(PSOREF("LAST REFILL DATE"),4,5),"/",$E(PSOREF("LAST REFILL DATE"),6,7),"/",$E(PSOREF("LAST REFILL DATE"),2,3)
"RTN","PSOREF0",87,0)
 . S PSOREF("DFLG")=1
"RTN","PSOREF0",88,0)
 I '$P(PSOPAR,"^",6),'$D(PSOREF("EAOK")),$P(PSOREF("RX3"),"^",2)>PSOREF("FILL DATE") D
"RTN","PSOREF0",89,0)
 . S PSOX1=(PSOREF("NUMBER")+1)*PSOREF("DAYS SUPPLY")-10
"RTN","PSOREF0",90,0)
 . W !?5,$C(7),"LESS THAN ",PSOX1," DAYS FOR ",PSOREF("NUMBER")+1," FILLS",! D DIR K PSOX1
"RTN","PSOREF0",91,0)
 I '$P(PSOPAR,"^",6),$G(PSOREF("EAOK"))=0,$P(PSOREF("RX3"),"^",2)>PSOREF("FILL DATE") D
"RTN","PSOREF0",92,0)
 . S Y=$P(PSOREF("RX3"),"^",2) D DD^%DT W !!,$C(7),"Cannot be refilled until "_Y_"." S (PSOREF("DFLG"),PSOMHV)=1 K Y
"RTN","PSOREF0",93,0)
DATESX Q
"RTN","PSOREF0",94,0)
DIR K DIR,X,Y S DIR(0)="Y",DIR("A")="Continue ",DIR("B")="N",DIR("?")="Answer YES to Refill, NO to bypass"
"RTN","PSOREF0",95,0)
 D ^DIR K DIR S:$D(DIRUT)!('Y) (PSOREF("DFLG"),PSOMHV)=1 K DIRUT,DTOUT,DUOUT,X,Y
"RTN","PSOREF0",96,0)
 Q
"RTN","PSOREF0",97,0)
NEWPT S PSOQFLG=0,(DFN,PSODFN)=PSOREF("PSODFN") D ^PSOPTPST I PSOQFLG S PSOREF("DFLG")=1,PSOQFLG=0 G NEWPTX
"RTN","PSOREF0",98,0)
 D PROFILE^PSOREF1
"RTN","PSOREF0",99,0)
NEWPTX Q
"RTN","PSOREF0",100,0)
 ;
"RTN","PSOREF0",101,0)
EN(PSOREF)         ; Entry Point for Batch Barcode Option
"RTN","PSOREF0",102,0)
 D PROCESS K DRUG,PSODF
"RTN","PSOREF0",103,0)
 Q
"VER")
8.0^22.0
"BLD",7994,6)
^319
**END**
**END**
