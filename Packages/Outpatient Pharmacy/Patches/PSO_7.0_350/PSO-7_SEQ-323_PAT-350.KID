Released PSO*7*350 SEQ #323
Extracted from mail message
**KIDS**:PSO*7.0*350^

**INSTALL NAME**
PSO*7.0*350
"BLD",7662,0)
PSO*7.0*350^OUTPATIENT PHARMACY^0^3100405^y
"BLD",7662,1,0)
^^4^4^3100219^
"BLD",7662,1,1,0)
When running menu option Signature Log Reprint [PSO SIGLOG REPRINT] or 
"BLD",7662,1,2,0)
the Speed option RS Reprint Sig Log no output is printed.
"BLD",7662,1,3,0)
It will also resolve an issue where a label that should print does not 
"BLD",7662,1,4,0)
and a label that should not be printed does.
"BLD",7662,4,0)
^9.64PA^^
"BLD",7662,6.3)
4
"BLD",7662,"ABPKG")
n
"BLD",7662,"KRN",0)
^9.67PA^779.2^20
"BLD",7662,"KRN",.4,0)
.4
"BLD",7662,"KRN",.401,0)
.401
"BLD",7662,"KRN",.402,0)
.402
"BLD",7662,"KRN",.403,0)
.403
"BLD",7662,"KRN",.5,0)
.5
"BLD",7662,"KRN",.84,0)
.84
"BLD",7662,"KRN",3.6,0)
3.6
"BLD",7662,"KRN",3.8,0)
3.8
"BLD",7662,"KRN",9.2,0)
9.2
"BLD",7662,"KRN",9.8,0)
9.8
"BLD",7662,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7662,"KRN",9.8,"NM",1,0)
PSOLLLH^^0^B33757537
"BLD",7662,"KRN",9.8,"NM",2,0)
PSOLLLHN^^0^B9196323
"BLD",7662,"KRN",9.8,"NM",3,0)
PSOLLL5^^0^B37326499
"BLD",7662,"KRN",9.8,"NM","B","PSOLLL5",3)

"BLD",7662,"KRN",9.8,"NM","B","PSOLLLH",1)

"BLD",7662,"KRN",9.8,"NM","B","PSOLLLHN",2)

"BLD",7662,"KRN",19,0)
19
"BLD",7662,"KRN",19.1,0)
19.1
"BLD",7662,"KRN",101,0)
101
"BLD",7662,"KRN",409.61,0)
409.61
"BLD",7662,"KRN",771,0)
771
"BLD",7662,"KRN",779.2,0)
779.2
"BLD",7662,"KRN",870,0)
870
"BLD",7662,"KRN",8989.51,0)
8989.51
"BLD",7662,"KRN",8989.52,0)
8989.52
"BLD",7662,"KRN",8994,0)
8994
"BLD",7662,"KRN","B",.4,.4)

"BLD",7662,"KRN","B",.401,.401)

"BLD",7662,"KRN","B",.402,.402)

"BLD",7662,"KRN","B",.403,.403)

"BLD",7662,"KRN","B",.5,.5)

"BLD",7662,"KRN","B",.84,.84)

"BLD",7662,"KRN","B",3.6,3.6)

"BLD",7662,"KRN","B",3.8,3.8)

"BLD",7662,"KRN","B",9.2,9.2)

"BLD",7662,"KRN","B",9.8,9.8)

"BLD",7662,"KRN","B",19,19)

"BLD",7662,"KRN","B",19.1,19.1)

"BLD",7662,"KRN","B",101,101)

"BLD",7662,"KRN","B",409.61,409.61)

"BLD",7662,"KRN","B",771,771)

"BLD",7662,"KRN","B",779.2,779.2)

"BLD",7662,"KRN","B",870,870)

"BLD",7662,"KRN","B",8989.51,8989.51)

"BLD",7662,"KRN","B",8989.52,8989.52)

"BLD",7662,"KRN","B",8994,8994)

"BLD",7662,"QDEF")
^^^^NO^^^^^^NO
"BLD",7662,"QUES",0)
^9.62^^
"BLD",7662,"REQB",0)
^9.611^1^1
"BLD",7662,"REQB",1,0)
PSO*7.0*321^2
"BLD",7662,"REQB","B","PSO*7.0*321",1)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
350^3100405
"PKG",141,22,1,"PAH",1,1,0)
^^4^4^3100405
"PKG",141,22,1,"PAH",1,1,1,0)
When running menu option Signature Log Reprint [PSO SIGLOG REPRINT] or 
"PKG",141,22,1,"PAH",1,1,2,0)
the Speed option RS Reprint Sig Log no output is printed.
"PKG",141,22,1,"PAH",1,1,3,0)
It will also resolve an issue where a label that should print does not 
"PKG",141,22,1,"PAH",1,1,4,0)
and a label that should not be printed does.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSOLLL5")
0^3^B37326499^B37231330
"RTN","PSOLLL5",1,0)
PSOLLL5 ;BIR/RJS - LASER LABEL CONTINUED ;11/14/05 10:09am
"RTN","PSOLLL5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,161,230,200,326,350**;DEC 1997;Build 4
"RTN","PSOLLL5",3,0)
 ;
"RTN","PSOLLL5",4,0)
START ;
"RTN","PSOLLL5",5,0)
 N TEXT,BLNKLIN
"RTN","PSOLLL5",6,0)
 S $P(BLNKLIN,"_",90)="_"
"RTN","PSOLLL5",7,0)
 D MAIL^PSOLLL7
"RTN","PSOLLL5",8,0)
 I $G(PSOIO("ACI"))]"" X PSOIO("ACI")
"RTN","PSOLLL5",9,0)
 S TEXT="HAS YOUR ADDRESS CHANGED?" D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSOLLL5",10,0)
 S OPSOX=PSOX,PSOX=4.2-L($E(PSOHFONT,2,99))*300/2+OPSOX
"RTN","PSOLLL5",11,0)
 S OFONT=PSOFONT,PSOFONT=$G(PSOHFONT,OFONT) D PRINT(TEXT,1) S PSOX=OPSOX,PSOY=PSOY+10,PSOFONT=OFONT
"RTN","PSOLLL5",12,0)
 S TEXT="Write address changes in the blanks, sign the form, and return to" D PRINT(TEXT,0)
"RTN","PSOLLL5",13,0)
 S TEXT="your pharmacy." D PRINT(TEXT,0)
"RTN","PSOLLL5",14,0)
 S X=$S($D(^DPT(DFN,0))#2:^(0),1:""),PNM=$P(X,"^")
"RTN","PSOLLL5",15,0)
 D PID^VADPT6,ADD^VADPT S SSNP=""
"RTN","PSOLLL5",16,0)
 S PSOY=PSOY+PSOYI,TEXT=PNM_"  "_SSNP D PRINT(TEXT,0)
"RTN","PSOLLL5",17,0)
 I $G(VAPA(1))="" G ALLERGY
"RTN","PSOLLL5",18,0)
 F I=1:1:3 I $G(VAPA(I))]"" S TEXT=$G(VAPA(I))_$E(BLNKLIN,1,80-$L(VAPA(I))) D PRINT(TEXT,0)
"RTN","PSOLLL5",19,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL5",20,0)
 S B=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSOLLL5",21,0)
 S TEXT=B_$E(BLNKLIN,1,80-$L(B)) D PRINT(TEXT,0)
"RTN","PSOLLL5",22,0)
 S B=VAPA(8)
"RTN","PSOLLL5",23,0)
 S TEXT=B_$E(BLNKLIN,1,80-$L(B)) D PRINT(TEXT,0)
"RTN","PSOLLL5",24,0)
 S:$G(VAPA(3))="" PSOY=PSOY+PSOYI
"RTN","PSOLLL5",25,0)
 S TEXT="[   ] Permanent                     [   ] Temporary until ____/____/____" D PRINT(TEXT,0)
"RTN","PSOLLL5",26,0)
 S PSOY=$G(PSOFY),TEXT="Signature "_$E(BLNKLIN,1,45) D PRINT(TEXT,0)
"RTN","PSOLLL5",27,0)
 ;
"RTN","PSOLLL5",28,0)
ALLERGY ;ALLERGIES & REACTIONS
"RTN","PSOLLL5",29,0)
 K ^TMP($J,"PSOALWA")
"RTN","PSOLLL5",30,0)
 S GMRA="0^0^111" D ^GMRADPT
"RTN","PSOLLL5",31,0)
 I $G(GMRAL) S PSORY=0 F  S PSORY=$O(GMRAL(PSORY)) Q:'PSORY  S ^TMP($J,"PSOALWA",$S($P(GMRAL(PSORY),"^",4):1,1:2),$S('$P(GMRAL(PSORY),"^",5):1,1:2),$P(GMRAL(PSORY),"^",7),$P(GMRAL(PSORY),"^",2))=""
"RTN","PSOLLL5",32,0)
 S ^TMP($J,"PSOAPT",1)=$G(PNM)_"  "_$G(SSNP),^(2)="Verified Allergies"
"RTN","PSOLLL5",33,0)
 S ALCNT=0,EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)=PSOLGA
"RTN","PSOLLL5",34,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)="NKA"
"RTN","PSOLLL5",35,0)
 S ALCNT=0,^TMP($J,"PSOAPT",3)="Non-Verified Allergies"
"RTN","PSOLLL5",36,0)
 S EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=EEE+1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)=PSOLGA
"RTN","PSOLLL5",37,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)="NKA"
"RTN","PSOLLL5",38,0)
 S ALCNT=0,^TMP($J,"PSOAPT",4)="Verified Adverse Reactions"
"RTN","PSOLLL5",39,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",4,ALCNT)=PSOLGA
"RTN","PSOLLL5",40,0)
 S ALCNT=0,^TMP($J,"PSOAPT",5)="Non-Verified Adverse Reactions"
"RTN","PSOLLL5",41,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",5,ALCNT)=PSOLGA
"RTN","PSOLLL5",42,0)
 I $G(PSOIO("ALI"))]"" X PSOIO("ALI")
"RTN","PSOLLL5",43,0)
 S XFONT=$E($G(PSOFONT),2,99)
"RTN","PSOLLL5",44,0)
 S OFONT=PSOFONT,PSOFONT=$G(PSOHFONT,PSOFONT) S TEXT=^TMP($J,"PSOAPT",1) D PRINT(TEXT,1) S PSOFONT=OFONT
"RTN","PSOLLL5",45,0)
 I $$GET1^DIQ(44,$P(RXY,"^",5),2,"I")="W" S TEXT="INPATIENT" D PRINT(TEXT,0)
"RTN","PSOLLL5",46,0)
 F CCC=3,4,5 I '$O(^TMP($J,"PSOAPT",CCC,0)) K ^TMP($J,"PSOAPT",CCC)
"RTN","PSOLLL5",47,0)
 D ASSESS
"RTN","PSOLLL5",48,0)
 I CCC="NKA" S ^TMP($J,"PSOAPT",2,1)="No Known Allergies" K ^TMP($J,"PSOAPT",3)
"RTN","PSOLLL5",49,0)
 S CCC=1,OUT=0
"RTN","PSOLLL5",50,0)
 F  S CCC=$O(^TMP($J,"PSOAPT",CCC)) Q:CCC=""  D  Q:OUT
"RTN","PSOLLL5",51,0)
 .S TEXT=$G(^TMP($J,"PSOAPT",CCC))
"RTN","PSOLLL5",52,0)
 .I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL5",53,0)
 .S PSOY=PSOY+PSOYI D PRINT(TEXT,0,1)
"RTN","PSOLLL5",54,0)
 .I TEXT="No Assessment Made" Q
"RTN","PSOLLL5",55,0)
 .I PSOY>PSOYM S OUT=1 Q
"RTN","PSOLLL5",56,0)
 .S (TEXT,PTEXT,CCC2)="",LENGTH=0
"RTN","PSOLLL5",57,0)
 .F  S CCC2=$O(^TMP($J,"PSOAPT",CCC,CCC2)) Q:CCC2=""  S TEXT=^(CCC2) D  Q:OUT
"RTN","PSOLLL5",58,0)
 ..D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSOLLL5",59,0)
 ..I LENGTH+L(XFONT)<3.7 S PTEXT=PTEXT_TEXT_",",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL5",60,0)
 ..I PTEXT="" D  Q
"RTN","PSOLLL5",61,0)
 ... F JJ=$L(TEXT):-1 S PTEXT=$E(TEXT,1,JJ) D STRT^PSOLLU1("SEC2",PTEXT,.L) I L(XFONT)<3.7 D PRINT(PTEXT,0) S PTEXT=$E(TEXT,JJ+1,512)_"," Q
"RTN","PSOLLL5",62,0)
 ... D STRT^PSOLLU1("SEC2",PTEXT,.L) S LENGTH=L(XFONT)
"RTN","PSOLLL5",63,0)
 ..S LENGTH=0,CCC2=CCC2-1
"RTN","PSOLLL5",64,0)
 ..I PSOY>PSOYM S OUT=1 Q
"RTN","PSOLLL5",65,0)
 ..D PRINT(PTEXT,0) S PTEXT=""
"RTN","PSOLLL5",66,0)
 .I 'OUT,PTEXT]"" D PRINT($P(PTEXT,",",1,$L(PTEXT,",")-1),0)
"RTN","PSOLLL5",67,0)
 I OUT S T="Additional Allergies or Adverse Reactions Exist." D PRINT(T,0) S T="Talk to your Physician or Pharmacist." D PRINT(T,0)
"RTN","PSOLLL5",68,0)
 K ^TMP($J,"PSOALWA"),^TMP($J,"PSOAPT"),PSONKA,PSONULL,WWW,GMRA,GMRAL,JJJ,WCNT,RRR,ALG,ALCNT,EEE,FFF,PSOLG,PSOLGA,PSORY,CCC,CCC2,FNTFLG,TEXT,TEXT2
"RTN","PSOLLL5",69,0)
SUSPEN S PSODFN=DFN,(SPPL,RXX,STA)="",XXS=1
"RTN","PSOLLL5",70,0)
 I $G(PSODTCUT)']"" S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X
"RTN","PSOLLL5",71,0)
 D ^PSOBUILD S (STA,RXX)=""
"RTN","PSOLLL5",72,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S RXX=$O(PSOSD(STA,RXX)) Q:RXX=""  I $P(PSOSD(STA,RXX),"^",2)=5 S SPPL=$P(PSOSD(STA,RXX),"^")_","_SPPL
"RTN","PSOLLL5",73,0)
 I SPPL="" Q
"RTN","PSOLLL5",74,0)
SUSP1 I $G(PSOIO("SPI"))]"" X PSOIO("SPI")
"RTN","PSOLLL5",75,0)
 S TOF=0,TEXT=PNM_" "_SSNP_" "_$G(PSONOW) D PRINT(TEXT,0)
"RTN","PSOLLL5",76,0)
 S TEXT="The following prescription(s) have been requested and will be" D PRINT(TEXT,0)
"RTN","PSOLLL5",77,0)
 S TEXT="mailed to you on or after the date indicated." D PRINT(TEXT,0)
"RTN","PSOLLL5",78,0)
 S PSOY=PSOY+PSOYI,TEXT="Rx#                                          Date                                        "
"RTN","PSOLLL5",79,0)
 D PRINT(TEXT,0,1)
"RTN","PSOLLL5",80,0)
 N RX
"RTN","PSOLLL5",81,0)
 F XX=XXS:1 Q:$P(SPPL,",",XX)=""  S RX=$P(SPPL,",",XX) D  Q:TOF
"RTN","PSOLLL5",82,0)
 . S SPNUM=$O(^PS(52.5,"B",RX,0)) I SPNUM S SPDATE=$P($G(^PS(52.5,SPNUM,0)),"^",2) S Y=SPDATE X ^DD("DD") S SPDATE=Y
"RTN","PSOLLL5",83,0)
 . S T=$P(^PSRX(RX,0),"^") D PRINT(T,0)
"RTN","PSOLLL5",84,0)
 . S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=PSOCX,T=$G(SPDATE) D PRINT(T,0)
"RTN","PSOLLL5",85,0)
 . S PSOX=OPSOX+20,T=$$ZZ^PSOSUTL(RX) D PRINT(T,0) K SPNUM,SPDATE,Y,ZDRUG
"RTN","PSOLLL5",86,0)
 . S PSOX=OPSOX,PSOY=PSOY+PSOYI
"RTN","PSOLLL5",87,0)
 . I PSOY>PSOYM S XXS=XX+1,TOF=1 W:$P(SPPL,",",XXS)]"" @IOF Q
"RTN","PSOLLL5",88,0)
 I TOF,$P(SPPL,",",XXS)]"" G SUSP1
"RTN","PSOLLL5",89,0)
 Q
"RTN","PSOLLL5",90,0)
PRINT(T,B,UL) ;
"RTN","PSOLLL5",91,0)
 S BOLD=$G(B),UL=$G(UL)
"RTN","PSOLLL5",92,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL5",93,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL5",94,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL5",95,0)
 I UL,$G(PSOIO("FWU"))]"" X PSOIO("FWU")
"RTN","PSOLLL5",96,0)
 W T,!
"RTN","PSOLLL5",97,0)
 I UL,$G(PSOIO("FDU"))]"" X PSOIO("FDU")
"RTN","PSOLLL5",98,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL5",99,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL5",100,0)
 Q
"RTN","PSOLLL5",101,0)
ASSESS ;
"RTN","PSOLLL5",102,0)
 N FLG3,FLG4,FLG5
"RTN","PSOLLL5",103,0)
 S CCC=$G(^TMP($J,"PSOAPT",2,1))
"RTN","PSOLLL5",104,0)
 S FLG3=$G(^TMP($J,"PSOAPT",3,1))
"RTN","PSOLLL5",105,0)
 S FLG4=$G(^TMP($J,"PSOAPT",4,1))
"RTN","PSOLLL5",106,0)
 S FLG5=$G(^TMP($J,"PSOAPT",5,1))
"RTN","PSOLLL5",107,0)
 I CCC="",FLG3="",FLG4="",FLG5="" S ^TMP($J,"PSOAPT",2,1)="No Assessment Made" K ^TMP($J,"PSOAPT",3)
"RTN","PSOLLL5",108,0)
 Q
"RTN","PSOLLLH")
0^1^B33757537^B33683705
"RTN","PSOLLLH",1,0)
PSOLLLH ;BIR/EJW - HIPAA/NCPDP LASER LABELS ;7/20/06 10:21am
"RTN","PSOLLLH",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**161,148,244,200,326,321,350**;DEC 1997;Build 4
"RTN","PSOLLLH",3,0)
 ;
"RTN","PSOLLLH",4,0)
 ;Reference to DUR1^BPSNCPD3 supported by DBIA 4560
"RTN","PSOLLLH",5,0)
 ;
"RTN","PSOLLLH",6,0)
 ;*244 ignore Rx status > 11
"RTN","PSOLLLH",7,0)
 ;
"RTN","PSOLLLH",8,0)
SIGLOG N PSOSEQ,J,RXF,RXY,RXN,RX,FIRST,DATE,BLNKLIN,RX2,FDT,BLNKLN2,LAST,CNT
"RTN","PSOLLLH",9,0)
 D DEM^VADPT
"RTN","PSOLLLH",10,0)
 S FIRST=1,LAST=0
"RTN","PSOLLLH",11,0)
 I '$G(REPRINT) D NOWINDOW I NOWIN Q
"RTN","PSOLLLH",12,0)
 K NOWIN
"RTN","PSOLLLH",13,0)
 S $P(BLNKLN2," ",32)=" "
"RTN","PSOLLLH",14,0)
 S $P(BLNKLIN,"_",32)="_"
"RTN","PSOLLLH",15,0)
 F PSOSEQ=1:1:$L(PPL,",") S RX=$P(PPL,",",PSOSEQ) D
"RTN","PSOLLLH",16,0)
 .I RX="" Q
"RTN","PSOLLLH",17,0)
 .Q:$G(^PSRX(RX,"STA"))>11                           ;*244
"RTN","PSOLLLH",18,0)
 .S RXY=$G(^PSRX(RX,0)) I RXY="" Q
"RTN","PSOLLLH",19,0)
 .I $P(RXY,"^",2)'=$G(DFN) Q  ;*321
"RTN","PSOLLLH",20,0)
 .S CNT=$G(CNT)+1
"RTN","PSOLLLH",21,0)
 .S RX2=$G(^PSRX(RX,2)),FDT=$P(RX2,"^",2)
"RTN","PSOLLLH",22,0)
 .I FIRST!(CNT#4=1) D HDR,BARC S FIRST=0
"RTN","PSOLLLH",23,0)
 .S RXF=+$O(^PSRX(RX,1,"A"),-1)
"RTN","PSOLLLH",24,0)
 .I RXF>0 I +^PSRX(RX,1,RXF,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLH",25,0)
 .S DATE=$E(FDT,1,7),Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSOLLLH",26,0)
 .S RXN=$P(RXY,"^")
"RTN","PSOLLLH",27,0)
 .S T=RXN_" ("_(RXF)_") "
"RTN","PSOLLLH",28,0)
 .N PSODRNM
"RTN","PSOLLLH",29,0)
 .S PSODRNM=$$ZZ^PSOSUTL(RX)
"RTN","PSOLLLH",30,0)
 .S T=T_$E(FDT,4,5)_"/"_$E(FDT,6,7)_"/"_$E(FDT,2,3)_" "_$E(PSODRNM,1,(27-$L(RXN))) D PRINT(T)
"RTN","PSOLLLH",31,0)
 S LAST=1 D SIGN
"RTN","PSOLLLH",32,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PSOLLLH",33,0)
 Q
"RTN","PSOLLLH",34,0)
 ;
"RTN","PSOLLLH",35,0)
SIGN ;
"RTN","PSOLLLH",36,0)
 I '$G(CNT) Q
"RTN","PSOLLLH",37,0)
 N II
"RTN","PSOLLLH",38,0)
 S II=CNT#4
"RTN","PSOLLLH",39,0)
 I LAST,II>0 F J=1:1:(4-II) S T=" " D PRINT(T)
"RTN","PSOLLLH",40,0)
 S PSOY=PSOY+10
"RTN","PSOLLLH",41,0)
 S T="Pt. Sig."_BLNKLIN D PRINT(T)
"RTN","PSOLLLH",42,0)
 S PSOY=PSOY+5
"RTN","PSOLLLH",43,0)
 D PRINT($$PLANNM())
"RTN","PSOLLLH",44,0)
 S PSOY=PSOY+15
"RTN","PSOLLLH",45,0)
 S T="Relation_____ Counseling Refused__ Accepted__" D PRINT(T)
"RTN","PSOLLLH",46,0)
 S PSOY=PSOY+10
"RTN","PSOLLLH",47,0)
 S T=PNM_"  "_$G(SSNP) D PRINT(T,1)
"RTN","PSOLLLH",48,0)
 Q
"RTN","PSOLLLH",49,0)
 ;
"RTN","PSOLLLH",50,0)
HDR ;
"RTN","PSOLLLH",51,0)
 I 'FIRST D SIGN W @IOF
"RTN","PSOLLLH",52,0)
 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSOLLLH",53,0)
 S T="VAMC "_$P(PS,"^",7)_", "_STATE_" "_$G(PSOHZIP) D PRINT(T)
"RTN","PSOLLLH",54,0)
 S T=$P(PS2,"^",2)_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4)_"       "_$G(PSONOW) D PRINT(T)
"RTN","PSOLLLH",55,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSOLLLH",56,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLLH",57,0)
 N REPMSG
"RTN","PSOLLLH",58,0)
 S REPMSG=BLNKLN2_"(REPRINT)"
"RTN","PSOLLLH",59,0)
 S T="By signing below"_$S($G(REPRINT):REPMSG,1:"") D PRINT(T,1)
"RTN","PSOLLLH",60,0)
 S T="you acknowledge receipt of the following Rx's" D PRINT(T,1)
"RTN","PSOLLLH",61,0)
 S T=" " D PRINT(T)
"RTN","PSOLLLH",62,0)
 S PSOY=PSOY-20
"RTN","PSOLLLH",63,0)
 Q
"RTN","PSOLLLH",64,0)
 ;
"RTN","PSOLLLH",65,0)
PRINT(T,B) ;
"RTN","PSOLLLH",66,0)
 S BOLD=$G(B)
"RTN","PSOLLLH",67,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLLH",68,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLLH",69,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLLH",70,0)
 W T,!
"RTN","PSOLLLH",71,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLLH",72,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLLH",73,0)
 Q
"RTN","PSOLLLH",74,0)
 ;
"RTN","PSOLLLH",75,0)
QUEUE ; ENTRY POINT TO REPRINT SIGNATURE LOG
"RTN","PSOLLLH",76,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) Q
"RTN","PSOLLLH",77,0)
 N REPRINT,PS,STATE,PS2,PSOHZIP
"RTN","PSOLLLH",78,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLLH",79,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLH",80,0)
 I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLLH",81,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLLH",82,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLLH",83,0)
 S REPRINT=1
"RTN","PSOLLLH",84,0)
LRP W !! S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")<10",DIC="^PSRX(",DIC("A")="Reprint Signature Log for Prescription: ",DIC(0)="QEAZ" D ^DIC K P,DIC("A") I Y<0!("^"[X) D KILL Q
"RTN","PSOLLLH",85,0)
 W !
"RTN","PSOLLLH",86,0)
 S (PPL,RX)=+Y
"RTN","PSOLLLH",87,0)
 N RXY
"RTN","PSOLLLH",88,0)
 S RXY=$G(^PSRX(RX,0)) I RXY="" Q
"RTN","PSOLLLH",89,0)
 S DFN=$P(RXY,"^",2)
"RTN","PSOLLLH",90,0)
GETPT2 D DEM^VADPT S PNM=VADM(1)
"RTN","PSOLLLH",91,0)
 I $P(VADM(6),"^",2)]"" D  G LRP
"RTN","PSOLLLH",92,0)
 .W $C(7),!!,PNM_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSOLLLH",93,0)
 D 6^VADPT,PID^VADPT6 S SSNP=""
"RTN","PSOLLLH",94,0)
Q1 W ! K POP,ZTSK S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A")
"RTN","PSOLLLH",95,0)
 I $G(POP) Q
"RTN","PSOLLLH",96,0)
 I $G(IOST(0)),'$D(^%ZIS(2,IOST(0),55,"B","LL")) W !,"Must specify a laser labels printer for Signature Log Reprint" G Q1
"RTN","PSOLLLH",97,0)
 I '$G(IOST(0)) W !,"Nothing queued to print." H 1 Q
"RTN","PSOLLLH",98,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y
"RTN","PSOLLLH",99,0)
 F G="PPL","REPRINT","PNM","STATE","PS2","PSOHZIP","PSOPAR","PSOSITE","PS","PSONOW","PSOSYS","SSNP","DFN" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOLLLH",100,0)
 S ZTRTN="DQ^PSOLLLH",ZTIO=PSLION,ZTDESC="Outpatient Pharmacy Signature Log Reprint",ZTDTH=$H,PDUZ=DUZ
"RTN","PSOLLLH",101,0)
 D ^%ZISC,^%ZTLOAD W:$D(ZTSK) !!,"Signature Log Reprint queued",!! H 1 K G
"RTN","PSOLLLH",102,0)
 G QUEUE
"RTN","PSOLLLH",103,0)
 Q
"RTN","PSOLLLH",104,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLH",105,0)
 I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLLH",106,0)
 G SIGLOG
"RTN","PSOLLLH",107,0)
 ;
"RTN","PSOLLLH",108,0)
PLANNM() ; Returns Insurance Name (3rd Party)
"RTN","PSOLLLH",109,0)
 S PLANNM=""
"RTN","PSOLLLH",110,0)
 N I,DUR,RX
"RTN","PSOLLLH",111,0)
 F I=1:1:$L(PPL,",") S RX=+$P(PPL,",",I) D  I PLANNM'="" Q
"RTN","PSOLLLH",112,0)
 .I 'RX Q
"RTN","PSOLLLH",113,0)
 .D DUR1^BPSNCPD3(RX,$$LSTRFL^PSOBPSU1(RX),.DUR) S PLANNM=$G(DUR(1,"INSURANCE NAME"))
"RTN","PSOLLLH",114,0)
 Q PLANNM
"RTN","PSOLLLH",115,0)
BARC I '$G(FIRST) G BARCE ; PRINT BARCODE FOR 1 RX ON 1ST SIGLOG LABEL ONLY
"RTN","PSOLLLH",116,0)
 I $G(PSOIO("BLBC"))]"" X PSOIO("BLBC") I $G(NOBARC) G BARCE
"RTN","PSOLLLH",117,0)
 I '$D(PSOINST) D INST
"RTN","PSOLLLH",118,0)
 S X2=PSOINST_"-"_RX W X2
"RTN","PSOLLLH",119,0)
 I $G(PSOIO("EBLBC"))]"" X PSOIO("EBLBC")
"RTN","PSOLLLH",120,0)
BARCE Q
"RTN","PSOLLLH",121,0)
 ;
"RTN","PSOLLLH",122,0)
KILL ; CLEAN UP VARIABLES
"RTN","PSOLLLH",123,0)
 K DIC,DFN,PNM,PPL,PSZIP,RX,SSNP,VA,VADDR1,VADM,VAEL,VAPA,VASTREET
"RTN","PSOLLLH",124,0)
 Q
"RTN","PSOLLLH",125,0)
INST ;
"RTN","PSOLLLH",126,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOLLLH",127,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I"))
"RTN","PSOLLLH",128,0)
 K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLLLH",129,0)
 Q
"RTN","PSOLLLH",130,0)
 ;
"RTN","PSOLLLH",131,0)
NOWINDOW ; ON ORIGINAL PRINT - DON'T PRINT IF ALL ARE MAIL
"RTN","PSOLLLH",132,0)
 N I,RX,RXF,MW,RXP,RXY
"RTN","PSOLLLH",133,0)
 S NOWIN=1
"RTN","PSOLLLH",134,0)
 F I=1:1:$L(PPL,",") S RX=$P(PPL,",",I) D  I 'NOWIN Q
"RTN","PSOLLLH",135,0)
 .I RX="" Q
"RTN","PSOLLLH",136,0)
 .I $G(^PSRX(RX,"STA"))>11 Q
"RTN","PSOLLLH",137,0)
 .S RXY=$G(^PSRX(RX,0)) I RXY="" Q
"RTN","PSOLLLH",138,0)
 .I '$D(^PSRX(RX,1)) S MW=$P(RXY,"^",11) I MW="W" S NOWIN=0 Q
"RTN","PSOLLLH",139,0)
 .S RXF=$O(^PSRX(RX,1,99),-1) I RXF>0 S MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) I MW="W" S NOWIN=0
"RTN","PSOLLLH",140,0)
 .S RXP=$O(^PSRX(RX,"P",99),-1) I RXP>0 S MW=$P($G(^PSRX(RX,"P",RXP,0)),"^",2) I MW="W" S NOWIN=0
"RTN","PSOLLLH",141,0)
 Q
"RTN","PSOLLLHN")
0^2^B9196323^B9141187
"RTN","PSOLLLHN",1,0)
PSOLLLHN ;BIR/SJA - HIPAA/NCPDP LASER LABELS ;2/21/07 10:21am
"RTN","PSOLLLHN",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**200,268,326,350**;DEC 1997;Build 4
"RTN","PSOLLLHN",3,0)
 ;
"RTN","PSOLLLHN",4,0)
 ;*244 ignore Rx status > 11
"RTN","PSOLLLHN",5,0)
 ;
"RTN","PSOLLLHN",6,0)
ST ; ENTRY POINT TO SPEED SIGNATURE LOG REPRINT
"RTN","PSOLLLHN",7,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) Q
"RTN","PSOLLLHN",8,0)
 N REPRINT,PS,STATE,PS2,PSOHZIP,PSODISP,PSOOELSE,PSOIEN,VALMCNT
"RTN","PSOLLLHN",9,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLLHN",10,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLHN",11,0)
 I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLLHN",12,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLLHN",13,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLLHN",14,0)
 D 6^VADPT,PID^VADPT6 S SSNP=""
"RTN","PSOLLLHN",15,0)
 S REPRINT=1
"RTN","PSOLLLHN",16,0)
 I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOLLLHN",17,0)
OS K DIR,DUOUT,DIRUT S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR S LST=Y I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" Q
"RTN","PSOLLLHN",18,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,PSOREPX I '+LST D KILL S VALMBCK="" Q
"RTN","PSOLLLHN",19,0)
 S PSOOELSE=1 D FULL^VALM1
"RTN","PSOLLLHN",20,0)
Q1 K POP,ZTSK S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A")
"RTN","PSOLLLHN",21,0)
 I $G(POP) S VALMBCK="R",VALMSG="No Labels Reprinted." Q
"RTN","PSOLLLHN",22,0)
 I $G(IOST(0)),'$D(^%ZIS(2,IOST(0),55,"B","LL")) W !,"Must specify a laser labels printer for Signature Log Reprint" G Q1
"RTN","PSOLLLHN",23,0)
 I '$G(IOST(0)) S VALMBCK="R",VALMSG="Nothing queued to print." Q
"RTN","PSOLLLHN",24,0)
 D DEM^VADPT S PNM=VADM(1)
"RTN","PSOLLLHN",25,0)
 I $P(VADM(6),"^",2)]"" D  G OS
"RTN","PSOLLLHN",26,0)
 .W $C(7),!!,PNM_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSOLLLHN",27,0)
 S PPL="" F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""  S ORN=$P(LST,",",ORD),PSOIEN=$P(PSOLST(ORN),"^",2) D
"RTN","PSOLLLHN",28,0)
 .I '$P($G(^PSRX(PSOIEN,0)),"^",2)!($G(^("STA"),"^")>11) Q
"RTN","PSOLLLHN",29,0)
 .I $P($G(^PSRX(PSOIEN,0)),"^",2) S PPL=$S(PPL:PPL_",",1:"")_PSOIEN
"RTN","PSOLLLHN",30,0)
 .S VALMBCK="R"
"RTN","PSOLLLHN",31,0)
 I +PPL D QUEUE W:$D(ZTSK) !!,"Signature Log Reprint queued",!! H 1
"RTN","PSOLLLHN",32,0)
 I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSOLLLHN",33,0)
 D ^PSOBUILD
"RTN","PSOLLLHN",34,0)
 D KILL D KVA^VADPT
"RTN","PSOLLLHN",35,0)
 Q
"RTN","PSOLLLHN",36,0)
QUEUE D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y
"RTN","PSOLLLHN",37,0)
 F G="PPL","REPRINT","PNM","STATE","PS2","PSOHZIP","PSOPAR","PSOSITE","PS","PSONOW","PSOSYS","RX","SSNP","DFN" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOLLLHN",38,0)
 S ZTRTN="DQ^PSOLLLH",ZTIO=PSLION,ZTDESC="Outpatient Pharmacy Signature Log Reprint",ZTDTH=$H,PDUZ=DUZ
"RTN","PSOLLLHN",39,0)
 D ^%ZISC,^%ZTLOAD K G
"RTN","PSOLLLHN",40,0)
 Q
"RTN","PSOLLLHN",41,0)
 ;
"RTN","PSOLLLHN",42,0)
KILL ; CLEAN UP VARIABLES
"RTN","PSOLLLHN",43,0)
 K DIC,LST,ORD,ORN,PSOIEN,PNM,PPL,PSZIP,RX,SSNP,VA,VADDR1,VADM,VAEL,VAPA,VASTREET
"RTN","PSOLLLHN",44,0)
 Q
"VER")
8.0^22.0
"BLD",7662,6)
^323
**END**
**END**
