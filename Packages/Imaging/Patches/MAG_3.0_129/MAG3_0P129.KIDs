KIDS Distribution saved on May 10, 2013@13:00:31
VistA Imaging V3.0 Patch 129 - Clinical Capture Accusoft Version Update Maintenance - 05/10/2013 01:00PM
**KIDS**:MAG*3.0*129^

**INSTALL NAME**
MAG*3.0*129
"BLD",3463,0)
MAG*3.0*129^IMAGING^0^3130510^y
"BLD",3463,1,0)
^^10^10^3130510
"BLD",3463,1,1,0)
VistA Imaging V3.0 Patch 129 - Clinical Capture Accusoft Version Update Maintenance
"BLD",3463,1,2,0)
 
"BLD",3463,1,3,0)
 
"BLD",3463,1,4,0)
Routines:
"BLD",3463,1,5,0)
MAGGNTI    new value = 78486431
"BLD",3463,1,6,0)
MAGGTU4C    new value = 5332367
"BLD",3463,1,7,0)
MAGIP129    new value = 4237639
"BLD",3463,1,8,0)
 
"BLD",3463,1,9,0)
Please note that routine MAGIP129 is deleted after the KIDS Build is
"BLD",3463,1,10,0)
installed.
"BLD",3463,4,0)
^9.64PA^^0
"BLD",3463,6.3)
V3.0p129Build4607_T18
"BLD",3463,"ABNS",0)
^9.66A^^
"BLD",3463,"ABPKG")
n^n^G.IMAGING DEVELOPMENT TEAM@DOMAIN.EXT
"BLD",3463,"INI")
PRE^MAGIP129
"BLD",3463,"INID")
n^y^y
"BLD",3463,"INIT")
POS^MAGIP129
"BLD",3463,"KRN",0)
^9.67PA^8994^19
"BLD",3463,"KRN",.4,0)
.4
"BLD",3463,"KRN",.401,0)
.401
"BLD",3463,"KRN",.402,0)
.402
"BLD",3463,"KRN",.403,0)
.403
"BLD",3463,"KRN",.5,0)
.5
"BLD",3463,"KRN",.84,0)
.84
"BLD",3463,"KRN",3.6,0)
3.6
"BLD",3463,"KRN",3.8,0)
3.8
"BLD",3463,"KRN",9.2,0)
9.2
"BLD",3463,"KRN",9.8,0)
9.8
"BLD",3463,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",3463,"KRN",9.8,"NM",1,0)
MAGGNTI^^0^B78486431
"BLD",3463,"KRN",9.8,"NM",2,0)
MAGGTU4C^^0^B5332367
"BLD",3463,"KRN",9.8,"NM",3,0)
MAGIP129^^0^B4237639
"BLD",3463,"KRN",9.8,"NM","B","MAGGNTI",1)

"BLD",3463,"KRN",9.8,"NM","B","MAGGTU4C",2)

"BLD",3463,"KRN",9.8,"NM","B","MAGIP129",3)

"BLD",3463,"KRN",19,0)
19
"BLD",3463,"KRN",19.1,0)
19.1
"BLD",3463,"KRN",101,0)
101
"BLD",3463,"KRN",409.61,0)
409.61
"BLD",3463,"KRN",771,0)
771
"BLD",3463,"KRN",870,0)
870
"BLD",3463,"KRN",8989.51,0)
8989.51
"BLD",3463,"KRN",8989.52,0)
8989.52
"BLD",3463,"KRN",8994,0)
8994
"BLD",3463,"KRN","B",.4,.4)

"BLD",3463,"KRN","B",.401,.401)

"BLD",3463,"KRN","B",.402,.402)

"BLD",3463,"KRN","B",.403,.403)

"BLD",3463,"KRN","B",.5,.5)

"BLD",3463,"KRN","B",.84,.84)

"BLD",3463,"KRN","B",3.6,3.6)

"BLD",3463,"KRN","B",3.8,3.8)

"BLD",3463,"KRN","B",9.2,9.2)

"BLD",3463,"KRN","B",9.8,9.8)

"BLD",3463,"KRN","B",19,19)

"BLD",3463,"KRN","B",19.1,19.1)

"BLD",3463,"KRN","B",101,101)

"BLD",3463,"KRN","B",409.61,409.61)

"BLD",3463,"KRN","B",771,771)

"BLD",3463,"KRN","B",870,870)

"BLD",3463,"KRN","B",8989.51,8989.51)

"BLD",3463,"KRN","B",8989.52,8989.52)

"BLD",3463,"KRN","B",8994,8994)

"BLD",3463,"REQB",0)
^9.611^1^1
"BLD",3463,"REQB",1,0)
MAG*3.0*122^2
"BLD",3463,"REQB","B","MAG*3.0*122",1)

"INI")
PRE^MAGIP129
"INIT")
POS^MAGIP129
"MBREQ")
0
"PKG",454,-1)
1^1
"PKG",454,0)
IMAGING^MAG^Imaging Release History
"PKG",454,22,0)
^9.49I^1^1
"PKG",454,22,1,0)
3.0^3020328^3020328^.5
"PKG",454,22,1,"PAH",1,0)
129^3130510^.5
"PKG",454,22,1,"PAH",1,1,0)
^9.49011^9^9^3130510
"PKG",454,22,1,"PAH",1,1,1,0)
Routines for Patch 129, Test Build 18.
"PKG",454,22,1,"PAH",1,1,2,0)
 
"PKG",454,22,1,"PAH",1,1,3,0)
Routines:
"PKG",454,22,1,"PAH",1,1,4,0)
MAGGNTI    value = 16501984
"PKG",454,22,1,"PAH",1,1,5,0)
MAGGTU4C    value = 3613451
"PKG",454,22,1,"PAH",1,1,6,0)
MAGIP129    value = 2888745
"PKG",454,22,1,"PAH",1,1,7,0)
 
"PKG",454,22,1,"PAH",1,1,8,0)
Please note that routine MAGIP129 is deleted after the KIDS Build is
"PKG",454,22,1,"PAH",1,1,9,0)
installed.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","MAGGNTI")
0^1^B78486431
"RTN","MAGGNTI",1,0)
MAGGNTI ;WOIFO/GEK/SG/NST/JSL - Imaging interface to TIU RPC Calls etc. ; 20 Jan 2010 10:08 AM
"RTN","MAGGNTI",2,0)
 ;;3.0;IMAGING;**10,8,59,93,108,122,129**;Mar 19, 2002;Build 4607;May 10, 2013
"RTN","MAGGNTI",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGGNTI",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGNTI",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGNTI",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGNTI",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGNTI",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGNTI",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGNTI",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGNTI",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGNTI",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGNTI",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGNTI",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGNTI",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGNTI",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGNTI",17,0)
 ;;
"RTN","MAGGNTI",18,0)
 Q
"RTN","MAGGNTI",19,0)
FILE(MAGRY,MAGDA,TIUDA) ;RPC [MAG3 TIU IMAGE]
"RTN","MAGGNTI",20,0)
 ; Call to file TIU and Imaging Pointers
"RTN","MAGGNTI",21,0)
 ; TIU API to add image to TIU
"RTN","MAGGNTI",22,0)
 N X
"RTN","MAGGNTI",23,0)
 ;Patch 108
"RTN","MAGGNTI",24,0)
 ; Create a new TIU note if TIUDA equals zero
"RTN","MAGGNTI",25,0)
 I (TIUDA=0),'$$SETTIUDA(.MAGRY,MAGDA,.TIUDA) Q
"RTN","MAGGNTI",26,0)
 I $P(^TIU(8925,TIUDA,0),U,2)'=$P(^MAG(2005,MAGDA,0),U,7) S MAGRY="0^Patient Mismatch." Q
"RTN","MAGGNTI",27,0)
 D PUTIMAGE^TIUSRVPL(.MAGRY,TIUDA,MAGDA) ;
"RTN","MAGGNTI",28,0)
 I 'MAGRY Q
"RTN","MAGGNTI",29,0)
 ; Now SET the Parent fields in the Image File
"RTN","MAGGNTI",30,0)
 S $P(^MAG(2005,MAGDA,2),U,6,8)=8925_U_TIUDA_U_+MAGRY
"RTN","MAGGNTI",31,0)
 ; DONE.
"RTN","MAGGNTI",32,0)
 S MAGRY="1^Image pointer filed successfully"
"RTN","MAGGNTI",33,0)
 ; Now we save the PARENT ASSOCIATION Date/Time 
"RTN","MAGGNTI",34,0)
 D LINKDT^MAGGTU6(.X,MAGDA)
"RTN","MAGGNTI",35,0)
 Q
"RTN","MAGGNTI",36,0)
DATA(MAGRY,TIUDA) ;RPC [MAG3 TIU DATA FROM DA]
"RTN","MAGGNTI",37,0)
 ; Call to get TIU data from the TIUDA
"RTN","MAGGNTI",38,0)
 ; MAGRY: returns data from fields .01,1201,.02,1202 , .05
"RTN","MAGGNTI",39,0)
 ;           .01            1201         .02   1202 
"RTN","MAGGNTI",40,0)
 ;    TIUDA^Document Type ^Document Date^DFN^Author DUZ^Status
"RTN","MAGGNTI",41,0)
 ;
"RTN","MAGGNTI",42,0)
 ;  - old code
"RTN","MAGGNTI",43,0)
 ;S MAGRY=TIUDA_U_$$GET1^DIQ(8925,TIUDA,".01","E")_U_$$GET1^DIQ(8925,TIUDA,"1201","I")_U_$$GET1^DIQ(8925,TIUDA,".02","I")_U_$$GET1^DIQ(8925,TIUDA,"1202","I")_U
"RTN","MAGGNTI",44,0)
 ;
"RTN","MAGGNTI",45,0)
 ;P122 we need 1 if Status is Complete 0 otherwise. Status is field .05
"RTN","MAGGNTI",46,0)
 ; reformat code for easier reading, and add the 1 or 0 as 6th piece.
"RTN","MAGGNTI",47,0)
 ;
"RTN","MAGGNTI",48,0)
 N RES,CDA,ST
"RTN","MAGGNTI",49,0)
 D GETS^DIQ(8925,TIUDA,".01;1201;.02;1202;.05","EI","RES")
"RTN","MAGGNTI",50,0)
 I '$D(RES) S MAGRY="" Q  ;no TIU data
"RTN","MAGGNTI",51,0)
 S CDA=TIUDA_","
"RTN","MAGGNTI",52,0)
 S $P(MAGRY,U,1)=TIUDA
"RTN","MAGGNTI",53,0)
 S $P(MAGRY,U,2)=RES(8925,CDA,".01","E") ; Document Type
"RTN","MAGGNTI",54,0)
 S $P(MAGRY,U,3)=RES(8925,CDA,"1201","I") ;Document Date
"RTN","MAGGNTI",55,0)
 S $P(MAGRY,U,4)=RES(8925,CDA,".02","I") ;DFN
"RTN","MAGGNTI",56,0)
 S $P(MAGRY,U,5)=RES(8925,CDA,"1202","I") ;Author DUZ
"RTN","MAGGNTI",57,0)
 ; P122 Return Status  as 6th piece of Result String
"RTN","MAGGNTI",58,0)
 S $P(MAGRY,U,6)=RES(8925,CDA,".05","E") ; Status
"RTN","MAGGNTI",59,0)
 S $P(MAGRY,U,7)="" ; future
"RTN","MAGGNTI",60,0)
 S $P(MAGRY,U,8)=$$ISADDNDM^TIULC1(TIUDA) ;    NEW FOR 129T12
"RTN","MAGGNTI",61,0)
 S $P(MAGRY,U,9)="" ;  put's "^" on end of string.
"RTN","MAGGNTI",62,0)
 Q
"RTN","MAGGNTI",63,0)
IMAGES(MAGRY,TIUDA) ;RPC [MAG3 CPRS TIU NOTE]
"RTN","MAGGNTI",64,0)
 ; Call to get all images for a given TIU DA
"RTN","MAGGNTI",65,0)
 ; We first get all Image IEN's breaking groups into separate images
"RTN","MAGGNTI",66,0)
 ; Then get Image Info for each one.
"RTN","MAGGNTI",67,0)
 ; MAGRY    -     Return array of Image Data entries
"RTN","MAGGNTI",68,0)
 ; MAGRY(0)    is   1 ^ message  if successful
"RTN","MAGGNTI",69,0)
 ;                  0 ^ Error message if error;
"RTN","MAGGNTI",70,0)
 ; TIUDA  is IEN in ^TIU(8925
"RTN","MAGGNTI",71,0)
 ;
"RTN","MAGGNTI",72,0)
 ; Call TIU API to get list of Image IEN's
"RTN","MAGGNTI",73,0)
 N MAGARR,CT,TCT,I,J,Z K ^TMP($J,"MAGGX")
"RTN","MAGGNTI",74,0)
 N DA,MAGQI,MAGNCHK,MAGXX,MAGRSLT
"RTN","MAGGNTI",75,0)
 N TIUDFN,MAGQUIT ; MAGQI 8/22/01
"RTN","MAGGNTI",76,0)
 N MAGFILE ; MAGFILE is returned from MAGGTII
"RTN","MAGGNTI",77,0)
 ; 
"RTN","MAGGNTI",78,0)
 S MAGQUIT=0 ; MAGQI 8/22/01
"RTN","MAGGNTI",79,0)
 S TIUDFN=$P($G(^TIU(8925,TIUDA,0)),U,2) ;MAGQI 8/22/01
"RTN","MAGGNTI",80,0)
 I 'TIUDFN S MAGRY(0)="0^Invalid Patient DFN for Note ID: '"_TIUDA_"'"
"RTN","MAGGNTI",81,0)
 D GETILST^TIUSRVPL(.MAGARR,TIUDA)
"RTN","MAGGNTI",82,0)
 S CT=0,TCT=0
"RTN","MAGGNTI",83,0)
 ; Now get all images for all groups and single images.
"RTN","MAGGNTI",84,0)
 S I="" F  S I=$O(MAGARR(I)) Q:'I  S DA=MAGARR(I) D  ;Q:MAGQUIT
"RTN","MAGGNTI",85,0)
 . S Z=$$ISDELIMG(DA) I Z S TCT=TCT+1,MAGRY(TCT)="B2^"_Z Q
"RTN","MAGGNTI",86,0)
 . ; Check that array of images from selected TIUDA have 
"RTN","MAGGNTI",87,0)
 . ;     same patient's and valid backward pointers
"RTN","MAGGNTI",88,0)
 . I $P($G(^MAG(2005,DA,0)),U,7)'=TIUDFN S MAGQUIT=1,MAGNCHK="Patient Mismatch. TIU: "_TIUDA
"RTN","MAGGNTI",89,0)
 . I $P($G(^MAG(2005,DA,2)),U,7)'=TIUDA S MAGQUIT=1,MAGNCHK="Pointer Mismatch. TIU: "_TIUDA
"RTN","MAGGNTI",90,0)
 . I MAGQUIT S MAGXX=DA,MAGFILE=$$INFO^MAGGAII(MAGXX,"E") D  Q  ; D INFO^MAGGTII 
"RTN","MAGGNTI",91,0)
 . . ; remove the Abstract and Image File Names  ; 2/14/03 p8t14  remove c:\program files.  with   .\bmp\
"RTN","MAGGNTI",92,0)
 . . S $P(MAGFILE,U,2,3)="-1~Questionable Data Integrity^.\bmp\imageQA.bmp"
"RTN","MAGGNTI",93,0)
 . . ;this stops Delphi App from changing Abstract BMP to OFFLINE IMAGE
"RTN","MAGGNTI",94,0)
 . . S $P(MAGFILE,U,6)=$S(($P(MAGFILE,U,6)'=11):"99",1:11)
"RTN","MAGGNTI",95,0)
 . . S $P(MAGFILE,U,10)="M"
"RTN","MAGGNTI",96,0)
 . . ;Send the error message
"RTN","MAGGNTI",97,0)
 . . S $P(MAGFILE,U,17)=MAGNCHK
"RTN","MAGGNTI",98,0)
 . . S TCT=TCT+1,MAGRY(TCT)="B2^"_MAGFILE
"RTN","MAGGNTI",99,0)
 . ;
"RTN","MAGGNTI",100,0)
 . I $O(^MAG(2005,DA,1,0)) D  Q
"RTN","MAGGNTI",101,0)
 . . ; Integrity check, if group is questionable, add it's ien to list, not it's 
"RTN","MAGGNTI",102,0)
 . . ;   children.  Later when list is looped through, it's $$INFO^MAGGAII(MAGXX,"E") will be in 
"RTN","MAGGNTI",103,0)
 . . ;   list.  Have to do this to allow other images in list from TIU to be processed.
"RTN","MAGGNTI",104,0)
 . . D CHK^MAGGSQI(.MAGQI,DA) I 'MAGQI(0) S CT=CT+1,^TMP($J,"MAGGX",CT)=DA Q
"RTN","MAGGNTI",105,0)
 . . S J=0 ; the following line needs to take only the first piece of the node - PMK 4/4/02
"RTN","MAGGNTI",106,0)
 . . F  S J=$O(^MAG(2005,DA,1,J)) Q:'J  S CT=CT+1,^TMP($J,"MAGGX",CT)=$P(^(J,0),"^")
"RTN","MAGGNTI",107,0)
 . S CT=CT+1
"RTN","MAGGNTI",108,0)
 . S ^TMP($J,"MAGGX",CT)=DA
"RTN","MAGGNTI",109,0)
 ; Now get image info for each image
"RTN","MAGGNTI",110,0)
 ;
"RTN","MAGGNTI",111,0)
 S Z=""
"RTN","MAGGNTI",112,0)
 S MAGQUIET=1
"RTN","MAGGNTI",113,0)
 F  S Z=$O(^TMP($J,"MAGGX",Z)) Q:Z=""  D
"RTN","MAGGNTI",114,0)
 . S TCT=TCT+1,MAGXX=^TMP($J,"MAGGX",Z)
"RTN","MAGGNTI",115,0)
 . ;GEK 8/24/00 Stopping the Invalid Image IEN's and Deleted Images
"RTN","MAGGNTI",116,0)
 . I '$D(^MAG(2005,MAGXX)) D  Q
"RTN","MAGGNTI",117,0)
 . . D INVALID^MAGGTIG(MAGXX,.MAGRSLT) S MAGRY(CT)=MAGRSLT
"RTN","MAGGNTI",118,0)
 . ;D INFO^MAGGTII
"RTN","MAGGNTI",119,0)
 . S MAGFILE=$$INFO^MAGGAII(MAGXX,"E")
"RTN","MAGGNTI",120,0)
 . S MAGRY(TCT)="B2^"_MAGFILE
"RTN","MAGGNTI",121,0)
 K MAGQUIET
"RTN","MAGGNTI",122,0)
 S MAGRY(0)=TCT_"^"_TCT_" Images for the selected TIU NOTE"
"RTN","MAGGNTI",123,0)
 ; Put the Image IEN of the last image into the group IEN field.
"RTN","MAGGNTI",124,0)
 Q:'TCT
"RTN","MAGGNTI",125,0)
 S $P(MAGRY(0),U,3)=TIUDA
"RTN","MAGGNTI",126,0)
 K MAGRSLT
"RTN","MAGGNTI",127,0)
 D DATA(.MAGRSLT,TIUDA)
"RTN","MAGGNTI",128,0)
 S $P(MAGRY(0),U,4)=$$GET1^DIQ(8925,TIUDA,".02","E")_"  "_$P(MAGRSLT,U,2)_"  "_$$FMTE^XLFDT($P(MAGRSLT,U,3),"8")
"RTN","MAGGNTI",129,0)
 ;
"RTN","MAGGNTI",130,0)
 S $P(MAGRY(0),U,5)=$S($P($G(MAGFILE),U):$P(MAGFILE,U),$G(MAGXX):MAGXX,1:0)
"RTN","MAGGNTI",131,0)
 Q
"RTN","MAGGNTI",132,0)
 ;
"RTN","MAGGNTI",133,0)
ISDELIMG(MAGIEN) ; Is this a deleted Image.
"RTN","MAGGNTI",134,0)
 N ERR,MAGR,MAGT,Z
"RTN","MAGGNTI",135,0)
 ;--- Check the image status
"RTN","MAGGNTI",136,0)
 I '$$ISDEL^MAGGI11(MAGIEN,.ERR)  D  Q:$G(MAGT)="" MAGR
"RTN","MAGGNTI",137,0)
 . I ERR'<0    S MAGR="0^Valid Image"  Q
"RTN","MAGGNTI",138,0)
 . I +ERR=-43  S MAGR="0^Image IEN exists, and is Deleted !"  Q
"RTN","MAGGNTI",139,0)
 . S MAGR="Invalid Image pointer",MAGT=67
"RTN","MAGGNTI",140,0)
 . Q
"RTN","MAGGNTI",141,0)
 E  S MAGR="Deleted Image",MAGT=66
"RTN","MAGGNTI",142,0)
 ;--- Special processing for deleted images and errors
"RTN","MAGGNTI",143,0)
 S $P(Z,U,1,4)=MAGIEN_U_"-1~"_MAGR_U_"-1~"_MAGR_U_MAGR
"RTN","MAGGNTI",144,0)
 S $P(Z,U,6)=MAGT
"RTN","MAGGNTI",145,0)
 ;--- This stops client from changing Abstract BMP to OFFLINE IMAGE
"RTN","MAGGNTI",146,0)
 S $P(Z,U,10)="M"
"RTN","MAGGNTI",147,0)
 ;--- Return the error message
"RTN","MAGGNTI",148,0)
 S $P(Z,U,17)=$P(MAGR,U,2)
"RTN","MAGGNTI",149,0)
 Q Z
"RTN","MAGGNTI",150,0)
 ;
"RTN","MAGGNTI",151,0)
ISDOCCL(MAGRY,IEN,TIUFILE,CLASS) ;RPC [MAGG IS DOC CLASS]
"RTN","MAGGNTI",152,0)
 ;Checks to see if IEN of TIU Files 8925 or 8925.1 is of a certain Doc Class 
"RTN","MAGGNTI",153,0)
 ;MAGRY  = Return String  
"RTN","MAGGNTI",154,0)
 ;                 for Success   "1^message"
"RTN","MAGGNTI",155,0)
 ;                 for Failure   "0^message"
"RTN","MAGGNTI",156,0)
 ;IEN    = Internal Entry Number in the TIUFILE
"RTN","MAGGNTI",157,0)
 ;TIUFILE = either 8925   if we need to see if a Note is of a Document Class 
"RTN","MAGGNTI",158,0)
 ;            or   8925.1 if we need to see if a Title is of a Document Class
"RTN","MAGGNTI",159,0)
 ;CLASS  = Text Name of the Document Class   example: "ADVANCE DIRECTIVE"
"RTN","MAGGNTI",160,0)
 ;
"RTN","MAGGNTI",161,0)
 S MAGRY="0^Unknown Error checking TIU Document Class"
"RTN","MAGGNTI",162,0)
 K MAGTRGT,DEFIEN,DOCCL,RES,DONE,NTTL
"RTN","MAGGNTI",163,0)
 S DONE=0
"RTN","MAGGNTI",164,0)
 ; If we're resolving a Title
"RTN","MAGGNTI",165,0)
 I TIUFILE="8925.1" D  Q:DONE
"RTN","MAGGNTI",166,0)
 . S DEFIEN=IEN,NTTL="Title"
"RTN","MAGGNTI",167,0)
 . I '$D(^TIU(8925.1,DEFIEN,0)) S MAGRY="0^Invalid Title IEN",DONE=1 Q
"RTN","MAGGNTI",168,0)
 . Q
"RTN","MAGGNTI",169,0)
 ; If we're resolving a Note
"RTN","MAGGNTI",170,0)
 I TIUFILE="8925" D  Q:DONE
"RTN","MAGGNTI",171,0)
 . S NTTL="Note"
"RTN","MAGGNTI",172,0)
 . I '$D(^TIU(8925,IEN)) S MAGRY="0^Invalid Note IEN",DONE=1 Q
"RTN","MAGGNTI",173,0)
 . ; Get Title IEN from Note IEN
"RTN","MAGGNTI",174,0)
 . S DEFIEN=$$GET1^DIQ(8925,IEN_",",.01,"I")
"RTN","MAGGNTI",175,0)
 . I DEFIEN="" S MAGRY="0^Error resolving Document Class from Note IEN" S DONE=1 Q
"RTN","MAGGNTI",176,0)
 . Q
"RTN","MAGGNTI",177,0)
 ;
"RTN","MAGGNTI",178,0)
 ; Find the IEN in 8925.1 for Document Class (CLASS) 
"RTN","MAGGNTI",179,0)
 D FIND^DIC(8925.1,"","@;.001","X",CLASS,"","","I $P(^(0),U,4)=""DC""","","MAGTRGT")
"RTN","MAGGNTI",180,0)
 S DOCCL=$G(MAGTRGT("DILIST",2,1))
"RTN","MAGGNTI",181,0)
 ;
"RTN","MAGGNTI",182,0)
 ; See if ^TIU(8925.1,DEFIEN is of Document Class DOCCL
"RTN","MAGGNTI",183,0)
 S RES=$$ISA^TIULX(DEFIEN,DOCCL)
"RTN","MAGGNTI",184,0)
 I RES S MAGRY="1^The "_NTTL_" is of Document Class "_CLASS Q
"RTN","MAGGNTI",185,0)
 S MAGRY="0^The "_NTTL_" is Not of Document Class "_CLASS
"RTN","MAGGNTI",186,0)
 Q
"RTN","MAGGNTI",187,0)
 ;
"RTN","MAGGNTI",188,0)
 ; *******************
"RTN","MAGGNTI",189,0)
 ; Patch 108
"RTN","MAGGNTI",190,0)
 ; Create a new TIU stub using data in ^MAG(2006.82 by Tracking ID
"RTN","MAGGNTI",191,0)
 ; In this way BP doesn't need to be recompiled
"RTN","MAGGNTI",192,0)
 ;
"RTN","MAGGNTI",193,0)
 ; Return Values
"RTN","MAGGNTI",194,0)
 ; =============
"RTN","MAGGNTI",195,0)
 ;  0 for failure
"RTN","MAGGNTI",196,0)
 ;  1 for success
"RTN","MAGGNTI",197,0)
 ;  
"RTN","MAGGNTI",198,0)
 ;  MAGRY 
"RTN","MAGGNTI",199,0)
 ;     for failure   "0^message"
"RTN","MAGGNTI",200,0)
 ;     for success   "TIU Note IEN^message"
"RTN","MAGGNTI",201,0)
 ;  TIUDA - TIU Note IEN
"RTN","MAGGNTI",202,0)
 ;   
"RTN","MAGGNTI",203,0)
 ; Input Parameters
"RTN","MAGGNTI",204,0)
 ; ================
"RTN","MAGGNTI",205,0)
 ;  MAGDA - Image IEN in file #2005
"RTN","MAGGNTI",206,0)
 ; 
"RTN","MAGGNTI",207,0)
SETTIUDA(MAGRY,MAGDA,TIUDA) ;
"RTN","MAGGNTI",208,0)
 N TRKID,TIUTTL,TIUTCNT
"RTN","MAGGNTI",209,0)
 N MAGTEXT,MAGDFN,MAGADCL,MAGMODE,MAGES,MAGESBY,MAGDATE
"RTN","MAGGNTI",210,0)
 N MAGIAPI,TIUIEN
"RTN","MAGGNTI",211,0)
 S TRKID=$$GET1^DIQ(2005,MAGDA,"108")  ; Tracking ID - it is unique
"RTN","MAGGNTI",212,0)
 I TRKID="" S MAGRY="0^TIUDA equals zero and Tracking ID is not found." Q 0
"RTN","MAGGNTI",213,0)
 ; Get import data
"RTN","MAGGNTI",214,0)
 D GETIAPID^MAGGSIUI(.MAGIAPI,TRKID)
"RTN","MAGGNTI",215,0)
 I '$D(MAGIAPI) S MAGRY="0^TIUDA equals zero and no data found by Tracking ID." Q 0  ; no data quit
"RTN","MAGGNTI",216,0)
 S TIUTTL=$G(MAGIAPI("PXTIUTTL")) ; Get TIU Title
"RTN","MAGGNTI",217,0)
 ; Validate TIU Title
"RTN","MAGGNTI",218,0)
 I '$$GETTIUDA^MAGGSIV(.MAGRY,TIUTTL,.TIUIEN) Q 0
"RTN","MAGGNTI",219,0)
 S TIUTTL=TIUIEN  ; set TIUTTL to internal TIU Title in case the external value is provided
"RTN","MAGGNTI",220,0)
 ; Get Text
"RTN","MAGGNTI",221,0)
 S TIUTCNT=+$G(MAGIAPI("PXTIUTCNT"))  ; TIU note Text Lines Count
"RTN","MAGGNTI",222,0)
 F I=0:1:TIUTCNT-1 D
"RTN","MAGGNTI",223,0)
 . S MAGTEXT(I)=$G(MAGIAPI("PXTIUTXT"_$TR($J(I,5)," ",0)))  ; Get Text Lines
"RTN","MAGGNTI",224,0)
 . Q
"RTN","MAGGNTI",225,0)
 S MAGTEXT(TIUTCNT)="   VistA Imaging Import API - Imported Document"
"RTN","MAGGNTI",226,0)
 S MAGDFN=$$GET1^DIQ(2005,MAGDA,"5","I")  ; Patient DFN
"RTN","MAGGNTI",227,0)
 S MAGADCL=+$G(MAGIAPI("PXSGNTYP"))  ; Signature Type - 0 unsigned/ 1 Admin closed/ 2 Signed
"RTN","MAGGNTI",228,0)
 S MAGMODE="E"
"RTN","MAGGNTI",229,0)
 S MAGES=""
"RTN","MAGGNTI",230,0)
 S MAGESBY=$$GET1^DIQ(2005,MAGDA,"8","I")   ; Image Capture by ( Signed)
"RTN","MAGGNTI",231,0)
 S MAGDATE=$G(MAGIAPI("PXDT")) ; TIU note Date
"RTN","MAGGNTI",232,0)
 ; Create a new TIU note
"RTN","MAGGNTI",233,0)
 D NEW^MAGGNTI1(.MAGRY,MAGDFN,TIUTTL,MAGADCL,MAGMODE,MAGES,MAGESBY,"",MAGDATE,"",.MAGTEXT)
"RTN","MAGGNTI",234,0)
 I $P(MAGRY,"^") S TIUDA=+MAGRY  D UPDPKG^MAGGNTI(MAGDA,TIUDA) Q 1
"RTN","MAGGNTI",235,0)
 Q 0
"RTN","MAGGNTI",236,0)
 ;
"RTN","MAGGNTI",237,0)
 ; *******************
"RTN","MAGGNTI",238,0)
 ; Patch 108
"RTN","MAGGNTI",239,0)
 ; Update Package Index (#40) in #2005 based on TIU Note info.
"RTN","MAGGNTI",240,0)
 ; 
"RTN","MAGGNTI",241,0)
 ; Input Parameters
"RTN","MAGGNTI",242,0)
 ; ================
"RTN","MAGGNTI",243,0)
 ;  MAGDA - Image IEN in file #2005
"RTN","MAGGNTI",244,0)
 ;  PXIEN - TIU Note IEN in file #8925
"RTN","MAGGNTI",245,0)
 ;
"RTN","MAGGNTI",246,0)
UPDPKG(MAGDA,PXIEN) ;Patch 108: Update Package Index (#40) in #2005 based on TIU Note info.
"RTN","MAGGNTI",247,0)
 N PKG,MAGRY,OK,MAGGFDA,MAGGXE,MAGNOFMAUDIT
"RTN","MAGGNTI",248,0)
 S PKG=$$GET1^DIQ(2005,MAGDA_",",40)
"RTN","MAGGNTI",249,0)
 I PKG'="NONE" Q  ; Quit if the package is already set to something else than "NONE"
"RTN","MAGGNTI",250,0)
 S PKG=""
"RTN","MAGGNTI",251,0)
 D DATA^MAGGNTI(.MAGRY,PXIEN)
"RTN","MAGGNTI",252,0)
 D ISCP^TIUCP(.OK,$P(MAGRY,U,2)) I OK S PKG="CP"
"RTN","MAGGNTI",253,0)
 I PKG="" D ISCNSLT^TIUCNSLT(.OK,$P(MAGRY,U,2)) I OK S PKG="CONS"
"RTN","MAGGNTI",254,0)
 I PKG="" S PKG="NOTE"
"RTN","MAGGNTI",255,0)
 S MAGGFDA(2005,MAGDA_",",40)=PKG
"RTN","MAGGNTI",256,0)
 S MAGNOFMAUDIT=1  ; Do not file the changes in Audit file.
"RTN","MAGGNTI",257,0)
 ;                   We are not done with initial setup
"RTN","MAGGNTI",258,0)
 D UPDATE^DIE("","MAGGFDA","","MAGGXE")
"RTN","MAGGNTI",259,0)
 Q
"RTN","MAGGTU4C")
0^2^B5332367
"RTN","MAGGTU4C",1,0)
MAGGTU4C ;WOIFO/SG/NST/JSL - VERSION CONTROL (CLINICAL CAPTURE) ; 08 Mar 2011 2:52 PM
"RTN","MAGGTU4C",2,0)
 ;;3.0;IMAGING;**93,94,106,117,122,129**;Mar 19, 2002;Build 4607;May 10, 2013
"RTN","MAGGTU4C",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGGTU4C",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU4C",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGGTU4C",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGGTU4C",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGGTU4C",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGGTU4C",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGGTU4C",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGGTU4C",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGGTU4C",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGGTU4C",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGGTU4C",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGGTU4C",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGGTU4C",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGGTU4C",17,0)
 ;;
"RTN","MAGGTU4C",18,0)
 ; This routine contains the version control code and data specific
"RTN","MAGGTU4C",19,0)
 ; to the Clinical Capture application. DO NOT ADD ANYTHING ELSE!
"RTN","MAGGTU4C",20,0)
 Q
"RTN","MAGGTU4C",21,0)
 ;
"RTN","MAGGTU4C",22,0)
 ; Build 3 changed to match client.
"RTN","MAGGTU4C",23,0)
CLVERCT ;***** VERSION CONTROL TABLE FOR THE CLINICAL CAPTURE CLIENTS
"RTN","MAGGTU4C",24,0)
 ;;==================================================================
"RTN","MAGGTU4C",25,0)
 ;;| Version |Build|Seq #|                Comment                   |
"RTN","MAGGTU4C",26,0)
 ;;|---------+-----+------------------------------------------------|
"RTN","MAGGTU4C",27,0)
 ;;| 3.0.129 |  18 |  60 | Apr 2013                                 |
"RTN","MAGGTU4C",28,0)
 ;;| 3.0.122 |  15 |  55 | Nov 2012                                 |
"RTN","MAGGTU4C",29,0)
 ;;| 3.0.117 |   8 |  45 | Jul 2011                                 |
"RTN","MAGGTU4C",30,0)
 ;;| 3.0.106 |  13 |  40 | Feb 2011                                 |
"RTN","MAGGTU4C",31,0)
 ;;| 3.0.94  |  12 |  35 | May 2010                                 |
"RTN","MAGGTU4C",32,0)
 ;;==================================================================
"RTN","MAGGTU4C",33,0)
 ;
"RTN","MAGGTU4C",34,0)
 ; Each row of the version control table contains the version and
"RTN","MAGGTU4C",35,0)
 ; build number of a supported client. Released patches must also
"RTN","MAGGTU4C",36,0)
 ; indicate the sequential numbers.
"RTN","MAGGTU4C",37,0)
 ;
"RTN","MAGGTU4C",38,0)
 ; Sort order of the rows does not matter. However, the reversed
"RTN","MAGGTU4C",39,0)
 ; order of patch sequential numbers is recommended.
"RTN","MAGGTU4C",40,0)
 ;
"RTN","MAGGTU4C",41,0)
 Q
"RTN","MAGGTU4C",42,0)
 ;
"RTN","MAGGTU4C",43,0)
 ;***** ADDS A CLIENT-SPECIFIC WARNING (IF NECESSARY)
"RTN","MAGGTU4C",44,0)
 ;
"RTN","MAGGTU4C",45,0)
 ; .MAGBUF       Reference to a local array that the warning text
"RTN","MAGGTU4C",46,0)
 ;               is returned to. It is appended to the RPC result
"RTN","MAGGTU4C",47,0)
 ;               array by the caller (WARNING^MAGGTU41).
"RTN","MAGGTU4C",48,0)
 ;
"RTN","MAGGTU4C",49,0)
 ; CLVER         Client application version (Major.Minor.Patch.Build)
"RTN","MAGGTU4C",50,0)
 ;
"RTN","MAGGTU4C",51,0)
 ; CVRC          Version check code returned by the $$CHKVER1^MAGGTU41
"RTN","MAGGTU4C",52,0)
 ;
"RTN","MAGGTU4C",53,0)
 ; Notes
"RTN","MAGGTU4C",54,0)
 ; =====
"RTN","MAGGTU4C",55,0)
 ;
"RTN","MAGGTU4C",56,0)
 ; If the RPC result array already contains an error message that
"RTN","MAGGTU4C",57,0)
 ; will terminate the client, application, this procedure is not
"RTN","MAGGTU4C",58,0)
 ; called.
"RTN","MAGGTU4C",59,0)
 ;
"RTN","MAGGTU4C",60,0)
WARNING(MAGBUF,CLVER,CVRC) ;
"RTN","MAGGTU4C",61,0)
 Q
"RTN","MAGIP129")
0^3^B4237639
"RTN","MAGIP129",1,0)
MAGIP129 ;WOIFO/GEK - INSTALL CODE FOR MAG*3.0*129 Capture ; 11 Jun 2012 11:15 AM
"RTN","MAGIP129",2,0)
 ;;3.0;IMAGING;**129**;Mar 19, 2002;Build 4607;May 10, 2013
"RTN","MAGIP129",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MAGIP129",4,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP129",5,0)
 ;; | Property of the US Government.                                |
"RTN","MAGIP129",6,0)
 ;; | No permission to copy or redistribute this software is given. |
"RTN","MAGIP129",7,0)
 ;; | Use of unreleased versions of this software requires the user |
"RTN","MAGIP129",8,0)
 ;; | to execute a written test agreement with the VistA Imaging    |
"RTN","MAGIP129",9,0)
 ;; | Development Office of the Department of Veterans Affairs,     |
"RTN","MAGIP129",10,0)
 ;; | telephone (301) 734-0100.                                     |
"RTN","MAGIP129",11,0)
 ;; | The Food and Drug Administration classifies this software as  |
"RTN","MAGIP129",12,0)
 ;; | a medical device.  As such, it may not be changed in any way. |
"RTN","MAGIP129",13,0)
 ;; | Modifications to this software may result in an adulterated   |
"RTN","MAGIP129",14,0)
 ;; | medical device under 21CFR820, the use of which is considered |
"RTN","MAGIP129",15,0)
 ;; | to be a violation of US Federal Statutes.                     |
"RTN","MAGIP129",16,0)
 ;; +---------------------------------------------------------------+
"RTN","MAGIP129",17,0)
 ;;
"RTN","MAGIP129",18,0)
 ; There are no environment checks here but the MAGIP129 has to be
"RTN","MAGIP129",19,0)
 ; referenced by the "Environment Check Routine" field of the KIDS
"RTN","MAGIP129",20,0)
 ; build so that entry points of the routine are available to the
"RTN","MAGIP129",21,0)
 ; KIDS during all installation phases.
"RTN","MAGIP129",22,0)
 ;
"RTN","MAGIP129",23,0)
 Q
"RTN","MAGIP129",24,0)
 ;
"RTN","MAGIP129",25,0)
 ;+++++ INSTALLATION ERROR HANDLING
"RTN","MAGIP129",26,0)
ERROR ;
"RTN","MAGIP129",27,0)
 S:$D(XPDNM) XPDABORT=1
"RTN","MAGIP129",28,0)
 ;--- Display the messages and store them to the INSTALL file
"RTN","MAGIP129",29,0)
 D DUMP^MAGUERR1(),ABTMSG^MAGKIDS()
"RTN","MAGIP129",30,0)
 Q
"RTN","MAGIP129",31,0)
 ;
"RTN","MAGIP129",32,0)
 ;***** POST-INSTALL CODE
"RTN","MAGIP129",33,0)
POS ;
"RTN","MAGIP129",34,0)
 N CALLBACK
"RTN","MAGIP129",35,0)
 D CLEAR^MAGUERR(1)
"RTN","MAGIP129",36,0)
 ;
"RTN","MAGIP129",37,0)
 ;--- Link new remote procedures to the Broker context option
"RTN","MAGIP129",38,0)
 ;S CALLBACK="$$ADDRPCS^"_$NA(MAGKIDS1("RPCLST^"_$T(+0),"MAG WINDOWS"))
"RTN","MAGIP129",39,0)
 ;I $$CP^MAGKIDS("MAG ATTACH RPCS",CALLBACK)<0  D ERROR  Q
"RTN","MAGIP129",40,0)
 ;
"RTN","MAGIP129",41,0)
 ;
"RTN","MAGIP129",42,0)
 ;--- Misc Updates
"RTN","MAGIP129",43,0)
 ;I $$CP^MAGKIDS("MAG 129 MISC UPDATES ","$$UPDATE^"_$T(+0))<0  D ERROR Q
"RTN","MAGIP129",44,0)
 ;
"RTN","MAGIP129",45,0)
 ;--- Send the notification e-mail
"RTN","MAGIP129",46,0)
 D BMES^XPDUTL("Post Install Mail Message: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP129",47,0)
 D INS^MAGQBUT4(XPDNM,DUZ,$$NOW^XLFDT,XPDA)
"RTN","MAGIP129",48,0)
 ;
"RTN","MAGIP129",49,0)
 Q
"RTN","MAGIP129",50,0)
 ;
"RTN","MAGIP129",51,0)
 ;***** PRE-INSTALL CODE
"RTN","MAGIP129",52,0)
PRE ;
"RTN","MAGIP129",53,0)
 Q
"RTN","MAGIP129",54,0)
 ;
"RTN","MAGIP129",55,0)
 ;+++++ LIST OF NEW REMOTE PROCEDURES
"RTN","MAGIP129",56,0)
 ; have a list in format ;;MAG4 IMAGE LIST
"RTN","MAGIP129",57,0)
RPCLST ;
"RTN","MAGIP129",58,0)
 ;
"RTN","MAGIP129",59,0)
 Q 0
"RTN","MAGIP129",60,0)
 ;
"VER")
8.0^22.0
**END**
**END**
;I $$CP^MAGKIDS("MAG ATTACH RPCS",CALLBACK)<0  D ERROR  Q
"RTN","MAGIP129",40,0)
 ;
"RTN","MAGIP129",41,0)
 ;
"RTN","MAGIP129",42,0)
 ;--- Misc Updates
"RTN","MAGIP129",43,0)
 ;I $$CP^MAGKIDS("MAG 129 MISC UPDATES ","$$UPDATE^"_$T(+0))<0  D ERROR Q
"RTN","MAGIP129",44,0)
 ;
"RTN","MAGIP129",45,0)
 ;--- Send the notification e-mail
"RTN","MAGIP129",46,0)
 D BMES^XPDUTL("Post Install Mail Message: "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","MAGIP129",47,0)
 D INS^MAGQBUT4(XPDNM,DUZ,$$NOW^XLFDT,XPDA)
"RTN","MAGIP129",48,0)
 ;
"RTN","MAGIP129",49,0)
 Q
"RTN","MAGIP129",50,0)
 ;
"RTN","MAGIP129",51,0)
 ;***** PRE-INSTALL CODE
"RTN","MAGIP129",52,0)
PRE ;
"RTN","MAGIP129",53,0)
 Q
"RTN","MAGIP129",54,0)
 ;
"RTN","MAGIP129",55,0)
 ;+++++ LIST OF NEW REMOTE PROCEDURES
"RTN","MAGIP129",56,0)
 ; have a list in format ;;MAG4 IMAGE LIST
"RTN","MAGIP129",57,0)
RPCLST ;
"RTN","MAGIP129",58,0)
 ;
"RTN","MAGIP129",59,0)
 Q 0
"RTN","MAGIP129",60,0)
 ;
"VER")
8.0^22.0
**END**
**END**
