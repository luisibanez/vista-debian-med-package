Released RMPR*3*163 SEQ #148
Extracted from mail message
**KIDS**:RMPR*3.0*163^

**INSTALL NAME**
RMPR*3.0*163
"BLD",7739,0)
RMPR*3.0*163^PROSTHETICS^0^3111115^y
"BLD",7739,1,0)
^^10^10^3111115^^^
"BLD",7739,1,1,0)
1. Cannot link patient record to Suspense:
"BLD",7739,1,2,0)
   a. When select patients appearing on the GUI Delayed Order
"BLD",7739,1,3,0)
      Report.
"BLD",7739,1,4,0)
 
"BLD",7739,1,5,0)
   b. After selecting patient, current issue item does not display.
"BLD",7739,1,6,0)
 
"BLD",7739,1,7,0)
2. Report 'Print Item Usage By Location' fails to print due to a missing 
"BLD",7739,1,8,0)
   HCPCS item reference.
"BLD",7739,1,9,0)
 
"BLD",7739,1,10,0)
3. Prosthetics GUI error when displaying Delayed Order Report (DOR)
"BLD",7739,4,0)
^9.64PA^^
"BLD",7739,6.3)
9
"BLD",7739,"ABPKG")
n
"BLD",7739,"INID")
^n
"BLD",7739,"INIT")
AUDIT^RMPR163P
"BLD",7739,"KRN",0)
^9.67PA^779.2^20
"BLD",7739,"KRN",.4,0)
.4
"BLD",7739,"KRN",.401,0)
.401
"BLD",7739,"KRN",.402,0)
.402
"BLD",7739,"KRN",.403,0)
.403
"BLD",7739,"KRN",.5,0)
.5
"BLD",7739,"KRN",.84,0)
.84
"BLD",7739,"KRN",3.6,0)
3.6
"BLD",7739,"KRN",3.8,0)
3.8
"BLD",7739,"KRN",9.2,0)
9.2
"BLD",7739,"KRN",9.8,0)
9.8
"BLD",7739,"KRN",9.8,"NM",0)
^9.68A^8^7
"BLD",7739,"KRN",9.8,"NM",1,0)
RMPRPCE1^^0^B35212918
"BLD",7739,"KRN",9.8,"NM",2,0)
RMPRPAT3^^0^B41816871
"BLD",7739,"KRN",9.8,"NM",3,0)
RMPRPIFD^^0^B7240804
"BLD",7739,"KRN",9.8,"NM",5,0)
RMPR9DO^^0^B94727310
"BLD",7739,"KRN",9.8,"NM",6,0)
RMPR163P^^0^B11748560
"BLD",7739,"KRN",9.8,"NM",7,0)
RMPR8PG^^0^B7739853
"BLD",7739,"KRN",9.8,"NM",8,0)
RMPR8PG1^^0^B12913194
"BLD",7739,"KRN",9.8,"NM","B","RMPR163P",6)

"BLD",7739,"KRN",9.8,"NM","B","RMPR8PG",7)

"BLD",7739,"KRN",9.8,"NM","B","RMPR8PG1",8)

"BLD",7739,"KRN",9.8,"NM","B","RMPR9DO",5)

"BLD",7739,"KRN",9.8,"NM","B","RMPRPAT3",2)

"BLD",7739,"KRN",9.8,"NM","B","RMPRPCE1",1)

"BLD",7739,"KRN",9.8,"NM","B","RMPRPIFD",3)

"BLD",7739,"KRN",19,0)
19
"BLD",7739,"KRN",19,"NM",0)
^9.68A^^0
"BLD",7739,"KRN",19.1,0)
19.1
"BLD",7739,"KRN",101,0)
101
"BLD",7739,"KRN",409.61,0)
409.61
"BLD",7739,"KRN",771,0)
771
"BLD",7739,"KRN",779.2,0)
779.2
"BLD",7739,"KRN",870,0)
870
"BLD",7739,"KRN",8989.51,0)
8989.51
"BLD",7739,"KRN",8989.52,0)
8989.52
"BLD",7739,"KRN",8994,0)
8994
"BLD",7739,"KRN","B",.4,.4)

"BLD",7739,"KRN","B",.401,.401)

"BLD",7739,"KRN","B",.402,.402)

"BLD",7739,"KRN","B",.403,.403)

"BLD",7739,"KRN","B",.5,.5)

"BLD",7739,"KRN","B",.84,.84)

"BLD",7739,"KRN","B",3.6,3.6)

"BLD",7739,"KRN","B",3.8,3.8)

"BLD",7739,"KRN","B",9.2,9.2)

"BLD",7739,"KRN","B",9.8,9.8)

"BLD",7739,"KRN","B",19,19)

"BLD",7739,"KRN","B",19.1,19.1)

"BLD",7739,"KRN","B",101,101)

"BLD",7739,"KRN","B",409.61,409.61)

"BLD",7739,"KRN","B",771,771)

"BLD",7739,"KRN","B",779.2,779.2)

"BLD",7739,"KRN","B",870,870)

"BLD",7739,"KRN","B",8989.51,8989.51)

"BLD",7739,"KRN","B",8989.52,8989.52)

"BLD",7739,"KRN","B",8994,8994)

"BLD",7739,"QDEF")
^^^^NO^^^^^^YES
"BLD",7739,"QUES",0)
^9.62^^
"BLD",7739,"REQB",0)
^9.611^6^5
"BLD",7739,"REQB",1,0)
RMPR*3.0*146^2
"BLD",7739,"REQB",2,0)
RMPR*3.0*162^2
"BLD",7739,"REQB",4,0)
RMPR*3.0*139^2
"BLD",7739,"REQB",5,0)
RMPR*3.0*135^2
"BLD",7739,"REQB",6,0)
RMPR*3.0*140^2
"BLD",7739,"REQB","B","RMPR*3.0*135",5)

"BLD",7739,"REQB","B","RMPR*3.0*139",4)

"BLD",7739,"REQB","B","RMPR*3.0*140",6)

"BLD",7739,"REQB","B","RMPR*3.0*146",1)

"BLD",7739,"REQB","B","RMPR*3.0*162",2)

"INIT")
AUDIT^RMPR163P
"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
163^3111115
"PKG",101,22,1,"PAH",1,1,0)
^^10^10^3111115
"PKG",101,22,1,"PAH",1,1,1,0)
1. Cannot link patient record to Suspense:
"PKG",101,22,1,"PAH",1,1,2,0)
   a. When select patients appearing on the GUI Delayed Order
"PKG",101,22,1,"PAH",1,1,3,0)
      Report.
"PKG",101,22,1,"PAH",1,1,4,0)
 
"PKG",101,22,1,"PAH",1,1,5,0)
   b. After selecting patient, current issue item does not display.
"PKG",101,22,1,"PAH",1,1,6,0)
 
"PKG",101,22,1,"PAH",1,1,7,0)
2. Report 'Print Item Usage By Location' fails to print due to a missing 
"PKG",101,22,1,"PAH",1,1,8,0)
   HCPCS item reference.
"PKG",101,22,1,"PAH",1,1,9,0)
 
"PKG",101,22,1,"PAH",1,1,10,0)
3. Prosthetics GUI error when displaying Delayed Order Report (DOR)
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","RMPR163P")
0^6^B11748560^n/a
"RTN","RMPR163P",1,0)
RMPR163P ;VM/RB - check/purge file ^RMPR(668) 'L'/'L1' x-ref not matching zero node info ;03/27/08
"RTN","RMPR163P",2,0)
 ;;3.0;Prosthetics;**163**;13/27/08;Build 9
"RTN","RMPR163P",3,0)
 ;;
"RTN","RMPR163P",4,0)
 Q
"RTN","RMPR163P",5,0)
AUDIT ;   Post install audit to check for any 'L' and 'L1' x-ref that
"RTN","RMPR163P",6,0)
 ;   no longer have an associated master record to ien data that
"RTN","RMPR163P",7,0)
 ;   matches File ^RMPR(668,ien,0) data
"RTN","RMPR163P",8,0)
 ;
"RTN","RMPR163P",9,0)
 Q:$D(^XTMP("RMPR163P"))
"RTN","RMPR163P",10,0)
 N U,TOT1,TOT2,TOT3,TOT4,TOT5,TOT6,RMPRSS,RMPRDT,RMPRST,RMPRIEN,DFN,RDPT0,SSN,SSN2,RMSTART,RMEND,R0
"RTN","RMPR163P",11,0)
 D NOW^%DTC S RMSTART=%
"RTN","RMPR163P",12,0)
 S ^XTMP("RMPR163P","START COMPILE")=RMSTART
"RTN","RMPR163P",13,0)
 S ^XTMP("RMPR163P","END COMPILE")="RUNNING"
"RTN","RMPR163P",14,0)
 S ^XTMP("RMPR163P",0)=$$FMADD^XLFDT(RMSTART,90)_"^"_RMSTART
"RTN","RMPR163P",15,0)
0 ;FIND 668 'L' and 'L1' x-refs with missing master record
"RTN","RMPR163P",16,0)
 S U="^",(TOT1,TOT2,TOT3,TOT4,TOT5,TOT6)=0,RMPRSS=0
"RTN","RMPR163P",17,0)
1 F  S RMPRSS=$O(^RMPR(668,"L",RMPRSS)),RMPRDT=0 Q:RMPRSS=""  D
"RTN","RMPR163P",18,0)
 . F  S RMPRDT=$O(^RMPR(668,"L",RMPRSS,RMPRDT)),RMPRST="" Q:RMPRDT=""  D
"RTN","RMPR163P",19,0)
 .. F  S RMPRST=$O(^RMPR(668,"L",RMPRSS,RMPRDT,RMPRST)),RMPRIEN=0 Q:RMPRST=""  D
"RTN","RMPR163P",20,0)
 ... F  S RMPRIEN=$O(^RMPR(668,"L",RMPRSS,RMPRDT,RMPRST,RMPRIEN)) Q:RMPRIEN=""  D
"RTN","RMPR163P",21,0)
 .... I '$D(^RMPR(668,RMPRIEN,0)) D  Q
"RTN","RMPR163P",22,0)
 ..... S ^XTMP("RMPR163P","L",0,RMPRSS,RMPRDT,RMPRST,RMPRIEN)="PAT POINTER MISSING IN NODE 0"
"RTN","RMPR163P",23,0)
 ..... S TOT1=TOT1+1
"RTN","RMPR163P",24,0)
 ..... K ^RMPR(668,"L",RMPRSS,RMPRDT,RMPRST,RMPRIEN)
"RTN","RMPR163P",25,0)
 .... S R0=$G(^RMPR(668,RMPRIEN,0)),DFN=$P(R0,U,2)
"RTN","RMPR163P",26,0)
 .... I +$G(DFN)>0,$D(^DPT(+$G(DFN),0)) D  Q
"RTN","RMPR163P",27,0)
 ..... S RDPT0=$G(^DPT(DFN,0)),SSN=$P(RDPT0,U,9),SSN2=$E(SSN,8,9)
"RTN","RMPR163P",28,0)
 ..... I RMPRSS'=SSN2!(RMPRDT'=$P($P(R0,U),"."))!(RMPRST'=$P(R0,U,10)) D
"RTN","RMPR163P",29,0)
 ...... S ^XTMP("RMPR163P","L",2,RMPRSS,RMPRDT,RMPRST,RMPRIEN)=SSN_U_$P(R0,U)_U_$P(R0,U,10)
"RTN","RMPR163P",30,0)
 ...... S TOT2=TOT2+1
"RTN","RMPR163P",31,0)
 ...... K ^RMPR(668,"L",RMPRSS,RMPRDT,RMPRST,RMPRIEN)
"RTN","RMPR163P",32,0)
 ...... I +R0>0,SSN2>0,$P(R0,U,10)'="" S ^RMPR(668,"L",$P($P(R0,U),"."),SSN2,$P(R0,U,10),RMPRIEN)=""
"RTN","RMPR163P",33,0)
 .... S ^XTMP("RMPR163P","L",3,RMPRSS,RMPRDT,RMPRST,RMPRIEN)="BAD DFN IN 0 RECORD"
"RTN","RMPR163P",34,0)
 .... S TOT3=TOT3+1
"RTN","RMPR163P",35,0)
 .... K ^RMPR(668,"L",RMPRSS,RMPRDT,RMPRST,RMPRIEN)
"RTN","RMPR163P",36,0)
5 S RMPRSS=0
"RTN","RMPR163P",37,0)
 F  S RMPRSS=$O(^RMPR(668,"L1",RMPRSS)),RMPRST="" Q:RMPRSS=""  D
"RTN","RMPR163P",38,0)
 . F  S RMPRST=$O(^RMPR(668,"L1",RMPRSS,RMPRST)),RMPRIEN=0 Q:RMPRST=""  D
"RTN","RMPR163P",39,0)
 .. F  S RMPRIEN=$O(^RMPR(668,"L1",RMPRSS,RMPRST,RMPRIEN)) Q:RMPRIEN=""  D
"RTN","RMPR163P",40,0)
 ... I '$D(^RMPR(668,RMPRIEN,0)) D  Q
"RTN","RMPR163P",41,0)
 .... S ^XTMP("RMPR163P","L1",0,RMPRSS,RMPRST,RMPRIEN)="PAT POINTER MISSING IN NODE 0"
"RTN","RMPR163P",42,0)
 .... S TOT4=TOT4+1
"RTN","RMPR163P",43,0)
 .... K ^RMPR(668,"L1",RMPRSS,RMPRST,RMPRIEN)
"RTN","RMPR163P",44,0)
 ... S R0=$G(^RMPR(668,RMPRIEN,0)),DFN=$P(R0,U,2)
"RTN","RMPR163P",45,0)
 ... I +$G(DFN)>0,$D(^DPT(+$G(DFN),0)) D  Q
"RTN","RMPR163P",46,0)
 .... S RDPT0=$G(^DPT(DFN,0)),SSN=$P(RDPT0,U,9),SSN2=$E(SSN,8,9)
"RTN","RMPR163P",47,0)
 .... I RMPRSS'=SSN2!(RMPRST'=$P(R0,U,10)) D
"RTN","RMPR163P",48,0)
 ..... S ^XTMP("RMPR163P","L1",1,RMPRSS,RMPRST,RMPRIEN)=SSN_U_$P(R0,U)_U_$P(R0,U,10)
"RTN","RMPR163P",49,0)
 ..... S TOT5=TOT5+1
"RTN","RMPR163P",50,0)
 ..... K ^RMPR(668,"L1",RMPRSS,RMPRST,RMPRIEN)
"RTN","RMPR163P",51,0)
 ..... I SSN2>0,$P(R0,U,10)'="" S ^RMPR(668,"L1",SSN2,$P(R0,U,10),RMPRIEN)=""
"RTN","RMPR163P",52,0)
 ... S ^XTMP("RMPR163P","L1",2,RMPRSS,RMPRST,RMPRIEN)="BAD DFN IN 0 RECORD"
"RTN","RMPR163P",53,0)
 ... S TOT6=TOT6+1
"RTN","RMPR163P",54,0)
 ... K ^RMPR(668,"L",RMPRSS,RMPRST,RMPRIEN)
"RTN","RMPR163P",55,0)
9 W !,"MISSING 'L' 0 NODE TOTAL:  ",TOT1
"RTN","RMPR163P",56,0)
 W !,"MISSING 'L' MISMATCH W/DFN TOTAL:  ",TOT2
"RTN","RMPR163P",57,0)
 W !,"MISSING 'L' MISMATCH W/O DFN TOTAL:  ",TOT3
"RTN","RMPR163P",58,0)
 W !,"MISSING 'L1' 0 NODE TOTAL:  ",TOT4
"RTN","RMPR163P",59,0)
 W !,"MISSING 'L1' MISMATCH W/DFN TOTAL:  ",TOT5
"RTN","RMPR163P",60,0)
 W !,"MISSING 'L1' MISMATCH W/O DFN TOTAL:  ",TOT6
"RTN","RMPR163P",61,0)
 D NOW^%DTC S RMEND=%
"RTN","RMPR163P",62,0)
 S ^XTMP("RMPR163P","END COMPILE")=RMEND
"RTN","RMPR163P",63,0)
 K %
"RTN","RMPR163P",64,0)
 Q
"RTN","RMPR8PG")
0^7^B7739853^B6676473
"RTN","RMPR8PG",1,0)
RMPR8PG ;PHX,HOIFO/JLT,SPS-PURGE 668 SUSPENSE FILE ;8/29/1994
"RTN","RMPR8PG",2,0)
 ;;3.0;PROSTHETICS;**5,75,140,163**;Feb 09, 1996;Build 9
"RTN","RMPR8PG",3,0)
 ;
"RTN","RMPR8PG",4,0)
 ;02/03/06 Added code to delete the pointer in 664.1 field .05 when a 
"RTN","RMPR8PG",5,0)
 ;record is purged.
"RTN","RMPR8PG",6,0)
 ;
"RTN","RMPR8PG",7,0)
EN D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPR8PG",8,0)
EN2 K %ZIS,IOP,ZTIO S %ZIS="MQ",%ZIS("B")="" D ^%ZIS G:POP END
"RTN","RMPR8PG",9,0)
 ;I IOST["C-" W !,$C(7),"YOU MAY NOT SELECT YOUR TERMINAL" G EN2
"RTN","RMPR8PG",10,0)
 I $D(IO("Q")) S ZTRTN="EN1^RMPR8PG",ZTDESC="PURGE 668 SUSPENSE FILE" F RD="I","RMPRIEN","RMPRDT","ION","RMPR(","RMPRSITE" S ZTSAVE(RD)=""
"RTN","RMPR8PG",11,0)
 I $D(IO("Q")) K IO("Q") D ^%ZTLOAD W !,"<REQUEST QUEUED!>" G EXIT
"RTN","RMPR8PG",12,0)
EN1 S (I,RMPRIEN,RDEL)=0,RMPRDT=$P(^RMPR(669.9,RMPRSITE,0),U,8) G:RMPRDT'>89 END
"RTN","RMPR8PG",13,0)
 S X1=DT,X2=-RMPRDT D C^%DTC S RMPRDT=X I RMPRDT<$O(^RMPR(668,"B",""))!('$O(^RMPR(668,0))) G END
"RTN","RMPR8PG",14,0)
 ;RMPR*3.0*163 adds check to insure the 0 node is defined in DIP run
"RTN","RMPR8PG",15,0)
 S DIS(0)="I $D(^RMPR(668,D0,0)),$P(^RMPR(668,D0,0),U,7)=RMPR(""STA"")",IOP=ION,DIC="^RMPR(668,",FLDS=".01;C1,1;C20;L17,2,3,6;C45;L15,5;C65,4;C1,7;C1",BY="5",FR=$S($D(^RMPR(668,"B")):$O(^RMPR(668,"B","")),1:2890101)
"RTN","RMPR8PG",16,0)
 S TO=RMPRDT,DHD="Purge Suspense File Entries from Station/Division "_RMPR("STA") D EN1^DIP
"RTN","RMPR8PG",17,0)
 N RMPR6641
"RTN","RMPR8PG",18,0)
 F  S RMPRIEN=$O(^RMPR(668,RMPRIEN)) Q:RMPRIEN'>0  I $P($G(^RMPR(668,RMPRIEN,0)),U,7)=RMPR("STA") I ($P(^RMPR(668,RMPRIEN,0),U,5))&($P(^(0),U,5)<RMPRDT) S DA=RMPRIEN,DIC="^RMPR(668," S DA=RMPRIEN,DIK=DIC D ^DIK D  S RDEL=RDEL+1
"RTN","RMPR8PG",19,0)
 . S RMPR6641=0 F  S RMPR6641=$O(^RMPR(664.1,"SUS",DA,RMPR6641)) Q:RMPR6641'>0  D
"RTN","RMPR8PG",20,0)
 .. I $D(^RMPR(664.1,RMPR6641,0)) S $P(^(0),U,8)=""
"RTN","RMPR8PG",21,0)
END I $G(RDEL)<1 W !!,"No Suspense entries purged."
"RTN","RMPR8PG",22,0)
 I $G(RDEL)>1 W !!,RDEL," Suspense entries purged."
"RTN","RMPR8PG",23,0)
 I $G(RDEL)=1 W !!,RDEL,"Suspense entry purged. "
"RTN","RMPR8PG",24,0)
EXIT ;common exit point
"RTN","RMPR8PG",25,0)
 K I,RD,X,DIS,%ZIS,X1,X2,RMPRIEN,RMPRDT,RMPR6641,RDEL,DIC,DIK,DA,RL,BY,DHD,DHIT,FLDS,FR,TO D ^%ZISC
"RTN","RMPR8PG",26,0)
 G AUDIT^RMPR8PG1    ;RMPR*3.0*163  Call to audit/remove file 668 'L' & 'L1' x-ref with pointer to null master rec
"RTN","RMPR8PG1")
0^8^B12913194^n/a
"RTN","RMPR8PG1",1,0)
RMPR8PG1 ;VM/RB - check/purge file ^RMPR(668) 'L'/'L1' x-ref not matching zero node info ;03/27/08
"RTN","RMPR8PG1",2,0)
 ;;3.0;Prosthetics;**163**;13/27/08;Build 9
"RTN","RMPR8PG1",3,0)
 ;;
"RTN","RMPR8PG1",4,0)
 Q
"RTN","RMPR8PG1",5,0)
AUDIT ;   Post suspense purge audit to check for any 'L' and 'L1' x-ref that
"RTN","RMPR8PG1",6,0)
 ;   no longer have an associated master record to ien data that
"RTN","RMPR8PG1",7,0)
 ;   matches File ^RMPR(668,ien,0) data
"RTN","RMPR8PG1",8,0)
 ;
"RTN","RMPR8PG1",9,0)
 Q:$D(^XTMP("RMPR8PG1"))    ;Will run this index cleanse portion no sooner than 90 days after the last cleansing.
"RTN","RMPR8PG1",10,0)
 N U,TOT1,TOT2,TOT3,TOT4,TOT5,TOT6,RMPRSS,RMPRDT,RMPRST,RMPRIEN,DFN,RDPT0,SSN,SSN2,RMSTART,RMEND,R0
"RTN","RMPR8PG1",11,0)
 D NOW^%DTC S RMSTART=%
"RTN","RMPR8PG1",12,0)
 S ^XTMP("RMPR8PG1","START COMPILE")=RMSTART
"RTN","RMPR8PG1",13,0)
 S ^XTMP("RMPR8PG1","END COMPILE")="RUNNING"
"RTN","RMPR8PG1",14,0)
 S ^XTMP("RMPR8PG1",0)=$$FMADD^XLFDT(RMSTART,90)_"^"_RMSTART
"RTN","RMPR8PG1",15,0)
0 ;FIND 668 'L' and 'L1' x-refs with missing master record
"RTN","RMPR8PG1",16,0)
 S U="^",(TOT1,TOT2,TOT3,TOT4,TOT5,TOT6)=0,RMPRSS=0
"RTN","RMPR8PG1",17,0)
1 F  S RMPRSS=$O(^RMPR(668,"L",RMPRSS)),RMPRDT=0 Q:RMPRSS=""  D
"RTN","RMPR8PG1",18,0)
 . F  S RMPRDT=$O(^RMPR(668,"L",RMPRSS,RMPRDT)),RMPRST="" Q:RMPRDT=""  D
"RTN","RMPR8PG1",19,0)
 .. F  S RMPRST=$O(^RMPR(668,"L",RMPRSS,RMPRDT,RMPRST)),RMPRIEN=0 Q:RMPRST=""  D
"RTN","RMPR8PG1",20,0)
 ... F  S RMPRIEN=$O(^RMPR(668,"L",RMPRSS,RMPRDT,RMPRST,RMPRIEN)) Q:RMPRIEN=""  D
"RTN","RMPR8PG1",21,0)
 .... I '$D(^RMPR(668,RMPRIEN,0)) D  Q
"RTN","RMPR8PG1",22,0)
 ..... S ^XTMP("RMPR8PG1","L",0,RMPRSS,RMPRDT,RMPRST,RMPRIEN)="PAT POINTER MISSING IN NODE 0"
"RTN","RMPR8PG1",23,0)
 ..... S TOT1=TOT1+1
"RTN","RMPR8PG1",24,0)
 ..... K ^RMPR(668,"L",RMPRSS,RMPRDT,RMPRST,RMPRIEN)
"RTN","RMPR8PG1",25,0)
 .... S R0=$G(^RMPR(668,RMPRIEN,0)),DFN=$P(R0,U,2)
"RTN","RMPR8PG1",26,0)
 .... I +$G(DFN)>0,$D(^DPT(+$G(DFN),0)) D  Q
"RTN","RMPR8PG1",27,0)
 ..... S RDPT0=$G(^DPT(DFN,0)),SSN=$P(RDPT0,U,9),SSN2=$E(SSN,8,9)
"RTN","RMPR8PG1",28,0)
 ..... I RMPRSS'=SSN2!(RMPRDT'=$P($P(R0,U),"."))!(RMPRST'=$P(R0,U,10)) D
"RTN","RMPR8PG1",29,0)
 ...... S ^XTMP("RMPR8PG1","L",2,RMPRSS,RMPRDT,RMPRST,RMPRIEN)=SSN_U_$P(R0,U)_U_$P(R0,U,10)
"RTN","RMPR8PG1",30,0)
 ...... S TOT2=TOT2+1
"RTN","RMPR8PG1",31,0)
 ...... K ^RMPR(668,"L",RMPRSS,RMPRDT,RMPRST,RMPRIEN)
"RTN","RMPR8PG1",32,0)
 ...... I +R0>0,SSN2>0,$P(R0,U,10)'="" S ^RMPR(668,"L",$P($P(R0,U),"."),SSN2,$P(R0,U,10),RMPRIEN)=""
"RTN","RMPR8PG1",33,0)
 .... S ^XTMP("RMPR8PG1","L",3,RMPRSS,RMPRDT,RMPRST,RMPRIEN)="BAD DFN IN 0 RECORD"
"RTN","RMPR8PG1",34,0)
 .... S TOT3=TOT3+1
"RTN","RMPR8PG1",35,0)
 .... K ^RMPR(668,"L",RMPRSS,RMPRDT,RMPRST,RMPRIEN)
"RTN","RMPR8PG1",36,0)
5 S RMPRSS=0
"RTN","RMPR8PG1",37,0)
 F  S RMPRSS=$O(^RMPR(668,"L1",RMPRSS)),RMPRST="" Q:RMPRSS=""  D
"RTN","RMPR8PG1",38,0)
 . F  S RMPRST=$O(^RMPR(668,"L1",RMPRSS,RMPRST)),RMPRIEN=0 Q:RMPRST=""  D
"RTN","RMPR8PG1",39,0)
 .. F  S RMPRIEN=$O(^RMPR(668,"L1",RMPRSS,RMPRST,RMPRIEN)) Q:RMPRIEN=""  D
"RTN","RMPR8PG1",40,0)
 ... I '$D(^RMPR(668,RMPRIEN,0)) D  Q
"RTN","RMPR8PG1",41,0)
 .... S ^XTMP("RMPR8PG1","L1",0,RMPRSS,RMPRST,RMPRIEN)="PAT POINTER MISSING IN NODE 0"
"RTN","RMPR8PG1",42,0)
 .... S TOT4=TOT4+1
"RTN","RMPR8PG1",43,0)
 .... K ^RMPR(668,"L1",RMPRSS,RMPRST,RMPRIEN)
"RTN","RMPR8PG1",44,0)
 ... S R0=$G(^RMPR(668,RMPRIEN,0)),DFN=$P(R0,U,2)
"RTN","RMPR8PG1",45,0)
 ... I +$G(DFN)>0,$D(^DPT(+$G(DFN),0)) D  Q
"RTN","RMPR8PG1",46,0)
 .... S RDPT0=$G(^DPT(DFN,0)),SSN=$P(RDPT0,U,9),SSN2=$E(SSN,8,9)
"RTN","RMPR8PG1",47,0)
 .... I RMPRSS'=SSN2!(RMPRST'=$P(R0,U,10)) D
"RTN","RMPR8PG1",48,0)
 ..... S ^XTMP("RMPR8PG1","L1",1,RMPRSS,RMPRST,RMPRIEN)=SSN_U_$P(R0,U)_U_$P(R0,U,10)
"RTN","RMPR8PG1",49,0)
 ..... S TOT5=TOT5+1
"RTN","RMPR8PG1",50,0)
 ..... K ^RMPR(668,"L1",RMPRSS,RMPRST,RMPRIEN)
"RTN","RMPR8PG1",51,0)
 ..... I SSN2>0,$P(R0,U,10)'="" S ^RMPR(668,"L1",SSN2,$P(R0,U,10),RMPRIEN)=""
"RTN","RMPR8PG1",52,0)
 ... S ^XTMP("RMPR8PG1","L1",2,RMPRSS,RMPRST,RMPRIEN)="BAD DFN IN 0 RECORD"
"RTN","RMPR8PG1",53,0)
 ... S TOT6=TOT6+1
"RTN","RMPR8PG1",54,0)
 ... K ^RMPR(668,"L",RMPRSS,RMPRST,RMPRIEN)
"RTN","RMPR8PG1",55,0)
9 W !!!!,"MISSING 'L' 0 NODE TOTAL:  ",TOT1
"RTN","RMPR8PG1",56,0)
 W !,"MISSING 'L' MISMATCH W/DFN TOTAL:  ",TOT2
"RTN","RMPR8PG1",57,0)
 W !,"MISSING 'L' MISMATCH W/O DFN TOTAL:  ",TOT3
"RTN","RMPR8PG1",58,0)
 W !,"MISSING 'L1' 0 NODE TOTAL:  ",TOT4
"RTN","RMPR8PG1",59,0)
 W !,"MISSING 'L1' MISMATCH W/DFN TOTAL:  ",TOT5
"RTN","RMPR8PG1",60,0)
 W !,"MISSING 'L1' MISMATCH W/O DFN TOTAL:  ",TOT6
"RTN","RMPR8PG1",61,0)
 D NOW^%DTC S RMEND=%
"RTN","RMPR8PG1",62,0)
 S ^XTMP("RMPR8PG1","TOTALS")=TOT1_U_TOT2_U_TOT3_U_TOT4_U_TOT5_U_TOT6
"RTN","RMPR8PG1",63,0)
 S ^XTMP("RMPR8PG1","END COMPILE")=RMEND
"RTN","RMPR8PG1",64,0)
 K %
"RTN","RMPR8PG1",65,0)
 Q
"RTN","RMPR9DO")
0^5^B94727310^B90495875
"RTN","RMPR9DO",1,0)
RMPR9DO ;HOIFO/HNC -  ORDER CONROL PROCESSING-REMOTE PROCEDURE ;9/8/03  07:12
"RTN","RMPR9DO",2,0)
 ;;3.0;PROSTHETICS;**59,77,90,60,135,163**;Feb 09, 1996;Build 9
"RTN","RMPR9DO",3,0)
 ;
"RTN","RMPR9DO",4,0)
 ;8/5/03 Make sure no dups, HNC patch 77
"RTN","RMPR9DO",5,0)
 ;
"RTN","RMPR9DO",6,0)
 ;Patch RMPR*3.0*163 check all three $O for x-ref 'L', 'L1' and 'CD' to
"RTN","RMPR9DO",7,0)
 ;insure the linked master record has a node 0 defined.
"RTN","RMPR9DO",8,0)
 ;
"RTN","RMPR9DO",9,0)
A1(START,STOP,SITE,SORT,DATE,WHAT) ;entry point for rollup
"RTN","RMPR9DO",10,0)
 ;activated from (option name)
"RTN","RMPR9DO",11,0)
 I WHAT="S" D
"RTN","RMPR9DO",12,0)
 .S STN1=0
"RTN","RMPR9DO",13,0)
 .F  S STN1=$O(^RMPR(669.9,STN1)) Q:STN1'>0  D
"RTN","RMPR9DO",14,0)
 . .S SITE=STN1
"RTN","RMPR9DO",15,0)
 . .D A2
"RTN","RMPR9DO",16,0)
 I WHAT="ALL" G A2
"RTN","RMPR9DO",17,0)
 Q
"RTN","RMPR9DO",18,0)
EN(RESULT,DUZ,START,STOP,SITE,SORT,DATE,RMPRPRSN) ; -- Broker callback to get list to display
"RTN","RMPR9DO",19,0)
 ;entry to send to PCM, WHAT=ALL or S for Summary Only
"RTN","RMPR9DO",20,0)
 ;RMPRPRSN=P for Purchasing D for Delayed Order Report
"RTN","RMPR9DO",21,0)
 S (WHO,RMPRSC)=""
"RTN","RMPR9DO",22,0)
 I RMPRPRSN="P" S RMPRSC=$O(^RMPR(669.9,"PA",DUZ,RMPRSC)) Q:(RMPRSC="")!(WHO'="")  D
"RTN","RMPR9DO",23,0)
 . I '$D(^RMPR(669.9,RMPRSC,0)) Q
"RTN","RMPR9DO",24,0)
 . I '$D(^RMPR(669.9,RMPRSC,5,"B",DUZ)) Q
"RTN","RMPR9DO",25,0)
 . S WHO=$O(^RMPR(669.9,RMPRSC,5,"B",DUZ,""))
"RTN","RMPR9DO",26,0)
 . I START="" S START=$P(^RMPR(669.9,RMPRSC,5,WHO,0),U,2)
"RTN","RMPR9DO",27,0)
 . I STOP="" S STOP=$P(^RMPR(669.9,RMPRSC,5,WHO,0),U,3)
"RTN","RMPR9DO",28,0)
A2 N STRING,CLREND,COLUMN,ON,OFF
"RTN","RMPR9DO",29,0)
 Q:SORT=""
"RTN","RMPR9DO",30,0)
 Q:DATE=""
"RTN","RMPR9DO",31,0)
 Q:START=""
"RTN","RMPR9DO",32,0)
 Q:STOP=""
"RTN","RMPR9DO",33,0)
 Q:SITE=""
"RTN","RMPR9DO",34,0)
 I SITE'="ALL" S SITE=$P(^RMPR(669.9,SITE,0),U,2)
"RTN","RMPR9DO",35,0)
 K ^TMP($J)
"RTN","RMPR9DO",36,0)
 N RMPRA,CDATE,X
"RTN","RMPR9DO",37,0)
 K ADATE,PDAY,RMPRCD
"RTN","RMPR9DO",38,0)
 S VALMCNT=0,RRX=""
"RTN","RMPR9DO",39,0)
 ;if sort for open or pending include all regardless of date
"RTN","RMPR9DO",40,0)
 ;if sort for cancelled or closed include from date passed forward
"RTN","RMPR9DO",41,0)
 ;
"RTN","RMPR9DO",42,0)
 ;PPD# status=pending before date, total days create to 1st action
"RTN","RMPR9DO",43,0)
 ;MHD# manual totals days create to 1st action
"RTN","RMPR9DO",44,0)
 ;CHD# consult totals days create to 1st action
"RTN","RMPR9DO",45,0)
 ;PPDD# status=pending before date, total days in pending state, 1st
"RTN","RMPR9DO",46,0)
 ;      action to current date
"RTN","RMPR9DO",47,0)
 ;
"RTN","RMPR9DO",48,0)
 S (LINE,MHD1,MHD2,MHD3,MHD4,MHD5,CHD1,CHD2,CHD3,CHD4,CHD5,CLNK,MLNK)=0
"RTN","RMPR9DO",49,0)
 S (PPDAY,PPD,PPD1,PPD2,PPD3,PPD4,PPD5)=0
"RTN","RMPR9DO",50,0)
 S (PPDDAY,PPDD1,PPDD2,PPDD3,PPDD4,PPDD5)=0
"RTN","RMPR9DO",51,0)
 I SORT["O"!(SORT["P") D ALL
"RTN","RMPR9DO",52,0)
 I SORT["C"!(SORT["X") D DTFWD
"RTN","RMPR9DO",53,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",54,0)
 S ^TMP($J,"A1")="^^^^^^^^"_MHD1_U_MHD2_U_MHD3_U_MHD4_U_MHD5_"^^^^"_MLNK_U_0
"RTN","RMPR9DO",55,0)
 I $G(WHAT)="S" S RMPRXM(1)=MHD1_U_MHD2_U_MHD3_U_MHD4_U_MHD5_U_MLNK_U_0
"RTN","RMPR9DO",56,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",57,0)
 S ^TMP($J,"A2")="^^^^^^^^"_CHD1_U_CHD2_U_CHD3_U_CHD4_U_CHD5_"^^^^"_CLNK_U_1
"RTN","RMPR9DO",58,0)
 I $G(WHAT)="S" S RMPRXM(2)=CHD1_U_CHD2_U_CHD3_U_CHD4_U_CHD5_U_CLNK_U_1
"RTN","RMPR9DO",59,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",60,0)
 I $G(WHAT)="S" S RMPRXM(3)=PPD1_U_PPD2_U_PPD3_U_PPD4_U_PPD5_U_U_2
"RTN","RMPR9DO",61,0)
 S ^TMP($J,"A3")="^^^^^^^^"_PPDD1_U_PPDD2_U_PPDD3_U_PPDD4_U_PPDD5_"^^^^^"_2
"RTN","RMPR9DO",62,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",63,0)
 S ^TMP($J,"A4")="^^^^^^^^"_PPD1_U_PPD2_U_PPD3_U_PPD4_U_PPD5_"^^^^^"_3
"RTN","RMPR9DO",64,0)
 ;quarter rollup with full data
"RTN","RMPR9DO",65,0)
 I $G(WHAT)="Q" D MAIL
"RTN","RMPR9DO",66,0)
 ;summary only
"RTN","RMPR9DO",67,0)
 I $G(WHAT)="S" D MAILG
"RTN","RMPR9DO",68,0)
 I $G(WHAT)="ALL" D MAILG,MAIL
"RTN","RMPR9DO",69,0)
 I '$G(WHAT) G EXIT
"RTN","RMPR9DO",70,0)
 Q
"RTN","RMPR9DO",71,0)
ALL ;all open pending records regardless of date passed
"RTN","RMPR9DO",72,0)
 S RMPRI1=0
"RTN","RMPR9DO",73,0)
 F RMPRI1=START:1:STOP D
"RTN","RMPR9DO",74,0)
 .I $L(RMPRI1)=1 S RMPRI=0_RMPRI1
"RTN","RMPR9DO",75,0)
 .E  S RMPRI=RMPRI1
"RTN","RMPR9DO",76,0)
 .S RMPRST=""
"RTN","RMPR9DO",77,0)
 .F  S RMPRST=$O(^RMPR(668,"L1",RMPRI,RMPRST)) Q:RMPRST=""  D
"RTN","RMPR9DO",78,0)
 . .Q:RMPRST="X"
"RTN","RMPR9DO",79,0)
 . .Q:RMPRST="C"
"RTN","RMPR9DO",80,0)
 . .I SORT'["P"&(RMPRST="P") Q
"RTN","RMPR9DO",81,0)
 . .S RMPRA=0
"RTN","RMPR9DO",82,0)
 . .F  S RMPRA=$O(^RMPR(668,"L1",RMPRI,RMPRST,RMPRA)) Q:RMPRA'>0  D
"RTN","RMPR9DO",83,0)
 . . .Q:'$D(^RMPR(668,RMPRA,0))    ;;Patch RMPR*3.0*163 check
"RTN","RMPR9DO",84,0)
 . . .S STN=$P(^RMPR(668,RMPRA,0),U,7)
"RTN","RMPR9DO",85,0)
 . . .I SITE'="ALL"&(SITE'=STN) Q
"RTN","RMPR9DO",86,0)
 . . .S STNX=$$STATN^RMPRUTIL(STN)
"RTN","RMPR9DO",87,0)
 . . .I $G(WHAT)="S" S VISNX=$P($G(^RMPR(669.9,STN1,"INV")),U,2)
"RTN","RMPR9DO",88,0)
 . . .S STS=$P(^RMPR(668,RMPRA,0),U,10)
"RTN","RMPR9DO",89,0)
 . . .Q:STS["X"
"RTN","RMPR9DO",90,0)
 . . .Q:STS["C"
"RTN","RMPR9DO",91,0)
 . . .I SORT'["O"&(STS="O") Q
"RTN","RMPR9DO",92,0)
 . . .I SORT'["P"&(STS="P") Q
"RTN","RMPR9DO",93,0)
 . . .D REC
"RTN","RMPR9DO",94,0)
 Q
"RTN","RMPR9DO",95,0)
DTFWD ;from date passed forward
"RTN","RMPR9DO",96,0)
 S RMPRI1=0
"RTN","RMPR9DO",97,0)
 F RMPRI1=START:1:STOP D
"RTN","RMPR9DO",98,0)
 .I $L(RMPRI1)=1 S RMPRI=0_RMPRI1
"RTN","RMPR9DO",99,0)
 .E  S RMPRI=RMPRI1
"RTN","RMPR9DO",100,0)
 .S RMPRDTM=""
"RTN","RMPR9DO",101,0)
 .F  S RMPRDTM=$O(^RMPR(668,"L",RMPRI,RMPRDTM)) Q:RMPRDTM=""  D
"RTN","RMPR9DO",102,0)
 ..Q:RMPRDTM=""
"RTN","RMPR9DO",103,0)
 ..Q:RMPRDTM<DATE
"RTN","RMPR9DO",104,0)
 ..S RMPRST=""
"RTN","RMPR9DO",105,0)
 ..F  S RMPRST=$O(^RMPR(668,"L",RMPRI,RMPRDTM,RMPRST)) Q:RMPRST=""  D
"RTN","RMPR9DO",106,0)
 .. .Q:RMPRST="O"
"RTN","RMPR9DO",107,0)
 .. .Q:RMPRST="P"
"RTN","RMPR9DO",108,0)
 .. .I SORT'["X"&(RMPRST="X") Q
"RTN","RMPR9DO",109,0)
 .. .I SORT'["C"&(RMPRST="C") Q
"RTN","RMPR9DO",110,0)
 .. .S RMPRA=0
"RTN","RMPR9DO",111,0)
 .. .F  S RMPRA=$O(^RMPR(668,"L",RMPRI,RMPRDTM,RMPRST,RMPRA)) Q:RMPRA'>0  D
"RTN","RMPR9DO",112,0)
 .. . .Q:'$D(^RMPR(668,RMPRA,0))      ;;;;Patch RMPR*3.0*163 check
"RTN","RMPR9DO",113,0)
 .. . .Q:RMPRA=""
"RTN","RMPR9DO",114,0)
 .. . .S STN=$P(^RMPR(668,RMPRA,0),U,7)
"RTN","RMPR9DO",115,0)
 .. . .I SITE'="ALL"&(SITE'=STN) Q
"RTN","RMPR9DO",116,0)
 .. . .S STNX=$$STATN^RMPRUTIL(STN)
"RTN","RMPR9DO",117,0)
 .. . .I $G(WHAT)'="" S VISNX=$P($G(^RMPR(669.9,SITE,"INV")),U,2)
"RTN","RMPR9DO",118,0)
 .. . .S STS=$P(^RMPR(668,RMPRA,0),U,10)
"RTN","RMPR9DO",119,0)
 .. . .Q:STS["O"
"RTN","RMPR9DO",120,0)
 .. . .Q:STS["P"
"RTN","RMPR9DO",121,0)
 .. . .I SORT'["C"&(STS="C") Q
"RTN","RMPR9DO",122,0)
 .. . .I SORT'["X"&(STS="X") Q
"RTN","RMPR9DO",123,0)
 .. . .D REC
"RTN","RMPR9DO",124,0)
 S RMPRDTC=$P(DATE,".",1)
"RTN","RMPR9DO",125,0)
 F  S RMPRDTC=$O(^RMPR(668,"CD",RMPRDTC)) Q:RMPRDTC=""  D
"RTN","RMPR9DO",126,0)
 .Q:RMPRDTC<DATE
"RTN","RMPR9DO",127,0)
 .S RMPRDYS=0
"RTN","RMPR9DO",128,0)
 .F  S RMPRDYS=$O(^RMPR(668,"CD",RMPRDTC,RMPRDYS)) Q:RMPRDYS=""  D
"RTN","RMPR9DO",129,0)
 . .Q:RMPRDYS'>5
"RTN","RMPR9DO",130,0)
 . .S RMPRA=0
"RTN","RMPR9DO",131,0)
 . .F  S RMPRA=$O(^RMPR(668,"CD",RMPRDTC,RMPRDYS,RMPRA)) Q:RMPRA'>0  D
"RTN","RMPR9DO",132,0)
 . . .Q:'$D(^RMPR(668,RMPRA,0))     ;;Patch RMPR*3.0*163 check
"RTN","RMPR9DO",133,0)
 . . .;check site
"RTN","RMPR9DO",134,0)
 . . .S STN=$P(^RMPR(668,RMPRA,0),U,7)
"RTN","RMPR9DO",135,0)
 . . .I SITE'="ALL"&(SITE'=STN) Q
"RTN","RMPR9DO",136,0)
 . . .S STNX=$$STATN^RMPRUTIL(STN)
"RTN","RMPR9DO",137,0)
 . . .;check status
"RTN","RMPR9DO",138,0)
 . . .S STS=$P(^RMPR(668,RMPRA,0),U,10)
"RTN","RMPR9DO",139,0)
 . . .I SORT'["O"&(STS="O") Q
"RTN","RMPR9DO",140,0)
 . . .I SORT'["P"&(STS="P") Q
"RTN","RMPR9DO",141,0)
 . . .I SORT'["C"&(STS="C") Q
"RTN","RMPR9DO",142,0)
 . . .I SORT'["X"&(STS="X") Q
"RTN","RMPR9DO",143,0)
 . . .;ssn range filter
"RTN","RMPR9DO",144,0)
 . . .S DFN=$P(^RMPR(668,RMPRA,0),U,2)
"RTN","RMPR9DO",145,0)
 . . .D DEM^VADPT
"RTN","RMPR9DO",146,0)
 . . .S SSNEN=$E($P(VADM(2),"^",2),10,11)
"RTN","RMPR9DO",147,0)
 . . .I SSNEN>STOP Q
"RTN","RMPR9DO",148,0)
 . . .I SSNEN<START Q
"RTN","RMPR9DO",149,0)
 . . .K SSNEN,VADM
"RTN","RMPR9DO",150,0)
 . . .D REC
"RTN","RMPR9DO",151,0)
 Q
"RTN","RMPR9DO",152,0)
REC ;records to grid
"RTN","RMPR9DO",153,0)
 ;stop date, init action date
"RTN","RMPR9DO",154,0)
 ;check ien, patch 77
"RTN","RMPR9DO",155,0)
 ;
"RTN","RMPR9DO",156,0)
 Q:$D(^TMP($J,RMPRA))
"RTN","RMPR9DO",157,0)
 ;
"RTN","RMPR9DO",158,0)
 N DIC,DIQ,DR,STOPDT
"RTN","RMPR9DO",159,0)
 S DA=RMPRA
"RTN","RMPR9DO",160,0)
 S DIC=668,DIQ="RE",DR=10,DIQ(0)="EN" D EN^DIQ1
"RTN","RMPR9DO",161,0)
 S STOPDT=$P($G(^RMPR(668,RMPRA,0)),U,9),STOPDT=$$DAT2^RMPRUTL1(STOPDT)
"RTN","RMPR9DO",162,0)
 S LINE=LINE+1
"RTN","RMPR9DO",163,0)
 S CDATE=$P(^RMPR(668,RMPRA,0),U,1),CDATE=$$DAT2^RMPRUTL1(CDATE)
"RTN","RMPR9DO",164,0)
 S DFN=$P(^RMPR(668,RMPRA,0),U,2) Q:DFN=""
"RTN","RMPR9DO",165,0)
 N VA,VADM
"RTN","RMPR9DO",166,0)
 D DEM^VADPT
"RTN","RMPR9DO",167,0)
 S WHO=VADM(1)
"RTN","RMPR9DO",168,0)
 S SSN=VADM(2)
"RTN","RMPR9DO",169,0)
 D SVC^VADPT
"RTN","RMPR9DO",170,0)
 S RMPROEOI=$S(VASV(11)>0:"<!>",VASV(12)>0:"<!>",VASV(13)>0:"<!>",1:0)
"RTN","RMPR9DO",171,0)
 D KVAR^VADPT
"RTN","RMPR9DO",172,0)
 ;type
"RTN","RMPR9DO",173,0)
 S TYPE=$$TYPE^RMPREOU(RMPRA,8)
"RTN","RMPR9DO",174,0)
 ;display description if manual
"RTN","RMPR9DO",175,0)
 S DES=$$DES^RMPREOU(RMPRA,22)
"RTN","RMPR9DO",176,0)
 S DES=$TR(DES,"^","*")
"RTN","RMPR9DO",177,0)
 S DES=$TR(DES,"""","'")
"RTN","RMPR9DO",178,0)
 ;init action date
"RTN","RMPR9DO",179,0)
 S ADATE="",PDAY="",WRKDAY=""
"RTN","RMPR9DO",180,0)
 S ADATE=$P(^RMPR(668,RMPRA,0),U,9)
"RTN","RMPR9DO",181,0)
 ;PPD=1 for previous pending
"RTN","RMPR9DO",182,0)
 I ADATE'="" S (PDAY,WRKDAY)=$$WRKDAY^RMPREOU(RMPRA)
"RTN","RMPR9DO",183,0)
 I ADATE="" S (PDAY,WRKDAY)=$$CWRKDAY^RMPREOU(RMPRA) I $P(^RMPR(668,RMPRA,0),U,10)="X" S (PDAY,WRKDAY)=$$CANWKDY^RMPREOU(RMPRA)
"RTN","RMPR9DO",184,0)
 I ADATE'="" S CDAY=$$PDAY^RMPREOU(RMPRA)
"RTN","RMPR9DO",185,0)
 ;
"RTN","RMPR9DO",186,0)
 S STATUS=$$STATUS^RMPREOU(RMPRA)
"RTN","RMPR9DO",187,0)
 I STATUS["PENDING" D
"RTN","RMPR9DO",188,0)
 .I ADATE'=""&(ADATE<DATE) S PPD=1
"RTN","RMPR9DO",189,0)
 .S PPDAY=$$PWRKDAY^RMPREOU(RMPRA)
"RTN","RMPR9DO",190,0)
 S LINKED=$P($G(^RMPR(668,RMPRA,10,0)),U,4)
"RTN","RMPR9DO",191,0)
 I LINKED="" S LINKED=0
"RTN","RMPR9DO",192,0)
 ;
"RTN","RMPR9DO",193,0)
 I RMPROEOI="<!>" S WHO=RMPROEOI_WHO
"RTN","RMPR9DO",194,0)
 S ^TMP($J,RMPRA)=CDATE_U_WHO_U_SSN_U_TYPE_U_DES_U
"RTN","RMPR9DO",195,0)
 ;look at pday and parse
"RTN","RMPR9DO",196,0)
 S (HD1,HD2,HD3,HD4,HD5,DH6)=""
"RTN","RMPR9DO",197,0)
 ;SD Working Days in Pending Status
"RTN","RMPR9DO",198,0)
 S (SD1,SD2,SD3,SD4,SD5)=0
"RTN","RMPR9DO",199,0)
 I (PDAY>0)&(PDAY<6)!(PDAY=0) S HD1=PDAY,DH6="NO"
"RTN","RMPR9DO",200,0)
 I (PPDAY>0)&(PPDAY<6)!(PPDAY=0) S SD1=PPDAY
"RTN","RMPR9DO",201,0)
 I (PDAY>0)&(PDAY<6)&(TYPE["MANUAL")!(PDAY=0)&(TYPE["MANUAL") S MHD1=MHD1+1
"RTN","RMPR9DO",202,0)
 I (PDAY>0)&(PDAY<6)&(TYPE'["MANUAL")!(PDAY=0)&(TYPE'["MANUAL") S CHD1=CHD1+1
"RTN","RMPR9DO",203,0)
 I (PPDAY>0)&(PPDAY<6)&(STATUS["PENDING") S PPDD1=PPDD1+1
"RTN","RMPR9DO",204,0)
 I (PDAY>0)&(PDAY<6)&(PPD=1) S PPD1=PPD1+1
"RTN","RMPR9DO",205,0)
 I HD1=""  S HD1=0
"RTN","RMPR9DO",206,0)
 I (PDAY>5)&(PDAY<10) S HD2=PDAY,DH6="YES"
"RTN","RMPR9DO",207,0)
 I (PPDAY>5)&(PPDAY<10) S SD2=PPDAY
"RTN","RMPR9DO",208,0)
 I (PDAY>5)&(PDAY<10)&(TYPE["MANUAL") S MHD2=MHD2+1
"RTN","RMPR9DO",209,0)
 I (PDAY>5)&(PDAY<10)&(TYPE'["MANUAL") S CHD2=CHD2+1
"RTN","RMPR9DO",210,0)
 I (PPDAY>5)&(PPDAY<10)&(STATUS["PENDING") S PPDD2=PPDD2+1
"RTN","RMPR9DO",211,0)
 I (PDAY>5)&(PDAY<10)&(PPD=1) S PPD2=PPD2+1
"RTN","RMPR9DO",212,0)
 I HD2="" S HD2=0
"RTN","RMPR9DO",213,0)
 I (PDAY>9)&(PDAY<30) S HD3=PDAY,DH6="YES"
"RTN","RMPR9DO",214,0)
 I (PPDAY>9)&(PPDAY<30) S SD3=PPDAY
"RTN","RMPR9DO",215,0)
 I (PDAY>9)&(PDAY<30)&(TYPE["MANUAL") S MHD3=MHD3+1
"RTN","RMPR9DO",216,0)
 I (PDAY>9)&(PDAY<30)&(TYPE'["MANUAL") S CHD3=CHD3+1
"RTN","RMPR9DO",217,0)
 I (PPDAY>9)&(PPDAY<30)&(STATUS["PENDING") S PPDD3=PPDD3+1
"RTN","RMPR9DO",218,0)
 I (PDAY>9)&(PDAY<30)&(PPD=1) S PPD3=PPD3+1
"RTN","RMPR9DO",219,0)
 I HD3="" S HD3=0
"RTN","RMPR9DO",220,0)
 I (PDAY>29)&(PDAY<90) S HD4=PDAY,DH6="YES"
"RTN","RMPR9DO",221,0)
 I (PPDAY>29)&(PPDAY<90) S SD4=PPDAY
"RTN","RMPR9DO",222,0)
 I (PDAY>29)&(PDAY<90)&(TYPE["MANUAL") S MHD4=MHD4+1
"RTN","RMPR9DO",223,0)
 I (PDAY>29)&(PDAY<90)&(TYPE'["MANUAL") S CHD4=CHD4+1
"RTN","RMPR9DO",224,0)
 I (PPDAY>29)&(PPDAY<90)&(STATUS["PENDING") S PPDD4=PPDD4+1
"RTN","RMPR9DO",225,0)
 I (PDAY>29)&(PDAY<90)&(PPD=1) S PPD4=PPD4+1
"RTN","RMPR9DO",226,0)
 I HD4="" S HD4=0
"RTN","RMPR9DO",227,0)
 I PDAY>89 S HD5=PDAY,DH6="YES"
"RTN","RMPR9DO",228,0)
 I PPDAY>89 S SD5=PPDAY
"RTN","RMPR9DO",229,0)
 I (PDAY>89)&(TYPE["MANUAL") S MHD5=MHD5+1
"RTN","RMPR9DO",230,0)
 I (PDAY>89)&(TYPE'["MANUAL") S CHD5=CHD5+1
"RTN","RMPR9DO",231,0)
 I (PPDAY>89)&(STATUS["PENDING") S PPDD5=PPDD5+1
"RTN","RMPR9DO",232,0)
 I (PDAY>89)&(PPD=1) S PPD5=PPD5+1
"RTN","RMPR9DO",233,0)
 I HD5="" S HD5=0
"RTN","RMPR9DO",234,0)
 S (PPD,PPDAY)=0
"RTN","RMPR9DO",235,0)
 I LINKED'=0&(TYPE["MANUAL") S MLNK=MLNK+1
"RTN","RMPR9DO",236,0)
 I LINKED'=0&(TYPE'["MANUAL") S CLNK=CLNK+1
"RTN","RMPR9DO",237,0)
 S ^TMP($J,RMPRA)=^TMP($J,RMPRA)_STOPDT_U_DH6_U_HD1_U_HD2_U_HD3_U_HD4_U_HD5
"RTN","RMPR9DO",238,0)
 S ^TMP($J,RMPRA)=^TMP($J,RMPRA)_U_STATUS_U_RMPRA_U_STNX_U_LINKED
"RTN","RMPR9DO",239,0)
 S ^TMP($J,RMPRA)=^TMP($J,RMPRA)_U_U_SD1_U_SD2_U_SD3_U_SD4_U_SD5
"RTN","RMPR9DO",240,0)
 K CDATE,WHO,SSN,TYPE,DES,PDAY,STATUS,ADATE
"RTN","RMPR9DO",241,0)
 ;PUT RESULTS IN GLOBAL!!
"RTN","RMPR9DO",242,0)
 Q
"RTN","RMPR9DO",243,0)
EXIT ;common exit point
"RTN","RMPR9DO",244,0)
 S RESULT=$NA(^TMP($J))
"RTN","RMPR9DO",245,0)
 Q
"RTN","RMPR9DO",246,0)
MAIL ;send to PCM full dataset
"RTN","RMPR9DO",247,0)
 S XMY("G.RMPR SERVER")=""
"RTN","RMPR9DO",248,0)
 S XMY("G.PROSTHETICS@PSAS.MED.VA.GOV")=""
"RTN","RMPR9DO",249,0)
 S XMDUZ=.5
"RTN","RMPR9DO",250,0)
 S XMSUB="Full DOR From Station: "_STNX
"RTN","RMPR9DO",251,0)
 N LASTIEN
"RTN","RMPR9DO",252,0)
 S LASTIEN="A1",LASTIEN=$O(^TMP($J,LASTIEN),-1)
"RTN","RMPR9DO",253,0)
 S ^TMP($J,LASTIEN+1)=^TMP($J,"A1")
"RTN","RMPR9DO",254,0)
 S ^TMP($J,LASTIEN+2)=^TMP($J,"A2")
"RTN","RMPR9DO",255,0)
 S ^TMP($J,LASTIEN+3)=^TMP($J,"A3")
"RTN","RMPR9DO",256,0)
 S ^TMP($J,LASTIEN+4)=^TMP($J,"A4")
"RTN","RMPR9DO",257,0)
 K ^TMP($J,"A1")
"RTN","RMPR9DO",258,0)
 K ^TMP($J,"A2")
"RTN","RMPR9DO",259,0)
 K ^TMP($J,"A3")
"RTN","RMPR9DO",260,0)
 K ^TMP($J,"A4")
"RTN","RMPR9DO",261,0)
 S XMTEXT="^TMP($J,"
"RTN","RMPR9DO",262,0)
 D ^XMD
"RTN","RMPR9DO",263,0)
 Q
"RTN","RMPR9DO",264,0)
MAILG ;Mail message to local staff
"RTN","RMPR9DO",265,0)
 S XMDUZ=.5
"RTN","RMPR9DO",266,0)
 S XMY("G.RMPR SERVER")=""
"RTN","RMPR9DO",267,0)
 S XMY("VHACOPSASPIPReport@MED.VA.GOV")=""
"RTN","RMPR9DO",268,0)
 S XMSUB="DOR From Station: "_STNX
"RTN","RMPR9DO",269,0)
 S RMPRMSG(1)="The Automated Delayed Order Report has transmitted to Prosthetics HQ."
"RTN","RMPR9DO",270,0)
 S RMPRMSG(2)="This was activated by "_$P(XMFROM,"@",1)
"RTN","RMPR9DO",271,0)
 S RMPRMSG(3)=""
"RTN","RMPR9DO",272,0)
 S RMPRMSG(4)="Summary Data Transmitted, includes the following:"
"RTN","RMPR9DO",273,0)
 S RMPRMSG(5)="Totals for site "_STNX_" listed in the order of 0-5, 6-9, 10-29, 30-89, 90+"
"RTN","RMPR9DO",274,0)
 S RMPRMSG(6)="Seperated by ;"
"RTN","RMPR9DO",275,0)
 S RMPRMSG(7)="***Number of MANUALS      ;;"_STNX_";"_MHD1_";"_MHD2_";"_MHD3_";"_MHD4_";"_MHD5
"RTN","RMPR9DO",276,0)
 S RMPRMSG(8)="***Number of CONSULTS     ;;"_STNX_";"_CHD1_";"_CHD2_";"_CHD3_";"_CHD4_";"_CHD5
"RTN","RMPR9DO",277,0)
 S RMPRMSG(9)="***Minus Previous Pending ;;"_STNX_";"_PPD1_";"_PPD2_";"_PPD3_";"_PPD4_";"_PPD5
"RTN","RMPR9DO",278,0)
 S RMPRMSG(10)=""
"RTN","RMPR9DO",279,0)
 S XMTEXT="RMPRMSG("
"RTN","RMPR9DO",280,0)
 D ^XMD
"RTN","RMPR9DO",281,0)
 Q
"RTN","RMPRPAT3")
0^2^B41816871^B40605335
"RTN","RMPRPAT3",1,0)
RMPRPAT3 ;HINES-CIOFO/HNC,RVD - Detail Display Patient 10-2319 Transaction ;11/03/04
"RTN","RMPRPAT3",2,0)
 ;;3.0;PROSTHETICS;**3,12,25,28,32,41,69,92,99,90,162,163**;Feb 09, 1996;Build 9
"RTN","RMPRPAT3",3,0)
 ;
"RTN","RMPRPAT3",4,0)
 ; RVD 4/30/02 patch #69 - add ICD-9 CODE and description in the display.
"RTN","RMPRPAT3",5,0)
 ;                         add HCPCS and Short Description.
"RTN","RMPRPAT3",6,0)
 ; AAC 08/03/04 Patch 92 - Code Set Versioning (CSV)
"RTN","RMPRPAT3",7,0)
 ; RGB 09/14/10 Patch 163 - Add Suspense Date to appliance line item detail
"RTN","RMPRPAT3",8,0)
 ;Used API=ICDDX^ICDCODE to replace direct calls to global ICD9(80).
"RTN","RMPRPAT3",9,0)
 ;
"RTN","RMPRPAT3",10,0)
 ;expect ANS,IT(ANS)
"RTN","RMPRPAT3",11,0)
 ;          +IT(ANS)=ien of file 660
"RTN","RMPRPAT3",12,0)
 ;expect variables from GETPAT^RMPRUTIL
"RTN","RMPRPAT3",13,0)
 ;    RMPRSSNE (external form of SSN)
"RTN","RMPRPAT3",14,0)
 ;    RMPRNAM (name of patient)
"RTN","RMPRPAT3",15,0)
 ;    RMPRDOB
"RTN","RMPRPAT3",16,0)
 ;display detailed record
"RTN","RMPRPAT3",17,0)
PRINT ;called from RMPRPAT2
"RTN","RMPRPAT3",18,0)
 ;get 2319 transaction
"RTN","RMPRPAT3",19,0)
 ;
"RTN","RMPRPAT3",20,0)
 N DIC,DIQ,DR,DA,RMPRV,RMPRDA,RV,DESCRPT
"RTN","RMPRPAT3",21,0)
 S DIC=660,DIQ="R19",DR=".01:96",DIQ(0)="EN"
"RTN","RMPRPAT3",22,0)
 S (RMPRDA,DA)=+IT(ANS)
"RTN","RMPRPAT3",23,0)
 D EN^DIQ1
"RTN","RMPRPAT3",24,0)
 S DIQ="R19",DR=72,DIQ(0)="I" D EN^DIQ1
"RTN","RMPRPAT3",25,0)
 ;get vendor info
"RTN","RMPRPAT3",26,0)
 S DA=$P(^RMPR(660,RMPRDA,0),U,9)
"RTN","RMPRPAT3",27,0)
 I DA D
"RTN","RMPRPAT3",28,0)
 .S DIC=440,DIQ="RV",DR=".01:6",DIQ(0)="EN"
"RTN","RMPRPAT3",29,0)
 .S (RMPRV,DA)=$P(^RMPR(660,RMPRDA,0),U,9)
"RTN","RMPRPAT3",30,0)
 .D EN^DIQ1
"RTN","RMPRPAT3",31,0)
 ;
"RTN","RMPRPAT3",32,0)
 ;array defined for record in following format:
"RTN","RMPRPAT3",33,0)
 ;R19(filenumber,ien,field,E)=external form of data
"RTN","RMPRPAT3",34,0)
 ;RV(filenumber,ien,field,E)=external form of data
"RTN","RMPRPAT3",35,0)
 ;example:
"RTN","RMPRPAT3",36,0)
 ;R19(660,100,.01,"E")=APR 27, 1995
"RTN","RMPRPAT3",37,0)
 ;R19(660,100,.02,"E")=FUDGE,CHOCOLATE
"RTN","RMPRPAT3",38,0)
 ;RV(440,131,.01,"E")=ORTHOTIC LAB
"RTN","RMPRPAT3",39,0)
 ;
"RTN","RMPRPAT3",40,0)
 D HDR
"RTN","RMPRPAT3",41,0)
 W !,"TYPE OF FORM: ",$G(R19(660,RMPRDA,11,"E"))
"RTN","RMPRPAT3",42,0)
 W ?25,"INITIATOR: ",$G(R19(660,RMPRDA,27,"E"))
"RTN","RMPRPAT3",43,0)
 W ?55,"DATE: ",$G(R19(660,RMPRDA,1,"E"))
"RTN","RMPRPAT3",44,0)
 ;historical/original item
"RTN","RMPRPAT3",45,0)
 ;W !,"ITEM DESCRIPTION: ",$G(R19(660,RMPRDA,89,"E"))
"RTN","RMPRPAT3",46,0)
 W !,"DELIVER TO: ",$G(R19(660,RMPRDA,25,"E"))
"RTN","RMPRPAT3",47,0)
 W !,"TYPE TRANS: ",$G(R19(660,RMPRDA,2,"E"))
"RTN","RMPRPAT3",48,0)
 W ?30,"QTY: ",$G(R19(660,RMPRDA,5,"E"))
"RTN","RMPRPAT3",49,0)
 W:$G(R19(660,RMPRDA,29,"E")) ?40,"INVENTORY POINT: ",R19(660,RMPRDA,29,"E"),!
"RTN","RMPRPAT3",50,0)
 W ?40,"SOURCE: ",$G(R19(660,RMPRDA,12,"E"))
"RTN","RMPRPAT3",51,0)
 ;vendor tracking number
"RTN","RMPRPAT3",52,0)
 I $G(R19(660,RMPRDA,11,"E"))="VISA" D
"RTN","RMPRPAT3",53,0)
 .W !,"VENDOR TRACKING: ",$G(R19(660,RMPRDA,4.2,"E"))
"RTN","RMPRPAT3",54,0)
 .W ?38,"BANK AUTHORIZATION: ",$G(R19(660,RMPRDA,4.3,"E"))
"RTN","RMPRPAT3",55,0)
 W !,"VENDOR: ",?15,$G(R19(660,RMPRDA,7,"E"))
"RTN","RMPRPAT3",56,0)
 I $D(RV) D
"RTN","RMPRPAT3",57,0)
 .W !,"VENDOR PHONE: ",?15,$G(RV(440,RMPRV,5,"E"))
"RTN","RMPRPAT3",58,0)
 .W !?15,$G(RV(440,RMPRV,1,"E"))
"RTN","RMPRPAT3",59,0)
 .W !?15,$G(RV(440,RMPRV,4.2,"E")),","
"RTN","RMPRPAT3",60,0)
 .W ?$X+3,$G(RV(440,RMPRV,4.4,"E")),?$X+5,$G(RV(440,RMPRV,4.6,"E"))
"RTN","RMPRPAT3",61,0)
 W !,"DELIVERY DATE: "
"RTN","RMPRPAT3",62,0)
 I $D(R19(660,RMPRDA,10,"E")) W R19(660,RMPRDA,10,"E")
"RTN","RMPRPAT3",63,0)
 W ?40,"SUSPENSE DATE: " I $D(R19(660,RMPRDA,8.1,"E")) W R19(660,RMPRDA,8.1,"E")   ;Patch RMPR*3*163
"RTN","RMPRPAT3",64,0)
 W !
"RTN","RMPRPAT3",65,0)
 I '$P(IT(AN),U,3) D
"RTN","RMPRPAT3",66,0)
 .W "TOTAL COST: "
"RTN","RMPRPAT3",67,0)
 .I $G(R19(660,RMPRDA,14,"E"))'="" W "$"_$J(R19(660,RMPRDA,14,"E"),2)
"RTN","RMPRPAT3",68,0)
 .I $G(R19(660,RMPRDA,14,"E"))="" W $S($G(R19(660,RMPRDA,6,"E"))'="":"$"_$J(R19(660,RMPRDA,6,"E"),2),$G(R19(660,RMPRDA,48,"E"))'="":"$"_$J(R19(660,RMPRDA,48,"E"),2),1:"")
"RTN","RMPRPAT3",69,0)
 W ?30,"OBL: ",$G(R19(660,RMPRDA,23,"E"))
"RTN","RMPRPAT3",70,0)
 ;
"RTN","RMPRPAT3",71,0)
 ;lab data
"RTN","RMPRPAT3",72,0)
 I $D(^RMPR(660,RMPRDA,"LB")) D
"RTN","RMPRPAT3",73,0)
 .N DIC,DIQ,DR,L19,DA
"RTN","RMPRPAT3",74,0)
 .S (DA,RMPRLA)=$P(^RMPR(660,RMPRDA,"LB"),U,10)
"RTN","RMPRPAT3",75,0)
 .Q:DA=""
"RTN","RMPRPAT3",76,0)
 .S DIC=664.1,DIQ="L19",DR="15",DIQ(0)="E"
"RTN","RMPRPAT3",77,0)
 .D EN^DIQ1
"RTN","RMPRPAT3",78,0)
 .W !,"WORK ORDER: ",$G(R19(660,RMPRDA,71,"E"))
"RTN","RMPRPAT3",79,0)
 .W ?40,"RECEIVING STATION: ",$G(R19(660,RMPRDA,70,"E"))
"RTN","RMPRPAT3",80,0)
 .W !,"TECHNICIAN: ",$G(L19(664.1,RMPRLA,15,"E"))
"RTN","RMPRPAT3",81,0)
 .W !,"TOTAL LABOR HOURS: ",$G(R19(660,RMPRDA,45,"E"))
"RTN","RMPRPAT3",82,0)
 .W ?40,"TOTAL LABOR COST: ",$G(R19(660,RMPRDA,46,"E"))
"RTN","RMPRPAT3",83,0)
 .W !,"TOTAL MATERIAL COST: ",$G(R19(660,RMPRDA,47,"E"))
"RTN","RMPRPAT3",84,0)
 .W ?40,"TOTAL LAB COST: ",$G(R19(660,RMPRDA,48,"E"))
"RTN","RMPRPAT3",85,0)
 .W !,"COMPLETION DATE: ",$G(R19(660,RMPRDA,50,"E"))
"RTN","RMPRPAT3",86,0)
 .W ?40,"LAB REMARKS: ",$G(R19(660,RMPRDA,51,"E"))
"RTN","RMPRPAT3",87,0)
 W !,"REMARKS: ",?15,$G(R19(660,RMPRDA,16,"E"))
"RTN","RMPRPAT3",88,0)
 I $G(R19(660,RMPRDA,17.5,"E")) W ?40,"RETURN STATUS: ",R19(660,RMPRDA,17.5,"E")
"RTN","RMPRPAT3",89,0)
 ;
"RTN","RMPRPAT3",90,0)
 ;historical data
"RTN","RMPRPAT3",91,0)
 I $G(R19(660,RMPRDA,15,"E"))["*" D
"RTN","RMPRPAT3",92,0)
 .;include records that have been merged
"RTN","RMPRPAT3",93,0)
 .W !!,"HISTORICAL DATA",!
"RTN","RMPRPAT3",94,0)
 .Q:'$D(R19(660,RMPRDA,89))
"RTN","RMPRPAT3",95,0)
 .W !,?15,"ITEM: ",$G(R19(660,RMPRDA,89,"E"))
"RTN","RMPRPAT3",96,0)
 .W !,?15,"STATION: ",$G(R19(660,RMPRDA,90,"E"))
"RTN","RMPRPAT3",97,0)
 .W !,?15,"VENDOR: ",$G(R19(660,RMPRDA,91,"E")),"   PHONE: ",$G(R19(660,RMPRDA,92,"E"))
"RTN","RMPRPAT3",98,0)
 .W !,?23,$G(R19(660,RMPRDA,93,"E")),!,?23,$G(R19(660,RMPRDA,94,"E"))
"RTN","RMPRPAT3",99,0)
 .W "   ",$G(R19(660,RMPRDA,95,"E")),"  ",$G(R19(660,RMPRDA,96,"E"))
"RTN","RMPRPAT3",100,0)
 ;put in lab display here fields 45,46,47,48 and 51
"RTN","RMPRPAT3",101,0)
 ;lab amis
"RTN","RMPRPAT3",102,0)
 I $G(R19(660,RMPRDA,73,"E")) D
"RTN","RMPRPAT3",103,0)
 .W ?40,"ORTHOTICS LAB CODE: "
"RTN","RMPRPAT3",104,0)
 .W $S($D(R19(660,RMPRDA,74,"E")):R19(660,RMPRDA,74,"E"),$D(R19(660,RMPRDA,75,"E")):R19(660,RMPRDA,75,"E"),1:"")
"RTN","RMPRPAT3",105,0)
 .W !?40,"RESTORATIONS LAB CODE: "
"RTN","RMPRPAT3",106,0)
 .W $S($D(R19(660,RMPRDA,76,"E")):R19(660,RMPRDA,76,"E"),$D(R19(660,RMPRDA,77,"E")):R19(660,RMPRDA,77,"E"),1:"")
"RTN","RMPRPAT3",107,0)
 ;purchasing and issue from stock amis
"RTN","RMPRPAT3",108,0)
 W !,"DISABILITY SERVED: ",$G(R19(660,RMPRDA,62,"E"))
"RTN","RMPRPAT3",109,0)
 ;appliance/item information
"RTN","RMPRPAT3",110,0)
 ;historical/original item
"RTN","RMPRPAT3",111,0)
 W !,"ITEM DESCRIPTION: ",$G(R19(660,RMPRDA,89,"E"))
"RTN","RMPRPAT3",112,0)
 ;check for item description changes
"RTN","RMPRPAT3",113,0)
 I $G(R19(660,RMPRDA,89,"E"))'=$G(R19(660,RMPRDA,4,"E")) W !,"*** See Above For Original Item Description ***"
"RTN","RMPRPAT3",114,0)
 W !,"APPLIANCE: ",$G(R19(660,RMPRDA,4,"E"))
"RTN","RMPRPAT3",115,0)
 W !,"CONTRACT #: ",$G(R19(660,RMPRDA,38.7,"E"))
"RTN","RMPRPAT3",116,0)
 W !,"EXCLUDED/WAIVER: ",$G(R19(660,RMPRDA,38.1,"E"))
"RTN","RMPRPAT3",117,0)
 W !,"PSAS HCPCS: ",$G(R19(660,RMPRDA,4.5,"E"))
"RTN","RMPRPAT3",118,0)
 I $P($G(^RMPR(660,RMPRDA,1)),U,4) W ?22,$P($G(^RMPR(661.1,$P(^RMPR(660,RMPRDA,1),U,4),0)),U,2)
"RTN","RMPRPAT3",119,0)
 ;added by #69
"RTN","RMPRPAT3",120,0)
 ;
"RTN","RMPRPAT3",121,0)
 ; PATCH 92 - Code Set Versioning (CSV) changes below
"RTN","RMPRPAT3",122,0)
 ; AAC      - 08/03/04
"RTN","RMPRPAT3",123,0)
 ;
"RTN","RMPRPAT3",124,0)
 S (RMPRICD,RMPRIC9,RMPRCOD,RMPRDAT)="" S RMPRERR=0
"RTN","RMPRPAT3",125,0)
 S RMPRDAT=$P($G(^RMPR(660,RMPRDA,0)),U,1)
"RTN","RMPRPAT3",126,0)
 I $D(^RMPR(660,RMPRDA,10)) S RMPRIC9=$P(^RMPR(660,RMPRDA,10),U,8)
"RTN","RMPRPAT3",127,0)
 I RMPRIC9'="" D
"RTN","RMPRPAT3",128,0)
 .S RMPRICD=$$ICDDX^ICDCODE(RMPRIC9,RMPRDAT)
"RTN","RMPRPAT3",129,0)
 .S RMPRERR=$P(RMPRICD,U,1)
"RTN","RMPRPAT3",130,0)
 .I RMPRERR<0 W !,"ICD-9 Message: ",$P(RMPRICD,U,2)
"RTN","RMPRPAT3",131,0)
 W !,"ICD-9 Code: "
"RTN","RMPRPAT3",132,0)
 I $G(RMPRICD)'="" W $P(RMPRICD,U,2),?19,$E($P(RMPRICD,U,4),1,55) I $P(RMPRICD,U,10)'>0 W " ","** Inactive ** Date: " S Y=$P(RMPRICD,U,12) D DD^%DT W Y
"RTN","RMPRPAT3",133,0)
 ;
"RTN","RMPRPAT3",134,0)
 ; End of Patch 92
"RTN","RMPRPAT3",135,0)
 ;
"RTN","RMPRPAT3",136,0)
 W !,"CPT MODIFIER: ",$G(R19(660,RMPRDA,4.7,"E"))
"RTN","RMPRPAT3",137,0)
 ;set description and modify for SHIPPING CHARGE; patch RMPR*3.0*162
"RTN","RMPRPAT3",138,0)
 S DESCRPT=$G(R19(660,RMPRDA,24,"E")) S:$P(^RMPR(660,RMPRDA,0),U,17) DESCRPT="SHIPPING CHARGE"
"RTN","RMPRPAT3",139,0)
 W !,"DESCRIPTION: ",DESCRPT
"RTN","RMPRPAT3",140,0)
 W !,"EXTENDED DESCRIPTION: ",!
"RTN","RMPRPAT3",141,0)
 I $D(R19(660,RMPRDA,28)) D  G:$D(DUOUT)!$D(DTOUT) EX1
"RTN","RMPRPAT3",142,0)
 .N R28
"RTN","RMPRPAT3",143,0)
 .;command part of new standards
"RTN","RMPRPAT3",144,0)
 .MERGE R28=R19(660,RMPRDA,28)
"RTN","RMPRPAT3",145,0)
 .I $P($G(^RMPR(660,RMPRDA,"DES",0)),U,3)>1 N DIR S DIR(0)="E" D ^DIR Q:$D(DUOUT)!$D(DTOUT)  D HDR W !,"EXTENDED DESCRIPTION: ",!
"RTN","RMPRPAT3",146,0)
 .D EN^DDIOL(.R28)
"RTN","RMPRPAT3",147,0)
 ;NPPD key items consolidated, example L5300 limb order
"RTN","RMPRPAT3",148,0)
 I $P(IT(AN),U,3) W !!,"*** Return For DETAIL REPORT ***" N DIR S DIR(0)="E" D ^DIR G:$D(DUOUT)!$D(DTOUT) EX1  W @IOF D HDR,^RMPRPAT7
"RTN","RMPRPAT3",149,0)
 ;display work order if it is a 2529-3 form
"RTN","RMPRPAT3",150,0)
 ;must pass ien to file 664.1 NOT 664.2
"RTN","RMPRPAT3",151,0)
 I $G(R19(660,RMPRDA,72,"I"))'="" D  G EX1
"RTN","RMPRPAT3",152,0)
 .S DIR(0)="E" D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","RMPRPAT3",153,0)
 .S RMPRBCK=RMPRDA
"RTN","RMPRPAT3",154,0)
 .N DIC
"RTN","RMPRPAT3",155,0)
 .S RMPRDA=R19(660,RMPRBCK,72,"I")
"RTN","RMPRPAT3",156,0)
 .D DISP^RMPR293(RMPRDA)
"RTN","RMPRPAT3",157,0)
 .S RMPRDA=RMPRBCK K RMPRBCK
"RTN","RMPRPAT3",158,0)
 ;return from work order
"RTN","RMPRPAT3",159,0)
 G EXIT
"RTN","RMPRPAT3",160,0)
 ;
"RTN","RMPRPAT3",161,0)
HDR ;display heading
"RTN","RMPRPAT3",162,0)
 W @IOF,RMPRNAM,?30," SSN: "
"RTN","RMPRPAT3",163,0)
 W $E(RMPRSSN,1,3)_"-"_$E(RMPRSSN,4,5)_"-"_$E(RMPRSSN,6,10),?50
"RTN","RMPRPAT3",164,0)
 W $G(R19(660,RMPRDA,8,"E")),?70,"DOB: "
"RTN","RMPRPAT3",165,0)
 W $S(RMPRDOB:$E(RMPRDOB,4,5)_"-"_$E(RMPRDOB,6,7)_"-"_(1700+$E(RMPRDOB,1,3)),1:"Unknown")
"RTN","RMPRPAT3",166,0)
 W !?20,"APPLIANCE/REPAIR LINE ITEM DETAIL ",?70,"<4-",ANS,">",!
"RTN","RMPRPAT3",167,0)
 Q
"RTN","RMPRPAT3",168,0)
EXIT ;common exit point
"RTN","RMPRPAT3",169,0)
 I $Y>(IOSL-4) F  W ! Q:$Y>(IOSL-3)
"RTN","RMPRPAT3",170,0)
 N DIR S DIR(0)="E" D ^DIR
"RTN","RMPRPAT3",171,0)
 ;duout,dtout is evaluated in dis+1^rmprpat2
"RTN","RMPRPAT3",172,0)
EX1 ;back out through that point to clean up
"RTN","RMPRPAT3",173,0)
 K R19,RV,RMPRICD,RMPRIC9,RMPRICD,RMPRIC9,MSGICD,RMPRCOD,RMPRERR,RMPRDAT,Y W @IOF
"RTN","RMPRPAT3",174,0)
 Q
"RTN","RMPRPAT3",175,0)
 ;end
"RTN","RMPRPCE1")
0^1^B35212918^B30024794
"RTN","RMPRPCE1",1,0)
RMPRPCE1 ;HCIOFO/RVD - Prosthetics/PCE UPDATE UTILITY ;5/7/03  09:12
"RTN","RMPRPCE1",2,0)
 ;;3.0;PROSTHETICS;**62,69,77,78,146,163**;Feb 09, 1996;Build 9
"RTN","RMPRPCE1",3,0)
 ;
"RTN","RMPRPCE1",4,0)
 ;patch #69
"RTN","RMPRPCE1",5,0)
 ;RVD 4/10/02 - validate the length (16 c) of provisional diagnosis
"RTN","RMPRPCE1",6,0)
 ;              before filing.  Change Routine Prosthetic to ROUTINE
"RTN","RMPRPCE1",7,0)
 ;              Type of Request field in 660.
"RTN","RMPRPCE1",8,0)
 ;RVD 5/6/03 patch #77 - SET Consult Request Service field in #660.
"RTN","RMPRPCE1",9,0)
 ;                     - POST init for setting Consult Request Service. 
"RTN","RMPRPCE1",10,0)
 ;TH 9/29/03 Patch #78 - Add Billing Aware related fields.
"RTN","RMPRPCE1",11,0)
 ;
"RTN","RMPRPCE1",12,0)
 ;DBIA # 10060, Fileman read of file #200.
"RTN","RMPRPCE1",13,0)
 ;
"RTN","RMPRPCE1",14,0)
 ;This routine contains the code for updating file #660 and #668.
"RTN","RMPRPCE1",15,0)
 ;
"RTN","RMPRPCE1",16,0)
 ;RMIE60 - ien of file #660
"RTN","RMPRPCE1",17,0)
UP60(RMIE60,RMIE68,RMSUSTAT) ; update file #660.
"RTN","RMPRPCE1",18,0)
 D NEWVAR
"RTN","RMPRPCE1",19,0)
 S RMERR=0
"RTN","RMPRPCE1",20,0)
 S:RMSUSTAT="" RMSUSTAT=0
"RTN","RMPRPCE1",21,0)
 L +^RMPR(660,RMIE60):2
"RTN","RMPRPCE1",22,0)
 I $T=0 W !,"Someone else is Editing this entry!!!",! H 3 S RMERR=1 G UP60X
"RTN","RMPRPCE1",23,0)
 S RM680=$G(^RMPR(668,RMIE68,0))
"RTN","RMPRPCE1",24,0)
 S RM688=$G(^RMPR(668,RMIE68,8))
"RTN","RMPRPCE1",25,0)
 S RM6810=$G(^RMPR(668,RMIE68,10))
"RTN","RMPRPCE1",26,0)
 ;code here for 668 fields
"RTN","RMPRPCE1",27,0)
 S RMDATE=$P(RM680,U,1)  ;Suspense Date
"RTN","RMPRPCE1",28,0)
 S RMCODT=$P(RM680,U,5)  ;Completion Date
"RTN","RMPRPCE1",29,0)
 S RMINDT=$P(RM680,U,9)  ;Initial Action Date
"RTN","RMPRPCE1",30,0)
 S RMPRCO=$P(RM680,U,15) ;Consult
"RTN","RMPRPCE1",31,0)
 S RMDWRT=$P(RM680,U,16) ;Date RX Written
"RTN","RMPRPCE1",32,0)
 S RMSTAT=$P(RM680,U,7)  ;Station
"RTN","RMPRPCE1",33,0)
 S RMTRES=$P(RM680,U,8)  ;Type of Request
"RTN","RMPRPCE1",34,0)
 S RMTYRE=$S(RMTRES=1:"ROUTINE",RMTRES=2:"EYEGLASS",RMTRES=3:"CONTACT LENS",RMTRES=4:"OXYGEN",RMTRES=5:"MANUAL",1:"")
"RTN","RMPRPCE1",35,0)
 S RMREQU=$P(RM680,U,11) ;Requestor (Ordering Provider)
"RTN","RMPRPCE1",36,0)
 S RMSERV=""
"RTN","RMPRPCE1",37,0)
 ;I $G(RMREQU) D GETS^DIQ(200,RMREQU,"29","E","RMAA") S RMSERV=RMAA(200,RMREQU_",",29,"E")
"RTN","RMPRPCE1",38,0)
 S RMPRDI=$E($P(RM688,U,2),1,16) ;Provisional Diagnosis
"RTN","RMPRPCE1",39,0)
 S RMICD9=$P(RM688,U,3)   ;ICD9
"RTN","RMPRPCE1",40,0)
 ;
"RTN","RMPRPCE1",41,0)
 S RMDAT(660,RMIE60_",",8.1)=RMDATE    ;Suspense Date
"RTN","RMPRPCE1",42,0)
 S RMDAT(660,RMIE60_",",8.2)=RMDWRT    ;Date RX Written
"RTN","RMPRPCE1",43,0)
 S RMDAT(660,RMIE60_",",8.3)=RMINDT    ;Initial Action Date
"RTN","RMPRPCE1",44,0)
 S RMDAT(660,RMIE60_",",8.4)=RMCODT    ;Completion Date
"RTN","RMPRPCE1",45,0)
 S RMDAT(660,RMIE60_",",8.5)=RMTYRE    ;Type of Request
"RTN","RMPRPCE1",46,0)
 S RMDAT(660,RMIE60_",",8.6)=RMREQU    ;Ordering Provider
"RTN","RMPRPCE1",47,0)
 S RMDAT(660,RMIE60_",",8.61)=RMSERV   ;Consult Request Service
"RTN","RMPRPCE1",48,0)
 S RMDAT(660,RMIE60_",",8.7)=RMPRDI    ;Provisional Diagnosis
"RTN","RMPRPCE1",49,0)
 S RMDAT(660,RMIE60_",",8.8)=RMICD9    ;Suspense ICD9
"RTN","RMPRPCE1",50,0)
 S RMDAT(660,RMIE60_",",8.9)=RMPRCO    ;Pointer to Request/Consultation
"RTN","RMPRPCE1",51,0)
 S RMDAT(660,RMIE60_",",8.11)=RMSTAT   ;Suspense Station
"RTN","RMPRPCE1",52,0)
 S RMDAT(660,RMIE60_",",8.14)=RMSUSTAT ;Suspense Status
"RTN","RMPRPCE1",53,0)
 ;
"RTN","RMPRPCE1",54,0)
 ; Patch #78
"RTN","RMPRPCE1",55,0)
 ; #668,BA nodes
"RTN","RMPRPCE1",56,0)
 F RMPRL=1:1:99 S RM68BA=$G(^RMPR(668,RMIE68,"BA"_RMPRL)) Q:RM68BA=""  D
"RTN","RMPRPCE1",57,0)
 . N RMICD,RMAO,RMIR,RMSC,RMEC,RMMST,RMHNC,RMCBV
"RTN","RMPRPCE1",58,0)
 . S RMICD=$P(RM68BA,U,1)
"RTN","RMPRPCE1",59,0)
 . S RMAO=$P(RM68BA,U,2)
"RTN","RMPRPCE1",60,0)
 . S RMIR=$P(RM68BA,U,3)
"RTN","RMPRPCE1",61,0)
 . S RMSC=$P(RM68BA,U,4)
"RTN","RMPRPCE1",62,0)
 . S RMEC=$P(RM68BA,U,5)
"RTN","RMPRPCE1",63,0)
 . S RMMST=$P(RM68BA,U,6)
"RTN","RMPRPCE1",64,0)
 . S RMHNC=$P(RM68BA,U,7)
"RTN","RMPRPCE1",65,0)
 . S RMCBV=$P(RM68BA,U,8)
"RTN","RMPRPCE1",66,0)
 . N RMPTR
"RTN","RMPRPCE1",67,0)
 . S RMPTR=29+RMPRL
"RTN","RMPRPCE1",68,0)
 . S RMDAT(660,RMIE60_",",RMPTR)=RMICD
"RTN","RMPRPCE1",69,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".1")=RMAO
"RTN","RMPRPCE1",70,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".2")=RMIR
"RTN","RMPRPCE1",71,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".3")=RMSC
"RTN","RMPRPCE1",72,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".4")=RMEC
"RTN","RMPRPCE1",73,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".5")=RMMST
"RTN","RMPRPCE1",74,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".6")=RMHNC
"RTN","RMPRPCE1",75,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".7")=RMCBV
"RTN","RMPRPCE1",76,0)
 ;
"RTN","RMPRPCE1",77,0)
 D UPDATE^DIE("","RMDAT",,"RMERROR")
"RTN","RMPRPCE1",78,0)
 I $D(RMERROR) S RMERR=1 D ERR0
"RTN","RMPRPCE1",79,0)
 ;
"RTN","RMPRPCE1",80,0)
 L -^RMPR(660,RMIE60)
"RTN","RMPRPCE1",81,0)
UP60X ; exit point
"RTN","RMPRPCE1",82,0)
 Q RMERR
"RTN","RMPRPCE1",83,0)
 ;
"RTN","RMPRPCE1",84,0)
 ;RMIE60 = IEN of file #660.
"RTN","RMPRPCE1",85,0)
 ;RMIE68 = IEN of file #668.
"RTN","RMPRPCE1",86,0)
UP68(RMIE60,RMIE68,RMAMIS) ; update file #668.
"RTN","RMPRPCE1",87,0)
 D NEWVAR
"RTN","RMPRPCE1",88,0)
 S (RMI,RMERR)=0
"RTN","RMPRPCE1",89,0)
 ;S RMAMIS=$G(^RMPR(660,RMIE60,"AMS"))
"RTN","RMPRPCE1",90,0)
 I '$G(RMAMIS) D ERR8 S RMERR=1 G UP68X
"RTN","RMPRPCE1",91,0)
 ;L +^RMPR(668,RMIE68):2
"RTN","RMPRPCE1",92,0)
 ;I $T=0 W !,"Someone else is Editing this entry!!!",! H 3 S RMERR=1 G UP68X
"RTN","RMPRPCE1",93,0)
 I $D(^RMPR(668,RMIE68,10,"B",RMIE60)) G UP68X
"RTN","RMPRPCE1",94,0)
 S DA(1)=RMIE68 K DD,DO
"RTN","RMPRPCE1",95,0)
 S DIC="^RMPR(668,"_DA(1)_","_"10,",DIC(0)="L",DLAYGO=668,X=RMIE60
"RTN","RMPRPCE1",96,0)
 D FILE^DICN K DIC,X,DLAYGO,DD,DO
"RTN","RMPRPCE1",97,0)
 I Y=-1 S RMERR=1 D ERR8 G UNL68
"RTN","RMPRPCE1",98,0)
 I $D(^RMPR(668,RMIE68,11,"B",RMAMIS)) G UP68X
"RTN","RMPRPCE1",99,0)
 S DA(1)=RMIE68
"RTN","RMPRPCE1",100,0)
 S DIC="^RMPR(668,"_DA(1)_","_"11,",DIC(0)="L",DLAYGO=668,X=RMAMIS
"RTN","RMPRPCE1",101,0)
 D FILE^DICN K DIC
"RTN","RMPRPCE1",102,0)
 I Y=-1 S RMERR=1 D ERR8 G UNL68
"RTN","RMPRPCE1",103,0)
 ;
"RTN","RMPRPCE1",104,0)
UNL68 ;L -^RMPR(668,RMIE68)
"RTN","RMPRPCE1",105,0)
UP68X ; exit point
"RTN","RMPRPCE1",106,0)
 Q RMERR
"RTN","RMPRPCE1",107,0)
 ;
"RTN","RMPRPCE1",108,0)
ERR0 ;error updating file #660
"RTN","RMPRPCE1",109,0)
 W !,"*** Error updating file #660 in PCE module!!!",!
"RTN","RMPRPCE1",110,0)
 Q
"RTN","RMPRPCE1",111,0)
ERR8 ;error updating file #668
"RTN","RMPRPCE1",112,0)
 W !,"*** Error updating file #668 in PCE module!!!",!
"RTN","RMPRPCE1",113,0)
 Q
"RTN","RMPRPCE1",114,0)
LINK ;link 2319 to suspense
"RTN","RMPRPCE1",115,0)
 N IEN660,XIEN,CTR,R10
"RTN","RMPRPCE1",116,0)
 D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPRPCE1",117,0)
 K ^TMP($J)
"RTN","RMPRPCE1",118,0)
 ;Patch RMPR*3.0*163 will first find the patient in the suspense file to insure there are unlinked transactions, message/exit if not
"RTN","RMPRPCE1",119,0)
 ;if unlinked transactions it will then make call to file 660 to display available items to be linked
"RTN","RMPRPCE1",120,0)
 D GETPAT^RMPRUTIL G:$D(X) EXIT
"RTN","RMPRPCE1",121,0)
 S IEN660=+DFN,XIEN=0,CTR=0
"RTN","RMPRPCE1",122,0)
 F I=1:1 S XIEN=$O(^RMPR(660,"C",IEN660,XIEN)) Q:XIEN=""  S R10=$G(^RMPR(660,XIEN,10)) I R10'="",$P(R10,U,14)'=1,$D(^RMPR(660,XIEN,"AMS")),RMPR("STA")=$P($G(^RMPR(660,XIEN,0)),U,10) S CTR=1 Q
"RTN","RMPRPCE1",123,0)
 I CTR'=1 W !,?2,$C(7),">> NO patient unlinked items available to be posted to Suspense, hit return" R CTR:15 G EXIT
"RTN","RMPRPCE1",124,0)
 W ! S DIC="^RMPR(660,",DIC(0)="EQZ",D="C",X=+DFN
"RTN","RMPRPCE1",125,0)
 S DIC("S")="S RMZ=$G(^RMPR(660,+Y,10)) I $P(RMZ,U,14)'=1,$D(^(""AMS"")),RMPR(""STA"")=$P(^(0),U,10)"
"RTN","RMPRPCE1",126,0)
 S DIC("W")="D EN^RMPRD1"
"RTN","RMPRPCE1",127,0)
 W !
"RTN","RMPRPCE1",128,0)
 D IX^DIC G:Y'>0 EXIT
"RTN","RMPRPCE1",129,0)
 L +^RMPR(660,+Y):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRPCE1",130,0)
 S RMPRDA=+Y
"RTN","RMPRPCE1",131,0)
 S RMPRDFN=$P(^RMPR(660,+Y,0),U,2)
"RTN","RMPRPCE1",132,0)
 I $D(^RMPR(660,+Y,"AMS")) N RMPRAMIS S RMPRAMIS=$P(^RMPR(660,+Y,"AMS"),U,1)
"RTN","RMPRPCE1",133,0)
 S ^TMP($J,"RMPRPCE",660,+Y)=RMPRAMIS_"^"_RMPRDFN
"RTN","RMPRPCE1",134,0)
 D LINK^RMPRS
"RTN","RMPRPCE1",135,0)
 I $G(RMPRDA)="" S RMPRDA=$O(^TMP($J,"RMPRPCE",660,0))
"RTN","RMPRPCE1",136,0)
 I $G(RMPRDA)="" L  G EXIT
"RTN","RMPRPCE1",137,0)
 L -^RMPR(660,RMPRDA)
"RTN","RMPRPCE1",138,0)
EXIT ;quit
"RTN","RMPRPCE1",139,0)
 K ^TMP($J)
"RTN","RMPRPCE1",140,0)
 K RMPR,RMPRSTE
"RTN","RMPRPCE1",141,0)
 K RMCODT
"RTN","RMPRPCE1",142,0)
 D KILL^XUSCLEAN
"RTN","RMPRPCE1",143,0)
 Q
"RTN","RMPRPCE1",144,0)
 ;
"RTN","RMPRPCE1",145,0)
SCRS ;set consult request service.
"RTN","RMPRPCE1",146,0)
 ;start conversion on 1/1/2002, the date of PCE/Link to suspense patch.
"RTN","RMPRPCE1",147,0)
 W !!,"Setting Consult Request Service in file #660....."
"RTN","RMPRPCE1",148,0)
 N RI,RJ F RI=3020100:0 S RI=$O(^RMPR(660,"B",RI)) Q:RI'>0  F RJ=0:0 S RJ=$O(^RMPR(660,"B",RI,RJ)) Q:RJ'>0  I $D(^RMPR(660,RJ,10)) D
"RTN","RMPRPCE1",149,0)
 .K RMAA
"RTN","RMPRPCE1",150,0)
 .S RMREQU=$P(^RMPR(660,RJ,10),U,6)
"RTN","RMPRPCE1",151,0)
 .S RMSERV=""
"RTN","RMPRPCE1",152,0)
 .I $G(RMREQU) D GETS^DIQ(200,RMREQU,"29","E","RMAA") S RMSERV=RMAA(200,RMREQU_",",29,"E")
"RTN","RMPRPCE1",153,0)
 .S:RMSERV'="" $P(^RMPR(660,RJ,4),U,3)=RMSERV
"RTN","RMPRPCE1",154,0)
 W !!,"Done setting Consult Request Service!!",!
"RTN","RMPRPCE1",155,0)
 Q
"RTN","RMPRPCE1",156,0)
 ;
"RTN","RMPRPCE1",157,0)
NEWVAR N DA,DIE,DIC,I,J,RMDFN,RMI,RMDATE,RM680,RM688,RM6810,RMERROR
"RTN","RMPRPCE1",158,0)
 N RMERR,RMCHK,RMAMIS,DLAYGO,X,DR,RMAA,RMSERV,RMREQU,RMDAT
"RTN","RMPRPCE1",159,0)
 N RMPRL,RM68BA,RMDWRT,RMICD9,RMINDT,RMPRCO,RMPRDI,RMSTAT,RMTRES,RMTYRE
"RTN","RMPRPCE1",160,0)
 Q
"RTN","RMPRPIFD")
0^3^B7240804^B6492459
"RTN","RMPRPIFD",1,0)
RMPRPIFD ;PHX/RFM,RGB-DELETE ISSUE FROM STOCK ;8/27/07  07:27
"RTN","RMPRPIFD",2,0)
 ;;3.0;PROSTHETICS;**139,163**;Feb 09, 1996;Build 9
"RTN","RMPRPIFD",3,0)
 ; RVD #61 - phase III of PIP enhancement.
"RTN","RMPRPIFD",4,0)
 ;
"RTN","RMPRPIFD",5,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RMPRPIFD",6,0)
DEL1 ;ENTRY POINT TO DELETE AN ISSUE FROM STOCK
"RTN","RMPRPIFD",7,0)
 K DIR N ITEMIEN,RITEM,ITEMCK,ITEMSTA,ITEMLOC
"RTN","RMPRPIFD",8,0)
 S DIR("A")="Are you sure you want to DELETE this entry",DIR("B")="N",DIR(0)="Y"
"RTN","RMPRPIFD",9,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT)!$D(DIRUT) G EXIT
"RTN","RMPRPIFD",10,0)
 I Y'=1 G CO^RMPRPIYE
"RTN","RMPRPIFD",11,0)
 ;
"RTN","RMPRPIFD",12,0)
DEL1A ;ASK IF INACTIVE ITEM
"RTN","RMPRPIFD",13,0)
 S ITEMSTA=$P(R1(0),U,10),ITEMLOC=$P(R1(1),U,5)
"RTN","RMPRPIFD",14,0)
DEL1B S ITEMIEN=$O(^RMPR(661.11,"ASHI",ITEMSTA,$P(RMIT,"-"),$P(RMIT,"-",2),0))
"RTN","RMPRPIFD",15,0)
 ;Patch RMPR*3.0*163 prevents user from deleting a previous issue if the HCPCS item has been removed
"RTN","RMPRPIFD",16,0)
 I ITEMIEN="" D  G EXIT
"RTN","RMPRPIFD",17,0)
 . W !!,"  *** Scanned HCPCS has been deleted from HCPCS Item Master (ASHI). CANNOT delete previous issue." R X:4 W !
"RTN","RMPRPIFD",18,0)
 D  G:ITEMCK=0 EXIT G:ITEMCK=1 DEL2
"RTN","RMPRPIFD",19,0)
 . S ITEMCK=0,RITEM=^RMPR(661.11,ITEMIEN,0)
"RTN","RMPRPIFD",20,0)
 . I $P(RITEM,U,9)'=1 S ITEMCK=1 Q
"RTN","RMPRPIFD",21,0)
 . S DIR("A")="Scanned item is inactive, reactivate?",DIR("B")="N",DIR(0)="Y"
"RTN","RMPRPIFD",22,0)
 . D ^DIR I $D(DTOUT)!$D(DUOUT)!$D(DIRUT) S ITEMCK=0 Q
"RTN","RMPRPIFD",23,0)
 . I Y'=1 S ITEMCK=1 Q
"RTN","RMPRPIFD",24,0)
 . S $P(^RMPR(661.11,ITEMIEN,0),U,9)=0,$P(^RMPR(661.11,ITEMIEN,0),U,10)="",ITEMCK=2
"RTN","RMPRPIFD",25,0)
 ;ask to reset ROP to zero
"RTN","RMPRPIFD",26,0)
 S DIR("A")="Scanned item Is now ACTIVE, set ROP to zero?",DIR("B")="N",DIR(0)="Y"
"RTN","RMPRPIFD",27,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT)!$D(DIRUT) G DEL2
"RTN","RMPRPIFD",28,0)
 I Y'=1 G DEL2
"RTN","RMPRPIFD",29,0)
 I 'ITEMSTA!'ITEMLOC G DEL2
"RTN","RMPRPIFD",30,0)
 S ITEMLOC=$P($G(^RMPR(661.6,ITEMLOC,0)),U,14) G:'ITEMLOC DEL2
"RTN","RMPRPIFD",31,0)
 S ITEMIEN=$O(^RMPR(661.4,"ASLHI",ITEMSTA,ITEMLOC,$P(RMIT,"-"),$P(RMIT,"-",2),0)) G:'ITEMIEN DEL2
"RTN","RMPRPIFD",32,0)
 S $P(^RMPR(661.4,ITEMIEN,0),U,4)=0
"RTN","RMPRPIFD",33,0)
 ;
"RTN","RMPRPIFD",34,0)
DEL2 ;call API for returning item to PIP
"RTN","RMPRPIFD",35,0)
 K RITEM,ITEMCK,ITEMIEN,ITEMSTA,ITEMLOC
"RTN","RMPRPIFD",36,0)
 S (RMCHK,RMERPCE)=0
"RTN","RMPRPIFD",37,0)
 S RMI68=$P($G(^RMPR(660,RMPRIEN,10)),U,1) I RMI68>0 D  I RMERPCE W !!,"** STOCK ISSUE DELETE ABORTED",!! G EXIT
"RTN","RMPRPIFD",38,0)
 .S RMCHK=$$DEL^RMPRPCED(RMPRIEN)
"RTN","RMPRPIFD",39,0)
 .I RMCHK'=0 W !!,"*** ERROR in PCE DELETE, Please notify your IRM..660 IEN = ",RMPRIEN,!! S RMERPCE=1 H 3
"RTN","RMPRPIFD",40,0)
 S RMPR60("IEN")=RMPRIEN
"RTN","RMPRPIFD",41,0)
 S RMCHK=$$DEL^RMPRPIU3(.RMPR60)
"RTN","RMPRPIFD",42,0)
 I $G(RMCHK) W !,"*** Error in API RMPRPIU3, ERROR = ",RMCHK,!,"*** Please inform your IRM !!",! G EXIT
"RTN","RMPRPIFD",43,0)
 ;
"RTN","RMPRPIFD",44,0)
 W $C(7),!?10,"Deleted..." H 1
"RTN","RMPRPIFD",45,0)
EXIT ;KILL VARIABLES AND EXIT ROUTINE
"RTN","RMPRPIFD",46,0)
 I $G(RMPRIEN),$D(^RMPR(660,RMPRIEN)) L -^RMPR(660,RMPRIEN)
"RTN","RMPRPIFD",47,0)
 K ^TMP($J) N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPRPIFD",48,0)
 Q
"RTN","RMPRPIFD",49,0)
 ;
"VER")
8.0^22.0
"BLD",7739,6)
^148
**END**
**END**
