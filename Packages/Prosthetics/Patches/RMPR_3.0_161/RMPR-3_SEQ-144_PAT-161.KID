Released RMPR*3*161 SEQ #144
Extracted from mail message
**KIDS**:RMPR*3.0*161^

**INSTALL NAME**
RMPR*3.0*161
"BLD",7710,0)
RMPR*3.0*161^PROSTHETICS^0^3110127^y
"BLD",7710,1,0)
^^10^10^3110127^
"BLD",7710,1,1,0)
1. Add new field #1.3 (VERSION DATE) to file #661.1 [PROSTHETIC HCPCS] to
"BLD",7710,1,2,0)
   facilitate synchronization of HCPCS (Healthcare Common Procedure 
"BLD",7710,1,3,0)
   Coding System) code update between VISTA Prosthetics GUI and an 
"BLD",7710,1,4,0)
   enterprise asset management system.
"BLD",7710,1,5,0)
 
"BLD",7710,1,6,0)
2. Site received a subscript error in option Issue from Stock due to 
"BLD",7710,1,7,0)
   incomplete inventory item bar code scan.
"BLD",7710,1,8,0)
 
"BLD",7710,1,9,0)
3. When reprinting Purchase Order on Vista a Patient Notification letter
"BLD",7710,1,10,0)
   prints showing the patient social security number.
"BLD",7710,4,0)
^9.64PA^661.1^1
"BLD",7710,4,661.1,0)
661.1
"BLD",7710,4,661.1,2,0)
^9.641^661.1^1
"BLD",7710,4,661.1,2,661.1,0)
PROSTHETIC HCPCS  (File-top level)
"BLD",7710,4,661.1,2,661.1,1,0)
^9.6411^1.3^1
"BLD",7710,4,661.1,2,661.1,1,1.3,0)
VERSION DATE
"BLD",7710,4,661.1,222)
y^n^p^^^^n^^n
"BLD",7710,4,661.1,224)

"BLD",7710,4,"APDD",661.1,661.1)

"BLD",7710,4,"APDD",661.1,661.1,1.3)

"BLD",7710,4,"B",661.1,661.1)

"BLD",7710,6.3)
2
"BLD",7710,"ABPKG")
n
"BLD",7710,"KRN",0)
^9.67PA^779.2^20
"BLD",7710,"KRN",.4,0)
.4
"BLD",7710,"KRN",.401,0)
.401
"BLD",7710,"KRN",.402,0)
.402
"BLD",7710,"KRN",.403,0)
.403
"BLD",7710,"KRN",.5,0)
.5
"BLD",7710,"KRN",.84,0)
.84
"BLD",7710,"KRN",3.6,0)
3.6
"BLD",7710,"KRN",3.8,0)
3.8
"BLD",7710,"KRN",9.2,0)
9.2
"BLD",7710,"KRN",9.8,0)
9.8
"BLD",7710,"KRN",9.8,"NM",0)
^9.68A^5^2
"BLD",7710,"KRN",9.8,"NM",4,0)
RMPRPIYS^^0^B86506085
"BLD",7710,"KRN",9.8,"NM",5,0)
RMPR4P24^^0^B10064106
"BLD",7710,"KRN",9.8,"NM","B","RMPR4P24",5)

"BLD",7710,"KRN",9.8,"NM","B","RMPRPIYS",4)

"BLD",7710,"KRN",19,0)
19
"BLD",7710,"KRN",19.1,0)
19.1
"BLD",7710,"KRN",101,0)
101
"BLD",7710,"KRN",409.61,0)
409.61
"BLD",7710,"KRN",771,0)
771
"BLD",7710,"KRN",779.2,0)
779.2
"BLD",7710,"KRN",870,0)
870
"BLD",7710,"KRN",8989.51,0)
8989.51
"BLD",7710,"KRN",8989.52,0)
8989.52
"BLD",7710,"KRN",8994,0)
8994
"BLD",7710,"KRN","B",.4,.4)

"BLD",7710,"KRN","B",.401,.401)

"BLD",7710,"KRN","B",.402,.402)

"BLD",7710,"KRN","B",.403,.403)

"BLD",7710,"KRN","B",.5,.5)

"BLD",7710,"KRN","B",.84,.84)

"BLD",7710,"KRN","B",3.6,3.6)

"BLD",7710,"KRN","B",3.8,3.8)

"BLD",7710,"KRN","B",9.2,9.2)

"BLD",7710,"KRN","B",9.8,9.8)

"BLD",7710,"KRN","B",19,19)

"BLD",7710,"KRN","B",19.1,19.1)

"BLD",7710,"KRN","B",101,101)

"BLD",7710,"KRN","B",409.61,409.61)

"BLD",7710,"KRN","B",771,771)

"BLD",7710,"KRN","B",779.2,779.2)

"BLD",7710,"KRN","B",870,870)

"BLD",7710,"KRN","B",8989.51,8989.51)

"BLD",7710,"KRN","B",8989.52,8989.52)

"BLD",7710,"KRN","B",8994,8994)

"BLD",7710,"QUES",0)
^9.62^^
"BLD",7710,"REQB",0)
^9.611^3^2
"BLD",7710,"REQB",1,0)
RMPR*3.0*128^2
"BLD",7710,"REQB",3,0)
RMPR*3.0*55^2
"BLD",7710,"REQB","B","RMPR*3.0*128",1)

"BLD",7710,"REQB","B","RMPR*3.0*55",3)

"FIA",661.1)
PROSTHETIC HCPCS
"FIA",661.1,0)
^RMPR(661.1,
"FIA",661.1,0,0)
661.1I
"FIA",661.1,0,1)
y^n^p^^^^n^^n
"FIA",661.1,0,10)

"FIA",661.1,0,11)

"FIA",661.1,0,"RLRO")

"FIA",661.1,0,"VR")
3.0^RMPR
"FIA",661.1,661.1)
1
"FIA",661.1,661.1,1.3)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
161^3110127
"PKG",101,22,1,"PAH",1,1,0)
^^10^10^3110127
"PKG",101,22,1,"PAH",1,1,1,0)
1. Add new field #1.3 (VERSION DATE) to file #661.1 [PROSTHETIC HCPCS] to
"PKG",101,22,1,"PAH",1,1,2,0)
   facilitate synchronization of HCPCS (Healthcare Common Procedure 
"PKG",101,22,1,"PAH",1,1,3,0)
   Coding System) code update between VISTA Prosthetics GUI and an 
"PKG",101,22,1,"PAH",1,1,4,0)
   enterprise asset management system.
"PKG",101,22,1,"PAH",1,1,5,0)
 
"PKG",101,22,1,"PAH",1,1,6,0)
2. Site received a subscript error in option Issue from Stock due to 
"PKG",101,22,1,"PAH",1,1,7,0)
   incomplete inventory item bar code scan.
"PKG",101,22,1,"PAH",1,1,8,0)
 
"PKG",101,22,1,"PAH",1,1,9,0)
3. When reprinting Purchase Order on Vista a Patient Notification letter
"PKG",101,22,1,"PAH",1,1,10,0)
   prints showing the patient social security number.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RMPR4P24")
0^5^B10064106^B10145973
"RTN","RMPR4P24",1,0)
RMPR4P24 ;PHX/HPL-Print patient PC notification letter ;10/31/1994
"RTN","RMPR4P24",2,0)
 ;;3.0;PROSTHETICS;**3,20,55,161**;Feb 09, 1996;Build 2
"RTN","RMPR4P24",3,0)
 ;
"RTN","RMPR4P24",4,0)
 ; ODJ - patch 55 - 1/29/01 - replace hard coded mail route code 121
"RTN","RMPR4P24",5,0)
 ;                            with call to extrinsic for site param.
"RTN","RMPR4P24",6,0)
 ;                            see nois AUG-1097-32118
"RTN","RMPR4P24",7,0)
 ;
"RTN","RMPR4P24",8,0)
EN(RDA) ;SETUP VARIABLES AND PRINT PATIENT NOTIFICATION LETTER
"RTN","RMPR4P24",9,0)
 ;VARIABLE REQUIRED:RDA - ENTRY # IN FILE 664
"RTN","RMPR4P24",10,0)
 N VAHOW
"RTN","RMPR4P24",11,0)
 S NAME=$P(^RMPR(664,RDA,0),U,9),RMPRINIT=NAME,RMPREMP=$$SIG^RMPR31U(NAME)
"RTN","RMPR4P24",12,0)
 I $D(^VA(200,RMPRINIT,.13)) S RMPRPHON=$P(^VA(200,RMPRINIT,.13),U,2)
"RTN","RMPR4P24",13,0)
 I '$D(^VA(200,$P(^RMPR(664,RDA,0),U,9),.13)) S RMPRPHON=RMPR("PHONE")
"RTN","RMPR4P24",14,0)
 S DFN=$P(^RMPR(664,RDA,0),U,2) D ADD^VADPT,DEM^VADPT
"RTN","RMPR4P24",15,0)
 S RMPRITEM=""
"RTN","RMPR4P24",16,0)
 S RMPRITM=0 F LP=1:1 S RMPRITM=$O(^RMPR(664,RDA,1,RMPRITM)) Q:RMPRITM="B"  S RMPRITEM(LP)=$P(^RMPR(664,RDA,1,RMPRITM,0),U,2),RMPRITM(LP)=$P(^RMPR(664,RDA,1,RMPRITM,0),U,1)
"RTN","RMPR4P24",17,0)
 S HEADING="Department of Veterans Affairs"
"RTN","RMPR4P24",18,0)
 W !!!!!,?IOM-$L(HEADING)\2,HEADING
"RTN","RMPR4P24",19,0)
 S RMPRTAB=IOM-$L(RMPR("NAME"))\2 W !,?RMPRTAB,RMPR("NAME")
"RTN","RMPR4P24",20,0)
 S RMPRTAB=IOM-$L(RMPR("ADD"))\2 W !,?RMPRTAB,RMPR("ADD")
"RTN","RMPR4P24",21,0)
 S RMPRTAB=IOM-$L(RMPR("CITY"))\2 W !,?RMPRTAB,RMPR("CITY")
"RTN","RMPR4P24",22,0)
 S RMPRTAB=7 S NAME=VADM(1) S FIXDNAME=$$PARS^RMPRUTL1(NAME)
"RTN","RMPR4P24",23,0)
 W !!,?44,$$FMTE^XLFDT(DT,"D")
"RTN","RMPR4P24",24,0)
 S FIXDNAME=$E(FIXDNAME,2,$L(FIXDNAME)-2)
"RTN","RMPR4P24",25,0)
 W !!,?RMPRTAB,$S($P(VADM(5),U,1)["M":"MR. ",$P(VADM(5),U,1)["F":"MS. ",1:"")_$$UP^XLFSTR(FIXDNAME)
"RTN","RMPR4P24",26,0)
 W ?44,"In reply refer to: ",$P(^DIC(4,RMPR("STA"),99),U,1)_"/"_$$ROU^RMPRUTIL(RMPRSITE),!
"RTN","RMPR4P24",27,0)
 ;display purchase card transaction
"RTN","RMPR4P24",28,0)
 W:VAPA(1)'="" ?RMPRTAB,VAPA(1)
"RTN","RMPR4P24",29,0)
 W:VAPA(2)'="" ?RMPRTAB,VAPA(2)
"RTN","RMPR4P24",30,0)
 W ?44,"Accounting Symbol ",$P(^RMPR(664,RDA,4),U,5),!
"RTN","RMPR4P24",31,0)
 W:VAPA(3)'="" ?RMPRTAB,VAPA(3)
"RTN","RMPR4P24",32,0)
 W:VAPA(4)'="" ?RMPRTAB,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_VAPA(6)
"RTN","RMPR4P24",33,0)
 W ?44,"Veteran: ",VADM(1),!
"RTN","RMPR4P24",34,0)
 ; *161 removed old line which printed SSN
"RTN","RMPR4P24",35,0)
 W !!,?RMPRTAB,"Dear ",$S($P(VADM(5),"^",1)["M":"Mr. ",$P(VADM(5),"^",1)["F":"Ms. ",1:"")_FIXDNAME_","
"RTN","RMPR4P24",36,0)
 W !!,?RMPRTAB+0
"RTN","RMPR4P24",37,0)
 W "This is to notify you that the items listed below were ordered"
"RTN","RMPR4P24",38,0)
 W !,?RMPRTAB,"for you on "
"RTN","RMPR4P24",39,0)
 W $$FMTE^XLFDT($P(^RMPR(664,RDA,0),U,1),"D")_".  Delivery of this equipment is expected"
"RTN","RMPR4P24",40,0)
 W !,?RMPRTAB,$S($P($G(^RMPR(664,RDA,3)),U,2)'="":"on or about "_$$FMTE^XLFDT($P(^RMPR(664,RDA,3),U,2),"D")_".",1:"in 30 days from the order date.")
"RTN","RMPR4P24",41,0)
 W !!,?RMPRTAB,"If you do not receive it within 5 days of the expected date,"
"RTN","RMPR4P24",42,0)
 S LINE="please contact "_RMPREMP_", of my staff, at "_RMPRPHON_"."
"RTN","RMPR4P24",43,0)
 W $$RAP^RMPRUTL1(LINE,RMPRTAB)
"RTN","RMPR4P24",44,0)
ITEMS NEW DA
"RTN","RMPR4P24",45,0)
 W !
"RTN","RMPR4P24",46,0)
 S RMPRLAST=$P(^RMPR(664,RDA,1,0),U,4) F LP=1:1:RMPRLAST D
"RTN","RMPR4P24",47,0)
 .I $D(RMPRITEM(LP)) W !,?RMPRTAB+3,RMPRITEM(LP)
"RTN","RMPR4P24",48,0)
 .E  S RMPRITM=RMPRITM(LP) W !,?RMPRTAB+3,$$ITM^RMPR31U(RMPRITM)
"RTN","RMPR4P24",49,0)
 W !!,?RMPRTAB,"Sincerely,"
"RTN","RMPR4P24",50,0)
 W !!!!!,?RMPRTAB,RMPR("SIG")
"RTN","RMPR4P24",51,0)
 W !,?RMPRTAB,RMPR("SBT")
"RTN","RMPR4P24",52,0)
 W @IOF
"RTN","RMPR4P24",53,0)
 K RMPREMP,RMPRNAME,LINE Q " "
"RTN","RMPRPIYS")
0^4^B86506085^B84869709
"RTN","RMPRPIYS",1,0)
RMPRPIYS ;HINCIO/ODJ - RC - PIP Receive Stock ;10/8/02  13:11
"RTN","RMPRPIYS",2,0)
 ;;3.0;PROSTHETICS;**61,108,128,161**;Feb 09, 1996;Build 2
"RTN","RMPRPIYS",3,0)
 Q
"RTN","RMPRPIYS",4,0)
 ;
"RTN","RMPRPIYS",5,0)
 ;***** PB - Print Bar Code labels
"RTN","RMPRPIYS",6,0)
 ;           RMPR INV BAR CODE
"RTN","RMPRPIYS",7,0)
 ;           Callable from VISTA menu, no vars required other than
"RTN","RMPRPIYS",8,0)
 ;           global VISTA vars (DUZ, etc)
"RTN","RMPRPIYS",9,0)
 ;
"RTN","RMPRPIYS",10,0)
PB N RMPRERR,RMPRSTN,RMPRLCN,RMPREXC,RMPR1,RMPR11,RMPROVAL,RMPRNLAB
"RTN","RMPRPIYS",11,0)
 N RMPR6,RMPR7,RMPR7I,RMPRBARC,RMPRITXT,RMPRBCP,RMPRQ,RMPRIOP
"RTN","RMPRPIYS",12,0)
 ;
"RTN","RMPRPIYS",13,0)
 ;***** STN - prompt for Site/Station
"RTN","RMPRPIYS",14,0)
STN S RMPROVAL=$G(RMPRSTN("IEN"))
"RTN","RMPRPIYS",15,0)
 W @IOF S RMPRERR=$$STN^RMPRPIY1(.RMPRSTN,.RMPREXC)
"RTN","RMPRPIYS",16,0)
 I RMPRERR G PBX
"RTN","RMPRPIYS",17,0)
 I RMPREXC'="" G PBX
"RTN","RMPRPIYS",18,0)
 I RMPROVAL'=RMPRSTN("IEN") K RMPR1,RMPR11
"RTN","RMPRPIYS",19,0)
 ;
"RTN","RMPRPIYS",20,0)
 ;***** HCPCS - prompt for HCPCS and Item
"RTN","RMPRPIYS",21,0)
HCPCS W !!,"Print Bar code Labels for current inventory...",!
"RTN","RMPRPIYS",22,0)
HCPCS2 D HCPCS^RMPRPIY7(RMPRSTN("IEN"),$G(RMPR1("HCPCS")),.RMPR1,.RMPR11,.RMPREXC)
"RTN","RMPRPIYS",23,0)
 I RMPREXC="T" G PBX
"RTN","RMPRPIYS",24,0)
 I RMPREXC="P" G STN
"RTN","RMPRPIYS",25,0)
 I RMPREXC="^" D  G PBX
"RTN","RMPRPIYS",26,0)
 . W !,"** No HCPCS selected..." H 1
"RTN","RMPRPIYS",27,0)
 . Q
"RTN","RMPRPIYS",28,0)
 I $G(RMPR11("IEN"))'="" G HCPCS3A
"RTN","RMPRPIYS",29,0)
HCPCS3 D ITEM^RMPRPIYP(RMPRSTN("IEN"),RMPR1("HCPCS"),.RMPR11,.RMPREXC)
"RTN","RMPRPIYS",30,0)
 I RMPREXC="T" G PBX
"RTN","RMPRPIYS",31,0)
 I RMPREXC="P"!(RMPREXC="^") G HCPCS
"RTN","RMPRPIYS",32,0)
HCPCS3A S RMPR11("STATION")=RMPRSTN("IEN")
"RTN","RMPRPIYS",33,0)
 S RMPR11("STATION IEN")=RMPRSTN("IEN")
"RTN","RMPRPIYS",34,0)
 ;
"RTN","RMPRPIYS",35,0)
 ; display selected HCPCS and item and continue
"RTN","RMPRPIYS",36,0)
HCPCS4 W !!,"HCPCS: "_RMPR1("HCPCS")_" "_RMPR1("SHORT DESC")
"RTN","RMPRPIYS",37,0)
 W !!,"IFCAP Item: ",RMPR11("ITEM MASTER")
"RTN","RMPRPIYS",38,0)
 W !!,"PIP Item desc.: ",RMPR11("DESCRIPTION")
"RTN","RMPRPIYS",39,0)
 ;
"RTN","RMPRPIYS",40,0)
 ;***** CURST - call prompt for current stock record
"RTN","RMPRPIYS",41,0)
CURST S RMPRLCN=""
"RTN","RMPRPIYS",42,0)
 D PVEN^RMPRPIYR(RMPRSTN("IEN"),.RMPRLCN,RMPR11("HCPCS"),RMPR11("ITEM"),.RMPR6,.RMPR7,.RMPREXC)
"RTN","RMPRPIYS",43,0)
 I RMPREXC="T" G PBX
"RTN","RMPRPIYS",44,0)
 I RMPREXC="P" G HCPCS3
"RTN","RMPRPIYS",45,0)
 I RMPREXC="^" G HCPCS
"RTN","RMPRPIYS",46,0)
 I '+$G(RMPR7("QUANTITY")) D  G HCPCS2
"RTN","RMPRPIYS",47,0)
 . W !,"This item is not currently in stock.",!!
"RTN","RMPRPIYS",48,0)
 . Q
"RTN","RMPRPIYS",49,0)
 K RMPR7I
"RTN","RMPRPIYS",50,0)
 S RMPRERR=$$ETOI^RMPRPIX7(.RMPR7,.RMPR7I)
"RTN","RMPRPIYS",51,0)
 S RMPRBARC=RMPR11("HCPCS")_"-"_$P(RMPR7I("DATE&TIME"),".",1)_$P(RMPR7I("DATE&TIME"),".",2)
"RTN","RMPRPIYS",52,0)
 S RMPRITXT("DATE")=$E(RMPR7I("DATE&TIME"),4,5)_"/"_$E(RMPR7I("DATE&TIME"),6,7)_"/"_(1700+$E(RMPR7I("DATE&TIME"),1,3))
"RTN","RMPRPIYS",53,0)
 S RMPRITXT("ITEM")=RMPR11("HCPCS-ITEM")
"RTN","RMPRPIYS",54,0)
 S RMPRITXT("MASTER DESC")=RMPR11("ITEM MASTER")
"RTN","RMPRPIYS",55,0)
 S RMPRITXT("ITEM DESC")=RMPR11("DESCRIPTION")
"RTN","RMPRPIYS",56,0)
 S RMPRITXT("UNIT PRICE")=+$J(RMPR7("VALUE")/RMPR7("QUANTITY"),0,2)
"RTN","RMPRPIYS",57,0)
 S RMPRITXT("VENDOR")=RMPR6("VENDOR")
"RTN","RMPRPIYS",58,0)
 S RMPRITXT("LOCATION")=RMPR7("LOCATION")
"RTN","RMPRPIYS",59,0)
 ;
"RTN","RMPRPIYS",60,0)
 ;***** NLAB - call prompt for number of labels to print
"RTN","RMPRPIYS",61,0)
NLAB S RMPRNLAB=RMPR7("QUANTITY")
"RTN","RMPRPIYS",62,0)
 W ! D NLABP(.RMPRNLAB,RMPR7("QUANTITY"),.RMPREXC)
"RTN","RMPRPIYS",63,0)
 I RMPREXC="T" G PBX
"RTN","RMPRPIYS",64,0)
 I RMPREXC="P" G HCPCS
"RTN","RMPRPIYS",65,0)
 I RMPREXC="^" G HCPCS
"RTN","RMPRPIYS",66,0)
 ;
"RTN","RMPRPIYS",67,0)
 ;***** SELP - call prompt for bar code print device
"RTN","RMPRPIYS",68,0)
SELP D PRINT G HCPCS
"RTN","RMPRPIYS",69,0)
 G HCPCS
"RTN","RMPRPIYS",70,0)
PBX D KILL^XUSCLEAN
"RTN","RMPRPIYS",71,0)
 Q
"RTN","RMPRPIYS",72,0)
 ;
"RTN","RMPRPIYS",73,0)
 ;***** PRINT - print bar code labels
"RTN","RMPRPIYS",74,0)
 ;              requires RMPRNLAB (number of labels) and
"RTN","RMPRPIYS",75,0)
 ;                       RMPRBCP (bar code printer name) to be set
"RTN","RMPRPIYS",76,0)
 ;                       RMPRBARC (bar code to print)
"RTN","RMPRPIYS",77,0)
 ;                       RMPRIOP (the device to open)
"RTN","RMPRPIYS",78,0)
PRINT I '$D(RMPRNLAB) S RMPRNLAB=1
"RTN","RMPRPIYS",79,0)
 ;allows queing of bar code labels
"RTN","RMPRPIYS",80,0)
SELD S %ZIS("A")="Select Bar Code Printer: "
"RTN","RMPRPIYS",81,0)
 S %ZIS="QM" K IOP W ! D ^%ZIS G:POP PRINTX
"RTN","RMPRPIYS",82,0)
 I $G(IOST)'["P-ZEBRA" D
"RTN","RMPRPIYS",83,0)
 . W !!,"** WARNING - This is NOT a Zebra Bar Code Printer!!",!!
"RTN","RMPRPIYS",84,0)
 I '$D(IO("Q")) U IO G PNOW
"RTN","RMPRPIYS",85,0)
 K IO("Q") S ZTDESC="PRINT BAR CODE LABELS",ZTRTN="PNOW^RMPRPIYS"
"RTN","RMPRPIYS",86,0)
 S ZTIO=ION,ZTSAVE("RMPRBARC")="",ZTSAVE("RMPRITXT(")=""
"RTN","RMPRPIYS",87,0)
 S ZTSAVE("RMPRNLAB")="",ZTSAVE("RMPR(")="",ZTSAVE("RMPRSTN(")=""
"RTN","RMPRPIYS",88,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 2 G PRINTC
"RTN","RMPRPIYS",89,0)
 ;
"RTN","RMPRPIYS",90,0)
PNOW ;jump here if not queued.
"RTN","RMPRPIYS",91,0)
 D ZPLII^RMPRPI11(RMPRBARC,.RMPRITXT,RMPRNLAB)
"RTN","RMPRPIYS",92,0)
 S IONOFF=1
"RTN","RMPRPIYS",93,0)
PRINTC D ^%ZISC K IONOFF
"RTN","RMPRPIYS",94,0)
PRINTX Q
"RTN","RMPRPIYS",95,0)
 ;
"RTN","RMPRPIYS",96,0)
 ;***** NLABP - Number of labels prompt
"RTN","RMPRPIYS",97,0)
NLABP(RMPRNLAB,RMPRMAX,RMPREXC) ;
"RTN","RMPRPIYS",98,0)
 N RMPRERR,DIR,X,Y,DUOUT,DTOUT,DIROUT,DIRUT,DA
"RTN","RMPRPIYS",99,0)
 S RMPRNLAB=$G(RMPRNLAB)
"RTN","RMPRPIYS",100,0)
 S RMPRERR=0
"RTN","RMPRPIYS",101,0)
 S DIR(0)="NAO^1:"_RMPRMAX_":0"
"RTN","RMPRPIYS",102,0)
 S DIR("A")="Number of Labels to print: "
"RTN","RMPRPIYS",103,0)
 S:RMPRNLAB'="" DIR("B")=RMPRNLAB
"RTN","RMPRPIYS",104,0)
 S DIR("??")="^D NLABPH2^RMPRPIYS"
"RTN","RMPRPIYS",105,0)
 D ^DIR
"RTN","RMPRPIYS",106,0)
 I $D(DTOUT) S RMPREXC="T" G NLABPX
"RTN","RMPRPIYS",107,0)
 I $D(DIROUT) S RMPREXC="P" G NLABPX
"RTN","RMPRPIYS",108,0)
 I X=""!(X["^")!($D(DUOUT)) S RMPREXC="^" G NLABPX
"RTN","RMPRPIYS",109,0)
 S RMPREXC=""
"RTN","RMPRPIYS",110,0)
 S RMPRNLAB=+Y
"RTN","RMPRPIYS",111,0)
NLABPX Q
"RTN","RMPRPIYS",112,0)
NLABPH2 W "Type in the number of bar code labels you want to print for the",!
"RTN","RMPRPIYS",113,0)
 W "inventory item you have selected.",!
"RTN","RMPRPIYS",114,0)
 Q
"RTN","RMPRPIYS",115,0)
 ;
"RTN","RMPRPIYS",116,0)
 ;***** BARC - bar code prompt
"RTN","RMPRPIYS",117,0)
BARC(RMPRBARC,RMPREXC) ;
"RTN","RMPRPIYS",118,0)
 N RMPRERR,DIR,X,Y,DUOUT,DTOUT,DIROUT,DIRUT,DA
"RTN","RMPRPIYS",119,0)
 S RMPRBARC=""
"RTN","RMPRPIYS",120,0)
 S RMPREXC=""
"RTN","RMPRPIYS",121,0)
 S RMPRERR=0
"RTN","RMPRPIYS",122,0)
 S DIR(0)="FAO"
"RTN","RMPRPIYS",123,0)
 S DIR("A")="Scan in item bar code: "
"RTN","RMPRPIYS",124,0)
 S DIR("?")="^D BARCH^RMPRPIYS"
"RTN","RMPRPIYS",125,0)
BARC1 D ^DIR
"RTN","RMPRPIYS",126,0)
 I $D(DTOUT) S RMPREXC="T" G BARCX
"RTN","RMPRPIYS",127,0)
 I $D(DIROUT) S RMPREXC="P" G BARCX
"RTN","RMPRPIYS",128,0)
 I X["^"!($D(DUOUT)) S RMPREXC="^" G BARCX
"RTN","RMPRPIYS",129,0)
 I X="",$G(REDIT) G BARCX
"RTN","RMPRPIYS",130,0)
 I X="" G BARC1
"RTN","RMPRPIYS",131,0)
 S RMPRBARC=X
"RTN","RMPRPIYS",132,0)
BARCX Q
"RTN","RMPRPIYS",133,0)
BARCH W "If you have access to a bar code scanner, use it to scan the item bar code now.",!
"RTN","RMPRPIYS",134,0)
 W "Don't press the [Enter] key as the scanner should do this automatically.",!
"RTN","RMPRPIYS",135,0)
 W "If the scanner cannot read the bar code, type in the character sequence",!
"RTN","RMPRPIYS",136,0)
 W "immediately below the bar code.",!
"RTN","RMPRPIYS",137,0)
 ;W "If there is no bar code or you prefer to enter the transaction manually",!
"RTN","RMPRPIYS",138,0)
 ;W "leave this prompt blank.",!
"RTN","RMPRPIYS",139,0)
 Q
"RTN","RMPRPIYS",140,0)
 ;
"RTN","RMPRPIYS",141,0)
 ;***** SCAN - scan bar code and set up stock issue vars.
"RTN","RMPRPIYS",142,0)
 ;             (to be called by RMPRPIYI (too big))
"RTN","RMPRPIYS",143,0)
SCAN K RMPR7,RMPR7I,RMPR1,RMPR1I,RMPR11,RMPR11I,RMPR6,RMDAHC,RMITQTY
"RTN","RMPRPIYS",144,0)
SCAN1 D BARC(.RMPRBARC,.RMPREXC)
"RTN","RMPRPIYS",145,0)
 I RMPREXC'="" S RMPRBARC="" G SCANX
"RTN","RMPRPIYS",146,0)
 I RMPRBARC="" G SCANX
"RTN","RMPRPIYS",147,0)
 ;*161 added check to insure barcode scan or manual entry was valid HCPCS item entry
"RTN","RMPRPIYS",148,0)
 I $P(RMPRBARC,"-")="" W !,"** No HCPCS Selected due to null HCPCS entered..." G SCAN
"RTN","RMPRPIYS",149,0)
 S RMPRBARC=$$UPCASE(RMPRBARC)
"RTN","RMPRPIYS",150,0)
 ;
"RTN","RMPRPIYS",151,0)
 ; If we get a good bar code then populate all the fields and go
"RTN","RMPRPIYS",152,0)
 ; straight to the Post/Edit prompt
"RTN","RMPRPIYS",153,0)
 K RMPR7
"RTN","RMPRPIYS",154,0)
 S (RMPR7("STATION"),RMPRSTN)=RMPR("STA")
"RTN","RMPRPIYS",155,0)
 S RMPR7("HCPCS")=$P(RMPRBARC,"-",1)
"RTN","RMPRPIYS",156,0)
 S RMDAHC=$O(^RMPR(661.1,"B",RMPR7("HCPCS"),0))
"RTN","RMPRPIYS",157,0)
 I $G(RMDAHC),$D(^RMPR(661.1,RMDAHC,0)),($P(^RMPR(661.1,RMDAHC,0),U,5)'=1) S RMDAHC=$P(^RMPR(661.1,RMDAHC,0),U,3)
"RTN","RMPRPIYS",158,0)
 I '$G(RMDAHC) W !,"** No HCPCS Selected or Unable to Select Inactive HCPCS..." G SCAN
"RTN","RMPRPIYS",159,0)
 S RMPR7("DATE&TIME")=$E($P(RMPRBARC,"-",2),1,7)_"."_$E($P(RMPRBARC,"-",2),8,$L(RMPRBARC))
"RTN","RMPRPIYS",160,0)
 ;
"RTN","RMPRPIYS",161,0)
 ; look up current stock record with bar coded key fields
"RTN","RMPRPIYS",162,0)
 S RMPRERR=$$SCAN^RMPRPIUA(.RMPR7,.RMPREXC)
"RTN","RMPRPIYS",163,0)
 I $G(RMPR7("IEN"))="" W !,"*** The Item scanned is not available, please update your inventory !!!" G SCAN1
"RTN","RMPRPIYS",164,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",165,0)
 S RMPRERR=$$ETOI^RMPRPIX7(.RMPR7,.RMPR7I)
"RTN","RMPRPIYS",166,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",167,0)
 S R1("DATE&TIME")=$G(RMPR7I("DATE&TIME"))
"RTN","RMPRPIYS",168,0)
 S $P(R1(0),U,8)=$G(RMPR7I("UNIT"))
"RTN","RMPRPIYS",169,0)
 ;
"RTN","RMPRPIYS",170,0)
 ; set vars. for HCPCS
"RTN","RMPRPIYS",171,0)
 K RMPR1,RMPR1I
"RTN","RMPRPIYS",172,0)
 S RMPR1("HCPCS")=RMPR7("HCPCS")
"RTN","RMPRPIYS",173,0)
 S RMPRERR=$$HPACT^RMPRPIX1(.RMPR1)
"RTN","RMPRPIYS",174,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",175,0)
 S RMPRERR=$$HPETOI^RMPRPIX1(.RMPR1,.RMPR1I)
"RTN","RMPRPIYS",176,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",177,0)
 ;
"RTN","RMPRPIYS",178,0)
 ; set vars. for Item
"RTN","RMPRPIYS",179,0)
 K RMPR11,RMPR11I
"RTN","RMPRPIYS",180,0)
 S RMPR11("STATION")=RMPR("STA")
"RTN","RMPRPIYS",181,0)
 S RMPR11("HCPCS")=RMPR7("HCPCS")
"RTN","RMPRPIYS",182,0)
 S RMPR11("ITEM")=RMPR7("ITEM")
"RTN","RMPRPIYS",183,0)
 S RMPRERR=$$GET^RMPRPIX1(.RMPR11)
"RTN","RMPRPIYS",184,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",185,0)
 S RMPRERR=$$ETOI^RMPRPIX1(.RMPR11,.RMPR11I)
"RTN","RMPRPIYS",186,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",187,0)
 I RMPR11I("ITEM MASTER IEN")="" D  G SCAN1
"RTN","RMPRPIYS",188,0)
 . W !,"This item is not associated with an IFCAP Item.",!
"RTN","RMPRPIYS",189,0)
 . W "Please use the Edit Inventory option before trying to issue this item."
"RTN","RMPRPIYS",190,0)
 . W !
"RTN","RMPRPIYS",191,0)
 . Q
"RTN","RMPRPIYS",192,0)
 ;S RMDAHC=RMPR1("IEN")
"RTN","RMPRPIYS",193,0)
 D CPT(RMDAHC_"^"_$P(R1(0),U,4)_"^"_RMPR11I("SOURCE")_"^660")
"RTN","RMPRPIYS",194,0)
 I RMPREXC="T" G SCANX
"RTN","RMPRPIYS",195,0)
 I RMPREXC'="" G SCAN1
"RTN","RMPRPIYS",196,0)
 ;
"RTN","RMPRPIYS",197,0)
 ; get Vendor
"RTN","RMPRPIYS",198,0)
 S RMPR6("DATE&TIME")=RMPR7I("DATE&TIME")
"RTN","RMPRPIYS",199,0)
 S RMPR6("HCPCS")=RMPR7("HCPCS")
"RTN","RMPRPIYS",200,0)
 S RMPR6("SEQUENCE")=RMPR7("SEQUENCE")
"RTN","RMPRPIYS",201,0)
 S RMPRERR=$$GET^RMPRPIX6(.RMPR6)
"RTN","RMPRPIYS",202,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",203,0)
 S RMPRERR=$$VNDIEN^RMPRPIX6(.RMPR6)
"RTN","RMPRPIYS",204,0)
 I RMPRERR D SCANE G SCAN1
"RTN","RMPRPIYS",205,0)
 S $P(R1(0),U,9)=RMPR6("VENDOR IEN")
"RTN","RMPRPIYS",206,0)
 S $P(R3("D"),U,9)=RMPR6("VENDOR")
"RTN","RMPRPIYS",207,0)
 ;
"RTN","RMPRPIYS",208,0)
 ; set vars for issue
"RTN","RMPRPIYS",209,0)
 S RMCPTC=""
"RTN","RMPRPIYS",210,0)
 I $G(RMDAHC),$D(^RMPR(661.1,RMDAHC,0)) S RMCPTC=$P(^RMPR(661.1,RMDAHC,0),U,4)
"RTN","RMPRPIYS",211,0)
 S $P(R1(1),U,4)=RMDAHC
"RTN","RMPRPIYS",212,0)
 S $P(R1(0),U,22)=$G(RMCPTC)
"RTN","RMPRPIYS",213,0)
 S $P(R1(0),U,6)=RMPR11I("ITEM MASTER IEN")
"RTN","RMPRPIYS",214,0)
 S (RMHCNEW,RMHCDA)=RMDAHC
"RTN","RMPRPIYS",215,0)
 S RMITDA=RMPR11("IEN")
"RTN","RMPRPIYS",216,0)
 S RMHCPC=RMPR11("HCPCS")
"RTN","RMPRPIYS",217,0)
 S RMIT=RMPR11("HCPCS-ITEM")
"RTN","RMPRPIYS",218,0)
 S RDESC=RMPR1("SHORT DESC")
"RTN","RMPRPIYS",219,0)
 S $P(R3("D"),U,14)=RMPR11("SOURCE")
"RTN","RMPRPIYS",220,0)
 S RMSO=RMPR11I("SOURCE")
"RTN","RMPRPIYS",221,0)
 S $P(R1(0),U,14)=RMSO
"RTN","RMPRPIYS",222,0)
 S $P(R3("D"),U,6)=RMPR11("ITEM MASTER")
"RTN","RMPRPIYS",223,0)
 S $P(R1(0),U,6)=RMPR11I("ITEM MASTER IEN")
"RTN","RMPRPIYS",224,0)
 S $P(R1(2),U,1)=RMIT
"RTN","RMPRPIYS",225,0)
 S $P(R1(2),U,2)=RMPR11("DESCRIPTION")
"RTN","RMPRPIYS",226,0)
 S RMLOC=RMPR7I("LOCATION"),RMUBA=0,RMPR11("ITEM")=$P(RMIT,"-",2)
"RTN","RMPRPIYS",227,0)
 S RMPR11("LOCATION")=RMLOC,RMPR11("STATION")=RMPRSTN
"RTN","RMPRPIYS",228,0)
 I '$G(RMPR11("LOCATION")) S RMUBA=RMPR7("QUANTITY")
"RTN","RMPRPIYS",229,0)
 S:'$G(RMUBA) RMUBA=$$BAL^RMPRPIX7(.RMPR11)
"RTN","RMPRPIYS",230,0)
 S RMITQTY=RMPR7("QUANTITY")
"RTN","RMPRPIYS",231,0)
 K RMPR5
"RTN","RMPRPIYS",232,0)
 S RMPR5("IEN")=RMLOC
"RTN","RMPRPIYS",233,0)
 S RMPRUCST=RMPR7("VALUE")/RMPR7("QUANTITY")
"RTN","RMPRPIYS",234,0)
 S $P(R1(0),U,16)=$J(RMPRUCST,0,2)
"RTN","RMPRPIYS",235,0)
 S $P(R3("D"),U,16)=$J(RMPRUCST,0,2)
"RTN","RMPRPIYS",236,0)
 S $P(R1(0),U,7)=1   ;qty.
"RTN","RMPRPIYS",237,0)
 S $P(R1(0),U,11)="" ;serial num
"RTN","RMPRPIYS",238,0)
 S $P(R1(0),U,24)="" ;lot num
"RTN","RMPRPIYS",239,0)
 S $P(R1(0),U,18)="" ;remarks
"RTN","RMPRPIYS",240,0)
SCANX Q
"RTN","RMPRPIYS",241,0)
SCANE W !,"A problem has occurred with the scan, please try again.",!
"RTN","RMPRPIYS",242,0)
 Q
"RTN","RMPRPIYS",243,0)
 ;
"RTN","RMPRPIYS",244,0)
 ;***** CPT - prompt for CPT modifier
"RTN","RMPRPIYS",245,0)
 ; (extension of RMPRPIYI and to be used only by that routine)
"RTN","RMPRPIYS",246,0)
CPT(RDA) ;
"RTN","RMPRPIYS",247,0)
 N DIC,Y,RQUIT,X,DA,DIR,DUOUT,DTOUT
"RTN","RMPRPIYS",248,0)
 N RMPR1,RMPR11,RMPR11I,RMPR7,RMPR7I
"RTN","RMPRPIYS",249,0)
 S RMPREXC=""
"RTN","RMPRPIYS",250,0)
 D:$D(RMCPT) CHK^RMPRED5
"RTN","RMPRPIYS",251,0)
 W:$G(REDIT) !,"OLD CPT MODIFIER: ",$P(R1(1),U,6)
"RTN","RMPRPIYS",252,0)
 I RMHCOLD'=RMDAHC D CPT^RMPRCPTU(RDA)
"RTN","RMPRPIYS",253,0)
 I $D(DUOUT) S RMPREXC="^" G CPTX
"RTN","RMPRPIYS",254,0)
 I $D(DTOUT) S RMPREXC="T" G CPTX
"RTN","RMPRPIYS",255,0)
 S $P(R1(1),U,6)=$G(RMCPT)
"RTN","RMPRPIYS",256,0)
 W:$G(REDIT) !,"NEW CPT MODIFIER: ",$G(RMCPT)
"RTN","RMPRPIYS",257,0)
 I RMHCOLD'="",(RMHCOLD=RMDAHC),$G(REDIT) D
"RTN","RMPRPIYS",258,0)
 .S DIR(0)="Y",DIR("A")="Would you like to Edit CPT MODIFIER Entry  ",DIR("B")="N" D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","RMPRPIYS",259,0)
 .I $G(Y) D
"RTN","RMPRPIYS",260,0)
 ..D CPT^RMPRCPTU(RDA)
"RTN","RMPRPIYS",261,0)
 ..I $D(DUOUT) S RMPREXC="^"
"RTN","RMPRPIYS",262,0)
 ..I $D(DTOUT) S RMPREXC="T"
"RTN","RMPRPIYS",263,0)
 ..W:RMCPT=$P(R1(1),U,6) !!,"***Based on the information given above, CPT modifier string has not changed!!!",!
"RTN","RMPRPIYS",264,0)
 ..W:RMCPT'=$P(R1(1),U,6) !,"NEW CPT MODIFIER: ",$G(RMCPT)
"RTN","RMPRPIYS",265,0)
 ..S $P(R1(1),U,6)=$G(RMCPT)
"RTN","RMPRPIYS",266,0)
CPTX Q
"RTN","RMPRPIYS",267,0)
UPCASE(RMPRSTR) ;
"RTN","RMPRPIYS",268,0)
 Q $TR(RMPRSTR,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"VER")
8.0^22.0
"^DD",661.1,661.1,1.3,0)
VERSION DATE^D^^5;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",661.1,661.1,1.3,3)
Enter the date of the latest update to this HCPCS code.
"^DD",661.1,661.1,1.3,21,0)
^.001^3^3^3100803^^
"^DD",661.1,661.1,1.3,21,1,0)
This date represents the most recent update to a HCPCS code in the PCM
"^DD",661.1,661.1,1.3,21,2,0)
gold copy. Version date is controlled by PCM and is used to synchronize
"^DD",661.1,661.1,1.3,21,3,0)
VistA HCPCS updates with the enterprise asset management system.
"^DD",661.1,661.1,1.3,"DT")
3100715
"BLD",7710,6)
^144
**END**
**END**
