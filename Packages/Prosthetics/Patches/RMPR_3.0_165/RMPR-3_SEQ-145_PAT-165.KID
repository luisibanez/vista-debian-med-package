Released RMPR*3*165 SEQ #145
Extracted from mail message
**KIDS**:RMPR*3.0*165^

**INSTALL NAME**
RMPR*3.0*165
"BLD",7844,0)
RMPR*3.0*165^PROSTHETICS^0^3110509^y
"BLD",7844,1,0)
^^12^12^3110509^^^
"BLD",7844,1,1,0)
1. Home Oxygen charges for patient do not total for all linked Fund 
"BLD",7844,1,2,0)
   Control Points.
"BLD",7844,1,3,0)
 
"BLD",7844,1,4,0)
2. The VistA National Prosthetic Patient Database (NPPD) reporting
"BLD",7844,1,5,0)
   does not match the national NPPD rollup for Unique Social
"BLD",7844,1,6,0)
   Security Number (SSN) totals between NEW item costs and USED
"BLD",7844,1,7,0)
   inventory item costs.
"BLD",7844,1,8,0)
 
"BLD",7844,1,9,0)
3. Delete Prosthetics options Manual Send Delivery Notification and  
"BLD",7844,1,10,0)
   Returned Delivery Verification Card and remove same options from
"BLD",7844,1,11,0)
   Prosthetics Utilities Menu as the government contract for Letter 
"BLD",7844,1,12,0)
   Notification was cancelled. 
"BLD",7844,4,0)
^9.64PA^^
"BLD",7844,6.3)
4
"BLD",7844,"ABPKG")
n
"BLD",7844,"INID")
^
"BLD",7844,"INIT")

"BLD",7844,"KRN",0)
^9.67PA^779.2^20
"BLD",7844,"KRN",.4,0)
.4
"BLD",7844,"KRN",.401,0)
.401
"BLD",7844,"KRN",.402,0)
.402
"BLD",7844,"KRN",.403,0)
.403
"BLD",7844,"KRN",.5,0)
.5
"BLD",7844,"KRN",.84,0)
.84
"BLD",7844,"KRN",3.6,0)
3.6
"BLD",7844,"KRN",3.8,0)
3.8
"BLD",7844,"KRN",9.2,0)
9.2
"BLD",7844,"KRN",9.8,0)
9.8
"BLD",7844,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7844,"KRN",9.8,"NM",1,0)
RMPOBIL2^^0^B60979023
"BLD",7844,"KRN",9.8,"NM",2,0)
RMPRN6^^0^B90365732
"BLD",7844,"KRN",9.8,"NM","B","RMPOBIL2",1)

"BLD",7844,"KRN",9.8,"NM","B","RMPRN6",2)

"BLD",7844,"KRN",19,0)
19
"BLD",7844,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",7844,"KRN",19,"NM",1,0)
RMPR MANUAL SEND DVN^^1^
"BLD",7844,"KRN",19,"NM",2,0)
RMPR RETURNED DVN CARD^^1^
"BLD",7844,"KRN",19,"NM","B","RMPR MANUAL SEND DVN",1)

"BLD",7844,"KRN",19,"NM","B","RMPR RETURNED DVN CARD",2)

"BLD",7844,"KRN",19.1,0)
19.1
"BLD",7844,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7844,"KRN",101,0)
101
"BLD",7844,"KRN",409.61,0)
409.61
"BLD",7844,"KRN",771,0)
771
"BLD",7844,"KRN",779.2,0)
779.2
"BLD",7844,"KRN",870,0)
870
"BLD",7844,"KRN",8989.51,0)
8989.51
"BLD",7844,"KRN",8989.52,0)
8989.52
"BLD",7844,"KRN",8994,0)
8994
"BLD",7844,"KRN","B",.4,.4)

"BLD",7844,"KRN","B",.401,.401)

"BLD",7844,"KRN","B",.402,.402)

"BLD",7844,"KRN","B",.403,.403)

"BLD",7844,"KRN","B",.5,.5)

"BLD",7844,"KRN","B",.84,.84)

"BLD",7844,"KRN","B",3.6,3.6)

"BLD",7844,"KRN","B",3.8,3.8)

"BLD",7844,"KRN","B",9.2,9.2)

"BLD",7844,"KRN","B",9.8,9.8)

"BLD",7844,"KRN","B",19,19)

"BLD",7844,"KRN","B",19.1,19.1)

"BLD",7844,"KRN","B",101,101)

"BLD",7844,"KRN","B",409.61,409.61)

"BLD",7844,"KRN","B",771,771)

"BLD",7844,"KRN","B",779.2,779.2)

"BLD",7844,"KRN","B",870,870)

"BLD",7844,"KRN","B",8989.51,8989.51)

"BLD",7844,"KRN","B",8989.52,8989.52)

"BLD",7844,"KRN","B",8994,8994)

"BLD",7844,"QDEF")
^^^^YES
"BLD",7844,"QUES",0)
^9.62^^
"BLD",7844,"REQB",0)
^9.611^2^2
"BLD",7844,"REQB",1,0)
RMPR*3.0*110^2
"BLD",7844,"REQB",2,0)
RMPR*3.0*144^2
"BLD",7844,"REQB","B","RMPR*3.0*110",1)

"BLD",7844,"REQB","B","RMPR*3.0*144",2)

"KRN",19,13233,-1)
1^1
"KRN",19,13233,0)
RMPR MANUAL SEND DVN
"KRN",19,13234,-1)
1^2
"KRN",19,13234,0)
RMPR RETURNED DVN CARD
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
165^3110509
"PKG",101,22,1,"PAH",1,1,0)
^^12^12^3110509
"PKG",101,22,1,"PAH",1,1,1,0)
1. Home Oxygen charges for patient do not total for all linked Fund 
"PKG",101,22,1,"PAH",1,1,2,0)
   Control Points.
"PKG",101,22,1,"PAH",1,1,3,0)
 
"PKG",101,22,1,"PAH",1,1,4,0)
2. The VistA National Prosthetic Patient Database (NPPD) reporting
"PKG",101,22,1,"PAH",1,1,5,0)
   does not match the national NPPD rollup for Unique Social
"PKG",101,22,1,"PAH",1,1,6,0)
   Security Number (SSN) totals between NEW item costs and USED
"PKG",101,22,1,"PAH",1,1,7,0)
   inventory item costs.
"PKG",101,22,1,"PAH",1,1,8,0)
 
"PKG",101,22,1,"PAH",1,1,9,0)
3. Delete Prosthetics options Manual Send Delivery Notification and  
"PKG",101,22,1,"PAH",1,1,10,0)
   Returned Delivery Verification Card and remove same options from
"PKG",101,22,1,"PAH",1,1,11,0)
   Prosthetics Utilities Menu as the government contract for Letter 
"PKG",101,22,1,"PAH",1,1,12,0)
   Notification was cancelled. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RMPOBIL2")
0^1^B60979023^B60026916
"RTN","RMPOBIL2",1,0)
RMPOBIL2 ;EDS/MDB - HOME OXYGEN BILLING TRANSACTIONS ;7/28/98
"RTN","RMPOBIL2",2,0)
 ;;3.0;PROSTHETICS;**29,44,46,50,110,165**;Feb 09, 1996;Build 4
"RTN","RMPOBIL2",3,0)
 ; ODJ patch 50 - Fix crashes reported in NOIS LIT-0600-70930
"RTN","RMPOBIL2",4,0)
 Q
"RTN","RMPOBIL2",5,0)
2319 ; SHOW PAGE 8 OF 2319
"RTN","RMPOBIL2",6,0)
 ;S:$D(RMPRDFN)&('$D(RMPODFN)) RMPODFN=RMPRDFN
"RTN","RMPOBIL2",7,0)
 S RMPODFN=RMPRDFN
"RTN","RMPOBIL2",8,0)
 D BPI,DPI
"RTN","RMPOBIL2",9,0)
 K DIR S DIR(0)="E" D ^DIR I $$QUIT G ASK1^RMPRPAT
"RTN","RMPOBIL2",10,0)
 D ^RMPOBIL5
"RTN","RMPOBIL2",11,0)
 K PTI,I,RX,Y,DT1,DT2,TRX,IENS,DFN
"RTN","RMPOBIL2",12,0)
 Q
"RTN","RMPOBIL2",13,0)
QUIT() S QUIT=$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOBIL2",14,0)
EQUIT() S QUIT=$D(DTOUT)!$D(Y) Q QUIT
"RTN","RMPOBIL2",15,0)
LJ(S,W,C) ; Left justify S in a field W wide padding with char C
"RTN","RMPOBIL2",16,0)
 ;
"RTN","RMPOBIL2",17,0)
 S C=$G(C," ")   ; Default pad char is space
"RTN","RMPOBIL2",18,0)
 I $L(S)'=W S $P(S,C,W-$L(S)+$L(S,C))=""
"RTN","RMPOBIL2",19,0)
 Q $E(S,1,W)
"RTN","RMPOBIL2",20,0)
EDIT ;NEW billing transaction edit module
"RTN","RMPOBIL2",21,0)
 ;This module edits a single billing transaction (trx)
"RTN","RMPOBIL2",22,0)
 ;a single trx is identified by 4 values
"RTN","RMPOBIL2",23,0)
 ;  site, billing month, vendor, and patient
"RTN","RMPOBIL2",24,0)
 ;  these four values represent an entry in file 665.72
"RTN","RMPOBIL2",25,0)
 ;
"RTN","RMPOBIL2",26,0)
 Q:'($D(RMPOXITE)&$D(RMPORVDT)&$D(RMPOVDR)&$D(RMPODFN))
"RTN","RMPOBIL2",27,0)
 Q:'$D(^RMPO(665.72,+RMPOXITE,1,+RMPORVDT,1,+RMPOVDR,"V",+RMPODFN))
"RTN","RMPOBIL2",28,0)
 ; previous two lines for development only - shouldn't be needed
"RTN","RMPOBIL2",29,0)
 ;
"RTN","RMPOBIL2",30,0)
 D ITEM
"RTN","RMPOBIL2",31,0)
EXIT L -^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN,0)
"RTN","RMPOBIL2",32,0)
 K ITM,IEN,IENS,ITMACT,PTI,TMP,ZX1,TOT,T910,OTH,A,RX,TRX,DT1,DT2
"RTN","RMPOBIL2",33,0)
 K DIC,DIE,DA,DR,DO,DD,DIR,DIK,DIROUT,DUOUT
"RTN","RMPOBIL2",34,0)
 K TIEN,FCP,DFN,I,ITEM,NEW,QUIT,TOTAL,VADM,X,Y,Z,Z1,Z2,ZV,Z3
"RTN","RMPOBIL2",35,0)
 K PSTFLG,PITM,BACKPTR,POSTED,SUSP,DFCP,C,W,S,CIEN,RMIT,RMDIC
"RTN","RMPOBIL2",36,0)
 Q
"RTN","RMPOBIL2",37,0)
QUIK ; QUICK ITEM EDIT
"RTN","RMPOBIL2",38,0)
 ;
"RTN","RMPOBIL2",39,0)
 I '$$OK2EDIT D  Q
"RTN","RMPOBIL2",40,0)
 . W !,$C(7)_"Cannot edit Accepted Transactions.  "
"RTN","RMPOBIL2",41,0)
 . W "Please 'Unaccept' first." K DIR S DIR(0)="E" D ^DIR
"RTN","RMPOBIL2",42,0)
 I $$LOCKED D  Q
"RTN","RMPOBIL2",43,0)
 . W !,$C(7)_"Record is locked. " K DIR S DIR(0)="E" D ^DIR
"RTN","RMPOBIL2",44,0)
 D ITEMD
"RTN","RMPOBIL2",45,0)
 F I=1:1:IEN D  Q:QUIT
"RTN","RMPOBIL2",46,0)
 . W !,ITM(I)
"RTN","RMPOBIL2",47,0)
 .K DR D SDICE
"RTN","RMPOBIL2",48,0)
 .S DA=IEN(I),DR="7" D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",49,0)
 .S Z=^RMPO(665.72,DA(4),1,DA(3),1,DA(2),"V",DA(1),1,DA,0)
"RTN","RMPOBIL2",50,0)
 .S Z1=$P(Z,U,7),Z2=$P(Z,U,5),Z3=$P(Z,U,11)
"RTN","RMPOBIL2",51,0)
 .S DR="6///"_((Z1*Z2)-Z3) D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",52,0)
 D BII,DII
"RTN","RMPOBIL2",53,0)
 K DIR S DIR(0)="E" D ^DIR Q:$$QUIT
"RTN","RMPOBIL2",54,0)
 G EXIT
"RTN","RMPOBIL2",55,0)
 Q
"RTN","RMPOBIL2",56,0)
ITEM ; Main edit loop
"RTN","RMPOBIL2",57,0)
 ;
"RTN","RMPOBIL2",58,0)
 I '$$OK2EDIT D  Q
"RTN","RMPOBIL2",59,0)
 . W !,$C(7)_"Cannot edit Accepted Transactions.  "
"RTN","RMPOBIL2",60,0)
 . W "Please 'Unaccept' first." K DIR S DIR(0)="E" D ^DIR
"RTN","RMPOBIL2",61,0)
 I $$LOCKED D  Q
"RTN","RMPOBIL2",62,0)
 . W !,$C(7)_"Record is locked. " K DIR S DIR(0)="E" D ^DIR
"RTN","RMPOBIL2",63,0)
 ;
"RTN","RMPOBIL2",64,0)
ITEMLOOP ;
"RTN","RMPOBIL2",65,0)
 ;
"RTN","RMPOBIL2",66,0)
 S QUIT=0
"RTN","RMPOBIL2",67,0)
 D ITEMD
"RTN","RMPOBIL2",68,0)
 ; ask for ACTION, quit if <return>, timeout, etc
"RTN","RMPOBIL2",69,0)
 S ITMACT=$$ITEMO Q:$$QUIT!(ITMACT="")
"RTN","RMPOBIL2",70,0)
 ; if they entered 'A', do ADD ITEM, then edit it
"RTN","RMPOBIL2",71,0)
 I ITMACT="A" D ITEMA Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEMLOOP
"RTN","RMPOBIL2",72,0)
 ; if they entered 'D', select an item, then delete it
"RTN","RMPOBIL2",73,0)
 I ITMACT="D" D ITEMS Q:QUIT!(ITEM="")  D ITEMK G ITEMLOOP
"RTN","RMPOBIL2",74,0)
 ; if they entered 'E', select an item, then edit it
"RTN","RMPOBIL2",75,0)
 I ITMACT="E" D ITEMS Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEMLOOP
"RTN","RMPOBIL2",76,0)
 ; if they entered 'Z', select an item, then zero it
"RTN","RMPOBIL2",77,0)
 I ITMACT="Z" D ITEMS Q:QUIT!(ITEM="")  D ITEMZ Q:QUIT  G ITEMLOOP
"RTN","RMPOBIL2",78,0)
 G ITEMLOOP
"RTN","RMPOBIL2",79,0)
 Q
"RTN","RMPOBIL2",80,0)
OK2EDIT() ;
"RTN","RMPOBIL2",81,0)
 ;
"RTN","RMPOBIL2",82,0)
 Q $P(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN,0),U,2)'="Y"
"RTN","RMPOBIL2",83,0)
 Q
"RTN","RMPOBIL2",84,0)
LOCKED() ;
"RTN","RMPOBIL2",85,0)
 ;
"RTN","RMPOBIL2",86,0)
 L +^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN,0):2
"RTN","RMPOBIL2",87,0)
 Q '$T
"RTN","RMPOBIL2",88,0)
 Q
"RTN","RMPOBIL2",89,0)
ITEMD ; Display items
"RTN","RMPOBIL2",90,0)
 ;
"RTN","RMPOBIL2",91,0)
 D BPI,DPI,BII,DII
"RTN","RMPOBIL2",92,0)
 Q
"RTN","RMPOBIL2",93,0)
BPI ; Build pt info hdr
"RTN","RMPOBIL2",94,0)
 K PTI
"RTN","RMPOBIL2",95,0)
 ; Name,SSN
"RTN","RMPOBIL2",96,0)
 S DFN=RMPODFN D DEM^VADPT
"RTN","RMPOBIL2",97,0)
 S PTI(1)=VADM(1)_"    "_$P(VADM(2),U,2)
"RTN","RMPOBIL2",98,0)
 ; Current Rx (IEN on ACT DATE)
"RTN","RMPOBIL2",99,0)
 S RX=$O(^RMPR(665,RMPODFN,"RMPOB"," "),-1)
"RTN","RMPOBIL2",100,0)
 Q:'RX
"RTN","RMPOBIL2",101,0)
 S Y=$P(^RMPR(665,RMPODFN,"RMPOB",RX,0),U) X ^DD("DD") S DT1=Y
"RTN","RMPOBIL2",102,0)
 S Y=$P(^RMPR(665,RMPODFN,"RMPOB",RX,0),U,3) X ^DD("DD") S DT2=Y
"RTN","RMPOBIL2",103,0)
 S PTI(2)="Current Prescription (#"_RX_")"
"RTN","RMPOBIL2",104,0)
 S PTI(3)="      Active Date: "_DT1_"    Expiration Date: "_DT2
"RTN","RMPOBIL2",105,0)
 ; Rx Remarks
"RTN","RMPOBIL2",106,0)
 K TRX
"RTN","RMPOBIL2",107,0)
 S IENS=RX_","_RMPODFN_","
"RTN","RMPOBIL2",108,0)
 D GETS^DIQ(665.193,IENS,3,,"TRX")
"RTN","RMPOBIL2",109,0)
 S I=0 F  S I=$O(TRX(665.193,IENS,3,I)) Q:I=""  D
"RTN","RMPOBIL2",110,0)
 . S PTI(3+I)="      "_TRX(665.193,IENS,3,I)
"RTN","RMPOBIL2",111,0)
 Q
"RTN","RMPOBIL2",112,0)
DPI ; Display pt info hdr
"RTN","RMPOBIL2",113,0)
 S I=0 F  S I=$O(PTI(I)) Q:I=""  W !,PTI(I)
"RTN","RMPOBIL2",114,0)
 Q
"RTN","RMPOBIL2",115,0)
BII ; Build item info array
"RTN","RMPOBIL2",116,0)
 K TRX,ITM,TOT,SUSP,POSTED,PITM,IEN,CIEN
"RTN","RMPOBIL2",117,0)
 S SUSP=0,CIEN=1
"RTN","RMPOBIL2",118,0)
 S IENS=RMPODFN_","_RMPOVDR_","_RMPORVDT_","_RMPOXITE
"RTN","RMPOBIL2",119,0)
 D GETS^DIQ(665.72319,IENS,"**","IE","TRX")
"RTN","RMPOBIL2",120,0)
 S ZX1=""
"RTN","RMPOBIL2",121,0)
 F IEN=0:1 S ZX1=$O(TRX(665.723191,ZX1)) Q:ZX1=""  D
"RTN","RMPOBIL2",122,0)
 . K TMP M TMP=TRX(665.723191,ZX1)
"RTN","RMPOBIL2",123,0)
 . F Z=5,6,10 S TMP(Z,"E")=$J($G(TMP(Z,"E")),0,2)
"RTN","RMPOBIL2",124,0)
 . S TIEN=+ZX1 D BIIL
"RTN","RMPOBIL2",125,0)
 K TMP
"RTN","RMPOBIL2",126,0)
 S TMP(2,"E")="HCPCS"
"RTN","RMPOBIL2",127,0)
 S TMP(.01,"E")="Description"
"RTN","RMPOBIL2",128,0)
 S TMP(3,"E")="FCP"
"RTN","RMPOBIL2",129,0)
 S TMP(7,"E")="Qty"
"RTN","RMPOBIL2",130,0)
 S TMP(5,"E")="Cost"
"RTN","RMPOBIL2",131,0)
 S TMP(6,"E")="Total"
"RTN","RMPOBIL2",132,0)
 S TMP(8,"I")=" "
"RTN","RMPOBIL2",133,0)
 S TMP(10,"E")="Susp."
"RTN","RMPOBIL2",134,0)
 S (CIEN,TIEN)=0 D BIIL
"RTN","RMPOBIL2",135,0)
 Q
"RTN","RMPOBIL2",136,0)
BIIL ;Build detail line
"RTN","RMPOBIL2",137,0)
 ;
"RTN","RMPOBIL2",138,0)
 S:TIEN IEN(CIEN)=TIEN ;S:TIEN IEN(TIEN)=TIEN
"RTN","RMPOBIL2",139,0)
 S ITM(CIEN)="   "
"RTN","RMPOBIL2",140,0)
 ;S:TIEN ITM(TIEN)=$J(TIEN,2)_"."                     ; ITEM #
"RTN","RMPOBIL2",141,0)
 S:TIEN ITM(CIEN)=$J(CIEN,2)_"."                          ; ITEM #
"RTN","RMPOBIL2",142,0)
 S PSTFLG=$S($G(TMP(8,"I"))="Y":"p",1:" ")
"RTN","RMPOBIL2",143,0)
 S BACKPTR=$G(TMP(12,"I"))
"RTN","RMPOBIL2",144,0)
 S TMP(.01,"E")=$G(TMP(.01,"E"))_"                          "
"RTN","RMPOBIL2",145,0)
 S ITM(CIEN)=ITM(CIEN)_$$LJ(PSTFLG,2)                      ; POSTED
"RTN","RMPOBIL2",146,0)
 S ITM(CIEN)=ITM(CIEN)_$$LJ($G(TMP(2,"E")),7)              ; HCPCS
"RTN","RMPOBIL2",147,0)
 S ITM(CIEN)=ITM(CIEN)_$$LJ($G(TMP(.01,"E")),30)           ; ITEM DESCR
"RTN","RMPOBIL2",148,0)
 S ITM(CIEN)=ITM(CIEN)_"  "_$$LJ($P($G(TMP(3,"E"))," "),5)  ; FCP
"RTN","RMPOBIL2",149,0)
 S ITM(CIEN)=ITM(CIEN)_$J($G(TMP(7,"E")),5)                 ; QTY
"RTN","RMPOBIL2",150,0)
 S ITM(CIEN)=ITM(CIEN)_$J($G(TMP(5,"E")),8)                 ; UNIT COST
"RTN","RMPOBIL2",151,0)
 S ITM(CIEN)=ITM(CIEN)_$J($G(TMP(10,"E")),8)                ; SUSP
"RTN","RMPOBIL2",152,0)
 S ITM(CIEN)=ITM(CIEN)_$J($G(TMP(6,"E")),8)                 ; QTY * CST
"RTN","RMPOBIL2",153,0)
 ; Quit if we're doing the header
"RTN","RMPOBIL2",154,0)
 Q:TIEN=0
"RTN","RMPOBIL2",155,0)
 I $G(TMP(8,"I"))="Y" S POSTED(TIEN)=""
"RTN","RMPOBIL2",156,0)
 ; Do totals while we're here
"RTN","RMPOBIL2",157,0)
 S FCP=+TMP(3,"E"),TOTAL=TMP(6,"E")
"RTN","RMPOBIL2",158,0)
 S TOT(FCP)=$G(TOT(FCP))+TOTAL
"RTN","RMPOBIL2",159,0)
 S TOT=$G(TOT)+TOTAL
"RTN","RMPOBIL2",160,0)
 S SUSP=SUSP+$G(TMP(10,"E")),CIEN=CIEN+1
"RTN","RMPOBIL2",161,0)
 Q
"RTN","RMPOBIL2",162,0)
DII ; Display item info array
"RTN","RMPOBIL2",163,0)
 ; Patch RMPR*3.0*165 removes 910 total line and replaces with FCP breakout for those FCPs now associated with HO billing.
"RTN","RMPOBIL2",164,0)
 Q:'$G(IEN)
"RTN","RMPOBIL2",165,0)
 N RMPOFCP,RMPOSITE S RMPOFCP=0,RMPOSITE=$P($G(^RMPR(669.9,RMPOXITE,0)),U,2)
"RTN","RMPOBIL2",166,0)
 W ! F I=0:1:IEN W !,ITM(I)
"RTN","RMPOBIL2",167,0)
 W !!,"TOTAL COST",?72,$J(TOT,6,2),!
"RTN","RMPOBIL2",168,0)
 F  S RMPOFCP=$O(TOT(RMPOFCP)) Q:RMPOFCP=""  D
"RTN","RMPOBIL2",169,0)
 . W !,"Total ",$P($G(^PRC(420,RMPOSITE,1,RMPOFCP,0)),U)," Charges:",?72,$J(+$G(TOT(RMPOFCP)),6,2)
"RTN","RMPOBIL2",170,0)
 W !
"RTN","RMPOBIL2",171,0)
 Q
"RTN","RMPOBIL2",172,0)
ITEMO() ; Select action (A/E/D/Z)
"RTN","RMPOBIL2",173,0)
 K DIR
"RTN","RMPOBIL2",174,0)
 S DIR(0)="SBO^A:Add;D:Delete;E:Edit;Z:Zero"
"RTN","RMPOBIL2",175,0)
 S DIR("A")="Select ACTION" D ^DIR
"RTN","RMPOBIL2",176,0)
 Q Y
"RTN","RMPOBIL2",177,0)
 Q
"RTN","RMPOBIL2",178,0)
ITEMA ; Add an item
"RTN","RMPOBIL2",179,0)
 S ITEM=""
"RTN","RMPOBIL2",180,0)
 K DIC S DIC="^RMPR(661,",DIC(0)="AEQMZ" D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOBIL2",181,0)
 S NEW=+Y
"RTN","RMPOBIL2",182,0)
 K DD,DO D SDICE S DIC(0)="LN" S X=NEW
"RTN","RMPOBIL2",183,0)
 D FILE^DICN Q:Y<0!$$QUIT
"RTN","RMPOBIL2",184,0)
 S DA=+Y,DR="2;9" D ^DIE I $$EQUIT S DIK=DIE D WAK Q
"RTN","RMPOBIL2",185,0)
 ;S FCP=$$GETFCP^RMPOBILU I $$QUIT!(FCP<0) S DIK=DIE D WAK Q
"RTN","RMPOBIL2",186,0)
 ;S DR="3///"_$P(FCP,U,2) D ^DIE I $$EQUIT S DIK=DIE D WAK Q
"RTN","RMPOBIL2",187,0)
 ;S ITEM=DA,IEN=$G(IEN)+1,IEN(IEN)=ITEM
"RTN","RMPOBIL2",188,0)
 S IEN=$G(IEN)+1,IEN(IEN)=DA,ITEM=IEN
"RTN","RMPOBIL2",189,0)
 Q
"RTN","RMPOBIL2",190,0)
SDICE ; Set DIC,DIE,DA for adding Trx items
"RTN","RMPOBIL2",191,0)
 K DIC,DIE,DA
"RTN","RMPOBIL2",192,0)
 S ZV=",""V"","
"RTN","RMPOBIL2",193,0)
 S DA(1)=RMPODFN,DA(2)=RMPOVDR,DA(3)=RMPORVDT,DA(4)=RMPOXITE
"RTN","RMPOBIL2",194,0)
 S DIC="^RMPO(665.72,"_DA(4)_",1,"_DA(3)_",1,"_DA(2)_ZV_DA(1)_",1,"
"RTN","RMPOBIL2",195,0)
 S DIE=DIC
"RTN","RMPOBIL2",196,0)
 Q
"RTN","RMPOBIL2",197,0)
ITEMS ; Select an item
"RTN","RMPOBIL2",198,0)
 I IEN=1 S ITEM=1 Q
"RTN","RMPOBIL2",199,0)
 K DIR
"RTN","RMPOBIL2",200,0)
 S ITEM=""
"RTN","RMPOBIL2",201,0)
 S DIR(0)="NO^1:"_IEN,DIR("A")="Select an ITEM"
"RTN","RMPOBIL2",202,0)
 S DIR("?")="Note:  You cannot select POSTED items"
"RTN","RMPOBIL2",203,0)
 M DIR("?")=ITM
"RTN","RMPOBIL2",204,0)
 D ^DIR Q:Y'>0!$$QUIT
"RTN","RMPOBIL2",205,0)
 I $D(POSTED(+Y)) D  G ITEMS
"RTN","RMPOBIL2",206,0)
 . W !,$C(7)_"Item "_(+Y)_" has been POSTED!"
"RTN","RMPOBIL2",207,0)
 S ITEM=+Y I $P($G(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN,1,ITEM,0)),U,8)="Y" S PITM=ITEM
"RTN","RMPOBIL2",208,0)
 S BACKPTR=$P($G(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN,1,ITEM,0)),U,13)
"RTN","RMPOBIL2",209,0)
 I $G(BACKPTR),$D(^RMPR(665,RMPODFN,"RMPOC",BACKPTR,0)),$P(^RMPR(665,RMPODFN,"RMPOC",BACKPTR,0),U,11)="Y" S PITM=ITEM
"RTN","RMPOBIL2",210,0)
 Q
"RTN","RMPOBIL2",211,0)
ITEME ; Edit an item
"RTN","RMPOBIL2",212,0)
 K DR D SDICE
"RTN","RMPOBIL2",213,0)
 S DIE("NO^")="BACK"
"RTN","RMPOBIL2",214,0)
 S DA=IEN(ITEM),DR="1;7;S Z1=X;5;S Z2=X;4" D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",215,0)
SACK S DR="10;S Z3=X" D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",216,0)
 I Z3>(Z1*Z2) D  G SACK
"RTN","RMPOBIL2",217,0)
 . W !,"SUSPENDED AMT SHOULD NOT BE GREATER THAN TOTAL AMOUNT!"
"RTN","RMPOBIL2",218,0)
 S DR="11"_$S(+X=0:"///@",1:"") D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",219,0)
 S DR="6///"_((Z1*Z2)-Z3) D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",220,0)
 S DFCP=$P(^RMPO(665.72,DA(4),1,DA(3),1,DA(2),"V",DA(1),1,DA,0),U,3)
"RTN","RMPOBIL2",221,0)
 F  D  Q:(FCP>0)!QUIT
"RTN","RMPOBIL2",222,0)
 . S FCP=$P($$GETFCP^RMPOBILU(DFCP),U,2) Q:$$QUIT
"RTN","RMPOBIL2",223,0)
 . I FCP<0!(FCP="") W $C(7)_"REQUIRED FIELD!"
"RTN","RMPOBIL2",224,0)
 I FCP>0 S DR="3R///"_FCP_";13R;14" D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",225,0)
 Q
"RTN","RMPOBIL2",226,0)
ITEMZ ; Zero an item
"RTN","RMPOBIL2",227,0)
 K DR D SDICE
"RTN","RMPOBIL2",228,0)
 S DA=IEN(ITEM),DR="5///0;6///0;10///0;11///@" D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",229,0)
 Q
"RTN","RMPOBIL2",230,0)
ITEMK ; Delete an item
"RTN","RMPOBIL2",231,0)
 D SDICE
"RTN","RMPOBIL2",232,0)
 S RMDIC=DIC_IEN(ITEM)_",0)",RMIT=$G(@RMDIC),PITM=$P(RMIT,U,8)
"RTN","RMPOBIL2",233,0)
 I PITM="Y" D  Q
"RTN","RMPOBIL2",234,0)
 . W !,"Can't delete PRIMARY ITEM!"
"RTN","RMPOBIL2",235,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you SURE you want to delete this item"
"RTN","RMPOBIL2",236,0)
 S DIR("B")="NO" D ^DIR Q:Y'>0
"RTN","RMPOBIL2",237,0)
 K DIK,DA D SDICE S DIK=DIC,DA=IEN(ITEM)
"RTN","RMPOBIL2",238,0)
WAK D ^DIK W "  ...deleted!"
"RTN","RMPOBIL2",239,0)
 Q
"RTN","RMPRN6")
0^2^B90365732^B85232517
"RTN","RMPRN6",1,0)
RMPRN6 ;Hines OIFO/HNC-PRINT NPPD LOCAL DATA ;3/17/03  11:38
"RTN","RMPRN6",2,0)
 ;;3.0;PROSTHETICS;**31,32,34,36,39,48,51,70,77,90,144,165**;Feb 09, 1996;Build 4
"RTN","RMPRN6",3,0)
 ;RVD 3/17/03 patch #77 - fix undefined and closing device.
"RTN","RMPRN6",4,0)
 ;SPS 5/24/05 Patch #90 - check for type of 5 Rental.
"RTN","RMPRN6",5,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPRN6",6,0)
DATE S %DT="XEA",%DT("A")="Enter Date to Start NPPD Calculations From: " D ^%DT G:X[U!(X="")!($D(DTOUT)) EXIT
"RTN","RMPRN6",7,0)
 S DATE(1)=+Y
"RTN","RMPRN6",8,0)
 S %DT="XEA",%DT("A")="Enter End Date: " D ^%DT G:X[U!(X="")!($D(DTOUT)) EXIT S DATE(2)=+Y
"RTN","RMPRN6",9,0)
 I DATE(1)>DATE(2) W !!,$C(7),"ENDING DATE RANGE IS LESS THAN BEGINNING DATE RANGE",! G DATE
"RTN","RMPRN6",10,0)
 Q:$D(RMPRCDE)
"RTN","RMPRN6",11,0)
DET ;select detail or brief
"RTN","RMPRN6",12,0)
 D DISP^RMPRN6S
"RTN","RMPRN6",13,0)
 K DIR
"RTN","RMPRN6",14,0)
 ;S DIR(0)="S^D:DETAIL;B:BRIEF"
"RTN","RMPRN6",15,0)
 S DIR(0)="S^1:BRIEF NEW SUMMARY;2:BRIEF USED SUMMARY;3:BRIEF BOTH SUMMARY;4:DETAIL & NEW SUMMARY;5:DETAIL & USED SUMMARY;6:DETAIL & BOTH SUMMARY"
"RTN","RMPRN6",16,0)
 S DIR("A")="Type of Report",DIR("B")="DETAIL & NEW SUMMARY" D ^DIR
"RTN","RMPRN6",17,0)
 Q:$D(DIRUT)!($D(DTOUT))
"RTN","RMPRN6",18,0)
 S RMPRDET=Y
"RTN","RMPRN6",19,0)
DEV ;device
"RTN","RMPRN6",20,0)
 S %ZIS="Q" D ^%ZIS G:POP EXIT K IOP I $E(IOST,1,2)["C-" G PRT
"RTN","RMPRN6",21,0)
 I $D(IO("Q")) S ZTIO=ION,ZTSAVE("RMPRSITE")="",ZTSAVE("RMPR(")=""
"RTN","RMPRN6",22,0)
 I  S ZTSAVE("DATE(")="",ZTSAVE("RMPRZ")="",ZTSAVE("RMPRDET")=""
"RTN","RMPRN6",23,0)
 I  S ZTRTN="PRT^RMPRN6",ZTDESC="Prosthetic NPPD" D ^%ZTLOAD K ZTDESC,ZTIO,ZTRTN,ZTSAVE G EXIT
"RTN","RMPRN6",24,0)
PRT ;print
"RTN","RMPRN6",25,0)
 I '$D(IO("Q")) U IO
"RTN","RMPRN6",26,0)
 D GNP,GNPC
"RTN","RMPRN6",27,0)
 Q
"RTN","RMPRN6",28,0)
ENL ;entry point for one line
"RTN","RMPRN6",29,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPRN6",30,0)
 S RMPRCDE=1
"RTN","RMPRN6",31,0)
 D DATE
"RTN","RMPRN6",32,0)
 G:'$D(DATE(1))!('$D(DATE(2))) EXIT
"RTN","RMPRN6",33,0)
 ;single line always new and used (BOTH) sort
"RTN","RMPRN6",34,0)
 S RMPRDET=6
"RTN","RMPRN6",35,0)
 D GNPCC,EXIT
"RTN","RMPRN6",36,0)
 Q
"RTN","RMPRN6",37,0)
GNP ;gather nppd data
"RTN","RMPRN6",38,0)
 N SORTERR
"RTN","RMPRN6",39,0)
 S $P(LN,"-",IOM)=""
"RTN","RMPRN6",40,0)
 S DATE=DATE(1)-1
"RTN","RMPRN6",41,0)
 K ^TMP($J)
"RTN","RMPRN6",42,0)
 F  S DATE=$O(^RMPR(660,"B",DATE)) Q:(DATE="")!($P(DATE,".",1)>DATE(2))  D
"RTN","RMPRN6",43,0)
 .S RMPRB=0
"RTN","RMPRN6",44,0)
 .F  S RMPRB=$O(^RMPR(660,"B",DATE,RMPRB)) Q:RMPRB'>0  D
"RTN","RMPRN6",45,0)
 ..;define variables for record
"RTN","RMPRN6",46,0)
 ..S REC=$G(^RMPR(660,RMPRB,0)) Q:REC=""
"RTN","RMPRN6",47,0)
 ..Q:$P(REC,U,15)["*"
"RTN","RMPRN6",48,0)
 ..Q:$P(REC,U,10)'=RMPR("STA")
"RTN","RMPRN6",49,0)
 ..;RMPR*3.0*165 corrected logic for new/used reporting criteria
"RTN","RMPRN6",50,0)
 ..;check for USED ONLY pip
"RTN","RMPRN6",51,0)
 ..;if USED pip sort, not pip or not 'va', quit
"RTN","RMPRN6",52,0)
 ..S SORTERR=0
"RTN","RMPRN6",53,0)
 ..I $G(RMPRDET)=2!($G(RMPRDET)=5) D  Q:SORTERR
"RTN","RMPRN6",54,0)
 ... I $P($G(^RMPR(660,RMPRB,1)),U,5)="" S SORTERR=1
"RTN","RMPRN6",55,0)
 ... I $P(REC,U,14)'="V" S SORTERR=1
"RTN","RMPRN6",56,0)
 ..;check for NEW ONLY pip
"RTN","RMPRN6",57,0)
 ..;if NEW pip sort, pip, va, quit
"RTN","RMPRN6",58,0)
 ..I $G(RMPRDET)=1!($G(RMPRDET)=4) D  Q:SORTERR
"RTN","RMPRN6",59,0)
 ... I $P($G(^RMPR(660,RMPRB,1)),U,5)="" Q
"RTN","RMPRN6",60,0)
 ... I $P(REC,U,14)="V" S SORTERR=1
"RTN","RMPRN6",61,0)
 ..S TYPE=$P(REC,U,4)
"RTN","RMPRN6",62,0)
 ..S TY=$S(TYPE="X":2,TYPE=5:2,TYPE="I":1,1:3)
"RTN","RMPRN6",63,0)
 ..S MR=$P($G(^RMPR(660,RMPRB,1)),U,4)
"RTN","RMPRN6",64,0)
 ..I $P(^RMPR(660,RMPRB,0),U,17)'=""&($P(^(0),U,26)="") S TY=2,LINE="R99 A",MR=2676
"RTN","RMPRN6",65,0)
 ..;PICKUP AND DELIVERY
"RTN","RMPRN6",66,0)
 ..I $P(^RMPR(660,RMPRB,0),U,26)'="" S TY=2,LINE="R80 D",MR=2951
"RTN","RMPRN6",67,0)
 ..Q:MR=""
"RTN","RMPRN6",68,0)
 ..;        PATCH 70             Auto-fix
"RTN","RMPRN6",69,0)
 ..K LINE
"RTN","RMPRN6",70,0)
 ..I TY'=2 S LINE=$P(^RMPR(661.1,MR,0),U,7)
"RTN","RMPRN6",71,0)
 ..I TY'=2&($G(LINE)="") D
"RTN","RMPRN6",72,0)
 ...; I TYPE=5 Q
"RTN","RMPRN6",73,0)
 ...S ERR=""
"RTN","RMPRN6",74,0)
 ...S LINE=$P(^RMPR(661.1,MR,0),U,6) S:MR=2676 LINE="R99 A"
"RTN","RMPRN6",75,0)
 ...S TYPE="X"
"RTN","RMPRN6",76,0)
 ...S DIE="^RMPR(660,",DA=RMPRB,DR="2///^S X=TYPE"
"RTN","RMPRN6",77,0)
 ...L +^RMPR(660,RMPRB):1 I '$T S ERR=1
"RTN","RMPRN6",78,0)
 ...I ERR="" D ^DIE L -^RMPR(660,RMPRB)
"RTN","RMPRN6",79,0)
 ...K DIE,DA,DR
"RTN","RMPRN6",80,0)
 ...I ERR=1 S ^TMP($J,"RMPRA",RMPRB)="NO UPDATE!"
"RTN","RMPRN6",81,0)
 ...I ERR="" S ^TMP($J,"RMPRA",RMPRB)="NEW TO REPAIR"
"RTN","RMPRN6",82,0)
 ...S B=RMPRB D DATA^RMPRN6XM
"RTN","RMPRN6",83,0)
 ..I TY=2 S LINE=$P(^RMPR(661.1,MR,0),U,6) S:MR=2676 LINE="R99 A"
"RTN","RMPRN6",84,0)
 ..I TY=2&($G(LINE)="") D
"RTN","RMPRN6",85,0)
 ...; I TYPE=5 Q
"RTN","RMPRN6",86,0)
 ...S ERR=""
"RTN","RMPRN6",87,0)
 ...S LINE=$P(^RMPR(661.1,MR,0),U,7)
"RTN","RMPRN6",88,0)
 ...S TYPE="I"
"RTN","RMPRN6",89,0)
 ...S DIE="^RMPR(660,",DA=RMPRB,DR="2///^S X=TYPE"
"RTN","RMPRN6",90,0)
 ...L +^RMPR(660,RMPRB):1 I '$T S ERR=1
"RTN","RMPRN6",91,0)
 ...I ERR="" D ^DIE L -^RMPR(660,RMPRB)
"RTN","RMPRN6",92,0)
 ...K DIE,DA,DR
"RTN","RMPRN6",93,0)
 ...I ERR=1 S ^TMP($J,"RMPRA",RMPRB)="NO UPDATE!"
"RTN","RMPRN6",94,0)
 ...I ERR="" S ^TMP($J,"RMPRA",RMPRB)="REPAIR TO NEW"
"RTN","RMPRN6",95,0)
 ...S B=RMPRB D DATA^RMPRN6XM
"RTN","RMPRN6",96,0)
 ..;
"RTN","RMPRN6",97,0)
 ..I LINE="" W !,"Line is null, something wrong with file 661.1  :",MR
"RTN","RMPRN6",98,0)
 ..;set to 999 group if null
"RTN","RMPRN6",99,0)
 ..S FLAG=$P(^RMPR(661.1,MR,0),U,8)
"RTN","RMPRN6",100,0)
 ..I FLAG="" S FLAG=2
"RTN","RMPRN6",101,0)
 ..S CATEGRY=$P($G(^RMPR(660,RMPRB,"AM")),U,3),SPEC=$P($G(^("AM")),U,4),GN=$P($G(^("AMS")),U,1)
"RTN","RMPRN6",102,0)
 ..Q:GN=""
"RTN","RMPRN6",103,0)
 ..D SET
"RTN","RMPRN6",104,0)
 D FMT^RMPRN6XM,MAIL^RMPRN6XM
"RTN","RMPRN6",105,0)
 Q
"RTN","RMPRN6",106,0)
GNPC ;worksheet/detail
"RTN","RMPRN6",107,0)
 S STN=RMPR("NAME")
"RTN","RMPRN6",108,0)
 D CAL^RMPRN6
"RTN","RMPRN6",109,0)
 S PAGE=0,FL=""
"RTN","RMPRN6",110,0)
 D ^RMPRN6PT
"RTN","RMPRN6",111,0)
 G:FL=1 EXIT
"RTN","RMPRN6",112,0)
 D ^RMPRN6PR
"RTN","RMPRN6",113,0)
 G:FL=1 EXIT
"RTN","RMPRN6",114,0)
 I RMPRDET<4 G EXIT
"RTN","RMPRN6",115,0)
 D DESP^RMPRN63
"RTN","RMPRN6",116,0)
 D DESPR^RMPRN63
"RTN","RMPRN6",117,0)
EXIT ;commom exit point
"RTN","RMPRN6",118,0)
 D ^%ZISC
"RTN","RMPRN6",119,0)
 N RMPR,RMPRSITE
"RTN","RMPRN6",120,0)
 K ^TMP($J) D KILL^XUSCLEAN
"RTN","RMPRN6",121,0)
 Q
"RTN","RMPRN6",122,0)
GNPCC ;one line only
"RTN","RMPRN6",123,0)
 S STN=RMPR("NAME")
"RTN","RMPRN6",124,0)
 D CODE^RMPRN63
"RTN","RMPRN6",125,0)
 D ^RMPRN6UT
"RTN","RMPRN6",126,0)
 G:$D(DIRUT)!($D(DTOUT)) EXIT
"RTN","RMPRN6",127,0)
 I $G(RMPRCDE)="" S RMPRCDE="",RMPRCDE=$O(BRA(Y,RMPRCDE))
"RTN","RMPRN6",128,0)
 S Y=DATE(1) D DD^%DT S DATE(3)=Y,Y=DATE(2) D DD^%DT S DATE(4)=Y
"RTN","RMPRN6",129,0)
 S %ZIS="Q" D ^%ZIS G:POP EXIT K IOP I $E(IOST,1,2)["C-" G PRTL
"RTN","RMPRN6",130,0)
 I $D(IO("Q")) S ZTIO=ION,ZTSAVE("RMPRSITE")="",ZTSAVE("RMPR(")=""
"RTN","RMPRN6",131,0)
 I  S ZTSAVE("DATE(")="",ZTSAVE("RMPRZ")="",ZTSAVE("RMPRDET")="",ZTSAVE("RMPRCDE")=""
"RTN","RMPRN6",132,0)
 I  S ZTRTN="PRTL^RMPRN6",ZTDESC="Prosthetic NPPD" D ^%ZTLOAD K ZTDESC,ZTIO,ZTRTN,ZTSAVE G EXIT
"RTN","RMPRN6",133,0)
PRTL ;print one line entry from taskman
"RTN","RMPRN6",134,0)
 I '$D(IO("Q")) U IO
"RTN","RMPRN6",135,0)
 D GNP
"RTN","RMPRN6",136,0)
 D CAL^RMPRN6
"RTN","RMPRN6",137,0)
 S PAGE=0,FL=""
"RTN","RMPRN6",138,0)
 S CODE=RMPRCDE
"RTN","RMPRN6",139,0)
 D DESP^RMPRN6PL
"RTN","RMPRN6",140,0)
 Q
"RTN","RMPRN6",141,0)
SET ;set temp global
"RTN","RMPRN6",142,0)
 S STN=RMPR("NAME")
"RTN","RMPRN6",143,0)
 S ^TMP($J,"RMPRGN",STN,GN,FLAG,LINE,RMPRB)=""
"RTN","RMPRN6",144,0)
 S RMSSN=$P(^RMPR(660,RMPRB,0),U,2) I RMSSN S RMSSN=$P(^DPT(RMSSN,0),U,9)
"RTN","RMPRN6",145,0)
 I RMSSN'="" S ^TMP($J,"A",RMSSN)=""
"RTN","RMPRN6",146,0)
 K RMSSN
"RTN","RMPRN6",147,0)
 Q
"RTN","RMPRN6",148,0)
 ;
"RTN","RMPRN6",149,0)
LOOP ;sort on hcpcs key and grouper is complete
"RTN","RMPRN6",150,0)
 ;store in tmp($j,"N",station) or "R"
"RTN","RMPRN6",151,0)
 S (TAM,T1,RMPRB,COUNT,CODE,RMPRAD,DATE,RMPRFG,RMPRT,RMPRI,RMPRNW,RMPRRPR)=0
"RTN","RMPRN6",152,0)
 S (TQTY,RMPROTH,CC,RMPRC,RMPRN,TT,RMPRPSC,VA,CM,RMPRCT1,SO,SI,DIS,RMPRCT,RMPR21,CODE,RMPRB,FM,LEG,RMPRNI,RMPRNO,RMPRSL,RMPRAA,RMPRPHC)=0
"RTN","RMPRN6",153,0)
 S DATE=DATE(1),RMPRB=0
"RTN","RMPRN6",154,0)
CAL ;loop through grouper key sort
"RTN","RMPRN6",155,0)
 S STN=RMPR("NAME")
"RTN","RMPRN6",156,0)
 D CODE^RMPRN63
"RTN","RMPRN6",157,0)
 S GN=""
"RTN","RMPRN6",158,0)
 F  S GN=$O(^TMP($J,"RMPRGN",STN,GN)) Q:GN=""  D
"RTN","RMPRN6",159,0)
 .S FLG=0
"RTN","RMPRN6",160,0)
 .F  S FLG=$O(^TMP($J,"RMPRGN",STN,GN,FLG)) Q:FLG'>0  D  I FLG=1&(RMPRDET'=2)!(RMPRDET'=5) Q
"RTN","RMPRN6",161,0)
 ..;used items never get grouped
"RTN","RMPRN6",162,0)
 ..I FLG=1&(RMPRDET'=2)&(RMPRDET'=5) D GROUP Q
"RTN","RMPRN6",163,0)
 ..;I FLG=1 D GROUP Q
"RTN","RMPRN6",164,0)
 ..S CODE=0
"RTN","RMPRN6",165,0)
 ..F  S CODE=$O(^TMP($J,"RMPRGN",STN,GN,FLG,CODE)) Q:CODE=""  D
"RTN","RMPRN6",166,0)
 ...S RD=0
"RTN","RMPRN6",167,0)
 ...F  S RD=$O(^TMP($J,"RMPRGN",STN,GN,FLG,CODE,RD)) Q:RD'>0  D
"RTN","RMPRN6",168,0)
 ....I RMPRDET=1!(RMPRDET=4) D SORT Q
"RTN","RMPRN6",169,0)
 ....I RMPRDET=2!(RMPRDET=5) D SORTUSED^RMPRN6S Q
"RTN","RMPRN6",170,0)
 ....I RMPRDET=3!(RMPRDET=6) D SORTBOTH^RMPRN6S Q
"RTN","RMPRN6",171,0)
 ....;D SORT
"RTN","RMPRN6",172,0)
 Q
"RTN","RMPRN6",173,0)
GROUP ;total grouper to main key
"RTN","RMPRN6",174,0)
 M BC=^TMP($J,"RMPRGN",STN,GN)
"RTN","RMPRN6",175,0)
 S BF=0,BTCOST=0,SRD=""
"RTN","RMPRN6",176,0)
 ;bc array is entrie PO 2421
"RTN","RMPRN6",177,0)
 F  S BF=$O(BC(BF)) Q:BF'>0  D
"RTN","RMPRN6",178,0)
 .;b1 is line,or code
"RTN","RMPRN6",179,0)
 .S BL=0
"RTN","RMPRN6",180,0)
 .F  S BL=$O(BC(BF,BL)) Q:BL=""  D
"RTN","RMPRN6",181,0)
 ..S BR=0
"RTN","RMPRN6",182,0)
 ..;BR is record number
"RTN","RMPRN6",183,0)
 ..F  S BR=$O(BC(BF,BL,BR)) Q:BR'>0  D
"RTN","RMPRN6",184,0)
 ...S BCOST=$P(^RMPR(660,BR,0),U,16)
"RTN","RMPRN6",185,0)
 ...S BTCOST=BTCOST+BCOST
"RTN","RMPRN6",186,0)
 ...I (BF=1)&(SRD="") S SRD=BR,CODE="",CODE=$O(BC(1,CODE))
"RTN","RMPRN6",187,0)
 K BC
"RTN","RMPRN6",188,0)
 Q:SRD=""
"RTN","RMPRN6",189,0)
 ;calculate based on primary
"RTN","RMPRN6",190,0)
 S TYPE=$P(^RMPR(660,SRD,0),U,4)
"RTN","RMPRN6",191,0)
 S TY=$S(TYPE="X":2,TYPE=5:2,TYPE="I":1,1:3)
"RTN","RMPRN6",192,0)
 S SOURCE=$P(^RMPR(660,SRD,0),U,14)
"RTN","RMPRN6",193,0)
 S COST=BTCOST
"RTN","RMPRN6",194,0)
 ;stock issue display and calculate zero used cost if VA source
"RTN","RMPRN6",195,0)
 I $P(^RMPR(660,SRD,1),U,5)'=""&(SOURCE["V") S BTCOST=0,COST=0
"RTN","RMPRN6",196,0)
 I $P(^RMPR(660,SRD,0),U,13)["-3" S COST=0,SOURCE="VA",BTCOST=0
"RTN","RMPRN6",197,0)
 S QTY=$P(^RMPR(660,SRD,0),U,7)
"RTN","RMPRN6",198,0)
 S ^TMP($J,CODE,SRD)=COST
"RTN","RMPRN6",199,0)
 S CATEGRY=$P($G(^RMPR(660,SRD,"AM")),U,3),SPEC=$P($G(^("AM")),U,4),GN=$P(^("AMS"),U,1)
"RTN","RMPRN6",200,0)
 ;new or repair code
"RTN","RMPRN6",201,0)
 S B1=SRD
"RTN","RMPRN6",202,0)
 I TY=2 D REP
"RTN","RMPRN6",203,0)
 I TY'=2 D NEW
"RTN","RMPRN6",204,0)
 Q
"RTN","RMPRN6",205,0)
SORT ;main data for worksheets
"RTN","RMPRN6",206,0)
 S TYPE=$P(^RMPR(660,RD,0),U,4)
"RTN","RMPRN6",207,0)
 S TY=$S(TYPE="X":2,TYPE=5:2,TYPE="I":1,1:3)
"RTN","RMPRN6",208,0)
 S SOURCE=$P(^RMPR(660,RD,0),U,14)
"RTN","RMPRN6",209,0)
 I SOURCE="" S SOURCE="C"
"RTN","RMPRN6",210,0)
 S CATEGRY=$P($G(^RMPR(660,RD,"AM")),U,3),SPEC=$P($G(^("AM")),U,4),GN=$P(^("AMS"),U,1)
"RTN","RMPRN6",211,0)
 S COST=$P(^RMPR(660,RD,0),U,16)
"RTN","RMPRN6",212,0)
 ;stock issue source VA, used cost calculation is zero
"RTN","RMPRN6",213,0)
 I $P(^RMPR(660,RD,1),U,5)'=""&(SOURCE["V") S COST=0
"RTN","RMPRN6",214,0)
 ;form
"RTN","RMPRN6",215,0)
 S FORM=$P(^RMPR(660,RD,0),U,13)
"RTN","RMPRN6",216,0)
 I (FORM=4)!(FORM=15) S COST=0,SOURCE="V"
"RTN","RMPRN6",217,0)
 S QTY=$P(^RMPR(660,RD,0),U,7)
"RTN","RMPRN6",218,0)
 S B1=RD
"RTN","RMPRN6",219,0)
 S ^TMP($J,CODE,RD)=COST
"RTN","RMPRN6",220,0)
 I TY=2 D REP
"RTN","RMPRN6",221,0)
 I TY'=2 D NEW
"RTN","RMPRN6",222,0)
 Q
"RTN","RMPRN6",223,0)
REP ;calculate repair cost
"RTN","RMPRN6",224,0)
 ;I $G(RD)'="" D
"RTN","RMPRN6",225,0)
 ;.S SSN=$P(^RMPR(660,RD,0),U,2) I SSN S SSN=$P(^DPT(SSN,0),U,9)
"RTN","RMPRN6",226,0)
 ;.I SSN'="" S ^TMP($J,"A",SSN)=""
"RTN","RMPRN6",227,0)
 ;.K SSN
"RTN","RMPRN6",228,0)
 S LINE=CODE
"RTN","RMPRN6",229,0)
 I LINE="R99 A" S SOURCE="C",QTY=1
"RTN","RMPRN6",230,0)
 I $G(^TMP($J,"R",STN,LINE))="" S ^TMP($J,"R",STN,LINE)=""
"RTN","RMPRN6",231,0)
 I SOURCE["V" S $P(^TMP($J,"R",STN,LINE),U,1)=$P(^TMP($J,"R",STN,LINE),U,1)+QTY
"RTN","RMPRN6",232,0)
 I SOURCE["C" S $P(^TMP($J,"R",STN,LINE),U,2)=$P(^TMP($J,"R",STN,LINE),U,2)+QTY
"RTN","RMPRN6",233,0)
 ;
"RTN","RMPRN6",234,0)
 S $P(^TMP($J,"R",STN,LINE),U,3)=$P(^TMP($J,"R",STN,LINE),U,3)+COST
"RTN","RMPRN6",235,0)
 I CATEGRY=1 S $P(^TMP($J,"R",STN,LINE),U,4)=$P(^TMP($J,"R",STN,LINE),U,4)+1
"RTN","RMPRN6",236,0)
 I CATEGRY=4 S $P(^TMP($J,"R",STN,LINE),U,5)=$P(^TMP($J,"R",STN,LINE),U,5)+1
"RTN","RMPRN6",237,0)
 I CATEGRY=2 S $P(^TMP($J,"R",STN,LINE),U,6)=$P(^TMP($J,"R",STN,LINE),U,6)+1
"RTN","RMPRN6",238,0)
 I CATEGRY=3 S $P(^TMP($J,"R",STN,LINE),U,7)=$P(^TMP($J,"R",STN,LINE),U,7)+1
"RTN","RMPRN6",239,0)
 I SPEC=1 S $P(^TMP($J,"R",STN,LINE),U,8)=$P(^TMP($J,"R",STN,LINE),U,8)+1
"RTN","RMPRN6",240,0)
 I SPEC=2 S $P(^TMP($J,"R",STN,LINE),U,9)=$P(^TMP($J,"R",STN,LINE),U,9)+1
"RTN","RMPRN6",241,0)
 I SPEC=3 S $P(^TMP($J,"R",STN,LINE),U,10)=$P(^TMP($J,"R",STN,LINE),U,10)+1
"RTN","RMPRN6",242,0)
 I SPEC=4 S $P(^TMP($J,"R",STN,LINE),U,11)=$P(^TMP($J,"R",STN,LINE),U,11)+1,$P(^(LINE),U,16)=$P(^(LINE),U,16)+COST
"RTN","RMPRN6",243,0)
 I TYPE="I" S $P(^TMP($J,"R",STN,LINE),U,12)=$P(^TMP($J,"R",STN,LINE),U,12)+1
"RTN","RMPRN6",244,0)
 Q
"RTN","RMPRN6",245,0)
 ;
"RTN","RMPRN6",246,0)
NEW ;calculate new costs
"RTN","RMPRN6",247,0)
 ;I $G(RD)'="" D
"RTN","RMPRN6",248,0)
 ;.S SSN=$P(^RMPR(660,RD,0),U,2) I SSN S SSN=$P(^DPT(SSN,0),U,9)
"RTN","RMPRN6",249,0)
 ;.I SSN'="" S ^TMP($J,"A",SSN)=""
"RTN","RMPRN6",250,0)
 ;.K SSN
"RTN","RMPRN6",251,0)
 S LINE=CODE
"RTN","RMPRN6",252,0)
 I $G(^TMP($J,"N",STN,LINE))="" S ^TMP($J,"N",STN,LINE)=""
"RTN","RMPRN6",253,0)
 I SOURCE["V" S $P(^TMP($J,"N",STN,LINE),U,1)=$P(^TMP($J,"N",STN,LINE),U,1)+QTY
"RTN","RMPRN6",254,0)
 I SOURCE["C" S $P(^TMP($J,"N",STN,LINE),U,2)=$P(^TMP($J,"N",STN,LINE),U,2)+QTY
"RTN","RMPRN6",255,0)
 S $P(^TMP($J,"N",STN,LINE),U,3)=$P(^TMP($J,"N",STN,LINE),U,3)+COST
"RTN","RMPRN6",256,0)
 I CATEGRY=1 S $P(^TMP($J,"N",STN,LINE),U,4)=$P(^TMP($J,"N",STN,LINE),U,4)+1
"RTN","RMPRN6",257,0)
 I CATEGRY=4 S $P(^TMP($J,"N",STN,LINE),U,5)=$P(^TMP($J,"N",STN,LINE),U,5)+1
"RTN","RMPRN6",258,0)
 I CATEGRY=2 S $P(^TMP($J,"N",STN,LINE),U,6)=$P(^TMP($J,"N",STN,LINE),U,6)+1
"RTN","RMPRN6",259,0)
 I CATEGRY=3 S $P(^TMP($J,"N",STN,LINE),U,7)=$P(^TMP($J,"N",STN,LINE),U,7)+1
"RTN","RMPRN6",260,0)
 I SPEC=1 S $P(^TMP($J,"N",STN,LINE),U,8)=$P(^TMP($J,"N",STN,LINE),U,8)+1
"RTN","RMPRN6",261,0)
 I SPEC=2 S $P(^TMP($J,"N",STN,LINE),U,9)=$P(^TMP($J,"N",STN,LINE),U,9)+1
"RTN","RMPRN6",262,0)
 I SPEC=3 S $P(^TMP($J,"N",STN,LINE),U,10)=$P(^TMP($J,"N",STN,LINE),U,10)+1
"RTN","RMPRN6",263,0)
 I SPEC=4 S $P(^TMP($J,"N",STN,LINE),U,11)=$P(^TMP($J,"N",STN,LINE),U,11)+1,$P(^(LINE),U,16)=$P(^(LINE),U,16)+COST
"RTN","RMPRN6",264,0)
 I TYPE="I" S $P(^TMP($J,"N",STN,LINE),U,12)=$P(^TMP($J,"N",STN,LINE),U,12)+1
"RTN","RMPRN6",265,0)
 Q
"VER")
8.0^22.0
"BLD",7844,6)
^145
**END**
**END**
