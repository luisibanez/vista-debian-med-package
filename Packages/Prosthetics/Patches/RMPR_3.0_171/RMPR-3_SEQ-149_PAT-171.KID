EMERGENCY Released RMPR*3*171 SEQ #149
Extracted from mail message
**KIDS**:RMPR*3.0*171^

**INSTALL NAME**
RMPR*3.0*171
"BLD",8382,0)
RMPR*3.0*171^PROSTHETICS^0^3120701^y
"BLD",8382,1,0)
^^2^2^3120701^
"BLD",8382,1,1,0)
1. Unlinked patient 2319s not displaying in option 'Link Patient Record
"BLD",8382,1,2,0)
   to Suspense'.
"BLD",8382,4,0)
^9.64PA^^
"BLD",8382,6.3)
1
"BLD",8382,"ABPKG")
n
"BLD",8382,"KRN",0)
^9.67PA^779.2^20
"BLD",8382,"KRN",.4,0)
.4
"BLD",8382,"KRN",.401,0)
.401
"BLD",8382,"KRN",.402,0)
.402
"BLD",8382,"KRN",.403,0)
.403
"BLD",8382,"KRN",.5,0)
.5
"BLD",8382,"KRN",.84,0)
.84
"BLD",8382,"KRN",3.6,0)
3.6
"BLD",8382,"KRN",3.8,0)
3.8
"BLD",8382,"KRN",9.2,0)
9.2
"BLD",8382,"KRN",9.8,0)
9.8
"BLD",8382,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8382,"KRN",9.8,"NM",1,0)
RMPRPCE1^^0^B35595468
"BLD",8382,"KRN",9.8,"NM","B","RMPRPCE1",1)

"BLD",8382,"KRN",19,0)
19
"BLD",8382,"KRN",19.1,0)
19.1
"BLD",8382,"KRN",101,0)
101
"BLD",8382,"KRN",409.61,0)
409.61
"BLD",8382,"KRN",771,0)
771
"BLD",8382,"KRN",779.2,0)
779.2
"BLD",8382,"KRN",870,0)
870
"BLD",8382,"KRN",8989.51,0)
8989.51
"BLD",8382,"KRN",8989.52,0)
8989.52
"BLD",8382,"KRN",8994,0)
8994
"BLD",8382,"KRN","B",.4,.4)

"BLD",8382,"KRN","B",.401,.401)

"BLD",8382,"KRN","B",.402,.402)

"BLD",8382,"KRN","B",.403,.403)

"BLD",8382,"KRN","B",.5,.5)

"BLD",8382,"KRN","B",.84,.84)

"BLD",8382,"KRN","B",3.6,3.6)

"BLD",8382,"KRN","B",3.8,3.8)

"BLD",8382,"KRN","B",9.2,9.2)

"BLD",8382,"KRN","B",9.8,9.8)

"BLD",8382,"KRN","B",19,19)

"BLD",8382,"KRN","B",19.1,19.1)

"BLD",8382,"KRN","B",101,101)

"BLD",8382,"KRN","B",409.61,409.61)

"BLD",8382,"KRN","B",771,771)

"BLD",8382,"KRN","B",779.2,779.2)

"BLD",8382,"KRN","B",870,870)

"BLD",8382,"KRN","B",8989.51,8989.51)

"BLD",8382,"KRN","B",8989.52,8989.52)

"BLD",8382,"KRN","B",8994,8994)

"BLD",8382,"QDEF")
^^^^^^^^^^YES
"BLD",8382,"QUES",0)
^9.62^^
"BLD",8382,"REQB",0)
^9.611^1^1
"BLD",8382,"REQB",1,0)
RMPR*3.0*163^2
"BLD",8382,"REQB","B","RMPR*3.0*163",1)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
171^3120701
"PKG",101,22,1,"PAH",1,1,0)
^^2^2^3120701
"PKG",101,22,1,"PAH",1,1,1,0)
1. Unlinked patient 2319s not displaying in option 'Link Patient Record
"PKG",101,22,1,"PAH",1,1,2,0)
   to Suspense'.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","RMPRPCE1")
0^1^B35595468^B35212918
"RTN","RMPRPCE1",1,0)
RMPRPCE1 ;HCIOFO/RVD - Prosthetics/PCE UPDATE UTILITY ;5/7/03  09:12
"RTN","RMPRPCE1",2,0)
 ;;3.0;PROSTHETICS;**62,69,77,78,146,163,171**;Feb 09, 1996;Build 1
"RTN","RMPRPCE1",3,0)
 ;
"RTN","RMPRPCE1",4,0)
 ;patch #69
"RTN","RMPRPCE1",5,0)
 ;RVD 4/10/02 - validate the length (16 c) of provisional diagnosis
"RTN","RMPRPCE1",6,0)
 ;              before filing.  Change Routine Prosthetic to ROUTINE
"RTN","RMPRPCE1",7,0)
 ;              Type of Request field in 660.
"RTN","RMPRPCE1",8,0)
 ;RVD 5/6/03 patch #77 - SET Consult Request Service field in #660.
"RTN","RMPRPCE1",9,0)
 ;                     - POST init for setting Consult Request Service. 
"RTN","RMPRPCE1",10,0)
 ;TH 9/29/03 Patch #78 - Add Billing Aware related fields.
"RTN","RMPRPCE1",11,0)
 ;
"RTN","RMPRPCE1",12,0)
 ;DBIA # 10060, Fileman read of file #200.
"RTN","RMPRPCE1",13,0)
 ;
"RTN","RMPRPCE1",14,0)
 ;This routine contains the code for updating file #660 and #668.
"RTN","RMPRPCE1",15,0)
 ;
"RTN","RMPRPCE1",16,0)
 ;RMIE60 - ien of file #660
"RTN","RMPRPCE1",17,0)
UP60(RMIE60,RMIE68,RMSUSTAT) ; update file #660.
"RTN","RMPRPCE1",18,0)
 D NEWVAR
"RTN","RMPRPCE1",19,0)
 S RMERR=0
"RTN","RMPRPCE1",20,0)
 S:RMSUSTAT="" RMSUSTAT=0
"RTN","RMPRPCE1",21,0)
 L +^RMPR(660,RMIE60):2
"RTN","RMPRPCE1",22,0)
 I $T=0 W !,"Someone else is Editing this entry!!!",! H 3 S RMERR=1 G UP60X
"RTN","RMPRPCE1",23,0)
 S RM680=$G(^RMPR(668,RMIE68,0))
"RTN","RMPRPCE1",24,0)
 S RM688=$G(^RMPR(668,RMIE68,8))
"RTN","RMPRPCE1",25,0)
 S RM6810=$G(^RMPR(668,RMIE68,10))
"RTN","RMPRPCE1",26,0)
 ;code here for 668 fields
"RTN","RMPRPCE1",27,0)
 S RMDATE=$P(RM680,U,1)  ;Suspense Date
"RTN","RMPRPCE1",28,0)
 S RMCODT=$P(RM680,U,5)  ;Completion Date
"RTN","RMPRPCE1",29,0)
 S RMINDT=$P(RM680,U,9)  ;Initial Action Date
"RTN","RMPRPCE1",30,0)
 S RMPRCO=$P(RM680,U,15) ;Consult
"RTN","RMPRPCE1",31,0)
 S RMDWRT=$P(RM680,U,16) ;Date RX Written
"RTN","RMPRPCE1",32,0)
 S RMSTAT=$P(RM680,U,7)  ;Station
"RTN","RMPRPCE1",33,0)
 S RMTRES=$P(RM680,U,8)  ;Type of Request
"RTN","RMPRPCE1",34,0)
 S RMTYRE=$S(RMTRES=1:"ROUTINE",RMTRES=2:"EYEGLASS",RMTRES=3:"CONTACT LENS",RMTRES=4:"OXYGEN",RMTRES=5:"MANUAL",1:"")
"RTN","RMPRPCE1",35,0)
 S RMREQU=$P(RM680,U,11) ;Requestor (Ordering Provider)
"RTN","RMPRPCE1",36,0)
 S RMSERV=""
"RTN","RMPRPCE1",37,0)
 ;I $G(RMREQU) D GETS^DIQ(200,RMREQU,"29","E","RMAA") S RMSERV=RMAA(200,RMREQU_",",29,"E")
"RTN","RMPRPCE1",38,0)
 S RMPRDI=$E($P(RM688,U,2),1,16) ;Provisional Diagnosis
"RTN","RMPRPCE1",39,0)
 S RMICD9=$P(RM688,U,3)   ;ICD9
"RTN","RMPRPCE1",40,0)
 ;
"RTN","RMPRPCE1",41,0)
 S RMDAT(660,RMIE60_",",8.1)=RMDATE    ;Suspense Date
"RTN","RMPRPCE1",42,0)
 S RMDAT(660,RMIE60_",",8.2)=RMDWRT    ;Date RX Written
"RTN","RMPRPCE1",43,0)
 S RMDAT(660,RMIE60_",",8.3)=RMINDT    ;Initial Action Date
"RTN","RMPRPCE1",44,0)
 S RMDAT(660,RMIE60_",",8.4)=RMCODT    ;Completion Date
"RTN","RMPRPCE1",45,0)
 S RMDAT(660,RMIE60_",",8.5)=RMTYRE    ;Type of Request
"RTN","RMPRPCE1",46,0)
 S RMDAT(660,RMIE60_",",8.6)=RMREQU    ;Ordering Provider
"RTN","RMPRPCE1",47,0)
 S RMDAT(660,RMIE60_",",8.61)=RMSERV   ;Consult Request Service
"RTN","RMPRPCE1",48,0)
 S RMDAT(660,RMIE60_",",8.7)=RMPRDI    ;Provisional Diagnosis
"RTN","RMPRPCE1",49,0)
 S RMDAT(660,RMIE60_",",8.8)=RMICD9    ;Suspense ICD9
"RTN","RMPRPCE1",50,0)
 S RMDAT(660,RMIE60_",",8.9)=RMPRCO    ;Pointer to Request/Consultation
"RTN","RMPRPCE1",51,0)
 S RMDAT(660,RMIE60_",",8.11)=RMSTAT   ;Suspense Station
"RTN","RMPRPCE1",52,0)
 S RMDAT(660,RMIE60_",",8.14)=RMSUSTAT ;Suspense Status
"RTN","RMPRPCE1",53,0)
 ;
"RTN","RMPRPCE1",54,0)
 ; Patch #78
"RTN","RMPRPCE1",55,0)
 ; #668,BA nodes
"RTN","RMPRPCE1",56,0)
 F RMPRL=1:1:99 S RM68BA=$G(^RMPR(668,RMIE68,"BA"_RMPRL)) Q:RM68BA=""  D
"RTN","RMPRPCE1",57,0)
 . N RMICD,RMAO,RMIR,RMSC,RMEC,RMMST,RMHNC,RMCBV
"RTN","RMPRPCE1",58,0)
 . S RMICD=$P(RM68BA,U,1)
"RTN","RMPRPCE1",59,0)
 . S RMAO=$P(RM68BA,U,2)
"RTN","RMPRPCE1",60,0)
 . S RMIR=$P(RM68BA,U,3)
"RTN","RMPRPCE1",61,0)
 . S RMSC=$P(RM68BA,U,4)
"RTN","RMPRPCE1",62,0)
 . S RMEC=$P(RM68BA,U,5)
"RTN","RMPRPCE1",63,0)
 . S RMMST=$P(RM68BA,U,6)
"RTN","RMPRPCE1",64,0)
 . S RMHNC=$P(RM68BA,U,7)
"RTN","RMPRPCE1",65,0)
 . S RMCBV=$P(RM68BA,U,8)
"RTN","RMPRPCE1",66,0)
 . N RMPTR
"RTN","RMPRPCE1",67,0)
 . S RMPTR=29+RMPRL
"RTN","RMPRPCE1",68,0)
 . S RMDAT(660,RMIE60_",",RMPTR)=RMICD
"RTN","RMPRPCE1",69,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".1")=RMAO
"RTN","RMPRPCE1",70,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".2")=RMIR
"RTN","RMPRPCE1",71,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".3")=RMSC
"RTN","RMPRPCE1",72,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".4")=RMEC
"RTN","RMPRPCE1",73,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".5")=RMMST
"RTN","RMPRPCE1",74,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".6")=RMHNC
"RTN","RMPRPCE1",75,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".7")=RMCBV
"RTN","RMPRPCE1",76,0)
 ;
"RTN","RMPRPCE1",77,0)
 D UPDATE^DIE("","RMDAT",,"RMERROR")
"RTN","RMPRPCE1",78,0)
 I $D(RMERROR) S RMERR=1 D ERR0
"RTN","RMPRPCE1",79,0)
 ;
"RTN","RMPRPCE1",80,0)
 L -^RMPR(660,RMIE60)
"RTN","RMPRPCE1",81,0)
UP60X ; exit point
"RTN","RMPRPCE1",82,0)
 Q RMERR
"RTN","RMPRPCE1",83,0)
 ;
"RTN","RMPRPCE1",84,0)
 ;RMIE60 = IEN of file #660.
"RTN","RMPRPCE1",85,0)
 ;RMIE68 = IEN of file #668.
"RTN","RMPRPCE1",86,0)
UP68(RMIE60,RMIE68,RMAMIS) ; update file #668.
"RTN","RMPRPCE1",87,0)
 D NEWVAR
"RTN","RMPRPCE1",88,0)
 S (RMI,RMERR)=0
"RTN","RMPRPCE1",89,0)
 ;S RMAMIS=$G(^RMPR(660,RMIE60,"AMS"))
"RTN","RMPRPCE1",90,0)
 I '$G(RMAMIS) D ERR8 S RMERR=1 G UP68X
"RTN","RMPRPCE1",91,0)
 ;L +^RMPR(668,RMIE68):2
"RTN","RMPRPCE1",92,0)
 ;I $T=0 W !,"Someone else is Editing this entry!!!",! H 3 S RMERR=1 G UP68X
"RTN","RMPRPCE1",93,0)
 I $D(^RMPR(668,RMIE68,10,"B",RMIE60)) G UP68X
"RTN","RMPRPCE1",94,0)
 S DA(1)=RMIE68 K DD,DO
"RTN","RMPRPCE1",95,0)
 S DIC="^RMPR(668,"_DA(1)_","_"10,",DIC(0)="L",DLAYGO=668,X=RMIE60
"RTN","RMPRPCE1",96,0)
 D FILE^DICN K DIC,X,DLAYGO,DD,DO
"RTN","RMPRPCE1",97,0)
 I Y=-1 S RMERR=1 D ERR8 G UNL68
"RTN","RMPRPCE1",98,0)
 I $D(^RMPR(668,RMIE68,11,"B",RMAMIS)) G UP68X
"RTN","RMPRPCE1",99,0)
 S DA(1)=RMIE68
"RTN","RMPRPCE1",100,0)
 S DIC="^RMPR(668,"_DA(1)_","_"11,",DIC(0)="L",DLAYGO=668,X=RMAMIS
"RTN","RMPRPCE1",101,0)
 D FILE^DICN K DIC
"RTN","RMPRPCE1",102,0)
 I Y=-1 S RMERR=1 D ERR8 G UNL68
"RTN","RMPRPCE1",103,0)
 ;
"RTN","RMPRPCE1",104,0)
UNL68 ;L -^RMPR(668,RMIE68)
"RTN","RMPRPCE1",105,0)
UP68X ; exit point
"RTN","RMPRPCE1",106,0)
 Q RMERR
"RTN","RMPRPCE1",107,0)
 ;
"RTN","RMPRPCE1",108,0)
ERR0 ;error updating file #660
"RTN","RMPRPCE1",109,0)
 W !,"*** Error updating file #660 in PCE module!!!",!
"RTN","RMPRPCE1",110,0)
 Q
"RTN","RMPRPCE1",111,0)
ERR8 ;error updating file #668
"RTN","RMPRPCE1",112,0)
 W !,"*** Error updating file #668 in PCE module!!!",!
"RTN","RMPRPCE1",113,0)
 Q
"RTN","RMPRPCE1",114,0)
LINK ;link 2319 to suspense
"RTN","RMPRPCE1",115,0)
 N IEN660,XIEN,CTR,R10
"RTN","RMPRPCE1",116,0)
 D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPRPCE1",117,0)
 K ^TMP($J)
"RTN","RMPRPCE1",118,0)
 ;Patch RMPR*3.0*163 will first find the patient in the suspense file to insure there are unlinked transactions, message/exit if not
"RTN","RMPRPCE1",119,0)
 ;if unlinked transactions it will then make call to file 660 to display available items to be linked
"RTN","RMPRPCE1",120,0)
 D GETPAT^RMPRUTIL G:$D(X) EXIT
"RTN","RMPRPCE1",121,0)
 S IEN660=+DFN,XIEN=0,CTR=0
"RTN","RMPRPCE1",122,0)
 ;Patch RMPR*3.0*171  Insure node ^RMPR(660,IEN660,10) exists, if not, count as unlinked
"RTN","RMPRPCE1",123,0)
 F I=1:1 S XIEN=$O(^RMPR(660,"C",IEN660,XIEN)) Q:XIEN=""  S R10=$G(^RMPR(660,XIEN,10)) S:R10="" CTR=1 Q:CTR  I $P(R10,U,14)'=1,$D(^RMPR(660,XIEN,"AMS")),RMPR("STA")=$P($G(^RMPR(660,XIEN,0)),U,10) S CTR=1 Q
"RTN","RMPRPCE1",124,0)
 I CTR'=1 W !,?2,$C(7),">> NO patient unlinked items available to be posted to Suspense, hit return" R CTR:15 G EXIT
"RTN","RMPRPCE1",125,0)
 W ! S DIC="^RMPR(660,",DIC(0)="EQZ",D="C",X=+DFN
"RTN","RMPRPCE1",126,0)
 S DIC("S")="S RMZ=$G(^RMPR(660,+Y,10)) I $P(RMZ,U,14)'=1,$D(^(""AMS"")),RMPR(""STA"")=$P(^(0),U,10)"
"RTN","RMPRPCE1",127,0)
 S DIC("W")="D EN^RMPRD1"
"RTN","RMPRPCE1",128,0)
 W !
"RTN","RMPRPCE1",129,0)
 D IX^DIC G:Y'>0 EXIT
"RTN","RMPRPCE1",130,0)
 L +^RMPR(660,+Y):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRPCE1",131,0)
 S RMPRDA=+Y
"RTN","RMPRPCE1",132,0)
 S RMPRDFN=$P(^RMPR(660,+Y,0),U,2)
"RTN","RMPRPCE1",133,0)
 I $D(^RMPR(660,+Y,"AMS")) N RMPRAMIS S RMPRAMIS=$P(^RMPR(660,+Y,"AMS"),U,1)
"RTN","RMPRPCE1",134,0)
 S ^TMP($J,"RMPRPCE",660,+Y)=RMPRAMIS_"^"_RMPRDFN
"RTN","RMPRPCE1",135,0)
 D LINK^RMPRS
"RTN","RMPRPCE1",136,0)
 I $G(RMPRDA)="" S RMPRDA=$O(^TMP($J,"RMPRPCE",660,0))
"RTN","RMPRPCE1",137,0)
 I $G(RMPRDA)="" L  G EXIT
"RTN","RMPRPCE1",138,0)
 L -^RMPR(660,RMPRDA)
"RTN","RMPRPCE1",139,0)
EXIT ;quit
"RTN","RMPRPCE1",140,0)
 K ^TMP($J)
"RTN","RMPRPCE1",141,0)
 K RMPR,RMPRSTE
"RTN","RMPRPCE1",142,0)
 K RMCODT
"RTN","RMPRPCE1",143,0)
 D KILL^XUSCLEAN
"RTN","RMPRPCE1",144,0)
 Q
"RTN","RMPRPCE1",145,0)
 ;
"RTN","RMPRPCE1",146,0)
SCRS ;set consult request service.
"RTN","RMPRPCE1",147,0)
 ;start conversion on 1/1/2002, the date of PCE/Link to suspense patch.
"RTN","RMPRPCE1",148,0)
 W !!,"Setting Consult Request Service in file #660....."
"RTN","RMPRPCE1",149,0)
 N RI,RJ F RI=3020100:0 S RI=$O(^RMPR(660,"B",RI)) Q:RI'>0  F RJ=0:0 S RJ=$O(^RMPR(660,"B",RI,RJ)) Q:RJ'>0  I $D(^RMPR(660,RJ,10)) D
"RTN","RMPRPCE1",150,0)
 .K RMAA
"RTN","RMPRPCE1",151,0)
 .S RMREQU=$P(^RMPR(660,RJ,10),U,6)
"RTN","RMPRPCE1",152,0)
 .S RMSERV=""
"RTN","RMPRPCE1",153,0)
 .I $G(RMREQU) D GETS^DIQ(200,RMREQU,"29","E","RMAA") S RMSERV=RMAA(200,RMREQU_",",29,"E")
"RTN","RMPRPCE1",154,0)
 .S:RMSERV'="" $P(^RMPR(660,RJ,4),U,3)=RMSERV
"RTN","RMPRPCE1",155,0)
 W !!,"Done setting Consult Request Service!!",!
"RTN","RMPRPCE1",156,0)
 Q
"RTN","RMPRPCE1",157,0)
 ;
"RTN","RMPRPCE1",158,0)
NEWVAR N DA,DIE,DIC,I,J,RMDFN,RMI,RMDATE,RM680,RM688,RM6810,RMERROR
"RTN","RMPRPCE1",159,0)
 N RMERR,RMCHK,RMAMIS,DLAYGO,X,DR,RMAA,RMSERV,RMREQU,RMDAT
"RTN","RMPRPCE1",160,0)
 N RMPRL,RM68BA,RMDWRT,RMICD9,RMINDT,RMPRCO,RMPRDI,RMSTAT,RMTRES,RMTYRE
"RTN","RMPRPCE1",161,0)
 Q
"VER")
8.0^22.0
"BLD",8382,6)
^149
**END**
**END**
