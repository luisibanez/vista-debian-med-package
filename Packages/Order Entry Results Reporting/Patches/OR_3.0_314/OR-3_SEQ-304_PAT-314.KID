Released OR*3*314 SEQ #304
Extracted from mail message
**KIDS**:OR*3.0*314^

**INSTALL NAME**
OR*3.0*314
"BLD",8130,0)
OR*3.0*314^ORDER ENTRY/RESULTS REPORTING^0^3120124^y
"BLD",8130,1,0)
^^4^4^3090612^
"BLD",8130,1,1,0)
This patch corrects an issue with a recursive lookup that causes a very
"BLD",8130,1,2,0)
long pause in the software.  It also corrects a situation where a user
"BLD",8130,1,3,0)
can select a large number of items to replace, but only some of them are
"BLD",8130,1,4,0)
updated.
"BLD",8130,4,0)
^9.64PA^^
"BLD",8130,6)
1^
"BLD",8130,6.3)
3
"BLD",8130,"ABPKG")
n
"BLD",8130,"KRN",0)
^9.67PA^779.2^20
"BLD",8130,"KRN",.4,0)
.4
"BLD",8130,"KRN",.401,0)
.401
"BLD",8130,"KRN",.402,0)
.402
"BLD",8130,"KRN",.403,0)
.403
"BLD",8130,"KRN",.5,0)
.5
"BLD",8130,"KRN",.84,0)
.84
"BLD",8130,"KRN",3.6,0)
3.6
"BLD",8130,"KRN",3.8,0)
3.8
"BLD",8130,"KRN",9.2,0)
9.2
"BLD",8130,"KRN",9.8,0)
9.8
"BLD",8130,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8130,"KRN",9.8,"NM",1,0)
ORCMEDT5^^0^B36616080
"BLD",8130,"KRN",9.8,"NM","B","ORCMEDT5",1)

"BLD",8130,"KRN",19,0)
19
"BLD",8130,"KRN",19.1,0)
19.1
"BLD",8130,"KRN",101,0)
101
"BLD",8130,"KRN",409.61,0)
409.61
"BLD",8130,"KRN",771,0)
771
"BLD",8130,"KRN",779.2,0)
779.2
"BLD",8130,"KRN",870,0)
870
"BLD",8130,"KRN",8989.51,0)
8989.51
"BLD",8130,"KRN",8989.52,0)
8989.52
"BLD",8130,"KRN",8994,0)
8994
"BLD",8130,"KRN","B",.4,.4)

"BLD",8130,"KRN","B",.401,.401)

"BLD",8130,"KRN","B",.402,.402)

"BLD",8130,"KRN","B",.403,.403)

"BLD",8130,"KRN","B",.5,.5)

"BLD",8130,"KRN","B",.84,.84)

"BLD",8130,"KRN","B",3.6,3.6)

"BLD",8130,"KRN","B",3.8,3.8)

"BLD",8130,"KRN","B",9.2,9.2)

"BLD",8130,"KRN","B",9.8,9.8)

"BLD",8130,"KRN","B",19,19)

"BLD",8130,"KRN","B",19.1,19.1)

"BLD",8130,"KRN","B",101,101)

"BLD",8130,"KRN","B",409.61,409.61)

"BLD",8130,"KRN","B",771,771)

"BLD",8130,"KRN","B",779.2,779.2)

"BLD",8130,"KRN","B",870,870)

"BLD",8130,"KRN","B",8989.51,8989.51)

"BLD",8130,"KRN","B",8989.52,8989.52)

"BLD",8130,"KRN","B",8994,8994)

"BLD",8130,"QUES",0)
^9.62^^
"BLD",8130,"REQB",0)
^9.611^1^1
"BLD",8130,"REQB",1,0)
OR*3.0*296^1
"BLD",8130,"REQB","B","OR*3.0*296",1)

"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2971217^2980417^1271
"PKG",167,22,1,"PAH",1,0)
314^3120124^15000026
"PKG",167,22,1,"PAH",1,1,0)
^^4^4^3120124
"PKG",167,22,1,"PAH",1,1,1,0)
This patch corrects an issue with a recursive lookup that causes a very
"PKG",167,22,1,"PAH",1,1,2,0)
long pause in the software.  It also corrects a situation where a user
"PKG",167,22,1,"PAH",1,1,3,0)
can select a large number of items to replace, but only some of them are
"PKG",167,22,1,"PAH",1,1,4,0)
updated.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORCMEDT5")
0^1^B36616080^B35418320
"RTN","ORCMEDT5",1,0)
ORCMEDT5 ;SLC/MKB-Misc menu utilities ;03:29 PM  12 Feb 1999
"RTN","ORCMEDT5",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**8,46,296,314**;Dec 17, 1997;Build 3
"RTN","ORCMEDT5",3,0)
SEARCH ; -- Search/replace menu items
"RTN","ORCMEDT5",4,0)
 N ORDLG
"RTN","ORCMEDT5",5,0)
 F  S ORDLG=$$DIC Q:ORDLG'>0  D SR1(ORDLG) W !!
"RTN","ORCMEDT5",6,0)
 Q
"RTN","ORCMEDT5",7,0)
 ;
"RTN","ORCMEDT5",8,0)
SR1(ORX) ; -- list parents, get replacement
"RTN","ORCMEDT5",9,0)
 N CNT,DA,DR,DIE,DIK,I,J,ORDAD,ORY,ORNMBR,NUM,ORI,ORDAD,ORNM
"RTN","ORCMEDT5",10,0)
 I '$O(^ORD(101.41,"AD",+ORX,0)) W !,$P(ORX,U,2)_" has no menu items." Q
"RTN","ORCMEDT5",11,0)
 W @IOF,"Menu items of "_$P(ORX,U,2),!?4,"Name",?69,"Type",!,$$REPEAT^XLFSTR("-",79)
"RTN","ORCMEDT5",12,0)
 S (I,ORDAD)=0 F  S I=$O(^ORD(101.41,"AD",+ORX,I)) Q:I'>0  D
"RTN","ORCMEDT5",13,0)
 . S J=0 F  S J=$O(^ORD(101.41,"AD",+ORX,I,J)) Q:J'>0  D
"RTN","ORCMEDT5",14,0)
 . . S ORDAD=ORDAD+1,ORDAD(ORDAD)=I_U_J
"RTN","ORCMEDT5",15,0)
 . . W !,ORDAD,?4,$P(^ORD(101.41,I,0),U),?69,$$TYPE($P(^(0),U,4))
"RTN","ORCMEDT5",16,0)
 W !,$$REPEAT^XLFSTR("-",79)
"RTN","ORCMEDT5",17,0)
 S ORY=$$REPLWITH(ORX) Q:ORY="^"
"RTN","ORCMEDT5",18,0)
 D SELECT(ORY,ORDAD,.ORNMBR) Q:ORNMBR="^"
"RTN","ORCMEDT5",19,0)
 Q:'$$OK  W !!,$S(ORY="@":"Removing",1:"Replacing "_$P(ORX,U,2)_" with "_$P(ORY,U,2))_" in:"
"RTN","ORCMEDT5",20,0)
 S CNT="" F  S CNT=$O(ORNMBR(CNT)) Q:CNT=""  D
"RTN","ORCMEDT5",21,0)
 . D LOOP($G(ORNMBR(CNT)))
"RTN","ORCMEDT5",22,0)
 Q
"RTN","ORCMEDT5",23,0)
LOOP(ORNMBR)    ;
"RTN","ORCMEDT5",24,0)
 F ORI=1:1:$L(ORNMBR,",") S NUM=$P(ORNMBR,",",ORI) I NUM D
"RTN","ORCMEDT5",25,0)
 . S DA(1)=+ORDAD(NUM),DA=$P(ORDAD(NUM),U,2),DIE="^ORD(101.41,"_DA(1)_",10,"
"RTN","ORCMEDT5",26,0)
 . S ORDAD=DA(1),ORNM=$P(^ORD(101.41,ORDAD,0),U) W !?3,ORNM_" ..."
"RTN","ORCMEDT5",27,0)
 . I '$$VALID(ORY,ORDAD,.ORERR) D  Q
"RTN","ORCMEDT5",28,0)
 . . W "not "_$S(ORY="@":"removed.",1:"changed."),!?3,">> "_$G(ORERR)
"RTN","ORCMEDT5",29,0)
 . . S I=0 F  S I=$O(ORERR(I)) Q:I'>0  W !?25,"=>"_ORERR(I)
"RTN","ORCMEDT5",30,0)
 . I ORY="@" S DIK=DIE D ^DIK W "done." Q
"RTN","ORCMEDT5",31,0)
 . S DR="2////"_+ORY D ^DIE W $S($P(^ORD(101.41,DA(1),10,DA,0),U,2)=+ORY:"done.",1:"error - not replaced.")
"RTN","ORCMEDT5",32,0)
 Q
"RTN","ORCMEDT5",33,0)
 ;
"RTN","ORCMEDT5",34,0)
TYPE(X) ; -- Returns name of dialog type
"RTN","ORCMEDT5",35,0)
 N Y S Y=$S(X="P":"prompt",X="D":"dialog",X="Q":"quick order",X="O":"order set",X="M":"menu",X="A":"action",1:"")
"RTN","ORCMEDT5",36,0)
 Q Y
"RTN","ORCMEDT5",37,0)
 ;
"RTN","ORCMEDT5",38,0)
DIC() ; -- ^DIC on Order Dialog file
"RTN","ORCMEDT5",39,0)
 N X,Y,DIC
"RTN","ORCMEDT5",40,0)
 S DIC=101.41,DIC(0)="AEQM",DIC("A")="Search for: "
"RTN","ORCMEDT5",41,0)
 S DIC("?")="Enter the name of the dialog component you wish to search for."
"RTN","ORCMEDT5",42,0)
 D ^DIC
"RTN","ORCMEDT5",43,0)
 Q Y
"RTN","ORCMEDT5",44,0)
 ;
"RTN","ORCMEDT5",45,0)
SELECT(ORY,MAX,Y) ; -- Select which Dlgs to replace items
"RTN","ORCMEDT5",46,0)
 N X,DIR
"RTN","ORCMEDT5",47,0)
 S DIR(0)="LA^1:"_MAX,DIR("A")=$S(ORY="@":"Remove in: ",1:"Replace in: "),DIR("B")=$S(MAX>1:"1-"_MAX,1:"1")
"RTN","ORCMEDT5",48,0)
 ; S DIR("?")
"RTN","ORCMEDT5",49,0)
 D ^DIR S:$D(DTOUT)!(X["^") Y="^"
"RTN","ORCMEDT5",50,0)
 Q
"RTN","ORCMEDT5",51,0)
 ;
"RTN","ORCMEDT5",52,0)
OK() ; -- Are you ready?
"RTN","ORCMEDT5",53,0)
 N X,Y,DIR
"RTN","ORCMEDT5",54,0)
 S DIR(0)="YA",DIR("A")="Are you ready? ",DIR("B")="NO"
"RTN","ORCMEDT5",55,0)
 W ! D ^DIR
"RTN","ORCMEDT5",56,0)
 Q +Y
"RTN","ORCMEDT5",57,0)
 ;
"RTN","ORCMEDT5",58,0)
REPLWITH(ORIT) ; -- Remove item, or select replacement
"RTN","ORCMEDT5",59,0)
 N X,Y,DIR,DIC
"RTN","ORCMEDT5",60,0)
 S DIR(0)="FAO^1:63",DIR("A")="Replace "_$P(ORIT,U,2)_" with: "
"RTN","ORCMEDT5",61,0)
 S DIR("?")="Enter the name of the item you wish to replace this one with, or @ to remove this item; to quit without changing anything, press <return>."
"RTN","ORCMEDT5",62,0)
R1 D ^DIR I X="@" Q "@"
"RTN","ORCMEDT5",63,0)
 I $D(DTOUT)!("^"[X) Q "^"
"RTN","ORCMEDT5",64,0)
 S DIC=101.41,DIC(0)="EQM" D ^DIC I Y'>0 G R1
"RTN","ORCMEDT5",65,0)
 Q Y
"RTN","ORCMEDT5",66,0)
 ;
"RTN","ORCMEDT5",67,0)
VALID(ITM,DAD,ERR) ; -- Ck if ITM may be placed on DAD
"RTN","ORCMEDT5",68,0)
 N DTYPE,ITYPE,Y S Y=0
"RTN","ORCMEDT5",69,0)
 S DTYPE=$P(^ORD(101.41,DAD,0),U,4) I DTYPE="D",$$NMSP^ORCD($P(^(0),U,7))'="OR" S ERR="Only generic ordering dialogs are editable." G VQ
"RTN","ORCMEDT5",70,0)
 I ITM="@" S Y=1 G VQ ; ok to delete
"RTN","ORCMEDT5",71,0)
 S ITYPE=$P(^ORD(101.41,+ITM,0),U,4)
"RTN","ORCMEDT5",72,0)
 I ITYPE="P",DTYPE'="D" S ERR="A prompt may not be added to a "_$$TYPE(DTYPE)_"." G VQ
"RTN","ORCMEDT5",73,0)
 I ITYPE="A","DOM"'[DTYPE S ERR="An action may not be added to a "_$$TYPE(DTYPE)_"." G VQ
"RTN","ORCMEDT5",74,0)
 I "DQOM"[ITYPE,"OM"'[DTYPE S ERR="A "_$$TYPE(ITYPE)_" may not be added to a "_$$TYPE(DTYPE)_"." G VQ
"RTN","ORCMEDT5",75,0)
 D RECURSV(+ITM,DAD,.ERR) I $D(ERR) S Y=0 G VQ
"RTN","ORCMEDT5",76,0)
 S Y=1 ; ok
"RTN","ORCMEDT5",77,0)
VQ Q Y
"RTN","ORCMEDT5",78,0)
 ;
"RTN","ORCMEDT5",79,0)
RECURSV(ITEM,MENU,MSG) ; -- Return 1 or 0, if recursive reference to ITEM
"RTN","ORCMEDT5",80,0)
 N STACK,CNT S STACK=0,CNT=0
"RTN","ORCMEDT5",81,0)
 K MSG D CHKPAR(MENU)
"RTN","ORCMEDT5",82,0)
 Q
"RTN","ORCMEDT5",83,0)
CHKPAR(MENU) ; follow tree to check parents
"RTN","ORCMEDT5",84,0)
 N PMENU,I
"RTN","ORCMEDT5",85,0)
 S STACK=STACK+1,STACK(STACK)=MENU,STACK("B",MENU)=STACK,PMENU=0
"RTN","ORCMEDT5",86,0)
 F  S PMENU=$O(^ORD(101.41,"AD",MENU,PMENU)) Q:'PMENU  D  Q:$D(MSG)
"RTN","ORCMEDT5",87,0)
 . I PMENU=ITEM D  Q
"RTN","ORCMEDT5",88,0)
 . . S MSG="Recursive Reference: "_$P(^ORD(101.41,ITEM,0),U)
"RTN","ORCMEDT5",89,0)
 . . F I=STACK:-1:1 S CNT=CNT+1,MSG(CNT)=$P(^ORD(101.41,STACK(I),0),U)
"RTN","ORCMEDT5",90,0)
 . I $D(STACK("B",PMENU)) Q
"RTN","ORCMEDT5",91,0)
 . D CHKPAR(PMENU)
"RTN","ORCMEDT5",92,0)
 K STACK(STACK) S STACK=STACK-1
"RTN","ORCMEDT5",93,0)
 Q
"RTN","ORCMEDT5",94,0)
 ;
"RTN","ORCMEDT5",95,0)
INUSE(MENU) ; -- Returns 1 or 0, if MENU is in use by parameter
"RTN","ORCMEDT5",96,0)
 N PARAM,ENT,Y
"RTN","ORCMEDT5",97,0)
 S PARAM=$O(^XTV(8989.51,"B","OR ADD ORDERS MENU",0)),Y=0
"RTN","ORCMEDT5",98,0)
 S ENT="" F  S ENT=$O(^XTV(8989.5,"AC",PARAM,ENT)) Q:ENT=""  I $G(^(ENT,1))=MENU S Y=1 Q
"RTN","ORCMEDT5",99,0)
 Q Y
"RTN","ORCMEDT5",100,0)
 ;
"RTN","ORCMEDT5",101,0)
ASSIGN ; -- Assign menu to user(s)
"RTN","ORCMEDT5",102,0)
 D FULL^VALM1
"RTN","ORCMEDT5",103,0)
 D EDITPAR^XPAREDIT("OR ADD ORDERS MENU")
"RTN","ORCMEDT5",104,0)
 S VALMBCK="R"
"RTN","ORCMEDT5",105,0)
 Q
"RTN","ORCMEDT5",106,0)
 ;
"RTN","ORCMEDT5",107,0)
INQ ; -- Inquire to Order Dialog file
"RTN","ORCMEDT5",108,0)
 N X,Y,DIC,DA,DR,DIQ
"RTN","ORCMEDT5",109,0)
 S DIC="^ORD(101.41,",DIC(0)="AEQM"
"RTN","ORCMEDT5",110,0)
 F  D ^DIC Q:Y'>0  S DA=+Y W ! D EN^DIQ W !
"RTN","ORCMEDT5",111,0)
 Q
"RTN","ORCMEDT5",112,0)
 ;
"RTN","ORCMEDT5",113,0)
OUTPUT(ORY) ; -- Output Xform for Value field of Response multiple
"RTN","ORCMEDT5",114,0)
 N ORDIALOG,ORP,ORZ S ORZ=ORY
"RTN","ORCMEDT5",115,0)
 S ORP=$P($G(^ORD(101.41,D0,6,D1,0)),U,2)
"RTN","ORCMEDT5",116,0)
 I ORP S ORDIALOG(ORP,0)=$P($G(^ORD(101.41,ORP,1)),U,1,2),ORDIALOG(ORP,1)=ORY,ORZ=$$EXT^ORCD(ORP,1)
"RTN","ORCMEDT5",117,0)
 Q ORZ
"RTN","ORCMEDT5",118,0)
 ;
"RTN","ORCMEDT5",119,0)
AOPAR ; -- List of add order menus assigned to users
"RTN","ORCMEDT5",120,0)
 N BY,DHD,DIC,FLDS,FR,TO
"RTN","ORCMEDT5",121,0)
 S DIC=8989.5
"RTN","ORCMEDT5",122,0)
 S FR="OR ADD ORDERS MENU,?",TO="OR ADD ORDERS MENU,?"
"RTN","ORCMEDT5",123,0)
 S BY="@.02,@1;S2;""Add order menu: """
"RTN","ORCMEDT5",124,0)
 S DHD="CPRS Add order menu list"
"RTN","ORCMEDT5",125,0)
 S FLDS="VALUE;N;""Menu"",ENTITY;""User/Location/etc."";C40"
"RTN","ORCMEDT5",126,0)
 D EN1^DIP
"RTN","ORCMEDT5",127,0)
 Q
"RTN","ORCMEDT5",128,0)
 ;
"RTN","ORCMEDT5",129,0)
DISABLE ; -- Disable order dialogs
"RTN","ORCMEDT5",130,0)
 N X,Y,DIC,DIR,ORDIS,ORI K ^TMP("ORDISABLE",$J)
"RTN","ORCMEDT5",131,0)
 S DIC=101.41,DIC(0)="AEQM",DIC("A")="Select ORDER DIALOG: ",DIC("?")="Enter the name of an order dialog you wish to disable."
"RTN","ORCMEDT5",132,0)
 S DIC("W")="I $L($P(^(0),U,3)) W !?3,"">> disabled: ""_$P(^(0),U,3)"
"RTN","ORCMEDT5",133,0)
 F  D ^DIC Q:Y'>0  S ^TMP("ORDISABLE",$J,+Y)="" S DIC("A")="ANOTHER ONE: "
"RTN","ORCMEDT5",134,0)
 Q:'$O(^TMP("ORDISABLE",$J,0))  ;none selected
"RTN","ORCMEDT5",135,0)
 W !!,"Enter a message to disable the dialog(s), or @ to enable again."
"RTN","ORCMEDT5",136,0)
 S DIR(0)="FAO^1:40",DIR("A")="MESSAGE: "
"RTN","ORCMEDT5",137,0)
 S DIR("?")="Enter up to 40 characters explaining why use of this dialog has been disabled that will display if the dialog is selected, or @ to enable the dialog again."
"RTN","ORCMEDT5",138,0)
 D ^DIR G:$D(DTOUT)!$D(DUOUT)!(X="") DQ S ORDIS=X
"RTN","ORCMEDT5",139,0)
 I '$$OK W !,"Nothing "_$S(ORDIS="@":"en",1:"dis")_"abled." H 1 G DQ
"RTN","ORCMEDT5",140,0)
 S ORI=0  F  S ORI=$O(^TMP("ORDISABLE",$J,ORI)) Q:ORI'>0  S $P(^ORD(101.41,ORI,0),U,3)=$S(ORDIS="@":"",1:ORDIS) W "."
"RTN","ORCMEDT5",141,0)
 W !,"done." H 1
"RTN","ORCMEDT5",142,0)
DQ K ^TMP("ORDISABLE",$J)
"RTN","ORCMEDT5",143,0)
 Q
"VER")
8.0^22.0
"BLD",8130,6)
^304
**END**
**END**
