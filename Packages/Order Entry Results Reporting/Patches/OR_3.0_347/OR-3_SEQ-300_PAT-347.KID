Released OR*3*347 SEQ #300
Extracted from mail message
**KIDS**:OR*3.0*347^

**INSTALL NAME**
OR*3.0*347
"BLD",8435,0)
OR*3.0*347^ORDER ENTRY/RESULTS REPORTING^0^3110913^y
"BLD",8435,1,0)
^^12^12^3110315^
"BLD",8435,1,1,0)
This patch will correct the following issues:
"BLD",8435,1,2,0)
1)Relative dates are not saving time in custom views in the CPRS orders 
"BLD",8435,1,3,0)
  tab.
"BLD",8435,1,4,0)
 
"BLD",8435,1,5,0)
2)Data on the clinical surgery report is hanging over from one item to 
"BLD",8435,1,6,0)
  another.
"BLD",8435,1,7,0)
 
"BLD",8435,1,8,0)
3)When creating a new patient movement, discontinued orders are 
"BLD",8435,1,9,0)
  displaying on the "Copy active orders for selected event" dialog
"BLD",8435,1,10,0)
 
"BLD",8435,1,11,0)
4)Incorrect data is showing up on the Search orders by Nature or Status 
"BLD",8435,1,12,0)
  [OR NATURE/STATUS ORDER SEARCH] report.
"BLD",8435,4,0)
^9.64PA^^
"BLD",8435,6)
2^
"BLD",8435,6.3)
4
"BLD",8435,"KRN",0)
^9.67PA^779.2^20
"BLD",8435,"KRN",.4,0)
.4
"BLD",8435,"KRN",.401,0)
.401
"BLD",8435,"KRN",.402,0)
.402
"BLD",8435,"KRN",.403,0)
.403
"BLD",8435,"KRN",.5,0)
.5
"BLD",8435,"KRN",.84,0)
.84
"BLD",8435,"KRN",3.6,0)
3.6
"BLD",8435,"KRN",3.8,0)
3.8
"BLD",8435,"KRN",9.2,0)
9.2
"BLD",8435,"KRN",9.8,0)
9.8
"BLD",8435,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",8435,"KRN",9.8,"NM",1,0)
OREVNTX1^^0^B76466044
"BLD",8435,"KRN",9.8,"NM",2,0)
ORWSR^^0^B28551721
"BLD",8435,"KRN",9.8,"NM",3,0)
ORWOR^^0^B42185290
"BLD",8435,"KRN",9.8,"NM",4,0)
ORSNAST2^^0^B25134010
"BLD",8435,"KRN",9.8,"NM","B","OREVNTX1",1)

"BLD",8435,"KRN",9.8,"NM","B","ORSNAST2",4)

"BLD",8435,"KRN",9.8,"NM","B","ORWOR",3)

"BLD",8435,"KRN",9.8,"NM","B","ORWSR",2)

"BLD",8435,"KRN",19,0)
19
"BLD",8435,"KRN",19.1,0)
19.1
"BLD",8435,"KRN",101,0)
101
"BLD",8435,"KRN",409.61,0)
409.61
"BLD",8435,"KRN",771,0)
771
"BLD",8435,"KRN",779.2,0)
779.2
"BLD",8435,"KRN",870,0)
870
"BLD",8435,"KRN",8989.51,0)
8989.51
"BLD",8435,"KRN",8989.52,0)
8989.52
"BLD",8435,"KRN",8994,0)
8994
"BLD",8435,"KRN","B",.4,.4)

"BLD",8435,"KRN","B",.401,.401)

"BLD",8435,"KRN","B",.402,.402)

"BLD",8435,"KRN","B",.403,.403)

"BLD",8435,"KRN","B",.5,.5)

"BLD",8435,"KRN","B",.84,.84)

"BLD",8435,"KRN","B",3.6,3.6)

"BLD",8435,"KRN","B",3.8,3.8)

"BLD",8435,"KRN","B",9.2,9.2)

"BLD",8435,"KRN","B",9.8,9.8)

"BLD",8435,"KRN","B",19,19)

"BLD",8435,"KRN","B",19.1,19.1)

"BLD",8435,"KRN","B",101,101)

"BLD",8435,"KRN","B",409.61,409.61)

"BLD",8435,"KRN","B",771,771)

"BLD",8435,"KRN","B",779.2,779.2)

"BLD",8435,"KRN","B",870,870)

"BLD",8435,"KRN","B",8989.51,8989.51)

"BLD",8435,"KRN","B",8989.52,8989.52)

"BLD",8435,"KRN","B",8994,8994)

"BLD",8435,"QUES",0)
^9.62^^
"BLD",8435,"REQB",0)
^9.611^3^3
"BLD",8435,"REQB",1,0)
OR*3.0*280^2
"BLD",8435,"REQB",2,0)
OR*3.0*330^2
"BLD",8435,"REQB",3,0)
OR*3.0*274^2
"BLD",8435,"REQB","B","OR*3.0*274",3)

"BLD",8435,"REQB","B","OR*3.0*280",1)

"BLD",8435,"REQB","B","OR*3.0*330",2)

"MBREQ")
0
"PKG",188,-1)
1^1
"PKG",188,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",188,20,0)
^9.402P^^
"PKG",188,22,0)
^9.49I^1^1
"PKG",188,22,1,0)
3.0^2971217^2981113^1
"PKG",188,22,1,"PAH",1,0)
347^3110913^520665228
"PKG",188,22,1,"PAH",1,1,0)
^^12^12^3110913
"PKG",188,22,1,"PAH",1,1,1,0)
This patch will correct the following issues:
"PKG",188,22,1,"PAH",1,1,2,0)
1)Relative dates are not saving time in custom views in the CPRS orders 
"PKG",188,22,1,"PAH",1,1,3,0)
  tab.
"PKG",188,22,1,"PAH",1,1,4,0)
 
"PKG",188,22,1,"PAH",1,1,5,0)
2)Data on the clinical surgery report is hanging over from one item to 
"PKG",188,22,1,"PAH",1,1,6,0)
  another.
"PKG",188,22,1,"PAH",1,1,7,0)
 
"PKG",188,22,1,"PAH",1,1,8,0)
3)When creating a new patient movement, discontinued orders are 
"PKG",188,22,1,"PAH",1,1,9,0)
  displaying on the "Copy active orders for selected event" dialog
"PKG",188,22,1,"PAH",1,1,10,0)
 
"PKG",188,22,1,"PAH",1,1,11,0)
4)Incorrect data is showing up on the Search orders by Nature or Status 
"PKG",188,22,1,"PAH",1,1,12,0)
  [OR NATURE/STATUS ORDER SEARCH] report.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","OREVNTX1")
0^1^B76466044^B75868849
"RTN","OREVNTX1",1,0)
OREVNTX1 ; SLC/JLI - Event delayed orders RPC's ; 4/5/11 2:53pm
"RTN","OREVNTX1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,165,149,243,280,347**;Dec 17, 1997;Build 4
"RTN","OREVNTX1",3,0)
 ;
"RTN","OREVNTX1",4,0)
PUTEVNT(ORY,DFN,EVT,ORIFN) ; Save new patient delayed events to file 100.2
"RTN","OREVNTX1",5,0)
 S ORY=$$NEW^OREVNT(DFN,EVT,ORIFN)
"RTN","OREVNTX1",6,0)
 Q
"RTN","OREVNTX1",7,0)
 ;
"RTN","OREVNTX1",8,0)
GTEVT(ORY,PTEVT) ; Return Event infomation based on PTEVT ptr #100.2
"RTN","OREVNTX1",9,0)
 ;EVTID     ptr #100.5
"RTN","OREVNTX1",10,0)
 Q:'+PTEVT
"RTN","OREVNTX1",11,0)
 N EVTID,EVTTYPE,EVTNAME,EVTDISP,EVTDLG,PRTEVT
"RTN","OREVNTX1",12,0)
 S (EVTTYPE,EVTNAME,EVTDISP,PRTEVT)=""
"RTN","OREVNTX1",13,0)
 S EVTDLG=0
"RTN","OREVNTX1",14,0)
 I '$P(^ORE(100.2,+$G(PTEVT),0),U,2) Q
"RTN","OREVNTX1",15,0)
 S EVTID=$$EVT^OREVNTX(PTEVT)
"RTN","OREVNTX1",16,0)
 S PRTEVT=$P(^ORD(100.5,EVTID,0),U,12)
"RTN","OREVNTX1",17,0)
 I PRTEVT S EVTTYPE=$P(^ORD(100.5,PRTEVT,0),U,2)
"RTN","OREVNTX1",18,0)
 E  S EVTTYPE=$P(^ORD(100.5,EVTID,0),U,2)
"RTN","OREVNTX1",19,0)
 I $D(^ORD(100.5,EVTID,0)) D
"RTN","OREVNTX1",20,0)
 . S EVTNAME=$P(^ORD(100.5,EVTID,0),U,1)
"RTN","OREVNTX1",21,0)
 . S EVTDISP=$P(^ORD(100.5,EVTID,0),U,8)
"RTN","OREVNTX1",22,0)
 . S EVTDLG=$P(^ORD(100.5,EVTID,0),U,4)
"RTN","OREVNTX1",23,0)
 S ORY=EVTTYPE_U_EVTID_U_EVTNAME_U_EVTDISP_U_EVTDLG
"RTN","OREVNTX1",24,0)
 Q
"RTN","OREVNTX1",25,0)
GTEVT1(ORY,EVT) ; Return Event information based on EVT ptr #100.5
"RTN","OREVNTX1",26,0)
 ;EVT    ptr #100.5
"RTN","OREVNTX1",27,0)
 Q:'+EVT
"RTN","OREVNTX1",28,0)
 N EVTTYPE,EVTNAME,EVTDISP,EVTDLG,PRTEVT
"RTN","OREVNTX1",29,0)
 S (EVTDLG,PRTEVT)=0
"RTN","OREVNTX1",30,0)
 S PRTEVT=$P(^ORD(100.5,+EVT,0),U,12)
"RTN","OREVNTX1",31,0)
 I PRTEVT>0 S EVTTYPE=$P(^ORD(100.5,PRTEVT,0),U,2)
"RTN","OREVNTX1",32,0)
 E  S EVTTYPE=$P(^ORD(100.5,+EVT,0),U,2)
"RTN","OREVNTX1",33,0)
 S EVTNAME=$P($G(^ORD(100.5,+EVT,0)),U,1)
"RTN","OREVNTX1",34,0)
 S EVTDISP=$P($G(^ORD(100.5,+EVT,0)),U,8)
"RTN","OREVNTX1",35,0)
 S EVTDLG=$P($G(^ORD(100.5,+EVT,0)),U,4)
"RTN","OREVNTX1",36,0)
 S ORY=EVTTYPE_U_EVT_U_EVTNAME_U_EVTDISP_U_EVTDLG
"RTN","OREVNTX1",37,0)
 Q
"RTN","OREVNTX1",38,0)
 ;
"RTN","OREVNTX1",39,0)
EVT(ORY,PTEVT) ; Return Event ptr #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX1",40,0)
 Q:'+PTEVT
"RTN","OREVNTX1",41,0)
 S ORY=$$EVT^OREVNTX(PTEVT)
"RTN","OREVNTX1",42,0)
 Q
"RTN","OREVNTX1",43,0)
 ; 
"RTN","OREVNTX1",44,0)
EXISTS(ORY,DFN,EVT) ;Returns PtEvtID ptr #100.2 if patient already has delayed orders
"RTN","OREVNTX1",45,0)
 I '+EVT S ORY=0 Q
"RTN","OREVNTX1",46,0)
 N PTEVT S (PTEVT,ORY)=0
"RTN","OREVNTX1",47,0)
 S PTEVT=$O(^ORE(100.2,"AE",+DFN,+EVT,PTEVT))
"RTN","OREVNTX1",48,0)
 I PTEVT>0 S ORY=PTEVT
"RTN","OREVNTX1",49,0)
 Q
"RTN","OREVNTX1",50,0)
 ;
"RTN","OREVNTX1",51,0)
TYPEXT(ORY,DFN,EVT) ; does EVT has delayed orders?
"RTN","OREVNTX1",52,0)
 ; 1 if Patient DFN has delayed orders for EVT
"RTN","OREVNTX1",53,0)
 ; 2 if Parent/Sibling event has delayed orders
"RTN","OREVNTX1",54,0)
 ; 0 if No delayed orders for EVT
"RTN","OREVNTX1",55,0)
 Q:'+EVT
"RTN","OREVNTX1",56,0)
 S ORY=$$EXISTS^OREVNTX(DFN,EVT)
"RTN","OREVNTX1",57,0)
 Q
"RTN","OREVNTX1",58,0)
 ;
"RTN","OREVNTX1",59,0)
MATCH(ORY,DFN,EVT) ;If Pt's current data match selected event
"RTN","OREVNTX1",60,0)
 ;DFN: patient DFN
"RTN","OREVNTX1",61,0)
 ;EVT: ptr to #100.5
"RTN","OREVNTX1",62,0)
 S ORY=0
"RTN","OREVNTX1",63,0)
 Q:('+DFN)!('+EVT)
"RTN","OREVNTX1",64,0)
 S ORY=$$MATCH^OREVNT(DFN,EVT)
"RTN","OREVNTX1",65,0)
 N TS,TSNM
"RTN","OREVNTX1",66,0)
 S TS=$S($G(ORTS):+ORTS,1:+$G(^DPT(DFN,.103)))
"RTN","OREVNTX1",67,0)
 S TSNM=$P($G(^DIC(45.7,TS,0)),U)
"RTN","OREVNTX1",68,0)
 S:ORY ORY=ORY_U_TSNM
"RTN","OREVNTX1",69,0)
 Q
"RTN","OREVNTX1",70,0)
 ;
"RTN","OREVNTX1",71,0)
NAME(ORY,PTEVT) ; Return Event name from #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX1",72,0)
 I PTEVT'>0 S ORY="" Q
"RTN","OREVNTX1",73,0)
 S ORY=$$NAME^OREVNTX(PTEVT)
"RTN","OREVNTX1",74,0)
 Q
"RTN","OREVNTX1",75,0)
 ;
"RTN","OREVNTX1",76,0)
DIV(ORY,PTEVT) ; Return division for PTEVT ptr #100.2
"RTN","OREVNTX1",77,0)
 Q:'+PTEVT
"RTN","OREVNTX1",78,0)
 S ORY=$$DIV^OREVNTX(PTEVT)
"RTN","OREVNTX1",79,0)
 Q
"RTN","OREVNTX1",80,0)
 ;
"RTN","OREVNTX1",81,0)
DIV1(ORY,EVT) ; Return division for EVT ptr #100.5
"RTN","OREVNTX1",82,0)
 Q:'+EVT
"RTN","OREVNTX1",83,0)
 S ORY=+$P($G(^ORD(100.5,+EVT,0)),U,3) S:ORY<1 ORY=+$G(DUZ(2))
"RTN","OREVNTX1",84,0)
 Q
"RTN","OREVNTX1",85,0)
 ;
"RTN","OREVNTX1",86,0)
LOC(ORY,PTEVT) ; Return default hospital location ^SC( for PTEVT ptr #100.2
"RTN","OREVNTX1",87,0)
 Q:'+PTEVT
"RTN","OREVNTX1",88,0)
 S ORY=$$LOC^OREVNTX(PTEVT)
"RTN","OREVNTX1",89,0)
 S ORY=+ORY
"RTN","OREVNTX1",90,0)
 Q
"RTN","OREVNTX1",91,0)
 ;
"RTN","OREVNTX1",92,0)
LOC1(ORY,EVT) ; Return default hospital location ^SC( for EVT ptr #100.5
"RTN","OREVNTX1",93,0)
 Q:'+EVT
"RTN","OREVNTX1",94,0)
 S ORY=+$P($G(^ORD(100.5,+EVT,0)),U,9) S:ORY<1 ORY=+$G(ORL)
"RTN","OREVNTX1",95,0)
 Q
"RTN","OREVNTX1",96,0)
 ;
"RTN","OREVNTX1",97,0)
CHGEVT(ORY,NEWEVT,ORIDS) ; Change order's event
"RTN","OREVNTX1",98,0)
 N ORI
"RTN","OREVNTX1",99,0)
 S ORI=0
"RTN","OREVNTX1",100,0)
 F  S ORI=$O(ORIDS(ORI)) Q:'+ORI  D
"RTN","OREVNTX1",101,0)
 . D CHGEVT^OREVNTX(+$G(ORIDS(ORI)),NEWEVT)
"RTN","OREVNTX1",102,0)
 Q
"RTN","OREVNTX1",103,0)
 ;
"RTN","OREVNTX1",104,0)
EMPTY(ORY,PTEVT) ; Return 1 if PTEVT doesn't have any orders
"RTN","OREVNTX1",105,0)
 Q:'+PTEVT
"RTN","OREVNTX1",106,0)
 S ORY=$$EMPTY^OREVNTX(PTEVT)
"RTN","OREVNTX1",107,0)
 Q
"RTN","OREVNTX1",108,0)
 ;
"RTN","OREVNTX1",109,0)
DELPTEVT(ORY,PTEVT) ; Delete Patient Event in #100.2
"RTN","OREVNTX1",110,0)
 Q:'+PTEVT
"RTN","OREVNTX1",111,0)
 D CANCEL^OREVNTX(PTEVT)
"RTN","OREVNTX1",112,0)
 Q
"RTN","OREVNTX1",113,0)
 ;
"RTN","OREVNTX1",114,0)
UPDTOR(ORY,PTIFN,ORIFN,PTEVT) ; If delayed order was DCed, then update the EVENT and "AEVNT"
"RTN","OREVNTX1",115,0)
 Q  ;Don't ever need to do this!
"RTN","OREVNTX1",116,0)
CURSPE(ORY,PTIFN) ; Return current treating specialty
"RTN","OREVNTX1",117,0)
 Q:'PTIFN
"RTN","OREVNTX1",118,0)
 N SPEC S SPEC=$$PT^DGPMOBS(PTIFN),ORY=""
"RTN","OREVNTX1",119,0)
 I SPEC'<0 S ORY=$P(SPEC,U,3)_U_$P(SPEC,U,2)_U_$P(SPEC,U) ;name^ien^obs flag
"RTN","OREVNTX1",120,0)
 Q
"RTN","OREVNTX1",121,0)
DFLTEVT(ORY,PVIFN) ; Return default release event based on provider IFN
"RTN","OREVNTX1",122,0)
 N CMEVTLST,IDX
"RTN","OREVNTX1",123,0)
 S CMEVTLST="",IDX=0
"RTN","OREVNTX1",124,0)
 D GETLST^OREV3(.CMEVTLST)
"RTN","OREVNTX1",125,0)
 F  S IDX=$O(CMEVTLST(IDX)) Q:'IDX  D
"RTN","OREVNTX1",126,0)
 . I $P($G(CMEVTLST(IDX)),U,2) S ORY=$P($G(CMEVTLST(IDX)),U) Q
"RTN","OREVNTX1",127,0)
 Q
"RTN","OREVNTX1",128,0)
CMEVTS(ORY,CLOC) ;Return common event list
"RTN","OREVNTX1",129,0)
 N IDX,X0,X,LOC
"RTN","OREVNTX1",130,0)
 S:CLOC>0 LOC=CLOC
"RTN","OREVNTX1",131,0)
 S IDX=0,ORY=""
"RTN","OREVNTX1",132,0)
 D GETLST^OREV3(.ORY)
"RTN","OREVNTX1",133,0)
 F  S IDX=$O(ORY(IDX)) Q:'IDX  D
"RTN","OREVNTX1",134,0)
 . S X0=""
"RTN","OREVNTX1",135,0)
 . S:$L($G(^ORD(100.5,+ORY(IDX),0))) X0=$G(^(0))
"RTN","OREVNTX1",136,0)
 . I '$L($P(X0,U,2)) D
"RTN","OREVNTX1",137,0)
 .. S X=$P(X0,U,12) S:X $P(X0,U,2)=$P($G(^ORD(100.5,+X,0)),U,2)
"RTN","OREVNTX1",138,0)
 . S:$L(X0) ORY(IDX)=+ORY(IDX)_U_X0
"RTN","OREVNTX1",139,0)
 Q
"RTN","OREVNTX1",140,0)
 ;
"RTN","OREVNTX1",141,0)
DELDFLT(ORY,PVIFN) ; Delete default release event
"RTN","OREVNTX1",142,0)
 Q:'PVIFN
"RTN","OREVNTX1",143,0)
 N ORERR
"RTN","OREVNTX1",144,0)
 S ORERR=""
"RTN","OREVNTX1",145,0)
 D DEL^XPAR(PVIFN_";VA(200,","OREVNT DEFAULT",1,.ORERR)
"RTN","OREVNTX1",146,0)
 Q
"RTN","OREVNTX1",147,0)
WRLSTED(LST,LOC,EVTID) ; Return list of dialogs for writing event delayed orders
"RTN","OREVNTX1",148,0)
 ; .Y(n): DlgName^ListBox Text
"RTN","OREVNTX1",149,0)
WRLST1 N ANENT
"RTN","OREVNTX1",150,0)
 S LOC=+$G(LOC)_";SC(" I 'LOC S LOC=""
"RTN","OREVNTX1",151,0)
 S ANENT="ALL^USR.`"_DUZ_"^"_LOC_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
"RTN","OREVNTX1",152,0)
 N MNU,SEQ,IEN,ITM,TXT,FID,DGRP,X,TYP
"RTN","OREVNTX1",153,0)
 S MNU=$$GET^XPAR(ANENT,"ORWDX WRITE ORDERS EVENT LIST",EVTID,"I") Q:'MNU
"RTN","OREVNTX1",154,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,MNU,10,"B",SEQ)) Q:'SEQ  D
"RTN","OREVNTX1",155,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.41,MNU,10,"B",SEQ,IEN)) Q:'IEN  D
"RTN","OREVNTX1",156,0)
 . . S X=$G(^ORD(101.41,MNU,10,IEN,0)),ITM=+$P(X,U,2),TXT=$P(X,U,4)
"RTN","OREVNTX1",157,0)
 . . S X=$G(^ORD(101.41,ITM,5)),FID=+$P(X,U,5)
"RTN","OREVNTX1",158,0)
 . . S X=$G(^ORD(101.41,ITM,0)),TYP=$P(X,U,4),DGRP=+$P(X,U,5)
"RTN","OREVNTX1",159,0)
 . . S:'$L(TXT) TXT=$P(X,U,2)
"RTN","OREVNTX1",160,0)
 . . I TYP="M" S:'FID FID=1001
"RTN","OREVNTX1",161,0)
 . . S LST(SEQ)=ITM_";"_FID_";"_DGRP_";"_TYP_U_TXT
"RTN","OREVNTX1",162,0)
 Q
"RTN","OREVNTX1",163,0)
 ;
"RTN","OREVNTX1",164,0)
GETDLG(LST,DLGID) ; Return dialog infomation based on the DLGID
"RTN","OREVNTX1",165,0)
 N DIEN,DFID,DTXT,DTYP,DGRP,X0,X5
"RTN","OREVNTX1",166,0)
 S DLGID=+DLGID
"RTN","OREVNTX1",167,0)
 Q:'DLGID
"RTN","OREVNTX1",168,0)
 S X0=^ORD(101.41,DLGID,0),X5=$G(^(5))
"RTN","OREVNTX1",169,0)
 S DGRP=+$P(X0,U,5),DFID=+$P(X5,U,5),DTXT=$P(X5,U,4),DTYP=$P(X0,U,4)
"RTN","OREVNTX1",170,0)
    S:'$L(DTXT) DTXT=$P(X0,U,2)
"RTN","OREVNTX1",171,0)
 I $P(X0,U,4)="M" S:'DFID DFID=1001
"RTN","OREVNTX1",172,0)
 S LST=DLGID_";"_DFID_";"_DGRP_";"_DTYP_U_DTXT
"RTN","OREVNTX1",173,0)
 Q
"RTN","OREVNTX1",174,0)
DONE(LST,PTEVT) ; Terminate PTEvt
"RTN","OREVNTX1",175,0)
 Q:'PTEVT
"RTN","OREVNTX1",176,0)
 D DONE^OREVNTX(PTEVT)
"RTN","OREVNTX1",177,0)
 D ACTLOG^OREVNTX(PTEVT,"MN")
"RTN","OREVNTX1",178,0)
 Q
"RTN","OREVNTX1",179,0)
SETDFLT(ORY,EVT) ;Set personal default event
"RTN","OREVNTX1",180,0)
 N ERR,VAL S ERR=""
"RTN","OREVNTX1",181,0)
 Q:'$D(^ORD(100.5,EVT,0))
"RTN","OREVNTX1",182,0)
 S VAL=$P(^ORD(100.5,EVT,0),U)
"RTN","OREVNTX1",183,0)
 D EN^XPAR(DUZ_";VA(200,","OREVNT DEFAULT",1,VAL,ERR)
"RTN","OREVNTX1",184,0)
 S ORY=ERR
"RTN","OREVNTX1",185,0)
 Q
"RTN","OREVNTX1",186,0)
CPACT(ORY,EVT) ; Return True/False to display active orders for copy
"RTN","OREVNTX1",187,0)
 ; EVT ptr to #100.5
"RTN","OREVNTX1",188,0)
 Q:'EVT
"RTN","OREVNTX1",189,0)
 S ORY=0
"RTN","OREVNTX1",190,0)
 Q:'$D(^ORD(100.5,EVT,0))
"RTN","OREVNTX1",191,0)
 S ORY=$P(^ORD(100.5,EVT,0),U,11)
"RTN","OREVNTX1",192,0)
 Q
"RTN","OREVNTX1",193,0)
PRMPTID(ORY,PRTNM) ;Return event prompt IEN for OR GTX EVENT
"RTN","OREVNTX1",194,0)
 S:$D(^ORD(101.41,"B","OR GTX EVENT")) ORY=$O(^("OR GTX EVENT",0))
"RTN","OREVNTX1",195,0)
 Q
"RTN","OREVNTX1",196,0)
ISDCOD(ORY,ORIFN) ;True: the order need to be filtered out
"RTN","OREVNTX1",197,0)
 N PAS,X3,X0,ORGRPLST,THEGRP,IDX,ODGRP
"RTN","OREVNTX1",198,0)
 S (ORY,IDX)=0
"RTN","OREVNTX1",199,0)
 Q:'$D(^OR(100,+ORIFN,0))
"RTN","OREVNTX1",200,0)
 S X0=$G(^OR(100,+ORIFN,0))
"RTN","OREVNTX1",201,0)
 S ODGRP=$P(X0,U,11)
"RTN","OREVNTX1",202,0)
 D GETLST^XPAR(.ORGRPLST,"ALL","OREVNT EXCLUDE DGRP")
"RTN","OREVNTX1",203,0)
 F  S IDX=$O(ORGRPLST(IDX)) Q:'IDX!ORY  D
"RTN","OREVNTX1",204,0)
 . S THEGRP=$P($G(ORGRPLST(IDX)),U,2)
"RTN","OREVNTX1",205,0)
 . I $$GRPCHK(THEGRP,ODGRP) S ORY=1
"RTN","OREVNTX1",206,0)
 I ORY Q
"RTN","OREVNTX1",207,0)
 S PAS=";1;2;7;13;"  ;*347 Update Filter
"RTN","OREVNTX1",208,0)
 S:$D(^OR(100,+ORIFN,3)) X3=^OR(100,+ORIFN,3)
"RTN","OREVNTX1",209,0)
 ;*347 Filter out DC
"RTN","OREVNTX1",210,0)
 S:(PAS[(";"_$P(X3,U,3)_";")) ORY=1
"RTN","OREVNTX1",211,0)
 Q
"RTN","OREVNTX1",212,0)
DEFLTS(ORY,EVTID) ;Return default specialty for EVTID(#100.5)
"RTN","OREVNTX1",213,0)
 Q:'+EVTID
"RTN","OREVNTX1",214,0)
 N PRTEVT
"RTN","OREVNTX1",215,0)
 S PRTEVT=0
"RTN","OREVNTX1",216,0)
 S PRTEVT=$P(^ORD(100.5,+EVTID,0),U,12)
"RTN","OREVNTX1",217,0)
 I PRTEVT>0 S EVTID=PRTEVT
"RTN","OREVNTX1",218,0)
 S ORY=$$DEFTS^ORCDADT(EVTID)
"RTN","OREVNTX1",219,0)
 Q
"RTN","OREVNTX1",220,0)
 ;
"RTN","OREVNTX1",221,0)
MULTS(ORY,EVTID) ;Return specialty list for the EVTID(#100.5)
"RTN","OREVNTX1",222,0)
 Q:'+EVTID
"RTN","OREVNTX1",223,0)
 N I,CNT,X,Y S (I,CNT)=0
"RTN","OREVNTX1",224,0)
 N PRTEVT
"RTN","OREVNTX1",225,0)
 S PRTEVT=0
"RTN","OREVNTX1",226,0)
 S PRTEVT=$P(^ORD(100.5,+EVTID,0),U,12)
"RTN","OREVNTX1",227,0)
 I PRTEVT>0 S EVTID=PRTEVT
"RTN","OREVNTX1",228,0)
 F  S I=$O(^ORD(100.5,+$G(EVTID),"TS",I)) Q:I<1  S X=+$G(^(I,0)) D
"RTN","OREVNTX1",229,0)
 . S Y=$$GET1^DIQ(45.7,X_",",.01)
"RTN","OREVNTX1",230,0)
 . S CNT=CNT+1,ORY(CNT)=X_U_Y
"RTN","OREVNTX1",231,0)
 Q
"RTN","OREVNTX1",232,0)
 ;
"RTN","OREVNTX1",233,0)
PRTIDS(ORY,IDS) ;Return some prompt ids from #101.41
"RTN","OREVNTX1",234,0)
 ; treating specialty Id^attending provider id
"RTN","OREVNTX1",235,0)
 N IDX,ORTS,ORATT
"RTN","OREVNTX1",236,0)
 S (ORY,ORTS,ORATT)=""
"RTN","OREVNTX1",237,0)
 S IDX=$O(^ORD(101.41,"B","OR GTX TREATING SPECIALTY",0))
"RTN","OREVNTX1",238,0)
 S:$D(^ORD(101.41,IDX,1)) ORTS=$P($G(^ORD(101.41,IDX,1)),U,2,3)
"RTN","OREVNTX1",239,0)
 S IDX=$O(^ORD(101.41,"B","OR GTX PROVIDER",0))
"RTN","OREVNTX1",240,0)
 S:$D(^ORD(101.41,IDX,1)) ORATT=$P($G(^ORD(101.41,IDX,1)),U,2,3)
"RTN","OREVNTX1",241,0)
 S ORY=ORTS_"~"_ORATT
"RTN","OREVNTX1",242,0)
 Q
"RTN","OREVNTX1",243,0)
 ;
"RTN","OREVNTX1",244,0)
DFLTDLG(ORY,EVTID) ;Return event default dialog IEN
"RTN","OREVNTX1",245,0)
 S ORY=0
"RTN","OREVNTX1",246,0)
 Q:'$D(^ORD(100.5,+EVTID,0))
"RTN","OREVNTX1",247,0)
 S ORY=$P(^ORD(100.5,+EVTID,0),U,4)
"RTN","OREVNTX1",248,0)
 Q
"RTN","OREVNTX1",249,0)
AUTHMREL(ORY,USER) ;1: user can manual release delayed orders 0: can't
"RTN","OREVNTX1",250,0)
 S ORY=$$CANREL^OREV3
"RTN","OREVNTX1",251,0)
 Q
"RTN","OREVNTX1",252,0)
HAVEPRT(ORY,PTEVT) ;return parent patient event from #100.2
"RTN","OREVNTX1",253,0)
 Q:'+PTEVT
"RTN","OREVNTX1",254,0)
 S ORY=""
"RTN","OREVNTX1",255,0)
 S:$L($G(^ORE(100.2,PTEVT,1))) ORY=$P(^(1),U,5)
"RTN","OREVNTX1",256,0)
 Q
"RTN","OREVNTX1",257,0)
GRPCHK(DG,AGRP) ;If an order's group belong to DG group
"RTN","OREVNTX1",258,0)
 N RST
"RTN","OREVNTX1",259,0)
 S RST=0
"RTN","OREVNTX1",260,0)
 N ORGRP
"RTN","OREVNTX1",261,0)
 D GRP^ORQ1(DG)
"RTN","OREVNTX1",262,0)
 S RST=$S($D(ORGRP(AGRP)):1,1:0)
"RTN","OREVNTX1",263,0)
 Q RST
"RTN","OREVNTX1",264,0)
ODPTEVID(ORY,ORID) ;Return PtEvtID based on the ORID
"RTN","OREVNTX1",265,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","OREVNTX1",266,0)
 S ORY=$P($G(^OR(100,+ORID,0)),U,17)
"RTN","OREVNTX1",267,0)
 Q
"RTN","OREVNTX1",268,0)
COMP(ORY,PTEVT) ;Return 1 or 0 if PTEVT completed or not
"RTN","OREVNTX1",269,0)
 Q:'+PTEVT
"RTN","OREVNTX1",270,0)
 S ORY=$$COMP^OREVNTX(+PTEVT)
"RTN","OREVNTX1",271,0)
 Q
"RTN","OREVNTX1",272,0)
ISHDORD(ORY,ORID) ;Return 1 if it's on-hold med order
"RTN","OREVNTX1",273,0)
 Q:'+ORID
"RTN","OREVNTX1",274,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","OREVNTX1",275,0)
 N STS,HDSTS,ODGP,INPT,OUPT,MEDS,IVMD
"RTN","OREVNTX1",276,0)
 S HDSTS=$O(^ORD(100.01,"B","HOLD",0))
"RTN","OREVNTX1",277,0)
 S STS=$P($G(^OR(100,+ORID,3)),U,3)
"RTN","OREVNTX1",278,0)
 S INPT=$O(^ORD(100.98,"B","UD RX",0))
"RTN","OREVNTX1",279,0)
 S OUPT=$O(^ORD(100.98,"B","O RX",0))
"RTN","OREVNTX1",280,0)
 S MEDS=$O(^ORD(100.98,"B","RX",0))
"RTN","OREVNTX1",281,0)
 S IVMD=$O(^ORD(100.98,"B","IV RX",0))
"RTN","OREVNTX1",282,0)
 S ODGP=$P(^OR(100,+ORID,0),U,11)
"RTN","OREVNTX1",283,0)
 I (U_INPT_U_OUPT_U_MEDS_U_IVMD_U[U_ODGP_U),(HDSTS=STS) S ORY=1
"RTN","OREVNTX1",284,0)
 Q
"RTN","OREVNTX1",285,0)
ISPASS(ORY,PTEVTID,EVTTYPE) ;Return 1 if it's a pass event
"RTN","OREVNTX1",286,0)
 S ORY=$$EVT^OREVNTX(PTEVTID)
"RTN","OREVNTX1",287,0)
 S ORY=$P($G(^ORD(100.5,+ORY,0)),U,7)
"RTN","OREVNTX1",288,0)
 I EVTTYPE="T",ORY,ORY<4 S ORY=1
"RTN","OREVNTX1",289,0)
 E  S ORY=0
"RTN","OREVNTX1",290,0)
 Q
"RTN","OREVNTX1",291,0)
ISPASS1(ORY,EVTID,EVTTYPE) ;Return 1 if it's a pass event
"RTN","OREVNTX1",292,0)
 S ORY=$P($G(^ORD(100.5,+EVTID,0)),U,7)
"RTN","OREVNTX1",293,0)
 I EVTTYPE="T",ORY,ORY<4 S ORY=1
"RTN","OREVNTX1",294,0)
 E  S ORY=0
"RTN","OREVNTX1",295,0)
 Q
"RTN","OREVNTX1",296,0)
DLGIEN(ORY,DLGNAME) ;Return Order Dialog IEN based on name
"RTN","OREVNTX1",297,0)
 Q:'$D(^ORD(101.41,"B",DLGNAME))
"RTN","OREVNTX1",298,0)
 S ORY=$O(^ORD(101.41,"B",DLGNAME,0))
"RTN","OREVNTX1",299,0)
 Q
"RTN","OREVNTX1",300,0)
GETSTS(ORY,ORDID) ;Return Order status
"RTN","OREVNTX1",301,0)
 Q:'+ORDID
"RTN","OREVNTX1",302,0)
 Q:'$D(^OR(100,+ORDID,0))
"RTN","OREVNTX1",303,0)
 S ORY=$P($G(^OR(100,+ORDID,3)),U,3)
"RTN","OREVNTX1",304,0)
 Q
"RTN","OREVNTX1",305,0)
 ;
"RTN","OREVNTX1",306,0)
CHKORD(ORDER) ;Extrinsic function to determine if order is delayed and the "event" order
"RTN","OREVNTX1",307,0)
 ;
"RTN","OREVNTX1",308,0)
 N VALUE
"RTN","OREVNTX1",309,0)
 S VALUE=0
"RTN","OREVNTX1",310,0)
 I +$P($G(^OR(100,ORDER,0)),U,17),'$O(^ORE(100.2,"AO",ORDER,0)) S VALUE=1 ;Delayed but not the "event" order
"RTN","OREVNTX1",311,0)
 Q VALUE
"RTN","ORSNAST2")
0^4^B25134010^B24780861
"RTN","ORSNAST2",1,0)
ORSNAST2 ;SLC/RAF - continuation of nature/status search ; 9/13/11 6:56am
"RTN","ORSNAST2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**50,190,347**;Dec 17, 1997;Build 4
"RTN","ORSNAST2",3,0)
 ;
"RTN","ORSNAST2",4,0)
NATURE ;goes thru the "AF" xref in 100 for order dates for nature or order
"RTN","ORSNAST2",5,0)
1 I SORT=1 D  I ('$D(^TMP("ORNS",$J)))&(FORMAT=1) W !,"No orders found." Q
"RTN","ORSNAST2",6,0)
 .D:('PAGE)&(FORMAT=1) HDR^ORS100
"RTN","ORSNAST2",7,0)
 .S DATE=SDATE F  S DATE=$O(^OR(100,"AF",DATE)) Q:'DATE!STOP  Q:DATE>EDATE  D
"RTN","ORSNAST2",8,0)
 ..S IEN=0 F  S IEN=$O(^OR(100,"AF",DATE,IEN)) Q:'IEN!STOP  I $D(^OR(100,IEN)) D
"RTN","ORSNAST2",9,0)
 ...;*347 We only want to check the current action
"RTN","ORSNAST2",10,0)
 ...S SUB=$$GET1^DIQ(100,IEN,30,"I") Q:'SUB!STOP  D
"RTN","ORSNAST2",11,0)
 ....I $P($G(^OR(100,IEN,8,SUB,0)),U,12)=SEARCH D
"RTN","ORSNAST2",12,0)
 .....I $D(^VA(200,+$P(^OR(100,IEN,8,SUB,0),U,3),0)) S PROV=$$USER^ORS100(+$P(^OR(100,IEN,8,SUB,0),U,3))
"RTN","ORSNAST2",13,0)
 .....I $D(^VA(200,+$P(^OR(100,IEN,0),U,4),5)),$L($P(^(5),U)) S SER=$$SER^ORS100(+$P(^VA(200,+$P(^OR(100,IEN,0),U,4),5),U))
"RTN","ORSNAST2",14,0)
 .....E  S SER="MISSING from file 200"
"RTN","ORSNAST2",15,0)
 .....I $D(^VA(200,+$P(^OR(100,IEN,8,SUB,0),U,13))) S WHO=$$USER^ORS100(+$P(^OR(100,IEN,8,SUB,0),U,13))
"RTN","ORSNAST2",16,0)
 .....S DFN=+$P(^OR(100,IEN,0),U,2) Q:$P(^DPT(DFN,0),U,21)  D DEM^VADPT S SSN=VA("BID"),PNM=VADM(1)
"RTN","ORSNAST2",17,0)
 .....I $D(^OR(100,IEN,3)),$P(^(3),U,3) S STATUS=$$STAT^ORS100(+$P(^(3),U,3))
"RTN","ORSNAST2",18,0)
 .....I $D(^OR(100,IEN,8,SUB,0)) S WHEN=$$FMTE^XLFDT($P(^(0),U)) S SIGNED=$$FMTE^XLFDT($P(^(0),U,6))
"RTN","ORSNAST2",19,0)
 .....E  S SIGNED=""
"RTN","ORSNAST2",20,0)
 .....S ^TMP("ORNS",$J,WHO,PROV,IEN)=WHO_U_PROV_U_PNM_U_SSN_U_STATUS_U_IEN_U_WHEN_U_SIGNED
"RTN","ORSNAST2",21,0)
 .....S ^TMP("ORSERV",$J,SER,WHO,IEN)=SER_U_WHO_U_PROV_U_PNM_U_SSN_U_STATUS_U_IEN_U_WHEN_U_SIGNED
"RTN","ORSNAST2",22,0)
DETAILS .....;detailed output which includes the order text
"RTN","ORSNAST2",23,0)
 .....I FORMAT=1 D
"RTN","ORSNAST2",24,0)
 ......W !,"NATURE OF ORDER: ",SNAME,?54,"Order Action: ",$P(^OR(100,IEN,8,SUB,0),U,2) D:$Y>(IOSL-4) HDR^ORS100 Q:STOP
"RTN","ORSNAST2",25,0)
 ......W !,"STATUS: ",STATUS,?52,"ORIFN(Order #): ",IEN D:$Y>(IOSL-4) HDR^ORS100 Q:STOP
"RTN","ORSNAST2",26,0)
 ......W !,"OBJECT OF ORDER(Patient name): ",$G(PNM),?63,"SSN: ",$G(SSN) D:$Y>(IOSL-4) HDR^ORS100 Q:STOP
"RTN","ORSNAST2",27,0)
 ......I $P(^ORD(100.98,$P(^OR(100,+IEN,0),U,11),0),U)="NON-VA MEDICATIONS" D
"RTN","ORSNAST2",28,0)
 .......W !,"DOCUMENTED BY: ",$P($G(^VA(200,+$P(^OR(100,IEN,8,SUB,0),U,3),0)),U),?53,"VEILED ORDER?: ",$S($P(^OR(100,IEN,3),U,8)=1:"YES",1:"NO") D:$Y>(IOSL-4) HDR^ORS100 Q:STOP
"RTN","ORSNAST2",29,0)
 ......E  W !,"ORDERED BY: ",$P($G(^VA(200,+$P(^OR(100,IEN,8,SUB,0),U,3),0)),U),?53,"VEILED ORDER?: ",$S($P(^OR(100,IEN,3),U,8)=1:"YES",1:"NO") D:$Y>(IOSL-4) HDR^ORS100 Q:STOP
"RTN","ORSNAST2",30,0)
 ......W !,"ENTERED BY: ",$P($G(^VA(200,+$P(^OR(100,IEN,8,SUB,0),U,13),0)),U)," ON ",$$FMTE^XLFDT($P(^OR(100,IEN,0),U,7)) D:$Y>(IOSL-4) HDR^ORS100 Q:STOP
"RTN","ORSNAST2",31,0)
 ......W !,"RELEASED BY: " I +$P(^OR(100,IEN,8,SUB,0),U,16) W $P($G(^VA(200,+$P(^OR(100,IEN,8,SUB,0),U,17),0)),U)," ON ",$$FMTE^XLFDT($P(^OR(100,IEN,8,SUB,0),U,16)) D:$Y>(IOSL-4) HDR^ORS100 Q:STOP
"RTN","ORSNAST2",32,0)
 ......W !,"SIGNED BY: " I +$P(^OR(100,IEN,8,SUB,0),U,6) W $P($G(^VA(200,+$P(^OR(100,IEN,8,SUB,0),U,5),0)),U)," ON ",$$FMTE^XLFDT($P(^OR(100,IEN,8,SUB,0),U,6)) D:$Y>(IOSL-4) HDR^ORS100 Q:STOP
"RTN","ORSNAST2",33,0)
 ......W !,"ORDER TEXT: " S ORIGVIEW=2 D TEXT^ORQ12(.TEXT,IEN_";"_SUB,(IOM-13)) S TEXTSUB="" F  S TEXTSUB=$O(TEXT(TEXTSUB)) Q:'+TEXTSUB!(TEXTSUB=4)!STOP  W:TEXTSUB'=1 ?12 W TEXT(TEXTSUB),! D:$Y>(IOSL-4) HDR^ORS100 Q:STOP
"RTN","ORSNAST2",34,0)
 ......I 'STOP I TEXTSUB=4 W !,"***There is more order text.  It is limited to 3 lines for this report***"
"RTN","ORSNAST2",35,0)
 ......K TEXT,TEXTSUB
"RTN","ORSNAST2",36,0)
 ......I 'STOP K DASH S $P(DASH,"-",IOM)="" W !,DASH
"RTN","ORSNAST2",37,0)
COLUMNS ;this section uses the TMP global for the columnar format
"RTN","ORSNAST2",38,0)
 I '$G(SERVICE)&(FORMAT=2) D
"RTN","ORSNAST2",39,0)
 .S HDR1="!,""Provider"",?25,""Patient"",?50,""SSN"",?56,""Status"",?75,""Order #"",?87,""Order Date"",?110,""Signed"""
"RTN","ORSNAST2",40,0)
 .S HDR="!,""Search for orders with a nature of order of ""_SNAME"
"RTN","ORSNAST2",41,0)
 .D HDR^ORS100
"RTN","ORSNAST2",42,0)
 .I '$D(^TMP("ORNS",$J)) W !,"No orders found." Q
"RTN","ORSNAST2",43,0)
 .S WHO="" F  S WHO=$O(^TMP("ORNS",$J,WHO)) Q:WHO=""!STOP  W "Entered by: ",WHO,!  D  W !
"RTN","ORSNAST2",44,0)
 ..S PNM="" F  S PNM=$O(^TMP("ORNS",$J,WHO,PNM)) Q:PNM=""!STOP  D
"RTN","ORSNAST2",45,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORNS",$J,WHO,PNM,IEN)) Q:'IEN!STOP  D
"RTN","ORSNAST2",46,0)
 ....W $P(^(IEN),U,2),?25,$P(^(IEN),U,3),?50,$P(^(IEN),U,4),?56,$P(^(IEN),U,5),?75,$P(^(IEN),U,6),?87,$P(^(IEN),U,7),?110,$P(^(IEN),U,8),! D:$Y>(IOSL-4) HDR^ORS100
"RTN","ORSNAST2",47,0)
SERV I $G(SERVICE)&(FORMAT=2) D
"RTN","ORSNAST2",48,0)
 .S HDR1="!,""Provider"",?25,""Patient"",?50,""SSN"",?56,""Status"",?75,""Order #"",?87,""Order Date"",?110,""Signed"""
"RTN","ORSNAST2",49,0)
 .S HDR="!,""Search for orders with a nature of order of ""_SNAME"
"RTN","ORSNAST2",50,0)
 .D HDR^ORS100
"RTN","ORSNAST2",51,0)
 .I '$D(^TMP("ORSERV",$J)) W !,"No orders found." Q
"RTN","ORSNAST2",52,0)
 .S REF=$S($D(LONER):"LONER(SER)",1:"^TMP(""ORSERV"",$J,SER)")
"RTN","ORSNAST2",53,0)
 .S SER="" F  S SER=$O(@REF) Q:SER=""!STOP  W "Service/Section: ",SER,! D
"RTN","ORSNAST2",54,0)
 ..I '$D(^TMP("ORSERV",$J,SER)) W "No orders found.",!! Q
"RTN","ORSNAST2",55,0)
 ..S WHO="" F  S WHO=$O(^TMP("ORSERV",$J,SER,WHO)) Q:WHO=""!STOP  W ?5,"Entered by: ",WHO,!  D  W !
"RTN","ORSNAST2",56,0)
 ...S IEN=0 F  S IEN=$O(^TMP("ORSERV",$J,SER,WHO,IEN)) Q:'IEN!STOP  D
"RTN","ORSNAST2",57,0)
 ....W $P(^(IEN),U,3),?25,$P(^(IEN),U,4),?50,$P(^(IEN),U,5),?56,$P(^(IEN),U,6),?75,$P(^(IEN),U,7),?87,$P(^(IEN),U,8),?110,$P(^(IEN),U,9),! D:$Y>(IOSL-4) HDR^ORS100
"RTN","ORSNAST2",58,0)
 Q
"RTN","ORWOR")
0^3^B42185290^B42631980
"RTN","ORWOR",1,0)
ORWOR ; SLC/KCM - Orders Calls ; 3/15/11 8:10am
"RTN","ORWOR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,132,141,163,187,190,215,243,307,330,280,347**;Dec 17, 1997;Build 4
"RTN","ORWOR",3,0)
 ;
"RTN","ORWOR",4,0)
CURRENT(LST,DFN) ; Get Current Orders for a Patient
"RTN","ORWOR",5,0)
 ; Returns two lists in ^TMP("ORW",$J), fields and text
"RTN","ORWOR",6,0)
 N TM,IEN,X,X0,X3,CTR,IDX,I
"RTN","ORWOR",7,0)
 K ^TMP("ORW",$J)
"RTN","ORWOR",8,0)
 S IDX=0,DFN=DFN_";DPT("
"RTN","ORWOR",9,0)
 S TM=0 F  S TM=$O(^OR(100,"AC",DFN,TM)) Q:TM<1  D
"RTN","ORWOR",10,0)
 . S IEN=0 F  S IEN=$O(^OR(100,"AC",DFN,TM,IEN)) Q:IEN<1  D
"RTN","ORWOR",11,0)
 . . S X0=^OR(100,IEN,0),X3=^(3)
"RTN","ORWOR",12,0)
 . . S X=IEN_U_$P(X0,U,7)_U_$P(X0,U,11)_U_$P(X3,U,6)_U_$P(X3,U,3)
"RTN","ORWOR",13,0)
 . . S ^TMP("ORW",$J,IDX+1)=X
"RTN","ORWOR",14,0)
 . . S (CTR,I)=0,X=""
"RTN","ORWOR",15,0)
 . . F  S I=$O(^OR(100,IEN,1,I)) Q:I<1  D  Q:CTR>244
"RTN","ORWOR",16,0)
 . . . S X=X_$E(^OR(100,IEN,1,I,0),1,(245-CTR)),CTR=$L(X)
"RTN","ORWOR",17,0)
 . . S ^TMP("ORW",$J,IDX+2)=X,IDX=IDX+2
"RTN","ORWOR",18,0)
 ; S LST=$NA(^TMP("ORW",$J))
"RTN","ORWOR",19,0)
 M LST=^TMP("ORW",$J)
"RTN","ORWOR",20,0)
 Q
"RTN","ORWOR",21,0)
DETAIL(LST,ORID,DFN)    ; Return details of ORID (shell to kill VIDEO subs)
"RTN","ORWOR",22,0)
 Q:'+ORID
"RTN","ORWOR",23,0)
 I $G(DFN) N ORVP S ORVP=DFN_";DPT("
"RTN","ORWOR",24,0)
 S LST="^TMP(""ORTXT"",$J)"
"RTN","ORWOR",25,0)
 D DETAIL^ORQ2(.LST,ORID)
"RTN","ORWOR",26,0)
 K @LST@("VIDEO")
"RTN","ORWOR",27,0)
 S LST=$NA(^TMP("ORTXT",$J)),@LST=""
"RTN","ORWOR",28,0)
 Q
"RTN","ORWOR",29,0)
RESULT(REF,DFN,ORID,ID)      ; Return results of order identified by ID
"RTN","ORWOR",30,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWOR",31,0)
 N ORESULTS,ORVP,LCNT S ORESULTS=1,LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWOR",32,0)
 D ORDERS^ORCXPND1
"RTN","ORWOR",33,0)
 K ^TMP("ORXPND",$J,"VIDEO")
"RTN","ORWOR",34,0)
 S REF=$NA(^TMP("ORXPND",$J))
"RTN","ORWOR",35,0)
 Q
"RTN","ORWOR",36,0)
RESHIST(REF,DFN,ORID,ID)      ; Return result history of associated tests identified by ID
"RTN","ORWOR",37,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWOR",38,0)
 N ORESULTS,ORVP,LCNT
"RTN","ORWOR",39,0)
 S ORESULTS=1,LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWOR",40,0)
 D ORDHIST^ORWOR2
"RTN","ORWOR",41,0)
 K ^TMP("ORXPND",$J,"VIDEO")
"RTN","ORWOR",42,0)
 S REF=$NA(^TMP("ORXPND",$J))
"RTN","ORWOR",43,0)
 Q
"RTN","ORWOR",44,0)
TSALL(LST)      ; Return list of treating specialties
"RTN","ORWOR",45,0)
 N Y S Y=0
"RTN","ORWOR",46,0)
 F  S Y=$O(^DIC(45.7,Y)) Q:'Y  I $$ACTIVE^DGACT(45.7,Y) S LST(Y)=Y_U_$P(^DIC(45.7,Y,0),U)
"RTN","ORWOR",47,0)
 Q
"RTN","ORWOR",48,0)
DT(X) ; -- Returns FM date for X (SEE ORCHTAB1)
"RTN","ORWOR",49,0)
 N Y,%DT S %DT="T",Y="" D:X'="" ^%DT
"RTN","ORWOR",50,0)
 Q +Y
"RTN","ORWOR",51,0)
VWSET(ORERR,VIEW)       ; Set the preferred view for orders
"RTN","ORWOR",52,0)
 ; VIEW:  semi-colon delimited record
"RTN","ORWOR",53,0)
 ;        1 - Relative From Date/Time or ""
"RTN","ORWOR",54,0)
 ;        2 - Relative Thru Date/Time or ""
"RTN","ORWOR",55,0)
 ;        3 - Filter
"RTN","ORWOR",56,0)
 ;        4 - Display Group Pointer
"RTN","ORWOR",57,0)
 ;        5 - Format (preserve for list manager)
"RTN","ORWOR",58,0)
 ;        6 - chronological display (R or F)
"RTN","ORWOR",59,0)
 ;        7 - sort by display group
"RTN","ORWOR",60,0)
 N FMT
"RTN","ORWOR",61,0)
 ; use short name for display group instead of pointer
"RTN","ORWOR",62,0)
 ;*347 Allow times to be saved.
"RTN","ORWOR",63,0)
 ;I $E($P(VIEW,";",2))="T" S $P(VIEW,";",2)=$P($P(VIEW,";",2),"@") ;allows all orders for Today
"RTN","ORWOR",64,0)
 S $P(VIEW,";",4)=$P($G(^ORD(100.98,+$P(VIEW,";",4),0)),U,3)
"RTN","ORWOR",65,0)
 ; use last saved format, since this is used only by LM
"RTN","ORWOR",66,0)
 S FMT=$P($$GET^XPAR("ALL","ORCH CONTEXT ORDERS",1,"I"),";",5)
"RTN","ORWOR",67,0)
 S:'$L(FMT) FMT="L" S $P(VIEW,";",5)=FMT
"RTN","ORWOR",68,0)
 ; and save the parameter
"RTN","ORWOR",69,0)
 D EN^XPAR(DUZ_";VA(200,","ORCH CONTEXT ORDERS",1,VIEW,.ORERR)
"RTN","ORWOR",70,0)
 Q
"RTN","ORWOR",71,0)
VWGET(REC)      ; Get the preferred view for orders
"RTN","ORWOR",72,0)
 N FROM,THRU,FILTER,DGRP,FRMT,CHRN,BYGRP,S,VNAME,FL,I
"RTN","ORWOR",73,0)
 S REC=$$GET^XPAR("ALL","ORCH CONTEXT ORDERS",1,"I"),S=";"
"RTN","ORWOR",74,0)
 S FROM=$$DT($P(REC,S)),THRU=$$DT($P(REC,S,2)),FILTER=$P(REC,S,3)
"RTN","ORWOR",75,0)
 S DGRP=$P(REC,S,4),FRMT=$P(REC,S,5),CHRN=$P(REC,S,6),BYGRP=$P(REC,S,7)
"RTN","ORWOR",76,0)
 S:'$L(DGRP) DGRP="ALL" S DGRP=+$O(^ORD(100.98,"B",DGRP,0))
"RTN","ORWOR",77,0)
 I FILTER="" S FILTER=2  ; active orders
"RTN","ORWOR",78,0)
 I CHRN="" S CHRN="R"    ; reverse chronological
"RTN","ORWOR",79,0)
 I BYGRP="" S BYGRP=1    ; sort by display group
"RTN","ORWOR",80,0)
 ; set up view name
"RTN","ORWOR",81,0)
 D REVSTS^ORWORDG(.FL)
"RTN","ORWOR",82,0)
 S I=0 F  S I=$O(FL(I)) Q:'I  Q:+FL(I)=FILTER
"RTN","ORWOR",83,0)
 S VNAME=$P($G(FL(+I)),U,2)
"RTN","ORWOR",84,0)
 I '("^6^8^9^10^19^20^"[(U_FILTER_U)) S VNAME=VNAME_" Orders"
"RTN","ORWOR",85,0)
 I FILTER=2 S VNAME="Active Orders (includes Pending & Recent Activity)"
"RTN","ORWOR",86,0)
 I FILTER=23 S VNAME="Current Orders (Active & Pending Status Only)"
"RTN","ORWOR",87,0)
 S VNAME=VNAME_" - "_$P($G(^ORD(100.98,DGRP,0)),U)
"RTN","ORWOR",88,0)
 I (FROM>0)!(THRU>0) D
"RTN","ORWOR",89,0)
 . S VNAME=VNAME_" ("_$$FMTE^XLFDT(FROM,"2D")_" thru "
"RTN","ORWOR",90,0)
 . S VNAME=VNAME_$S(THRU>0:$$FMTE^XLFDT(THRU,"2D"),1:"")_")"
"RTN","ORWOR",91,0)
 S REC=FROM_S_THRU_S_FILTER_S_DGRP_S_FRMT_S_CHRN_S_BYGRP_S_VNAME
"RTN","ORWOR",92,0)
 Q
"RTN","ORWOR",93,0)
SHEETS(LST,ORVP) ; Return Order Sheets for a patient
"RTN","ORWOR",94,0)
 N ELST,ETYP,ORIFN,TS,I
"RTN","ORWOR",95,0)
 S ORVP=ORVP_";DPT("
"RTN","ORWOR",96,0)
 S ETYP="" F  S ETYP=$O(^OR(100,"AEVNT",ORVP,ETYP)) Q:ETYP=""  D
"RTN","ORWOR",97,0)
 . S ORIFN=0 F  S ORIFN=$O(^OR(100,"AEVNT",ORVP,ETYP,ORIFN)) Q:'ORIFN  D
"RTN","ORWOR",98,0)
 . . I (ETYP="A")!(ETYP="T") S ELST(ETYP,$P($G(^OR(100,+ORIFN,0)),U,13))=""
"RTN","ORWOR",99,0)
 S LST(1)="C;O^Current View",I=1
"RTN","ORWOR",100,0)
 S TS="" F  S TS=$O(ELST("A",TS)) Q:TS=""  D
"RTN","ORWOR",101,0)
 . S I=I+1,LST(I)="A;"_TS_U_"Admit to "_$P($G(^DIC(45.7,TS,0)),U)
"RTN","ORWOR",102,0)
 S I=I+1,LST(I)="A;-1^Admit..."
"RTN","ORWOR",103,0)
 S TS="" F  S TS=$O(ELST("T",TS)) Q:TS=""  D
"RTN","ORWOR",104,0)
 . S I=I+1,LST(I)="T;"_TS_U_"Transfer to "_$P($G(^DIC(45.7,TS,0)),U)
"RTN","ORWOR",105,0)
 I $L($G(^DPT(+ORVP,.1))) D
"RTN","ORWOR",106,0)
 . S I=I+1,LST(I)="T;-1^Transfer..."
"RTN","ORWOR",107,0)
 . S I=I+1,LST(I)="D;0^Discharge"
"RTN","ORWOR",108,0)
 Q
"RTN","ORWOR",109,0)
EVENTS(LST,EVT) ; Return general delayed events categories for a patient
"RTN","ORWOR",110,0)
 N EVTI
"RTN","ORWOR",111,0)
 S EVTI=0
"RTN","ORWOR",112,0)
 S EVTI=EVTI+1,LST(EVTI)="A;-1^Admit..."
"RTN","ORWOR",113,0)
 S EVTI=EVTI+1,LST(EVTI)="T;-1^Transfer..."
"RTN","ORWOR",114,0)
 S EVTI=EVTI+1,LST(EVTI)="D;0^Discharge"
"RTN","ORWOR",115,0)
 Q
"RTN","ORWOR",116,0)
UNSIGN(LST,ORVP,HAVE)   ; Return Unsigned Orders that are not on client
"RTN","ORWOR",117,0)
 N DC,DEL,DG,IFN,ACT,X0,X3,X8,ENT,LVL,TM,ILST,ORELSE
"RTN","ORWOR",118,0)
 S ILST=0
"RTN","ORWOR",119,0)
 Q:'$D(^XUSEC("ORES",DUZ))&('$D(^XUSEC("ORELSE",DUZ))&'$D(^ORAM(103,+ORVP)))
"RTN","ORWOR",120,0)
 S ORVP=ORVP_";DPT("
"RTN","ORWOR",121,0)
 S ENT="ALL"_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+^(5),1:"")
"RTN","ORWOR",122,0)
 S LVL=$$GET^XPAR(ENT,"OR UNSIGNED ORDERS ON EXIT")
"RTN","ORWOR",123,0)
 ; Nurses only see their own unsigned orders, independent of OR UNSIGNED ORDERS ON EXIT
"RTN","ORWOR",124,0)
 S ORELSE=$D(^XUSEC("ORELSE",DUZ))
"RTN","ORWOR",125,0)
 I ORELSE S LVL=1
"RTN","ORWOR",126,0)
 Q:'LVL
"RTN","ORWOR",127,0)
 S TM=0 F  S TM=$O(^OR(100,"AS",ORVP,TM)) Q:TM<1  D
"RTN","ORWOR",128,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AS",ORVP,TM,IFN)) Q:IFN<1  D
"RTN","ORWOR",129,0)
 . . S ACT=0 F  S ACT=$O(^OR(100,"AS",ORVP,TM,IFN,ACT)) Q:ACT<1  D
"RTN","ORWOR",130,0)
 . . . Q:$D(HAVE(IFN_";"_ACT))  ;in Changes
"RTN","ORWOR",131,0)
 . . . S X0=$G(^OR(100,IFN,0)),X3=$G(^OR(100,IFN,3))
"RTN","ORWOR",132,0)
 . . . S X8=$G(^OR(100,IFN,8,ACT,0))
"RTN","ORWOR",133,0)
 . . . ;determine Display Group
"RTN","ORWOR",134,0)
 . . . S DG=$P($G(^ORD(100.98,$P(X0,U,11),0)),U,2)
"RTN","ORWOR",135,0)
 . . . ;determine if DC
"RTN","ORWOR",136,0)
 . . . S DC=$S($P(X8,U,2)="DC":1,1:0)
"RTN","ORWOR",137,0)
 . . . ;determine if Delay
"RTN","ORWOR",138,0)
 . . . S DEL=$$CHKORD^OREVNTX1(IFN)
"RTN","ORWOR",139,0)
 . . . I '$S(LVL=1&($P(X8,U,3)=DUZ):1,ORELSE&($P(X8,U,13)=DUZ):1,LVL=2:1,1:0) Q  ;chk user
"RTN","ORWOR",140,0)
 . . . ;if Nurse, and order is already released or held for signature, don't include in list
"RTN","ORWOR",141,0)
 . . . I ORELSE,$S((+$P(X8,U,16)>0):1,$D(^OR(100,IFN,5)):1,1:0) Q
"RTN","ORWOR",142,0)
 . . . S ILST=ILST+1,LST(ILST)=IFN_";"_ACT_U_$P(X8,U,3)_U_DG_U_DC_U_DEL
"RTN","ORWOR",143,0)
 Q
"RTN","ORWOR",144,0)
PKIUSE(RETURN) ; RPC determines user can use PKI Digital Signature
"RTN","ORWOR",145,0)
 S RETURN=0
"RTN","ORWOR",146,0)
 I $$GET^XPAR("ALL^USR.`"_DUZ,"ORWOR PKI USE",1,"Q") S RETURN=1
"RTN","ORWOR",147,0)
 Q
"RTN","ORWOR",148,0)
PKISITE(RETURN) ; RPC determines if PKI is turned on at the site
"RTN","ORWOR",149,0)
 S RETURN=0
"RTN","ORWOR",150,0)
 Q:'$L($T(STORESIG^XUSSPKI))  ;Check for Kernel piece
"RTN","ORWOR",151,0)
 Q:'$L($T(DOSE^PSSOPKI1))  ;Check for Pharmacy piece
"RTN","ORWOR",152,0)
 I $$GET^XPAR("ALL","ORWOR PKI SITE",1,"Q") S RETURN=1
"RTN","ORWOR",153,0)
 Q
"RTN","ORWOR",154,0)
ACTXT(ORY,ORIFN) ;Return detail action information
"RTN","ORWOR",155,0)
 N ORI,CNT,OR0,OR3,OR6,ACTION
"RTN","ORWOR",156,0)
 K ^TMP("ORACTXT",$J)
"RTN","ORWOR",157,0)
 S ORY="^TMP(""ORACTXT"",$J)",ORI=$P(ORIFN,";",2)
"RTN","ORWOR",158,0)
 S CNT=0,ORIFN=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),OR6=$G(^(6))
"RTN","ORWOR",159,0)
 F  S ORI=$O(^OR(100,+ORIFN,8,ORI)) Q:ORI'>0  S ACTION=$G(^(ORI,0)) D ACT^ORQ20
"RTN","ORWOR",160,0)
 S ORY=$NA(^TMP("ORACTXT",$J)),@ORY=""
"RTN","ORWOR",161,0)
 Q
"RTN","ORWOR",162,0)
EXPIRED(ORY) ;return FM date/time to begin search for expired orders
"RTN","ORWOR",163,0)
 N HRS
"RTN","ORWOR",164,0)
 S HRS=$$GET^XPAR("ALL","ORWOR EXPIRED ORDERS",1,"I")
"RTN","ORWOR",165,0)
 S ORY=$$FMADD^XLFDT($$NOW^XLFDT,"","-"_HRS,"","")
"RTN","ORWOR",166,0)
 Q
"RTN","ORWSR")
0^2^B28551721^B26083948
"RTN","ORWSR",1,0)
ORWSR ;SLC/REV-Surgery RPCs ; 3/15/11 8:08am
"RTN","ORWSR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,116,132,148,160,190,274,347**;Dec 17, 1997;Build 4
"RTN","ORWSR",3,0)
 ;
"RTN","ORWSR",4,0)
SHOWSURG(ORY) ;is Surgery ES patch installed?
"RTN","ORWSR",5,0)
 S ORY=$$PATCH^XPDUTL("SR*3.0*100")
"RTN","ORWSR",6,0)
 Q:+ORY=0
"RTN","ORWSR",7,0)
 S ORY=$$GET^XPAR("ALL","ORWOR SHOW SURGERY TAB",1)
"RTN","ORWSR",8,0)
 Q
"RTN","ORWSR",9,0)
LIST(ORY,ORDFN,ORBDT,OREDT,ORCTXT,ORMAX,ORFHIE) ;RETURN LIST OF SURGERY CASES FOR A PATIENT
"RTN","ORWSR",10,0)
 Q:'$$PATCH^XPDUTL("SR*3.0*100")
"RTN","ORWSR",11,0)
 N I,J,X,SHOWADD,SHOWDOCS
"RTN","ORWSR",12,0)
 S ORY=$NA(^TMP("ORLIST",$J))
"RTN","ORWSR",13,0)
 Q:'+ORDFN
"RTN","ORWSR",14,0)
 S:'$G(ORCTXT) ORCTXT=1
"RTN","ORWSR",15,0)
 S:'$G(ORBDT) ORBDT=""
"RTN","ORWSR",16,0)
 S:'$G(OREDT) OREDT=""
"RTN","ORWSR",17,0)
 S:'$G(ORMAX) ORMAX=""
"RTN","ORWSR",18,0)
 S (SHOWDOCS,SHOWADD)=1
"RTN","ORWSR",19,0)
 D LIST^SROESTV(.ORY,ORDFN,ORBDT,OREDT,ORMAX,SHOWDOCS)
"RTN","ORWSR",20,0)
 S I=0
"RTN","ORWSR",21,0)
 F  S I=$O(@ORY@(I)) Q:+I=0  D
"RTN","ORWSR",22,0)
 . S X=@ORY@(I),J=0
"RTN","ORWSR",23,0)
 . S $P(X,U,6)=$$NON^SROESTV(+X)
"RTN","ORWSR",24,0)
 . S $P(X,U,14)=ORCTXT
"RTN","ORWSR",25,0)
 . S $P(X,U,13)=$P(X,U,5),$P(X,U,5)=""
"RTN","ORWSR",26,0)
 . S @ORY@(I)=X
"RTN","ORWSR",27,0)
 . F  S J=$O(@ORY@(I,J)) Q:+J=0  D
"RTN","ORWSR",28,0)
 . . S X=@ORY@(I,J)
"RTN","ORWSR",29,0)
 . . S:(($P(X,U,14)=ORCTXT)!($P(X,U,14)="")) $P(X,U,14)=+$P(X,U,10)
"RTN","ORWSR",30,0)
 . . S @ORY@(I,J)=X
"RTN","ORWSR",31,0)
 Q
"RTN","ORWSR",32,0)
CASELIST(ORY,ORDFN) ; retrieve list of cases, but no documents
"RTN","ORWSR",33,0)
 Q:'$$PATCH^XPDUTL("SR*3.0*100")
"RTN","ORWSR",34,0)
 Q:'+ORDFN
"RTN","ORWSR",35,0)
 N ORBDT,OREDT,ORMAX,I,SHOWDOCS S (ORBDT,OREDT,ORMAX)="",SHOWDOCS=0
"RTN","ORWSR",36,0)
 S ORY=$NA(^TMP("ORLIST",$J))
"RTN","ORWSR",37,0)
 D LIST^SROESTV(.ORY,ORDFN,ORBDT,OREDT,ORMAX,SHOWDOCS)
"RTN","ORWSR",38,0)
 S I=0
"RTN","ORWSR",39,0)
 F  S I=$O(@ORY@(I)) Q:+I=0  D
"RTN","ORWSR",40,0)
 . S $P(@ORY@(I),U,4)=$P($P(@ORY@(I),U,4),";",2)
"RTN","ORWSR",41,0)
 Q
"RTN","ORWSR",42,0)
GTSURCTX(Y,ORUSER) ; Returns current Notes view context for user
"RTN","ORWSR",43,0)
 N OCCLIM,SHOWSUB
"RTN","ORWSR",44,0)
 S Y=$$GET^XPAR("ALL","ORCH CONTEXT SURGERY",1)
"RTN","ORWSR",45,0)
 Q
"RTN","ORWSR",46,0)
SVSURCTX(Y,ORCTXT) ; Save new Notes view preferences for user
"RTN","ORWSR",47,0)
 N TMP
"RTN","ORWSR",48,0)
 S TMP=$$GET^XPAR(DUZ_";VA(200,","ORCH CONTEXT SURGERY",1)
"RTN","ORWSR",49,0)
 I TMP'="" D  Q
"RTN","ORWSR",50,0)
 . D CHG^XPAR(DUZ_";VA(200,","ORCH CONTEXT SURGERY",1,ORCTXT)
"RTN","ORWSR",51,0)
 D ADD^XPAR(DUZ_";VA(200,","ORCH CONTEXT SURGERY",1,ORCTXT)
"RTN","ORWSR",52,0)
 Q
"RTN","ORWSR",53,0)
 ;
"RTN","ORWSR",54,0)
ONECASE(ORY,ORTIUDA) ;Given a TIU document, return the case and related documents
"RTN","ORWSR",55,0)
 Q:'$$PATCH^XPDUTL("SR*3.0*100")!(+$G(ORTIUDA)=0)
"RTN","ORWSR",56,0)
 N ORCASE
"RTN","ORWSR",57,0)
 D GET1405^TIUSRVR(.ORCASE,ORTIUDA)
"RTN","ORWSR",58,0)
 I +ORCASE'>0 S ORY=ORCASE Q
"RTN","ORWSR",59,0)
 D GETONE(.ORY,+ORCASE)
"RTN","ORWSR",60,0)
 Q
"RTN","ORWSR",61,0)
GETONE(ORY,ORCASE) ; called by ONECASE and RPTTEXT 
"RTN","ORWSR",62,0)
 ;Q:'$$PATCH^XPDUTL("SR*3.0*100")
"RTN","ORWSR",63,0)
 N ORTMP,J,SHOWADD,ORCTXT
"RTN","ORWSR",64,0)
 S SHOWADD=1,ORCTXT=1
"RTN","ORWSR",65,0)
 D ONE^SROESTV("ORY",+ORCASE)
"RTN","ORWSR",66,0)
 S X=ORY(+ORCASE),J=0
"RTN","ORWSR",67,0)
 S $P(X,U,6)=$$NON^SROESTV(+X)
"RTN","ORWSR",68,0)
 S $P(X,U,14)=ORCTXT
"RTN","ORWSR",69,0)
 S $P(X,U,13)=$P(X,U,5),$P(X,U,5)=""
"RTN","ORWSR",70,0)
 S ORTMP(0)=X
"RTN","ORWSR",71,0)
 F  S J=$O(ORY(+ORCASE,J)) Q:+J=0  D
"RTN","ORWSR",72,0)
 . S X=ORY(+ORCASE,J)
"RTN","ORWSR",73,0)
 . S:(($P(X,U,14)=ORCTXT)!($P(X,U,14)="")) $P(X,U,14)=+$P(X,U,10)
"RTN","ORWSR",74,0)
 . S ORTMP(J)=X
"RTN","ORWSR",75,0)
 K ORY M ORY=ORTMP
"RTN","ORWSR",76,0)
 Q
"RTN","ORWSR",77,0)
SHOWOPTP(ORY,ORCASE) ;Should OpTop be displayed on signature?
"RTN","ORWSR",78,0)
 I '$$PATCH^XPDUTL("SR*3.0*100") S ORY=0 Q
"RTN","ORWSR",79,0)
 S ORY=$$OPTOP^SROESTV(+ORCASE)
"RTN","ORWSR",80,0)
 Q
"RTN","ORWSR",81,0)
ISNONOR(ORY,ORCASE) ;Is the procedure a non-OR procedure?
"RTN","ORWSR",82,0)
 I '$$PATCH^XPDUTL("SR*3.0*100") S ORY=0 Q
"RTN","ORWSR",83,0)
 S ORY=$$NON^SROESTV(+ORCASE)
"RTN","ORWSR",84,0)
 Q
"RTN","ORWSR",85,0)
RPTLIST(ORY,ORDFN) ;Return list of surgery reports for reports tab
"RTN","ORWSR",86,0)
 ;I '$$PATCH^XPDUTL("SR*3.0*100") D NOTYET(.ORY)  Q
"RTN","ORWSR",87,0)
 Q:'$$PATCH^XPDUTL("SR*3.0*100")
"RTN","ORWSR",88,0)
 Q:'+ORDFN
"RTN","ORWSR",89,0)
 N ORBDT,OREDT,ORMAX,I,SHOWDOCS,X,SITE,Z,SPEC,GMN,STATUS,DCTDTM,TRSDTM,Y,ORLW
"RTN","ORWSR",90,0)
 S (ORBDT,OREDT,ORMAX)="",SHOWDOCS=0
"RTN","ORWSR",91,0)
 S ORY=$NA(^TMP("ORLIST",$J))
"RTN","ORWSR",92,0)
 S SITE=$$SITE^VASITE,SITE=$P(SITE,"^",2)_";"_$P(SITE,"^",3)
"RTN","ORWSR",93,0)
 D LIST^SROESTV(.ORY,ORDFN,ORBDT,OREDT,ORMAX,SHOWDOCS)
"RTN","ORWSR",94,0)
 S I=0
"RTN","ORWSR",95,0)
 F  S I=$O(@ORY@(I)) Q:+I=0  D
"RTN","ORWSR",96,0)
 . S X=$P(@ORY@(I),U,2),$P(@ORY@(I),U,2)=$P(@ORY@(I),U,3),$P(@ORY@(I),U,3)=X
"RTN","ORWSR",97,0)
 . S $P(@ORY@(I),U,4)=$P($P(@ORY@(I),U,4),";",2)
"RTN","ORWSR",98,0)
 . S GMN=$P(@ORY@(I),U)
"RTN","ORWSR",99,0)
 . ;*347 Use Fileman calls.
"RTN","ORWSR",100,0)
 . K ORLW D GETS^DIQ(130,GMN,"49","","ORLW") S Z=$Q(ORLW) S:Z']"" Z="Z" S $P(@ORY@(I),U,6)="LAB WORK-"_$S($D(@Z)>1:"Yes",1:"No") ; Lab work
"RTN","ORWSR",101,0)
 . D STATUS^GMTSROB S:'$D(STATUS) STATUS="UNKNOWN"
"RTN","ORWSR",102,0)
 . S $P(@ORY@(I),U,7)="STATUS-"_STATUS ; op status
"RTN","ORWSR",103,0)
 . S Z=$$GET1^DIQ(130,GMN,.04,"I") I Z>0 S Y=Z,C=$P(^DD(130,.04,0),U,2) D Y^DIQ S SPEC=Y K Y
"RTN","ORWSR",104,0)
 . S $P(@ORY@(I),U,8)="SPEC-"_$G(SPEC) ; Surgical specialty
"RTN","ORWSR",105,0)
 . S Z=$$GET1^DIQ(130,GMN,15,"I") S:Z>0 DCTDTM=$$DATE^ORDVU(Z)
"RTN","ORWSR",106,0)
 . S $P(@ORY@(I),U,9)="DICT-"_$G(DCTDTM) ; Dictation Time
"RTN","ORWSR",107,0)
 . S Z=$$GET1^DIQ(130,GMN,39,"I") S:Z>0 TRSDTM=$$DATE^ORDVU(Z)
"RTN","ORWSR",108,0)
 . S $P(@ORY@(I),U,10)="TRANS-"_$G(TRSDTM) ; Transcription Time
"RTN","ORWSR",109,0)
 . ;*347 Reset variables for each item.
"RTN","ORWSR",110,0)
 . K SPEC,DCTDTM,TRSDTM,STATUS,Y,Z
"RTN","ORWSR",111,0)
 . S @ORY@(I)=SITE_U_@ORY@(I)
"RTN","ORWSR",112,0)
 Q
"RTN","ORWSR",113,0)
RPTTEXT(ROOT,DFN,ORID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX,ORFHIE) ; -- return surgery report
"RTN","ORWSR",114,0)
 ;I '$$PATCH^XPDUTL("SR*3.0*100") D NOTYET(.ROOT)  Q
"RTN","ORWSR",115,0)
 Q:'$$PATCH^XPDUTL("SR*3.0*100")
"RTN","ORWSR",116,0)
 Q:+ORID=0
"RTN","ORWSR",117,0)
 N X,ORI,J,ORDOC,ORCASE,CNT,LINES,ORSEP,ORTMP
"RTN","ORWSR",118,0)
 S (X,ORI)="",$P(ORSEP,"=",74)=""
"RTN","ORWSR",119,0)
 S ROOT=$NA(^TMP("ORXPND",$J))
"RTN","ORWSR",120,0)
 K @ROOT
"RTN","ORWSR",121,0)
 S CNT=0
"RTN","ORWSR",122,0)
 D GETONE(.ORCASE,ORID)
"RTN","ORWSR",123,0)
 S (ORI,J)=""
"RTN","ORWSR",124,0)
 F  S ORI=$O(ORCASE(ORI)) Q:ORI=""  D
"RTN","ORWSR",125,0)
 . S ORTMP(ORID,ORI)=ORCASE(ORI)
"RTN","ORWSR",126,0)
 K ORCASE M ORCASE=ORTMP
"RTN","ORWSR",127,0)
 S ORI=""
"RTN","ORWSR",128,0)
 F  S ORI=$O(ORCASE(ORID,ORI)) Q:ORI=""  D
"RTN","ORWSR",129,0)
 . Q:'$L($P(ORCASE(ORID,ORI),U,10))
"RTN","ORWSR",130,0)
 . Q:$E($P(ORCASE(ORID,ORI),U,2),1,8)="Addendum"
"RTN","ORWSR",131,0)
 . D TGET^TIUSRVR1(.ORDOC,+ORCASE(ORID,ORI),"VIEW")
"RTN","ORWSR",132,0)
 . S J="",LINES=0
"RTN","ORWSR",133,0)
 . F  S J=$O(@ORDOC@(J)) Q:J=""  D
"RTN","ORWSR",134,0)
 . . I $D(@ORDOC@(J))=10 D
"RTN","ORWSR",135,0)
 . . . S @ROOT@(J+CNT,0)=@ORDOC@(J,0),LINES=LINES+1
"RTN","ORWSR",136,0)
 . . E  S @ROOT@(J+CNT,0)=@ORDOC@(J),LINES=LINES+1
"RTN","ORWSR",137,0)
 . K ORDOC,ORY(ORID) S CNT=CNT+LINES+1
"RTN","ORWSR",138,0)
 . S @ROOT@(CNT,0)=ORSEP,CNT=CNT+1
"RTN","ORWSR",139,0)
 I CNT=0 S @ROOT@(CNT,0)="No reports are available for this case."
"RTN","ORWSR",140,0)
 Q
"RTN","ORWSR",141,0)
NOTYET(ROOT) ; -- standard not available display text
"RTN","ORWSR",142,0)
 D SETITEM(.ROOT,"Report not available at this time.")
"RTN","ORWSR",143,0)
 Q
"RTN","ORWSR",144,0)
SETITEM(ROOT,X) ; -- set item in list
"RTN","ORWSR",145,0)
 S @ROOT@($O(@ROOT@(9999),-1)+1)=X
"RTN","ORWSR",146,0)
 Q
"VER")
8.0^22.0
"BLD",8435,6)
^300
**END**
**END**
