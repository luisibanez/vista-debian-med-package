Released OR*3*351 SEQ #312
Extracted from mail message
**KIDS**:OR*3.0*351^

**INSTALL NAME**
OR*3.0*351
"BLD",8348,0)
OR*3.0*351^ORDER ENTRY/RESULTS REPORTING^0^3120725^y
"BLD",8348,1,0)
^^9^9^3110706^^
"BLD",8348,1,1,0)
This patch will correct the following
"BLD",8348,1,2,0)
 
"BLD",8348,1,3,0)
1. When a patient has changed clinics and is displaying on the team 
"BLD",8348,1,4,0)
   list for the new clinic. They are not being removed from the old
"BLD",8348,1,5,0)
   clinic's team list.
"BLD",8348,1,6,0)
 
"BLD",8348,1,7,0)
2. When listing all patients on a clinic team list using the 
"BLD",8348,1,8,0)
   Anticoagulation Patinet Lists [ORAM PATIENT LIST MENU] option, patients
"BLD",8348,1,9,0)
   whos name begins with the letter Z do not show up.
"BLD",8348,4,0)
^9.64PA^^
"BLD",8348,6)
1^
"BLD",8348,6.3)
4
"BLD",8348,"ABPKG")
n
"BLD",8348,"INID")
^y
"BLD",8348,"INIT")
EN^ORP351
"BLD",8348,"KRN",0)
^9.67PA^779.2^20
"BLD",8348,"KRN",.4,0)
.4
"BLD",8348,"KRN",.401,0)
.401
"BLD",8348,"KRN",.401,"NM",0)
^9.68A^1^1
"BLD",8348,"KRN",.401,"NM",1,0)
ORAM TEAM LIST    FILE #100.21^100.21^0
"BLD",8348,"KRN",.401,"NM","B","ORAM TEAM LIST    FILE #100.21",1)

"BLD",8348,"KRN",.402,0)
.402
"BLD",8348,"KRN",.403,0)
.403
"BLD",8348,"KRN",.5,0)
.5
"BLD",8348,"KRN",.84,0)
.84
"BLD",8348,"KRN",3.6,0)
3.6
"BLD",8348,"KRN",3.8,0)
3.8
"BLD",8348,"KRN",9.2,0)
9.2
"BLD",8348,"KRN",9.8,0)
9.8
"BLD",8348,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8348,"KRN",9.8,"NM",1,0)
ORAM1^^0^B162237541
"BLD",8348,"KRN",9.8,"NM","B","ORAM1",1)

"BLD",8348,"KRN",19,0)
19
"BLD",8348,"KRN",19.1,0)
19.1
"BLD",8348,"KRN",101,0)
101
"BLD",8348,"KRN",409.61,0)
409.61
"BLD",8348,"KRN",771,0)
771
"BLD",8348,"KRN",779.2,0)
779.2
"BLD",8348,"KRN",870,0)
870
"BLD",8348,"KRN",8989.51,0)
8989.51
"BLD",8348,"KRN",8989.52,0)
8989.52
"BLD",8348,"KRN",8994,0)
8994
"BLD",8348,"KRN","B",.4,.4)

"BLD",8348,"KRN","B",.401,.401)

"BLD",8348,"KRN","B",.402,.402)

"BLD",8348,"KRN","B",.403,.403)

"BLD",8348,"KRN","B",.5,.5)

"BLD",8348,"KRN","B",.84,.84)

"BLD",8348,"KRN","B",3.6,3.6)

"BLD",8348,"KRN","B",3.8,3.8)

"BLD",8348,"KRN","B",9.2,9.2)

"BLD",8348,"KRN","B",9.8,9.8)

"BLD",8348,"KRN","B",19,19)

"BLD",8348,"KRN","B",19.1,19.1)

"BLD",8348,"KRN","B",101,101)

"BLD",8348,"KRN","B",409.61,409.61)

"BLD",8348,"KRN","B",771,771)

"BLD",8348,"KRN","B",779.2,779.2)

"BLD",8348,"KRN","B",870,870)

"BLD",8348,"KRN","B",8989.51,8989.51)

"BLD",8348,"KRN","B",8989.52,8989.52)

"BLD",8348,"KRN","B",8994,8994)

"BLD",8348,"QUES",0)
^9.62^^
"BLD",8348,"REQB",0)
^9.611^1^1
"BLD",8348,"REQB",1,0)
OR*3.0*339^2
"BLD",8348,"REQB","B","OR*3.0*339",1)

"INIT")
EN^ORP351
"KRN",.401,449570,-1)
0^1
"KRN",.401,449570,0)
ORAM TEAM LIST^3110706.1151^@^100.21^^@^3110706
"KRN",.401,449570,2,0)
^.4014^2^2
"KRN",.401,449570,2,1,0)
100.21^.01^NAME^@^^^^^^4
"KRN",.401,449570,2,1,"ASK")
1
"KRN",.401,449570,2,1,"F")
ANTIC Lissz^ANTIC List
"KRN",.401,449570,2,1,"GET")
S DISX(1)=$P($G(^OR(100.21,D0,0)),U)
"KRN",.401,449570,2,1,"IX")
^OR(100.21,"B",^OR(100.21,^2
"KRN",.401,449570,2,1,"QCON")
I DISX(1)="ANTIC List"
"KRN",.401,449570,2,1,"SER")
98.0000^0.9899
"KRN",.401,449570,2,1,"T")
ANTIC List^ANTIC List
"KRN",.401,449570,2,1,"TXT")
NAME equals ANTIC List
"KRN",.401,449570,2,2,0)
100.2101^^MEMBER^@".01^^^^^^4
"KRN",.401,449570,2,2,1,0)
^.40141^1^1
"KRN",.401,449570,2,2,1,1,0)
100.21^10
"KRN",.401,449570,2,2,1,"B",100.21,1)

"KRN",.401,449570,2,2,"CM")
N DIERR S Y(1)=$S($D(^OR(100.21,D0,10,D1,0)):^(0),1:"") S X=$$EXTERNAL^DIDU(100.2101,.01,"",$P(Y(1),U,1)) I D1>0 S DISX(2)=X
"KRN",.401,449570,2,2,"GET")
N DIERR S Y(1)=$S($D(^OR(100.21,D0,10,D1,0)):^(0),1:"") S X=$$EXTERNAL^DIDU(100.2101,.01,"",$P(Y(1),U,1)) I D1>0 S DISX(2)=X
"KRN",.401,449570,2,2,"QCON")
I DISX(2)'=""
"KRN",.401,449570,2,2,"TXT")
MEMBER not null
"KRN",.401,449570,2,"B",100.21,1)

"KRN",.401,449570,2,"B",100.2101,2)

"KRN",.401,449570,"%D",0)
^.4012^2^2^3090611^^^^
"KRN",.401,449570,"%D",1,0)
This sort template identifies the list of Complext Anticoagulation 
"KRN",.401,449570,"%D",2,0)
patients.
"MBREQ")
0
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"PKG",188,-1)
1^1
"PKG",188,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",188,20,0)
^9.402P^^
"PKG",188,22,0)
^9.49I^1^1
"PKG",188,22,1,0)
3.0^2971217^2981113^1
"PKG",188,22,1,"PAH",1,0)
351^3120725^520665228
"PKG",188,22,1,"PAH",1,1,0)
^^9^9^3120725
"PKG",188,22,1,"PAH",1,1,1,0)
This patch will correct the following
"PKG",188,22,1,"PAH",1,1,2,0)
 
"PKG",188,22,1,"PAH",1,1,3,0)
1. When a patient has changed clinics and is displaying on the team 
"PKG",188,22,1,"PAH",1,1,4,0)
   list for the new clinic. They are not being removed from the old
"PKG",188,22,1,"PAH",1,1,5,0)
   clinic's team list.
"PKG",188,22,1,"PAH",1,1,6,0)
 
"PKG",188,22,1,"PAH",1,1,7,0)
2. When listing all patients on a clinic team list using the 
"PKG",188,22,1,"PAH",1,1,8,0)
   Anticoagulation Patinet Lists [ORAM PATIENT LIST MENU] option, patients
"PKG",188,22,1,"PAH",1,1,9,0)
   whos name begins with the letter Z do not show up.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ORAM1")
0^1^B162237541^B161086526
"RTN","ORAM1",1,0)
ORAM1 ;POR/RSF - ANTICOAGULATION MANAGEMENT RPCS (2 of 4) ; 7/25/12 2:15pm
"RTN","ORAM1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**307,339,351**;Dec 17, 1997;Build 4
"RTN","ORAM1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ORAM1",4,0)
 Q
"RTN","ORAM1",5,0)
 ;
"RTN","ORAM1",6,0)
TERASE(RESULT,ORAMDFN,ORAMCOMP) ; Manage Team Lists
"RTN","ORAM1",7,0)
 N ORAMKEY,ORAMTMP,ORAMCEY,ORAMCLIN,ORAMCLNM,ORAMCOM,ORAMALL,ORAMCPLX,ORAMENT,QQ,DA,DIK,D0
"RTN","ORAM1",8,0)
 Q:'+$G(ORAMDFN)
"RTN","ORAM1",9,0)
 S ORAMCLIN=+$P($G(^ORAM(103,ORAMDFN,6)),U,2),ORAMENT=$S(+ORAMCLIN>0:ORAMCLIN_";SC(",1:"ALL")
"RTN","ORAM1",10,0)
 I +ORAMCLIN S ORAMCLNM=$$EXTERNAL^DILFD(103,101,"",ORAMCLIN)
"RTN","ORAM1",11,0)
 S ORAMALL=$$GET^XPAR(ORAMENT,"ORAM TEAM LIST (ALL)",1,"I"),ORAMCPLX=$$GET^XPAR(ORAMENT,"ORAM TEAM LIST (COMPLEX)",1,"I")
"RTN","ORAM1",12,0)
 I +$G(ORAMALL) D  I 1
"RTN","ORAM1",13,0)
 . S DA(1)=ORAMALL,DIK="^OR(100.21"_","_DA(1)_",10,"
"RTN","ORAM1",14,0)
 . S ORAMTMP=ORAMDFN_";DPT("
"RTN","ORAM1",15,0)
 . S ORAMKEY=$O(^OR(100.21,ORAMALL,10,"B",ORAMTMP,0)) Q:+ORAMKEY'>0  S DA=ORAMKEY
"RTN","ORAM1",16,0)
 . D ^DIK
"RTN","ORAM1",17,0)
 . K DA,DIK
"RTN","ORAM1",18,0)
 . K D0
"RTN","ORAM1",19,0)
 . S RESULT=1
"RTN","ORAM1",20,0)
 E  S RESULT="0^ORAM TEAM LIST (ALL) not defined for Clinic "_ORAMCLNM_"."
"RTN","ORAM1",21,0)
 I +$G(ORAMCPLX) D  I 1
"RTN","ORAM1",22,0)
 . S DA(1)=ORAMCPLX,DIK="^OR(100.21"_","_DA(1)_",10,"
"RTN","ORAM1",23,0)
 . S ORAMCEY=$O(^OR(100.21,ORAMCPLX,10,"B",ORAMTMP,0)) Q:+ORAMCEY'>0  S DA=ORAMCEY
"RTN","ORAM1",24,0)
 . D ^DIK
"RTN","ORAM1",25,0)
 . K DA,DIK
"RTN","ORAM1",26,0)
 . S:'$D(RESULT) RESULT=1
"RTN","ORAM1",27,0)
 E  S RESULT="0^ORAM TEAM LIST (COMPLEX) not defined for Clinic "_ORAMCLNM_"."
"RTN","ORAM1",28,0)
 Q
"RTN","ORAM1",29,0)
 ;
"RTN","ORAM1",30,0)
ICDCODE(RESULT,ICODE) ; Map ICD Code
"RTN","ORAM1",31,0)
 N ORAMICD
"RTN","ORAM1",32,0)
 S ORAMICD=ICODE_" "
"RTN","ORAM1",33,0)
 S RESULT=$O(^ICD9("AB",ORAMICD,0))
"RTN","ORAM1",34,0)
 Q
"RTN","ORAM1",35,0)
 ;
"RTN","ORAM1",36,0)
PTCHECK(RESULT,ORAMDFN) ; CHECKS TO SEE IF PT IS IN FILE
"RTN","ORAM1",37,0)
 N ORPTLOC
"RTN","ORAM1",38,0)
 Q:'+$G(ORAMDFN)
"RTN","ORAM1",39,0)
 S RESULT=0
"RTN","ORAM1",40,0)
 I $S('$D(^ORAM(103,ORAMDFN)):1,+$O(^ORAM(103,ORAMDFN,3,0))'>0:1,1:0) S RESULT=1 Q
"RTN","ORAM1",41,0)
 S ORPTLOC=$P($G(^ORAM(103,ORAMDFN,6)),U,2)
"RTN","ORAM1",42,0)
 I ORPTLOC']"" S RESULT=2 Q
"RTN","ORAM1",43,0)
 I +ORPTLOC,'$L($$GET^XPAR(ORPTLOC_";SC(^DIV.`"_DUZ(2),"ORAM CLINIC NAME",1,"I")) S RESULT=99
"RTN","ORAM1",44,0)
 Q
"RTN","ORAM1",45,0)
 ;
"RTN","ORAM1",46,0)
PTENTER(RESULT,DFN) ; ENTERS PATIENT INTO FILE WITH ALL DATES = TODAY
"RTN","ORAM1",47,0)
 N DO,DD,DIC,DINUM,X
"RTN","ORAM1",48,0)
 S DIC="^ORAM(103,"
"RTN","ORAM1",49,0)
 S DIC(0)="Z"
"RTN","ORAM1",50,0)
 S (DINUM,X)=DFN
"RTN","ORAM1",51,0)
 D FILE^DICN
"RTN","ORAM1",52,0)
 K DO,DD
"RTN","ORAM1",53,0)
 S RESULT=1
"RTN","ORAM1",54,0)
 Q
"RTN","ORAM1",55,0)
 ;
"RTN","ORAM1",56,0)
ACDATA(RESULT,DFN) ; HEADING DATA
"RTN","ORAM1",57,0)
 N ORAMSTOT,ORAMRTOT,ORAMRAT,ORAMMSGT,ORAMRAT,ORAMBRT,ORAMX,ORI,ORLINE
"RTN","ORAM1",58,0)
 N ORAMD0,ORAMD4,ORAMD5,ORAMD6,ORAMD9,ORAMD15,ORAMD17,ORAMD18
"RTN","ORAM1",59,0)
 N ORAMT4,ORAMT5,ORAMT6,ORAMT9,ORAMT15,ORAMT17,ORAMT18
"RTN","ORAM1",60,0)
 S ORAMX=0
"RTN","ORAM1",61,0)
 I '$D(^ORAM(103,DFN)) D  ;IF NOT IN FILE ALREADY...
"RTN","ORAM1",62,0)
 . N DD,DIC,DINUM,DO,X
"RTN","ORAM1",63,0)
 . S DIC="^ORAM(103,"
"RTN","ORAM1",64,0)
 . S DIC(0)="Z"
"RTN","ORAM1",65,0)
 . S (DINUM,X)=DFN
"RTN","ORAM1",66,0)
 . D FILE^DICN
"RTN","ORAM1",67,0)
 . K DO,DD
"RTN","ORAM1",68,0)
 . S ORAMX=1
"RTN","ORAM1",69,0)
 I ORAMX=1 S RESULT(0)=0 G ACDATAQ
"RTN","ORAM1",70,0)
 S ORAMD0=^ORAM(103,DFN,0)
"RTN","ORAM1",71,0)
 S ORI=0 F  S ORI=$O(^ORAM(103,DFN,1,ORI)) Q:+ORI'>0  S ORLINE=$G(^ORAM(103,DFN,1,ORI,0)) S:ORLINE="" ORLINE=" " S ORAMSTOT=$G(ORAMSTOT)_U_ORLINE
"RTN","ORAM1",72,0)
 S ORI=0 F  S ORI=$O(^ORAM(103,DFN,2,ORI)) Q:+ORI'>0  S ORLINE=$G(^ORAM(103,DFN,2,ORI,0)) S:ORLINE="" ORLINE=" " S ORAMRTOT=$G(ORAMRTOT)_U_ORLINE
"RTN","ORAM1",73,0)
 S ORI=0 F  S ORI=$O(^ORAM(103,DFN,4,ORI)) Q:+ORI'>0  S ORLINE=$G(^ORAM(103,DFN,4,ORI,0)) S:ORLINE="" ORLINE=" " S ORAMMSGT=$G(ORAMMSGT)_U_ORLINE
"RTN","ORAM1",74,0)
 S ORI=0 F  S ORI=$O(^ORAM(103,DFN,5,ORI)) Q:+ORI'>0  S ORLINE=$G(^ORAM(103,DFN,5,ORI,0)) S:ORLINE="" ORLINE=" " S ORAMRAT=$G(ORAMRAT)_U_ORLINE
"RTN","ORAM1",75,0)
 S ORI=0 F  S ORI=$O(^ORAM(103,DFN,7,ORI)) Q:+ORI'>0  S ORLINE=$G(^ORAM(103,DFN,7,ORI,0)) S:ORLINE="" ORLINE=" " S ORAMBRT=$G(ORAMBRT)_U_ORLINE
"RTN","ORAM1",76,0)
 S RESULT(0)=$G(ORAMSTOT)
"RTN","ORAM1",77,0)
 S RESULT(1)=$G(ORAMRTOT)
"RTN","ORAM1",78,0)
 S RESULT(2)=$G(ORAMMSGT)
"RTN","ORAM1",79,0)
 S RESULT(4)=$G(ORAMRAT)
"RTN","ORAM1",80,0)
 S RESULT(5)=$S($G(ORAMBRT)]"":$P($G(^ORAM(103,DFN,6)),"^",5)_"^"_$P($G(ORAMBRT),"^",2,99),1:"")
"RTN","ORAM1",81,0)
 S ORAMD4=$P(ORAMD0,"^",4),ORAMD5=$P(ORAMD0,"^",5),ORAMD6=$P(ORAMD0,"^",6),ORAMD9=$P(ORAMD0,"^",9),ORAMD15=$P(ORAMD0,"^",15),ORAMD17=$P(ORAMD0,"^",17),ORAMD18=$P(ORAMD0,"^",18)
"RTN","ORAM1",82,0)
 S ORAMT4=$$FMTE^XLFDT($E($G(ORAMD4),1,12),"2P"),ORAMT5=$$FMTE^XLFDT($E($G(ORAMD5),1,12),"2P"),ORAMT6=$$FMTE^XLFDT($E($G(ORAMD6),1,12),"2P"),ORAMT9=$$FMTE^XLFDT($E($G(ORAMD9),1,12),"2P")
"RTN","ORAM1",83,0)
 S ORAMT15=$$FMTE^XLFDT($E($G(ORAMD15),1,12),"2P"),ORAMT17=$$FMTE^XLFDT($E($G(ORAMD17),1,12),"2P"),ORAMT18=$$FMTE^XLFDT($E($G(ORAMD18),1,12),"2P")
"RTN","ORAM1",84,0)
 S:$L($P(ORAMT4,"/",1))=1 $P(ORAMT4,"/",1)="0"_$P(ORAMT4,"/",1)
"RTN","ORAM1",85,0)
 S:$L($P(ORAMT4,"/",2))=1 $P(ORAMT4,"/",2)="0"_$P(ORAMT4,"/",2)
"RTN","ORAM1",86,0)
 S:$L($P(ORAMT15,"/",1))=1 $P(ORAMT15,"/",1)="0"_$P(ORAMT15,"/",1)
"RTN","ORAM1",87,0)
 S:$L($P(ORAMT15,"/",2))=1 $P(ORAMT15,"/",2)="0"_$P(ORAMT15,"/",2)
"RTN","ORAM1",88,0)
 S:$L($P(ORAMT17,"/",1))=1 $P(ORAMT17,"/",1)="0"_$P(ORAMT17,"/",1)
"RTN","ORAM1",89,0)
 S:$L($P(ORAMT17,"/",2))=1 $P(ORAMT17,"/",2)="0"_$P(ORAMT17,"/",2)
"RTN","ORAM1",90,0)
 S:$L($P(ORAMT18,"/",1))=1 $P(ORAMT18,"/",1)="0"_$P(ORAMT18,"/",1)
"RTN","ORAM1",91,0)
 S:$L($P(ORAMT18,"/",2))=1 $P(ORAMT18,"/",2)="0"_$P(ORAMT18,"/",2)
"RTN","ORAM1",92,0)
 S $P(ORAMD0,"^",4)=$G(ORAMT4),$P(ORAMD0,"^",5)=$G(ORAMT5),$P(ORAMD0,"^",6)=$G(ORAMT6),$P(ORAMD0,"^",9)=$G(ORAMT9),$P(ORAMD0,"^",15)=$G(ORAMT15),$P(ORAMD0,"^",17)=$G(ORAMT17),$P(ORAMD0,"^",18)=$G(ORAMT18)
"RTN","ORAM1",93,0)
 S RESULT(3)=ORAMD0 S:$D(^ORAM(103,DFN,6)) RESULT(3)=RESULT(3)_"^"_$P(^ORAM(103,DFN,6),"^")
"RTN","ORAM1",94,0)
ACDATAQ Q
"RTN","ORAM1",95,0)
 ;
"RTN","ORAM1",96,0)
ADDTOP(RESULT,TOPARR) ; File ANTICOAG data
"RTN","ORAM1",97,0)
 N ORAM0,SI,RISK,PEEP,ORAMSIL,ORAMRL,ORAMPEPL,ORAMDAY,ORAMST,ORAMBACK,ORAMSTP,ORAMOR,ORAMFB,ORAMREM,ORAMRML,ORAMR,ORAMC
"RTN","ORAM1",98,0)
 N ORAMBRG,ORAMBRGC,ORAMBRGL,ORAMLOC,OLDRTN,DFN,R,X,FDA
"RTN","ORAM1",99,0)
 D NOW^%DTC S ORAMDAY=X
"RTN","ORAM1",100,0)
 S DFN=TOPARR(0),ORAM0=TOPARR(1),SI=TOPARR(2),RISK=TOPARR(3),PEEP=TOPARR(4),ORAMREM=TOPARR(5)
"RTN","ORAM1",101,0)
 S ORAMBRG=$G(TOPARR(6)),ORAMBRGC=$G(TOPARR(7)),ORAMLOC=$G(TOPARR(8))
"RTN","ORAM1",102,0)
 S OLDRTN=$P($G(^ORAM(103,DFN,0)),"^",4)
"RTN","ORAM1",103,0)
 I SI'="" K ^ORAM(103,DFN,1) S ORAMSIL=$L(SI,"^"),^ORAM(103,DFN,1,0)="^^"_ORAMSIL_"^"_ORAMSIL_"^"_ORAMDAY_"^" F R=1:1:ORAMSIL D
"RTN","ORAM1",104,0)
 . S ^ORAM(103,DFN,1,R,0)=$P(SI,"^",R)
"RTN","ORAM1",105,0)
 I RISK'="" K ^ORAM(103,DFN,2) S ORAMRL=$L(RISK,"^"),^ORAM(103,DFN,2,0)="^^"_ORAMRL_"^"_ORAMRL_"^"_ORAMDAY_"^" F R=1:1:ORAMRL D
"RTN","ORAM1",106,0)
 . S ^ORAM(103,DFN,2,R,0)=$P(RISK,"^",R)
"RTN","ORAM1",107,0)
 I PEEP'="" K ^ORAM(103,DFN,4) S ORAMPEPL=$L(PEEP,"^"),^ORAM(103,DFN,4,0)="^^"_ORAMPEPL_"^"_ORAMPEPL_"^"_ORAMDAY_"^" F R=1:1:ORAMPEPL D
"RTN","ORAM1",108,0)
 . S ^ORAM(103,DFN,4,R,0)=$P(PEEP,"^",R)
"RTN","ORAM1",109,0)
 K ^ORAM(103,DFN,5)
"RTN","ORAM1",110,0)
 I ORAMREM'="" D
"RTN","ORAM1",111,0)
 . S ORAMRML=$L(ORAMREM,"^"),^ORAM(103,DFN,5,0)="^^"_ORAMRML_"^"_ORAMRML_"^"_ORAMDAY_"^"
"RTN","ORAM1",112,0)
 . F R=1:1:ORAMRML S ^ORAM(103,DFN,5,R,0)=$P(ORAMREM,"^",R)
"RTN","ORAM1",113,0)
 ;*351 Use Fileman so x-ref updates.
"RTN","ORAM1",114,0)
 S:ORAMLOC>0 FDA(1,103,DFN_",",101)=ORAMLOC
"RTN","ORAM1",115,0)
 S FDA(1,103,DFN_",",111)=+ORAMBRG
"RTN","ORAM1",116,0)
 D UPDATE^DIE(,"FDA(1)")
"RTN","ORAM1",117,0)
 I +ORAMBRG,(ORAMBRGC]"") D
"RTN","ORAM1",118,0)
 . K ^ORAM(103,DFN,7)
"RTN","ORAM1",119,0)
 . S ORAMBRGL=$L(ORAMBRGC,"^"),^ORAM(103,DFN,7,0)="^^"_ORAMBRGL_"^"_ORAMBRGL_"^"_ORAMDAY_"^"
"RTN","ORAM1",120,0)
 . F R=1:1:ORAMBRGL S ^ORAM(103,DFN,7,R,0)=$P(ORAMBRGC,"^",R)
"RTN","ORAM1",121,0)
 I $P($G(ORAM0),"^",4)'="" S X="",ORAMBACK=$P(ORAM0,"^",4) D DT^DILF("TS",ORAMBACK,.X) S $P(ORAM0,"^",4)=X
"RTN","ORAM1",122,0)
 I $P($G(ORAM0),"^",15)'="" S X="",ORAMFB=$P(ORAM0,"^",15) D DT^DILF(,ORAMFB,.X) S $P(ORAM0,"^",15)=X
"RTN","ORAM1",123,0)
 I $P($G(ORAM0),"^",17)'="" S X="",ORAMC=$P(ORAM0,"^",17) D DT^DILF(,ORAMC,.X) S $P(ORAM0,"^",17)=X
"RTN","ORAM1",124,0)
 I $P($G(ORAM0),"^",18)'="" S X="",ORAMR=$P(ORAM0,"^",18) D DT^DILF(,ORAMR,.X) S $P(ORAM0,"^",18)=X
"RTN","ORAM1",125,0)
 I OLDRTN'="" K ^ORAM(103,"L",OLDRTN,DFN)
"RTN","ORAM1",126,0)
 S ^ORAM(103,DFN,0)=ORAM0 S:$P($G(ORAM0),"^",4)'="" ^ORAM(103,"L",$P(ORAM0,"^",4),DFN)=""
"RTN","ORAM1",127,0)
 I $P(^ORAM(103,DFN,0),"^",13)="" S $P(^ORAM(103,DFN,0),"^",13)="SAVE"
"RTN","ORAM1",128,0)
 Q
"RTN","ORAM1",129,0)
 ;
"RTN","ORAM1",130,0)
OUTINR(RESULT,ORAMINR) ; INR VALUES FROM OUTSIDE LAB
"RTN","ORAM1",131,0)
 N ORAMLEN,ORAMPI,ORAMRI,ORAMZANY,ORAMHDT,ORAMNDT
"RTN","ORAM1",132,0)
 S ORAMLEN=$L($G(ORAMINR),"^"),ORAMRI=0
"RTN","ORAM1",133,0)
 F ORAMPI=1:2:ORAMLEN D
"RTN","ORAM1",134,0)
 . N %H,ORAMDT,X
"RTN","ORAM1",135,0)
 . S ORAMDT=$P(ORAMINR,"^",ORAMPI+1) I $L(ORAMDT) D DT^DILF("E",ORAMDT,.ORAMZANY) S X=ORAMZANY D H^%DTC S ORAMHDT=%H,ORAMNDT=$$FMTE^XLFDT(X,"2P")
"RTN","ORAM1",136,0)
 . I $L(ORAMDT) S RESULT(ORAMRI)=$P(ORAMINR,"^",ORAMPI)_"^"_$G(ORAMHDT)_"^"_$G(ORAMNDT)
"RTN","ORAM1",137,0)
 . E  S RESULT(ORAMRI)="^^"
"RTN","ORAM1",138,0)
 . S ORAMRI=ORAMRI+1
"RTN","ORAM1",139,0)
 Q
"RTN","ORAM1",140,0)
 ;
"RTN","ORAM1",141,0)
PCGOAL(RESULT,DFN,CMPLX) ; % of time Pt in current goal
"RTN","ORAM1",142,0)
 N ORAMSNO,ORAMPC,R,ORAMGOOD,ORAMDATE
"RTN","ORAM1",143,0)
 S R=0,ORAMGOOD=0,ORAMDATE=0
"RTN","ORAM1",144,0)
 S ORAMSNO=0 F  S ORAMSNO=$O(^ORAM(103,DFN,3,ORAMSNO)) Q:'ORAMSNO  D
"RTN","ORAM1",145,0)
 . N ORAMD0,ORAMINR,ORAMGOAL,ORAMGLOW,ORAMHIGH,LCNT,ORAMND
"RTN","ORAM1",146,0)
 . S ORAMD0=$G(^ORAM(103,DFN,3,ORAMSNO,0)),LCNT=$P($G(^ORAM(103,DFN,3,ORAMSNO,1,0)),"^",3)-1
"RTN","ORAM1",147,0)
 . I $G(CMPLX)=1,$G(^ORAM(103,DFN,3,ORAMSNO,1,LCNT,0))["COMPLEX PATIENT" Q
"RTN","ORAM1",148,0)
 . S ORAMND=$P(ORAMD0,"^"),ORAMINR=$P(ORAMD0,"^",3),ORAMGOAL=$P(ORAMD0,"^",12),ORAMGLOW=$P(ORAMGOAL,"-"),ORAMHIGH=$P(ORAMGOAL,"-",2) S:ORAMHIGH[" " ORAMHIGH=$P(ORAMHIGH," ",2)
"RTN","ORAM1",149,0)
 . S ORAMGLOW=ORAMGLOW-(.1*ORAMGLOW),ORAMHIGH=ORAMHIGH+(.1*ORAMHIGH)
"RTN","ORAM1",150,0)
 . I (ORAMND'=ORAMDATE)&(ORAMINR) S R=R+1,ORAMDATE=ORAMND I ((ORAMINR'<ORAMGLOW)&(ORAMINR'>ORAMHIGH)) S ORAMGOOD=ORAMGOOD+1
"RTN","ORAM1",151,0)
 I R>0 S ORAMPC=(ORAMGOOD/R)*100,ORAMPC=$E(ORAMPC,1,4)
"RTN","ORAM1",152,0)
 S RESULT=$G(ORAMPC)_"^"_$G(R)
"RTN","ORAM1",153,0)
PCGOALQ Q
"RTN","ORAM1",154,0)
 ;
"RTN","ORAM1",155,0)
COMPTEST(RESULT,COMMARR) ; File Flow Sheet Data
"RTN","ORAM1",156,0)
 ; RPC: ORAM1 COMPTEST
"RTN","ORAM1",157,0)
 N ORAMDFN,ORAMZERO,ORAMCOMM,ORAMDT,ORAMX,ORAMCL,ORAMTEMP,ORAMSAVE,ORAMRD,ORAMCOMPL,ORAMCCNT,DA,DIK,R,X
"RTN","ORAM1",158,0)
 N ORAMICNT,ORAMIOFF
"RTN","ORAM1",159,0)
 S ORAMDFN=COMMARR(0),ORAMZERO=COMMARR(1),ORAMSAVE=COMMARR(2),ORAMRD=COMMARR(3),ORAMCOMPL=COMMARR(4),ORAMCCNT=COMMARR(5)
"RTN","ORAM1",160,0)
 S ORAMIOFF=+ORAMCCNT+6,ORAMICNT=COMMARR(ORAMIOFF)
"RTN","ORAM1",161,0)
 S ORAMTEMP=$P(ORAMZERO,"^",1) D DT^DILF(,ORAMTEMP,.X) S $P(ORAMZERO,"^",1)=$S($G(X)]"":$G(X),1:DT)
"RTN","ORAM1",162,0)
 S ORAMDT=$$NOW^XLFDT,$P(ORAMZERO,"^",9)=ORAMDT
"RTN","ORAM1",163,0)
 S ORAMX=$O(^ORAM(103,ORAMDFN,3," "),-1)
"RTN","ORAM1",164,0)
 I 'ORAMX S ORAMX=0
"RTN","ORAM1",165,0)
 I $P(^ORAM(103,ORAMDFN,0),"^",13)="TEMPSAVE" K DIK,DA S DIK="^ORAM(103,"_ORAMDFN_",3,",DA(1)=ORAMDFN,DA=ORAMX D ^DIK
"RTN","ORAM1",166,0)
 I $P(^ORAM(103,ORAMDFN,0),"^",13)="SAVE" S ORAMX=ORAMX+1
"RTN","ORAM1",167,0)
 ; Execute KILL Logic for cross-refs on update
"RTN","ORAM1",168,0)
 I $D(^ORAM(103,ORAMDFN)) D
"RTN","ORAM1",169,0)
 . S DIK="^ORAM(103,"
"RTN","ORAM1",170,0)
 . S DA=ORAMDFN
"RTN","ORAM1",171,0)
 . D IX2^DIK
"RTN","ORAM1",172,0)
 S ^ORAM(103,ORAMDFN,3,0)="^103.011DA^"_ORAMX_"^"_ORAMX
"RTN","ORAM1",173,0)
 S ^ORAM(103,ORAMDFN,3,ORAMX,0)=ORAMZERO
"RTN","ORAM1",174,0)
 I $P(ORAMRD,U,4)]"" S $P(^ORAM(103,ORAMDFN,6),U,1,4)=ORAMRD
"RTN","ORAM1",175,0)
 E  S $P(^ORAM(103,ORAMDFN,6),U,1,3)=$P(ORAMRD,U,1,3)
"RTN","ORAM1",176,0)
 ; If there are comments, file them
"RTN","ORAM1",177,0)
 I +ORAMCCNT>0 F R=1:1:(ORAMCCNT) D
"RTN","ORAM1",178,0)
 . S ^ORAM(103,ORAMDFN,3,ORAMX,1,R,0)=COMMARR(R+5)
"RTN","ORAM1",179,0)
 . S ^ORAM(103,ORAMDFN,3,ORAMX,1,0)="^^"_ORAMCCNT_"^"_ORAMCCNT_"^"_$P(ORAMZERO,"^",1)_"^"
"RTN","ORAM1",180,0)
 ; If there are complications, file them
"RTN","ORAM1",181,0)
 I $L(ORAMCOMPL)>0 D
"RTN","ORAM1",182,0)
 . N P1,P2,X
"RTN","ORAM1",183,0)
 . S P1=$P(ORAMCOMPL,"|"),P2=$P(ORAMCOMPL,"|",2)
"RTN","ORAM1",184,0)
 . I P1>99 S P1=2 ;CLOT in the 100 range...
"RTN","ORAM1",185,0)
 . E  I P1#10>0 S P1=1 ;MAJOR BLEED
"RTN","ORAM1",186,0)
 . E  I P1=10 S P1=3 ;MINOR BLEED
"RTN","ORAM1",187,0)
 . S:+$G(P1) $P(^ORAM(103,ORAMDFN,3,ORAMX,0),"^",2)=P1
"RTN","ORAM1",188,0)
 . F X=1:1:$L(P2,"^") D
"RTN","ORAM1",189,0)
 .. S ^ORAM(103,ORAMDFN,3,ORAMX,2,X,0)=$P(P2,"^",X)
"RTN","ORAM1",190,0)
 . S ^ORAM(103,ORAMDFN,3,ORAMX,2,0)="^^"_$L(P2,"^")-1_"^"_$L(P2,"^")-1_"^"_$P(ORAMZERO,"^",1)_"^"
"RTN","ORAM1",191,0)
 ; If there are Patient Instructions, file them
"RTN","ORAM1",192,0)
 I +ORAMICNT>0 F R=1:1:(ORAMICNT) D
"RTN","ORAM1",193,0)
 . N ORLINE S ORLINE=COMMARR(R+ORAMIOFF)
"RTN","ORAM1",194,0)
 . S ^ORAM(103,ORAMDFN,3,ORAMX,3,R,0)=$S(ORLINE="":" ",1:ORLINE)
"RTN","ORAM1",195,0)
 . S ^ORAM(103,ORAMDFN,3,ORAMX,3,0)="^^"_ORAMICNT_"^"_ORAMICNT_"^"_$P(ORAMZERO,"^",1)_"^"
"RTN","ORAM1",196,0)
 S ^ORAM(103,ORAMDFN,3,"B",$P(ORAMZERO,"^",1),ORAMX)=""
"RTN","ORAM1",197,0)
 S $P(^ORAM(103,ORAMDFN,0),"^",13)=ORAMSAVE
"RTN","ORAM1",198,0)
 ; Update all cross-refs for Flow Sheet entry
"RTN","ORAM1",199,0)
 S DIK="^ORAM(103,"
"RTN","ORAM1",200,0)
 S DA=ORAMDFN
"RTN","ORAM1",201,0)
 D IX^DIK
"RTN","ORAM1",202,0)
 S RESULT=1
"RTN","ORAM1",203,0)
 Q
"RTN","ORAM1",204,0)
 ;
"RTN","ORAM1",205,0)
FLOWTT(RESULT,DFN) ; GETS ANTICOAG FLOWSHEET DATA
"RTN","ORAM1",206,0)
 N FSARR,COMARR,ORAMI,ORI,ORX
"RTN","ORAM1",207,0)
 S (ORI,ORAMI,ORX)=0
"RTN","ORAM1",208,0)
 F  S ORI=$O(^ORAM(103,DFN,3,"B",ORI)) Q:+ORI'>0  D
"RTN","ORAM1",209,0)
 . N ORJ S ORJ=0
"RTN","ORAM1",210,0)
 . F  S ORJ=$O(^ORAM(103,DFN,3,"B",ORI,ORJ)) Q:+ORJ'>0  D
"RTN","ORAM1",211,0)
 .. N ORAMACFS,ORAMCOM,ORAMCOMP,ORAMCC,ORAMPROV,ORAMLCNT,ORAMTOT,ORAMT
"RTN","ORAM1",212,0)
 .. S ORAMACFS=^ORAM(103,DFN,3,ORJ,0),ORAMCC=$P(ORAMACFS,U,2)
"RTN","ORAM1",213,0)
 .. S ORAMCOM=$P(ORAMACFS,U),$P(ORAMACFS,U)=$$FMTE^XLFDT(ORAMCOM,"2P"),$P(ORAMACFS,U,2)=ORJ
"RTN","ORAM1",214,0)
 .. S ORAMPROV=$P(ORAMACFS,U,10) I +$G(ORAMPROV) S $P(ORAMACFS,U,10)=$P(^VA(200,+ORAMPROV,0),U)
"RTN","ORAM1",215,0)
 .. S ORAMLCNT=+$O(^ORAM(103,DFN,3,ORJ,1,""),-1)
"RTN","ORAM1",216,0)
 .. S ORAMCOMP=$O(^ORAM(103,DFN,3,ORJ,2,""),-1)
"RTN","ORAM1",217,0)
 .. S ORAMT=ORAMLCNT
"RTN","ORAM1",218,0)
 .. S:+$G(ORAMCC) ORAMT=$G(ORAMLCNT)_","_$G(ORAMCOMP)
"RTN","ORAM1",219,0)
 .. S ORAMTOT=$G(ORAMLCNT)+$G(ORAMCOMP)
"RTN","ORAM1",220,0)
 .. I +$G(ORAMTOT) D
"RTN","ORAM1",221,0)
 ... S RESULT(ORAMI)=$G(ORAMT)_"|"_$G(ORAMACFS)
"RTN","ORAM1",222,0)
 ... I +$G(ORAMLCNT) F ORX=(ORAMI+1):1:(ORAMLCNT+ORAMI) S RESULT(ORX)=$G(^ORAM(103,DFN,3,ORJ,1,(ORX-ORAMI),0))
"RTN","ORAM1",223,0)
 ... I +$G(ORAMCC),+$G(ORAMCOMP) D
"RTN","ORAM1",224,0)
 .... S ORAMI=ORX+2,RESULT(ORAMI)="Complications noted:"
"RTN","ORAM1",225,0)
 .... F ORX=(ORAMI+2):1:(ORAMCOMP+ORAMI) D
"RTN","ORAM1",226,0)
 ..... N ORAMCMPL
"RTN","ORAM1",227,0)
 ..... S ORAMCMPL=$G(^ORAM(103,DFN,3,ORJ,2,(ORX-ORAMI),0))
"RTN","ORAM1",228,0)
 ..... S RESULT(ORX)=$S((ORAMCMPL["MB:")!(ORAMCMPL["C:"):$P(ORAMCMPL,":",2),1:ORAMCMPL)
"RTN","ORAM1",229,0)
 .. E  S RESULT(ORAMI+1)="0|"_$G(ORAMACFS)
"RTN","ORAM1",230,0)
 .. S ORAMI=ORX+1
"RTN","ORAM1",231,0)
 Q
"RTN","ORAM1",232,0)
 ;
"RTN","ORAM1",233,0)
LOGIT(RESULT,FSARRAY,ORAMCOMP) ; RPC= ORAM1 LOG
"RTN","ORAM1",234,0)
 N ORAMDATE,ORAMINR,ORAMPTN,ORAMTWD,ORAMLOG,ORAMLOGN,TODAY,TTIME,COUNT,ORAMODFN,ORAMOD,ORAMND,ORAMNEWD,AROW
"RTN","ORAM1",235,0)
 N %,DA,DIK,ORAMDFN,ORAMRSF,R,X
"RTN","ORAM1",236,0)
 S RESULT=0
"RTN","ORAM1",237,0)
 D NOW^%DTC S TODAY=X,TTIME=%
"RTN","ORAM1",238,0)
 ;FIRST GET THE OLD FLOW SHEET DATA AND SAVE TO THE LOG FILE
"RTN","ORAM1",239,0)
 S ORAMDFN=$G(FSARRAY(0)),AROW=$G(FSARRAY(1))
"RTN","ORAM1",240,0)
 S ORAMDATE=$P($G(^ORAM(103,ORAMDFN,3,AROW,0)),"^"),ORAMINR=$P($G(^ORAM(103,ORAMDFN,3,AROW,0)),"^",3),ORAMPTN=$P($G(^ORAM(103,ORAMDFN,3,AROW,0)),"^",8),ORAMTWD=$P($G(^ORAM(103,ORAMDFN,3,AROW,0)),"^",6)
"RTN","ORAM1",241,0)
 S ORAMODFN=$P($G(^ORAM(103,ORAMDFN,3,AROW,0)),"^",10),ORAMOD=$P($G(^ORAM(103,ORAMDFN,3,AROW,0)),"^",9)
"RTN","ORAM1",242,0)
 S ORAMLOG="Original FS "_AROW_": DATE="_$G(ORAMDATE)_", INR="_$G(ORAMINR)_", PT NOTIFIED="_$G(ORAMPTN)_", TWD="_$G(ORAMTWD)_"; "_ORAMODFN_" ("_ORAMOD_"): EDITED: "_FSARRAY(6)_"("_TODAY_")"
"RTN","ORAM1",243,0)
 S ORAMLOGN=$P($G(^ORAM(103,ORAMDFN,3,AROW,"LOG",0)),"^",3)+1
"RTN","ORAM1",244,0)
 S ^ORAM(103,ORAMDFN,3,AROW,"LOG",ORAMLOGN,0)=ORAMLOG
"RTN","ORAM1",245,0)
 K ^ORAM(103,ORAMDFN,3,"B",$G(ORAMDATE),AROW)
"RTN","ORAM1",246,0)
 F ORAMRSF=1:1:$P($G(^ORAM(103,ORAMDFN,3,AROW,1,0)),"^",3) S COUNT=ORAMLOGN+ORAMRSF,^ORAM(103,ORAMDFN,3,AROW,"LOG",COUNT,0)=^ORAM(103,ORAMDFN,3,AROW,1,ORAMRSF,0)
"RTN","ORAM1",247,0)
 S ^ORAM(103,ORAMDFN,3,AROW,"LOG",0)="^^"_$G(COUNT)_"^"_$G(COUNT)_"^"_TODAY
"RTN","ORAM1",248,0)
 ;NOW SET NEW INFO FOR THE FLOW SHEET ENTRY
"RTN","ORAM1",249,0)
 ;Array order is: DFN;ARow;date;inr;ptnotified;twd;DUZ;#comment lines;comments
"RTN","ORAM1",250,0)
 S ORAMNEWD=$G(FSARRAY(2)) D DT^DILF(,ORAMNEWD,.X) S ORAMNEWD=X
"RTN","ORAM1",251,0)
 S $P(^ORAM(103,ORAMDFN,3,AROW,0),"^")=$G(ORAMNEWD),$P(^ORAM(103,ORAMDFN,3,AROW,0),"^",3)=$G(FSARRAY(3)),$P(^ORAM(103,ORAMDFN,3,AROW,0),"^",8)=$G(FSARRAY(4)),$P(^ORAM(103,ORAMDFN,3,AROW,0),"^",6)=$G(FSARRAY(5))
"RTN","ORAM1",252,0)
 S $P(^ORAM(103,ORAMDFN,3,AROW,0),"^",2)=$G(ORAMCOMP)
"RTN","ORAM1",253,0)
 S $P(^ORAM(103,ORAMDFN,3,AROW,0),"^",10)=$G(FSARRAY(6)),$P(^ORAM(103,ORAMDFN,3,AROW,0),"^",9)=TTIME
"RTN","ORAM1",254,0)
 I $G(FSARRAY(7))'="" K ^ORAM(103,ORAMDFN,3,AROW,1) F R=1:1:$G(FSARRAY(7)) D
"RTN","ORAM1",255,0)
 . S ^ORAM(103,ORAMDFN,3,AROW,1,R,0)=$G(FSARRAY(R+7))
"RTN","ORAM1",256,0)
 S ^ORAM(103,ORAMDFN,3,AROW,1,0)="^^"_$G(FSARRAY(7))_"^"_$G(FSARRAY(7))_"^"_TODAY_"^"  ;$E(ORAMDT,1,7)_"^"
"RTN","ORAM1",257,0)
 S ^ORAM(103,ORAMDFN,3,"B",$G(ORAMNEWD),AROW)=""
"RTN","ORAM1",258,0)
 S DIK="^ORAM(103,"
"RTN","ORAM1",259,0)
 S DA(1)=ORAMDFN,DA=AROW
"RTN","ORAM1",260,0)
 D IX^DIK
"RTN","ORAM1",261,0)
 S RESULT=1
"RTN","ORAM1",262,0)
 Q
"RTN","ORAM1",263,0)
 ;
"RTN","ORAM1",264,0)
LOCK(RESULT,DATA) ; Locks form   RPC=ORAM1 LOCK
"RTN","ORAM1",265,0)
 N X
"RTN","ORAM1",266,0)
 S RESULT=0
"RTN","ORAM1",267,0)
 Q:$P($G(DATA),"^")=""
"RTN","ORAM1",268,0)
 Q:$D(^ORAM(103,$P(DATA,"^")))=0
"RTN","ORAM1",269,0)
 D NOW^%DTC N ORAMTDAY S ORAMTDAY=X
"RTN","ORAM1",270,0)
 I $P(^ORAM(103,$P(DATA,"^"),0),"^",18,19)="" S $P(^ORAM(103,$P(DATA,"^"),0),"^",18)="^"
"RTN","ORAM1",271,0)
 S $P(^ORAM(103,$P(DATA,"^"),0),"^",19)=1_"|"_$P(^VA(200,$P(DATA,"^",2),0),"^")_"|"_ORAMTDAY,RESULT=1
"RTN","ORAM1",272,0)
 Q
"RTN","ORAM1",273,0)
 ;
"RTN","ORAM1",274,0)
UNLOCK(RESULT,DFN) ; Unlocks form  RPC=ORAM1 UNLOCK
"RTN","ORAM1",275,0)
 S RESULT=0
"RTN","ORAM1",276,0)
 Q:DFN<1
"RTN","ORAM1",277,0)
 Q:$D(^ORAM(103,DFN))=0
"RTN","ORAM1",278,0)
 S $P(^ORAM(103,DFN,0),"^",19)=0,RESULT=1
"RTN","ORAM1",279,0)
 Q
"RTN","ORAM1",280,0)
 ;
"RTN","ORAM1",281,0)
GETPT(RESULT) ; Get Pt list  RPC=ORAM1 PT LIST
"RTN","ORAM1",282,0)
 N ORAMPT
"RTN","ORAM1",283,0)
 S ORAMPT=0 F  S ORAMPT=$O(^ORAM(103,"B",ORAMPT)) Q:ORAMPT=""  D
"RTN","ORAM1",284,0)
 . S RESULT($G(ORAMPT))=$G(ORAMPT)_"^"_$P(^DPT(ORAMPT,0),"^")_"^"_$E($P(^DPT(ORAMPT,0),"^",9),6,9)
"RTN","ORAM1",285,0)
 Q
"RTN","ORAM1",286,0)
 ;
"RTN","ORAM1",287,0)
SETHCT(RESULT,ORAMORD) ; SET HCT LAB ITEM NUMBER
"RTN","ORAM1",288,0)
 Q:'+$G(ORAMORD)
"RTN","ORAM1",289,0)
 N ORAMX,ORAML60,ORAMCH S ORAMX=0 F  S ORAMX=$O(^ORD(101.43,$G(ORAMORD),10,ORAMX)) Q:'+$G(ORAMX)!+$G(ORAMCH)  D
"RTN","ORAM1",290,0)
 . I $P(^ORD(101.43,$G(ORAMORD),10,ORAMX,0),"^")["HCT" S ORAML60=+$P(^(0),"^",2)
"RTN","ORAM1",291,0)
 . I +$G(ORAML60) S ORAMCH=$P($P(^LAB(60,ORAML60,0),"^",5),";",2) S RESULT=ORAMCH
"RTN","ORAM1",292,0)
 Q
"RTN","ORAM1",293,0)
 ;
"RTN","ORP351")
0^^B707059^n/a
"RTN","ORP351",1,0)
ORP351 ;BP/SMT Post init OR*3*351 ;7/06/11 11:09
"RTN","ORP351",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**351**;Jul 06, 2011;Build 4
"RTN","ORP351",3,0)
 ;
"RTN","ORP351",4,0)
 ; This routine will clear the CL x-ref and rebuild it.
"RTN","ORP351",5,0)
 ;
"RTN","ORP351",6,0)
 Q
"RTN","ORP351",7,0)
EN ;
"RTN","ORP351",8,0)
 N DIK
"RTN","ORP351",9,0)
 I $D(^ORAM(103,"CL")) D  ;Lets check that values in the X-ref exist before rebuilding.
"RTN","ORP351",10,0)
 . S DIK="^ORAM(103,",DIK(1)="101^CL"
"RTN","ORP351",11,0)
 . D ENALL2^DIK ;Kill CL X-ref to clean up danglers
"RTN","ORP351",12,0)
 . D ENALL^DIK ;Rebuild CL X-ref.
"RTN","ORP351",13,0)
 Q
"VER")
8.0^22.0
"BLD",8348,6)
^312
**END**
**END**
