EMERGENCY Released GMTS*2.7*96 SEQ #94
Extracted from mail message
**KIDS**:GMTS*2.7*96^

**INSTALL NAME**
GMTS*2.7*96
"BLD",7936,0)
GMTS*2.7*96^HEALTH SUMMARY^0^3121030^y
"BLD",7936,1,0)
^^17^17^3121015^
"BLD",7936,1,1,0)
1. As a part of the Lab Re-engineering project, displays are being
"BLD",7936,1,2,0)
modified to show the Cerner COTS (Commercial Off-The-Shelf) accession
"BLD",7936,1,3,0)
number for those orders that are being performed on Cerner.
"BLD",7936,1,4,0)
 
"BLD",7936,1,5,0)
One of these displays is controlled by the Health Summary v2.7 package. 
"BLD",7936,1,6,0)
The purpose of this patch is to modify the display on the Reports Tab - 
"BLD",7936,1,7,0)
Clinical Reports - Laboratory - Lab Orders to show the COTS accession 
"BLD",7936,1,8,0)
number if it is available.
"BLD",7936,1,9,0)
 
"BLD",7936,1,10,0)
2. In some cases, the status of a test displays as 'COMPLETED' on the 
"BLD",7936,1,11,0)
Computerized Patient Record System (CPRS) Reports Tab and Lab Tab 
"BLD",7936,1,12,0)
displays, rather than the appropriate status of 'CANCELED'. This patch 
"BLD",7936,1,13,0)
corrects this problem.
"BLD",7936,1,14,0)
 
"BLD",7936,1,15,0)
3. In support of New Service Request 20070438, a change is required in 
"BLD",7936,1,16,0)
the Health Summary package. This patch makes this change to the Lab 
"BLD",7936,1,17,0)
Display Status. The change will be dormant until CPRS v30 is installed.
"BLD",7936,4,0)
^9.64PA^^
"BLD",7936,6.3)
9
"BLD",7936,"ABPKG")
n
"BLD",7936,"KRN",0)
^9.67PA^779.2^20
"BLD",7936,"KRN",.4,0)
.4
"BLD",7936,"KRN",.401,0)
.401
"BLD",7936,"KRN",.402,0)
.402
"BLD",7936,"KRN",.403,0)
.403
"BLD",7936,"KRN",.5,0)
.5
"BLD",7936,"KRN",.84,0)
.84
"BLD",7936,"KRN",3.6,0)
3.6
"BLD",7936,"KRN",3.8,0)
3.8
"BLD",7936,"KRN",9.2,0)
9.2
"BLD",7936,"KRN",9.8,0)
9.8
"BLD",7936,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7936,"KRN",9.8,"NM",1,0)
GMTSLROE^^0^B12396519
"BLD",7936,"KRN",9.8,"NM",1,99999999)
2989975^3100831.215004
"BLD",7936,"KRN",9.8,"NM","B","GMTSLROE",1)

"BLD",7936,"KRN",19,0)
19
"BLD",7936,"KRN",19,"NM",0)
^9.68A^^
"BLD",7936,"KRN",19.1,0)
19.1
"BLD",7936,"KRN",101,0)
101
"BLD",7936,"KRN",409.61,0)
409.61
"BLD",7936,"KRN",771,0)
771
"BLD",7936,"KRN",779.2,0)
779.2
"BLD",7936,"KRN",870,0)
870
"BLD",7936,"KRN",8989.51,0)
8989.51
"BLD",7936,"KRN",8989.52,0)
8989.52
"BLD",7936,"KRN",8994,0)
8994
"BLD",7936,"KRN","B",.4,.4)

"BLD",7936,"KRN","B",.401,.401)

"BLD",7936,"KRN","B",.402,.402)

"BLD",7936,"KRN","B",.403,.403)

"BLD",7936,"KRN","B",.5,.5)

"BLD",7936,"KRN","B",.84,.84)

"BLD",7936,"KRN","B",3.6,3.6)

"BLD",7936,"KRN","B",3.8,3.8)

"BLD",7936,"KRN","B",9.2,9.2)

"BLD",7936,"KRN","B",9.8,9.8)

"BLD",7936,"KRN","B",19,19)

"BLD",7936,"KRN","B",19.1,19.1)

"BLD",7936,"KRN","B",101,101)

"BLD",7936,"KRN","B",409.61,409.61)

"BLD",7936,"KRN","B",771,771)

"BLD",7936,"KRN","B",779.2,779.2)

"BLD",7936,"KRN","B",870,870)

"BLD",7936,"KRN","B",8989.51,8989.51)

"BLD",7936,"KRN","B",8989.52,8989.52)

"BLD",7936,"KRN","B",8994,8994)

"BLD",7936,"QUES",0)
^9.62^^
"BLD",7936,"REQB",0)
^9.611^1^1
"BLD",7936,"REQB",1,0)
GMTS*2.7*47^2
"BLD",7936,"REQB","B","GMTS*2.7*47",1)

"MBREQ")
0
"PKG",160,-1)
1^1
"PKG",160,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",160,20,0)
^9.402P^^
"PKG",160,22,0)
^9.49I^1^1
"PKG",160,22,1,0)
2.7^2951020^2951219
"PKG",160,22,1,"PAH",1,0)
96^3121030^10000000179
"PKG",160,22,1,"PAH",1,1,0)
^^17^17^3121030
"PKG",160,22,1,"PAH",1,1,1,0)
1. As a part of the Lab Re-engineering project, displays are being
"PKG",160,22,1,"PAH",1,1,2,0)
modified to show the Cerner COTS (Commercial Off-The-Shelf) accession
"PKG",160,22,1,"PAH",1,1,3,0)
number for those orders that are being performed on Cerner.
"PKG",160,22,1,"PAH",1,1,4,0)
 
"PKG",160,22,1,"PAH",1,1,5,0)
One of these displays is controlled by the Health Summary v2.7 package. 
"PKG",160,22,1,"PAH",1,1,6,0)
The purpose of this patch is to modify the display on the Reports Tab - 
"PKG",160,22,1,"PAH",1,1,7,0)
Clinical Reports - Laboratory - Lab Orders to show the COTS accession 
"PKG",160,22,1,"PAH",1,1,8,0)
number if it is available.
"PKG",160,22,1,"PAH",1,1,9,0)
 
"PKG",160,22,1,"PAH",1,1,10,0)
2. In some cases, the status of a test displays as 'COMPLETED' on the 
"PKG",160,22,1,"PAH",1,1,11,0)
Computerized Patient Record System (CPRS) Reports Tab and Lab Tab 
"PKG",160,22,1,"PAH",1,1,12,0)
displays, rather than the appropriate status of 'CANCELED'. This patch 
"PKG",160,22,1,"PAH",1,1,13,0)
corrects this problem.
"PKG",160,22,1,"PAH",1,1,14,0)
 
"PKG",160,22,1,"PAH",1,1,15,0)
3. In support of New Service Request 20070438, a change is required in 
"PKG",160,22,1,"PAH",1,1,16,0)
the Health Summary package. This patch makes this change to the Lab 
"PKG",160,22,1,"PAH",1,1,17,0)
Display Status. The change will be dormant until CPRS v30 is installed.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","GMTSLROE")
0^1^B12396519^B11334514
"RTN","GMTSLROE",1,0)
GMTSLROE ; SLC/JER,KER - Lab Orders Extract Routine ; 09/21/2001
"RTN","GMTSLROE",2,0)
 ;;2.7;Health Summary;**9,28,47,96**;Oct 20, 1995;Build 9
"RTN","GMTSLROE",3,0)
 ;
"RTN","GMTSLROE",4,0)
 ; External References
"RTN","GMTSLROE",5,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSLROE",6,0)
 ;   DBIA   525  ^LR(
"RTN","GMTSLROE",7,0)
 ;   DBIA   532  ^LRO(69,
"RTN","GMTSLROE",8,0)
 ;   DBIA   524  ^LAB(61,
"RTN","GMTSLROE",9,0)
 ;   DBIA    67  ^LAB(60
"RTN","GMTSLROE",10,0)
 ;   DBIA   530  ^LAB(62.05,
"RTN","GMTSLROE",11,0)
 ;   DBIA   531  ^LRO(68,
"RTN","GMTSLROE",12,0)
 ;   DBIA  5466  ^LRJWLST
"RTN","GMTSLROE",13,0)
 ;   DBIA 10142  $$VERSION^XPDUTL
"RTN","GMTSLROE",14,0)
 ;                 
"RTN","GMTSLROE",15,0)
XTRCT ; Gets lab orders and loads them into GMTSLRO local array
"RTN","GMTSLROE",16,0)
 N LRDFN,GMI,CD,ID,SN,TN K ^TMP("LROI",$J)
"RTN","GMTSLROE",17,0)
 K ^TMP("LRO",$J)
"RTN","GMTSLROE",18,0)
 Q:'$D(^DPT(DFN,"LR"))  S LRDFN=+^DPT(DFN,"LR") Q:'$D(^LR(LRDFN))
"RTN","GMTSLROE",19,0)
 S CD=GMTSBEG-.1
"RTN","GMTSLROE",20,0)
 F  S CD=$O(^LRO(69,"D",LRDFN,CD)) Q:CD'>0!(CD>GMTSEND)  S SN=0 F  S SN=$O(^LRO(69,"D",LRDFN,CD,SN)) Q:SN'>0  S TN=0 F  S TN=$O(^LRO(69,CD,1,SN,2,TN)) Q:TN'>0  S ^TMP("LROI",$J,9999999-CD,SN,TN)=""
"RTN","GMTSLROE",21,0)
 S (GMI,ID)=0 F  S ID=$O(^TMP("LROI",$J,ID)) Q:ID'>0!(GMI=MAX)  S CD=9999999-ID,SN=0 F  S SN=$O(^TMP("LROI",$J,ID,SN)) Q:SN'>0!(GMI=MAX)  S TN=0 F  S TN=$O(^TMP("LROI",$J,ID,SN,TN)) Q:TN'>0!(GMI=MAX)  D SET
"RTN","GMTSLROE",22,0)
 K ^TMP("LROI",$J)
"RTN","GMTSLROE",23,0)
 Q
"RTN","GMTSLROE",24,0)
SET ; Sets ^TMP("LRO",$J, w/appropriate data
"RTN","GMTSLROE",25,0)
 N SPST,CST,OS,CDT,SPST,FST,RDT,SITE,SPEC,TST,IDT,COLL,ODT,MD,CS,URG,ACC
"RTN","GMTSLROE",26,0)
 N RL,TEST
"RTN","GMTSLROE",27,0)
 I $D(^LRO(69,CD,1,SN,0)) S SPST=^(0) D ORDER
"RTN","GMTSLROE",28,0)
 I $D(^LRO(69,CD,1,SN,1)) S CST=^(1) D COLLECT I 1
"RTN","GMTSLROE",29,0)
 E  S OS="ORDERED",X=$P(^LRO(69,CD,1,SN,0),U,8),IDT=9999999-X D REGDTM4^GMTSU S CDT=X K X
"RTN","GMTSLROE",30,0)
 I $D(^LRO(69,CD,1,SN,3)) S FST=^(3) D RESULT I 1
"RTN","GMTSLROE",31,0)
 E  S RDT="UNKNOWN"
"RTN","GMTSLROE",32,0)
 S SITE=+$G(^LRO(69,CD,1,SN,4,+$O(^LRO(69,CD,1,SN,4,0)),0)),SPEC=$S(SITE>0:SITE_";"_$P(^LAB(61,SITE,0),U),1:";UNKNOWN")
"RTN","GMTSLROE",33,0)
 I $D(^LRO(69,CD,1,SN,2,TN,0)) S TST=^(0) S:$P(TST,"^",9)="CA" OS="CANCELED" D TEST
"RTN","GMTSLROE",34,0)
 I $D(BADTEST) K BADTEST Q
"RTN","GMTSLROE",35,0)
 I $D(IDT),$D(SN),$D(TN) S ^TMP("LRO",$J,IDT,SN_TN)=CDT_U_TEST_U_SPEC_U_URG_U_OS_U_MD_U_ODT_U_ACC_U_RDT_U_COLL_U_CD_U_$P(TST,U,7),GMI=GMI+1
"RTN","GMTSLROE",36,0)
 Q
"RTN","GMTSLROE",37,0)
ORDER ; Get Orders
"RTN","GMTSLROE",38,0)
 N IFN,FNF,FILE,NM,NSPACE,PKG,X
"RTN","GMTSLROE",39,0)
 S COLL=$S($L($P(SPST,U,4)):$P(SPST,U,4),1:"UNKNOWN")
"RTN","GMTSLROE",40,0)
 S:"LW"[COLL COLL=$S(COLL="L":"LAB",1:"WARD")
"RTN","GMTSLROE",41,0)
 S X=$P(SPST,U,5) D REGDTM4^GMTSU S ODT=X
"RTN","GMTSLROE",42,0)
 S (MD,IFN)=$P(SPST,U,6),FNF=0,NSPACE="LR"
"RTN","GMTSLROE",43,0)
 S PKG=$$VERSION^XPDUTL(NSPACE),FILE=$S($G(PKG)<5.2:6,1:200)
"RTN","GMTSLROE",44,0)
 S NM=$$NAME^GMTSU(MD,0,10) S MD=MD_";"_NM
"RTN","GMTSLROE",45,0)
 S RL=$P(SPST,U,7) Q
"RTN","GMTSLROE",46,0)
COLLECT ; Collection Date and Time
"RTN","GMTSLROE",47,0)
 N X S X=$P(CST,U),IDT=9999999-X D REGDTM4^GMTSU S CDT=X,CS=$P(CST,U,4),OS="COLLECTED"
"RTN","GMTSLROE",48,0)
 Q
"RTN","GMTSLROE",49,0)
RESULT ; Result Date and Time
"RTN","GMTSLROE",50,0)
 N X S X=$P(FST,U,2) D REGDTM4^GMTSU S RDT=X
"RTN","GMTSLROE",51,0)
 Q
"RTN","GMTSLROE",52,0)
TEST ; Lab Test Ordered
"RTN","GMTSLROE",53,0)
 N TPTR,UPTR,ACCD,ACCA,ACCN
"RTN","GMTSLROE",54,0)
 S TPTR=+TST,UPTR=$P(TST,U,2),ACCD=$P(TST,U,3)
"RTN","GMTSLROE",55,0)
 I $D(TPTR),(TPTR'>0) S BADTEST=1 Q
"RTN","GMTSLROE",56,0)
 S ACCA=$P(TST,U,4),ACCN=$P(TST,U,5)
"RTN","GMTSLROE",57,0)
 S TEST=TPTR_";"_$S($L($P(^LAB(60,TPTR,0),U))<21:$P(^(0),U),1:$P(^(.1),U))
"RTN","GMTSLROE",58,0)
 S URG=$E($S($D(^LAB(62.05,+UPTR,0)):$P(^(0),U),1:""),1,7)
"RTN","GMTSLROE",59,0)
 I $S('$D(ACCD):1,'$L(ACCA):1,'$L(ACCD):1,1:0) S ACC="NONE" Q
"RTN","GMTSLROE",60,0)
 S ACC=$S($D(^LRO(68,+ACCA,1,+ACCD,1,+ACCN,.2)):^(.2),1:"NONE")
"RTN","GMTSLROE",61,0)
 I $T(GETACC^LRJWLST)]"" D
"RTN","GMTSLROE",62,0)
 . N OACC
"RTN","GMTSLROE",63,0)
 . S OACC=$P($G(^LRO(69,CD,1,SN,2,TN,64.91)),"^",3)
"RTN","GMTSLROE",64,0)
 . I OACC]"" S ACC=OACC
"RTN","GMTSLROE",65,0)
 I $D(^LRO(68,+ACCA,1,+ACCD,1,+ACCN,4,TPTR,0)) S X=$P(^(0),U,5) I $G(OS)'="CANCELED" S OS=$S('$L(X):"PROCESSING",1:"COMPLETED")
"RTN","GMTSLROE",66,0)
 Q
"VER")
8.0^22.0
"BLD",7936,6)
^94
**END**
**END**
