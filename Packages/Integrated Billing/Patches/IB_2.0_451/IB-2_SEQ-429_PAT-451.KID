Released IB*2*451 SEQ #429
Extracted from mail message
**KIDS**:IB*2.0*451^

**INSTALL NAME**
IB*2.0*451
"BLD",7679,0)
IB*2.0*451^INTEGRATED BILLING^0^3111206^y
"BLD",7679,1,0)
^^2^2^3111017^^
"BLD",7679,1,1,0)
This patch addresses system enhancements to the Integrated Billing 
"BLD",7679,1,2,0)
software as requested by the VA's Chief Business Office (CBO).
"BLD",7679,4,0)
^9.64PA^361.1^1
"BLD",7679,4,361.1,0)
361.1
"BLD",7679,4,361.1,2,0)
^9.641^361.1101^2
"BLD",7679,4,361.1,2,361.1101,0)
MOVE/COPY HISTORY  (sub-file)
"BLD",7679,4,361.1,2,361.1101,1,0)
^9.6411^^0
"BLD",7679,4,361.1,2,361.11016,0)
OTHER CLAIM NUMBERS  (sub-file)
"BLD",7679,4,361.1,2,361.11016,1,0)
^9.6411^^0
"BLD",7679,4,361.1,222)
y^n^p^^^^n^^n
"BLD",7679,4,361.1,224)

"BLD",7679,4,"APDD",361.1,361.1101)

"BLD",7679,4,"APDD",361.1,361.11016)

"BLD",7679,4,"B",361.1,361.1)

"BLD",7679,6.3)
47
"BLD",7679,"ABPKG")
n
"BLD",7679,"KRN",0)
^9.67PA^779.2^20
"BLD",7679,"KRN",.4,0)
.4
"BLD",7679,"KRN",.401,0)
.401
"BLD",7679,"KRN",.402,0)
.402
"BLD",7679,"KRN",.403,0)
.403
"BLD",7679,"KRN",.5,0)
.5
"BLD",7679,"KRN",.84,0)
.84
"BLD",7679,"KRN",3.6,0)
3.6
"BLD",7679,"KRN",3.8,0)
3.8
"BLD",7679,"KRN",9.2,0)
9.2
"BLD",7679,"KRN",9.8,0)
9.8
"BLD",7679,"KRN",9.8,"NM",0)
^9.68A^20^14
"BLD",7679,"KRN",9.8,"NM",3,0)
IBJDF41^^0^B92006724
"BLD",7679,"KRN",9.8,"NM",5,0)
IBOA31^^0^B19354784
"BLD",7679,"KRN",9.8,"NM",6,0)
IBOA32^^0^B7690123
"BLD",7679,"KRN",9.8,"NM",7,0)
IBOTR2^^0^B18730525
"BLD",7679,"KRN",9.8,"NM",9,0)
IBJTU1^^0^B7894877
"BLD",7679,"KRN",9.8,"NM",10,0)
IBJTLA^^0^B3871013
"BLD",7679,"KRN",9.8,"NM",11,0)
IBJTLA1^^0^B10714466
"BLD",7679,"KRN",9.8,"NM",13,0)
IBJDF11^^0^B27610057
"BLD",7679,"KRN",9.8,"NM",14,0)
IBJTLB^^0^B2602328
"BLD",7679,"KRN",9.8,"NM",15,0)
IBJTLB1^^0^B11067077
"BLD",7679,"KRN",9.8,"NM",17,0)
IBCEOB4^^0^B17512247
"BLD",7679,"KRN",9.8,"NM",18,0)
IBCECSA6^^0^B167601727
"BLD",7679,"KRN",9.8,"NM",19,0)
IBJTBA1^^0^B50433175
"BLD",7679,"KRN",9.8,"NM",20,0)
IBJTCA^^0^B2378826
"BLD",7679,"KRN",9.8,"NM","B","IBCECSA6",18)

"BLD",7679,"KRN",9.8,"NM","B","IBCEOB4",17)

"BLD",7679,"KRN",9.8,"NM","B","IBJDF11",13)

"BLD",7679,"KRN",9.8,"NM","B","IBJDF41",3)

"BLD",7679,"KRN",9.8,"NM","B","IBJTBA1",19)

"BLD",7679,"KRN",9.8,"NM","B","IBJTCA",20)

"BLD",7679,"KRN",9.8,"NM","B","IBJTLA",10)

"BLD",7679,"KRN",9.8,"NM","B","IBJTLA1",11)

"BLD",7679,"KRN",9.8,"NM","B","IBJTLB",14)

"BLD",7679,"KRN",9.8,"NM","B","IBJTLB1",15)

"BLD",7679,"KRN",9.8,"NM","B","IBJTU1",9)

"BLD",7679,"KRN",9.8,"NM","B","IBOA31",5)

"BLD",7679,"KRN",9.8,"NM","B","IBOA32",6)

"BLD",7679,"KRN",9.8,"NM","B","IBOTR2",7)

"BLD",7679,"KRN",19,0)
19
"BLD",7679,"KRN",19,"NM",0)
^9.68A^^
"BLD",7679,"KRN",19.1,0)
19.1
"BLD",7679,"KRN",101,0)
101
"BLD",7679,"KRN",409.61,0)
409.61
"BLD",7679,"KRN",409.61,"NM",0)
^9.68A^2^2
"BLD",7679,"KRN",409.61,"NM",1,0)
IBJT ACTIVE LIST^^0
"BLD",7679,"KRN",409.61,"NM",2,0)
IBJT INACTIVE LIST^^0
"BLD",7679,"KRN",409.61,"NM","B","IBJT ACTIVE LIST",1)

"BLD",7679,"KRN",409.61,"NM","B","IBJT INACTIVE LIST",2)

"BLD",7679,"KRN",771,0)
771
"BLD",7679,"KRN",779.2,0)
779.2
"BLD",7679,"KRN",870,0)
870
"BLD",7679,"KRN",8989.51,0)
8989.51
"BLD",7679,"KRN",8989.52,0)
8989.52
"BLD",7679,"KRN",8994,0)
8994
"BLD",7679,"KRN","B",.4,.4)

"BLD",7679,"KRN","B",.401,.401)

"BLD",7679,"KRN","B",.402,.402)

"BLD",7679,"KRN","B",.403,.403)

"BLD",7679,"KRN","B",.5,.5)

"BLD",7679,"KRN","B",.84,.84)

"BLD",7679,"KRN","B",3.6,3.6)

"BLD",7679,"KRN","B",3.8,3.8)

"BLD",7679,"KRN","B",9.2,9.2)

"BLD",7679,"KRN","B",9.8,9.8)

"BLD",7679,"KRN","B",19,19)

"BLD",7679,"KRN","B",19.1,19.1)

"BLD",7679,"KRN","B",101,101)

"BLD",7679,"KRN","B",409.61,409.61)

"BLD",7679,"KRN","B",771,771)

"BLD",7679,"KRN","B",779.2,779.2)

"BLD",7679,"KRN","B",870,870)

"BLD",7679,"KRN","B",8989.51,8989.51)

"BLD",7679,"KRN","B",8989.52,8989.52)

"BLD",7679,"KRN","B",8994,8994)

"BLD",7679,"QUES",0)
^9.62^^
"BLD",7679,"REQB",0)
^9.611^2^2
"BLD",7679,"REQB",1,0)
IB*2.0*431^2
"BLD",7679,"REQB",2,0)
IB*2.0*433^2
"BLD",7679,"REQB","B","IB*2.0*431",1)

"BLD",7679,"REQB","B","IB*2.0*433",2)

"FIA",361.1)
EXPLANATION OF BENEFITS
"FIA",361.1,0)
^IBM(361.1,
"FIA",361.1,0,0)
361.1PI
"FIA",361.1,0,1)
y^n^p^^^^n^^n
"FIA",361.1,0,10)

"FIA",361.1,0,11)

"FIA",361.1,0,"RLRO")

"FIA",361.1,0,"VR")
2.0^IB
"FIA",361.1,361.1)
1
"FIA",361.1,361.1,101)

"FIA",361.1,361.1101)
0
"FIA",361.1,361.11016)
0
"KRN",409.61,1724,-1)
0^1
"KRN",409.61,1724,0)
IBJT ACTIVE LIST^1^^80^4^20^1^1^Active Bill^IBJT ACTIVE LIST SCREEN MENU^Third Party Active Bills^1^^1
"KRN",409.61,1724,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,1724,"ARRAY")
 ^TMP("IBJTLA",$J)
"KRN",409.61,1724,"COL",0)
^409.621^14^14
"KRN",409.61,1724,"COL",1,0)
NUMBER^1^3
"KRN",409.61,1724,"COL",2,0)
BILL^4^9^ Bill #
"KRN",409.61,1724,"COL",3,0)
HD^14^1
"KRN",409.61,1724,"COL",4,0)
STFROM^15^8^From
"KRN",409.61,1724,"COL",5,0)
STTO^24^8^To
"KRN",409.61,1724,"COL",6,0)
TYPE^37^4^Type
"KRN",409.61,1724,"COL",7,0)
ARST^42^4^Stat
"KRN",409.61,1724,"COL",8,0)
RATE^47^7^Rate
"KRN",409.61,1724,"COL",9,0)
CB^55^1
"KRN",409.61,1724,"COL",10,0)
INSUR^56^7^Insurer
"KRN",409.61,1724,"COL",11,0)
OAMT^64^8^Orig Amt
"KRN",409.61,1724,"COL",12,0)
CAMT^73^8^Curr Amt
"KRN",409.61,1724,"COL",13,0)
REFER^13^1
"KRN",409.61,1724,"COL",14,0)
MT?^33^3^MT?
"KRN",409.61,1724,"COL","B","ARST",7)

"KRN",409.61,1724,"COL","B","BILL",2)

"KRN",409.61,1724,"COL","B","CAMT",12)

"KRN",409.61,1724,"COL","B","CAT",14)

"KRN",409.61,1724,"COL","B","CB",9)

"KRN",409.61,1724,"COL","B","HD",3)

"KRN",409.61,1724,"COL","B","INSUR",10)

"KRN",409.61,1724,"COL","B","MT?",14)

"KRN",409.61,1724,"COL","B","NUMBER",1)

"KRN",409.61,1724,"COL","B","OAMT",11)

"KRN",409.61,1724,"COL","B","RATE",8)

"KRN",409.61,1724,"COL","B","REFER",13)

"KRN",409.61,1724,"COL","B","STFROM",4)

"KRN",409.61,1724,"COL","B","STTO",5)

"KRN",409.61,1724,"COL","B","TYPE",6)

"KRN",409.61,1724,"FNL")
D EXIT^IBJTLA
"KRN",409.61,1724,"HDR")
D HDR^IBJTLA
"KRN",409.61,1724,"HLP")
D HELP^IBJTLA
"KRN",409.61,1724,"INIT")
D INIT^IBJTLA
"KRN",409.61,1735,-1)
0^2
"KRN",409.61,1735,0)
IBJT INACTIVE LIST^1^^80^4^20^1^1^Inactive Bill^IBJT INACTIVE LIST SCREEN MENU^Inactive Bills^1^^1
"KRN",409.61,1735,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,1735,"ARRAY")
 ^TMP("IBJTLB",$J)
"KRN",409.61,1735,"COL",0)
^409.621^13^13
"KRN",409.61,1735,"COL",1,0)
NUMBER^1^3
"KRN",409.61,1735,"COL",2,0)
BILL^4^9^ Bill #
"KRN",409.61,1735,"COL",3,0)
HD^14^1
"KRN",409.61,1735,"COL",4,0)
STFROM^15^8^From
"KRN",409.61,1735,"COL",5,0)
STTO^25^8^To
"KRN",409.61,1735,"COL",6,0)
TYPE^35^4^Type
"KRN",409.61,1735,"COL",7,0)
ARST^40^4^Stat
"KRN",409.61,1735,"COL",8,0)
RATE^45^8^Rate
"KRN",409.61,1735,"COL",9,0)
CB^55^1
"KRN",409.61,1735,"COL",10,0)
INSUR^56^7^Insurer
"KRN",409.61,1735,"COL",11,0)
OAMT^64^8^Orig Amt
"KRN",409.61,1735,"COL",12,0)
CAMT^73^8^Curr Amt
"KRN",409.61,1735,"COL",13,0)
REFER^13^1
"KRN",409.61,1735,"COL","B","ARST",7)

"KRN",409.61,1735,"COL","B","BILL",2)

"KRN",409.61,1735,"COL","B","CAMT",12)

"KRN",409.61,1735,"COL","B","CB",9)

"KRN",409.61,1735,"COL","B","HD",3)

"KRN",409.61,1735,"COL","B","INSUR",10)

"KRN",409.61,1735,"COL","B","NUMBER",1)

"KRN",409.61,1735,"COL","B","OAMT",11)

"KRN",409.61,1735,"COL","B","RATE",8)

"KRN",409.61,1735,"COL","B","REFER",13)

"KRN",409.61,1735,"COL","B","STFROM",4)

"KRN",409.61,1735,"COL","B","STTO",5)

"KRN",409.61,1735,"COL","B","TYPE",6)

"KRN",409.61,1735,"FNL")
D EXIT^IBJTLB
"KRN",409.61,1735,"HDR")
D HDR^IBJTLB
"KRN",409.61,1735,"HLP")
D HELP^IBJTLB
"KRN",409.61,1735,"INIT")
D INIT^IBJTLB
"MBREQ")
0
"ORD",17,409.61)
409.61;17;1;;;;LME1^XPDIA1;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"PKG",202,-1)
1^1
"PKG",202,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",202,20,0)
^9.402P^1^1
"PKG",202,20,1,0)
2^^IBAXDR
"PKG",202,20,1,1)

"PKG",202,20,"B",2,1)

"PKG",202,22,0)
^9.49I^1^1
"PKG",202,22,1,0)
2.0^2940321^2940321
"PKG",202,22,1,"PAH",1,0)
451^3111206
"PKG",202,22,1,"PAH",1,1,0)
^^2^2^3111206
"PKG",202,22,1,"PAH",1,1,1,0)
This patch addresses system enhancements to the Integrated Billing 
"PKG",202,22,1,"PAH",1,1,2,0)
software as requested by the VA's Chief Business Office (CBO).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","IBCECSA6")
0^18^B167601727^B133569108
"RTN","IBCECSA6",1,0)
IBCECSA6 ;ALB/CXW/PJH - VIEW EOB SCREEN ;01-OCT-1999
"RTN","IBCECSA6",2,0)
 ;;2.0;INTEGRATED BILLING;**137,135,155,417,431,451**;21-MAR-1994;Build 47
"RTN","IBCECSA6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCECSA6",4,0)
 ;
"RTN","IBCECSA6",5,0)
BLD ;build EOB data display
"RTN","IBCECSA6",6,0)
 D GETEOB(IBCNT,0)
"RTN","IBCECSA6",7,0)
 Q
"RTN","IBCECSA6",8,0)
 ;
"RTN","IBCECSA6",9,0)
GETEOB(IBCNT,IBSRC,IBFULL,IBJTIBLN) ; Get EOB data in display format
"RTN","IBCECSA6",10,0)
 ; IBCNT = the ien of the entry in file 361.1
"RTN","IBCECSA6",11,0)
 ; IBSRC = 1 if called from AR, 0 if List Manager format needed
"RTN","IBCECSA6",12,0)
 ;       = 2 if called from AR and header data is desired
"RTN","IBCECSA6",13,0)
 ;   If IBSRC > 0  ^TMP("PRCA_EOB",$J,IBCNT,n)=line n's text is ret'd
"RTN","IBCECSA6",14,0)
 ; IBFULL = 1 if no check should be made to eliminate a fld whose value=0
"RTN","IBCECSA6",15,0)
 ; IBJTIBLN = line number to start VALMCNT with (optional)
"RTN","IBCECSA6",16,0)
 ;            used by IBJTBA1
"RTN","IBCECSA6",17,0)
 ;
"RTN","IBCECSA6",18,0)
 N IBREC,IBTYP,CNT,IBREM
"RTN","IBCECSA6",19,0)
 S IBFULL=$G(IBFULL),IBSRC=$G(IBSRC)
"RTN","IBCECSA6",20,0)
 I IBSRC N VALMBG,VALMCNT
"RTN","IBCECSA6",21,0)
 S VALMCNT=0,VALMBG=1,CNT=0
"RTN","IBCECSA6",22,0)
 I $G(IBJTIBLN)>0 S VALMCNT=IBJTIBLN
"RTN","IBCECSA6",23,0)
 S IBREC=$G(^IBM(361.1,IBCNT,0)),IBTYP=$P(IBREC,U,4)
"RTN","IBCECSA6",24,0)
 I IBSRC K ^TMP("PRCA_EOB",$J,IBCNT)
"RTN","IBCECSA6",25,0)
 ; Once we're displaying a single EOB, remove the multiple EOB header of 
"RTN","IBCECSA6",26,0)
 ; the View EOB screen that was set in HDR^IBCEOB2 - VALMHDR(4).
"RTN","IBCECSA6",27,0)
 I 'IBSRC,$G(VALMHDR(4))'="" S VALMHDR(4)=""
"RTN","IBCECSA6",28,0)
 D GEN,PAY,ARCP^IBCECSA7,CLVL,CLVLA,MIN^IBCECSA5,MOUT,LLVLA^IBCECSA7,RDATA^IBCECSA7
"RTN","IBCECSA6",29,0)
 Q
"RTN","IBCECSA6",30,0)
 ;
"RTN","IBCECSA6",31,0)
SEL(IB,ONE) ;
"RTN","IBCECSA6",32,0)
 N IBDA
"RTN","IBCECSA6",33,0)
 D EN^VALM2($G(XQORNOD(0)),$S('$G(ONE):"",1:"S"))
"RTN","IBCECSA6",34,0)
 S IBDA=0 S IBDA=$O(VALMY(IBDA)) Q:'IBDA  D
"RTN","IBCECSA6",35,0)
 . S IB=$P($G(^TMP("IBCECSD",$J,IBDA)),U,2)
"RTN","IBCECSA6",36,0)
 . S IBONE=1
"RTN","IBCECSA6",37,0)
 Q
"RTN","IBCECSA6",38,0)
 ;
"RTN","IBCECSA6",39,0)
ACT ; Reposition display using actions
"RTN","IBCECSA6",40,0)
 I '$G(IBONE) D SEL(.IBCNT,1) D BLD:$G(IBCNT)
"RTN","IBCECSA6",41,0)
 S VALMBG=$G(^TMP("IBCECSD",$J,"X",+$G(IBACT))) S:'VALMBG VALMBG=1
"RTN","IBCECSA6",42,0)
 S VALMBCK="R"
"RTN","IBCECSA6",43,0)
 Q
"RTN","IBCECSA6",44,0)
 ;
"RTN","IBCECSA6",45,0)
SET(IBSRC,X,CNT,IBCNT) ;set list manager arrays
"RTN","IBCECSA6",46,0)
 S VALMCNT=VALMCNT+1,IBSRC=$G(IBSRC)
"RTN","IBCECSA6",47,0)
 ;
"RTN","IBCECSA6",48,0)
 I IBSRC D  Q
"RTN","IBCECSA6",49,0)
 . S ^TMP("PRCA_EOB",$J,IBCNT,VALMCNT)=X
"RTN","IBCECSA6",50,0)
 ;
"RTN","IBCECSA6",51,0)
 S ^TMP("IBCECSD",$J,VALMCNT,0)=X
"RTN","IBCECSA6",52,0)
 S ^TMP("IBCECSD",$J,"IDX",VALMCNT,CNT)=""
"RTN","IBCECSA6",53,0)
 S ^TMP("IBCECSD",$J,CNT)=VALMCNT_U_IBCNT
"RTN","IBCECSA6",54,0)
 Q
"RTN","IBCECSA6",55,0)
 ;
"RTN","IBCECSA6",56,0)
GEN ;
"RTN","IBCECSA6",57,0)
 S IBSRC=$G(IBSRC) Q:IBSRC=1
"RTN","IBCECSA6",58,0)
 N IBREC1,IBTMP,IBSPL
"RTN","IBCECSA6",59,0)
 S IBSPL=+$O(^IBM(361.1,IBCNT,8,0)),IBSPL=(+$O(^(IBSPL))'=IBSPL)
"RTN","IBCECSA6",60,0)
 S IB=$$SETSTR^VALM1("EOB GENERAL INFORMATION:","",1,50)
"RTN","IBCECSA6",61,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",62,0)
 I 'IBSRC D
"RTN","IBCECSA6",63,0)
 . D CNTRL^VALM10(VALMCNT,1,24,IORVON,IORVOFF)
"RTN","IBCECSA6",64,0)
 . S ^TMP("IBCECSD",$J,"X",1)=VALMCNT
"RTN","IBCECSA6",65,0)
 S IB=$$SETSTR^VALM1("Type        : "_$S(IBTYP:"MEDICARE MRA",1:"NORMAL EOB")_$S(IBSPL:" (SPLIT IN A/R)",1:""),"",2,39)
"RTN","IBCECSA6",66,0)
 S IB=$$SETSTR^VALM1("EOB Paid DT  : "_$$DAT1^IBOUTL($P(IBREC,U,6),1),IB,41,38)
"RTN","IBCECSA6",67,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",68,0)
 I IBSRC D
"RTN","IBCECSA6",69,0)
 . S IB=$$SETSTR^VALM1($S(IBSRC:"Entry Dt/Tm :"_$$DAT1^IBOUTL($P(IBREC,U,5),1),1:""),"",2,39)
"RTN","IBCECSA6",70,0)
 . S IBTMP=$P(IBREC,U,13)
"RTN","IBCECSA6",71,0)
 . S IB=$$SETSTR^VALM1("Claim Status : "_$$EXTERNAL^DILFD(361.1,.13,"",IBTMP),IB,41,38)
"RTN","IBCECSA6",72,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",73,0)
 . S IBTMP=$P(IBREC,U,16)
"RTN","IBCECSA6",74,0)
 . S IB=$$SETSTR^VALM1("Review Status: "_$$EXTERNAL^DILFD(361.1,.16,"",IBTMP),IB,41,38)
"RTN","IBCECSA6",75,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",76,0)
 . S IB=$$SETSTR^VALM1("Entered By  : "_$P($G(^VA(200,+$P(IBREC,U,18),0)),U),"",2,39)
"RTN","IBCECSA6",77,0)
 . S IBTMP=$P(IBREC,U,15)
"RTN","IBCECSA6",78,0)
 . S IB=$$SETSTR^VALM1("Insurance Seq: "_$$EXTERNAL^DILFD(361.1,.15,"",IBTMP),IB,41,38)
"RTN","IBCECSA6",79,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",80,0)
 I 'IBSRC D
"RTN","IBCECSA6",81,0)
 . S IB=$$SETSTR^VALM1($S($P(IBREC,U,17):"Manual Entry: YES",1:""),"",2,39)
"RTN","IBCECSA6",82,0)
 . S IBTMP=$P(IBREC,U,13)
"RTN","IBCECSA6",83,0)
 . S IB=$$SETSTR^VALM1("Claim Status : "_$$EXTERNAL^DILFD(361.1,.13,"",IBTMP),IB,41,38)
"RTN","IBCECSA6",84,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",85,0)
 . S IBTMP=$P(IBREC,U,15)
"RTN","IBCECSA6",86,0)
 . S IB=$$SETSTR^VALM1("Insurance Seq: "_$$EXTERNAL^DILFD(361.1,.15,"",IBTMP),"",41,38)
"RTN","IBCECSA6",87,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",88,0)
 S IBREC1=$G(^IBM(361.1,IBCNT,100))
"RTN","IBCECSA6",89,0)
 I $S($G(IBFULL):1,1:$P(IBREC1,U,4)'=""!($P(IBREC1,U,3)'="")) D
"RTN","IBCECSA6",90,0)
 . S IB=$$SETSTR^VALM1("Last Edited : "_$$DAT1^IBOUTL($P(IBREC1,U,4),1),"",2,39)
"RTN","IBCECSA6",91,0)
 . S IB=$$SETSTR^VALM1("Last Edit By : "_$P($G(^VA(200,+$P(IBREC1,U,3),0)),U),IB,41,38)
"RTN","IBCECSA6",92,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",93,0)
 ;
"RTN","IBCECSA6",94,0)
 D INSINF^IBCECSA7(+IBREC,CNT,IBCNT)
"RTN","IBCECSA6",95,0)
 ;
"RTN","IBCECSA6",96,0)
 ;Additional fields for HIPAA 5010
"RTN","IBCECSA6",97,0)
 I IBSRC D
"RTN","IBCECSA6",98,0)
 .N IBOSN,IBOSN1,IBREC50,IBREC51
"RTN","IBCECSA6",99,0)
 .S IBREC50=$G(^IBM(361.1,IBCNT,50)),IBREC51=$G(^IBM(361.1,IBCNT,51))
"RTN","IBCECSA6",100,0)
 .S IB=$$SETSTR^VALM1("Claim Rec'd Date     : "_$$DAT1^IBOUTL($P(IBREC50,U),1),"",2,39)
"RTN","IBCECSA6",101,0)
 .D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",102,0)
 .S IBOSN=$E($P(IBREC51,U),1,56),IBOSN1=$E($P(IBREC51,U),57,112)
"RTN","IBCECSA6",103,0)
 .S IB=$$SETSTR^VALM1("Other Subscriber Name: "_IBOSN,"",2,79)
"RTN","IBCECSA6",104,0)
 .D SET(IBSRC,IB,CNT,IBCNT) Q:IBOSN1=""
"RTN","IBCECSA6",105,0)
 .S IB=$$SETSTR^VALM1("                       "_IBOSN1,"",2,79)
"RTN","IBCECSA6",106,0)
 .D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",107,0)
 ;
"RTN","IBCECSA6",108,0)
 I $S($G(IBFULL):1,1:$P($G(^IBM(361.1,IBCNT,6)),U)'=""!($P($G(^IBM(361.1,IBCNT,6)),U,2)'="")) D
"RTN","IBCECSA6",109,0)
 . S IB=$$SETSTR^VALM1("New Pat. Nm.: "_$P($G(^IBM(361.1,IBCNT,6)),U),"",2,39)
"RTN","IBCECSA6",110,0)
 . S IB=$$SETSTR^VALM1("New Pat. Id  : "_$P($G(^IBM(361.1,IBCNT,6)),U,2),IB,41,38)
"RTN","IBCECSA6",111,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",112,0)
 D:IBSRC SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",113,0)
 Q
"RTN","IBCECSA6",114,0)
 ;
"RTN","IBCECSA6",115,0)
PAY ;
"RTN","IBCECSA6",116,0)
 S IBSRC=$G(IBSRC) Q:IBSRC=1
"RTN","IBCECSA6",117,0)
 N IBREC1,IBTMP
"RTN","IBCECSA6",118,0)
 S IB=$$SETSTR^VALM1("PAYER INFORMATION:","",1,50)
"RTN","IBCECSA6",119,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",120,0)
 I 'IBSRC D
"RTN","IBCECSA6",121,0)
 . D CNTRL^VALM10(VALMCNT,1,18,IORVON,IORVOFF)
"RTN","IBCECSA6",122,0)
 . S ^TMP("IBCECSD",$J,"X",2)=VALMCNT
"RTN","IBCECSA6",123,0)
 ; KL - HIPAA 5010 - moved the write of the Payer ID on the next line down from the payer name to accommodate
"RTN","IBCECSA6",124,0)
 ; the increased length of the PAYER NAME from 35 to 60 characters.  modified length parameter to $$SETSTR function for
"RTN","IBCECSA6",125,0)
 ; Payer ID and ICN to accommodate increased length of additional 20 characters. 
"RTN","IBCECSA6",126,0)
 S IB=$$SETSTR^VALM1("Payer Name   : "_$P($G(^DIC(36,+$P(IBREC,U,2),0)),U),"",2,60)
"RTN","IBCECSA6",127,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",128,0)
 S IB=$$SETSTR^VALM1("Payer Id     : "_$P(IBREC,U,3),IB,2,38)
"RTN","IBCECSA6",129,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",130,0)
 S IB=$$SETSTR^VALM1("ICN          : "_$P(IBREC,U,14),"",2,60)
"RTN","IBCECSA6",131,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",132,0)
 ;Additional fields for HIPA 5010
"RTN","IBCECSA6",133,0)
 N I,IBREC25,IBCON,IBCONTXT,IBCTYP,IBPAYNAM,IBWEB3,IBWEB
"RTN","IBCECSA6",134,0)
 ; Display PAYER CONTACT NAME, file #361.1, or CONTACT NAME, file #344; .4, (whichever is available)
"RTN","IBCECSA6",135,0)
 S IBREC25=$G(^IBM(361.1,IBCNT,25))
"RTN","IBCECSA6",136,0)
 S IBPAYNAM=$P(IBREC25,U)
"RTN","IBCECSA6",137,0)
 I IBPAYNAM="",+$G(RCSCR)>0 S IBPAYNAM=$P($G(^RCY(344.4,RCSCR,3)),U)
"RTN","IBCECSA6",138,0)
 I IBPAYNAM'="" D
"RTN","IBCECSA6",139,0)
 .S IB=$$SETSTR^VALM1("Payer Contact: "_IBPAYNAM,IB,2,60)
"RTN","IBCECSA6",140,0)
 .D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",141,0)
 I $TR($P(IBREC25,U,2,7),U,"")'="" D
"RTN","IBCECSA6",142,0)
 .F I=2,4,6 D
"RTN","IBCECSA6",143,0)
 ..S IBCON=$P(IBREC25,U,I),IBCTYP=$P(IBREC25,U,I+1) Q:IBCON=""
"RTN","IBCECSA6",144,0)
 ..S IBCONTXT=$S(IBCTYP="TE":"Contact Phone  : ",IBCTYP="FX":"Contact Fax    : ",IBCTYP="EM":"Contact e-Mail : ",1:"Invalid type :")
"RTN","IBCECSA6",145,0)
 ..S IB=$$SETSTR^VALM1(IBCONTXT_IBCON,"",2,50)
"RTN","IBCECSA6",146,0)
 ..D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",147,0)
 I $G(RCSCR)'="" D
"RTN","IBCECSA6",148,0)
 .S IBWEB=$P($G(^RCY(344.4,RCSCR,5)),U) Q:IBWEB=""
"RTN","IBCECSA6",149,0)
 .S IB=$$SETSTR^VALM1("Payer Web Site : "_$E(IBWEB,1,60),"",2,78)
"RTN","IBCECSA6",150,0)
 .D SET(IBSRC,IB,CNT,IBCNT) Q:$L(IBWEB)<61
"RTN","IBCECSA6",151,0)
 .S IB=$$SETSTR^VALM1($E(IBWEB,61,115),"",19,78)
"RTN","IBCECSA6",152,0)
 .D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",153,0)
 ;Payer Policy References
"RTN","IBCECSA6",154,0)
 D PPR
"RTN","IBCECSA6",155,0)
 N IBREC51
"RTN","IBCECSA6",156,0)
 S IBREC51=$G(^IBM(361.1,IBCNT,51))
"RTN","IBCECSA6",157,0)
 I $P(IBREC,U,9)'=""!($P(IBREC51,U,2)'="") D
"RTN","IBCECSA6",158,0)
 . S IB=$$SETSTR^VALM1("Cross Ovr ID : "_$P(IBREC,U,9),"",2,39)
"RTN","IBCECSA6",159,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",160,0)
 . S IB=$$SETSTR^VALM1("Cross Ovr Nm: "_$P(IBREC51,U,2),"",2,76)
"RTN","IBCECSA6",161,0)
 . D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",162,0)
 D:IBSRC SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",163,0)
 ;Audit Details
"RTN","IBCECSA6",164,0)
 D AUDIT
"RTN","IBCECSA6",165,0)
 Q
"RTN","IBCECSA6",166,0)
 ;
"RTN","IBCECSA6",167,0)
CLVL ;
"RTN","IBCECSA6",168,0)
 N IBREC1,IBTMP,IBRL
"RTN","IBCECSA6",169,0)
 S IB=$$SETSTR^VALM1("CLAIM LEVEL PAY STATUS:","",1,50),IBSRC=$G(IBSRC)
"RTN","IBCECSA6",170,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",171,0)
 I 'IBSRC D
"RTN","IBCECSA6",172,0)
 . D CNTRL^VALM10(VALMCNT,1,23,IORVON,IORVOFF)
"RTN","IBCECSA6",173,0)
 . S ^TMP("IBCECSD",$J,"X",3)=VALMCNT
"RTN","IBCECSA6",174,0)
 I '$D(^IBM(361.1,IBCNT,2)),'$D(^IBM(361.1,IBCNT,1)) D SET(IBSRC," NONE",CNT,IBCNT) Q
"RTN","IBCECSA6",175,0)
 S IB=$$SETSTR^VALM1("Tot Submitted Chrg: "_$$A10($P($G(^IBM(361.1,IBCNT,2)),U,4)),"",2,39)
"RTN","IBCECSA6",176,0)
 S IBREC1=$G(^IBM(361.1,IBCNT,1))
"RTN","IBCECSA6",177,0)
 S IB=$$SETSTR^VALM1("Covered Amt       : "_$$A10($P(IBREC1,U,3)),IB,41,38)
"RTN","IBCECSA6",178,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",179,0)
 S IB=$$SETSTR^VALM1("Payer Paid Amt    : "_$$A10($P(IBREC1,U)),"",2,39)
"RTN","IBCECSA6",180,0)
 S IB=$$SETSTR^VALM1("Patient Resp. Amt : "_$$A10($S($D(^IBM(361.1,IBCNT,"ERR")):0,IBSRC:$P(IBREC1,U,2),$$FT^IBCEF(+IBREC)=3:$$PTRESPI^IBCECOB1(IBCNT),1:$P($G(^IBM(361.1,IBCNT,1)),"^",2))),IB,41,38)
"RTN","IBCECSA6",181,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",182,0)
 S (IB,IBRL)=""
"RTN","IBCECSA6",183,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,4)) S IB=$$SETSTR^VALM1("Discount Amt      : "_$$A10($P(IBREC1,U,4)),"",2,39),IBRL=1
"RTN","IBCECSA6",184,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,5)) S IB=$$SETSTR^VALM1("Per Day Limit Amt : "_$$A10($P(IBREC1,U,5)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",185,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,8)) S IB=$$SETSTR^VALM1("Tax Amt           : "_$$A10($P(IBREC1,U,8)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",186,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,9)) S IB=$$SETSTR^VALM1("Tot Before Tax Amt: "_$$A10($P(IBREC1,U,9)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",187,0)
 I $S(IBFULL:1,1:$P($G(^IBM(361.1,IBCNT,2)),U,3)) S IB=$$SETSTR^VALM1("Total Allowed Amt : "_$$A10($P($G(^IBM(361.1,IBCNT,2)),U,3)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",188,0)
 I $S(IBFULL:1,1:$P($G(^IBM(361.1,IBCNT,2)),U,5)) S IB=$$SETSTR^VALM1("Negative Reimb Amt: "_$$A10($P($G(^IBM(361.1,IBCNT,2)),U,5)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",189,0)
 I $G(IBSRC) I $S(IBFULL:1,1:$P(IBREC,U,12)) S IB=$$SETSTR^VALM1("Discharge Fraction: "_$$A10($P(IBREC,U,12)),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",190,0)
 I $S(IBFULL:1,1:$P(IBREC,U,10)) S IB=$$SETSTR^VALM1("DRG Code Used     :"_$$RJ^XLFSTR($P(IBREC,U,10),11," "),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1) I IBRL=0 D SET(IBSRC,IB,CNT,IBCNT) S IB=""
"RTN","IBCECSA6",191,0)
 I $S(IBFULL:1,1:$P(IBREC,U,11)) S IB=$$SETSTR^VALM1("DRG Weight Used   :"_$$RJ^XLFSTR($P(IBREC,U,11),11," "),IB,$S('IBRL:2,1:41),$S('IBRL:39,1:38)),IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA6",192,0)
 D:IBRL'="" SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",193,0)
 D:IBSRC SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",194,0)
 Q
"RTN","IBCECSA6",195,0)
 ;
"RTN","IBCECSA6",196,0)
MOUT ;
"RTN","IBCECSA6",197,0)
 N IBREC1,IBRL
"RTN","IBCECSA6",198,0)
 S IBREC1=$G(^IBM(361.1,IBCNT,3)),IBSRC=$G(IBSRC)
"RTN","IBCECSA6",199,0)
 I 'IBSRC,$$INPAT^IBCEF(+IBREC),$TR(IBREC1,"0^")="" Q
"RTN","IBCECSA6",200,0)
 I IBREC1="" D:'$D(^IBM(361.1,IBCNT,4)) SET(IBSRC,"  NONE",CNT,IBCNT) D:'IBSRC SET(IBSRC,"",CNT,IBCNT),REMARK^IBCECSA5 Q
"RTN","IBCECSA6",201,0)
 D SET(IBSRC," OUTPATIENT:",CNT,IBCNT)
"RTN","IBCECSA6",202,0)
 S IBRL=""
"RTN","IBCECSA6",203,0)
 I $S(IBFULL:1,1:$P(IBREC1,U)) S IB=$$SETSTR^VALM1("Reimburse Rate    : "_$$P10($P(IBREC1,U)),"",$S('IBRL:4,1:40),$S('IBRL:41,1:38)),IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA6",204,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,2)) S IB=$$SETSTR^VALM1("HCPCS Pay Amt     : "_$$A10($P(IBREC1,U,2)),IB,$S('IBRL:4,1:40),$S('IBRL:41,1:38)),IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA6",205,0)
 D:IBRL=0 SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",206,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,8)) S IB=$$SETSTR^VALM1("Esrd Paid Amt     : "_$$A10($P(IBREC1,U,8)),"",$S('IBRL:4,1:40),$S('IBRL:41,1:38)),IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA6",207,0)
 D:IBRL=0 SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",208,0)
 I $S(IBFULL:1,1:$P(IBREC1,U,9)) S IB=$$SETSTR^VALM1("Non-Pay Prof Comp : "_$$A10($P(IBREC1,U,9)),IB,$S('IBRL:4,1:40),$S('IBRL:41,1:38)),IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA6",209,0)
 D:IBRL'="" SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",210,0)
 D REMARK^IBCECSA5
"RTN","IBCECSA6",211,0)
 D SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",212,0)
 Q
"RTN","IBCECSA6",213,0)
 ;
"RTN","IBCECSA6",214,0)
CLVLA ;
"RTN","IBCECSA6",215,0)
 N IBREC,IBFLG,GR,RSN,Z,I
"RTN","IBCECSA6",216,0)
 S IB=$$SETSTR^VALM1("CLAIM LEVEL ADJUSTMENTS:","",1,50),IBSRC=$G(IBSRC)
"RTN","IBCECSA6",217,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",218,0)
 I 'IBSRC D
"RTN","IBCECSA6",219,0)
 . D CNTRL^VALM10(VALMCNT,1,24,IORVON,IORVOFF)
"RTN","IBCECSA6",220,0)
 . S ^TMP("IBCECSD",$J,"X",4)=VALMCNT
"RTN","IBCECSA6",221,0)
 S (Y,IBFLG)=0 F  S Y=$O(^IBM(361.1,IBCNT,10,Y)) Q:'Y  D
"RTN","IBCECSA6",222,0)
 . S IBREC=$G(^IBM(361.1,IBCNT,10,Y,0)),GR=$P(IBREC,U,1)
"RTN","IBCECSA6",223,0)
 . I GR="OA",$P($G(^IBM(361.1,IBCNT,10,Y,1,0)),U,4)=1,$D(^IBM(361.1,IBCNT,10,Y,1,"B","AB3")) Q   ; kludge
"RTN","IBCECSA6",224,0)
 . S IBREC=$$EXTERNAL^DILFD(361.11,.01,"",GR),IBFLG=1
"RTN","IBCECSA6",225,0)
 . D SET(IBSRC," GROUP CODE: "_IBREC,CNT,IBCNT)
"RTN","IBCECSA6",226,0)
 . S Z=0 F  S Z=$O(^IBM(361.1,IBCNT,10,Y,1,Z)) Q:'Z  D
"RTN","IBCECSA6",227,0)
 .. S IBREC=$G(^IBM(361.1,IBCNT,10,Y,1,Z,0)),RSN=$P(IBREC,U,1)
"RTN","IBCECSA6",228,0)
 .. I GR="OA",RSN="AB3" Q   ; kludge
"RTN","IBCECSA6",229,0)
 .. S IB=$$SETSTR^VALM1("REASON CODE: "_RSN_"  "_$P(IBREC,U,4),"",3,77)
"RTN","IBCECSA6",230,0)
 .. D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",231,0)
 .. S IB=$$SETSTR^VALM1("Amount: "_$$A10($P(IBREC,U,2)),"",3,40)
"RTN","IBCECSA6",232,0)
 .. S IB=$$SETSTR^VALM1("Quantity: "_$P(IBREC,U,3),IB,41,38)
"RTN","IBCECSA6",233,0)
 .. D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",234,0)
 D:IBSRC SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",235,0)
 I 'IBFLG D SET(IBSRC," NONE",CNT,IBCNT)
"RTN","IBCECSA6",236,0)
 Q
"RTN","IBCECSA6",237,0)
 ;
"RTN","IBCECSA6",238,0)
A10(X) ; returns a dollar amount right justified to 10 characters
"RTN","IBCECSA6",239,0)
 Q $$RJ^XLFSTR($FN(X,"",2),10," ")
"RTN","IBCECSA6",240,0)
 ;
"RTN","IBCECSA6",241,0)
P10(X) ; returns a % right just 10
"RTN","IBCECSA6",242,0)
 ; X is a decimal between 0-1
"RTN","IBCECSA6",243,0)
 Q $$RJ^XLFSTR((X*100)_"%",10," ")
"RTN","IBCECSA6",244,0)
 ;
"RTN","IBCECSA6",245,0)
PPR ;Display Payer Policy References
"RTN","IBCECSA6",246,0)
 ;
"RTN","IBCECSA6",247,0)
 N I,IBARR,IBX,IBX2,IBX3,IBPY,IBPCNT,IBDISP,IBTXT
"RTN","IBCECSA6",248,0)
 S IBX=0
"RTN","IBCECSA6",249,0)
 ;Get next Adjustment
"RTN","IBCECSA6",250,0)
 F  S IBX=$O(^IBM(361.1,IBCNT,15,IBX)) Q:'IBX  D
"RTN","IBCECSA6",251,0)
 .;Get next Line Level
"RTN","IBCECSA6",252,0)
 .S IBX2=0
"RTN","IBCECSA6",253,0)
 .F  S IBX2=$O(^IBM(361.1,IBCNT,15,IBX,1,IBX2)) Q:'IBX2  D
"RTN","IBCECSA6",254,0)
 ..;Get Adjustment line references (up to 5)
"RTN","IBCECSA6",255,0)
 ..S IBX3=0
"RTN","IBCECSA6",256,0)
 ..F  S IBX3=$O(^IBM(361.1,IBCNT,15,IBX,1,IBX2,2,IBX3)) Q:'IBX3  D
"RTN","IBCECSA6",257,0)
 ...S IBPY=$P($G(^IBM(361.1,IBCNT,15,IBX,1,IBX2,2,IBX3,0)),U) Q:IBPY=""
"RTN","IBCECSA6",258,0)
 ...S IBARR(IBPY)=""
"RTN","IBCECSA6",259,0)
 ;Concatenate Adjustment references
"RTN","IBCECSA6",260,0)
 S IBPY="",IBPCNT=0
"RTN","IBCECSA6",261,0)
 F  S IBPY=$O(IBARR(IBPY)) Q:IBPY=""  D  Q:IBPCNT=5
"RTN","IBCECSA6",262,0)
 .S IBPCNT=IBPCNT+1,$P(IBDISP,";",IBPCNT)=IBPY
"RTN","IBCECSA6",263,0)
 ;Format display
"RTN","IBCECSA6",264,0)
 Q:'IBPCNT
"RTN","IBCECSA6",265,0)
 S IB=$$SETSTR^VALM1("Policy Reference: Check Payer policies referenced on Payer website","",2,78)
"RTN","IBCECSA6",266,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",267,0)
 S IB=$$SETSTR^VALM1("for the following: "_$E(IBDISP,1,50),"",2,78)
"RTN","IBCECSA6",268,0)
 D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",269,0)
 F I=50:50:250 S IBTXT=$E(IBDISP,I+1,I+50) Q:IBTXT=""  D
"RTN","IBCECSA6",270,0)
 .S IB=$$SETSTR^VALM1($J("",19)_IBTXT,"",2,78)
"RTN","IBCECSA6",271,0)
 .D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",272,0)
 Q
"RTN","IBCECSA6",273,0)
 ;
"RTN","IBCECSA6",274,0)
AUDIT ;Display details of any EEOB MOVE/COPY
"RTN","IBCECSA6",275,0)
 ;
"RTN","IBCECSA6",276,0)
 N IEN101,FIRST101
"RTN","IBCECSA6",277,0)
 S IEN101=0,FIRST101=1
"RTN","IBCECSA6",278,0)
 F  S IEN101=$O(^IBM(361.1,IBCNT,101,IEN101)) Q:'IEN101  D
"RTN","IBCECSA6",279,0)
 .N IB101,IBDATE,IBUSER,IBJUST,IBJUST1,IBORIG,IBDIR
"RTN","IBCECSA6",280,0)
 .S IB101=$G(^IBM(361.1,IBCNT,101,IEN101,0)) Q:IB101=""
"RTN","IBCECSA6",281,0)
 .S IBDATE=$$EXTERNAL^DILFD(361.1101,.01,,$P(IB101,U,1))
"RTN","IBCECSA6",282,0)
 .S IBUSER=$$EXTERNAL^DILFD(361.1101,.02,,$P(IB101,U,2))
"RTN","IBCECSA6",283,0)
 .S IBJUST=$E($P(IB101,U,3),1,78),IBJUST1=$E($P(IB101,U,3),79,100)
"RTN","IBCECSA6",284,0)
 .S IBORIG=$$EXTERNAL^DILFD(361.1101,.04,,$P(IB101,U,4))
"RTN","IBCECSA6",285,0)
 .S IBDIR=$$EXTERNAL^DILFD(361.1101,.05,,$P(IB101,U,5)) ; kl - added MOVE/COPY field
"RTN","IBCECSA6",286,0)
 .S:IBDIR']"" IBDIR="Move"
"RTN","IBCECSA6",287,0)
 .I FIRST101 D
"RTN","IBCECSA6",288,0)
 ..S IB=$$SETSTR^VALM1("MOVE/COPY HISTORY","",1,78),FIRST101=0
"RTN","IBCECSA6",289,0)
 ..D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",290,0)
 .D SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",291,0)
 .S IB=$$SETSTR^VALM1("Date/Time of EEOB "_IBDIR_": "_IBDATE,"",1,78)  ;kl  8/23/11
"RTN","IBCECSA6",292,0)
 .D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",293,0)
 .S IB=$$SETSTR^VALM1(IBDIR_" of EEOB performed by: "_IBUSER,"",1,78)  ;kl 8/23/11
"RTN","IBCECSA6",294,0)
 .D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",295,0)
 .S IB=$$SETSTR^VALM1(IBDIR_" Justification Comments: ","",1,78)
"RTN","IBCECSA6",296,0)
 .D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",297,0)
 .S IB=$$SETSTR^VALM1(IBJUST,"",1,78)
"RTN","IBCECSA6",298,0)
 .D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",299,0)
 .I IBJUST1]"" D
"RTN","IBCECSA6",300,0)
 ..S IB=$$SETSTR^VALM1(IBJUST1,"",1,78)
"RTN","IBCECSA6",301,0)
 ..D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",302,0)
 .I IBORIG]"" D
"RTN","IBCECSA6",303,0)
 ..S IB=$$SETSTR^VALM1("Original Claim Number: "_IBORIG,"",1,78)
"RTN","IBCECSA6",304,0)
 ..D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",305,0)
 .;Other claim numbers
"RTN","IBCECSA6",306,0)
 .N SUB,IBOTH,OTEXT
"RTN","IBCECSA6",307,0)
 .S SUB=0,OTEXT=""
"RTN","IBCECSA6",308,0)
 .F  S SUB=$O(^IBM(361.1,IBCNT,101,IEN101,1,SUB)) Q:'SUB  D
"RTN","IBCECSA6",309,0)
 ..S IBOTH=$P($G(^IBM(361.1,IBCNT,101,IEN101,1,SUB,0)),U) Q:'IBOTH
"RTN","IBCECSA6",310,0)
 ..S IBOTH=$$EXTERNAL^DILFD(361.11016,.01,,IBOTH) Q:IBOTH=""
"RTN","IBCECSA6",311,0)
 ..S OTEXT=OTEXT_","_IBOTH
"RTN","IBCECSA6",312,0)
 .S OTEXT=$P(OTEXT,",",2,99)
"RTN","IBCECSA6",313,0)
 .I OTEXT]"" D
"RTN","IBCECSA6",314,0)
 ..S IB=$$SETSTR^VALM1("Other Claims: "_OTEXT,"",1,78)
"RTN","IBCECSA6",315,0)
 ..D SET(IBSRC,IB,CNT,IBCNT)
"RTN","IBCECSA6",316,0)
 .D SET(IBSRC,"",CNT,IBCNT)
"RTN","IBCECSA6",317,0)
 Q
"RTN","IBCEOB4")
0^17^B17512247^n/a
"RTN","IBCEOB4",1,0)
IBCEOB4 ;ALB/PJH - EPAYMENTS MOVE/COPY EEOB TO NEW CLAIM ;9/15/11 6:39pm
"RTN","IBCEOB4",2,0)
 ;;2.0;INTEGRATED BILLING;**451**;21-MAR-1994;Build 47
"RTN","IBCEOB4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCEOB4",4,0)
 ;
"RTN","IBCEOB4",5,0)
 ;Entry point for EEOB Move
"RTN","IBCEOB4",6,0)
MOVE(EOBIEN,IBIFN,DUZ,MDATE,JCOM,EVENT) ;
"RTN","IBCEOB4",7,0)
 ;
"RTN","IBCEOB4",8,0)
 N DA,DIC,DIE,DR,IEN101,OBILL,X,Y
"RTN","IBCEOB4",9,0)
 S OBILL=$$EXTERNAL^DILFD(361.1,.01,,$P($G(^IBM(361.1,EOBIEN,0)),U))
"RTN","IBCEOB4",10,0)
 ;
"RTN","IBCEOB4",11,0)
 ;Create new MOVE/COPY HISTORY stub
"RTN","IBCEOB4",12,0)
 S DA(1)=EOBIEN
"RTN","IBCEOB4",13,0)
 S DIC="^IBM(361.1,"_DA(1)_",101,",DIC(0)="L",X=MDATE
"RTN","IBCEOB4",14,0)
 D FILE^DICN
"RTN","IBCEOB4",15,0)
 S IEN101=+Y Q:'IEN101
"RTN","IBCEOB4",16,0)
 ;
"RTN","IBCEOB4",17,0)
 ;Update detail on MOVE/COPY HISTORY
"RTN","IBCEOB4",18,0)
 N DIE,DA,DR,X,Y
"RTN","IBCEOB4",19,0)
 S DIE="^IBM(361.1,"_EOBIEN_",101,",DA=IEN101
"RTN","IBCEOB4",20,0)
 ;Update User, Date/Time, Comments,Move/Copy event
"RTN","IBCEOB4",21,0)
 S DR=".02///"_DUZ_";.03///"_JCOM_";.05///"_EVENT
"RTN","IBCEOB4",22,0)
 ;Update original bill number
"RTN","IBCEOB4",23,0)
 S DR=DR_";.04///"_OBILL
"RTN","IBCEOB4",24,0)
 D ^DIE
"RTN","IBCEOB4",25,0)
 ;
"RTN","IBCEOB4",26,0)
 ;Update bill number on EOB
"RTN","IBCEOB4",27,0)
 N DIE,DA,DR,X,Y
"RTN","IBCEOB4",28,0)
 S DIE="^IBM(361.1,",DA=EOBIEN,DR=".01///"_IBIFN
"RTN","IBCEOB4",29,0)
 D ^DIE
"RTN","IBCEOB4",30,0)
 ;
"RTN","IBCEOB4",31,0)
 ;Update any AR AMOUNTS DISTRIBUTION (split/edit detail)
"RTN","IBCEOB4",32,0)
 D FUNCTION(EOBIEN,OBILL,IBIFN)
"RTN","IBCEOB4",33,0)
 ;
"RTN","IBCEOB4",34,0)
 Q
"RTN","IBCEOB4",35,0)
 ;
"RTN","IBCEOB4",36,0)
 ;Entry point for EEOB Copy
"RTN","IBCEOB4",37,0)
COPY(EOBIEN,IBIFN,DUZ,MDATE,JCOM,EVENT) ;
"RTN","IBCEOB4",38,0)
 ;
"RTN","IBCEOB4",39,0)
 N IEN,OBILL,NEWEOB
"RTN","IBCEOB4",40,0)
 ;
"RTN","IBCEOB4",41,0)
 ;Original Claim number
"RTN","IBCEOB4",42,0)
 S OBILL=$$EXTERNAL^DILFD(361.1,.01,,$P($G(^IBM(361.1,EOBIEN,0)),U))
"RTN","IBCEOB4",43,0)
 ;
"RTN","IBCEOB4",44,0)
 ;Lock zero node before making inserts
"RTN","IBCEOB4",45,0)
 Q:'$$LOCK(0)
"RTN","IBCEOB4",46,0)
 ;
"RTN","IBCEOB4",47,0)
 ;Scan through list of new claims
"RTN","IBCEOB4",48,0)
 S IEN=0
"RTN","IBCEOB4",49,0)
 F  S IEN=$O(IBIFN(IEN)) Q:'IEN  D
"RTN","IBCEOB4",50,0)
 .;Create stub
"RTN","IBCEOB4",51,0)
 .N DIC,DLAYGO,X
"RTN","IBCEOB4",52,0)
 .S DIC(0)="L",DIC="^IBM(361.1,",DLAYGO=361.1
"RTN","IBCEOB4",53,0)
 .;Use 399 ien as .01 field
"RTN","IBCEOB4",54,0)
 .S X=IEN
"RTN","IBCEOB4",55,0)
 .D FILE^DICN
"RTN","IBCEOB4",56,0)
 .S NEWEOB=+Y Q:'NEWEOB
"RTN","IBCEOB4",57,0)
 .;Lock the new entry
"RTN","IBCEOB4",58,0)
 .Q:'$$LOCK(NEWEOB)
"RTN","IBCEOB4",59,0)
 .;Copy details to new EOB (except for audit information)
"RTN","IBCEOB4",60,0)
 .N ARRAY
"RTN","IBCEOB4",61,0)
 .M ARRAY=^IBM(361.1,EOBIEN) K ARRAY(101)
"RTN","IBCEOB4",62,0)
 .M ^IBM(361.1,NEWEOB)=ARRAY
"RTN","IBCEOB4",63,0)
 .;Re-index new EOB
"RTN","IBCEOB4",64,0)
 .N DIK,DA S DIK="^IBM(361.1,",DA=NEWEOB D IX^DIK
"RTN","IBCEOB4",65,0)
 .;Update .01 field in new EOB
"RTN","IBCEOB4",66,0)
 .N DA,DIE,DR,X,Y
"RTN","IBCEOB4",67,0)
 .S DIE="^IBM(361.1,",DA=NEWEOB
"RTN","IBCEOB4",68,0)
 .S DR=".01////"_IBIFN(IEN)
"RTN","IBCEOB4",69,0)
 .D ^DIE
"RTN","IBCEOB4",70,0)
 .;Update any AR AMOUNTS DISTRIBUTION (split/edit detail)
"RTN","IBCEOB4",71,0)
 .D FUNCTION(NEWEOB,OBILL,IBIFN(IEN))
"RTN","IBCEOB4",72,0)
 .;
"RTN","IBCEOB4",73,0)
 .;Create stub for audit information
"RTN","IBCEOB4",74,0)
 .N DA,DIC,IEN101,X,Y
"RTN","IBCEOB4",75,0)
 .S DA(1)=NEWEOB
"RTN","IBCEOB4",76,0)
 .S DIC="^IBM(361.1,"_DA(1)_",101,",DIC(0)="L",X=MDATE
"RTN","IBCEOB4",77,0)
 .D FILE^DICN
"RTN","IBCEOB4",78,0)
 .S IEN101=+Y Q:'IEN101
"RTN","IBCEOB4",79,0)
 .;
"RTN","IBCEOB4",80,0)
 .;Update detail on MOVE/COPY HISTORY
"RTN","IBCEOB4",81,0)
 .N DA,DIE,DR,X,Y
"RTN","IBCEOB4",82,0)
 .S DIE="^IBM(361.1,"_NEWEOB_",101,",DA=IEN101
"RTN","IBCEOB4",83,0)
 .;Update User, Date/Time, Comments,Event
"RTN","IBCEOB4",84,0)
 .S DR=".02///"_DUZ_";.03///"_JCOM_";.05///"_EVENT
"RTN","IBCEOB4",85,0)
 .S DR=DR_";.04///"_OBILL
"RTN","IBCEOB4",86,0)
 .D ^DIE
"RTN","IBCEOB4",87,0)
 .;
"RTN","IBCEOB4",88,0)
 .;Insert Other claim numbers
"RTN","IBCEOB4",89,0)
 .N DIC,IEN1,X,Y
"RTN","IBCEOB4",90,0)
 .S IEN1=""
"RTN","IBCEOB4",91,0)
 .F  S IEN1=$O(IBIFN(IEN1)) Q:'IEN1  D
"RTN","IBCEOB4",92,0)
 ..;current claim excluded
"RTN","IBCEOB4",93,0)
 ..Q:IEN1=IEN
"RTN","IBCEOB4",94,0)
 ..N DA,DIC,DLAYGO,DR,X
"RTN","IBCEOB4",95,0)
 ..S DA(1)=IEN101,DA(2)=NEWEOB
"RTN","IBCEOB4",96,0)
 ..S DIC="^IBM(361.1,"_DA(2)_",101,"_DA(1)_",1,"
"RTN","IBCEOB4",97,0)
 ..S DIC(0)="L",X=IBIFN(IEN1)
"RTN","IBCEOB4",98,0)
 ..D FILE^DICN
"RTN","IBCEOB4",99,0)
 .;Unlock new entry
"RTN","IBCEOB4",100,0)
 .D UNLOCK(NEWEOB)
"RTN","IBCEOB4",101,0)
 ;
"RTN","IBCEOB4",102,0)
 ;Update original EOB audit information
"RTN","IBCEOB4",103,0)
 N DA,DIC,IEN101,X,Y
"RTN","IBCEOB4",104,0)
 S DA(1)=EOBIEN
"RTN","IBCEOB4",105,0)
 S DIC="^IBM(361.1,"_DA(1)_",101,",DIC(0)="L",X=MDATE
"RTN","IBCEOB4",106,0)
 D FILE^DICN
"RTN","IBCEOB4",107,0)
 S IEN101=+Y Q:'IEN101
"RTN","IBCEOB4",108,0)
 ;
"RTN","IBCEOB4",109,0)
 ;Update User, Date/Time, Comments,Event
"RTN","IBCEOB4",110,0)
 N DA,DIE,DR
"RTN","IBCEOB4",111,0)
 S DIE="^IBM(361.1,"_EOBIEN_",101,",DA=IEN101
"RTN","IBCEOB4",112,0)
 S DR=".02///"_DUZ_";.03///"_JCOM_";.05///"_EVENT
"RTN","IBCEOB4",113,0)
 D ^DIE
"RTN","IBCEOB4",114,0)
 ;
"RTN","IBCEOB4",115,0)
 ;Insert Other claim numbers
"RTN","IBCEOB4",116,0)
 N DIC,IEN1,X,Y
"RTN","IBCEOB4",117,0)
 S IEN1=""
"RTN","IBCEOB4",118,0)
 F  S IEN1=$O(IBIFN(IEN1)) Q:'IEN1  D
"RTN","IBCEOB4",119,0)
 .N DA,DIC,DLAYGO,DR,X
"RTN","IBCEOB4",120,0)
 .S DA(1)=IEN101,DA(2)=EOBIEN
"RTN","IBCEOB4",121,0)
 .S DIC="^IBM(361.1,"_DA(2)_",101,"_DA(1)_",1,"
"RTN","IBCEOB4",122,0)
 .S DIC(0)="L",X=IBIFN(IEN1)
"RTN","IBCEOB4",123,0)
 .D FILE^DICN
"RTN","IBCEOB4",124,0)
 ;
"RTN","IBCEOB4",125,0)
 ;Release zero node after inserts
"RTN","IBCEOB4",126,0)
 D UNLOCK(0)
"RTN","IBCEOB4",127,0)
 Q
"RTN","IBCEOB4",128,0)
 ;
"RTN","IBCEOB4",129,0)
 ;Update Split/Edit history for EOB
"RTN","IBCEOB4",130,0)
FUNCTION(EOBIEN,ONAME,NEWIEN) ;
"RTN","IBCEOB4",131,0)
 N SUB
"RTN","IBCEOB4",132,0)
 ;Check for split/edit history for original claim
"RTN","IBCEOB4",133,0)
 S SUB=$O(^IBM(361.1,EOBIEN,8,"B",ONAME,"")) Q:'SUB
"RTN","IBCEOB4",134,0)
 ;New bill name
"RTN","IBCEOB4",135,0)
 S NEWNAME=$P($G(^DGCR(399,NEWIEN,0)),U)
"RTN","IBCEOB4",136,0)
 ;Update bill number in Split/Edit history
"RTN","IBCEOB4",137,0)
 N DA,DIE,DR,X,Y
"RTN","IBCEOB4",138,0)
 S DA(1)=EOBIEN,DIE="^IBM(361.1,"_DA(1)_",8,",DA=SUB
"RTN","IBCEOB4",139,0)
 S DR=".01///"_NEWNAME_";.03///"_NEWNAME
"RTN","IBCEOB4",140,0)
 D ^DIE
"RTN","IBCEOB4",141,0)
 Q
"RTN","IBCEOB4",142,0)
 ;
"RTN","IBCEOB4",143,0)
LOCK(EOBIEN) ;Lock Original EOB
"RTN","IBCEOB4",144,0)
 L +^IBM(361.1,EOBIEN):5 I  Q 1
"RTN","IBCEOB4",145,0)
 W !,"EOB in use by another user, try later"
"RTN","IBCEOB4",146,0)
 Q 0
"RTN","IBCEOB4",147,0)
 ;
"RTN","IBCEOB4",148,0)
UNLOCK(EOBIEN) ;Release EOB
"RTN","IBCEOB4",149,0)
 L -^IBM(361.1,EOBIEN)
"RTN","IBCEOB4",150,0)
 Q
"RTN","IBJDF11")
0^13^B27610057^B25856262
"RTN","IBJDF11",1,0)
IBJDF11 ;ALB/CPM - THIRD PARTY FOLLOW-UP REPORT (COMPILE) ;09-JAN-97
"RTN","IBJDF11",2,0)
 ;;2.0;INTEGRATED BILLING;**69,80,118,128,204,205,227,451**;21-MAR-94;Build 47
"RTN","IBJDF11",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJDF11",4,0)
 ;
"RTN","IBJDF11",5,0)
DQ ; - Tasked entry point.
"RTN","IBJDF11",6,0)
 K ^TMP("IBJDF1",$J) S IBQ=0
"RTN","IBJDF11",7,0)
 ;
"RTN","IBJDF11",8,0)
 ; - Collect divisions when running the job for all divisions.
"RTN","IBJDF11",9,0)
 I IBSD,VAUTD S J=0 F  S J=$O(^DG(40.8,J)) Q:'J  S VAUTD(J)=""
"RTN","IBJDF11",10,0)
 ;
"RTN","IBJDF11",11,0)
 ; - Find data required for the report.
"RTN","IBJDF11",12,0)
 S IBA=0 F  S IBA=$O(^PRCA(430,"AC",16,IBA)) Q:'IBA  D  Q:IBQ
"RTN","IBJDF11",13,0)
 .;
"RTN","IBJDF11",14,0)
 .I IBA#100=0 S IBQ=$$STOP^IBOUTL("Third Party Follow-Up Report") Q:IBQ
"RTN","IBJDF11",15,0)
 .;
"RTN","IBJDF11",16,0)
 .S IBAR=$G(^PRCA(430,IBA,0))
"RTN","IBJDF11",17,0)
 .I $P(IBAR,U,2)'=9 Q  ;       Not an RI bill.
"RTN","IBJDF11",18,0)
 .I '$D(^DGCR(399,IBA,0)) Q  ; No corresponding claim to this AR.
"RTN","IBJDF11",19,0)
 .;
"RTN","IBJDF11",20,0)
 .; - Determine whether bill is inpatient, outpatient, or RX refill.
"RTN","IBJDF11",21,0)
 .S IBTYP=$P($G(^DGCR(399,IBA,0)),U,5),IBTYP=$S(IBTYP>2:2,1:1)
"RTN","IBJDF11",22,0)
 .S:$D(^IBA(362.4,"C",IBA)) IBTYP=3 I IBSEL'[IBTYP,IBSEL'[4 Q
"RTN","IBJDF11",23,0)
 .;
"RTN","IBJDF11",24,0)
 .; - Check the receivable age, if necessary.
"RTN","IBJDF11",25,0)
 .I IBSMN S:"Aa"[IBSDATE IBARD=$$ACT^IBJDF2(IBA) S:"Dd"[IBSDATE IBARD=$$DATE1^IBJDF2(IBA) Q:'IBARD  S:IBARD IBARD=$$FMDIFF^XLFDT(DT,IBARD) I IBARD<IBSMN!(IBARD>IBSMX) Q
"RTN","IBJDF11",26,0)
 .;
"RTN","IBJDF11",27,0)
 .; - Check the minimum dollar amount, if necessary.
"RTN","IBJDF11",28,0)
 .S IBWBA=+$G(^PRCA(430,IBA,7)) I IBSAM,IBWBA<IBSAM Q
"RTN","IBJDF11",29,0)
 .;
"RTN","IBJDF11",30,0)
 .; - Get division, if necessary.
"RTN","IBJDF11",31,0)
 .I 'IBSD S IBDIV=0
"RTN","IBJDF11",32,0)
 .E  S IBDIV=$$DIV^IBJDF2(IBA) I 'IBDIV S IBDIV=+$$PRIM^VASITE()
"RTN","IBJDF11",33,0)
 .I IBSD,'VAUTD Q:'$D(VAUTD(IBDIV))  ;  Not a selected division.
"RTN","IBJDF11",34,0)
 .;
"RTN","IBJDF11",35,0)
 .; - Exclude receivables referred to Regional Counsel, if necessary.
"RTN","IBJDF11",36,0)
 .S IBWRC=$G(^PRCA(430,IBA,6)) I 'IBSRC,$P(IBWRC,U,4) Q
"RTN","IBJDF11",37,0)
 .S IBWRC=$S('$P(IBWRC,U,4):"",$P(IBWRC,U,22):$P(IBWRC,U,22),1:$P(IBWRC,U,4))
"RTN","IBJDF11",38,0)
 .;
"RTN","IBJDF11",39,0)
 .; - Get the insurance carrier and exclude claim, if necessary.
"RTN","IBJDF11",40,0)
 .S IBWIN=$$INS(IBA) I IBWIN="" Q
"RTN","IBJDF11",41,0)
 .;
"RTN","IBJDF11",42,0)
 .; - Get the claim patient and exclude claim, if necessary.
"RTN","IBJDF11",43,0)
 .S IBWPT=$$PAT(IBA) I IBWPT="" Q
"RTN","IBJDF11",44,0)
 .;
"RTN","IBJDF11",45,0)
 .; - Get remaining claim information.
"RTN","IBJDF11",46,0)
 .; IB*2.0*451 - get 1st/3rd party payment EEOB indicator for bill
"RTN","IBJDF11",47,0)
 .S IBPFLAG=$$EEOB^IBOA31(IBA)
"RTN","IBJDF11",48,0)
 .S IBWDP=$P(IBAR,U,10),IBWBN=$G(IBPFLAG)_$P(IBAR,U) ; flag bill # when applicable
"RTN","IBJDF11",49,0)
 .S IBBU=$G(^DGCR(399,IBA,"U")),IBWFR=+IBBU,IBWTO=$P(IBBU,U,2)
"RTN","IBJDF11",50,0)
 .S IBWSC=$$OTH($P(IBWPT,U,5),$P(IBWIN,"@@",2),IBWFR),IBWOR=$P(IBAR,U,3)
"RTN","IBJDF11",51,0)
 .S IBWSI=$P($G(^DPT(+$P(IBWPT,U,5),.312,+$P($G(^DGCR(399,IBA,"MP")),U,2),0)),U,2)
"RTN","IBJDF11",52,0)
 .;
"RTN","IBJDF11",53,0)
 .; - Set up main report index.
"RTN","IBJDF11",54,0)
 .F X=IBTYP,4 I IBSEL[X D
"RTN","IBJDF11",55,0)
 ..S ^TMP("IBJDF1",$J,IBDIV,X,IBWIN,$P(IBWPT,U)_"@@"_$P(IBWPT,U,5),IBWDP_"@@"_IBWBN)=$P(IBWPT,U,2)_" ("_$P(IBWPT,U,4)_")"_U_$P(IBWPT,U,3)_U_IBWSC_U_IBWFR_U_IBWTO_U_IBWOR_U_IBWBA_"~"_IBWRC_U_IBWSI
"RTN","IBJDF11",56,0)
 .;
"RTN","IBJDF11",57,0)
 .; - Add bill comment history, if necessary.
"RTN","IBJDF11",58,0)
 .I IBSH D
"RTN","IBJDF11",59,0)
 ..S X=0 F  S X=$O(^PRCA(433,"C",IBA,X)) Q:'X  D
"RTN","IBJDF11",60,0)
 ...S Y=$G(^PRCA(433,X,1))
"RTN","IBJDF11",61,0)
 ...I $P(Y,U,2)'=35,$P(Y,U,2)'=45 Q  ; Not a decrease/comment transact.
"RTN","IBJDF11",62,0)
 ...S DAT=$S(Y:+Y\1,1:+$P(Y,U,9)\1)
"RTN","IBJDF11",63,0)
 ...;
"RTN","IBJDF11",64,0)
 ...; - Append brief and transaction comments.
"RTN","IBJDF11",65,0)
 ...K COM,COM1 S COM(0)=DAT,X1=0
"RTN","IBJDF11",66,0)
 ...S COM1(1)=$P($G(^PRCA(433,X,5)),U,2),COM1(2)=$E($P($G(^(8)),U,6),1,70)
"RTN","IBJDF11",67,0)
 ...S COM(1)=COM1(1)_$S(COM1(1)]""&(COM1(2)]""):"|",1:"")_COM1(2)
"RTN","IBJDF11",68,0)
 ...I COM(1)]"" S COM(1)="**"_COM(1)_"**",X1=1
"RTN","IBJDF11",69,0)
 ...;
"RTN","IBJDF11",70,0)
 ...; - Get main comments.
"RTN","IBJDF11",71,0)
 ...S X2=0 F  S X2=$O(^PRCA(433,X,7,X2)) Q:'X2  S COM($S(X1:X2+1,1:X2))=^(X2,0)
"RTN","IBJDF11",72,0)
 ...;
"RTN","IBJDF11",73,0)
 ...S X1="" F  S X1=$O(COM(X1)) Q:X1=""  F X2=IBTYP,4 I IBSEL[X2 D
"RTN","IBJDF11",74,0)
 ....S ^TMP("IBJDF1",$J,IBDIV,X2,IBWIN,$P(IBWPT,U)_"@@"_$P(IBWPT,U,5),IBWDP_"@@"_IBWBN,X,X1)=COM(X1)
"RTN","IBJDF11",75,0)
 ;
"RTN","IBJDF11",76,0)
 I 'IBQ D EN^IBJDF12 ; Print the report.
"RTN","IBJDF11",77,0)
 ;
"RTN","IBJDF11",78,0)
ENQ K ^TMP("IBJDF1",$J)
"RTN","IBJDF11",79,0)
 I $D(ZTQUEUED) S ZTREQ="@" G ENQ1
"RTN","IBJDF11",80,0)
 ;
"RTN","IBJDF11",81,0)
 D ^%ZISC
"RTN","IBJDF11",82,0)
ENQ1 K IBA,IBAR,IBARD,IBBU,IBDIV,IBQ,IBIO,IBWRC,IBWPT,IBWDP,IBWIN,IBWBN
"RTN","IBJDF11",83,0)
 K IBTYP,IBWSC,IBWSI,IBWFR,IBWTO,IBWOR,IBWBA,COM,COM1,DAT,VAUTD
"RTN","IBJDF11",84,0)
 K X,X1,X2,Y,Z
"RTN","IBJDF11",85,0)
 Q
"RTN","IBJDF11",86,0)
 ;
"RTN","IBJDF11",87,0)
INS(X) ; - Find the Insurance company and decide to include the claim.
"RTN","IBJDF11",88,0)
 ;  Input: X=Pointer to the claim/AR in file #399/#430
"RTN","IBJDF11",89,0)
 ;           plus all variable input in IBS*
"RTN","IBJDF11",90,0)
 ; Output: Y=Insurance Company name and pointer to file #36
"RTN","IBJDF11",91,0)
 ;
"RTN","IBJDF11",92,0)
 N Y,Z,Z1 S Y=""
"RTN","IBJDF11",93,0)
 I '$G(X) G INSQ
"RTN","IBJDF11",94,0)
 S Z=+$G(^DGCR(399,X,"MP")),Z1=$P($G(^DIC(36,Z,0)),U)
"RTN","IBJDF11",95,0)
 I $G(IBSI) G INSQ:'$D(IBSI(Z)),INSC
"RTN","IBJDF11",96,0)
 I IBSIF'="@",'Z G INSQ
"RTN","IBJDF11",97,0)
 I $D(IBSIA) G:IBSIA="ALL"&('Z) INSQ G:IBSIA="NULL"&(Z) INSQ
"RTN","IBJDF11",98,0)
 I Z1="" S Z1="UNKNOWN" G INSC
"RTN","IBJDF11",99,0)
 I $G(IBSIA)="ALL" G INSC
"RTN","IBJDF11",100,0)
 I IBSIF="@",IBSIL="zzzzz" G INSC
"RTN","IBJDF11",101,0)
 I IBSIF]Z1!(Z1]IBSIL) G INSQ
"RTN","IBJDF11",102,0)
 ;
"RTN","IBJDF11",103,0)
INSC S Y=Z1_"@@"_Z
"RTN","IBJDF11",104,0)
INSQ Q Y
"RTN","IBJDF11",105,0)
 ;
"RTN","IBJDF11",106,0)
PAT(X) ; - Find the claim patient and decide to include the claim.
"RTN","IBJDF11",107,0)
 ;  Input: X=Pointer to the claim/AR in file #399/#430
"RTN","IBJDF11",108,0)
 ;           plus all variable input in IBS*
"RTN","IBJDF11",109,0)
 ; Output: Y=1^2^3^4^5, where
"RTN","IBJDF11",110,0)
 ;           1 => sort key (name or last four)
"RTN","IBJDF11",111,0)
 ;           2 => patient name
"RTN","IBJDF11",112,0)
 ;           3 => patient ssn
"RTN","IBJDF11",113,0)
 ;           4 => patient age
"RTN","IBJDF11",114,0)
 ;           5 => patient pointer to file #2
"RTN","IBJDF11",115,0)
 ;
"RTN","IBJDF11",116,0)
 N AGE,DFN,DOB,KEY,Y,Z S Y=""
"RTN","IBJDF11",117,0)
 I '$G(X) G PATQ
"RTN","IBJDF11",118,0)
 S DFN=+$P($G(^DGCR(399,X,0)),U,2),Z=$G(^DPT(DFN,0))
"RTN","IBJDF11",119,0)
 S KEY=$S(IBSN="N":$P(Z,U),1:$E($P(Z,U,9),6,9))
"RTN","IBJDF11",120,0)
 ;
"RTN","IBJDF11",121,0)
 I IBSNF'="@",'DFN G PATQ
"RTN","IBJDF11",122,0)
 I $D(IBSNA) G:IBSNA="ALL"&('DFN) PATQ G:IBSNA="NULL"&(DFN) PATQ
"RTN","IBJDF11",123,0)
 I KEY="" S Y="UNK^UNK^UNK^UNK^UNK" G PATQ
"RTN","IBJDF11",124,0)
 I $G(IBSNA)="ALL" G PATC
"RTN","IBJDF11",125,0)
 I IBSNF="@",IBSNL="zzzzz" G PATC
"RTN","IBJDF11",126,0)
 I IBSNF]KEY!(KEY]IBSNL) G PATQ
"RTN","IBJDF11",127,0)
 ;
"RTN","IBJDF11",128,0)
PATC ; - Find all patient data.
"RTN","IBJDF11",129,0)
 S DOB=$P(Z,U,3)
"RTN","IBJDF11",130,0)
 S AGE=$S('DOB:"UNK",1:$E(DT,1,3)-$E(DOB,1,3)-($E(DT,4,7)<$E(DOB,4,7)))
"RTN","IBJDF11",131,0)
 S Y=KEY_U_$E($P(Z,U),1,17)_U_$P(Z,U,9)_U_AGE_U_DFN
"RTN","IBJDF11",132,0)
PATQ Q Y
"RTN","IBJDF11",133,0)
 ;
"RTN","IBJDF11",134,0)
OTH(DFN,INS,DS) ; - Find a patient's other valid insurance carrier (if any).
"RTN","IBJDF11",135,0)
 ;  Input: DFN=Pointer to the patient in file #2
"RTN","IBJDF11",136,0)
 ;         INS=Pointer to the patient's primary carrier in file #36
"RTN","IBJDF11",137,0)
 ;          DS=Date of service for validity check
"RTN","IBJDF11",138,0)
 ; Output: Valid insurance carrier (1st 13 chars.) or null
"RTN","IBJDF11",139,0)
 ;
"RTN","IBJDF11",140,0)
 N Y S Y="" I '$G(DFN)!('$G(DS)) G OTHQ
"RTN","IBJDF11",141,0)
 S Z=0 F  S Z=$O(^DPT(DFN,.312,Z)) Q:'Z  S X=$G(^(Z,0)) D:X  Q:Y]""
"RTN","IBJDF11",142,0)
 .I $G(INS),+X=INS Q
"RTN","IBJDF11",143,0)
 .S X1=$G(^DIC(36,+X,0)) I X1="" Q
"RTN","IBJDF11",144,0)
 .I $P(X1,U,2)'="N",$$CHK^IBCNS1(X,DS) S Y=$E($P(X1,U),1,13)
"RTN","IBJDF11",145,0)
 ;
"RTN","IBJDF11",146,0)
OTHQ Q Y
"RTN","IBJDF41")
0^3^B92006724^B65120113
"RTN","IBJDF41",1,0)
IBJDF41 ;ALB/RB - FIRST PARTY FOLLOW-UP REPORT (COMPILE) ;15-APR-00
"RTN","IBJDF41",2,0)
 ;;2.0;INTEGRATED BILLING;**123,159,204,356,451**;21-MAR-94;Build 47
"RTN","IBJDF41",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJDF41",4,0)
 ;
"RTN","IBJDF41",5,0)
ST ; - Tasked entry point.
"RTN","IBJDF41",6,0)
 K IB,IBCAT,^TMP("IBJDF4",$J)
"RTN","IBJDF41",7,0)
 S IBQ=0
"RTN","IBJDF41",8,0)
 ;
"RTN","IBJDF41",9,0)
 ; - Set selected categories for report.
"RTN","IBJDF41",10,0)
 I IBSEL[1 S IBCAT(2)=1
"RTN","IBJDF41",11,0)
 I IBSEL[2 S IBCAT(1)=2
"RTN","IBJDF41",12,0)
 I IBSEL[3 S IBCAT(18)=3 F X=22,23 S IBCAT(X)=4
"RTN","IBJDF41",13,0)
 I IBSEL[4 F X=33:1:39 S IBCAT(X)=5
"RTN","IBJDF41",14,0)
 ;
"RTN","IBJDF41",15,0)
 ; - Print the header line for the Excel spreadsheet
"RTN","IBJDF41",16,0)
 I $G(IBEXCEL) D PHDL
"RTN","IBJDF41",17,0)
 ;
"RTN","IBJDF41",18,0)
 ; - Find data required for report.
"RTN","IBJDF41",19,0)
 F IB=16,19,40 D  G:IBQ ENQ
"RTN","IBJDF41",20,0)
 . I IBSTA="A",IB'=16 Q  ;      Active AR's only.
"RTN","IBJDF41",21,0)
 . I IBSTA="S",IB=16 Q   ;      Suspended AR's only.
"RTN","IBJDF41",22,0)
 . I IB'=40 D 
"RTN","IBJDF41",23,0)
 . . S IBCAT=""
"RTN","IBJDF41",24,0)
 . . F  S IBCAT=$O(IBCAT(IBCAT)) Q:IBCAT=""  D
"RTN","IBJDF41",25,0)
 . . . D INIT^IBJDF43
"RTN","IBJDF41",26,0)
 . S IBA=0
"RTN","IBJDF41",27,0)
 . F  S IBA=$O(^PRCA(430,"AC",IB,IBA)) Q:'IBA  D  Q:IBQ
"RTN","IBJDF41",28,0)
 . . D PROC
"RTN","IBJDF41",29,0)
 ;
"RTN","IBJDF41",30,0)
 I 'IBQ,'$G(IBEXCEL) D EN^IBJDF42 ; Print the report.
"RTN","IBJDF41",31,0)
 ;
"RTN","IBJDF41",32,0)
ENQ K ^TMP("IBJDF4",$J)
"RTN","IBJDF41",33,0)
 I $D(ZTQUEUED) S ZTREQ="@" G ENQ1
"RTN","IBJDF41",34,0)
 ;
"RTN","IBJDF41",35,0)
 D ^%ZISC
"RTN","IBJDF41",36,0)
ENQ1 K IB,IB0,IBA,IBA1,IBADM,IBAGE,IBAR,IBAR1,IBBA,IBBN,IBBU,IBC,IBCAT,IBCAT1
"RTN","IBJDF41",37,0)
 K IBELIG,IBEXCEL,IBFLG,IBAI,IBAIQ,IBIDX,IBIO,IBINT,IBN,IBPA,IBPD,IBPAT
"RTN","IBJDF41",38,0)
 K IBPT,IBQ,IBRFD,IBRFT,IBSRC,IBRP,IBVA,COM,COM1,DAT,DFN,X,X1,X2,Y,Z
"RTN","IBJDF41",39,0)
 Q
"RTN","IBJDF41",40,0)
 ;
"RTN","IBJDF41",41,0)
PROC ; - Process data for report(s).
"RTN","IBJDF41",42,0)
 I IBA#100=0 D  Q:IBQ
"RTN","IBJDF41",43,0)
 . S IBQ=$$STOP^IBOUTL("First Party Follow-Up Report")
"RTN","IBJDF41",44,0)
 S IBAR=$G(^PRCA(430,IBA,0)) I 'IBAR Q
"RTN","IBJDF41",45,0)
 S IBCAT=+$P(IBAR,U,2) I '$D(IBCAT(IBCAT)) Q   ;Get valid AR category.
"RTN","IBJDF41",46,0)
 I '$$CLMACT^IBJD(IBA,IBCAT) Q  ;               Invalid IB claim/action.
"RTN","IBJDF41",47,0)
 S IBPT=$$PAT(IBA) I IBPT="" Q  ;               Get patient info.
"RTN","IBJDF41",48,0)
 S DFN=$P(IBPT,U,2)
"RTN","IBJDF41",49,0)
 S IBAGE=$$FMDIFF^XLFDT(DT,+$P(IBAR,U,10))
"RTN","IBJDF41",50,0)
 I IBSMN,IBAGE<IBSMN!(IBAGE>IBSMX) Q  ;         AR outside age range.
"RTN","IBJDF41",51,0)
 S IBVA=$$VA^IBJD1(DFN),IBBN=$P(IBAR,U),IBPD=$P($$PYMT^IBJD1(IBA),U)
"RTN","IBJDF41",52,0)
 S IBPAT=$P(IBPT,U)_"@@"_DFN
"RTN","IBJDF41",53,0)
 ;
"RTN","IBJDF41",54,0)
 ; - Check the AR balance amounts, if necessary.
"RTN","IBJDF41",55,0)
 S (IBADM,IBBA,IBINT,IBPA)=0,IBN=$G(^PRCA(430,IBA,7))
"RTN","IBJDF41",56,0)
 F X=1:1:5 D
"RTN","IBJDF41",57,0)
 . S IBBA=IBBA+$P(IBN,U,X)
"RTN","IBJDF41",58,0)
 . S:X=1 IBPA=+IBN S:X=2 IBINT=$P(IBN,U,2) S:X=3 IBADM=$P(IBN,U,3)
"RTN","IBJDF41",59,0)
 ;
"RTN","IBJDF41",60,0)
 I '$G(IBEXCEL) D EN^IBJDF43 I IBRPT="S" Q  ;   Get summary stats.
"RTN","IBJDF41",61,0)
 ;
"RTN","IBJDF41",62,0)
 I IBSAM,IBBA<IBSAM Q
"RTN","IBJDF41",63,0)
 ;
"RTN","IBJDF41",64,0)
 ; - Check if AR was referred to R-Regional Counsel, D-DMC, or T-TOP
"RTN","IBJDF41",65,0)
 ;   and exclude, if necessary.
"RTN","IBJDF41",66,0)
 S IB0=$S(IB=40:19,1:IB),IBIDX=0,IBRFT=""
"RTN","IBJDF41",67,0)
 S IBAIQ=0,IBAI=$G(^TMP("IBJDF4",$J,IBPAT,0,"A"))
"RTN","IBJDF41",68,0)
 S IBRFD=$P($G(^PRCA(430,IBA,6)),U,4)
"RTN","IBJDF41",69,0)
 I IBRPT="D",IBRFD D  I IBAIQ Q                   ; Referred to RC
"RTN","IBJDF41",70,0)
 . S IBRFT="R" I IBAI'["R" S IBAI=IBAI_"R"
"RTN","IBJDF41",71,0)
 . I 'IBSRC S IBAIQ=1 Q
"RTN","IBJDF41",72,0)
 . D SREF("R",IBRFD,IB0,,.IBIDX)
"RTN","IBJDF41",73,0)
 S IBRFD=+$G(^PRCA(430,IBA,12))
"RTN","IBJDF41",74,0)
 I IBRPT="D",IBRFD D                              ; Referred to DMC
"RTN","IBJDF41",75,0)
 . S IBRFT=IBRFT_"D" I IBAI'["D" S IBAI=IBAI_"D"
"RTN","IBJDF41",76,0)
 . D SREF("D",IBRFD,IB0,,.IBIDX)
"RTN","IBJDF41",77,0)
 S IBRFD=+$G(^PRCA(430,IBA,14))
"RTN","IBJDF41",78,0)
 I IBRPT="D",IBRFD D                              ; Referred to TOP
"RTN","IBJDF41",79,0)
 . S IBRFT=IBRFT_"T" I IBAI'["T" S IBAI=IBAI_"T"
"RTN","IBJDF41",80,0)
 . D SREF("T",IBRFD,IB0,,.IBIDX)
"RTN","IBJDF41",81,0)
 ;
"RTN","IBJDF41",82,0)
 ; - Check if AR is on P-Repayment plan or F-Defaulted repayment plan.
"RTN","IBJDF41",83,0)
 ;   and exclude if repayment plan is active.
"RTN","IBJDF41",84,0)
 S IBRP=$$RP(IBA)
"RTN","IBJDF41",85,0)
 I IBRP D
"RTN","IBJDF41",86,0)
 . I IBRP=2 S IBRFT=IBRFT_"F"  I IBAI'["F" S IBAI=IBAI_"F"
"RTN","IBJDF41",87,0)
 . I IBRP=1 S IBRFT=IBRFT_"P" I IBAI'["P"&(IBAI'["F") S IBAI=IBAI_"P"
"RTN","IBJDF41",88,0)
 . D SREF("P",$P(IBRP,"^",2),IB0,$S(+IBRP=2:1,1:0),.IBIDX)
"RTN","IBJDF41",89,0)
 ;
"RTN","IBJDF41",90,0)
 I IBIDX S IBFLG=1
"RTN","IBJDF41",91,0)
 ;
"RTN","IBJDF41",92,0)
 ; - Check if VA Employee
"RTN","IBJDF41",93,0)
 I $P(IBVA,"^")["*",IBAI'["V" S IBAI=IBAI_"V"
"RTN","IBJDF41",94,0)
 ;
"RTN","IBJDF41",95,0)
 I IBAI'="" S ^TMP("IBJDF4",$J,IBPAT,0,"A")=IBAI
"RTN","IBJDF41",96,0)
 ;
"RTN","IBJDF41",97,0)
 ; IB*2.0*451 - Check for EEOB on associated 3rd party bills and attach EOB indicator '%' if applicable
"RTN","IBJDF41",98,0)
 S IBBN=$$IBEEOBCK(IBBN,DFN)_IBBN  ; Pass AR BILL#, Pat ID
"RTN","IBJDF41",99,0)
 ;
"RTN","IBJDF41",100,0)
 ; - Set up indexes for detail report.
"RTN","IBJDF41",101,0)
 I $G(IBEXCEL) D  Q
"RTN","IBJDF41",102,0)
 . S IBEXCEL1=$P($G(^PRCA(430.2,IBCAT,0)),U,2)_U_$P(IBPT,U,3)_U_$P(IBVA,U)_U_$P(IBPT,U,4)_U_$$DT^IBJD($P(IBPT,U,6),1)_U_$$ELIG^IBJDF42(+$P(IBPT,U,5))_U
"RTN","IBJDF41",103,0)
 . S IBEXCEL1=IBEXCEL1_$$GET1^DIQ(2,DFN,.381)_U_$$MTRX(DFN)_U_IBBN_U_$S(IB=16:"A",1:"S")_U_IBRFT_U_$$DT^IBJD($P(IBAR,U,10),1)_U_$$DT^IBJD(IBPD,1)_U_IBBA_U_IBPA_U_IBINT_U_IBADM_U
"RTN","IBJDF41",104,0)
 . I IBSH D COM
"RTN","IBJDF41",105,0)
 . S IBD=0 I DAT!IBPD S IBD=$$FMDIFF^XLFDT(DT,$S('DAT:IBPD,1:$G(DAT)))
"RTN","IBJDF41",106,0)
 . S IBEXCEL1=IBEXCEL1_U_IBD W !,IBEXCEL1 K IBD,IBEXCEL1
"RTN","IBJDF41",107,0)
 ;
"RTN","IBJDF41",108,0)
 I '($D(^TMP("IBJDF4",$J,IBPAT))#10) D
"RTN","IBJDF41",109,0)
 . S ^TMP("IBJDF4",$J,IBPAT)=$P(IBPT,U,3,5)_U_$$MTRX(DFN)_U_$P(IBPT,U,6)_"^"_$P(IBVA,"^",2)_"^"_$$ACCBAL($P(IBPT,U,7))
"RTN","IBJDF41",110,0)
 S ^TMP("IBJDF4",$J,IBPAT,IB0,IBCAT,IBBN)=IBPD_U_IBBA_U_IBPA_U_IBINT_U_IBADM_U_IBIDX
"RTN","IBJDF41",111,0)
 ;
"RTN","IBJDF41",112,0)
 I IBSH D COM
"RTN","IBJDF41",113,0)
 Q
"RTN","IBJDF41",114,0)
 ;
"RTN","IBJDF41",115,0)
ACCBAL(DFN) ; Calculates the Account Balance for the Bill
"RTN","IBJDF41",116,0)
 ; Input: DFN - Patient/Debtor internal number
"RTN","IBJDF41",117,0)
 ; Output: BAL - Patient/Debtor Account Balance
"RTN","IBJDF41",118,0)
 ;
"RTN","IBJDF41",119,0)
 N B0,B7,BAL,BILL,I
"RTN","IBJDF41",120,0)
 S (BAL,BILL)=0
"RTN","IBJDF41",121,0)
 F  S BILL=$O(^PRCA(430,"C",DFN,BILL)) Q:BILL=""  D
"RTN","IBJDF41",122,0)
 . S B0=$G(^PRCA(430,BILL,0)) I $P(B0,"^",8)'=16 Q
"RTN","IBJDF41",123,0)
 . S B7=$G(^PRCA(430,BILL,7))
"RTN","IBJDF41",124,0)
 . F I=1:1:5 S BAL=BAL+$P(B7,"^",I)
"RTN","IBJDF41",125,0)
 Q BAL
"RTN","IBJDF41",126,0)
 ;
"RTN","IBJDF41",127,0)
PHDL ; - Print the header line for the Excel spreadsheet
"RTN","IBJDF41",128,0)
 N X
"RTN","IBJDF41",129,0)
 S X="Cat^Patient^VA Empl.?^SSN^Dt Death^Prim.Elig.^Med.Elig.?^"
"RTN","IBJDF41",130,0)
 S X=X_"Means Tst Sts^Means Tst Dt^RX Copay Exemp.Sts^RX Copay Exemp.Dt^"
"RTN","IBJDF41",131,0)
 S X=X_"Bill #^Act/Susp^Refer. to^Dt Bill prep.^Last Pymt Dt^"
"RTN","IBJDF41",132,0)
 S X=X_"Curr.Bal.^Princ.Bal.^Int.^Admin.^Last Comm.Dt^Days Lst Comm."
"RTN","IBJDF41",133,0)
 W !,X
"RTN","IBJDF41",134,0)
 Q
"RTN","IBJDF41",135,0)
 ;
"RTN","IBJDF41",136,0)
PAT(X) ; - Find the AR patient and decide to include the AR.
"RTN","IBJDF41",137,0)
 ;    Input: X=AR pointer to file #430 and pre-set variables IBS*
"RTN","IBJDF41",138,0)
 ;   Output: Y=Sort key (name or last 4) ^ Patient pointer to file #2 
"RTN","IBJDF41",139,0)
 ;             ^ Name ^ SSN ^ Eligibilities ^ Date of death (if any)
"RTN","IBJDF41",140,0)
 ;             ^ Debtor pointer to file #340
"RTN","IBJDF41",141,0)
 N PAT,KEY,DBTR,DFN,DEATH,NAME,SSN,VAEL,VADM,X1,X2
"RTN","IBJDF41",142,0)
 S PAT="" G:'$G(X) PATQ
"RTN","IBJDF41",143,0)
 S DBTR=+$P($G(^PRCA(430,X,0)),U,9)
"RTN","IBJDF41",144,0)
 S X1=$P($G(^RCD(340,DBTR,0)),U) G:X1'["DPT" PATQ
"RTN","IBJDF41",145,0)
 S DFN=+X1 G:'DFN PATQ D DEM^VADPT
"RTN","IBJDF41",146,0)
 S NAME=VADM(1),SSN=$P(VADM(2),"^"),DEATH=VADM(6)\1
"RTN","IBJDF41",147,0)
 S KEY=$S(IBSN="N":NAME,1:$E(SSN,6,9))
"RTN","IBJDF41",148,0)
 I KEY=""!(IBSNF'="@"&('DFN)) G PATQ
"RTN","IBJDF41",149,0)
 I $D(IBSNA) G:IBSNA="ALL"&('DFN) PATQ G:IBSNA="NULL"&(DFN) PATQ
"RTN","IBJDF41",150,0)
 I $G(IBSNA)="ALL" G PATC
"RTN","IBJDF41",151,0)
 I IBSNF="@",IBSNL="zzzzz" G PATC
"RTN","IBJDF41",152,0)
 I IBSNF'=KEY,IBSNF]KEY G PATQ
"RTN","IBJDF41",153,0)
 I IBSNL'=KEY,KEY]IBSNL G PATQ
"RTN","IBJDF41",154,0)
 ;
"RTN","IBJDF41",155,0)
PATC ; - Set patient eligibilities.
"RTN","IBJDF41",156,0)
 D ELIG^VADPT S X2=+$G(VAEL(1))_";"
"RTN","IBJDF41",157,0)
 I +X2 S X1=0 F  S X1=$O(VAEL(1,X1)) Q:'X1  S X2=X2_X1_";"
"RTN","IBJDF41",158,0)
 ;
"RTN","IBJDF41",159,0)
 S PAT=KEY_U_DFN_U_$E(NAME,1,26)_U_SSN_U_X2_U_DEATH
"RTN","IBJDF41",160,0)
 S PAT=PAT_U_DBTR
"RTN","IBJDF41",161,0)
PATQ Q PAT
"RTN","IBJDF41",162,0)
 ;
"RTN","IBJDF41",163,0)
RP(X) ; - Check if claim/receivable is under a repayment plan.
"RTN","IBJDF41",164,0)
 ;    Input: X=Bill pointer to file #399/#430
"RTN","IBJDF41",165,0)
 ;   Output: 0-Not on repay plan, 1-On repay plan, 2-On defaulted plan
"RTN","IBJDF41",166,0)
 N Z
"RTN","IBJDF41",167,0)
 S Z=$$REPDATA^RCBECHGA(X,1) I Z="" Q 0
"RTN","IBJDF41",168,0)
 I '$P(Z,"^",7) Q ("1^"_$P(Z,"^"))
"RTN","IBJDF41",169,0)
 Q ("2^"_$P(Z,"^"))
"RTN","IBJDF41",170,0)
 ;
"RTN","IBJDF41",171,0)
MTRX(X) ; - Return patient's means test and/or RX copay status and most recent
"RTN","IBJDF41",172,0)
 ;   test dates for both.
"RTN","IBJDF41",173,0)
 ;    Input: X=Patient pointer to file #2 and opt. variable IBEXCEL
"RTN","IBJDF41",174,0)
 ;   Output: Y=Means test status ^ Date ^ RX copay status ^ Date 
"RTN","IBJDF41",175,0)
 N MTST,RXST,Y
"RTN","IBJDF41",176,0)
 S Y="^^^",MTST=$$LST^DGMTU(X),RXST=$$RXST^IBARXEU(X)
"RTN","IBJDF41",177,0)
 I '$G(IBEXCEL) D
"RTN","IBJDF41",178,0)
 . S $P(Y,"^",1,2)=$P(MTST,"^",3)_"^"_$$DAT1^IBOUTL($P(MTST,"^",2))
"RTN","IBJDF41",179,0)
 . S $P(Y,"^",3)=$S('RXST:"NON-EXEMPT",+RXST=1:"EXEMPT",1:"")
"RTN","IBJDF41",180,0)
 . I $P(Y,"^",3)'="" S $P(Y,"^",4)=$$DAT1^IBOUTL($P(RXST,"^",5))
"RTN","IBJDF41",181,0)
 I $G(IBEXCEL) D
"RTN","IBJDF41",182,0)
 . S $P(Y,"^",1,2)=$P(MTST,"^",4)_"^"_$$DT^IBJD($P(MTST,"^",2),1)
"RTN","IBJDF41",183,0)
 . S $P(Y,"^",3)=$S('RXST:"M",+RXST=1:"E",1:"")
"RTN","IBJDF41",184,0)
 . I $P(Y,"^",3)'="" S $P(Y,"^",4)=$$DT^IBJD($P(RXST,"^",5),1)
"RTN","IBJDF41",185,0)
 Q Y
"RTN","IBJDF41",186,0)
 ;
"RTN","IBJDF41",187,0)
SREF(RFT,DAT,STS,DEF,IDX) ; Set the "referred to" information on the 
"RTN","IBJDF41",188,0)
 ;                         temporary global ^TMP
"RTN","IBJDF41",189,0)
 ;Input: RFT: "R": RC, "D": DMC, "T": TOP, "P": REPAYMENT PLAN
"RTN","IBJDF41",190,0)
 ;       DAT: Date it was referred/established
"RTN","IBJDF41",191,0)
 ;       STS: Receivable status (16-Active,19-Suspended)
"RTN","IBJDF41",192,0)
 ;       DEF: Repayment Plan in Default? (1 - YES, 0 - NO)
"RTN","IBJDF41",193,0)
 ;       IDX: Subscript to be set in the Temporary global ^TMP
"RTN","IBJDF41",194,0)
 ;Output: IDX: Subscript set in the Temporary global ^TMP
"RTN","IBJDF41",195,0)
 ;
"RTN","IBJDF41",196,0)
 N SREF,IDX1
"RTN","IBJDF41",197,0)
 S DEF=+$G(DEF),IDX=+$G(IDX)
"RTN","IBJDF41",198,0)
 I RFT="R" S SREF="REFERRED TO RC"
"RTN","IBJDF41",199,0)
 I RFT="D" S SREF="REFERRED TO DMC"
"RTN","IBJDF41",200,0)
 I RFT="T" S SREF="REFERRED TO TOP"
"RTN","IBJDF41",201,0)
 I RFT="P" D
"RTN","IBJDF41",202,0)
 . S SREF="REPAYMENT PLAN ESTABLISHED"
"RTN","IBJDF41",203,0)
 . I $G(DEF) S SREF=SREF_" (CURRENTLY IN DEFAULT)"
"RTN","IBJDF41",204,0)
 ;
"RTN","IBJDF41",205,0)
 I 'IDX S IDX=$O(^TMP("IBJDF4",$J,IBPAT,0,"C",STS,""),-1)+1
"RTN","IBJDF41",206,0)
 S IDX1=$O(^TMP("IBJDF4",$J,IBPAT,0,"C",STS,IDX,""),-1)+1
"RTN","IBJDF41",207,0)
 S ^TMP("IBJDF4",$J,IBPAT,0,"C",STS,IDX,IDX1)=DAT
"RTN","IBJDF41",208,0)
 S ^TMP("IBJDF4",$J,IBPAT,0,"C",STS,IDX,IDX1,1)=SREF
"RTN","IBJDF41",209,0)
 Q
"RTN","IBJDF41",210,0)
 ;
"RTN","IBJDF41",211,0)
COM ; - Get bill comments.
"RTN","IBJDF41",212,0)
 I 'IBIDX,'$G(IBEXCEL) D
"RTN","IBJDF41",213,0)
 . S IBFLG=0,IBIDX=$O(^TMP("IBJDF4",$J,IBPAT,0,"C",IB0,""),-1)+1
"RTN","IBJDF41",214,0)
 ;
"RTN","IBJDF41",215,0)
 S DAT=0,IBA1=$S(IBSH1="M":999999999,1:0)
"RTN","IBJDF41",216,0)
 F  S IBA1=$S(IBSH1="M":$O(^PRCA(433,"C",IBA,IBA1),-1),1:$O(^PRCA(433,"C",IBA,IBA1))) Q:'IBA1  D  I IBSH1="M",DAT Q
"RTN","IBJDF41",217,0)
 . S IBC=$G(^PRCA(433,IBA1,1)) Q:'IBC
"RTN","IBJDF41",218,0)
 . I $G(IBSH2),$$FMDIFF^XLFDT(DT,+IBC)>IBSH2 Q  ; Comment age not minimum.
"RTN","IBJDF41",219,0)
 . I $P(IBC,U,2)'=35,$P(IBC,U,2)'=45 Q  ;   Not decrease/comment transact.
"RTN","IBJDF41",220,0)
 . S DAT=$S(IBC:+IBC\1,1:+$P(IBC,U,9)\1)
"RTN","IBJDF41",221,0)
 . I $G(IBEXCEL),IBSH1="M" S IBEXCEL1=IBEXCEL1_$$DT^IBJD(DAT,1) Q
"RTN","IBJDF41",222,0)
 . ;
"RTN","IBJDF41",223,0)
 . ; - Append brief and transaction comments.
"RTN","IBJDF41",224,0)
 . K COM,COM1 S COM(0)=DAT,X1=0
"RTN","IBJDF41",225,0)
 . S COM1(1)=$P($G(^PRCA(433,IBA1,5)),U,2)
"RTN","IBJDF41",226,0)
 . S COM1(2)=$E($P($G(^PRCA(433,IBA1,8)),U,6),1,70)
"RTN","IBJDF41",227,0)
 . S COM(1)=COM1(1)_$S(COM1(1)]""&(COM1(2)]""):"|",1:"")_COM1(2)
"RTN","IBJDF41",228,0)
 . I COM(1)]"" S COM(1)="**"_COM(1)_"**",X1=1
"RTN","IBJDF41",229,0)
 . ;
"RTN","IBJDF41",230,0)
 . ; - Get main comments.
"RTN","IBJDF41",231,0)
 . S X2=0
"RTN","IBJDF41",232,0)
 . F  S X2=$O(^PRCA(433,IBA1,7,X2)) Q:'X2  D
"RTN","IBJDF41",233,0)
 . . S COM($S(X1:X2+1,1:X2))=^PRCA(433,IBA1,7,X2,0)
"RTN","IBJDF41",234,0)
 . ;
"RTN","IBJDF41",235,0)
 . I $G(IBEXCEL) Q
"RTN","IBJDF41",236,0)
 . ;
"RTN","IBJDF41",237,0)
 . S IBFLG=1,^TMP("IBJDF4",$J,IBPAT,0,"C",IB0,IBIDX,IBA1)=$G(COM(0)),X1=0
"RTN","IBJDF41",238,0)
 . F  S X1=$O(COM(X1)) Q:X1=""  D
"RTN","IBJDF41",239,0)
 . . S ^TMP("IBJDF4",$J,IBPAT,0,"C",IB0,IBIDX,IBA1,X1)=COM(X1)
"RTN","IBJDF41",240,0)
 ;
"RTN","IBJDF41",241,0)
 I '$G(IBEXCEL),IBFLG D
"RTN","IBJDF41",242,0)
 . S $P(^TMP("IBJDF4",$J,IBPAT,IB0,IBCAT,IBBN),"^",6)=IBIDX
"RTN","IBJDF41",243,0)
 Q
"RTN","IBJDF41",244,0)
 ; IB*2.0*451 -  Use Event Date to find an associated 3rd Party bill with an associated EEOB
"RTN","IBJDF41",245,0)
IBEEOBCK(IBBN,DFN) ; Passed AR Bill, Patient ID
"RTN","IBJDF41",246,0)
 ; Function will quit as soon as a 3rd party bill is located that has an associated EEOB
"RTN","IBJDF41",247,0)
 ;
"RTN","IBJDF41",248,0)
 ; Find 3rd Party Bills with an Event Date
"RTN","IBJDF41",249,0)
 N IBREF,IBEEOB,IBDT
"RTN","IBJDF41",250,0)
 S IBEEOB=""
"RTN","IBJDF41",251,0)
 ; Loop through Xref of ARbill (#430) to Action file (#350)
"RTN","IBJDF41",252,0)
 I +$G(IBBN) S IBREF=0 F  S IBREF=$O(^IB("ABIL",IBBN,IBREF)) Q:'IBREF  D  Q:IBEEOB="%"
"RTN","IBJDF41",253,0)
 . S IBDT=$P($G(^IB(IBREF,0)),"^",17) ;Get event Date
"RTN","IBJDF41",254,0)
 . I IBDT S IBEEOB=$$TPEVDT(DFN,IBDT)
"RTN","IBJDF41",255,0)
 . I IBDT S IBEEOB=$$TPOPV(DFN,IBDT)
"RTN","IBJDF41",256,0)
 ;
"RTN","IBJDF41",257,0)
 Q IBEEOB
"RTN","IBJDF41",258,0)
 ;
"RTN","IBJDF41",259,0)
 ; IB*2.0*451 - Traverse all THIRD PARTY bills for a patient with a specific Event Date (399,.03)
"RTN","IBJDF41",260,0)
TPEVDT(DFN,EVDT) ;
"RTN","IBJDF41",261,0)
 ; Function will quit as soon as a 3rd party bill is located that has an associated EEOB
"RTN","IBJDF41",262,0)
 N IBIFN,IBDT,IBEEOB
"RTN","IBJDF41",263,0)
 S IBEEOB=""
"RTN","IBJDF41",264,0)
 I +$G(DFN),+$G(EVDT) S IBDT=(EVDT\1)-.001 F  S IBDT=$O(^DGCR(399,"D",IBDT)) Q:'IBDT!((IBDT\1)>(EVDT\1))  D  Q:IBEEOB="%"
"RTN","IBJDF41",265,0)
 . S IBIFN=0 F  S IBIFN=$O(^DGCR(399,"D",IBDT,IBIFN)) Q:'IBIFN  D  Q:IBEEOB="%"
"RTN","IBJDF41",266,0)
 .. Q:DFN'=$P($G(^DGCR(399,IBIFN,0)),U,2)
"RTN","IBJDF41",267,0)
 .. ; attach EOB indicator '%' to bill # when applicable
"RTN","IBJDF41",268,0)
 .. S IBEEOB=$$EEOBCK(IBIFN)
"RTN","IBJDF41",269,0)
 Q IBEEOB
"RTN","IBJDF41",270,0)
 ; 
"RTN","IBJDF41",271,0)
 ; IB*2.0*451 - Traverse all THIRD PARTY bills for a patient with any Opt Visit Dates same as Event Date (399,43)
"RTN","IBJDF41",272,0)
TPOPV(DFN,EVDT) ;
"RTN","IBJDF41",273,0)
 ; Function will quit as soon as a 3rd party bill is located that has an associated EEOB
"RTN","IBJDF41",274,0)
 N IBIFN,IBEEOB
"RTN","IBJDF41",275,0)
 S IBEEOB=""
"RTN","IBJDF41",276,0)
 I +$G(DFN),+$G(EVDT) S IBIFN=0 F  S IBIFN=$O(^DGCR(399,"AOPV",DFN,EVDT,IBIFN)) Q:'IBIFN  D  Q:IBEEOB="%"
"RTN","IBJDF41",277,0)
 . ; attach EOB indicator '%' to bill # when applicable
"RTN","IBJDF41",278,0)
 . S IBEEOB=$$EEOBCK(IBIFN)
"RTN","IBJDF41",279,0)
 Q IBEEOB
"RTN","IBJDF41",280,0)
 ;
"RTN","IBJDF41",281,0)
 ; IB*2.0*451 - Check for EEOB indicator
"RTN","IBJDF41",282,0)
EEOBCK(IBBILL)  ;
"RTN","IBJDF41",283,0)
 ; Check for 1st and 3rd party payment activity on bill
"RTN","IBJDF41",284,0)
 ; IBBILL is the IEN for the bill # in files #399/#430 and must be valid,
"RTN","IBJDF41",285,0)
 ; check the EOB type and exclude it if it is an MRA. Otherwise,
"RTN","IBJDF41",286,0)
 ; returns the EEOB indicator '%' if payment activity was found.
"RTN","IBJDF41",287,0)
 ; Access to file #361.1 covered by IA #4051.
"RTN","IBJDF41",288,0)
 ; Access to file #399 covered by IA #3820.
"RTN","IBJDF41",289,0)
 N IBOUT,IBVAL,Z
"RTN","IBJDF41",290,0)
 I $G(IBBILL)=0 Q ""
"RTN","IBJDF41",291,0)
 I '$O(^IBM(361.1,"B",IBBILL,0)) Q ""  ; no entry here
"RTN","IBJDF41",292,0)
 I $P($G(^DGCR(399,IBBILL,0)),"^",13)=1 Q ""  ;avoid 'ENTERED/NOT REVIEWED' status
"RTN","IBJDF41",293,0)
 ; handle both single and multiple bill entries in file #361.1
"RTN","IBJDF41",294,0)
 S Z=0 F  S Z=$O(^IBM(361.1,"B",IBBILL,Z)) Q:'Z  D  Q:$G(IBOUT)="%"
"RTN","IBJDF41",295,0)
 . S IBVAL=$G(^IBM(361.1,Z,0))
"RTN","IBJDF41",296,0)
 . S IBOUT=$S($P(IBVAL,"^",4)=1:"",$P(IBVAL,"^",4)=0:"%",1:"")
"RTN","IBJDF41",297,0)
 Q IBOUT  ; EOB indicator for either 1st or 3rd party payment on bill
"RTN","IBJTBA1")
0^19^B50433175^B27347491
"RTN","IBJTBA1",1,0)
IBJTBA1 ;ALB/TMK/PJH - TPJI BILL CHARGE INFO SCREEN ;01-MAR-1995
"RTN","IBJTBA1",2,0)
 ;;2.0;INTEGRATED BILLING;**135,265,155,349,417,451**;21-MAR-94;Build 47
"RTN","IBJTBA1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTBA1",4,0)
 ;
"RTN","IBJTBA1",5,0)
SHEOB(IBI,IBSPL,IBEOBCT,IBCTOF) ; Format EOB called from IBJTBA
"RTN","IBJTBA1",6,0)
 ; IBSPL = 0 if EOB represents one bill's payment
"RTN","IBJTBA1",7,0)
 ;       =  1 if AR had to split the EOB between multiple bills
"RTN","IBJTBA1",8,0)
 ; Assumes IBLN is defined and returns it with line count
"RTN","IBJTBA1",9,0)
 ; Assumes IBEOBDET may be defined as a flag to control detail level of print
"RTN","IBJTBA1",10,0)
 N X,IBPT,IBCN,IBM,IBM1,IBM2,IBTY,IBPY,IBPR,IBST,IBSTR,IBCA,IBTS,IBTA,Z,Z0
"RTN","IBJTBA1",11,0)
 S X="0.00"
"RTN","IBJTBA1",12,0)
 S IBM=$G(^IBM(361.1,IBI,0))
"RTN","IBJTBA1",13,0)
 S IBTY=$P(IBM,U,4),IBTY=$S(IBTY:"MEDICARE MRA",1:"NORMAL EOB")
"RTN","IBJTBA1",14,0)
 I IBTY'["MRA",IBSPL S IBTY="A/R SPLIT/COVERS MORE THAN 1 BILL"
"RTN","IBJTBA1",15,0)
 I $P(IBM,U,13)>1,$P(IBM,U,13)<5 S IBTY=IBTY_" ("_$$EXTERNAL^DILFD(361.1,.13,,$P(IBM,U,13))_")"
"RTN","IBJTBA1",16,0)
 S IBCN=$P(IBM,U,14),IBPY=$P(IBM,U,2)
"RTN","IBJTBA1",17,0)
 S:IBPY IBPY=$P($G(^DIC(36,IBPY,0)),U)
"RTN","IBJTBA1",18,0)
 S IBPR=$$FMTE^XLFDT($P(IBM,U,6)),IBST=$P(IBM,U,16)
"RTN","IBJTBA1",19,0)
 S IBST=$$EXPAND^IBTRE(361.1,.16,+IBST)
"RTN","IBJTBA1",20,0)
 S IBM1=$G(^IBM(361.1,IBI,1))
"RTN","IBJTBA1",21,0)
 ;
"RTN","IBJTBA1",22,0)
 S IBPT=$P(IBM1,U,2)   ; patient responsibility 1.02 fiel
"RTN","IBJTBA1",23,0)
 I $P(IBM,U,4),$D(^IBM(361.1,IBI,"ERR")) S IBPT=0  ; filing error
"RTN","IBJTBA1",24,0)
 ; If MRA & UB, then calculate patient responsiblity value
"RTN","IBJTBA1",25,0)
 I $P(IBM,U,4),$$FT^IBCEF(+$P(IBM,U,1))=3 S IBPT=$$PTRESPI^IBCECOB1(IBI)
"RTN","IBJTBA1",26,0)
 ;
"RTN","IBJTBA1",27,0)
 S IBCA=$P(IBM1,U)
"RTN","IBJTBA1",28,0)
 S IBM2=$G(^IBM(361.1,IBI,2)),IBTA=$P(IBM2,U,3)
"RTN","IBJTBA1",29,0)
 ; if no Total Allowed Amount, sum up amounts on Line Level Adjustment
"RTN","IBJTBA1",30,0)
 I IBTA="" S IBTA=$$ALLOWED^IBCEMU2(IBI)
"RTN","IBJTBA1",31,0)
 S IBTS=$P(IBM2,U,4)
"RTN","IBJTBA1",32,0)
 D MRA2
"RTN","IBJTBA1",33,0)
 S IBLN=$$SET^IBJTBA("",IBLN)
"RTN","IBJTBA1",34,0)
 I '$G(IBEOBDET),IBSPL D
"RTN","IBJTBA1",35,0)
 . S IBSTR=$$SETLN^IBJTBA("    **A/R CORRECTED PAYMENT DATA:","",1,50),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",36,0)
 . S IBSTR=$$SETLN^IBJTBA("     TOTAL AMT PD: "_$J(+$P($G(^IBM(361.1,IBI,1)),U,1),"",2),"",1,75),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",37,0)
 . S Z=0 F  S Z=$O(^IBM(361.1,IBI,8,Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","IBJTBA1",38,0)
 .. S IBSTR=$$SETLN^IBJTBA($E($J("",8)_$S($P(Z0,U,3):$$BN1^PRCAFN(+$P(Z0,U,3)),1:"[suspense]"_$P(Z0,U))_$J("",25),1,25)_"  "_$J(+$P(Z0,U,2),"",2),"",1,75),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",39,0)
 ;
"RTN","IBJTBA1",40,0)
 I $G(IBEOBDET) D
"RTN","IBJTBA1",41,0)
 . I $P($G(^IBM(361.1,IBI,0)),U,4) D  Q     ; Medicare MRA processing
"RTN","IBJTBA1",42,0)
 .. N VALMCNT
"RTN","IBJTBA1",43,0)
 .. K ^TMP("IBCECSD",$J)
"RTN","IBJTBA1",44,0)
 .. D GETEOB^IBCECSA6(IBI,0,,+$G(IBLN)-1)
"RTN","IBJTBA1",45,0)
 .. S Z=0 F  S Z=$O(^TMP("IBCECSD",$J,Z)) Q:'Z  S IBSTR=$$SETLN^IBJTBA($G(^TMP("IBCECSD",$J,Z,0)),"",1,79),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",46,0)
 .. K ^TMP("IBCECSD",$J)
"RTN","IBJTBA1",47,0)
 .. D EOBERR
"RTN","IBJTBA1",48,0)
 .. Q
"RTN","IBJTBA1",49,0)
 . ;
"RTN","IBJTBA1",50,0)
 . ; Normal EOB processing
"RTN","IBJTBA1",51,0)
 . N VALMCNT
"RTN","IBJTBA1",52,0)
 . K ^TMP("PRCA_EOB",$J)
"RTN","IBJTBA1",53,0)
 . D GETEOB^IBCECSA6(IBI,1)
"RTN","IBJTBA1",54,0)
 . S Z=0 F  S Z=$O(^TMP("PRCA_EOB",$J,IBI,Z)) Q:'Z  S IBSTR=$$SETLN^IBJTBA($G(^TMP("PRCA_EOB",$J,IBI,Z)),"",1,79),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",55,0)
 . K ^TMP("PRCA_EOB",$J)
"RTN","IBJTBA1",56,0)
 . D EOBERR
"RTN","IBJTBA1",57,0)
 . Q
"RTN","IBJTBA1",58,0)
 ;
"RTN","IBJTBA1",59,0)
 Q
"RTN","IBJTBA1",60,0)
 ;
"RTN","IBJTBA1",61,0)
MRA2 ;
"RTN","IBJTBA1",62,0)
 N IBD
"RTN","IBJTBA1",63,0)
 S IBLN=$$SET^IBJTBA("",IBLN)
"RTN","IBJTBA1",64,0)
 S IBD="EOB/MRA Information"_$S($D(IBCTOF):" ("_$G(IBEOBCT)_" OF "_IBCTOF_")",1:"")
"RTN","IBJTBA1",65,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,"",30,45),$E(IBSTR,1,2)=">>",IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",66,0)
 S IBD="EOB Type: "_IBTY,IBSTR=$$SETLN^IBJTBA(IBD,"",5,59)
"RTN","IBJTBA1",67,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",68,0)
 S IBD="ICN: "_IBCN,IBSTR=$$SETLN^IBJTBA(IBD,"",10,30)
"RTN","IBJTBA1",69,0)
 S IBD="Patient Resp Amount: "_$S('IBPT:X,1:IBPT)
"RTN","IBJTBA1",70,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,44,35)
"RTN","IBJTBA1",71,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",72,0)
 S IBD="Payer Name: "_IBPY,IBSTR=$$SETLN^IBJTBA(IBD,"",3,40)
"RTN","IBJTBA1",73,0)
 S IBD="Total Allowed Amount: "_$S('IBTA:X,1:IBTA)
"RTN","IBJTBA1",74,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,43,36)
"RTN","IBJTBA1",75,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",76,0)
 S IBD="EOB Date: "_IBPR,IBSTR=$$SETLN^IBJTBA(IBD,"",5,35)
"RTN","IBJTBA1",77,0)
 S IBD="Total Submitted Charges: "_$S('IBTS:X,1:IBTS)
"RTN","IBJTBA1",78,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,40,39)
"RTN","IBJTBA1",79,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",80,0)
 S IBD="Svc From Dt: "_$$DAT1^IBOUTL($P(IBM1,U,10))
"RTN","IBJTBA1",81,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,"",2,38)
"RTN","IBJTBA1",82,0)
 S IBD="Svc To Dt: "_$$DAT1^IBOUTL($P(IBM1,U,11))
"RTN","IBJTBA1",83,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,54,25)
"RTN","IBJTBA1",84,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",85,0)
 S IBSTR=""
"RTN","IBJTBA1",86,0)
 I IBTY["MRA" S IBD="MRA Review Status: "_IBST,IBSTR=$$SETLN^IBJTBA(IBD,"",2,38)
"RTN","IBJTBA1",87,0)
 S IBD=$S('$G(IBSPL):"  ",1:"**")_"Reported Payment Amt: "_$S('IBCA:$J(X,"",2),1:$J(+IBCA,"",2))
"RTN","IBJTBA1",88,0)
 S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,41,37)
"RTN","IBJTBA1",89,0)
 S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",90,0)
 ;
"RTN","IBJTBA1",91,0)
 ; begin IB*2.0*451
"RTN","IBJTBA1",92,0)
 ; display Trace # and ERA # for every EOB record found. MRAs will not have an ERA #, only a Trace #
"RTN","IBJTBA1",93,0)
 I IBTY]"" D
"RTN","IBJTBA1",94,0)
 . S IBTRACE=$P($G(^IBM(361.1,IBI,0)),U,7)
"RTN","IBJTBA1",95,0)
 . I IBTRACE]"" S IBERAE=$O(^RCY(344.4,"D",IBTRACE,""))
"RTN","IBJTBA1",96,0)
 . S IBD="       ERA #: "_$G(IBERAE),IBSTR=$$SETLN^IBJTBA(IBD,"",1,25)
"RTN","IBJTBA1",97,0)
 . S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",98,0)
 . S IBD="     Trace #: "_$G(IBTRACE),IBSTR=$$SETLN^IBJTBA(IBD,"",1,80) ; Trace # can be up to 50 characters long
"RTN","IBJTBA1",99,0)
 . S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",100,0)
 . S IBLN=$$SET^IBJTBA("",IBLN)
"RTN","IBJTBA1",101,0)
 ; end IB*2.0*451
"RTN","IBJTBA1",102,0)
 ; 
"RTN","IBJTBA1",103,0)
 I IBTY["MRA",$D(^IBM(361.1,IBI,21)) D
"RTN","IBJTBA1",104,0)
 . S IBD=$TR($J("",35)," ","-")_"Review"_$TR($J("",38)," ","-")
"RTN","IBJTBA1",105,0)
 . S IBSTR=$$SETLN^IBJTBA(IBD,"",1,79),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",106,0)
 . S (IBST,IBCN)=0 F  S IBCN=$O(^IBM(361.1,IBI,21,IBCN)) Q:'IBCN  S X=$G(^(IBCN,0)) D
"RTN","IBJTBA1",107,0)
 .. S IBST=0
"RTN","IBJTBA1",108,0)
 .. S IBD="Review Date: "_$$DAT1^IBOUTL($P(X,U))
"RTN","IBJTBA1",109,0)
 .. S IBSTR=$$SETLN^IBJTBA(IBD,"",1,30)
"RTN","IBJTBA1",110,0)
 .. S IBD="Reviewed By: "_$P($G(^VA(200,+$P(X,U,2),0)),U)
"RTN","IBJTBA1",111,0)
 .. S IBSTR=$$SETLN^IBJTBA(IBD,IBSTR,40,39)
"RTN","IBJTBA1",112,0)
 .. S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",113,0)
 .. S IBD=0 F  S IBD=$O(^IBM(361.1,IBI,21,IBCN,1,IBD)) Q:'IBD  S IBSTR=$$SETLN^IBJTBA($S('IBST:"Comments: ",1:"")_$G(^(IBD,0)),"",1,$S('IBST:69,1:79)),IBST=1,IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",114,0)
 . I 'IBST D
"RTN","IBJTBA1",115,0)
 .. S IBSTR=$$SETLN^IBJTBA("None","",1,10)
"RTN","IBJTBA1",116,0)
 .. S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",117,0)
 ;
"RTN","IBJTBA1",118,0)
MOVE    ;
"RTN","IBJTBA1",119,0)
 ;Display details of any EEOB MOVE/COPY
"RTN","IBJTBA1",120,0)
 I IBTY'["MRA",$D(^IBM(361.1,IBI,101)) D
"RTN","IBJTBA1",121,0)
 .N IEN101,FIRST101 S IEN101=0,FIRST101=1
"RTN","IBJTBA1",122,0)
 .F  S IEN101=$O(^IBM(361.1,IBI,101,IEN101)) Q:'IEN101  D
"RTN","IBJTBA1",123,0)
 ..N IB101,IB102,IBDATE,IBUSER,IBJS,IBJS1,IBJS2,IBORIG,IBDIR
"RTN","IBJTBA1",124,0)
 ..S IB101=$G(^IBM(361.1,IBI,101,IEN101,0)) Q:IB101=""
"RTN","IBJTBA1",125,0)
 ..S IBDATE=$$EXTERNAL^DILFD(361.1101,.01,,$P(IB101,U,1))
"RTN","IBJTBA1",126,0)
 ..S IBUSER=$$EXTERNAL^DILFD(361.1101,.02,,$P(IB101,U,2))
"RTN","IBJTBA1",127,0)
 ..S IBJS=$E($P(IB101,U,3),1,78),IBJS1=$E($P(IB101,U,3),79,100)
"RTN","IBJTBA1",128,0)
 ..S IBDIR=$$EXTERNAL^DILFD(361.1101,.05,,$P(IB101,U,5)) ; kl - added MOVE/COPY field
"RTN","IBJTBA1",129,0)
 ..S IBORIG=$$EXTERNAL^DILFD(361.1101,.04,,$P(IB101,U,4))
"RTN","IBJTBA1",130,0)
 ..I FIRST101 D
"RTN","IBJTBA1",131,0)
 ...S IBSTR=$$SETLN^IBJTBA("MOVE/COPY HISTORY","",1,78),FIRST101=0
"RTN","IBJTBA1",132,0)
 ...S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",133,0)
 ..S IBLN=$$SET^IBJTBA("",IBLN)
"RTN","IBJTBA1",134,0)
 ..S:IBDIR']"" IBDIR="Move"
"RTN","IBJTBA1",135,0)
 ..S IBSTR=$$SETLN^IBJTBA("Date/Time of EEOB "_IBDIR_": "_IBDATE,"",1,78) ; kl
"RTN","IBJTBA1",136,0)
 ..S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",137,0)
 ..S IBSTR=$$SETLN^IBJTBA(IBDIR_" of EEOB performed by: "_IBUSER,"",1,78) ; kl
"RTN","IBJTBA1",138,0)
 ..S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",139,0)
 ..S IBSTR=$$SETLN^IBJTBA(IBDIR_" Justification Comments: ","",1,78)
"RTN","IBJTBA1",140,0)
 ..S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",141,0)
 ..S IBSTR=$$SETLN^IBJTBA(IBJS,"",1,78)
"RTN","IBJTBA1",142,0)
 ..S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",143,0)
 ..I IBJS1]"" D
"RTN","IBJTBA1",144,0)
 ...S IBSTR=$$SETLN^IBJTBA(IBJS1,"",1,78)
"RTN","IBJTBA1",145,0)
 ...S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",146,0)
 ..I IBORIG]"" D
"RTN","IBJTBA1",147,0)
 ...S IBSTR=$$SETLN^IBJTBA("Original Claim Number: "_IBORIG,"",1,78)
"RTN","IBJTBA1",148,0)
 ...S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",149,0)
 ..;Other claim numbers
"RTN","IBJTBA1",150,0)
 ..N SUB,IBOTH,OTEXT
"RTN","IBJTBA1",151,0)
 ..S SUB=0,OTEXT=""
"RTN","IBJTBA1",152,0)
 ..F  S SUB=$O(^IBM(361.1,IBI,101,IEN101,1,SUB)) Q:'SUB  D
"RTN","IBJTBA1",153,0)
 ...S IBOTH=$P($G(^IBM(361.1,IBI,101,IEN101,1,SUB,0)),U) Q:'IBOTH
"RTN","IBJTBA1",154,0)
 ...S IBOTH=$$EXTERNAL^DILFD(361.11016,.01,,IBOTH) Q:IBOTH=""
"RTN","IBJTBA1",155,0)
 ...S OTEXT=OTEXT_","_IBOTH
"RTN","IBJTBA1",156,0)
 ..S OTEXT=$P(OTEXT,",",2,99)
"RTN","IBJTBA1",157,0)
 ..I OTEXT]"" D
"RTN","IBJTBA1",158,0)
 ...S IBSTR=$$SETLN^IBJTBA("Other Claims: "_OTEXT,"",1,78)
"RTN","IBJTBA1",159,0)
 ...S IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",160,0)
 Q
"RTN","IBJTBA1",161,0)
 ;
"RTN","IBJTBA1",162,0)
EOBERR ; Display information about any 361.1 message storage or filing errors
"RTN","IBJTBA1",163,0)
 I '$O(^IBM(361.1,IBI,"ERR",0)) Q
"RTN","IBJTBA1",164,0)
 S IBSTR=$$SETLN^IBJTBA(" ** MESSAGE STORAGE ERRORS  **","",1,79),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",165,0)
 S Z=0 F  S Z=$O(^IBM(361.1,IBI,"ERR",Z)) Q:'Z  S IBSTR=$$SETLN^IBJTBA($G(^(Z,0)),"",1,79),IBLN=$$SET^IBJTBA(IBSTR,IBLN)
"RTN","IBJTBA1",166,0)
 Q
"RTN","IBJTCA")
0^20^B2378826^B2171336
"RTN","IBJTCA",1,0)
IBJTCA ;ALB/ARH - TPI CLAIMS INFO SCREEN ;16-FEB-1995
"RTN","IBJTCA",2,0)
 ;;2.0;INTEGRATED BILLING;**39,137,451**;21-MAR-94;Build 47
"RTN","IBJTCA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTCA",4,0)
 ;
"RTN","IBJTCA",5,0)
EN ; -- main entry point for IBJ TP CLAIMS INFO
"RTN","IBJTCA",6,0)
 D EN^VALM("IBJT CLAIM INFO")
"RTN","IBJTCA",7,0)
 Q
"RTN","IBJTCA",8,0)
 ;
"RTN","IBJTCA",9,0)
HDR ; -- header code
"RTN","IBJTCA",10,0)
 D HDR^IBJTU1(+IBIFN,+DFN,1)
"RTN","IBJTCA",11,0)
 S:$$WNRBILL^IBEFUNC(+IBIFN) VALMSG="*=No payment expected, bill exists to obtain MRA"
"RTN","IBJTCA",12,0)
 S VALMSG="|% EEOB | Enter ?? for more actions|" ; IB*2.0*451
"RTN","IBJTCA",13,0)
 Q
"RTN","IBJTCA",14,0)
 ;
"RTN","IBJTCA",15,0)
INIT ; -- init variables and list array
"RTN","IBJTCA",16,0)
 K IBPOLICY F I="IBJTCA","IBJTBA","IBJTBB","IBJTBC","IBJTBD","IBJTEA","IBJTRA","IBJTTA","IBJTTB","IBJTTC","IBTRCD","IBTRDD","IBCNSA","IBCNSC","IBCNSVP" K ^TMP(I,$J)
"RTN","IBJTCA",17,0)
 I '$G(DFN)!'$G(IBIFN) S VALMQUIT="" G INITQ
"RTN","IBJTCA",18,0)
 D BLD^IBJTCA1
"RTN","IBJTCA",19,0)
INITQ Q
"RTN","IBJTCA",20,0)
 ;
"RTN","IBJTCA",21,0)
HELP ; -- help code
"RTN","IBJTCA",22,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBJTCA",23,0)
 Q
"RTN","IBJTCA",24,0)
 ;
"RTN","IBJTCA",25,0)
EXIT ; -- exit code
"RTN","IBJTCA",26,0)
 K ^TMP("IBJTCA",$J),IBIFN,IBPRVSCR,IBPOLICY,IBARCOMM
"RTN","IBJTCA",27,0)
 D CLEAR^VALM1,CLEAN^VALM10
"RTN","IBJTCA",28,0)
 Q
"RTN","IBJTLA")
0^10^B3871013^B3799584
"RTN","IBJTLA",1,0)
IBJTLA ;ALB/ARH - TPI ACTIVE BILLS LIST SCREEN ;14-FEB-1995
"RTN","IBJTLA",2,0)
 ;;2.0;INTEGRATED BILLING;**39,61,153,451**;21-MAR-94;Build 47
"RTN","IBJTLA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTLA",4,0)
 ;
"RTN","IBJTLA",5,0)
EN ; -- main entry point for IBJ THIRD PARTY ACTIVE LIST
"RTN","IBJTLA",6,0)
 D EN^VALM("IBJT ACTIVE LIST")
"RTN","IBJTLA",7,0)
 Q
"RTN","IBJTLA",8,0)
 ;
"RTN","IBJTLA",9,0)
HDR ; -- header code
"RTN","IBJTLA",10,0)
 N X S X=$$PT^IBEFUNC(+$G(DFN))
"RTN","IBJTLA",11,0)
 S VALMHDR(1)=$P(X,U,1) I $P(X,U,3)'="" S VALMHDR(1)=VALMHDR(1)_"   "_$E(X,1)_$P(X,U,3)
"RTN","IBJTLA",12,0)
 I $G(DFN) N VAEL,VAERR D ELIG^VADPT S X=$P(VAEL(1),U,2),VALMHDR(1)=VALMHDR(1)_$J(" ",(79-$L(VALMHDR(1))-$L(X)))_X
"RTN","IBJTLA",13,0)
 ; IB*2.0*451 - explanation of EEOB indicator '%' for user
"RTN","IBJTLA",14,0)
 S VALMSG="|r Referred|* MT on Hold |+ Multi Carriers|% EEOB|"
"RTN","IBJTLA",15,0)
 Q
"RTN","IBJTLA",16,0)
 ;
"RTN","IBJTLA",17,0)
INIT ; -- init variables and list array
"RTN","IBJTLA",18,0)
 K ^TMP("IBJTLA",$J),^TMP("IBJTLAX",$J)
"RTN","IBJTLA",19,0)
 I '$G(DFN) S DFN=+$$PAT^IBJTU2 I 'DFN S VALMQUIT="" G INITQ
"RTN","IBJTLA",20,0)
 D BLDA^IBJTLA1
"RTN","IBJTLA",21,0)
INITQ Q
"RTN","IBJTLA",22,0)
 ;
"RTN","IBJTLA",23,0)
HELP ; -- help code
"RTN","IBJTLA",24,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBJTLA",25,0)
 Q
"RTN","IBJTLA",26,0)
 ;
"RTN","IBJTLA",27,0)
EXIT ; -- exit code
"RTN","IBJTLA",28,0)
 K ^TMP("IBJTLA",$J),^TMP("IBJTLAX",$J),IBFASTXT,DFN
"RTN","IBJTLA",29,0)
 D CLEAR^VALM1,CLEAN^VALM10
"RTN","IBJTLA",30,0)
 Q
"RTN","IBJTLA",31,0)
 ;
"RTN","IBJTLA",32,0)
NX(IBTPLNM) ; -- IBJT CLAIM SCREEN ACTIVE action: go to next screen template
"RTN","IBJTLA",33,0)
 ; get user bill selection from Active Bills screen then open Claim Info screen for that bill
"RTN","IBJTLA",34,0)
 ;
"RTN","IBJTLA",35,0)
 N VALMY,IBSELN,IBIFN
"RTN","IBJTLA",36,0)
 D EN^VALM2($G(XQORNOD(0)))
"RTN","IBJTLA",37,0)
 I $D(VALMY) S IBSELN=0 F  S IBSELN=$O(VALMY(IBSELN)) Q:'IBSELN  D
"RTN","IBJTLA",38,0)
 . S IBIFN=$P($G(^TMP("IBJTLAX",$J,IBSELN)),U,2)
"RTN","IBJTLA",39,0)
 . I +IBIFN D EN^VALM(IBTPLNM)
"RTN","IBJTLA",40,0)
 S VALMBCK="R"
"RTN","IBJTLA",41,0)
 Q
"RTN","IBJTLA",42,0)
 ;
"RTN","IBJTLA",43,0)
OPTION ; ENTRY POINT TO THIRD PARTY INQUIRY FROM MENU OPTION, gets patient or bill number then goes to correct screen
"RTN","IBJTLA",44,0)
 ;
"RTN","IBJTLA",45,0)
 N IBX S IBX=$$PB^IBJTU2
"RTN","IBJTLA",46,0)
 I +IBX=1 S DFN=+$P(IBX,U,2) I +DFN D EN^IBJTLA G OPTQ
"RTN","IBJTLA",47,0)
 I +IBX=2 S IBIFN=+$P(IBX,U,2),DFN=+$P($G(^DGCR(399,IBIFN,0)),U,2) I +DFN D EN^IBJTCA G OPTQ
"RTN","IBJTLA",48,0)
OPTQ K DFN,IBIFN,IBFASTXT,IBPRVSCR,VALMBCK
"RTN","IBJTLA",49,0)
 Q
"RTN","IBJTLA1")
0^11^B10714466^B7038251
"RTN","IBJTLA1",1,0)
IBJTLA1 ;ALB/ARH - TPI ACTIVE BILLS LIST BUILD ;2/14/95
"RTN","IBJTLA1",2,0)
 ;;2.0;INTEGRATED BILLING;**39,80,61,51,153,137,183,276,451**;21-MAR-94;Build 47
"RTN","IBJTLA1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTLA1",4,0)
 ;
"RTN","IBJTLA1",5,0)
BLDA ; build active list for third party joint inquiry active list
"RTN","IBJTLA1",6,0)
 N IBIFN,IBCNT S VALMCNT=0,IBCNT=0
"RTN","IBJTLA1",7,0)
 S IBIFN=0 F  S IBIFN=$O(^DGCR(399,"C",DFN,IBIFN)) Q:'IBIFN  I $$ACTIVE^IBJTU4(IBIFN) W "." D SCRN
"RTN","IBJTLA1",8,0)
 ;
"RTN","IBJTLA1",9,0)
 I VALMCNT=0 D SET(" ",0),SET("No Active Bills for this Patient",0)
"RTN","IBJTLA1",10,0)
 ;
"RTN","IBJTLA1",11,0)
 Q
"RTN","IBJTLA1",12,0)
 ;
"RTN","IBJTLA1",13,0)
SCRN ; add bill to screen list (IBIFN,DFN must be defined)
"RTN","IBJTLA1",14,0)
 N X,IBY,IBD0,IBDU,IBDM S X=""
"RTN","IBJTLA1",15,0)
 S IBCNT=IBCNT+1,IBD0=$G(^DGCR(399,+IBIFN,0)),IBDU=$G(^DGCR(399,+IBIFN,"U")),IBDM=$G(^DGCR(399,+IBIFN,"M"))
"RTN","IBJTLA1",16,0)
 S IBY=IBCNT,X=$$SETFLD^VALM1(IBY,X,"NUMBER")
"RTN","IBJTLA1",17,0)
 ; IB*2.0*451 - get EEOB indicator for bill # when applicable
"RTN","IBJTLA1",18,0)
 S IBPFLAG=$$EEOB(+IBIFN)
"RTN","IBJTLA1",19,0)
 S IBY=$S($G(IBPFLAG)'="":"%",1:" ")_$P(IBD0,U,1)_$$ECME^IBTRE(IBIFN),X=$$SETFLD^VALM1(IBY,X,"BILL") ;add EEOB indicator '%' to bill number when applicable
"RTN","IBJTLA1",20,0)
 S IBY=$S($$REF^IBJTU31(+IBIFN):"r",1:""),X=$$SETFLD^VALM1(IBY,X,"REFER")
"RTN","IBJTLA1",21,0)
 S IBY=$S($$IB^IBRUTL(+IBIFN,0):"*",1:""),X=$$SETFLD^VALM1(IBY,X,"HD")
"RTN","IBJTLA1",22,0)
 S IBY=$$DATE($P(IBDU,U,1)),X=$$SETFLD^VALM1(IBY,X,"STFROM")
"RTN","IBJTLA1",23,0)
 S IBY=$$DATE($P(IBDU,U,2)),X=$$SETFLD^VALM1(IBY,X,"STTO")
"RTN","IBJTLA1",24,0)
 ;
"RTN","IBJTLA1",25,0)
 S IBY=$P($$LST^DGMTU(DFN,$P(IBDU,U)),U,4),IBY=$S(IBY="C":"YES",IBY="P":"PEN",IBY="R":"REQ",IBY="G":"GMT",1:"NO"),X=$$SETFLD^VALM1(IBY,X,"MT?")
"RTN","IBJTLA1",26,0)
 S IBY=$$TYPE($P(IBD0,U,5))_$$TF($P(IBD0,U,6)),X=$$SETFLD^VALM1(IBY,X,"TYPE")
"RTN","IBJTLA1",27,0)
 S IBY=" "_$P($$ARSTATA^IBJTU4(IBIFN),U,2),X=$$SETFLD^VALM1(IBY,X,"ARST")
"RTN","IBJTLA1",28,0)
 ;
"RTN","IBJTLA1",29,0)
 S IBY=$P($G(^DGCR(399.3,+$P(IBD0,U,7),0)),U,4),X=$$SETFLD^VALM1(IBY,X,"RATE")
"RTN","IBJTLA1",30,0)
 S IBY=$S($$MINS^IBJTU31(+IBIFN):"+",1:""),X=$$SETFLD^VALM1(IBY,X,"CB")
"RTN","IBJTLA1",31,0)
 S IBY=+$G(^DGCR(399,+IBIFN,"MP"))
"RTN","IBJTLA1",32,0)
 I 'IBY,$$MCRWNR^IBEFUNC($$CURR^IBCEF2(IBIFN)) S IBY=+$$CURR^IBCEF2(IBIFN)
"RTN","IBJTLA1",33,0)
 S IBY=$P($G(^DIC(36,+IBY,0)),U,1)
"RTN","IBJTLA1",34,0)
 S X=$$SETFLD^VALM1(IBY,X,"INSUR")
"RTN","IBJTLA1",35,0)
 S IBY=$$BILL^RCJIBFN2(IBIFN)
"RTN","IBJTLA1",36,0)
 S X=$$SETFLD^VALM1($J(+$P(IBY,U,1),8,2),X,"OAMT")
"RTN","IBJTLA1",37,0)
 S X=$$SETFLD^VALM1($J(+$P(IBY,U,3),8,2),X,"CAMT")
"RTN","IBJTLA1",38,0)
 D SET(X,IBCNT)
"RTN","IBJTLA1",39,0)
 Q
"RTN","IBJTLA1",40,0)
 ;
"RTN","IBJTLA1",41,0)
DATE(X) ; date in external format
"RTN","IBJTLA1",42,0)
 N Y S Y="" I X?7N.E S Y=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBJTLA1",43,0)
 Q Y
"RTN","IBJTLA1",44,0)
 ;
"RTN","IBJTLA1",45,0)
TYPE(X) ; return abbreviated form of Bill Classification (399,.05)
"RTN","IBJTLA1",46,0)
 Q $S(X=1:"IP",X=2:"IH",X=3:"OP",X=4:"OH",1:"")
"RTN","IBJTLA1",47,0)
 ;
"RTN","IBJTLA1",48,0)
TF(X) ; return abbreviated form of Timeframe of Bill (399,.06)
"RTN","IBJTLA1",49,0)
 Q $S(X=2:"-F",X=3:"-C",X=4:"-L",X'=1:"-O",1:"")
"RTN","IBJTLA1",50,0)
 ;
"RTN","IBJTLA1",51,0)
SET(X,CNT) ; set up list manager screen array
"RTN","IBJTLA1",52,0)
 S VALMCNT=VALMCNT+1
"RTN","IBJTLA1",53,0)
 S ^TMP("IBJTLA",$J,VALMCNT,0)=X Q:'CNT
"RTN","IBJTLA1",54,0)
 S ^TMP("IBJTLA",$J,"IDX",VALMCNT,+CNT)=""
"RTN","IBJTLA1",55,0)
 S ^TMP("IBJTLAX",$J,CNT)=VALMCNT_U_IBIFN
"RTN","IBJTLA1",56,0)
 Q
"RTN","IBJTLA1",57,0)
 ;
"RTN","IBJTLA1",58,0)
EEOB(IBIFN) ; get payment information
"RTN","IBJTLA1",59,0)
 ; IB*2.0*451 - find an EOB payment for a bill
"RTN","IBJTLA1",60,0)
 ; input is the IEN for the bill # in file #399 and must be valid,
"RTN","IBJTLA1",61,0)
 ; output is the EEOB indicator '%' if a payment is found in file #361.1,
"RTN","IBJTLA1",62,0)
 ; exclude EOB type MRA (Medicare).
"RTN","IBJTLA1",63,0)
 N IBPFLAG,IBVAL,Z
"RTN","IBJTLA1",64,0)
 I $G(IBIFN)=0 Q ""
"RTN","IBJTLA1",65,0)
 I '$O(^IBM(361.1,"B",IBIFN,0)) Q ""  ; no entry here
"RTN","IBJTLA1",66,0)
 I $P($G(^DGCR(399,IBIFN,0)),"^",13)=1 Q ""  ;avoid 'ENTERED/NOT REVIEWED' status
"RTN","IBJTLA1",67,0)
 ; handle both single and multiple bill entries in file #361.1
"RTN","IBJTLA1",68,0)
 S Z=0 F  S Z=$O(^IBM(361.1,"B",IBIFN,Z)) Q:'Z  D  Q:$G(IBPFLAG)="%"
"RTN","IBJTLA1",69,0)
 . S IBVAL=$G(^IBM(361.1,Z,0))
"RTN","IBJTLA1",70,0)
 . S IBPFLAG=$S($P(IBVAL,"^",4)=1:"",$P(IBVAL,"^",4)=0:"%",1:"")
"RTN","IBJTLA1",71,0)
 Q IBPFLAG  ; EOB indicator for either 1st or 3rd payment on bill
"RTN","IBJTLB")
0^14^B2602328^B2542739
"RTN","IBJTLB",1,0)
IBJTLB ;ALB/ARH - TPI INACTIVE LIST SCREEN ;14-FEB-1995
"RTN","IBJTLB",2,0)
 ;;2.0;INTEGRATED BILLING;**39,61,153,451**;21-MAR-94;Build 47
"RTN","IBJTLB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTLB",4,0)
 ;
"RTN","IBJTLB",5,0)
EN ; -- main entry point for IBJ THIRD PARTY INACTIVE LIST
"RTN","IBJTLB",6,0)
 D EN^VALM("IBJT INACTIVE LIST")
"RTN","IBJTLB",7,0)
 Q
"RTN","IBJTLB",8,0)
 ;
"RTN","IBJTLB",9,0)
HDR ; -- header code
"RTN","IBJTLB",10,0)
 N X S X=$$PT^IBEFUNC(+$G(DFN))
"RTN","IBJTLB",11,0)
 S VALMHDR(1)=$P(X,U,1) I $P(X,U,3)'="" S VALMHDR(1)=VALMHDR(1)_"   "_$E(X,1)_$P(X,U,3)
"RTN","IBJTLB",12,0)
 S VALMHDR(1)=VALMHDR(1)_$J(IBHMSG,(80-$L(VALMHDR(1))))
"RTN","IBJTLB",13,0)
 ; IB*2.0*451 - explanation of EEOB indicator '%' for user
"RTN","IBJTLB",14,0)
 S VALMSG="|r Referred|* MT on Hold |+ Multi Carriers|% EEOB|"
"RTN","IBJTLB",15,0)
 Q
"RTN","IBJTLB",16,0)
 ;
"RTN","IBJTLB",17,0)
INIT ; -- init variables and list array
"RTN","IBJTLB",18,0)
 K ^TMP("IBJTLB",$J),^TMP("IBJTLBX",$J)
"RTN","IBJTLB",19,0)
 I '$G(DFN) S DFN=+$$PAT^IBJTU2 I 'DFN S VALMQUIT="" G INITQ
"RTN","IBJTLB",20,0)
 D BLDA^IBJTLB1
"RTN","IBJTLB",21,0)
INITQ Q
"RTN","IBJTLB",22,0)
 ;
"RTN","IBJTLB",23,0)
HELP ; -- help code
"RTN","IBJTLB",24,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBJTLB",25,0)
 Q
"RTN","IBJTLB",26,0)
 ;
"RTN","IBJTLB",27,0)
EXIT ; -- exit code
"RTN","IBJTLB",28,0)
 K ^TMP("IBJTLB",$J),^TMP("IBJTLBX",$J),IBBEG,IBEND,IBHMSG
"RTN","IBJTLB",29,0)
 D CLEAR^VALM1
"RTN","IBJTLB",30,0)
 Q
"RTN","IBJTLB",31,0)
 ;
"RTN","IBJTLB",32,0)
DATE(X) ;
"RTN","IBJTLB",33,0)
 Q $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBJTLB",34,0)
 ;
"RTN","IBJTLB",35,0)
NX(IBTPLNM) ; -- IBJT CLAIM SCREEN INACTIVE action:  go to next screen template
"RTN","IBJTLB",36,0)
 ;            get user bill selection from Inactive Bills list then open Claim Info screen for that bill
"RTN","IBJTLB",37,0)
 ;
"RTN","IBJTLB",38,0)
 N VALMY,IBSELN,IBIFN
"RTN","IBJTLB",39,0)
 D EN^VALM2($G(XQORNOD(0)))
"RTN","IBJTLB",40,0)
 I $D(VALMY) S IBSELN=0 F  S IBSELN=$O(VALMY(IBSELN)) Q:'IBSELN  D
"RTN","IBJTLB",41,0)
 . S IBIFN=$P($G(^TMP("IBJTLBX",$J,IBSELN)),U,2)
"RTN","IBJTLB",42,0)
 . I +IBIFN D EN^VALM(IBTPLNM)
"RTN","IBJTLB",43,0)
 S VALMBCK="R"
"RTN","IBJTLB",44,0)
 Q
"RTN","IBJTLB1")
0^15^B11067077^B10448877
"RTN","IBJTLB1",1,0)
IBJTLB1 ;ALB/ARH - TPI INACTIVE LIST BUILD ;2/14/95
"RTN","IBJTLB1",2,0)
 ;;2.0;INTEGRATED BILLING;**39,80,61,137,276,451**;21-MAR-94;Build 47
"RTN","IBJTLB1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTLB1",4,0)
 ;
"RTN","IBJTLB1",5,0)
BLDA ; build active list for third party joint inquiry active list, DFN must be defined
"RTN","IBJTLB1",6,0)
 ; first search starts at dt and works backwards for 6 months of bills or IBMAXCNT bills, whichever is greater
"RTN","IBJTLB1",7,0)
 ; all bills for a single day are included in the same search so even IBMAXCNT may be exceeded
"RTN","IBJTLB1",8,0)
 ; if IBEND is defined on entry it is used as the end dt of the search, otherwise DT is used
"RTN","IBJTLB1",9,0)
 ; IBBEG is left defined on exit, if it has a value then it is used by the Change Dates action to define the next
"RTN","IBJTLB1",10,0)
 ; end date of the search, this results in each CD action default working backwards through the date range until
"RTN","IBJTLB1",11,0)
 ; no bills are found and IBBEG is null then search restarts at DT, IBEND is defined so can tell if range changed
"RTN","IBJTLB1",12,0)
 N IBIFN,IBCNT,IBBDT,IBEDT,IBFIRST,IBLAST,IBDT1,IBDT2,IBMAXCNT K IBHMSG
"RTN","IBJTLB1",13,0)
 S IBEDT=$S(+$G(IBEND):IBEND,1:DT),IBBDT=$$FMADD^XLFDT(IBEDT,-180),IBMAXCNT=52
"RTN","IBJTLB1",14,0)
 ;
"RTN","IBJTLB1",15,0)
 S (VALMCNT,IBCNT)=0,IBDT1=$S(IBEDT'="":-(IBEDT+.01),1:""),IBDT2=-IBBDT
"RTN","IBJTLB1",16,0)
 S IBFIRST=IBBDT,IBLAST=-$O(^DGCR(399,"APDS",DFN,""))
"RTN","IBJTLB1",17,0)
 ;
"RTN","IBJTLB1",18,0)
 F  S IBDT1=$O(^DGCR(399,"APDS",DFN,IBDT1)) Q:'IBDT1!(IBDT1>IBDT2&(IBCNT'<IBMAXCNT))  S IBFIRST=-IBDT1 D
"RTN","IBJTLB1",19,0)
 . S IBIFN=0 F  S IBIFN=$O(^DGCR(399,"APDS",DFN,IBDT1,IBIFN)) Q:'IBIFN  I '$$ACTIVE^IBJTU4(IBIFN) D SCRN W "."
"RTN","IBJTLB1",20,0)
 ;
"RTN","IBJTLB1",21,0)
 S IBBEG=$S('IBDT1:"",IBBDT>IBFIRST:IBFIRST,1:IBBDT),IBBDT=$S(+IBBEG:$$DATE(IBBEG),1:"BEGIN")
"RTN","IBJTLB1",22,0)
 S IBEND=$S(IBEDT=""!(IBLAST'>IBEDT):"",1:IBEDT),IBEDT=$S(+IBEND:$$DATE(IBEND),1:"END")
"RTN","IBJTLB1",23,0)
 ;
"RTN","IBJTLB1",24,0)
 I 'IBBEG,'IBEND S IBHMSG="** All Inactive Bills **"
"RTN","IBJTLB1",25,0)
 I $G(IBHMSG)="" S IBHMSG=IBBDT_" - "_IBEDT
"RTN","IBJTLB1",26,0)
 S IBHMSG=IBHMSG_"   ("_VALMCNT_")"
"RTN","IBJTLB1",27,0)
 ;
"RTN","IBJTLB1",28,0)
 I VALMCNT=0 D SET(" ",0),SET("No Inactive Bills for this Patient",0)
"RTN","IBJTLB1",29,0)
 ;
"RTN","IBJTLB1",30,0)
 Q
"RTN","IBJTLB1",31,0)
 ;
"RTN","IBJTLB1",32,0)
SCRN ; add bill to screen list (IBIFN,DFN must be defined)
"RTN","IBJTLB1",33,0)
 N X,IBY,IBD0,IBDU,IBDM S X=""
"RTN","IBJTLB1",34,0)
 S IBCNT=IBCNT+1,IBD0=$G(^DGCR(399,+IBIFN,0)),IBDU=$G(^DGCR(399,+IBIFN,"U")),IBDM=$G(^DGCR(399,+IBIFN,"M"))
"RTN","IBJTLB1",35,0)
 S IBY=IBCNT,X=$$SETFLD^VALM1(IBY,X,"NUMBER")
"RTN","IBJTLB1",36,0)
 ; IB*2.0*451 - get EEOB indicator for bill # when applicable
"RTN","IBJTLB1",37,0)
 S IBPFLAG=$$EEOB^IBJTLA1(+IBIFN)
"RTN","IBJTLB1",38,0)
 S IBY=$P(IBD0,U,1)_$$ECME^IBTRE(IBIFN),X=$$SETFLD^VALM1(IBY,X,"BILL")
"RTN","IBJTLB1",39,0)
 S IBY=$S($G(IBPFLAG)'="":"%",1:" ")_IBY,X=$$SETFLD^VALM1(IBY,X,"BILL")
"RTN","IBJTLB1",40,0)
 S IBY=$S($$REF^IBJTU31(+IBIFN):"r",1:""),X=$$SETFLD^VALM1(IBY,X,"REFER")
"RTN","IBJTLB1",41,0)
 S IBY=$S($$IB^IBRUTL(+IBIFN,0):"*",1:""),X=$$SETFLD^VALM1(IBY,X,"HD")
"RTN","IBJTLB1",42,0)
 S IBY=$$DATE($P(IBDU,U,1)),X=$$SETFLD^VALM1(IBY,X,"STFROM")
"RTN","IBJTLB1",43,0)
 S IBY=$$DATE($P(IBDU,U,2)),X=$$SETFLD^VALM1(IBY,X,"STTO")
"RTN","IBJTLB1",44,0)
 ;
"RTN","IBJTLB1",45,0)
 S IBY=$$TYPE($P(IBD0,U,5))_$$TF($P(IBD0,U,6)),X=$$SETFLD^VALM1(IBY,X,"TYPE")
"RTN","IBJTLB1",46,0)
 S IBY=" "_$P($$ARSTATA^IBJTU4(IBIFN),U,2),X=$$SETFLD^VALM1(IBY,X,"ARST")
"RTN","IBJTLB1",47,0)
 ;
"RTN","IBJTLB1",48,0)
 S IBY=$P($G(^DGCR(399.3,+$P(IBD0,U,7),0)),U,4),X=$$SETFLD^VALM1(IBY,X,"RATE")
"RTN","IBJTLB1",49,0)
 S IBY=$S($$MINS^IBJTU31(IBIFN):"+",1:""),X=$$SETFLD^VALM1(IBY,X,"CB")
"RTN","IBJTLB1",50,0)
 S IBY=+$G(^DGCR(399,+IBIFN,"MP"))
"RTN","IBJTLB1",51,0)
 I 'IBY,$$MCRWNR^IBEFUNC(+$$CURR^IBCEF2(IBIFN)) S IBY=+$$CURR^IBCEF2(IBIFN)
"RTN","IBJTLB1",52,0)
 S IBY=$P($G(^DIC(36,+IBY,0)),U,1),X=$$SETFLD^VALM1(IBY,X,"INSUR")
"RTN","IBJTLB1",53,0)
 S IBY=$$BILL^RCJIBFN2(IBIFN)
"RTN","IBJTLB1",54,0)
 S X=$$SETFLD^VALM1($J(+$P(IBY,U,1),8,2),X,"OAMT")
"RTN","IBJTLB1",55,0)
 S X=$$SETFLD^VALM1($J(+$P(IBY,U,3),8,2),X,"CAMT")
"RTN","IBJTLB1",56,0)
 D SET(X,IBCNT)
"RTN","IBJTLB1",57,0)
 Q
"RTN","IBJTLB1",58,0)
 ;
"RTN","IBJTLB1",59,0)
DATE(X) ; date in external format
"RTN","IBJTLB1",60,0)
 Q $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBJTLB1",61,0)
 ;
"RTN","IBJTLB1",62,0)
TYPE(X) ; return abbreviated form of Bill Classification (399,.05)
"RTN","IBJTLB1",63,0)
 Q $S(X=1:"IP",X=2:"IH",X=3:"OP",X=4:"OH",1:"")
"RTN","IBJTLB1",64,0)
 ;
"RTN","IBJTLB1",65,0)
TF(X) ; return abbreviated form of Timeframe of Bill (399,.06)
"RTN","IBJTLB1",66,0)
 Q $S(X=2:"-F",X=3:"-C",X=4:"-L",X'=1:"-O",1:"")
"RTN","IBJTLB1",67,0)
 ;
"RTN","IBJTLB1",68,0)
SET(X,CNT) ; set up list manager screen array
"RTN","IBJTLB1",69,0)
 S VALMCNT=VALMCNT+1
"RTN","IBJTLB1",70,0)
 S ^TMP("IBJTLB",$J,VALMCNT,0)=X Q:'CNT
"RTN","IBJTLB1",71,0)
 S ^TMP("IBJTLB",$J,"IDX",VALMCNT,+CNT)=""
"RTN","IBJTLB1",72,0)
 S ^TMP("IBJTLBX",$J,CNT)=VALMCNT_U_IBIFN
"RTN","IBJTLB1",73,0)
 Q
"RTN","IBJTU1")
0^9^B7894877^B6991546
"RTN","IBJTU1",1,0)
IBJTU1 ;ALB/ARH - TPI UTILITIES ;2/14/95
"RTN","IBJTU1",2,0)
 ;;2.0;INTEGRATED BILLING;**39,80,276,451**;21-MAR-94;Build 47
"RTN","IBJTU1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTU1",4,0)
 ;
"RTN","IBJTU1",5,0)
PRVSCR(SCRNARR) ; called as part of a screen ACTION PROTOCOL'S ENTRY ACTION to determine if screen has already been displayed
"RTN","IBJTU1",6,0)
 ; returns true if screen array already exists (ie. already displayed), 
"RTN","IBJTU1",7,0)
 ; setting IBFASTXT causes LM to back out of current screens,
"RTN","IBJTU1",8,0)
 ; setting IBPRVSCR causes LM to stop exiting screens when the chosen screen is reached
"RTN","IBJTU1",9,0)
 ; if user tries to execute a screen already displayed it will quit out of existing screens until the asked for screen is found
"RTN","IBJTU1",10,0)
 N X S X=0,IBPRVSCR="" I $G(SCRNARR)'="",$D(^TMP(SCRNARR,$J)) S X=1,IBPRVSCR=SCRNARR,IBFASTXT=3
"RTN","IBJTU1",11,0)
 Q X
"RTN","IBJTU1",12,0)
 ;
"RTN","IBJTU1",13,0)
HDR(IBIFN,DFN,LNS) ; called by a screens's LIST TEMPLATE HEADER to get lines for header, used for all TP screens
"RTN","IBJTU1",14,0)
 ;input:  LNS=header lines to add  ---  defined on exit: VALMHDR array
"RTN","IBJTU1",15,0)
 ;
"RTN","IBJTU1",16,0)
 N X,Y,Z,IBD0,IBPD0,IBDI1,IBCNT S IBIFN=+$G(IBIFN),DFN=+$G(DFN),LNS=+$G(LNS) K VALMHDR
"RTN","IBJTU1",17,0)
 S IBCNT=0,IBD0=$G(^DGCR(399,+IBIFN,0)),IBPD0=$G(^DPT(+DFN,0))
"RTN","IBJTU1",18,0)
 S IBDI1=$P(IBD0,U,21),IBDI1=$S(IBDI1="S":"I2",IBDI1="T":"I3",1:"I1"),IBDI1=$G(^DGCR(399,+IBIFN,IBDI1))
"RTN","IBJTU1",19,0)
 ;
"RTN","IBJTU1",20,0)
1 I LNS'[1 G 2
"RTN","IBJTU1",21,0)
 ; -- first line of screens: BILL NUMBER, PAT NAME, PAT ID, DOB, SUBSCRIBER ID
"RTN","IBJTU1",22,0)
 N IBBILL,IBPAT,IBPATID,IBDOB,IBSUB,IBPNWDTH S IBCNT=IBCNT+1,(IBSUB,IBPATID)=""
"RTN","IBJTU1",23,0)
 S IBBILL=$P(IBD0,U,1)_$$ECME^IBTRE(IBIFN)
"RTN","IBJTU1",24,0)
 S X=$$PT^IBEFUNC(DFN),IBPAT=$P(X,U,1) I $P(X,U,3)'="" S IBPATID=$E(X)_$P(X,U,3)
"RTN","IBJTU1",25,0)
 S IBDOB="DOB: "_$$DATE^IBJU1($P(IBPD0,U,3))
"RTN","IBJTU1",26,0)
 I +IBIFN S X=$P(IBDI1,U,2),X=X_$J("",(13-$L(X))),IBSUB="Subsc ID: "_X
"RTN","IBJTU1",27,0)
 ;
"RTN","IBJTU1",28,0)
 ; IB*2.0*451 - get EEOB indicator for bill #
"RTN","IBJTU1",29,0)
 S IBPFLAG=$$EEOB^IBJTLA1(IBIFN)
"RTN","IBJTU1",30,0)
 S IBBILL=$G(IBPFLAG)_IBBILL
"RTN","IBJTU1",31,0)
 S IBPNWDTH=80-($L(IBBILL)+3+2+$L(IBPATID)+3+$L(IBDOB)+3+$L(IBSUB)),IBPAT=$E(IBPAT,1,IBPNWDTH),Z="   "
"RTN","IBJTU1",32,0)
 S VALMHDR(IBCNT)=IBBILL_Z_IBPAT_"  "_IBPATID_$J("",(IBPNWDTH-$L(IBPAT)))_Z_IBDOB_Z_IBSUB
"RTN","IBJTU1",33,0)
 ; IB*2.0*451 - add explanation of '%' indicator for the user
"RTN","IBJTU1",34,0)
 S VALMSG="|% EEOB | Enter ?? for more actions|"
"RTN","IBJTU1",35,0)
2 I LNS'[2 G 3
"RTN","IBJTU1",36,0)
 ; -- bill screens line 2: STATEMENT DATES, TIMEFRAME, ORIG AMT (AR)
"RTN","IBJTU1",37,0)
 N IBDU S IBCNT=IBCNT+1,IBDU=$G(^DGCR(399,+IBIFN,"U"))
"RTN","IBJTU1",38,0)
 S X=" "_$$DATE^IBJU1(+IBDU)_" - "_$$DATE^IBJU1(+$P(IBDU,U,2)),VALMHDR(IBCNT)=X_$J("",(28-$L(X)))
"RTN","IBJTU1",39,0)
 S X=$$EXSET^IBJU1(+$P(IBD0,U,6),399,.06),VALMHDR(IBCNT)=VALMHDR(IBCNT)_X_$J("",(29-$L(X)))
"RTN","IBJTU1",40,0)
 S X=$$BILL^RCJIBFN2(IBIFN),X="Orig Amt: "_$FN($P(X,U,1),",",2),VALMHDR(IBCNT)=VALMHDR(IBCNT)_X
"RTN","IBJTU1",41,0)
 ; IB*2.0*451 - add explanation of '%' indicator for the user
"RTN","IBJTU1",42,0)
 S VALMSG="|% EEOB | Enter ?? for more actions|"
"RTN","IBJTU1",43,0)
3 I LNS'[3 G HDRQ
"RTN","IBJTU1",44,0)
 ; -- AR screens line 2: CURRENT STATUS (AR), ORIGINAL AMT (AR), CURRENT AMT (AR)
"RTN","IBJTU1",45,0)
 N IBST,IBOC,IBBD,IBY S IBCNT=IBCNT+1,IBY=$$BILL^RCJIBFN2(+IBIFN)
"RTN","IBJTU1",46,0)
 S IBST="AR Status: "_$P($$ARSTATA^IBJTU4(+IBIFN),U,1)
"RTN","IBJTU1",47,0)
 S IBOC="Orig Amt: "_$FN($P(IBY,U,1),",",2)
"RTN","IBJTU1",48,0)
 S IBBD="Balance Due: "_$FN($P(IBY,U,3),",",2)
"RTN","IBJTU1",49,0)
 ;
"RTN","IBJTU1",50,0)
 S X="  "_IBOC_$J("",(20-$L(IBOC)))_" "_IBBD_$J("",(23-$L(IBBD))),Y=80-$L(X),IBST=$E(IBST,1,Y)
"RTN","IBJTU1",51,0)
 S VALMHDR(IBCNT)=IBST_$J("",(Y-$L(IBST)))_X
"RTN","IBJTU1",52,0)
 ;
"RTN","IBJTU1",53,0)
HDRQ Q
"RTN","IBOA31")
0^5^B19354784^B15589530
"RTN","IBOA31",1,0)
IBOA31 ;ALB/AAS - PRINT ALL BILLS FOR A PATIENT ;04/18/90
"RTN","IBOA31",2,0)
 ;;2.0;INTEGRATED BILLING;**95,199,433,451**;21-MAR-94;Build 47
"RTN","IBOA31",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBOA31",4,0)
 ;
"RTN","IBOA31",5,0)
 ;MAP TO DGCRA31
"RTN","IBOA31",6,0)
EN ;
"RTN","IBOA31",7,0)
 ;***
"RTN","IBOA31",8,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOA31" D T1^%ZOSV ;stop rt clock
"RTN","IBOA31",9,0)
 ;S XRTL=$ZU(0),XRTN="IBOA31-1" D T0^%ZOSV ;start rt clock
"RTN","IBOA31",10,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBOA31",11,0)
 S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC K DIC Q:Y<1  S DFN=+Y
"RTN","IBOA31",12,0)
 S DIR(0)="Y",DIR("A")="Include Pharmacy Co-Pay charges on this report",DIR("B")="NO"
"RTN","IBOA31",13,0)
 S DIR("?",1)="    Enter:  'Y'  -  To include Pharmacy Co-pay charges on this report"
"RTN","IBOA31",14,0)
 S DIR("?",2)="            'N'  -  To exclude Pharmacy Co-pay charges on this report"
"RTN","IBOA31",15,0)
 S DIR("?")="            '^'  -  To select a new patient"
"RTN","IBOA31",16,0)
 D ^DIR K DIR G:$D(DIRUT) END S IBIBRX=Y
"RTN","IBOA31",17,0)
 W !,"You will need a 132 column printer for this report."
"RTN","IBOA31",18,0)
 S %ZIS="QM" D ^%ZIS G:POP ENQ
"RTN","IBOA31",19,0)
 I $D(IO("Q")) K IO("Q") D  G ENQ
"RTN","IBOA31",20,0)
 .S ZTDESC="IB - PRINT ALL BILLS FOR A PATIENT",ZTRTN="DQ^IBOA31",ZTSAVE("DFN")="",ZTSAVE("IB*")=""
"RTN","IBOA31",21,0)
 .D ^%ZTLOAD K ZTSK D HOME^%ZIS
"RTN","IBOA31",22,0)
 ;
"RTN","IBOA31",23,0)
 ;***
"RTN","IBOA31",24,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOA31" D T1^%ZOSV ;stop rt clock
"RTN","IBOA31",25,0)
DQ ;
"RTN","IBOA31",26,0)
 ;***
"RTN","IBOA31",27,0)
 ;S XRTL=$ZU(0),XRTN="IBOA31-2" D T0^%ZOSV ;start rt clock
"RTN","IBOA31",28,0)
 U IO S IBPAG=0 D NOW^%DTC S Y=% X ^DD("DD") S IBNOW=Y,$P(IBLINE,"-",IOM+1)=""
"RTN","IBOA31",29,0)
 S IBQUIT=0,IBN=$$PT^IBEFUNC(DFN) D UTIL^IBCA3,UTIL^IBOA32
"RTN","IBOA31",30,0)
 I '$D(^UTILITY($J)) W !,"No Bills On File for ",$P(IBN,"^"),"  SSN: ",$P(IBN,"^",2),"." G ENQ
"RTN","IBOA31",31,0)
 D HDR1 S (IBDT,IBIFN)=""
"RTN","IBOA31",32,0)
 ; - loop through all bills
"RTN","IBOA31",33,0)
 F  S IBDT=$O(^UTILITY($J,IBDT)) Q:IBDT=""!(IBQUIT)  D
"RTN","IBOA31",34,0)
 . F  S IBIFN=$O(^UTILITY($J,IBDT,IBIFN)) Q:IBIFN=""!(IBQUIT)  D @($S($E(IBIFN,$L(IBIFN))="X":"^IBOA32",1:"ONE"))
"RTN","IBOA31",35,0)
 D:'IBQUIT PAUSE
"RTN","IBOA31",36,0)
ENQ W ! G END
"RTN","IBOA31",37,0)
 ;
"RTN","IBOA31",38,0)
ONE D GVAR^IBCBB
"RTN","IBOA31",39,0)
 D:($Y>(IOSL-5)) HDR Q:IBQUIT
"RTN","IBOA31",40,0)
 ; IB*2.0*451 - get 1st/3rd party payment EEOB indicator and add to bill when applicable
"RTN","IBOA31",41,0)
 S IBIFN=+$O(^DGCR(399,"B",IBBNO,0)),IBPFLAG=$$EEOB(IBIFN)
"RTN","IBOA31",42,0)
 W !,$G(IBPFLAG)_IBBNO,?9,$$DAT1^IBOUTL($P(IBNDS,"^",12)),?19,$P($G(^DGCR(399.3,+IBAT,0)),"^")
"RTN","IBOA31",43,0)
 W ?38,$E($S(IBCL=1:"INPATIENT",IBCL=2:"HUMANIT. (INPT)",IBCL=3:"OUTPATIENT",IBCL=4:"HUMANIT. (OPT)",1:""),1,14),?55
"RTN","IBOA31",44,0)
 F I=$S(IBCL<3!('$O(^DGCR(399,IBIFN,"OP",0))):IBEVDT,1:$O(^DGCR(399,IBIFN,"OP",0))),IBFDT,IBTDT W $S(I]"":$$DAT1^IBOUTL(I)_"  ",1:"          ")
"RTN","IBOA31",45,0)
 S X=+$$TPR^PRCAFN(IBIFN) W $J($S(X<0:0,1:X),8,2)
"RTN","IBOA31",46,0)
 W ?95,$S(IBST=1:"ENTERED/NOT REV.",IBST=2:"REVIEWED",IBST=3:"AUTHORIZED",IBST=4:"PRINTED",IBST=7:"CANCELLED",1:"")
"RTN","IBOA31",47,0)
 W ?112,$P("NON-PAYMENT/ZERO^ADMIT - DISCHARGE^INTERIM - FIRST^INTERIM - CONTINUING^INTERIM - LAST^LATE CHARGE(S) ONLY^ADJUSTMENT OF PRIOR^REPLACEMENT OF PRIOR","^",(IBTF+1))
"RTN","IBOA31",48,0)
 ; - print remaining outpatient visit dates
"RTN","IBOA31",49,0)
 S IBOPD=$O(^DGCR(399,IBIFN,"OP",0)) Q:'IBOPD
"RTN","IBOA31",50,0)
 F  S IBOPD=$O(^DGCR(399,IBIFN,"OP",IBOPD)) Q:'IBOPD  D  Q:IBQUIT
"RTN","IBOA31",51,0)
 . D:($Y>(IOSL-5)) HDR Q:IBQUIT  W !?55,$$DAT1^IBOUTL(IBOPD)
"RTN","IBOA31",52,0)
 Q
"RTN","IBOA31",53,0)
 ;
"RTN","IBOA31",54,0)
HDR I $E(IOST,1,2)["C-" D PAUSE Q:IBQUIT
"RTN","IBOA31",55,0)
HDR1 S IBPAG=IBPAG+1 W:$E(IOST,1,2)["C-"!(IBPAG>1) @IOF
"RTN","IBOA31",56,0)
 W "List of all Bills for ",$P(IBN,"^"),"  SSN: ",$P(IBN,"^",2),"  ",?(IOM-31),IBNOW,"  PAGE ",IBPAG
"RTN","IBOA31",57,0)
 W !,"BILL",?10,"DATE",?55,"DATE OF",?64,"STATEMENT  STATEMENT   AMOUNT"
"RTN","IBOA31",58,0)
 W !,"NO.      PRINTED   ACTION/RATE TYPE   CLASSIFICATION   CARE   "
"RTN","IBOA31",59,0)
 W $S(IBIBRX=1:"  FR/FL DT   TO/RL DT",1:"  FROM DATE  TO DATE")
"RTN","IBOA31",60,0)
 W "  COLLECTED  STATUS          TIMEFRAME OF BILL"
"RTN","IBOA31",61,0)
 W !,IBLINE
"RTN","IBOA31",62,0)
 W:IBIBRX !,?53,"'*' = outpt visit on same day as Rx fill date",!,IBLINE
"RTN","IBOA31",63,0)
 Q
"RTN","IBOA31",64,0)
 ;
"RTN","IBOA31",65,0)
PAUSE S IBX1="" R:$E(IOST,1,2)["C-" !!!,"Enter ""^"" to quit, or return to continue",IBX1:DTIME S IBQUIT=$S(IBX1["^":1,1:0) Q
"RTN","IBOA31",66,0)
 ;
"RTN","IBOA31",67,0)
END K ^UTILITY($J)
"RTN","IBOA31",68,0)
 ;***
"RTN","IBOA31",69,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOA31" D T1^%ZOSV ;stop rt clock
"RTN","IBOA31",70,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBOA31",71,0)
 D END^IBCBB1
"RTN","IBOA31",72,0)
 K IBIFN1,IBQUIT,IBX1,IBDT,IBCNT,IBN,DFN,IBIFN,IBLINE,IBNOW,IBPAG,IBOPD,IBIBRX,DIRUT,DUOUT,DTOUT,X,Y
"RTN","IBOA31",73,0)
 K IBRDT,IBRF,IBRX
"RTN","IBOA31",74,0)
 D ^%ZISC G EN
"RTN","IBOA31",75,0)
 ;
"RTN","IBOA31",76,0)
EEOB(IBIFN) ; --
"RTN","IBOA31",77,0)
 ; IB*2.0*451 - find an EOB payment for bill
"RTN","IBOA31",78,0)
 ; IBIFN is the IEN of the bill # in file #399 and must be valid
"RTN","IBOA31",79,0)
 ; check the EOB type in file #361.1 and exclude MRA type (Medicare). Otherwise return
"RTN","IBOA31",80,0)
 ; the EEOB indicator '%' if payment activity was found in file #361.1
"RTN","IBOA31",81,0)
 N IBPFLAG,IBVAL,Z
"RTN","IBOA31",82,0)
 I $G(IBIFN)=0 Q ""
"RTN","IBOA31",83,0)
 I '$O(^IBM(361.1,"B",IBIFN,0)) Q ""  ; no entry here
"RTN","IBOA31",84,0)
 I $P($G(^DGCR(399,IBIFN,0)),"^",13)=1 Q ""  ;avoid 'ENTERED/NOT REVIEWED' status
"RTN","IBOA31",85,0)
 ; handle both single and multiple bill entries in file #361.1
"RTN","IBOA31",86,0)
 S Z=0 F  S Z=$O(^IBM(361.1,"B",IBIFN,Z)) Q:'Z  D  Q:$G(IBPFLAG)="%"
"RTN","IBOA31",87,0)
 . S IBVAL=$G(^IBM(361.1,Z,0))
"RTN","IBOA31",88,0)
 . S IBPFLAG=$S($P(IBVAL,"^",4)=1:"",$P(IBVAL,"^",4)=0:"%",1:"")
"RTN","IBOA31",89,0)
 Q IBPFLAG  ; EEOB indicator for either 1st or 3rd party payment on bill
"RTN","IBOA31",90,0)
 ;
"RTN","IBOA32")
0^6^B7690123^B6792943
"RTN","IBOA32",1,0)
IBOA32 ;ALB/CPM - PRINT ALL BILLS FOR A PATIENT (CON'T) ;28-JAN-92
"RTN","IBOA32",2,0)
 ;;2.0;INTEGRATED BILLING;**7,95,347,433,451**;21-MAR-94;Build 47
"RTN","IBOA32",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBOA32",4,0)
 ;
"RTN","IBOA32",5,0)
 ;MAP TO DGCRA32
"RTN","IBOA32",6,0)
 ;
"RTN","IBOA32",7,0)
 ; Print out IB Actions onto the list.
"RTN","IBOA32",8,0)
 D:($Y>(IOSL-5)) HDR^IBOA31 Q:IBQUIT
"RTN","IBOA32",9,0)
 N IBND,IBND1,X,IBX,IENS,IBRXN,IBRX,IBRF,IBRDT,IBPFLAG
"RTN","IBOA32",10,0)
 S IBND=$G(^IB($E(IBIFN,1,$L(IBIFN)-1),0)),IBND1=$G(^(1))
"RTN","IBOA32",11,0)
 S (IBRXN,IBRX,IBRF,IBRDT,IBX)=0
"RTN","IBOA32",12,0)
 I $P(IBND,"^",4)["52:" S IBRXN=$P($P(IBND,"^",4),":",2),IBRX=$P($P(IBND,"^",8),"-"),IBRF=$P($P(IBND,"^",4),":",3)
"RTN","IBOA32",13,0)
 I IBRF>0 S IBRDT=$$SUBFILE^IBRXUTL(+IBRXN,IBRF,52,.01)
"RTN","IBOA32",14,0)
 E  S IBRDT=$$FILE^IBRXUTL(+IBRXN,22),IBX=$$APPT^IBCU3(IBRDT,DFN)
"RTN","IBOA32",15,0)
 ; IB*2.0*451 - Check for EEOB on associated 3rd party bills and attach EOB indicator '%' if applicable
"RTN","IBOA32",16,0)
 S IBPFLAG="" I $P(IBND,"^",11)'="" S IBPFLAG=$$IBEEOBCK^IBJDF41($P(IBND,"^",11),DFN)  ; Pass AR BILL#, Pat ID
"RTN","IBOA32",17,0)
 W !,IBPFLAG,$S($P(IBND,"^",11)]"":$P($P(IBND,"^",11),"-",2),$P(IBND,"^",5)=99:"",$P(IBND,"^",5)=10:"",1:"Pending")
"RTN","IBOA32",18,0)
 ; IB*2.0*451 - make space for EEOB indicator '%' next to the bill #
"RTN","IBOA32",19,0)
 W ?9,$$DAT1^IBOUTL($S($P(IBND,"^",11)="":"",$P(IBND,"^",5)>2&($P(IBND,"^",5)'=99):$P(IBND1,"^",4)\1,1:""))
"RTN","IBOA32",20,0)
 S X=$P($P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^")," ",2,99)
"RTN","IBOA32",21,0)
 W ?19,$E($P(X," ",1,$L(X," ")-1),1,17)
"RTN","IBOA32",22,0)
 W ?38,$E($S($P(IBND,"^",4)["350:":$E($P(IBND,"^",8),1,14),$P(IBND,"^",3)<7:"Rx:"_IBRX_$S(IBRF>0:"("_IBRF_")",1:""),$P(IBND1,"^",5):"CHAMPVA SUBSIST",1:"AUT MEANS TEST"),1,14)
"RTN","IBOA32",23,0)
 W:IBX=1 ?54,"*"
"RTN","IBOA32",24,0)
 W ?55,$$DAT1^IBOUTL(-IBDT)
"RTN","IBOA32",25,0)
 W ?65,$$DAT1^IBOUTL($S(IBRXN>0:IBRDT,$P(IBND,"^",14):$P(IBND,"^",14),1:$P(IBND1,"^",2)\1))
"RTN","IBOA32",26,0)
 W ?75,$$DAT1^IBOUTL($S($P(IBND,"^",15):$P(IBND,"^",15),1:$P(IBND1,"^",2)\1))
"RTN","IBOA32",27,0)
 W ?90,"N/A",?95,$E($P($G(^IBE(350.21,+$P(IBND,"^",5),0)),"^",2),1,17)
"RTN","IBOA32",28,0)
 Q
"RTN","IBOA32",29,0)
 ;
"RTN","IBOA32",30,0)
UTIL ; Gather all IB Actions for a patient.
"RTN","IBOA32",31,0)
 N DATE,IBN,X,A,B,C,D,E,IBNX
"RTN","IBOA32",32,0)
 S IBN=0 F  S IBN=$O(^IB("C",DFN,IBN)) Q:'IBN  S X=$G(^IB(IBN,0)) D:X
"RTN","IBOA32",33,0)
 . I 'IBIBRX,$E($G(^IBE(350.1,+$P(X,"^",3),0)),1,3)="PSO" Q
"RTN","IBOA32",34,0)
 . Q:$P(X,"^",8)["ADMISSION"
"RTN","IBOA32",35,0)
 . Q:'$D(^IB("APDT",IBN))
"RTN","IBOA32",36,0)
 . S (C,D)="",C=$O(^IB("APDT",IBN,C)),D=$O(^IB("APDT",IBN,C,D))
"RTN","IBOA32",37,0)
 . S E=$P($G(^IB(D,0)),U,3)
"RTN","IBOA32",38,0)
 . S A=$P($G(^IBE(350.1,E,0)),U,5)
"RTN","IBOA32",39,0)
 . S IBNX=$S(A=2:$P($Q(^IB("APDT",IBN,C,D)),")",1),A=3:$P($Q(^IB("APDT",IBN,C,D)),")",1),1:IBN)
"RTN","IBOA32",40,0)
 . I (A=2)!(A=3) D
"RTN","IBOA32",41,0)
 .. I IBNX["[""" S IBNX="^"_$P(IBNX,"]",2)
"RTN","IBOA32",42,0)
 . I $P(IBNX,",",4)>0 S IBNX=$P(IBNX,",",4)
"RTN","IBOA32",43,0)
 . S DATE=$P($G(^IB(+$P(X,"^",16),0)),"^",17)
"RTN","IBOA32",44,0)
 . S:'DATE DATE=$P($G(^IB(IBNX,1)),"^",5)
"RTN","IBOA32",45,0)
 . S:'DATE DATE=$P($G(^IB(IBNX,1)),"^",2)\1
"RTN","IBOA32",46,0)
 . S:DATE ^UTILITY($J,-DATE,IBNX_"X")=""
"RTN","IBOA32",47,0)
 Q
"RTN","IBOTR2")
0^7^B18730525^B17329987
"RTN","IBOTR2",1,0)
IBOTR2 ;ALB/CPM - INSURANCE PAYMENT TREND REPORT - COMPILATION ;5-JUN-91
"RTN","IBOTR2",2,0)
 ;;2.0;INTEGRATED BILLING;**21,42,52,80,100,118,128,451**;21-MAR-94;Build 47
"RTN","IBOTR2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBOTR2",4,0)
 ;
"RTN","IBOTR2",5,0)
 ;MAP TO DGCROTR2
"RTN","IBOTR2",6,0)
 ;
"RTN","IBOTR2",7,0)
 ;***
"RTN","IBOTR2",8,0)
 ;S XRTL=$ZU(0),XRTN="IBOTR-2" D T0^%ZOSV ;start rt clock
"RTN","IBOTR2",9,0)
 ;
"RTN","IBOTR2",10,0)
 I $G(IBXTRACT) D E^IBJDE(8,1) ; Change extract status.
"RTN","IBOTR2",11,0)
 ;
"RTN","IBOTR2",12,0)
 K ^TMP($J) S IBQUIT=0
"RTN","IBOTR2",13,0)
 S IBDA="" F  S IBDA=$O(^DGCR(399,"AD",IBRT,IBDA)) Q:'IBDA  D  Q:IBQUIT
"RTN","IBOTR2",14,0)
 .D COMP I IBDA#100=0 S IBQUIT=$$STOP^IBOUTL("Trend Report")
"RTN","IBOTR2",15,0)
 ;
"RTN","IBOTR2",16,0)
 ; - Write the output report.
"RTN","IBOTR2",17,0)
 I 'IBQUIT D
"RTN","IBOTR2",18,0)
 .I 'IBSDIV D:"OP"[IBSORT SORT D EN^IBOTR3(0) Q
"RTN","IBOTR2",19,0)
 .S IBDIV=0 F  S IBDIV=$S('VAUTD:$O(VAUTD(IBDIV)),1:$O(^DG(40.8,IBDIV))) Q:'IBDIV  D:"OP"[IBSORT SORT D EN^IBOTR3(IBDIV) Q:IBQUIT
"RTN","IBOTR2",20,0)
 ;
"RTN","IBOTR2",21,0)
 ;***
"RTN","IBOTR2",22,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOTR2" D T1^%ZOSV ;stop rt clock
"RTN","IBOTR2",23,0)
ENQ I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBOTR2",24,0)
 K IB,IBAO,IBAP,IBCNT,IBDA,DFN,IBBC,DIC,DA,DR,DIQ,IBDP,IBDBC,IBSCF,IBSCT
"RTN","IBOTR2",25,0)
 K IBCFL,IBDIV,IBQUIT,IBEVT,^TMP($J) D ^%ZISC
"RTN","IBOTR2",26,0)
 Q
"RTN","IBOTR2",27,0)
 ;
"RTN","IBOTR2",28,0)
COMP ; - Compile Bill-Accounts Receivable records for report.
"RTN","IBOTR2",29,0)
 S IBD=$G(^DGCR(399,IBDA,0)) I IBD="" Q
"RTN","IBOTR2",30,0)
 ;
"RTN","IBOTR2",31,0)
 ; - Get division, if necessary.
"RTN","IBOTR2",32,0)
 I 'IBSDIV S IBDIV=0
"RTN","IBOTR2",33,0)
 E  S IBDIV=$$DIV^IBJDF2(IBDA) I 'IBDIV S IBDIV=+$$PRIM^VASITE()
"RTN","IBOTR2",34,0)
 I IBSDIV,'VAUTD,'$D(VAUTD(IBDIV)) Q  ;  Not a selected division.
"RTN","IBOTR2",35,0)
 ;
"RTN","IBOTR2",36,0)
 ; - Exclude receivables referred to Regional Counsel, if necessary.
"RTN","IBOTR2",37,0)
 I 'IBINRC,$P($G(^PRCA(430,IBDA,6)),U,4) Q
"RTN","IBOTR2",38,0)
 ;
"RTN","IBOTR2",39,0)
 ; IB*2.0*451 - get EEOB indicator '%' for bill
"RTN","IBOTR2",40,0)
 S IBPFLAG=$$EEOB^IBOA31(IBDA) ; get 1st/3rd party payment when applicable
"RTN","IBOTR2",41,0)
 S IBBN=$P(IBD,U),DFN=+$P(IBD,U,2),IBEVT=+$P(IBD,U,3),IBBC=$P(IBD,U,5)
"RTN","IBOTR2",42,0)
 S:IBBN="" IBBN="NULL" Q:IBBRT="O"&("12"[IBBC)  Q:IBBRT="I"&("34"[IBBC)
"RTN","IBOTR2",43,0)
 S IBDBC=$$CLO^PRCAFN(IBDA) Q:IBARST="O"&(IBDBC>-2)!(IBARST="C"&(IBDBC<-1))
"RTN","IBOTR2",44,0)
 I IBDBC>0 S IBBN=$G(IBPFLAG)_IBBN_"*" ; add EEOB indicator
"RTN","IBOTR2",45,0)
 E  S IBD=$P($$STA^PRCAFN(IBDA),U,2),IBDBC=$S($L(IBD)>8:$E(IBD,1,8),1:IBD)
"RTN","IBOTR2",46,0)
 I $D(IBBRN),IBBRN="S" S IBBRTY=$S("12"[IBBC:"I",1:"O")
"RTN","IBOTR2",47,0)
 ;
"RTN","IBOTR2",48,0)
 ; - Perform edits for insurance company.
"RTN","IBOTR2",49,0)
 S IBD=$P($G(^DGCR(399,IBDA,"MP")),U),IBINS=$P($G(^DIC(36,+IBD,0)),U)
"RTN","IBOTR2",50,0)
 I $G(IBICPT) Q:'$D(IBICPT(+IBD))  G CANC
"RTN","IBOTR2",51,0)
 I IBICF'="@",IBD="" Q
"RTN","IBOTR2",52,0)
 I $D(IBIC) Q:IBIC="ALL"&(IBD="")  Q:IBIC="NULL"&(IBD]"")
"RTN","IBOTR2",53,0)
 I IBINS="" S IBINS="UNKNOWN" G CANC
"RTN","IBOTR2",54,0)
 I $G(IBIC)="ALL" G CANC
"RTN","IBOTR2",55,0)
 I IBICF="@",IBICL="zzzzz" G CANC
"RTN","IBOTR2",56,0)
 I IBICF]IBINS!(IBINS]IBICL) Q
"RTN","IBOTR2",57,0)
 ;
"RTN","IBOTR2",58,0)
CANC ; - Keep cancelled bills if CANCEL BILL? field was selected or answer
"RTN","IBOTR2",59,0)
 ;   to 'Do you want to include cancelled receivables?' prompt was YES.
"RTN","IBOTR2",60,0)
 S IBCFL=0,IBINS=IBINS_"@@"_IBD Q:'$D(^DGCR(399,IBDA,"S"))  S IBD=^("S")
"RTN","IBOTR2",61,0)
 S IBCNC=0 I "^26^39^"[(U_$P($G(^PRCA(430,IBDA,0)),U,8)_U) S IBCNC=1
"RTN","IBOTR2",62,0)
 I $G(IBCANC),($P(IBD,U,16)!(IBCNC)) S IBCFL=1 G PTDE ; Add canc. bill.
"RTN","IBOTR2",63,0)
 I $G(IBAF)'=16 Q:$P(IBD,U,16)!(IBCNC)  ;      Bill has been cancelled.
"RTN","IBOTR2",64,0)
 ;
"RTN","IBOTR2",65,0)
PTDE ; - Perform Printed/Treatment date edits.
"RTN","IBOTR2",66,0)
 S IBDP=$P(IBD,U,12)
"RTN","IBOTR2",67,0)
 I IBDF=1 Q:IBDP<IBBDT!(IBDP>IBEDT)  ;   Date printed is out of range.
"RTN","IBOTR2",68,0)
 S IBD=$G(^DGCR(399,IBDA,"U")),IBSCF=$P(IBD,U),IBSCT=$P(IBD,U,2)
"RTN","IBOTR2",69,0)
 I IBDF=2 Q:IBSCT<IBBDT!(IBSCF>IBEDT)  ; Treatment dates out of range.
"RTN","IBOTR2",70,0)
 I '$D(IBAF) G BUILD
"RTN","IBOTR2",71,0)
 ;
"RTN","IBOTR2",72,0)
 ; - Find the selected field value and compare to selection parameters.
"RTN","IBOTR2",73,0)
 K IB S DIC=399,DA=IBDA,DR=IBAF,DIQ="IB" S:IBAFD DIQ(0)="I"
"RTN","IBOTR2",74,0)
 D EN^DIQ1 K DIQ S:IBAFD IB(399,IBDA,IBAF)=IB(399,IBDA,IBAF,"I")
"RTN","IBOTR2",75,0)
 S IB=$G(IB(399,IBDA,IBAF)) I IB="",IBAFF'="@" Q
"RTN","IBOTR2",76,0)
 I $D(IBAFZ) Q:IBAFZ="ALL"&(IB="")  Q:IBAFZ="NULL"&(IB]"")
"RTN","IBOTR2",77,0)
 I IB=""!($G(IBAFZ)="ALL") G BUILD
"RTN","IBOTR2",78,0)
 I IBAFF="@",IBAFL="" G BUILD
"RTN","IBOTR2",79,0)
 I +IBAFF=IBAFF,+IBAFL=IBAFL Q:IB<IBAFF!(IB>IBAFL)
"RTN","IBOTR2",80,0)
 E  Q:IBAFF]IB!(IB]IBAFL)
"RTN","IBOTR2",81,0)
 ;
"RTN","IBOTR2",82,0)
BUILD ; - Retrieve A/R data and build sort global.
"RTN","IBOTR2",83,0)
 S IBAO=$$ORI^PRCAFN(IBDA) S:IBAO<0 IBAO=0
"RTN","IBOTR2",84,0)
 S IBAP=$$TPR^PRCAFN(IBDA) S:IBAP<0 IBAP=0
"RTN","IBOTR2",85,0)
 S ^TMP($J,"IBOTR",IBDIV,IBBRTY,IBINS,$$NAMAGE(DFN,IBEVT)_"@@"_IBBN)=U_IBSCF_U_IBSCT_U_IBDP_U_IBDBC_U_IBAO_U_IBAP_U_IBCFL
"RTN","IBOTR2",86,0)
 I "OP"[IBSORT D
"RTN","IBOTR2",87,0)
 .S ^TMP($J,"IBOTR",IBDIV,IBBRTY,IBINS)=$G(^TMP($J,"IBOTR",IBDIV,IBBRTY,IBINS))+$S(IBSORT="O":(IBAO-IBAP),1:IBAP)
"RTN","IBOTR2",88,0)
 Q
"RTN","IBOTR2",89,0)
 ;
"RTN","IBOTR2",90,0)
SORT ; - Create sort global based on amount owed/amount paid, if necessary.
"RTN","IBOTR2",91,0)
 I 'IBSDIV S IBDIV=0
"RTN","IBOTR2",92,0)
 S IBX="" F  S IBX=$O(^TMP($J,"IBOTR",IBDIV,IBX)) Q:IBX=""  D
"RTN","IBOTR2",93,0)
 .S IBINS="" F  S IBINS=$O(^TMP($J,"IBOTR",IBDIV,IBX,IBINS)) Q:IBINS=""  S IBXX=^(IBINS),^TMP($J,"IBOTRS",IBDIV,IBX,-IBXX,IBINS)=""
"RTN","IBOTR2",94,0)
 K IBX,IBXX
"RTN","IBOTR2",95,0)
 Q
"RTN","IBOTR2",96,0)
 ;
"RTN","IBOTR2",97,0)
NAMAGE(DFN,EVT) ; - Return patient name and age.
"RTN","IBOTR2",98,0)
 ;  Input: DFN = Pointer to patient in file #2
"RTN","IBOTR2",99,0)
 ;         EVT = Event Date of claim
"RTN","IBOTR2",100,0)
 ; Output: Patient name (1st 18 chars.)_"("_Age_")"
"RTN","IBOTR2",101,0)
 N DPT0,X,X1,X2
"RTN","IBOTR2",102,0)
 S DPT0=$G(^DPT(DFN,0)),X2=$P(DPT0,U,3)
"RTN","IBOTR2",103,0)
 I 'X2 S X="UNK"
"RTN","IBOTR2",104,0)
 E  S X1=EVT S:'X1 X1=DT D ^%DTC S X=X\365.25
"RTN","IBOTR2",105,0)
 Q $E($P(DPT0,U),1,18)_" ("_X_")"
"UP",361.1,361.1101,-1)
361.1^101
"UP",361.1,361.1101,0)
361.1101
"UP",361.1,361.11016,-2)
361.1^101
"UP",361.1,361.11016,-1)
361.1101^1
"UP",361.1,361.11016,0)
361.11016
"VER")
8.0^22.0
"^DD",361.1,361.1,101,0)
MOVE/COPY HISTORY^361.1101DA^^101;0
"^DD",361.1,361.1,101,21,0)
^^1^1^3110907^
"^DD",361.1,361.1,101,21,1,0)
This multiple contains a record for each time an EOB is moved or copied.
"^DD",361.1,361.1,101,23,0)
^^1^1^3110905^
"^DD",361.1,361.1,101,23,1,0)
Updated from EOB Move/Copy option and Worklist Split/Edit Line protocol.
"^DD",361.1,361.1101,0)
MOVE/COPY HISTORY SUB-FIELD^^.06^6
"^DD",361.1,361.1101,0,"DT")
3110912
"^DD",361.1,361.1101,0,"IX","B",361.1101,.01)

"^DD",361.1,361.1101,0,"NM","MOVE/COPY HISTORY")

"^DD",361.1,361.1101,0,"UP")
361.1
"^DD",361.1,361.1101,.01,0)
DATE/TIME EOB MOVED^RD^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",361.1,361.1101,.01,1,0)
^.1
"^DD",361.1,361.1101,.01,1,1,0)
361.1101^B
"^DD",361.1,361.1101,.01,1,1,1)
S ^IBM(361.1,DA(1),101,"B",$E(X,1,30),DA)=""
"^DD",361.1,361.1101,.01,1,1,2)
K ^IBM(361.1,DA(1),101,"B",$E(X,1,30),DA)
"^DD",361.1,361.1101,.01,1,2,0)
361.1^AEOB
"^DD",361.1,361.1101,.01,1,2,1)
S ^IBM(361.1,"AEOB",$E(X,1,30),DA(1),DA)=""
"^DD",361.1,361.1101,.01,1,2,2)
K ^IBM(361.1,"AEOB",$E(X,1,30),DA(1),DA)
"^DD",361.1,361.1101,.01,1,2,"%D",0)
^^2^2^3110905^
"^DD",361.1,361.1101,.01,1,2,"%D",1,0)
This cross reference is used by the RCDPE EEOB MOVE/COPY AUDIT REPORT 
"^DD",361.1,361.1101,.01,1,2,"%D",2,0)
option.
"^DD",361.1,361.1101,.01,1,2,"DT")
3110905
"^DD",361.1,361.1101,.01,3)
Enter date/time EOB was moved or copied to a different claim.
"^DD",361.1,361.1101,.01,21,0)
^^1^1^3110907^
"^DD",361.1,361.1101,.01,21,1,0)
Date/Time the move/copy transaction was performed.
"^DD",361.1,361.1101,.01,"DT")
3110907
"^DD",361.1,361.1101,.02,0)
EOB MOVE/COPY BY^P200'^VA(200,^0;2^Q
"^DD",361.1,361.1101,.02,3)
Select the person who moved the EOB to a new claim.
"^DD",361.1,361.1101,.02,21,0)
^^1^1^3110905^
"^DD",361.1,361.1101,.02,21,1,0)
This is person who moved EOB to a new claim.
"^DD",361.1,361.1101,.02,"DT")
3110905
"^DD",361.1,361.1101,.03,0)
MOVE/COPY REASON^FX^^0;3^K:$L(X)>100!($L(X)<1)!($TR(X," ","")="") X
"^DD",361.1,361.1101,.03,3)
Answer must be 1-100 characters in length.
"^DD",361.1,361.1101,.03,21,0)
^^1^1^3110905^
"^DD",361.1,361.1101,.03,21,1,0)
Justification for moving EOB to new claim or claims.
"^DD",361.1,361.1101,.03,"DT")
3110912
"^DD",361.1,361.1101,.04,0)
ORIGINAL BILL NUMBER^P399'^DGCR(399,^0;4^Q
"^DD",361.1,361.1101,.04,3)
Enter original claim number for this EOB.
"^DD",361.1,361.1101,.04,21,0)
^^1^1^3110905^
"^DD",361.1,361.1101,.04,21,1,0)
Original claim number for this EOB.
"^DD",361.1,361.1101,.04,"DT")
3110905
"^DD",361.1,361.1101,.05,0)
MOVE/COPY EVENT^S^M:Move;C:Copy;^0;5^Q
"^DD",361.1,361.1101,.05,3)
Indicate whether the EOB was moved or copied.
"^DD",361.1,361.1101,.05,21,0)
^^3^3^3110909^
"^DD",361.1,361.1101,.05,21,1,0)
This field indicates whether a move or a copy action was performed. It is 
"^DD",361.1,361.1101,.05,21,2,0)
automatically updated by the Move/Copy option or the Split/Edit a Line 
"^DD",361.1,361.1101,.05,21,3,0)
option.
"^DD",361.1,361.1101,.05,"DT")
3110909
"^DD",361.1,361.1101,.06,0)
OTHER CLAIM NUMBERS^361.11016PA^^1;0
"^DD",361.1,361.1101,.06,21,0)
^^1^1^3110905^
"^DD",361.1,361.1101,.06,21,1,0)
This multiple contains the other claim numbers that the EOB was copied to.
"^DD",361.1,361.11016,0)
OTHER CLAIM NUMBERS SUB-FIELD^^.01^1
"^DD",361.1,361.11016,0,"DT")
3110905
"^DD",361.1,361.11016,0,"IX","B",361.11016,.01)

"^DD",361.1,361.11016,0,"NM","OTHER CLAIM NUMBERS")

"^DD",361.1,361.11016,0,"UP")
361.1101
"^DD",361.1,361.11016,.01,0)
OTHER CLAIM NUMBERS^RP399^DGCR(399,^0;1^Q
"^DD",361.1,361.11016,.01,1,0)
^.1
"^DD",361.1,361.11016,.01,1,1,0)
361.11016^B
"^DD",361.1,361.11016,.01,1,1,1)
S ^IBM(361.1,DA(2),101,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",361.1,361.11016,.01,1,1,2)
K ^IBM(361.1,DA(2),101,DA(1),1,"B",$E(X,1,30),DA)
"^DD",361.1,361.11016,.01,3)
Enter other claim number the EOB was copied to.
"^DD",361.1,361.11016,.01,21,0)
^^1^1^3110905^
"^DD",361.1,361.11016,.01,21,1,0)
This is another claim number that the EOB was copied to.
"^DD",361.1,361.11016,.01,"DT")
3110905
"BLD",7679,6)
^429
**END**
**END**
