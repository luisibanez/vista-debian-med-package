Released OOPS*2*25 SEQ #26
Extracted from mail message
**KIDS**:OOPS*2.0*25^

**INSTALL NAME**
OOPS*2.0*25
"BLD",9215,0)
OOPS*2.0*25^ASISTS^0^3130213^y
"BLD",9215,1,0)
^^6^6^3130213^
"BLD",9215,1,1,0)
This patch addresses the following:
"BLD",9215,1,2,0)
 
"BLD",9215,1,3,0)
-Issues displaying Stations on the "Edit Site Parameter" form 
"BLD",9215,1,4,0)
-Incident Outcome display order problems
"BLD",9215,1,5,0)
-OSHA 300 "Away From Work" and "Job Transfer/Restriction" calculation
"BLD",9215,1,6,0)
 issues 
"BLD",9215,4,0)
^9.64PA^^
"BLD",9215,6.3)
4
"BLD",9215,"KRN",0)
^9.67PA^779.2^20
"BLD",9215,"KRN",.4,0)
.4
"BLD",9215,"KRN",.401,0)
.401
"BLD",9215,"KRN",.402,0)
.402
"BLD",9215,"KRN",.403,0)
.403
"BLD",9215,"KRN",.5,0)
.5
"BLD",9215,"KRN",.84,0)
.84
"BLD",9215,"KRN",3.6,0)
3.6
"BLD",9215,"KRN",3.8,0)
3.8
"BLD",9215,"KRN",9.2,0)
9.2
"BLD",9215,"KRN",9.8,0)
9.8
"BLD",9215,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",9215,"KRN",9.8,"NM",1,0)
OOPSGUI6^^0^B55527418
"BLD",9215,"KRN",9.8,"NM",2,0)
OOPSGUIR^^0^B71502420
"BLD",9215,"KRN",9.8,"NM",3,0)
OOPSGUIC^^0^B79794142
"BLD",9215,"KRN",9.8,"NM","B","OOPSGUI6",1)

"BLD",9215,"KRN",9.8,"NM","B","OOPSGUIC",3)

"BLD",9215,"KRN",9.8,"NM","B","OOPSGUIR",2)

"BLD",9215,"KRN",19,0)
19
"BLD",9215,"KRN",19.1,0)
19.1
"BLD",9215,"KRN",101,0)
101
"BLD",9215,"KRN",409.61,0)
409.61
"BLD",9215,"KRN",771,0)
771
"BLD",9215,"KRN",779.2,0)
779.2
"BLD",9215,"KRN",870,0)
870
"BLD",9215,"KRN",8989.51,0)
8989.51
"BLD",9215,"KRN",8989.52,0)
8989.52
"BLD",9215,"KRN",8994,0)
8994
"BLD",9215,"KRN","B",.4,.4)

"BLD",9215,"KRN","B",.401,.401)

"BLD",9215,"KRN","B",.402,.402)

"BLD",9215,"KRN","B",.403,.403)

"BLD",9215,"KRN","B",.5,.5)

"BLD",9215,"KRN","B",.84,.84)

"BLD",9215,"KRN","B",3.6,3.6)

"BLD",9215,"KRN","B",3.8,3.8)

"BLD",9215,"KRN","B",9.2,9.2)

"BLD",9215,"KRN","B",9.8,9.8)

"BLD",9215,"KRN","B",19,19)

"BLD",9215,"KRN","B",19.1,19.1)

"BLD",9215,"KRN","B",101,101)

"BLD",9215,"KRN","B",409.61,409.61)

"BLD",9215,"KRN","B",771,771)

"BLD",9215,"KRN","B",779.2,779.2)

"BLD",9215,"KRN","B",870,870)

"BLD",9215,"KRN","B",8989.51,8989.51)

"BLD",9215,"KRN","B",8989.52,8989.52)

"BLD",9215,"KRN","B",8994,8994)

"BLD",9215,"QUES",0)
^9.62^^
"BLD",9215,"REQB",0)
^9.611^2^2
"BLD",9215,"REQB",1,0)
OOPS*2.0*24^1
"BLD",9215,"REQB",2,0)
OOPS*2.0*20^1
"BLD",9215,"REQB","B","OOPS*2.0*20",2)

"BLD",9215,"REQB","B","OOPS*2.0*24",1)

"MBREQ")
0
"PKG",472,-1)
1^1
"PKG",472,0)
ASISTS^OOPS^Automated Safety Incident Surveillance Tracking System
"PKG",472,20,0)
^9.402P^^
"PKG",472,22,0)
^9.49I^1^1
"PKG",472,22,1,0)
2.0^3020709^3030401^66481
"PKG",472,22,1,"PAH",1,0)
25^3130213
"PKG",472,22,1,"PAH",1,1,0)
^^6^6^3130213
"PKG",472,22,1,"PAH",1,1,1,0)
This patch addresses the following:
"PKG",472,22,1,"PAH",1,1,2,0)
 
"PKG",472,22,1,"PAH",1,1,3,0)
-Issues displaying Stations on the "Edit Site Parameter" form 
"PKG",472,22,1,"PAH",1,1,4,0)
-Incident Outcome display order problems
"PKG",472,22,1,"PAH",1,1,5,0)
-OSHA 300 "Away From Work" and "Job Transfer/Restriction" calculation
"PKG",472,22,1,"PAH",1,1,6,0)
 issues 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","OOPSGUI6")
0^1^B55527418^B53278536
"RTN","OOPSGUI6",1,0)
OOPSGUI6 ;WIOFO/LLH-RPC routines for ASISTS Gui ;9/18/01
"RTN","OOPSGUI6",2,0)
 ;;2.0;ASISTS;**4,8,7,25**;Jun 03, 2002;Build 4
"RTN","OOPSGUI6",3,0)
 ;
"RTN","OOPSGUI6",4,0)
UNIGET(RESULTS) ; Returns entries in the Union table
"RTN","OOPSGUI6",5,0)
 N DATA,CNT,SUP,UIEN,UNI
"RTN","OOPSGUI6",6,0)
 S CNT=0,UNI=""
"RTN","OOPSGUI6",7,0)
 F  S UNI=$O(^OOPS(2263.7,"B",UNI)) Q:UNI=""  D
"RTN","OOPSGUI6",8,0)
 .S UIEN=0
"RTN","OOPSGUI6",9,0)
 .F  S UIEN=$O(^OOPS(2263.7,"B",UNI,UIEN)) Q:UIEN=""  D
"RTN","OOPSGUI6",10,0)
 ..S DATA=$G(^OOPS(2263.7,UIEN,0))
"RTN","OOPSGUI6",11,0)
 ..S SUP=$$GET1^DIQ(200,$P($G(DATA),U,3),.01)
"RTN","OOPSGUI6",12,0)
 ..S RESULTS(CNT)=DATA_U_SUP_U_UIEN,CNT=CNT+1
"RTN","OOPSGUI6",13,0)
 Q
"RTN","OOPSGUI6",14,0)
UNIKILL(RESULTS,INPUT) ;
"RTN","OOPSGUI6",15,0)
 ;  Input - INPUT contains the IEN for Union to be deleted
"RTN","OOPSGUI6",16,0)
 ; Output - RESULTS will contain a message indicating the record
"RTN","OOPSGUI6",17,0)
 ;          was successfully deleted.
"RTN","OOPSGUI6",18,0)
 N DA,DIK
"RTN","OOPSGUI6",19,0)
 S RESULTS="No Changes Filed"
"RTN","OOPSGUI6",20,0)
 S DIK="^OOPS(2263.7,",DA=INPUT
"RTN","OOPSGUI6",21,0)
 D ^DIK
"RTN","OOPSGUI6",22,0)
 S RESULTS="Record Successfully Deleted"
"RTN","OOPSGUI6",23,0)
 Q
"RTN","OOPSGUI6",24,0)
UNIADD ; Files a new record in ^OOPS(2263.7 
"RTN","OOPSGUI6",25,0)
 N X,DIC,DLAYGO
"RTN","OOPSGUI6",26,0)
 K DO
"RTN","OOPSGUI6",27,0)
 S DLAYGO=2263.7,DIC="^OOPS(2263.7,",DIC(0)="L",X=NM
"RTN","OOPSGUI6",28,0)
 D FILE^DICN
"RTN","OOPSGUI6",29,0)
 I Y=-1 S RESULTS="Failed" Q
"RTN","OOPSGUI6",30,0)
 S DA=+Y,RESULTS=X_" union added"
"RTN","OOPSGUI6",31,0)
 Q
"RTN","OOPSGUI6",32,0)
UNIEDT(RESULTS,INPUT) ; Edits the input in ^OOPS(2263.7
"RTN","OOPSGUI6",33,0)
 ;  Input - INPUT contains the IEN of Union to be edited or NULL if a
"RTN","OOPSGUI6",34,0)
 ;          new union is being added.  Also has the Union Name,
"RTN","OOPSGUI6",35,0)
 ;          Acronym, and  Representative in the format:
"RTN","OOPSGUI6",36,0)
 ;          IEN^UNION NAME^UNION ACRONYM^UNION REP
"RTN","OOPSGUI6",37,0)
 ; Output - RESULTS contains a status message regarding the filing of
"RTN","OOPSGUI6",38,0)
 ;          the data
"RTN","OOPSGUI6",39,0)
 N DA,DIE,DR,IEN,NM,ACR,REP
"RTN","OOPSGUI6",40,0)
 S RESULTS="No Changes Filed"
"RTN","OOPSGUI6",41,0)
 S DIE="^OOPS(2263.7,",IEN=$P($G(INPUT),U),NM=$P($G(INPUT),U,2)
"RTN","OOPSGUI6",42,0)
 I $G(NM)="" Q
"RTN","OOPSGUI6",43,0)
 I $G(IEN)="" D UNIADD S IEN=DA
"RTN","OOPSGUI6",44,0)
 I RESULTS="Failed" Q
"RTN","OOPSGUI6",45,0)
 S ACR=$P($G(INPUT),U,3),REP=$P($G(INPUT),U,4)
"RTN","OOPSGUI6",46,0)
 S DA=IEN,DR=".01///^S X=NM;1///^S X=ACR;2///^S X=REP"
"RTN","OOPSGUI6",47,0)
 D ^DIE
"RTN","OOPSGUI6",48,0)
 I $G(Y)="" D  Q
"RTN","OOPSGUI6",49,0)
 .;if next line executed, then straight edit, not an add
"RTN","OOPSGUI6",50,0)
 .I RESULTS="No Changes Filed" S RESULTS="Union Update Successful."
"RTN","OOPSGUI6",51,0)
 S RESULTS="Union Update NOT Successful."
"RTN","OOPSGUI6",52,0)
 Q
"RTN","OOPSGUI6",53,0)
SITEPGET(RESULTS,FORM) ;
"RTN","OOPSGUI6",54,0)
 ;  Input - FORM = contains either a blank for 'normal' site parameter
"RTN","OOPSGUI6",55,0)
 ;          look ups or 'OSHA300' if for the OSHA 300A summary input
"RTN","OOPSGUI6",56,0)
 ; Output - RESULTS is an array whose 0 node contains the Site 
"RTN","OOPSGUI6",57,0)
 ;          parameter name, IEN, and District Office in the format:
"RTN","OOPSGUI6",58,0)
 ;          SITE NAME^DISTRICT OFFICE^SITE IEN
"RTN","OOPSGUI6",59,0)
 ;          Subsequent nodes starting from 1 contain Station information
"RTN","OOPSGUI6",60,0)
 ;          in the following format:
"RTN","OOPSGUI6",61,0)
 ;          STANM_U_PNM_U_PADD_U_PCTY_U_PST_U_PZIP_U_PTITLE_
"RTN","OOPSGUI6",62,0)
 ;          U_CHGBKCODE_U_SUB_U_STA
"RTN","OOPSGUI6",63,0)
 N CNT,DOFF,IENS,SIEN,STA,SUB,SNAME,STR,STR2,CBCSUF,OOPSST
"RTN","OOPSGUI6",64,0)
 S SIEN=$P($G(^OOPS(2262,0)),U,3)
"RTN","OOPSGUI6",65,0)
 N CBC,STANM,STATION,PNM,PADD,PCTY,PST,PZIP,PTITLE
"RTN","OOPSGUI6",66,0)
 S (CBC,STATION,PNM,PADD,PCTY,PST,PZIP,PTITLE)=""
"RTN","OOPSGUI6",67,0)
 N NA,TTL,PHN,EXT,IND,NAICS,SIC
"RTN","OOPSGUI6",68,0)
 S (NA,TTL,PHN,EXT,IND,NAICS,SIC)=""
"RTN","OOPSGUI6",69,0)
 I '$G(SIEN) S RESULTS(0)="No Site Parameter File was Found" Q
"RTN","OOPSGUI6",70,0)
 L +^OOPS(2262,SIEN):2
"RTN","OOPSGUI6",71,0)
 E  S RESULTS(0)="This option in use by another user, try again later." Q
"RTN","OOPSGUI6",72,0)
 S SNAME=$$GET1^DIQ(2262,SIEN,.01),DOFF=$$GET1^DIQ(2262,SIEN,2,"E")
"RTN","OOPSGUI6",73,0)
 S RESULTS(0)=SNAME_U_DOFF_U_SIEN
"RTN","OOPSGUI6",74,0)
 S CNT=1,SUB=""
"RTN","OOPSGUI6",75,0)
 F  S SUB=$O(^OOPS(2262,SIEN,SUB)) Q:SUB=""  S STA=0 D
"RTN","OOPSGUI6",76,0)
 .F  S STA=$O(^OOPS(2262,SIEN,SUB,STA)) Q:STA'>0  D
"RTN","OOPSGUI6",77,0)
 ..S STR=$G(^OOPS(2262,SIEN,SUB,STA,0)),IENS=STA_","_SUB_","
"RTN","OOPSGUI6",78,0)
 ..S STR2=$G(^OOPS(2262,SIEN,SUB,STA,1))
"RTN","OOPSGUI6",79,0)
 ..S STATION=$$GET1^DIQ(2262.03,IENS,".01:99")
"RTN","OOPSGUI6",80,0)
 ..S STANM=$$GET1^DIQ(2262.03,IENS,.01)_" = "_STATION
"RTN","OOPSGUI6",81,0)
 ..;RRA OOPS*25 - 781436 after STA is sent back as null STA needs to be 
"RTN","OOPSGUI6",82,0)
 ..;set back to original value for proper "$O"rdering.
"RTN","OOPSGUI6",83,0)
 ..; Patch 5 llh - if station inactive blank STA
"RTN","OOPSGUI6",84,0)
 ..I $$GET1^DIQ(4,$P(STR,U),101)'="" S OOPSST=STA,STA=""
"RTN","OOPSGUI6",85,0)
 ..I $G(FORM)="" D
"RTN","OOPSGUI6",86,0)
 ...S PNM=$P(STR,U,2),PADD=$P(STR,U,3),PCTY=$P(STR,U,4),PZIP=$P(STR,U,6)
"RTN","OOPSGUI6",87,0)
 ...I $P(STR,U,5)'="" S PST=$$GET1^DIQ(2262.03,IENS,4)
"RTN","OOPSGUI6",88,0)
 ...I $P(STR,U,7)'="" S PTITLE=$$GET1^DIQ(2262.03,IENS,6)
"RTN","OOPSGUI6",89,0)
 ...S CBC=$P(STR,U,8) I $G(CBC)'="" S CBC=$$GET1^DIQ(2263.6,CBC,.01)
"RTN","OOPSGUI6",90,0)
 ...;Patch 5 llh - added CBCSUF sets
"RTN","OOPSGUI6",91,0)
 ...S CBCSUF=$P(STR,U,9)
"RTN","OOPSGUI6",92,0)
 ...S RESULTS(CNT)=STANM_U_PNM_U_PADD_U_PCTY_U_PST_U_PZIP_U_PTITLE_U_CBC_U_SUB_U_STA_U_CBCSUF
"RTN","OOPSGUI6",93,0)
 ..I $G(FORM)="OSHA300" D
"RTN","OOPSGUI6",94,0)
 ...I $P(STR2,U,1)'="" S NA=$$GET1^DIQ(2262.03,IENS,7)
"RTN","OOPSGUI6",95,0)
 ...S TTL=$P(STR2,U,2),PHN=$P(STR2,U,3),EXT=$P(STR2,U,4)
"RTN","OOPSGUI6",96,0)
 ...S IND=$P(STR2,U,5),SIC=$$GET1^DIQ(2262.03,IENS,12)
"RTN","OOPSGUI6",97,0)
 ...S NAICS=$$GET1^DIQ(2262.03,IENS,13)
"RTN","OOPSGUI6",98,0)
 ...S RESULTS(CNT)=STANM_U_NA_U_TTL_U_PHN_U_EXT_U_IND_U_SIC_U_NAICS_U_SUB_U_STA_U_$P(STR,U,1)_U
"RTN","OOPSGUI6",99,0)
 ..I $G(FORM)="" S (STANM,PNM,PADD,PCTY,PST,PZIP,PTITLE,CBC,CBCSUF)=""
"RTN","OOPSGUI6",100,0)
 ..E  S (NA,TTL,PHN,EXT,IND,NAICS,SIC)=""
"RTN","OOPSGUI6",101,0)
 ..I STA="" S STA=OOPSST
"RTN","OOPSGUI6",102,0)
 ..S CNT=CNT+1
"RTN","OOPSGUI6",103,0)
 L -^OOPS(2262,SIEN)
"RTN","OOPSGUI6",104,0)
 Q
"RTN","OOPSGUI6",105,0)
SITEPADD ; Creates a new Station Subfile in the Site Parameter
"RTN","OOPSGUI6",106,0)
 ;                 File (#2262
"RTN","OOPSGUI6",107,0)
 N X,DIC,DLAYGO
"RTN","OOPSGUI6",108,0)
 S DLAYGO=2262,DIC="^OOPS(2262,"_SIEN_","_SUBF_",",DIC(0)="L"
"RTN","OOPSGUI6",109,0)
 S DA(1)=SIEN,X=STANM
"RTN","OOPSGUI6",110,0)
 D FILE^DICN
"RTN","OOPSGUI6",111,0)
 I Y=-1 S RESULTS="Failed" Q
"RTN","OOPSGUI6",112,0)
 S DA=+Y,RESULTS="Successfully Added"
"RTN","OOPSGUI6",113,0)
 Q
"RTN","OOPSGUI6",114,0)
SITEPKIL(RESULTS,INPUT) ; Deletes the Station Subfile whose IEN was passed in
"RTN","OOPSGUI6",115,0)
 ;  Input - INPUT contains the Site Parameter file IEN, the subfile IEN,
"RTN","OOPSGUI6",116,0)
 ;          and the Station IEN in the format: SIEN^SUBF^STAIEN
"RTN","OOPSGUI6",117,0)
 ; Output - RESULTS contains a message with the filing status
"RTN","OOPSGUI6",118,0)
 N DA,DIK,SIEN,SUBF,STAIEN
"RTN","OOPSGUI6",119,0)
 S SIEN=$P($G(INPUT),U),SUBF=$P($G(INPUT),U,2),STAIEN=$P($G(INPUT),U,3)
"RTN","OOPSGUI6",120,0)
 I $G(SIEN)=""!($G(SUBF)="")!($G(STAIEN)="") D  Q
"RTN","OOPSGUI6",121,0)
 .S RESULTS="Missing Record Identifiers, Cannot file."
"RTN","OOPSGUI6",122,0)
 S DIK="^OOPS(2262,"_SIEN_","_SUBF_","
"RTN","OOPSGUI6",123,0)
 S DA=STAIEN,DA(1)=SIEN
"RTN","OOPSGUI6",124,0)
 D ^DIK
"RTN","OOPSGUI6",125,0)
 I $G(Y)="" S RESULTS="Deletion did not occur." Q
"RTN","OOPSGUI6",126,0)
 S RESULTS="Record successfully deleted"
"RTN","OOPSGUI6",127,0)
 Q
"RTN","OOPSGUI6",128,0)
SITEPEDT(RESULTS,INPUT,DATA,FORM) ;
"RTN","OOPSGUI6",129,0)
 ;  Edits the Station Subfile whose data and IEN have been passed in
"RTN","OOPSGUI6",130,0)
 ;  Input - INPUT contains the IEN of the Site Parameter file, subfile
"RTN","OOPSGUI6",131,0)
 ;                & Station IEN.  If adding new station, the Station IEN 
"RTN","OOPSGUI6",132,0)
 ;                = "". INPUT format:  SITE IEN^SUBFILE IEN^STATION IEN
"RTN","OOPSGUI6",133,0)
 ;          DATA  contains the data to be filed
"RTN","OOPSGUI6",134,0)
 ;          FORM  is either "" or "OSHA300" to signify data for filing
"RTN","OOPSGUI6",135,0)
 ; Output - RESULTS is a single value with a message regarding the 
"RTN","OOPSGUI6",136,0)
 ;          filing status
"RTN","OOPSGUI6",137,0)
 N CBC,DA,DIE,DR,PNM,PADD,PCTY,PST,PZIP,PTITLE,SIEN,SUBF,CBCSUF
"RTN","OOPSGUI6",138,0)
 N STANM,STAIEN,NA,TTL,PHN,EXT,IND,SIC,NAICS
"RTN","OOPSGUI6",139,0)
 S RESULTS="Filing"
"RTN","OOPSGUI6",140,0)
 S SIEN=$P($G(INPUT),U),SUBF=$P($G(INPUT),U,2),STAIEN=$P($G(INPUT),U,3)
"RTN","OOPSGUI6",141,0)
 I $G(SIEN)="" S RESULTS="Missing Record Identifiers, Cannot file." Q
"RTN","OOPSGUI6",142,0)
 I '$G(SUBF) S SUBF=$O(^OOPS(2262,SIEN,0)) I '$G(SUBF) S SUBF=1
"RTN","OOPSGUI6",143,0)
 S STANM=$P($G(DATA),U)
"RTN","OOPSGUI6",144,0)
 I $G(STANM)="" S RESULTS="Missing Station, Cannot continue." Q
"RTN","OOPSGUI6",145,0)
 I $G(STAIEN)="" D SITEPADD S STAIEN=DA
"RTN","OOPSGUI6",146,0)
 I $G(STAIEN)="" S RESULTS="Missing Station, cannot file." Q
"RTN","OOPSGUI6",147,0)
 S DIE="^OOPS(2262,"_SIEN_","_SUBF_","
"RTN","OOPSGUI6",148,0)
 S DA=STAIEN,DA(1)=SIEN,DR=""
"RTN","OOPSGUI6",149,0)
 I $G(FORM)="" D
"RTN","OOPSGUI6",150,0)
 .S PNM=$P($G(DATA),U,2),PADD=$P($G(DATA),U,3)
"RTN","OOPSGUI6",151,0)
 .S PCTY=$P($G(DATA),U,4),PST=$P($G(DATA),U,5),PZIP=$P($G(DATA),U,6)
"RTN","OOPSGUI6",152,0)
 .S PTITLE=$P($G(DATA),U,7),CBC=$P($G(DATA),U,8)
"RTN","OOPSGUI6",153,0)
 .; Patch 5 llh - Added CBCSUF sets
"RTN","OOPSGUI6",154,0)
 .S CBCSUF=$P($G(DATA),U,9)
"RTN","OOPSGUI6",155,0)
 .S DR=".7///^S X=CBC;.8///^S X=CBCSUF;1///^S X=PNM;2///^S X=PADD;3///^S X=PCTY;4///^S X=PST;5///^S X=PZIP;6///^S X=PTITLE"
"RTN","OOPSGUI6",156,0)
 I $G(FORM)="OSHA300" D
"RTN","OOPSGUI6",157,0)
 .S NA=$P($G(DATA),U,2),TTL=$P($G(DATA),U,3),PHN=$P($G(DATA),U,4)
"RTN","OOPSGUI6",158,0)
 .S EXT=$P($G(DATA),U,5),IND=$P($G(DATA),U,6),SIC=$P($G(DATA),U,7)
"RTN","OOPSGUI6",159,0)
 .S NAICS=$P($G(DATA),U,8)
"RTN","OOPSGUI6",160,0)
 .S DR="7///^S X=NA;8///^S X=TTL;9///^S X=PHN;10///^S X=EXT"
"RTN","OOPSGUI6",161,0)
 .S DR=DR_";11///^S X=IND;12///^S X=SIC;13///^S X=NAICS"
"RTN","OOPSGUI6",162,0)
 I $G(DR)'="" D ^DIE
"RTN","OOPSGUI6",163,0)
 I $G(Y)="" D  Q
"RTN","OOPSGUI6",164,0)
 .; if line below executed, then no Add, only edit
"RTN","OOPSGUI6",165,0)
 .I RESULTS="Filing" S RESULTS="Update Successful"
"RTN","OOPSGUI6",166,0)
 S RESULTS="Update was not Successful"
"RTN","OOPSGUI6",167,0)
 Q
"RTN","OOPSGUI6",168,0)
PARMEDT(RESULTS,INPUT) ; Files changes to top level file (#2262)
"RTN","OOPSGUI6",169,0)
 ;  Input:   INPUT - This variable contains the IEN, Site Name, and 
"RTN","OOPSGUI6",170,0)
 ;                   District Office Name to be filed in the format:
"RTN","OOPSGUI6",171,0)
 ;                   IEN^SITE NAME^DISTRICT OFFICE
"RTN","OOPSGUI6",172,0)
 ; Output: RESULTS - Results will contain a filing status message
"RTN","OOPSGUI6",173,0)
 N DA,DIE,DR,IEN,SITENM,DISOFF
"RTN","OOPSGUI6",174,0)
 S IEN=$P($G(INPUT),U),SITENM=$P($G(INPUT),U,2),DISOFF=$P($G(INPUT),U,3)
"RTN","OOPSGUI6",175,0)
 I '$G(IEN) S RESULTS="Cannot File Changes, no Record Number" Q
"RTN","OOPSGUI6",176,0)
 S DIE="^OOPS(2262,",DA=IEN
"RTN","OOPSGUI6",177,0)
 S DR=".01///^S X=SITENM;2///^S X=DISOFF"
"RTN","OOPSGUI6",178,0)
 D ^DIE
"RTN","OOPSGUI6",179,0)
 I $G(Y)="" S RESULTS="Update Site data Successful" Q
"RTN","OOPSGUI6",180,0)
 S RESULTS="Update Site data was NOT Successful"
"RTN","OOPSGUI6",181,0)
 Q
"RTN","OOPSGUI6",182,0)
CHGCASE(RESULTS,INPUT,FLD58) ;  File Change Case Status
"RTN","OOPSGUI6",183,0)
 ;  Input:    INPUT  - IEN^STAT where IEN = the ASISTS case IEN and
"RTN","OOPSGUI6",184,0)
 ;                     STAT = the new case status
"RTN","OOPSGUI6",185,0)
 ;          DELETE   - Reason for Deletion, field #58, file #2260
"RTN","OOPSGUI6",186,0)
 ; Output: RESULTS   - Message back to client with new Case Status
"RTN","OOPSGUI6",187,0)
 ;
"RTN","OOPSGUI6",188,0)
 N CURRENT,DR,DIE,IEN,Y,STATUS
"RTN","OOPSGUI6",189,0)
 S IEN=$P(INPUT,U),(STATUS,Y)=$P(INPUT,U,2)
"RTN","OOPSGUI6",190,0)
 I '$G(IEN) S RESULTS="Missing Record Identifier, cannot file." Q
"RTN","OOPSGUI6",191,0)
 I $$GET1^DIQ(2260,IEN,66)'="",(Y=2) D  Q
"RTN","OOPSGUI6",192,0)
 .S RESULTS="Case transmitted to DOL, cannot change status to Deleted."
"RTN","OOPSGUI6",193,0)
 S CURRENT=$$GET1^DIQ(2260,IEN,51,"I")
"RTN","OOPSGUI6",194,0)
CLOSE ; Close
"RTN","OOPSGUI6",195,0)
 S DR=""
"RTN","OOPSGUI6",196,0)
 S DR="51////"_Y
"RTN","OOPSGUI6",197,0)
 ;If current status goes from closed/deleted to Open, reset field 57
"RTN","OOPSGUI6",198,0)
 I (CURRENT=1!(CURRENT=2)),(Y=0) S DR=DR_";57////@"
"RTN","OOPSGUI6",199,0)
 I FLD58]"" S DR=DR_";58////"_FLD58
"RTN","OOPSGUI6",200,0)
 S DIE="^OOPS(2260,",DA=IEN
"RTN","OOPSGUI6",201,0)
 D ^DIE K DIE,DA
"RTN","OOPSGUI6",202,0)
 I $D(Y)'=0 Q
"RTN","OOPSGUI6",203,0)
 S RESULTS="Case Status has been changed to: "_$$GET1^DIQ(2260,IEN,51)
"RTN","OOPSGUI6",204,0)
 ;01/02/04 Patch 4 llh- if case = closed, send bulletin
"RTN","OOPSGUI6",205,0)
 I STATUS=1 D CLSCASE^OOPSMBUL(IEN)
"RTN","OOPSGUI6",206,0)
 Q
"RTN","OOPSGUIC")
0^3^B79794142^B66128626
"RTN","OOPSGUIC",1,0)
OOPSGUIC ;WIOFO/LLH-RPC routine for GET/SET CA7 ;04/22/04
"RTN","OOPSGUIC",2,0)
 ;;2.0;ASISTS;**8,7,23,24,25**;Jun 03, 2002;Build 4
"RTN","OOPSGUIC",3,0)
 ;
"RTN","OOPSGUIC",4,0)
CA7LIST(RESULTS,PERSON,CALL) ; builds CA-7 selection list from existing
"RTN","OOPSGUIC",5,0)
 ;                         cases - not an add
"RTN","OOPSGUIC",6,0)
 ;
"RTN","OOPSGUIC",7,0)
 ;   Input:  PERSON  - person's SSN whether CALL="E" or "W"
"RTN","OOPSGUIC",8,0)
 ;              CALL - contains the calling menu and file number in the
"RTN","OOPSGUIC",9,0)
 ;                     format FILENUM^CALL.
"RTN","OOPSGUIC",10,0)
 ;  Output:  RESULTS - returns an array containing
"RTN","OOPSGUIC",11,0)
 ;                     CA7 case #^IEN^DATE OF INCIDENT
"RTN","OOPSGUIC",12,0)
 K ^TMP("CA7LIST",DUZ)
"RTN","OOPSGUIC",13,0)
 N ARR,CA7,CAIEN,CALLER,ESSN,FILE
"RTN","OOPSGUIC",14,0)
 S FILE=$P($G(CALL),U),CALLER=$P($G(CALL),U,2)
"RTN","OOPSGUIC",15,0)
 I $G(PERSON)=""!($G(CALL)="")!($G(FILE)="") D  Q
"RTN","OOPSGUIC",16,0)
 . S ^TMP("CA7LIST",DUZ,1)="Not enough info - can't process request"
"RTN","OOPSGUIC",17,0)
 S CAIEN=0,^TMP("CA7LIST",DUZ,1)="No CA-7's Selectable"
"RTN","OOPSGUIC",18,0)
 S ESSN=$$GET1^DIQ(200,DUZ,9)
"RTN","OOPSGUIC",19,0)
 I CALLER="E",ESSN'=PERSON D  Q
"RTN","OOPSGUIC",20,0)
 .S ^TMP("CA7LIST",DUZ,1)="User SSN, file SSN do not match-form aborted"
"RTN","OOPSGUIC",21,0)
 F  S CAIEN=$O(^OOPS(FILE,"SSN",PERSON,CAIEN)) Q:CAIEN=""  D
"RTN","OOPSGUIC",22,0)
 .;if from emp menu & signed by both, don't give access
"RTN","OOPSGUIC",23,0)
 .I CALLER="E",$P($G(^OOPS(FILE,CAIEN,"CA7S7")),U,2)'="",($P($G(^OOPS(FILE,CAIEN,"CA7S15")),U,2)'="") Q
"RTN","OOPSGUIC",24,0)
 .I CALLER="W",(ESSN=PERSON) Q
"RTN","OOPSGUIC",25,0)
 .S CA7=$$GET1^DIQ(FILE,CAIEN,.01),ARR(CA7)=CAIEN
"RTN","OOPSGUIC",26,0)
 ; drop thru here and
"RTN","OOPSGUIC",27,0)
SORT ; reverse the order
"RTN","OOPSGUIC",28,0)
 N CN,CA7,CAIEN,DOI,NM,SSN
"RTN","OOPSGUIC",29,0)
 S ^TMP("CA7LIST",DUZ,0)="",CN=1,CA7=""
"RTN","OOPSGUIC",30,0)
 I '$D(ARR) S ^TMP("CA7LIST",DUZ,1)="No CA7's Selectable"
"RTN","OOPSGUIC",31,0)
 F  S CA7=$O(ARR(CA7),-1) Q:CA7=""  D
"RTN","OOPSGUIC",32,0)
 .S CAIEN=ARR(CA7)
"RTN","OOPSGUIC",33,0)
 .S ASISTS=$$GET1^DIQ(2260,$$GET1^DIQ(FILE,CAIEN,.7,"I"),52,"I")
"RTN","OOPSGUIC",34,0)
 .S ASISTS="CA-"_$G(ASISTS)
"RTN","OOPSGUIC",35,0)
 .S NM=$E($$GET1^DIQ(FILE,CAIEN,.9),1,27)
"RTN","OOPSGUIC",36,0)
 .S DOI=$$GET1^DIQ(FILE,CAIEN,7)
"RTN","OOPSGUIC",37,0)
 .S SSN=$$GET1^DIQ(FILE,CAIEN,.8)
"RTN","OOPSGUIC",38,0)
 .S ^TMP("CA7LIST",DUZ,CN)=CA7_U_DOI_U_NM_U_ASISTS_U_CAIEN_U_SSN_$C(10)
"RTN","OOPSGUIC",39,0)
 .S CN=CN+1
"RTN","OOPSGUIC",40,0)
 ; then quit
"RTN","OOPSGUIC",41,0)
 S RESULTS=$NA(^TMP("CA7LIST",DUZ))
"RTN","OOPSGUIC",42,0)
 Q
"RTN","OOPSGUIC",43,0)
LISTCA(RESULTS,INPUT) ; returns a list of valid CA (1 or 2) claims that
"RTN","OOPSGUIC",44,0)
 ;                 can be selected to create a new CA-7
"RTN","OOPSGUIC",45,0)
 ;  Input:   INPUT - 3 pieces to input parameter
"RTN","OOPSGUIC",46,0)
 ;                   SSN^FILE^CALLER - CALLER contains either E
"RTN","OOPSGUIC",47,0)
 ;                   or W (menu called from).
"RTN","OOPSGUIC",48,0)
 ;                   FILE now only contains 2260 (for CA-1 or 2)
"RTN","OOPSGUIC",49,0)
 ; Output: RESULTS - contains a array of ASISTS Claims with the
"RTN","OOPSGUIC",50,0)
 ;                   claim number, name, and date of injury.  Other
"RTN","OOPSGUIC",51,0)
 ;                   default fields returned are, grade, step, pay amt,
"RTN","OOPSGUIC",52,0)
 ;                   pay period, FEGLI Code, and Health Ins.
"RTN","OOPSGUIC",53,0)
 ;
"RTN","OOPSGUIC",54,0)
 K ^TMP("LISTCA",DUZ)
"RTN","OOPSGUIC",55,0)
 N ARR,CAIEN,CALLER,CAIEN,CN,CNUM,DOI,FILE,INJ,NM,PAR,PDFLD,SSN
"RTN","OOPSGUIC",56,0)
 S PAR=$P($G(INPUT),U),FILE=$P($G(INPUT),U,2),CALLER=$P($G(INPUT),U,3)
"RTN","OOPSGUIC",57,0)
 I $G(PAR)=""!($G(FILE)="")!($G(CALLER)="") D  Q
"RTN","OOPSGUIC",58,0)
 .S ^TMP("LISTCA",DUZ,0)="Missing parameters - cannot continue"
"RTN","OOPSGUIC",59,0)
 S CAIEN=0
"RTN","OOPSGUIC",60,0)
 F  S CAIEN=$O(^OOPS(FILE,"SSN",PAR,CAIEN)) Q:CAIEN=""  D
"RTN","OOPSGUIC",61,0)
 .I '$$INCLUDE() Q
"RTN","OOPSGUIC",62,0)
 .I CALLER="E",($$GET1^DIQ(200,DUZ,9)'=PAR) Q
"RTN","OOPSGUIC",63,0)
 .I CALLER="W",($$GET1^DIQ(200,DUZ,9)=PAR) Q
"RTN","OOPSGUIC",64,0)
 .S CNUM=$$GET1^DIQ(FILE,CAIEN,.01),ARR(CNUM)=CAIEN
"RTN","OOPSGUIC",65,0)
 ; No cases to send back
"RTN","OOPSGUIC",66,0)
 I '$D(ARR) D  Q
"RTN","OOPSGUIC",67,0)
 .S ^TMP("LISTCA",DUZ,1)="No Cases Selectable"
"RTN","OOPSGUIC",68,0)
 .S RESULTS=$NA(^TMP("LISTCA",DUZ))
"RTN","OOPSGUIC",69,0)
 ; get reverse order
"RTN","OOPSGUIC",70,0)
 S CNUM="",CN=1
"RTN","OOPSGUIC",71,0)
 F  S CNUM=$O(ARR(CNUM),-1) Q:CNUM=""  D
"RTN","OOPSGUIC",72,0)
 .S CAIEN=ARR(CNUM)
"RTN","OOPSGUIC",73,0)
 .S NM=$$GET1^DIQ(FILE,CAIEN,1)
"RTN","OOPSGUIC",74,0)
 .S DOI=$$GET1^DIQ(FILE,CAIEN,4)
"RTN","OOPSGUIC",75,0)
 .S SSN=$TR($$GET1^DIQ(FILE,CAIEN,5),"-","")
"RTN","OOPSGUIC",76,0)
 .S GRD=$$GET1^DIQ(FILE,CAIEN,16)
"RTN","OOPSGUIC",77,0)
 .S STP=$$GET1^DIQ(FILE,CAIEN,17)
"RTN","OOPSGUIC",78,0)
 .S INJ=$$GET1^DIQ(FILE,CAIEN,52)
"RTN","OOPSGUIC",79,0)
 .S RET=$$GET1^DIQ(FILE,CAIEN,60)
"RTN","OOPSGUIC",80,0)
 .S PAY=$$GET1^DIQ(FILE,CAIEN,166)
"RTN","OOPSGUIC",81,0)
 .S PER=$$GET1^DIQ(FILE,CAIEN,167)
"RTN","OOPSGUIC",82,0)
 .; only need to do this 1 time, should never have but 1 different
"RTN","OOPSGUIC",83,0)
 .; person in this list, many claims but all for the same person
"RTN","OOPSGUIC",84,0)
 .I CN=1 S PDFLD=$$PDDEF()
"RTN","OOPSGUIC",85,0)
 .S STR=CNUM_U_DOI_U_NM_U_CAIEN_U_SSN_U_INJ_U_GRD_U_STP_U_PAY_U_PER
"RTN","OOPSGUIC",86,0)
 .S ^TMP("LISTCA",DUZ,CN)=STR_U_RET_U_PDFLD_U_DUZ_$C(10)
"RTN","OOPSGUIC",87,0)
 .S CN=CN+1
"RTN","OOPSGUIC",88,0)
 S RESULTS=$NA(^TMP("LISTCA",DUZ))
"RTN","OOPSGUIC",89,0)
 Q
"RTN","OOPSGUIC",90,0)
INCLUDE() ; checks to make sure ok to include claim in list
"RTN","OOPSGUIC",91,0)
 N CA7OK
"RTN","OOPSGUIC",92,0)
 S CA7OK=1
"RTN","OOPSGUIC",93,0)
 ; if claim not sent to DOL, can't pick
"RTN","OOPSGUIC",94,0)
 I $$GET1^DIQ(FILE,CAIEN,67)="" S CA7OK=0
"RTN","OOPSGUIC",95,0)
 ; if deleted, replaced by amendment - can't pick
"RTN","OOPSGUIC",96,0)
 I $$GET1^DIQ(FILE,CAIEN,51,"I")>1 S CA7OK=0
"RTN","OOPSGUIC",97,0)
 Q (CA7OK)
"RTN","OOPSGUIC",98,0)
PDDEF() ; get Fegli Code and Health insurance fields from paid
"RTN","OOPSGUIC",99,0)
 N CNT,FEG,FEG1,INS,INS1,PAID
"RTN","OOPSGUIC",100,0)
 S (FEG,FEG1,INS,INS1)=""
"RTN","OOPSGUIC",101,0)
 D FIND^DIC(450,,"@;226EI;231I","MPSC",SSN,10,"SSN")
"RTN","OOPSGUIC",102,0)
 I $G(DIERR) D CLEAN^DILF Q FEG_U_INS
"RTN","OOPSGUIC",103,0)
 I $P(^TMP("DILIST",$J,0),U)=0 Q FEG_U_INS
"RTN","OOPSGUIC",104,0)
 S PAID=$G(^TMP("DILIST",$J,1,0)),FEG=$P(PAID,U,3)
"RTN","OOPSGUIC",105,0)
 ; if A0 - ineligible, B0 - waived therefore No 
"RTN","OOPSGUIC",106,0)
 I FEG="A0"!(FEG="B0") S FEG1="N;"
"RTN","OOPSGUIC",107,0)
 ; if C0 - only Basic
"RTN","OOPSGUIC",108,0)
 I FEG="C0" S FEG1="Y;"
"RTN","OOPSGUIC",109,0)
 ; has Fegli, but not basic, additional, get additional code
"RTN","OOPSGUIC",110,0)
 I $G(FEG1)="",($L($P(PAID,U,2),"Basic +")>1) S FEG1="Y;"_FEG
"RTN","OOPSGUIC",111,0)
 ; now deal with insurance
"RTN","OOPSGUIC",112,0)
 S INS=$P(PAID,U,4)
"RTN","OOPSGUIC",113,0)
 ; if INS = 000, 001, 002, 003 they don't have insurance
"RTN","OOPSGUIC",114,0)
 I (INS?.N)&(+INS<4) S INS1="N;"
"RTN","OOPSGUIC",115,0)
 ; otherwise they do, get the code
"RTN","OOPSGUIC",116,0)
 I $G(INS1)="" S INS1="Y;"_INS
"RTN","OOPSGUIC",117,0)
 Q INS1_U_FEG1
"RTN","OOPSGUIC",118,0)
MULTIPLE(RESULTS,INPUT,DATA) ; retrieve data from multiple
"RTN","OOPSGUIC",119,0)
 ; NOTE:  When filing into subrecord, the entire subrecord is deleted
"RTN","OOPSGUIC",120,0)
 ;        then rebuilt.  Also, the field number for the subrecord
"RTN","OOPSGUIC",121,0)
 ;        must be passed with the data.
"RTN","OOPSGUIC",122,0)
 ;        WORD PROCESSING fields CANNOT file using this code
"RTN","OOPSGUIC",123,0)
 ;   Input:   INPUT - in the format FILE^FIELD^IEN
"RTN","OOPSGUIC",124,0)
 ;             DATA - array of data in the format
"RTN","OOPSGUIC",125,0)
 ;                    DATA(SIEN)=data where data = P1^P2^P3 etc, where
"RTN","OOPSGUIC",126,0)
 ;                    P1 = subfield #;data
"RTN","OOPSGUIC",127,0)
 ;                    DATA="" must be true for a GET.
"RTN","OOPSGUIC",128,0)
 ;  Output: RESULTS - data from all records in the multiple will
"RTN","OOPSGUIC",129,0)
 ;                     be returned.  it will be saved in a pieced
"RTN","OOPSGUIC",130,0)
 ;                     string.
"RTN","OOPSGUIC",131,0)
 N ACTION,ARR,IEN,FIELD,FILE,ROOT,SAVEDIK,SPEC,SUB,OOPSCNT,OOPSSV,OOPSSV1
"RTN","OOPSGUIC",132,0)
 S FILE=$P($G(INPUT),U),FIELD=$P($G(INPUT),U,2),IEN=$P($G(INPUT),U,3)
"RTN","OOPSGUIC",133,0)
 S ACTION="" I $D(DATA)>1 S ACTION=1
"RTN","OOPSGUIC",134,0)
 S RESULTS(0)="Record Accessed, no data"
"RTN","OOPSGUIC",135,0)
 I $G(IEN)=""!($G(FILE)="")!($G(FIELD)="") D  Q
"RTN","OOPSGUIC",136,0)
 . S RESULTS(0)="Invalid parameters cannot continue"
"RTN","OOPSGUIC",137,0)
 S ROOT=$$ROOT^DILFD(FILE,0,"GL")
"RTN","OOPSGUIC",138,0)
 S SPEC=+$$GET1^DID(FILE,FIELD,"","SPECIFIER")
"RTN","OOPSGUIC",139,0)
 S SUB=$$GET1^DID(FILE,FIELD,"","GLOBAL SUBSCRIPT LOCATION")
"RTN","OOPSGUIC",140,0)
 I '$$GET1^DID(FILE,FIELD,"","MULTIPLE-VALUED"),'$G(SPEC) D  Q
"RTN","OOPSGUIC",141,0)
 . S RESULTS(1)="Field in not a multiple, cannot continue"
"RTN","OOPSGUIC",142,0)
 ; now go get data from subfile
"RTN","OOPSGUIC",143,0)
 S SAVEDIK=ROOT_IEN_","_$C(34)_$P(SUB,";")_$C(34)_","
"RTN","OOPSGUIC",144,0)
 ;RRA OOPS*2*23 - ticket 396917 
"RTN","OOPSGUIC",145,0)
 ;GUI may pass in name as a string - so if there are duplicate names in #200
"RTN","OOPSGUIC",146,0)
 ;it doesn't know how to resolve the name to an ien
"RTN","OOPSGUIC",147,0)
 ;also adding a "/" (to create a "////") to the fields so they bypass fileman  
"RTN","OOPSGUIC",148,0)
 ;validation in case the DUZ is 4 digits (could confuse as SSN) 
"RTN","OOPSGUIC",149,0)
 I ACTION,FILE=2260,FIELD=95 D
"RTN","OOPSGUIC",150,0)
 . S OOPSCNT=0
"RTN","OOPSGUIC",151,0)
 . F  S OOPSCNT=$O(DATA(OOPSCNT)) Q:OOPSCNT'>0  D
"RTN","OOPSGUIC",152,0)
 .. S OOPSSV=$P($P($G(DATA(OOPSCNT)),"^",8),";",2)
"RTN","OOPSGUIC",153,0)
 .. S OOPSSV1=$P($P($G(DATA(OOPSCNT)),"^",10),";",2)
"RTN","OOPSGUIC",154,0)
 .. I '+OOPSSV S OOPSSV=$P($G(^OOPS(2260,IEN,"OUTC",OOPSCNT,0)),"^",8)
"RTN","OOPSGUIC",155,0)
 .. I '+OOPSSV1 S OOPSSV1=$P($G(^OOPS(2260,IEN,"OUTC",OOPSCNT,0)),"^",10)
"RTN","OOPSGUIC",156,0)
 ..S $P(DATA(OOPSCNT),"^",8)="7;/"_OOPSSV
"RTN","OOPSGUIC",157,0)
 ..S $P(DATA(OOPSCNT),"^",10)="9;/"_OOPSSV1
"RTN","OOPSGUIC",158,0)
 ;END RRA OOPS*2*23
"RTN","OOPSGUIC",159,0)
 I 'ACTION D GETD
"RTN","OOPSGUIC",160,0)
 I ACTION D KILLD,SETD
"RTN","OOPSGUIC",161,0)
 Q
"RTN","OOPSGUIC",162,0)
GETD ; get the data
"RTN","OOPSGUIC",163,0)
 N CNT,DATA,FLDA,FLDS,IENS,SIEN,SFLD,SREC,TYPE
"RTN","OOPSGUIC",164,0)
 S CNT=0,IENS=IEN_","
"RTN","OOPSGUIC",165,0)
 S FLDA=FIELD_"*"
"RTN","OOPSGUIC",166,0)
 ; hate to hardwire, but need data back as entered, not canonical
"RTN","OOPSGUIC",167,0)
 I FILE=2262.03,FIELD=15 D FLD15 Q
"RTN","OOPSGUIC",168,0)
 ;if Incident Outcome multiple, need to sort in chron order OOPS*25
"RTN","OOPSGUIC",169,0)
 I FILE=2260,FIELD=95 D FLD95 Q
"RTN","OOPSGUIC",170,0)
 D GETS^DIQ(FILE,IENS,FLDA,,"ARR")
"RTN","OOPSGUIC",171,0)
 I $D(ARR) S SIEN="",RESULTS(0)="" D
"RTN","OOPSGUIC",172,0)
 .F  S SIEN=$O(ARR(SPEC,SIEN)) Q:SIEN=""  D
"RTN","OOPSGUIC",173,0)
 ..S SFLD="",SREC=$P(SIEN,",")
"RTN","OOPSGUIC",174,0)
 ..F  S SFLD=$O(ARR(SPEC,SIEN,SFLD)) Q:SFLD=""  D
"RTN","OOPSGUIC",175,0)
 ...S DATA=ARR(SPEC,SIEN,SFLD)_U
"RTN","OOPSGUIC",176,0)
 ...S:$D(RESULTS(CNT))=0 RESULTS(CNT)=""
"RTN","OOPSGUIC",177,0)
 ...S RESULTS(CNT)=RESULTS(CNT)_DATA
"RTN","OOPSGUIC",178,0)
 ..S CNT=CNT+1
"RTN","OOPSGUIC",179,0)
 Q
"RTN","OOPSGUIC",180,0)
KILLD ; first kill all records in subfile, then rebuild
"RTN","OOPSGUIC",181,0)
 N DA,DIK,NODE
"RTN","OOPSGUIC",182,0)
 S NODE=$P(SUB,";"),DA=0,DA(1)=IEN,DIK=SAVEDIK
"RTN","OOPSGUIC",183,0)
 F  S DA=$O(@(ROOT_"DA(1),NODE,DA)")) Q:(+DA'>0)  D ^DIK
"RTN","OOPSGUIC",184,0)
 Q
"RTN","OOPSGUIC",185,0)
SETD ; subrecord cleaned out, now rebuild
"RTN","OOPSGUIC",186,0)
 N BAD,CN,DR,DIE,DA,DLAYGO,I,NUM,STR,DIC,TYPE
"RTN","OOPSGUIC",187,0)
 K DR
"RTN","OOPSGUIC",188,0)
 S RESULTS(0)="Filing successful"
"RTN","OOPSGUIC",189,0)
 S CN=0,DLAYGO=FILE,DA(1)=IEN,DIC=SAVEDIK,DIC(0)="L"
"RTN","OOPSGUIC",190,0)
 F  S CN=$O(DATA(CN)) Q:CN'>0  S X="",BAD=0 D
"RTN","OOPSGUIC",191,0)
 .S STR=DATA(CN),NUM=$L(DATA(CN),U),DIC("DR")=""
"RTN","OOPSGUIC",192,0)
 .F I=1:1:NUM S STR1=$P($G(STR),U,I) D:('BAD)
"RTN","OOPSGUIC",193,0)
 ..I $P(STR1,";")=.01,$P(STR1,";")="",$P(STR1,";",2)="" S BAD=1 Q
"RTN","OOPSGUIC",194,0)
 ..I $P(STR1,";")=.01 D
"RTN","OOPSGUIC",195,0)
 ...S TYPE=$$GET1^DID(SPEC,.01,"","TYPE")
"RTN","OOPSGUIC",196,0)
 ...I TYPE="DATE/TIME" S X=$$FMTE^XLFDT($P(STR1,";",2),2)
"RTN","OOPSGUIC",197,0)
 ...E  S X=$P(STR1,";",2)
"RTN","OOPSGUIC",198,0)
 ..S DIC("DR")=DIC("DR")_$P(STR1,";")_"///"_$P(STR1,";",2)_";"
"RTN","OOPSGUIC",199,0)
 .D MFILE
"RTN","OOPSGUIC",200,0)
 Q
"RTN","OOPSGUIC",201,0)
MFILE ; file the multiple
"RTN","OOPSGUIC",202,0)
 N PCE,PCE1,TMP
"RTN","OOPSGUIC",203,0)
 I X="" S RESULTS(0)=".01 field missing - could not file" Q
"RTN","OOPSGUIC",204,0)
 I $G(BAD) S RESULTS(0)="Problems Filing subrecord" Q
"RTN","OOPSGUIC",205,0)
 I $L(DIC("DR"))>240 D
"RTN","OOPSGUIC",206,0)
 .S PCE=$L(DIC("DR"),";"),TMP=DIC("DR"),PCE1=$P(PCE/2,".")
"RTN","OOPSGUIC",207,0)
 .S DIC("DR")=$P(TMP,";",1,PCE1)
"RTN","OOPSGUIC",208,0)
 .K DD,DO D FILE^DICN I Y'>0 S BAD=1
"RTN","OOPSGUIC",209,0)
 .S DIC("DR")=$P(TMP,";",(PCE1+1),PCE)
"RTN","OOPSGUIC",210,0)
 K DD,DO D FILE^DICN I Y'>0 S BAD=1
"RTN","OOPSGUIC",211,0)
 I BAD S RESULTS(0)="Problems filing subrecord"
"RTN","OOPSGUIC",212,0)
 Q
"RTN","OOPSGUIC",213,0)
OSHA300(RESULTS,STA,DATA) ; Files data into subrecord 2262.315
"RTN","OOPSGUIC",214,0)
 ;  Input - STA is the station number subrecord IEN
"RTN","OOPSGUIC",215,0)
 ;         DATA is an number subscripted array containing the records
"RTN","OOPSGUIC",216,0)
 ;              that contain the Emp Numbers and hours worked in the
"RTN","OOPSGUIC",217,0)
 ;              OSHA MONTH/YEAR subrecord.
"RTN","OOPSGUIC",218,0)
 ; Output - RESULTS indicating the success of the filing.
"RTN","OOPSGUIC",219,0)
 ;
"RTN","OOPSGUIC",220,0)
 N CNT,IENS,FILE,OSHAFDA,LV1,LV2,PAR,REC,STR
"RTN","OOPSGUIC",221,0)
 S CNT=1,FILE=2262.315
"RTN","OOPSGUIC",222,0)
 S PAR="^OOPS(2262,0)",PAR=$Q(@PAR),PAR=$Q(@PAR)
"RTN","OOPSGUIC",223,0)
 S LV1=$P(PAR,",",2),LV2=$P(PAR,",",3)
"RTN","OOPSGUIC",224,0)
 S RESULTS=""
"RTN","OOPSGUIC",225,0)
 I $D(DATA)<10 S RESULTS="NO DATA TO FILE, CANNOT CONTINUE" Q
"RTN","OOPSGUIC",226,0)
 I '$G(STA) S RESULTS="NOT ENOUGH PARAMETERS, COULDN'T FILE" Q
"RTN","OOPSGUIC",227,0)
 I '$D(^OOPS(2262,LV1,LV2,STA)) D  Q
"RTN","OOPSGUIC",228,0)
 .S RESULTS="NO STATION RECORD, COULDN'T FILE"
"RTN","OOPSGUIC",229,0)
 K ^OOPS(2262,LV1,LV2,STA,2)
"RTN","OOPSGUIC",230,0)
 S REC=0 F  S REC=$O(DATA(REC)) Q:REC=""  D
"RTN","OOPSGUIC",231,0)
 .S IENS="?+"_CNT_","_STA_","_LV1_","
"RTN","OOPSGUIC",232,0)
 .S STR=DATA(REC)
"RTN","OOPSGUIC",233,0)
 .S OSHAFDA(FILE,IENS,.01)=$P($P(STR,U,1),";",2)
"RTN","OOPSGUIC",234,0)
 .S OSHAFDA(FILE,IENS,1)=$P($P(STR,U,2),";",2)
"RTN","OOPSGUIC",235,0)
 .S OSHAFDA(FILE,IENS,2)=$P($P(STR,U,3),";",2)
"RTN","OOPSGUIC",236,0)
 .S CNT=CNT+1
"RTN","OOPSGUIC",237,0)
 D UPDATE^DIE("E","OSHAFDA","IENS","MSG")
"RTN","OOPSGUIC",238,0)
 I '$D(MSG) S RESULTS="Filing Successful"
"RTN","OOPSGUIC",239,0)
 K MSG,STR,Y,X,%DT
"RTN","OOPSGUIC",240,0)
 Q
"RTN","OOPSGUIC",241,0)
FLD15 ; retrieves OSHA 300A Summary data from file 2262
"RTN","OOPSGUIC",242,0)
 N CNT,DATE,LV1,LV2,PAR,REC
"RTN","OOPSGUIC",243,0)
 S CNT=0,PAR="^OOPS(2262,0)",PAR=$Q(@PAR),PAR=$Q(@PAR)
"RTN","OOPSGUIC",244,0)
 S LV1=$P(PAR,",",2),LV2=$P(PAR,",",3),IENS=$P(IEN,",",1),REC=0
"RTN","OOPSGUIC",245,0)
 F  S REC=$O(^OOPS(2262,LV1,LV2,IENS,2,REC)) Q:REC'>0  D
"RTN","OOPSGUIC",246,0)
 .S STR=$G(^OOPS(2262,LV1,LV2,IENS,2,REC,0))
"RTN","OOPSGUIC",247,0)
 .S Y=$P(STR,U,1) D DD^%DT
"RTN","OOPSGUIC",248,0)
 .S RESULTS(CNT)=Y_U_$P(STR,U,2,3)
"RTN","OOPSGUIC",249,0)
 .S CNT=CNT+1
"RTN","OOPSGUIC",250,0)
 Q
"RTN","OOPSGUIC",251,0)
FLD95 ; sort Incident Outcomes so they display in chron order OOPS*25
"RTN","OOPSGUIC",252,0)
 N OOPSCNT,OOPSSREC,OOPSIEN,OOPSSUB,OOPSFLD,OOPSDATA,OOPSARR
"RTN","OOPSGUIC",253,0)
 S OOPSCNT=0
"RTN","OOPSGUIC",254,0)
 D GETS^DIQ(FILE,IENS,FLDA,,"ARR")
"RTN","OOPSGUIC",255,0)
 ;rebuild array so when it $O's it goes through in chron order
"RTN","OOPSGUIC",256,0)
 I $D(ARR) S OOPSSUB="",RESULTS(0)="" D
"RTN","OOPSGUIC",257,0)
 .F  S OOPSSUB=$O(ARR(SPEC,OOPSSUB)) Q:OOPSSUB=""  D
"RTN","OOPSGUIC",258,0)
 ..S OOPSSREC=$P(OOPSSUB,","),OOPSIEN=$P(OOPSSUB,",",2),OOPSFLD=""
"RTN","OOPSGUIC",259,0)
 ..F  S OOPSFLD=$O(ARR(SPEC,OOPSSUB,OOPSFLD)) Q:OOPSFLD=""  D
"RTN","OOPSGUIC",260,0)
 ...S OOPSARR(OOPSSREC,OOPSFLD)=ARR(SPEC,OOPSSUB,OOPSFLD)
"RTN","OOPSGUIC",261,0)
 ;now go through the new subscripted array and process
"RTN","OOPSGUIC",262,0)
 S OOPSSREC=""
"RTN","OOPSGUIC",263,0)
 F  S OOPSSREC=$O(OOPSARR(OOPSSREC)) Q:OOPSSREC=""  D
"RTN","OOPSGUIC",264,0)
 .S OOPSFLD=""
"RTN","OOPSGUIC",265,0)
 .F  S OOPSFLD=$O(OOPSARR(OOPSSREC,OOPSFLD)) Q:OOPSFLD=""  D
"RTN","OOPSGUIC",266,0)
 ..S OOPSDATA=OOPSARR(OOPSSREC,OOPSFLD)_U
"RTN","OOPSGUIC",267,0)
 ..S:$D(RESULTS(OOPSCNT))=0 RESULTS(OOPSCNT)=""
"RTN","OOPSGUIC",268,0)
 ..S RESULTS(OOPSCNT)=RESULTS(OOPSCNT)_OOPSDATA
"RTN","OOPSGUIC",269,0)
 .S OOPSCNT=OOPSCNT+1
"RTN","OOPSGUIC",270,0)
 Q
"RTN","OOPSGUIR")
0^2^B71502420^B70518771
"RTN","OOPSGUIR",1,0)
OOPSGUIR ;WIOFO/LLH-RPC routine for misc reports ; 6/11/09 10:32am
"RTN","OOPSGUIR",2,0)
 ;;2.0;ASISTS;**8,7,11,14,20,25**;Jun 03, 2002;Build 4
"RTN","OOPSGUIR",3,0)
 ;
"RTN","OOPSGUIR",4,0)
ENT(RESULTS,INPUT,CALL) ; get the data for the report
"RTN","OOPSGUIR",5,0)
 ;   Input:  INPUT - contains 3 values, the START AND END DATE, 
"RTN","OOPSGUIR",6,0)
 ;                   STATION. The Date of Occ (fld #4) is used to 
"RTN","OOPSGUIR",7,0)
 ;                   in/exclude claims from the report. If Station='ALL'
"RTN","OOPSGUIR",8,0)
 ;                   then all claims are included, if not 'All', then
"RTN","OOPSGUIR",9,0)
 ;                   only 1 station is included.
"RTN","OOPSGUIR",10,0)
 ;            CALL - contains the report call which will invoke
"RTN","OOPSGUIR",11,0)
 ;                   the appropriate M call 
"RTN","OOPSGUIR",12,0)
 ; Output: RESULTS - the results array passes data back to the client.
"RTN","OOPSGUIR",13,0)
 N CAX,FI,LP,MENU,SDATE,STDT,STA,STATION,ENDDT,EDATE,TAG,X,Y,%DT
"RTN","OOPSGUIR",14,0)
 S RESULTS(0)="Processing..."
"RTN","OOPSGUIR",15,0)
 S STDT=$P($G(INPUT),U),ENDDT=$P($G(INPUT),U,2)
"RTN","OOPSGUIR",16,0)
 S STA=$P($G(INPUT),U,3),TAG=CALL
"RTN","OOPSGUIR",17,0)
 I (STDT="")!(ENDDT="")!(STA="")!(TAG="") D  Q
"RTN","OOPSGUIR",18,0)
 . S RESULTS(0)="Input parameters missing, cannot run report." Q
"RTN","OOPSGUIR",19,0)
 K ^TMP($J,TAG)
"RTN","OOPSGUIR",20,0)
 S (SDATE,EDATE,MENU)=""
"RTN","OOPSGUIR",21,0)
 S X=STDT D ^%DT S SDATE=Y
"RTN","OOPSGUIR",22,0)
 S X=ENDDT D ^%DT S EDATE=Y
"RTN","OOPSGUIR",23,0)
 ; SDATE made last time in day prior so start date correct
"RTN","OOPSGUIR",24,0)
 I TAG="LOG300U" S TAG="LOG300",MENU="U"
"RTN","OOPSGUIR",25,0)
 S SDATE=(SDATE-1)+.9999,EDATE=EDATE_".9999"
"RTN","OOPSGUIR",26,0)
 D @TAG
"RTN","OOPSGUIR",27,0)
 Q
"RTN","OOPSGUIR",28,0)
SERVICE ; Service/Detail Location report - patch 11
"RTN","OOPSGUIR",29,0)
DSPUTE ; Reason for Dispute report. Patch 11
"RTN","OOPSGUIR",30,0)
FLD174 ; Report compiles filing instruction result counts
"RTN","OOPSGUIR",31,0)
FLD332 ; Use this tag for Reason for Controvert report. Patch 11
"RTN","OOPSGUIR",32,0)
 N ARR,CODE,CN,LP,IEN,I,GOON,P2,TX
"RTN","OOPSGUIR",33,0)
 S LP="",IEN="",CN=0
"RTN","OOPSGUIR",34,0)
 I TAG="FLD174" D
"RTN","OOPSGUIR",35,0)
 .S CODE=$P($G(^DD(2260,174,0)),U,3)
"RTN","OOPSGUIR",36,0)
 .F I=1:1 S LP=$P(CODE,";",I) Q:$G(LP)=""  I $P(LP,":",2)'="" S ARR(LP)=0
"RTN","OOPSGUIR",37,0)
 .S ARR(I_":No Data Entered")=0
"RTN","OOPSGUIR",38,0)
 I TAG="FLD332" D
"RTN","OOPSGUIR",39,0)
 .F I=1:1 Q:'$D(^OOPS(2262.4,I))  S ARR(I_":"_$P(^OOPS(2262.4,I,0),U))=0
"RTN","OOPSGUIR",40,0)
 .S ARR(98_":Blk 36 also has text entered")=0
"RTN","OOPSGUIR",41,0)
 .S ARR(99_":Controvert question checked Yes, but no Controvert Code entered")=0
"RTN","OOPSGUIR",42,0)
 F LP=SDATE:0 S LP=$O(^OOPS(2260,"AD",LP)) Q:(LP'>0)!(LP>EDATE)  D
"RTN","OOPSGUIR",43,0)
 .F  S IEN=$O(^OOPS(2260,"AD",LP,IEN)) Q:IEN'>0  D
"RTN","OOPSGUIR",44,0)
 ..I $$GET1^DIQ(2260,IEN,51,"I")>1 Q      ;only allow open/closed cases
"RTN","OOPSGUIR",45,0)
 ..S CAX=$$GET1^DIQ(2260,IEN,52,"I")
"RTN","OOPSGUIR",46,0)
 ..I TAG'="SERVICE"&(CAX=2) Q                       ;only allow CA1's
"RTN","OOPSGUIR",47,0)
 ..S STATION=$P(^OOPS(2260,IEN,"2162A"),U,9)
"RTN","OOPSGUIR",48,0)
 ..I ($G(STA)'="A"),(STATION'=STA) Q        ;get correct station
"RTN","OOPSGUIR",49,0)
 ..;patch 11 - sent to OOPSGUIF due to size this routine
"RTN","OOPSGUIR",50,0)
 ..I TAG="DSPUTE" D DSPUTE^OOPSGUIF
"RTN","OOPSGUIR",51,0)
 ..I TAG="SERVICE" D SERVICE^OOPSGUIU
"RTN","OOPSGUIR",52,0)
 ..; Filing instructions report
"RTN","OOPSGUIR",53,0)
 ..I TAG="FLD174" D
"RTN","OOPSGUIR",54,0)
 ...S FI=$$GET1^DIQ(2260,IEN,174,"I")_":"_$$GET1^DIQ(2260,IEN,174)
"RTN","OOPSGUIR",55,0)
 ...I $$GET1^DIQ(2260,IEN,174)="" S FI=I_":No Data Entered"
"RTN","OOPSGUIR",56,0)
 ...S ARR(FI)=ARR(FI)+1
"RTN","OOPSGUIR",57,0)
 ...;patch 11 - Reason for controvert report
"RTN","OOPSGUIR",58,0)
 ..I TAG="FLD332" D
"RTN","OOPSGUIR",59,0)
 ...;first Agency Controvert must = "Y" to be counted
"RTN","OOPSGUIR",60,0)
 ...S GOON=$$GET1^DIQ(2260,IEN,165.1,"I") I $G(GOON)'="Y" D  Q
"RTN","OOPSGUIR",61,0)
 ....S:'$D(ARR("999:Case not controverted, no controvert code expected")) ARR("999:Case not controverted, no controvert code expected")=0
"RTN","OOPSGUIR",62,0)
 ....S ARR("999:Case not controverted, no controvert code expected")=ARR("999:Case not controverted, no controvert code expected")+1
"RTN","OOPSGUIR",63,0)
 ...S FI=$$GET1^DIQ(2260,IEN,332,"I")_":"_$$GET1^DIQ(2260,IEN,332)
"RTN","OOPSGUIR",64,0)
 ...I $$GET1^DIQ(2260,IEN,332)="" S FI=99_":Controvert question checked Yes, but no Controvert Code entered"
"RTN","OOPSGUIR",65,0)
 ...S ARR(FI)=ARR(FI)+1
"RTN","OOPSGUIR",66,0)
 ...I $G(^OOPS(2260,IEN,"CA1K",1,0))'="" D
"RTN","OOPSGUIR",67,0)
 ....;if case is diputed, don't count in Controvert rpt - quit
"RTN","OOPSGUIR",68,0)
 ....S GOON=$$GET1^DIQ(2260,IEN,165.2,"I") I $G(GOON)="Y" Q
"RTN","OOPSGUIR",69,0)
 ....S ARR(98_":Blk 36 also has text entered")=ARR(98_":Blk 36 also has text entered")+1
"RTN","OOPSGUIR",70,0)
 I TAG'="DSPUTE",(TAG'="SERVICE") D
"RTN","OOPSGUIR",71,0)
 .S CN=0,FI="",P2=""
"RTN","OOPSGUIR",72,0)
 .F  S FI=$O(ARR(FI)) Q:FI=""  D
"RTN","OOPSGUIR",73,0)
 ..S CN=$P(FI,":"),P2=$P(FI,":",2),CODE=0
"RTN","OOPSGUIR",74,0)
 ..I TAG="FLD332" S TX=$O(^OOPS(2262.4,"B",P2,"")) I $G(TX) S CODE=$P(^OOPS(2262.4,TX,0),U,2)
"RTN","OOPSGUIR",75,0)
 ..S ^TMP($J,TAG,CN)=P2_U_CODE_U_ARR(FI)
"RTN","OOPSGUIR",76,0)
 ..; rearrange 'bogus' Controvert Codes for report formating
"RTN","OOPSGUIR",77,0)
 ..I TAG="FLD332",(CN>97) S ^TMP($J,TAG,CN)=U_P2_U_ARR(FI)
"RTN","OOPSGUIR",78,0)
 I TAG="SERVICE" D CMPLSRV^OOPSGUIU
"RTN","OOPSGUIR",79,0)
 I TAG="DSPUTE" D DSPUTE^OOPSGUIU
"RTN","OOPSGUIR",80,0)
 S RESULTS=$NA(^TMP($J,TAG))
"RTN","OOPSGUIR",81,0)
 Q
"RTN","OOPSGUIR",82,0)
SUM300A ; Summary of Work-related injuries and illness report
"RTN","OOPSGUIR",83,0)
 N CN,EMP,FAC,HRS,STATE,STR
"RTN","OOPSGUIR",84,0)
 N COLG,COLH,COLI,COLJ,COLK,COLL,COLM
"RTN","OOPSGUIR",85,0)
 S (COLG,COLH,COLI,COLJ,COLK,COLL)=0
"RTN","OOPSGUIR",86,0)
 S (COLM(1),COLM(2),COLM(3),COLM(4),COLM(5),COLM(6))=0
"RTN","OOPSGUIR",87,0)
 S ^TMP($J,TAG,0)="No worksheet data for this station."
"RTN","OOPSGUIR",88,0)
 S FAC=$$GET1^DIQ(4,STA,.01,"E")
"RTN","OOPSGUIR",89,0)
 K ARR D STATINFO^OOPSGUI3(.ARR,STA) I $D(ARR) D
"RTN","OOPSGUIR",90,0)
 .S STATE=$P($G(ARR(0)),U,3)
"RTN","OOPSGUIR",91,0)
 .I $G(STATE)'="" D
"RTN","OOPSGUIR",92,0)
 ..S STATE=$O(^DIC(5,"B",STATE,""))
"RTN","OOPSGUIR",93,0)
 ..S $P(ARR(0),U,3)=$P(^DIC(5,STATE,0),U,2)
"RTN","OOPSGUIR",94,0)
 .S ^TMP($J,TAG,0)=FAC_U_ARR(0)
"RTN","OOPSGUIR",95,0)
 K ARR D SITEPGET^OOPSGUI6(.ARR,"OSHA300") I $D(ARR) D 
"RTN","OOPSGUIR",96,0)
 .S CN=0 F  S CN=$O(ARR(CN)) Q:CN=""  D
"RTN","OOPSGUIR",97,0)
 ..I $P(ARR(CN),U,11)'=STA Q
"RTN","OOPSGUIR",98,0)
 ..S STR=$P($P(ARR(CN),U,1)," = ",2)
"RTN","OOPSGUIR",99,0)
 ..S STR=$P(ARR(CN),U,3)_U_$P(ARR(CN),U,4)_U_$P(ARR(CN),U,6)_U
"RTN","OOPSGUIR",100,0)
 ..S STR=STR_$P(ARR(CN),U,7)_U_$P(ARR(CN),U,8)
"RTN","OOPSGUIR",101,0)
 ..S ^TMP($J,TAG,0)=^TMP($J,TAG,0)_U_STR
"RTN","OOPSGUIR",102,0)
 K ARR,DATA S DATA=""
"RTN","OOPSGUIR",103,0)
 D EMPHRS,DETAIL
"RTN","OOPSGUIR",104,0)
 Q
"RTN","OOPSGUIR",105,0)
IRWSHT ; Incidence Rates Worksheet Report
"RTN","OOPSGUIR",106,0)
 N COLHI,EMP,HRS
"RTN","OOPSGUIR",107,0)
 S ^TMP($J,TAG,1)="No Worksheet Data for this Station"
"RTN","OOPSGUIR",108,0)
 S COLHI=0
"RTN","OOPSGUIR",109,0)
 K ARR,DATA S DATA=""
"RTN","OOPSGUIR",110,0)
 D EMPHRS,DETAIL
"RTN","OOPSGUIR",111,0)
 Q
"RTN","OOPSGUIR",112,0)
DETAIL ; now get employee information
"RTN","OOPSGUIR",113,0)
LOG300 ; entry point for the OSHA 300 LOG
"RTN","OOPSGUIR",114,0)
 N CN,CASES,COLF,DOI,FLD,IEN,INC,STATION,TYPE
"RTN","OOPSGUIR",115,0)
 S DOI=SDATE,CASES=0,CN=1
"RTN","OOPSGUIR",116,0)
 F  S DOI=$O(^OOPS(2260,"AF",DOI)) Q:(DOI>EDATE)!(DOI="")  S IEN=0 D
"RTN","OOPSGUIR",117,0)
 .F  S IEN=$O(^OOPS(2260,"AF",DOI,"Y",IEN)) Q:IEN=""  D
"RTN","OOPSGUIR",118,0)
 ..S STATION=$P(^OOPS(2260,IEN,"2162A"),U,9) I $G(STATION)'=STA Q
"RTN","OOPSGUIR",119,0)
 ..I $P(^OOPS(2260,IEN,0),U,6)>1 Q
"RTN","OOPSGUIR",120,0)
 ..S CASES=CASES+1
"RTN","OOPSGUIR",121,0)
 ..I TAG="IRWSHT" D
"RTN","OOPSGUIR",122,0)
 ...I $D(^OOPS(2260,IEN,"OUTC","AC","A","J"))!$D(^OOPS(2260,IEN,"OUTC","AC","A","A")) S COLHI=COLHI+1
"RTN","OOPSGUIR",123,0)
 ..I TAG="SUM300A" D FLD95
"RTN","OOPSGUIR",124,0)
 ..I TAG="LOG300" D FLD95 D
"RTN","OOPSGUIR",125,0)
 ...S ARR(1)=$$GET1^DIQ(2260,IEN,.01),ARR(2)=$$GET1^DIQ(2260,IEN,1)
"RTN","OOPSGUIR",126,0)
 ...I $$GET1^DIQ(2260,IEN,337,"I")="Y" S ARR(2)="Privacy Case"
"RTN","OOPSGUIR",127,0)
 ...S TYPE=$$GET1^DIQ(2260,IEN,3,"I")
"RTN","OOPSGUIR",128,0)
 ...I TYPE>10&(TYPE<15) S ARR(2)="Privacy Case"
"RTN","OOPSGUIR",129,0)
 ...I MENU="U" S ARR(2)=""
"RTN","OOPSGUIR",130,0)
 ...S INC=$$GET1^DIQ(2260,IEN,52,"I"),FLD=$S(INC=1:111,INC=2:208,1:"")
"RTN","OOPSGUIR",131,0)
 ...S ARR(3)=$$GET1^DIQ(2260,IEN,FLD)
"RTN","OOPSGUIR",132,0)
 ...S ARR(4)=$P($$FMTE^XLFDT(($$GET1^DIQ(2260,IEN,4,"I")),2),"@")
"RTN","OOPSGUIR",133,0)
 ...S ARR(5)=$$GET1^DIQ(2260,IEN,27,"E")
"RTN","OOPSGUIR",134,0)
 ...;v2_P20 changed field to populate ARR(6) - Coluum F OSHA 300 log
"RTN","OOPSGUIR",135,0)
 ...S COLF=$$GET1^DIQ(2260,IEN,384),ARR(6)=COLF
"RTN","OOPSGUIR",136,0)
 ...I (SDATE<3081231.9999&(EDATE>3081231.9999)) S ARR(6)=COLF
"RTN","OOPSGUIR",137,0)
 ...I EDATE<3090101&(COLF="") S ARR(6)=$$GET1^DIQ(2260,IEN,3)_";"_$$GET1^DIQ(2260,IEN,30)
"RTN","OOPSGUIR",138,0)
 ...S DATA=ARR(1)_U_ARR(2)_U_ARR(3)_U_ARR(4)_U_ARR(5)_U_ARR(6)_U_ARR(7)_U
"RTN","OOPSGUIR",139,0)
 ...S DATA=DATA_ARR(8)_U_ARR(9)_U_ARR(10)
"RTN","OOPSGUIR",140,0)
 ...S ^TMP($J,TAG,CN)=DATA,CN=CN+1
"RTN","OOPSGUIR",141,0)
 I TAG="IRWSHT" S ^TMP($J,TAG,1)=CASES_U_COLHI_U_HRS
"RTN","OOPSGUIR",142,0)
 I TAG="SUM300A" D
"RTN","OOPSGUIR",143,0)
 .S DATA=CASES_U_EMP_U_HRS_U_COLG_U_COLH_U_COLI_U_COLJ_U_COLK_U_COLL_U
"RTN","OOPSGUIR",144,0)
 .S DATA=DATA_COLM(1)_U_COLM(2)_U_COLM(3)_U_COLM(4)_U_COLM(5)_U_COLM(6)
"RTN","OOPSGUIR",145,0)
 .S ^TMP($J,TAG,1)=DATA
"RTN","OOPSGUIR",146,0)
 S RESULTS=$NA(^TMP($J,TAG))
"RTN","OOPSGUIR",147,0)
 K ARR,DATA
"RTN","OOPSGUIR",148,0)
 Q
"RTN","OOPSGUIR",149,0)
FLD95 ; use OUTC subrecord to retrieve data
"RTN","OOPSGUIR",150,0)
 N AVAIL,ED,SD,S0,INC,ILL,DAYA,DAYJ,DAYS,IEN95,OC,OUTC,S95,TDAY
"RTN","OOPSGUIR",151,0)
 S S0=$G(^OOPS(2260,IEN,0)),INC=$P(S0,U,7)
"RTN","OOPSGUIR",152,0)
 S ILL=$P($G(^OOPS(2260,IEN,"2162B")),U,15)
"RTN","OOPSGUIR",153,0)
 S TDAY=$$HTFM^XLFDT(+$H)
"RTN","OOPSGUIR",154,0)
 ; add days away & job transfer up only to 180 for log, 4 300A get all
"RTN","OOPSGUIR",155,0)
 S (DAYA,DAYJ,TAWAY)=0,IEN95=0
"RTN","OOPSGUIR",156,0)
 F  S IEN95=$O(^OOPS(2260,IEN,"OUTC",IEN95)) Q:IEN95'>0  D
"RTN","OOPSGUIR",157,0)
 .S S95=$G(^OOPS(2260,IEN,"OUTC",IEN95,0))
"RTN","OOPSGUIR",158,0)
 .S SD=$P(S95,U,1),ED=$P(S95,U,2),OC=$P(S95,U,3),DAYS=0
"RTN","OOPSGUIR",159,0)
 .I $P(S95,U,11)="D" Q      ; entry is deleted
"RTN","OOPSGUIR",160,0)
 .;patch 11 - added logic that if TAG=LOG300 include all incident days
"RTN","OOPSGUIR",161,0)
 .;           up to 180, else 300A, only include date range incidents
"RTN","OOPSGUIR",162,0)
 .I (TAG="SUM300A"),(EDATE<SD) Q
"RTN","OOPSGUIR",163,0)
 .I $G(OC)'="" S OUTC(OC)=""
"RTN","OOPSGUIR",164,0)
 .I TAG="SUM300A" D
"RTN","OOPSGUIR",165,0)
 ..I $G(ED)=""!($G(ED)>EDATE) S DAYS=$$FMDIFF^XLFDT(EDATE,SD,1)+1
"RTN","OOPSGUIR",166,0)
 .I TAG="LOG300",($G(ED)="") S DAYS=$$FMDIFF^XLFDT(TDAY,SD,1)+1
"RTN","OOPSGUIR",167,0)
 .I '$G(DAYS) S DAYS=$S(OC="A":$P(S95,U,4),OC="J":$P(S95,U,5),1:0)
"RTN","OOPSGUIR",168,0)
 .I DAYA+DAYJ>179 Q
"RTN","OOPSGUIR",169,0)
 .S AVAIL=0
"RTN","OOPSGUIR",170,0)
 .I DAYS>179 S AVAIL=(180-(DAYA+DAYJ))
"RTN","OOPSGUIR",171,0)
 .I (DAYS<180) D
"RTN","OOPSGUIR",172,0)
 ..;rra oops*25 - INC809171 account for exactly 180 days
"RTN","OOPSGUIR",173,0)
 ..I (DAYS+DAYA+DAYJ)<=180 S AVAIL=DAYS
"RTN","OOPSGUIR",174,0)
 ..I (DAYS+DAYA+DAYJ)>180 S AVAIL=(180-(DAYA+DAYJ))
"RTN","OOPSGUIR",175,0)
 .I $G(OC)="A" S DAYA=DAYA+AVAIL
"RTN","OOPSGUIR",176,0)
 .I $G(OC)="J" S DAYJ=DAYJ+AVAIL
"RTN","OOPSGUIR",177,0)
 I TAG="SUM300A" D
"RTN","OOPSGUIR",178,0)
 .S:$G(INC)=1 COLM(1)=COLM(1)+1
"RTN","OOPSGUIR",179,0)
 .I INC=2 D
"RTN","OOPSGUIR",180,0)
 ..I $G(ILL) S COLM(ILL)=COLM(ILL)+1
"RTN","OOPSGUIR",181,0)
 ..I '$G(ILL) S COLM(6)=COLM(6)+1
"RTN","OOPSGUIR",182,0)
 .S COLK=COLK+DAYA,COLL=COLL+DAYJ
"RTN","OOPSGUIR",183,0)
 .I $D(OUTC("D")) S COLG=COLG+1 Q
"RTN","OOPSGUIR",184,0)
 .I $D(OUTC("A")) S COLH=COLH+1 Q
"RTN","OOPSGUIR",185,0)
 .I $D(OUTC("J")) S COLI=COLI+1 Q
"RTN","OOPSGUIR",186,0)
 .I $D(OUTC("O")) S COLJ=COLJ+1 Q
"RTN","OOPSGUIR",187,0)
 I TAG="LOG300" D
"RTN","OOPSGUIR",188,0)
 .S ARR(7)="",ARR(10)="",(ARR(8),ARR(9))=0
"RTN","OOPSGUIR",189,0)
 .I INC=1 S ARR(10)=1
"RTN","OOPSGUIR",190,0)
 .I INC=2 S:$G(ILL) ARR(10)=ILL S:'$G(ILL) ARR(10)=6
"RTN","OOPSGUIR",191,0)
 .S ARR(8)=DAYA,ARR(9)=DAYJ
"RTN","OOPSGUIR",192,0)
 .I $D(OUTC("D")) S ARR(7)="D" S (ARR(8),ARR(9))=0 Q
"RTN","OOPSGUIR",193,0)
 .I $D(OUTC("A")) S ARR(7)="A" Q
"RTN","OOPSGUIR",194,0)
 .I $D(OUTC("J")) S ARR(7)="J" Q
"RTN","OOPSGUIR",195,0)
 .I $D(OUTC("O")) S ARR(7)="O" Q
"RTN","OOPSGUIR",196,0)
 Q
"RTN","OOPSGUIR",197,0)
EMPHRS ; get Total Num Employees and Hours worked
"RTN","OOPSGUIR",198,0)
 N CASES,ED,LV1,LV2,MON,OK,PAR,SD,SIEN,STR,WS,X,X1,X2
"RTN","OOPSGUIR",199,0)
 S (EMP,HRS,WS)=0
"RTN","OOPSGUIR",200,0)
 S PAR="^OOPS(2262,0)",PAR=$Q(@PAR),PAR=$Q(@PAR)
"RTN","OOPSGUIR",201,0)
 S LV1=$P(PAR,",",2),LV2=$P(PAR,",",3)
"RTN","OOPSGUIR",202,0)
 S SIEN=$O(^OOPS(2262,LV1,LV2,"B",STA,-1)) Q:SIEN=""
"RTN","OOPSGUIR",203,0)
 ; get month range to make sure all emp numbers and hours are entered
"RTN","OOPSGUIR",204,0)
 S SDATE=SDATE\1
"RTN","OOPSGUIR",205,0)
 S SD=$E(SDATE,1,5)_"00"_$E(SDATE,8,$L(SDATE))
"RTN","OOPSGUIR",206,0)
 S ED=$E(EDATE,1,5)_"00"_$E(EDATE,8,$L(EDATE))
"RTN","OOPSGUIR",207,0)
 S X1=$E(ED,1,3),X2=$E(SD,1,3)
"RTN","OOPSGUIR",208,0)
 I X1>X2 D
"RTN","OOPSGUIR",209,0)
 .S OK=0,X=(X1-X2) S:X>1 OK=(X-1)*12
"RTN","OOPSGUIR",210,0)
 .S OK=OK+((12-$E(SD,4,5))+1)+$E(ED,4,5)
"RTN","OOPSGUIR",211,0)
 I X1=X2 S OK=($E(ED,4,5)-$E(SD,4,5))+1
"RTN","OOPSGUIR",212,0)
 S MON=OK
"RTN","OOPSGUIR",213,0)
 F  S WS=$O(^OOPS(2262,LV1,LV2,SIEN,2,WS)) Q:(WS'>0)  D
"RTN","OOPSGUIR",214,0)
 .S STR=^OOPS(2262,LV1,LV2,SIEN,2,WS,0)
"RTN","OOPSGUIR",215,0)
 .I ($P(STR,U)'<SD)&($P(STR,U)'>ED) D
"RTN","OOPSGUIR",216,0)
 ..I ($P(STR,U,2)="")!($P(STR,U,3)="") Q
"RTN","OOPSGUIR",217,0)
 ..S EMP=EMP+$P(STR,U,2),HRS=HRS+$P(STR,U,3),OK=OK-1
"RTN","OOPSGUIR",218,0)
 I '$G(OK) S EMP=EMP/MON
"RTN","OOPSGUIR",219,0)
 I $G(OK) S (EMP,HRS)="INCOMPLETE DATA"
"RTN","OOPSGUIR",220,0)
 Q
"VER")
8.0^22.0
"BLD",9215,6)
^26
**END**
**END**
