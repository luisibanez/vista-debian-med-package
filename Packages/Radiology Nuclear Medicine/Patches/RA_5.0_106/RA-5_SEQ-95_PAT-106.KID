Released RA*5*106 SEQ #95
Extracted from mail message
**KIDS**:RA*5.0*106^

**INSTALL NAME**
RA*5.0*106
"BLD",8060,0)
RA*5.0*106^RADIOLOGY/NUCLEAR MEDICINE^0^3110209^y
"BLD",8060,1,0)
^^3^3^3100913^^
"BLD",8060,1,1,0)
Patch one hundred and six for the VistA Radiology/Nuclear Medicine 5.0
"BLD",8060,1,2,0)
application. Please review FORUM's Patch Module description and
"BLD",8060,1,3,0)
installation instructions for RA*5.0*106 before installing this patch.
"BLD",8060,4,0)
^9.64PA^74^1
"BLD",8060,4,74,0)
74
"BLD",8060,4,74,2,0)
^9.641^74.01^1
"BLD",8060,4,74,2,74.01,0)
ACTIVITY LOG  (sub-file)
"BLD",8060,4,74,2,74.01,1,0)
^9.6411^2^1
"BLD",8060,4,74,2,74.01,1,2,0)
TYPE OF ACTION
"BLD",8060,4,74,222)
y^n^p^^^^n^^n
"BLD",8060,4,74,224)

"BLD",8060,4,"APDD",74,74.01)

"BLD",8060,4,"APDD",74,74.01,2)

"BLD",8060,4,"B",74,74)

"BLD",8060,6)
1^
"BLD",8060,6.3)
2
"BLD",8060,"ABPKG")
n
"BLD",8060,"KRN",0)
^9.67PA^779.2^20
"BLD",8060,"KRN",.4,0)
.4
"BLD",8060,"KRN",.401,0)
.401
"BLD",8060,"KRN",.402,0)
.402
"BLD",8060,"KRN",.403,0)
.403
"BLD",8060,"KRN",.5,0)
.5
"BLD",8060,"KRN",.84,0)
.84
"BLD",8060,"KRN",3.6,0)
3.6
"BLD",8060,"KRN",3.8,0)
3.8
"BLD",8060,"KRN",9.2,0)
9.2
"BLD",8060,"KRN",9.8,0)
9.8
"BLD",8060,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",8060,"KRN",9.8,"NM",1,0)
RAEDCN1^^0^B15204171
"BLD",8060,"KRN",9.8,"NM",2,0)
RARPTUT^^0^B110205349
"BLD",8060,"KRN",9.8,"NM",3,0)
RAHLO^^0^B50036551
"BLD",8060,"KRN",9.8,"NM",4,0)
RAHLTCPB^^0^B71900626
"BLD",8060,"KRN",9.8,"NM","B","RAEDCN1",1)

"BLD",8060,"KRN",9.8,"NM","B","RAHLO",3)

"BLD",8060,"KRN",9.8,"NM","B","RAHLTCPB",4)

"BLD",8060,"KRN",9.8,"NM","B","RARPTUT",2)

"BLD",8060,"KRN",19,0)
19
"BLD",8060,"KRN",19.1,0)
19.1
"BLD",8060,"KRN",101,0)
101
"BLD",8060,"KRN",409.61,0)
409.61
"BLD",8060,"KRN",771,0)
771
"BLD",8060,"KRN",779.2,0)
779.2
"BLD",8060,"KRN",870,0)
870
"BLD",8060,"KRN",8989.51,0)
8989.51
"BLD",8060,"KRN",8989.52,0)
8989.52
"BLD",8060,"KRN",8994,0)
8994
"BLD",8060,"KRN","B",.4,.4)

"BLD",8060,"KRN","B",.401,.401)

"BLD",8060,"KRN","B",.402,.402)

"BLD",8060,"KRN","B",.403,.403)

"BLD",8060,"KRN","B",.5,.5)

"BLD",8060,"KRN","B",.84,.84)

"BLD",8060,"KRN","B",3.6,3.6)

"BLD",8060,"KRN","B",3.8,3.8)

"BLD",8060,"KRN","B",9.2,9.2)

"BLD",8060,"KRN","B",9.8,9.8)

"BLD",8060,"KRN","B",19,19)

"BLD",8060,"KRN","B",19.1,19.1)

"BLD",8060,"KRN","B",101,101)

"BLD",8060,"KRN","B",409.61,409.61)

"BLD",8060,"KRN","B",771,771)

"BLD",8060,"KRN","B",779.2,779.2)

"BLD",8060,"KRN","B",870,870)

"BLD",8060,"KRN","B",8989.51,8989.51)

"BLD",8060,"KRN","B",8989.52,8989.52)

"BLD",8060,"KRN","B",8994,8994)

"BLD",8060,"QUES",0)
^9.62^^
"BLD",8060,"REQB",0)
^9.611^3^2
"BLD",8060,"REQB",2,0)
RA*5.0*90^2
"BLD",8060,"REQB",3,0)
RA*5.0*94^2
"BLD",8060,"REQB","B","RA*5.0*90",2)

"BLD",8060,"REQB","B","RA*5.0*94",3)

"FIA",74)
RAD/NUC MED REPORTS
"FIA",74,0)
^RARPT(
"FIA",74,0,0)
74I
"FIA",74,0,1)
y^n^p^^^^n^^n
"FIA",74,0,10)

"FIA",74,0,11)

"FIA",74,0,"RLRO")

"FIA",74,0,"VR")
5.0^RA
"FIA",74,74)
1
"FIA",74,74.01)
1
"FIA",74,74.01,2)

"MBREQ")
0
"PKG",31,-1)
1^1
"PKG",31,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",31,20,0)
^9.402P^^
"PKG",31,22,0)
^9.49I^1^1
"PKG",31,22,1,0)
5.0^2980317^2980805^1
"PKG",31,22,1,"PAH",1,0)
106^3110209^520665224
"PKG",31,22,1,"PAH",1,1,0)
^^3^3^3110209
"PKG",31,22,1,"PAH",1,1,1,0)
Patch one hundred and six for the VistA Radiology/Nuclear Medicine 5.0
"PKG",31,22,1,"PAH",1,1,2,0)
application. Please review FORUM's Patch Module description and
"PKG",31,22,1,"PAH",1,1,3,0)
installation instructions for RA*5.0*106 before installing this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","RAEDCN1")
0^1^B15204171^B14134766
"RTN","RAEDCN1",1,0)
RAEDCN1 ;HISC/GJC-Utility routine for RAEDCN ;9/18/97  13:49
"RTN","RAEDCN1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,45,93,106**;Mar 16, 1998;Build 2
"RTN","RAEDCN1",3,0)
 ; last modif by SS for P18
"RTN","RAEDCN1",4,0)
 ; 07/15/2008 BAY/KAM rem call 249750 RA*5*93 Correct DIK Calls
"RTN","RAEDCN1",5,0)
UNDEF ; Message for undefined imaging types
"RTN","RAEDCN1",6,0)
 I '+$G(RAMLC) D  Q
"RTN","RAEDCN1",7,0)
 . W !?5,"Imaging Location data is not defined, "
"RTN","RAEDCN1",8,0)
 . W "contact IRM.",$C(7)
"RTN","RAEDCN1",9,0)
 . Q
"RTN","RAEDCN1",10,0)
 W !?5,"An Imaging Type was not defined for the following Imaging"
"RTN","RAEDCN1",11,0)
 W !?5,"Location: "_$P(^SC($P($G(^RA(79.1,+RAMLC,0)),U),0),U)_"."
"RTN","RAEDCN1",12,0)
 Q
"RTN","RAEDCN1",13,0)
 ;
"RTN","RAEDCN1",14,0)
STUB(RARPT) ; Determine if this is an imaging stub report.
"RTN","RAEDCN1",15,0)
 ; Input : RARPT: IEN of the report record
"RTN","RAEDCN1",16,0)
 ; Output: 1 if an imaging stub report, else 0
"RTN","RAEDCN1",17,0)
 ;
"RTN","RAEDCN1",18,0)
 ;new business rules with the advent of RA*5.0*106. An
"RTN","RAEDCN1",19,0)
 ;'images collected' (Activity Log, TYPE OF ACTION field)
"RTN","RAEDCN1",20,0)
 ;event no longer defines a stub report. A stub report is
"RTN","RAEDCN1",21,0)
 ;defined as a report with the following traits:
"RTN","RAEDCN1",22,0)
 ;-------------------------------------------------------
"RTN","RAEDCN1",23,0)
 ;* Has attached images
"RTN","RAEDCN1",24,0)
 ;* Does not have a REPORT STATUS value
"RTN","RAEDCN1",25,0)
 ;* Does not have impression text
"RTN","RAEDCN1",26,0)
 ;* Does not have a problem statement
"RTN","RAEDCN1",27,0)
 ;* Does not have report text
"RTN","RAEDCN1",28,0)
 ;
"RTN","RAEDCN1",29,0)
 ;sanity check
"RTN","RAEDCN1",30,0)
 Q:RARPT'>0 0 Q:'($D(^RARPT(RARPT,0))#2) 0
"RTN","RAEDCN1",31,0)
 ;
"RTN","RAEDCN1",32,0)
 I $P(^RARPT(RARPT,0),U,5)="",$O(^RARPT(RARPT,2005,0)),'$D(^RARPT(RARPT,"I")),'$D(^("P")),'$D(^("R")) Q 1
"RTN","RAEDCN1",33,0)
 Q 0
"RTN","RAEDCN1",34,0)
 ;
"RTN","RAEDCN1",35,0)
PSET(RADFN,RADTI,RACNI) ; Determine if this exam is part of a printset.
"RTN","RAEDCN1",36,0)
 ; Input: RADFN-patient dfn <-> RADTI-exam timestamp <-> RACNI-exam ien
"RTN","RAEDCN1",37,0)
 ; Output: 1 if part of a printset, else 0
"RTN","RAEDCN1",38,0)
 Q $S($P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",25)=2:1,1:0)
"RTN","RAEDCN1",39,0)
 ;
"RTN","RAEDCN1",40,0)
CKREASON(X) ;check file 75.2 ; P18 moved it from RAEDCN because the routine's length exceeded limit
"RTN","RAEDCN1",41,0)
 ; 0=OKAY, 1=BAD
"RTN","RAEDCN1",42,0)
 ; don't check for var RAOREA, because it's not set this early
"RTN","RAEDCN1",43,0)
 I X="C",$O(^RA(75.2,"B","EXAM CANCELLED",0)) Q 0
"RTN","RAEDCN1",44,0)
 I X="D",$O(^RA(75.2,"B","EXAM DELETED",0)) Q 0
"RTN","RAEDCN1",45,0)
 W !!?5,$S(X="C":"Cancellation",1:"Deletion")," cannot be done, because your file #75.2,"
"RTN","RAEDCN1",46,0)
 W !?5,"RAD/NUC MED REASON, does not have ""EXAM ",$S(X="C":"CANCELLED",1:"DELETED"),"""","."
"RTN","RAEDCN1",47,0)
 W !!?5,"Please notify your ADPAC.",!
"RTN","RAEDCN1",48,0)
 K DIR S DIR(0)="E",DIR("A")="Press RETURN for menu options" D ^DIR K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAEDCN1",49,0)
 Q 1
"RTN","RAEDCN1",50,0)
 ;
"RTN","RAEDCN1",51,0)
DEL ; 'Exam Deletion' option (RA DELETEXAM)
"RTN","RAEDCN1",52,0)
 D SETVARS^RAEDCN Q:'($D(RACCESS(DUZ))\10)!('$D(RAIMGTY))
"RTN","RAEDCN1",53,0)
 S RAXIT=$$CKREASON^RAEDCN1("D") I RAXIT K RAXIT Q  ;P18
"RTN","RAEDCN1",54,0)
DEL1 D ^RACNLU G Q^RAEDCN:X="^"
"RTN","RAEDCN1",55,0)
 I RARPT W !?3,$C(7),"A report has been filed for this case. Therefore deletion is not allowed!" G DEL1
"RTN","RAEDCN1",56,0)
ASKDEL R !!,"Do you wish to delete this exam? NO// ",X:DTIME S:'$T!(X="")!(X["^") X="N" G DEL1:"Nn"[$E(X) I "Yy"'[$E(X) W:X'["?" $C(7) W !!,"Enter 'YES' to delete this exam, or 'NO' not to." G ASKDEL
"RTN","RAEDCN1",57,0)
 L +^RADPT(RADFN,"DT",RADTI):1 I '$T W !,$C(7),"Someone else is editing an exam for this patient on the date/time",!,"you selected. Please try Later" G DEL1
"RTN","RAEDCN1",58,0)
 S RADELFLG="" D ^RAORDC
"RTN","RAEDCN1",59,0)
 ; trigger RA CANCEL protocol on xam delete if xam not already cancelled
"RTN","RAEDCN1",60,0)
 S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),X=+$P(RA7003,"^",3)
"RTN","RAEDCN1",61,0)
 ; no rpt filed, xam status exists & not cancelled -OR- xam status
"RTN","RAEDCN1",62,0)
 ; non-existent.
"RTN","RAEDCN1",63,0)
 I $P($G(^RA(72,X,0)),U,3)'=0 D
"RTN","RAEDCN1",64,0)
 . K RAIENS,RAERR S RAIENS=""_RACNI_","_RADTI_","_RADFN_","_"",RAFDA(70.03,RAIENS,3)="CANCELLED" D FILE^DIE("KSE","RAFDA","RAERR") K RAIENS,RAERR,RAFDA D CANCEL^RAHLRPC
"RTN","RAEDCN1",65,0)
 . Q
"RTN","RAEDCN1",66,0)
 K RA7003 S RABULL="",DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RAEDCN1",67,0)
 ;S DIK="^RADPT(DA(2),""DT"",DA(1),""P""," D ^DIK
"RTN","RAEDCN1",68,0)
 S DIK="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P""," D ^DIK
"RTN","RAEDCN1",69,0)
 W !?10,"...deletion of exam complete."
"RTN","RAEDCN1",70,0)
 K %,D,D0,D1,D2,DA,DIC,DIK,RADELFLG,RABULL,RAPRTZ,RAAFTER,RABEFORE
"RTN","RAEDCN1",71,0)
 ; Check if one exam or multiple exams exists below "DT" node.
"RTN","RAEDCN1",72,0)
 ; If no exams are present, delete "DT" node.
"RTN","RAEDCN1",73,0)
 I '+$O(^RADPT(RADFN,"DT",RADTI,"P",0)) D
"RTN","RAEDCN1",74,0)
 . K DA,DIK S DA(1)=RADFN,DA=RADTI
"RTN","RAEDCN1",75,0)
 . ; S DIK="^RADPT(DA(1),""DT""," D ^DIK
"RTN","RAEDCN1",76,0)
 . S DIK="^RADPT("_DA(1)_",""DT""," D ^DIK
"RTN","RAEDCN1",77,0)
 . K DA,DIK Q
"RTN","RAEDCN1",78,0)
 L -^RADPT(RADFN,"DT",RADTI)
"RTN","RAEDCN1",79,0)
 G DEL1
"RTN","RAEDCN1",80,0)
 ;
"RTN","RAEDCN1",81,0)
VIEW ; 'View Exam by Case No.' option (RA VIEWCN)
"RTN","RAEDCN1",82,0)
 D SETVARS^RAEDCN Q:'($D(RACCESS(DUZ))\10)!('$D(RAIMGTY))
"RTN","RAEDCN1",83,0)
 S RAVW="" D ^RACNLU G Q^RAEDCN:X="^" K RAFL D ^RAPROD D Q^RAEDCN G VIEW
"RTN","RAEDCN1",84,0)
 ;
"RTN","RAHLO")
0^3^B50036551^B46090166
"RTN","RAHLO",1,0)
RAHLO ;HIRMFO/GJC-Process data set from the bridge program ;11/18/97  12:13
"RTN","RAHLO",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**4,8,27,55,66,84,94,106**;Mar 16, 1998;Build 2
"RTN","RAHLO",3,0)
 ; 09/07/2005 Remedy call 108405 - KAM Allow Radiology to accept dx codes from Talk Technology
"RTN","RAHLO",4,0)
 ;
"RTN","RAHLO",5,0)
 ;Integration Agreements
"RTN","RAHLO",6,0)
 ;----------------------
"RTN","RAHLO",7,0)
 ;DT^DILF(2054); LOCK^DILF(2054); DEM^VADPT(10061); $$DT^XLFDT(10103)
"RTN","RAHLO",8,0)
 ;
"RTN","RAHLO",9,0)
EN1 ; Check the validity of the following data globals:
"RTN","RAHLO",10,0)
 ; Example: '^TMP("RARPT-REC",$J,RASUB,' where RASUB is a
"RTN","RAHLO",11,0)
 ; record in file 772.
"RTN","RAHLO",12,0)
 ;**************** Validates (if data present): ************************
"RTN","RAHLO",13,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RACNI")=Case IEN
"RTN","RAHLO",14,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RADATE")=Date reported/entered/verified
"RTN","RAHLO",15,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RADFN")=Patient IEN
"RTN","RAHLO",16,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RADTI")=Inverted Exam Date/Time
"RTN","RAHLO",17,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RADX",#)=Dx codes (could be more than 1)
"RTN","RAHLO",18,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RAESIG")=Verifier's E-Sig (if present)
"RTN","RAHLO",19,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RAHIST")=Additional Clinical History
"RTN","RAHLO",20,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RAIMP",#)=Impression Text
"RTN","RAHLO",21,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RALONGCN")=Long Case Number
"RTN","RAHLO",22,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RASSN")=Patient SSN
"RTN","RAHLO",23,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RASTAT")=A, C, F or R
"RTN","RAHLO",24,0)
 ;    Note: we use 'F' for final and 'P' for preliminary as RESULT
"RTN","RAHLO",25,0)
 ;          STATUS values for both the v2.3 & v2.4 HL7 interfaces.
"RTN","RAHLO",26,0)
 ;          BUT: we use 'C' ('corrected') for the v2.4 interface &
"RTN","RAHLO",27,0)
 ;                      'A' ('amended') for the v2.3 interface.
"RTN","RAHLO",28,0)
 ; 
"RTN","RAHLO",29,0)
 ;    Note: VAQ - added w/P106 study released back to VAMC
"RTN","RAHLO",30,0)
 ;                for interpretation
"RTN","RAHLO",31,0)
 ;
"RTN","RAHLO",32,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RATXT",#)=Report Text
"RTN","RAHLO",33,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"VENDOR")=vendor
"RTN","RAHLO",34,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RAVERF")=Verifier ien
"RTN","RAHLO",35,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RATRANSCRIPT")=transcriptionist (optional)
"RTN","RAHLO",36,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RASTAFF")=Primary staff
"RTN","RAHLO",37,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RARESIDENT")=Primary resident
"RTN","RAHLO",38,0)
 ; ^TMP("RARPT-REC",$J,RASUB,"RAWHOCHANGE")=Who changed status to Verify
"RTN","RAHLO",39,0)
 ;**********************************************************************
"RTN","RAHLO",40,0)
 K RAERR S RAQUIET=1
"RTN","RAHLO",41,0)
 ; Check if the minimum data set exists.
"RTN","RAHLO",42,0)
 I '$D(^TMP("RARPT-REC",$J,RASUB,"RACNI")) S RAERR="Missing Case Number" Q
"RTN","RAHLO",43,0)
 I '$D(^TMP("RARPT-REC",$J,RASUB,"RADFN")) S RAERR="Internal Patient ID Missing" Q
"RTN","RAHLO",44,0)
 I '$D(^TMP("RARPT-REC",$J,RASUB,"RADTI")) S RAERR="Missing Exam Date" Q
"RTN","RAHLO",45,0)
 I '$D(^TMP("RARPT-REC",$J,RASUB,"RALONGCN")) S RAERR="Missing Exam Date and/or Case Number" Q
"RTN","RAHLO",46,0)
 I '$D(^TMP("RARPT-REC",$J,RASUB,"RASSN")) S RAERR="Missing Patient ID" Q
"RTN","RAHLO",47,0)
 D CHECK ; check the validity of our data.
"RTN","RAHLO",48,0)
XIT ; Kill and quit
"RTN","RAHLO",49,0)
 K A,B,DFN,K,RACNI,RADX,RADENDUM,RADFN,RADTI,RADUZ,RAIMGTY,RALONGCN,RAMDIV,RAMDV,RAMLC,RAQUIET,RARPT,RARPTSTS,RASSN,RAVLDT,X,Y,RATRANSC
"RTN","RAHLO",50,0)
 Q
"RTN","RAHLO",51,0)
CHECK ; Check if our data is valid.
"RTN","RAHLO",52,0)
 S RACNI=$G(^TMP("RARPT-REC",$J,RASUB,"RACNI"))
"RTN","RAHLO",53,0)
 S RADATE=$G(^TMP("RARPT-REC",$J,RASUB,"RADATE"))
"RTN","RAHLO",54,0)
 S RADFN=$G(^TMP("RARPT-REC",$J,RASUB,"RADFN"))
"RTN","RAHLO",55,0)
 S RADTI=$G(^TMP("RARPT-REC",$J,RASUB,"RADTI"))
"RTN","RAHLO",56,0)
 S RALONGCN=$G(^TMP("RARPT-REC",$J,RASUB,"RALONGCN"))
"RTN","RAHLO",57,0)
 S RASSN=$G(^TMP("RARPT-REC",$J,RASUB,"RASSN"))
"RTN","RAHLO",58,0)
 S (RAVERF,RADUZ)=$G(^TMP("RARPT-REC",$J,RASUB,"RAVERF"))
"RTN","RAHLO",59,0)
 S RATRANSC=$G(^TMP("RARPT-REC",$J,RASUB,"RATRANSCRIPT"))
"RTN","RAHLO",60,0)
 S RASTAT=$G(^TMP("RARPT-REC",$J,RASUB,"RASTAT")) I RASTAT="A"!(RASTAT="C") S RADENDUM=""
"RTN","RAHLO",61,0)
 I $D(^TMP("RARPT-REC",$J,RASUB,"RAESIG")) S RAESIG=$G(^("RAESIG"))
"RTN","RAHLO",62,0)
 I $D(^TMP("RARPT-REC",$J,RASUB,"RAIMP")) D IMPTXT^RAHLO2
"RTN","RAHLO",63,0)
 I RADATE']"" S RAERR="Missing report date" Q
"RTN","RAHLO",64,0)
 I RADFN']"" S RAERR="Missing Internal Patient ID" Q
"RTN","RAHLO",65,0)
 I RACNI']"" S RAERR="Missing Case Number" Q
"RTN","RAHLO",66,0)
 I RADTI']"" S RAERR="Missing Exam Date" Q
"RTN","RAHLO",67,0)
 D DT^DILF("ET",RADATE,.RAVLDT)
"RTN","RAHLO",68,0)
 S:RAVLDT=-1 RAERR="Invalid report date" Q:$D(RAERR)
"RTN","RAHLO",69,0)
 K VA,VADM,VAERR S DFN=RADFN D DEM^VADPT
"RTN","RAHLO",70,0)
 I VADM(1)']"" S RAERR="Unknown Internal patient identifier" K VA,VADM,VAERR Q
"RTN","RAHLO",71,0)
 I RASSN'=$P(VADM(2),"^") S RAERR="Internal patient identifier and SSN don't match" K VA,VADM,VAERR Q
"RTN","RAHLO",72,0)
 I '$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))!(RALONGCN']"") D  Q
"RTN","RAHLO",73,0)
 . S RAERR="Invalid Exam Date and/or Case Number"
"RTN","RAHLO",74,0)
 . Q
"RTN","RAHLO",75,0)
 D EDTCHK^RAHLQ ; is user allowed to edit report for a cancelled case?
"RTN","RAHLO",76,0)
 I RARPT=1 S RAERR="Report for CANCELLED case not permitted." Q
"RTN","RAHLO",77,0)
 I RARPT=2 S RAERR="Please use VISTA to edit CANCELLED printset cases." Q
"RTN","RAHLO",78,0)
 S RARPT=+$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)
"RTN","RAHLO",79,0)
 I '$D(^RARPT(RARPT,0)),($D(RADENDUM)#2) S RAERR="Can't add addendum, no report" Q
"RTN","RAHLO",80,0)
 I $D(^RARPT(RARPT,0)),($P(^(0),"^",5)'="V"),($D(RADENDUM)#2)  D  Q
"RTN","RAHLO",81,0)
 .S RAERR="Can't add addendum to a report that is not verified." Q  ;P94
"RTN","RAHLO",82,0)
 ;
"RTN","RAHLO",83,0)
 I $D(^RARPT(RARPT,0)),(($P(^(0),"^",5)="V")!($P(^(0),"^",5)="EF")),('$D(RADENDUM)#2) D  Q
"RTN","RAHLO",84,0)
 .S RAERR="Report already on file" Q  ;P94
"RTN","RAHLO",85,0)
 ;
"RTN","RAHLO",86,0)
 I ($D(RADENDUM)#2),'$O(^TMP("RARPT-REC",$J,RASUB,"RAIMP",0)),'$O(^TMP("RARPT-REC",$J,RASUB,"RATXT",0)) S RAERR="Missing addendum report/impression text" Q
"RTN","RAHLO",87,0)
 I $D(^RADPT(RADFN,"DT",RADTI,0)) S RAMDIV=^(0),RAMLC=+$P(RAMDIV,"^",4),RAMDIV=+$P(RAMDIV,"^",3),RAMDV=$S($D(^RA(79,RAMDIV,.1)):^(.1),1:""),RAMDV=$S(RAMDV="":RAMDV,1:$TR(RAMDV,"YyNn",1100))
"RTN","RAHLO",88,0)
 I '($D(RADENDUM)#2) I $P(RAMDV,"^",16),('$D(^TMP("RARPT-REC",$J,RASUB,"RAIMP"))) S RAERR="Missing Impression Text" Q  ; impression req'd for this division
"RTN","RAHLO",89,0)
 I ($D(RADENDUM)#2),($D(^RARPT(RARPT,0))#2),($P(RAMDV,"^",16)),('$O(^RARPT(RARPT,"I",0))),('$D(^TMP("RARPT-REC",$J,RASUB,"RAIMP"))) S RAERR="Impression Text missing for current record." Q  ; impression req'd for this division
"RTN","RAHLO",90,0)
 I $D(RADENDUM)#2 D CKDUPA^RAHLO4 I RADUPA S RAERR="Duplicate Addendum" Q
"RTN","RAHLO",91,0)
 ; check resident and staff
"RTN","RAHLO",92,0)
 N X1,X2,X3 S X2=0,X3=""
"RTN","RAHLO",93,0)
 I '$G(RATELE),+$G(^TMP("RARPT-REC",$J,RASUB,"RARESIDENT"))!(+$G(^("RASTAFF"))) D  Q:$G(RAERR)]""
"RTN","RAHLO",94,0)
 . S X1=+$G(^TMP("RARPT-REC",$J,RASUB,"RARESIDENT"))
"RTN","RAHLO",95,0)
 . I X1 D
"RTN","RAHLO",96,0)
 .. I '$D(^VA(200,"ARC","R",X1)),'$D(^VA(200,"ARC","S",X1)) S X2=1
"RTN","RAHLO",97,0)
 .. I $P($G(^VA(200,X1,"RA")),"^",3),$P(^("RA"),"^",3)'>$$DT^XLFDT S X2=X2+2
"RTN","RAHLO",98,0)
 .. I X2=1 S X3=$E($P($G(^VA(200,X1,0)),"^"),1,20)_" is not class'd as Resident or Staff"
"RTN","RAHLO",99,0)
 .. I X2=2 S X3=$P($G(^VA(200,X1,0)),"^")_"'s INACTIVE DATE is past"
"RTN","RAHLO",100,0)
 .. I X2=3 S X3=$P($G(^VA(200,X1,0)),"^")_" is not class'd as resident and past INACTIVE DATE"
"RTN","RAHLO",101,0)
 .. I X3]"" S RAERR=X3
"RTN","RAHLO",102,0)
 . S X2=0,X3="" S X1=+$G(^TMP("RARPT-REC",$J,RASUB,"RASTAFF"))
"RTN","RAHLO",103,0)
 . I X1 D
"RTN","RAHLO",104,0)
 .. I '$D(^VA(200,"ARC","S",X1)) S X2=1
"RTN","RAHLO",105,0)
 .. I $P($G(^VA(200,X1,"RA")),"^",3),$P(^("RA"),"^",3)'>$$DT^XLFDT S X2=X2+2
"RTN","RAHLO",106,0)
 .. I X2=1 S X3=$E($P($G(^VA(200,X1,0)),"^"),1,20)_" is not class'd as staff"
"RTN","RAHLO",107,0)
 .. I X2=2 S X3=$P($G(^VA(200,X1,0)),"^")_"'s INACTIVE DATE is past"
"RTN","RAHLO",108,0)
 .. I X2=3 S X3=$P($G(^VA(200,X1,0)),"^")_" is not class'd as staff and past INACTIVE DATE"
"RTN","RAHLO",109,0)
 .. I X3]"" S RAERR=$S($G(RAERR)]"":RAERR_", ",1:"")_X3
"RTN","RAHLO",110,0)
 . Q
"RTN","RAHLO",111,0)
 ; raesig is in alphanumeric format, so shouldn't use $g of it here
"RTN","RAHLO",112,0)
 I ($G(RAESIG)]"")!($G(RAVERF)) D:'$G(RATELE) VERCHK^RAHLO3 ; check if provider can verify report
"RTN","RAHLO",113,0)
 ; if verifier fails checks,
"RTN","RAHLO",114,0)
 ;   quit only if vendor is non-kurzweil,
"RTN","RAHLO",115,0)
 ;   if vendor is kurzweil, continue on by deleting raerr, raverf
"RTN","RAHLO",116,0)
 I $D(RAERR) Q:$G(^TMP("RARPT-REC",$J,RASUB,"VENDOR"))'="KURZWEIL"  K RAERR,RAVERF
"RTN","RAHLO",117,0)
 S RAIMGTY=$$IMGTY^RAUTL12("l",RAMLC) I '$L(RAIMGTY) S RAERR="No Imaging Type for Location where exam was performed" Q
"RTN","RAHLO",118,0)
 K RASECDX ;clear secondary dx array because RAHLO2 may not be called
"RTN","RAHLO",119,0)
 ; 09/07/2005 108405 KAM- Removed ('$D(RADENDUM)#2) from next line
"RTN","RAHLO",120,0)
 I $G(RATELE),'$D(RADENDUM),'$D(^TMP("RARPT-REC",$J,RASUB,"RADX")) D  ;Patch 84
"RTN","RAHLO",121,0)
 .I RASTAT="R" S:$D(RATELEDR) ^TMP("RARPT-REC",$J,RASUB,"RADX",1)=RATELEDR Q
"RTN","RAHLO",122,0)
 .S:$D(RATELEDF) ^TMP("RARPT-REC",$J,RASUB,"RADX",1)=RATELEDF
"RTN","RAHLO",123,0)
 D:$D(^TMP("RARPT-REC",$J,RASUB,"RADX")) DIAG^RAHLO2 Q:$D(RAERR)  ; DX code check took out - &('$D(RADENDUM)#2)
"RTN","RAHLO",124,0)
 ; edit sec Dx codes if they exist for non-addendums
"RTN","RAHLO",125,0)
 ; 09/07/2005 108405 KAM - Removed ('$D(RADENDUM)#2)from next line
"RTN","RAHLO",126,0)
 I $D(RASECDX) D SECDX^RAHLO2 Q:$D(RAERR)
"RTN","RAHLO",127,0)
 S B=0 F A="I","R" D  Q:$D(RAERR)
"RTN","RAHLO",128,0)
 . Q:A="R"&('$D(^TMP("RARPT-REC",$J,RASUB,"RATXT")))  ; no rpt text
"RTN","RAHLO",129,0)
 . Q:A="I"&('$D(^TMP("RARPT-REC",$J,RASUB,"RAIMP")))  ; no imp text
"RTN","RAHLO",130,0)
 . S B=$$TEXT^RAHLO3(A)
"RTN","RAHLO",131,0)
 . S:'B RAERR=$$ERR^RAHLO2(A)
"RTN","RAHLO",132,0)
 . Q
"RTN","RAHLO",133,0)
 ;
"RTN","RAHLO",134,0)
 I $G(RATELE),$L($G(RATELEPI)),RATELEPI'?10N S RAERR="Incorrect Teleradiologist's NPI: "_RATELEPI Q
"RTN","RAHLO",135,0)
 D RPTSTAT^RAHLO3 ; determine the status of the report
"RTN","RAHLO",136,0)
 ;
"RTN","RAHLO",137,0)
 ;new w/P106
"RTN","RAHLO",138,0)
 I RARPT,($T(EN^RARPTUT)'=""),(RASTAT="VAQ"),('($D(RAERR)#2)) D EN^RARPTUT QUIT
"RTN","RAHLO",139,0)
 ;
"RTN","RAHLO",140,0)
 ;new w/P94
"RTN","RAHLO",141,0)
 D FILE^RAHLO1:'($D(RAERR)#2)
"RTN","RAHLO",142,0)
 Q
"RTN","RAHLO",143,0)
 ;
"RTN","RAHLTCPB")
0^4^B71900626^B70765098
"RTN","RAHLTCPB",1,0)
RAHLTCPB ; HIRMFO/REL,GJC,BNT,PAV - Rad/Nuc Med HL7 TCP/IP Bridge;05/21/99 ; 8/28/08 2:05pm
"RTN","RAHLTCPB",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**12,17,25,51,71,81,84,106**;Mar 16, 1998;Build 2
"RTN","RAHLTCPB",3,0)
 ; 07/05/2006 BAY/KAM Remedy Call 124379 Eliminate unneeded ORM msgs
"RTN","RAHLTCPB",4,0)
 ; 09/01/2006   Accomodate multiple ORC/OBR segments Patch 81
"RTN","RAHLTCPB",5,0)
 ; 
"RTN","RAHLTCPB",6,0)
 ;Integration Agreements
"RTN","RAHLTCPB",7,0)
 ;----------------------
"RTN","RAHLTCPB",8,0)
 ;INIT^HLFNC2(2161); GENACK^HLMA1(2165); $$DT^XLFDT(10103)
"RTN","RAHLTCPB",9,0)
 ; 
"RTN","RAHLTCPB",10,0)
EN1 ; Build the ^TMP("RARPT-REC" global when we receive the
"RTN","RAHLTCPB",11,0)
 ; 07/05/2006 Remedy Call 124379 message from HL7. If RAHLTCPB is defined, do not broadcast ORM messages. As of the writing
"RTN","RAHLTCPB",12,0)
 ; of patch 71, RAHLTCPB is referenced in RAHLTCPB, UPSTAT^RAUTL0, & UP2^RAUTL1 Generic provider: RADIOLOGY,OUTSIDE SERVICE
"RTN","RAHLTCPB",13,0)
 N RATELE,RATELENM,RATELEPI,RATELEKN,RATELEDR,RATELEDF
"RTN","RAHLTCPB",14,0)
 D TELE^RAHLRPTT ;Patch 84
"RTN","RAHLTCPB",15,0)
 ;** branch to new HL7 logic when the HL7 version surpasses 2.3 **
"RTN","RAHLTCPB",16,0)
 I HL("VER")>2.3,($T(^RAHLTCPX))'="" GOTO EN1^RAHLTCPX
"RTN","RAHLTCPB",17,0)
 S RASUB=HL("MID"),RAHLTCPB=1 K RAERR
"RTN","RAHLTCPB",18,0)
 ;**********************************************
"RTN","RAHLTCPB",19,0)
 ;RACN is Counter - Indication that ORC segment present
"RTN","RAHLTCPB",20,0)
 N RACN,II,L,RAPRSET,RARRR,XX,RAHLD,RARSDNT,RATRSCRP S (RACN,RAPRSET)=0 ; = Address where we go to store data...
"RTN","RAHLTCPB",21,0)
 ;**********************************************
"RTN","RAHLTCPB",22,0)
 K ^TMP("RARPT-HL7",$J) ; clean area that holds data from HL7
"RTN","RAHLTCPB",23,0)
 K ^TMP("RARPT-REC",$J,RASUB) ; kill storage area for new HL7 message id
"RTN","RAHLTCPB",24,0)
 S ^TMP("RARPT-REC",$J,RASUB,"RADATE")=$$DT^XLFDT()
"RTN","RAHLTCPB",25,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","RAHLTCPB",26,0)
 .I '$L(HLNODE),$L($G(HLNODE(1))) S HLNODE=HLNODE(1) K HLNODE(1) F J=2:1 Q:'$D(HLNODE(J))  S HLNODE(J-1)=HLNODE(J) K HLNODE(J)
"RTN","RAHLTCPB",27,0)
 .S ^TMP("RARPT-HL7",$J,I)=HLNODE,J=0 F  S J=$O(HLNODE(J)) Q:'J  S ^TMP("RARPT-HL7",$J,I,J)=HLNODE(J)
"RTN","RAHLTCPB",28,0)
 S CNT=2,SEGMNT=$G(^TMP("RARPT-HL7",$J,CNT))
"RTN","RAHLTCPB",29,0)
 S:'$$GETSFLAG^RAHLRU($G(HL("SAN")),$G(HL("MTN")),$G(HL("ETN")),$G(HL("VER"))) RANOSEND=$G(HL("SAN"))
"RTN","RAHLTCPB",30,0)
 S ^TMP("RARPT-REC",$J,RASUB,"VENDOR")=$G(HL("SAN"))
"RTN","RAHLTCPB",31,0)
PID ; Pick data off the 'PID' segment.
"RTN","RAHLTCPB",32,0)
 I $P(SEGMNT,HL("FS"))="PID" D
"RTN","RAHLTCPB",33,0)
 . S SEGMNT=$P(SEGMNT,HL("FS"),2,99999)
"RTN","RAHLTCPB",34,0)
 . I $P($P(SEGMNT,HL("FS"),3),$E(HL("ECH")))]"" D
"RTN","RAHLTCPB",35,0)
 .. S (^TMP("RARPT-REC",$J,RASUB,"RADFN"),RADFN)=$P($P(SEGMNT,HL("FS"),3),$E(HL("ECH")))
"RTN","RAHLTCPB",36,0)
 .. Q
"RTN","RAHLTCPB",37,0)
 . I $P(SEGMNT,HL("FS"),19)]"" D
"RTN","RAHLTCPB",38,0)
 .. S ^TMP("RARPT-REC",$J,RASUB,"RASSN")=$P(SEGMNT,HL("FS"),19)
"RTN","RAHLTCPB",39,0)
 .. Q
"RTN","RAHLTCPB",40,0)
 . Q
"RTN","RAHLTCPB",41,0)
 E  S RAERR="Missing PID segment" D XIT Q
"RTN","RAHLTCPB",42,0)
 I '(+$G(^TMP("RARPT-REC",$J,RASUB,"RADFN"))) D  Q
"RTN","RAHLTCPB",43,0)
 .S RAERR="Invalid Patient ID"
"RTN","RAHLTCPB",44,0)
 .D XIT
"RTN","RAHLTCPB",45,0)
 ; Save off E-Sig information (if it exists)
"RTN","RAHLTCPB",46,0)
 S:$D(HL("ESIG")) ^TMP("RARPT-REC",$J,RASUB,"RAESIG")=HL("ESIG")
"RTN","RAHLTCPB",47,0)
 ;********************************
"RTN","RAHLTCPB",48,0)
ORC ; Pick data off the 'ORC' segment.
"RTN","RAHLTCPB",49,0)
 D
"RTN","RAHLTCPB",50,0)
 .N CNT1 S CNT1=CNT,RARRR=""
"RTN","RAHLTCPB",51,0)
111 .K SEGMNT S CNT1=$O(^TMP("RARPT-HL7",$J,CNT1)) Q:CNT1=""  S SEGMNT=$G(^(CNT1))
"RTN","RAHLTCPB",52,0)
 .I $P(SEGMNT,HL("FS"))="PV1" S CNT=CNT1 G 111
"RTN","RAHLTCPB",53,0)
 .Q:$P(SEGMNT,HL("FS"))'="ORC"
"RTN","RAHLTCPB",54,0)
 .S CNT=CNT1 Q:$P(SEGMNT,HL("FS"),2)'="CN"  ; find the 'ORC' segment
"RTN","RAHLTCPB",55,0)
 .S RACN=RACN+1,RARRR="RARPT-REC-"_RACN
"RTN","RAHLTCPB",56,0)
 ;********************************
"RTN","RAHLTCPB",57,0)
OBR ; Pick data off the 'OBR' segment.
"RTN","RAHLTCPB",58,0)
 I $L(RARRR) K ^TMP(RARRR,$J) M ^TMP(RARRR,$J)=^TMP("RARPT-REC",$J) ;Merge if OBR without Report
"RTN","RAHLTCPB",59,0)
 S:'$L(RARRR) RARRR="RARPT-REC"
"RTN","RAHLTCPB",60,0)
 K SEGMNT F  S CNT=$O(^TMP("RARPT-HL7",$J,CNT)) Q:CNT=""  S SEGMNT=$G(^(CNT)) Q:$P(SEGMNT,HL("FS"))="OBR"  ; find the 'OBR' segment
"RTN","RAHLTCPB",61,0)
 I $P($G(SEGMNT),HL("FS"))'="OBR" S RAERR="Missing OBR segment" D XIT Q
"RTN","RAHLTCPB",62,0)
 S SEGMNT=$P(SEGMNT,HL("FS"),2,99999) K RADTI,RACNI
"RTN","RAHLTCPB",63,0)
 I $P(SEGMNT,HL("FS"),3)]"" D
"RTN","RAHLTCPB",64,0)
 . N RADTCN S RADTCN=$P(SEGMNT,HL("FS"),3)
"RTN","RAHLTCPB",65,0)
 . S:$P($P(RADTCN,$E(HL("ECH"))),"-")]"" (^TMP(RARRR,$J,RASUB,"RADTI"),RADTI)=$P($P(RADTCN,$E(HL("ECH"))),"-")
"RTN","RAHLTCPB",66,0)
 . S:$P($P(RADTCN,$E(HL("ECH"))),"-",2)]"" (^TMP(RARRR,$J,RASUB,"RACNI"),RACNI)=$P($P(RADTCN,$E(HL("ECH"))),"-",2)
"RTN","RAHLTCPB",67,0)
 . S:$P(RADTCN,$E(HL("ECH")),2)["&L" RADTCN=$TR(RADTCN,"&","^")
"RTN","RAHLTCPB",68,0)
 . S:$P(RADTCN,$E(HL("ECH")),2)]"" ^TMP(RARRR,$J,RASUB,"RALONGCN")=$P(RADTCN,$E(HL("ECH")),2)
"RTN","RAHLTCPB",69,0)
 . Q
"RTN","RAHLTCPB",70,0)
 I $G(RADTI)'>0 S RAERR="Invalid exam registration timestamp" D XIT Q
"RTN","RAHLTCPB",71,0)
 I $G(RACNI)'>0 S RAERR="Invalid exam record IEN" D XIT Q
"RTN","RAHLTCPB",72,0)
 S RAHLD=$$PCEXTR^RAHLO4(CNT,SEGMNT,25,HL("FS")) K RAHL70
"RTN","RAHLTCPB",73,0)
 I RAHLD="" S RAERR="Missing Report Status" D XIT Q
"RTN","RAHLTCPB",74,0)
 ;P106
"RTN","RAHLTCPB",75,0)
 I "^A^F^R^VAQ^"'[("^"_RAHLD_"^") D  D XIT Q
"RTN","RAHLTCPB",76,0)
 .S RAERR="Invalid Report Status: "_RAHLD QUIT
"RTN","RAHLTCPB",77,0)
 ;
"RTN","RAHLTCPB",78,0)
 S ^TMP(RARRR,$J,RASUB,"RASTAT")=RAHLD
"RTN","RAHLTCPB",79,0)
 G:$P(RARRR,"-",3) 112 S RAHLD=$$PCEXTR^RAHLO4(CNT,SEGMNT,32,HL("FS")) K RAHL70
"RTN","RAHLTCPB",80,0)
 I RAHLD']"" S RAERR="Missing Provider ID" D XIT Q
"RTN","RAHLTCPB",81,0)
 S RAVERF=RAHLD
"RTN","RAHLTCPB",82,0)
 ; -----   Check the validity of the provider name   -----
"RTN","RAHLTCPB",83,0)
 I '$D(^VA(200,"B",RAVERF)) D  ; check for a partial match in file 200
"RTN","RAHLTCPB",84,0)
 . D VFIER^RAHLO3 ; if one partial match found, return the entry ien
"RTN","RAHLTCPB",85,0)
 E  D  ; $D(^VA(200,"B",RAVERF)) true, get the entry ien
"RTN","RAHLTCPB",86,0)
 . S RAVERF=$O(^VA(200,"B",RAVERF,0))
"RTN","RAHLTCPB",87,0)
 . S:'RAVERF RAERR="Invalid Provider Name: "_RAHLD
"RTN","RAHLTCPB",88,0)
 ; can't get resident info from medspeak
"RTN","RAHLTCPB",89,0)
 S RAHLD=$$PCEXTR^RAHLO4(CNT,SEGMNT,33,HL("FS")),RARSDNT="" K RAHL70
"RTN","RAHLTCPB",90,0)
 I RAHLD]"" D
"RTN","RAHLTCPB",91,0)
 . S RARSDNT=$P(RAHLD,$E(HL("ECH"),4)) I '$D(^VA(200,+RARSDNT,0)) S RARSDNT=""
"RTN","RAHLTCPB",92,0)
 S RAHLD="",RAHLD=$$PCEXTR^RAHLO4(CNT,SEGMNT,35,HL("FS")),RATRSCRP="" K RAHL70
"RTN","RAHLTCPB",93,0)
 I RAHLD]"" D
"RTN","RAHLTCPB",94,0)
 . S RATRSCRP=$P(RAHLD,$E(HL("ECH"),4)) I '$D(^VA(200,+RATRSCRP,0)) S RATRSCRP=""
"RTN","RAHLTCPB",95,0)
 S ^TMP(RARRR,$J,RASUB,"RAVERF")=RAVERF
"RTN","RAHLTCPB",96,0)
 S ^TMP(RARRR,$J,RASUB,"RATRANSCRIPT")=$S(RATRSCRP]"":RATRSCRP,RARSDNT]"":RARSDNT,1:RAVERF)
"RTN","RAHLTCPB",97,0)
 S:$G(RARSDNT) ^TMP(RARRR,$J,RASUB,"RARESIDENT")=RARSDNT
"RTN","RAHLTCPB",98,0)
 S ^TMP(RARRR,$J,RASUB,"RASTAFF")=RAVERF,^("RAWHOCHANGE")=RAVERF
"RTN","RAHLTCPB",99,0)
 I $D(RAERR) D XIT Q
"RTN","RAHLTCPB",100,0)
 D ESIG^RAHLO3
"RTN","RAHLTCPB",101,0)
 ;
"RTN","RAHLTCPB",102,0)
 ;If last OBR set provider info to all OBRs
"RTN","RAHLTCPB",103,0)
 K XX F I=1:1:RACN S XX=RARRR_"-"_I D:$D(^TMP(XX,$J,RASUB))
"RTN","RAHLTCPB",104,0)
 .N XXX M XXX=^TMP(XX,$J,RASUB),^TMP(XX,$J,RASUB)=^TMP(RARRR,$J,RASUB),^TMP(XX,$J,RASUB)=XXX
"RTN","RAHLTCPB",105,0)
112 I $D(RADTI),$D(RACNI),$D(RAPRSET(RADTI,RACNI)) K RAPRSET(RADTI,RACNI),^TMP(RARRR,$J) S RACN=RACN-1 G:$P(RARRR,"-",3) ORC M ^TMP(RARRR,$J)=^TMP("RARPT-REC-"_(RACN+1),$J) K ^TMP("RARPT-REC-"_(RACN+1),$J) G OBX
"RTN","RAHLTCPB",106,0)
 I $D(RADTI),'$D(RAPRSET(RADTI)) D  ;Get array of printset for date...
"RTN","RAHLTCPB",107,0)
 .N RAPRTSET,RACN,RASUB,CNT
"RTN","RAHLTCPB",108,0)
 .K XX D EN2^RAUTL20(.XX) M:$D(XX) RAPRSET(RADTI)=XX K RAPRSET(RADTI,RACNI)
"RTN","RAHLTCPB",109,0)
 ;
"RTN","RAHLTCPB",110,0)
OBX ; Pick data off the 'OBX' segments
"RTN","RAHLTCPB",111,0)
 K SEGMNT F  S CNT=$O(^TMP("RARPT-HL7",$J,CNT)) Q:CNT=""  S SEGMNT=$G(^(CNT)) D:$P(SEGMNT,HL("FS"))="OBX"  Q:$D(RAERR)  I $P(SEGMNT,HL("FS"))="ORC" S CNT=CNT-1 G ORC
"RTN","RAHLTCPB",112,0)
 . S SEGMNT=$P(SEGMNT,HL("FS"),2,9999)
"RTN","RAHLTCPB",113,0)
 . Q:SEGMNT?@("1"""_HL("FS")_"""."""_HL("FS")_"""")  ;Quit if OBX is something as:    OBX||||||||
"RTN","RAHLTCPB",114,0)
 . I $P(SEGMNT,HL("FS"),3)']"" S RAERR="Missing Observation Identifier" Q
"RTN","RAHLTCPB",115,0)
 . S OBXTYP=$P($P(SEGMNT,HL("FS"),3),$E(HL("ECH"))),OBXTYP=$E($P(OBXTYP,"&",2))
"RTN","RAHLTCPB",116,0)
 . S OBX2CE=""
"RTN","RAHLTCPB",117,0)
 . S:OBXTYP="" OBXTYP=" "
"RTN","RAHLTCPB",118,0)
 . I OBXTYP=" "&($P(SEGMNT,HL("FS"),2)="CE") D
"RTN","RAHLTCPB",119,0)
 . . I $P(SEGMNT,HL("FS"),5)=" " S OBXTYP="F" Q
"RTN","RAHLTCPB",120,0)
 . . S OBX2CE=1,OBXTYP="D" Q
"RTN","RAHLTCPB",121,0)
 . I "IDRF"'[OBXTYP S RAERR="Invalid Observation Identifier" Q
"RTN","RAHLTCPB",122,0)
 . D RPT Q
"RTN","RAHLTCPB",123,0)
XIT ; RACKYES  Indicates that Ack will be sent on the last OBR segment or at Error condition.
"RTN","RAHLTCPB",124,0)
 N RACKYES
"RTN","RAHLTCPB",125,0)
 I $D(RAERR) S RACKYES=1 D EN1^RAHLEXF,GENACK G XIT1
"RTN","RAHLTCPB",126,0)
 I $D(^TMP("RARPT-REC",$J)) S:'RACN RACKYES=1 D  G:$D(RAERR) XIT1
"RTN","RAHLTCPB",127,0)
 .N RACN D EN1^RAHLO I $D(RAERR) S RACKYES=1 D EN1^RAHLEXF,GENACK
"RTN","RAHLTCPB",128,0)
 F II=1:1:RACN S RARRR="RARPT-REC-"_II D:$D(^TMP(RARRR,$J))  Q:$D(RAERR)
"RTN","RAHLTCPB",129,0)
 .K ^TMP("RARPT-REC",$J) M ^TMP("RARPT-REC",$J)=^TMP(RARRR,$J) K ^TMP(RARRR,$J)
"RTN","RAHLTCPB",130,0)
 .S RACKYES=(II=RACN) N II,RACN D EN1^RAHLO I $D(RAERR) S RACKYES=1 D EN1^RAHLEXF,GENACK
"RTN","RAHLTCPB",131,0)
XIT1 K ^TMP("RARPT-REC",$J) ; kill storage area for current HL7 message id
"RTN","RAHLTCPB",132,0)
 F II=1:1:RACN S RARRR="RARPT-REC-"_II K:$D(^TMP(RARRR,$J)) ^TMP(RARRR,$J)
"RTN","RAHLTCPB",133,0)
 K ^TMP("RARPT-HL7",$J) ; clean up HL7 storage
"RTN","RAHLTCPB",134,0)
 K CNT,OBXTYP,X1,LIN,RADATE,RADTCN,RAERR,RAESIG,RAHLD,RAHLTCPB,RANODE,RARCNT
"RTN","RAHLTCPB",135,0)
 K RAVERF,RASUB,SEGMNT,RANOSEND,MSA1,OBX2CE,RADX,RADX1,RADX2,RADX3
"RTN","RAHLTCPB",136,0)
 Q
"RTN","RAHLTCPB",137,0)
RPT ; Save off Report Text data.
"RTN","RAHLTCPB",138,0)
 N RAXADEDN
"RTN","RAHLTCPB",139,0)
 S RAXADEDN=^TMP("RARPT-REC",$J,RASUB,"RASTAT")
"RTN","RAHLTCPB",140,0)
 S RANODE=$S(OBXTYP="D":"RADX",OBXTYP="I":"RAIMP",1:"RATXT"),LIN=""
"RTN","RAHLTCPB",141,0)
 I OBX2CE D  Q
"RTN","RAHLTCPB",142,0)
 . S X=$P(SEGMNT,HL("FS"),5),RADX1=$P(X,$E(HL("ECH")))
"RTN","RAHLTCPB",143,0)
 . S LIN=RADX1,L=999 D P2 S LIN=X
"RTN","RAHLTCPB",144,0)
 . Q:X'["~"  F J=0:0 S J=$O(^TMP("RARPT-HL7",$J,CNT,J)) Q:'J  S X1=^(J),LIN=LIN_X1 Q
"RTN","RAHLTCPB",145,0)
 . S RADX=LIN,RADX2=$P($P(RADX,"~",2),"^") S:RADX2]"" LIN=RADX2 D P2
"RTN","RAHLTCPB",146,0)
 . S RADX3=$P($P(RADX,"~",3),"^") Q:RADX3']""  S LIN=RADX3 D P2 Q
"RTN","RAHLTCPB",147,0)
 S X=$P(SEGMNT,HL("FS"),5)
"RTN","RAHLTCPB",148,0)
 I X["\S\"!(X["\R\")!(X["\E\")!(X["\T\") D FORMAT
"RTN","RAHLTCPB",149,0)
 I $G(RATELE),$D(RATELEKN),X[RATELEKN S X=$P(X,RATELEKN,2),RATELENM=$P(X,"-"),RATELEPI=$TR($P(X,"-",2)," ","") ;SFVAMC/DAD/9-7-2007/Comment out the quit Q  ;Patch 84
"RTN","RAHLTCPB",150,0)
 D PAR
"RTN","RAHLTCPB",151,0)
 F J=0:0 S J=$O(^TMP("RARPT-HL7",$J,CNT,J)) Q:'J  S X1=^(J),X=$E(X1,1,125) D PAR I $L(X1)>125 S X=$E(X1,126,999) D PAR
"RTN","RAHLTCPB",152,0)
 I X=""!(LIN'="") S L=999 D P2
"RTN","RAHLTCPB",153,0)
 Q
"RTN","RAHLTCPB",154,0)
 ;
"RTN","RAHLTCPB",155,0)
PAR ; Build text paragraph
"RTN","RAHLTCPB",156,0)
 S LIN=LIN_X
"RTN","RAHLTCPB",157,0)
P1 I $L(LIN)<80 Q
"RTN","RAHLTCPB",158,0)
 F L=80:-1:1 Q:$E(LIN,L)=" "
"RTN","RAHLTCPB",159,0)
 D P2 S LIN=$E(LIN,L+1,999) G P1
"RTN","RAHLTCPB",160,0)
P2 ; Set node
"RTN","RAHLTCPB",161,0)
 ; If Addendum and Report text is a space don't process
"RTN","RAHLTCPB",162,0)
 I $P(SEGMNT,HL("FS"),1)=1,RAXADEDN="A",RANODE="RATXT",$E(LIN,1,L-1)=" " Q
"RTN","RAHLTCPB",163,0)
 S RARCNT(OBXTYP)=$G(RARCNT(OBXTYP))+1
"RTN","RAHLTCPB",164,0)
 S ^TMP("RARPT-REC",$J,RASUB,RANODE,RARCNT(OBXTYP))=$E(LIN,1,L-1)
"RTN","RAHLTCPB",165,0)
 F I=1:1:RACN S RARRR="RARPT-REC-"_I S:$D(^TMP(RARRR,$J)) ^TMP(RARRR,$J,RASUB,RANODE,RARCNT(OBXTYP))=$E(LIN,1,L-1)
"RTN","RAHLTCPB",166,0)
 Q
"RTN","RAHLTCPB",167,0)
 ;
"RTN","RAHLTCPB",168,0)
GENACK ; Compile the 'ACK' segment, generate the 'ACK' message.
"RTN","RAHLTCPB",169,0)
 Q:'$G(RACKYES)
"RTN","RAHLTCPB",170,0)
 S MSA1="AA"
"RTN","RAHLTCPB",171,0)
 Q:$E($G(HL("SAN")),1,3)'="RA-"  ; Don't allow non RA namespaced interfaces
"RTN","RAHLTCPB",172,0)
 I $D(RAERR) S MSA1=$S($G(HL("SAN"))="RA-PSCRIBE-TCP"!$G(RATELE):"AE",1:"AR")
"RTN","RAHLTCPB",173,0)
 ; Added next line to support MedSpeak interface.  Must re-initialize
"RTN","RAHLTCPB",174,0)
 ; FS and EC's before sending ACK.
"RTN","RAHLTCPB",175,0)
 D:$G(HL("SAN"))="RA-CLIENT-TCP" INIT^HLFNC2("RA VOICE TCP SERVER RPT",.HL)
"RTN","RAHLTCPB",176,0)
 S HLA("HLA",1)="MSA"_HL("FS")_MSA1_HL("FS")_HL("MID")_$S($D(RAERR):HL("FS")_RAERR,1:"")
"RTN","RAHLTCPB",177,0)
 ; 06/22/2006 KAM CHANGED NEXT TWO LINES FOR RA*5*71
"RTN","RAHLTCPB",178,0)
 S HLEID=HL("EID"),HLEIDS=HL("EIDS"),HLARYTYP="LM",HLFORMAT=1
"RTN","RAHLTCPB",179,0)
 K HLRESLT D GENACK^HLMA1(HLEID,HLMTIENS,HLEIDS,HLARYTYP,HLFORMAT)
"RTN","RAHLTCPB",180,0)
 Q
"RTN","RAHLTCPB",181,0)
 ;
"RTN","RAHLTCPB",182,0)
FORMAT ; Format report text for Escape Character delimited codes.
"RTN","RAHLTCPB",183,0)
 S Y=X N T,Q
"RTN","RAHLTCPB",184,0)
 I Y["\S\" S Q=$F(Y,"\S\"),T=Q-4,X=$E(Y,1,T)_$E(HL("ECH"))_$E(Y,Q,$L(X)),Y=X
"RTN","RAHLTCPB",185,0)
 I Y["\R\" S Q=$F(Y,"\R\"),T=Q-4,X=$E(Y,1,T)_$E(HL("ECH"),2)_$E(Y,Q,$L(X)),Y=X
"RTN","RAHLTCPB",186,0)
 I Y["\E\" S Q=$F(Y,"\E\"),T=Q-4,X=$E(Y,1,T)_$E(HL("ECH"),3)_$E(Y,Q,$L(X)),Y=X
"RTN","RAHLTCPB",187,0)
 I Y["\T\" S Q=$F(Y,"\T\"),T=Q-4,X=$E(Y,1,T)_$E(HL("ECH"),4)_$E(Y,Q,$L(X)),Y=X
"RTN","RAHLTCPB",188,0)
 I X["\S\"!(X["\R\")!(X["\E\")!(X["\T\") D FORMAT
"RTN","RAHLTCPB",189,0)
 Q
"RTN","RAHLTCPB",190,0)
 ;
"RTN","RARPTUT")
0^2^B110205349^n/a
"RTN","RARPTUT",1,0)
RARPTUT ;HISC/GJC - rad/nuc med report utilities ;04/15/10  07:51
"RTN","RARPTUT",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**106**;Mar 16, 1998;Build 2
"RTN","RARPTUT",3,0)
 ;
"RTN","RARPTUT",4,0)
 ;Integration Agreements
"RTN","RARPTUT",5,0)
 ;----------------------
"RTN","RARPTUT",6,0)
 ;$$FIND^DIC  - 2051 (supported)
"RTN","RARPTUT",7,0)
 ;FILE^DIE    - 2053 (supported)
"RTN","RARPTUT",8,0)
 ;UPDATE^DIE  - 2053 (supported)
"RTN","RARPTUT",9,0)
 ;WP^DIE      - 2053 (supported)
"RTN","RARPTUT",10,0)
 ;$$IENS^DILF - 2054 (supported)
"RTN","RARPTUT",11,0)
 ;CLEAN^DILF  - 2054 (supported)
"RTN","RARPTUT",12,0)
 ;$$GET1^DIQ  - 2056 (supported)
"RTN","RARPTUT",13,0)
 ;
"RTN","RARPTUT",14,0)
 ;Events that cause reports to be deleted or to revert back to a
"RTN","RARPTUT",15,0)
 ;stub form need to make the appropriate case available to be read.
"RTN","RARPTUT",16,0)
 ;
"RTN","RARPTUT",17,0)
REL(RARPT,RAERR) ;NTP II - mark a report as 'X' (Deleted) or null
"RTN","RARPTUT",18,0)
 ;(mimics 'images collected'). Called when an inbound report has a RESULT
"RTN","RARPTUT",19,0)
 ;STATUS (OBR-25) value of 'VAQ'.
"RTN","RARPTUT",20,0)
 ;
"RTN","RARPTUT",21,0)
 ;Input : RARPT = the IEN of the rad/nuc med report record
"RTN","RARPTUT",22,0)
 ;Output: RAERR = 0 if successful
"RTN","RARPTUT",23,0)
 ;                <0 error code^Message text^Error location^Type
"RTN","RARPTUT",24,0)
 ;
"RTN","RARPTUT",25,0)
 ;    A positive value of RAERR will not trigger a negative acknowledgment
"RTN","RARPTUT",26,0)
 ;    to be broadcast.
"RTN","RARPTUT",27,0)
 ;
"RTN","RARPTUT",28,0)
 S U="^",RAERR=0
"RTN","RARPTUT",29,0)
 N C,RAPARAMS,RATIMOUT,X,Y S RATIMOUT=300
"RTN","RARPTUT",30,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",31,0)
 ;lock the report record in question. if unsuccessful quit w/error
"RTN","RARPTUT",32,0)
 S RAERR=$$LOCKFM^RALOCK(74,RARPT_",",,RATIMOUT) ;(+1)
"RTN","RARPTUT",33,0)
 S RAERR=$$LOCKERR^RAERR(RAERR,"Rad/Nuc Med Reports file")
"RTN","RARPTUT",34,0)
 ;RAERR = -15^The Rad/Nuc Med Reports file is locked by other user/task. Please try later.
"RTN","RARPTUT",35,0)
 ;        ^LOCKERR+1~RAERR^W
"RTN","RARPTUT",36,0)
 I RAERR D  QUIT
"RTN","RARPTUT",37,0)
 .N RATXT S RATXT(1)=$P(RAERR,U,2),RATXT(2)="IEN: "_$G(RARPT,-1)
"RTN","RARPTUT",38,0)
 .S RATXT(3)="Calling Routine: "_$P(RAERR,U,3)
"RTN","RARPTUT",39,0)
 .D MM(74,.RATXT)
"RTN","RARPTUT",40,0)
 .Q
"RTN","RARPTUT",41,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",42,0)
 ;
"RTN","RARPTUT",43,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",44,0)
CHKSTS ;In order to 'mark as deleted', NTP reports those reports must have a
"RTN","RARPTUT",45,0)
 ;REPORT STATUS of 'R' (RELEASED/NOT VERIFIED). If the report status is
"RTN","RARPTUT",46,0)
 ;not set to 'R' log the error, unlock the report & quit.
"RTN","RARPTUT",47,0)
 ;RAERR="-19^Invalid value of field #5 in file #74, IENS='2317'.^^E"                 
"RTN","RARPTUT",48,0)
 S RARPT(0)=$G(^RARPT(RARPT,0))
"RTN","RARPTUT",49,0)
 I $P(RARPT(0),U,5)'="R" D  Q
"RTN","RARPTUT",50,0)
 .S RAERR=$$ERROR^RAERR(-19,,74,RARPT,5)
"RTN","RARPTUT",51,0)
 .D UNLOCKFM^RALOCK(74,RARPT_",") ;(-1)
"RTN","RARPTUT",52,0)
 .N RATXT S RATXT(1)=$P($G(RAERR),U,2)
"RTN","RARPTUT",53,0)
 .S RATXT(2)=$P($G(RAERR),U,3) D MM(74,.RATXT)
"RTN","RARPTUT",54,0)
 .Q
"RTN","RARPTUT",55,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",56,0)
 ;
"RTN","RARPTUT",57,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",58,0)
IMG ;Can't 'mark as deleted' a report being held if images have been
"RTN","RARPTUT",59,0)
 ;attached to that report record. Held reports w/images get moved to
"RTN","RARPTUT",60,0)
 ;a null report status.
"RTN","RARPTUT",61,0)
 ;  RAIMAGES=1 if images are attached
"RTN","RARPTUT",62,0)
 ;  else RAIMAGES=0
"RTN","RARPTUT",63,0)
 N RAIMAGES S RAIMAGES=$S($O(^RARPT(RARPT,2005,0))>0:1,1:0)
"RTN","RARPTUT",64,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",65,0)
 ;
"RTN","RARPTUT",66,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",67,0)
REGEX ;lock at the REGISTERED EXAM (#70.02) record associated with this report
"RTN","RARPTUT",68,0)
 ;piece 2: Patient DFN, piece 3: EXAM DATE/TIME, piece 4: CASE NUMBER
"RTN","RARPTUT",69,0)
 ;>>> Note: RAIEN70 is the IEN string at the 70.02 level. <<<
"RTN","RARPTUT",70,0)
 N RACN,RACNI,RADFN,RADTI,RAIEN70,RAX
"RTN","RARPTUT",71,0)
 S (DA(1),RADFN)=$P(RARPT(0),U,2),(DA,RADTI)=9999999.9999-$P(RARPT(0),U,3)
"RTN","RARPTUT",72,0)
 S RACN=+$P(RARPT(0),U,4),RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0))
"RTN","RARPTUT",73,0)
 S RAIEN70=$$IENS^DILF(.DA) K DA
"RTN","RARPTUT",74,0)
 S RAERR=$$LOCKFM^RALOCK(70.02,RAIEN70,,RATIMOUT) ;(+2)
"RTN","RARPTUT",75,0)
 S RAERR=$$LOCKERR^RAERR(RAERR,"Registered Exams Sub-File #70.02")
"RTN","RARPTUT",76,0)
 ;I the case at the REGISTERED EXAMS level is locked
"RTN","RARPTUT",77,0)
 I RAERR D  QUIT
"RTN","RARPTUT",78,0)
 .D UNLOCKFM^RALOCK(74,RARPT_",") ;(-1)
"RTN","RARPTUT",79,0)
 .N RATXT S RATXT(1)=$P($G(RAERR),U,2),RATXT(2)="IEN(s): "_$G(RAIEN70,-1)
"RTN","RARPTUT",80,0)
 .S RATXT(3)="Calling Routine: "_$P($G(RAERR),U,3)
"RTN","RARPTUT",81,0)
 .D MM(74,.RATXT)
"RTN","RARPTUT",82,0)
 .Q
"RTN","RARPTUT",83,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",84,0)
 ;
"RTN","RARPTUT",85,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",86,0)
RPTXT ;delete the REPORT TEXT (70.03; #17) field value for a exam liked to
"RTN","RARPTUT",87,0)
 ;a report that does not have attached images.
"RTN","RARPTUT",88,0)
 ;>>> Note: RAIENS70 is the IEN string at the 70.03 level. <<<
"RTN","RARPTUT",89,0)
 I RAIMAGES=0 D
"RTN","RARPTUT",90,0)
 .;make sure you consider printsets
"RTN","RARPTUT",91,0)
 .S RADA=0 N RAIENS70
"RTN","RARPTUT",92,0)
 .F  S RADA=$O(^RADPT(RADFN,"DT",RADTI,"P",RADA)) Q:'RADA  D
"RTN","RARPTUT",93,0)
 ..S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RADA,0)) Q:$P(RA7003,U,17)'=RARPT
"RTN","RARPTUT",94,0)
 ..S DA=RADA,DA(1)=RADTI,DA(2)=RADFN
"RTN","RARPTUT",95,0)
 ..S RAIENS70=$$IENS^DILF(.DA) K DA
"RTN","RARPTUT",96,0)
 ..S RAFDA(70.03,RAIENS70,17)="@"
"RTN","RARPTUT",97,0)
 ..Q
"RTN","RARPTUT",98,0)
 .I ($D(RAFDA(70.03))\10) D
"RTN","RARPTUT",99,0)
 ..D FILE^DIE("","RAFDA") K RA7003,RADA,RAFDA
"RTN","RARPTUT",100,0)
 ..I $D(DIERR)#2 D
"RTN","RARPTUT",101,0)
 ...;RAERR="-9^FileMan DBS call error(s); File #70.03; 
"RTN","RARPTUT",102,0)
 ...;IENS: "1,6917999.9999,76,"^DBS+14~RAERR^E"
"RTN","RARPTUT",103,0)
 ...S RAERR=$$DBS^RAERR("",-9,70.03,RAIENS70)
"RTN","RARPTUT",104,0)
 ...D UNLOCKFM^RALOCK(70.02,RAIEN70) ;(-2)
"RTN","RARPTUT",105,0)
 ...D UNLOCKFM^RALOCK(74,RARPT_",") ;(-1)
"RTN","RARPTUT",106,0)
 ...N RATXT S RATXT(1)=$P($G(RAERR),U,2)
"RTN","RARPTUT",107,0)
 ...S RATXT(2)="Calling Routine: "_$P($G(RAERR),U,3)
"RTN","RARPTUT",108,0)
 ...S RATXT(3)="Calling subroutine: RPTXT"
"RTN","RARPTUT",109,0)
 ...D MM(70.02,.RATXT)
"RTN","RARPTUT",110,0)
 ...Q
"RTN","RARPTUT",111,0)
 ..D CLEAN^DILF
"RTN","RARPTUT",112,0)
 ..Q
"RTN","RARPTUT",113,0)
 .Q
"RTN","RARPTUT",114,0)
 Q:RAERR
"RTN","RARPTUT",115,0)
 ;
"RTN","RARPTUT",116,0)
PIS ;delete the PRIMARY INTERPRETING STAFF (70.03; #15) field value
"RTN","RARPTUT",117,0)
 ;for a exam liked to a report regardless of whether that report has
"RTN","RARPTUT",118,0)
 ;attached images.
"RTN","RARPTUT",119,0)
 ;>>> Note: RAIENS70 is the IEN string at the 70.03 level. <<<
"RTN","RARPTUT",120,0)
 D
"RTN","RARPTUT",121,0)
 .;make sure you consider printsets
"RTN","RARPTUT",122,0)
 .S RADA=0 N RAIENS70
"RTN","RARPTUT",123,0)
 .F  S RADA=$O(^RADPT(RADFN,"DT",RADTI,"P",RADA)) Q:'RADA  D
"RTN","RARPTUT",124,0)
 ..S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RADA,0))
"RTN","RARPTUT",125,0)
 ..S DA=RADA,DA(1)=RADTI,DA(2)=RADFN
"RTN","RARPTUT",126,0)
 ..S RAIENS70=$$IENS^DILF(.DA) K DA
"RTN","RARPTUT",127,0)
 ..S RAFDA(70.03,RAIENS70,15)="@"
"RTN","RARPTUT",128,0)
 ..Q
"RTN","RARPTUT",129,0)
 .I ($D(RAFDA(70.03))\10) D
"RTN","RARPTUT",130,0)
 ..D FILE^DIE("","RAFDA") K RA7003,RADA,RAFDA
"RTN","RARPTUT",131,0)
 ..I $D(DIERR)#2 D
"RTN","RARPTUT",132,0)
 ...;RAERR="-9^FileMan DBS call error(s); File #70.03; 
"RTN","RARPTUT",133,0)
 ...;IENS: "1,6917999.9999,76,"^DBS+14~RAERR^E"
"RTN","RARPTUT",134,0)
 ...S RAERR=$$DBS^RAERR("",-9,70.03,RAIENS70)
"RTN","RARPTUT",135,0)
 ...D UNLOCKFM^RALOCK(70.02,RAIEN70) ;(-2)
"RTN","RARPTUT",136,0)
 ...D UNLOCKFM^RALOCK(74,RARPT_",") ;(-1)
"RTN","RARPTUT",137,0)
 ...N RATXT S RATXT(1)=$P($G(RAERR),U,2)
"RTN","RARPTUT",138,0)
 ...S RATXT(2)="Calling Routine: "_$P($G(RAERR),U,3)
"RTN","RARPTUT",139,0)
 ...S RATXT(3)="Calling subroutine: PIS"
"RTN","RARPTUT",140,0)
 ...D MM(70.02,.RATXT)
"RTN","RARPTUT",141,0)
 ...Q
"RTN","RARPTUT",142,0)
 ..D CLEAN^DILF
"RTN","RARPTUT",143,0)
 ..Q
"RTN","RARPTUT",144,0)
 .Q
"RTN","RARPTUT",145,0)
 Q:RAERR
"RTN","RARPTUT",146,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",147,0)
 ;
"RTN","RARPTUT",148,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",149,0)
BATCH ;if the report does not have associated images check the REPORT BATCHES
"RTN","RARPTUT",150,0)
 ;(#74.2) file for references to the report in question. If there are
"RTN","RARPTUT",151,0)
 ;references to this report those references (pointers) must be deleted.
"RTN","RARPTUT",152,0)
 ;If there is an error within the RA742 function do not quit. The code
"RTN","RARPTUT",153,0)
 ;within RA742 will trigger the correct emails. Continue on and update
"RTN","RARPTUT",154,0)
 ;the REPORT STATUS field.
"RTN","RARPTUT",155,0)
 I RAIMAGES=0 D RA742(RARPT)
"RTN","RARPTUT",156,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",157,0)
 ;
"RTN","RARPTUT",158,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",159,0)
RSTATUS ;1) set the REPORT STATUS for reports absent of images to 'X'
"RTN","RARPTUT",160,0)
 ;          (Deleted)
"RTN","RARPTUT",161,0)
 ;       2) set the REPORT STATUS for reports w/images present to null
"RTN","RARPTUT",162,0)
 ;          (mimics 'images collected')
"RTN","RARPTUT",163,0)
 K RAFDA S RAFDA(74,RARPT_",",5)=$S(RAIMAGES=1:"@",1:"X")
"RTN","RARPTUT",164,0)
 D FILE^DIE("","RAFDA") K RAFDA
"RTN","RARPTUT",165,0)
 I $D(DIERR)#2 D
"RTN","RARPTUT",166,0)
 .;RAERR="-9^FileMan DBS call error(s); File #74; 
"RTN","RARPTUT",167,0)
 .;IENS: "2370,"^DBS+14~RAERR^E"
"RTN","RARPTUT",168,0)
 .S RAERR=$$DBS^RAERR("",-9,74,RARPT_",")
"RTN","RARPTUT",169,0)
 .D UNLOCKFM^RALOCK(70.02,RAIEN70) ;(-2)
"RTN","RARPTUT",170,0)
 .D UNLOCKFM^RALOCK(74,RARPT_",") ;(-1)
"RTN","RARPTUT",171,0)
 .N RATXT S RATXT(1)=$P($G(RAERR),U,2)
"RTN","RARPTUT",172,0)
 .S RATXT(2)="Calling Routine: "_$P($G(RAERR),U,3)
"RTN","RARPTUT",173,0)
 .D MM(74,.RATXT)
"RTN","RARPTUT",174,0)
 .Q
"RTN","RARPTUT",175,0)
 Q:RAERR
"RTN","RARPTUT",176,0)
 ;
"RTN","RARPTUT",177,0)
IMPRPTXT ;Delete the IMPRESSION TEXT (#300) and REPORT TEXT (#200)
"RTN","RARPTUT",178,0)
 ;for a report record, w/images, being released back to the local
"RTN","RARPTUT",179,0)
 ;facility for interpretation.
"RTN","RARPTUT",180,0)
 I RAIMAGES=1 D WP^DIE(74,RARPT_",",300,,"@"),WP^DIE(74,RARPT_",",200,,"@")
"RTN","RARPTUT",181,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",182,0)
 ;
"RTN","RARPTUT",183,0)
ACTIVLOG ;update the activity log. If an error occurs here inform the mail group
"RTN","RARPTUT",184,0)
 ;and fall through to the code that unlocks the exam and report records.
"RTN","RARPTUT",185,0)
 ;
"RTN","RARPTUT",186,0)
 ;>>> Note: RAIEN is the record number for the newly created activity log sub-file
"RTN","RARPTUT",187,0)
 ;record. <<<
"RTN","RARPTUT",188,0)
 ;
"RTN","RARPTUT",189,0)
 S RAIEN=$$ACTLOG()
"RTN","RARPTUT",190,0)
 ;
"RTN","RARPTUT",191,0)
 ;if no error, and there are not images associated with this report build
"RTN","RARPTUT",192,0)
 ;the RAFDA array for Dx Codes, sec. staff & sec. resident & file the data
"RTN","RARPTUT",193,0)
 ;in the proper lower level sub-files.
"RTN","RARPTUT",194,0)
 I RAIEN>0,(RAIMAGES=0) S RAERR=$$ACTLOGX(RAIEN)
"RTN","RARPTUT",195,0)
 ;
"RTN","RARPTUT",196,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",197,0)
 ;unlock the records
"RTN","RARPTUT",198,0)
 D UNLOCKFM^RALOCK(70.02,RAIEN70) ;(-2)
"RTN","RARPTUT",199,0)
 D UNLOCKFM^RALOCK(74,RARPT_",") ;(-1)
"RTN","RARPTUT",200,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",201,0)
 ;
"RTN","RARPTUT",202,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",203,0)
MAIL ;Whether the event was a success of failure update the users in the RAD 
"RTN","RARPTUT",204,0)
 ;HL7 MESSAGES mail group about the change in REPORT STATUS.
"RTN","RARPTUT",205,0)
 S RARPTSTS=$$GET1^DIQ(74,RARPT_",",5)
"RTN","RARPTUT",206,0)
 S:RAERR RAX="NTP failed to release a study back to the local facility."
"RTN","RARPTUT",207,0)
 S:'RAERR RAX="NTP succeeded in releasing a study back to the local facility."
"RTN","RARPTUT",208,0)
 S RATXT(1)=RAX,RATXT(2)=""
"RTN","RARPTUT",209,0)
 S RATXT(3)="NTP released Rad/Nuc Med Report: "_$P(RARPT(0),U)_"."
"RTN","RARPTUT",210,0)
 S RATXT(4)="The REPORT STATUS of this report is: "_$S(RARPTSTS'="":RARPTSTS,1:"N/A")
"RTN","RARPTUT",211,0)
 D MM(74,.RATXT) K RARPTSTS,RATXT,RAX
"RTN","RARPTUT",212,0)
 ;------------------------------------------------------------------------
"RTN","RARPTUT",213,0)
 ;
"RTN","RARPTUT",214,0)
 D CLEAN^DILF K RAIEN QUIT  ;end of main body...
"RTN","RARPTUT",215,0)
 ;
"RTN","RARPTUT",216,0)
 ;>>> subroutines follow <<<
"RTN","RARPTUT",217,0)
 ;
"RTN","RARPTUT",218,0)
RA742(RARPT) ;delete a report (without images) from the REPORT BATCHES (#74.2)
"RTN","RARPTUT",219,0)
 ;REPORTS sub-file 
"RTN","RARPTUT",220,0)
 ;Input: RARPT = IEN of the RAD/NUC MED REPORT record
"RTN","RARPTUT",221,0)
 ;;>>> Note: RAIEN742 is the IEN string at the 74.2 level. <<<
"RTN","RARPTUT",222,0)
 I ($D(^RABTCH(74.2,"D",RARPT))\10) D
"RTN","RARPTUT",223,0)
 .K DA,RA,RAFDA,RAIEN742,RAX N RAY1,RAY2 S RAY1=0,RA=74.2
"RTN","RARPTUT",224,0)
 .F  S RAY1=$O(^RABTCH(74.2,"D",RARPT,RAY1)) Q:RAY1'>0  D
"RTN","RARPTUT",225,0)
 ..S RAY2=0 F  S RAY2=$O(^RABTCH(74.2,"D",RARPT,RAY1,RAY2)) Q:RAY2'>0  D
"RTN","RARPTUT",226,0)
 ...S DA=RAY2,DA(1)=RAY1 S RAIEN742=$$IENS^DILF(.DA) K DA
"RTN","RARPTUT",227,0)
 ...S RAERR=$$LOCKFM^RALOCK(74.21,RAIEN742,,RATIMOUT) ;(+3)
"RTN","RARPTUT",228,0)
 ...S RAERR=$$LOCKERR^RAERR(RAERR,"Report Batches File #74.2")
"RTN","RARPTUT",229,0)
 ...;
"RTN","RARPTUT",230,0)
 ...;RAERR = -15^The Rad/Nuc Med Reports file is locked by other user/task. Please try later.
"RTN","RARPTUT",231,0)
 ...;        ^LOCKERR+1~RAERR^W
"RTN","RARPTUT",232,0)
 ...I RAERR D  QUIT
"RTN","RARPTUT",233,0)
 ....N RATXT S RATXT(1)=$P($G(RAERR),U,2),RATXT(2)="IEN: "_$G(RARPT,-1)
"RTN","RARPTUT",234,0)
 ....S RATXT(3)="Calling Routine: "_$P($G(RAERR),U,3)
"RTN","RARPTUT",235,0)
 ....D MM(RA,.RATXT)
"RTN","RARPTUT",236,0)
 ....Q
"RTN","RARPTUT",237,0)
 ...;
"RTN","RARPTUT",238,0)
 ...S RAFDA(74.21,RAIEN742,.01)="@"
"RTN","RARPTUT",239,0)
 ...D FILE^DIE("","RAFDA") K RAFDA
"RTN","RARPTUT",240,0)
 ...;
"RTN","RARPTUT",241,0)
 ...I $D(DIERR)#2 D
"RTN","RARPTUT",242,0)
 ....;RAERR="-9^FileMan DBS call error(s); File #74.21; 
"RTN","RARPTUT",243,0)
 ....;IENS: "1,113,"^DBS+14~RAERR^E"
"RTN","RARPTUT",244,0)
 ....S RAERR=$$DBS^RAERR("",-9,74.21,RAIEN742)
"RTN","RARPTUT",245,0)
 ....N RATXT S RATXT(1)=$P($G(RAERR),U,2)
"RTN","RARPTUT",246,0)
 ....S RATXT(2)="Calling Routine: "_$P($G(RAERR),U,3)
"RTN","RARPTUT",247,0)
 ....D MM(RA,.RATXT)
"RTN","RARPTUT",248,0)
 ....Q
"RTN","RARPTUT",249,0)
 ...D UNLOCKFM^RALOCK(74.21,RAIEN742) ;(-3)
"RTN","RARPTUT",250,0)
 ...D CLEAN^DILF K RA,RAIEN742,RAX
"RTN","RARPTUT",251,0)
 ...Q
"RTN","RARPTUT",252,0)
 ..Q
"RTN","RARPTUT",253,0)
 .Q
"RTN","RARPTUT",254,0)
 Q
"RTN","RARPTUT",255,0)
 ;
"RTN","RARPTUT",256,0)
ACTLOG() ;update the Activity Log (#74.01) whenever a report is
"RTN","RARPTUT",257,0)
 ;has a REPORT STATUS value of DELETED. Remember that printsets
"RTN","RARPTUT",258,0)
 ;share primary/secondary staff, resident & Dx Codes across all
"RTN","RARPTUT",259,0)
 ;studies.
"RTN","RARPTUT",260,0)
 ;
"RTN","RARPTUT",261,0)
 ;Given: RADFN, RADTI, RACNI, RARPT & RAIMAGE (indicates if DELETED)
"RTN","RARPTUT",262,0)
 ;Note: the report record remains locked.
"RTN","RARPTUT",263,0)
 ;>>> Note: RAIENS74 is the IEN string at the 74.01 level. <<<
"RTN","RARPTUT",264,0)
 ;>>> RAIEN "finds" the next available IEN in the Activity Log sub-file <<<
"RTN","RARPTUT",265,0)
 N RAERR,RAFDA,RAIEN,RAIENS74,RAUSER,RAY3
"RTN","RARPTUT",266,0)
 S RAIEN=$O(^RARPT(RARPT,"L",$C(32)),-1),RAIEN=RAIEN+1
"RTN","RARPTUT",267,0)
 S RAUSER=$$FIND1^DIC(200,,"X","RADIOLOGY,OUTSIDE SERVICE")
"RTN","RARPTUT",268,0)
 S RAY3=$$GETEXM(),RAIENS74="+"_RAIEN_","_RARPT_","
"RTN","RARPTUT",269,0)
 S RAFDA(74.01,RAIENS74,.01)=$$NOW^XLFDT() ;to the second
"RTN","RARPTUT",270,0)
 S RAFDA(74.01,RAIENS74,2)="Q" ;QUIT released back to local VAMC
"RTN","RARPTUT",271,0)
 S RAFDA(74.01,RAIENS74,3)=$S(RAUSER>0:RAUSER,1:.5) ;a tipoff on a NTP action
"RTN","RARPTUT",272,0)
 S RAFDA(74.01,RAIENS74,4)="R" ;must be "R" (Released/not Verified)
"RTN","RARPTUT",273,0)
 ;
"RTN","RARPTUT",274,0)
 ;if there are no images linked to this report file primary & secondary
"RTN","RARPTUT",275,0)
 ;Dx Code, resident, & staff into the Activity Log
"RTN","RARPTUT",276,0)
 I RAIMAGES=0 D
"RTN","RARPTUT",277,0)
 .S:$P(RAY3,U,2) RAFDA(74.01,RAIENS74,5)=$P(RAY3,U,2) ;dx
"RTN","RARPTUT",278,0)
 .S:$P(RAY3,U,3) RAFDA(74.01,RAIENS74,7)=$P(RAY3,U,3) ;stf
"RTN","RARPTUT",279,0)
 .S:$P(RAY3,U) RAFDA(74.01,RAIENS74,9)=$P(RAY3,U) ;res
"RTN","RARPTUT",280,0)
 .Q
"RTN","RARPTUT",281,0)
 ;
"RTN","RARPTUT",282,0)
 D UPDATE^DIE("","RAFDA","RAIEN")
"RTN","RARPTUT",283,0)
 ;if successful RAIEN(RAIEN) is the new record # for 74.01 sub-file
"RTN","RARPTUT",284,0)
 I $D(DIERR)#2 D
"RTN","RARPTUT",285,0)
 .S RAERR=$$DBS^RAERR("",-9,74.01,RAIENS74)
"RTN","RARPTUT",286,0)
 .N RATXT S RATXT(1)=$P($G(RAERR),U,2)
"RTN","RARPTUT",287,0)
 .S RATXT(2)="Calling Routine: "_$P($G(RAERR),U,3)
"RTN","RARPTUT",288,0)
 .D MM(RA,.RATXT)
"RTN","RARPTUT",289,0)
 .Q
"RTN","RARPTUT",290,0)
 Q $S(($D(RAERR)#2)<0:RAERR,1:RAIEN(RAIEN))
"RTN","RARPTUT",291,0)
 ;
"RTN","RARPTUT",292,0)
ACTLOGX(RAIEN) ;update the lower level sub-files...
"RTN","RARPTUT",293,0)
 ;given: RARPT
"RTN","RARPTUT",294,0)
 ;Input: RAIEN is the new record number created @ the 74.01 level
"RTN","RARPTUT",295,0)
 ;>>> Note: RAIENS74 is the IEN string at the 74.01 level. <<< 
"RTN","RARPTUT",296,0)
 N RA,RAERR,RAFDA,RAIENS74
"RTN","RARPTUT",297,0)
 S RAIENS74=","_RAIEN_","_RARPT_",",RA=74.01
"RTN","RARPTUT",298,0)
 ;build the RAFDA array for Dx Codes, sec. staff & sec. resident
"RTN","RARPTUT",299,0)
 D SECDX,SECSTF,SECRES
"RTN","RARPTUT",300,0)
 ;if there's data to be filed, file it. Note: the input transforms
"RTN","RARPTUT",301,0)
 ;are "clean" so I stuff the internal value (equivalent of a four slash) 
"RTN","RARPTUT",302,0)
 D:($D(RAFDA)\10) UPDATE^DIE("","RAFDA",,)
"RTN","RARPTUT",303,0)
 I $D(DIERR)#2 D
"RTN","RARPTUT",304,0)
 .S RAERR=$$DBS^RAERR("",-9,74.01,RAIENS74)
"RTN","RARPTUT",305,0)
 .N RATXT S RATXT(1)=$P($G(RAERR),U,2)
"RTN","RARPTUT",306,0)
 .S RATXT(2)="Calling Routine: "_$P($G(RAERR),U,3)
"RTN","RARPTUT",307,0)
 .D MM(RA,.RATXT)
"RTN","RARPTUT",308,0)
 .Q
"RTN","RARPTUT",309,0)
 Q $S(($D(RAERR)#2)<0:RAERR,1:0)
"RTN","RARPTUT",310,0)
 ;
"RTN","RARPTUT",311,0)
MM(RAY,RAX) ;call MailMan; let the members of the mail group know
"RTN","RARPTUT",312,0)
 ;if a problem exists.
"RTN","RARPTUT",313,0)
 ;Input: RAY = file #
"RTN","RARPTUT",314,0)
 ;       RAX = information passed to RAD HL7 MESSAGES members 
"RTN","RARPTUT",315,0)
 ;I $$GOTLOCAL^XMXAPIG("RAD HL7 MESSAGES") D
"RTN","RARPTUT",316,0)
 N DIERR,DUZ,RARY,X,XMDUN,XMDUZ,XMMG,XMZ S DUZ=.5,XMDUZ="POSTMASTER"
"RTN","RARPTUT",317,0)
 S XMSUB="NTP releases a case back to the local facility: #"_RAY
"RTN","RARPTUT",318,0)
 S XMTEXT="RAX(",XMY("G.RAD HL7 MESSAGES")="",XMY("POSTMASTER")=""
"RTN","RARPTUT",319,0)
 D ^XMD
"RTN","RARPTUT",320,0)
 Q
"RTN","RARPTUT",321,0)
 ;
"RTN","RARPTUT",322,0)
GETEXM() ;return primary Resident, primary Dx Code & primary Staff data (if any) #70.03
"RTN","RARPTUT",323,0)
 ;given: RADFN, RADTI & RACNI
"RTN","RARPTUT",324,0)
 ;return: primary Resident (piece 12)^Dx Code (piece 13)^primary Staff (piece 15)
"RTN","RARPTUT",325,0)
 N X S X=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RARPTUT",326,0)
 Q ($P(X,U,12)_U_$P(X,U,13)_U_$P(X,U,15))
"RTN","RARPTUT",327,0)
 ;
"RTN","RARPTUT",328,0)
SECRES ;return secondary Resident data (if any) #70.09 place in #74.19
"RTN","RARPTUT",329,0)
 ;given: RADFN, RADTI & RACNI & RAIENS74 (global scope; defined in ACTLOGX)
"RTN","RARPTUT",330,0)
 N RAIEN,RAX,RAY,RAZ S RAX=500,RAY=0
"RTN","RARPTUT",331,0)
 F  S RAY=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",RAY)) Q:'RAY  D
"RTN","RARPTUT",332,0)
 .S RAZ=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",RAY,0))
"RTN","RARPTUT",333,0)
 .S RAIEN="+"_RAX,RAFDA(74.19,RAIEN_RAIENS74,.01)=$P(RAZ,U)
"RTN","RARPTUT",334,0)
 .S RAX=RAX+1
"RTN","RARPTUT",335,0)
 .Q
"RTN","RARPTUT",336,0)
 Q
"RTN","RARPTUT",337,0)
 ;
"RTN","RARPTUT",338,0)
SECDX ;return secondary Dx Code data (if any) #70.14 place in #74.16
"RTN","RARPTUT",339,0)
 ;given: RADFN, RADTI & RACNI & RAIENS74 (global scope; defined in ACTLOGX)
"RTN","RARPTUT",340,0)
 N RAIEN,RAX,RAY,RAZ S RAX=100,RAY=0
"RTN","RARPTUT",341,0)
 F  S RAY=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX",RAY)) Q:'RAY  D
"RTN","RARPTUT",342,0)
 .S RAZ=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"DX",RAY,0))
"RTN","RARPTUT",343,0)
 .S RAIEN="+"_RAX,RAFDA(74.16,RAIEN_RAIENS74,.01)=$P(RAZ,U)
"RTN","RARPTUT",344,0)
 .S RAX=RAX+1
"RTN","RARPTUT",345,0)
 .Q
"RTN","RARPTUT",346,0)
 Q
"RTN","RARPTUT",347,0)
 ;
"RTN","RARPTUT",348,0)
SECSTF ;return secondary Staff data (if any) #70.11 place in #74.18
"RTN","RARPTUT",349,0)
 ;given: RADFN, RADTI & RACNI & RAIENS74 (global scope; defined in ACTLOGX)
"RTN","RARPTUT",350,0)
 N RAIEN,RAX,RAY,RAZ S RAX=300,RAY=0
"RTN","RARPTUT",351,0)
 F  S RAY=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",RAY)) Q:'RAY  D
"RTN","RARPTUT",352,0)
 .S RAZ=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",RAY,0))
"RTN","RARPTUT",353,0)
 .S RAIEN="+"_RAX,RAFDA(74.18,RAIEN_RAIENS74,.01)=$P(RAZ,U)
"RTN","RARPTUT",354,0)
 .S RAX=RAX+1
"RTN","RARPTUT",355,0)
 .Q
"RTN","RARPTUT",356,0)
 Q
"RTN","RARPTUT",357,0)
 ;
"RTN","RARPTUT",358,0)
EN ;entry point called (from RAHLO) to trigger the logic that updates the
"RTN","RARPTUT",359,0)
 ;REPORT STATUS field of a report w/o images to 'deleted'. If the report
"RTN","RARPTUT",360,0)
 ;does associate with images the report is to be treated as an imaging
"RTN","RARPTUT",361,0)
 ;stub report.
"RTN","RARPTUT",362,0)
 ;
"RTN","RARPTUT",363,0)
 Q:RARPT'>0
"RTN","RARPTUT",364,0)
 D REL^RARPTUT(RARPT,.RAERR)
"RTN","RARPTUT",365,0)
 Q:$G(RAERR)'=0
"RTN","RARPTUT",366,0)
 ;
"RTN","RARPTUT",367,0)
 ;RAERR will be defined so if RAERR=0 proceed to update the
"RTN","RARPTUT",368,0)
 ;status of the exam. If RAERR'=0 do not update the status of
"RTN","RARPTUT",369,0)
 ;the exam.
"RTN","RARPTUT",370,0)
 ;
"RTN","RARPTUT",371,0)
 ;Update the exam status. RAMDV (set in RAHLO) is a string that
"RTN","RARPTUT",372,0)
 ;identifies division specific attributes. 11/NORPT^RASTREQ
"RTN","RARPTUT",373,0)
 ;determine whether a report exists (an imaging stub is not
"RTN","RARPTUT",374,0)
 ;a report).
"RTN","RARPTUT",375,0)
 ;
"RTN","RARPTUT",376,0)
 ;Note: exam records are locked within UP1^RAUTL1
"RTN","RARPTUT",377,0)
 I $D(RAMDV)#2,(RAMDV'="") D UP1^RAUTL1
"RTN","RARPTUT",378,0)
 ;
"RTN","RARPTUT",379,0)
 ;Note - the fact of the matter is this: upon returning to
"RTN","RARPTUT",380,0)
 ;RAHLTCPB (which is done after the next 'Q'uit), GENACK is
"RTN","RARPTUT",381,0)
 ;called only if an error has occurred. Because of this I
"RTN","RARPTUT",382,0)
 ;call GENACK^RAHLTCPB below because there is no error.
"RTN","RARPTUT",383,0)
 D GENACK^RAHLTCPB ; generate 'ACK' message
"RTN","RARPTUT",384,0)
 Q
"RTN","RARPTUT",385,0)
 ;
"UP",74,74.01,-1)
74^L
"UP",74,74.01,0)
74.01
"VER")
8.0^22.0
"^DD",74,74.01,2,0)
TYPE OF ACTION^RS^I:INITIAL REPORT TRANSCRIPTION;E:REPORT EDIT;V:VERIFIED;U:REPORT UNVERIFIED;C:IMAGES COLLECTED;P:PRE-VERIFIED;F:ELECTRONICALLY FILED;X:DELETED REPORT;R:RESTORED REPORT;Q:QUIT;^0;2^Q
"^DD",74,74.01,2,.1)
TYPE OF ACTION ON REPORT RECORD
"^DD",74,74.01,2,3)
This is the action type for this report.
"^DD",74,74.01,2,10)
SYSTEM GENERATED
"^DD",74,74.01,2,21,0)
^^5^5^3100521^
"^DD",74,74.01,2,21,1,0)
This field contains the type of action that was taken on this report
"^DD",74,74.01,2,21,2,0)
record.  Valid choices are:  'I' for Initial Report Transcription, 'E' for
"^DD",74,74.01,2,21,3,0)
Report Edit, 'V' for Verified, 'U' for Report Unverified, 'C' for
"^DD",74,74.01,2,21,4,0)
Digitized Images Collected, 'P' for Pre-Verified, 'F' for Electronically 
"^DD",74,74.01,2,21,5,0)
Filed, 'X' for Deleted Report, 'R' for Restored Report & 'Q' for Quit.
"^DD",74,74.01,2,23,0)
^^6^6^3100521^
"^DD",74,74.01,2,23,1,0)
'Quit' is an action specific to the National Teleradiology Project 
"^DD",74,74.01,2,23,2,0)
introduced with RA*5.0*106.
"^DD",74,74.01,2,23,3,0)
 
"^DD",74,74.01,2,23,4,0)
The meaning of the action is that a study, initially to be interpreted by
"^DD",74,74.01,2,23,5,0)
NTP, is released by NTP back to the local VA Medical Center for
"^DD",74,74.01,2,23,6,0)
interpretation.
"^DD",74,74.01,2,"DT")
3100521
"BLD",8060,6)
^95
**END**
**END**
