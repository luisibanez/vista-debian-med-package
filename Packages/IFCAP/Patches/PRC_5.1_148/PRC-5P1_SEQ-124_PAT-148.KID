EMERGENCY Released PRC*5.1*148 SEQ #124
Extracted from mail message
**KIDS**:PRC*5.1*148^

**INSTALL NAME**
PRC*5.1*148
"BLD",6572,0)
PRC*5.1*148^IFCAP^0^3101109^y
"BLD",6572,1,0)
^^5^5^3100924^
"BLD",6572,1,1,0)
Enhancement for 1358 miscellaneous obligations:
"BLD",6572,1,2,0)
  o enforce segregation of duties
"BLD",6572,1,3,0)
  o enter additional data on a 1358 request
"BLD",6572,1,4,0)
  o require mandatory fields to be populated
"BLD",6572,1,5,0)
  o include the new authority/sub-authority codes on the SO code sheet 
"BLD",6572,4,0)
^9.64PA^410.9^2
"BLD",6572,4,410,0)
410
"BLD",6572,4,410,2,0)
^9.641^410^1
"BLD",6572,4,410,2,410,0)
CONTROL POINT ACTIVITY  (File-top level)
"BLD",6572,4,410,2,410,1,0)
^9.6411^6.5^4
"BLD",6572,4,410,2,410,1,6,0)
SERVICE START DATE
"BLD",6572,4,410,2,410,1,6.5,0)
SERVICE END DATE
"BLD",6572,4,410,2,410,1,19,0)
AUTHORITY
"BLD",6572,4,410,2,410,1,19.1,0)
SUB AUTHORITY
"BLD",6572,4,410,222)
y^n^p^^^^n^^n
"BLD",6572,4,410,224)

"BLD",6572,4,410.9,0)
410.9
"BLD",6572,4,410.9,222)
y^y^f^^n^^y^o^n
"BLD",6572,4,"APDD",410,410)

"BLD",6572,4,"APDD",410,410,6)

"BLD",6572,4,"APDD",410,410,6.5)

"BLD",6572,4,"APDD",410,410,19)

"BLD",6572,4,"APDD",410,410,19.1)

"BLD",6572,4,"B",410,410)

"BLD",6572,4,"B",410.9,410.9)

"BLD",6572,6.3)
5
"BLD",6572,"ABPKG")
n
"BLD",6572,"KRN",0)
^9.67PA^779.2^20
"BLD",6572,"KRN",.4,0)
.4
"BLD",6572,"KRN",.4,"NM",0)
^9.68A^3^3
"BLD",6572,"KRN",.4,"NM",1,0)
PRCH OBLIGATED 1358 LIST    FILE #442^442^0
"BLD",6572,"KRN",.4,"NM",2,0)
PRCH PO REGISTER    FILE #442^442^0
"BLD",6572,"KRN",.4,"NM",3,0)
PRC 1358 MISSING FIELDS    FILE #410^410^1^
"BLD",6572,"KRN",.4,"NM","B","PRC 1358 MISSING FIELDS    FILE #410",3)

"BLD",6572,"KRN",.4,"NM","B","PRCH OBLIGATED 1358 LIST    FILE #442",1)

"BLD",6572,"KRN",.4,"NM","B","PRCH PO REGISTER    FILE #442",2)

"BLD",6572,"KRN",.401,0)
.401
"BLD",6572,"KRN",.401,"NM",0)
^9.68A^1^1
"BLD",6572,"KRN",.401,"NM",1,0)
PRC MISSING 1358 FIELDS    FILE #410^410^1^
"BLD",6572,"KRN",.401,"NM","B","PRC MISSING 1358 FIELDS    FILE #410",1)

"BLD",6572,"KRN",.402,0)
.402
"BLD",6572,"KRN",.402,"NM",0)
^9.68A^5^3
"BLD",6572,"KRN",.402,"NM",1,0)
PRCE 1358 ADJUSTMENT    FILE #410^410^0
"BLD",6572,"KRN",.402,"NM",3,0)
PRCE NEW 1358    FILE #410^410^0
"BLD",6572,"KRN",.402,"NM",5,0)
PRCSENA 1358    FILE #410^410^0
"BLD",6572,"KRN",.402,"NM","B","PRCE 1358 ADJUSTMENT    FILE #410",1)

"BLD",6572,"KRN",.402,"NM","B","PRCE NEW 1358    FILE #410",3)

"BLD",6572,"KRN",.402,"NM","B","PRCSENA 1358    FILE #410",5)

"BLD",6572,"KRN",.403,0)
.403
"BLD",6572,"KRN",.5,0)
.5
"BLD",6572,"KRN",.84,0)
.84
"BLD",6572,"KRN",3.6,0)
3.6
"BLD",6572,"KRN",3.8,0)
3.8
"BLD",6572,"KRN",9.2,0)
9.2
"BLD",6572,"KRN",9.8,0)
9.8
"BLD",6572,"KRN",9.8,"NM",0)
^9.68A^19^17
"BLD",6572,"KRN",9.8,"NM",1,0)
PRCEN^^0^B46938754
"BLD",6572,"KRN",9.8,"NM",2,0)
PRCSAPP1^^0^B12057361
"BLD",6572,"KRN",9.8,"NM",5,0)
PRCEADJ^^0^B34959566
"BLD",6572,"KRN",9.8,"NM",6,0)
PRCSECP^^0^B28930970
"BLD",6572,"KRN",9.8,"NM",7,0)
PRCSUT2^^0^B51951982
"BLD",6572,"KRN",9.8,"NM",8,0)
PRCSECP1^^0^B15793904
"BLD",6572,"KRN",9.8,"NM",9,0)
PRCE58P0^^0^B17096977
"BLD",6572,"KRN",9.8,"NM",10,0)
PRCS58OB^^0^B21961903
"BLD",6572,"KRN",9.8,"NM",11,0)
PRCE58P2^^0^B16930657
"BLD",6572,"KRN",9.8,"NM",12,0)
PRCEOB1^^0^B5824737
"BLD",6572,"KRN",9.8,"NM",13,0)
PRCEFIS5^^0^B14226098
"BLD",6572,"KRN",9.8,"NM",14,0)
PRCFFU2^^0^B10580880
"BLD",6572,"KRN",9.8,"NM",15,0)
PRC1358C^^0^B3640057
"BLD",6572,"KRN",9.8,"NM",16,0)
PRCSAPP2^^0^B21099667
"BLD",6572,"KRN",9.8,"NM",17,0)
PRCESOE^^0^B45274590
"BLD",6572,"KRN",9.8,"NM",18,0)
PRCESOM^^0^B59523571
"BLD",6572,"KRN",9.8,"NM",19,0)
PRCSEM^^0^B7333642
"BLD",6572,"KRN",9.8,"NM","B","PRC1358C",15)

"BLD",6572,"KRN",9.8,"NM","B","PRCE58P0",9)

"BLD",6572,"KRN",9.8,"NM","B","PRCE58P2",11)

"BLD",6572,"KRN",9.8,"NM","B","PRCEADJ",5)

"BLD",6572,"KRN",9.8,"NM","B","PRCEFIS5",13)

"BLD",6572,"KRN",9.8,"NM","B","PRCEN",1)

"BLD",6572,"KRN",9.8,"NM","B","PRCEOB1",12)

"BLD",6572,"KRN",9.8,"NM","B","PRCESOE",17)

"BLD",6572,"KRN",9.8,"NM","B","PRCESOM",18)

"BLD",6572,"KRN",9.8,"NM","B","PRCFFU2",14)

"BLD",6572,"KRN",9.8,"NM","B","PRCS58OB",10)

"BLD",6572,"KRN",9.8,"NM","B","PRCSAPP1",2)

"BLD",6572,"KRN",9.8,"NM","B","PRCSAPP2",16)

"BLD",6572,"KRN",9.8,"NM","B","PRCSECP",6)

"BLD",6572,"KRN",9.8,"NM","B","PRCSECP1",8)

"BLD",6572,"KRN",9.8,"NM","B","PRCSEM",19)

"BLD",6572,"KRN",9.8,"NM","B","PRCSUT2",7)

"BLD",6572,"KRN",19,0)
19
"BLD",6572,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",6572,"KRN",19,"NM",1,0)
PRC 1358 MISSING FIELDS^^1^
"BLD",6572,"KRN",19,"NM",2,0)
PRCSENOD^^1^
"BLD",6572,"KRN",19,"NM","B","PRC 1358 MISSING FIELDS",1)

"BLD",6572,"KRN",19,"NM","B","PRCSENOD",2)

"BLD",6572,"KRN",19.1,0)
19.1
"BLD",6572,"KRN",101,0)
101
"BLD",6572,"KRN",409.61,0)
409.61
"BLD",6572,"KRN",771,0)
771
"BLD",6572,"KRN",779.2,0)
779.2
"BLD",6572,"KRN",870,0)
870
"BLD",6572,"KRN",8989.51,0)
8989.51
"BLD",6572,"KRN",8989.52,0)
8989.52
"BLD",6572,"KRN",8994,0)
8994
"BLD",6572,"KRN","B",.4,.4)

"BLD",6572,"KRN","B",.401,.401)

"BLD",6572,"KRN","B",.402,.402)

"BLD",6572,"KRN","B",.403,.403)

"BLD",6572,"KRN","B",.5,.5)

"BLD",6572,"KRN","B",.84,.84)

"BLD",6572,"KRN","B",3.6,3.6)

"BLD",6572,"KRN","B",3.8,3.8)

"BLD",6572,"KRN","B",9.2,9.2)

"BLD",6572,"KRN","B",9.8,9.8)

"BLD",6572,"KRN","B",19,19)

"BLD",6572,"KRN","B",19.1,19.1)

"BLD",6572,"KRN","B",101,101)

"BLD",6572,"KRN","B",409.61,409.61)

"BLD",6572,"KRN","B",771,771)

"BLD",6572,"KRN","B",779.2,779.2)

"BLD",6572,"KRN","B",870,870)

"BLD",6572,"KRN","B",8989.51,8989.51)

"BLD",6572,"KRN","B",8989.52,8989.52)

"BLD",6572,"KRN","B",8994,8994)

"BLD",6572,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",6572,"QUES",0)
^9.62^^
"BLD",6572,"REQB",0)
^9.611^4^4
"BLD",6572,"REQB",1,0)
PRC*5.1*140^2
"BLD",6572,"REQB",2,0)
PRC*5.1*135^2
"BLD",6572,"REQB",3,0)
PRC*5.1*81^2
"BLD",6572,"REQB",4,0)
PRC*5.1*23^2
"BLD",6572,"REQB","B","PRC*5.1*135",2)

"BLD",6572,"REQB","B","PRC*5.1*140",1)

"BLD",6572,"REQB","B","PRC*5.1*23",4)

"BLD",6572,"REQB","B","PRC*5.1*81",3)

"DATA",410.9,1,0)
1^NURSING HOME/ADULT DAYCARE
"DATA",410.9,2,0)
2^FEE BASIS
"DATA",410.9,3,0)
3^STANDARDIZED OBLIGATIONS
"DATA",410.9,4,0)
4^LIMITED OPEN TRAVEL AUTHORITY^^^0^0^4
"DATA",410.9,5,0)
5^RESEARCH STUDIES^^^0^0^5
"DATA",410.9,6,0)
6^INTER-LIBRARY LOAN PROGRAM^^^0^0^6
"DATA",410.9,7,0)
7^AFFILIATED AGREEMENTS FOR INTERNS/RESIDENTS^^^0^0^7
"DATA",410.9,8,0)
8^TORT CLAIMS/EEO SETTLEMENTS/OIG CONFIDENTIAL SERVICES^^^0^0^8
"DATA",410.9,9,0)
9^VOLUNTEER MEAL TICKETS^^^0^0^9
"DATA",410.9,10,0)
10^INCENTIVE THERAPY/COMPENSATED WORK THERAPY^^^0^0^10
"DATA",410.9,11,0)
11^BENEFICIARY TRAVEL^^^0^0^11
"DATA",410.9,12,0)
12^HOME IMPROVEMENT STRUCTURAL ALTERATIONS^^^1^0^12
"DATA",410.9,13,0)
13^OUTER BURIAL RECEPTACLES^^^0^0^13
"DATA",410.9,14,0)
14^VBA LEASE AGREEMENT OVERTIME CHARGES^^^1^0^14
"DATA",410.9,15,0)
15^HOME OXYGEN BILLS^^^0^0^15
"DATA",410.9,16,0)
16^PROSTHETICS^^^1^0^16
"DATA",410.9,17,0)
17^PHARMACY AND SUBSISTENCE PRIME VENDOR^^^0^0^17
"DATA",410.9,18,0)
18^REGULATED UTILITIES^^^1^0^18
"DATA",410.9,19,0)
19^TUITION REIMBURSEMENT TO VA EMPLOYEES^^^1^0^19
"DATA",410.9,20,0)
20^NON-PROCUREMENT OBLIGATIONS
"DATA",410.9,21,0)
21^HEALTH ADMIN CARE PROGRAMS
"DATA",410.9,22,0)
22^SPECIAL ADAPTIVE HOUSING INSPECTIONS^^^0^0^22
"DATA",410.9,23,0)
23^STATE APPROVING AGENCY^^^0^0^23
"DATA",410.9,101,0)
A^NURSING HOME^1^^0^0^1A
"DATA",410.9,102,0)
B^ADULT DAY CARE^1^^0^0^1B
"DATA",410.9,103,0)
A^FEE MEDICAL/DENTAL (PRE-AUTHORIZED)^2^^0^0^2A
"DATA",410.9,104,0)
B^FEE MEDICAL/DENTAL (NOT PRE-AUTHORIZED)^2^^0^0^2B
"DATA",410.9,105,0)
C^HOMEMAKER/HOME HEALTH AID^2^^0^0^2C
"DATA",410.9,106,0)
D^NON-VA HOSPITALIZATION (PRE-AUTHORIZED)^2^^0^0^2D
"DATA",410.9,107,0)
E^NON-VA HOSPITALIZATION (NOT PRE-AUTHORIZED)^2^^0^0^2E
"DATA",410.9,108,0)
F^NON-CONTRACT EMERGENCY TRAVEL^2^^0^0^2F
"DATA",410.9,109,0)
A^FEDERAL TELECOMMUNICATIONS SERVICES^3^^1^1^3A
"DATA",410.9,110,0)
B^COLLEGE OF AMERICAN PATHOLOGY^3^^1^1^3B
"DATA",410.9,111,0)
C^CONVENIENCE CHECK FEES^3^^0^0^3C
"DATA",410.9,112,0)
D^DENVER ACQUISITION AND LOGISTICS CENTER SERVICES AND SUPPLIES^3^^1^0^3D
"DATA",410.9,113,0)
E^EMERGENCY CARE BENEFICIARY TRAVEL, INCLUDING MILEAGE^3^^0^0^3E
"DATA",410.9,114,0)
F^FEE BASIS PURCHASE CARD^3^^0^0^3F
"DATA",410.9,115,0)
G^FEDERAL EMPLOYEES COMPENSATION PROGRAM^3^^1^0^3G
"DATA",410.9,116,0)
H^SHPS^3^^1^0^3H
"DATA",410.9,117,0)
I^STANDARD LEVEL USER CHARGES/GSA^3^^1^0^3I
"DATA",410.9,118,0)
J^TRANSIT BENEFITS^3^^1^0^3J
"DATA",410.9,119,0)
K^FRANCHISE FUND: SECURITY AND INVESTIGATIONS CENTER^3^^1^0^3K
"DATA",410.9,120,0)
L^FRANCHISE FUND: LAW ENFORCEMENT TRAINING CENTER^3^^1^0^3L
"DATA",410.9,121,0)
M^FRANCHISE FUND: FINANCIAL SERVICES CENTER^3^^1^0^3M
"DATA",410.9,122,0)
N^FRANCHISE FUND: DEBT MANAGEMENT CENTER^3^^1^0^3N
"DATA",410.9,123,0)
O^FRANCHISE FUND: CORPORATE DATA CENTER OPERATIONS^3^^1^0^3O
"DATA",410.9,124,0)
P^FRANCHISE FUND: RECORDS CENTER AND VAULT^3^^1^0^3P
"DATA",410.9,125,0)
A^ONE VA PLUS FUND^20^^1^0^20A
"DATA",410.9,126,0)
B^COMPENSATED WORK THERAPY PROGRAM^20^^0^0^20B
"DATA",410.9,127,0)
C^INTERNAL VA PROGRAMS AND AGREEMENTS^20^^1^0^20C
"DATA",410.9,128,0)
D^VA HOMELESS PROVIDERS GRANT AND PER DIEM PROGRAM^20^^1^0^20D
"DATA",410.9,129,0)
E^CEMETERY GRANTS AND STATE HOME PROGRAM^20^^1^0^20E
"DATA",410.9,130,0)
F^GSA ACTIVITIES^20^^1^0^20F
"DATA",410.9,131,0)
G^GOVERNMENT PRINTING OFFICE^20^^1^0^20G
"DATA",410.9,132,0)
H^INTER-AGENCY SHARING AGREEMENTS (VA/DOD SHARING)^20^^1^0^20H
"DATA",410.9,133,0)
I^INTRA-AGENCY SHARING AGREEMENTS (VHA, VBA, NCA, OI&T)^20^^1^0^20I
"DATA",410.9,134,0)
J^INTERGOVERNMENTAL PERSONNEL AGREEMENTS AND SERVICES, INCLUDING CASUS^20^^1^0^20J
"DATA",410.9,135,0)
A^CHAMPVA^21^^0^0^21A
"DATA",410.9,136,0)
B^SPINA BIFIDA HEALTH^21^^0^0^21B
"DATA",410.9,137,0)
C^CHILDREN OF WOMEN VIETNAM VETERANS^21^^0^0^21C
"DATA",410.9,138,0)
D^FOREIGN MEDICAL PROGRAM^21^^0^0^21D
"DATA",410.9,139,0)
E^OTHER HEALTH ADMINISTRATION HEALTH CARE PROGRAMS^21^^0^0^21E
"FIA",410)
CONTROL POINT ACTIVITY
"FIA",410,0)
^PRCS(410,
"FIA",410,0,0)
410I
"FIA",410,0,1)
y^n^p^^^^n^^n
"FIA",410,0,10)

"FIA",410,0,11)

"FIA",410,0,"RLRO")

"FIA",410,0,"VR")
5.1^PRC
"FIA",410,410)
1
"FIA",410,410,6)

"FIA",410,410,6.5)

"FIA",410,410,19)

"FIA",410,410,19.1)

"FIA",410.9)
AUTHORITY OF REQUEST
"FIA",410.9,0)
^PRCS(410.9,
"FIA",410.9,0,0)
410.9I
"FIA",410.9,0,1)
y^y^f^^n^^y^o^n
"FIA",410.9,0,10)

"FIA",410.9,0,11)

"FIA",410.9,0,"RLRO")

"FIA",410.9,0,"VR")
5.1^PRC
"FIA",410.9,410.9)
0
"KRN",.4,2356,-1)
0^2
"KRN",.4,2356,0)
PRCH PO REGISTER^3100920.1113^^442^^^3101007
"KRN",.4,2356,"DXS",1,9.2)
S I(0,0)=$G(D0),DIP(1)=$S($D(^PRC(442,D0,1)):^(1),1:""),D0=$P(DIP(1),U,10) S:'D0!'$D(^VA(200,+D0,0)) D0=-1 S DIP(101)=$S($D(^VA(200,D0,0)):^(0),1:"")
"KRN",.4,2356,"DXS",2,9.2)
S I(100,0)=$G(D0),DIP(101)=$S($D(^PRCS(410,D0,11)):^(11),1:""),D0=$P(DIP(101),U,4) S:'D0!'$D(^PRCS(410.9,+D0,0)) D0=-1 S DIP(201)=$S($D(^PRCS(410.9,D0,0)):^(0),1:"")
"KRN",.4,2356,"DXS",3,9.2)
S I(100,0)=$G(D0),DIP(101)=$S($D(^PRCS(410,D0,11)):^(11),1:""),D0=$P(DIP(101),U,4) S:'D0!'$D(^PRCS(410.9,+D0,0)) D0=-1 S DIP(201)=$S($D(^PRCS(410.9,D0,0)):^(0),1:"")
"KRN",.4,2356,"DXS",4,9.2)
S I(100,0)=$G(D0),DIP(101)=$S($D(^PRCS(410,D0,11)):^(11),1:""),D0=$P(DIP(101),U,5) S:'D0!'$D(^PRCS(410.9,+D0,0)) D0=-1 S DIP(201)=$S($D(^PRCS(410.9,D0,0)):^(0),1:"")
"KRN",.4,2356,"DXS",5,9.2)
S I(100,0)=$G(D0),DIP(101)=$S($D(^PRCS(410,D0,11)):^(11),1:""),D0=$P(DIP(101),U,5) S:'D0!'$D(^PRCS(410.9,+D0,0)) D0=-1 S DIP(201)=$S($D(^PRCS(410.9,D0,0)):^(0),1:"")
"KRN",.4,2356,"F",1)
.01;C1;"PO #";S1~
"KRN",.4,2356,"F",2)
S DIP(1)=$S($D(^PRC(442,D0,1)):^(1),1:"") S X=$P(DIP(1),U,15) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;"DATE";C14;Z;"NUMDATE(P.O. DATE)"~
"KRN",.4,2356,"F",3)
5~
"KRN",.4,2356,"F",4)
S DIP(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(DIP(1),U,10) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;"DEL.DATE";C63;Z;"NUMDATE(DELIVERY DATE)"~
"KRN",.4,2356,"F",5)
35,.01;C78;C78~35,1;"TC"~15;"LI"~
"KRN",.4,2356,"F",6)
S DIP(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(DIP(1),U,3),DIP(2)=$G(X) S X=" ",DIP(3)=$G(X) S X=1,X=$P(DIP(2),DIP(3),X) W X K DIP;"FCP";Z;"$P(FCP," ",1)"~
"KRN",.4,2356,"F",7)
X DXS(1,9.2) S X=$P(DIP(101),U,2) S D0=I(0,0) W X K DIP;"INT";C106;Z;"16:INITIAL"~.6,0;"PARTIAL";C112~
"KRN",.4,2356,"F",8)
.6,S DIP(1)=$S($D(^PRC(442,D0,11,D1,0)):^(0),1:"") S X=$P(DIP(1),U,1) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;"DATE";C121;Z;"NUMDATE(DATE)"~
"KRN",.4,2356,"F",9)
S DIP(1)=$S($D(^PRC(442,D0,7)):^(7),1:"") S X=$P($G(^PRCD(442.3,+$P(DIP(1),U,1),0)),U),DIP(2)=$G(X) S X=1,DIP(3)=$G(X) S X=20,X=$E(DIP(2),DIP(3),X) W X K DIP;"STATUS";Z;"$E(#.5,1,20)"~
"KRN",.4,2356,"F",10)
-410,^PRCS(410,^^S I(0,0)=D0 S DIP(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(DIP(1),U,12),X=X S D(0)=+X;Z;"PRIMARY 2237:"~
"KRN",.4,2356,"F",11)
-410,S DIP(101)=$S($D(^PRCS(410,D0,1)):^(1),1:"") S X=$P(DIP(101),U,6) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;C1;"SERVICE START DATE";L18;Z;"NUMDATE(SERVICE START DATE)"~
"KRN",.4,2356,"F",12)
-410,S DIP(101)=$S($D(^PRCS(410,D0,1)):^(1),1:"") S X=$P(DIP(101),U,7) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;C30;"SERVICE END DATE";L16;Z;"NUMDATE(SERVICE END DATE)"~
"KRN",.4,2356,"F",13)
-410,X DXS(2,9.2) S X=$P(DIP(201),U,1) S D0=I(100,0) W X K DIP;L4;C1;" ";Z;"AUTHORITY:AUTHORITY CODE"~
"KRN",.4,2356,"F",14)
-410,X DXS(3,9.2) S X=$P(DIP(201),U,2) S D0=I(100,0) W X K DIP;L70;"AUTHORITY";C6;Z;"AUTHORITY:AUTHORITY DESCRIPTION"~
"KRN",.4,2356,"F",15)
-410,X DXS(4,9.2) S X=$P(DIP(201),U,1) S D0=I(100,0) W X K DIP;L4;C1;" ";Z;"SUB AUTHORITY:AUTHORITY CODE"~
"KRN",.4,2356,"F",16)
-410,X DXS(5,9.2) S X=$P(DIP(201),U,2) S D0=I(100,0) W X K DIP;L70;"SUB-AUTHORITY";C6;Z;"SUB AUTHORITY:AUTHORITY DESCRIPTION"~"  ";C1~
"KRN",.4,2356,"H")
SUPPLY PURCHASE ORDER REGISTER
"KRN",.4,2675,-1)
0^1
"KRN",.4,2675,0)
PRCH OBLIGATED 1358 LIST^3100917.1337^@^442^^@^3101028
"KRN",.4,2675,"%D",0)
^^2^2^3050218^
"KRN",.4,2675,"%D",1,0)
This new option is used to support a new FPDS report for the Austin 
"KRN",.4,2675,"%D",2,0)
Automation Center (AAC).
"KRN",.4,2675,"DXS",1,9.2)
S I(100,0)=$G(D0),DIP(101)=$S($D(^PRCS(410,D0,11)):^(11),1:""),D0=$P(DIP(101),U,4) S:'D0!'$D(^PRCS(410.9,+D0,0)) D0=-1 S DIP(201)=$S($D(^PRCS(410.9,D0,0)):^(0),1:"")
"KRN",.4,2675,"DXS",2,9.2)
S I(100,0)=$G(D0),DIP(101)=$S($D(^PRCS(410,D0,11)):^(11),1:""),D0=$P(DIP(101),U,4) S:'D0!'$D(^PRCS(410.9,+D0,0)) D0=-1 S DIP(201)=$S($D(^PRCS(410.9,D0,0)):^(0),1:"")
"KRN",.4,2675,"DXS",3,9.2)
S I(100,0)=$G(D0),DIP(101)=$S($D(^PRCS(410,D0,11)):^(11),1:""),D0=$P(DIP(101),U,5) S:'D0!'$D(^PRCS(410.9,+D0,0)) D0=-1 S DIP(201)=$S($D(^PRCS(410.9,D0,0)):^(0),1:"")
"KRN",.4,2675,"DXS",4,9.2)
S I(100,0)=$G(D0),DIP(101)=$S($D(^PRCS(410,D0,11)):^(11),1:""),D0=$P(DIP(101),U,5) S:'D0!'$D(^PRCS(410.9,+D0,0)) D0=-1 S DIP(201)=$S($D(^PRCS(410.9,D0,0)):^(0),1:"")
"KRN",.4,2675,"F",1)
.01;L12~.1;L12~-410,^PRCS(410,^^S I(0,0)=D0 S DIP(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(DIP(1),U,12),X=X S D(0)=+X;Z;".07:"~-410,11;L25~-410,13;L15~
"KRN",.4,2675,"F",2)
-440,^PRC(440,^^S I(0,0)=D0 S DIP(1)=$S($D(^PRC(442,D0,1)):^(1),1:"") S X=$P(DIP(1),U,1),X=X S D(0)=+X;Z;"VENDOR:"~-440,8.3;L5~-440,10,.01;L3~91;L9~
"KRN",.4,2675,"F",3)
-440,^PRC(440,^^S I(0,0)=D0 S DIP(1)=$S($D(^PRC(442,D0,1)):^(1),1:"") S X=$P(DIP(1),U,1),X=X S D(0)=+X;Z;"VENDOR:"~
"KRN",.4,2675,"F",4)
-410,^PRCS(410,^^S I(0,0)=D0 S DIP(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(DIP(1),U,12),X=X S D(0)=+X;Z;".07:"~-410,40;L18~
"KRN",.4,2675,"F",5)
-410,S DIP(101)=$S($D(^PRCS(410,D0,1)):^(1),1:"") S X=$P(DIP(101),U,6) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;C1;"SERVICE START DATE";L18;Z;"NUMDATE(SERVICE START DATE)"~
"KRN",.4,2675,"F",6)
-410,S DIP(101)=$S($D(^PRCS(410,D0,1)):^(1),1:"") S X=$P(DIP(101),U,7) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;C30;"SERVICE END DATE";L16;Z;"NUMDATE(SERVICE END DATE)"~
"KRN",.4,2675,"F",7)
-410,X DXS(1,9.2) S X=$P(DIP(201),U,1) S D0=I(100,0) W X K DIP;L4;C1;" ";Z;"AUTHORITY:AUTHORITY CODE"~
"KRN",.4,2675,"F",8)
-410,X DXS(2,9.2) S X=$P(DIP(201),U,2) S D0=I(100,0) W X K DIP;L70;"AUTHORITY";C6;Z;"AUTHORITY:AUTHORITY DESCRIPTION"~
"KRN",.4,2675,"F",9)
-410,X DXS(3,9.2) S X=$P(DIP(201),U,1) S D0=I(100,0) W X K DIP;L4;C1;" ";Z;"SUB AUTHORITY:AUTHORITY CODE"~
"KRN",.4,2675,"F",10)
-410,X DXS(4,9.2) S X=$P(DIP(201),U,2) S D0=I(100,0) W X K DIP;L70;"SUB-AUTHORITY";C6;Z;"SUB AUTHORITY:AUTHORITY DESCRIPTION"~"  ";C1~
"KRN",.4,2675,"H")
PROCUREMENT & ACCOUNTING TRANSACTIONS LIST (OBLIGATED 1358s)
"KRN",.4,2813,-1)
1^3
"KRN",.4,2813,0)
PRC 1358 MISSING FIELDS    FILE #410
"KRN",.401,2041,-1)
1^1
"KRN",.401,2041,0)
PRC MISSING 1358 FIELDS    FILE #410
"KRN",.402,2589,-1)
0^5
"KRN",.402,2589,0)
PRCSENA 1358^3100913.1011^^410^^^3101013
"KRN",.402,2589,"%D",0)
^^2^2^2930407^^^
"KRN",.402,2589,"%D",1,0)
This input template is for creating an adjustment of a 1358
"KRN",.402,2589,"%D",2,0)
form type request.
"KRN",.402,2589,"DIAB",3,0,410,1)
45;"PURPOSE"
"KRN",.402,2589,"DIAB",15,0,410,0)
26//TODAY
"KRN",.402,2589,"DR",1,410)
1///A;40////^S X=DUZ;49;25;I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),U,12)>1 S Y="@2";15.5;@1;I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),U,12)>0 S Y="@2";17;17.5;@2;D RB^PRCSCK;16;Q;26//^N %I,%H,% D NOW^%DTC;
"KRN",.402,2589,"DR",1,410,1)
I $D(^PRCS(410,DA,0)),$P(^(0),U,4)'=1 S Y=60;S Y=45;45PURPOSE~;I '$D(^PRCS(410,DA,8,1,0)) W $C(7),!,"PURPOSE IS REQUIRED!!!" S Y=45;60;
"KRN",.402,2589,"DR",2,410.04)
.01;1;D RB1^PRCSCK;
"KRN",.402,2638,-1)
0^1
"KRN",.402,2638,0)
PRCE 1358 ADJUSTMENT^3100913.101^^410^^^3101101
"KRN",.402,2638,"%D",0)
^^1^1^2890716^
"KRN",.402,2638,"%D",1,0)
This input template is for creating a 1358 form type adjustment.
"KRN",.402,2638,"DIAB",7,0,410,0)
5//TODAY
"KRN",.402,2638,"DIAB",11,0,410,1)
45;"PURPOSE"
"KRN",.402,2638,"DR",1,410)
1///A;40////^S X=DUZ;S PRCSCOST=0;8;49;Q;5//^N %I,%H,% D NOW^%DTC;I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),"^",12)>1 S Y="@1";15.5;I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),"^",12)>0 S Y="@1";26;@1;25;
"KRN",.402,2638,"DR",1,410,1)
S PRCSCOST=X;17;17.5//^S X=PRCSCOST;S PRCSCOST=PRCSCOST-X;I PRCSCOST W *7,!!,"Adjustment Amount does not equal the Subaccount $ Amount.",!,"Please correct the error." S Y="@1";@3;D RB^PRCSCK;16;@2;S Y=45;45PURPOSE~;
"KRN",.402,2638,"DR",1,410,2)
I '$D(^PRCS(410,DA,8,1,0)) W $C(7),!,"PURPOSE IS REQUIRED!!!" S Y=45;I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),"^",11)="Y" S Y=60;42;60;
"KRN",.402,2638,"DR",2,410.04)
.01;1;D RB1^PRCSCK;
"KRN",.402,2639,-1)
0^3
"KRN",.402,2639,0)
PRCE NEW 1358^3100916.1124^^410^^^3101109
"KRN",.402,2639,"DIAB",3,0,410,6)
VENDOR CONTRACT NUMBER;REQ
"KRN",.402,2639,"DIAB",5,0,410,0)
19;REQ
"KRN",.402,2639,"DIAB",5,0,410,1)
DATE OF REQUEST//TODAY
"KRN",.402,2639,"DIAB",5,0,410,6)
6;REQ
"KRN",.402,2639,"DIAB",7,0,410,6)
6.5;REQ
"KRN",.402,2639,"DIAB",9,0,410,6)
45;"PURPOSE"
"KRN",.402,2639,"DIAB",12,0,410,0)
19.1;REQ
"KRN",.402,2639,"DR",1,410)
1///O;S PRCS1MO=X;40////^S X=DUZ;S:$P(XQY0,U)="PRCEC NEW" Y="@4";19R~;S PRCAUTH=+X;S:$D(^PRCS(410.9,"AC",PRCAUTH,+$P($G(^PRCS(410,D0,11)),U,5))) Y="@3";19.1///@;@3;S:'$D(^PRCS(410.9,"AC",PRCAUTH)) Y="@4";K PRCAUTH;19.1R~;@4;
"KRN",.402,2639,"DR",1,410,1)
S PRCVEN=$G(^PRCS(410,D0,11)),PRCVEN=$G(^PRCS(410.9,+$S($P(PRCVEN,U,5):$P(PRCVEN,U,5),1:$P(PRCVEN,U,4)),0)),PRCONT=$P(PRCVEN,U,6),PRCVEN=$P(PRCVEN,U,5);8;49;Q;5//^N %I,%H,% D NOW^%DTC;21//^S X=$E(DT,4,5)_"/01/"_$E(DT,2,3);@1;20;
"KRN",.402,2639,"DR",1,410,2)
S $P(^PRCS(410,DA,3),U,7)=X;S X=$$GETCCCNT^PRCSECP(PRC("SITE"),PRC("CP")) I (+X=1) S $P(^PRCS(410,DA,3),U,3)=$P(X,U,2),Y="@33" W !,"COST CENTER: ",$P(X,U,2);15.5;@33;
"KRN",.402,2639,"DR",1,410,3)
S X=$P($G(^PRCS(410,DA,3)),U,3) I X]"" S X=$$GETBOCNT^PRCSECP(PRC("SITE"),+PRC("CP"),+X) I (+X=1) S $P(^PRCS(410,DA,3),U,6)=$P(X,U,2),Y="@44" W !,"BOC: ",$P(X,U,2);17;@44;D RB^PRCSCK;16;@2;
"KRN",.402,2639,"DR",1,410,4)
S:$P($G(^PRCS(410,DA,2)),U)]""!(PRCVEN) Y="@25";
"KRN",.402,2639,"DR",1,410,5)
W !,"Do you want to enter a vendor for this 1358 request" S %=2 D YN^DICN I %'=1 W:%=0 !,"Enter 'YES' if you want to enter a vendor and vendor contract # for this request." S Y=$S(%=0:"@2",%<0:"",1:6);@25;11;S:PRCONT Y="@55";13;
"KRN",.402,2639,"DR",1,410,6)
S Y=6;@55;13R~;S Y=6;6R~;S PRCSDT=X;6.5R~;K PRCSDT;45PURPOSE~;I '$D(^PRCS(410,DA,8,1,0)) W $C(7),!,"PURPOSE IS REQUIRED!!!" S Y=45;I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),"^",11)="Y" S Y=68;42;68;
"KRN",.402,2639,"DR",1,410,7)
K PRCSCOST,PRCSBOST,PRCS1MO;60;
"KRN",.402,2639,"DR",2,410.04)
.01;1;D RB1^PRCSCK;
"KRN",19,12965,-1)
1^1
"KRN",19,12965,0)
PRC 1358 MISSING FIELDS
"KRN",19,12966,-1)
1^2
"KRN",19,12966,0)
PRCSENOD
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
148^3101109
"PKG",455,22,1,"PAH",1,1,0)
^^5^5^3101109
"PKG",455,22,1,"PAH",1,1,1,0)
Enhancement for 1358 miscellaneous obligations:
"PKG",455,22,1,"PAH",1,1,2,0)
  o enforce segregation of duties
"PKG",455,22,1,"PAH",1,1,3,0)
  o enter additional data on a 1358 request
"PKG",455,22,1,"PAH",1,1,4,0)
  o require mandatory fields to be populated
"PKG",455,22,1,"PAH",1,1,5,0)
  o include the new authority/sub-authority codes on the SO code sheet 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
17
"RTN","PRC1358C")
0^15^B3640057^B4910186
"RTN","PRC1358C",1,0)
PRC1358C ;WOIFO/LKG-1358 COMPLIANCE REPORTS ;9/21/10  09:57
"RTN","PRC1358C",2,0)
 ;;5.1;IFCAP;**130,148**;Oct 20, 2000;Build 5
"RTN","PRC1358C",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRC1358C",4,0)
IN1 ;Entry point for execution of scheduled 1358 compliance reports and
"RTN","PRC1358C",5,0)
 ;start of logic for 1358 Separation of Duties Violations report
"RTN","PRC1358C",6,0)
 N PRCDOW S PRCDOW=$$DOW^XLFDT($$NOW^XLFDT,1) Q:PRCDOW=0  ;Quit if Sunday
"RTN","PRC1358C",7,0)
 N L,DIOBEG,DIOEND,DIC,DISUPNO,FLDS,BY,FR,TO,IOP,XMQUIET,XMDUZ,XMSUB,XMY
"RTN","PRC1358C",8,0)
 S L=0,DIC=410,BY="[PRC SEPARATION VIOLATE]",FLDS="[PRC 1358 SEPARATION VIOL]"
"RTN","PRC1358C",9,0)
 ;Set FR to "T-2" for Monday's output and "T-1" for other days
"RTN","PRC1358C",10,0)
 S FR=$S(PRCDOW=1:"T-2",1:"T-1"),TO="T-1",IOP="P-MESSAGE-HFS;79"
"RTN","PRC1358C",11,0)
 S XMQUIET=1,XMDUZ="1358 EXAMINER",XMSUB="1358 SEPARATION OF DUTIES VIOLATIONS"
"RTN","PRC1358C",12,0)
 S XMY("G.PRC 1358 MONITORS")=""
"RTN","PRC1358C",13,0)
 D EN1^DIP
"RTN","PRC1358C",14,0)
IN2 ;Start of code for Missing Fields report
"RTN","PRC1358C",15,0)
 Q  ;The Missing Fields Report (1358) [PRC 1358 MISSING FIELDS] has been removed.
"RTN","PRC1358C",16,0)
 ;
"RTN","PRC1358C",17,0)
IN3 ;Entry point for user interactive 1358 Separation of Duties Violations report
"RTN","PRC1358C",18,0)
 N L,DIOBEG,DIOEND,DIC,DIPCRIT,DISUPNO,FLDS,BY,FR,TO,IOP,X S DIPCRIT=1
"RTN","PRC1358C",19,0)
 S DIOBEG="W:$E(IOST,1,2)=""C-"" @IOF",DIOEND="R:$E(IOST,1,2)=""C-"" !,""Press RETURN to continue..."",X:DTIME"
"RTN","PRC1358C",20,0)
 S L=0,DIC=410,BY="[PRC SEPARATION VIOLATE]",FLDS="[PRC 1358 SEPARATION VIOL]"
"RTN","PRC1358C",21,0)
 D EN1^DIP
"RTN","PRC1358C",22,0)
 Q
"RTN","PRC1358C",23,0)
 ;
"RTN","PRC1358C",24,0)
IN4 ;Entry point for user interactive Missing 1358 Fields report
"RTN","PRC1358C",25,0)
 N X W !!,"The Missing Fields Report (1358) [PRC 1358 MISSING FIELDS] has been deleted.",!?10,"Hit <RETURN> to continue...  " R X:DTIME
"RTN","PRC1358C",26,0)
 Q
"RTN","PRCE58P0")
0^9^B17096977^B15103802
"RTN","PRCE58P0",1,0)
PRCE58P0 ;WISC/SAW/LDB-DISPLAY 1358 FORM CONT. 19-FEB-92 ;03/16/94
"RTN","PRCE58P0",2,0)
V ;;5.1;IFCAP;**148**;Oct 20, 2000;Build 5
"RTN","PRCE58P0",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCE58P0",4,0)
PRCSD11 ;Entry for print
"RTN","PRCE58P0",5,0)
 U IO W @IOF S U="^",PRCSP=1 D NOW^%DTC S Y=% D DD^%DT W !,$P(TRNODE(0),U),?34,Y,?73,"PAGE ",PRCSP S L="",$P(L,"_",IOM)="_" W !,L
"RTN","PRCE58P0",6,0)
 D NEWP1 W !,"Originator of Request: " I $G(TRNODE(14)),TRNODE(14)'="" W $P($G(^VA(200,+TRNODE(14),0)),"^"),!
"RTN","PRCE58P0",7,0)
 W !,"Requestor:",?34,"|Date Requested:",?62,"|Obligation No.:"
"RTN","PRCE58P0",8,0)
 W ! K P1 I $D(TRNODE(7)) S P1=TRNODE(7) I +P1 S X=$P($G(^VA(200,+P1,0)),U) W X
"RTN","PRCE58P0",9,0)
 W ?34,"|" I $D(TRNODE(1)) S Y=$P(TRNODE(1),U) I Y D DD^%DT W Y
"RTN","PRCE58P0",10,0)
 W ?62,"|" I $D(TRNODE(4)),$P(TRNODE(4),U,5)'="" S PRCSPO=$P(TRNODE(4),U,5) W ?65,PRC("SITE")_"-"_PRCSPO
"RTN","PRCE58P0",11,0)
 W !,L W !,"Vendor:",?34,"|Contract Number:"
"RTN","PRCE58P0",12,0)
 W ! I $D(TRNODE(2)) S X=$P(TRNODE(2),U) I X]"" W $E(X,1,31)
"RTN","PRCE58P0",13,0)
 W ?34,"|" K PRCSG I $D(TRNODE(3)) S PRCSG=TRNODE(3) I $P(PRCSG,U,10)]"" W $P(PRCSG,U,10)
"RTN","PRCE58P0",14,0)
 W !,L W !,"Name and Title Approving Off.:",?41,"|Signature:",?62,"|Date Signed:"
"RTN","PRCE58P0",15,0)
 K P W ! I $D(P1) S P=$P(P1,U,3) S X=$S($D(^VA(200,+P,20)):$P(^(20),U,2),1:"") W $E(X,1,30)
"RTN","PRCE58P0",16,0)
 W ?41,"|" I $D(P),P,$P(P1,U,6)'="" S X=$$DECODE^PRCSC1(DA) W "/ES/"_$E(X,1,23)
"RTN","PRCE58P0",17,0)
 W ?62,"|" I $D(P1) S Y=$S($P(P1,U,7):$P(P1,U,7),1:$P(P1,U,5)) I Y D DD^%DT W Y K Y
"RTN","PRCE58P0",18,0)
 W ! I $D(P1) W $P(P1,U,4)
"RTN","PRCE58P0",19,0)
 W ?41,"|",?62,"|" W !,L W !,"FUND CERTIFICATION:  The supplies and services listed on this request are"
"RTN","PRCE58P0",20,0)
 W !,"properly chargeable to the following allotments, the available balances of"
"RTN","PRCE58P0",21,0)
 W !,"which are sufficient to cover the cost thereof, and funds have been obligated."
"RTN","PRCE58P0",22,0)
 W !,L,!,"Appropriation & Acct. Symbols:",?41,"|Obligated By: ",?62,"|Date Obligated:"
"RTN","PRCE58P0",23,0)
TST S DIWL=0,DIWR=80,DIWF="" K ^UTILITY($J)
"RTN","PRCE58P0",24,0)
 I $D(TRNODE(8)) S X1=0 F I=1:1 S X1=$O(TRNODE(8,X1)) Q:X1=""  S X=TRNODE(8,X1),PRCSDAA=DA D DIWP^PRCUTL($G(DA)) S DA=PRCSDAA K PRCSDAA
"RTN","PRCE58P0",25,0)
 S P=PRC("SITE") I $D(PRCSG) S:$P(PRCSG,U,2)]"" P=P_"-"_$P(PRCSG,U,2) S P=P_"-"_$P(PRC("CP")," ") S:$P(PRCSG,U,3)]"" P=P_"-"_$P($P(PRCSG,U,3)," ") S:$P(PRCSG,U,6)]"" P=P_"-"_+$P(PRCSG,U,6)
"RTN","PRCE58P0",26,0)
 N PROJ I $D(TRNODE(3)),$P($G(TRNODE(3)),"^",12)'="" S PROJ=$P(TRNODE(3),"^",12),P=P_" "_PROJ
"RTN","PRCE58P0",27,0)
 W !,P,?41,"|" K PRCSG I $D(TRNODE(4)) S PRCSG=TRNODE(4) I $P(PRCSG,U,9),$P(PRCSG,U,10)'="" S X=$$DECODE^PRCSC2(DA) W "/ES/"_$E(X,1,27)
"RTN","PRCE58P0",28,0)
 W ?62,"|" I $D(PRCSG) S Y=$P(PRCSG,U,4) I Y D DD^%DT W Y
"RTN","PRCE58P0",29,0)
 W !,L D HOLD G EXIT:Z3=U D NEWP
"RTN","PRCE58P0",30,0)
 W !,"AUTHORITY: " I $P($G(TRNODE(11)),U,4) W $P($G(^PRCS(410.9,$P(TRNODE(11),U,4),0)),U)," ",$P($G(^(0)),U,2)
"RTN","PRCE58P0",31,0)
 W:$P($G(TRNODE(11)),U,5) !,"SUB: ",$P($G(^PRCS(410.9,$P(TRNODE(11),U,5),0)),U)," ",$P($G(^(0)),U,2)
"RTN","PRCE58P0",32,0)
 W !,L,!,"Purpose:       SERVICE START DATE: ",$$FMTE^XLFDT($P($G(TRNODE(1)),U,6),"2DZ"),"     SERVICE END DATE: ",$$FMTE^XLFDT($P($G(TRNODE(1)),U,7),"2DZ")
"RTN","PRCE58P0",33,0)
 I $D(^UTILITY($J,"W",DIWL)) S Z=^UTILITY($J,"W",DIWL) F I=1:1:Z W !,^UTILITY($J,"W",DIWL,I,0) I IOSL-$Y<3 W !,L D HOLD Q:Z3=U  D NEWP
"RTN","PRCE58P0",34,0)
 G EXIT:Z3=U W !,L I IOSL-$Y<6 D HOLD G EXIT:Z3=U D NEWP
"RTN","PRCE58P0",35,0)
 D ^PRCE58P1 I Z3'=U D HOLD
"RTN","PRCE58P0",36,0)
EXIT K %DT,CT,UT,P1,P,PRCSP,PRCSA,PRCSA1,PRCSA2,PRCSG,PRCSPO,PRCSY,TRNODE,X,X1,Y,DIWL,DIWR,DIWF,Z,Z1,Z2,Z3,DA,I,L,^UTILITY($J) D:$D(ZTQUEUED) KILL^%ZTLOAD Q
"RTN","PRCE58P0",37,0)
NEWP ;PRINT HEADER FOR NEW PAGE
"RTN","PRCE58P0",38,0)
 W @IOF S PRCSP=PRCSP+1 W !,$P(TRNODE(0),U) W:$D(PRCSPO) ?35,PRC("SITE")_"-"_PRCSPO W ?73,"PAGE ",PRCSP W !,L
"RTN","PRCE58P0",39,0)
NEWP1 W !,?11,"ESTIMATED MISCELLANEOUS OBLIGATION OR CHANGE IN OBLIGATION" W !,L
"RTN","PRCE58P0",40,0)
 Q
"RTN","PRCE58P0",41,0)
HOLD R !,"Press return to continue, ""^"" to exit: ",Z3:DTIME S:'$T Z3=U Q
"RTN","PRCE58P0",42,0)
W2 W !!,"Enter information for another report or an uparrow to return to the menu.",! Q
"RTN","PRCE58P0",43,0)
W1 W !!,"You are not an authorized control point user.",!,"Contact your control point official." R X:5 G EXIT
"RTN","PRCE58P0",44,0)
W I $E(IOST,1)="C" W !!,"Press return to continue:  " R X:DTIME
"RTN","PRCE58P0",45,0)
 I IO'=IO(0) D ^%ZISC
"RTN","PRCE58P2")
0^11^B16930657^B14887203
"RTN","PRCE58P2",1,0)
PRCE58P2 ;WISC/SAW,LDB-CONTROL POINT ACTIVITY 1358 PRINTOUT ;07/07/93
"RTN","PRCE58P2",2,0)
V ;;5.1;IFCAP;**148**;Oct 20, 2000;Build 5
"RTN","PRCE58P2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCE58P2",4,0)
 G P
"RTN","PRCE58P2",5,0)
QUE I $D(ZTQUEUED) S DA=D0
"RTN","PRCE58P2",6,0)
 S DA=D0,PRCSOB=1
"RTN","PRCE58P2",7,0)
P U IO W:$Y>0 @IOF S U="^",PRCSP=1,L="",$P(L,"-",80)="-" D NOW^%DTC S Y=% D DD^%DT
"RTN","PRCE58P2",8,0)
 D NODE^PRCS58OB(DA,.TRNODE) S PRCSTN=$P($G(TRNODE(0)),U),PRC("SITE")=+PRCSTN W !,PRCSTN,?36,Y,?72,"PAGE ",PRCSP D UL
"RTN","PRCE58P2",9,0)
 D NEWP1 W !,"Originator of Request: " I $D(TRNODE(14)),TRNODE(14)'="" W $P($G(^VA(200,TRNODE(14),0)),"^"),!
"RTN","PRCE58P2",10,0)
 W !,"Requestor:",?41,"|Date Requested:",?62,"|Obligation No.:"
"RTN","PRCE58P2",11,0)
 W ! K P1 I $D(TRNODE(7)) S P1=TRNODE(7) I +P1 S X=$P($G(^VA(200,+P1,0)),U) W X
"RTN","PRCE58P2",12,0)
 W ?41,"|" I $D(TRNODE(1)) S Y=$P(TRNODE(1),U) I Y D DD^%DT W Y
"RTN","PRCE58P2",13,0)
 W ?62,"|" I $D(TRNODE(4)),$P(TRNODE(4),U,5)'="" S PRCSPO=$P(TRNODE(4),U,5) W ?65,PRC("SITE")_"-"_PRCSPO
"RTN","PRCE58P2",14,0)
 D UL W !,"Vendor:",?41,"|Contract Number:"
"RTN","PRCE58P2",15,0)
 W ! I $D(TRNODE(2)) W $P(TRNODE(2),U)
"RTN","PRCE58P2",16,0)
 W ?41,"|" K PRCSG I $D(TRNODE(3)) S PRCSG=TRNODE(3) I $P(PRCSG,U,10)]"" W $P(PRCSG,U,10)
"RTN","PRCE58P2",17,0)
 W ! I $D(TRNODE(2)),TRNODE(2)]"" W $P(TRNODE(2),U,2),?41,"|",!,$P(TRNODE(2),U,6)_", " W $S($D(^DIC(5,+$P(TRNODE(2),U,7),0)):$P(^(0),U,2),1:"  ")_"  "_$P(TRNODE(2),U,8)
"RTN","PRCE58P2",18,0)
 W ?41,"|" D UL W !,"Name and Title Approving Official:",?41,"|Signature/Date Signed:"
"RTN","PRCE58P2",19,0)
 K P W ! I $D(P1) S P=$P(P1,U,3) I P S X=$S($D(^VA(200,P,20)):$P(^(20),U,2),1:"") W $E(X,1,30)
"RTN","PRCE58P2",20,0)
 K P W ! I $D(P1) S P=$P(P1,U,3) I P S X=$S($G(^VA(200,P,20)):$P(^(20),U,2),1:"") W $E(X,1,30)
"RTN","PRCE58P2",21,0)
 W ?41,"|" I $D(P),P,$P(P1,U,6)'="" S X=$$DECODE^PRCSC1(DA) W "/ES/"_$E(X,1,28)
"RTN","PRCE58P2",22,0)
 W ?62,"/" I $D(P1) S Y=$S($P(P1,U,7):$P(P1,U,7),1:$P(P1,U,5)) I Y D DD^%DT W Y K Y
"RTN","PRCE58P2",23,0)
 W ! I $D(P1) W $P(P1,U,4)
"RTN","PRCE58P2",24,0)
 W ?41,"|" D UL W !,"FUND CERTIFICATION:",!,"The supplies and services listed on this request are properly chargeable"
"RTN","PRCE58P2",25,0)
 W !,"to the following allotments, the available balances of which are"
"RTN","PRCE58P2",26,0)
 W !,"sufficient to cover the cost thereof, and funds have been obligated."
"RTN","PRCE58P2",27,0)
 D UL W !,"Appropriation and Accounting Symbols:",?41,"|Obligated By: ",?62,"|Date Obligated:"
"RTN","PRCE58P2",28,0)
 S DIWL=0,DIWR=80,DIWF="" K ^UTILITY($J)
"RTN","PRCE58P2",29,0)
 I $D(TRNODE(8)) S X1=0 F I=1:1 S X1=$O(TRNODE(8,X1)) Q:X1=""  S X=TRNODE(8,X1),PRCSDAA=DA D DIWP^PRCUTL($G(DA)) S DA=PRCSDAA K PRCSDAA
"RTN","PRCE58P2",30,0)
 S P=PRC("SITE") I $D(PRCSG) S:$P(PRCSG,U,2)]"" P=P_"-"_$P(PRCSG,U,2) S P=P_"-"_$P(PRCSTN,"-",4) S:$P(PRCSG,U,3)]"" P=P_"-"_$P($P(PRCSG,U,3)," ") S:$P(PRCSG,U,6) P=P_"-"_+$P(PRCSG,U,6)
"RTN","PRCE58P2",31,0)
 I $D(TRNODE(3)),$P($G(TRNODE(3)),"^",12)'="" S PROJ=$P(TRNODE(3),"^",12),P=P_" "_PROJ
"RTN","PRCE58P2",32,0)
 W !,P,?41,"|" K PRCSG I $D(TRNODE(4)) S PRCSG=TRNODE(4) I $P(PRCSG,U,9),$P(PRCSG,U,10)'="" S X=$$DECODE^PRCSC2(DA) W "/ES/"_$E(X,1,28)
"RTN","PRCE58P2",33,0)
 W ?62,"|" I $D(PRCSG) S Y=$P(PRCSG,U,4) I Y D DD^%DT W Y
"RTN","PRCE58P2",34,0)
 D UL
"RTN","PRCE58P2",35,0)
 W !,"AUTHORITY: " I $P($G(TRNODE(11)),U,4) W $P($G(^PRCS(410.9,$P(TRNODE(11),U,4),0)),U)," ",$P($G(^(0)),U,2)
"RTN","PRCE58P2",36,0)
 W:$P($G(TRNODE(11)),U,5) !,"SUB: ",$P($G(^PRCS(410.9,$P(TRNODE(11),U,5),0)),U)," ",$P($G(^(0)),U,2)
"RTN","PRCE58P2",37,0)
 D UL W !,"Purpose:       SERVICE START DATE: ",$$FMTE^XLFDT($P($G(TRNODE(1)),U,6),"2DZ"),"     SERVICE END DATE: ",$$FMTE^XLFDT($P($G(TRNODE(1)),U,7),"2DZ")
"RTN","PRCE58P2",38,0)
 I $D(^UTILITY($J,"W",DIWL)) S Z=^UTILITY($J,"W",DIWL) F I=1:1:Z W !,^UTILITY($J,"W",DIWL,I,0) I IOSL-$Y<3 D UL,NEWP
"RTN","PRCE58P2",39,0)
 I IOSL-$Y<10 D NEWP
"RTN","PRCE58P2",40,0)
 D ^PRCE58P3
"RTN","PRCE58P2",41,0)
 K %DT,CT,UT,P1,P,PRCSP,PRCSA,PRCSG,PRCSOB,PRCSPO,PRCSTN,X,X1,Y,DIWL,DIWR,DIWF,Z,DA,I,L,^UTILITY($J) D:$D(ZTQUEUED) KILL^%ZTLOAD Q
"RTN","PRCE58P2",42,0)
UL W ! N I F I=1:1:80 W @IOBS
"RTN","PRCE58P2",43,0)
 W L Q
"RTN","PRCE58P2",44,0)
NEWP ;PRINT HEADER FOR NEW PAGE
"RTN","PRCE58P2",45,0)
 W !!,"VA FORM 4-1358a-ADP (NOV 1987)" W:$Y>0 @IOF
"RTN","PRCE58P2",46,0)
 S PRCSP=PRCSP+1 W !,$P(TRNODE(0),U) W:$D(PRCSPO) ?40,PRC("SITE")_"-"_PRCSPO W ?72,"PAGE ",PRCSP D UL
"RTN","PRCE58P2",47,0)
NEWP1 I '$D(PRCSOB) W !,?14,"ESTIMATED MISCELLANEOUS OBLIGATION OR CHANGE IN OBLIGATION" D UL
"RTN","PRCE58P2",48,0)
 E  W !,?26,"REQUEST FOR 1358 OBLIGATION/ADJUSTMENT" D UL
"RTN","PRCE58P2",49,0)
 Q
"RTN","PRCEADJ")
0^5^B34959566^B31997445
"RTN","PRCEADJ",1,0)
PRCEADJ ;WISC/CLH/LDB/PLT/SJG - CP 1358 ADJUSTMENTS ; 9/15/2010
"RTN","PRCEADJ",2,0)
V ;;5.1;IFCAP;**140,148**;Oct 20, 2000;Build 5
"RTN","PRCEADJ",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCEADJ",4,0)
 ;Create increase/decrease adjustment
"RTN","PRCEADJ",5,0)
EN N PRC410,PRC442,PRCS,DIE,DR,PRC,PRCS2,DIC,X,X410,X442,X1,X2,X3,X4,PRCSIP,Y,Y410,DIR,TRNODE,Z,Z410,PRCSOBN
"RTN","PRCEADJ",6,0)
EN1 ;
"RTN","PRCEADJ",7,0)
 D EN^PRCSUT ; ask site, fiscal year, quarter, control point; set X & Z
"RTN","PRCEADJ",8,0)
 I '$D(PRC("SITE")) W !,$C(7),"You are not an authorized control point user.",! G OUT
"RTN","PRCEADJ",9,0)
 G OUT:'$D(PRC("QTR"))!(Y<0)
"RTN","PRCEADJ",10,0)
 S X410=X ; station-FY-FCP
"RTN","PRCEADJ",11,0)
 S Z410=Z ; station-FY-quarter-FCP
"RTN","PRCEADJ",12,0)
 ;
"RTN","PRCEADJ",13,0)
 ; warn CP official, allow to quit (PRC*5.1*148)
"RTN","PRCEADJ",14,0)
 G:$$Q1358^PRCEN(PRC("SITE"),PRC("CP"),"A") OUT
"RTN","PRCEADJ",15,0)
 ;
"RTN","PRCEADJ",16,0)
ENA1 S DIC=410,Y=""
"RTN","PRCEADJ",17,0)
 D OROBL^PRCS58OB(DIC,.PRC,.Y) ; get obligation # from old 1358
"RTN","PRCEADJ",18,0)
 I $D(DTOUT)!$D(DUOUT) G OUT
"RTN","PRCEADJ",19,0)
 I Y<0 W $C(7),!!,"    Obligation number is required.  Use '^' to exit this option.",! G ENA1
"RTN","PRCEADJ",20,0)
 S Y410=Y
"RTN","PRCEADJ",21,0)
 S X442=X
"RTN","PRCEADJ",22,0)
 D NODE^PRCS58OB(+Y,.TRNODE) ; set up TRNODE array from data in 410
"RTN","PRCEADJ",23,0)
 S X="0101"_$P(TRNODE(0),"-",2),%DT="X" D ^%DT
"RTN","PRCEADJ",24,0)
 S X2=$E(Y,1,3) ; FY of original 1358
"RTN","PRCEADJ",25,0)
 S X="0101"_PRC("FY"),%DT="X" D ^%DT
"RTN","PRCEADJ",26,0)
 S X3=$E(Y,1,3) ; adjustment FY
"RTN","PRCEADJ",27,0)
 I X2_"-"_$P(TRNODE(0),"-",3)](X3_"-"_PRC("QTR")) D EN^DDIOL("Adjustments cannot be earlier than the original 1358's FY-QTR.") G ENA1
"RTN","PRCEADJ",28,0)
 N POOBL S POOBL=$P($G(TRNODE(10)),U,3)
"RTN","PRCEADJ",29,0)
 I POOBL="" D EN^DDIOL("    Obligation number is required.") W ! G ENA1
"RTN","PRCEADJ",30,0)
 N OBLSTAT S OBLSTAT=$$NP^PRC0B("^PRC(442,"_POOBL_",",7,1)
"RTN","PRCEADJ",31,0)
 I $G(OBLSTAT)=40 D EN^DDIOL("    Adjusting a closed 1358 request is not allowed.") W ! G ENA1
"RTN","PRCEADJ",32,0)
ENA2 N EXIT S EXIT=0
"RTN","PRCEADJ",33,0)
 D FMSTAT(POOBL,.FMSDOC,.STATUS)
"RTN","PRCEADJ",34,0)
 I $D(STATUS),"AF"'[$E(STATUS,1) D  I EXIT D MSG1,OUT G EN1
"RTN","PRCEADJ",35,0)
 .Q:STATUS="CALM"
"RTN","PRCEADJ",36,0)
 .; S TMP=Y,%X="Y",%Y="TMP(" D %XY^%RCR K %X,%Y ; PRC*5*231 - saves Y earlier
"RTN","PRCEADJ",37,0)
 .K MSG W !
"RTN","PRCEADJ",38,0)
 .S MSG(1)="    Note that one of the previous documents has not been processed in FMS."
"RTN","PRCEADJ",39,0)
 .S MSG(2)="    The adjustment to this 1358 cannot be obligated until the previous"
"RTN","PRCEADJ",40,0)
 .S MSG(3)="    document has been processed in FMS.",MSG(5)="  "
"RTN","PRCEADJ",41,0)
 .S MSG(6)="    FMS Document: "_FMSDOC,MSG(7)="    Status: "_STATUS
"RTN","PRCEADJ",42,0)
 .D EN^DDIOL(.MSG) K MSG
"RTN","PRCEADJ",43,0)
 .W ! D PROMPT
"RTN","PRCEADJ",44,0)
 .S:Y EXIT=0 I 'Y!($D(DIRUT)) S EXIT=1
"RTN","PRCEADJ",45,0)
 .Q
"RTN","PRCEADJ",46,0)
 ;The following lines commented out by PRC*5*231 - Y doesn't need to be restored
"RTN","PRCEADJ",47,0)
 ; I $D(STATUS) S:"AF"[$E(STATUS,1)!(STATUS="CALM") EXIT=1
"RTN","PRCEADJ",48,0)
ENA3 ; I $D(EXIT) I 'EXIT S Y=TMP,%X="TMP",%Y="Y(" D %XY^%RCR,MSG2 K TMP,%X,%Y
"RTN","PRCEADJ",49,0)
 S PRC442=$P($G(TRNODE(10)),U,3)
"RTN","PRCEADJ",50,0)
 S PRCSOBN=$$BAL^PRCH58(PRC442) ; get obligation# from file 442,node 8
"RTN","PRCEADJ",51,0)
 I PRCSOBN'=-1 W !," Original Obligation Amount:  $ ",$FN($P(PRCSOBN,U),",P",2)
"RTN","PRCEADJ",52,0)
 I PRCSOBN'=-1 D
"RTN","PRCEADJ",53,0)
 .W ?46,"Service Balance: $ ",$FN((+PRCSOBN-$P(PRCSOBN,U,3)),",P",2),!
"RTN","PRCEADJ",54,0)
 .W ?4,"  Fiscal's 1358 Balance:  $ ",$FN(+PRCSOBN-$P(PRCSOBN,U,2),",P",2),!
"RTN","PRCEADJ",55,0)
 S Y=Y410,X=X410,X1=X,Z=Z410
"RTN","PRCEADJ",56,0)
 D EN1^PRCSUT3 Q:'X  S X1=X
"RTN","PRCEADJ",57,0)
 D EN2 Q:'$D(X1)  S X=X1 ; add data to record in 410
"RTN","PRCEADJ",58,0)
 W !,"This transaction is assigned transaction number: ",X
"RTN","PRCEADJ",59,0)
 L +^PRCS(410,DA):$S($D(DILOCKTM):DILOCKTM,1:3) I $T=0 D EN^DDIOL("File in use.... Please try again later") D KILL G EN1
"RTN","PRCEADJ",60,0)
 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) S:$P(^(0),U,11)="Y" PRCS2=1
"RTN","PRCEADJ",61,0)
 S PRC410=DA
"RTN","PRCEADJ",62,0)
 S PRCSIP=$S($D(PRCSIP):PRCSIP,1:"")
"RTN","PRCEADJ",63,0)
 D ADJ^PRCS58OB(DIC,DA,PRCSIP,.X4)
"RTN","PRCEADJ",64,0)
 K PRCSOBN
"RTN","PRCEADJ",65,0)
 D ADJ1^PRCS58OB(DA,X,Y410)
"RTN","PRCEADJ",66,0)
 D ADJ2^PRCS58OB(.PRC,X442,DA)
"RTN","PRCEADJ",67,0)
 L -^PRCS(410,DA)
"RTN","PRCEADJ",68,0)
 S DIR("A")="Enter another increase/decrease adjustment"
"RTN","PRCEADJ",69,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","PRCEADJ",70,0)
 S DIR("?")="Yes to enter an adjustment, return or '^' to quit"
"RTN","PRCEADJ",71,0)
 D ^DIR I Y D KILL G EN1
"RTN","PRCEADJ",72,0)
OUT K DIRUT,DTOUT,DUOUT
"RTN","PRCEADJ",73,0)
KILL K PRC410,PRC442,PRCS,DIE,DR,PRC,PRCSL,PRCS2,DIC,X,X410,X442,X1,X4,PRCSIP,Y,Y410,DIR,TRNODE,Z,Z410,PRCSOBN
"RTN","PRCEADJ",74,0)
 K DA,FMSDOC,STATUS,TMP,%DT
"RTN","PRCEADJ",75,0)
 QUIT
"RTN","PRCEADJ",76,0)
 ;
"RTN","PRCEADJ",77,0)
ASK ; entry point from other options
"RTN","PRCEADJ",78,0)
 S DIR(0)="YO"
"RTN","PRCEADJ",79,0)
 S DIR("A")="Do you want to enter an increase adjustment at this time"
"RTN","PRCEADJ",80,0)
 S DIR("B")="NO"
"RTN","PRCEADJ",81,0)
 S DIR("?")="Yes to enter an increase adjustment, return or '^' to quit"
"RTN","PRCEADJ",82,0)
 D ^DIR I 'Y&'$D(DIRUT) W !!,"No action can be taken with this authorization amount now.",! K DIR Q
"RTN","PRCEADJ",83,0)
 K DIR,DIC,X,Y I $D(DIRUT) Q
"RTN","PRCEADJ",84,0)
 G EN
"RTN","PRCEADJ",85,0)
 ;
"RTN","PRCEADJ",86,0)
FMSTAT(POOBL,FMSDOC,STATUS) ; Check status of prior FMS Documents
"RTN","PRCEADJ",87,0)
 N LOOP,NODE
"RTN","PRCEADJ",88,0)
 S LOOP=0,(FMSDOC,STATUS)=""
"RTN","PRCEADJ",89,0)
 F  S LOOP=$O(^PRC(442,+POOBL,10,LOOP)) Q:LOOP'>0  D
"RTN","PRCEADJ",90,0)
 .S NODE=^PRC(442,+POOBL,10,LOOP,0)
"RTN","PRCEADJ",91,0)
 .I $E(NODE,1,2)="SO"!($E(NODE,1,2)="AR") D
"RTN","PRCEADJ",92,0)
 ..S FMSDOC=$P($G(^PRC(442,+POOBL,10,LOOP,0)),U,4)
"RTN","PRCEADJ",93,0)
 ..S STATUS=$$STATUS^GECSSGET(FMSDOC)
"RTN","PRCEADJ",94,0)
 ..Q
"RTN","PRCEADJ",95,0)
 .I $E(NODE,1,6)?3N1"."2N S STATUS="CALM"
"RTN","PRCEADJ",96,0)
 Q
"RTN","PRCEADJ",97,0)
PROMPT ;
"RTN","PRCEADJ",98,0)
 S DIR(0)="Y"
"RTN","PRCEADJ",99,0)
 S DIR("A")="    Do you wish to create the adjustment to this 1358"
"RTN","PRCEADJ",100,0)
 S DIR("B")="YES"
"RTN","PRCEADJ",101,0)
 S DIR("?")="    Enter 'YES' or 'Y' or 'RETURN' to create the adjustment."
"RTN","PRCEADJ",102,0)
 S DIR("?",1)="    Enter 'NO' or 'N' or '^' to exit."
"RTN","PRCEADJ",103,0)
 D ^DIR K DIR
"RTN","PRCEADJ",104,0)
 Q
"RTN","PRCEADJ",105,0)
 ;
"RTN","PRCEADJ",106,0)
EN2 ;add record in file 410
"RTN","PRCEADJ",107,0)
 S DLAYGO=410,DIC="^PRCS(410,",DIC(0)="LXZ" D ^DIC K DLAYGO G:Y<0 W4
"RTN","PRCEADJ",108,0)
EN2A S DA=+Y S:'$D(T(2)) T(2)=""
"RTN","PRCEADJ",109,0)
 S PRC("ACC")=$$ACC^PRC0C(PRC("SITE"),PRC("CP")_"^"_PRC("FY")_"^"_PRC("BBFY"))
"RTN","PRCEADJ",110,0)
 S PRCSAPP=$P(PRC("ACC"),U,11)
"RTN","PRCEADJ",111,0)
 S ^PRCS(410,DA,0)=$P(^PRCS(410,DA,0),U)_"^^"_T(2)_"^^"_PRC("SITE")
"RTN","PRCEADJ",112,0)
 S $P(^PRCS(410,DA,1),U,6,7)=$P($G(^PRCS(410,+Y410,1)),U,6,7)
"RTN","PRCEADJ",113,0)
 S ^PRCS(410,DA,2)=$G(^PRCS(410,+Y410,2))
"RTN","PRCEADJ",114,0)
 S ^PRCS(410,DA,3)=PRC("CP")_U_PRCSAPP,$P(^(3),U,12)=$P(PRC("ACC"),U,3)
"RTN","PRCEADJ",115,0)
 S $P(^PRCS(410,DA,3),U,11)=$P($$DATE^PRC0C(PRC("BBFY"),"E"),U,7)
"RTN","PRCEADJ",116,0)
 S $P(^PRCS(410,DA,3),U,10)=$P($G(^PRCS(410,+Y410,3)),U,10)
"RTN","PRCEADJ",117,0)
 S $P(^PRCS(410,DA,11),U,4,5)=$P($G(^PRCS(410,+Y410,11)),U,4,5)
"RTN","PRCEADJ",118,0)
 S ^PRCS(410,"AN",$E(PRC("CP"),1,30),DA)=""
"RTN","PRCEADJ",119,0)
 D ERS410^PRC0G(DA_"^E")
"RTN","PRCEADJ",120,0)
 S:T(2)'="" ^PRCS(410,"H",$E(T(2),1,30),DA)=DUZ,$P(^PRCS(410,DA,11),U,2)=DUZ,^PRCS(410,"K",+$P(PRC("CP")," "),DA)="",$P(^PRCS(410,DA,6),U,4)=+$P(PRC("CP")," ") K PRCSAPP
"RTN","PRCEADJ",121,0)
EN2B S:$D(PRC("SST")) $P(^PRCS(410,DA,0),U,10)=PRC("SST")
"RTN","PRCEADJ",122,0)
 D:$D(MYY) ERS410^PRC0G(DA_"^E")
"RTN","PRCEADJ",123,0)
 K T(2),MYY
"RTN","PRCEADJ",124,0)
 Q
"RTN","PRCEADJ",125,0)
W4 W !!,"Another user is accessing this file...  Try later.",$C(7) R:$E(IOST,1,2)="C-" X:5
"RTN","PRCEADJ",126,0)
 Q
"RTN","PRCEADJ",127,0)
 ;
"RTN","PRCEADJ",128,0)
MSG1 W ! D EN^DDIOL("    No further action taken on this adjustment.") W ! Q
"RTN","PRCEADJ",129,0)
MSG2 W ! D EN^DDIOL("    Returning to creating the 1358 adjustment...") W !! Q
"RTN","PRCEFIS5")
0^13^B14226098^B12287079
"RTN","PRCEFIS5",1,0)
PRCEFIS5 ;WISC/CTB/CLH-DISPLAY 1358 TRANSACTIONS ;05/19/94
"RTN","PRCEFIS5",2,0)
V ;;5.1;IFCAP;**148**;Oct 20, 2000;Build 5
"RTN","PRCEFIS5",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCEFIS5",4,0)
 N PO,PODA,PRCFA,PRC410
"RTN","PRCEFIS5",5,0)
 I '$D(PRC("SITE")) N PRC,% S PRCF("X")="AS" D ^PRCFSITE Q:'%
"RTN","PRCEFIS5",6,0)
EN1 N Y,DIR,PRCFAUTH,ZTSAVE,ZTRTN,ZTDESC
"RTN","PRCEFIS5",7,0)
 D HILO^PRCFQ
"RTN","PRCEFIS5",8,0)
 I '$D(PO(0)) N PODA D OBLK^PRCH58OB(.PODA) Q:'PODA  D PO^PRCH58OB(PODA,.PO) Q:$G(PO(0))=""  S PRCFA("PODA")=PODA
"RTN","PRCEFIS5",9,0)
 S PRC410(1)=$G(^PRCS(410,+$P($G(PO(0)),"^",12),1)),PRC410(11)=$G(^(11))
"RTN","PRCEFIS5",10,0)
 W !!,"SERVICE START DATE: ",$$FMTE^XLFDT($P(PRC410(1),"^",6),"2DZ"),"     SERVICE END DATE: ",$$FMTE^XLFDT($P(PRC410(1),"^",7),"2DZ")
"RTN","PRCEFIS5",11,0)
 W !,"AUTHORITY: ",$P($G(^PRCS(410.9,+$P(PRC410(11),"^",4),0)),"^")," ",$P($G(^(0)),"^",2)
"RTN","PRCEFIS5",12,0)
 W:$P(PRC410(11),"^",5) !,"SUB: ",$P($G(^PRCS(410.9,+$P(PRC410(11),"^",5),0)),"^")," ",$P($G(^(0)),"^",2) W !
"RTN","PRCEFIS5",13,0)
 S DIR("A")="Do you wish to view the Authorization information",DIR("B")="No",DIR(0)="YO",DIR("?")="Enter YES to view authorization information" D ^DIR Q:Y["^"  K DIR S:Y=1 PRCFAUTH=""
"RTN","PRCEFIS5",14,0)
 S ZTSAVE("PO*")="",ZTSAVE("PR*")="",ZTSAVE("PRCFAUTH")="",ZTDESC="DISPLAY 1358 "_$P(PO(0),"^"),ZTRTN="Q^PRCEFIS5" D ^PRCFQ
"RTN","PRCEFIS5",15,0)
 Q
"RTN","PRCEFIS5",16,0)
 ;
"RTN","PRCEFIS5",17,0)
Q ;Entry point for queued report
"RTN","PRCEFIS5",18,0)
 N %X,AUTHAMT,C,CT,DATE,DIC,DREC,I,LIQAMT,OBNUM,S,TMP,UL,UT,X,X1,Z,ZX,DIR
"RTN","PRCEFIS5",19,0)
 S $P(UL,"_",80)="",OBNUM=$S($D(PO(0)):$P(PO(0),U),$D(PRCFA("PODA")):$P(^PRC(442,PRCFA("PODA"),0),U),1:"")
"RTN","PRCEFIS5",20,0)
 I '$D(DA) S DA=$S($D(PO(0)):+$P(PO(0),U,12),$D(PRCFA("PODA")):$P(^PRC(442,PRCFA("PODA"),0),U,12),1:0)
"RTN","PRCEFIS5",21,0)
 D HDR
"RTN","PRCEFIS5",22,0)
 I 'OBNUM!('$D(^PRC(424,"AD",OBNUM))) W !,"Daily Record entries have not yet been entered for this request.",!,"The total committed cost of this request is $" W $S($D(^PRCS(410,DA,4)):$J($P(^(4),U),0,2),1:0),!,UL D:'$D(ZTQUEUED) PAUSE^PRCFQ Q
"RTN","PRCEFIS5",23,0)
 S %=1,(X1,CT,UT)="" F  S X1=$O(^PRC(424,"AD",OBNUM,X1)) Q:X1'>0  I $D(^PRC(424,X1,0)) S DREC=^(0) D   I ($G(IOSL)-$Y<4) D:'$D(ZTQUEUED) PAUSE^PRCFQ Q:'%  D HDR
"RTN","PRCEFIS5",24,0)
   . I '$D(PRCFAUTH),$P(DREC,U,3)="AU" Q
"RTN","PRCEFIS5",25,0)
   . S S="|",X=$P(DREC,U,7) D CNVD^PRCFQ S DATE=Y S TYPE=$P(DREC,U,3)
"RTN","PRCEFIS5",26,0)
   . I TYPE="" Q
"RTN","PRCEFIS5",27,0)
   . S AUTHAMT=$S(TYPE="AU":-$P(DREC,U,12),TYPE="O":$P(DREC,U,6),TYPE="A":$P(DREC,U,6),1:"")
"RTN","PRCEFIS5",28,0)
   . S LIQAMT=$S(TYPE="L":-$P(DREC,U,4),TYPE="O":$P(DREC,U,6),TYPE="A":$P(DREC,U,6),1:"")
"RTN","PRCEFIS5",29,0)
   . W !,DATE,?16,S," ",$S(TYPE="O":"OBLIGATION",TYPE="A":"ADJUSTMENT",1:$E($P(DREC,U,10),1,12)),?30,S
"RTN","PRCEFIS5",30,0)
   . I AUTHAMT]"",$D(PRCFAUTH) W $J(AUTHAMT,11,2),?42,S S CT=CT+AUTHAMT W $J(CT,11,2),?54,S
"RTN","PRCEFIS5",31,0)
   . E  W ?42,S,?54,S
"RTN","PRCEFIS5",32,0)
   . I LIQAMT]"" W $J(LIQAMT,12,2),?67,S S UT=UT+LIQAMT W $J(UT,11,2)
"RTN","PRCEFIS5",33,0)
   . E  W ?67,S
"RTN","PRCEFIS5",34,0)
   . K LIQAMT,AUTHAMT,ADJAMT,X,DREC,DATE,TYPE,Y
"RTN","PRCEFIS5",35,0)
 W !,UL D:'$D(ZTQUEUED) PAUSE^PRCFQ
"RTN","PRCEFIS5",36,0)
 Q
"RTN","PRCEFIS5",37,0)
 ;
"RTN","PRCEFIS5",38,0)
HDR W @IOF W ?25,"Obligation #: ",IOINHI,$P(PO(0),"^"),IOINORM
"RTN","PRCEFIS5",39,0)
 I $D(PO(8)) W !?$X+4,"Total Authorization:",IOINHI," $ "_$J($FN($P(PO(8),U,3),",",2),12),?$X+5,IOINORM,"Total Liquidation:",IOINHI," $ "_$J($FN($P(PO(8),U,2),",",2),12),IOINORM
"RTN","PRCEFIS5",40,0)
 W !?30,"|AUTHORIZATION/ORDER REC|",?59,"LIQUIDATION RECORD"
"RTN","PRCEFIS5",41,0)
 W !,?2,"Date/Time",?18,"Reference No",?30,"|Indiv/Daily",?48,"Cumul",?54,"|  Liq. Amt",?67,"| Unliq Bal." W !,UL
"RTN","PRCEFIS5",42,0)
 Q
"RTN","PRCEN")
0^1^B46938754^B18332756
"RTN","PRCEN",1,0)
PRCEN ;WISC/CLH - ENTER/EDIT 1358 ;9/2/2010
"RTN","PRCEN",2,0)
V ;;5.1;IFCAP;**23,148**;Oct 20, 2000;Build 5
"RTN","PRCEN",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCEN",4,0)
EN ;new 1358 request
"RTN","PRCEN",5,0)
 N PRC,X,X1,DIC,DIE,DR,PRCS2,PRCSL,PRCSIP,DIR,DIRUT,PRCS,PRCSCP,PRCSN
"RTN","PRCEN",6,0)
 N PRCST,PRCST1,PRCSTT,PRC410,PRCUA,PRCAUTH,PRCAUTHS,PRCQ,PRCVEN,PRCONT
"RTN","PRCEN",7,0)
EN0 K PRC,X,X1,DIC,DIE,DR,PRCS2,PRCSL,PRCSIP,DIR,DIRUT,PRCS,PRCSCP,PRCSN
"RTN","PRCEN",8,0)
 K PRCST,PRCST1,PRCSTT,PRCAED,PRC410,PRCUA,PRCAUTHS
"RTN","PRCEN",9,0)
 D EN^PRCSUT I '$D(PRC("SITE")) W !!,"You are not an authorized control point user.",!,"Contact your control point official." H 3 Q
"RTN","PRCEN",10,0)
 Q:'$D(PRC("QTR"))!(Y<0)
"RTN","PRCEN",11,0)
 ;
"RTN","PRCEN",12,0)
 ; warn CP official, allow to quit
"RTN","PRCEN",13,0)
 Q:$$Q1358(PRC("SITE"),PRC("CP"))
"RTN","PRCEN",14,0)
 ;
"RTN","PRCEN",15,0)
 ; ask for 1358 Authority (need to preserve variables)
"RTN","PRCEN",16,0)
 S PRCQ=0 D
"RTN","PRCEN",17,0)
 . N X,Y,DTOUT,DUOUT,DIC
"RTN","PRCEN",18,0)
 . S DIC="^PRCS(410.9,",DIC(0)="AEMQ",DIC("S")="I Y<100,('$P(^(0),U,4)!($P(^(0),U,4)>DT))",DIC("A")="Select AUTHORITY OF REQUEST: " D ^DIC S PRCAUTH=+Y I Y<1 S PRCQ=1 Q
"RTN","PRCEN",19,0)
 . I $D(^PRCS(410.9,"AC",PRCAUTH)) S DIC("S")="I $P(^(0),U,3)=PRCAUTH,('$P(^(0),U,4)!($P(^(0),U,4)>DT))",DIC("A")="Select SUB-AUTHORITY OF REQUEST: " D ^DIC S PRCAUTHS=+Y I Y<1 S PRCQ=1
"RTN","PRCEN",20,0)
 Q:PRCQ
"RTN","PRCEN",21,0)
 D EN1^PRCSUT3 Q:'X
"RTN","PRCEN",22,0)
 S X1=X D EN2^PRCSUT3 Q:'$D(X1)  S X=X1 W !!,"This transaction is assigned Transaction number: ",X
"RTN","PRCEN",23,0)
 S PRC410=DA
"RTN","PRCEN",24,0)
 D  G:'$D(DA) EN0
"RTN","PRCEN",25,0)
 . L +^PRCS(410,DA):$S($D(DILOCKTM):DILOCKTM,1:3)
"RTN","PRCEN",26,0)
 . E  D EN^DDIOL("Transaction is being accessed by another user!") K DA
"RTN","PRCEN",27,0)
 . Q
"RTN","PRCEN",28,0)
 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) S:$P(^(0),"^",11)="Y" PRCS2=1
"RTN","PRCEN",29,0)
 S DIC(0)="AEMQ",DIE=DIC,DR="3///1"_$S($D(PRCSIP):";4////"_PRCSIP,1:"")_";19////^S X=PRCAUTH"_$S($G(PRCAUTHS):";19.1////^S X=PRCAUTHS",1:""),X4=1 D ^DIE
"RTN","PRCEN",30,0)
 S PRCAED=1,PRCUA=""
"RTN","PRCEN",31,0)
 ; define if fields need to be required or not
"RTN","PRCEN",32,0)
 S PRCVEN=^PRCS(410.9,$S($G(PRCAUTHS):PRCAUTHS,1:PRCAUTH),0),PRCONT=$P(PRCVEN,"^",6),PRCVEN=$P(PRCVEN,"^",5)
"RTN","PRCEN",33,0)
 S DR="[PRCE NEW 1358]" D ^DIE
"RTN","PRCEN",34,0)
 I $D(Y)#10 S PRCUA=1 D YN^PRC0A(.X,.Y,"Delete this NEW entry","","No") I Y=1 D
"RTN","PRCEN",35,0)
 . D DELETE^PRC0B1(.X,"410;^PRCS(410,;"_DA) S:X=1 PRCAED=-1
"RTN","PRCEN",36,0)
 . D EN^DDIOL(" **** NEW ENTRY IS "_$S(X=1:"",1:"NOT ")_"DELETED ****")
"RTN","PRCEN",37,0)
 . QUIT
"RTN","PRCEN",38,0)
 I PRCAED'=-1 D
"RTN","PRCEN",39,0)
 . D:$O(^PRCS(410,DA,12,0)) SCPC0^PRCSED
"RTN","PRCEN",40,0)
 . K PRCSF
"RTN","PRCEN",41,0)
 . D W1^PRCSEB
"RTN","PRCEN",42,0)
 . I $D(PRCS2),+^PRCS(410,DA,0),'PRCUA,$$CHECK(PRC410) D
"RTN","PRCEN",43,0)
 .. D W6^PRCSEB
"RTN","PRCEN",44,0)
 .. Q
"RTN","PRCEN",45,0)
 . Q
"RTN","PRCEN",46,0)
 L -^PRCS(410,PRC410)
"RTN","PRCEN",47,0)
 S DIR("B")="NO",DIR(0)="Y",DIR("A")="Do you want to enter another NEW request" D ^DIR Q:'Y!($D(DIRUT))
"RTN","PRCEN",48,0)
 W !! K PRCS2 G EN0
"RTN","PRCEN",49,0)
 Q
"RTN","PRCEN",50,0)
ED ;edit 1358
"RTN","PRCEN",51,0)
 N PRC410,PRC442,PRCHQ,PRCSDR,PRCSN,PRCST,PRCST1,Y,PRC,PRCS,TT,DIE,DA,DIC
"RTN","PRCEN",52,0)
 N DR,DIR,PRCSY,PRCSL,X,X1,T,T1,Z,PRCSDA,DTOUT,PRCVEN,PRCONT
"RTN","PRCEN",53,0)
ED0 K PRCHQ,PRCSDR,PRCSN,PRCST,PRCST1,Y,PRC,PRCS,TT,DIE,DA,DIC,DR,DIR,PRCSY
"RTN","PRCEN",54,0)
 K PRCSL,X,X1,T,T1,Z,PRCSDA
"RTN","PRCEN",55,0)
 D EN3^PRCSUT I '$D(PRC("SITE")) W !!,"You are not an authorized control point user.",!,"Contact your control point official." H 3 Q
"RTN","PRCEN",56,0)
 Q:Y<0
"RTN","PRCEN",57,0)
 S DIC="^PRCS(410,",DIE=DIC,DIC(0)="AEQM",DIC("S")="I $P(^(0),U,4)=1,+$P(^(0),U)'=0,$D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),""^"",5)=PRC(""SITE"") I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCEN",58,0)
 D ^PRCSDIC Q:Y<0  K DIC("S") S (DA,PRCSY,PRCSDA)=+Y ;D LOCK^PRCSUT G ED0:PRCSL=0
"RTN","PRCEN",59,0)
 D  G:'$D(DA) ED0
"RTN","PRCEN",60,0)
 . L +^PRCS(410,DA):$S($D(DILOCKTM):DILOCKTM,1:3)
"RTN","PRCEN",61,0)
 . E  D EN^DDIOL("Another user is editing this transaction! Try Later") K DA
"RTN","PRCEN",62,0)
 . Q
"RTN","PRCEN",63,0)
 D NODE^PRCS58OB(DA,.TRNODE) S PRC410=DA
"RTN","PRCEN",64,0)
 S X=^PRCS(410,DA,0) S:+X PRC("FY")=$P(X,"-",2),PRC("QTR")=+$P(X,"-",3),TT=$P(X,"^",2)
"RTN","PRCEN",65,0)
 D EN2B^PRCSUT3
"RTN","PRCEN",66,0)
 I $D(^PRCS(410,DA,7)),$P(^(7),U,6)]"" D SCPE G OUT ;if obligated
"RTN","PRCEN",67,0)
ED1 I TT="CA" S DR="[PRCSENCT]",DIE=DIC D ^DIE S DA=PRCSY L -^PRCS(410,PRCSY) G ED0
"RTN","PRCEN",68,0)
 ; warn CP offical and allow to quit
"RTN","PRCEN",69,0)
 I $$Q1358(PRC("SITE"),PRC("CP"),$G(TT),$G(DA)) L -^PRCS(410,PRCSY) G ED0
"RTN","PRCEN",70,0)
 ;
"RTN","PRCEN",71,0)
 ;  patch 23, fix problem of not able to exit with "^"
"RTN","PRCEN",72,0)
 I TT'="O" S DR="[PRCSENA 1358]" S DIE=DIC D ^DIE L:$D(Y)>9 -^PRCS(410,PRCSY) G:$D(Y)>9 ED0 S DA=PRCSY
"RTN","PRCEN",73,0)
 I TT="A" S PRC442=$P($G(^PRCS(410,PRC410,10)),U,3) I PRC442 G:$$EN1^PRCE0A(PRC410,PRC442,1) ED1
"RTN","PRCEN",74,0)
 I TT="A",$P(^PRCS(410,DA,0),U,4)=1 S X=$P(^(4),U,6),X1=$P(^(3),U,7) I $J(X,0,2)'=$J(X1,0,2)!('X)!('X1) W $C(7),!,"Adj $ Amt does not equal the total of BOC $ Amts.",!,"Please correct the error.",! K DR G ED1
"RTN","PRCEN",75,0)
 D:TT="A"&($O(^PRCS(410,PRCSY,12,0))) SCPC0^PRCSED
"RTN","PRCEN",76,0)
 I TT="A" D REV D:$$CHECK(PRC410) W6^PRCSEB G OUT
"RTN","PRCEN",77,0)
 ;
"RTN","PRCEN",78,0)
 S DR="[PRCE NEW 1358]" D ^DIE,REV D:$$CHECK(PRC410) W6^PRCSEB
"RTN","PRCEN",79,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you want to edit another request" D ^DIR G OUT:'Y!($D(DIRUT))
"RTN","PRCEN",80,0)
 L -^PRCS(410,PRCSDA)
"RTN","PRCEN",81,0)
 G ED0
"RTN","PRCEN",82,0)
SCPE ;sub control point edit
"RTN","PRCEN",83,0)
 S DR="[PRCSEDS]" D ^DIE
"RTN","PRCEN",84,0)
REV W !!,"Would you like to review this request" S %=2 D YN^DICN G REV:%=0 Q:%'=1  S (N,PRCSZ)=DA,PRCSF=1 D PRF1^PRCSP1 S DA=PRCSZ K X,PRCSF,PRCSZ Q
"RTN","PRCEN",85,0)
OUT L -^PRCS(410,PRCSDA) Q
"RTN","PRCEN",86,0)
 ;
"RTN","PRCEN",87,0)
CHECK(PRC410) ; - Check out a 1358 410 entry for required fields
"RTN","PRCEN",88,0)
 N PRCX,PRC0,PRC11,PRCER,PRC3,PRC1
"RTN","PRCEN",89,0)
 Q:'$G(PRC410) -1
"RTN","PRCEN",90,0)
 ;
"RTN","PRCEN",91,0)
 ; get data
"RTN","PRCEN",92,0)
 F PRCX=0,1,3,11 S @("PRC"_PRCX)=$G(^PRCS(410,PRC410,PRCX))
"RTN","PRCEN",93,0)
 S PRCX=$G(^PRCS(410.9,$S(+$P(PRC11,"^",5):+$P(PRC11,"^",5),1:+$P(PRC11,"^",4)),0))
"RTN","PRCEN",94,0)
 S PRCER=0
"RTN","PRCEN",95,0)
 ;
"RTN","PRCEN",96,0)
 ; make sure I have a 1358
"RTN","PRCEN",97,0)
 I $P(PRC0,"^",4)'=1 Q 1
"RTN","PRCEN",98,0)
 ;
"RTN","PRCEN",99,0)
 ; start checking out data
"RTN","PRCEN",100,0)
 I '$D(^PRCS(410,PRC410,8,1,0)) D CKER("PURPOSE is Missing")
"RTN","PRCEN",101,0)
 ;
"RTN","PRCEN",102,0)
 ; done checking if not an obligation
"RTN","PRCEN",103,0)
 I $P(PRC0,"^",2)'="O" G CKEX
"RTN","PRCEN",104,0)
 ;
"RTN","PRCEN",105,0)
 ; continue checking
"RTN","PRCEN",106,0)
 I '$P(PRC11,"^",4) D CKER("AUTHORITY is Missing")
"RTN","PRCEN",107,0)
 I $P(PRC11,"^",5),'$D(^PRCS(410.9,"AC",$P(PRC11,"^",4),$P(PRC11,"^",5))) D CKER("SUB-AUTHORITY does not correspond to AUTHORITY")
"RTN","PRCEN",108,0)
 I '$P(PRC11,"^",5),$O(^PRCS(410.9,"AC",+$P(PRC11,"^",4),0)) D CKER("SUB-AUTHORITY is Missing")
"RTN","PRCEN",109,0)
 I $P(PRCX,"^",5),'$P(PRC3,"^",4) D CKER("VENDOR is Missing")
"RTN","PRCEN",110,0)
 I $P(PRCX,"^",6),'$L($P(PRC3,"^",10)) D CKER("CONTRACT is Missing")
"RTN","PRCEN",111,0)
 I '$P(PRC1,"^",6) D CKER("Service Start Date is Missing")
"RTN","PRCEN",112,0)
 I '$P(PRC1,"^",7) D CKER("Service End Date is Missing")
"RTN","PRCEN",113,0)
 ;
"RTN","PRCEN",114,0)
CKEX I PRCER S PRCER=0 F  S PRCER=$O(PRCER(PRCER)) Q:'PRCER  W !?5,PRCER(PRCER),"!!!"
"RTN","PRCEN",115,0)
 Q $S($O(PRCER(0)):0,1:1)
"RTN","PRCEN",116,0)
 ;
"RTN","PRCEN",117,0)
CKER(X) ;
"RTN","PRCEN",118,0)
 S PRCER=PRCER+1
"RTN","PRCEN",119,0)
 S PRCER(PRCER)=X
"RTN","PRCEN",120,0)
 Q
"RTN","PRCEN",121,0)
 ;
"RTN","PRCEN",122,0)
Q1358(PRCSTA,PRCFCP,PRCTT,PRCDA) ; Quit 1358 Process
"RTN","PRCEN",123,0)
 ; This API warns a control point offical that they will be set as
"RTN","PRCEN",124,0)
 ; the requestor on the 1358 and thus cannot also approve it.
"RTN","PRCEN",125,0)
 ; The API will return 1 (true) if the user decided to quit the
"RTN","PRCEN",126,0)
 ; current process before being set as the requestor.
"RTN","PRCEN",127,0)
 ;
"RTN","PRCEN",128,0)
 ; inputs
"RTN","PRCEN",129,0)
 ;   PRCSTA - station number
"RTN","PRCEN",130,0)
 ;   PRCFCP - fund control point
"RTN","PRCEN",131,0)
 ;   PRCTT  - (optional) transaction type, pass "A" for adjustment
"RTN","PRCEN",132,0)
 ;   PRCDA  - (optional) file 410 ien of 1358 when editing 1358
"RTN","PRCEN",133,0)
 ; returns boolean value (0 or 1)
"RTN","PRCEN",134,0)
 ;   = 0 to proceed with process
"RTN","PRCEN",135,0)
 ;   = 1 to quit process
"RTN","PRCEN",136,0)
 ;
"RTN","PRCEN",137,0)
 N RET
"RTN","PRCEN",138,0)
 S RET=0 ; init value to return
"RTN","PRCEN",139,0)
 ;
"RTN","PRCEN",140,0)
 ; if user is control point official for input station and FCP
"RTN","PRCEN",141,0)
 I $G(PRCSTA)]"",$G(PRCFCP)]"",$D(^PRC(420,"A",DUZ,PRCSTA,+PRCFCP,1)) D
"RTN","PRCEN",142,0)
 . N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","PRCEN",143,0)
 . ;
"RTN","PRCEN",144,0)
 . ; don't warn when editing a 1358 if user is already the requestor
"RTN","PRCEN",145,0)
 . I $G(PRCDA),$P($G(^PRCS(410,PRCDA,7)),"^")=DUZ Q
"RTN","PRCEN",146,0)
 . ;
"RTN","PRCEN",147,0)
 . I $G(PRCTT)'="A" D
"RTN","PRCEN",148,0)
 . . W !,"WARNING: The system will assign you as the CP Clerk (Requestor) of this 1358."
"RTN","PRCEN",149,0)
 . . W !,"You will be unable to approve a 1358 on which you are the REQUESTOR due to"
"RTN","PRCEN",150,0)
 . . W !,"segregation of duties."
"RTN","PRCEN",151,0)
 . I $G(PRCTT)="A" D
"RTN","PRCEN",152,0)
 . . W !,"WARNING: The system will assign you as the CP Clerk (Requestor) of this 1358"
"RTN","PRCEN",153,0)
 . . W !,"Adjustment.  You will be unable to approve a 1358 Adjustment on which you"
"RTN","PRCEN",154,0)
 . . W !,"are the REQUESTOR due to segregation of duties."
"RTN","PRCEN",155,0)
 . ;
"RTN","PRCEN",156,0)
 . S DIR(0)="Y",DIR("A")="Do you want to proceed (Y/N)",DIR("B")="NO"
"RTN","PRCEN",157,0)
 . D ^DIR K DIR I $D(DIRUT)!'Y S RET=1
"RTN","PRCEN",158,0)
 . W !
"RTN","PRCEN",159,0)
 ;
"RTN","PRCEN",160,0)
 Q RET
"RTN","PRCEOB1")
0^12^B5824737^B4186076
"RTN","PRCEOB1",1,0)
PRCEOB1 ;WISC/CTB/CLH-SUBROUTINES FOR PRCEOB ;2/10/92
"RTN","PRCEOB1",2,0)
V ;;5.1;IFCAP;**148**;Oct 20, 2000;Build 5
"RTN","PRCEOB1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCEOB1",4,0)
SCREEN D HILO^PRCFQ,SW,SC Q
"RTN","PRCEOB1",5,0)
 Q
"RTN","PRCEOB1",6,0)
SW ;SWITCH BOCS IF NECESSARY
"RTN","PRCEOB1",7,0)
 F I=6:1:9 S @("S"_I)=$P(TRNODE(3),"^",I)
"RTN","PRCEOB1",8,0)
 I S8=0!(S9=0) S S8="",S9=""
"RTN","PRCEOB1",9,0)
 I S6=0!(S7=0) S S6=S8,S7=S9,S8="",S9=""
"RTN","PRCEOB1",10,0)
 S $P(TRNODE(3),"^",6,9)=S6_"^"_S7_"^"_S8_"^"_S9 K S6,S7,S8,S9 Q
"RTN","PRCEOB1",11,0)
 ;
"RTN","PRCEOB1",12,0)
SC ;DISPLAY SCREEN
"RTN","PRCEOB1",13,0)
 W @IOF,!?15,"1358 TRANSACTION - ",IOINHI,$P(TRNODE(0),"^"),IOINLOW
"RTN","PRCEOB1",14,0)
 W !!,"  COST CENTER: ",IOINHI,+$P(TRNODE(3),"^",3),IOINLOW,?IOM-4\2,"AMOUNT: ",IOINHI,"$ ",$J($P(TRNODE(4),"^"),0,2)
"RTN","PRCEOB1",15,0)
 W !!,IOINLOW,"BOC #1: ",IOINHI,+$P(TRNODE(3),"^",6),IOINLOW,?IOM-10\2,"AMOUNT #1: ",IOINHI,"$ "_$J($P(TRNODE(3),"^",7),0,2)
"RTN","PRCEOB1",16,0)
 I $P(TRNODE(3),"^",8,9)'="^" W !!,IOINLOW,"BOC #2: ",IOINHI,+$P(TRNODE(3),"^",8),?IOM-10\2,IOINLOW,"AMOUNT #2: ",IOINHI,"$ "_$J($P(TRNODE(3),"^",9),0,2)
"RTN","PRCEOB1",17,0)
 W !!,IOINLOW,"AUTHORITY: ",IOINHI,$P($G(^PRCS(410.9,+$P($G(TRNODE(11)),"^",4),0)),"^")," ",$P($G(^(0)),"^",2)
"RTN","PRCEOB1",18,0)
 W:$P($G(TRNODE(11)),"^",5) !,IOINLOW,"SUB: ",IOINHI,$P($G(^PRCS(410.9,+$P($G(TRNODE(11)),"^",5),0)),"^")," ",$P($G(^(0)),"^",2)
"RTN","PRCEOB1",19,0)
 W !,IOINLOW,"SERVICE START DATE: ",IOINHI,$$FMTE^XLFDT($P($G(TRNODE(1)),"^",6))
"RTN","PRCEOB1",20,0)
 W !,IOINLOW,"SERVICE END DATE: ",IOINHI,$$FMTE^XLFDT($P($G(TRNODE(1)),"^",7))
"RTN","PRCEOB1",21,0)
 W IOINORM Q:'$D(^PRCS(410,PRCFA("TRDA"),8,0))#2  W !!,IOINHI K ^UTILITY($J,"W") S DIWF="W",DIWL=1,DIWR=IOM*.75\1,N=0 F I=1:1 S N=$O(^PRCS(410,PRCFA("TRDA"),8,N)) Q:'N  S X=^(N,0) D DIWP^PRCUTL($G(DA))
"RTN","PRCEOB1",22,0)
 D ^DIWW,DIWKILL^PRCFQ W IOINORM Q
"RTN","PRCEOB1",23,0)
 S $P(^PRC(424,DA,0),"^",2,14)=X,DIK="^PRC(424," D IX1^DIK K DIK S %=1 Q
"RTN","PRCESOE")
0^17^B45274590^B36367973
"RTN","PRCESOE",1,0)
PRCESOE ;WISC/CLH/CTB/SJG/ASU - 1358 OBLIGATION ; 08/22/94  5:11 PM
"RTN","PRCESOE",2,0)
V ;;5.1;IFCAP;**148**;Oct 20, 2000;Build 5
"RTN","PRCESOE",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCESOE",4,0)
 K PRC,PRCF,Y
"RTN","PRCESOE",5,0)
 N PRCFSC S PRCFSC=1    ;PRC*5.1*148  ENTERED FROM 1358 OBLIGATE
"RTN","PRCESOE",6,0)
 D OUT
"RTN","PRCESOE",7,0)
 S PRCF("X")="AB"
"RTN","PRCESOE",8,0)
 D ^PRCFSITE Q:'%
"RTN","PRCESOE",9,0)
 D LOOKUP G:Y<0 OUT
"RTN","PRCESOE",10,0)
 D K1A^PRCFFUZ
"RTN","PRCESOE",11,0)
 S (OB,DA)=+Y ; ien for file 410
"RTN","PRCESOE",12,0)
 S PRCFA("RETRAN")=0
"RTN","PRCESOE",13,0)
SC ; Entry point for rebuild/retransmit
"RTN","PRCESOE",14,0)
 D NODE^PRCS58OB(DA,.TRNODE) ; set file 410 values into TRNODE array
"RTN","PRCESOE",15,0)
 S PRCFA("TRDA")=OB
"RTN","PRCESOE",16,0)
 D SCREEN^PRCEOB1 W !
"RTN","PRCESOE",17,0)
 D VENCONO^PRCFFU15(OB) ; display vendor & contract info, if exists
"RTN","PRCESOE",18,0)
 ; PRC*5.1*148 start
"RTN","PRCESOE",19,0)
 ; if Obligator is a requestor, violation to segregation of duties
"RTN","PRCESOE",20,0)
 I $P($G(TRNODE(7)),"^",1)=DUZ D  G OUT
"RTN","PRCESOE",21,0)
 . W !!,"You are the CP Clerk (Requestor) on this 1358 transaction."
"RTN","PRCESOE",22,0)
 . W !,"Per Segregation of Duties, the CP Clerk (Requestor)"
"RTN","PRCESOE",23,0)
 . W " is not permitted to "
"RTN","PRCESOE",24,0)
 . W $S($G(PRCFSC):"Obligate",1:"Rebuild/Retransmit")," the 1358."
"RTN","PRCESOE",25,0)
 . I $G(PRCFSC) Q
"RTN","PRCESOE",26,0)
 . W ! D EN^DDIOL("  ** Press RETURN to continue **")
"RTN","PRCESOE",27,0)
 . R X:DTIME Q
"RTN","PRCESOE",28,0)
 ; if Obligator is a approver, violation to segregation of duties
"RTN","PRCESOE",29,0)
 I $P($G(TRNODE(7)),"^",3)=DUZ D  G OUT
"RTN","PRCESOE",30,0)
 . W !!,"You are the Approver on this 1358 transaction."
"RTN","PRCESOE",31,0)
 . W !,"Per Segregation of Duties, the Approver is not permitted to "
"RTN","PRCESOE",32,0)
 . W $S($G(PRCFSC):"Obligate",1:"Rebuild/Retransmit")," the 1358."
"RTN","PRCESOE",33,0)
 . I $G(PRCFSC) Q
"RTN","PRCESOE",34,0)
 . W ! D EN^DDIOL("  ** Press RETURN to continue **")
"RTN","PRCESOE",35,0)
 . R X:DTIME Q
"RTN","PRCESOE",36,0)
 ; PRC*5.1*148 end
"RTN","PRCESOE",37,0)
 S FLDCHK=0
"RTN","PRCESOE",38,0)
 D EN^PRCFFU14(OB) ; edit auto accrual info
"RTN","PRCESOE",39,0)
 I ACCEDIT=1 G SC
"RTN","PRCESOE",40,0)
 I FLDCHK=1 D OUT G V
"RTN","PRCESOE",41,0)
OKAY S PRCFA("IDES")="1358 Obligation"
"RTN","PRCESOE",42,0)
 D OKAY^PRCFFU ; ask 'Is info correct?'
"RTN","PRCESOE",43,0)
 I $D(DIRUT) D MSG H 3 G OUT
"RTN","PRCESOE",44,0)
 S ESIGCHK=1
"RTN","PRCESOE",45,0)
 S FISCEDIT=0
"RTN","PRCESOE",46,0)
 I 'Y D 1358^PRCFFU13 ; edit cost center or boc?
"RTN","PRCESOE",47,0)
 I 'ESIGCHK D MSG H 3 G OUT
"RTN","PRCESOE",48,0)
 I FISCEDIT G SC
"RTN","PRCESOE",49,0)
 S PRC("RBDT")=$P(TRNODE(0),U,11)
"RTN","PRCESOE",50,0)
 S PCP=$P(TRNODE(0),"-",4)
"RTN","PRCESOE",51,0)
 S PQT=$P(TRNODE(0),"-",3)
"RTN","PRCESOE",52,0)
 D CPBAL^PRCFFMO1 ; display control point balance
"RTN","PRCESOE",53,0)
 K PQT,PRCF("NOBAL")
"RTN","PRCESOE",54,0)
 K PRCTMP
"RTN","PRCESOE",55,0)
 I '$P(TRNODE(0),U,11) D
"RTN","PRCESOE",56,0)
 . D ERS410^PRC0G(DA)
"RTN","PRCESOE",57,0)
 . S TRNODE(0)=^PRCS(410,DA,0)
"RTN","PRCESOE",58,0)
 S PRC("FY")=$P(TRNODE(0),"-",2)
"RTN","PRCESOE",59,0)
 S PRC("QTR")=$P(TRNODE(0),"-",3)
"RTN","PRCESOE",60,0)
 S PRC("CP")=$P(TRNODE(0),"-",4)
"RTN","PRCESOE",61,0)
 I $G(PRCRGS)<1 D OVCOM1^PRCFFU10 I PRCFA("OVCOM")=1!(PRCFA("OVCOM")=2) D REQFAIL^PRCFFU10,MSG H 3 G OUT
"RTN","PRCESOE",62,0)
 W ! D OKAY2^PRCFFU ; ask 'OK to continue?'
"RTN","PRCESOE",63,0)
 I 'Y!($D(DTOUT)) D MSG H 3 G OUT
"RTN","PRCESOE",64,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=0 D  G:'$D(DA) OUT
"RTN","PRCESOE",65,0)
 . K DA,X
"RTN","PRCESOE",66,0)
 . S PRCHP("T")=21
"RTN","PRCESOE",67,0)
 . S PRCHP("S")=4
"RTN","PRCESOE",68,0)
 . S PRCHP("A")="1358 Obligation Number"
"RTN","PRCESOE",69,0)
 . S PRCFA(1358)=""
"RTN","PRCESOE",70,0)
 . D EN^PRCHPAT ; ask for obligation #, set up 442 record
"RTN","PRCESOE",71,0)
 . K PRCFA(1358),PRCHP
"RTN","PRCESOE",72,0)
 . I '$D(DA) D MSG3
"RTN","PRCESOE",73,0)
 . Q
"RTN","PRCESOE",74,0)
VAR I $D(PRCFA("RETRAN")),PRCFA("RETRAN") S DA=POIEN ; 442 ien
"RTN","PRCESOE",75,0)
 D PAT^PRCH58OB(DA,.PODA,.PO,.PATNUM) ; set up parameterized variables
"RTN","PRCESOE",76,0)
 N PRCFDEL,AMT,CS,DA,DIK,TIME,MOD
"RTN","PRCESOE",77,0)
 S PRCFA("BBFY")=$TR($P(TRNODE(3),"^",11)," ")
"RTN","PRCESOE",78,0)
 S PRCFA("MOD")="E^0^Original Entry"
"RTN","PRCESOE",79,0)
 S PRCFA("MP")=$P(PO(0),U,2)
"RTN","PRCESOE",80,0)
 S PRCFA("PATNUM")=$P($P(PO(0),"^"),"-",2)
"RTN","PRCESOE",81,0)
 S PRCFA("PODA")=PODA
"RTN","PRCESOE",82,0)
 S PRCFA("REF")=$P(PO(0),U)
"RTN","PRCESOE",83,0)
 ; S PRCFA("SFC")=$P(PO(0),U,19)
"RTN","PRCESOE",84,0)
 S PRCFA("SYS")="FMS"
"RTN","PRCESOE",85,0)
 S PRCFA("TT")="SO"
"RTN","PRCESOE",86,0)
VAR11 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1 D  G VAR2
"RTN","PRCESOE",87,0)
 . D RETRANO^PRCESOE2 ; put date in FMS transaction into PRCFA("OBLDATE")
"RTN","PRCESOE",88,0)
 . S X=PRCFA("OBLDATE")
"RTN","PRCESOE",89,0)
 S X=PRC("RBDT")
"RTN","PRCESOE",90,0)
 I X<DT!'X D NOW^%DTC
"RTN","PRCESOE",91,0)
VAR2 S Y=X D D^PRCFQ ; convert date to external format
"RTN","PRCESOE",92,0)
 S %DT="AEX"
"RTN","PRCESOE",93,0)
 S %DT("B")=Y
"RTN","PRCESOE",94,0)
 S %DT("A")="Select Obligation Processing Date: "
"RTN","PRCESOE",95,0)
 W ! D ^%DT K %DT
"RTN","PRCESOE",96,0)
 I Y<0 D EXIT G OUT
"RTN","PRCESOE",97,0)
 S PRCFA("OBLDATE")=Y
"RTN","PRCESOE",98,0)
 S EXIT=0
"RTN","PRCESOE",99,0)
 D ENO^PRCESOE2 ; processes PRCFA("OBLDATE"), gets accounting period
"RTN","PRCESOE",100,0)
 I EXIT=1 D EXIT,KILL^PRCESOE2 G OUT
"RTN","PRCESOE",101,0)
 I PRC("RBDT")'<$P(^PRC(420,PRC("SITE"),0),"^",9),$P($$DATE^PRC0C(PRCFA("OBLDATE"),"I"),U,1,2)'=$P($$DATE^PRC0C(PRC("RBDT"),"I"),U,1,2) D MSG1^PRCFFUD S X=PRC("RBDT") G VAR11
"RTN","PRCESOE",102,0)
 ;
"RTN","PRCESOE",103,0)
GO ; Prompt user for final go-ahead for the document creation
"RTN","PRCESOE",104,0)
 D GO^PRCFFU ; ask 'Transmit?'
"RTN","PRCESOE",105,0)
 I 'Y!($D(DIRUT)) G EXIT
"RTN","PRCESOE",106,0)
 ;
"RTN","PRCESOE",107,0)
ESIG ; Enter the Electronic Signature and away it goes!
"RTN","PRCESOE",108,0)
 W !,"The Electronic Signature must now be entered to generate the "_PRCFA("TYPE")_" Document.",!
"RTN","PRCESOE",109,0)
 D SIG^PRCFFU4
"RTN","PRCESOE",110,0)
 I $D(PRCFA("SIGFAIL")) D  G EXIT
"RTN","PRCESOE",111,0)
 . K PRCFA("SIGFAIL")
"RTN","PRCESOE",112,0)
 . D MSG2(ESIGMSG)
"RTN","PRCESOE",113,0)
 . Q
"RTN","PRCESOE",114,0)
 ;
"RTN","PRCESOE",115,0)
 D OB1^PRCS58OB(PRCFA("TRDA"),PODA) ; save 442 ien in file 410
"RTN","PRCESOE",116,0)
 D COB^PRCH58OB(PODA,.TRNODE,.PO,PRCFA("TRDA"),X) ; stuff some values into 442
"RTN","PRCESOE",117,0)
 D PODT^PRCS58OB(PRCFA("PODA"),PRCFA("OBLDATE")) ; save PRCFA("OBLDATE")  in file 442 as PO DATE
"RTN","PRCESOE",118,0)
 S PRCFA("BBFY")=$$BBFY^PRCFFU5(PRCFA("PODA"))
"RTN","PRCESOE",119,0)
 D GENDIQ^PRCFFU7(442,PRCFA("PODA"),".1;.07;.03;17","IEN","")
"RTN","PRCESOE",120,0)
 D EDIT410^PRCFFUD(PRCFA("TRDA"),"O") ; updates running balance quarter & status in 410
"RTN","PRCESOE",121,0)
 S PRC("CP")=+$P(PO(0),"^",3)
"RTN","PRCESOE",122,0)
 ;
"RTN","PRCESOE",123,0)
EDIT ; Check fund/year dictionary for required FMS fields
"RTN","PRCESOE",124,0)
 D EDIT^PRCFFU ; sets up PRCFMO array to use in building LIN segment
"RTN","PRCESOE",125,0)
 ;
"RTN","PRCESOE",126,0)
 S IDFLAG="I" ; flag to FMS indicating a dollar increase
"RTN","PRCESOE",127,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1 D SET1358^PRCFFERT ; do rebuild
"RTN","PRCESOE",128,0)
 ;
"RTN","PRCESOE",129,0)
STACK ; Create entry in GECS Stack File
"RTN","PRCESOE",130,0)
 D STACK^PRCFFU(0) ; set up CTL,DOC segs of code sheet, (0) means no batch#
"RTN","PRCESOE",131,0)
 ;
"RTN","PRCESOE",132,0)
SEGS ; Create entry in TMP($J, for remaining segments
"RTN","PRCESOE",133,0)
 K ^TMP($J,"PRCMO")
"RTN","PRCESOE",134,0)
 N FMSINT S FMSINT=+PO
"RTN","PRCESOE",135,0)
 S FMSMOD=$P(PRCFA("MOD"),U,1)
"RTN","PRCESOE",136,0)
 D NEW^PRCFFU1(FMSINT,PRCFA("TT"),FMSMOD) ; builds remaining segs
"RTN","PRCESOE",137,0)
 ;
"RTN","PRCESOE",138,0)
 ; Transfers remaining segs from TMP($J, into GECS Stack File
"RTN","PRCESOE",139,0)
 N LOOP S LOOP=0
"RTN","PRCESOE",140,0)
 F  S LOOP=$O(^TMP($J,"PRCMO",GECSFMS("DA"),LOOP)) Q:'LOOP  D SETCS^GECSSTAA(GECSFMS("DA"),^(LOOP))
"RTN","PRCESOE",141,0)
 K ^TMP($J,"PRCMO")
"RTN","PRCESOE",142,0)
 ;
"RTN","PRCESOE",143,0)
TRANS ; Mark the FMS transaction document as queued for transmission
"RTN","PRCESOE",144,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCESOE",145,0)
 N P2 S P2=+PO
"RTN","PRCESOE",146,0)
 S $P(P2,"/",3)=+OB
"RTN","PRCESOE",147,0)
 S $P(P2,"/",5)=$P(PRCFA("ACCPD"),U)
"RTN","PRCESOE",148,0)
 S $P(P2,"/",6)=PRCFA("OBLDATE")
"RTN","PRCESOE",149,0)
 D SETPARAM^GECSSDCT(GECSFMS("DA"),P2)
"RTN","PRCESOE",150,0)
 ;
"RTN","PRCESOE",151,0)
POBAL ; Enter Obligation Data into Purchase Order Record
"RTN","PRCESOE",152,0)
 ;
"RTN","PRCESOE",153,0)
 ; add FMS document info to node 10 of file 442
"RTN","PRCESOE",154,0)
 D EN7^PRCFFU41(PRCFA("TT"),FMSMOD,PRCFA("OBLDATE"),PRCFA("PATNUM"))
"RTN","PRCESOE",155,0)
 ;
"RTN","PRCESOE",156,0)
 ; create daily record in file 424
"RTN","PRCESOE",157,0)
 D POST G OUT:'%
"RTN","PRCESOE",158,0)
 ;
"RTN","PRCESOE",159,0)
 ; continue processing if this is not a rebuild
"RTN","PRCESOE",160,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN") D OUT Q
"RTN","PRCESOE",161,0)
 S X=100
"RTN","PRCESOE",162,0)
 S DA=PRCFA("PODA")
"RTN","PRCESOE",163,0)
 D ENF^PRCHSTAT
"RTN","PRCESOE",164,0)
 S AMT=$P(PO(0),U,7)+$S(+$P(PO(0),U,9)'=0:$P(PO(0),U,9),1:"")
"RTN","PRCESOE",165,0)
 D NOW^PRCFQ
"RTN","PRCESOE",166,0)
 S TIME=X
"RTN","PRCESOE",167,0)
 S X=$P(TRNODE(4),"^",8) ; file 410 transaction amount
"RTN","PRCESOE",168,0)
 S DA=PRCFA("TRDA") ; file 410 ien
"RTN","PRCESOE",169,0)
 D TRANK^PRCSES
"RTN","PRCESOE",170,0)
 S DEL=$S('$D(DEL):"",1:DEL)
"RTN","PRCESOE",171,0)
 D CS^PRCS58OB(OB,AMT,TIME,PATNUM,PODA,DEL,X,.PRC)
"RTN","PRCESOE",172,0)
 W !!,"...updating 1358 Obligation balances...",!
"RTN","PRCESOE",173,0)
 S ^PRC(442,PODA,8)=AMT_"^0^0"
"RTN","PRCESOE",174,0)
 S X=AMT D TRANS1^PRCSES
"RTN","PRCESOE",175,0)
 S X=AMT D  W !! G V
"RTN","PRCESOE",176,0)
 . D TRANS^PRCSES
"RTN","PRCESOE",177,0)
 . D BULLET^PRCEFIS1
"RTN","PRCESOE",178,0)
 . D OUT
"RTN","PRCESOE",179,0)
 ;
"RTN","PRCESOE",180,0)
OUT D K1B^PRCFFUZ
"RTN","PRCESOE",181,0)
 D K1C^PRCFFUZ
"RTN","PRCESOE",182,0)
 Q
"RTN","PRCESOE",183,0)
 ;
"RTN","PRCESOE",184,0)
EXIT I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=0 D MSG1,KILL^PRCH58OB(PODA)
"RTN","PRCESOE",185,0)
 E  D MSG
"RTN","PRCESOE",186,0)
 Q
"RTN","PRCESOE",187,0)
 ;
"RTN","PRCESOE",188,0)
KILL D KILL^PRCH58OB(PODA) G OUT
"RTN","PRCESOE",189,0)
 ;
"RTN","PRCESOE",190,0)
LOOKUP ; Lookup 1358 transaction which is pending fiscal action.
"RTN","PRCESOE",191,0)
 D LOOKUP^PRCESOE1
"RTN","PRCESOE",192,0)
 Q
"RTN","PRCESOE",193,0)
 ;
"RTN","PRCESOE",194,0)
POST ; Post data in file 424
"RTN","PRCESOE",195,0)
 I $D(PRCFA("RETRAN")),'PRCFA("RETRAN") D POST^PRCESOE1
"RTN","PRCESOE",196,0)
 Q
"RTN","PRCESOE",197,0)
 ;
"RTN","PRCESOE",198,0)
 ; Message processing
"RTN","PRCESOE",199,0)
MSG D MSG^PRCESOE1 Q
"RTN","PRCESOE",200,0)
MSG1 D MSG1^PRCESOE1 Q
"RTN","PRCESOE",201,0)
MSG2(MSG) D MSG2^PRCESOE1(MSG) Q
"RTN","PRCESOE",202,0)
MSG3 D MSG3^PRCESOE1 Q
"RTN","PRCESOM")
0^18^B59523571^B49737920
"RTN","PRCESOM",1,0)
PRCESOM ;WISC/SJG/ASU - CONTINUATION OF 1358 ADJUST OBLIAGTION PRCEADJ1 ;4/27/94  2:13 PM
"RTN","PRCESOM",2,0)
V ;;5.1;IFCAP;**148**;Oct 20, 2000;Build 5
"RTN","PRCESOM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCESOM",4,0)
 N TI,PRCFASYS,IOINLOW,IOINHI,IOINORM,DIR,AMT,OLDTT,CS,HASH,DIE,DR,LAUTH,LBAL,TAUTH,TBAL,DLAYGO
"RTN","PRCESOM",5,0)
 D SCREEN
"RTN","PRCESOM",6,0)
 S PRC("CP")=$P(TRNODE(0),"-",4)
"RTN","PRCESOM",7,0)
 S PRC("RBDT")=$P(TRNODE(0),U,11)
"RTN","PRCESOM",8,0)
 I $G(PRCRGS)<1 D OVCOM1^PRCFFU10 I PRCFA("OVCOM")=1!(PRCFA("OVCOM")=2) D REQFAIL^PRCFFU10,MSG G OUT
"RTN","PRCESOM",9,0)
 ; PRC*5.1*148 start
"RTN","PRCESOM",10,0)
 ; if Obligator is a requestor, violation to segregation of duties
"RTN","PRCESOM",11,0)
 I $P($G(TRNODE(7)),"^",1)=DUZ D  S Y=0 D MSG G OUT
"RTN","PRCESOM",12,0)
 . W !!,"You are the CP Clerk (Requestor) on this 1358 transaction."
"RTN","PRCESOM",13,0)
 . W !,"Per Segregation of Duties, the CP Clerk (Requestor)"
"RTN","PRCESOM",14,0)
 . W " is not permitted to "
"RTN","PRCESOM",15,0)
 . W $S($G(PRCFA("RETRAN")):"Rebuild/Retransmit",1:"Obligate")," the 1358."
"RTN","PRCESOM",16,0)
 . I '$G(PRCFA("RETRAN")) Q
"RTN","PRCESOM",17,0)
 . W ! D EN^DDIOL("  ** Press RETURN to continue **")
"RTN","PRCESOM",18,0)
 . R X:DTIME Q
"RTN","PRCESOM",19,0)
 ; if Obligator is a approver, violation to segregation of duties
"RTN","PRCESOM",20,0)
 I $P($G(TRNODE(7)),"^",3)=DUZ D  S Y=0 D MSG G OUT
"RTN","PRCESOM",21,0)
 . W !!,"You are the Approver on this 1358 transaction."
"RTN","PRCESOM",22,0)
 . W !,"Per Segregation of Duties, the Approver is not permitted to "
"RTN","PRCESOM",23,0)
 . W $S($G(PRCFA("RETRAN")):"Rebuild/Retransmit",1:"Obligate")," the 1358."
"RTN","PRCESOM",24,0)
 . I '$G(PRCFA("RETRAN")) Q
"RTN","PRCESOM",25,0)
 . W ! D EN^DDIOL("  ** Press RETURN to continue **")
"RTN","PRCESOM",26,0)
 . R X:DTIME Q
"RTN","PRCESOM",27,0)
 ; PRC*5.1*148 end
"RTN","PRCESOM",28,0)
 ;
"RTN","PRCESOM",29,0)
 D OKAY2^PRCFFU ; ask 'OK to continue?'
"RTN","PRCESOM",30,0)
 I 'Y!($D(DIRUT)) D MSG G OUT
"RTN","PRCESOM",31,0)
 S AMT=$P(TRNODE(4),U,8)
"RTN","PRCESOM",32,0)
K F I=7,9 S AMT(I)=$P(TRNODE(3),"^",I) S:AMT(I)<0 AMT(I)=-AMT(I) S AMT(I)=AMT(I)*100
"RTN","PRCESOM",33,0)
 S PRC("CP")=$P(TRNODE(0),"-",4)
"RTN","PRCESOM",34,0)
 S PRCFA("BBFY")=$$BBFY^PRCFFU5(+PO)
"RTN","PRCESOM",35,0)
 S PRCFA("MOD")="M^1^Modification Entry"
"RTN","PRCESOM",36,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1,$P(PRCFA("GECS"),"^",2)="E" S PRCFA("MOD")="E^0^Original Document"
"RTN","PRCESOM",37,0)
 S PRCFA("MP")=$P(PO(0),U,2)
"RTN","PRCESOM",38,0)
 S PRCFA("PATNUM")=$P($P(PO(0),U),"-",2)
"RTN","PRCESOM",39,0)
 S PRCFA("PODA")=PODA
"RTN","PRCESOM",40,0)
 S PRCFA("REF")=$P(PO(0),U)
"RTN","PRCESOM",41,0)
 ; S PRCFA("SFC")=$P(PO(0),U,19)
"RTN","PRCESOM",42,0)
 S PRCFA("SYS")="FMS"
"RTN","PRCESOM",43,0)
 S PRCFA("TT")="SO"
"RTN","PRCESOM",44,0)
 I $D(GECSDATA),$G(GECSDATA(2100.1,GECSDATA,.01,"E"))[("AR-") S PRCFA("TT")="AR"
"RTN","PRCESOM",45,0)
EDIT ; 
"RTN","PRCESOM",46,0)
 I $G(PRCFA("ACCEDIT"))=1 D TAG33^PRCFFU9 ; sets PRCFA("PPT") & PRCFA("MOMREQ")
"RTN","PRCESOM",47,0)
 I $G(PRCFA("RETRAN"))=1 D TAG33^PRCFFU9 ; sets PRCFA("PPT") & PRCFA("MOMREQ")
"RTN","PRCESOM",48,0)
 ;
"RTN","PRCESOM",49,0)
 ; Compare adjustment to original 1358
"RTN","PRCESOM",50,0)
 N RETURN,ERFLAG,IDFLAG,TYPE
"RTN","PRCESOM",51,0)
 S RETURN=$$COMP^PRCFFU6(PRC442,PRC410,.RETURN)
"RTN","PRCESOM",52,0)
 S ERFLAG=$P(RETURN,U,1)
"RTN","PRCESOM",53,0)
 S IDFLAG=$P(RETURN,U,2)
"RTN","PRCESOM",54,0)
 S TYPE=$P(RETURN,U,2)
"RTN","PRCESOM",55,0)
 I ERFLAG D  Q 
"RTN","PRCESOM",56,0)
 . W !!,"  Cannot continue...one or more of the following fields have changed..."
"RTN","PRCESOM",57,0)
 . N LOOP S LOOP=""
"RTN","PRCESOM",58,0)
 . F  S LOOP=$O(PRCFA("CHG",LOOP)) Q:LOOP=""  I PRCFA("CHG",LOOP)]"" W !,?5,PRCFA("CHG",LOOP)
"RTN","PRCESOM",59,0)
 . K PRCFA("CHG")
"RTN","PRCESOM",60,0)
 . W !!,"  Please be sure that the VENDOR, FUND CONTROL POINT, BOC, and COST CENTER",!,"  fields are the same as the original 1358 obligation!"
"RTN","PRCESOM",61,0)
 . D MSG
"RTN","PRCESOM",62,0)
 . D EN^DDIOL("  ** Press RETURN to continue **")
"RTN","PRCESOM",63,0)
 . R X:DTIME
"RTN","PRCESOM",64,0)
 . D OUT
"RTN","PRCESOM",65,0)
 . Q
"RTN","PRCESOM",66,0)
 ;
"RTN","PRCESOM",67,0)
DT I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1 D  G DT1
"RTN","PRCESOM",68,0)
 . D RETRANM^PRCESOE2 ; get account & obligation processing dates
"RTN","PRCESOM",69,0)
 . S Y=PRCFA("OBLDATE")
"RTN","PRCESOM",70,0)
 S Y=PRC("RBDT") I Y<DT!'Y D NOW^%DTC S Y=X
"RTN","PRCESOM",71,0)
DT1 D D^PRCFQ ; convert date to external format
"RTN","PRCESOM",72,0)
 S %DT="AEX"
"RTN","PRCESOM",73,0)
 S %DT("A")="Select Obligation Processing Date: "
"RTN","PRCESOM",74,0)
 S %DT("B")=Y
"RTN","PRCESOM",75,0)
 W ! D ^%DT
"RTN","PRCESOM",76,0)
 K %DT
"RTN","PRCESOM",77,0)
 I Y<0 D MSG,OUT H 3 Q
"RTN","PRCESOM",78,0)
 S PRCFA("OBLDATE")=Y
"RTN","PRCESOM",79,0)
 S EXIT=0
"RTN","PRCESOM",80,0)
 D ENM^PRCESOE2
"RTN","PRCESOM",81,0)
 I EXIT D  H 3 Q
"RTN","PRCESOM",82,0)
 . D MSG
"RTN","PRCESOM",83,0)
 . D OUT
"RTN","PRCESOM",84,0)
 . D KILL^PRCESOE2
"RTN","PRCESOM",85,0)
 I PRC("RBDT")'<$P(^PRC(420,PRC("SITE"),0),"^",9),$P($$DATE^PRC0C(PRCFA("OBLDATE"),"I"),U,1,2)'=$P($$DATE^PRC0C(PRC("RBDT"),"I"),U,1,2) D MSG1^PRCFFUD G DT
"RTN","PRCESOM",86,0)
 D GENDIQ^PRCFFU7(442,+PO,".1;.07;.03;17","IEN","")
"RTN","PRCESOM",87,0)
 ;
"RTN","PRCESOM",88,0)
 D  I "^SO^AR^"'[("^"_$P(PRCFA("TT"),":",1)) D MSG S Y=1 G OUT
"RTN","PRCESOM",89,0)
 . N PRCFATT S PRCFATT=PRCFA("TT")
"RTN","PRCESOM",90,0)
 . D SOAR^PRC0E(PRCFA("PODA"),.PRCFATT,1) ; ask SO or AR, if appropriate
"RTN","PRCESOM",91,0)
 . S PRCFA("TT")=PRCFATT K PRCFATT
"RTN","PRCESOM",92,0)
 ;
"RTN","PRCESOM",93,0)
 I PRCFA("TT")="AR" D  I "EM"'[X D MSG S Y=1 G OUT
"RTN","PRCESOM",94,0)
 . N Y
"RTN","PRCESOM",95,0)
 . D SC^PRC0A("",.Y,"Label document action as: ","AOM^E:Original Entry;M:Modification Entry","M")
"RTN","PRCESOM",96,0)
 . I $E(Y)="E" S PRCFA("MOD")="E^0^Original Entry"
"RTN","PRCESOM",97,0)
 . I $E(Y)="M" S PRCFA("MOD")="M^1^Modification Entry"
"RTN","PRCESOM",98,0)
 . S X=$E(Y)
"RTN","PRCESOM",99,0)
 . K Y
"RTN","PRCESOM",100,0)
 S X=0
"RTN","PRCESOM",101,0)
 I $G(PRCFA("RETRAN"))=1,"^SO^AR"[("^"_$E(PRCFA("TT"),1,2)),$P(PRCFA("GECS"),"^",1,2)'=($E(PRCFA("TT"),1,2)_"^"_$E(PRCFA("MOD"))) D  I X="^" D MSG,PAUSE^PRCFFERU S Y=1 G OUT
"RTN","PRCESOM",102,0)
 . S PRCFA("SIS")=$$GETTXNS^PRCFFERT(PO,PRC410,21) ; get other FMS txns for this adjustment
"RTN","PRCESOM",103,0)
 . S X=$$NEWCHK^PRCFFERT(PRCFA("TT"),$E(PRCFA("MOD")),PRCFA("SIS")) ; if selected txn exists, X will be DOCID
"RTN","PRCESOM",104,0)
 . I X=0 S PRCFA("RETRAN")=2 ; selected txn doesn't exist, create
"RTN","PRCESOM",105,0)
 . I X'=0 S X=$$SWITCH^PRCFFERT(X,21,.GECSDATA) ; is selected txn available?
"RTN","PRCESOM",106,0)
 ;
"RTN","PRCESOM",107,0)
GO ; Prompt use for final go-ahead for the document creation
"RTN","PRCESOM",108,0)
 D GO^PRCFFU
"RTN","PRCESOM",109,0)
 I 'Y!($D(DIRUT)) D MSG,OUT Q
"RTN","PRCESOM",110,0)
 ;
"RTN","PRCESOM",111,0)
ESIG ; Enter the Electronic Signature and away it goes!
"RTN","PRCESOM",112,0)
 W !,"The Electronic Signature must now be entered to generate the "_PRCFA("TYPE")_" Document.",!
"RTN","PRCESOM",113,0)
 D SIG^PRCFFU4
"RTN","PRCESOM",114,0)
 I $D(PRCFA("SIGFAIL")) K PRCFA("SIGFAIL") H 3 D MSG,OUT Q
"RTN","PRCESOM",115,0)
 ;
"RTN","PRCESOM",116,0)
 ; Check fund/year dictionary for FMS required fields
"RTN","PRCESOM",117,0)
 D EDIT^PRCFFU ; sets up PRCFMO array for req'd fields
"RTN","PRCESOM",118,0)
 ;
"RTN","PRCESOM",119,0)
 D EDIT410^PRCFFUD(OB,"O") ; edit running balance qtr & status in 410
"RTN","PRCESOM",120,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1 D SET1358^PRCFFERT ; do rebuild
"RTN","PRCESOM",121,0)
 ;
"RTN","PRCESOM",122,0)
STACK ; Create entry in GECS Stack File
"RTN","PRCESOM",123,0)
 D STACK^PRCFFU(1) ; CTL,BAT,DOC segments, (1) creates batch# for FMS doc
"RTN","PRCESOM",124,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")>0 G SEGS
"RTN","PRCESOM",125,0)
 ;
"RTN","PRCESOM",126,0)
UPDATE ; Update records in 442 and 410
"RTN","PRCESOM",127,0)
 W !!,"...updating obligation balances....please hold...",!!
"RTN","PRCESOM",128,0)
 D POADJ^PRCH58OB(.PO,PODA,.TRNODE,AMT)
"RTN","PRCESOM",129,0)
 D POADJ^PRCS58OB(.PRC,PODA,TRDA,AMT)
"RTN","PRCESOM",130,0)
 D:AMT>0 BULC^PRCH58(PODA)
"RTN","PRCESOM",131,0)
 D UPDATE^PRCFFU6(PRC442,PRC410) ; update node 22 of file 442
"RTN","PRCESOM",132,0)
 ;
"RTN","PRCESOM",133,0)
SEGS ; Use TMP($J to store remaining segments to be built
"RTN","PRCESOM",134,0)
 K ^TMP($J,"PRCMO")
"RTN","PRCESOM",135,0)
 N FMSINT S FMSINT=+PO
"RTN","PRCESOM",136,0)
 S FMSMOD=$P(PRCFA("MOD"),U,1)
"RTN","PRCESOM",137,0)
 D NEW^PRCFFU1(FMSINT,PRCFA("TT"),FMSMOD) ; build segments
"RTN","PRCESOM",138,0)
 ;
"RTN","PRCESOM",139,0)
 ; Transfer nodes from TMP($J, into GECS Stack File
"RTN","PRCESOM",140,0)
 N LOOP S LOOP=0
"RTN","PRCESOM",141,0)
 F  S LOOP=$O(^TMP($J,"PRCMO",GECSFMS("DA"),LOOP)) Q:'LOOP  D SETCS^GECSSTAA(GECSFMS("DA"),^(LOOP))
"RTN","PRCESOM",142,0)
 K ^TMP($J,"PRCMO")
"RTN","PRCESOM",143,0)
 ;
"RTN","PRCESOM",144,0)
TRANS ; Mark the document as queued for transmission
"RTN","PRCESOM",145,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCESOM",146,0)
 N P2 S P2=+PO
"RTN","PRCESOM",147,0)
 S $P(P2,"/",4)=+TRDA
"RTN","PRCESOM",148,0)
 S $P(P2,"/",5)=$P(PRCFA("ACCPD"),U)
"RTN","PRCESOM",149,0)
 S $P(P2,"/",6)=PRCFA("OBLDATE")
"RTN","PRCESOM",150,0)
 D SETPARAM^GECSSDCT(GECSFMS("DA"),P2) ; save P2 as node 26 of 2100.1
"RTN","PRCESOM",151,0)
 ;
"RTN","PRCESOM",152,0)
POBAL ; Enter Obligation Data into Purchase Order Record
"RTN","PRCESOM",153,0)
 ; Log transaction into node 10 of file 442
"RTN","PRCESOM",154,0)
 D EN7^PRCFFU41(PRCFA("TT"),FMSMOD,PODATE,PRCFA("PATNUM"))
"RTN","PRCESOM",155,0)
 ;
"RTN","PRCESOM",156,0)
 ; Continue processing if this is not a rebuild
"RTN","PRCESOM",157,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")>0 G OUT
"RTN","PRCESOM",158,0)
Z S (X,Z)=$P(PO(0),U)
"RTN","PRCESOM",159,0)
 S %=1
"RTN","PRCESOM",160,0)
 D EN1^PRCSUT3
"RTN","PRCESOM",161,0)
 S DLAYGO=424
"RTN","PRCESOM",162,0)
 S DIC="^PRC(424,"
"RTN","PRCESOM",163,0)
 S DIC(0)="L"
"RTN","PRCESOM",164,0)
 D FILE^DICN
"RTN","PRCESOM",165,0)
 I Y<0 W !,"ERROR IN CREATING 424 RECORD",$C(7),!! Q
"RTN","PRCESOM",166,0)
 ;
"RTN","PRCESOM",167,0)
 S DIE="^PRC(424,"
"RTN","PRCESOM",168,0)
 S DA(1358)=+Y
"RTN","PRCESOM",169,0)
 D NOW^%DTC
"RTN","PRCESOM",170,0)
 S TI=%
"RTN","PRCESOM",171,0)
 S DA=DA(1358)
"RTN","PRCESOM",172,0)
 S DR=".02///^S X=PODA;.03///^S X=""A"";.06///^S X=$P(TRNODE(4),U,8);.07///^S X=TI;.08////^S X=DUZ;1.1////^S X=""ADJUSTMENT OBLIGATION"";.15////^S X=TRDA"
"RTN","PRCESOM",173,0)
 D ^DIE W "...adjustment completed..."
"RTN","PRCESOM",174,0)
 G OUT
"RTN","PRCESOM",175,0)
 Q
"RTN","PRCESOM",176,0)
 ;
"RTN","PRCESOM",177,0)
SCREEN ;COMPARISON SCREEN
"RTN","PRCESOM",178,0)
 N CEILING,LAUTH,TAUTH,TBAL,LBAL,IOINHI,IOINLOW,IOINORM
"RTN","PRCESOM",179,0)
 D HILO^PRCFQ
"RTN","PRCESOM",180,0)
 S CEILING=$P(PO(8),U)
"RTN","PRCESOM",181,0)
 W @IOF,IOINLOW,"Adjustment Transaction # ",IOINHI,$P(TRNODE(0),"^")
"RTN","PRCESOM",182,0)
 W IOINLOW,"     1358 # ",IOINHI,$P(PO(0),"^")
"RTN","PRCESOM",183,0)
 W !!,IOINLOW,"Current amount obligated on 1358: ",IOINHI,"  $ ",$FN(CEILING,"P,",2)
"RTN","PRCESOM",184,0)
 S TBAL=$P(PO(8),U,3)
"RTN","PRCESOM",185,0)
 S TAUTH=CEILING-TBAL
"RTN","PRCESOM",186,0)
 W !!,IOINLOW," Total Authorizations: ",IOINHI," $ ",$J($FN(TAUTH,"P,",2),12)
"RTN","PRCESOM",187,0)
 S LBAL=$P(PO(8),U,2),LAUTH=CEILING-LBAL
"RTN","PRCESOM",188,0)
 W ?40,IOINLOW," Total Liquidations: ",IOINHI," $ ",$J($FN(LAUTH,",P",2),12)
"RTN","PRCESOM",189,0)
 W !,IOINLOW,"Authorization Balance: ",IOINHI," $ ",$J($FN(TBAL,"P,",2),12)
"RTN","PRCESOM",190,0)
 W ?40,IOINLOW,"Liquidation Balance: ",IOINHI," $ ",$J($FN(LBAL,"P,",2),12),!!
"RTN","PRCESOM",191,0)
 W IOINLOW,"Amount of Adjustment: ",IOINHI,$J($P(TRNODE(4),"^",8),0,2),!!,IOINORM
"RTN","PRCESOM",192,0)
 Q
"RTN","PRCESOM",193,0)
MSG W !
"RTN","PRCESOM",194,0)
 S X="No further processing is being taken on this 1358 adjustment obligation.  It has NOT been obligated.*"
"RTN","PRCESOM",195,0)
 D MSG^PRCFQ
"RTN","PRCESOM",196,0)
 Q
"RTN","PRCESOM",197,0)
OUT K DIRUT,DTOUT,DUOUT,DIROUT
"RTN","PRCESOM",198,0)
 QUIT
"RTN","PRCFFU2")
0^14^B10580880^B8191248
"RTN","PRCFFU2",1,0)
PRCFFU2 ;WISC/SJG-FMS MO2 SEGMENT ;9/7/10  15:11
"RTN","PRCFFU2",2,0)
 ;;5.1;IFCAP;**130,148**;Oct 20, 2000;Build 5
"RTN","PRCFFU2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCFFU2",4,0)
 ;
"RTN","PRCFFU2",5,0)
MO2(NODE,TYCODE) ;BUILD 'MO2' SEGMENT
"RTN","PRCFFU2",6,0)
 ; .1  - P.O. DATE FROM 442   .01 - NAME FROM 440
"RTN","PRCFFU2",7,0)
 ; 5   - VENDOR FROM 442      .06 - FEDERAL SOURCE FROM 440
"RTN","PRCFFU2",8,0)
 ; 6.4 - FOB POINT FROM 442   34  - FMS VENDOR CODE FROM 440
"RTN","PRCFFU2",9,0)
 ;                            35  - ALT-ADDR-IND FROM 440
"RTN","PRCFFU2",10,0)
MO2A N SEG,FMSYR,FMSMO,FMSDAY,VEND,FMSVENCD,FMSVENNM,FMSPODAT,FMSFOB
"RTN","PRCFFU2",11,0)
 S (FMSVENID,FMSVENCD,FMSVENNM,FMSFOB)=""
"RTN","PRCFFU2",12,0)
 S TMPLINE=TMPLINE+1
"RTN","PRCFFU2",13,0)
 K PRCTMP N DA S DIC=442,DR=".1;5;6.4",DA=+PO,DIQ="PRCTMP(",DIQ(0)="IE" D EN^DIQ1 K DIC,DIQ,DR
"RTN","PRCFFU2",14,0)
MO2B I (TRCODE="MO")&(("^1^3^4^7^8^26^"[("^"_PRCFA("MP")_"^"))) D
"RTN","PRCFFU2",15,0)
 .S (BEGDATE,FMSPODAT,PODATE)=PRCFA("OBLDATE")
"RTN","PRCFFU2",16,0)
 .D DATE(FMSPODAT,.A,.B,.C) S FMSPODAT=FMSYR_U_FMSMO_U_FMSDAY
"RTN","PRCFFU2",17,0)
MO2C I (TRCODE="SO")&(PRCFA("MP")=2) D
"RTN","PRCFFU2",18,0)
 .S (BEGDATE,FMSPODAT,PODATE)=PRCFA("OBLDATE")
"RTN","PRCFFU2",19,0)
 .D DATE(FMSPODAT,.A,.B,.C) S FMSPODAT=FMSYR_U_FMSMO_U_FMSDAY
"RTN","PRCFFU2",20,0)
MO2D I (TRCODE="SO")&(PRCFA("MP")=21) D
"RTN","PRCFFU2",21,0)
 .I TYCODE="E" D
"RTN","PRCFFU2",22,0)
 ..S (BEGDATE,FMSPODAT,PODATE)=PRCFA("OBLDATE")
"RTN","PRCFFU2",23,0)
 ..S FMSPODAT=$E(PODATE,2,3)_U_$E(PODATE,4,5)_U_$E(PODATE,6,7)
"RTN","PRCFFU2",24,0)
 ..Q
"RTN","PRCFFU2",25,0)
 .I TYCODE="M" D
"RTN","PRCFFU2",26,0)
 ..S (BEGDATE,FMSPODAT,PODATE)=PRCFA("OBLDATE")
"RTN","PRCFFU2",27,0)
 ..D DATE(FMSPODAT,.A,.B,.C) S FMSPODAT=FMSYR_U_FMSMO_U_FMSDAY
"RTN","PRCFFU2",28,0)
 ..Q
"RTN","PRCFFU2",29,0)
MO2E D
"RTN","PRCFFU2",30,0)
 .I TYCODE="M" Q:'PRCFA("FOB")
"RTN","PRCFFU2",31,0)
 .S (FMSFOB,FOB)=$G(PRCTMP(442,+PO,6.4,"I"))
"RTN","PRCFFU2",32,0)
 .I FOB="" S (FMSFOB,FOB)="D"
"RTN","PRCFFU2",33,0)
MO2F D
"RTN","PRCFFU2",34,0)
 .I TYCODE="M" Q:'PRCFA("VEND")
"RTN","PRCFFU2",35,0)
 .S VEND=$G(PRCTMP(442,+PO,5,"I"))
"RTN","PRCFFU2",36,0)
 .I VEND]"" D
"RTN","PRCFFU2",37,0)
 ..N DA S DIC=440,DR=".01;.06;34;35",DA=+VEND,DIQ="PRCTMP(",DIQ(0)="IE" D EN^DIQ1 K DIC,DIQ,DR
"RTN","PRCFFU2",38,0)
 ..S FMSVENID=$G(PRCTMP(440,VEND,34,"E"))
"RTN","PRCFFU2",39,0)
 ..S FMSVENCD=$G(PRCTMP(440,VEND,35,"E"))
"RTN","PRCFFU2",40,0)
 ..S FMSVENNM=$G(PRCTMP(440,VEND,.01,"E"))
"RTN","PRCFFU2",41,0)
 ..S FMSVENNM=$E(FMSVENNM,1,30)
"RTN","PRCFFU2",42,0)
 ..I FMSVENID="" D
"RTN","PRCFFU2",43,0)
 ...S FMSFED=$G(PRCTMP(440,VEND,.06,"I"))
"RTN","PRCFFU2",44,0)
 ...S FMSVENID=$S(FMSFED:"MISCG",'FMSFED:"MISCN")
"RTN","PRCFFU2",45,0)
 .I VEND="" I TRCODE="SO" S FMSVENID="MISCN",(FMSVENCD,FMSVENNM)=""
"RTN","PRCFFU2",46,0)
MO2G S SEG="MO2^"_FMSPODAT
"RTN","PRCFFU2",47,0)
 N ACCMO,ACCYR,ACCPD
"RTN","PRCFFU2",48,0)
 S ACCPD=$P($G(PRCFA("ACCPD")),U),ACCMO=$E(ACCPD,1,2),ACCYR=$E(ACCPD,3,4)
"RTN","PRCFFU2",49,0)
 S $P(SEG,U,5)=ACCMO,$P(SEG,U,6)=ACCYR,$P(SEG,U,10)=TYCODE
"RTN","PRCFFU2",50,0)
 I TRCODE="SO" S $P(SEG,U,11)=$S(PRCFA("MP")=2:"C",PRCFA("MP")=21:"T",1:"")
"RTN","PRCFFU2",51,0)
 I TRCODE="SO",PRCFA("MP")=21 S $P(SEG,U,13)=$$AUTH(+PO,"SO",PRCFA("MP"))
"RTN","PRCFFU2",52,0)
 I FMSVENID]"" S $P(SEG,U,14)=FMSVENID
"RTN","PRCFFU2",53,0)
 I FMSVENCD]"" S $P(SEG,U,15)=FMSVENCD
"RTN","PRCFFU2",54,0)
 I (FMSVENID="MISCN")!(FMSVENID="MISCG") I FMSVENNM]"" S $P(SEG,U,16)=FMSVENNM
"RTN","PRCFFU2",55,0)
 I FMSFOB]"" S $P(SEG,U,24)=FMSFOB
"RTN","PRCFFU2",56,0)
 S ^TMP($J,"PRCMO",INT,TMPLINE)=SEG_"^~" K PRCTMP
"RTN","PRCFFU2",57,0)
 Q
"RTN","PRCFFU2",58,0)
 ;
"RTN","PRCFFU2",59,0)
DATE(X,A,B,C) ;
"RTN","PRCFFU2",60,0)
 S FMSYR=$E(X,2,3),FMSMO=$E(X,4,5),FMSDAY=$E(X,6,7)
"RTN","PRCFFU2",61,0)
 Q
"RTN","PRCFFU2",62,0)
DATE1(X) ;
"RTN","PRCFFU2",63,0)
 Q $E(X,4,5)_$E(X,6,7)_$E(X,2,3)
"RTN","PRCFFU2",64,0)
 Q
"RTN","PRCFFU2",65,0)
ASKDATE(X) ;
"RTN","PRCFFU2",66,0)
 N Y,ASKDATE
"RTN","PRCFFU2",67,0)
 S %DT="AEX",%DT("A")=X D ^%DT
"RTN","PRCFFU2",68,0)
 S ASKDATE=Y K %DT
"RTN","PRCFFU2",69,0)
 Q ASKDATE
"RTN","PRCFFU2",70,0)
 ;
"RTN","PRCFFU2",71,0)
AUTH(PRCIEN,PRCCODE,PRCMOP) ;Extrinsic function returns authority/sub-authority code for 1358
"RTN","PRCFFU2",72,0)
 N PRCDA,PRCX,PRCY S PRCX=""
"RTN","PRCFFU2",73,0)
 G AUTHX:$G(PRCIEN)'>0,AUTHX:$G(PRCCODE)'="SO",AUTHX:$G(PRCMOP)'=21
"RTN","PRCFFU2",74,0)
 S PRCDA=$P($G(^PRC(442,PRCIEN,0)),U,12) G AUTHX:PRCDA'>0
"RTN","PRCFFU2",75,0)
 S PRCY=$P($G(^PRCS(410,PRCDA,11)),U,5) S:PRCY'>0 PRCY=$P($G(^(11)),U,4)
"RTN","PRCFFU2",76,0)
 G AUTHX:PRCY'>0
"RTN","PRCFFU2",77,0)
 S PRCX=$P($G(^PRCS(410.9,PRCY,0)),U,7)
"RTN","PRCFFU2",78,0)
AUTHX Q PRCX
"RTN","PRCS58OB")
0^10^B21961903^B21940704
"RTN","PRCS58OB",1,0)
PRCS58OB ;WISC/CLH-OBLIGATION PROCESSING ;07/21/93
"RTN","PRCS58OB",2,0)
V ;;5.1;IFCAP;**148**;Oct 20, 2000;Build 5
"RTN","PRCS58OB",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCS58OB",4,0)
OB(DA) ;Obligation edits
"RTN","PRCS58OB",5,0)
SC N DIE,DR
"RTN","PRCS58OB",6,0)
 S DIE="^PRCS(410,",DIE("NO^")=""
"RTN","PRCS58OB",7,0)
 S DR="15.5;S NEWCC=X;W !;17;S NEWBOC=X" D ^DIE
"RTN","PRCS58OB",8,0)
 ;S DR="15.5;W !;17;@1;S AMT=$P(^PRCS(410,DA,4),U);17.5;S S1AMT=X;W !;18;18.5;I X+S1AMT'=+AMT W !,$C(7),?5,""Amounts out of balance"" K AMT,S1AMT S Y=""@1""" D ^DIE
"RTN","PRCS58OB",9,0)
 Q
"RTN","PRCS58OB",10,0)
OB1(OB,DA) ;set obligation number in 410
"RTN","PRCS58OB",11,0)
 N DIE,DR,Z
"RTN","PRCS58OB",12,0)
 S Z=DA,DA=OB,DIE="^PRCS(410,",DR="52///^S X=Z" D ^DIE
"RTN","PRCS58OB",13,0)
 Q
"RTN","PRCS58OB",14,0)
CS(OB,AMT,TIME,PATNUM,PODA,DEL,X,PRC) ;set code sheet information in 410
"RTN","PRCS58OB",15,0)
 N Y
"RTN","PRCS58OB",16,0)
 ; Change ESIG processing:
"RTN","PRCS58OB",17,0)
 S Y=$S($D(^PRCS(410,OB,4)):^(4),1:""),$P(Y,"^",3,5)=AMT_"^"_TIME_"^"_$P(PATNUM,"-",2),$P(Y,"^",8)=AMT,^(4)=Y
"RTN","PRCS58OB",18,0)
 S MESSAGE=""
"RTN","PRCS58OB",19,0)
 D ENCODE^PRCSC2(OB,DUZ,.MESSAGE)
"RTN","PRCS58OB",20,0)
 K MESSAGE
"RTN","PRCS58OB",21,0)
 S $P(^PRCS(410,OB,10),"^",3,4)=PODA_"^" S:$D(DEL) $P(^(9),"^",2)=DEL S ^PRCS(410,"D",$P(PATNUM,"-",2),OB)=""
"RTN","PRCS58OB",22,0)
 Q
"RTN","PRCS58OB",23,0)
 ;End of first ESIG mod for this routine . . .
"RTN","PRCS58OB",24,0)
PODT(DA,A) ; post P.O. Date onto 442 record
"RTN","PRCS58OB",25,0)
 N DIE,DR
"RTN","PRCS58OB",26,0)
 S DIE="^PRC(442,",DR=".1////"_A D ^DIE
"RTN","PRCS58OB",27,0)
 Q
"RTN","PRCS58OB",28,0)
ADJ(DIC,DA,PRCSIP,X4) ;enter adjustment on transaction
"RTN","PRCS58OB",29,0)
 N DIE,DR
"RTN","PRCS58OB",30,0)
 S DIC(0)="AEMQ",DIE=DIC,DR="3///1"_$S($D(PRCSIP):";4////"_PRCSIP,1:""),X4=1 D ^DIE
"RTN","PRCS58OB",31,0)
 Q
"RTN","PRCS58OB",32,0)
ADJ1(DA,X,Y) N DIE,DR,Z
"RTN","PRCS58OB",33,0)
 S Z=Y,DIE="^PRCS(410,",DR="1///^S X=""A"";3///^S X=1;24///^S X=$P(^PRCS(410,+Z,4),U,5);52////^S X=$G(PRC442)" D ^DIE
"RTN","PRCS58OB",34,0)
 Q
"RTN","PRCS58OB",35,0)
ADJ2(PRC,X,DA) ;mark the transaction as an adjustment
"RTN","PRCS58OB",36,0)
 N PRCX442 S PRCX442=X,PRCX442=$$UPPER^PRCFFU5(PRCX442) D OBL^PRCSES2 S X=PRCX442
"RTN","PRCS58OB",37,0)
 N X1,X2
"RTN","PRCS58OB",38,0)
ENA2 S DIC(0)="AEMQ",DIE="^PRCS(410,",DR="[PRCE 1358 ADJUSTMENT]" D ^DIE
"RTN","PRCS58OB",39,0)
 I $D(Y)#10 D YN^PRC0A(.X,.Y,"Delete this NEW entry","","No") I Y=1 D  QUIT:X=1
"RTN","PRCS58OB",40,0)
 . D DELETE^PRC0B1(.X,"410;^PRCS(410,;"_DA)
"RTN","PRCS58OB",41,0)
 . D EN^DDIOL(" **** NEW ENTRY IS "_$S(X=1:"",1:"NOT ")_"DELETED ****")
"RTN","PRCS58OB",42,0)
 . QUIT
"RTN","PRCS58OB",43,0)
 I DA S X=$P($G(^PRCS(410,DA,4)),U,6) D:X TRANK^PRCSEZ
"RTN","PRCS58OB",44,0)
 I $G(PRC410),$G(PRC442),$$EN1^PRCE0A(PRC410,PRC442,1) G ENA2
"RTN","PRCS58OB",45,0)
 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),U,12)>0 G ENA3
"RTN","PRCS58OB",46,0)
 I $D(^PRCS(410,DA,4)) S X=$P(^(4),U,6),X2=^(3),X1=$P(X2,U,7)+$P(X2,U,9) I $J(X,0,2)'=$J(X1,0,2)!('X)!('X1) W $C(7),!,"Adjustment $ Amount does not equal the BOC $ Amount.",!,"Please correct the error.",! G ENA2
"RTN","PRCS58OB",47,0)
ENA3 D:$O(^PRCS(410,DA,12,0)) SCPC0^PRCSED D W1^PRCSEB I $D(PRCS2),+^PRCS(410,DA,0) D W6^PRCSEB
"RTN","PRCS58OB",48,0)
 Q
"RTN","PRCS58OB",49,0)
NODE(DA,TRNODE) ;get transaction node information from 410
"RTN","PRCS58OB",50,0)
 K TRNODE F I=0,1,2,3,4,7,10,11,14 S TRNODE(I)="" S:$D(^PRCS(410,DA,I)) TRNODE(I)=^(I)
"RTN","PRCS58OB",51,0)
 S:$P(TRNODE(3),"^",11)="" $P(TRNODE(3),"^",11)=$P(TRNODE(0),"-",2)+200_"0000"
"RTN","PRCS58OB",52,0)
 S I=0 F  S I=$O(^PRCS(410,DA,8,I)) Q:'I  S:$D(^(I,0)) TRNODE(8,I)=^(0)
"RTN","PRCS58OB",53,0)
 Q
"RTN","PRCS58OB",54,0)
LU(Y,PRC,PRCF) N DIC,FSO,PRCFA,PX
"RTN","PRCS58OB",55,0)
 ;look up transaction
"RTN","PRCS58OB",56,0)
 S DIC=410,DIC(0)="AEMNZ"
"RTN","PRCS58OB",57,0)
 S PRCFA(1358)="",FSO=$O(^PRCD(442.3,"AC",10,0)),DIC("S")="S PX=^(0) I $P($P(PX,U),""-"",1,2)=PRCF(""SIFY""),$P(PX,U,4)=1,$D(^(10)),$P(^(10),U,4)=FSO"
"RTN","PRCS58OB",58,0)
 D ^PRCSDIC
"RTN","PRCS58OB",59,0)
 Q
"RTN","PRCS58OB",60,0)
SAEDIT(PO,DA) N DIE,DR
"RTN","PRCS58OB",61,0)
 I '$D(PRCFA("TRDA")),$G(DA)]"" S PRCFA("TRDA")=$G(DA)
"RTN","PRCS58OB",62,0)
 W !!,"The current values are:",!,?10,"BOC #1: ",$P(PO(0),"^",6),!?10,"BOC #2:",$P(PO(0),"^",8),!!,"Please enter the corrected values.",!!
"RTN","PRCS58OB",63,0)
 S DA=PRCFA("TRDA"),DIE="^PRCS(410,",DR="17;18" D ^DIE S TRNODE(3)=^PRCS(410,DA,3)
"RTN","PRCS58OB",64,0)
 Q
"RTN","PRCS58OB",65,0)
POADJ(PRC,PODA,TRDA,AMT) ;set adjustments obligations in 410
"RTN","PRCS58OB",66,0)
 ;This code modified for new ESIG:
"RTN","PRCS58OB",67,0)
 N DA,TIME,X
"RTN","PRCS58OB",68,0)
 S DA=TRDA
"RTN","PRCS58OB",69,0)
 D NOW^PRCFQ S TIME=X K %,%X
"RTN","PRCS58OB",70,0)
 S $P(^PRCS(410,DA,10),U,3,4)=PRCFA("PODA")_U
"RTN","PRCS58OB",71,0)
 S X=^PRCS(410,DA,4),$P(X,"^",3,5)=AMT_"^"_TIME_"^"_$P($P(^PRC(442,PRCFA("PODA"),0),"^"),"-",2),$P(X,"^",8)=AMT,^PRCS(410,DA,4)=X,X=AMT
"RTN","PRCS58OB",72,0)
 S MESSAGE=""
"RTN","PRCS58OB",73,0)
 D ENCODE^PRCSC2(DA,DUZ,.MESSAGE)
"RTN","PRCS58OB",74,0)
 K MESSAGE
"RTN","PRCS58OB",75,0)
 S PRCHOBL="" D TRANK^PRCSES,TRANS^PRCSES K PRCHOBL D TRANS1^PRCSES
"RTN","PRCS58OB",76,0)
 Q
"RTN","PRCS58OB",77,0)
 ;End of ESIG mods.
"RTN","PRCS58OB",78,0)
OROBL(DIC,PRC,DA) ;lookup obligation number on original 1358 request
"RTN","PRCS58OB",79,0)
 S DIC("A")="Select OBLIGATION NUMBER: ",DIC(0)="AEQZ",D="D",DIC("S")="I $P(^(0),U,2)=""O"",$P(^(0),U,4)=1,PRC(""SITE"")=+^(0)" I $D(PRC("CP")) S DIC("S")=DIC("S")_",+PRC(""CP"")=+$P($P(^(0),U),""-"",4)"
"RTN","PRCS58OB",80,0)
 D IX^DIC
"RTN","PRCS58OB",81,0)
 I X=" " D
"RTN","PRCS58OB",82,0)
 .N TRDAIEN
"RTN","PRCS58OB",83,0)
 .S TRDAIEN=Y,%X="Y(",%Y="TRDAIEN(" D %XY^%RCR K %X,%Y
"RTN","PRCS58OB",84,0)
 .K PRCTMP(410,+TRDAIEN,52)
"RTN","PRCS58OB",85,0)
 .D GENDIQ^PRCFFU7(410,+TRDAIEN,52,"IEN","")
"RTN","PRCS58OB",86,0)
 .S X=$P($G(PRCTMP(410,+TRDAIEN,52,"E")),"-",2)
"RTN","PRCS58OB",87,0)
 .K PRCTMP(410,+TRDAIEN,52)
"RTN","PRCS58OB",88,0)
 .S Y=TRDAIEN,%X="TRDAIEN(",%Y="Y(" D %XY^%RCR K %X,%Y
"RTN","PRCS58OB",89,0)
 .Q 
"RTN","PRCS58OB",90,0)
 Q
"RTN","PRCS58OB",91,0)
RTN(DA) ;return request to service
"RTN","PRCS58OB",92,0)
 N DIE,DR,AMT,X
"RTN","PRCS58OB",93,0)
 S DIE="^PRCS(410,",DR="61" D ^DIE I $D(Y) S X="No action taken*" D MSG^PRCFQ Q
"RTN","PRCS58OB",94,0)
 S AMT=$P(^PRCS(410,DA,4),"^",8),X=AMT D TRANK^PRCSES S $P(^PRCS(410,DA,7),"^",5,7)="^^",$P(^PRCS(410,DA,10),"^",4)=$O(^PRCD(442.3,"AC",9,0))
"RTN","PRCS58OB",95,0)
 Q
"RTN","PRCS58OB",96,0)
KILL(TRDA) ;kill obligation transaction when obligation data killed
"RTN","PRCS58OB",97,0)
 S $P(^PRCS(410,TRDA,10),"^",4)=$O(^PRCD(442.3,"AC",10,0))
"RTN","PRCS58OB",98,0)
 Q
"RTN","PRCSAPP1")
0^2^B12057361^B11267015
"RTN","PRCSAPP1",1,0)
PRCSAPP1 ;WISC/KMB-CHECK 2237 BEFORE APPROVAL ;12/17/93
"RTN","PRCSAPP1",2,0)
 ;;5.1;IFCAP;**148**;Oct 20, 2000;Build 5
"RTN","PRCSAPP1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCSAPP1",4,0)
CHEC ;
"RTN","PRCSAPP1",5,0)
 I +$P(^PRCS(410,DA,0),"-")'=PRC("SITE") S SPENDCP=1 G EVAL
"RTN","PRCSAPP1",6,0)
 I +$P(^PRCS(410,DA,0),"-",4)'=PRC("CP") S SPENDCP=2 G EVAL
"RTN","PRCSAPP1",7,0)
 S D0=DA,DIC="^PRCS(410," L +^PRCS(410,DA):5 W @IOF D ^PRCST5 H 1
"RTN","PRCSAPP1",8,0)
 L -^PRCS(410,DA)
"RTN","PRCSAPP1",9,0)
 I $D(^PRCS(410,DA,7)),$P(^(7),U,6)'="" S SPENDCP=3 D EVAL Q
"RTN","PRCSAPP1",10,0)
 S:'$D(^PRCS(410,DA,11)) ^(11)="" I '$P(^(11),U,3) S SPENDCP=4 D EVAL Q
"RTN","PRCSAPP1",11,0)
 ; PRC*5.1*148
"RTN","PRCSAPP1",12,0)
 I $P(^PRCS(410,DA,0),"^",11)="" D ERS410^PRC0G(DA)
"RTN","PRCSAPP1",13,0)
 S PRCSN=^PRCS(410,DA,0),PRCHQ=$P(PRCSN,"^",4),PRC("FY")=$P(PRCSN,"-",2),PRC("QTR")=$P(PRCSN,"-",3)
"RTN","PRCSAPP1",14,0)
T1 ;   this is the 'jump' entry point for the CP official
"RTN","PRCSAPP1",15,0)
 ;   to approve a request just after s/he creates it
"RTN","PRCSAPP1",16,0)
 I '$D(ALL) N JUMP,ALL S JUMP=1,ALL=0
"RTN","PRCSAPP1",17,0)
 N ESTSHP,CST S ESTSHP=$P($G(^PRCS(410,DA,9)),"^",4),CST=$P($G(^PRCS(410,DA,4)),"^",8)
"RTN","PRCSAPP1",18,0)
 S PRC("RBDT")=$P(^PRCS(410,DA,0),"^",11),PRCST1=$$DATE^PRC0C(PRC("RBDT"),"I")
"RTN","PRCSAPP1",19,0)
 S PRCST1=$S($D(^PRC(420,PRC("SITE"),1,+PRC("CP"),4,$E($P(PRCST1,"^"),3,4),0)):$P(^(0),U,$P(PRCST1,"^",2)+1),1:0),PRCST=$S($D(^PRCS(410,DA,4)):$P(^(4),U,8),1:0)
"RTN","PRCSAPP1",20,0)
 S PRCST=ESTSHP+CST I PRCST<0,$P(^PRCS(410,DA,0),"^",4)'=1 S SPENDCP=9 D EVAL Q
"RTN","PRCSAPP1",21,0)
 ;Check for different costs
"RTN","PRCSAPP1",22,0)
 N PRCCOMCT,PRCBOCCT
"RTN","PRCSAPP1",23,0)
 S PRCCOMCT=$S($D(^PRCS(410,DA,4)):$P(^(4),"^"),1:0)
"RTN","PRCSAPP1",24,0)
 S PRCBOCCT=$S($D(^PRCS(410,DA,3)):$P(^(3),"^",7),1:0)
"RTN","PRCSAPP1",25,0)
 I $P(^PRCS(410,DA,0),"^",2)="O",$P(^(0),"^",4)=1,$J(PRCCOMCT,0,2)'=$J(PRCBOCCT,0,2) S SPENDCP=10 D EVAL Q
"RTN","PRCSAPP1",26,0)
 ;
"RTN","PRCSAPP1",27,0)
 W !,"Current Control Point balance: $",$J(PRCST1,0,2),!,"Estimated cost of this request: $",$J(PRCST,0,2) H 1
"RTN","PRCSAPP1",28,0)
T2 ;
"RTN","PRCSAPP1",29,0)
 ;N ALLTOT,MINUS S ALLTOT=0 F Z=2:1:PRC("QTR")+1 S ALLTOT=ALLTOT+$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),4,PRC("FY"),0)),"^",Z)
"RTN","PRCSAPP1",30,0)
 ;S MINUS="" I ALLTOT<0 S ALLTOT=-ALLTOT,MINUS="-"
"RTN","PRCSAPP1",31,0)
 ;W !,"Total uncommitted balance from current and prior quarters: ",MINUS,"$",$J(ALLTOT,0,2),!
"RTN","PRCSAPP1",32,0)
 Q:$D(REPORT2)
"RTN","PRCSAPP1",33,0)
 ;S STRING=PRC("SITE")_"^"_PRC("CP")_"^"_PRC("FY")_"^"_PRC("QTR")
"RTN","PRCSAPP1",34,0)
 ;S TEST=$$YEAR^PRC0C(PRC("FY"))'<$$DATE^PRC0C("N","E")
"RTN","PRCSAPP1",35,0)
 ;I TEST S TEST=$$OVCOM^PRCS0A(STRING,PRCST,2) I TEST'=0 S SPENDCP=5 D EVAL Q
"RTN","PRCSAPP1",36,0)
 I $$OVCOM^PRCS0A(PRC("SITE")_"^"_PRC("CP")_"^"_$P($$DATE^PRC0C(PRC("RBDT"),"I"),"^",1,2),PRCST,2)'=0 S SPENDCP=5 D EVAL Q
"RTN","PRCSAPP1",37,0)
 I $P(PRCSN,"^",4)="" S SPENDCP=6 D EVAL Q
"RTN","PRCSAPP1",38,0)
 I $P(PRCSN,"^",4)>1,'$D(^PRCS(410,DA,"IT",0)) S SPENDCP=7 D EVAL Q
"RTN","PRCSAPP1",39,0)
 I +$P(^PRCS(410,DA,3),"^",3)=0 S SPENDCP=8 D EVAL Q
"RTN","PRCSAPP1",40,0)
 I '$$CHECK^PRCEN(DA) S SPENDCP=11 D EVAL Q
"RTN","PRCSAPP1",41,0)
 S OK=1 QUIT
"RTN","PRCSAPP1",42,0)
EVAL ;
"RTN","PRCSAPP1",43,0)
 I SPENDCP'=0 W !,$P($T(MESSAGE+SPENDCP),";;",2) H 2 Q:$D(JUMP)  R !!,"Press return to continue: ",X:DTIME I X["^" D
"RTN","PRCSAPP1",44,0)
 .I ALL=0 S STOP1=-1 Q
"RTN","PRCSAPP1",45,0)
 .S %=1 W !,"Continue looping through your control points" D YN^DICN I %=2 S STOP1=-1 Q
"RTN","PRCSAPP1",46,0)
 .I %=0 W !,"Enter yes or no.  Continue" S %=1 D YN^DICN S:%<2 STOP1=-1
"RTN","PRCSAPP1",47,0)
 Q
"RTN","PRCSAPP1",48,0)
MESSAGE ;
"RTN","PRCSAPP1",49,0)
 ;;This transaction was not entered for your site
"RTN","PRCSAPP1",50,0)
 ;;This transaction was not entered for your control point
"RTN","PRCSAPP1",51,0)
 ;;This transaction has already been approved!
"RTN","PRCSAPP1",52,0)
 ;;This transaction is not ready for approval
"RTN","PRCSAPP1",53,0)
 ;;You do not have the funds to approve this request
"RTN","PRCSAPP1",54,0)
 ;;This request does not have a form type
"RTN","PRCSAPP1",55,0)
 ;;Requests without items cannot be approved
"RTN","PRCSAPP1",56,0)
 ;;This transaction does not have a cost center
"RTN","PRCSAPP1",57,0)
 ;;This request has a negative dollar amount
"RTN","PRCSAPP1",58,0)
 ;;Committed Cost does not equal BOC $ Amount - Please re-edit.
"RTN","PRCSAPP1",59,0)
 ;;Missing required data, request needs to be edited.
"RTN","PRCSAPP2")
0^16^B21099667^B18964515
"RTN","PRCSAPP2",1,0)
PRCSAPP2 ;WISC/KMB/BGJ/SC/ASU - CONTINUATION OF PRCSAPP ; 3/31/05 3:07pm
"RTN","PRCSAPP2",2,0)
V ;;5.1;IFCAP;**14,81,148**;Oct 20, 2000;Build 5
"RTN","PRCSAPP2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCSAPP2",4,0)
 ;
"RTN","PRCSAPP2",5,0)
 ;PRC*5.1*81-if a 2237 trx is being approved & it originated from
"RTN","PRCSAPP2",6,0)
 ;DynaMed RIL then update DM re. approval thru a call to rtn PRCVTAP
"RTN","PRCSAPP2",7,0)
 ;
"RTN","PRCSAPP2",8,0)
FINAL ;   ask if request was reviewed. print request if needed.
"RTN","PRCSAPP2",9,0)
 ;
"RTN","PRCSAPP2",10,0)
 N PRCSDA,PRCPRIB,RPRINT,REPLY,REPLY1 S (REPLY,REPLY1)=2
"RTN","PRCSAPP2",11,0)
 ; SKIPRNT is set in PRCSEB - official can approve request here
"RTN","PRCSAPP2",12,0)
 ; immediately after creating it in PRCSEB
"RTN","PRCSAPP2",13,0)
 I '$D(SKIPRNT) S %=0 W !,"Requests need to be reviewed prior to approval.",!,"Have you reviewed this request" D YN^DICN Q:%=-1  I %=0 W !,"Enter yes or no.",! H 1 G FINAL
"RTN","PRCSAPP2",14,0)
 I '$D(SKIPRNT),%=2 S (PRCS,PRCPRIB)=DA,TRNODE(0)=0 D:PRCHQ=1 NODE^PRCS58OB(DA,.TRNODE) S RPRINT=$S(PRCHQ=1:"^PRCE58P0",PRCHQ=5:"DQ^PRCPRIB0",1:"^PRCSD12") D @RPRINT S DA=PRCS
"RTN","PRCSAPP2",15,0)
 ;ask for approval, signature
"RTN","PRCSAPP2",16,0)
 N PRCOKCB S PRCOKCB=$$OKCCBOC^PRCSCK($P(PRCSN,"^"))
"RTN","PRCSAPP2",17,0)
 I PRCOKCB S %=1 W !,"Is this request ready for approval" D YN^DICN W:%=0 !,"Enter yes or no.",! G:%=0 FINAL Q:%=-1  S REPLY=%
"RTN","PRCSAPP2",18,0)
 I 'PRCOKCB S REPLY=2
"RTN","PRCSAPP2",19,0)
 ; PRC*5.1*148 start
"RTN","PRCSAPP2",20,0)
 ; if Approver is a requestor, violation to segregation of duties
"RTN","PRCSAPP2",21,0)
 I REPLY=1,PRCHQ=1,$P($G(^PRCS(410,DA,7)),"^",1)=DUZ D  G FINAL2
"RTN","PRCSAPP2",22,0)
 . W !!,"You are the CP Clerk (Requestor) on this 1358 transaction."
"RTN","PRCSAPP2",23,0)
 . W " Per Segregation",!,"of Duties, the CP Clerk (Requestor)"
"RTN","PRCSAPP2",24,0)
 . W " is not permitted to Approve the 1358." H 2
"RTN","PRCSAPP2",25,0)
 ; PRC*5.1*148 end
"RTN","PRCSAPP2",26,0)
 ;
"RTN","PRCSAPP2",27,0)
FINAL1 ;*******************************************************************
"RTN","PRCSAPP2",28,0)
 ;PRCVDM -flag helps in determining if ans is Y to transmit to Fiscal
"RTN","PRCSAPP2",29,0)
 ;then ONLY pass the data to DynaMed for DM related approved 2237
"RTN","PRCSAPP2",30,0)
 ;*******************************************************************
"RTN","PRCSAPP2",31,0)
 N PRCVDM
"RTN","PRCSAPP2",32,0)
 I REPLY=1 W !,"Is this request ready for transmission to A&MM/Fiscal" S %=2 D YN^DICN Q:%=-1  S REPLY1=% S:%=1 PRCVDM=1 I %=0 W !,"Enter yes or no.",! H 1 G FINAL1
"RTN","PRCSAPP2",33,0)
 ;  if ready for approval (or reviewed), store on cross-ref F,F1
"RTN","PRCSAPP2",34,0)
FINAL2 ;
"RTN","PRCSAPP2",35,0)
 D:REPLY=2 W5^PRCSEB D:REPLY=1 W51^PRCSEB Q:REPLY1=2
"RTN","PRCSAPP2",36,0)
 I $D(SKIPRNT) S MESSAGE="" D ESIG^PRCUESIG(DUZ,.MESSAGE) Q:MESSAGE'=1
"RTN","PRCSAPP2",37,0)
 ;********************************************************************
"RTN","PRCSAPP2",38,0)
 ;all of the line item data that we need to pass to DM on a DM related
"RTN","PRCSAPP2",39,0)
 ;trx. is recorded in the file 410 at this point for an approved 2237
"RTN","PRCSAPP2",40,0)
 ;********************************************************************
"RTN","PRCSAPP2",41,0)
 I $D(PRCVDM),PRCVDM=1 D EN^PRCVTAP(DA)
"RTN","PRCSAPP2",42,0)
 ;
"RTN","PRCSAPP2",43,0)
 ;  set record in 443, clean up 410, change cp uncommitted balance 
"RTN","PRCSAPP2",44,0)
 ;  using TRANS^PRCSES, in 420
"RTN","PRCSAPP2",45,0)
 D NOW^%DTC S PRCS=%
"RTN","PRCSAPP2",46,0)
 S PRCSCP=$S($D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)):$P(^(0),U,12),1:"")
"RTN","PRCSAPP2",47,0)
 N PPMFLG S:$D(PPMFLG1) PPMFLG=10
"RTN","PRCSAPP2",48,0)
 L +^PRCS(410,DA):15 Q:$T=0
"RTN","PRCSAPP2",49,0)
 S $P(^PRCS(410,DA,10),U,4)=$S(PRCSCP=1!(PRCHQ=1):$O(^PRCD(442.3,"C",10,0)),1:$O(^PRCD(442.3,"C",60,0))),$P(^(11),U,3)=""
"RTN","PRCSAPP2",50,0)
 N ESTSHIP,COST S ESTSHIP=$P($G(^PRCS(410,DA,9)),"^",4),COST=$P($G(^PRCS(410,DA,4)),"^",8)
"RTN","PRCSAPP2",51,0)
 N IJ F IJ=1,8 S $P(^PRCS(410,DA,4),"^",IJ)=ESTSHIP+COST
"RTN","PRCSAPP2",52,0)
 K ^PRCS(410,"F",+PRCSN_"-"_+PRC("CP")_"-"_$P($P(PRCSN,U),"-",5),DA),^PRCS(410,"F1",$P($P(PRCSN,U),"-",5)_"-"_+PRCSN_"-"_+PRC("CP"),DA),^PRCS(410,"AQ",1,DA)
"RTN","PRCSAPP2",53,0)
 S:'$D(^PRCS(410,DA,11)) ^(11)="" S $P(^(11),U,3)=""
"RTN","PRCSAPP2",54,0)
 D ERS410^PRC0G(DA_"^A")
"RTN","PRCSAPP2",55,0)
 ;
"RTN","PRCSAPP2",56,0)
 S MESSAGE=""
"RTN","PRCSAPP2",57,0)
 D ENCODE^PRCSC1(DA,DUZ,.MESSAGE)
"RTN","PRCSAPP2",58,0)
 K MESSAGE
"RTN","PRCSAPP2",59,0)
 S X=PRCST D TRANS^PRCSES
"RTN","PRCSAPP2",60,0)
 ;
"RTN","PRCSAPP2",61,0)
 S PRCSSCP=0 F PRCSSI=1:1 S PRCSSCP=$O(^PRCS(410,DA,12,PRCSSCP)) Q:PRCSSCP'>0  I $D(^PRCS(410,DA,12,PRCSSCP,0)) S X=$P(^(0),U,2) I X S DA(1)=DA,DA=PRCSSCP D TRANS^PRCSEZZ S DA=DA(1)
"RTN","PRCSAPP2",62,0)
 K PRCSSCP,PRCSSI L -^PRCS(410,DA)
"RTN","PRCSAPP2",63,0)
 I $P(PRCSN,U,4)>1 S X=$P(PRCSN,U,1),DIC="^PRC(443,",DIC(0)="L",DLAYGO=443 D ^DIC K DIC,DLAYGO,X
"RTN","PRCSAPP2",64,0)
 I $P(PRCSN,U,4)>1 S X=$O(^PRCD(442.3,"C",60,0)) S:PRCSCP=1 X=$O(^PRCD(442.3,"C",10,0)) S $P(^PRC(443,DA,0),U,7)=X,^PRC(443,"AC",X,DA)="",$P(^PRC(443,DA,0),U,11)=$P(PRCSN,U,6)
"RTN","PRCSAPP2",65,0)
 D EN2^PRCPWI
"RTN","PRCSAPP2",66,0)
 S (PRCS,PRCPRIB)=DA,TRNODE(0)=0 D:PRCHQ=1 NODE^PRCS58OB(DA,.TRNODE)
"RTN","PRCSAPP2",67,0)
TAG ;
"RTN","PRCSAPP2",68,0)
 S PRCSDA=DA
"RTN","PRCSAPP2",69,0)
 S D0=DA,PRCHQ=$S(PRCHQ=1:"QUE^PRCE58P2",PRCHQ=5:"DQ^PRCPRIB0",1:"QUE^PRCSP12"),PRCHQ("DEST")=$S(PRCSCP=1!(PRCHQ="QUE^PRCE58P2"):"F",1:"S") D ^PRCHQUE S DA=PRCSDA Q
"RTN","PRCSAPP2",70,0)
 Q
"RTN","PRCSAPP2",71,0)
PRT ;
"RTN","PRCSAPP2",72,0)
 K IO("Q") S %ZIS("B")="HOME",%ZIS="MQ" D ^%ZIS Q:POP
"RTN","PRCSAPP2",73,0)
 I $D(IO("Q")) S D0=$G(DA),ZTRTN=$S(PRCHQ=1:"QUE^PRCE58P2",PRCHQ=5:"DQ^PRCPRIB0",1:"^PRCSP12"),ZTSAVE("PRNTALL")="",ZTSAVE("DA")="",ZTSAVE("D0")="",ZTSAVE("PRC*")="",ZTSAVE("TRNODE*")="" D ^%ZTLOAD,^%ZISC Q
"RTN","PRCSAPP2",74,0)
 I IO=IO(0) U IO D:PRCHQ=5 DQ^PRCPRIB0 D:PRCHQ=1 ^PRCE58P0 D:PRCHQ'=1&(PRCHQ'=5) ^PRCSD12 D ^%ZISC W:$Y>0 @IOF Q
"RTN","PRCSAPP2",75,0)
 U IO D:PRCHQ=5 DQ^PRCPRIB0 D:PRCHQ=1 QUE^PRCE58P2 D:PRCHQ'=1&(PRCHQ'=5) ^PRCSP12 D ^%ZISC W:$Y>0 @IOF
"RTN","PRCSAPP2",76,0)
 QUIT
"RTN","PRCSECP")
0^6^B28930970^B28160184
"RTN","PRCSECP",1,0)
PRCSECP ;SFISC/KSS,LJP/DAP - COPY A TRANSACTION ; 9/7/2010
"RTN","PRCSECP",2,0)
V ;;5.1;IFCAP;**81,148**;Oct 20, 2000;Build 5
"RTN","PRCSECP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCSECP",4,0)
A I '$D(DT) S %DT="",X="T" D ^%DT S DT=Y
"RTN","PRCSECP",5,0)
 W @IOF,!!
"RTN","PRCSECP",6,0)
B D EN3^PRCSUT ;GO GET STATION AND CONTROL POINT
"RTN","PRCSECP",7,0)
 I '$D(PRC("SITE"))!('$D(PRC("CP")))!(Y<0)!('$D(X))!($G(X)[U) D END Q
"RTN","PRCSECP",8,0)
 N GET,GET1 S DIC="^PRCS(410,",DIC(0)="AEQM"
"RTN","PRCSECP",9,0)
 S DIC("S")="S PRCST=$P(^(0),U,2) I $D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),""^"",5)=PRC(""SITE"") I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2))) I PRCST=""O""!(PRCST=""CA"")"
"RTN","PRCSECP",10,0)
 S DIC("A")="Select the Transaction to be copied: "
"RTN","PRCSECP",11,0)
C W ! D ^PRCSDIC K PRCST
"RTN","PRCSECP",12,0)
 I (X[U)!(Y<0) D END Q
"RTN","PRCSECP",13,0)
 S DA=+Y D W1
"RTN","PRCSECP",14,0)
 S PRCVFT=$P(^PRCS(410,DA,0),"^",4)
"RTN","PRCSECP",15,0)
 ;*81 Check site parameter to see if Issue Books are allowed
"RTN","PRCSECP",16,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVZ=1
"RTN","PRCSECP",17,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVZ=0
"RTN","PRCSECP",18,0)
 I PRCVZ=1,PRCVFT=5 W !,"All Supply Warehouse requests must be processed in the new Inventory System.",!!,"Please cancel this IFCAP issue book order." D W3 G:%'=1 END W !! K PRCS,PRCS2 G B
"RTN","PRCSECP",19,0)
 W !!,"Would you like to proceed " S %=1 D YN^DICN G C:%'=1
"RTN","PRCSECP",20,0)
 S DIC="^PRCS(410," L +^PRCS(410,DA):15 G END:$T=0
"RTN","PRCSECP",21,0)
 S T1=DA,T2=^PRCS(410,DA,0),T5=$P(T2,U,4),T4=$P(T2,U,2),T2=$P(T2,U),T3=$P(^(3),U)
"RTN","PRCSECP",22,0)
 K ^TMP($J)
"RTN","PRCSECP",23,0)
 S ^TMP($J,"OLDDA")=DA,^("OLDTXN")=$P(T2,U,1),^("OLDFCP")=PRC("CP")
"RTN","PRCSECP",24,0)
 W !!,"Now enter the information for the new transaction number.",!
"RTN","PRCSECP",25,0)
 ;L -^PRCS(410,DA)
"RTN","PRCSECP",26,0)
 K DA,DIC,Y D EN1^PRCSUT K DA,DIC
"RTN","PRCSECP",27,0)
 I ('$D(PRC("SITE")))!('$D(PRC("QTR")))!('$D(PRC("CP"))) G UNLKEND
"RTN","PRCSECP",28,0)
 I $P($G(^PRCS(410,T1,0)),"^",4)=1,$$Q1358^PRCEN(PRC("SITE"),PRC("CP")) G UNLKEND
"RTN","PRCSECP",29,0)
 S X1=X,PRCSAPP=$P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),U,3)
"RTN","PRCSECP",30,0)
 I PRC("CP")'=T3,PRCSAPP["_" D PRCFY^PRCSUT2 I (PRCSAPP["_") G UNLKEND
"RTN","PRCSECP",31,0)
 S X=X1 D EN1^PRCSUT3 I 'X G UNLKEND
"RTN","PRCSECP",32,0)
 S X1=X D EN2^PRCSUT3 I ('$D(X1)) G UNLKEND
"RTN","PRCSECP",33,0)
 S (X,^TMP($J,"NEWTXN"))=X1
"RTN","PRCSECP",34,0)
 W !!,"This transaction is assigned transaction number: ",X
"RTN","PRCSECP",35,0)
 ;L +^PRCS(410,DA):15 G B:$T=0
"RTN","PRCSECP",36,0)
 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) S:$P(^(0),U,11)="Y" PRCS2=1
"RTN","PRCSECP",37,0)
TYPE ;
"RTN","PRCSECP",38,0)
 S PRCSX=$P(^PRCS(410,T1,0),"^",4)
"RTN","PRCSECP",39,0)
 ;*81 Check site parameter to see if issue books should be allowed
"RTN","PRCSECP",40,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVX="I Y>(.5)&(Y<5)",PRCVY="The Issue Book and NO FORM types are no longer used."
"RTN","PRCSECP",41,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVX="I Y>(.5)",PRCVY="The NO FORM type is no longer used."
"RTN","PRCSECP",42,0)
 I PRCSX<1 W !,PRCVY,!,"Please enter another form type.",! S PRCDAA=DA,DIC="^PRCS(410.5,",DIC("S")=PRCVX,DIC("A")="FORM TYPE: ",DIC(0)="AEQZ" D ^DIC S:Y=-1 Y=2 S DA=PRCDAA,PRCSX=+Y
"RTN","PRCSECP",43,0)
 S (DIE,DIC)="^PRCS(410,"
"RTN","PRCSECP",44,0)
 K PRCVX,PRCVY
"RTN","PRCSECP",45,0)
 S $P(^PRCS(410,DA,0),"^",4)=PRCSX
"RTN","PRCSECP",46,0)
 W !,"The form type for this request is: ",$P($G(^PRCS(410.5,PRCSX,0)),"^"),!
"RTN","PRCSECP",47,0)
 W !,?10,"Transaction data is being copied...",!
"RTN","PRCSECP",48,0)
 D @$S(PRCSX=1:"S1^PRCSECP1",1:"S2^PRCSECP1") S DIK="^PRCS(410," D IX^DIK
"RTN","PRCSECP",49,0)
 S (DIC,DIE)="^PRCS(410,"
"RTN","PRCSECP",50,0)
 ;P182--removed warning about changed CC/BOC;replaced w/following call
"RTN","PRCSECP",51,0)
 S X=$$CHGCCBOC^PRCSCK(^TMP($J,"OLDTXN"),^TMP($J,"NEWTXN"),^TMP($J,"OLDFCP"),0)
"RTN","PRCSECP",52,0)
 S X=PRCSX S:'$D(PRCS2)&(X>2) $P(^PRCS(410,DA,0),"^",4)=2,X=2
"RTN","PRCSECP",53,0)
 S (PRCSDR,DR)="["_$S(X=1:"PRCE NEW 1358",X=2:"PRCSEN2237B",X=3:"PRCSENPR",X=4:"PRCSENR&NR",X=5:"PRCSENIB",1:"PRCSENCOD")_"]"
"RTN","PRCSECP",54,0)
D K DTOUT,DUOUT,Y S COPYDA=DA D ^DIE I $D(Y)!($D(DTOUT)) S DA=COPYDA G END
"RTN","PRCSECP",55,0)
 S DA=COPYDA D RL^PRCSUT1
"RTN","PRCSECP",56,0)
 D ^PRCSCK I $D(PRCSERR),PRCSERR G D
"RTN","PRCSECP",57,0)
 K PRCSERR
"RTN","PRCSECP",58,0)
 I PRCSDR="[PRCSENCOD]" D W7^PRCSEB0 D:$D(PRCSOB) ENOD1^PRCSEB1 K PRCSOB
"RTN","PRCSECP",59,0)
 D:PRCSDR'="[PRCSENCOD]" W1 I PRCSDR'="[PRCSENCOD]",$D(PRCS2),+^PRCS(410,DA,0) D W6^PRCSEB
"RTN","PRCSECP",60,0)
 S DA=COPYDA L -^PRCS(410,DA) D W3 G END:%'=1 W !! K PRCS,PRCS2
"RTN","PRCSECP",61,0)
 G B
"RTN","PRCSECP",62,0)
 ;
"RTN","PRCSECP",63,0)
UNLKEND S DA=^TMP($J,"OLDDA") L -^PRCS(410,DA)
"RTN","PRCSECP",64,0)
END K %,D0,DA,DIC,DIE,DIK,DR,N,P,PRCSAPP,COPYDA,PRCSDR,PRCSERR,PRCSI,PRCSIP,PRCSJ,PRCSJ,PRCSL,PRCST1,PRCSTMP,PRCSTT,PRCSX,PRCSZ,T1,T2,T3,T4,T5,X,X1,Y,PRCVZ,PRCVFT
"RTN","PRCSECP",65,0)
 K ^TMP($J)
"RTN","PRCSECP",66,0)
 Q
"RTN","PRCSECP",67,0)
W1 W !!,"Would you like to review this request" S %=2 D YN^DICN G W1:%=0 Q:%'=1  S (N,PRCSZ)=DA,PRCSF=1 D PRF1^PRCSP1 S DA=PRCSZ K X,PRCSF,PRCSZ Q
"RTN","PRCSECP",68,0)
W3 W !!,"Would you like to copy another request" S %=1 D YN^DICN G W3:%=0 Q
"RTN","PRCSECP",69,0)
 ;
"RTN","PRCSECP",70,0)
GETCCCNT(STA,FCP) ;How many valid Cost Centers for this Control Point
"RTN","PRCSECP",71,0)
 ;return count and first CC
"RTN","PRCSECP",72,0)
 N GOODCC,CC,FIRSTCC
"RTN","PRCSECP",73,0)
 S GOODCC=0,(CC,FIRSTCC)=""
"RTN","PRCSECP",74,0)
 F  S CC=$O(^PRC(420,+STA,1,+FCP,2,CC)) Q:CC=""  D
"RTN","PRCSECP",75,0)
 . I $$VALIDCC(STA,FCP,CC) S GOODCC=GOODCC+1 I FIRSTCC="" S FIRSTCC=$E($P(^PRCD(420.1,+CC,0),U,1),1,23)
"RTN","PRCSECP",76,0)
 Q GOODCC_"^"_FIRSTCC
"RTN","PRCSECP",77,0)
 ;
"RTN","PRCSECP",78,0)
VALIDCC(STA,FCP,CC) ;Is this STATION,FCP,COST CENTER combination valid?
"RTN","PRCSECP",79,0)
 ;To be valid, station/FCP must point to CC, CC must be active,CC must
"RTN","PRCSECP",80,0)
 ;point to some active BOC
"RTN","PRCSECP",81,0)
 N X,VALID,BOC,GOODBOC
"RTN","PRCSECP",82,0)
 S BOC="",GOODBOC=0
"RTN","PRCSECP",83,0)
 S X=$G(^PRC(420,+STA,1,+FCP,2,+CC,0))  I (+X=+CC) D  ;FCP => CC
"RTN","PRCSECP",84,0)
 . S X=$G(^PRCD(420.1,CC,0)) I X]"",'$P(X,U,2) D  ;    CC IS ACTIVE
"RTN","PRCSECP",85,0)
 .. F  S BOC=$O(^PRCD(420.1,+CC,1,BOC)) Q:BOC=""!GOODBOC  D
"RTN","PRCSECP",86,0)
 ... S X=$G(^PRCD(420.2,+BOC,0)) I X]"",'$P(X,U,2) S GOODBOC=1
"RTN","PRCSECP",87,0)
 Q GOODBOC
"RTN","PRCSECP",88,0)
 ;
"RTN","PRCSECP",89,0)
GETBOCNT(STA,FCP,CC) ;How many valid BOCs for this STATION,FCP,COST CENTER
"RTN","PRCSECP",90,0)
 ;To be valid, station/FCP must point to CC, CC must be active,CC must
"RTN","PRCSECP",91,0)
 ;point to some active BOC
"RTN","PRCSECP",92,0)
 N X,VALID,BOC,GOODBOC,TOTBOCS,FIRSTBOC
"RTN","PRCSECP",93,0)
 S BOC="",GOODBOC=0,TOTBOCS=0,FIRSTBOC=""
"RTN","PRCSECP",94,0)
 S X=$G(^PRC(420,+STA,1,+FCP,2,+CC,0))  I (+X=+CC) D  ;FCP => CC
"RTN","PRCSECP",95,0)
 . S X=$G(^PRCD(420.1,CC,0)) I X]"",'$P(X,U,2) D  ;    CC IS ACTIVE
"RTN","PRCSECP",96,0)
 .. F  S BOC=$O(^PRCD(420.1,+CC,1,BOC)) Q:BOC=""  D
"RTN","PRCSECP",97,0)
 ... S X=$G(^PRCD(420.2,+BOC,0)) I X]"",'$P(X,U,2) D
"RTN","PRCSECP",98,0)
 .... S TOTBOCS=TOTBOCS+1 I FIRSTBOC="" S FIRSTBOC=$E($P(^PRCD(420.2,+BOC,0),U,1),1,23)
"RTN","PRCSECP",99,0)
 Q TOTBOCS_"^"_FIRSTBOC
"RTN","PRCSECP",100,0)
 ;
"RTN","PRCSECP",101,0)
VALIDBOC(STA,FCP,CC,BOC) ;Is this STATION,FCP,COST CENTER,BOC VALID?
"RTN","PRCSECP",102,0)
 ;To be valid, station/FCP must point to CC, CC must be active,CC must
"RTN","PRCSECP",103,0)
 ;point to BOC,and BOC must be active
"RTN","PRCSECP",104,0)
 N X,VALID,GOODBOC
"RTN","PRCSECP",105,0)
 S GOODBOC=0
"RTN","PRCSECP",106,0)
 S X=$G(^PRC(420,+STA,1,+FCP,2,+CC,0))
"RTN","PRCSECP",107,0)
 I (+X=+CC) S X=$G(^PRCD(420.1,+CC,0)) I X]"",'$P(X,U,2) D
"RTN","PRCSECP",108,0)
 . S X=$G(^PRCD(420.1,+CC,1,+BOC,0))
"RTN","PRCSECP",109,0)
 . I X]"" S X=$G(^PRCD(420.2,+BOC,0)) I X]"",'$P(X,U,2) S GOODBOC=1
"RTN","PRCSECP",110,0)
 Q GOODBOC
"RTN","PRCSECP",111,0)
 ;
"RTN","PRCSECP1")
0^8^B15793904^B15371548
"RTN","PRCSECP1",1,0)
PRCSECP1 ;SF-ISC/LJP/DGL-COPY A TRANSACTION CON'T ;7/29/99
"RTN","PRCSECP1",2,0)
V ;;5.1;IFCAP;**148**;Oct 20, 2000;Build 5
"RTN","PRCSECP1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCSECP1",4,0)
S1 ;subroutine to copy transactions of form type 1 (i.e. 1358)
"RTN","PRCSECP1",5,0)
 K PRCSTMP
"RTN","PRCSECP1",6,0)
 N I,PRCSIP
"RTN","PRCSECP1",7,0)
 I $D(^PRCS(410,T1,0)) D
"RTN","PRCSECP1",8,0)
 . F I=2,4 S $P(^PRCS(410,DA,0),U,I)=$P(^PRCS(410,T1,0),U,I)
"RTN","PRCSECP1",9,0)
 . D IP^PRCSUT
"RTN","PRCSECP1",10,0)
 . I $G(PRCSIP) S $P(^PRCS(410,DA,0),U,6)=PRCSIP
"RTN","PRCSECP1",11,0)
 S:$D(^PRCS(410,T1,1)) $P(^PRCS(410,DA,1),U,5)=$P(^(1),U,5)
"RTN","PRCSECP1",12,0)
 I $D(^PRCS(410,T1,3)) S PRCSTMP=^(3),^PRCS(410,DA,3)=$P(^PRCS(410,DA,3),U,1,2)_"^"_$P(PRCSTMP,U,3,6)_"^^"_$P(PRCSTMP,U,8)_"^^"_$P(PRCSTMP,U,10)
"RTN","PRCSECP1",13,0)
 I $P(PRCSTMP,U)'=$P(^PRCS(410,DA,3),U) S $P(^PRCS(410,DA,3),U,3)=""
"RTN","PRCSECP1",14,0)
 S:$D(^PRCS(410,T1,10)) $P(^PRCS(410,DA,10),U)=$P(^(10),U)
"RTN","PRCSECP1",15,0)
 ;
"RTN","PRCSECP1",16,0)
 D CHECK
"RTN","PRCSECP1",17,0)
 D S4,S5,S7
"RTN","PRCSECP1",18,0)
 Q
"RTN","PRCSECP1",19,0)
 ;
"RTN","PRCSECP1",20,0)
 ;subroutine S2 is called to copy all transactions of form type <> 1
"RTN","PRCSECP1",21,0)
 ;(anything other than a 1358)
"RTN","PRCSECP1",22,0)
S2 K PRCSTMP
"RTN","PRCSECP1",23,0)
 N I,PRCSIP
"RTN","PRCSECP1",24,0)
 ;if possible, copy over transaction type & form type from old trans.
"RTN","PRCSECP1",25,0)
 ;also get inventory distrib. point from NEW FCP inv distrib point
"RTN","PRCSECP1",26,0)
 I $D(^PRCS(410,T1,0)) D
"RTN","PRCSECP1",27,0)
 . F I=2,4 S $P(^PRCS(410,DA,0),U,I)=$P(^PRCS(410,T1,0),U,I)
"RTN","PRCSECP1",28,0)
 . D IP^PRCSUT
"RTN","PRCSECP1",29,0)
 . I $D(PRCSIP) S $P(^PRCS(410,DA,0),U,6)=PRCSIP
"RTN","PRCSECP1",30,0)
 ;copy classification of request
"RTN","PRCSECP1",31,0)
 I $D(^PRCS(410,T1,1)) S $P(^PRCS(410,DA,1),U,5)=$P(^(1),U,5)
"RTN","PRCSECP1",32,0)
 ;now copy cost center, vendor, requesting service, and vendor contract #
"RTN","PRCSECP1",33,0)
 ;"CHECK" checks for valid FCP user, CC, BOC, etc.
"RTN","PRCSECP1",34,0)
 I $D(^PRCS(410,T1,3)) D
"RTN","PRCSECP1",35,0)
 . F I=3,4,5,10 S $P(^PRCS(410,DA,3),U,I)=$P(^PRCS(410,T1,3),U,I)
"RTN","PRCSECP1",36,0)
 . I $P(^PRCS(410,T1,3),U)'=$P(^PRCS(410,DA,3),U) S $P(^PRCS(410,DA,3),U,3)=""
"RTN","PRCSECP1",37,0)
 . D CHECK
"RTN","PRCSECP1",38,0)
 ;copy the line item count
"RTN","PRCSECP1",39,0)
 S:$D(^PRCS(410,T1,10)) $P(^PRCS(410,DA,10),U)=$P(^(10),U)
"RTN","PRCSECP1",40,0)
 ;S:$D(^PRCS(410,T1,9)) $P(^PRCS(410,DA,9),U,1)=$P(^(9),U,1)
"RTN","PRCSECP1",41,0)
 ;
"RTN","PRCSECP1",42,0)
 D S4,S5,S7
"RTN","PRCSECP1",43,0)
 Q
"RTN","PRCSECP1",44,0)
 ;
"RTN","PRCSECP1",45,0)
S3 ;Note: S3 commented out (prior to patch 182) so it falls through to S4
"RTN","PRCSECP1",46,0)
 ;K PRCSTMP
"RTN","PRCSECP1",47,0)
 ;S:$D(^PRCS(410,T1,3)) $P(^PRCS(410,DA,3),U,3)=$P(^(3),U,3) D CHECK
"RTN","PRCSECP1",48,0)
 ;I $D(^PRCS(410,T1,"CO",0)) S ^PRCS(410,DA,"CO",0)=$P(^(0),U,1,4)_"^"_DT,PRCSI="CO",PRCSK=0 D S6
"RTN","PRCSECP1",49,0)
 ;D S4 Q
"RTN","PRCSECP1",50,0)
 ;
"RTN","PRCSECP1",51,0)
 ;
"RTN","PRCSECP1",52,0)
S4 ;copy vendor info, sort group and authoritie(s)
"RTN","PRCSECP1",53,0)
 ;
"RTN","PRCSECP1",54,0)
 N PRC11
"RTN","PRCSECP1",55,0)
 S:$D(^PRCS(410,T1,2)) ^PRCS(410,DA,2)=^(2)
"RTN","PRCSECP1",56,0)
 I $D(^PRCS(410,T1,11)) S PRC11=^(11),^PRCS(410,DA,11)=$P(PRC11,"^")_"^^^"_$P(PRC11,"^",4,5)
"RTN","PRCSECP1",57,0)
 ;following line (copy sub control point) commented out before P182 
"RTN","PRCSECP1",58,0)
 ;I $D(^PRCS(410,T1,12,0)) S ^PRCS(410,DA,12,0)=^(0),PRCSI=12,PRCSK=0 D S6
"RTN","PRCSECP1",59,0)
 Q
"RTN","PRCSECP1",60,0)
 ;
"RTN","PRCSECP1",61,0)
S5 ;copy special remarks (using S6)
"RTN","PRCSECP1",62,0)
 S PRCSI="RM"
"RTN","PRCSECP1",63,0)
 I $D(^PRCS(410,T1,PRCSI,0)) D
"RTN","PRCSECP1",64,0)
 . S ^PRCS(410,DA,PRCSI,0)=$P(^(0),U,1,4)_"^"_DT,PRCSK=0
"RTN","PRCSECP1",65,0)
 . D S6
"RTN","PRCSECP1",66,0)
 Q
"RTN","PRCSECP1",67,0)
 ;
"RTN","PRCSECP1",68,0)
S6 ;General purpose copy used for remarks
"RTN","PRCSECP1",69,0)
 F  S PRCSK=$O(^PRCS(410,T1,PRCSI,PRCSK)) Q:'PRCSK  D
"RTN","PRCSECP1",70,0)
 . S:$D(^PRCS(410,T1,PRCSI,PRCSK,0)) ^PRCS(410,DA,PRCSI,PRCSK,0)=$P(^(0),U,1)
"RTN","PRCSECP1",71,0)
 Q
"RTN","PRCSECP1",72,0)
 ;
"RTN","PRCSECP1",73,0)
S7 ;copy the items from the old transaction to the new
"RTN","PRCSECP1",74,0)
 I $D(^PRCS(410,T1,"IT",0)) D
"RTN","PRCSECP1",75,0)
 . S ^PRCS(410,DA,"IT",0)=^PRCS(410,T1,"IT",0)
"RTN","PRCSECP1",76,0)
 . K PRCSTMP S PRCSK=0
"RTN","PRCSECP1",77,0)
 . D S8
"RTN","PRCSECP1",78,0)
 Q
"RTN","PRCSECP1",79,0)
 ;
"RTN","PRCSECP1",80,0)
S8 ;copy the items from old to new (detail)
"RTN","PRCSECP1",81,0)
 F  S PRCSK=$O(^PRCS(410,T1,"IT",PRCSK)) Q:'PRCSK  I $D(^(PRCSK,0)) D
"RTN","PRCSECP1",82,0)
 . S PRCSTMP=^PRCS(410,T1,"IT",PRCSK,0)
"RTN","PRCSECP1",83,0)
 . S ^PRCS(410,DA,"IT",PRCSK,0)=$P(PRCSTMP,U,1,7)
"RTN","PRCSECP1",84,0)
 . S PRCSL=0 D S9
"RTN","PRCSECP1",85,0)
 Q
"RTN","PRCSECP1",86,0)
S9 ;copy the items from old txn to new (further detail)
"RTN","PRCSECP1",87,0)
 N PRCSTMP
"RTN","PRCSECP1",88,0)
 I $D(GET1) S $P(^PRCS(410,DA,"IT",PRCSK,0),"^",4)=GET1
"RTN","PRCSECP1",89,0)
 I $D(^PRCS(410,T1,"IT",PRCSK,1,0)) S PRCSTMP=^(0) D
"RTN","PRCSECP1",90,0)
 . S ^PRCS(410,DA,"IT",PRCSK,1,0)=$P(PRCSTMP,U,1,4)_"^"_DT
"RTN","PRCSECP1",91,0)
 F  S PRCSL=$O(^PRCS(410,T1,"IT",PRCSK,1,PRCSL)) Q:'PRCSL  D
"RTN","PRCSECP1",92,0)
 . L -^PRCS(410,DA)
"RTN","PRCSECP1",93,0)
 . I $D(^PRCS(410,T1,"IT",PRCSK,1,PRCSL,0)) S PRCSTMP=^(0),^PRCS(410,DA,"IT",PRCSK,1,PRCSL,0)=PRCSTMP
"RTN","PRCSECP1",94,0)
 Q
"RTN","PRCSECP1",95,0)
CHECK ;Check for valid CC/BOC on the FCP for this transaction
"RTN","PRCSECP1",96,0)
 ;if old trans didn't have an FCP stop right now
"RTN","PRCSECP1",97,0)
 N TEST S TEST=$P($G(^PRCS(410,T1,3)),"^",3) Q:TEST=""
"RTN","PRCSECP1",98,0)
 S PRC("ACC")=$$ACC^PRC0C(PRC("SITE"),PRC("CP")_"^"_PRC("FY")_"^"_PRC("BBFY"))
"RTN","PRCSECP1",99,0)
 S PRCSAPP=$P(PRC("ACC"),"^",11)
"RTN","PRCSECP1",100,0)
 S $P(^PRCS(410,DA,3),U)=PRC("CP"),$P(^(3),"^",2)=PRCSAPP,$P(^(3),"^",12)=$P(PRC("ACC"),"^",3)
"RTN","PRCSECP1",101,0)
 S $P(^PRCS(410,DA,3),"^",11)=$P($$DATE^PRC0C(PRC("BBFY"),"E"),"^",7)
"RTN","PRCSECP1",102,0)
 S $P(^PRCS(410,DA,7),U)=DUZ,$P(^PRCS(410,DA,7),U,2)=$P($G(^VA(200,DUZ,20)),U,3)
"RTN","PRCSECP1",103,0)
 ;P182--Commented out following 4 lines which were determining a default
"RTN","PRCSECP1",104,0)
 ;CC and attempting to get a default BOC.  Now this is accomplished in
"RTN","PRCSECP1",105,0)
 ;CHGCCBOC^PRCSCK, which is called upon return to ^PRCSECP
"RTN","PRCSECP1",106,0)
 ;I '$D(^PRC(420,PRC("SITE"),1,+PRC("CP"),2,TEST)) D
"RTN","PRCSECP1",107,0)
 ;.S GET=0 S GET=$O(^PRC(420,PRC("SITE"),1,+PRC("CP"),2,GET)) Q:+GET=0
"RTN","PRCSECP1",108,0)
 ;.Q:'$D(^PRCD(420.1,GET))  S GET1=0 S GET1=$O(^PRCD(420.1,GET,1,GET1)) Q:'$D(^PRCD(420.2,GET1))  S GET1=$E(^PRCD(420.2,GET1,0),1,30)
"RTN","PRCSECP1",109,0)
 ;.Q:+GET1=0  S $P(^PRCS(410,DA,3),"^",3)=GET
"RTN","PRCSECP1",110,0)
 Q
"RTN","PRCSECP1",111,0)
W1 W !!,"Would you like to review this request" S %=2 D YN^DICN G W1:%=0 Q:%'=1  S (N,PRCSZ)=DA,PRCSF=1 D PRF1^PRCSP1 S DA=PRCSZ K X,PRCSF,PRCSZ Q
"RTN","PRCSECP1",112,0)
W3 W !!,"Would you like to copy another request" S %=1 D YN^DICN G W3:%=0 Q
"RTN","PRCSEM")
0^19^B7333642^B6717561
"RTN","PRCSEM",1,0)
PRCSEM ;WISC/KMB-DELIVERY RECEIVING,OBLIGATION DATA ;6-6-95 12:00
"RTN","PRCSEM",2,0)
V ;;5.1;IFCAP;**148**;Oct 20, 2000;Build 5
"RTN","PRCSEM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCSEM",4,0)
 S PRCSEM=1 D EDTD^PRCSEB0 K PRCSEM
"RTN","PRCSEM",5,0)
 ;
"RTN","PRCSEM",6,0)
 Q
"RTN","PRCSEM",7,0)
ENOD ;ENTER OBLIGATION DATA
"RTN","PRCSEM",8,0)
 ; The option to execute this entry (Obligation Data [PRCSENOD]) was
"RTN","PRCSEM",9,0)
 ; was removed with PRC*5.1*148 to enforce segregation of duties.  This
"RTN","PRCSEM",10,0)
 ; entry point should no longer be used.
"RTN","PRCSEM",11,0)
 W !!,"This option is no longer available!" Q
"RTN","PRCSEM",12,0)
 ;
"RTN","PRCSEM",13,0)
 D EN3^PRCSUT G W2:'$D(PRC("SITE")),EXIT:Y<0
"RTN","PRCSEM",14,0)
 S DIC="^PRCS(410,",DIE=DIC,DIC(0)="AEQM",DIC("S")="I +^(0),$D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),""^"",5)=PRC(""SITE""),$P(^(0),""^"",2)=""O"" I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSEM",15,0)
 D ^PRCSDIC G EXIT:Y<0 K DIC("S") S (DA,PRCS)=+Y L +^PRCS(410,DA):5 G ENOD:$T=0
"RTN","PRCSEM",16,0)
ENOD1 ;
"RTN","PRCSEM",17,0)
 N VALUE,OBLAMT1 S VALUE=$P(^PRCS(410,DA,0),"^") I $D(^PRCS(410,DA,4)),$P(^(4),"^",3)>0 S OBLAMT1=$P(^(4),"^",3)
"RTN","PRCSEM",18,0)
 W !,"Committed (Estimated) Cost:" I $D(^PRCS(410,DA,4)),$P(^(4),U)]"" W ?28,$J($P(^(4),U),0,2)
"RTN","PRCSEM",19,0)
 E  W ?28,"None entered."
"RTN","PRCSEM",20,0)
 S DR="[PRCSENOD]",DIE=DIC D ^DIE
"RTN","PRCSEM",21,0)
 I $D(^PRCS(410,DA,4)),$P(^(4),"^",3)>0 D:$P(^(4),"^",10)]"" REMOVE^PRCSC2(DA) D ENCODE^PRCSC2(DA,DUZ),ERS410^PRC0G(DA_"^O")
"RTN","PRCSEM",22,0)
 S:'$D(PRCS) PRCS=DA L -^PRCS(410,DA)
"RTN","PRCSEM",23,0)
 N OBLAMT2 I $D(^PRCS(410,DA,4)),$P(^(4),"^",3)>0 S OBLAMT2=$P(^(4),"^",3)
"RTN","PRCSEM",24,0)
 I $D(OBLAMT1),$D(OBLAMT2),OBLAMT2<OBLAMT1 D SENDIT
"RTN","PRCSEM",25,0)
 D W3 G EXIT:%'=1 W !! G ENOD
"RTN","PRCSEM",26,0)
SENDIT ;
"RTN","PRCSEM",27,0)
 N XX,XMY,XMDUZ,XMSUB,XMTEXT S XX=$P($G(^PRCS(410,DA,7)),"^",1) S:XX="" XX=$P($G(^PRCS(410,DA,7)),"^",3) Q:XX=""
"RTN","PRCSEM",28,0)
 S XMDUZ=DUZ,XMY(XX)=""
"RTN","PRCSEM",29,0)
 S XMSUB="OBLIGATION DECREASE NOTIFICATION"
"RTN","PRCSEM",30,0)
 N ARRAY S ARRAY(1)="The obligation amount for transaction "_VALUE,ARRAY(2)="has been decreased from $"_OBLAMT1_" to $"_OBLAMT2_"."
"RTN","PRCSEM",31,0)
 S XMTEXT="ARRAY(" D ^XMD Q
"RTN","PRCSEM",32,0)
W2 W !!,"You are not an authorized control point user.",!,"Contact your control point official." R X:5 G EXIT
"RTN","PRCSEM",33,0)
W3 W !!,"Would you like to enter another obligation" S %=1 D YN^DICN G W3:%=0 Q
"RTN","PRCSEM",34,0)
EXIT K DA,DIC,DIE,DR,PRCS,PRCS58,PRCSL,T,X,X1,Y,DLAYGO Q
"RTN","PRCSUT2")
0^7^B51951982^B49296654
"RTN","PRCSUT2",1,0)
PRCSUT2 ;WISC/SAW/CTB/DXH - TRANSACTION UTILITY ; 9/15/2010
"RTN","PRCSUT2",2,0)
V ;;5.1;IFCAP;**13,135,148**;Oct 20, 2000;Build 5
"RTN","PRCSUT2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCSUT2",4,0)
 ; assigns a permanent transaction number to an existing transaction
"RTN","PRCSUT2",5,0)
 ; if the existing transaction is temporary, it is converted to 
"RTN","PRCSUT2",6,0)
 ;   permanent.
"RTN","PRCSUT2",7,0)
 ; if the existing transaction is permanent, a new ien is created and
"RTN","PRCSUT2",8,0)
 ;   populated with info from the existing transaction, then canceled.  
"RTN","PRCSUT2",9,0)
 ;   The original transaction is updated with the new transaction number.
"RTN","PRCSUT2",10,0)
ANTN ;
"RTN","PRCSUT2",11,0)
 N ODA,PNW,TX1,T1,T2,T3,T4,T5,PRCSY,PRCSDIC,PRCSAPP
"RTN","PRCSUT2",12,0)
ANTN1 D EN3^PRCSUT ; ask site, CP
"RTN","PRCSUT2",13,0)
 G W5:'$D(PRC("SITE"))
"RTN","PRCSUT2",14,0)
 G EXIT:Y<0
"RTN","PRCSUT2",15,0)
 W !!,"Select the existing transaction number to be replaced",!
"RTN","PRCSUT2",16,0)
 S DIC="^PRCS(410,",DIC(0)="AEFMQ"
"RTN","PRCSUT2",17,0)
 S DIC("S")="I $P(^(0),U,2)=""O""!($P(^(0),U,2)=""A""&($P(^(0),U,4)=1)),$S('$D(^(7)):1,1:$P(^(7),""^"",6)=""""),$D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),U,5)=PRC(""SITE"") I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSUT2",18,0)
 D ^PRCSDIC G:Y<0 EXIT
"RTN","PRCSUT2",19,0)
 S (ODA,DA,T1)=+Y,PRCSDIC=DIC
"RTN","PRCSUT2",20,0)
 L +^PRCS(410,DA):$S($D(DILOCKTM):DILOCKTM,1:3)
"RTN","PRCSUT2",21,0)
 I $T=0 W !,"File being accessed...please try later" G ANTN1
"RTN","PRCSUT2",22,0)
 D REVIEW
"RTN","PRCSUT2",23,0)
 S T2=^PRCS(410,DA,0) ; node 0 string of txn to be replaced
"RTN","PRCSUT2",24,0)
 S T5=$P(T2,"^",10) ; substation
"RTN","PRCSUT2",25,0)
 S T4=$P(T2,"^",2) ; txn type of transaction to be replaced
"RTN","PRCSUT2",26,0)
 S T2=$P(T2,"^") ; txn number to be replaced
"RTN","PRCSUT2",27,0)
 S T3=$P(^PRCS(410,DA,3),"^") ; control point of txn to be replaced
"RTN","PRCSUT2",28,0)
 K DA,DIC,Y
"RTN","PRCSUT2",29,0)
 W !!,"Enter the information for the new transaction number",!
"RTN","PRCSUT2",30,0)
 D EN^PRCSUT3 ; ask SITE, FY, QRTR, CP for new txn
"RTN","PRCSUT2",31,0)
 G:'$D(PRC("QTR"))!('$D(PRC("CP"))) EXIT
"RTN","PRCSUT2",32,0)
 S TX1=X
"RTN","PRCSUT2",33,0)
 I $P($G(^PRCS(410,T1,0)),"^",4)=1,$$Q1358^PRCEN(PRC("SITE"),PRC("CP"),T4,T1) G EXIT
"RTN","PRCSUT2",34,0)
 D IP^PRCSUT ; set up prcsip
"RTN","PRCSUT2",35,0)
 S PRCSAPP=$P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),"^",3)
"RTN","PRCSUT2",36,0)
 I PRC("CP")'=T3,PRCSAPP["_" D PRCFY G EXIT:PRCSAPP["_"
"RTN","PRCSUT2",37,0)
 S X=TX1
"RTN","PRCSUT2",38,0)
 D EN1^PRCSUT3 ; generate new name for txn and put in X
"RTN","PRCSUT2",39,0)
 G:'X EXIT
"RTN","PRCSUT2",40,0)
 S TX1=X,(DIC,DIE)="^PRCS(410,"
"RTN","PRCSUT2",41,0)
CK G:'+T2 CK1 ; don't set up new ien for temp txns (txns with non-numeric names)
"RTN","PRCSUT2",42,0)
 K DA
"RTN","PRCSUT2",43,0)
 S DLAYGO=410,DIC="^PRCS(410,",DIC(0)="LXZ"
"RTN","PRCSUT2",44,0)
 D ^DIC
"RTN","PRCSUT2",45,0)
 K DLAYGO
"RTN","PRCSUT2",46,0)
 G:Y'>0 EXIT
"RTN","PRCSUT2",47,0)
 S DA=+Y
"RTN","PRCSUT2",48,0)
 L +^PRCS(410,DA):$S($D(DILOCKTM):DILOCKTM,1:3) ; Lock new ien
"RTN","PRCSUT2",49,0)
 I $T=0 W !," Cannot create new number now...please try again later" G EXIT
"RTN","PRCSUT2",50,0)
 ; clean up txn x-refs for old & new ien's (nodes 'B','B2','B3','AE')
"RTN","PRCSUT2",51,0)
 K ^PRCS(410,"B",TX1,DA),^PRCS(410,"B2",$P(TX1,"-",5),DA),^PRCS(410,"B3",$P(TX1,"-",2)_"-"_$P(TX1,"-",5),DA),^PRCS(410,"AE",$P(TX1,"-",1,4),DA)
"RTN","PRCSUT2",52,0)
 ; kill x-refs to old ien
"RTN","PRCSUT2",53,0)
 N RBQTDT,DSH,RBOLD
"RTN","PRCSUT2",54,0)
 S RBQTDT=$P($G(^PRCS(410,T1,0)),"^",11),DSH="-" D:RBQTDT>0
"RTN","PRCSUT2",55,0)
 . S RBOLD=RBQTDT_DSH_$P(T2,"-")_DSH_$P(T2,"-",4)_DSH_$P(T2,"-",2)_DSH_$P(T2,"-",5)
"RTN","PRCSUT2",56,0)
 . K ^PRCS(410,"RB",RBOLD,T1)
"RTN","PRCSUT2",57,0)
 K RBQTDT,DSH,RBOLD
"RTN","PRCSUT2",58,0)
 K ^PRCS(410,"B",T2,T1),^PRCS(410,"B2",$P(T2,"-",5),T1),^PRCS(410,"B3",$P(T2,"-",2)_"-"_$P(T2,"-",5),T1),^PRCS(410,"AE",$P(T2,"-",1,4),T1)
"RTN","PRCSUT2",59,0)
 ; set old txn name into new ien
"RTN","PRCSUT2",60,0)
 S $P(^PRCS(410,DA,0),"^")=T2
"RTN","PRCSUT2",61,0)
 ; set x-refs of old txn values to new ien
"RTN","PRCSUT2",62,0)
 S (^PRCS(410,"B",T2,DA),^PRCS(410,"B2",$P(T2,"-",5),DA),^PRCS(410,"B3",$P(T2,"-",2)_"-"_$P(T2,"-",5),DA),^PRCS(410,"AE",$P(T2,"-",1,4),DA))=""
"RTN","PRCSUT2",63,0)
CK1 ; set new txn name into old (original) ien
"RTN","PRCSUT2",64,0)
 S $P(^PRCS(410,T1,0),"^")=TX1
"RTN","PRCSUT2",65,0)
 ; set x-refs of new txn values to old ien
"RTN","PRCSUT2",66,0)
 S (^PRCS(410,"B",TX1,T1),^PRCS(410,"B2",$P(TX1,"-",5),T1),^PRCS(410,"B3",$P(TX1,"-",2)_"-"_$P(TX1,"-",5),T1),^PRCS(410,"AE",$P(TX1,"-",1,4),T1))=""
"RTN","PRCSUT2",67,0)
 ; delete old txn from temp txn x-ref & remove temp txn flag
"RTN","PRCSUT2",68,0)
 K ^PRCS(410,"K",+T3,ODA) S $P(^PRCS(410,ODA,6),"^",4)=""
"RTN","PRCSUT2",69,0)
 S PRC("OCP")=$P(^PRCS(410,ODA,3),U)
"RTN","PRCSUT2",70,0)
 ; if old txn name is non-numeric (temp txn), force new site & CP into record at old ien
"RTN","PRCSUT2",71,0)
 I '+T2 S DA=ODA,DIE="^PRCS(410,",DR=".5///"_PRC("SITE")_";S X=X;15///"_PRC("CP") D ^DIE G EN
"RTN","PRCSUT2",72,0)
 ; else: cancel txn at old ien; force old site & CP info into new ien
"RTN","PRCSUT2",73,0)
 ;(Shortened comment and added cancel flag with patch 182
"RTN","PRCSUT2",74,0)
 S DIE="^PRCS(410,",DR=".5///"_+T2_";S X=X;15///"_T3
"RTN","PRCSUT2",75,0)
 S DR=DR_";60///Transaction "_T2_" replaced by trans. "_TX1
"RTN","PRCSUT2",76,0)
 S DR=DR_";450///C" ;put cancel flag in Running Bal status 
"RTN","PRCSUT2",77,0)
 D ^DIE
"RTN","PRCSUT2",78,0)
 I T5'="" S $P(^PRCS(410,DA,0),U,10)=T5 ; save substation in new ien
"RTN","PRCSUT2",79,0)
 S $P(^PRCS(410,DA,0),U,2)="CA" ; cancel txn at new ien
"RTN","PRCSUT2",80,0)
 D ERS410^PRC0G(DA_"^C")
"RTN","PRCSUT2",81,0)
 D W5^PRCSEB ; kill flags & x-refs indicating cancel txn is ready to approve
"RTN","PRCSUT2",82,0)
 L -^PRCS(410,DA) ; release new ien
"RTN","PRCSUT2",83,0)
 W !,"Old transaction "_T2_" is now cancelled.",!
"RTN","PRCSUT2",84,0)
 I $D(^PRC(443,ODA,0)) S DA=ODA,DIK="^PRC(443," D ^DIK K DA,DIK
"RTN","PRCSUT2",85,0)
EN W !!,"Transaction '"_T2_"' has been replaced by "_TX1,!
"RTN","PRCSUT2",86,0)
 S PNW=ODA,PNW(1)=TX1
"RTN","PRCSUT2",87,0)
 N A,B
"RTN","PRCSUT2",88,0)
 S A=TX1 D RBQTR ; returns B for DR string (RB Qrtr date)
"RTN","PRCSUT2",89,0)
 I $E(B,$L(B))=";" S B=$E(B,1,$L(B)-1) ; remove trailing semi-colon
"RTN","PRCSUT2",90,0)
 S DA=PNW,DR=B_$S(+T2:";1///"_T4,1:"")_$S(PRC("SITE")'=+T2:";S X=X;.5///"_PRC("SITE"),1:"")_$S(PRC("CP")'=T3:";S X=X;15///"_PRC("CP"),1:"")_$S($D(PRCSIP):";4////"_PRCSIP,1:"")
"RTN","PRCSUT2",91,0)
 S DR=DR_$S($P($G(^PRCS(410,DA,0)),"^",4)=1:";40////^S X=DUZ",1:"")
"RTN","PRCSUT2",92,0)
 D ^DIE
"RTN","PRCSUT2",93,0)
 S PRC("ACC")=$$ACC^PRC0C(PRC("SITE"),PRC("CP")_"^"_PRC("FY")_"^"_PRC("BBFY"))
"RTN","PRCSUT2",94,0)
 S PRCSAPP=$P(PRC("ACC"),"^",11)
"RTN","PRCSUT2",95,0)
 S $P(^PRCS(410,DA,3),"^")=PRC("CP")
"RTN","PRCSUT2",96,0)
 S $P(^PRCS(410,DA,3),"^",2)=PRCSAPP
"RTN","PRCSUT2",97,0)
 S $P(^PRCS(410,DA,3),"^",12)=$P(PRC("ACC"),"^",3)
"RTN","PRCSUT2",98,0)
 S $P(^PRCS(410,DA,3),"^",11)=$P($$DATE^PRC0C(PRC("BBFY"),"E"),"^",7)
"RTN","PRCSUT2",99,0)
 N MYY S MYY="" D EN2B^PRCSUT3 ; save substation & process with status of entered
"RTN","PRCSUT2",100,0)
 D K^PRCSUT1 ; kill 'F', 'F1', x-refs
"RTN","PRCSUT2",101,0)
 K T1(1)
"RTN","PRCSUT2",102,0)
 S (DA,PRCS,PRCSY)=PNW
"RTN","PRCSUT2",103,0)
 I $P(^PRCS(410,DA,0),"^",4)=1 D  G ANTN:%=1,EXIT
"RTN","PRCSUT2",104,0)
 . S AA=$$CHGCCBOC^PRCSCK(T2,TX1,PRC("OCP"),0)
"RTN","PRCSUT2",105,0)
 . W !,"Use the 1358 edit option ",$S(AA<0:"",1:"if you wish "),"to edit this request.",!! D EXIT,W3
"RTN","PRCSUT2",106,0)
 ; restore values associated with new txn (use new name)
"RTN","PRCSUT2",107,0)
 S PRC("SITE")=$P(PNW(1),"-"),PRC("FY")=$P(PNW(1),"-",2),PRC("QTR")=$P(PNW(1),"-",3),PRC("CP")=$P(PNW(1),"-",4),PRCSQ=1
"RTN","PRCSUT2",108,0)
 S AA=$$CHGCCBOC^PRCSCK(T2,TX1,PRC("OCP"),0)
"RTN","PRCSUT2",109,0)
 I AA<0 W !,"Use the Edit a 2237 option to edit this request.",!! D EXIT,W3 G ANTN:%=1,EXIT
"RTN","PRCSUT2",110,0)
 E  D W1 ; ask 'edit this request?'
"RTN","PRCSUT2",111,0)
 I %=2 D W6^PRCSEB G EN1 ; if no, may ask if ready for authorization
"RTN","PRCSUT2",112,0)
 D:%=1 EDTD1^PRCSEB0 D:'$D(PRCSQ)&(T4="O") W6^PRCSEB
"RTN","PRCSUT2",113,0)
EN1 K PRCSQ
"RTN","PRCSUT2",114,0)
 L -^PRCS(410,ODA)
"RTN","PRCSUT2",115,0)
 D W3 I %=1 D EXIT W !! G ANTN1
"RTN","PRCSUT2",116,0)
 G EXIT
"RTN","PRCSUT2",117,0)
 ;
"RTN","PRCSUT2",118,0)
PRCFY S A=PRCSAPP I A["_/_" D FY2 G KILL
"RTN","PRCSUT2",119,0)
 I A["_" S PRCSAPP=$P(A,"_",1)_$E(PRC("FY"),$L(PRC("FY")))_$P(A,"_",2)
"RTN","PRCSUT2",120,0)
KILL K %DT,A,B,RES,X
"RTN","PRCSUT2",121,0)
 Q
"RTN","PRCSUT2",122,0)
 ;
"RTN","PRCSUT2",123,0)
FY2 ;TWO YR APP
"RTN","PRCSUT2",124,0)
 I '$D(PRC("FY")) D NOW^%DTC S PRC("FY")=$E(100+$E(X,4)+$E(X,2,3),2,3)
"RTN","PRCSUT2",125,0)
 W !!,"Enter first year of this two year appropriation: ",PRC("FY")," // " R RES:DTIME G:RES["^" FY21
"RTN","PRCSUT2",126,0)
 I RES["?"!(RES'?.4N) W !,"Enter fiscal year in format '1' '81' or '1981'",!! G FY2
"RTN","PRCSUT2",127,0)
FY21 S:'RES RES=PRC("FY")
"RTN","PRCSUT2",128,0)
 S RES=$E(RES,$L(RES)),PRCSAPP=$P(A,"_",1)_RES_"/"_(RES+1#10)_$P(A,"_",3)
"RTN","PRCSUT2",129,0)
 Q
"RTN","PRCSUT2",130,0)
 ;
"RTN","PRCSUT2",131,0)
REVIEW W !!,"Would you like to review this request"
"RTN","PRCSUT2",132,0)
 S %=2 D YN^DICN G REVIEW:%=0
"RTN","PRCSUT2",133,0)
 Q:%'=1
"RTN","PRCSUT2",134,0)
 S (N,PRCSZ)=DA,PRCSF=1
"RTN","PRCSUT2",135,0)
 D PRF1^PRCSP1 ; print 2237
"RTN","PRCSUT2",136,0)
 S DA=PRCSZ
"RTN","PRCSUT2",137,0)
 K X,PRCSF,PRCSZ
"RTN","PRCSUT2",138,0)
 Q
"RTN","PRCSUT2",139,0)
 ;
"RTN","PRCSUT2",140,0)
W1 S %=2 Q:T4'="O"
"RTN","PRCSUT2",141,0)
 W !!,"Would you like to edit this request"
"RTN","PRCSUT2",142,0)
 D YN^DICN G W1:%=0
"RTN","PRCSUT2",143,0)
 Q
"RTN","PRCSUT2",144,0)
 ;
"RTN","PRCSUT2",145,0)
W3 W !!,"Would you like to replace another transaction number"
"RTN","PRCSUT2",146,0)
 S %=2 D YN^DICN G W3:%=0
"RTN","PRCSUT2",147,0)
 Q
"RTN","PRCSUT2",148,0)
 ;
"RTN","PRCSUT2",149,0)
W5 W !!,"You are not an authorized control point user.",!,"Contact your control point official." R X:5
"RTN","PRCSUT2",150,0)
EXIT I $D(ODA) L -^PRCS(410,ODA)
"RTN","PRCSUT2",151,0)
 D EXIT^PRCSUT31
"RTN","PRCSUT2",152,0)
 Q
"RTN","PRCSUT2",153,0)
 ;
"RTN","PRCSUT2",154,0)
MO ;MO QRTR
"RTN","PRCSUT2",155,0)
 I DA,$D(^PRCS(410,DA,0)) S PRCSQT=$P(^(0),"-",3) I PRCSQT="" K PRCSQT Q
"RTN","PRCSUT2",156,0)
 I PRCSQT=1 W !?3,"10  OCT",!?3,"11  NOV",!?3,"12  DEC" Q
"RTN","PRCSUT2",157,0)
 I PRCSQT=2 W !?3," 1  JAN",!?3," 2  FEB",!?3," 3  MAR" Q
"RTN","PRCSUT2",158,0)
 I PRCSQT=3 W !?3," 4  APR",!?3," 5  MAY",!?3," 6  JUN" Q
"RTN","PRCSUT2",159,0)
 I PRCSQT=4 W !?3," 7  JUL",!?3," 8  AUG",!?3," 9  SEP" Q
"RTN","PRCSUT2",160,0)
 Q
"RTN","PRCSUT2",161,0)
 ;
"RTN","PRCSUT2",162,0)
MO1 I DA,$D(^PRCS(410,DA,0)) S PRCSQT=$P(^(0),"-",3) I PRCSQT="" K PRCSQT Q
"RTN","PRCSUT2",163,0)
 S PRCSMO=$S(X<4:2,X>9:1,X>3&(X<7):3,X>6&(X<10):4,1:"")
"RTN","PRCSUT2",164,0)
 I PRCSMO="" K PRCSMO
"RTN","PRCSUT2",165,0)
 Q
"RTN","PRCSUT2",166,0)
 ;
"RTN","PRCSUT2",167,0)
RBQTR N C,D S B="",B=$S(B="":$P(A,"-",2)_"^F",1:+$$DATE^PRC0C(B,"I"))
"RTN","PRCSUT2",168,0)
 S C=$$QTRDT^PRC0G($P(A,"-",1)_"^"_$P(A,"-",4)_"^"_B)
"RTN","PRCSUT2",169,0)
 S D=$$QTRDATE^PRC0D($P(A,"-",2),$P(A,"-",3)),D=$P(D,"^",7)
"RTN","PRCSUT2",170,0)
 S B=$S(D<$P(C,"^",3):$P(C,"^",3),$P(C,"^",2)<D:$P(C,"^",2),1:D)
"RTN","PRCSUT2",171,0)
 S B="449////"_B_";"
"RTN","PRCSUT2",172,0)
 QUIT
"SEC","^DIC",410.9,410.9,0,"AUDIT")
@
"SEC","^DIC",410.9,410.9,0,"DD")
@
"SEC","^DIC",410.9,410.9,0,"DEL")
@
"SEC","^DIC",410.9,410.9,0,"LAYGO")
@
"SEC","^DIC",410.9,410.9,0,"RD")

"SEC","^DIC",410.9,410.9,0,"WR")
@
"VER")
8.0^22.0
"^DD",410,410,6,0)
SERVICE START DATE^D^^1;6^S %DT="EX" D ^%DT S X=Y K:X<1 X
"^DD",410,410,6,3)
Enter the starting date of the service(s).
"^DD",410,410,6,21,0)
^^1^1^3100916^
"^DD",410,410,6,21,1,0)
This is the starting date of the service(s) for this obligation.
"^DD",410,410,6,"DT")
3100916
"^DD",410,410,6.5,0)
SERVICE END DATE^DX^^1;7^S %DT="EX" S:$D(PRCSDT) %DT(0)=PRCSDT D ^%DT S X=Y K:X<1 X
"^DD",410,410,6.5,3)
Enter the ending date of the service(s). (Must be at least or after the start date)
"^DD",410,410,6.5,21,0)
^^1^1^3100916^
"^DD",410,410,6.5,21,1,0)
This is the ending date of the service(s) for this obligation.
"^DD",410,410,6.5,"DT")
3100916
"^DD",410,410,19,0)
AUTHORITY^*P410.9'^PRCS(410.9,^11;4^S DIC("S")="I ('$P(^(0),U,4)!($P(^(0),U,4)>DT)),Y<100" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",410,410,19,3)
Select the Authority for this 1358 Obligation.
"^DD",410,410,19,12)
Only Active Primary Authorities.
"^DD",410,410,19,12.1)
S DIC("S")="I ('$P(^(0),U,4)!($P(^(0),U,4)>DT)),Y<100"
"^DD",410,410,19,21,0)
^^2^2^3100825^
"^DD",410,410,19,21,1,0)
This is the officially approved authority for use of a 1358 document.  You
"^DD",410,410,19,21,2,0)
can only select active authorities.
"^DD",410,410,19,"DT")
3100830
"^DD",410,410,19.1,0)
SUB AUTHORITY^*P410.9'^PRCS(410.9,^11;5^S DIC("S")="I ('$P(^(0),U,4)!($P(^(0),U,4)>DT)),$D(^PRCS(410.9,""AC"",+$P($G(^PRCS(410,D0,11)),U,4),Y))" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",410,410,19.1,3)
Select the Sub-Authority for this 1358 Obligation.
"^DD",410,410,19.1,12)
You can only select active sub-authorities that relate to the main one.
"^DD",410,410,19.1,12.1)
S DIC("S")="I ('$P(^(0),U,4)!($P(^(0),U,4)>DT)),$D(^PRCS(410.9,""AC"",+$P($G(^PRCS(410,D0,11)),U,4),Y))"
"^DD",410,410,19.1,21,0)
^^3^3^3100825^
"^DD",410,410,19.1,21,1,0)
This is the officially approved sub-authority for use of a 1358
"^DD",410,410,19.1,21,2,0)
document.  You can only select active sub-authorities for the authority
"^DD",410,410,19.1,21,3,0)
you selected.
"^DD",410,410,19.1,"DT")
3100827
"^DD",410.9,410.9,0)
FIELD^^.02^7
"^DD",410.9,410.9,0,"DDA")
N
"^DD",410.9,410.9,0,"DT")
3100908
"^DD",410.9,410.9,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",410.9,410.9,0,"IX","AC",410.9,.03)

"^DD",410.9,410.9,0,"IX","B",410.9,.01)

"^DD",410.9,410.9,0,"IX","C",410.9,.02)

"^DD",410.9,410.9,0,"NM","AUTHORITY OF REQUEST")

"^DD",410.9,410.9,0,"PT",410,19)

"^DD",410.9,410.9,0,"PT",410,19.1)

"^DD",410.9,410.9,0,"PT",410.9,.03)

"^DD",410.9,410.9,.01,0)
AUTHORITY CODE^RF^^0;1^K:$L(X)>2!($L(X)<1) X
"^DD",410.9,410.9,.01,1,0)
^.1
"^DD",410.9,410.9,.01,1,1,0)
410.9^B
"^DD",410.9,410.9,.01,1,1,1)
S ^PRCS(410.9,"B",$E(X,1,30),DA)=""
"^DD",410.9,410.9,.01,1,1,2)
K ^PRCS(410.9,"B",$E(X,1,30),DA)
"^DD",410.9,410.9,.01,3)
Enter the code for the authority or sub-authority (1-2 characters).
"^DD",410.9,410.9,.01,21,0)
^^4^4^3100908^^
"^DD",410.9,410.9,.01,21,1,0)
This is the code for quick selection of the authority.  For primary 
"^DD",410.9,410.9,.01,21,2,0)
authorities they are numeric sequential.  For secondary authorities they 
"^DD",410.9,410.9,.01,21,3,0)
are alpha characters.  Alpha characters can be duplicated but not in 
"^DD",410.9,410.9,.01,21,4,0)
relation to the same primary authority.
"^DD",410.9,410.9,.01,23,0)
^^4^4^3100908^
"^DD",410.9,410.9,.01,23,1,0)
Authorities with an IEN value of less than 100 (1-2 characters numeric)
"^DD",410.9,410.9,.01,23,2,0)
are all Primary Authority codes.  Authorities with an IEN value > 100 are
"^DD",410.9,410.9,.01,23,3,0)
secondary (sub) authority codes.  Sub-authorities are Alpha characters 
"^DD",410.9,410.9,.01,23,4,0)
(A-Z).
"^DD",410.9,410.9,.01,"DT")
3100908
"^DD",410.9,410.9,.02,0)
AUTHORITY DESCRIPTION^FX^^0;2^S X=$$UP^XLFSTR(X) K:$L(X)>68!($L(X)<3) X
"^DD",410.9,410.9,.02,1,0)
^.1
"^DD",410.9,410.9,.02,1,1,0)
410.9^C^MUMPS
"^DD",410.9,410.9,.02,1,1,1)
S:DA<100 ^PRCS(410.9,"C",$E(X,1,30),DA)=""
"^DD",410.9,410.9,.02,1,1,2)
K:DA<100 ^PRCS(410.9,"C",$E(X,1,30),DA)
"^DD",410.9,410.9,.02,1,1,"%D",0)
^^2^2^3100910^
"^DD",410.9,410.9,.02,1,1,"%D",1,0)
Cross reference included to allow for descriptive name lookup for Primary
"^DD",410.9,410.9,.02,1,1,"%D",2,0)
Authorities only.
"^DD",410.9,410.9,.02,1,1,"DT")
3100910
"^DD",410.9,410.9,.02,3)
Enter the name of the 1358 authority (3-68 characters).
"^DD",410.9,410.9,.02,21,0)
^^2^2^3100826^
"^DD",410.9,410.9,.02,21,1,0)
This is the text description of the 1358 authority to be used for display 
"^DD",410.9,410.9,.02,21,2,0)
and reports.
"^DD",410.9,410.9,.02,"DT")
3100910
"^DD",410.9,410.9,.03,0)
PRIMARY AUTHORITY^*P410.9'^PRCS(410.9,^0;3^S DIC("S")="I '$P(^PRCS(410.9,Y,0),U,3)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",410.9,410.9,.03,1,0)
^.1
"^DD",410.9,410.9,.03,1,1,0)
410.9^AC
"^DD",410.9,410.9,.03,1,1,1)
S ^PRCS(410.9,"AC",$E(X,1,30),DA)=""
"^DD",410.9,410.9,.03,1,1,2)
K ^PRCS(410.9,"AC",$E(X,1,30),DA)
"^DD",410.9,410.9,.03,1,1,"%D",0)
^^2^2^3100826^
"^DD",410.9,410.9,.03,1,1,"%D",1,0)
Used to identify if any primary authorities exist in relation to
"^DD",410.9,410.9,.03,1,1,"%D",2,0)
sub-authorities. 
"^DD",410.9,410.9,.03,1,1,"DT")
3100826
"^DD",410.9,410.9,.03,3)
If this is a sub-authority, select the primary authority.
"^DD",410.9,410.9,.03,12)
ONLY PRIMARY AUTHORITIES CAN BE SELECTED.
"^DD",410.9,410.9,.03,12.1)
S DIC("S")="I '$P(^PRCS(410.9,Y,0),U,3)"
"^DD",410.9,410.9,.03,21,0)
^^3^3^3100826^
"^DD",410.9,410.9,.03,21,1,0)
This field is used to point to the primary authority.  When entering a
"^DD",410.9,410.9,.03,21,2,0)
1358 after selecting a primary authority, you will only be able to select
"^DD",410.9,410.9,.03,21,3,0)
associated sub-authorities that relate to the primary authority.
"^DD",410.9,410.9,.03,"DT")
3100826
"^DD",410.9,410.9,.04,0)
DATE INACTIVE^D^^0;4^S %DT="EX" D ^%DT S X=Y K:X<1 X
"^DD",410.9,410.9,.04,3)
Enter the date this authority is no longer active for selection.
"^DD",410.9,410.9,.04,21,0)
^^3^3^3100826^
"^DD",410.9,410.9,.04,21,1,0)
This is the date the authority is no longer valid for selection in
"^DD",410.9,410.9,.04,21,2,0)
association with creation of a 1358.  If the date is past the entry will
"^DD",410.9,410.9,.04,21,3,0)
no longer be available for selection.
"^DD",410.9,410.9,.04,"DT")
3100826
"^DD",410.9,410.9,.05,0)
VENDOR MANDATORY^S^0:NO;1:YES;^0;5^Q
"^DD",410.9,410.9,.05,3)
Is Vendor selection mandatory?
"^DD",410.9,410.9,.05,21,0)
^^2^2^3100825^
"^DD",410.9,410.9,.05,21,1,0)
This will specify if a vendor selection is mandatory for this type of 
"^DD",410.9,410.9,.05,21,2,0)
authority on a 1358.
"^DD",410.9,410.9,.05,"DT")
3100908
"^DD",410.9,410.9,.06,0)
CONTRACT MANDATORY^S^0:NO;1:YES;^0;6^Q
"^DD",410.9,410.9,.06,3)
Is Contract selection mandatory?
"^DD",410.9,410.9,.06,21,0)
^^2^2^3100825^
"^DD",410.9,410.9,.06,21,1,0)
This will specify if a contract selection is mandatory for this type of 
"^DD",410.9,410.9,.06,21,2,0)
authority on a 1358.
"^DD",410.9,410.9,.06,"DT")
3100908
"^DD",410.9,410.9,.07,0)
FMS CODE^F^^0;7^K:$L(X)>3!($L(X)<1) X
"^DD",410.9,410.9,.07,3)
Enter the code for FMS transmission (1-3 characters).
"^DD",410.9,410.9,.07,21,0)
^^2^2^3100826^
"^DD",410.9,410.9,.07,21,1,0)
This is the 1-3 digit code to be included on code sheets transmitted to
"^DD",410.9,410.9,.07,21,2,0)
FMS that indicates the authority that was used for the 1358 creation.
"^DD",410.9,410.9,.07,23,0)
^^8^8^3100908^
"^DD",410.9,410.9,.07,23,1,0)
Fields .01 and .07 may be the same or different. The .01 is what the user
"^DD",410.9,410.9,.07,23,2,0)
selects from a coded list. The .07 is what is actually sent to FMS in the
"^DD",410.9,410.9,.07,23,3,0)
code sheet, sometimes the .07 is a Numeric and sometimes it is a Numeric +
"^DD",410.9,410.9,.07,23,4,0)
an Alpha Coded value.  They are only the same if it is numeric only.
"^DD",410.9,410.9,.07,23,5,0)
 
"^DD",410.9,410.9,.07,23,6,0)
In a (primary) authority code record, the FMS code is the numeric
"^DD",410.9,410.9,.07,23,7,0)
authority code, if it's a sub-authority code record, the FMS code is the
"^DD",410.9,410.9,.07,23,8,0)
numeric (primary) authority code followed by the alpha sub-authority code.
"^DD",410.9,410.9,.07,"DT")
3100908
"^DIC",410.9,410.9,0)
AUTHORITY OF REQUEST^410.9
"^DIC",410.9,410.9,0,"GL")
^PRCS(410.9,
"^DIC",410.9,410.9,"%",0)
^1.005^^0
"^DIC",410.9,410.9,"%D",0)
^^5^5^3100825^
"^DIC",410.9,410.9,"%D",1,0)
This file contains a list of officially approved authorities for 1358 
"^DIC",410.9,410.9,"%D",2,0)
creation.  Entries in this file are populated via national patches only, 
"^DIC",410.9,410.9,"%D",3,0)
no data should be entered, edited or deleted within this file.
"^DIC",410.9,410.9,"%D",4,0)
 
"^DIC",410.9,410.9,"%D",5,0)
Per VHA Directive 2004-038, this file should not be modified.
"^DIC",410.9,"B","AUTHORITY OF REQUEST",410.9)

"BLD",6572,6)
^124
**END**
**END**
