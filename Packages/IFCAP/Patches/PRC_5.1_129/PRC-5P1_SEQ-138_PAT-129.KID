Released PRC*5.1*129 SEQ #138
Extracted from mail message
**KIDS**:PRC*5.1*129^

**INSTALL NAME**
PRC*5.1*129
"BLD",5919,0)
PRC*5.1*129^IFCAP^0^3111026^y
"BLD",5919,1,0)
^^9^9^3110216^^
"BLD",5919,1,1,0)
1. Tasking the option 'Inactivate Expired Charge Cards' does not work as
"BLD",5919,1,2,0)
   the processing asks for STATION which cannot be answered once tasked.
"BLD",5919,1,3,0)
 
"BLD",5919,1,4,0)
2. Option, New Purchase Order [PRCHPC PO ADD], must have query INVOICE 
"BLD",5919,1,5,0)
   ADDRESS default 'FMS' changed to "VA FSC'.
"BLD",5919,1,6,0)
 
"BLD",5919,1,7,0)
3. Routine PRCHNPO6 is not in compliance with SACC (VistA Programming 
"BLD",5919,1,8,0)
   Standards and Conventions) since lock ':0' is less than the value of
"BLD",5919,1,9,0)
   the kernel variable "DILOCKTM". 
"BLD",5919,4,0)
^9.64PA^^0
"BLD",5919,6.3)
5
"BLD",5919,"ABPKG")
n
"BLD",5919,"KRN",0)
^9.67PA^779.2^20
"BLD",5919,"KRN",.4,0)
.4
"BLD",5919,"KRN",.401,0)
.401
"BLD",5919,"KRN",.402,0)
.402
"BLD",5919,"KRN",.402,"NM",0)
^9.68A^7^7
"BLD",5919,"KRN",.402,"NM",1,0)
PRCH2138    FILE #442^442^0
"BLD",5919,"KRN",.402,"NM",2,0)
PRCHSIMP    FILE #442^442^0
"BLD",5919,"KRN",.402,"NM",3,0)
PRCH DETAILED PURCHASE CARD    FILE #442^442^0
"BLD",5919,"KRN",.402,"NM",4,0)
PRCH DIRECT DELIVERY ORDER    FILE #442^442^0
"BLD",5919,"KRN",.402,"NM",5,0)
PRCH PROSTHETIC    FILE #442^442^0
"BLD",5919,"KRN",.402,"NM",6,0)
PRCH PC DIRECT DELIVERY    FILE #442^442^0
"BLD",5919,"KRN",.402,"NM",7,0)
PRCH DELIVERY ORDER    FILE #442^442^0
"BLD",5919,"KRN",.402,"NM","B","PRCH DELIVERY ORDER    FILE #442",7)

"BLD",5919,"KRN",.402,"NM","B","PRCH DETAILED PURCHASE CARD    FILE #442",3)

"BLD",5919,"KRN",.402,"NM","B","PRCH DIRECT DELIVERY ORDER    FILE #442",4)

"BLD",5919,"KRN",.402,"NM","B","PRCH PC DIRECT DELIVERY    FILE #442",6)

"BLD",5919,"KRN",.402,"NM","B","PRCH PROSTHETIC    FILE #442",5)

"BLD",5919,"KRN",.402,"NM","B","PRCH2138    FILE #442",1)

"BLD",5919,"KRN",.402,"NM","B","PRCHSIMP    FILE #442",2)

"BLD",5919,"KRN",.403,0)
.403
"BLD",5919,"KRN",.5,0)
.5
"BLD",5919,"KRN",.84,0)
.84
"BLD",5919,"KRN",3.6,0)
3.6
"BLD",5919,"KRN",3.8,0)
3.8
"BLD",5919,"KRN",9.2,0)
9.2
"BLD",5919,"KRN",9.8,0)
9.8
"BLD",5919,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5919,"KRN",9.8,"NM",1,0)
PRCH3A^^0^B4015402
"BLD",5919,"KRN",9.8,"NM",2,0)
PRCHNPO6^^0^B22810187
"BLD",5919,"KRN",9.8,"NM","B","PRCH3A",1)

"BLD",5919,"KRN",9.8,"NM","B","PRCHNPO6",2)

"BLD",5919,"KRN",19,0)
19
"BLD",5919,"KRN",19.1,0)
19.1
"BLD",5919,"KRN",101,0)
101
"BLD",5919,"KRN",409.61,0)
409.61
"BLD",5919,"KRN",771,0)
771
"BLD",5919,"KRN",779.2,0)
779.2
"BLD",5919,"KRN",870,0)
870
"BLD",5919,"KRN",8989.51,0)
8989.51
"BLD",5919,"KRN",8989.52,0)
8989.52
"BLD",5919,"KRN",8994,0)
8994
"BLD",5919,"KRN","B",.4,.4)

"BLD",5919,"KRN","B",.401,.401)

"BLD",5919,"KRN","B",.402,.402)

"BLD",5919,"KRN","B",.403,.403)

"BLD",5919,"KRN","B",.5,.5)

"BLD",5919,"KRN","B",.84,.84)

"BLD",5919,"KRN","B",3.6,3.6)

"BLD",5919,"KRN","B",3.8,3.8)

"BLD",5919,"KRN","B",9.2,9.2)

"BLD",5919,"KRN","B",9.8,9.8)

"BLD",5919,"KRN","B",19,19)

"BLD",5919,"KRN","B",19.1,19.1)

"BLD",5919,"KRN","B",101,101)

"BLD",5919,"KRN","B",409.61,409.61)

"BLD",5919,"KRN","B",771,771)

"BLD",5919,"KRN","B",779.2,779.2)

"BLD",5919,"KRN","B",870,870)

"BLD",5919,"KRN","B",8989.51,8989.51)

"BLD",5919,"KRN","B",8989.52,8989.52)

"BLD",5919,"KRN","B",8994,8994)

"BLD",5919,"QUES",0)
^9.62^^
"BLD",5919,"REQB",0)
^9.611^1^1
"BLD",5919,"REQB",1,0)
PRC*5.1*125^2
"BLD",5919,"REQB","B","PRC*5.1*125",1)

"KRN",.402,2456,-1)
0^1
"KRN",.402,2456,0)
PRCH2138^3111026.1029^^442^^^3111026
"KRN",.402,2456,"DIAB",1,0,442,11)
VENDOR:
"KRN",.402,2456,"DIAB",1,1,442.01,23)
PURCHASE ORDER NUMBER:DELIVERY SCHEDULE (ORDER):
"KRN",.402,2456,"DIAB",1,1,442.12,0)
ALL
"KRN",.402,2456,"DIAB",2,0,442,4)
SUBSTATION;REQ
"KRN",.402,2456,"DIAB",7,1,442.01,9)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2456,"DR",1,442)
Q:'$D(PRC("SITE"));S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="";S PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19);S PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:"");S PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2456,"DR",1,442,1)
S PRCHNVF="",PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;D EN2^PRCHNPO6;
"KRN",.402,2456,"DR",1,442,2)
S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);S PRCHN("MP")=$S($D(^PRCD(442.5,+$P(^PRC(442,DA,0),U,2),0)):$P(^(0),U,3),1:"");S PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")'="":PRCHN("INV"),1:"VA FSC");
"KRN",.402,2456,"DR",1,442,3)
S PRCHCTPO=$S(PRCHN("MP")=2:"Y",1:"N");S X=$P($G(^PRC(442,DA,1)),U) I X>0,$P($G(^PRC(440,X,3)),U,2)="Y" S PRCHEDI="";I '$D(^PRC(411,"UP",PRC("SITE"))) S Y=.1;S OSUB=$P($G(^PRC(442,DA,23)),U,7);
"KRN",.402,2456,"DR",1,442,4)
I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($G(^(0)),U,10) I +X=OSUB W !,"SUBSTATION: ",$P(^PRC(411,$P(^PRC(442,DA,23),U,7),0),U) S Y=.1;31R~;
"KRN",.402,2456,"DR",1,442,5)
I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)),X'=OSUB W !,?5,"Sub-station cannot be changed because the attached 2237",!,?5,"would then have a different sub-station.",!;
"KRN",.402,2456,"DR",1,442,6)
S PRCX=$O(^PRC(411,X,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,X,1,PRCX,0)),U) K PRCX;Q;Q;Q;Q;.1//TODAY;.02//^S X="INVOICE/RECEIVING REPORT";
"KRN",.402,2456,"DR",1,442,7)
S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")]"":PRCHN("INV"),1:"VA FSC");S:PRCHN("MP")'=25 Y=.08;D LOOK^PRCSPC;I (X="")!(X["^") S ERRFLG=38,Y=0;
"KRN",.402,2456,"DR",1,442,8)
I $G(PRCHXXX)="" S ERRFLG=38,Y=0;46////^S X=$G(PRCHXXX);56////^S X=DUZ;I PRCHXXX]"" S PRCPO=^PRC(440.5,PRCHXXX,0),PRCHHLDR=$P(PRCPO,U,8);61////^S X=PRCHHLDR;K PRCPO,PRCHHLDR,PRCHXXX;
"KRN",.402,2456,"DR",1,442,9)
.08//^S X=$S(PRCHN("MP")=2:"Y",PRCHN("MP")=12:"Y",1:"N");.04//^S X=PRCHN("INV");5;I $P(PRCHNVF,"^",3)=1 S Y="@20";S PRCHOV3=$G(^PRC(440,+^PRC(442,D0,1),3)) S:$P(PRCHOV3,"^",12)="P" Y="@20";S:$P(PRCHOV3,"^",6)="N" Y="@20";
"KRN",.402,2456,"DR",1,442,10)
S FLAG=0 I $P(PRCHOV3,"^",4)]""!(($P(PRCHOV3,"^",9)]"")&($P(PRCHOV3,"^",8)]"")) S FLAG=1;D EN9^PRCHNPO7;W:0 "The jump Y=@20 is set in routine EN9^PRCHNPO7";
"KRN",.402,2456,"DR",1,442,11)
^440^PRC(440,^^S I(0,0)=D0 S Y(1)=$S($D(^PRC(442,D0,1)):^(1),1:"") S X=$P(Y(1),U,1),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");@20;I '$D(PRCHEDI) S:$D(^PRC(442,DA,12)) $P(^(12),U,13,14)="^" S Y="@10";18.6//^S X="N";
"KRN",.402,2456,"DR",1,442,12)
I X'="Y" S:$D(^PRC(442,DA,12)) $P(^(12),U,14)="" S Y="@10";18.7;@10;8//^S X=PRCHN("SC");I "29"'[X K:0 DIC("DR") D ^PRCHNPO3 S Y="@1";.25;D ^PRCHNPO3;@1;
"KRN",.402,2456,"DR",1,442,13)
I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($P(^(0),U,1),"-",4) I +X=+$P(^PRC(442,DA,0),U,3) W !,"FCP: ",$P(^(0),U,3) S Y="@2";1;S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19);@2;
"KRN",.402,2456,"DR",1,442,14)
I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));26///^S X=PRC("BBFY");D EN2^PRCHNPO3;2//^S X=PRCHN("CC");@88;5.2//^S X=PRCHN("SVC");I $P(^PRC(442,DA,0),U,2)=25 S Y="@89";S Y="@90";@89;
"KRN",.402,2456,"DR",1,442,15)
54;@90;S:PRCHN("MP")=2 Y="@3" I $D(^PRC(442,DA,1)),$P(^(1),U,18)]"" S Y="@3";.3//^S X="E";@3;S:PRCHN("MP")=4 Y=5.3;
"KRN",.402,2456,"DR",1,442,16)
I '$P(^PRC(442,DA,0),U,19)&(PRCHN("MP")'=2) W !,"Enter the word 'PATIENT' in the 'DELIVERY LOCATION' field for a direct delivery",!,"to a patient.";5.6;
"KRN",.402,2456,"DR",1,442,17)
I X="PATIENT",$P(^PRC(442,DA,0),U,19) I $P(^(0),U,19)!(PRCHN("MP")=2) W *7,!,"  PATIENT DELIVERY not valid for this type of order!" S Y=5.6;I X="PATIENT" W "   Direct Delivery to Patient" S Y=5.3;5.4//^S X=$G(PRCY);
"KRN",.402,2456,"DR",1,442,18)
I $P(^PRC(442,DA,1),U,12)'="" W *7,!,"Delete the Direct Delivery patient name if you wish the 'Ship to' address",!,"to print on the P.O.",!;S:(PRCHN("MP")'=4)&($P(^(1),U,12)="") Y=6;5.3;K DIC("DR");6//NO;S:X'="Y" Y=6.4;6.2;
"KRN",.402,2456,"DR",1,442,19)
6.4//DESTINATION;S PRCHN("FOB")=X;Q;Q;Q;Q;7//TODAY+10;8.2//^S X="N/A";8.3;13;S PRCHSHP=+X;S:X']"" Y="@99";I $P(^PRC(442,DA,0),U,19)'=2 S Y="@98";S PRCHSBOC=$P($G(^PRCD(420.2,2299,0)),U);13.05////^S X=PRCHSBOC;S Y="@100";@98;13.05;
"KRN",.402,2456,"DR",1,442,20)
@100;S:'$D(PRCHSHP) PRCHSHP=$P(^PRC(442,DA,0),U,13) I '(PRCHN("FOB")="O"&((PRCHSHP>250)!(PRCHSHP=0))) S Y="@99";13.2;13.4;13.3;@99;97//^S X="A";16//^S X=$S($D(PRCHDUZ):PRCHDUZ,1:"");
"KRN",.402,2456,"DR",1,442,21)
S PRCHDUZ1=X I $P(^PRC(442,DA,0),U,2)=25,'$D(^PRC(440.5,"H",X)) W *7,!,"This user is not a purchase card user." S Y=16;K PRCHDUZ,PRCHDUZ1;40;24;20;501//^S X=$G(PRCHCTPO);K PRCHANS,PRCHTPO,PRCHSEEN,PRCHMORE,PRCHQTY,PRCSAVE;
"KRN",.402,2456,"DR",2,440)
I FLAG S Y=17.3;38;I X]"" S Y=39;W !!,"This VENDOR needs a TAX IDENTIFICATION NUMBER or a SOCIAL SECURITY NUMBER.",!,"Please enter one if you have it or get one from the VENDOR.",!;39;I X]"" S Y=17.3;
"KRN",.402,2456,"DR",2,440,1)
W !!,"Please tell me whether the TAX ID/SSN field is a TAX NUMBER or a SSN NUMBER.",!;17.3;17.4;17.7;17.8;17.9;I $P(PRCHOV3,U,11)]"" S Y="@10";41;@10;I $P(PRCHOV3,U,14)]"" S Y="@11";44;@11;I $P(PRCHOV3,U,13)]"" S Y="";
"KRN",.402,2456,"DR",2,442.01)
S PRCHREC=DA,PRCHQUAN="",Z="",PRCHTOT=0;S PRCHINUM=DA;.01;K PRCSAVE;S PRCHOLD=$P($G(^PRC(442,PRCHIEN,2,PRCHINUM,0)),U,2);1.5;I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";
"KRN",.402,2456,"DR",2,442.01,1)
I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;1;
"KRN",.402,2456,"DR",2,442.01,2)
I '$D(^PRC(442,DA(1),2,DA,1)) W $C(7),!,"Description is Required!!" S Y=1;I $D(^PRC(442,DA(1),1)) S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),2,+^PRC(442,DA(1),1),0)):^(0),1:"");
"KRN",.402,2456,"DR",2,442.01,3)
I Z'="" W:$P(Z,U,12)'="" !,"    Minimum Order Qty.: ",$P(Z,U,12) W:$P(Z,U,9) !,"    Maximum Order Qty.: ",$P(Z,U,9) W:$P(Z,U,11) !,"    Required Order Multiple: ",$P(Z,U,11) S PRCHQUAN=Z K Z;
"KRN",.402,2456,"DR",2,442.01,4)
2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");I X<PRCHOLD N I F I=0:0 S I=$O(^PRC(442.8,"AC",PRCHPONO,PRCHINUM,I)) Q:'I  S PRCHTOT=PRCHTOT+$P($G(^PRC(442.8,I,0)),U,5);
"KRN",.402,2456,"DR",2,442.01,5)
I $G(PRCHTOT)>X W !!!!!,$C(7),"****Delivery schedule total for this item (",PRCHTOT,") EXCEEDS order quantity (",X,").",!,"Edit delivery schedule(s).",!! S PRCHFLG=1,PRCHQTY=X S Y="@16";@44;
"KRN",.402,2456,"DR",2,442.01,6)
I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than the Minimum Order Quantity of ",$P(PRCHQUAN,U,12),$C(7) S Y=2;
"KRN",.402,2456,"DR",2,442.01,7)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than the Maximum Order Quantity of ",$P(PRCHQUAN,U,9),$C(7) S Y=2;
"KRN",.402,2456,"DR",2,442.01,8)
I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value of ",$P(PRCHQUAN,U,11),$C(7) S Y=2;3;5;I $D(^PRC(442,DA(1),1)),$P(^(1),U,20)="Y" S Y="@6";D TSTREQ1^PRCHNPO9;3.1;9.4;S:X']"" Y=9;
"KRN",.402,2456,"DR",2,442.01,9)
S DIE("NO^")="A";9.7;K DIE("NO^");9;9.5;@6;8T~;I $G(PRCSAVE)'="^" D EN10^PRCHNPO7;
"KRN",.402,2456,"DR",2,442.01,10)
S PRCHFCP=+$P(^PRC(442,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:$E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)=11 Y=41 S:(PRCHN("COM")'=1)&($E($P($G(^(0)),U,18),1,2)'=11) Y="@4";
"KRN",.402,2456,"DR",2,442.01,11)
S:PRCHN("MP")=2 Y="@4";9.3;D TSTREQ2^PRCHNPO9;40;S Y="@4";41//^S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),3)):^(3),1:""),X=$P(Z,U,7);42;@4;S DIE("NO^")="OUTOK";4;K DIE("NO^");
"KRN",.402,2456,"DR",2,442.01,12)
I PRCHN("SFC")=2 S $P(^PRC(442,DA(1),2,DA,0),U,4)=$$SUPBOC^PRCHNPO7(-1) S Y="@87";3.5//^S X=$$SUPBOC^PRCHNPO7(-1);@87;S:'$D(PRCHEDI) Y="@5";36.3;36.6;@5;
"KRN",.402,2456,"DR",2,442.01,13)
S PRCHTOT=0,PRCHSCN="" F I=0:0 S PRCHSCN=$O(^PRC(442.8,"B",PRCHPONO,PRCHSCN)) Q:PRCHSCN=""  I $P(^PRC(442.8,PRCHSCN,0),U,2)=DA S PRCHTOT=PRCHTOT+$P(^(0),U,5);S PRCHQTY=$P(^PRC(442,DA(1),2,DA,0),U,2);
"KRN",.402,2456,"DR",2,442.01,14)
I PRCHTOT>PRCHQTY S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(442,DA(1),2,PRCHREC,0),U) W !,"Line Item # = ",PRCHLINO,!,"Quantity Ordered: "_$P(^PRC(442,DA(1),2,PRCHREC,0),U,2),! S Y="@555";
"KRN",.402,2456,"DR",2,442.01,15)
W !!,"Enter/Edit Delivery Schedule for this Item?  NO// " R X:DTIME S:'$T X="^" S:X="" X="N" S:X["?" Y="@5" S:"Yy?"'[$E(X) Y="@56" W "  "_$S("Yy"[$E(X):"(YES)","Nn"[$E(X):"(NO)",1:"");@16;
"KRN",.402,2456,"DR",2,442.01,16)
S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(442,DA(1),2,PRCHREC,0),U) W !,"Line Item #=",PRCHLINO,!,"Quantity Ordered: "_$P(^PRC(442,DA(1),2,PRCHREC,0),U,2),!;
"KRN",.402,2456,"DR",2,442.01,17)
I PRCHTOT=PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," equals order quantity of ",PRCHQTY,".",!,"You may edit delivery schedule(s), but cannot add a new schedule.",!;@555;
"KRN",.402,2456,"DR",2,442.01,18)
I PRCHTOT>PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," EXCEEDS order quantity of ",PRCHQTY,".  You must edit",!,"one or more schedules so that the total equals no more than ",PRCHQTY,".",!! S Y="@55";
"KRN",.402,2456,"DR",2,442.01,19)
S:$D(PRCHSEEN) Y="@55";S PRCHSEEN=1,DLAYGO=442.8 W !!,"To delete a schedule, zero out the quantity to be delivered. To add a new",!,"delivery schedule do the following:",!!;
"KRN",.402,2456,"DR",2,442.01,20)
W "a. If there is no delivery schedule already in file answer 'Yes' when asked if     you are adding a new delivery schedule.";
"KRN",.402,2456,"DR",2,442.01,21)
W !,"b. If there is only one delivery schedule already in the file you will see         'OK? YES//' answer 'No' and then answer 'Yes' when asked if you are adding a    new delivery schedule.";
"KRN",.402,2456,"DR",2,442.01,22)
W !,"c. If there is more than one delivery schedule in the file, hit <return> key at    'CHOOSE' prompt and answer 'Yes' when asked if you are adding a new delivery    schedule.",!!;@55;
"KRN",.402,2456,"DR",2,442.01,23)
^442.8^PRC(442.8,^^X DR(99,1,9.2) S Y(101)=$S($D(^PRC(442.8,D0,0)):^(0),1:"") S X=$P(Y(101),U,1),Y(102)=$G(X) S X=$P(Y(101),U,1) S D0=I(0,0) S D1=I(1,0) S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,2456,"DR",2,442.01,24)
S:$G(PRCHDA) PRCHINUM=PRCHDA S PRCHQTY=$P(^PRC(442,PRCHIEN,2,PRCHINUM,0),U,2);
"KRN",.402,2456,"DR",2,442.01,25)
I $G(PRCHFLG),PRCHTOT>PRCHQTY W !!,"Delivery schedule total of ",PRCHTOT," EXCEEDS ordered quantity.",!,"of ",PRCHQTY,".  Adjust delivery schedule(s).",!! S Y="@16";
"KRN",.402,2456,"DR",2,442.01,26)
I $G(PRCHFLG) S PRCHFLG=0 W !!!!,"****Returning to Item Multiple edit session.",!! S Y="@44";I PRCHTOT>PRCHQTY S Y="@555";
"KRN",.402,2456,"DR",2,442.01,27)
W !!,"Enter/Edit Another Delivery Schedule for this Item? NO// " R X:DTIME S:'$T X="^" S:X="" X="N" S:X["?" Y="@5" S:"Yy?"[$E(X) Y="@16";@56;K DIE("NO^"),PRCHTOT,PRCHSCN,PRCHSEEN;
"KRN",.402,2456,"DR",2,442.12)
.01
"KRN",.402,2456,"DR",2,442.15)
.01;
"KRN",.402,2456,"DR",3,442.8)
1///^S X=PRCHDA;S DIE("NO^")="";2;3;@6;4;K DIE("NO^");S PRCHTOT=0,PRCHSCN="" F I=0:0 S PRCHSCN=$O(^PRC(442.8,"B",PRCHPONO,PRCHSCN)) Q:PRCHSCN=""  I $P(^PRC(442.8,PRCHSCN,0),U,2)=PRCHDA S PRCHTOT=PRCHTOT+$P(^(0),U,5);
"KRN",.402,2456,"DR",3,442.8,1)
S PRCHQTY=$P(^PRC(442,PRCHIEN,2,PRCHDA,0),U,2);S PRCHMORE=$P(^PRC(442.8,DA,0),U,5),PRCHMOR2=(PRCHQTY-PRCHTOT+PRCHMORE);
"KRN",.402,2456,"DR",3,442.8,2)
I PRCHTOT>PRCHQTY I PRCHMORE'=0 W *7,!,"Del. sched. total of ",PRCHTOT," for item ",PRCHDA," EXCEEDS the purchase",!,"order quantity of ",PRCHQTY,".",!,"Max. quantity here is ",$S(PRCHMOR2>0:PRCHMOR2,1:0),".",!! S Y="@6";
"KRN",.402,2456,"DR",3,442.8,3)
I PRCHTOT<PRCHQTY W !,"Delivery schedule total of ",PRCHTOT," for item ",PRCHDA," is less than purchase",!,"order quantity.",!!;I X>0 S Y="@445";W *7,!,"Delivery Schedule DELETED",!;.01////@;@445;
"KRN",.402,2456,"DR",99,1,9.2)
S I(1,0)=$G(D1),I(0,0)=$G(D0),Y(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(Y(1),U,1) K DIC S DIC="^PRC(442.8,",DIC(0)="MFLE" D ^DIC S (D,D0,D(0))=+Y
"KRN",.402,2662,-1)
0^2
"KRN",.402,2662,0)
PRCHSIMP^3111026.1038^^442^^^3111026
"KRN",.402,2662,"DIAB",2,0,442,7)
PCDO VENDOR;REQ
"KRN",.402,2662,"DIAB",2,0,442,8)
FREE TEXT VENDOR;REQ
"KRN",.402,2662,"DIAB",7,0,442,2)
SUBSTATION;REQ
"KRN",.402,2662,"DIAB",9,0,442,9)
PURCHASE COST;REQ
"KRN",.402,2662,"DR",1,442)
Q:'$D(PRC("SITE"))  S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="",PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19),PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:""),PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2662,"DR",1,442,1)
S PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);16////^S X=DUZ;
"KRN",.402,2662,"DR",1,442,2)
56////^S X=DUZ;.02///^S X=25;48///^S X="S";63///^S X=1;54///^S X="N";I '$D(^PRC(411,"UP",PRC("SITE"))) S Y="@46";31R~;S SUB=X;I $D(SUB) S PRCX=$O(^PRC(411,SUB,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,SUB,1,PRCX,0)),U) K PRCX;@46;
"KRN",.402,2662,"DR",1,442,3)
S PRCHCDNO=$P($G(^PRC(442,DA,23)),U,8);S PRCHNN=0 F PRCHII=1:1 S PRCHNN=$O(^PRC(440.5,"C",DUZ,PRCHNN)) Q:'PRCHNN  S PRCHCDF=$P(^PRC(440.5,PRCHNN,0),U);S PRCHCDFT="" I PRCHII=2 S PRCHCDFT=PRCHCDF;D LOOK^PRCSPC;
"KRN",.402,2662,"DR",1,442,4)
I (X="")!(X["^") S ERRFLG=1,Y=0;I $G(PRCHXXX)="" S ERRFLG=1,Y=0;46////^S X=$G(PRCHXXX);I PRCHCDNO'="",X'=PRCHCDNO W !,?5,"Please verify the accounting information for the new Purchase Card.",!;
"KRN",.402,2662,"DR",1,442,5)
I X]"" S PRCHP0=^PRC(440.5,X,0),PRCHFCP=$P(PRCHP0,U,2),PRCHCC=$P(PRCHP0,U,3),PRCHBOC1=$P(PRCHP0,U,4),PRCHDLOC=$P(PRCHP0,U,7),PRCHCD=$P(PRCHP0,U),PRCHCDNO=+X,PRCHHLDR=$P(PRCHP0,U,8);61////^S X=PRCHHLDR;55///^S X=PRCHCD;Q;Q;Q;Q;
"KRN",.402,2662,"DR",1,442,6)
.1//TODAY;I +X<DT D REF^PRCSPC W $C(7),!!,"Enter TODAY or a future date only. Contact Fiscal or A&MM Service for ",!,"assistance with PO requiring prior date since an ET is required.",! S Y=.1;
"KRN",.402,2662,"DR",1,442,7)
S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("INV")]"":PRCHN("INV"),1:"VA FSC");53R~;I $G(PRCFLAG)=1 S $P(^PRC(442,DA,23),U,14)="" K X S Y=53;S PRCHVEN=+X;5////^S X=PRCHVEN;
"KRN",.402,2662,"DR",1,442,8)
I $P($G(^PRC(440,PRCHVEN,0)),U)'="SIMPLIFIED" S Y=1;64R~;1//^S X=PRCHFCP;S PRC("CP")=X;S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19);@2;I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));
"KRN",.402,2662,"DR",1,442,9)
26///^S X=PRC("BBFY");D EN2^PRCHNPO3;2//^S X=PRCHCC;@88;K DIC("DR");K PRCHDUZ;52;@3;60R~;I X'="" S PRCHTOT=X;I X>3000 W !,$C(7),"COST CANNOT EXCEED $3000.00 - YOU MUST USE DETAILED PURCHASE CARD!!" S Y="@3";5.4///^S X="SIMPLIFIED";
"KRN",.402,2662,"DR",1,442,10)
S $P(^PRC(442,DA,0),"^",15)=PRCHTOT;
"KRN",.402,2663,-1)
0^3
"KRN",.402,2663,0)
PRCH DETAILED PURCHASE CARD^3110921.0901^^442^^^3111026
"KRN",.402,2663,"DIAB",1,0,442,6)
P.O. DATE//TODAY
"KRN",.402,2663,"DIAB",1,0,442,11)
DELIVERY DATE//TODAY+10
"KRN",.402,2663,"DIAB",3,0,442,7)
PCDO VENDOR;REQ
"KRN",.402,2663,"DIAB",7,0,442,2)
SUBSTATION;REQ
"KRN",.402,2663,"DIAB",10,1,442.01,8)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2663,"DR",1,442)
Q:'$D(PRC("SITE"))  S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="",PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19),PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:""),PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2663,"DR",1,442,1)
S PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;D EN2^PRCHNPO6;S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);
"KRN",.402,2663,"DR",1,442,2)
16////^S X=DUZ;56////^S X=DUZ;.02///^S X=25;48///^S X="P";63///^S X=1;I '$D(^PRC(411,"UP",PRC("SITE"))) S Y="@46";31R~;S SUB=X;I $D(SUB) S PRCX=$O(^PRC(411,SUB,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,SUB,1,PRCX,0)),U) K PRCX;@46;
"KRN",.402,2663,"DR",1,442,3)
S PRCHCDNO=$P($G(^PRC(442,DA,23)),U,8);S PRCHNN=0 F PRCHII=1:1 S PRCHNN=$O(^PRC(440.5,"C",DUZ,PRCHNN)) Q:'PRCHNN  S PRCHCDF=$P(^PRC(440.5,PRCHNN,0),U);S PRCHCDFT="" I PRCHII=2 S PRCHCDFT=PRCHCDF;D LOOK^PRCSPC;
"KRN",.402,2663,"DR",1,442,4)
I (X="")!(X["^") S ERRFLG=2,Y=0;I $G(PRCHXXX)="" S ERRFLG=2,Y=0;46////^S X=$G(PRCHXXX);I PRCHCDNO'="",X'=PRCHCDNO W !,?5,"Please verify the accounting information for the new Purchase Card.",!;
"KRN",.402,2663,"DR",1,442,5)
I X]"" S PRCHP0=^PRC(440.5,X,0),PRCHFCP=$P(PRCHP0,U,2),PRCHCC=$P(PRCHP0,U,3),PRCHBOC1=$P(PRCHP0,U,4),PRCHDLOC=$P(PRCHP0,U,7),PRCHCD=$P(PRCHP0,U),PRCHCDNO=+X,PRCHHLDR=$P(PRCHP0,U,8);61////^S X=PRCHHLDR;55///^S X=PRCHCD;Q;Q;Q;Q;
"KRN",.402,2663,"DR",1,442,6)
.1//^N %I,%H,% D NOW^%DTC;I +X<DT W $C(7),!!,"Enter TODAY or a future date only. Contact Fiscal or A&MM Service for ",!,"assistance with PO requiring prior date since an ET is required.",! D ODATE^PRCHNPO5 S Y=.1;
"KRN",.402,2663,"DR",1,442,7)
S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("INV")]"":PRCHN("INV"),1:"VA FSC");.08//^S X="N";53R~;I $G(PRCFLAG)=1 S $P(^PRC(442,DA,23),U,14)="" K X S Y=53;S PRCHVEN=+X;5////^S X=PRCHVEN;
"KRN",.402,2663,"DR",1,442,8)
8//^S X="B";S PRCHN("MP")=$P(^PRC(442,DA,0),U,2);1//^S X=PRCHFCP;S PRC("CP")=X;S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19);@2;I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));
"KRN",.402,2663,"DR",1,442,9)
26///^S X=PRC("BBFY");D EN2^PRCHNPO3;2//^S X=PRCHCC;5.2;52;@88;54;I X["N" S Y=6.4;5.6//^S X=PRCHDLOC;
"KRN",.402,2663,"DR",1,442,10)
I X="PATIENT",$P(^PRC(442,DA,0),U,19) I $P(^(0),U,19)!(PRCHN("MP")=2) W *7,!,"  PATIENT DELIVERY not valid for this type of order!" S Y=5.6;5.4//^S X=$G(PRCY);K DIC("DR");6.4//DESTINATION;S PRCHN("FOB")=X;Q;Q;Q;Q;
"KRN",.402,2663,"DR",1,442,11)
7//^N %I,%H,% D NOW^%DTC S X=X,X1=X,X2=+10,X="" D C^%DTC:X1;8.2//^S X="N/A";13;S PRCHSHP=+X;S:X']"" Y="@99";I $P(^PRC(442,DA,0),U,19)'=2 S Y="@98";S PRCHSBOC=$P($G(^PRCD(420.2,2299,0)),U);13.05////^S X=PRCHSBOC;S Y="@100";@98;
"KRN",.402,2663,"DR",1,442,12)
13.05;@100;I '(PRCHN("FOB")="O"&((PRCHSHP>250)!(PRCHSHP=0))) S Y="@99";13.2;13.4;13.3;@99;K PRCHDUZ;40;20;
"KRN",.402,2663,"DR",2,442.01)
S PRCHREC=DA;.01;K PRCSAVE;S PRCHINUM=DA,PRCHOLD=$P($G(^PRC(442,PRCHIEN,2,PRCHINUM,0)),U,2);1.5;I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";
"KRN",.402,2663,"DR",2,442.01,1)
I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;
"KRN",.402,2663,"DR",2,442.01,2)
I X'="",$G(PRCHN("SFC"))'=2 S PRCHMAND=$P($G(^PRC(441,X,0)),U,8) I $G(PRCHMAND),PRCHMAND'=$P($G(^PRC(442,DA(1),1)),U) W !,"This item can only be purchased from "_$P($G(^PRC(440,PRCHMAND,0)),U) S Y=1.5;1;
"KRN",.402,2663,"DR",2,442.01,3)
I '$D(^PRC(442,DA(1),2,DA,1)) W $C(7),!,"Description is Required!!" S Y=1;S (PRCHQUAN,Z)="" I $D(^PRC(442,DA(1),1)) S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),2,+^PRC(442,DA(1),1),0)):^(0),1:"");
"KRN",.402,2663,"DR",2,442.01,4)
I Z'="" W:$P(Z,U,12)'="" !,"    Minimum Order Qty.: ",$P(Z,U,12) W:$P(Z,U,9) !,"    Maximum Order Qty.: ",$P(Z,U,9) W:$P(Z,U,11) !,"    Required Order Multiple: ",$P(Z,U,11) S PRCHQUAN=Z K Z;
"KRN",.402,2663,"DR",2,442.01,5)
2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");
"KRN",.402,2663,"DR",2,442.01,6)
I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than the Minimum Order Quantity of ",$P(PRCHQUAN,U,12),$C(7) S Y=2;
"KRN",.402,2663,"DR",2,442.01,7)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than the Maximum Order Quantity of ",$P(PRCHQUAN,U,9),$C(7) S Y=2;
"KRN",.402,2663,"DR",2,442.01,8)
I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value of ",$P(PRCHQUAN,U,11),$C(7) S Y=2;3;5;D TSTREQ1^PRCHNPO9;3.1;S DIE("NO^")="A";9.7;K DIE("NO^");9;8T~;
"KRN",.402,2663,"DR",2,442.01,9)
I $G(PRCSAVE)'="^" D EN10^PRCHNPO7;S PRCHFCP=+$P(^PRC(442,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:(PRCHN("COM")'=1)&($E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)'=11) Y=4;4;
"KRN",.402,2663,"DR",2,442.01,10)
S PRCHIDA=+$P(^PRC(442,DA(1),2,DA,0),U,5);K PRCHBOCC;I PRCHN("SFC")=2 S ACCT=$$ACCT^PRCPUX1($E($$NSN^PRCPUX1(PRCHIDA),1,4)) S PRCHBOCC=$S(ACCT=1:2697,ACCT=2:2698,ACCT=3:2699,ACCT=6:2699,ACCT=8:2696,1:2699);
"KRN",.402,2663,"DR",2,442.01,11)
I '$G(PRCHBOCC) S Y="@87";S PRCHBOCC=$P($G(^PRCD(420.2,PRCHBOCC,0)),U);3.5////^S X=PRCHBOCC;S Y="@89";@87;3.5;@89;K PRCHBOCC,PRCHANS,PRCSAVE;
"KRN",.402,2664,-1)
0^7
"KRN",.402,2664,0)
PRCH DELIVERY ORDER^3090102.144^^442^^^3110707
"KRN",.402,2664,"DIAB",3,0,442,6)
PCDO VENDOR;REQ
"KRN",.402,2664,"DIAB",4,0,442,3)
SUBSTATION;REQ
"KRN",.402,2664,"DIAB",8,0,442,4)
P.O. DATE//TODAY
"KRN",.402,2664,"DIAB",8,1,442.01,10)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2664,"DIAB",9,0,442,10)
DELIVERY DATE//TODAY+10
"KRN",.402,2664,"DR",1,442)
Q:'$D(PRC("SITE"))  S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="",PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19),PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:""),PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2664,"DR",1,442,1)
S PRCHNVF="",PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;D EN2^PRCHNPO6;
"KRN",.402,2664,"DR",1,442,2)
S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);S PRCHN("MP")=$S($D(^PRCD(442.5,+$P(^PRC(442,DA,0),U,2),0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")'="":PRCHN("INV"),1:"VA FSC");48///^S X="D";
"KRN",.402,2664,"DR",1,442,3)
I '$D(^PRC(411,"UP",PRC("SITE"))) S Y=.1;S OSUB=$P($G(^PRC(442,DA,23)),U,7);I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($G(^(0)),U,10) I +X=OSUB W !,"SUBSTATION: ",$P(^PRC(411,$P(^PRC(442,DA,23),U,7),0),U) S Y=.1;31R~;
"KRN",.402,2664,"DR",1,442,4)
S SUB=X;I $D(SUB) S PRCX=$O(^PRC(411,SUB,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,SUB,1,PRCX,0)),U) K PRCX;Q;Q;Q;Q;Q;.1//^S X=DT;.02//^S X="INVOICE/RECEIVING REPORT";
"KRN",.402,2664,"DR",1,442,5)
S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")]"":PRCHN("INV"),1:"VA FSC");S PRCHCTPO=$S(PRCHN("MP")=2:"Y",1:"N");
"KRN",.402,2664,"DR",1,442,6)
.08//^S X=$S(PRCHN("MP")=2:"Y",PRCHN("MP")=12:"Y",1:"N");.04//^S X=PRCHN("INV");53R~;S PRCHVEN=+X;5////^S X=PRCHVEN;8///^S X=6;K DIC("DR");@1;1;S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19);@2;
"KRN",.402,2664,"DR",1,442,7)
I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));26///^S X=PRC("BBFY");D EN2^PRCHNPO3;2//^S X=PRCHN("CC");@88;S:PRCHN("MP")=2 Y="@3" I $D(^PRC(442,DA,1)),$P(^(1),U,18)]"" S Y="@3";@3;
"KRN",.402,2664,"DR",1,442,8)
S:PRCHN("MP")=4 Y=5.3;I '$P(^PRC(442,DA,0),U,19)&(PRCHN("MP")'=2) W !,"Enter the word 'PATIENT' in the 'DELIVERY LOCATION' field for a direct delivery",!,"to a patient.";5.6;
"KRN",.402,2664,"DR",1,442,9)
I X="PATIENT",$P(^PRC(442,DA,0),U,19) I $P(^(0),U,19)!(PRCHN("MP")=2) W *7,!,"  PATIENT DELIVERY not valid for this type of order!" S Y=5.6;5.4//^S X=$G(PRCY);
"KRN",.402,2664,"DR",1,442,10)
I $P(^PRC(442,DA,1),U,12)'="" W *7,!,"Delete the Direct Delivery patient name if you wish the 'Ship to' address",!,"to print on the P.O.",!;6.4//DESTINATION;S PRCHN("FOB")=X;Q;Q;Q;Q;Q;7//^S X=DT S X=X,X1=X,X2=+10,X="" D C^%DTC:X1;
"KRN",.402,2664,"DR",1,442,11)
8.2//^S X="N/A";13;S PRCHSHP=+X;S:X']"" Y="@99";I $P(^PRC(442,DA,0),U,19)'=2 S Y="@98";S PRCHSBOC=$P($G(^PRCD(420.2,2299,0)),U);13.05////^S X=PRCHSBOC;S Y="@100";@98;13.05;@100;
"KRN",.402,2664,"DR",1,442,12)
I '(PRCHN("FOB")="O"&((PRCHSHP>250)!(PRCHSHP=0))) S Y="@99";13.2;13.4;13.3;@99;16////^S X=DUZ;K PRCHDUZ;40;20;
"KRN",.402,2664,"DR",2,442.01)
S PRCHREC=DA;.01;K PRCSAVE;S PRCHINUM=DA,PRCHOLD=$P($G(^PRC(442,PRCHIEN,2,PRCHINUM,0)),U,2);1.5;I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";
"KRN",.402,2664,"DR",2,442.01,1)
I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;
"KRN",.402,2664,"DR",2,442.01,2)
I X'="",$P($G(^PRC(441,X,2,PRCHVEN,0)),U,3)="",$G(PRCSAVE)="" W !,"This is not a contract item." S Y=1.5;
"KRN",.402,2664,"DR",2,442.01,3)
I X'="" S PRCHMAND=$P($G(^PRC(441,X,0)),U,8) I $G(PRCHMAND),PRCHMAND'=$P($G(^PRC(442,DA(1),1)),U) W !,"This item can only be purchased from "_$P($G(^PRC(440,PRCHMAND,0)),U) S Y=1.5;1;
"KRN",.402,2664,"DR",2,442.01,4)
I '$D(^PRC(442,DA(1),2,DA,1)) W $C(7),!,"Description is Required!!" S Y=1;S (PRCHQUAN,Z)="" I $D(^PRC(442,DA(1),1)) S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),2,+^PRC(442,DA(1),1),0)):^(0),1:"");
"KRN",.402,2664,"DR",2,442.01,5)
I Z'="" W:$P(Z,U,12)'="" !,"    Minimum Order Qty.: ",$P(Z,U,12) W:$P(Z,U,9) !,"    Maximum Order Qty.: ",$P(Z,U,9) W:$P(Z,U,11) !,"    Required Order Multiple: ",$P(Z,U,11) S PRCHQUAN=Z K Z;
"KRN",.402,2664,"DR",2,442.01,6)
2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");S PRCHTOT=0 I X<PRCHOLD N I F I=0:0 S I=$O(^PRC(442.8,"AC",PRCHPONO,PRCHINUM,I)) Q:'I  S PRCHTOT=PRCHTOT+$P($G(^PRC(442.8,I,0)),U,5);
"KRN",.402,2664,"DR",2,442.01,7)
I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than the Minimum Order Quantity of ",$P(PRCHQUAN,U,12),$C(7) S Y=2;
"KRN",.402,2664,"DR",2,442.01,8)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than the Maximum Order Quantity of ",$P(PRCHQUAN,U,9),$C(7) S Y=2;
"KRN",.402,2664,"DR",2,442.01,9)
I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value of ",$P(PRCHQUAN,U,11),$C(7) S Y=2;3;5;I $D(^PRC(442,DA(1),1)),$P(^(1),U,20)="Y" S Y="@6";D TSTREQ1^PRCHNPO9;3.1;
"KRN",.402,2664,"DR",2,442.01,10)
S DIE("NO^")="A";9.7;K DIE("NO^");9;9.5;@6;S:PRCHN("MP")=2 Y=4;8T~;I $G(PRCSAVE)'="^" D EN10^PRCHNPO7;
"KRN",.402,2664,"DR",2,442.01,11)
S PRCHFCP=+$P(^PRC(442,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:$E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)=11 Y=41 S:(PRCHN("COM")'=1)&($E($P($G(^(0)),U,18),1,2)'=11) Y=4;9.3;
"KRN",.402,2664,"DR",2,442.01,12)
D TSTREQ2^PRCHNPO9;40;S Y=4;41//^S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),3)):^(3),1:""),X=$P(Z,U,7);4;S PRCHIDA=+$P(^PRC(442,DA(1),2,DA,0),U,5);K PRCHBOCC;
"KRN",.402,2664,"DR",2,442.01,13)
S:PRCHN("SFC")=2 ACCT=$$ACCT^PRCPUX1($E($$NSN^PRCPUX1(PRCHIDA),1,4)),PRCHBOCC=$P($G(^PRCD(420.2,$S(ACCT=1:2697,ACCT=2:2698,ACCT=3:2699,ACCT=6:2699,ACCT=8:2696,1:2699),0)),U);I $G(PRCHBOCC) S Y="@87";3.5//^S X=$G(PRCHBOCC);
"KRN",.402,2664,"DR",2,442.01,14)
S Y="@89";@87;3.5////^S X=PRCHBOCC;S Y="@89";@87;3.5;@89;K PRCHBOCC,PRCHANS,PRCSAVE;S:'$D(PRCHEDI) Y="@5";36.3;36.6;@5;
"KRN",.402,2668,-1)
0^4
"KRN",.402,2668,0)
PRCH DIRECT DELIVERY ORDER^3090102.1019^^442^^^3110216
"KRN",.402,2668,"DIAB",2,0,442,6)
PCDO VENDOR;REQ
"KRN",.402,2668,"DIAB",4,0,442,3)
SUBSTATION;REQ
"KRN",.402,2668,"DIAB",6,0,442,4)
P.O. DATE//TODAY
"KRN",.402,2668,"DIAB",7,0,442,10)
DELIVERY DATE//TODAY+1
"KRN",.402,2668,"DR",1,442)
Q:'$D(PRC("SITE"))  S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="",PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19),PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:""),PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2668,"DR",1,442,1)
S PRCHNVF="",PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;D EN2^PRCHNPO6;
"KRN",.402,2668,"DR",1,442,2)
S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);S PRCHN("MP")=$S($D(^PRCD(442.5,+$P(^PRC(442,DA,0),U,2),0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")'="":PRCHN("INV"),1:"VA FSC");48///^S X="D";
"KRN",.402,2668,"DR",1,442,3)
I '$D(^PRC(411,"UP",PRC("SITE"))) S Y=.1;S OSUB=$P($G(^PRC(442,DA,23)),U,7);I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($G(^(0)),U,10) I +X=OSUB W !,"SUBSTATION: ",$P(^PRC(411,$P(^PRC(442,DA,23),U,7),0),U) S Y=.1;31R~;
"KRN",.402,2668,"DR",1,442,4)
S SUB=X;I $D(SUB) S PRCX=$O(^PRC(411,SUB,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,SUB,1,PRCX,0)),U) K PRCX;Q;Q;Q;.1//^S X=DT;.02///^S X="AUTO BANK PAYMENT";
"KRN",.402,2668,"DR",1,442,5)
S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")]"":PRCHN("INV"),1:"VA FSC");S PRCHCTPO=$S(PRCHN("MP")=2:"Y",1:"N");.08///^S X="N";
"KRN",.402,2668,"DR",1,442,6)
.04///^S X=PRCHN("INV");53R~;S PRCHVEN=+X;5////^S X=PRCHVEN;8///^S X=6;K DIC("DR");@1;1;S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19);@2;I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));
"KRN",.402,2668,"DR",1,442,7)
26///^S X=PRC("BBFY");D EN2^PRCHNPO3;2//^S X=PRCHN("CC");@88;S:PRCHN("MP")=2 Y="@3" I $D(^PRC(442,DA,1)),$P(^(1),U,18)]"" S Y="@3";@3;
"KRN",.402,2668,"DR",1,442,8)
I '$P(^PRC(442,DA,0),U,19)&(PRCHN("MP")'=2) W !,"Enter the word 'PATIENT' in the 'DELIVERY LOCATION' field for a direct delivery",!,"to a patient.";5.6;
"KRN",.402,2668,"DR",1,442,9)
I X="PATIENT",$P(^PRC(442,DA,0),U,19) I $P(^(0),U,19)!(PRCHN("MP")=2) W *7,!,"  PATIENT DELIVERY not valid for this type of order!" S Y=5.6;5.4//^S X=$G(PRCY);
"KRN",.402,2668,"DR",1,442,10)
I $P(^PRC(442,DA,1),U,12)'="" W *7,!,"Delete the Direct Delivery patient name if you wish the 'Ship to' address",!,"to print on the P.O.",!;6.4///DESTINATION;S PRCHN("FOB")=X;Q;Q;Q;7//^S X=DT S X=X,X1=X,X2=+1,X="" D C^%DTC:X1;
"KRN",.402,2668,"DR",1,442,11)
8.2///^S X="N/A";16////^S X=DUZ;K PRCHDUZ;40;20;
"KRN",.402,2668,"DR",2,442.01)
S PRCHREC=DA;.01;S PRCHINUM=DA,PRCHOLD=$P($G(^PRC(442,PRCHIEN,2,PRCHINUM,0)),U,2);1.5;I X="" W !,"Items for this order must be from the Item Master File." S Y=1.5;
"KRN",.402,2668,"DR",2,442.01,1)
I X'="",$P($G(^PRC(441,X,2,PRCHVEN,0)),U,3)="" W !,"This is not a contract item." S Y=1.5;
"KRN",.402,2668,"DR",2,442.01,2)
I X'="" S PRCHMAND=$P($G(^PRC(441,X,0)),U,8) I $G(PRCHMAND),PRCHMAND'=$P($G(^PRC(442,DA(1),1)),U) W !,"This item can only be purchased from "_$P($G(^PRC(440,PRCHMAND,0)),U) S Y=1.5;1;
"KRN",.402,2668,"DR",2,442.01,3)
I '$D(^PRC(442,DA(1),2,DA,1)) W $C(7),!,"Description is Required!!" S Y=1;S (PRCHQUAN,Z)="" I $D(^PRC(442,DA(1),1)) S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),2,+^PRC(442,DA(1),1),0)):^(0),1:"");
"KRN",.402,2668,"DR",2,442.01,4)
I Z'="" W:$P(Z,U,12)'="" !,"    Minimum Order Qty.: ",$P(Z,U,12) W:$P(Z,U,9) !,"    Maximum Order Qty.: ",$P(Z,U,9) W:$P(Z,U,11) !,"    Required Order Multiple: ",$P(Z,U,11) S PRCHQUAN=Z K Z;
"KRN",.402,2668,"DR",2,442.01,5)
2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");S PRCHTOT=0 I X<PRCHOLD N I F I=0:0 S I=$O(^PRC(442.8,"AC",PRCHPONO,PRCHINUM,I)) Q:'I  S PRCHTOT=PRCHTOT+$P($G(^PRC(442.8,I,0)),U,5);
"KRN",.402,2668,"DR",2,442.01,6)
I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than the Minimum Order Quantity of ",$P(PRCHQUAN,U,12),$C(7) S Y=2;
"KRN",.402,2668,"DR",2,442.01,7)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than the Maximum Order Quantity of ",$P(PRCHQUAN,U,9),$C(7) S Y=2;
"KRN",.402,2668,"DR",2,442.01,8)
I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value of ",$P(PRCHQUAN,U,11),$C(7) S Y=2;3;S $P(^PRC(442,DA(1),2,DA,0),U,9)=0;5//^S X=0;
"KRN",.402,2668,"DR",2,442.01,9)
I $D(^PRC(442,DA(1),1)),$P(^(1),U,20)="Y" S Y="@6";3.1///^S X=1;S DIE("NO^")="A";9.7///^S X=1;K DIE("NO^");@6;S:PRCHN("MP")=2 Y=4;8///^S X=9999;
"KRN",.402,2668,"DR",2,442.01,10)
S PRCHFCP=+$P(^PRC(442,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:$E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)=11 Y=41 S:(PRCHN("COM")'=1)&($E($P($G(^(0)),U,18),1,2)'=11) Y="@44";
"KRN",.402,2668,"DR",2,442.01,11)
D TSTREQ2^PRCHNPO9;40;S Y="@44";41///^S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),3)):^(3),1:""),X=$P(Z,U,7);@44;S PRCHIDA=+$P(^PRC(442,DA(1),2,DA,0),U,5);
"KRN",.402,2668,"DR",2,442.01,12)
I PRCHN("SFC")=2 S ACCT=$$ACCT^PRCPUX1($E($$NSN^PRCPUX1(PRCHIDA),1,4)) S PRCHBOCC=$S(ACCT=1:2697,ACCT=2:2698,ACCT=3:2699,ACCT=6:2699,ACCT=8:2696,1:2699);I '$G(PRCHBOCC) S Y="@87";S PRCHBOCC=$P($G(^PRCD(420.2,PRCHBOCC,0)),U);
"KRN",.402,2668,"DR",2,442.01,13)
3.5////^S X=PRCHBOCC;S Y="@89";@87;3.5;@89;K PRCHBOCC;@5;
"KRN",.402,2670,-1)
0^5
"KRN",.402,2670,0)
PRCH PROSTHETIC^3090102.1022^@^442^^@^3090102
"KRN",.402,2670,"DIAB",2,0,442,8)
64;REQ
"KRN",.402,2670,"DR",1,442)
Q:'$D(PRC("SITE"))  S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="",PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19),PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:""),PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2670,"DR",1,442,1)
S PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);Q;16////^S X=DUZ;
"KRN",.402,2670,"DR",1,442,2)
56////^S X=DUZ;.02///^S X=25;48///^S X="S";63///^S X=1;54///^S X="N";I '$D(^PRC(411,"UP",PRC("SITE"))) S Y="@46";31////^S X=PRC("SITE");S SUB=X;
"KRN",.402,2670,"DR",1,442,3)
I $D(SUB) S PRCX=$O(^PRC(411,SUB,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,SUB,1,PRCX,0)),U) K PRCX;Q;Q;Q;@46;S PRCHCDNO=$P($G(^PRC(442,DA,23)),U,8);
"KRN",.402,2670,"DR",1,442,4)
S PRCHNN=0 F PRCHII=1:1 S PRCHNN=$O(^PRC(440.5,"C",DUZ,PRCHNN)) Q:'PRCHNN  S PRCHCDF=$P(^PRC(440.5,PRCHNN,0),U);S PRCHCDFT="" I PRCHII=2 S PRCHCDFT=PRCHCDF;D LOOK^PRCSPC;I (X="")!(X["^") S Y=0;I $G(PRCHXXX)="" S Y=0;
"KRN",.402,2670,"DR",1,442,5)
46////^S X=$G(PRCHXXX);I PRCHCDNO'="",X'=PRCHCDNO W !,?5,"Please verify the accounting information for the new Purchase Card.",!;
"KRN",.402,2670,"DR",1,442,6)
I X]"" S PRCHP0=^PRC(440.5,X,0),PRCHFCP=$P(PRCHP0,U,2),PRCHCC=$P(PRCHP0,U,3),PRCHBOC1=$P(PRCHP0,U,4),PRCHDLOC=$P(PRCHP0,U,7),PRCHCD=$P(PRCHP0,U),PRCHCDNO=+X,PRCHHLDR=$P(PRCHP0,U,8);61////^S X=PRCHHLDR;55///^S X=PRCHCD;Q;
"KRN",.402,2670,"DR",1,442,7)
.1///^S X="T";S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("INV")]"":PRCHN("INV"),1:"VA FSC");53////^S X=PRCRI(440);Q;Q;Q;Q;S PRCHVEN=PRCRI(440);5////^S X=PRCHVEN;
"KRN",.402,2670,"DR",1,442,8)
I $P($G(^PRC(440,PRCHVEN,0)),U)'="SIMPLIFIED" S Y=1;64R~;1///^S X=PRCHFCP;Q;Q;S PRC("CP")=X;S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19);@2;I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));
"KRN",.402,2670,"DR",1,442,9)
26///^S X=PRC("BBFY");D EN2^PRCHNPO3;2//^S X=PRCHCC;@88;Q;Q;K DIC("DR");Q;K PRCHDUZ;5.4///^S X="SIMPLIFIED";S PRCPROST=1.9;
"KRN",.402,2673,-1)
0^6
"KRN",.402,2673,0)
PRCH PC DIRECT DELIVERY^3090102.1438^^442^^^3110216
"KRN",.402,2673,"DIAB",3,0,442,3)
SUBSTATION;REQ
"KRN",.402,2673,"DIAB",5,0,442,5)
.1//TODAY
"KRN",.402,2673,"DIAB",6,0,442,8)
PCDO VENDOR;REQ
"KRN",.402,2673,"DIAB",7,1,442.01,9)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2673,"DIAB",13,0,442,14)
7//TODAY+10
"KRN",.402,2673,"DR",1,442)
Q:'$D(PRC("SITE"));S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="",PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19),PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:""),PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2673,"DR",1,442,1)
S PRCHNVF="",PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;D EN2^PRCHNPO6;
"KRN",.402,2673,"DR",1,442,2)
S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);16////^S X=DUZ;56////^S X=DUZ;.02///^S X=25;48///^S X="P";63///^S X=1;S X=$P($G(^PRC(442,DA,1)),U) I X>0,$P($G(^PRC(440,X,3)),U,2)="Y" S PRCHEDI="";I '$D(^PRC(411,"UP",PRC("SITE"))) S Y=.1;
"KRN",.402,2673,"DR",1,442,3)
S OSUB=$P($G(^PRC(442,DA,23)),U,7);I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($G(^(0)),U,10) I +X=OSUB W !,"SUBSTATION: ",$P(^PRC(411,$P(^PRC(442,DA,23),U,7),0),U) S Y=.1;31R~;
"KRN",.402,2673,"DR",1,442,4)
I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) I X'=OSUB W !,?5,"Sub-station cannot be changed because the attached 2237",!,?5,"would then have a different sub-station.",! S $P(^PRC(442,DA,23),U,7)=OSUB S Y=31;
"KRN",.402,2673,"DR",1,442,5)
S PRCX=$O(^PRC(411,X,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,X,1,PRCX,0)),U) K PRCX;Q;Q;Q;.1//^S X=DT;S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("INV")]"":PRCHN("INV"),1:"VA FSC");
"KRN",.402,2673,"DR",1,442,6)
S PRCHCDNO=$P($G(^PRC(442,DA,23)),U,8);D LOOK^PRCSPC;I (X="")!(X["^") S ERRFLG=3,Y=0;I $G(PRCHXXX)="" S ERRFLG=3,Y=0;46////^S X=$G(PRCHXXX);
"KRN",.402,2673,"DR",1,442,7)
I PRCHCDNO'="",X'=PRCHCDNO W !,?5,"Please verify the accounting information for the new purchase card.",!;
"KRN",.402,2673,"DR",1,442,8)
I X]"" S PRCHP0=^PRC(440.5,X,0),PRCHFCP=$P(PRCHP0,U,2),PRCHCC=$P(PRCHP0,U,3),PRCHBOC1=$P(PRCHP0,U,4),PRCHCD=$P(PRCHP0,U),PRCHCDNO=+X,PRCHHLDR=$P(PRCHP0,U,8);55///^S X=PRCHCD;.08//^S X="N";.04//^S X=PRCHN("INV");@33;53R~;
"KRN",.402,2673,"DR",1,442,9)
I $P($G(^PRC(440,($P(^PRC(442,D0,23),U,14)),2)),U,11)'="Y" W !,?5,"This vendor is not a guarenteed delivery vendor." S $P(^PRC(442,DA,23),U,14)="" K X S Y="@33";
"KRN",.402,2673,"DR",1,442,10)
S PRCHOV3=$G(^PRC(440,+^PRC(442,D0,1),3)) S:$P(PRCHOV3,"^",12)="P" Y="@20";I $G(PRCFLAG)=1 S $P(^PRC(442,DA,23),U,14)="" K X S Y=53;S PRCHVEN=+X;5////^S X=PRCHVEN;@20;18.6//^S X="N";I X="N" S Y="@10";18.7;@10;8//^S X=PRCHN("SC");
"KRN",.402,2673,"DR",1,442,11)
I "46910"'[X K:0 DIC("DR") D ^PRCHNPO3 S Y="@1";.25;D ^PRCHNPO3;@1;1//^S X=PRCHFCP;I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($P(^(0),U,1),"-",4) I +X=+$P(^PRC(442,DA,0),U,3) W !,"FCP: ",$P(^(0),U,3) S Y="@2";S X=PRCHFCP;
"KRN",.402,2673,"DR",1,442,12)
S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19) I PRCHN("SFC")'="" W !,"You cannot use a special control point for this type of order." S Y="@1";S PRC("CP")=$P(^PRC(442,DA,0),U,3);@2;
"KRN",.402,2673,"DR",1,442,13)
I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));26///^S X=PRC("BBFY");D EN2^PRCHNPO3;2//^S X=PRCHCC;@88;5.2//^S X=PRCHN("SVC");I $D(^PRC(442,DA,1)),$P(^(1),U,18)]"" S Y="@3";
"KRN",.402,2673,"DR",1,442,14)
.3//^S X="E";@3;52;5.3;5.6////^S X="PATIENT";5.4;6.2;6.4;S PRCHN("FOB")=X;Q;Q;Q;7//^S X=DT S X=X,X1=X,X2=+10,X="" D C^%DTC:X1;8.2//^S X="N/A";8.3;13;S PRCHSHP=+X;I $P(^PRC(442,DA,0),U,19)'=2 S Y="@98";
"KRN",.402,2673,"DR",1,442,15)
S PRCHSBOC=$P($G(^PRCD(420.2,2299,0)),U);13.05////^S X=PRCHSBOC;S Y="@100";@98;13.05;@100;S:'$D(PRCHSHP) PRCHSHP=$P(^PRC(442,DA,0),U,13) I '(PRCHN("FOB")="O"&((PRCHSHP>250)!(PRCHSHP=0))) S Y="@99";13.2;13.4;13.3;@99;97//^S X="A";
"KRN",.402,2673,"DR",1,442,16)
16//^S X=$S($D(PRCHDUZ):PRCHDUZ,1:"");S PRCHDUZ1=X I $P(^PRC(442,DA,0),U,2)=25,'$D(^PRC(440.5,"H",X)) W *7,!,"This user is not a purchase card user." S Y=16;61////^S X=PRCHDUZ1;@25;K PRCHDUZ,PRCHDUZ1;40;24;20;
"KRN",.402,2673,"DR",1,442,17)
K PRCHANS,PRCHTPO,PRCHSEEN,PRCHMORE,PRCHQTY,PRCSAVE;
"KRN",.402,2673,"DR",2,442.01)
S PRCHREC=DA,PRCHQUAN="",Z="",PRCHTOT=0;.01;K PRCSAVE;S PRCHINUM=DA,PRCHOLD=$P($G(^PRC(442,PRCHIEN,2,PRCHINUM,0)),U,2);1.5;I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";
"KRN",.402,2673,"DR",2,442.01,1)
I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;1;
"KRN",.402,2673,"DR",2,442.01,2)
I '$D(^PRC(442,DA(1),2,DA,1)) W $C(7),!,"Description is Required!!" S Y=1;I $D(^PRC(442,DA(1),1)) S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),2,+^PRC(442,DA(1),1),0)):^(0),1:"");
"KRN",.402,2673,"DR",2,442.01,3)
I Z'="" W:$P(Z,U,12)'="" !,"    Minimum Order Qty.: ",$P(Z,U,12) W:$P(Z,U,9) !,"    Maximum Order Qty.: ",$P(Z,U,9) W:$P(Z,U,11) !,"    Required Order Multiple: ",$P(Z,U,11) S PRCHQUAN=Z K Z;
"KRN",.402,2673,"DR",2,442.01,4)
2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");I X<PRCHOLD N I F I=0:0 S I=$O(^PRC(442.8,"AC",PRCHPONO,PRCHINUM,I)) Q:'I  S PRCHTOT=PRCHTOT+$P($G(^PRC(442.8,I,0)),U,5);
"KRN",.402,2673,"DR",2,442.01,5)
I $G(PRCHTOT)>X W !!!!!,$C(7),"****Delivery schedule total for this item (",PRCHTOT,") EXCEEDS order quantity (",X,").",!,"Edit delivery schedule(s) now." S PRCHFLG=1,PRCHQTY=X S Y="@16";@44;
"KRN",.402,2673,"DR",2,442.01,6)
I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than the Minimum Order Quantity of ",$P(PRCHQUAN,U,12),$C(7) S Y=2;
"KRN",.402,2673,"DR",2,442.01,7)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than the Maximum Order Quantity of ",$P(PRCHQUAN,U,9),$C(7) S Y=2;
"KRN",.402,2673,"DR",2,442.01,8)
I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value of ",$P(PRCHQUAN,U,11),$C(7) S Y=2;3;5;I $D(^PRC(442,DA(1),1)),$P(^(1),U,20)="Y" S Y="@6";D TSTREQ1^PRCHNPO9;3.1;9.4;S:X']"" Y=9;
"KRN",.402,2673,"DR",2,442.01,9)
S DIE("NO^")="A";9.7;K DIE("NO^");9;9.5;@6;8T~;I $G(PRCSAVE)'="^" D EN10^PRCHNPO7;
"KRN",.402,2673,"DR",2,442.01,10)
S PRCHFCP=+$P(^PRC(442,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:$E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)=11 Y=41 S:(PRCHN("COM")'=1)&($E($P($G(^(0)),U,18),1,2)'=11) Y=4;9.3;
"KRN",.402,2673,"DR",2,442.01,11)
D TSTREQ2^PRCHNPO9;40;41//^S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),3)):^(3),1:""),X=$P(Z,U,7);42;4;@87;36.3;36.6;@5;
"KRN",.402,2673,"DR",2,442.01,12)
S PRCHTOT=0,PRCHSCN="" F I=0:0 S PRCHSCN=$O(^PRC(442.8,"B",PRCHPONO,PRCHSCN)) Q:PRCHSCN=""  I $P(^PRC(442.8,PRCHSCN,0),U,2)=DA S PRCHTOT=PRCHTOT+$P(^(0),U,5);S PRCHQTY=$P(^PRC(442,DA(1),2,DA,0),U,2);
"KRN",.402,2673,"DR",2,442.01,13)
I PRCHTOT>PRCHQTY S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(442,DA(1),2,PRCHREC,0),U) W !,"Line Item # = ",PRCHLINO,!,"Orig. Quantity Ordered: "_$P(^PRC(442,DA(1),2,PRCHREC,0),U,2),! S Y="@555";
"KRN",.402,2673,"DR",2,442.01,14)
W !!,"Enter/Edit Delivery Schedule for this Item?  NO// " R X:DTIME S:'$T X="^" S:X="" X="N" S:X["?" Y="@5" S:"Yy?"'[$E(X) Y="@56" W "  "_$S("Yy"[$E(X):"(YES)","Nn"[$E(X):"(NO)",1:"");@16;
"KRN",.402,2673,"DR",2,442.01,15)
S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(442,DA(1),2,PRCHREC,0),U) W !,"Line Item #=",PRCHLINO,!,"Orig. Quantity Ordered: "_$P(^PRC(442,DA(1),2,PRCHREC,0),U,2),!;
"KRN",.402,2673,"DR",2,442.01,16)
I PRCHTOT=PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," equals order quantity of ",PRCHQTY,".",!,"You may edit delivery schedule(s), but cannot add a new schedule.",!;@555;
"KRN",.402,2673,"DR",2,442.01,17)
I PRCHTOT>PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," EXCEEDS order quantity of ",PRCHQTY,".  You must edit",!,"one or more schedules so that the total equals no more than ",PRCHQTY,".",! S Y="@55";
"KRN",.402,2673,"DR",2,442.01,18)
S:$D(PRCHSEEN) Y="@55";S PRCHSEEN=1 W !!,"To delete a schedule, zero out the quantity to be delivered. To add a new",!,"delivery schedule do the following:",!!;
"KRN",.402,2673,"DR",2,442.01,19)
W "a. If there is no delivery schedule already in file answer 'Yes' when asked if     you are adding a new delivery schedule.";
"KRN",.402,2673,"DR",2,442.01,20)
W !,"b. If there is only one delivery schedule already in the file you will see         'OK? YES//' answer 'No' and then answer 'Yes' when asked if you are adding a    new delivery schedule.";
"KRN",.402,2673,"DR",2,442.01,21)
W !,"c. If there is more than one delivery schedule in the file, hit <return> key at    'CHOOSE' prompt and answer 'Yes' when asked if you are adding a new delivery    schedule.";@55;
"KRN",.402,2673,"DR",2,442.01,22)
S:$G(PRCHDA) PRCHINUM=PRCHDA S PRCHQTY=$P(^PRC(442,PRCHIEN,2,PRCHINUM,0),U,2);
"KRN",.402,2673,"DR",2,442.01,23)
I $G(PRCHFLG),PRCHTOT>PRCHQTY W !!,"Delivery schedule total of ",PRCHTOT," EXCEEDS ordered quantity.",!,"of ",PRCHQTY,".  Adjust delivery schedule(s)." S Y="@16";
"KRN",.402,2673,"DR",2,442.01,24)
I $G(PRCHFLG) S PRCHFLG=0 W !!!!,"****Returning to Item Multiple edit session." S Y="@44";I PRCHTOT>PRCHQTY S Y="@555";
"KRN",.402,2673,"DR",2,442.01,25)
W !!,"Enter/Edit Another Delivery Schedule for this Item? NO// " R X:DTIME S:'$T X="^" S:X="" X="N" S:X["?" Y="@5" S:"Yy?"[$E(X) Y="@16";@56;K PRCHTOT,PRCHSCN;3.5;
"KRN",.402,2673,"DR",2,442.12)
.01;
"KRN",.402,2673,"DR",2,442.15)
.01;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
129^3111026
"PKG",455,22,1,"PAH",1,1,0)
^^9^9^3111026
"PKG",455,22,1,"PAH",1,1,1,0)
1. Tasking the option 'Inactivate Expired Charge Cards' does not work as
"PKG",455,22,1,"PAH",1,1,2,0)
   the processing asks for STATION which cannot be answered once tasked.
"PKG",455,22,1,"PAH",1,1,3,0)
 
"PKG",455,22,1,"PAH",1,1,4,0)
2. Option, New Purchase Order [PRCHPC PO ADD], must have query INVOICE 
"PKG",455,22,1,"PAH",1,1,5,0)
   ADDRESS default 'FMS' changed to "VA FSC'.
"PKG",455,22,1,"PAH",1,1,6,0)
 
"PKG",455,22,1,"PAH",1,1,7,0)
3. Routine PRCHNPO6 is not in compliance with SACC (VistA Programming 
"PKG",455,22,1,"PAH",1,1,8,0)
   Standards and Conventions) since lock ':0' is less than the value of
"PKG",455,22,1,"PAH",1,1,9,0)
   the kernel variable "DILOCKTM". 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PRCH3A")
0^1^B4015402^B4013336
"RTN","PRCH3A",1,0)
PRCH3A ;WISC/PLT-IFCAP INACTIVATE OLD/EXPIRED PURCHASE CARDS - CITIBANK ;8/28/98  11:49
"RTN","PRCH3A",2,0)
V ;;5.1;IFCAP;**8,125,129**;Oct 20, 2000;Build 5
"RTN","PRCH3A",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCH3A",4,0)
 QUIT  ;invalid entry
"RTN","PRCH3A",5,0)
 ;
"RTN","PRCH3A",6,0)
 ;ZTQPARAM="REGULAR" if from schedule option, ="CITI" if from CITIBANK schedule
"RTN","PRCH3A",7,0)
EN ;inactivate charge cards
"RTN","PRCH3A",8,0)
 N PRCA,PRCB,PRCRI,PRCDI,PRC,PRCTD
"RTN","PRCH3A",9,0)
 I $D(ZTQUEUED) G SCHED
"RTN","PRCH3A",10,0)
 S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("SITE"))  Q:$G(X)="^"
"RTN","PRCH3A",11,0)
Q1 ;inactivate all CITI charge cards with expired date before t
"RTN","PRCH3A",12,0)
 S PRCTD=$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","PRCH3A",13,0)
 D YN^PRC0A(.X,.Y,"Ready to inactivate old Citibank & expired US Bank charge cards before "_PRCTD,"O","NO")
"RTN","PRCH3A",14,0)
 I X["^"!(X="")!'Y G EXIT
"RTN","PRCH3A",15,0)
 D NOW^%DTC S ZTDTH=%
"RTN","PRCH3A",16,0)
 S %ZIS("B")="Q",ZTIO=""
"RTN","PRCH3A",17,0)
 S ZTRTN="SCHED^PRCH3A",ZTDESC="IFCAP INACTIVATION OF OLD CITIBANK/EXPIRED US BANK CHARGE CARDS",ZTSAVE("*")=""
"RTN","PRCH3A",18,0)
 D ^%ZTLOAD
"RTN","PRCH3A",19,0)
 W !! D EN^DDIOL("  IFCAP INACTIVATION OF OLD CITIBANK/EXPIRED US BANK CHARGE CARDS WAS SCHEDULED WITH TASK # "_ZTSK)
"RTN","PRCH3A",20,0)
 R X:4
"RTN","PRCH3A",21,0)
 D HOME^%ZIS
"RTN","PRCH3A",22,0)
EXIT QUIT
"RTN","PRCH3A",23,0)
 ;
"RTN","PRCH3A",24,0)
 ;
"RTN","PRCH3A",25,0)
 D EDIT^PRC0B(.X,PRCDI,"4;5;6")
"RTN","PRCH3A",26,0)
 ;
"RTN","PRCH3A",27,0)
SCHED ;inactivate old Citibank/expired US Bank charge card with date before run date
"RTN","PRCH3A",28,0)
 D NOW^%DTC I %<3081129.0500 Q
"RTN","PRCH3A",29,0)
 N PRCRI,PRCA,PRCB,PRCC S DT=X
"RTN","PRCH3A",30,0)
 S PRCRI=0,U="^"
"RTN","PRCH3A",31,0)
 F  S PRCRI=$O(^PRC(440.5,PRCRI)) QUIT:PRCRI'?1N.N!'PRCRI  S PRCA=$G(^(PRCRI,0)),PRCB=$G(^(2)) D:$P(PRCB,U,2)'="Y"
"RTN","PRCH3A",32,0)
 . I $D(PRC("SITE")) Q:$P($G(PRCB),"^",3)'=PRC("SITE")
"RTN","PRCH3A",33,0)
 . S PRCC=""
"RTN","PRCH3A",34,0)
 . I PRCA?1"4486".E S PRCC="Y"
"RTN","PRCH3A",35,0)
 . I PRCC="",$P(PRCB,U,4),$P(PRCB,U,4)<DT S PRCC="Y"
"RTN","PRCH3A",36,0)
 . I PRCC="Y" S X="" D EDIT^PRC0B(.X,"440.5;^PRC(440.5,;"_PRCRI,"14///^S X=""Y""")
"RTN","PRCH3A",37,0)
 . QUIT
"RTN","PRCH3A",38,0)
 QUIT
"RTN","PRCHNPO6")
0^2^B22810187^B21803940
"RTN","PRCHNPO6",1,0)
PRCHNPO6 ;WISC/RHD-MISCELLANEOUS ROUTINES FROM P.O.ADD/EDIT 442 ;6/22/94  3:19 PM
"RTN","PRCHNPO6",2,0)
V ;;5.1;IFCAP;**129**;Oct 20, 2000;Build 5
"RTN","PRCHNPO6",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHNPO6",4,0)
 ;
"RTN","PRCHNPO6",5,0)
EN1 ;INPUT TRANSFORM FOR FILE 442, P.O.DATE #.1
"RTN","PRCHNPO6",6,0)
 Q:'$D(^PRC(442,DA,0))  Q:'$P(^(0),U,3)  S PRCHSAVX=X,PRC("FY")=X S:'$D(PRC("SITE")) PRC("SITE")=+^(0) S X=$P(^(0),U,3)
"RTN","PRCHNPO6",7,0)
 D EN1^PRCHNPO5 S:$D(X) $P(^PRC(442,DA,0),U,4)=PRC("APP")
"RTN","PRCHNPO6",8,0)
 S X=PRCHSAVX K PRCHSAVX
"RTN","PRCHNPO6",9,0)
 Q
"RTN","PRCHNPO6",10,0)
 ;
"RTN","PRCHNPO6",11,0)
EN2 ;SCREEN--P.O.#['X' (FRESH FOOD) OR 'Z' (CASCA)--INVOICE ADDRESS="FISCAL", P.O.#['C' (CERT.INV.)--MOP='CERT.INV.', INV.ADDR.="FISCAL", IMPREST FUNDS--INV.ADDR.="".
"RTN","PRCHNPO6",12,0)
 ;PRC*5.1*129 modifies INVOICE ADDRESS default from 'FMS' to 'VA FSC'
"RTN","PRCHNPO6",13,0)
 S Z1=$E($P(^PRC(442,DA,0),"-",2),1,2),PRCHN("INV")="VA FSC",Z2=+$P(^(0),U,2) I $D(^PRCD(442.5,Z2,0)) S PRCHN("MP")=$P(^(0),U,3) I PRCHN("MP")=12 S Z1="IF",PRCHN("INV")="" G EN20
"RTN","PRCHNPO6",14,0)
 I (Z1["X")!(Z1["Z") S PRCHN("INV")="FISCAL" K Z1,Z2 Q
"RTN","PRCHNPO6",15,0)
 I Z1'["C" K Z1,Z2 Q
"RTN","PRCHNPO6",16,0)
 S PRCHN("MP")=2,$P(^PRC(442,DA,0),U,2)=2,^PRC(442,"F",2,DA)="",Z2=2,PRCHN("INV")="FISCAL"
"RTN","PRCHNPO6",17,0)
EN20 W !,"Method of Processing="_$P(^PRCD(442.5,Z2,0),U,1) K Z1,Z2
"RTN","PRCHNPO6",18,0)
 Q
"RTN","PRCHNPO6",19,0)
 ;
"RTN","PRCHNPO6",20,0)
EN3 ;SCREEN FCP--CALLED FROM PRCHNPO3
"RTN","PRCHNPO6",21,0)
 G:'$D(PRCHPO) FALSE S Z0=$E($P(^PRC(442,PRCHPO,0),"-",2),1,2),Z1=+$P(^PRCS(410,Y,0),"-",4)
"RTN","PRCHNPO6",22,0)
 ;
"RTN","PRCHNPO6",23,0)
EN4 ;SCREEN FCP FOR SPECIAL P.O.NUMBERS--Z0=1ST 2 DIGITS OF P.O.NO.,Z1=FCP
"RTN","PRCHNPO6",24,0)
 G:(Z0["H")&('$D(^PRC(420,"AD",1,PRC("SITE"),Z1))) FALSE
"RTN","PRCHNPO6",25,0)
 I Z0["G",$D(^PRC(411,+PRC("SITE"),0)),$D(^PRC(411.2,+$P(^(0),U,7),0)),"^DEPOT^VACO^DDC^"[("^"_$P(^(0),U,1)_"^") G TRUE
"RTN","PRCHNPO6",26,0)
 G:(Z0["G")&('$D(^PRC(420,"AD",2,PRC("SITE"),Z1)))&('$D(^PRC(420,"AD",3,PRC("SITE"),Z1)))&('$D(^PRC(420,"AD",4,PRC("SITE"),Z1))) FALSE
"RTN","PRCHNPO6",27,0)
 G:(Z0["Z")&('$D(^PRC(420,"AD",3,PRC("SITE"),Z1)))&('$D(^PRC(420,"AD",4,PRC("SITE"),Z1))) FALSE
"RTN","PRCHNPO6",28,0)
 I $G(PRCHPC)!$G(PRCHDELV) I '$D(^PRC(420,"C",DUZ,PRC("SITE"),Z1)) G FALSE
"RTN","PRCHNPO6",29,0)
 ;
"RTN","PRCHNPO6",30,0)
TRUE I 1 Q
"RTN","PRCHNPO6",31,0)
 ;
"RTN","PRCHNPO6",32,0)
FALSE I 0
"RTN","PRCHNPO6",33,0)
 Q
"RTN","PRCHNPO6",34,0)
 ;
"RTN","PRCHNPO6",35,0)
EN5 ;FILE #442, FIELD #1 (FCP) ONLINE HELP
"RTN","PRCHNPO6",36,0)
 S Z1=Y D EN4 ;S FLAG=1
"RTN","PRCHNPO6",37,0)
 Q
"RTN","PRCHNPO6",38,0)
 ;
"RTN","PRCHNPO6",39,0)
EST ;Find Line Item # for Field #13.1
"RTN","PRCHNPO6",40,0)
 S N="" F PRCHESTA=1:1 S N=$O(^PRC(442,PRCHPO,2,"B",N)) Q:'N
"RTN","PRCHNPO6",41,0)
 S N=0 F PRCHDIS=1:1 S N=$O(^PRC(442,PRCHPO,3,N)) Q:'N
"RTN","PRCHNPO6",42,0)
 S PRCHDIS=PRCHDIS+PRCHESTA-1,$P(^PRC(442,PRCHPO,0),U,18)=PRCHDIS,$P(^(0),U,14)=PRCHDIS
"RTN","PRCHNPO6",43,0)
 K N,PRCHESTA,PRCHDIS
"RTN","PRCHNPO6",44,0)
 Q
"RTN","PRCHNPO6",45,0)
 ;
"RTN","PRCHNPO6",46,0)
EN7 ;FILE 442, PKG.MULT. #3.1
"RTN","PRCHNPO6",47,0)
 D VEN^PRCHNPO5 Q:'$D(X)!($P(^PRC(442,DA(1),2,DA,0),U,5)="")
"RTN","PRCHNPO6",48,0)
 S:'$D(PRC("SITE")) PRC("SITE")=+^PRC(442,DA(1),0) S PRCHCV=+$P(^PRC(442,DA(1),1),U,1),PRCHCI=+$P(^(2,DA,0),U,5),PRCHCPO=DA(1) D EN7^PRCHCRD1
"RTN","PRCHNPO6",49,0)
 Q
"RTN","PRCHNPO6",50,0)
 ;
"RTN","PRCHNPO6",51,0)
EN8 ;FILE 442, P.O.NO. .01  CALLED BY THE SCREEN ON THE .01 FIELD
"RTN","PRCHNPO6",52,0)
 Q:'$D(X)  Q:$D(PRCHNEW)&$D(^PRC(442,"B",X))
"RTN","PRCHNPO6",53,0)
 ;PRC*5.1*129 modifies SACC lock violations
"RTN","PRCHNPO6",54,0)
 L +^PRC(442,0):$S($G(DILOCKTM)>5:DILOCKTM,1:5) I '$T W $C(7),"ANOTHER USER IS EDITING SOME FILE 442 ENTRY! Please retry in a minute." K X Q
"RTN","PRCHNPO6",55,0)
 S Z=$P(^PRC(442,0),"^",3)-1 S:Z<1 Z=100000000 F Z=Z-1:-1 I '$D(^PRC(442,Z)) L +^PRC(442,Z):$S($D(DILOCKTM):DILOCKTM,1:3) Q:$T
"RTN","PRCHNPO6",56,0)
 L -^PRC(442,0) I Z'>0 K X L -^PRC(442,Z)
"RTN","PRCHNPO6",57,0)
 E  S DINUM=Z
"RTN","PRCHNPO6",58,0)
 K Z
"RTN","PRCHNPO6",59,0)
 Q
"RTN","PRCHNPO6",60,0)
 ;
"RTN","PRCHNPO6",61,0)
EN9 ;FILE 442, MAX.ORD.QTY.#9.6
"RTN","PRCHNPO6",62,0)
 D VEN^PRCHNPO5 Q:'$D(X)!($P(^PRC(442,DA(1),2,DA,0),U,5)="")
"RTN","PRCHNPO6",63,0)
 S:'$D(PRC("SITE")) PRC("SITE")=+^PRC(442,DA(1),0) S PRCHCV=+$P(^PRC(442,DA(1),1),U,1),PRCHCI=+$P(^(2,DA,0),U,5),PRCHCPO=DA(1) D EN9^PRCHCRD1
"RTN","PRCHNPO6",64,0)
 Q
"RTN","PRCHNPO6",65,0)
 ;
"RTN","PRCHNPO6",66,0)
 ; ER-ER3 ARE CALLED FROM PRCHNPO1
"RTN","PRCHNPO6",67,0)
ER W !," ** Error in Discount ",PRCH,", item ",PRCHN," has a unit cost of zero ",$C(7) S PRCHER=""
"RTN","PRCHNPO6",68,0)
 Q
"RTN","PRCHNPO6",69,0)
 ;
"RTN","PRCHNPO6",70,0)
ER1 W !," ** Error in Discount ",PRCH,", item ",PRCHN," has been changed. Discount will be deleted",!?4,"and must be re-edited!",$C(7) S PRCHER="",DR="14///^S X=PRCH",DR(2,442.03)=".01///@" D ^DIE K DR
"RTN","PRCHNPO6",71,0)
 Q
"RTN","PRCHNPO6",72,0)
 ;
"RTN","PRCHNPO6",73,0)
ER2 W !," Type Code is undefined.",$C(7) K PRCHPO
"RTN","PRCHNPO6",74,0)
 Q
"RTN","PRCHNPO6",75,0)
 ;
"RTN","PRCHNPO6",76,0)
ER3 W !,$S('PRCHDT:"Breakout Code is undefined.",1:"Socioeconomic Group (FY89) not defined in Vendor file."),$C(7) K PRCHPO
"RTN","PRCHNPO6",77,0)
 Q
"RTN","PRCHNPO6",78,0)
 ;
"RTN","PRCHNPO6",79,0)
SPRMK ;FORMAT & DISPLAY REMARKS FROM REQUEST TO PO
"RTN","PRCHNPO6",80,0)
 Q:'$D(^PRCS(410,PRCHSY,"RM"))  K ^UTILITY($J,"W")
"RTN","PRCHNPO6",81,0)
 W !,"2237 Special Remarks: " S U="^",PRCHZZ=0,DIWL=1,DIWR=78,DIWF="W"
"RTN","PRCHNPO6",82,0)
 F PRCHJJ=0:0 S PRCHZZ=$O(^PRCS(410,PRCHSY,"RM",PRCHZZ)) Q:'PRCHZZ  I $D(^(PRCHZZ,0)) S X=^(0) D DIWP^PRCUTL($G(DA)),^DIWW
"RTN","PRCHNPO6",83,0)
 ;
"RTN","PRCHNPO6",84,0)
SP1 K PRCHJJ W !,"Would you like to transfer the Special Remarks to the New P.O. Comments" S %=1 D YN^DICN
"RTN","PRCHNPO6",85,0)
 I %=0 W !,"Enter 'Y' to have the Special Remarks added to the end of the P.O. Comments.",! G SP1
"RTN","PRCHNPO6",86,0)
 G END:%'=1 S:'$D(^PRC(442,D0,4,0)) ^(0)="^^0^0^"_DT S PRCHNN=$P(^(0),U,3),PRCHX=0
"RTN","PRCHNPO6",87,0)
 F I=0:0 S PRCHX=$O(^PRCS(410,PRCHSY,"RM",PRCHX)) Q:'PRCHX  I $D(^(PRCHX,0)) S PRCHNN=PRCHNN+1,^PRC(442,D0,4,PRCHNN,0)=^(0)
"RTN","PRCHNPO6",88,0)
 S ^PRC(442,D0,4,0)="^^"_PRCHNN_U_PRCHNN_U_DT
"RTN","PRCHNPO6",89,0)
 ;
"RTN","PRCHNPO6",90,0)
END K PRCHNN,PRCHX,PRCHZZ,DIWL,DIWR,DISF,I,%
"RTN","PRCHNPO6",91,0)
 Q
"VER")
8.0^22.0
"BLD",5919,6)
^138
**END**
**END**
