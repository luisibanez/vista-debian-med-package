EMERGENCY Released PRC*5.1*163 SEQ #135
Extracted from mail message
**KIDS**:PRC*5.1*163^

**INSTALL NAME**
PRC*5.1*163
"BLD",6950,0)
PRC*5.1*163^IFCAP^0^3111013^y
"BLD",6950,1,0)
^^1^1^3111013^
"BLD",6950,1,1,0)
1. PRCH Purchase Card Adjustment Security Error in error display
"BLD",6950,4,0)
^9.64PA^^
"BLD",6950,6.3)
2
"BLD",6950,"ABPKG")
n
"BLD",6950,"KRN",0)
^9.67PA^779.2^20
"BLD",6950,"KRN",.4,0)
.4
"BLD",6950,"KRN",.401,0)
.401
"BLD",6950,"KRN",.402,0)
.402
"BLD",6950,"KRN",.403,0)
.403
"BLD",6950,"KRN",.5,0)
.5
"BLD",6950,"KRN",.84,0)
.84
"BLD",6950,"KRN",3.6,0)
3.6
"BLD",6950,"KRN",3.8,0)
3.8
"BLD",6950,"KRN",9.2,0)
9.2
"BLD",6950,"KRN",9.8,0)
9.8
"BLD",6950,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6950,"KRN",9.8,"NM",1,0)
PRCHE^^0^B72223463
"BLD",6950,"KRN",9.8,"NM","B","PRCHE",1)

"BLD",6950,"KRN",19,0)
19
"BLD",6950,"KRN",19.1,0)
19.1
"BLD",6950,"KRN",101,0)
101
"BLD",6950,"KRN",409.61,0)
409.61
"BLD",6950,"KRN",771,0)
771
"BLD",6950,"KRN",779.2,0)
779.2
"BLD",6950,"KRN",870,0)
870
"BLD",6950,"KRN",8989.51,0)
8989.51
"BLD",6950,"KRN",8989.52,0)
8989.52
"BLD",6950,"KRN",8994,0)
8994
"BLD",6950,"KRN","B",.4,.4)

"BLD",6950,"KRN","B",.401,.401)

"BLD",6950,"KRN","B",.402,.402)

"BLD",6950,"KRN","B",.403,.403)

"BLD",6950,"KRN","B",.5,.5)

"BLD",6950,"KRN","B",.84,.84)

"BLD",6950,"KRN","B",3.6,3.6)

"BLD",6950,"KRN","B",3.8,3.8)

"BLD",6950,"KRN","B",9.2,9.2)

"BLD",6950,"KRN","B",9.8,9.8)

"BLD",6950,"KRN","B",19,19)

"BLD",6950,"KRN","B",19.1,19.1)

"BLD",6950,"KRN","B",101,101)

"BLD",6950,"KRN","B",409.61,409.61)

"BLD",6950,"KRN","B",771,771)

"BLD",6950,"KRN","B",779.2,779.2)

"BLD",6950,"KRN","B",870,870)

"BLD",6950,"KRN","B",8989.51,8989.51)

"BLD",6950,"KRN","B",8989.52,8989.52)

"BLD",6950,"KRN","B",8994,8994)

"BLD",6950,"QDEF")
^^^^^^^^^^YES
"BLD",6950,"QUES",0)
^9.62^^
"BLD",6950,"REQB",0)
^9.611^1^1
"BLD",6950,"REQB",1,0)
PRC*5.1*144^2
"BLD",6950,"REQB","B","PRC*5.1*144",1)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
163^3111013
"PKG",455,22,1,"PAH",1,1,0)
^^1^1^3111013
"PKG",455,22,1,"PAH",1,1,1,0)
1. PRCH Purchase Card Adjustment Security Error in error display
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PRCHE")
0^1^B72223463^B69149403
"RTN","PRCHE",1,0)
PRCHE ;WOIFO/LKG/DST-EDIT ROUTINES FOR SUPPLY SYSTEM ; 6/22/05 8:40am
"RTN","PRCHE",2,0)
V ;;5.1;IFCAP;**1,28,39,81,63,144,163**;Oct 20, 2000;Build 2
"RTN","PRCHE",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHE",4,0)
EN1 ;ITEM FILE EDIT
"RTN","PRCHE",5,0)
 N PRCVDA
"RTN","PRCHE",6,0)
 I '$D(PRC("PARAM")) S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("PARAM"))
"RTN","PRCHE",7,0)
 W !! D DISP^PRCOSS1
"RTN","PRCHE",8,0)
 S DIC="^PRC(441,",DIC(0)="AEMQL",DLAYGO=441,PRCHPO="",PRCHDA=-1 D ^DIC
"RTN","PRCHE",9,0)
 I Y>0 D
"RTN","PRCHE",10,0)
 . S PRCHDA=+Y,DIE=DIC,DA=+Y
"RTN","PRCHE",11,0)
 . S DR=$S($P($G(^PRC(441,DA,0)),U,15)="":"[PRCHITEM2]",$D(^XUSEC("PRCHITEM MASTER",DUZ)):"[PRCHITEM2]",1:"[PRCHITEM]")
"RTN","PRCHE",12,0)
 . I DR="[PRCHITEM]" D
"RTN","PRCHE",13,0)
 . . N PRCARR S PRCARR(1)="This item is a National Item File entry and you have"
"RTN","PRCHE",14,0)
 . . S PRCARR(2)="not been granted permission to edit the SHORT DESCRIPTION"
"RTN","PRCHE",15,0)
 . . S PRCARR(3)="and DESCRIPTION fields.  You will not be able to edit these fields."
"RTN","PRCHE",16,0)
 . . D EN^DDIOL(.PRCARR)
"RTN","PRCHE",17,0)
 . D LCK D:$D(DA) ^DIE
"RTN","PRCHE",18,0)
 . ; Send ITEM master file updates info to DynaMed - **81**
"RTN","PRCHE",19,0)
 . S PRCVDA=$G(DA)
"RTN","PRCHE",20,0)
 S Y=PRCHDA K PRCHDA D Q K PRCHPO
"RTN","PRCHE",21,0)
 I Y<0 D CHECK^PRCOSS1 Q
"RTN","PRCHE",22,0)
 S (PRCHDA,DA,DA(1))=+Y I $O(^PRC(441,DA,4,0)) S DIC="^PRC(441,"_DA(1)_",4,",DIC(0)="QEMAN" D ^DIC S:$G(Y)'=-1 PRCVDA=PRCHDA I Y>0 S DA=+Y,DIE=DIC,DR=3 D ^DIE,Q
"RTN","PRCHE",23,0)
 ; S:$G(Y)'=-1 PRCVDA=PRCHDA
"RTN","PRCHE",24,0)
 ; If either ITEM record (and FCP fields) created or updated, and
"RTN","PRCHE",25,0)
 ; this site is a DynaMed Interface site
"RTN","PRCHE",26,0)
 I $G(PRCVDA),$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D ONECHK^PRCVIT(PRCVDA)
"RTN","PRCHE",27,0)
 I $P(^PRC(441,PRCHDA,0),U,10)="",$P(PRC("PARAM"),U,16)="Y" W $C(7),!!,"Warning--BOC is missing from this item--you should",!,"re-edit the item!!",!
"RTN","PRCHE",28,0)
 I $O(^PRCP(445,"AH",PRCHDA,""))]"" D BLDSEG^PRCPHLFM(3,PRCHDA,0) ; update supply stations
"RTN","PRCHE",29,0)
 K PRCHDA G EN1
"RTN","PRCHE",30,0)
 ;
"RTN","PRCHE",31,0)
EN2 ;EDIT SITE PARAMETERS
"RTN","PRCHE",32,0)
 N X R !,"STATION NUMBER: ",X:DTIME Q:'$T!(X["^")!(X="")
"RTN","PRCHE",33,0)
 I "???"[X D EN2DSP G EN2
"RTN","PRCHE",34,0)
 I X'?3N W !,"Please enter a 3 digit number or '^' to exit.  If attempting to enter substation information, please use 'Substation Enter/Edit'." G EN2
"RTN","PRCHE",35,0)
 I $D(^PRC(411,"B",X)) G EN2A
"RTN","PRCHE",36,0)
 N PRCX
"RTN","PRCHE",37,0)
 S PRCX=$O(^DIC(4,"D",X,"")) I PRCX="" W " ?? (That is not a valid Station Number)" G EN2
"RTN","PRCHE",38,0)
 S PRCX=$P($G(^DIC(4,PRCX,0)),U,1)
"RTN","PRCHE",39,0)
 D EN^DDIOL("Do you wish to add "_X_" ("_PRCX_") as a NEW station")
"RTN","PRCHE",40,0)
 S %=0 D YN^DICN I %'=1 G EN2
"RTN","PRCHE",41,0)
 ;
"RTN","PRCHE",42,0)
EN2A S DIC="^PRC(411,",DIC(0)="LX",DR="[PRCHSITE]",DLAYGO=411 D DIE
"RTN","PRCHE",43,0)
 G EN2
"RTN","PRCHE",44,0)
EN2DSP ;Display entries from file #411 if they are Ok in file #4. Otherwise,
"RTN","PRCHE",45,0)
 ;alert user about any incomplete entry.
"RTN","PRCHE",46,0)
 N PRCDA,PRCA,J,PRCIEN,PRCINSN
"RTN","PRCHE",47,0)
 S PRCDA=0 F J=2:0 S PRCDA=$O(^PRC(411,"B",PRCDA)) Q:PRCDA=""  D
"RTN","PRCHE",48,0)
 . S PRCIEN=$O(^PRC(411,"B",PRCDA,"")) I $D(^PRC(411,PRCIEN,0))#10 D 
"RTN","PRCHE",49,0)
 .. S PRCA=$P($G(^PRC(411,PRCIEN,0)),U,1) I PRCA?3N D
"RTN","PRCHE",50,0)
 ... S PRCA(J)=$J("",5)_PRCA_"  "
"RTN","PRCHE",51,0)
 ... S PRCINSN=$O(^DIC(4,"D",PRCDA,"")) I PRCINSN']"" D  Q
"RTN","PRCHE",52,0)
 .... W !,$C(7),?5,"ENTRY "_PRCDA_" IS NOT SET UP PROPERLY IN FILE #4. PLEASE CALL IRM"
"RTN","PRCHE",53,0)
 ... S PRCA(J)=PRCA(J)_$P($G(^DIC(4,PRCINSN,0)),U,1),J=J+1
"RTN","PRCHE",54,0)
 I J>2 S PRCA(1)=" ",PRCA(J)=" " D EN^DDIOL(.PRCA)
"RTN","PRCHE",55,0)
 Q
"RTN","PRCHE",56,0)
EN3 ;EDIT VENDOR FILE
"RTN","PRCHE",57,0)
 S DIC="^PRC(440,",DIC(0)="AEMQL",DR="[PRCHVENDOR1]",DLAYGO=440 K PRCHPO D DIE Q:Y<0  G EN3
"RTN","PRCHE",58,0)
 ;
"RTN","PRCHE",59,0)
EN5 ;ENTER A NEW P.O.
"RTN","PRCHE",60,0)
 D ST Q:'$D(PRC("SITE"))
"RTN","PRCHE",61,0)
 K PRCH("AM")
"RTN","PRCHE",62,0)
EN50 D ENPO^PRCHUTL Q:'$D(PRCHPO)  D LCK1 G:'$D(DA) EN50 D ^PRCHNPO L  G EN50
"RTN","PRCHE",63,0)
 ;
"RTN","PRCHE",64,0)
EN6 ;EDIT AN INCOMPLETE P.O.
"RTN","PRCHE",65,0)
 ;Edit an Incomplete Purchase Order created by 'New Purchase Order' option only
"RTN","PRCHE",66,0)
 D ST Q:'$D(PRC("SITE"))
"RTN","PRCHE",67,0)
EN60 N FLG1 S FLG1=1 D PO Q:'$D(PRCHPO)
"RTN","PRCHE",68,0)
 D LCK1 G:'$D(DA) EN60 D ^PRCHNPO L  G EN60
"RTN","PRCHE",69,0)
 ;
"RTN","PRCHE",70,0)
EN8 ;DELETE A RECEIVING REPORT
"RTN","PRCHE",71,0)
 N FLG1 S FLG1=0 D ST Q:'$D(PRC("SITE"))  G EN80^PRCHEF
"RTN","PRCHE",72,0)
 ;
"RTN","PRCHE",73,0)
EN9 ;EDIT COMMON NUMBERING SERIES
"RTN","PRCHE",74,0)
 W ! S DIC="^PRC(442.6,",DIC(0)="AEMQL",DR=".01:99",DLAYGO=442.6 D DIE Q:Y<0  I $D(^PRC(442.6,+Y)),$P(^(+Y,0),U,5)="" W !!,$C(7),"NOTE: Since you have left the USING SECTION field empty, these",!,"numbers can only be used by P&C.",!
"RTN","PRCHE",75,0)
 G EN9
"RTN","PRCHE",76,0)
 ;
"RTN","PRCHE",77,0)
EN10 ;EDIT SUPPLY EMPLOYEE INFORMATION
"RTN","PRCHE",78,0)
 K DIC,DA,X,Y S DIC="^VA(200,",DIC(0)="AEMQ" D ^DIC
"RTN","PRCHE",79,0)
 G:Y<0 EN10Q
"RTN","PRCHE",80,0)
 S DA=+Y L +^VA(200,DA):0 E  W $C(7),!,"ANOTHER USER IS EDITING THIS ENTRY!" G EN10
"RTN","PRCHE",81,0)
 K DR,DIE S DR="400;.135;.136;.151",DIE=DIC D ^DIE K DIE,DR
"RTN","PRCHE",82,0)
 L -^VA(200,DA)
"RTN","PRCHE",83,0)
 W !?5,"To edit the Signature Block Printed Name or title, Use TBOX",!
"RTN","PRCHE",84,0)
 G:'$D(DTOUT) EN10
"RTN","PRCHE",85,0)
EN10Q K DIC,DIE,X,Y,DA,DR,DTOUT,DUOUT
"RTN","PRCHE",86,0)
 Q
"RTN","PRCHE",87,0)
 ;
"RTN","PRCHE",88,0)
EN11 ;EDIT ADMINISTRATIVE CERTIFICATIONS
"RTN","PRCHE",89,0)
 S DIC="^PRC(442.7,",DIC(0)="AEMLQ",DR=".01:99",DLAYGO=442.7 D DIE Q:Y<0  G EN11
"RTN","PRCHE",90,0)
 ;
"RTN","PRCHE",91,0)
EN12 ;EDIT DELIVERY DATE
"RTN","PRCHE",92,0)
 N PRCHP D ST Q:'$D(PRC("SITE"))
"RTN","PRCHE",93,0)
 ;S PRCHP("S")="$P($G(^(7)),U,2)>19,$P($G(^(7)),U,2)<30,($P($G(^(0)),U,2)=25!($S($D(PRCHNRQ):$P($G(^(0)),U,2)=8,1:$P($G(^(0)),U,2)<8)))"
"RTN","PRCHE",94,0)
EN120 D PORQ I '$D(PRCHPO) G Q
"RTN","PRCHE",95,0)
 ;I X<20!(X>29) W " ??",$C(7) G EN120
"RTN","PRCHE",96,0)
 I "^20^21^22^23^24^25^26^27^28^29^32^34^39^44^46^47^"'[(U_X_U) W " ??",$C(7) G EN120
"RTN","PRCHE",97,0)
 D LCK1 G:'$D(DA) EN120
"RTN","PRCHE",98,0)
 S D0=DA,%=2,%B="",%A="REVIEW ORDER " D ^PRCFYN D:%=1 ^PRCHDP1
"RTN","PRCHE",99,0)
 W ! S PRCHDT=$P(^PRC(442,PRCHPO,0),U,10) S DA=PRCHPO,DIE="^PRC(442,",DR="[PRCHDEL]" D ^DIE S X=$P(^PRC(442,PRCHPO,0),U,10) I X,X'=PRCHDT,$P(^(0),U,20)="" S $P(^(0),U,20)=PRCHDT
"RTN","PRCHE",100,0)
 ; trigger bulletin for changed delivery date
"RTN","PRCHE",101,0)
 S PRCHDTT=$P(^PRC(442,PRCHPO,0),U,10) I PRCHDTT'=PRCHDT D ^PRCFACS2
"RTN","PRCHE",102,0)
 K PRCHDT D Q G EN120
"RTN","PRCHE",103,0)
 ;
"RTN","PRCHE",104,0)
EN13 ; Delete 2237 option has been de-activated.
"RTN","PRCHE",105,0)
 ; See documentation for PRC*5*128.
"RTN","PRCHE",106,0)
 Q
"RTN","PRCHE",107,0)
EN14 ;CREATE ADJUSTMENT VOUCHER
"RTN","PRCHE",108,0)
 D ST Q:'$D(PRC("SITE"))
"RTN","PRCHE",109,0)
EN140 D PORQ Q:'$D(PRCHPO)
"RTN","PRCHE",110,0)
 N PRCOK,PRCARDIEN,PCARDID,PCARDNM
"RTN","PRCHE",111,0)
 I X=28!(X=33) W $C(7),!,"Adjustment Vouchers not allowed until after order has been Obligated!!" G EN140
"RTN","PRCHE",112,0)
 I '$O(^PRC(442,PRCHPO,11,0)) W !?3,"Order has no Receiving Reports !",$C(7) G EN140
"RTN","PRCHE",113,0)
 S PRCOK=$$PCAUTH(DUZ,PRCHPO) I 'PRCOK D  G EN140 ; check authorization level, must be holder, surrogate or approver
"RTN","PRCHE",114,0)
 . S PCARDIEN=$P(PRCOK,U,2),PCARDID=$P(^PRC(440.5,PCARDIEN,0),U,1) D
"RTN","PRCHE",115,0)
 .. ;PRC*5.1*163 alters unauthorized user display to card name and card holder
"RTN","PRCHE",116,0)
 .. S PCARDNM=$P(^PRC(440.5,PCARDIEN,0),U,8),PCARDNM=$P($G(^VA(200,PCARDNM,0)),U)
"RTN","PRCHE",117,0)
 .. W $C(7),!,"You are not authorized to make adjustments on P-Card:"
"RTN","PRCHE",118,0)
 .. W !,?6,$P(^PRC(440.5,PCARDIEN,0),U,11),", belonging to ",PCARDNM
"RTN","PRCHE",119,0)
 . D WRNGMSG ; send e-mail to card holder
"RTN","PRCHE",120,0)
 D ^PRCHAM4 G EN140
"RTN","PRCHE",121,0)
 ;
"RTN","PRCHE",122,0)
EN15 ;ENTER LOG DEPARTMENTS TO FCP FILE (420)
"RTN","PRCHE",123,0)
 D ST Q:'$D(PRC("SITE"))
"RTN","PRCHE",124,0)
EN150 S DIC="^PRC(420,"_PRC("SITE")_",1,",DIC(0)="AEMNQ"
"RTN","PRCHE",125,0)
 S DIC("A")="Select CONTROL POINT: ",D="B^C" D MIX^DIC1 G:Y<0 Q
"RTN","PRCHE",126,0)
 S DIE=DIC,DA(1)=PRC("SITE"),DA=+Y,DR=19 D ^DIE
"RTN","PRCHE",127,0)
 D:$P(^PRC(420,DA(1),1,DA,0),U,18)?1"11".E
"RTN","PRCHE",128,0)
 .  W !,">>> You have just assigned a LOG DEPARTMENT that should only be used for        Subsistence FCPs.  If that is NOT true, please reassign it or you will be       asked for a Food Group on every item purchased."
"RTN","PRCHE",129,0)
 G EN150
"RTN","PRCHE",130,0)
 ;
"RTN","PRCHE",131,0)
DIE S PRCHDA=-1 D ^DIC
"RTN","PRCHE",132,0)
 I Y>0 S PRCHDA=+Y,DIE=DIC,DA=+Y D LCK I $D(DA) D ^DIE
"RTN","PRCHE",133,0)
 S Y=PRCHDA K PRCHDA G Q
"RTN","PRCHE",134,0)
 ;
"RTN","PRCHE",135,0)
QQ S:'$D(ROUTINE) ROUTINE=$T(+0) W !!,$$ERR^PRCHQQ(ROUTINE,PRCSIG) W:PRCSIG=0!(PRCSIG=-3) !,"Notify Application Coordinator!",$C(7) S DIR(0)="EAO",DIR("A")="Press <return> to continue" D ^DIR
"RTN","PRCHE",136,0)
 ;
"RTN","PRCHE",137,0)
Q K DA,DIC,DIE,DIK,DR,DLAYGO,D0,E,I,J,L,PRCHEX,PRCHPUSH,%,ROUTINE,CHECK L
"RTN","PRCHE",138,0)
 Q
"RTN","PRCHE",139,0)
 ;
"RTN","PRCHE",140,0)
LCK1 S DIC="^PRC(442,"
"RTN","PRCHE",141,0)
 ;
"RTN","PRCHE",142,0)
LCK L +@(DIC_DA_")"):DILOCKTM E  W !,$C(7),"ANOTHER USER IS EDITING THIS ENTRY!" K DA
"RTN","PRCHE",143,0)
 Q
"RTN","PRCHE",144,0)
 ;
"RTN","PRCHE",145,0)
ST S PRCF("X")="S" D ^PRCFSITE
"RTN","PRCHE",146,0)
 Q
"RTN","PRCHE",147,0)
 ;
"RTN","PRCHE",148,0)
PO S PRCHP("A")="P.O./REQ.NO.: "
"RTN","PRCHE",149,0)
 S PRCHP("S")=$S(FLG1:"$P($G(^(7)),U,2)<10,($P(^(0),U,2)<10!($P(^(0),U,2)=25&($P($G(^(23)),U,11)=""""))!($P(^(0),U,2)=26))",1:"$P(^(0),U,2)<10!($P(^(0),U,2)=25)!($P(^(0),U,2)=26)")
"RTN","PRCHE",150,0)
 S:$G(PRCHPC)=1 PRCHP("S")="$P($G(^(7)),U,2)<9,$P($G(^(1)),U,10)=DUZ,$P($G(^(0)),U,2)=25,$P($G(^(23)),U,11)=""S"""
"RTN","PRCHE",151,0)
 S:$G(PRCHPC)=2 PRCHP("S")="$P($G(^(7)),U,2)<9,$P($G(^(1)),U,10)=DUZ,$P($G(^(0)),U,2)=25,$P($G(^(23)),U,11)=""P"""
"RTN","PRCHE",152,0)
 S:$G(PRCHDELV) PRCHP("S")="$P($G(^(7)),U,2)<9,$P($G(^(23)),U,11)=""D"",$P(^(0),U,2)'=26"
"RTN","PRCHE",153,0)
 S:$G(PRCHPC)=3 PRCHP("S")="$P($G(^(7)),U,2)<9,$P($G(^(1)),U,10)=DUZ,$P($G(^(0)),U,2)=25,$P($G(^(23)),U,11)=""P"""
"RTN","PRCHE",154,0)
 S:$G(PRCHPHAM) PRCHP("S")="$P($G(^(7)),U,2)<9,$P($G(^(23)),U,11)=""D"",$P(^(0),U,2)=26"
"RTN","PRCHE",155,0)
 D EN3^PRCHPAT
"RTN","PRCHE",156,0)
 Q
"RTN","PRCHE",157,0)
 ;
"RTN","PRCHE",158,0)
PORQ S:$D(PRCHNRQ) PRCHP("A")="REQUISITION NO.: "
"RTN","PRCHE",159,0)
 I $G(PRCHAUTH)=1 S PRCHP("S")="$P($G(^(23)),U,11)=""P"""
"RTN","PRCHE",160,0)
 I $G(PRCHAUTH)=2 S PRCHP("S")="$P($G(^(23)),U,11)=""D"""
"RTN","PRCHE",161,0)
 D EN3^PRCHPAT
"RTN","PRCHE",162,0)
 Q
"RTN","PRCHE",163,0)
 ;
"RTN","PRCHE",164,0)
PCAUTH(PRCUSER,PRCORDIEN) ; Determine if authorized to adjust PCard Tx
"RTN","PRCHE",165,0)
 ; parameter 1 = DUZ of current user
"RTN","PRCHE",166,0)
 ; parameter 2 = IEN of order in file #442
"RTN","PRCHE",167,0)
 ; returns 1 if this is not a Purchase Card transaction
"RTN","PRCHE",168,0)
 ; returns 2 if this is a PCard order and the user is Holder, Surrogate, Approving Official, or Alternate Approving Official
"RTN","PRCHE",169,0)
 ; returns 0 if this is a PCard order but the user is not one of the above
"RTN","PRCHE",170,0)
 ; for values 0 and 2, returns the purchase card IEN (#440.5) in the second up-arrow piece
"RTN","PRCHE",171,0)
 N PCARD,PCAUTH,PCXRF
"RTN","PRCHE",172,0)
 S PCAUTH=0
"RTN","PRCHE",173,0)
 S PCARD=$P($G(^PRC(442,PRCORDIEN,23)),U,8)
"RTN","PRCHE",174,0)
 I PCARD="" Q 1  ; no purchase card involved
"RTN","PRCHE",175,0)
 F PCXRF="C","E","F" I $D(^PRC(440.5,PCXRF,PRCUSER,PCARD)) S PCAUTH=2 ; pcard is ok for this user
"RTN","PRCHE",176,0)
 Q PCAUTH_U_PCARD
"RTN","PRCHE",177,0)
 ;
"RTN","PRCHE",178,0)
WRNGMSG ;Send message to PCard holder when non-authorized user attempts to modify Tx
"RTN","PRCHE",179,0)
 N PRCHOLDER,XMDUZ,XMY,XMSUB,XMTEXT
"RTN","PRCHE",180,0)
 S PRCHOLDER=$P(^PRC(440.5,PCARDIEN,0),U,8) Q:PRCHOLDER=""
"RTN","PRCHE",181,0)
 K ^TMP("PRCHE",$J)
"RTN","PRCHE",182,0)
 S ^TMP("PRCHE",$J,1,0)="An attempt has been made to enter an Adjustment Voucher"
"RTN","PRCHE",183,0)
 S ^TMP("PRCHE",$J,2,0)="for the following Purchase Card Order:"
"RTN","PRCHE",184,0)
 S ^TMP("PRCHE",$J,3,0)="P-Card number: "_PCARDID_"    Card Holder: "_$P(^VA(200,PRCHOLDER,0),U,1)
"RTN","PRCHE",185,0)
 S ^TMP("PRCHE",$J,4,0)="Transaction number: "_$P(Y(0,0),U,1)
"RTN","PRCHE",186,0)
 S ^TMP("PRCHE",$J,5,0)="User attempting access: "_$P(PRC("PER"),U,2)
"RTN","PRCHE",187,0)
 S ^TMP("PRCHE",$J,6,0)="This user is not on the card's authorized access list."
"RTN","PRCHE",188,0)
 S XMDUZ="IFCAP Purchase Card Monitor"
"RTN","PRCHE",189,0)
 S XMSUB="Unauthorized P-Card transaction report"
"RTN","PRCHE",190,0)
 S XMTEXT="^TMP(""PRCHE"","_$J_","
"RTN","PRCHE",191,0)
 S XMY(PRCHOLDER)=""
"RTN","PRCHE",192,0)
 D ^XMD
"RTN","PRCHE",193,0)
 K ^TMP("PRCHE",$J)
"RTN","PRCHE",194,0)
 Q
"VER")
8.0^22.0
"BLD",6950,6)
^135
**END**
**END**
