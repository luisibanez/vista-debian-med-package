Released PRC*5.1*168 SEQ #152
Extracted from mail message
**KIDS**:PRC*5.1*168^

**INSTALL NAME**
PRC*5.1*168
"BLD",7066,0)
PRC*5.1*168^IFCAP^0^3130320^y
"BLD",7066,1,0)
^^5^5^3130114^
"BLD",7066,1,1,0)
1. Display/print for 1358 prints out of sequence when more than 999
"BLD",7066,1,2,0)
   transactions.
"BLD",7066,1,3,0)
 
"BLD",7066,1,4,0)
2. Modify IFCAP security key PRCFA SUPERVISOR 'Keep at Terminate' setting
"BLD",7066,1,5,0)
   to 'NO'.
"BLD",7066,4,0)
^9.64PA^^
"BLD",7066,6.3)
3
"BLD",7066,"ABPKG")
n
"BLD",7066,"INID")
^y
"BLD",7066,"INIT")
START^PRC168P
"BLD",7066,"KRN",0)
^9.67PA^779.2^20
"BLD",7066,"KRN",.4,0)
.4
"BLD",7066,"KRN",.401,0)
.401
"BLD",7066,"KRN",.402,0)
.402
"BLD",7066,"KRN",.403,0)
.403
"BLD",7066,"KRN",.5,0)
.5
"BLD",7066,"KRN",.84,0)
.84
"BLD",7066,"KRN",3.6,0)
3.6
"BLD",7066,"KRN",3.8,0)
3.8
"BLD",7066,"KRN",9.2,0)
9.2
"BLD",7066,"KRN",9.8,0)
9.8
"BLD",7066,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7066,"KRN",9.8,"NM",1,0)
PRC168P^^0^B5228324
"BLD",7066,"KRN",9.8,"NM",2,0)
PRCE58P1^^0^B18868603
"BLD",7066,"KRN",9.8,"NM",3,0)
PRCE58P3^^0^B19541081
"BLD",7066,"KRN",9.8,"NM","B","PRC168P",1)

"BLD",7066,"KRN",9.8,"NM","B","PRCE58P1",2)

"BLD",7066,"KRN",9.8,"NM","B","PRCE58P3",3)

"BLD",7066,"KRN",19,0)
19
"BLD",7066,"KRN",19.1,0)
19.1
"BLD",7066,"KRN",101,0)
101
"BLD",7066,"KRN",409.61,0)
409.61
"BLD",7066,"KRN",771,0)
771
"BLD",7066,"KRN",779.2,0)
779.2
"BLD",7066,"KRN",870,0)
870
"BLD",7066,"KRN",8989.51,0)
8989.51
"BLD",7066,"KRN",8989.52,0)
8989.52
"BLD",7066,"KRN",8994,0)
8994
"BLD",7066,"KRN","B",.4,.4)

"BLD",7066,"KRN","B",.401,.401)

"BLD",7066,"KRN","B",.402,.402)

"BLD",7066,"KRN","B",.403,.403)

"BLD",7066,"KRN","B",.5,.5)

"BLD",7066,"KRN","B",.84,.84)

"BLD",7066,"KRN","B",3.6,3.6)

"BLD",7066,"KRN","B",3.8,3.8)

"BLD",7066,"KRN","B",9.2,9.2)

"BLD",7066,"KRN","B",9.8,9.8)

"BLD",7066,"KRN","B",19,19)

"BLD",7066,"KRN","B",19.1,19.1)

"BLD",7066,"KRN","B",101,101)

"BLD",7066,"KRN","B",409.61,409.61)

"BLD",7066,"KRN","B",771,771)

"BLD",7066,"KRN","B",779.2,779.2)

"BLD",7066,"KRN","B",870,870)

"BLD",7066,"KRN","B",8989.51,8989.51)

"BLD",7066,"KRN","B",8989.52,8989.52)

"BLD",7066,"KRN","B",8994,8994)

"BLD",7066,"QDEF")
^^^^^^^^^^YES
"BLD",7066,"QUES",0)
^9.62^^
"BLD",7066,"REQB",0)
^9.611^1^1
"BLD",7066,"REQB",1,0)
PRC*5.1*158^2
"BLD",7066,"REQB","B","PRC*5.1*158",1)

"INIT")
START^PRC168P
"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
168^3130320
"PKG",455,22,1,"PAH",1,1,0)
^^5^5^3130320
"PKG",455,22,1,"PAH",1,1,1,0)
1. Display/print for 1358 prints out of sequence when more than 999
"PKG",455,22,1,"PAH",1,1,2,0)
   transactions.
"PKG",455,22,1,"PAH",1,1,3,0)
 
"PKG",455,22,1,"PAH",1,1,4,0)
2. Modify IFCAP security key PRCFA SUPERVISOR 'Keep at Terminate' setting
"PKG",455,22,1,"PAH",1,1,5,0)
   to 'NO'.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PRC168P")
0^1^B5228324^n/a
"RTN","PRC168P",1,0)
PRC168P ;VMP/RB - PRCFA SUPERVISOR key setting/audit ;03/01/12
"RTN","PRC168P",2,0)
 ;;5.1;IFCAP;**168**;Oct 20, 2000;Build 3
"RTN","PRC168P",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRC168P",4,0)
 ;;
"RTN","PRC168P",5,0)
 Q
"RTN","PRC168P",6,0)
START ;
"RTN","PRC168P",7,0)
 ;   Post install to set key PRCFA SUPERVISOR terminate setting
"RTN","PRC168P",8,0)
 ;   to 'NO" and audit to look for terminated employees having
"RTN","PRC168P",9,0)
 ;   PRCFA SUPERVISOR key.
"RTN","PRC168P",10,0)
 ;
"RTN","PRC168P",11,0)
 Q:$D(^XTMP("PRC168P"))
"RTN","PRC168P",12,0)
SETUP D NOW^%DTC S RMSTART=%,(T1,T2,T3)=0
"RTN","PRC168P",13,0)
 S ^XTMP("PRC168P","START COMPILE")=RMSTART
"RTN","PRC168P",14,0)
 S ^XTMP("PRC168P","END COMPILE")="RUNNING"
"RTN","PRC168P",15,0)
 S ^XTMP("PRC168P",0)=$$FMADD^XLFDT(RMSTART,120)_"^"_RMSTART
"RTN","PRC168P",16,0)
SET S CPOKEY=$O(^DIC(19.1,"B","PRCFA SUPERVISOR",0)) D:CPOKEY  I 'CPOKEY W !!,"** NO PRCFA SUPERVISOR KEY DEFINED AS IFCAP SECURITY KEY **" G EXIT
"RTN","PRC168P",17,0)
 . S R0=^DIC(19.1,CPOKEY,0)
"RTN","PRC168P",18,0)
 . S ^XTMP("PRC168P","KEY",0)=$P(R0,U,4)_U_"n"
"RTN","PRC168P",19,0)
 . S DA=CPOKEY,DIE="^DIC(19.1,",DR=".04///n" D ^DIE
"RTN","PRC168P",20,0)
AUDIT ;FIND EMPLOYEES IN ^VA(200) W/ KEY PRCFA SUPERVISOR
"RTN","PRC168P",21,0)
 S IEN=0,U="^"
"RTN","PRC168P",22,0)
1 S IEN=$O(^VA(200,IEN)) G EXIT:IEN=""!(IEN]"@")
"RTN","PRC168P",23,0)
 S R0=$G(^VA(200,IEN,0)) I R0="" S STS="X",T3=T3+1 D 3 G 1
"RTN","PRC168P",24,0)
2 S VAKEY=$O(^VA(200,IEN,51,"B",CPOKEY,0)) G 1:VAKEY=""!(VAKEY]"@")  D
"RTN","PRC168P",25,0)
 . S KR0=$G(^VA(200,IEN,51,VAKEY,0)) Q:$P(KR0,U)'=VAKEY
"RTN","PRC168P",26,0)
 . I $P(R0,U,11) S STS="T",T1=T1+1 D  D 3 Q
"RTN","PRC168P",27,0)
 .. S DA=VAKEY,DA(1)=IEN,DIK="^VA(200,"_DA(1)_",51," D ^DIK
"RTN","PRC168P",28,0)
 . S STS="A",T2=T2+1 D 3
"RTN","PRC168P",29,0)
 G 1
"RTN","PRC168P",30,0)
3 S ^XTMP("PRC168P",STS,IEN,0)=$P(R0,U)_U_$P(R0,U,11)
"RTN","PRC168P",31,0)
 Q
"RTN","PRC168P",32,0)
EXIT ;
"RTN","PRC168P",33,0)
 D NOW^%DTC S RMEND=%
"RTN","PRC168P",34,0)
 S ^XTMP("PRC168P","END COMPILE")=RMEND_U_T1_U_T2_U_T3
"RTN","PRC168P",35,0)
 W !!,"Number of TERMINATED employees with key PRCFA SUPERVISOR still assigned: ",T1
"RTN","PRC168P",36,0)
 W !!,"Number of ACTIVE employees with key PRCFA SUPERVISOR still assigned: ",T2
"RTN","PRC168P",37,0)
 W !!,"Number of employees with *NO* node 0 information: ",T3
"RTN","PRC168P",38,0)
 K RMEND,RMSTART,%,DR,DA,DIE,DIK,IEN,IENKEY,VAKEY,CPOKEY,T1,T2,T3,STS,R0,KR0
"RTN","PRC168P",39,0)
 Q
"RTN","PRCE58P1")
0^2^B18868603^B16647166
"RTN","PRCE58P1",1,0)
PRCE58P1 ;WISC/SAW,LDB/BGJ-CONTROL POINT ACTIVITY 1358 DISPLAY CON'T ;6/17/11  17:51
"RTN","PRCE58P1",2,0)
V ;;5.1;IFCAP;**158,168**;Oct 20, 2000;Build 3
"RTN","PRCE58P1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCE58P1",4,0)
 ;
"RTN","PRCE58P1",5,0)
 ;PRC*5.1*168 will remove leading zeros when transactions compile into 
"RTN","PRCE58P1",6,0)
 ;            temp global ^TMP("PRCSR") to insure correct sort for 1358
"RTN","PRCE58P1",7,0)
 ;            having more than 999 transactions
"RTN","PRCE58P1",8,0)
 ;
"RTN","PRCE58P1",9,0)
 S Z=$S($D(PRCSPO):PRC("SITE")_"-"_PRCSPO,1:0)
"RTN","PRCE58P1",10,0)
I I 'Z!('$D(^PRC(424,"AD",Z))) W !,"Daily Record entries have not yet been entered for this request.",!,"The total committed cost of this request is $" W:$D(TRNODE(4)) $J($P(TRNODE(4),U),0,2) W !,L G P
"RTN","PRCE58P1",11,0)
 D HDR1 S PRCSX=0 D OB S (ET,AT,UT)="" D PO1 Q:Z3=U
"RTN","PRCE58P1",12,0)
 W !!,?7,"TOTALS",?29,"$"
"RTN","PRCE58P1",13,0)
 ;Display of dollar amounts staggered if any amount $1 million or more
"RTN","PRCE58P1",14,0)
 D
"RTN","PRCE58P1",15,0)
 . I ET>999999.99!(AT>999999.99)!(CET>999999.99) D  Q
"RTN","PRCE58P1",16,0)
 . . W $J(ET,9,2),?51,"$",$J(CET,9,2),?69,"$",$J((PRCSOT-UT),9,2) W !,?40,"$",$J(AT,9,2)
"RTN","PRCE58P1",17,0)
 . W $J(ET,9,2),?40,"$",$J(AT,9,2),?51,"$",$J(CET,9,2),?69,"$",$J((PRCSOT-UT),9,2)
"RTN","PRCE58P1",18,0)
 K PRCSX,PRCSOT,UT,CT,AT,ET,CAT,CET,PRCSR,PRCSX,PRCSXX,J,JJ
"RTN","PRCE58P1",19,0)
 D P
"RTN","PRCE58P1",20,0)
 Q
"RTN","PRCE58P1",21,0)
OB ;DISPLAY ONLY OBLIGATIONS
"RTN","PRCE58P1",22,0)
 I '$D(^PRC(424,"AD",Z)) G OB1
"RTN","PRCE58P1",23,0)
 S (PRCSOT,X1,UT)="" F  S X1=$O(^PRC(424,"AF",Z,X1)) Q:X1'>0  I $D(^PRC(424,X1,0)) S Z1=^(0),PRCSOT=PRCSOT+$P(Z1,U,6) X "I IOSL-$Y<5 D HOLD^PRCE58P0 Q:Z3=U  D NEWP^PRCE58P0,HDR1" D DR1
"RTN","PRCE58P1",24,0)
 W !,L Q:$D(PRCSX)
"RTN","PRCE58P1",25,0)
OB1 W !!,"The following 1358 obligation/adjustment request is ready for processing:"
"RTN","PRCE58P1",26,0)
 S X=$P(TRNODE(0),U,1,2) W !,"TRANSACTION NUMBER: ",$P(X,U),?40,"TYPE: ",$S($P(X,U,2)="O":"OBLIGATION",1:"ADJUSTMENT"),?50,"AMOUNT: $",$J($P(TRNODE(4),U,8),0,2) W !,L G P
"RTN","PRCE58P1",27,0)
PO1 I $D(TRNODE(10)) S PRCSY=$P(TRNODE(10),U,3) I PRCSY K PO D PO^PRCH58OB(PRCSY,.PO) D:$D(PO(0)) PO11
"RTN","PRCE58P1",28,0)
 Q
"RTN","PRCE58P1",29,0)
PO11 K ^TMP("PRCSR",$J)
"RTN","PRCE58P1",30,0)
 I IOSL-$Y<15 D HOLD^PRCE58P0 Q:Z3=U  D NEWP^PRCE58P0
"RTN","PRCE58P1",31,0)
 D HDR S CET=0 F  S PRCSX=$O(^PRC(424,"C",PRCSY,PRCSX)) Q:'PRCSX  D
"RTN","PRCE58P1",32,0)
 . I $D(^PRC(424,PRCSX,0)),"^AU^L^"[("^"_$P(^(0),U,3)_"^") S Z1=^(0) I Z1 S ^TMP("PRCSR",$J,+$P($P(Z1,U),"-",3),PRCSX)=Z1   ;PRC*5.1*168 will remove leading zeros in TX#
"RTN","PRCE58P1",33,0)
 S PRCSXX="" F  S PRCSXX=$O(^TMP("PRCSR",$J,PRCSXX)) Q:PRCSXX=""  S (A,E)=0 D PO12 Q:Z3=U
"RTN","PRCE58P1",34,0)
 K ^TMP("PRCSR",$J) Q
"RTN","PRCE58P1",35,0)
PO12 S PRCSX=0 F  S PRCSX=$O(^TMP("PRCSR",$J,PRCSXX,PRCSX)) Q:PRCSX'>0  S Z1=^TMP("PRCSR",$J,PRCSXX,PRCSX),Y=$P(Z1,U,7) D T X "I IOSL-$Y<3 D HOLD^PRCE58P0 Q:Z3=U  D NEWP^PRCE58P0,HDR" D PO2 Q:Z3=U
"RTN","PRCE58P1",36,0)
 K A,E Q
"RTN","PRCE58P1",37,0)
PO2 W !,Y,?7,$E("0000",1,4-$L(PRCSXX))_PRCSXX,?12,$P(Z1,U,10),?29,"$"   ;PRC*5.1*168 will zero pad TX# for print
"RTN","PRCE58P1",38,0)
 S E=$P(Z1,U,12),A=$P(Z1,U,5),UT=UT+$P(Z1,U,4),AT=AT+A,ET=ET+E,CET=CET+E
"RTN","PRCE58P1",39,0)
 ;Display of dollar amounts staggered if any amount $1 million or more
"RTN","PRCE58P1",40,0)
 D
"RTN","PRCE58P1",41,0)
 . I E>999999.99!(A>999999.99)!(CET>999999.99)!(Z1>999999.99) D  Q
"RTN","PRCE58P1",42,0)
 . . W $J(E,9,2),?51,"$",$J(CET,9,2) W ! W:$D(PRCSA) ?12,$G(^PRC(424,PRCSX,1)) W ?40,"$",$J(A,9,2),?62,"$",$J($P(Z1,U,4),9,2)
"RTN","PRCE58P1",43,0)
 . W $J(E,9,2),?40,"$",$J(A,9,2),?51,"$",$J(CET,9,2),?62,"$",$J($P(Z1,U,4),9,2) I $D(PRCSA) W !,?12,$G(^PRC(424,PRCSX,1))
"RTN","PRCE58P1",44,0)
 I $D(^PRC(424.1,"C",PRCSX)),$G(PRCSA1)=1 S I=0 F  S I=$O(^PRC(424.1,"C",PRCSX,I)) Q:'I  I $D(^PRC(424.1,I,0)),$P(^(0),U,11)="P" D  Q:Z3=U  W !
"RTN","PRCE58P1",45,0)
 . W ! I IOSL-$Y<5 D HOLD^PRCE58P0 Q:Z3=U  D NEWP^PRCE58P0,HDR
"RTN","PRCE58P1",46,0)
 . W ! S Y=$P(^PRC(424.1,I,0),U,4) D T W Y,?7,$P($P(^(0),U),"-",3,4) W !,?12,$P(^(0),U,8),?29,"$",$J(($P(^(0),U,3)/-1),9,2)
"RTN","PRCE58P1",47,0)
 . I IOSL-$Y<5 D HOLD^PRCE58P0 Q:Z3=U  D NEWP^PRCE58P0,HDR
"RTN","PRCE58P1",48,0)
 . I PRCSA2=1,$D(^PRC(424.1,I,1)) W !,?12,^(1)
"RTN","PRCE58P1",49,0)
 Q
"RTN","PRCE58P1",50,0)
P W:Z3'=U !!,"VA FORM 4-1358a-ADP (NOV 1987)",! Q
"RTN","PRCE58P1",51,0)
DR1 S Y=$P(Z1,U,7) D T W !,Y,?7,$P($P(Z1,U),"-",3)
"RTN","PRCE58P1",52,0)
 S DA=$P(Z1,U,15) I DA D NODE^PRCS58OB(DA,.TRNODE) W ?13,$P(TRNODE(0),U)
"RTN","PRCE58P1",53,0)
 W ?36,"$",$J($P(Z1,U,6),9,2) W:$D(PRCSX) ?56,"$",$J(PRCSOT,9,2) Q
"RTN","PRCE58P1",54,0)
HDR W !,"AUTHORIZATION & ORDER RECORD",?62,"LIQUIDATION RECORD"
"RTN","PRCE58P1",55,0)
  W !!,?30,"AUTH.",?41,"AUTH.",?53,"CUMULATIVE",?74,"UNLIQ",!,"DATE",?7,"SEQ#",?14,"REFERENCE",?30,"AMOUNT",?41,"BALANCE",?53,"AUTH. AMT.",?64,"LIQUID",?74,"BAL" W !,L Q
"RTN","PRCE58P1",56,0)
HDR1 W !,"ESTIMATED OBLIGATION RECAP",!,"DATE",?7,"REF#",?13,"CPA#",?37,"AMOUNT",?57,"BALANCE" Q
"RTN","PRCE58P1",57,0)
T S Y=$E(Y,4,5)_"/"_$E(Y,6,7) Q
"RTN","PRCE58P3")
0^3^B19541081^B17424731
"RTN","PRCE58P3",1,0)
PRCE58P3 ;WISC/SAW,LDB/BGJ-CONTROL POINT ACTIVITY 1358 PRINOUT CON'T ;6/17/11  17:53
"RTN","PRCE58P3",2,0)
V ;;5.1;IFCAP;**158,168**;Oct 20, 2000;Build 3
"RTN","PRCE58P3",3,0)
  ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCE58P3",4,0)
 ;
"RTN","PRCE58P3",5,0)
 ;PRC*5.1*168 will remove leading zeros when transactions compile into 
"RTN","PRCE58P3",6,0)
 ;            temp global ^TMP("PRCSR") to insure correct sort for 1358
"RTN","PRCE58P3",7,0)
 ;            having more than 999 transactions
"RTN","PRCE58P3",8,0)
 ;
"RTN","PRCE58P3",9,0)
 S Z=$S($D(PRCSPO):PRC("SITE")_"-"_PRCSPO,1:0) G OB:$D(PRCSOB)
"RTN","PRCE58P3",10,0)
 I 'Z!('$D(^PRC(424,"AD",Z))) W !,"Daily Record entries have not yet been entered for this request.",!,"The total committed cost of this request is $" W:$D(TRNODE(4)) $J($P(TRNODE(4),U),0,2) D UL^PRCE58P2 G P
"RTN","PRCE58P3",11,0)
PO D HDR1 S PRCSX=0 D OB S (CET,ET,AT,UT)="" D PO1
"RTN","PRCE58P3",12,0)
 W !!,?7,"TOTALS",?29,"$"
"RTN","PRCE58P3",13,0)
 ;Display of dollar amounts staggered if any amount $1 million or more
"RTN","PRCE58P3",14,0)
 D
"RTN","PRCE58P3",15,0)
 . I ET>999999.99!(AT>999999.99)!(CET>999999.99) D  Q
"RTN","PRCE58P3",16,0)
 . . W $J(ET,9,2),?51,"$",$J(CET,9,2),?69,"$",$J((PRCSOT-UT),9,2) W !,?40,"$",$J(AT,9,2)
"RTN","PRCE58P3",17,0)
 . W $J(ET,9,2),?40,"$",$J(AT,9,2),?51,"$",$J(CET,9,2),?69,"$",$J((PRCSOT-UT),9,2)
"RTN","PRCE58P3",18,0)
 K PRCSX,PRCSOT,UT,CT,AT,ET,CAT,CET,PRCSR,PRCSX,PRCSXX,J,JJ,TRNODE
"RTN","PRCE58P3",19,0)
 D P
"RTN","PRCE58P3",20,0)
 Q
"RTN","PRCE58P3",21,0)
PO1 I $D(TRNODE(10)) S PRCSY=$P(TRNODE(10),U,3) I PRCSY K PO D PO^PRCH58OB(PRCSY,.PO) D:$D(PO(0)) PO11
"RTN","PRCE58P3",22,0)
 Q
"RTN","PRCE58P3",23,0)
PO11 ;;;PRC*5.1*168 will remove leading zeros in TX# in next line
"RTN","PRCE58P3",24,0)
 K ^TMP("PRCSR",$J) D HDR S CET=0 F  S PRCSX=$O(^PRC(424,"C",PRCSY,PRCSX)) Q:PRCSX'>0  I $D(^PRC(424,PRCSX,0)),"^AU^L^"[("^"_$P(^(0),U,3)_"^") S Z1=^(0) I Z1 S ^TMP("PRCSR",$J,+$P($P(Z1,U),"-",3),PRCSX)=Z1
"RTN","PRCE58P3",25,0)
 S PRCSXX="" F  S PRCSXX=$O(^TMP("PRCSR",$J,PRCSXX)) Q:PRCSXX=""  D PO12
"RTN","PRCE58P3",26,0)
 K ^TMP("PRCSR",$J) Q
"RTN","PRCE58P3",27,0)
PO12 S PRCSX=0 F JJ=1:1 S PRCSX=$O(^TMP("PRCSR",$J,PRCSXX,PRCSX)) Q:PRCSX'>0  S Z1=^TMP("PRCSR",$J,PRCSXX,PRCSX),Y=$P(Z1,U,7) D T D:IOSL-$Y<6 NEWP^PRCE58P2,HDR D PO2
"RTN","PRCE58P3",28,0)
 K A,E Q
"RTN","PRCE58P3",29,0)
 ;
"RTN","PRCE58P3",30,0)
PO2 W !,Y,?7,$E("0000",1,4-$L(PRCSXX))_PRCSXX,?12,$P(Z1,U,10),?29,"$"   ;PRC*5.1*168 will zero pad TX# for print
"RTN","PRCE58P3",31,0)
 S E=$P(Z1,U,12),A=$P(Z1,U,5),UT=UT+$P(Z1,U,4),AT=AT+A,ET=ET+E,CET=CET+E
"RTN","PRCE58P3",32,0)
 ;Display of dollar amounts staggered if any amount $1 million or more
"RTN","PRCE58P3",33,0)
 D
"RTN","PRCE58P3",34,0)
 . I E>999999.99!(A>999999.99)!(CET>999999.99)!(Z1>999999.99) D  Q
"RTN","PRCE58P3",35,0)
 . . W $J(E,9,2),?51,"$",$J(CET,9,2) W ! W:$D(PRCSA)&($G(^PRC(424,PRCSX,1))'="") ?12,^(1) W ?40,"$",$J(A,9,2),?62,"$",$J($P(Z1,U,4),9,2)
"RTN","PRCE58P3",36,0)
 . W $J(E,9,2),?40,"$",$J(A,9,2),?51,"$",$J(CET,9,2),?62,"$",$J($P(Z1,U,4),9,2) I $D(PRCSA),$G(^PRC(424,PRCSX,1))'="" W !,?12,^(1)
"RTN","PRCE58P3",37,0)
 I $D(^PRC(424.1,"C",PRCSX)),$D(PRCSA1),PRCSA1=1 S I=0 F  S I=$O(^PRC(424.1,"C",PRCSX,I)) Q:'I  I $D(^PRC(424.1,I,0)),$P(^(0),U,11)="P" D
"RTN","PRCE58P3",38,0)
 . I IOSL-$Y<6 D NEWP^PRCE58P2,HDR
"RTN","PRCE58P3",39,0)
 . W ! S Y=$P(^PRC(424.1,I,0),U,4) D T W Y,?7,$P($P(^(0),U),"-",3,4) W !,?12,$P(^(0),U,8),?29,"$",$J(($P(^(0),U,3)/-1),9,2)
"RTN","PRCE58P3",40,0)
 . I IOSL-$Y<6 D NEWP^PRCE58P2,HDR
"RTN","PRCE58P3",41,0)
 . I $D(PRCSA2),PRCSA2=1,$D(^PRC(424.1,I,1)) W !,?12,^(1)
"RTN","PRCE58P3",42,0)
 W ! Q
"RTN","PRCE58P3",43,0)
P W !!,"VA FORM 4-1358a-ADP (NOV 1987)",! Q
"RTN","PRCE58P3",44,0)
OB ;PRINT ONLY OBLIGATIONS
"RTN","PRCE58P3",45,0)
 I '$D(^PRC(424,"AD",Z)) G OB1
"RTN","PRCE58P3",46,0)
 S (PRCSOT,X1,UT)="" F I=1:1 S X1=$O(^PRC(424,"AF",Z,X1)) Q:X1'>0  I $D(^PRC(424,X1,0)) S Z1=^(0),PRCSOT=PRCSOT+$P(^(0),U,6) D:IOSL-$Y<3 NEWP^PRCSP11,HDR1 S ZDA=DA D DR1 S DA=ZDA K ZDA D NODE^PRCS58OB(DA,.TRNODE)
"RTN","PRCE58P3",47,0)
 D UL^PRCE58P2 Q:$D(PRCSX)
"RTN","PRCE58P3",48,0)
OB1 W !!,"The following 1358 obligation/adjustment request is ready for processing:"
"RTN","PRCE58P3",49,0)
 S X=$P(TRNODE(0),U,1,2) W !,"TRANSACTION NUMBER: ",$P(X,U),?40,"TYPE: ",$S($P(X,U,2)="O":"OBLIGATION",1:"ADJUSTMENT"),?60,"AMOUNT: $",$J($P(TRNODE(4),U,8),0,2) D UL^PRCE58P2 G P
"RTN","PRCE58P3",50,0)
DR1 S Y=$P(Z1,U,7) D T W !,Y,?7,$P($P(Z1,U),"-",3)
"RTN","PRCE58P3",51,0)
 S DA=$P(Z1,U,15) I DA D NODE^PRCS58OB(DA,.TRNODE) W ?13,$P($G(TRNODE(0)),U)
"RTN","PRCE58P3",52,0)
 W ?36,"$",$J($P(Z1,U,6),9,2) W:$D(PRCSX) ?56,"$",$J(PRCSOT,9,2) Q
"RTN","PRCE58P3",53,0)
HDR W !,"AUTHORIZATION & ORDER RECORD",?62,"LIQUIDATION RECORD"
"RTN","PRCE58P3",54,0)
 W !!,?30,"AUTH.",?41,"AUTH.",?53,"CUMULATIVE",?74,"UNLIQ",!,"DATE",?7,"SEQ#",?14,"REFERENCE",?30,"AMOUNT",?41,"BALANCE",?53,"AUTH. AMT.",?64,"LIQUID",?74,"BAL" D UL^PRCE58P2 Q
"RTN","PRCE58P3",55,0)
HDR1 W !,"ESTIMATED OBLIGATION RECAP",!,"DATE",?7,"REF#",?13,"CPA#",?37,"AMOUNT",?57,"BALANCE" Q
"RTN","PRCE58P3",56,0)
T S Y=$E(Y,4,5)_"/"_$E(Y,6,7) Q
"VER")
8.0^22.0
"BLD",7066,6)
^152
**END**
**END**
