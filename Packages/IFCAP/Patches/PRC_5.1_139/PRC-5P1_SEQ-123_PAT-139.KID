Released PRC*5.1*139 SEQ #123
Extracted from mail message
**KIDS**:PRC*5.1*139^

**INSTALL NAME**
PRC*5.1*139
"BLD",5988,0)
PRC*5.1*139^IFCAP^0^3101216^y
"BLD",5988,1,0)
^^4^4^3100611^
"BLD",5988,1,1,0)
1. Duplicate feeds of CLRS data to Austin when testing on the 
"BLD",5988,1,2,0)
   test/mirror account.
"BLD",5988,1,3,0)
 
"BLD",5988,1,4,0)
2. Ceiling Transactions out of numbers 
"BLD",5988,4,0)
^9.64PA^421^1
"BLD",5988,4,421,0)
421
"BLD",5988,4,421,2,0)
^9.641^421^1
"BLD",5988,4,421,2,421,0)
FUND DISTRIBUTION  (File-top level)
"BLD",5988,4,421,2,421,1,0)
^9.6411^.01^1
"BLD",5988,4,421,2,421,1,.01,0)
TRANSACTION NUMBER
"BLD",5988,4,421,222)
y^n^p^^^^n^^n
"BLD",5988,4,421,224)

"BLD",5988,4,"APDD",421,421)

"BLD",5988,4,"APDD",421,421,.01)

"BLD",5988,4,"B",421,421)

"BLD",5988,6.3)
16
"BLD",5988,"ABPKG")
n
"BLD",5988,"INID")
^y
"BLD",5988,"INIT")
START^PRCB139P
"BLD",5988,"KRN",0)
^9.67PA^779.2^20
"BLD",5988,"KRN",.4,0)
.4
"BLD",5988,"KRN",.401,0)
.401
"BLD",5988,"KRN",.402,0)
.402
"BLD",5988,"KRN",.403,0)
.403
"BLD",5988,"KRN",.5,0)
.5
"BLD",5988,"KRN",.84,0)
.84
"BLD",5988,"KRN",3.6,0)
3.6
"BLD",5988,"KRN",3.8,0)
3.8
"BLD",5988,"KRN",9.2,0)
9.2
"BLD",5988,"KRN",9.8,0)
9.8
"BLD",5988,"KRN",9.8,"NM",0)
^9.68A^8^7
"BLD",5988,"KRN",9.8,"NM",1,0)
PRCHLO5^^0^B87538990
"BLD",5988,"KRN",9.8,"NM",3,0)
PRCBE^^0^B19043867
"BLD",5988,"KRN",9.8,"NM",4,0)
PRCBR^^0^B31050343
"BLD",5988,"KRN",9.8,"NM",5,0)
PRCBP^^0^B34636457
"BLD",5988,"KRN",9.8,"NM",6,0)
PRCFSITE^^0^B17115209
"BLD",5988,"KRN",9.8,"NM",7,0)
PRCB139P^^0^B3925598
"BLD",5988,"KRN",9.8,"NM",8,0)
PRCBR1^^0^B21660865
"BLD",5988,"KRN",9.8,"NM","B","PRCB139P",7)

"BLD",5988,"KRN",9.8,"NM","B","PRCBE",3)

"BLD",5988,"KRN",9.8,"NM","B","PRCBP",5)

"BLD",5988,"KRN",9.8,"NM","B","PRCBR",4)

"BLD",5988,"KRN",9.8,"NM","B","PRCBR1",8)

"BLD",5988,"KRN",9.8,"NM","B","PRCFSITE",6)

"BLD",5988,"KRN",9.8,"NM","B","PRCHLO5",1)

"BLD",5988,"KRN",19,0)
19
"BLD",5988,"KRN",19.1,0)
19.1
"BLD",5988,"KRN",101,0)
101
"BLD",5988,"KRN",409.61,0)
409.61
"BLD",5988,"KRN",771,0)
771
"BLD",5988,"KRN",779.2,0)
779.2
"BLD",5988,"KRN",870,0)
870
"BLD",5988,"KRN",8989.51,0)
8989.51
"BLD",5988,"KRN",8989.52,0)
8989.52
"BLD",5988,"KRN",8994,0)
8994
"BLD",5988,"KRN","B",.4,.4)

"BLD",5988,"KRN","B",.401,.401)

"BLD",5988,"KRN","B",.402,.402)

"BLD",5988,"KRN","B",.403,.403)

"BLD",5988,"KRN","B",.5,.5)

"BLD",5988,"KRN","B",.84,.84)

"BLD",5988,"KRN","B",3.6,3.6)

"BLD",5988,"KRN","B",3.8,3.8)

"BLD",5988,"KRN","B",9.2,9.2)

"BLD",5988,"KRN","B",9.8,9.8)

"BLD",5988,"KRN","B",19,19)

"BLD",5988,"KRN","B",19.1,19.1)

"BLD",5988,"KRN","B",101,101)

"BLD",5988,"KRN","B",409.61,409.61)

"BLD",5988,"KRN","B",771,771)

"BLD",5988,"KRN","B",779.2,779.2)

"BLD",5988,"KRN","B",870,870)

"BLD",5988,"KRN","B",8989.51,8989.51)

"BLD",5988,"KRN","B",8989.52,8989.52)

"BLD",5988,"KRN","B",8994,8994)

"BLD",5988,"QUES",0)
^9.62^^
"BLD",5988,"REQB",0)
^9.611^3^2
"BLD",5988,"REQB",1,0)
PRC*5.1*98^2
"BLD",5988,"REQB",3,0)
PRC*5.1*43^2
"BLD",5988,"REQB","B","PRC*5.1*43",3)

"BLD",5988,"REQB","B","PRC*5.1*98",1)

"FIA",421)
FUND DISTRIBUTION
"FIA",421,0)
^PRCF(421,
"FIA",421,0,0)
421I
"FIA",421,0,1)
y^n^p^^^^n^^n
"FIA",421,0,10)

"FIA",421,0,11)

"FIA",421,0,"RLRO")

"FIA",421,0,"VR")
5.1^PRC
"FIA",421,421)
1
"FIA",421,421,.01)

"INIT")
START^PRCB139P
"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
139^3101216
"PKG",455,22,1,"PAH",1,1,0)
^^4^4^3101216
"PKG",455,22,1,"PAH",1,1,1,0)
1. Duplicate feeds of CLRS data to Austin when testing on the 
"PKG",455,22,1,"PAH",1,1,2,0)
   test/mirror account.
"PKG",455,22,1,"PAH",1,1,3,0)
 
"PKG",455,22,1,"PAH",1,1,4,0)
2. Ceiling Transactions out of numbers 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","PRCB139P")
0^7^B3925598^n/a
"RTN","PRCB139P",1,0)
PRCB139P ;VMP/RB-MODIFY ALL FY01 THROUGH FY11 CEILING TRANSACTIONS TO 5 DIGIT SEQ NUMBER
"RTN","PRCB139P",2,0)
 ;;5.1;IFCAP;**139**;Oct 01, 2009;Build 16
"RTN","PRCB139P",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCB139P",4,0)
 ;  Post install routine in patch PRC*5.1*139 that will modify all existing
"RTN","PRCB139P",5,0)
 ;  ceiling Transaction in file #421 for FY 2001-2011 from 4 digit sequence 
"RTN","PRCB139P",6,0)
 ;  number to 5 digit sequence number
"RTN","PRCB139P",7,0)
 ;;
"RTN","PRCB139P",8,0)
 Q
"RTN","PRCB139P",9,0)
START ;Modify ceiling tx sequence numbers from 4 to 5 digits for FY 2001-2011
"RTN","PRCB139P",10,0)
 I $D(^XTMP("PRCB139P")) Q
"RTN","PRCB139P",11,0)
 K ^XTMP("PRCB139P") D NOW^%DTC S RMSTART=%
"RTN","PRCB139P",12,0)
 S ^XTMP("PRCB139P","START COMPILE")=RMSTART
"RTN","PRCB139P",13,0)
 S ^XTMP("PRCB139P","END COMPILE")="RUNNING"
"RTN","PRCB139P",14,0)
 S ^XTMP("PRCB139P",0)=$$FMADD^XLFDT(RMSTART,120)_"^"_RMSTART
"RTN","PRCB139P",15,0)
 S U="^",IEN421=0
"RTN","PRCB139P",16,0)
1 S IEN421=$O(^PRCF(421,IEN421)) G EXIT:'IEN421
"RTN","PRCB139P",17,0)
 S R0=$G(^PRCF(421,IEN421,0)) I R0="" G 1
"RTN","PRCB139P",18,0)
 S TX421=$P(R0,U) I $P(TX421,"-",2)<01!($P(TX421,"-",2)>11) G 1
"RTN","PRCB139P",19,0)
 I $L($P(TX421,"-",3))=5 G 1
"RTN","PRCB139P",20,0)
2 ;.01 FIELD IN 0 NODE
"RTN","PRCB139P",21,0)
 S SEQ=$P(TX421,"-",3),WSEQ="0000"_SEQ,WSEQ=$E(WSEQ,$L(WSEQ)-4,$L(WSEQ))
"RTN","PRCB139P",22,0)
 S WTX421=$P(TX421,"-",1,2)_"-"_WSEQ
"RTN","PRCB139P",23,0)
 ;W !,IEN421,?10,TX421,?30,SEQ,?40,WSEQ,?50,WTX421
"RTN","PRCB139P",24,0)
3 ;'B' X-REF
"RTN","PRCB139P",25,0)
 S $P(R0,U)=WTX421,^PRCF(421,IEN421,0)=R0
"RTN","PRCB139P",26,0)
 K ^PRCF(421,"B",TX421,IEN421) S ^PRCF(421,"B",WTX421,IEN421)=""
"RTN","PRCB139P",27,0)
4 ;'AD' X-REF
"RTN","PRCB139P",28,0)
 S RVSEQ=10000-SEQ,NRVSEQ=100000-SEQ
"RTN","PRCB139P",29,0)
 S ^XTMP("PRCB139P",2,"AD",$P(TX421,"-",1,2),RVSEQ)=""
"RTN","PRCB139P",30,0)
 S ^XTMP("PRCB139P",2,"B",TX421,IEN421)=""
"RTN","PRCB139P",31,0)
 S ^XTMP("PRCB139P",2,"D",SEQ,IEN421)=""
"RTN","PRCB139P",32,0)
 K ^PRCF(421,"AD",$P(TX421,"-",1,2),RVSEQ) S ^PRCF(421,"AD",$P(WTX421,"-",1,2),NRVSEQ)=""
"RTN","PRCB139P",33,0)
 S ^XTMP("PRCB139P",1,IEN421,0)=TX421_U_WTX421_U_SEQ_U_WSEQ_U_RVSEQ_U_NRVSEQ
"RTN","PRCB139P",34,0)
5 ;'AD' X-REF
"RTN","PRCB139P",35,0)
 K ^PRCF(421,"D",SEQ,IEN421) S ^PRCF(421,"D",WSEQ,IEN421)=""
"RTN","PRCB139P",36,0)
 G 1
"RTN","PRCB139P",37,0)
EXIT ;
"RTN","PRCB139P",38,0)
 D NOW^%DTC S RMEND=%
"RTN","PRCB139P",39,0)
 S ^XTMP("PRCB139P","END COMPILE")=RMEND
"RTN","PRCB139P",40,0)
 K RMEND,RMSTART,%,IEN421,R0,TX421,SEQ,WSEQ,WTX421,RVSEQ,NRVSEQ
"RTN","PRCB139P",41,0)
 Q
"RTN","PRCBE")
0^3^B19043867^B19003458
"RTN","PRCBE",1,0)
PRCBE ;WISC@ALTOONA/CTB-EDIT ROUTINE FOR BUDGET MODULE OF ADMIN ACTIVITIES PACKAGE ; 04/07/94  1:43 PM
"RTN","PRCBE",2,0)
V ;;5.1;IFCAP;**139**;Oct 20, 2000;Build 16
"RTN","PRCBE",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCBE",4,0)
 W "ROUTINE CAN ONLY BE ENTERED THROUGH MENU MANAGER OR DRIVER",$C(7),!! Q
"RTN","PRCBE",5,0)
SEQNUM S:'$D(PRCF("SIFY")) PRCF("SIFY")=PRC("SITE")_"-"_PRC("FY") S X=$O(^PRCF(421,"AD",PRCF("SIFY"),0)) I X="" D WAIT^PRCFYN,ENIT G SEQNUM
"RTN","PRCBE",6,0)
 E  K ^PRCF(421,"AD",PRCF("SIFY"),X+30) S X=100000-X+1
"RTN","PRCBE",7,0)
 S X="00000"_X,X=$E(X,$L(X)-4,$L(X)) S PRCB("TRANS")=PRC("SITE")_"-"_PRC("FY")_"-"_X,X=PRCB("TRANS")
"RTN","PRCBE",8,0)
 Q
"RTN","PRCBE",9,0)
EN1 ;ENTER NEW TRANSACTION
"RTN","PRCBE",10,0)
 S PRCF("X")="ABFS" D ^PRCFSITE G:'% OUT
"RTN","PRCBE",11,0)
SEQ D SEQNUM G:X="" OUT
"RTN","PRCBE",12,0)
 W ! S %A="I am going to create a new transaction with the number "_X,%A(1)="IS THIS OK ",%B="",%=1 D ^PRCFYN I %'=1 W !!,"Transaction number ",X," has been deleted",$C(7) R X:2 G OUT
"RTN","PRCBE",13,0)
 K DIC("A") S DIC=421,DIC(0)="LZ",DLAYGO=421 D ^DIC I $P(Y,"^",3)="" W !,X," has just been taken by someone else, please hold on while I get another one." G SEQ
"RTN","PRCBE",14,0)
 G:+Y<0 OUT S DIE=DIC,DA=+Y,DR="[PRCB NEW TRANSACTION]" D ^DIE I $D(Y)=0,$P(^PRCF(421,DA,0),"^",2)]"",$P($G(^(0)),U,23) G EN1
"RTN","PRCBE",15,0)
 I $P(^PRCF(421,DA,0),"^",2)="" W !,$C(7),"Control Point missing."
"RTN","PRCBE",16,0)
KILL W $C(7),!!,"Transaction terminated!  ",!,"Transaction # ",PRCB("TRANS")," is being deleted." S DIK="^PRCF(421," D ^DIK
"RTN","PRCBE",17,0)
OUT K A,B,D,D0,DA,DIC,DIE,DIK,DLAYGO,DQ,DR,DWDL,J,PRCF,PRCB,X,Y Q
"RTN","PRCBE",18,0)
 ;
"RTN","PRCBE",19,0)
 ;
"RTN","PRCBE",20,0)
EN2 ;EDIT EXISTING, UNRELEASED TRANSACTION
"RTN","PRCBE",21,0)
 S PRCF("X")="ABFS" D ^PRCFSITE Q:'%
"RTN","PRCBE",22,0)
 S DR="[PRCB NEW TRANSACTION]",DIC("A")="Select Sequence Number for "_$S($D(PRCB("MDIV")):"Station "_PRC("SITE")_",",1:"")_" FY "_PRC("FY")_": "
"RTN","PRCBE",23,0)
 D EN21 K %,PRCFEN,A,B,DA,DIC,DIE,DR,I,J,K,X,Y,PRCF,PRCB Q
"RTN","PRCBE",24,0)
EN21 W ! S DIC("S")="S ZX=^(0) I $P(ZX,U)[PRCF(""SIFY"")&($P(ZX,U,11)="""")&($P(ZX,U)'[""00000"")&(+$P(ZX,U,20)<1)&'$P(ZX,U,22)"
"RTN","PRCBE",25,0)
 S DIC=421,DIC(0)="AEQZ",D="D" D IX^DIC K DIC Q:Y<0  S DA=+Y,DIE="^PRCF(421,"
"RTN","PRCBE",26,0)
 D ^DIE S DIC("A")="Select Next Sequence Number for "_$S($D(PRCB("MDIV")):"Station "_PRC("SITE")_",",1:"")_" FY "_PRC("FY")_": "
"RTN","PRCBE",27,0)
 G EN21
"RTN","PRCBE",28,0)
 Q
"RTN","PRCBE",29,0)
 ;
"RTN","PRCBE",30,0)
EN3 ;DELETE AN UNRELEASED TRANSACTION
"RTN","PRCBE",31,0)
 S PRCF("X")="ABFS" D ^PRCFSITE Q:'%
"RTN","PRCBE",32,0)
 S DIC("A")="Select Sequence Number for "_$S($D(PRCB("MDIV")):"Station "_PRC("SITE")_",",1:"")_" FY "_PRC("FY")_": "
"RTN","PRCBE",33,0)
 D EN31 K A,B,DA,DIC,DIK,DR,I,PRCB,X,Y,PRCF Q
"RTN","PRCBE",34,0)
EN31 W ! S DIC("S")="S ZX=^(0) I $P(ZX,U)[PRCF(""SIFY""),$P(ZX,U,11)="""",$P(ZX,U)'[""00000"",+$P(ZX,U,20)=0",DIC=421,DIC(0)="AEQZ",D="D" D IX^DIC K DIC,ZX Q:Y<0  S DA=+Y,DIK="^PRCF(421,"
"RTN","PRCBE",35,0)
 S %A="ARE YOU SURE YOU WANT TO DELETE THIS TRANSACTION",%B="Enter 'YES' to delete.",%=2 D ^PRCFYN I %'=1 W "  <NOTHING DELETED>",$C(7)
"RTN","PRCBE",36,0)
 E  S PRCB("TODA")=$P(^PRCF(421,DA,0),"^",22) D ^DIK S DA=PRCB("TODA") D:DA ^DIK S X=" Transaction Deleted.*" D MSG^PRCFQ
"RTN","PRCBE",37,0)
 S %A="Do you wish to delete another transaction for "_PRCF("SIFY"),%B="" D ^PRCFYN Q:%'=1
"RTN","PRCBE",38,0)
 S DIC("A")="Select Sequence Number for "_$S($D(PRCB("MDIV")):"Station "_PRC("SITE")_",",1:"")_" FY "_PRC("FY")_": "
"RTN","PRCBE",39,0)
 G EN31
"RTN","PRCBE",40,0)
 ;
"RTN","PRCBE",41,0)
NA W !!,$C(7),"THIS OPTION IS UNDER DEVELOPMENT AND NOT YET AVAILABLE",!! H 2 Q
"RTN","PRCBE",42,0)
ERR S ^PRC(420,PRC("SITE"),1,9999,0)="9999 GRAND TOTAL",^PRC(420,PRC("SITE"),1,"B","9999 GRAND TOTAL",9999)="",^PRC(420,PRC("SITE"),1,"C","GRAND TOTAL",9999)="" Q
"RTN","PRCBE",43,0)
 ;W !,$C(7),"Control Point '9999 GRAND TOTAL' does not exist for station ",PRC("SITE"),!,"Check documentation and use the 'ADD/EDIT FUND CONTROL POINT' to establish. ",!," Further processing is terminated." R X:3 S %X=9999 Q
"RTN","PRCBE",44,0)
ENIT I '$D(^PRC(420,PRC("SITE"),1,9999)) D ERR
"RTN","PRCBE",45,0)
 S X="00000",PRCB("TRANS")=PRC("SITE")_"-"_PRC("FY")_"-"_X,X=PRCB("TRANS") K DIC("A") S DIC=421,DIC(0)="NL",DLAYGO=421 D ^DIC S DIE=DIC,DR="1////9999 GRAND TOTAL",DA=+Y
"RTN","PRCBE",46,0)
 D ^DIE S $P(^PRCF(421,DA,0),U,11)=.5
"RTN","PRCBE",47,0)
 S X=$P(^PRCF(421,DA,0),"^",16) K:X]"" ^PRCF(421,"AG",X,DA) K X S $P(^PRCF(421,DA,0),"^",16)="",$P(^(0),"^",20)=2,^(4)="1^1^1^1",^PRCF(421,"AL",PRCF("SIFY"),2,DA)="" K ^PRCF(421,"AL",PRCF("SIFY"),0,DA) Q
"RTN","PRCBE",48,0)
DOLLAR I $D(IOST),"C-PK-"[$E(IOST,1,2) S:X["$" X=$P(X,"$",2) W "   $ ",$J(X,0,2)
"RTN","PRCBE",49,0)
 Q
"RTN","PRCBP")
0^5^B34636457^B34611350
"RTN","PRCBP",1,0)
PRCBP ;WISC/CTB-PRINT OPTIONS FOR PRCB ;10/31/01 12:50pm
"RTN","PRCBP",2,0)
V ;;5.1;IFCAP;**3,43,139**;Oct 20, 2000;Build 16
"RTN","PRCBP",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCBP",4,0)
SE W !!,$C(7),"ENTRY TO THIS ROUTINE IS ONLY PERMITTED THROUGH THE APPROPRIATE",!,"MENU OR DRIVER" Q
"RTN","PRCBP",5,0)
OUT K %,%Y,DIJ,DP,IOX,IOY,POP,PRCB,PRCF,PRC("CP"),X,Y,NOLCK Q
"RTN","PRCBP",6,0)
EN1 ;PRINT RANGE OF TRANSACTIONS
"RTN","PRCBP",7,0)
 S PRCF("X")="ABFS" D ^PRCFSITE G:'% OUT
"RTN","PRCBP",8,0)
R1 S C="R1",D=1 W !,"START WITH TRANSACTION NUMBER: 1// " R X:$S($D(DTIME):DTIME,1:300) S:X="" X=1 G:X["^" OUT G:X["?"!(X'?1.5N)!(+X'=X)!(X<1)!(X>PRCB("LAST")) Q1 S FR=X K X
"RTN","PRCBP",9,0)
R2 S C="R2",D=FR R !!,"GO TO TRANSACTION NUMBER: LAST// ",X:$S($D(DTIME):DTIME,1:300) S:X="" X=PRCB("LAST") G:X["^" OUT G:X["?"!(X'?1.4N)!(+X'=X)!(X<FR)!(X>PRCB("LAST")) Q1 S TO=X
"RTN","PRCBP",10,0)
 S X="0000"_FR,X=$E(X,$L(X)-4,$L(X)),FR=PRCF("SIFY")_"-"_X S X="0000"_TO,X=$E(X,$L(X)-4,$L(X)),TO=PRCF("SIFY")_"-"_X
"RTN","PRCBP",11,0)
 D ZIS G:POP OUT S FLDS=$S(IOM<81:"[PRCB TRANS RANGE DISPLAY]",1:"[PRCB TRANS RANGE LIST]")
"RTN","PRCBP",12,0)
 S DIC="^PRCF(421,",BY="[PRCB BY TRANSACTION NUMBER]",L=0 D EN1^DIP D H G OUT
"RTN","PRCBP",13,0)
Q1 W !!,$C(7),"ENTER A NUMBER BETWEEN ",D," AND ",PRCB("LAST"),".  ('^' TO EXIT)" G @(C)
"RTN","PRCBP",14,0)
 ;
"RTN","PRCBP",15,0)
EN2 ;PRINT SELECTED CONTROL POINTS
"RTN","PRCBP",16,0)
 ;Patch 3: This section no longer calls the PRCFQ. It calls %ZTLOAD.
"RTN","PRCBP",17,0)
 S NOTSK=0,NOLCK=0,EN2Q=0,EN2P=0,RECFLG=0
"RTN","PRCBP",18,0)
 K DIC("A") S PRCF("X")="ABFS" D ^PRCFSITE G:'% OUT
"RTN","PRCBP",19,0)
 S ^XTMP("PRCBP",$J)=""
"RTN","PRCBP",20,0)
 S DIC("A")="Select FUND CONTROL POINT: "
"RTN","PRCBP",21,0)
 F ZX=1:1 D  Q:$G(Y)<0!($G(Y)="")  Q:$G(OUT)=1
"RTN","PRCBP",22,0)
 .S DIC(0)="AEQZMN",DIC="^PRC(420,PRC(""SITE""),1,"
"RTN","PRCBP",23,0)
 .D ^DIC K DIC("A")
"RTN","PRCBP",24,0)
 .Q:Y<0
"RTN","PRCBP",25,0)
 .S CP=+Y
"RTN","PRCBP",26,0)
 .D EN23
"RTN","PRCBP",27,0)
 .I X=U K ^XTMP("PRCBP",$J) S OUT=1 Q
"RTN","PRCBP",28,0)
 .I RECFLG=0 D
"RTN","PRCBP",29,0)
 ..D EOP^PRC0A(.X,.Y,"No TXN for selected STATION, FISCAL, and Fund Control Point.","AO","")
"RTN","PRCBP",30,0)
 .S DIC("A")="ANOTHER FUND CONTROL POINT: "
"RTN","PRCBP",31,0)
 K ZX
"RTN","PRCBP",32,0)
 I $G(OUT)=1 K OUT G OUT
"RTN","PRCBP",33,0)
 I X=U K ^XTMP("PRCBP",$J) G CLNUP
"RTN","PRCBP",34,0)
 I '$O(^XTMP("PRCBP",$J,"AM",0)) G CLNUP
"RTN","PRCBP",35,0)
 K IO("Q"),IOP,ZTSK,%ZIS,IOC,ZTIO
"RTN","PRCBP",36,0)
 S %ZIS="NQ",%ZIS("B")="" D ^%ZIS I POP K ^XTMP("PRCBP",$J) G CLNUP
"RTN","PRCBP",37,0)
 I '$D(IO("Q")) S CP=9999 D EN23 S EN2P=1,EN2Q=0 G EN2P
"RTN","PRCBP",38,0)
 S EN2Q=1,EN2P=0
"RTN","PRCBP",39,0)
 S ZTDESC="PRINT SELECTED CONTROL POINTS",ZTRTN="EN2Q^PRCBP"
"RTN","PRCBP",40,0)
 S ZTSAVE("PRCF*")="",ZTSAVE("PRC*")=""
"RTN","PRCBP",41,0)
 D ^%ZTLOAD D ^%ZISC
"RTN","PRCBP",42,0)
 I '$D(ZTSK) S NOTSK=1 D ERRMSG G CLNUP
"RTN","PRCBP",43,0)
 W !,"  <Request Queued> Your Task number is: ",ZTSK,$C(7),!
"RTN","PRCBP",44,0)
 S TSKNUM=ZTSK,AQ=0,NOLCK=0
"RTN","PRCBP",45,0)
 S ^XTMP("PRCBP",TSKNUM)=""
"RTN","PRCBP",46,0)
 L +^XTMP("PRCBP",TSKNUM):5
"RTN","PRCBP",47,0)
 E  S NOLCK=1 D ERRMSG G CLNUP
"RTN","PRCBP",48,0)
 F LOOP=1:1 S AQ=$O(^XTMP("PRCBP",$J,"AM",1,AQ)) Q:AQ=""  D
"RTN","PRCBP",49,0)
 .S ^XTMP("PRCBP",TSKNUM,"AQ",1,AQ)=""
"RTN","PRCBP",50,0)
 S AQ=$O(^PRCF(421,"AC",PRCF("SIFY")_"-"_9999,AQ))
"RTN","PRCBP",51,0)
 S ^XTMP("PRCBP",TSKNUM,"AQ",1,AQ)=""
"RTN","PRCBP",52,0)
 K ^XTMP("PRCBP",$J)
"RTN","PRCBP",53,0)
 L -^XTMP("PRCBP",TSKNUM)
"RTN","PRCBP",54,0)
 G CLNUP
"RTN","PRCBP",55,0)
 ;
"RTN","PRCBP",56,0)
EN2Q ;Queue the Print Task(s).
"RTN","PRCBP",57,0)
 ;
"RTN","PRCBP",58,0)
 D:$D(ZTQUEUED) KILL^%ZTLOAD
"RTN","PRCBP",59,0)
 I '$D(ZTSK) S NOTSK=1 D ERRMSG G CLNUP
"RTN","PRCBP",60,0)
 K TSKNUM S AQ=0,TSKNUM=ZTSK,NOTSK=0,NOLCK=0,EN2Q=1,EN2P=0
"RTN","PRCBP",61,0)
 G EN2P
"RTN","PRCBP",62,0)
 ;
"RTN","PRCBP",63,0)
ERRMSG ;Write the error messages.
"RTN","PRCBP",64,0)
 ;
"RTN","PRCBP",65,0)
 N DTIME S DTIME=60
"RTN","PRCBP",66,0)
 I NOTSK=1 D
"RTN","PRCBP",67,0)
 .W !,"Could not get a Task Number. Enter RETURN or '^' to exit. "
"RTN","PRCBP",68,0)
 .R !,ANS:DTIME
"RTN","PRCBP",69,0)
 ;
"RTN","PRCBP",70,0)
CLNUP ;Clean variables that no longer needed.
"RTN","PRCBP",71,0)
 ;
"RTN","PRCBP",72,0)
 D OUT
"RTN","PRCBP",73,0)
 K TSKNUM,PRC,IOP,%ZIS,IOC,ZTIO,IO("Q"),ION,IOP,RECFLG,NOTSK
"RTN","PRCBP",74,0)
 K AQ,LOOP,DIC,L,BY,FLDS,CP,ANS,I,N,EN2P,EN2Q,NOLCK,AM
"RTN","PRCBP",75,0)
 K ZTDESC,ZTQUEUED,ZTRTN,ZTSAVE("PRC*"),ZTSAVE("PRCF*")
"RTN","PRCBP",76,0)
 Q
"RTN","PRCBP",77,0)
 ;
"RTN","PRCBP",78,0)
EN2P ;Print the Task(s).
"RTN","PRCBP",79,0)
 ;
"RTN","PRCBP",80,0)
 D:$D(ZTQUEUED) KILL^%ZTLOAD
"RTN","PRCBP",81,0)
 S AM=0,AQ=0
"RTN","PRCBP",82,0)
 S FLDS=$S(IOM<81:"[PRCB FCP DISPLAY]",1:"[PRCB FCP LIST]")
"RTN","PRCBP",83,0)
 S DIC="^PRCF(421,",BY="[PRCB BY SEARCH/FCP/TRANS]"
"RTN","PRCBP",84,0)
 S L=0,IOP=ION
"RTN","PRCBP",85,0)
 I EN2P  D
"RTN","PRCBP",86,0)
 .F LOOP=1:1 S AM=$O(^XTMP("PRCBP",$J,"AM",1,AM)) Q:AM=""  D
"RTN","PRCBP",87,0)
 ..S ^PRCF(421,"AM",1,AM)=""
"RTN","PRCBP",88,0)
 .K ^XTMP("PRCBP",$J)
"RTN","PRCBP",89,0)
 I EN2Q  D
"RTN","PRCBP",90,0)
 .F LOOP=1:1 S AQ=$O(^XTMP("PRCBP",TSKNUM,"AQ",1,AQ)) Q:AQ=""  D
"RTN","PRCBP",91,0)
 ..S ^PRCF(421,"AM",1,AQ)=""
"RTN","PRCBP",92,0)
 .K ^XTMP("PRCBP",TSKNUM)
"RTN","PRCBP",93,0)
 D EN1^DIP
"RTN","PRCBP",94,0)
 K ^PRCF(421,"AM")
"RTN","PRCBP",95,0)
 G CLNUP
"RTN","PRCBP",96,0)
 ;
"RTN","PRCBP",97,0)
EN23 ;Setup the temp file with selected records (FCP).
"RTN","PRCBP",98,0)
 ;
"RTN","PRCBP",99,0)
 S N=0,RECFLG=0
"RTN","PRCBP",100,0)
 F I=1:1 S N=$O(^PRCF(421,"AC",PRCF("SIFY")_"-"_CP,N)) Q:N=""  D
"RTN","PRCBP",101,0)
 .S RECFLG=1
"RTN","PRCBP",102,0)
 .S ^XTMP("PRCBP",$J,"AM",1,N)=""
"RTN","PRCBP",103,0)
 .S $P(^PRCF(421,N,2),"^",14)=1
"RTN","PRCBP",104,0)
 .W:CP'=9999 "."
"RTN","PRCBP",105,0)
 Q
"RTN","PRCBP",106,0)
EN3 ;PRINT BY TDA NUMBER
"RTN","PRCBP",107,0)
 S PRCF("X")="ABFS" D ^PRCFSITE G:'% OUT
"RTN","PRCBP",108,0)
 S FR=$O(^PRCF(421,"B",PRCF("SIFY")_"-00000")) I FR="" W !,"NO TRANSACTIONS IN FY ",PRC("FY") R X:2 G OUT
"RTN","PRCBP",109,0)
Q31 D DD^PRC0A(.X,.Y,"Beginning TDA Number","421,3O",1)
"RTN","PRCBP",110,0)
 G EN3:Y=""!(Y["^")
"RTN","PRCBP",111,0)
 S PRCA=Y
"RTN","PRCBP",112,0)
Q32 D DD^PRC0A(.X,.Y,"Ending TDA Number","421,3O",9999)
"RTN","PRCBP",113,0)
 G EN3:Y["^",Q31:Y=""
"RTN","PRCBP",114,0)
 I PRCA]Y D EN^DDIOL("Beginning/Ending TDA numbers are not in order") G Q32
"RTN","PRCBP",115,0)
 S PRCB=Y
"RTN","PRCBP",116,0)
 S FR=PRCF("SIFY")_","_PRCA,TO=PRCF("SIFY")_","_PRCB
"RTN","PRCBP",117,0)
 S ZTDESC="PRINT TDA LISTING",ZTRTN="EN1Q^PRCBP",ZTSAVE("PRC*")="",ZTSAVE("PRCF*")="",ZTSAVE("FR")="",ZTSAVE("TO")="" D ^PRCFQ,H,OUT Q
"RTN","PRCBP",118,0)
EN1Q S IOP=ION,FLDS=$S(IOM<81:"[PRCB TDA DISPLAY]",1:"[PRCB TDA LIST]")
"RTN","PRCBP",119,0)
 ;S DIC="^PRCF(421,",BY="[PRCB BY TRANS/TDA]",L=0 D EN1^DIP,H,OUT
"RTN","PRCBP",120,0)
 S DIC="^PRCF(421,",BY="]@.5,3",L=0 D EN1^DIP,H,OUT
"RTN","PRCBP",121,0)
 Q
"RTN","PRCBP",122,0)
EN4 ;FTEE SUMMARY BY PROGRAM
"RTN","PRCBP",123,0)
 S PRCF("X")="ABFS" D ^PRCFSITE G:'% OUT S L=0,DIC="^PRCF(421,",BY="[PRCB BY APPROP/TDA]",FR=PRCF("SIFY"),TO=PRCF("SIFY")_"Z",FLDS="[PRCB FTEE SUMMARY]" D EN1^DIP,OUT Q
"RTN","PRCBP",124,0)
EN5 ;APPROPRIATION SUMMARY (DETAIL)
"RTN","PRCBP",125,0)
 S PRCF("X")="ABFS" D ^PRCFSITE G:'% OUT
"RTN","PRCBP",126,0)
 S ZTDESC="APPROPRIATION SUMMARY (DETAIL)",ZTRTN="EN5Q^PRCBP",ZTSAVE("PRC*")="",ZTSAVE("PRCF*")="" D ^PRCFQ,OUT Q
"RTN","PRCBP",127,0)
EN5Q S FLDS=$S(IOM<81:"[PRCB DISPLAY APP SUM DETAIL]",1:"[PRCB APPROP SUM  DETAIL]")
"RTN","PRCBP",128,0)
 S IOP=ION,L=0,DIC="^PRCF(421,",BY="[PRCB BY APP/FCP]",FR=PRCF("SIFY"),TO=PRCF("SIFY") D EN1^DIP,OUT Q
"RTN","PRCBP",129,0)
EN6 ;APPROPTIATION SUMMARY (TOTALS)
"RTN","PRCBP",130,0)
 S PRCF("X")="ABFS" D ^PRCFSITE G:'% OUT
"RTN","PRCBP",131,0)
 S ZTDESC="APPROPRIATION SUMMARY (TOTALS)",ZTRTN="EN6Q^PRCBP",ZTSAVE("PRC*")="",ZTSAVE("PRCF*")="" D ^PRCFQ,OUT Q
"RTN","PRCBP",132,0)
EN6Q S IOP=PRIOP,L=0,DIC="^PRCF(421,",BY="[PRCB BY APP/FCP]",FR=PRCF("SIFY"),TO=PRCF("SIFY"),FLDS="[PRCB APPROP SUM  TOTAL]" D EN1^DIP,OUT Q
"RTN","PRCBP",133,0)
H I $D(IO(0)),IO=IO(0),$D(IOST),IOST["C-" W !,"PRESS RETURN TO CONTINUE",$C(7) R X:$S($D(DTIME):DTIME,1:300)
"RTN","PRCBP",134,0)
 Q
"RTN","PRCBP",135,0)
ZIS K DQTIME,IOP S %ZIS="QN" D ^%ZIS Q:POP  S IOP=ION I IO'=IO(0) S %ZIS="Q",IOP="Q;"_ION
"RTN","PRCBR")
0^4^B31050343^B27230799
"RTN","PRCBR",1,0)
PRCBR ;WISC@ALTOONA/CLH/CTB-ROUTINE TO RELEASE FUND DISTRIBUTION TRANSACTIONS ; 10 Apr 93  3:50 PM
"RTN","PRCBR",2,0)
V ;;5.1;IFCAP;**139**;Oct 20, 2000;Build 16
"RTN","PRCBR",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCBR",4,0)
 N X,DIR,DIC,DR,DIE,DIK,PRC,PRCF,PRCB,PRCFA,%,Y,Z,Z1,Q,J,K,D,Y,FAIL
"RTN","PRCBR",5,0)
 S X="BUDGET RELEASE" D ^PRCFALCK I '% G KILL
"RTN","PRCBR",6,0)
 S PRCF("X")="ABFS" D ^PRCFSITE G:'% OUT
"RTN","PRCBR",7,0)
 S X=$O(^PRCF(421,"AL",PRCF("SIFY"),"")) I X'=0&(X'=1) W !!,$C(7),"There are no PENDING RELEASE transactions for FY: ",PRC("FY") R X:3 G OUT
"RTN","PRCBR",8,0)
 S K=0 I '$D(^PRC(420,PRC("SITE"),2,DUZ)) W !,"You are not authorized to release funds for station ",PRC("SITE"),",",!,"PLEASE CONTACT YOUR APPLICATION MANAGER.",$C(7) R X:3 G OUT
"RTN","PRCBR",9,0)
 D SIG^PRCFACX0 K PRCFK I $D(PRCFA("SIGFAIL")) K PRCFA("SIGFAIL") G OUT
"RTN","PRCBR",10,0)
 N DIR,Y,X
"RTN","PRCBR",11,0)
 S PRCB("CK")="" S DIR(0)="YO",DIR("A")="Do you wish to review/edit any transactions",DIR("B")="NO",DIR("?")="Enter yes to review/edit a transaction, '^' to quit" D ^DIR G:Y["^" OUT
"RTN","PRCBR",12,0)
 I Y D
"RTN","PRCBR",13,0)
  . S DR="[PRCB NEW TRANSACTION]",DIC("A")="Select Sequence Number for "_$S($D(PRCB("MDIV")):"Station "_PRC("SITE")_",",1:"")_" FY "_PRC("FY")_": "
"RTN","PRCBR",14,0)
  . S Z="",PRCFLAST=PRCB("LAST") D EN21^PRCBE S PRCB("LAST")=PRCFLAST K PRCFLAST I '$D(PRCF("SIFY")) S PRCF("SIFY")=PRC("SITE")_"-"_PRC("FY")
"RTN","PRCBR",15,0)
ASK R !,"Enter Sequence Number of Transaction(s) to be Released: ",X:DTIME G:X["?" Q1 G:X["^" OUT G:X="ALL" ALL G:X["-" DASH G:X="" UNDO I X'?1.N W $C(7),"  ??" G ASK
"RTN","PRCBR",16,0)
 S (Z,X1)=X D ZERO S X1=Z I '$D(^PRCF(421,"B",PRCF("SIFY")_"-"_X1)) W $C(7),!,"  ??" G Q1A
"RTN","PRCBR",17,0)
 S DA=$O(^PRCF(421,"B",PRCF("SIFY")_"-"_X1,0)) I $D(^PRCF(421,"AL",PRCF("SIFY"),2,DA)) W $C(7),!,"  THIS SEQUENCE HAS ALREADY BEEN RELEASED.  RERELEASE IS NOT PERMITTED." G Q1A
"RTN","PRCBR",18,0)
 I $D(^PRCF(421,"AL",PRCF("SIFY"),1,DA)) W !,$C(7),"THIS TRANSACTION HAS ALREADY BEEN SELECTED FOR RELEASE.  NO ACTION TAKEN." H 2 K PRCB("CK") G ASK
"RTN","PRCBR",19,0)
 W "  OK" K PRCB("CK") D ONE
"RTN","PRCBR",20,0)
 G ASK
"RTN","PRCBR",21,0)
UNDO I '$D(^PRCF(421,"AL",PRCF("SIFY"),1)) W !!,$C(7),"No transactions have been selected for releasing for FY: ",PRC("FY") G ASK
"RTN","PRCBR",22,0)
 W !!,"To not release a transaction already selected to be released"
"RTN","PRCBR",23,0)
 S DIC("A")="Enter the last 5 digits of the transaction for "_$S($D(PRCB("MDIV")):"Station "_PRC("SITE")_",",1:"")_" FY "_PRC("FY")_": "
"RTN","PRCBR",24,0)
 S DIC("S")="S ZX=^(0) I $P(ZX,U)[PRCF(""SIFY"")&($P(ZX,U,11)="""")&($P(ZX,U)'[""00000"")&(+$P(ZX,U,20)=1)",DIC=421,DIC(0)="AEQZ",D="D" D IX^DIC K DIC G:Y<0 DEV S DA=+Y
"RTN","PRCBR",25,0)
 D UNREL(DA)
"RTN","PRCBR",26,0)
 ;if transfer fund
"RTN","PRCBR",27,0)
 I $P(^PRCF(421,DA,0),"^",22) D UNREL($P(^(0),"^",22))
"RTN","PRCBR",28,0)
 G UNDO
"RTN","PRCBR",29,0)
 ;
"RTN","PRCBR",30,0)
UNREL(DA) I $D(^PRCF(421,"AL",PRCF("SIFY"),1,DA)),'$D(^PRCF(421,"AL",PRCF("SIFY"),2,DA)) S DIE="^PRCF(421,",DR="11.5////^S X=0" D ^DIE K ^PRCF(421,"AL",PRCF("SIFY"),1,DA)
"RTN","PRCBR",31,0)
 QUIT
"RTN","PRCBR",32,0)
DEV ;ask device
"RTN","PRCBR",33,0)
 G QDEV^PRCBR2
"RTN","PRCBR",34,0)
Q1 F I=1:1 Q:$P($T(X+I),";",3,99)=""  W !,$P($T(X+I),";",3,99)
"RTN","PRCBR",35,0)
 S DIR(0)="Y",DIR("A")="Do you wish to see the list of all unreleased transactions",DIR("?")="Enter yes to look at list, no or '^' to quit" D ^DIR G:'Y ASK
"RTN","PRCBR",36,0)
Q1A W !!,"Unreleased Sequence Numbers for Station ",PRC("SITE"),", FY: ",PRC("FY"),! F I=0,40 W ?I," SEQ #     TRANS #     CP#    TOTAL"
"RTN","PRCBR",37,0)
 W ! S N=0 F I=0:1 S N=$O(^PRCF(421,"AL",PRCF("SIFY"),0,N)) Q:'N  D
"RTN","PRCBR",38,0)
  . S X1="",X=^PRCF(421,N,0) F J=7:1:10 S X1=X1+$P(X,"^",J)
"RTN","PRCBR",39,0)
  . W:'(I#2)*I ! W ?I#2*40,$J(+$P(X,"-",3),4,0),"    ",$P(X,"^"),"  CP-",+$P(X,"^",2),"  $",$J(X1,0,2) K X1,X,J
"RTN","PRCBR",40,0)
  . Q
"RTN","PRCBR",41,0)
 G ASK
"RTN","PRCBR",42,0)
X ;;
"RTN","PRCBR",43,0)
 ;;Enter the Sequence Number, or indicate a range of sequence numbers by
"RTN","PRCBR",44,0)
 ;;separating the first and last numbers with a dash (-).
"RTN","PRCBR",45,0)
 ;;Type "ALL" to release all unreleased transactions.
"RTN","PRCBR",46,0)
 ;;
"RTN","PRCBR",47,0)
ALL ;TRANSFER ALL TRANSACTIONS INTO ^TMP
"RTN","PRCBR",48,0)
 S DA=0 F I=1:1 S DA=$O(^PRCF(421,"AL",PRCF("SIFY"),0,DA)) Q:DA=""  D ONE
"RTN","PRCBR",49,0)
 G UNDO
"RTN","PRCBR",50,0)
ONE ;mark release status
"RTN","PRCBR",51,0)
 QUIT:$$FCPVAL^PRCBR2(DA)
"RTN","PRCBR",52,0)
 D REL(DA)
"RTN","PRCBR",53,0)
 ;if transfer fund
"RTN","PRCBR",54,0)
 I $P(^PRCF(421,DA,0),"^",22) D REL($P(^(0),"^",22))
"RTN","PRCBR",55,0)
 QUIT
"RTN","PRCBR",56,0)
 ;
"RTN","PRCBR",57,0)
REL(DA) I '$D(^PRCF(421,"AL",PRCF("SIFY"),1,DA)),'$D(^PRCF(421,"AL",PRCF("SIFY"),2,DA)) S DIE="^PRCF(421,",DR="11.5////^S X=1" D ^DIE K ^PRCF(421,"AL",PRCF("SIFY"),0,DA)
"RTN","PRCBR",58,0)
 QUIT
"RTN","PRCBR",59,0)
 ;
"RTN","PRCBR",60,0)
DASH ;release all transactions within a range of sequence numbers
"RTN","PRCBR",61,0)
 I X'?.N1"-".N W !,"Incorrect format. ",$C(7) G ASK
"RTN","PRCBR",62,0)
 S X1=+$P(X,"-",2),X=+$P(X,"-",1) I X'<X1 W !,"Illogical range, the first number is not less than the second.",$C(7),! G ASK
"RTN","PRCBR",63,0)
 I X>PRCB("LAST") W !,"First number in range is greater than highest defined sequence number in file, try again.",$C(7),! G ASK
"RTN","PRCBR",64,0)
 I X1>PRCB("LAST") S X1=PRCB("LAST") W !,"Second number in range greater than highest defined number, changing to highest number allowed: ",X1,$C(7)
"RTN","PRCBR",65,0)
 S PRCB("NUM")=0 S Q=X-1,Q1=X1-1 S Z=Q D ZERO S Q=Z,Z=Q1 D ZERO S Q1=Z,PRCB("LO")=$O(^PRCF(421,"B",PRCF("SIFY")_"-"_Q)) I PRCB("LO")="" W !,"No sequence numbers on file in range, try again.",$C(7),! G ASK
"RTN","PRCBR",66,0)
 S PRCB("LO")=$O(^PRCF(421,"B",PRCB("LO"),0)) I PRCB("LO")="" W !,"No sequence numbers in range specified. Please check your numbers and let's try again.",$C(7),! G ASK
"RTN","PRCBR",67,0)
D1 S PRCB("HI")=$O(^PRCF(421,"B",PRCF("SIFY")_"-"_Q1))
"RTN","PRCBR",68,0)
 S PRCB("HI")=$O(^PRCF(421,"B",PRCB("HI"),0))
"RTN","PRCBR",69,0)
 S DA=PRCB("LO")-.5 F I=0:0 S DA=$O(^PRCF(421,"AL",PRCF("SIFY"),0,DA)) Q:DA=""!(DA>PRCB("HI"))  D ONE
"RTN","PRCBR",70,0)
 W "   DONE" K PRCB("CK") G ASK
"RTN","PRCBR",71,0)
ZERO ;place up to 4 leading zeros onto a number
"RTN","PRCBR",72,0)
 S Z="0000"_Z,Z=$E(Z,$L(Z)-4,$L(Z)) Q
"RTN","PRCBR",73,0)
 ;
"RTN","PRCBR",74,0)
OUT S X="BUDGET RELEASE" D UNLOCK^PRCFALCK
"RTN","PRCBR",75,0)
KILL K DIRUT,DTOUT,DIROUT,DUOUT Q
"RTN","PRCBR1")
0^8^B21660865^B21541456
"RTN","PRCBR1",1,0)
PRCBR1 ;WISC@ALTOONA/CTB-ROUTINE TO RELEASE TRANSACTIONS FROM FUND DISTRIBUTION FILE ; 01/31/94  4:06 PM
"RTN","PRCBR1",2,0)
V ;;5.1;IFCAP;**139**;Oct 20, 2000;Build 16
"RTN","PRCBR1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCBR1",4,0)
SE ;DIRECT ENTRY POINT, UN QUEUED
"RTN","PRCBR1",5,0)
 I $D(ZTQUEUED) D KILL^%ZTLOAD
"RTN","PRCBR1",6,0)
 S X="BUDGET RELEASE" D ^PRCFALCK I '% D REQUE Q
"RTN","PRCBR1",7,0)
SE1 D NOW^%DTC S DT=X S:'$D(PRCFTIME) PRCFTIME=%
"RTN","PRCBR1",8,0)
 D DUZ^PRCFSITE G:'% OUT
"RTN","PRCBR1",9,0)
 I '$D(^PRCF(421,"AL",PRCF("SIFY"),1)) W !!,"FUND DISTRIBUTION RELEASE ABORTED.  NO TRANSACTIONS FOUND FOR STATION NUMBER "_PRC("SITE")_"." G OUT
"RTN","PRCBR1",10,0)
 W:$D(IOF) @IOF W "Beginning transaction release...",!!
"RTN","PRCBR1",11,0)
C S U="^" K ^PRCF(421,"AI",1),^TMP("PRCB",$J,"CP",2) S DA=0
"RTN","PRCBR1",12,0)
 F ZI=1:1 S DA=$O(^PRCF(421,"AL",PRCF("SIFY"),1,DA)) Q:'DA  Q:'$D(^PRCF(421,DA,0))  S PRCB("TRDA")=DA,TRDA(0)=^PRCF(421,DA,0) Q:$P(TRDA(0),"-",1,2)'=PRCF("SIFY")  D A Q:$D(PRCFA("QUIT"))
"RTN","PRCBR1",13,0)
 G:$D(PRCFA("QUIT")) OUT S PRCB("CP")=9999 D LOAD
"RTN","PRCBR1",14,0)
OUT K ^TMP("PRCB",$J,"CP"),%,%D,%H,%I,%M,%X,%Y,BY,C,DA,DHD,DIC,DLAYGO,FLDS,G,I,IOP,J,K,J,M,N,NOW,P,PRCF,PRCFA,PRCB,PRSAL,PRCFTIME,T,X,Y,Z,ZI
"RTN","PRCBR1",15,0)
 D EN^DDIOL("End of Released Transactions List **************")
"RTN","PRCBR1",16,0)
 S X="BUDGET RELEASE" D UNLOCK^PRCFALCK Q
"RTN","PRCBR1",17,0)
REQUE I '$D(ZTQUEUED) W !!,$C(7),"Try releasing at a later time." Q
"RTN","PRCBR1",18,0)
 S ZTIO=$S($D(PRCFA("NOPRINT")):"@",1:IO) D REQ^%ZTLOAD
"RTN","PRCBR1",19,0)
 Q
"RTN","PRCBR1",20,0)
A ;PROCEDURE TO DETERMINE IF CONTROL POINT IS AUTOMATED  D B IF IT IS, A1 IF ITIS NOT
"RTN","PRCBR1",21,0)
 S PRCB("CK")=0,PRCB("CP")=+($P(TRDA(0),U,2)),PRC("SITE")=+TRDA(0),PRC("FY")=$P(TRDA(0),"-",2)
"RTN","PRCBR1",22,0)
 I $D(^PRC(420,PRC("SITE"),1,PRCB("CP"),0)),$P(^(0),U,11)["Y" D B Q:$D(PRCFA("QUIT"))  D:PRCB("CK")'=1 REL Q
"RTN","PRCBR1",23,0)
 D LOAD
"RTN","PRCBR1",24,0)
 S DA=PRCB("TRDA")
"RTN","PRCBR1",25,0)
 S MESSAGE=""
"RTN","PRCBR1",26,0)
 D ENCODE^PRCBES1(DA,DUZ,.MESSAGE)
"RTN","PRCBR1",27,0)
 K MESSAGE
"RTN","PRCBR1",28,0)
 D REL
"RTN","PRCBR1",29,0)
 Q
"RTN","PRCBR1",30,0)
LOAD ;LOAD ALL TRANSACTIONS FOR A SPECIFIC CONTROL POINT INTO THE 'ON PRINT LIST FIELD AND CROSS REFERENCE
"RTN","PRCBR1",31,0)
 I '$D(^TMP("PRCB",$J,"CP",2,PRCB("CP"))) S ^TMP("PRCB",$J,"CP",2,PRCB("CP"))="",M=0 F J=1:1 S M=$O(^PRCF(421,"AC",PRCF("SIFY")_"-"_PRCB("CP"),M)) Q:M=""  S ^PRCF(421,"AI",1,M)="",$P(^PRCF(421,M,2),"^",13)=1
"RTN","PRCBR1",32,0)
 Q
"RTN","PRCBR1",33,0)
B ;RELEASE INDIVIDUAL SEQUENCE NUMBER
"RTN","PRCBR1",34,0)
 D LOAD S PRCFC(1)=+TRDA(0),PRCFC=$P(TRDA(0),U,2),PRCFC(2)=$P(PRCFC," ",1),PRCFC(3)=$P(TRDA(0),U,6),PRC("BBFY")=$P(TRDA(0),"^",23)
"RTN","PRCBR1",35,0)
 S I=PRCFC(2)_"^"_PRC("FY")_"^"_PRC("BBFY"),PRC("APP")=$P($$ACC^PRC0C(PRC("SITE"),I),"^",11)
"RTN","PRCBR1",36,0)
 S PRCFC(8)=PRC("APP"),PRCFC(9)=$P($P(TRDA(0),U,1),"-",3) F I=1:1:4 S PRCFC(I+3)=$P(TRDA(0),U,I+6)
"RTN","PRCBR1",37,0)
 F PRCFK=1:1:4 I PRCFC(PRCFK+3)'="",$P($G(^PRCF(421,PRCB("TRDA"),4)),U,PRCFK+6)="" S Z=PRC("SITE")_"-"_PRC("FY")_"-"_PRCFK_"-"_PRCFC(2),X=$P(Z,"-",1,2)_"-"_PRCFC(2),PRCB("CK")=1 D EN1 Q:$D(PRCFA("QUIT"))
"RTN","PRCBR1",38,0)
 K PRCFK,PRCFC Q
"RTN","PRCBR1",39,0)
REL ;KILL NON RELEASE INDICATOR, ENCODE RELEASER AND MARK TRANSACTION
"RTN","PRCBR1",40,0)
 S DA=PRCB("TRDA") K PRCB("CK"),^PRCF(421,"AL",PRCF("SIFY"),1,DA) S ^PRCF(421,"AL",PRCF("SIFY"),2,DA)="",$P(^PRCF(421,DA,0),"^",20)=2
"RTN","PRCBR1",41,0)
 S $P(^PRCF(421,DA,0),"^",18)=DT
"RTN","PRCBR1",42,0)
 S MESSAGE=""
"RTN","PRCBR1",43,0)
 D ENCODE^PRCBES1(DA,DUZ,.MESSAGE)
"RTN","PRCBR1",44,0)
 K MESSAGE
"RTN","PRCBR1",45,0)
 D ^PRCBBUL
"RTN","PRCBR1",46,0)
 W !,"Trans #: ",$P(^PRCF(421,DA,0),U),?22,"FCP: ",$E($P(^PRC(420,PRC("SITE"),1,PRCB("CP"),0),U),1,15)
"RTN","PRCBR1",47,0)
 F II=1:1:4 I $P(^PRCF(421,DA,0),U,II+6)]"" W ?44,"QTR: ",II,$P("ST,ND,RD,TH",",",II),?53,"AMT: ",$J($P(^(0),U,II+6),12,2)," Released.",!
"RTN","PRCBR1",48,0)
 Q
"RTN","PRCBR1",49,0)
EN1 D EN1^PRCSUT3 G:'X W4 S X1=X
"RTN","PRCBR1",50,0)
EN2 S DLAYGO=410,DIC=410,DIC(0)="MXLZ" D ^DIC G:Y<0 W5 S DA=+Y S $P(^PRCF(421,PRCB("TRDA"),4),U,PRCFK+6)=DA
"RTN","PRCBR1",51,0)
 S ^PRCS(410,DA,0)=^PRCS(410,DA,0)_"^C^^^"_PRCFC(1),^(4)="^^"_PRCFC(PRCFK+3)_"^"_$P($$DATE^PRC0C("T","E"),"^",7)_"^^^^"_PRCFC(PRCFK+3),^(6)=PRCFC(PRCFK+3)_U_PRCFC(3)_U_PRCFC(9),^(3)=PRCFC_U_PRCFC(8)
"RTN","PRCBR1",52,0)
 S ^PRCS(410,"AN",$E(PRCFC,1,30),DA)=""
"RTN","PRCBR1",53,0)
 S U="^"
"RTN","PRCBR1",54,0)
 S PRCF(7)=U_U_U_$P(PRC("PER"),U,3)_U_$P(PRCFTIME,".")_U_U_PRCFTIME
"RTN","PRCBR1",55,0)
 S ^PRCS(410,DA,7)=PRCF(7)
"RTN","PRCBR1",56,0)
 K PRCF(7)
"RTN","PRCBR1",57,0)
 S MESSAGE=""
"RTN","PRCBR1",58,0)
 D ENCODE^PRCSC1(DA,DUZ,.MESSAGE)
"RTN","PRCBR1",59,0)
 K MESSAGE
"RTN","PRCBR1",60,0)
 S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),PRCB("CP"),1)
"RTN","PRCBR1",61,0)
 D EDIT^PRC0B(.X,"410;^PRCS(410,;"_DA,"28.5///^S X="_PRC("BBFY"),"LS")
"RTN","PRCBR1",62,0)
 D ERS410^PRC0G(DA_"^"_"O")
"RTN","PRCBR1",63,0)
 S PRCHOBL=1,X=PRCFC(PRCFK+3) D TRANS1^PRCSES K PRCHOBL
"RTN","PRCBR1",64,0)
 S %X="^PRCF(421,"_PRCB("TRDA")_",1,",%Y="^PRCS(410,DA,""CO""," D %XY^%RCR S PRCB("CK")=2 Q
"RTN","PRCBR1",65,0)
W4 W !!,"UNABLE TO MAKE ENTRY ",X," IN FILE 410.1, FURTHER PROCESSING TERMINATED.  CONTACT YOUR SITE MANAGER." S PRCFA("QUIT")="" R X:2 Q
"RTN","PRCBR1",66,0)
W5 W !!,"UNABLE TO MAKE ENTRY ",X," IN FILE 410, FURTHER PROCESSING TERMINATED. CONTACT YOUR SITE MANAGER." S PRCFA("QUIT")="" R X:2 Q
"RTN","PRCBR1",67,0)
LOCK ;LOCK GLOBAL THAT IS BEING ACCESSED BY ANOTHER USER
"RTN","PRCBR1",68,0)
 L +@(DIC_DA_")"):$G(DILOCKTM:3) S PRSAL=$T Q:PRSAL'=0  I PRSAL=0 W !!,$C(7),"THIS ENTRY IS BEING EDITED BY ANOTHER USER.  TRY LATER." Q
"RTN","PRCFSITE")
0^6^B17115209^B17108078
"RTN","PRCFSITE",1,0)
PRCFSITE ;WISC/CTB/CLH/DL-RETURNS PRC* VARIABLES ; 1/29/98  1315
"RTN","PRCFSITE",2,0)
V ;;5.1;IFCAP;**139**;Oct 20, 2000;Build 16
"RTN","PRCFSITE",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCFSITE",4,0)
DIVFY ;CHECK FOR STATION AND FY
"RTN","PRCFSITE",5,0)
 D DUZ G:'% Q
"RTN","PRCFSITE",6,0)
 I $D(PRC("FY")),PRC("FY")'?2N K PRC("FY")
"RTN","PRCFSITE",7,0)
 I '$D(DT) D NOW^%DTC S DT=X K %,%H,%I,X
"RTN","PRCFSITE",8,0)
 W ! I '$D(^PRC(411,0)) W "SITE PARAMETERS HAVE NOT YET BEEN ESTABLISHED, NO FURTHER PROCESSING CAN OCCUR",$C(7) G Q
"RTN","PRCFSITE",9,0)
 S U="^",B=^PRC(411,0) I +$P(B,U,4)<1 W !,"NO ENTRIES FOUND IN SITE PARAMETER FILE",$C(7) G Q
"RTN","PRCFSITE",10,0)
 I $D(%F) S PRCF("X")=%F
"RTN","PRCFSITE",11,0)
 S %=1 K PRC("SP") I '$D(PRCF("X")) S PRCF("X")="AFS"
"RTN","PRCFSITE",12,0)
 S:$G(^VA(200,+PRC("PER"),400))]"" PRC("SP")=1
"RTN","PRCFSITE",13,0)
 I $P(B,U,4)>1 S PRC("MDIV")="" S:PRCF("X")["B" PRC("MDIV")=""
"RTN","PRCFSITE",14,0)
 I '$D(PRC("SITE")),PRCF("X")["S"!(PRCF("X")["B") S PRC("SITE")=$S($O(^PRC(411,"AC","Y",0)):$O(^PRC(411,"AC","Y",0)),1:$O(^PRC(411,0)))
"RTN","PRCFSITE",15,0)
 I '$D(PRC("FY")) S %DT="",X="T" D ^%DT S A=$E(Y,2,3),B=$E(Y,4,5),PRC("FY")=$E(100+$S(+B>9:A+1,1:A),2,3),PRC("QTR")=$S(B<4:2,B<7:3,B<10:4,1:1) S X=""
"RTN","PRCFSITE",16,0)
 K PRC("FU") I PRCF("X")["A",'$G(PRC("SP")) D AFU^PRCFSI1 G:$G(PRC("FU")) Q
"RTN","PRCFSITE",17,0)
 I '$D(PRC("MDIV")) S PRC("SITE")=$O(^PRC(411,0))
"RTN","PRCFSITE",18,0)
SI I $D(PRC("MDIV")),PRCF("X")["S"!(PRCF("X")["B") W ! S DIC("A")="Select STATION NUMBER ('^' TO EXIT): ",DIC("B")=PRC("SITE"),DIC=411,DIC(0)="AEQMZ",DIC("S")="I +Y<1000000" D ^DIC K DIC G:+Y<0 Q S PRC("SITE")=+Y
"RTN","PRCFSITE",19,0)
 I PRCF("X")["A",'$G(PRC("SP")) D AFU1^PRCFSI1 G:$G(PRC("FU")) Q
"RTN","PRCFSITE",20,0)
FY K X I PRCF("X")["F"!(PRCF("X")["B") W !,"Select FISCAL YEAR ('^' to EXIT): ",PRC("FY"),"// " R X:$S($D(DTIME):DTIME,1:60) G:X["^" Q I (X["?")!(X'?2N&(X'="")) W $C(7) D HELP1 G FY
"RTN","PRCFSITE",21,0)
 S:'$D(X) X="" I X="" S X=PRC("FY")
"RTN","PRCFSITE",22,0)
 E  S PRC("FY")=X
"RTN","PRCFSITE",23,0)
QTR G:PRCF("X")'["Q" SE1 W !,"Select FISCAL QUARTER: "_$S($D(PRC("QTR")):PRC("QTR")_"// ",1:"") R X:$S($D(DTIME):DTIME,1:50)
"RTN","PRCFSITE",24,0)
 G:'$T!(X["^") Q I $L(X)>1!("1234"'[X) W !,$C(7),"Enter a number between 1 and 4 ONLY." G QTR
"RTN","PRCFSITE",25,0)
 I X]"" S PRC("QTR")=X
"RTN","PRCFSITE",26,0)
SE1 S X="" S:$D(PRC("SITE")) PRC("PARAM")=^PRC(411,PRC("SITE"),0)
"RTN","PRCFSITE",27,0)
ISMS I $D(PRCFASYS),$D(PRC("SITE")) S:$$ISMSFLAG^PRCPUX2(PRC("SITE"))=2 PRCFASYS=PRCFASYS_"ISM"
"RTN","PRCFSITE",28,0)
 I PRCF("X")["B" S PRCF("SIFY")=PRC("SITE")_"-"_PRC("FY"),PRCB("LAST")=100000-($O(^PRCF(421,"AD",PRCF("SIFY"),0)))
"RTN","PRCFSITE",29,0)
OUT S %=1 K %DT,DIC,PRC("SP"),PRC("MDIV"),PRC("L"),PRC("I"),PRCF("X"),%F,A,B,X,Y Q
"RTN","PRCFSITE",30,0)
FYQ ;RETURNS FY AND QTR GIVEN IN FILEMANAGER DATE IN 'X'
"RTN","PRCFSITE",31,0)
 G:'$D(X) Q G:X=""!($E(X,1,7)'?7N)!(+$E(X,1,7)'=$E(X,1,7)) Q S Y=$E(X,2,3),Y(1)=$E(X,4,5),PRC("FY")=$E(100+$S(+Y(1)>9:Y+1,1:Y),2,3),PRC("QTR")=$S(Y(1)<4:2,Y(1)<7:3,Y(1)<10:4,1:1) K Y S %=1 Q
"RTN","PRCFSITE",32,0)
Q K PRC,PRCF("X"),PRCB,%DT,DIC,%F,A,B,X,Y S %=0 Q
"RTN","PRCFSITE",33,0)
HELP1 W !,"ENTER LAST TWO DIGITS OF FISCAL YEAR, OR <CR> TO ACCEPT PROMPT" Q
"RTN","PRCFSITE",34,0)
A S %X=$P(^VA(200,+PRC("PER"),0),"^"),%X=$P(%X,",",2)_" "_$P(%X,",")_$P(%X,",",3),$P(^VA(200,+PRC("PER"),20),"^",2)=%X,X=%X K %X Q
"RTN","PRCFSITE",35,0)
DUZ K PRCFDEL,PRC("PER") S %=1 I $D(DUZ)#2,+DUZ>0 S PRC("PER")=+DUZ
"RTN","PRCFSITE",36,0)
 I '$D(PRC("PER")) S %=0 W !,$C(7),"YOU ARE NOT IN THE 'NEW PERSON' FILE.  CONTACT YOUR SITE MANAGER",! Q
"RTN","PRCFSITE",37,0)
 K X S X=$S('$D(^VA(200,+PRC("PER"),20)):"",1:^VA(200,+PRC("PER"),20))
"RTN","PRCFSITE",38,0)
 I $P(X,"^",2)="" D A
"RTN","PRCFSITE",39,0)
 S $P(PRC("PER"),"^",2,4)=$P(X,"^",2)_"^"_$P(X,"^",3)_"^"_$S($D(^VA(200,+PRC("PER"),.13)):$P(^(.13),"^",2),1:"")
"RTN","PRCFSITE",40,0)
 Q
"RTN","PRCFSITE",41,0)
INIT ;PRIMARY INIT POINT FOR PRC OPTIONS
"RTN","PRCFSITE",42,0)
 D DUZ Q:'%  I $D(DUZ(0)),$D(DT),$D(DTIME),+DT>0,+DTIME>0 Q
"RTN","PRCFSITE",43,0)
 D DT^DICRW Q
"RTN","PRCFSITE",44,0)
EX ;EXIT LINE FOR MENUMANAGER
"RTN","PRCFSITE",45,0)
 K P
"RTN","PRCFSITE",46,0)
NA S X="<No action taken>" D MSG^PRCFQ S X="" Q
"RTN","PRCFSITE",47,0)
PRIMARY ;INPUT TRANSFORM FOR FILE 411 FIELD 21 "PRIMARY STATION"
"RTN","PRCFSITE",48,0)
 N PRCFX,PRCFY,%A,%B,PRCFZ,N S PRCFX=X S PRCFY=$O(^PRC(411,"AC",1,0))
"RTN","PRCFSITE",49,0)
 I $S('PRCFY:1,PRCFY=DA:1,1:0) Q
"RTN","PRCFSITE",50,0)
 S PRCFZ=$P(^PRC(411,PRCFY,0),"^",9),%A="Station number "_PRCFZ_" has already been designated as 'PRIMARY'",%A(1)="OK to REPLACE",%B="",%=2 D ^PRCFYN I %'=1 D NA Q
"RTN","PRCFSITE",51,0)
 S %A="Are you sure you want to make STATION "_$P(^PRC(411,DA,0),"^",9)_" as 'PRIMARY'",%B="",%=2 D ^PRCFYN I %'=1 D NA Q
"RTN","PRCFSITE",52,0)
 ;CLEAN UP CURRENT ENTRIES
"RTN","PRCFSITE",53,0)
 F N=0:0 S N=$O(^PRC(411,"AC","Y",0)) Q:'N  K ^(N) S $P(^PRC(411,N,0),"^",2)=""
"RTN","PRCFSITE",54,0)
 S X=" <Primary Station Changed>*" D MSG^PRCFQ S X="Y" Q
"RTN","PRCHLO5")
0^1^B87538990^B81680096
"RTN","PRCHLO5",1,0)
PRCHLO5 ;WOIFO/DAP/RLL-manual run for procurement reports  ; 10/16/06 2:12pm
"RTN","PRCHLO5",2,0)
V ;;5.1;IFCAP;**83,98,139**;Oct 20, 2000;Build 16
"RTN","PRCHLO5",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHLO5",4,0)
 ;
"RTN","PRCHLO5",5,0)
ENT ;This routine tasks out the execution of the procurement extract 
"RTN","PRCHLO5",6,0)
 ;reports associated with PRC*5.1*83 (CLRS).
"RTN","PRCHLO5",7,0)
 ;
"RTN","PRCHLO5",8,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,PRCHPRO,ZTSK,ZTREQ,PRCPMSG
"RTN","PRCHLO5",9,0)
 S ZTRTN="RUNEXT^PRCHLO5"
"RTN","PRCHLO5",10,0)
 S ZTDESC="PRCPLO CLO Procurement Reports CLRS"
"RTN","PRCHLO5",11,0)
 S ZTDTH=$H
"RTN","PRCHLO5",12,0)
 S ZTREQ="@"
"RTN","PRCHLO5",13,0)
 S ZTIO=""
"RTN","PRCHLO5",14,0)
 D ^%ZTLOAD
"RTN","PRCHLO5",15,0)
 S PRCHPRO=ZTSK
"RTN","PRCHLO5",16,0)
 ;Calls mail group message generation and screen display with success
"RTN","PRCHLO5",17,0)
 ;or exception notification
"RTN","PRCHLO5",18,0)
 I $D(PRCHPRO)[0 S PRCPMSG(1)="A task could not be created for the CLO Procurement Reports - please contact IRM." W ! D EN^DDIOL(PRCPMSG(1)) D MAIL^PRCHLO4A Q
"RTN","PRCHLO5",19,0)
 ; 
"RTN","PRCHLO5",20,0)
 S PRCPMSG(1)="Task # "_PRCHPRO_" entered for Procurement Reports."
"RTN","PRCHLO5",21,0)
 W !
"RTN","PRCHLO5",22,0)
 D EN^DDIOL(PRCPMSG(1))
"RTN","PRCHLO5",23,0)
 ;
"RTN","PRCHLO5",24,0)
 ;*98 Modified to move MAIL and MAILFTP tags to routine PRCHLO4A
"RTN","PRCHLO5",25,0)
 ;
"RTN","PRCHLO5",26,0)
 D MAIL^PRCHLO4A
"RTN","PRCHLO5",27,0)
 ;
"RTN","PRCHLO5",28,0)
 Q
"RTN","PRCHLO5",29,0)
PRCPCMP ; Notification of completion of building Procurement Report Data
"RTN","PRCHLO5",30,0)
 N PRCPMSG
"RTN","PRCHLO5",31,0)
 S PRCPMSG(1)="PO Procurement Data extract complete."
"RTN","PRCHLO5",32,0)
 D EN^DDIOL(PRCPMSG(1))
"RTN","PRCHLO5",33,0)
 D MAIL^PRCHLO4A
"RTN","PRCHLO5",34,0)
 Q
"RTN","PRCHLO5",35,0)
 ;
"RTN","PRCHLO5",36,0)
PRCPTST ; Notification of termination of building Procurement Report Data due to test system task origin (added in PRC*5.1*139)
"RTN","PRCHLO5",37,0)
 N PRCPMSG
"RTN","PRCHLO5",38,0)
 S PRCPMSG(1)="PO Procurement Data extract TERMINATED due to running on TEST system."
"RTN","PRCHLO5",39,0)
 D EN^DDIOL(PRCPMSG(1))
"RTN","PRCHLO5",40,0)
 D MAIL^PRCHLO4A
"RTN","PRCHLO5",41,0)
 K ^TMP($J),^TMP("PRCHLOG",$J)
"RTN","PRCHLO5",42,0)
 Q
"RTN","PRCHLO5",43,0)
 ;
"RTN","PRCHLO5",44,0)
RUNEXT ; Run extract reports for PO Activity
"RTN","PRCHLO5",45,0)
 I '$$PROD^XUPROD() G PRCPTST  ;Check added in patch PRC*139 to not execute on test systems
"RTN","PRCHLO5",46,0)
 N CLRSERR,CLRSTST1  ; error flag for exception handling,tst entry pt.
"RTN","PRCHLO5",47,0)
 ; CLRSERR will be set for the following conditions:
"RTN","PRCHLO5",48,0)
 ; 0 - Success, status message for completion is sent.
"RTN","PRCHLO5",49,0)
 ; 1 - Error creating ^TMP($J) data (i.e. disk full)
"RTN","PRCHLO5",50,0)
 ; 2 - Error creating Files(i.e. directory patch, VMS Space, etc.)
"RTN","PRCHLO5",51,0)
 ; 3 - Error creating .Com file for FTP transfer, permissions issue
"RTN","PRCHLO5",52,0)
 ; 4 - Error with FTP Transfer,ntwk/permissions, Report Server issue
"RTN","PRCHLO5",53,0)
 ; 5 - Error with file deletion/cleanup prior to processing
"RTN","PRCHLO5",54,0)
 ; 6 - Error, lock is present. Process already running
"RTN","PRCHLO5",55,0)
 S CLRSERR=0
"RTN","PRCHLO5",56,0)
TSTMSG ; This entry point is used to test the messaging framework
"RTN","PRCHLO5",57,0)
 ;  S SLRSTST1=1
"RTN","PRCHLO5",58,0)
 S CLRSERR=0
"RTN","PRCHLO5",59,0)
 ; Check for O/S version
"RTN","PRCHLO5",60,0)
 N CKOS
"RTN","PRCHLO5",61,0)
 S CKOS=$$OS^%ZOSV()
"RTN","PRCHLO5",62,0)
 ; use lock to prevent mult. runs
"RTN","PRCHLO5",63,0)
 L +^PRCP(446.7,"STATUS"):3 I $T=0 S CLRSERR=6
"RTN","PRCHLO5",64,0)
 I CLRSERR=0 D DELRUN^PRCHLO5
"RTN","PRCHLO5",65,0)
 I CLRSERR=5  D
"RTN","PRCHLO5",66,0)
 . N PRCPMSG
"RTN","PRCHLO5",67,0)
 . S PRCPMSG(1)="Error with file deletion/cleanup prior to processing. Please contact IRM."
"RTN","PRCHLO5",68,0)
 . S PRCPMSG(2)=" "
"RTN","PRCHLO5",69,0)
 . S PRCPMSG(3)="This error indicates the CLRS EXTRACT DIRECTORY has not"
"RTN","PRCHLO5",70,0)
 . S PRCPMSG(4)="been properly set up during the installation of this patch."
"RTN","PRCHLO5",71,0)
 . S PRCPMSG(5)=" "
"RTN","PRCHLO5",72,0)
 . S PRCPMSG(6)="(Please refer to the pre installation instructions for PRC*5.1*83)"
"RTN","PRCHLO5",73,0)
 . S PRCPMSG(7)=" "
"RTN","PRCHLO5",74,0)
 . S PRCPMSG(8)="A valid directory must be set up with the"
"RTN","PRCHLO5",75,0)
 . S PRCPMSG(9)="proper read/write/execute/delete privileges."
"RTN","PRCHLO5",76,0)
 . S PRCPMSG(10)=" "
"RTN","PRCHLO5",77,0)
 . S PRCPMSG(11)="In addition, the directory name which you create"
"RTN","PRCHLO5",78,0)
 . S PRCPMSG(12)="must be added as the CLRS EXTRACT DIRECTORY"
"RTN","PRCHLO5",79,0)
 . S PRCPMSG(13)="through the CLO System Parameters Option."
"RTN","PRCHLO5",80,0)
 . S PRCPMSG(14)="If the field is blank, you will generate this error."
"RTN","PRCHLO5",81,0)
 . S PRCPMSG(15)=" "
"RTN","PRCHLO5",82,0)
 . S PRCPMSG(16)="Please confirm all steps have been performed"
"RTN","PRCHLO5",83,0)
 . S PRCPMSG(17)="according to the pre installation instructions for patch PRC*5.1*83."
"RTN","PRCHLO5",84,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",85,0)
 . Q
"RTN","PRCHLO5",86,0)
 ; Begin to build files
"RTN","PRCHLO5",87,0)
 I CLRSERR=0 D INIT^PRCHLO
"RTN","PRCHLO5",88,0)
 I CLRSERR=0 D PRCPCMP^PRCHLO5  ; PO activity Extract logic completed
"RTN","PRCHLO5",89,0)
 I $D(CLRSTST1)  D  ; test point to generate message 1
"RTN","PRCHLO5",90,0)
 . Q:CLRSTST1'=1
"RTN","PRCHLO5",91,0)
 . S CLRSERR=1
"RTN","PRCHLO5",92,0)
 . Q
"RTN","PRCHLO5",93,0)
 I CLRSERR=1  D
"RTN","PRCHLO5",94,0)
 . N PRCPMSG  ; error building ^TMP($J)
"RTN","PRCHLO5",95,0)
 . S PRCPMSG(1)="Error, No Data for PO Activity Files, contact IRM"
"RTN","PRCHLO5",96,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",97,0)
 . Q
"RTN","PRCHLO5",98,0)
CRFILE ; Create .txt file to confirm write privileges to directory
"RTN","PRCHLO5",99,0)
 I CLRSERR=0 D TSTF^PRCHLO4  ; will return CLRSERR=2 on error
"RTN","PRCHLO5",100,0)
 I CLRSERR=0 D CLRSFIL^PRCHLO4
"RTN","PRCHLO5",101,0)
 I CLRSERR=2  D
"RTN","PRCHLO5",102,0)
 . N PRCPMSG
"RTN","PRCHLO5",103,0)
 . S PRCPMSG(1)="Error, Problem with FTP File Creation, contact IRM"
"RTN","PRCHLO5",104,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",105,0)
 . Q
"RTN","PRCHLO5",106,0)
 I CLRSERR=0  D
"RTN","PRCHLO5",107,0)
 . N PRCPMSG
"RTN","PRCHLO5",108,0)
 . S PRCPMSG(1)="Built PO Activity Extracts and GIP Extracts for transfer"
"RTN","PRCHLO5",109,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",110,0)
 . Q
"RTN","PRCHLO5",111,0)
 I CKOS["VMS"  D
"RTN","PRCHLO5",112,0)
 . I CLRSERR=0 D CRTCOM^PRCHLO4
"RTN","PRCHLO5",113,0)
 . Q
"RTN","PRCHLO5",114,0)
 I CKOS["NT"  D
"RTN","PRCHLO5",115,0)
 . I CLRSERR=0 D CRTWIN^PRCHLO4A
"RTN","PRCHLO5",116,0)
 . Q
"RTN","PRCHLO5",117,0)
 I CLRSERR=6  D
"RTN","PRCHLO5",118,0)
 . N PRCPMSG
"RTN","PRCHLO5",119,0)
 . S PRCPMSG(1)="Error encountered when attempting to run CLO PO"
"RTN","PRCHLO5",120,0)
 . S PRCPMSG(2)="activity reports due to other CLRS extracts in"
"RTN","PRCHLO5",121,0)
 . S PRCPMSG(3)="progress. Please try again later."
"RTN","PRCHLO5",122,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",123,0)
 . Q
"RTN","PRCHLO5",124,0)
 I $D(CLRSTST1)  D  ; test point to generate message 3
"RTN","PRCHLO5",125,0)
 . Q:CLRSTST1'=3
"RTN","PRCHLO5",126,0)
 . S CLRSERR=3
"RTN","PRCHLO5",127,0)
 . Q
"RTN","PRCHLO5",128,0)
 I CLRSERR=0 D CKRPTSV^PRCHLO4A  ;ping report server for availability
"RTN","PRCHLO5",129,0)
 I CLRSERR=3  D
"RTN","PRCHLO5",130,0)
 . N PRCPMSG
"RTN","PRCHLO5",131,0)
 . S PRCPMSG(1)="Error, problem creating SETUP file for FTP Transfer, contact IRM."
"RTN","PRCHLO5",132,0)
 . S PRCPMSG(2)="The Report Server may be unavailable for processing."
"RTN","PRCHLO5",133,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",134,0)
 . Q
"RTN","PRCHLO5",135,0)
 I CLRSERR=0  D
"RTN","PRCHLO5",136,0)
 . N PRCPMSG,FILEDIR
"RTN","PRCHLO5",137,0)
 . S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO5",138,0)
 . S PRCPMSG(1)="Final FTP Setup complete, beginning FTP Transfer"
"RTN","PRCHLO5",139,0)
 . S PRCPMSG(2)=" "
"RTN","PRCHLO5",140,0)
 . S PRCPMSG(3)="The file transfer to the report server has been initiated."
"RTN","PRCHLO5",141,0)
 . S PRCPMSG(4)="You will be receiving a notification that the FTP"
"RTN","PRCHLO5",142,0)
 . S PRCPMSG(5)="process has completed. The notification message"
"RTN","PRCHLO5",143,0)
 . S PRCPMSG(6)="should be received within the hour.  If you do not"
"RTN","PRCHLO5",144,0)
 . S PRCPMSG(7)="receive the FTP process has completed message,"
"RTN","PRCHLO5",145,0)
 . S PRCPMSG(8)="please contact IRM. IRM can confirm the process"
"RTN","PRCHLO5",146,0)
 . S PRCPMSG(9)="is still running by performing the following"
"RTN","PRCHLO5",147,0)
 . S PRCPMSG(10)="command:"
"RTN","PRCHLO5",148,0)
 . S PRCPMSG(11)=" "
"RTN","PRCHLO5",149,0)
 . S PRCPMSG(12)="At the MUMPS Programmer prompt, type D ^%SS"
"RTN","PRCHLO5",150,0)
 . S PRCPMSG(13)=" "
"RTN","PRCHLO5",151,0)
 . S PRCPMSG(14)="See if there are any PRCHLO* routines running."
"RTN","PRCHLO5",152,0)
 . S PRCPMSG(15)=" "
"RTN","PRCHLO5",153,0)
 . S PRCPMSG(16)="If these routines are present, the process is still"
"RTN","PRCHLO5",154,0)
 . S PRCPMSG(17)="running. If you waited one hour, and did not get the"
"RTN","PRCHLO5",155,0)
 . S PRCPMSG(18)="FTP process has completed message, a problem"
"RTN","PRCHLO5",156,0)
 . S PRCPMSG(19)="was encountered. Further troubleshooting can be"
"RTN","PRCHLO5",157,0)
 . S PRCPMSG(20)="performed by examining the LOGFILE CLRSxxxFTP1.LOG"
"RTN","PRCHLO5",158,0)
 . S PRCPMSG(21)="where xxx is your station ID#. The logfile is"
"RTN","PRCHLO5",159,0)
 . S PRCPMSG(22)="located in the following directory: "_FILEDIR
"RTN","PRCHLO5",160,0)
 . S PRCPMSG(23)=" "
"RTN","PRCHLO5",161,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",162,0)
 . Q
"RTN","PRCHLO5",163,0)
 I CKOS["VMS"  D
"RTN","PRCHLO5",164,0)
 . I CLRSERR=0  D
"RTN","PRCHLO5",165,0)
 . . D CRTCOM1^PRCHLO4
"RTN","PRCHLO5",166,0)
 . . D FTPCOM^PRCHLO4
"RTN","PRCHLO5",167,0)
 . . Q
"RTN","PRCHLO5",168,0)
 . Q
"RTN","PRCHLO5",169,0)
 I CKOS["NT"  D
"RTN","PRCHLO5",170,0)
 . I CLRSERR=0  D
"RTN","PRCHLO5",171,0)
 . . D CRTWIN^PRCHLO4A
"RTN","PRCHLO5",172,0)
 . . D FTPCOM^PRCHLO4A
"RTN","PRCHLO5",173,0)
 . . Q
"RTN","PRCHLO5",174,0)
 . Q
"RTN","PRCHLO5",175,0)
 ; release the lock
"RTN","PRCHLO5",176,0)
 L -^PRCP(446.7,"STATUS")
"RTN","PRCHLO5",177,0)
 I CLRSERR=4  D
"RTN","PRCHLO5",178,0)
 . N PRCPMSG,FILEDIR
"RTN","PRCHLO5",179,0)
 . S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO5",180,0)
 . S PRCPMSG(1)="An Error occurred during the FTP Transfer "_$$HTE^XLFDT($H)
"RTN","PRCHLO5",181,0)
 . S PRCPMSG(2)="Contact IRM to perform troubleshooting steps"
"RTN","PRCHLO5",182,0)
 . S PRCPMSG(3)="by examining the logfile CLRSxxxFTP1.LOG where"
"RTN","PRCHLO5",183,0)
 . S PRCPMSG(4)="xxx is your station number. The logfile is located"
"RTN","PRCHLO5",184,0)
 . S PRCPMSG(5)="the FTP directory "_FILEDIR
"RTN","PRCHLO5",185,0)
 . S PRCPMSG(6)=" "
"RTN","PRCHLO5",186,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",187,0)
 . Q
"RTN","PRCHLO5",188,0)
 I CLRSERR=0  D
"RTN","PRCHLO5",189,0)
 . N PRCPMSG,FILEDIR
"RTN","PRCHLO5",190,0)
 . S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO5",191,0)
 . S PRCPMSG(1)="The FTP Transfer process completed, "_$$HTE^XLFDT($H)
"RTN","PRCHLO5",192,0)
 . S PRCPMSG(2)=" "
"RTN","PRCHLO5",193,0)
 . S PRCPMSG(3)="The Clinical Logistics 0ffice should examine the Report Server"
"RTN","PRCHLO5",194,0)
 . S PRCPMSG(4)="FTP directory for your files. If the files from your"
"RTN","PRCHLO5",195,0)
 . S PRCPMSG(5)="station are not found, IRM can provide additional"
"RTN","PRCHLO5",196,0)
 . S PRCPMSG(6)="troubleshooting steps by examining the LOGFILE"
"RTN","PRCHLO5",197,0)
 . S PRCPMSG(7)="CLRSxxxFTP1.LOG where xxx is your station number."
"RTN","PRCHLO5",198,0)
 . S PRCPMSG(8)="The logfile is located in the directory: "_FILEDIR
"RTN","PRCHLO5",199,0)
 . S PRCPMSG(9)=" "
"RTN","PRCHLO5",200,0)
 . S PRCPMSG(10)="The contents of the logfile are listed below:"
"RTN","PRCHLO5",201,0)
 . D LOG2FILE^PRCHLO4A
"RTN","PRCHLO5",202,0)
 . Q
"RTN","PRCHLO5",203,0)
 ; CLEAN UP
"RTN","PRCHLO5",204,0)
 K ^TMP($J)
"RTN","PRCHLO5",205,0)
 K ^TMP("PRCHLOG",$J)
"RTN","PRCHLO5",206,0)
 Q
"RTN","PRCHLO5",207,0)
DELRUN ; delete previous run at the beginning of the program
"RTN","PRCHLO5",208,0)
 ;
"RTN","PRCHLO5",209,0)
 N FILCK,FILDEL,TFILE1,TFILE2,OUTFL1,OUTFL2,POP,STID
"RTN","PRCHLO5",210,0)
 ; create, delete, then create files to clean up and confirm
"RTN","PRCHLO5",211,0)
 ; write / delete privileges to directory
"RTN","PRCHLO5",212,0)
 S POP=""
"RTN","PRCHLO5",213,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO5",214,0)
 S OUTFL1="CLRS"_STID_"TST.TXT"
"RTN","PRCHLO5",215,0)
 S OUTFL2="IFCP"_STID_"TST.TXT"
"RTN","PRCHLO5",216,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO5",217,0)
 I FILEDIR=""  D
"RTN","PRCHLO5",218,0)
 . S CLRSERR=5
"RTN","PRCHLO5",219,0)
 . Q
"RTN","PRCHLO5",220,0)
 I FILEDIR=" "  D
"RTN","PRCHLO5",221,0)
 . S CLRSERR=5
"RTN","PRCHLO5",222,0)
 . Q
"RTN","PRCHLO5",223,0)
 I CLRSERR=0 D OPEN^%ZISH("TFILE1",FILEDIR,OUTFL1,"W")
"RTN","PRCHLO5",224,0)
 I POP  D
"RTN","PRCHLO5",225,0)
 . S CLRSERR=5
"RTN","PRCHLO5",226,0)
 . Q
"RTN","PRCHLO5",227,0)
 I CLRSERR=0  D
"RTN","PRCHLO5",228,0)
 . D USE^%ZISUTL("TFILE1")
"RTN","PRCHLO5",229,0)
 . W !,"$ ! This is a test file to confirm write/delete access"
"RTN","PRCHLO5",230,0)
 . W !,"$ ! once file access is confirmed, file is deleted"
"RTN","PRCHLO5",231,0)
 . W !,"$ EXIT"
"RTN","PRCHLO5",232,0)
 . D CLOSE^%ZISH("TFILE1")
"RTN","PRCHLO5",233,0)
 . D OPEN^%ZISH("TFILE2",FILEDIR,OUTFL2,"W")
"RTN","PRCHLO5",234,0)
 . D USE^%ZISUTL("TFILE2")
"RTN","PRCHLO5",235,0)
 . W !,"$ ! This is a test file to confirm write/delete access"
"RTN","PRCHLO5",236,0)
 . W !,"$ ! once file access is confirmed, file is deleted"
"RTN","PRCHLO5",237,0)
 . W !,"$ EXIT"
"RTN","PRCHLO5",238,0)
 . D CLOSE^%ZISH("TFILE2")
"RTN","PRCHLO5",239,0)
 . Q
"RTN","PRCHLO5",240,0)
 ;
"RTN","PRCHLO5",241,0)
DELWIN ; DELETE windows files, need to handle 1 file at a time
"RTN","PRCHLO5",242,0)
 ; SACC Exception received for usage of $ZF(-1) in PRC*5.1*83
"RTN","PRCHLO5",243,0)
 ; See IFCAP technical manual.
"RTN","PRCHLO5",244,0)
 I CKOS["NT" D DELWIN^PRCHLO4A
"RTN","PRCHLO5",245,0)
DELFILS ; Delete the files / clean-up before processing
"RTN","PRCHLO5",246,0)
 ;
"RTN","PRCHLO5",247,0)
 ; SACC Exception received for usage of $ZF(-1) in PRC*5.1*83
"RTN","PRCHLO5",248,0)
 ; See IFCAP technical manual
"RTN","PRCHLO5",249,0)
 I CKOS["VMS"  D  ;O/S IS VMS
"RTN","PRCHLO5",250,0)
 . Q:CLRSERR'="0"
"RTN","PRCHLO5",251,0)
 . N PV,PV1,XPV,XPV1
"RTN","PRCHLO5",252,0)
 . S XPV="S PV=$ZF(-1,""DELETE "_FILEDIR_"*"_STID_"*.*;*"")"
"RTN","PRCHLO5",253,0)
 . X XPV
"RTN","PRCHLO5",254,0)
 . Q
"RTN","PRCHLO5",255,0)
 Q
"VER")
8.0^22.0
"^DD",421,421,.01,0)
TRANSACTION NUMBER^RF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>12!($L(X)<3)!'(X'?1P.E)!(X'?.ANP) X
"^DD",421,421,.01,1,0)
^.1
"^DD",421,421,.01,1,1,0)
421^B
"^DD",421,421,.01,1,1,1)
S ^PRCF(421,"B",$E(X,1,30),DA)=""
"^DD",421,421,.01,1,1,2)
K ^PRCF(421,"B",$E(X,1,30),DA)
"^DD",421,421,.01,1,2,0)
421^AD^MUMPS
"^DD",421,421,.01,1,2,1)
S ^PRCF(421,"AD",$P(X,"-",1,2),100000-$P(X,"-",3))=""
"^DD",421,421,.01,1,2,2)
K ^PRCF(421,"AD",$P(X,"-",1,2),100000-$P(X,"-",3))
"^DD",421,421,.01,1,2,"%D",0)
^^3^3^2930624^
"^DD",421,421,.01,1,2,"%D",1,0)
This cross reference is set on the station number-
"^DD",421,421,.01,1,2,"%D",2,0)
fiscal year and a sequence number (100000 - last 5
"^DD",421,421,.01,1,2,"%D",3,0)
digits of the transaction number).
"^DD",421,421,.01,1,3,0)
421^D^MUMPS
"^DD",421,421,.01,1,3,1)
S ^PRCF(421,"D",$P(X,"-",3),DA)=""
"^DD",421,421,.01,1,3,2)
K ^PRCF(421,"D",$P(X,"-",3),DA)
"^DD",421,421,.01,1,3,"%D",0)
^^2^2^2930624^
"^DD",421,421,.01,1,3,"%D",1,0)
This cross reference is set on the last 5
"^DD",421,421,.01,1,3,"%D",2,0)
digits of the transaction number.
"^DD",421,421,.01,1,4,0)
421^AK^MUMPS
"^DD",421,421,.01,1,4,1)
S $P(^PRCF(421,DA,0),"^",12)=$P(X,"-",1,2),^PRCF(421,"AJ",$P(X,"-",1,2),DA)=""
"^DD",421,421,.01,1,4,2)
S $P(^PRCF(421,DA,0),"^",12)="" K ^PRCF(421,"AJ",$P(X,"-",1,2),DA)
"^DD",421,421,.01,1,4,"%D",0)
^^4^4^2930624^
"^DD",421,421,.01,1,4,"%D",1,0)
This cross reference sets the station number-
"^DD",421,421,.01,1,4,"%D",2,0)
fiscal year on the transaction record.
"^DD",421,421,.01,1,4,"%D",3,0)
It also sets the "AJ" cross reference on the
"^DD",421,421,.01,1,4,"%D",4,0)
station number-fiscal year.
"^DD",421,421,.01,1,4,"CREATE VALUE")
$P(TRANSACTION NUMBER,"-",1,2)
"^DD",421,421,.01,1,4,"DELETE VALUE")
@
"^DD",421,421,.01,1,4,"FIELD")
SIFY
"^DD",421,421,.01,1,5,0)
421^AO^MUMPS
"^DD",421,421,.01,1,5,1)
I $P(^PRCF(421,DA,0),"^",19)="" S $P(^(0),"^",19,20)="1^0",^PRCF(421,"AL",$P(X,"-",1,2),0,DA)=""
"^DD",421,421,.01,1,5,2)
Q
"^DD",421,421,.01,1,5,"%D",0)
^^2^2^2930624^
"^DD",421,421,.01,1,5,"%D",1,0)
This cross reference sets the indicator for whether
"^DD",421,421,.01,1,5,"%D",2,0)
the transaction is ready for code sheet creation.
"^DD",421,421,.01,3)
ANSWER MUST BE 3-12 CHARACTERS IN LENGTH
"^DD",421,421,.01,21,0)
^^6^6^3100625^
"^DD",421,421,.01,21,1,0)
This is the transaction number. The number is composed of 
"^DD",421,421,.01,21,2,0)
<stn#>"-"<YY>"-"<entry #>.
"^DD",421,421,.01,21,3,0)
 
"^DD",421,421,.01,21,4,0)
Example:   688-10-00015    where   688 = station number
"^DD",421,421,.01,21,5,0)
                                    10 = fiscal year 2010 (YY)
"^DD",421,421,.01,21,6,0)
                                 00015 = 5 digit transaction #
"^DD",421,421,.01,"DT")
2900709
"BLD",5988,6)
^123
**END**
**END**
