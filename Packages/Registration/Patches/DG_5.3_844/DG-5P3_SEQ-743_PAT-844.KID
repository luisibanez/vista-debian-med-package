Released DG*5.3*844 SEQ #743
Extracted from mail message
**KIDS**:DG*5.3*844^

**INSTALL NAME**
DG*5.3*844
"BLD",8755,0)
DG*5.3*844^REGISTRATION^0^3110627^y
"BLD",8755,1,0)
^^1^1^3110614^
"BLD",8755,1,1,0)
TREATING SPECIALTY UPDATES
"BLD",8755,4,0)
^9.64PA^^
"BLD",8755,6.3)
3
"BLD",8755,"INI")
PTFCHK^DG53P844
"BLD",8755,"INIT")
EN^DG53P844
"BLD",8755,"KRN",0)
^9.67PA^779.2^20
"BLD",8755,"KRN",.4,0)
.4
"BLD",8755,"KRN",.401,0)
.401
"BLD",8755,"KRN",.402,0)
.402
"BLD",8755,"KRN",.403,0)
.403
"BLD",8755,"KRN",.5,0)
.5
"BLD",8755,"KRN",.84,0)
.84
"BLD",8755,"KRN",3.6,0)
3.6
"BLD",8755,"KRN",3.8,0)
3.8
"BLD",8755,"KRN",9.2,0)
9.2
"BLD",8755,"KRN",9.8,0)
9.8
"BLD",8755,"KRN",9.8,"NM",0)
^9.68A^^
"BLD",8755,"KRN",19,0)
19
"BLD",8755,"KRN",19,"NM",0)
^9.68A^^
"BLD",8755,"KRN",19.1,0)
19.1
"BLD",8755,"KRN",101,0)
101
"BLD",8755,"KRN",409.61,0)
409.61
"BLD",8755,"KRN",771,0)
771
"BLD",8755,"KRN",779.2,0)
779.2
"BLD",8755,"KRN",870,0)
870
"BLD",8755,"KRN",8989.51,0)
8989.51
"BLD",8755,"KRN",8989.52,0)
8989.52
"BLD",8755,"KRN",8994,0)
8994
"BLD",8755,"KRN","B",.4,.4)

"BLD",8755,"KRN","B",.401,.401)

"BLD",8755,"KRN","B",.402,.402)

"BLD",8755,"KRN","B",.403,.403)

"BLD",8755,"KRN","B",.5,.5)

"BLD",8755,"KRN","B",.84,.84)

"BLD",8755,"KRN","B",3.6,3.6)

"BLD",8755,"KRN","B",3.8,3.8)

"BLD",8755,"KRN","B",9.2,9.2)

"BLD",8755,"KRN","B",9.8,9.8)

"BLD",8755,"KRN","B",19,19)

"BLD",8755,"KRN","B",19.1,19.1)

"BLD",8755,"KRN","B",101,101)

"BLD",8755,"KRN","B",409.61,409.61)

"BLD",8755,"KRN","B",771,771)

"BLD",8755,"KRN","B",779.2,779.2)

"BLD",8755,"KRN","B",870,870)

"BLD",8755,"KRN","B",8989.51,8989.51)

"BLD",8755,"KRN","B",8989.52,8989.52)

"BLD",8755,"KRN","B",8994,8994)

"BLD",8755,"QDEF")
^^^^^^^^^^YES
"BLD",8755,"QUES",0)
^9.62^^
"BLD",8755,"REQB",0)
^9.611^^
"INI")
PTFCHK^DG53P844
"INIT")
EN^DG53P844
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
844^3110627
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3110627
"PKG",5,22,1,"PAH",1,1,1,0)
TREATING SPECIALTY UPDATES
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","DG53P844")
0^^B39288188^n/a
"RTN","DG53P844",1,0)
DG53P844 ;ALB/MJB/RC - TREATING SPECIALTIES UPDATES ; 6/22/11 3:45pm
"RTN","DG53P844",2,0)
 ;;5.3;Registration;**844**;Aug 13, 1993;Build 3
"RTN","DG53P844",3,0)
 ;
"RTN","DG53P844",4,0)
 Q
"RTN","DG53P844",5,0)
 ;; This routine is used to add, edit and inactivate Specialties in the specialty file and
"RTN","DG53P844",6,0)
 ;; edit existing surgical specialties.
"RTN","DG53P844",7,0)
 ;;
"RTN","DG53P844",8,0)
EN ; Changes to the SPECIALITY file (#42.4)
"RTN","DG53P844",9,0)
 N DGI,DGERR,DGSPEC,DGIFN,DGQUES
"RTN","DG53P844",10,0)
 ;edit existing treating specialties, if needed
"RTN","DG53P844",11,0)
 D EDIT
"RTN","DG53P844",12,0)
 ;inactivate existing treating specialties, if needed
"RTN","DG53P844",13,0)
 D INACT
"RTN","DG53P844",14,0)
 ;edit existing surgical specialties, if needed
"RTN","DG53P844",15,0)
 ;D EDIT^DG53813R
"RTN","DG53P844",16,0)
 Q
"RTN","DG53P844",17,0)
INACT ;inactivate treating specialties
"RTN","DG53P844",18,0)
 N DA,DIE,DR,X,DGTSP,DIC,Y
"RTN","DG53P844",19,0)
 F DGTSP=43 D
"RTN","DG53P844",20,0)
 . S DIC="^DIC(42.4,"_DGTSP_",""E"","
"RTN","DG53P844",21,0)
 . S DA(1)=DGTSP
"RTN","DG53P844",22,0)
 . S DIC(0)="LX"
"RTN","DG53P844",23,0)
 . S DIC("P")=$P(^DD(42.4,10,0),"^",2)
"RTN","DG53P844",24,0)
 . S X=3111001
"RTN","DG53P844",25,0)
 . D ^DIC
"RTN","DG53P844",26,0)
 . S DA=+Y
"RTN","DG53P844",27,0)
 . I +Y=-1 D BMES^XPDUTL(">>>Inactive date not added to TS code "_DGTSP_" in the Specialty file.<<<") Q
"RTN","DG53P844",28,0)
 . D BMES^XPDUTL(">>>Inactive date added to TS code "_DGTSP_" in the Specialty file.<<<")
"RTN","DG53P844",29,0)
 . S DIE=DIC
"RTN","DG53P844",30,0)
 . S DR=".02///N"
"RTN","DG53P844",31,0)
 . D ^DIE
"RTN","DG53P844",32,0)
 . ;check for CODES in the Facility Treating Specialty File (45.7
"RTN","DG53P844",33,0)
 . ;add inactivation date of 10/1/2011
"RTN","DG53P844",34,0)
 . D BMES^XPDUTL("  ")
"RTN","DG53P844",35,0)
 . D MES^XPDUTL("     FACILITY TREATING SPECIALTY FILE being checked to see if any entries are")
"RTN","DG53P844",36,0)
 . D MES^XPDUTL("     pointing to "_DGTSP_".  If so, they will be inactivated.>>>")
"RTN","DG53P844",37,0)
 .N DAA F DAA=0:0 S DAA=$O(^DIC(45.7,"ASPEC",DGTSP,DAA)) Q:'DAA  D
"RTN","DG53P844",38,0)
 .. N DIE,DR,TS,X S TS=""
"RTN","DG53P844",39,0)
 ..S TS=$P($G(^DIC(45.7,DAA,0)),"^")
"RTN","DG53P844",40,0)
 ..S DIC="^DIC(45.7,"_DAA_",""E"","
"RTN","DG53P844",41,0)
 ..S DA(1)=DAA
"RTN","DG53P844",42,0)
 ..S DIC(0)="LX"
"RTN","DG53P844",43,0)
 ..S X=3111001
"RTN","DG53P844",44,0)
 ..D ^DIC
"RTN","DG53P844",45,0)
 ..S DA=+Y
"RTN","DG53P844",46,0)
 ..I +Y=-1 D BMES^XPDUTL("     Inactive date not added to "_TS_"in the Facility Treating Specialty file.") Q
"RTN","DG53P844",47,0)
 ..D BMES^XPDUTL("     Inactive date added to "_TS_" in the Facility Treating Specialty file.<<<")
"RTN","DG53P844",48,0)
 ..S DIE=DIC
"RTN","DG53P844",49,0)
 ..S DR=".02///N"
"RTN","DG53P844",50,0)
 ..D ^DIE
"RTN","DG53P844",51,0)
 Q
"RTN","DG53P844",52,0)
EDIT ;Edit treating specialties
"RTN","DG53P844",53,0)
 ;
"RTN","DG53P844",54,0)
 N DS,DIE,DR,DGI,DIC,Y
"RTN","DG53P844",55,0)
 S DIE="^DIC(42.4,"
"RTN","DG53P844",56,0)
 S DIC(0)="LX"
"RTN","DG53P844",57,0)
 F DGI=1:1 S DGSPEC=$P($T(ETRSP+DGI),";;",2) Q:DGSPEC="QUIT"  D
"RTN","DG53P844",58,0)
 . S DGERR=0
"RTN","DG53P844",59,0)
 . S DA=$P(DGSPEC,U)
"RTN","DG53P844",60,0)
 . S DR=".01///"_$P(DGSPEC,U,2)_";1///"_$P(DGSPEC,U,3)_";3///"_$P(DGSPEC,U,4)_";4///"_$P(DGSPEC,U,5)_";5///"_$P(DGSPEC,U,6)_";6///"_$P(DGSPEC,U,7)
"RTN","DG53P844",61,0)
 . D ^DIE
"RTN","DG53P844",62,0)
 . D BMES^XPDUTL("  ")
"RTN","DG53P844",63,0)
 . D BMES^XPDUTL("  ")
"RTN","DG53P844",64,0)
 . D BMES^XPDUTL(">>>"_$P(DGSPEC,U)_" code updated to "_$P(DGSPEC,U,2)_" in the Specialty file.>>>")
"RTN","DG53P844",65,0)
 N DS,DIE,DR,DGI,DGII,DGSP,CNT,DGSPEC,DGSPEC1
"RTN","DG53P844",66,0)
 S DIE="^DIC(45.7,"
"RTN","DG53P844",67,0)
 S DIC(0)="LX"
"RTN","DG53P844",68,0)
 F DGI=1:1 S DGSPEC=$P($T(ETRSP+DGI),";;",2) Q:DGSPEC="QUIT"  D
"RTN","DG53P844",69,0)
 . S DGERR=0
"RTN","DG53P844",70,0)
 . S DGSP=$P(DGSPEC,U)
"RTN","DG53P844",71,0)
 . S CNT=0,DGSPEC1=0 F DGII=0:0 S DGSPEC1=$O(^DIC(45.7,"ASPEC",DGSP,DGSPEC1)) Q:'DGSPEC1  S CNT=CNT+1 D
"RTN","DG53P844",72,0)
 .. I CNT=1 D
"RTN","DG53P844",73,0)
 ... I $$ACTIVE^DGACT(45.7,DGSPEC1)'=1 S CNT=0 Q
"RTN","DG53P844",74,0)
 ... S DA=DGSPEC1,DR=".01///"_$P(DGSPEC,U,2)_";99///@"
"RTN","DG53P844",75,0)
 ... D BMES^XPDUTL("     "_$P(^DIC(45.7,DGSPEC1,0),U)_" name has been changed to "_$P(DGSPEC,U,2)_" in the Facility Treating Specialty file.")
"RTN","DG53P844",76,0)
 ... D ^DIE
"RTN","DG53P844",77,0)
 .. E  D
"RTN","DG53P844",78,0)
 ... S TS=""
"RTN","DG53P844",79,0)
 ... S TS=$P($G(^DIC(45.7,DGSPEC1,0)),"^")
"RTN","DG53P844",80,0)
 ... D BMES^XPDUTL("     Please review Facility Treating Specialty "_TS_".  The entry name may need changing or entry may need inactivating since more than one entry points to "_$P(DGSPEC,U,2)_" in the Specialty file.<<<")
"RTN","DG53P844",81,0)
 Q
"RTN","DG53P844",82,0)
ETRSP ;PTF CODE^SPECIALTY^PRINT NAME^SERVICE^ASK PSYCH^BILLING BEDSECTION^CDR/MPCR
"RTN","DG53P844",83,0)
 ;;67^NH SHORT-STAY CONTINUING CARE^NH SS CONT CARE^NHCU^NO^NURSING HOME CARE^1430^^
"RTN","DG53P844",84,0)
 ;;68^NH SHORT-STAY MH RECOVERY^NH SS MH RECVRY^NHCU^NO^NURSING HOME CARE^1430^^
"RTN","DG53P844",85,0)
 ;;44^NH LONG-STAY CONTINUING CARE^NH LS CONT CARE^NHCU^NO^NURSING HOME CARE^1410^^
"RTN","DG53P844",86,0)
 ;;45^NH LONG-STAY MH RECOVERY^NH LS MH RECVRY^NHCU^NO^NURSING HOME CARE^1410^^
"RTN","DG53P844",87,0)
 ;;QUIT
"RTN","DG53P844",88,0)
PTFCHK ;Check Open PTF records for TS 43
"RTN","DG53P844",89,0)
 N DGPTFIEN,DGMVTIEN,DGTEXTLN,DGTEXT,DGSPCS
"RTN","DG53P844",90,0)
 S DGPTFIEN="",DGTEXTLN=10,DGSPCS="                              "
"RTN","DG53P844",91,0)
 ;Go through Open PTF records
"RTN","DG53P844",92,0)
 F  S DGPTFIEN=$O(^DGPT("AS",0,DGPTFIEN)) Q:'DGPTFIEN  D
"RTN","DG53P844",93,0)
 .;Find the newest movement
"RTN","DG53P844",94,0)
 .S DGMVTIEN=9999999
"RTN","DG53P844",95,0)
 .S DGMVTIEN=$O(^DGPT(DGPTFIEN,"M",DGMVTIEN),-1)
"RTN","DG53P844",96,0)
 .;If the treating specialty is 43 add to the mail message
"RTN","DG53P844",97,0)
 .I DGMVTIEN,$P($G(^DGPT(DGPTFIEN,"M",DGMVTIEN,0)),U,2)=43 D
"RTN","DG53P844",98,0)
 ..N DGPTNM,DGPTAD
"RTN","DG53P844",99,0)
 ..;retrieve the patient's name and admission date
"RTN","DG53P844",100,0)
 ..D GETS^DIQ(45,DGPTFIEN_",",".01;2","EI","DGPTINFO")
"RTN","DG53P844",101,0)
 ..S DGPTNM=$E(DGPTINFO(45,DGPTFIEN_",",".01","E")_DGSPCS,1,30)
"RTN","DG53P844",102,0)
 ..S DGPTAD=DGPTINFO(45,DGPTFIEN_",","2","E")
"RTN","DG53P844",103,0)
 ..S DGTEXTLN=DGTEXTLN+1
"RTN","DG53P844",104,0)
 ..;add a new line to the mail message in the format
"RTN","DG53P844",105,0)
 ..;ptf record #, patient's name, admission date
"RTN","DG53P844",106,0)
 ..S DGTEXT(DGTEXTLN)=$E(DGPTFIEN_DGSPCS,1,10)_" "_DGPTNM_" "_DGPTAD
"RTN","DG53P844",107,0)
 ..K DGPTINFO,DGPTNM,DGPTAD
"RTN","DG53P844",108,0)
 D GENMAIL(DGTEXTLN,.DGTEXT)
"RTN","DG53P844",109,0)
 Q
"RTN","DG53P844",110,0)
GENMAIL(DGTEXTLN,DGTEXT) ;Generate mail message with PTF information
"RTN","DG53P844",111,0)
 N XMDUZ,XMSUB,XMY,XMTEXT,DIFROM ;Mailman Variables
"RTN","DG53P844",112,0)
 S XMDUZ=".5" ;Message originates from postmaster
"RTN","DG53P844",113,0)
 S XMY(DUZ)="" ;Send message to patch installer
"RTN","DG53P844",114,0)
 S XMSUB="Treating Specialty Update DG*5.3*844"
"RTN","DG53P844",115,0)
 S XMTEXT="DGTEXT("
"RTN","DG53P844",116,0)
 S DGTEXT(1)="This message was generated by the installation of DG*5.3*844."
"RTN","DG53P844",117,0)
 I DGTEXTLN=10 D  Q
"RTN","DG53P844",118,0)
 .S DGTEXT(2)="There are no patients requiring treating specialty updates."
"RTN","DG53P844",119,0)
 .S DGTEXT(3)="No action is required."
"RTN","DG53P844",120,0)
 .D ^XMD
"RTN","DG53P844",121,0)
 S DGTEXT(2)="There are patients at your site that are still assigned to treating specialty: "
"RTN","DG53P844",122,0)
 S DGTEXT(3)="43 NH LONG STAY SKILLED NURING."
"RTN","DG53P844",123,0)
 S DGTEXT(4)="This code is inactive as of October 1, 2011."
"RTN","DG53P844",124,0)
 S DGTEXT(5)="Please forward this message to the appropriate MAS personnel for review."
"RTN","DG53P844",125,0)
 S DGTEXT(6)=""
"RTN","DG53P844",126,0)
 S DGTEXT(7)="Patients requiring treating specialty updates:"
"RTN","DG53P844",127,0)
 S DGTEXT(8)=""
"RTN","DG53P844",128,0)
 S DGTEXT(9)="PTF#       PATIENT                        ADMISSION DATE"
"RTN","DG53P844",129,0)
 S DGTEXT(10)="------------------------------------------------------------------"
"RTN","DG53P844",130,0)
 D ^XMD
"RTN","DG53P844",131,0)
 Q
"VER")
8.0^22.0
"BLD",8755,6)
^743
**END**
**END**
