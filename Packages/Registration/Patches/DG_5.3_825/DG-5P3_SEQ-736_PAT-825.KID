Released DG*5.3*825 SEQ #736
Extracted from mail message
**KIDS**:DG*5.3*825^

**INSTALL NAME**
DG*5.3*825
"BLD",2796,0)
DG*5.3*825^REGISTRATION^0^3100907^y
"BLD",2796,1,0)
^^3^3^3100902^
"BLD",2796,1,1,0)
SUPPORT FOR NATIONAL HEALTH INFORMATION EXCHANGE
"BLD",2796,1,2,0)
Refer to patch DG*5.3*825 in the FORUM Patch Module for a complete
"BLD",2796,1,3,0)
description.
"BLD",2796,4,0)
^9.64PA^391.91^2
"BLD",2796,4,391.91,0)
391.91
"BLD",2796,4,391.91,2,0)
^9.641^391.91^2
"BLD",2796,4,391.91,2,391.91,0)
TREATING FACILITY LIST  (File-top level)
"BLD",2796,4,391.91,2,391.91,1,0)
^9.6411^1^2
"BLD",2796,4,391.91,2,391.91,1,.09,0)
SOURCE ID TYPE
"BLD",2796,4,391.91,2,391.91,1,1,0)
ASSIGNING AUTHORITY
"BLD",2796,4,391.91,2,391.9101,0)
SOURCE ID  (sub-file)
"BLD",2796,4,391.91,2,391.9101,1,0)
^9.6411^^
"BLD",2796,4,391.91,222)
y^y^p^^^^n^^n
"BLD",2796,4,391.91,224)

"BLD",2796,4,391.92,0)
391.92
"BLD",2796,4,391.92,222)
y^y^f^^n^^y^o^n
"BLD",2796,4,391.92,224)
N X S X=+^(0) I ((X>0)&(X<6))
"BLD",2796,4,"APDD",391.91,391.91)

"BLD",2796,4,"APDD",391.91,391.91,.09)

"BLD",2796,4,"APDD",391.91,391.91,1)

"BLD",2796,4,"APDD",391.91,391.9101)

"BLD",2796,4,"B",391.91,391.91)

"BLD",2796,4,"B",391.92,391.92)

"BLD",2796,6.3)
1
"BLD",2796,"ABPKG")
n
"BLD",2796,"KRN",0)
^9.67PA^779.2^20
"BLD",2796,"KRN",.4,0)
.4
"BLD",2796,"KRN",.401,0)
.401
"BLD",2796,"KRN",.402,0)
.402
"BLD",2796,"KRN",.403,0)
.403
"BLD",2796,"KRN",.5,0)
.5
"BLD",2796,"KRN",.84,0)
.84
"BLD",2796,"KRN",3.6,0)
3.6
"BLD",2796,"KRN",3.8,0)
3.8
"BLD",2796,"KRN",9.2,0)
9.2
"BLD",2796,"KRN",9.8,0)
9.8
"BLD",2796,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",2796,"KRN",9.8,"NM",1,0)
DGFCPROT^^0^B7131954
"BLD",2796,"KRN",9.8,"NM",2,0)
VAFCSB^^0^B8780845
"BLD",2796,"KRN",9.8,"NM",3,0)
VAFCRPC^^0^B7679300
"BLD",2796,"KRN",9.8,"NM",4,0)
VAFCAAUT^^0^B27332848
"BLD",2796,"KRN",9.8,"NM","B","DGFCPROT",1)

"BLD",2796,"KRN",9.8,"NM","B","VAFCAAUT",4)

"BLD",2796,"KRN",9.8,"NM","B","VAFCRPC",3)

"BLD",2796,"KRN",9.8,"NM","B","VAFCSB",2)

"BLD",2796,"KRN",19,0)
19
"BLD",2796,"KRN",19.1,0)
19.1
"BLD",2796,"KRN",101,0)
101
"BLD",2796,"KRN",409.61,0)
409.61
"BLD",2796,"KRN",771,0)
771
"BLD",2796,"KRN",779.2,0)
779.2
"BLD",2796,"KRN",870,0)
870
"BLD",2796,"KRN",8989.51,0)
8989.51
"BLD",2796,"KRN",8989.52,0)
8989.52
"BLD",2796,"KRN",8994,0)
8994
"BLD",2796,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",2796,"KRN",8994,"NM",1,0)
VAFC AA UPDATE^^0
"BLD",2796,"KRN",8994,"NM","B","VAFC AA UPDATE",1)

"BLD",2796,"KRN","B",.4,.4)

"BLD",2796,"KRN","B",.401,.401)

"BLD",2796,"KRN","B",.402,.402)

"BLD",2796,"KRN","B",.403,.403)

"BLD",2796,"KRN","B",.5,.5)

"BLD",2796,"KRN","B",.84,.84)

"BLD",2796,"KRN","B",3.6,3.6)

"BLD",2796,"KRN","B",3.8,3.8)

"BLD",2796,"KRN","B",9.2,9.2)

"BLD",2796,"KRN","B",9.8,9.8)

"BLD",2796,"KRN","B",19,19)

"BLD",2796,"KRN","B",19.1,19.1)

"BLD",2796,"KRN","B",101,101)

"BLD",2796,"KRN","B",409.61,409.61)

"BLD",2796,"KRN","B",771,771)

"BLD",2796,"KRN","B",779.2,779.2)

"BLD",2796,"KRN","B",870,870)

"BLD",2796,"KRN","B",8989.51,8989.51)

"BLD",2796,"KRN","B",8989.52,8989.52)

"BLD",2796,"KRN","B",8994,8994)

"BLD",2796,"QUES",0)
^9.62^^
"BLD",2796,"REQB",0)
^9.611^3^2
"BLD",2796,"REQB",2,0)
DG*5.3*756^2
"BLD",2796,"REQB",3,0)
DG*5.3*479^2
"BLD",2796,"REQB","B","DG*5.3*479",3)

"BLD",2796,"REQB","B","DG*5.3*756",2)

"DATA",391.92,1,0)
1^USVHA^2.16.840.1.113883.4.349
"DATA",391.92,2,0)
2^^1.3.6.1.4.1.26580^NI
"DATA",391.92,3,0)
3^USDOD^2.16.840.1.113883.3.364
"DATA",391.92,4,0)
4^USSSA
"DATA",391.92,5,0)
5^USVBA
"FIA",391.91)
TREATING FACILITY LIST
"FIA",391.91,0)
^DGCN(391.91,
"FIA",391.91,0,0)
391.91IP
"FIA",391.91,0,1)
y^y^p^^^^n^^n
"FIA",391.91,0,10)

"FIA",391.91,0,11)

"FIA",391.91,0,"RLRO")

"FIA",391.91,0,"VR")
5.3^DG
"FIA",391.91,391.91)
1
"FIA",391.91,391.91,.09)

"FIA",391.91,391.91,1)

"FIA",391.91,391.91,20)

"FIA",391.91,391.9101)
0
"FIA",391.92)
VAFC ASSIGNING AUTHORITY
"FIA",391.92,0)
^DGCN(391.92,
"FIA",391.92,0,0)
391.92I
"FIA",391.92,0,1)
y^y^f^^n^^y^o^n
"FIA",391.92,0,10)

"FIA",391.92,0,11)
N X S X=+^(0) I ((X>0)&(X<6))
"FIA",391.92,0,"RLRO")

"FIA",391.92,0,"VR")
5.3^DG
"FIA",391.92,391.92)
0
"IX",391.91,391.91,"AE",0)
391.91^AE^Lookup using all identifier fields.^MU^^F^IR^W^391.9101^^^^^S
"IX",391.91,391.91,"AE",.1,0)
^^3^3^3100726^
"IX",391.91,391.91,"AE",.1,1,0)
This cross-reference will facilitate finding a specific unique identifier 
"IX",391.91,391.91,"AE",.1,2,0)
by SOURCE ID at the sub-file level and INSTITUTION, SOURCE ID TYPE, and 
"IX",391.91,391.91,"AE",.1,3,0)
ASSIGNING AUTHORITY.
"IX",391.91,391.91,"AE",1)
S ^DGCN(391.91,"AID",$E(X(1),1,150),X(2),X(3),X(4),DA(1),DA)=""
"IX",391.91,391.91,"AE",2)
K ^DGCN(391.91,"AID",$E(X(1),1,150),X(2),X(3),X(4),DA(1),DA)
"IX",391.91,391.91,"AE",2.5)
K ^DGCN(391.91,"AID")
"IX",391.91,391.91,"AE",11.1,0)
^.114IA^4^4
"IX",391.91,391.91,"AE",11.1,1,0)
1^F^391.9101^.01^150^1^F
"IX",391.91,391.91,"AE",11.1,2,0)
2^C^^^^2
"IX",391.91,391.91,"AE",11.1,2,1.5)
S X=$P(^DGCN(391.91,DA(1),0),"^",2)
"IX",391.91,391.91,"AE",11.1,3,0)
3^C^^^^3
"IX",391.91,391.91,"AE",11.1,3,1.5)
S X=$P(^DGCN(391.91,DA(1),0),"^",9)
"IX",391.91,391.91,"AE",11.1,4,0)
4^C^^^10^4
"IX",391.91,391.91,"AE",11.1,4,1.5)
S X=$P(^DGCN(391.91,DA(1),0),"^",10)
"IX",391.91,391.91,"AF",0)
391.91^AF^Lookup by SOURCE ID and ASSIGNING AUTHORITY.^MU^^F^IR^W^391.9101^^^^^S
"IX",391.91,391.91,"AF",.1,0)
^^4^4^3100726^
"IX",391.91,391.91,"AF",.1,1,0)
This cross-reference will facilitate finding a specific unique identifier 
"IX",391.91,391.91,"AF",.1,2,0)
by SOURCE ID at the sub-file level and ASSIGNING AUTHORITY when only 
"IX",391.91,391.91,"AF",.1,3,0)
those data fields are present, for example for a National Health 
"IX",391.91,391.91,"AF",.1,4,0)
Information Exchange (NHIE) location.
"IX",391.91,391.91,"AF",1)
S ^DGCN(391.91,"AID2",$E(X(1),1,150),X(2),DA(1),DA)=""
"IX",391.91,391.91,"AF",2)
K ^DGCN(391.91,"AID2",$E(X(1),1,150),X(2),DA(1),DA)
"IX",391.91,391.91,"AF",2.5)
K ^DGCN(391.91,"AID2")
"IX",391.91,391.91,"AF",11.1,0)
^.114IA^2^2
"IX",391.91,391.91,"AF",11.1,1,0)
1^F^391.9101^.01^150^1^F
"IX",391.91,391.91,"AF",11.1,2,0)
2^C^^^10^2
"IX",391.91,391.91,"AF",11.1,2,1.5)
S X=$P(^DGCN(391.91,DA(1),0),"^",10)
"IX",391.91,391.91,"AID",0)
391.91^AID^Find entry using all identifier fields.^R^^R^IR^I^391.91^^^^^S
"IX",391.91,391.91,"AID",.1,0)
^^2^2^3100726^
"IX",391.91,391.91,"AID",.1,1,0)
This cross-reference will facilitate finding a specific unique identifier 
"IX",391.91,391.91,"AID",.1,2,0)
by PATIENT, INSTITUTION, SOURCE ID TYPE, and ASSIGNING AUTHORITY.
"IX",391.91,391.91,"AID",1)
S ^DGCN(391.91,"AID",$E(X(1),1,150),X(2),X(3),$E(X(4),1,10),DA)=""
"IX",391.91,391.91,"AID",2)
K ^DGCN(391.91,"AID",$E(X(1),1,150),X(2),X(3),$E(X(4),1,10),DA)
"IX",391.91,391.91,"AID",2.5)
K ^DGCN(391.91,"AID")
"IX",391.91,391.91,"AID",11.1,0)
^.114IA^4^4
"IX",391.91,391.91,"AID",11.1,1,0)
1^F^391.91^.01^150^1^F
"IX",391.91,391.91,"AID",11.1,2,0)
2^F^391.91^.02^^2^F
"IX",391.91,391.91,"AID",11.1,3,0)
3^F^391.91^.09^^3^F
"IX",391.91,391.91,"AID",11.1,3,3)

"IX",391.91,391.91,"AID",11.1,4,0)
4^F^391.91^1^10^4^F
"IX",391.91,391.91,"AID2",0)
391.91^AID2^Lookup by PATIENT and ASSIGNING AUTHORITY.^R^^R^IR^I^391.91^^^^^S
"IX",391.91,391.91,"AID2",.1,0)
^^4^4^3100726^
"IX",391.91,391.91,"AID2",.1,1,0)
This cross-reference will facilitate finding a specific unique identifier 
"IX",391.91,391.91,"AID2",.1,2,0)
by PATIENT and ASSIGNING AUTHORITY when only those data fields are 
"IX",391.91,391.91,"AID2",.1,3,0)
present, for example for a National Health Information Exchange (NHIE) 
"IX",391.91,391.91,"AID2",.1,4,0)
location.
"IX",391.91,391.91,"AID2",1)
S ^DGCN(391.91,"AID2",$E(X(1),1,150),$E(X(2),1,10),DA)=""
"IX",391.91,391.91,"AID2",2)
K ^DGCN(391.91,"AID2",$E(X(1),1,150),$E(X(2),1,10),DA)
"IX",391.91,391.91,"AID2",2.5)
K ^DGCN(391.91,"AID2")
"IX",391.91,391.91,"AID2",11.1,0)
^.114IA^2^2
"IX",391.91,391.91,"AID2",11.1,1,0)
1^F^391.91^.01^150^1^F
"IX",391.91,391.91,"AID2",11.1,2,0)
2^F^391.91^1^10^2^F
"IX",391.91,391.91,"ASCR",0)
391.91^ASCR^X-REF on SOURCE ID and STATION NUMBER of SOURCE ID^MU^^F^IR^W^391.9101^^^^^A
"IX",391.91,391.91,"ASCR",.1,0)
^^2^2^3100108^
"IX",391.91,391.91,"ASCR",.1,1,0)
The ASCR cross-reference will be used to determine the INSTITUTION 
"IX",391.91,391.91,"ASCR",.1,2,0)
associated with the SOURCE ID.
"IX",391.91,391.91,"ASCR",1)
S ^DGCN(391.91,"ASCR",X(1),X(2),DA(1))=""
"IX",391.91,391.91,"ASCR",2)
K ^DGCN(391.91,"ASCR",X(1),X(2),DA(1))
"IX",391.91,391.91,"ASCR",2.5)
K ^DGCN(391.91,"ASCR")
"IX",391.91,391.91,"ASCR",11.1,0)
^.114IA^2^2
"IX",391.91,391.91,"ASCR",11.1,1,0)
1^F^391.9101^.01^^1^F
"IX",391.91,391.91,"ASCR",11.1,2,0)
2^C^^^^2^F
"IX",391.91,391.91,"ASCR",11.1,2,1.5)
S X=$P(^DGCN(391.91,DA(1),0),"^",2)
"IX",391.92,391.92,"HL24",0)
391.92^HL24^Get IEN for an HL7V2_4 entry.^R^^F^IR^I^391.92^^^^^LS
"IX",391.92,391.92,"HL24",.1,0)
^^2^2^3100423^
"IX",391.92,391.92,"HL24",.1,1,0)
The HL24 cross-reference is used to identify the IDENTIFIER or IEN for the
"IX",391.92,391.92,"HL24",.1,2,0)
HL7V2_4 field values.
"IX",391.92,391.92,"HL24",1)
S ^DGCN(391.92,"HL24",$E(X,1,5),DA)=""
"IX",391.92,391.92,"HL24",2)
K ^DGCN(391.92,"HL24",$E(X,1,5),DA)
"IX",391.92,391.92,"HL24",2.5)
K ^DGCN(391.92,"HL24")
"IX",391.92,391.92,"HL24",11.1,0)
^.114IA^1^1
"IX",391.92,391.92,"HL24",11.1,1,0)
1^F^391.92^.02^5^1^F
"IX",391.92,391.92,"HL24",11.1,1,3)

"IX",391.92,391.92,"HL3",0)
391.92^HL3^Get IEN for an HL7V3_0 entry.^R^^F^IR^I^391.92^^^^^LS
"IX",391.92,391.92,"HL3",.1,0)
^^2^2^3100423^
"IX",391.92,391.92,"HL3",.1,1,0)
The HL3 cross-reference is used to identify the IDENTIFIER or IEN for the
"IX",391.92,391.92,"HL3",.1,2,0)
HL7V3_0 field values.
"IX",391.92,391.92,"HL3",1)
S ^DGCN(391.92,"HL3",$E(X,1,70),DA)=""
"IX",391.92,391.92,"HL3",2)
K ^DGCN(391.92,"HL3",$E(X,1,70),DA)
"IX",391.92,391.92,"HL3",2.5)
K ^DGCN(391.92,"HL3")
"IX",391.92,391.92,"HL3",11.1,0)
^.114IA^1^1
"IX",391.92,391.92,"HL3",11.1,1,0)
1^F^391.92^.03^70^1^F
"IX",391.92,391.92,"HL3",11.1,1,3)

"KRN",8994,281,-1)
0^1
"KRN",8994,281,0)
VAFC AA UPDATE^AAUPD^VAFCRPC^1^P^0^^^1
"KRN",8994,281,1,0)
^^2^2^3100811^
"KRN",8994,281,1,1,0)
This remote procedure call will update assigning authority passed in by 
"KRN",8994,281,1,2,0)
MPI to VAFC ASSIGNING AUTHORITY file #391.92.
"KRN",8994,281,2,0)
^8994.02A^2^1
"KRN",8994,281,2,2,0)
ARRAA^2^2000^1^1
"KRN",8994,281,2,2,1,0)
^^6^6^3100811^
"KRN",8994,281,2,2,1,1,0)
ARRAA may contain the following values:
"KRN",8994,281,2,2,1,2,0)
The values are passed into this RPC from the Master Patient Index (MPI).
"KRN",8994,281,2,2,1,3,0)
 
"KRN",8994,281,2,2,1,4,0)
     ARRAA("HL7V2_4")= value for HL7V2_4 (#.02) field AND/OR
"KRN",8994,281,2,2,1,5,0)
     ARRAA("HL7V3_0")= value for HL7V3_0 (#.03) field
"KRN",8994,281,2,2,1,6,0)
     ARRAA("SOURCEID")= value for DEFAULT SOURCE ID TYPE (#.04) field
"KRN",8994,281,2,"B","ARRAA",2)

"KRN",8994,281,2,"PARAMSEQ",1,2)

"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813^2970721^12541
"PKG",5,22,1,"PAH",1,0)
825^3100907
"PKG",5,22,1,"PAH",1,1,0)
^^3^3^3100907
"PKG",5,22,1,"PAH",1,1,1,0)
SUPPORT FOR NATIONAL HEALTH INFORMATION EXCHANGE
"PKG",5,22,1,"PAH",1,1,2,0)
Refer to patch DG*5.3*825 in the FORUM Patch Module for a complete
"PKG",5,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DGFCPROT")
0^1^B7131954^B4864093
"RTN","DGFCPROT",1,0)
DGFCPROT ;FLB/ALB-DG Field Monitor cross-reference initialing routine. ;06/24/2010 10:51
"RTN","DGFCPROT",2,0)
 ;;5.3;Registration;**273,526,707,825**;AUG 13, 1993;Build 1
"RTN","DGFCPROT",3,0)
 ;
"RTN","DGFCPROT",4,0)
FC(DGDA,DGFILE,DGFIELD,DGTYPE,DGDTH,DGUSER,DGX,DGX1,DGX2,DGOPT) ; Field change listener
"RTN","DGFCPROT",5,0)
 ;Input: DGDA = DA array as exists during Fileman editing
"RTN","DGFCPROT",6,0)
 ;Input: DGFILE = File or subfile number where changed field resides
"RTN","DGFCPROT",7,0)
 ;Input: DGFIELD = Number of changed field
"RTN","DGFCPROT",8,0)
 ;Input: DGTYPE = Type of cross reference action ("SET" or "KILL")
"RTN","DGFCPROT",9,0)
 ;Input: DGDTH = date/time of change in $Horolog format
"RTN","DGFCPROT",10,0)
 ;Input: DGUSER = DUZ of user that made the change
"RTN","DGFCPROT",11,0)
 ;Input: DGX = X array as documented for Fileman new style x-refs
"RTN","DGFCPROT",12,0)
 ;Input: DGX1 = X1 array as documented for Fileman new style x-refs
"RTN","DGFCPROT",13,0)
 ;Input: DGX2 = X2 array as documented for Fileman new style x-refs
"RTN","DGFCPROT",14,0)
 ;Input: DGOPT = current option in "option_name^menu_text" format
"RTN","DGFCPROT",15,0)
 ;
"RTN","DGFCPROT",16,0)
 ;This utility invokes the DG FIELD MONITOR event point protocol.
"RTN","DGFCPROT",17,0)
 ;The DG variables as described above are made available to the
"RTN","DGFCPROT",18,0)
 ;subscribers of this event point.
"RTN","DGFCPROT",19,0)
 ;
"RTN","DGFCPROT",20,0)
 ;NOTE: This event point is not invoked if the action type is "KILL"
"RTN","DGFCPROT",21,0)
 ;      and the old field value is null or the new value is not null.
"RTN","DGFCPROT",22,0)
 ;      It is not invoked if the action type is "SET" and the new 
"RTN","DGFCPROT",23,0)
 ;      field value is null.
"RTN","DGFCPROT",24,0)
 ;
"RTN","DGFCPROT",25,0)
 Q:DGX=""  ;Quit if setting or killing null value
"RTN","DGFCPROT",26,0)
 ;
"RTN","DGFCPROT",27,0)
 I DGTYPE="KILL",DGX2]"" Q  ;Skip kill action on data update
"RTN","DGFCPROT",28,0)
 ;
"RTN","DGFCPROT",29,0)
 ;Manipulate DGTYPE value
"RTN","DGFCPROT",30,0)
 S DGTYPE=$S(DGTYPE="KILL":"DELETE",DGTYPE="SET":"ADD",1:DGTYPE)
"RTN","DGFCPROT",31,0)
 I DGX1]"",DGX2]"" S DGTYPE="UPDATE"
"RTN","DGFCPROT",32,0)
 ;
"RTN","DGFCPROT",33,0)
 S DGOPT=$P(DGOPT,U,1,2) S:DGOPT="" DGOPT="-1^Unknown"  ;Current option
"RTN","DGFCPROT",34,0)
 ; **825,MPIC_2114
"RTN","DGFCPROT",35,0)
 ;see if in reg option and save off values before getting into taskman task job and out of line with reg option
"RTN","DGFCPROT",36,0)
 I $$REG^VAFCDD01() D  Q
"RTN","DGFCPROT",37,0)
 .I (DGFIELD=994)!(DGFIELD=.525)!(DGFIELD=.0906)!(DGFIELD=.121)!(DGFIELD=.133)!(DGFIELD=.134) S VAFCFLDS(DGFIELD_";")=""
"RTN","DGFCPROT",38,0)
 .;The fields below ARE multiples
"RTN","DGFCPROT",39,0)
 .I DGFILE=2.01 S VAFCF="1;" S VAFCFLDS(VAFCF)="" ;ALIAS
"RTN","DGFCPROT",40,0)
 .I DGFILE=2.02 S VAFCF="2.02,.01;" S VAFCFLDS(VAFCF)="" ;RACE INFORMATION
"RTN","DGFCPROT",41,0)
 .I DGFILE=2.06 S VAFCF="2.06,.01;" S VAFCFLDS(VAFCF)="" ;ETHNICITY INFORMATION
"RTN","DGFCPROT",42,0)
 ;
"RTN","DGFCPROT",43,0)
 ;Task off (Taskman) driver routine.
"RTN","DGFCPROT",44,0)
 N ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSAVE,ZTSK,DGVAR,BXREF,SUBSCR,ZTREQ
"RTN","DGFCPROT",45,0)
 S ZTRTN="INIT^DGFCPROT",ZTDESC="DG Field monitor task"
"RTN","DGFCPROT",46,0)
 S ZTIO="DG FIELD MONITOR",ZTDTH=$$NOW^XLFDT
"RTN","DGFCPROT",47,0)
 F DGVAR="DGDA","DGDA(","DGFILE","DGFIELD","DGTYPE","DGDTH","DGUSER","DGX","DGX(","DGX1","DGX1(","DGX2","DGX2(","DGOPT" S ZTSAVE(DGVAR)=""
"RTN","DGFCPROT",48,0)
 ;If there are no subscribers, do not call Taskman
"RTN","DGFCPROT",49,0)
 I $D(VAFCA08) S ZTSAVE("VAFCA08")=VAFCA08 ;**707
"RTN","DGFCPROT",50,0)
 I $D(VAFHCA08) S ZTSAVE("VAFHCA08")=VAFHCA08 ;**707
"RTN","DGFCPROT",51,0)
 S BXREF=0,BXREF=$O(^ORD(101,"B","DG FIELD MONITOR",BXREF))
"RTN","DGFCPROT",52,0)
 S SUBSCR=0,SUBSCR=$O(^ORD(101,BXREF,10,SUBSCR))
"RTN","DGFCPROT",53,0)
 I 'SUBSCR Q
"RTN","DGFCPROT",54,0)
 D ^%ZTLOAD
"RTN","DGFCPROT",55,0)
 Q
"RTN","DGFCPROT",56,0)
 ;
"RTN","DGFCPROT",57,0)
INIT N X
"RTN","DGFCPROT",58,0)
 S X=$O(^ORD(101,"B","DG FIELD MONITOR",0))_";ORD(101," D EN1^XQOR
"RTN","DGFCPROT",59,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","DGFCPROT",60,0)
 K DGDA,DGFILE,DGFIELD,DGTYPE,DGDTH,DGUSER,DGX,DGX1,DGX2,DGOPT
"RTN","DGFCPROT",61,0)
 Q
"RTN","VAFCAAUT")
0^4^B27332848^n/a
"RTN","VAFCAAUT",1,0)
VAFCAAUT ;BIR/CML-VAFC ASSIGNING AUTHORITY FILE (#391.92) Utilities ; 7/13/10
"RTN","VAFCAAUT",2,0)
 ;;5.3;Registration;**825**;Aug 13, 1993;Build 1
"RTN","VAFCAAUT",3,0)
 Q
"RTN","VAFCAAUT",4,0)
 ;
"RTN","VAFCAAUT",5,0)
GETIEN(ASSIGNAU) ;
"RTN","VAFCAAUT",6,0)
 ; for MPIC_2006
"RTN","VAFCAAUT",7,0)
 ; Get IEN of record in the VAFC ASSIGNING AUTHORITY FILE (#391.92).
"RTN","VAFCAAUT",8,0)
 ;
"RTN","VAFCAAUT",9,0)
 ; Input:
"RTN","VAFCAAUT",10,0)
 ;   ASSIGNAU: Assigning Authority
"RTN","VAFCAAUT",11,0)
 ;          example of ASSIGNAU="1.3.6.1.4.1.26580" for HL7 v3.
"RTN","VAFCAAUT",12,0)
 ;          example of ASSIGNAU="USDOD" for HL7 v2.4.
"RTN","VAFCAAUT",13,0)
 ;
"RTN","VAFCAAUT",14,0)
 ; Return: 1) ien of MPI Assigning Authority (#985.55) file
"RTN","VAFCAAUT",15,0)
 ;         2) -1^<comment> if the input is bad or there is an ambiguity
"RTN","VAFCAAUT",16,0)
 ;
"RTN","VAFCAAUT",17,0)
 ;         Example:<ien>
"RTN","VAFCAAUT",18,0)
 ;         Example:"-1^Not found"
"RTN","VAFCAAUT",19,0)
 ;         Example:"-1^Invalid input"
"RTN","VAFCAAUT",20,0)
 ;         Example:"-1^More than one ien found^<ien #1>^<ien #2>..."
"RTN","VAFCAAUT",21,0)
 ;
"RTN","VAFCAAUT",22,0)
 N AA,IEN,INDEX,LIST,RESULT
"RTN","VAFCAAUT",23,0)
 ;
"RTN","VAFCAAUT",24,0)
 ; Check input parameter
"RTN","VAFCAAUT",25,0)
 S AA=$G(ASSIGNAU)
"RTN","VAFCAAUT",26,0)
 Q:AA="" "-1^Invalid input"
"RTN","VAFCAAUT",27,0)
 ;
"RTN","VAFCAAUT",28,0)
 ; Build a list of IENs found in the v2.4 and v3.0 indexes
"RTN","VAFCAAUT",29,0)
 ; making sure each IEN is added only once.
"RTN","VAFCAAUT",30,0)
 F INDEX="HL24","HL3" D
"RTN","VAFCAAUT",31,0)
 .S IEN=0 F  S IEN=$O(^DGCN(391.92,INDEX,AA,IEN)) Q:'IEN  D
"RTN","VAFCAAUT",32,0)
 ..Q:$G(LIST)[("^"_IEN_"^")
"RTN","VAFCAAUT",33,0)
 ..S LIST=$S($G(LIST)="":"^",1:LIST)_IEN_"^"
"RTN","VAFCAAUT",34,0)
 ;
"RTN","VAFCAAUT",35,0)
 ; Remove leading and trailing "^"
"RTN","VAFCAAUT",36,0)
 S:$G(LIST)["^" LIST=$E(LIST,2,$L(LIST)-1)
"RTN","VAFCAAUT",37,0)
 ;
"RTN","VAFCAAUT",38,0)
 ; Set the result
"RTN","VAFCAAUT",39,0)
 I $G(LIST)="" S RESULT="-1^Not found" Q RESULT
"RTN","VAFCAAUT",40,0)
 I $G(LIST)["^" S RESULT="-1^More than one ien found^"_LIST Q RESULT
"RTN","VAFCAAUT",41,0)
 S RESULT=LIST
"RTN","VAFCAAUT",42,0)
 ;
"RTN","VAFCAAUT",43,0)
 Q RESULT
"RTN","VAFCAAUT",44,0)
 ;
"RTN","VAFCAAUT",45,0)
ADD(ARRAY,ERROR) ;API to add an entry to the VAFC ASSIGNING AUTHORITY FILE (#391.92)  ;**825, MPIC_2007
"RTN","VAFCAAUT",46,0)
 ;
"RTN","VAFCAAUT",47,0)
 ;Acceptable input scenarios:
"RTN","VAFCAAUT",48,0)
 ;HL7V2_4 only and no SOURCEID,
"RTN","VAFCAAUT",49,0)
 ;HL7V2_4 and HL7V3_0 and no SOURCEID, or
"RTN","VAFCAAUT",50,0)
 ;HL7V3_0 only and SOURCEID
"RTN","VAFCAAUT",51,0)
 ;
"RTN","VAFCAAUT",52,0)
 ;Input ARRAY:
"RTN","VAFCAAUT",53,0)
 ;  ARRAY("HL7V2_4")= value for HL7V2_4 (#.02) field AND/OR
"RTN","VAFCAAUT",54,0)
 ;  ARRAY("HL7V3_0")= value for HL7V3_0 (#.03) field
"RTN","VAFCAAUT",55,0)
 ;  ARRAY("SOURCEID")= value for DEFAULT SOURCE ID TYPE (#.04) field
"RTN","VAFCAAUT",56,0)
 ;
"RTN","VAFCAAUT",57,0)
 ;Output:
"RTN","VAFCAAUT",58,0)
 ;  -1^error text - record add failed
"RTN","VAFCAAUT",59,0)
 ;  or
"RTN","VAFCAAUT",60,0)
 ;  IEN of the entry (new or previously existing)
"RTN","VAFCAAUT",61,0)
 ;
"RTN","VAFCAAUT",62,0)
 ;   Example: S ARRAY("HL7V3_0")="1234.5678.9876"
"RTN","VAFCAAUT",63,0)
 ;            S ARRAY("SOURCEID")="NI"
"RTN","VAFCAAUT",64,0)
 ;            S VAL=$$ADD^VAFCAAUT(.ARRAY,.ERR)
"RTN","VAFCAAUT",65,0)
 ;            VAL=6
"RTN","VAFCAAUT",66,0)
 ;
"RTN","VAFCAAUT",67,0)
 ;Check incoming data for invalid input
"RTN","VAFCAAUT",68,0)
 N FLD02,FLD03,FOUND,IEN,JJ,PC,RESULT,SRC,SRCID,SRCVAL
"RTN","VAFCAAUT",69,0)
 S RESULT="-1^Invalid input parameter.  ",SRCID=""
"RTN","VAFCAAUT",70,0)
 I '$D(ARRAY) Q RESULT ;No input data
"RTN","VAFCAAUT",71,0)
 ;Don't accept null input values
"RTN","VAFCAAUT",72,0)
 I $D(ARRAY("HL7V2_4")) I ARRAY("HL7V2_4")="" Q RESULT
"RTN","VAFCAAUT",73,0)
 I $D(ARRAY("HL7V3_0")) I ARRAY("HL7V3_0")="" Q RESULT
"RTN","VAFCAAUT",74,0)
 I $D(ARRAY("SOURCEID")) I ARRAY("SOURCEID")="" Q RESULT
"RTN","VAFCAAUT",75,0)
 ;
"RTN","VAFCAAUT",76,0)
 ;Must have either HL7_2.4 OR HL7_3.0 value input
"RTN","VAFCAAUT",77,0)
 I '$D(ARRAY("HL7V2_4"))&('$D(ARRAY("HL7V3_0"))) S RESULT=RESULT_"Assigning Authority value missing." Q RESULT
"RTN","VAFCAAUT",78,0)
 ;If both HL7_2.4 and HL7_3.0 values input, there must be NO SOURCEID
"RTN","VAFCAAUT",79,0)
 I $D(ARRAY("HL7V2_4"))&($D(ARRAY("HL7V3_0"))) D SOURCE I SRCID S RESULT=RESULT_"SOURCEID value must not be passed in." Q RESULT
"RTN","VAFCAAUT",80,0)
 ;If HL7V2_4 value input but not HL7V3_0, there must be NO SOURCEID
"RTN","VAFCAAUT",81,0)
 I $D(ARRAY("HL7V2_4"))&('$D(ARRAY("HL7V3_0"))) D SOURCE I SRCID S RESULT=RESULT_"SOURCEID value must not be passed in." Q RESULT
"RTN","VAFCAAUT",82,0)
 ;If HL7V3_0 value input but not HL7V2_4, then SOURCEID must be present
"RTN","VAFCAAUT",83,0)
 I '$D(ARRAY("HL7V2_4"))&($D(ARRAY("HL7V3_0"))) D SOURCE I 'SRCID S RESULT=RESULT_"SOURCEID value missing." Q RESULT
"RTN","VAFCAAUT",84,0)
 ;
"RTN","VAFCAAUT",85,0)
 ;If SOURCEID passed in, must have valid value
"RTN","VAFCAAUT",86,0)
 I $D(ARRAY("SOURCEID")) S FOUND=0 D  I 'FOUND S RESULT=RESULT_"Invalid SOURCEID value passed in." Q RESULT
"RTN","VAFCAAUT",87,0)
 .S SRCVAL=$$GET1^DID(391.92,.04,"","POINTER","","MSG") ;valid values
"RTN","VAFCAAUT",88,0)
 .F PC=1:1:($L(SRCVAL,";")-1) S SRC=$P($P(SRCVAL,";",PC),":") I ARRAY("SOURCEID")=SRC S FOUND=1
"RTN","VAFCAAUT",89,0)
 ;
"RTN","VAFCAAUT",90,0)
 ;If HL7V2_4 value passed in, must have valid value
"RTN","VAFCAAUT",91,0)
 I $D(ARRAY("HL7V2_4")) D  I $L(ARRAY("HL7V2_4"))>FLD02("FIELD LENGTH") S RESULT=RESULT_"Assigning Authority value too long." Q RESULT
"RTN","VAFCAAUT",92,0)
 .D FIELD^DID(391.92,.02,"","FIELD LENGTH","FLD02")
"RTN","VAFCAAUT",93,0)
 ;Ensure that HL7V2_4 value passed in is upper case.
"RTN","VAFCAAUT",94,0)
 I $D(ARRAY("HL7V2_4")) S ARRAY("HL7V2_4")=$$UP^XLFSTR(ARRAY("HL7V2_4"))
"RTN","VAFCAAUT",95,0)
 ;If HL7V3_0 value passed in, must have valid value
"RTN","VAFCAAUT",96,0)
 I $D(ARRAY("HL7V3_0")) D  I $L(ARRAY("HL7V3_0"))>FLD03("FIELD LENGTH") S RESULT=RESULT_"Assigning Authority value too long." Q RESULT
"RTN","VAFCAAUT",97,0)
 .D FIELD^DID(391.92,.03,"","FIELD LENGTH","FLD03")
"RTN","VAFCAAUT",98,0)
 I $D(ARRAY("HL7V3_0"))  I ARRAY("HL7V3_0")'?1N.NP S RESULT=RESULT_"HL73_0 value must contain only numerics/punctuation." Q RESULT
"RTN","VAFCAAUT",99,0)
 ;
"RTN","VAFCAAUT",100,0)
 ;Is entry already in the file? If so, quit with that IEN
"RTN","VAFCAAUT",101,0)
 S FOUND=0 F JJ="HL7V2_4","HL7V3_0" I $D(ARRAY(JJ)) S IEN=$$GETIEN^VAFCAAUT(ARRAY(JJ)) D  I FOUND Q
"RTN","VAFCAAUT",102,0)
 .I $P(IEN,"^")>0 S RESULT=IEN S FOUND=1 Q
"RTN","VAFCAAUT",103,0)
 .;Remote possibility that the GETIEN API will return an anomaly
"RTN","VAFCAAUT",104,0)
 .I $P(IEN,"^",2)="More than one ien found" S RESULT=IEN S FOUND=1 Q  ;Anomaly - should not happen
"RTN","VAFCAAUT",105,0)
 .;otherwise ien="-1^Not found", code will fall into module below
"RTN","VAFCAAUT",106,0)
 I FOUND Q RESULT
"RTN","VAFCAAUT",107,0)
 ;
"RTN","VAFCAAUT",108,0)
 ;Good input data, and entry does not already exist
"RTN","VAFCAAUT",109,0)
 ;Add entry to VAFC ASSIGNING AUTHORITY FILE (#391.92)
"RTN","VAFCAAUT",110,0)
 N DIC,DINUM,DR,LAST,X,Y
"RTN","VAFCAAUT",111,0)
 L +^DGCN(391.92,0):600
"RTN","VAFCAAUT",112,0)
 S (LAST,X)=0
"RTN","VAFCAAUT",113,0)
 S LAST=+$O(^DGCN(391.92,"@"),-1) ;Last entry # in file
"RTN","VAFCAAUT",114,0)
 S (X,DINUM)=LAST+1 ;Next available #
"RTN","VAFCAAUT",115,0)
 S DIC="^DGCN(391.92,",DIC(0)="FZ"
"RTN","VAFCAAUT",116,0)
 ;Set up DR string
"RTN","VAFCAAUT",117,0)
 I $D(ARRAY("HL7V2_4")) S DIC("DR")=".02///^S X=ARRAY(""HL7V2_4"")"_";"
"RTN","VAFCAAUT",118,0)
 I $D(ARRAY("HL7V3_0")) S DIC("DR")=$G(DIC("DR"))_".03///^S X=ARRAY(""HL7V3_0"")"_";"
"RTN","VAFCAAUT",119,0)
 I $D(ARRAY("SOURCEID")) S DIC("DR")=$G(DIC("DR"))_".04///^S X=ARRAY(""SOURCEID"")"_";"
"RTN","VAFCAAUT",120,0)
 ;
"RTN","VAFCAAUT",121,0)
 K DO D FILE^DICN K DO
"RTN","VAFCAAUT",122,0)
 L -^DGCN(391.92,0)
"RTN","VAFCAAUT",123,0)
 I +Y=-1 S RESULT="-1^Unable to create new entry in the VAFC ASSIGNING AUTHORITY FILE (#391.92)." Q RESULT
"RTN","VAFCAAUT",124,0)
 S RESULT=+Y
"RTN","VAFCAAUT",125,0)
 Q RESULT
"RTN","VAFCAAUT",126,0)
 ;
"RTN","VAFCAAUT",127,0)
SOURCE ;Is SOURCEID defined?
"RTN","VAFCAAUT",128,0)
 S SRCID=$S($D(ARRAY("SOURCEID")):1,1:0)
"RTN","VAFCAAUT",129,0)
 Q
"RTN","VAFCRPC")
0^3^B7679300^B7443211
"RTN","VAFCRPC",1,0)
VAFCRPC ;BIR/DLR-RPC ENTRY POINTS ; 8/11/10 6:18pm
"RTN","VAFCRPC",2,0)
 ;;5.3;Registration;**414,440,474,477,479,825**;Aug 13, 1993;Build 1
"RTN","VAFCRPC",3,0)
 ;;Routine uses the following supported IAs #2701 and #3027.
"RTN","VAFCRPC",4,0)
PDAT(RETURN,VALUE,SSN) ;remote pdat display
"RTN","VAFCRPC",5,0)
 ;'value' will pass in either an icn, ssn, dfn or patient name
"RTN","VAFCRPC",6,0)
 N ARRAY,DFN,ICN,NAME,SSN,VAFCSEN
"RTN","VAFCRPC",7,0)
 I $O(VALUE(""))="" S VALUE("ICN")=VALUE ;backwards compatibility - sites passing in an icn
"RTN","VAFCRPC",8,0)
 S ICN=$G(VALUE("ICN")) ;icn (local or national) passed in from mpi
"RTN","VAFCRPC",9,0)
 S NAME=$G(VALUE("NAME")) ;patient name passed in from mpi
"RTN","VAFCRPC",10,0)
 S SSN=$G(VALUE("SSN")) ;social security number passed in from mpi
"RTN","VAFCRPC",11,0)
 S DFN=$G(VALUE("DFN")) ;patient file ien passed in from mpi
"RTN","VAFCRPC",12,0)
 I $G(SSN)'="" S DFN=$O(^DPT("SSN",SSN,0)) I DFN="" S RETURN(1)="-1^Invalid SSN passed into RPC" Q
"RTN","VAFCRPC",13,0)
 I $G(ICN)'="" S DFN=$$GETDFN^MPIF001(ICN) I +DFN<0 S RETURN(1)="-1^Invalid ICN passed into RPC" Q  ;IA 2701
"RTN","VAFCRPC",14,0)
 I $G(NAME)'="" S DFN=$O(^DPT("B",NAME,0)) I DFN="" S RETURN(1)="-1^Invalid NAME passed into RPC" Q
"RTN","VAFCRPC",15,0)
 I $S('$G(DFN):1,'$D(^DPT(DFN,0)):1,1:0) S RETURN(1)="-1^Invalid DFN passed into RPC" Q
"RTN","VAFCRPC",16,0)
 ;log patient sensitivity on receiving system and send msg bulletin
"RTN","VAFCRPC",17,0)
 ;D NOTICE^DGSEC4(.VAFCSEN,DFN,"RPC - VAFC REMOTE AUDIT FROM THE MPI^Remote Audit Query",3) ;IA #3027
"RTN","VAFCRPC",18,0)
 S ARRAY="^TMP(""VAFCHFS"","_$J_")"
"RTN","VAFCRPC",19,0)
 D HFS^VAFCHFS("START^VAFCPDAT")
"RTN","VAFCRPC",20,0)
 ;M RETURN=@ARRAY
"RTN","VAFCRPC",21,0)
 D DSPPDAT^VAFCHFS(.RETURN)
"RTN","VAFCRPC",22,0)
 K ^TMP("VAFCHFS",$J)
"RTN","VAFCRPC",23,0)
 Q
"RTN","VAFCRPC",24,0)
 ;
"RTN","VAFCRPC",25,0)
AUDIT(RETURN,VALUE,SSN,SDT,EDT) ;remote audit display
"RTN","VAFCRPC",26,0)
 ;'value' will pass in either an icn, ssn, dfn or patient name
"RTN","VAFCRPC",27,0)
 N ARRAY,DFN,ICN,NAME,SSN,VAFCSEN
"RTN","VAFCRPC",28,0)
 S ICN=$G(VALUE("ICN")) ;icn (local or national) passed in
"RTN","VAFCRPC",29,0)
 S NAME=$G(VALUE("NAME")) ;patient name passed in
"RTN","VAFCRPC",30,0)
 S SSN=$G(VALUE("SSN")) ;social security number passed in
"RTN","VAFCRPC",31,0)
 S DFN=$G(VALUE("DFN")) ;patient file ien passed in
"RTN","VAFCRPC",32,0)
 I $G(SSN)'="" S DFN=$O(^DPT("SSN",SSN,0)) I DFN="" S RETURN(1)="-1^Invalid SSN passed into RPC" Q
"RTN","VAFCRPC",33,0)
 I $G(ICN)'="" S DFN=$$GETDFN^MPIF001(ICN) I +DFN<0 S RETURN(1)="-1^Invalid ICN passed into RPC" Q  ;IA 2701
"RTN","VAFCRPC",34,0)
 I $G(NAME)'="" S DFN=$O(^DPT("B",NAME,0)) I DFN="" S RETURN(1)="-1^Invalid NAME passed into RPC" Q
"RTN","VAFCRPC",35,0)
 I $S('$G(DFN):1,'$D(^DPT(DFN,0)):1,1:0) S RETURN(1)="-1^Invalid DFN passed into RPC" Q
"RTN","VAFCRPC",36,0)
 ;log patient sensitivity on receiving system and send msg bulletin
"RTN","VAFCRPC",37,0)
 ;D NOTICE^DGSEC4(.VAFCSEN,DFN,"RPC - VAFC REMOTE AUDIT FROM THE MPI^Remote Audit Query",3) ;IA #3027
"RTN","VAFCRPC",38,0)
 S ARRAY="^TMP(""VAFCHFS"","_$J_")"
"RTN","VAFCRPC",39,0)
 D HFS^VAFCHFS("START^VAFCAUD(DFN,SDT,EDT,1)")
"RTN","VAFCRPC",40,0)
 ;M RETURN=@ARRAY
"RTN","VAFCRPC",41,0)
 D DSPPDAT^VAFCHFS(.RETURN)
"RTN","VAFCRPC",42,0)
 K ^TMP("VAFCHFS",$J)
"RTN","VAFCRPC",43,0)
 Q
"RTN","VAFCRPC",44,0)
AAUPD(RETURN,ARRAA) ;Assigning authority update
"RTN","VAFCRPC",45,0)
 ;RPC: VAFC AA UPDATE
"RTN","VAFCRPC",46,0)
 S RETURN=$$ADD^VAFCAAUT(.ARRAA,.ERR)
"RTN","VAFCRPC",47,0)
 Q
"RTN","VAFCSB")
0^2^B8780845^B8457410
"RTN","VAFCSB",1,0)
VAFCSB ;BIR/CMC-CONT ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS ;7/9/2010
"RTN","VAFCSB",2,0)
 ;;5.3;Registration;**707,756,825**;Aug 13, 1993;Build 1
"RTN","VAFCSB",3,0)
 ;
"RTN","VAFCSB",4,0)
 ;Reference to $$XAMDT^RAO7UTL1 is supported by IA #4875
"RTN","VAFCSB",5,0)
 ;Reference to RESUTLS^LRPXAPI is supported by IA #4245
"RTN","VAFCSB",6,0)
 ;
"RTN","VAFCSB",7,0)
PV2() ;build pv2 segment
"RTN","VAFCSB",8,0)
 N PV2,LSTA,APPT,VASD,VAIP,VARP,VAROOT
"RTN","VAFCSB",9,0)
 S PV2=""
"RTN","VAFCSB",10,0)
 ;get next outpatient appointment
"RTN","VAFCSB",11,0)
 K ^UTILITY("VASD",$J) S VASD("F")=DT D SDA^VADPT
"RTN","VAFCSB",12,0)
 S APPT=$P($G(^UTILITY("VASD",$J,1,"I")),"^")
"RTN","VAFCSB",13,0)
 I APPT'="" S $P(PV2,HL("FS"),9)=$$HLDATE^HLFNC(APPT)
"RTN","VAFCSB",14,0)
 ;GET LAST ADMISSION DATE
"RTN","VAFCSB",15,0)
 K VAIP S VAIP("D")="LAST",VAIP("M")=0 D IN5^VADPT
"RTN","VAFCSB",16,0)
 ; **825,CR_1184: for PV2-14, it will be re-set as the 15th piece
"RTN","VAFCSB",17,0)
 ; in PV2 segment a few lines below
"RTN","VAFCSB",18,0)
 ; I VAIP(2)="1^ADMISSION" S $P(PV2,HL("FS"),15)=$$HLDATE^HLFNC($P(VAIP(3),"^"))
"RTN","VAFCSB",19,0)
 I VAIP(2)="1^ADMISSION" S $P(PV2,HL("FS"),14)=$$HLDATE^HLFNC($P(VAIP(3),"^"))
"RTN","VAFCSB",20,0)
 ;get last registration
"RTN","VAFCSB",21,0)
 S VAROOT="VARP"
"RTN","VAFCSB",22,0)
 D REG^VADPT
"RTN","VAFCSB",23,0)
 I $D(VARP(1,"I")),$G(VARP(1,"I"))>0 S $P(PV2,HL("FS"),46)=$$HLDATE^HLFNC($P(VARP(1,"I"),"^"),"DT"),$P(PV2,HL("FS"),24)="CR"
"RTN","VAFCSB",24,0)
 ;**756 ^ ONLY RETURN DATE FOR LAST REGISTRATION AS HL7 STANDARD CAN ONLY HAVE DATE
"RTN","VAFCSB",25,0)
 I PV2'="" S PV2="PV2"_HL("FS")_PV2
"RTN","VAFCSB",26,0)
 Q PV2
"RTN","VAFCSB",27,0)
PHARA() ;build obx to show active prescriptions
"RTN","VAFCSB",28,0)
 N RET S RET=""
"RTN","VAFCSB",29,0)
 I '$$PATCH^XPDUTL("PSS*1.0*101") Q RET
"RTN","VAFCSB",30,0)
 N PHARM,DGLIST
"RTN","VAFCSB",31,0)
 S PHARM="" D PROF^PSO52API(DFN,"DGLIST")
"RTN","VAFCSB",32,0)
 I +$G(^TMP($J,"DGLIST",DFN,0))>0 S PHARM="OBX"_HL("FS")_HL("FS")_"CE"_HL("FS")_"ACTIVE PRESCRIPTIONS"_HL("FS")_HL("FS")_"Y"
"RTN","VAFCSB",33,0)
 ;**756 CE added as the data type
"RTN","VAFCSB",34,0)
 Q PHARM
"RTN","VAFCSB",35,0)
LABE() ;BUILD OBX FOR LAST LAB TEST DATE
"RTN","VAFCSB",36,0)
 N OBX S OBX=""
"RTN","VAFCSB",37,0)
 I '$$PATCH^XPDUTL("LR*5.2*295") Q OBX
"RTN","VAFCSB",38,0)
 N LAB,LAB2,EN
"RTN","VAFCSB",39,0)
 S LAB="" K ^TMP("DGLAB",$J) D RESULTS^LRPXAPI("DGLAB",DFN,"C")
"RTN","VAFCSB",40,0)
 S EN=$O(^TMP("DGLAB",$J,"")) I EN'="" S LAB=$P($G(^TMP("DGLAB",$J,EN)),"^")
"RTN","VAFCSB",41,0)
 K ^TMP("DGLAB",$J) D RESULTS^LRPXAPI("DGLAB",DFN,"A")
"RTN","VAFCSB",42,0)
 S EN=$O(^TMP("DGLAB",$J,"")) I EN'="" S LAB2=$P($G(^TMP("DGLAB",$J,EN)),"^") I LAB2>LAB S LAB=LAB2
"RTN","VAFCSB",43,0)
 K ^TMP("DGLAB",$J) D RESULTS^LRPXAPI("DGLAB",DFN,"M")
"RTN","VAFCSB",44,0)
 S EN=$O(^TMP("DGLAB",$J,"")) I EN'="" S LAB2=$P($G(^TMP("DGLAB",$J,EN)),"^") I LAB2>LAB S LAB=LAB2
"RTN","VAFCSB",45,0)
 I LAB'="" D
"RTN","VAFCSB",46,0)
 .S $P(OBX,HL("FS"),2)="TS" ;**756 added the data type
"RTN","VAFCSB",47,0)
 .S $P(OBX,HL("FS"),3)="LAST LAB TEST DATE/TIME"
"RTN","VAFCSB",48,0)
 .S $P(OBX,HL("FS"),11)="F"
"RTN","VAFCSB",49,0)
 .S $P(OBX,HL("FS"),14)=$$HLDATE^HLFNC(LAB)
"RTN","VAFCSB",50,0)
 .S OBX="OBX"_HL("FS")_OBX
"RTN","VAFCSB",51,0)
 Q OBX
"RTN","VAFCSB",52,0)
RADE() ;BUILD OBX FOR LAST RADIOLOGY TEST DATE
"RTN","VAFCSB",53,0)
 N RET S RET=""
"RTN","VAFCSB",54,0)
 I '$$PATCH^XPDUTL("RA*5.0*76") Q RET
"RTN","VAFCSB",55,0)
 N RAD,RADE
"RTN","VAFCSB",56,0)
 S RAD="",RADE=$$XAMDT^RAO7UTL1(DFN) I +RADE<1 Q RAD
"RTN","VAFCSB",57,0)
 I +RADE>0 D
"RTN","VAFCSB",58,0)
 .S $P(OBX,HL("FS"),2)="TS" ;**756 added the data type
"RTN","VAFCSB",59,0)
 .S $P(RAD,HL("FS"),3)="LAST RADIOLOGY EXAM DATE/TIME"
"RTN","VAFCSB",60,0)
 .S $P(RAD,HL("FS"),11)="F"
"RTN","VAFCSB",61,0)
 .S $P(RAD,HL("FS"),14)=$$HLDATE^HLFNC(RADE)
"RTN","VAFCSB",62,0)
 .S RAD="OBX"_HL("FS")_RAD
"RTN","VAFCSB",63,0)
 Q RAD
"RTN","VAFCSB",64,0)
PD1() ;BUILD PD1 segment
"RTN","VAFCSB",65,0)
 ;PREFERRED FACILITY -- NOT GOING TO BE PASSED PER IMDQ 9/7/06
"RTN","VAFCSB",66,0)
 N TEAM,PD1
"RTN","VAFCSB",67,0)
 S PD1=""
"RTN","VAFCSB",68,0)
 ;S TEAM=$$PREF^DGENPTA(DFN)
"RTN","VAFCSB",69,0)
 ;I TEAM'="" S PD1="PD1"_HL("FS")_HL("FS")_HL("FS")_$$STA^XUAF4(TEAM)
"RTN","VAFCSB",70,0)
 Q PD1
"RTN","VAFCSB",71,0)
PV1() ;BUILD PV1 SEGMENT
"RTN","VAFCSB",72,0)
 ;CURRENTLY ADMITTED?
"RTN","VAFCSB",73,0)
 N PV1,VAINDT
"RTN","VAFCSB",74,0)
 S PV1=""
"RTN","VAFCSB",75,0)
 S VAINDT=DT
"RTN","VAFCSB",76,0)
 D INP^VADPT
"RTN","VAFCSB",77,0)
 I $G(VAIN(1))'="" S $P(PV1,HL("FS"),44)=$$HLDATE^HLFNC($P(VAIN(7),"^")),PV1="PV1"_HL("FS")_PV1
"RTN","VAFCSB",78,0)
 K VAIN
"RTN","VAFCSB",79,0)
 Q PV1
"SEC","^DIC",391.92,391.92,0,"DD")
@
"SEC","^DIC",391.92,391.92,0,"RD")
@
"UP",391.91,391.9101,-1)
391.91^1
"UP",391.91,391.9101,0)
391.9101
"VER")
8.0^22.0
"^DD",391.91,391.91,.09,0)
SOURCE ID TYPE^S^NI:National unique individual identifier;PI:Patient internal identifier;PN:Person number;EI:Employee number;SS:Social Security number;NPI:National provider identifier;^0;9^Q
"^DD",391.91,391.91,.09,.1)
Source ID Type
"^DD",391.91,391.91,.09,3)
Enter the SOURCE ID TYPE value for this entry.
"^DD",391.91,391.91,.09,21,0)
^^6^6^3100721^
"^DD",391.91,391.91,.09,21,1,0)
The SOURCE ID TYPE field defines the data source for this entry.  
"^DD",391.91,391.91,.09,21,2,0)
The source ID type is a reference to the HL7 Table 0203, Identifier Type, 
"^DD",391.91,391.91,.09,21,3,0)
and the VA Identity Management user defined values: NI (National 
"^DD",391.91,391.91,.09,21,4,0)
Identifier), PI (Patient Identifier), PN (Person Number), EI (Employee 
"^DD",391.91,391.91,.09,21,5,0)
Identifier), SS (Social Security Number), and NPI (National Provider 
"^DD",391.91,391.91,.09,21,6,0)
Identifier).
"^DD",391.91,391.91,.09,"DT")
3100726
"^DD",391.91,391.91,1,0)
ASSIGNING AUTHORITY^P391.92'a^DGCN(391.92,^0;10^Q
"^DD",391.91,391.91,1,.1)
Assigning Authority
"^DD",391.91,391.91,1,3)
Enter the ASSIGNING AUTHORITY for this entry.
"^DD",391.91,391.91,1,21,0)
^^9^9^3100721^
"^DD",391.91,391.91,1,21,1,0)
ASSIGNING AUTHORITY is the entity that established the identification 
"^DD",391.91,391.91,1,21,2,0)
number for the PATIENT entry.  This field is a pointer to the VAFC 
"^DD",391.91,391.91,1,21,3,0)
ASSIGNING AUTHORITY (#391.92) file, which is based on the Health Level 
"^DD",391.91,391.91,1,21,4,0)
Seven (HL7) standardized table 0363.
"^DD",391.91,391.91,1,21,5,0)
  
"^DD",391.91,391.91,1,21,6,0)
The ASSIGNING AUTHORITY selected will determine if messaging identifiers
"^DD",391.91,391.91,1,21,7,0)
should be in HL7 v3.0 format for National Health Information Network use
"^DD",391.91,391.91,1,21,8,0)
or in HL7 v2.4 format for Non-Patient use in the future or existing
"^DD",391.91,391.91,1,21,9,0)
PATIENT records.
"^DD",391.91,391.91,1,"AUDIT")
y
"^DD",391.91,391.91,1,"DT")
3100805
"^DD",391.91,391.91,20,0)
SOURCE ID^391.9101A^^1;0
"^DD",391.91,391.91,20,21,0)
^.001^13^13^3100716^^
"^DD",391.91,391.91,20,21,1,0)
SOURCE ID is the unique system assigned identifier at the identified 
"^DD",391.91,391.91,20,21,2,0)
facility for the patient record.  The value of SOURCE ID varies, 
"^DD",391.91,391.91,20,21,3,0)
depending on the source facility.
"^DD",391.91,391.91,20,21,4,0)
  
"^DD",391.91,391.91,20,21,5,0)
If SOURCE ID is from the Master Patient Index, the value is the 
"^DD",391.91,391.91,20,21,6,0)
Integration Control Number (ICN).  If SOURCE ID is from the Department of 
"^DD",391.91,391.91,20,21,7,0)
Defense (DoD), the value is the Electronic Data Interchange Personal 
"^DD",391.91,391.91,20,21,8,0)
Identifier (EDIPI), which is their equivalent of an ICN.  In the future, 
"^DD",391.91,391.91,20,21,9,0)
SOURCE ID may come from other sources due to additional initiatives.
"^DD",391.91,391.91,20,21,10,0)
  
"^DD",391.91,391.91,20,21,11,0)
SOURCE ID is a multiple because a patient seen at disparate systems 
"^DD",391.91,391.91,20,21,12,0)
(e.g., VAMC and DoD) may have a different identifier on each system which 
"^DD",391.91,391.91,20,21,13,0)
is unique to that system.
"^DD",391.91,391.9101,0)
SOURCE ID SUB-FIELD^^1^2
"^DD",391.91,391.9101,0,"DT")
3100716
"^DD",391.91,391.9101,0,"IX","B",391.9101,.01)

"^DD",391.91,391.9101,0,"NM","SOURCE ID")

"^DD",391.91,391.9101,0,"UP")
391.91
"^DD",391.91,391.9101,.01,0)
SOURCE ID^Fa^^0;1^K:$L(X)>150!($L(X)<1) X
"^DD",391.91,391.9101,.01,.1)
SourceID
"^DD",391.91,391.9101,.01,1,0)
^.1
"^DD",391.91,391.9101,.01,1,1,0)
391.9101^B
"^DD",391.91,391.9101,.01,1,1,1)
S ^DGCN(391.91,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",391.91,391.9101,.01,1,1,2)
K ^DGCN(391.91,DA(1),1,"B",$E(X,1,30),DA)
"^DD",391.91,391.9101,.01,3)
Answer must be 1-150 characters in length.
"^DD",391.91,391.9101,.01,21,0)
^.001^13^13^3100716^^^^
"^DD",391.91,391.9101,.01,21,1,0)
SOURCE ID is the unique system assigned identifier at the identified 
"^DD",391.91,391.9101,.01,21,2,0)
facility for the patient record.  The value of SOURCE ID varies, 
"^DD",391.91,391.9101,.01,21,3,0)
depending on the source facility.
"^DD",391.91,391.9101,.01,21,4,0)
  
"^DD",391.91,391.9101,.01,21,5,0)
If SOURCE ID is from the Master Patient Index, the value is the 
"^DD",391.91,391.9101,.01,21,6,0)
Integration Control Number (ICN).  If SOURCE ID is from the Department of 
"^DD",391.91,391.9101,.01,21,7,0)
Defense (DoD), the value is the Electronic Data Interchange Personal 
"^DD",391.91,391.9101,.01,21,8,0)
Identifier (EDIPI), which is their equivalent of an ICN.  In the future, 
"^DD",391.91,391.9101,.01,21,9,0)
SOURCE ID may come from other sources due to additional initiatives.
"^DD",391.91,391.9101,.01,21,10,0)
  
"^DD",391.91,391.9101,.01,21,11,0)
SOURCE ID is a multiple because a patient seen at disparate systems 
"^DD",391.91,391.9101,.01,21,12,0)
(e.g., VAMC and DoD) may have a different identifier on each system which 
"^DD",391.91,391.9101,.01,21,13,0)
is unique to that system.
"^DD",391.91,391.9101,.01,"AUDIT")
y
"^DD",391.91,391.9101,.01,"DT")
3100726
"^DD",391.91,391.9101,1,0)
IDENTIFIER STATUS^S^A:Active;H:Merged;^0;2^Q
"^DD",391.91,391.9101,1,.1)
Identifier Status
"^DD",391.91,391.9101,1,3)
Enter the status for this SourceID.
"^DD",391.91,391.9101,1,21,0)
^.001^11^11^3100714^^
"^DD",391.91,391.9101,1,21,1,0)
The IDENTIFIER STATUS field supports the upcoming Joint VA/DoD Medical 
"^DD",391.91,391.9101,1,21,2,0)
Center, Veteran's Record Management (VRM), and Virtual Lifetime 
"^DD",391.91,391.9101,1,21,3,0)
Electronic Record (VLER) initiatives.  This field allows the capture of 
"^DD",391.91,391.9101,1,21,4,0)
the resolved duplicate events and exposes the related identifier and 
"^DD",391.91,391.9101,1,21,5,0)
identifier status to the consuming applications.
"^DD",391.91,391.9101,1,21,6,0)
  
"^DD",391.91,391.9101,1,21,7,0)
A value of "A" indicates that the patient record is an active record on 
"^DD",391.91,391.9101,1,21,8,0)
the identifying system (e.g., VAMC or DoD).
"^DD",391.91,391.9101,1,21,9,0)
A value of "H" indicates that the patient record was identified as part 
"^DD",391.91,391.9101,1,21,10,0)
of a duplicate pair, has been merged, and is no longer active on the 
"^DD",391.91,391.9101,1,21,11,0)
identifying system (e.g., VAMC or DoD).
"^DD",391.91,391.9101,1,"DT")
3100107
"^DD",391.92,391.92,0)
FIELD^^.04^4
"^DD",391.92,391.92,0,"DDA")
N
"^DD",391.92,391.92,0,"DT")
3100716
"^DD",391.92,391.92,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",391.92,391.92,0,"ID",.03)
W "   ",$P(^(0),U,3)
"^DD",391.92,391.92,0,"IX","B",391.92,.01)

"^DD",391.92,391.92,0,"NM","VAFC ASSIGNING AUTHORITY")

"^DD",391.92,391.92,0,"PT",391.91,1)

"^DD",391.92,391.92,.01,0)
IDENTIFIER^RNJ10,0X^^0;1^K:+X'=X!(X>9999999999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",391.92,391.92,.01,.1)
ID
"^DD",391.92,391.92,.01,1,0)
^.1
"^DD",391.92,391.92,.01,1,1,0)
391.92^B
"^DD",391.92,391.92,.01,1,1,1)
S ^DGCN(391.92,"B",$E(X,1,30),DA)=""
"^DD",391.92,391.92,.01,1,1,2)
K ^DGCN(391.92,"B",$E(X,1,30),DA)
"^DD",391.92,391.92,.01,3)
Enter a number between 1 and 9999999999, 0 decimal digits.
"^DD",391.92,391.92,.01,21,0)
^.001^6^6^3100720^^^
"^DD",391.92,391.92,.01,21,1,0)
The IDENTIFIER is a DINUMED field used to distinguish an ASSIGNING 
"^DD",391.92,391.92,.01,21,2,0)
AUTHORITY entry.  An IDENTIFIER entry may contain information for either 
"^DD",391.92,391.92,.01,21,3,0)
the Health Level Seven v2.4 or v3.0 standard, or both.  Entries 1 through 
"^DD",391.92,391.92,.01,21,4,0)
5 are populated and exported with the file.  New entries can be 
"^DD",391.92,391.92,.01,21,5,0)
dynamically created as needed, and are likely to utilize only the HL7 
"^DD",391.92,391.92,.01,21,6,0)
v3.0 standard.
"^DD",391.92,391.92,.01,"DT")
3100422
"^DD",391.92,391.92,.02,0)
HL7V2_4^F^^0;2^K:$L(X)>5!($L(X)<1) X
"^DD",391.92,391.92,.02,.1)
HL7 Version 2.4
"^DD",391.92,391.92,.02,3)
Answer must be 1-5 characters in length.
"^DD",391.92,391.92,.02,21,0)
^^2^2^3100720^
"^DD",391.92,391.92,.02,21,1,0)
The HL7V2_4 field is the namespace ID subcomponent of the assigning 
"^DD",391.92,391.92,.02,21,2,0)
authority component in the standard PID-3 identifier.
"^DD",391.92,391.92,.02,"DT")
3100423
"^DD",391.92,391.92,.03,0)
HL7V3_0^F^^0;3^K:$L(X)>70!($L(X)<1) X
"^DD",391.92,391.92,.03,.1)
HL7 Version 3.0
"^DD",391.92,391.92,.03,3)
Answer must be 1-70 characters in length.
"^DD",391.92,391.92,.03,21,0)
^^2^2^3100720^
"^DD",391.92,391.92,.03,21,1,0)
The HL7V3_0 field is the universal ID subcomponent of the assigning 
"^DD",391.92,391.92,.03,21,2,0)
authority component in the standard PID-3 identifier.
"^DD",391.92,391.92,.03,"DT")
3100423
"^DD",391.92,391.92,.04,0)
DEFAULT SOURCE ID TYPE^S^NI:National unique individual identifier;PI:Patient internal identifier;PN:Person number;EI:Employee number;SS:Social Security number;NPI:National provider identifier;^0;4^Q
"^DD",391.92,391.92,.04,.1)
Default Source ID Type
"^DD",391.92,391.92,.04,3)
Enter the DEFAULT SOURCE ID TYPE value for this entry.
"^DD",391.92,391.92,.04,21,0)
^^6^6^3100720^
"^DD",391.92,391.92,.04,21,1,0)
The DEFAULT SOURCE ID TYPE field defines the data source for this entry.  
"^DD",391.92,391.92,.04,21,2,0)
The source ID type is a reference to the HL7 Table 0203, Identifier Type, 
"^DD",391.92,391.92,.04,21,3,0)
and the VA Identity Management user defined values: NI (National 
"^DD",391.92,391.92,.04,21,4,0)
Identifier), PI (Patient Identifier), PN (Person Number), EI (Employee 
"^DD",391.92,391.92,.04,21,5,0)
Identifier), SS (Social Security Number), and NPI (National Provider 
"^DD",391.92,391.92,.04,21,6,0)
Identifier).
"^DD",391.92,391.92,.04,"DT")
3100720
"^DIC",391.92,391.92,0)
VAFC ASSIGNING AUTHORITY^391.92
"^DIC",391.92,391.92,0,"GL")
^DGCN(391.92,
"^DIC",391.92,391.92,"%D",0)
^1.001^6^6^3100423^^
"^DIC",391.92,391.92,"%D",1,0)
The VAFC ASSIGNING AUTHORITY (#391.92) file expands the capability of VA 
"^DIC",391.92,391.92,"%D",2,0)
Identity Management Service (IdM) to support future initiatives, (e.g., 
"^DIC",391.92,391.92,"%D",3,0)
National Health Information Network (NHIN) and non-Patient Identity 
"^DIC",391.92,391.92,"%D",4,0)
Management, etc.).  This file stores a portion of the data used to 
"^DIC",391.92,391.92,"%D",5,0)
assemble fully qualified identifiers used for either the Health Level 
"^DIC",391.92,391.92,"%D",6,0)
Seven v2.4 or v3.0 standard.
"^DIC",391.92,"B","VAFC ASSIGNING AUTHORITY",391.92)

"BLD",2796,6)
^736
**END**
**END**
