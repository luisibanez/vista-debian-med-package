Released DG*5.3*787 SEQ #744
Extracted from mail message
**KIDS**:DG*5.3*787^

**INSTALL NAME**
DG*5.3*787
"BLD",8604,0)
DG*5.3*787^REGISTRATION^0^3110307^y
"BLD",8604,1,0)
^^1^1^3110307^
"BLD",8604,1,1,0)
DG*5.3*787 patch corrects two SAC (Standards and Conventions) violations.
"BLD",8604,4,0)
^9.64PA^^
"BLD",8604,6.3)
1
"BLD",8604,"KRN",0)
^9.67PA^779.2^20
"BLD",8604,"KRN",.4,0)
.4
"BLD",8604,"KRN",.401,0)
.401
"BLD",8604,"KRN",.402,0)
.402
"BLD",8604,"KRN",.403,0)
.403
"BLD",8604,"KRN",.5,0)
.5
"BLD",8604,"KRN",.84,0)
.84
"BLD",8604,"KRN",3.6,0)
3.6
"BLD",8604,"KRN",3.8,0)
3.8
"BLD",8604,"KRN",9.2,0)
9.2
"BLD",8604,"KRN",9.8,0)
9.8
"BLD",8604,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",8604,"KRN",9.8,"NM",1,0)
DGPTTS3^^0^B23553405
"BLD",8604,"KRN",9.8,"NM",2,0)
DGPTFTR^^0^B20387661
"BLD",8604,"KRN",9.8,"NM","B","DGPTFTR",2)

"BLD",8604,"KRN",9.8,"NM","B","DGPTTS3",1)

"BLD",8604,"KRN",19,0)
19
"BLD",8604,"KRN",19.1,0)
19.1
"BLD",8604,"KRN",101,0)
101
"BLD",8604,"KRN",409.61,0)
409.61
"BLD",8604,"KRN",771,0)
771
"BLD",8604,"KRN",779.2,0)
779.2
"BLD",8604,"KRN",870,0)
870
"BLD",8604,"KRN",8989.51,0)
8989.51
"BLD",8604,"KRN",8989.52,0)
8989.52
"BLD",8604,"KRN",8994,0)
8994
"BLD",8604,"KRN","B",.4,.4)

"BLD",8604,"KRN","B",.401,.401)

"BLD",8604,"KRN","B",.402,.402)

"BLD",8604,"KRN","B",.403,.403)

"BLD",8604,"KRN","B",.5,.5)

"BLD",8604,"KRN","B",.84,.84)

"BLD",8604,"KRN","B",3.6,3.6)

"BLD",8604,"KRN","B",3.8,3.8)

"BLD",8604,"KRN","B",9.2,9.2)

"BLD",8604,"KRN","B",9.8,9.8)

"BLD",8604,"KRN","B",19,19)

"BLD",8604,"KRN","B",19.1,19.1)

"BLD",8604,"KRN","B",101,101)

"BLD",8604,"KRN","B",409.61,409.61)

"BLD",8604,"KRN","B",771,771)

"BLD",8604,"KRN","B",779.2,779.2)

"BLD",8604,"KRN","B",870,870)

"BLD",8604,"KRN","B",8989.51,8989.51)

"BLD",8604,"KRN","B",8989.52,8989.52)

"BLD",8604,"KRN","B",8994,8994)

"BLD",8604,"QDEF")
^^^^NO^^^^^^YES
"BLD",8604,"QUES",0)
^9.62^^
"BLD",8604,"REQB",0)
^9.611^2^2
"BLD",8604,"REQB",1,0)
DG*5.3*645^2
"BLD",8604,"REQB",2,0)
DG*5.3*729^2
"BLD",8604,"REQB","B","DG*5.3*645",1)

"BLD",8604,"REQB","B","DG*5.3*729",2)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
787^3110307
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3110307
"PKG",5,22,1,"PAH",1,1,1,0)
DG*5.3*787 patch corrects two SAC (Standards and Conventions) violations.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DGPTFTR")
0^2^B20387661^B19046836
"RTN","DGPTFTR",1,0)
DGPTFTR ;ALB/JDS - TRANSMISSION OF PTF ; 6/29/10 3:57pm
"RTN","DGPTFTR",2,0)
 ;;5.3;Registration;**37,415,530,601,614,645,787**;Aug 13, 1993;Build 1
"RTN","DGPTFTR",3,0)
 ;
"RTN","DGPTFTR",4,0)
ENN L +^DGP(45.83):$G(DILOCKTM,5) I '$T W !,"Already transmitting" Q  ;787 add +,DILOCKTM
"RTN","DGPTFTR",5,0)
 D CEN^DGPTUTL
"RTN","DGPTFTR",6,0)
 I '$D(DGRTY) S Y=1 D RTY^DGPTUTL
"RTN","DGPTFTR",7,0)
 D FDT^DGPTUTL S DGFMTDT=Y
"RTN","DGPTFTR",8,0)
 ;
"RTN","DGPTFTR",9,0)
EN5 K DIC S DIC=45.83,DIC(0)="AMZEQ",DIC("A")="Enter Start Date: "
"RTN","DGPTFTR",10,0)
 S DIC("S")="I $O(^DGP(45.83,+Y,""P"",0)) F DGX=0:0 S DGX=$O(^DGP(45.83,+Y,""P"",DGX)) Q:'DGX  I '$P(^DGP(45.83,+Y,""P"",DGX,0),U,2),$D(^DGPT(DGX,0)),$D(^(70)),+^(70)>2901000,$P(^(0),U,11)=+DGRTY Q"
"RTN","DGPTFTR",11,0)
 S D="ANT" D IX^DIC G ENQ1:X["^"!(X=""),EN5:Y'>0
"RTN","DGPTFTR",12,0)
 S DGSD=+Y(0),DIC(0)="EAMZQ",DIC("S")="I Y'<DGSD"_" "_DIC("S"),DIC("A")="Enter Through Date: TODAY//  ",D="ANT" D IX^DIC K DIC,D
"RTN","DGPTFTR",13,0)
 ;
"RTN","DGPTFTR",14,0)
 G ENQ1:X["^" S DGED=$S(Y>0:+Y(0),1:DT)
"RTN","DGPTFTR",15,0)
 ; -- 125 cols
"RTN","DGPTFTR",16,0)
 S VATNAME="PTF125" D ^VATRAN I VATERR K VATNAME,VATERR,VAT L -^DGP(45.83) G ENQ
"RTN","DGPTFTR",17,0)
 S DGFMT=2 D SCAN G:DGOUTX ENQ1
"RTN","DGPTFTR",18,0)
ENQ D SCAN^DGPTFTR3
"RTN","DGPTFTR",19,0)
ENQ1 L -^DGP(45.83) K DGACNT,DGXM,XMDUN,XMY,DGOUTX,DGSTCNT,DIC,DGX,DGRTY,DGRTY0,DGCN,DGCN0,DGPTFMT,DGFMT,DGFMTDT,DGLOGIC,VAT,VATERR,VATNAME,DGSD,DGED ;787 change L to  full - lock.
"RTN","DGPTFTR",20,0)
 Q
"RTN","DGPTFTR",21,0)
 ;
"RTN","DGPTFTR",22,0)
SCAN K DGERR S DGPTFMT=2 D LOG S DGCNT=1,DGD=DGSD-.01,DGTR=0,DGID=1
"RTN","DGPTFTR",23,0)
 ; DG*5.3*614 - DGFIRST identifies first record in a batch
"RTN","DGPTFTR",24,0)
 N DGFIRST S DGFIRST=1
"RTN","DGPTFTR",25,0)
 W !!,"Now transmitting 125 column ",$P(DGRTY0,U)," records..."
"RTN","DGPTFTR",26,0)
 W !,"Includes records of "
"RTN","DGPTFTR",27,0)
 ;
"RTN","DGPTFTR",28,0)
DAT D:DGCNT>1 XMIT S DGD=$O(^DGP(45.83,DGD))
"RTN","DGPTFTR",29,0)
 I DGD>0,DGD'>DGED D SETTRAN^DGPTUTL1 Q:DGOUTX
"RTN","DGPTFTR",30,0)
 I DGD'>0!(DGD>DGED) D BULL^DGPTFTR3 G DATQ
"RTN","DGPTFTR",31,0)
 S J=0 G PWR
"RTN","DGPTFTR",32,0)
DATQ Q
"RTN","DGPTFTR",33,0)
 ;
"RTN","DGPTFTR",34,0)
PWR S P=J,J=$O(^DGP(45.83,DGD,"P",J)) G DAT:J'>0,PWR:$P(^(J,0),U,2)
"RTN","DGPTFTR",35,0)
 I $D(^DGPT(J,0)),$P(^(0),U,11)'=+DGRTY G PWR
"RTN","DGPTFTR",36,0)
 I $P(DGCN0,U,3)>DT,DGRTY=1 D CEN^DGPTFTR3 G PWR:'Y
"RTN","DGPTFTR",37,0)
 S Y=$S($D(^DGPT(J,70)):+^(70),1:0) D FMT^DGPTUTL G PWR:DGPTFMT'=DGFMT
"RTN","DGPTFTR",38,0)
 S T1=0,T2=9999999,Y=J,X=0 S:DGRTY=2 T2=+DGCN0_".9",T1=+$P(DGCN0,U,5) D LINES^DGPTFVC2 I (DGCNT+X)>VAT("F"),'$G(DGFIRST) S J=P G XMIT
"RTN","DGPTFTR",39,0)
 I $G(DGFIRST)=1 S DGFIRST=0
"RTN","DGPTFTR",40,0)
 K DICR S DGERR=0,DGSTCNT("P",J)=DGCNT
"RTN","DGPTFTR",41,0)
 W !,$E($P(^DPT(+^DGPT(J,0),0),U),1,25),?27,"(#",J,")" S X=^DGPT(J,0) D WR^DGPTF
"RTN","DGPTFTR",42,0)
 K ^TMP("AEDIT",$J),^TMP("AERROR",$J) S DGACNT=0
"RTN","DGPTFTR",43,0)
 I DGRTY=1 D COM
"RTN","DGPTFTR",44,0)
 I DGRTY=2 S T2=+DGCN0_".9",T1=+$P(DGCN0,U,5),(PTF,DGCI)=J D COM1
"RTN","DGPTFTR",45,0)
 I DGERR D OPEN^DGPTFTR3
"RTN","DGPTFTR",46,0)
 K ^TMP("AEDIT",$J)
"RTN","DGPTFTR",47,0)
 I 'DGERR W ?70," Okay" S DGTR=DGTR+1 G XMIT:DGCNT>VAT("F")
"RTN","DGPTFTR",48,0)
 G PWR
"RTN","DGPTFTR",49,0)
 Q
"RTN","DGPTFTR",50,0)
 ;
"RTN","DGPTFTR",51,0)
XMIT K XMY D ROUTER
"RTN","DGPTFTR",52,0)
 S XMZ=DGXMZ,^XMB(3.9,XMZ,2,0)="^3.92A^"_(DGCNT-1)_"^"_(DGCNT-1)_"^"_DT,DGJ=J
"RTN","DGPTFTR",53,0)
 S XMDUZ=.5,XMDUN=$P(^VA(200,DUZ,0),U) D ENT1^XMD
"RTN","DGPTFTR",54,0)
 W !,"Transmission Queued" S DGIDN(DGID)=XMZ
"RTN","DGPTFTR",55,0)
 F DGK=0:0 S DGK=$O(DGSTCNT("P",DGK)) Q:DGK'>0  D REC
"RTN","DGPTFTR",56,0)
 S DGFIRST=1
"RTN","DGPTFTR",57,0)
 K DGK S DGCNT=1,DGID=DGID+1,J=DGJ Q:J'>0  D SETTRAN^DGPTUTL1 G:'DGOUTX PWR
"RTN","DGPTFTR",58,0)
 Q
"RTN","DGPTFTR",59,0)
 ;
"RTN","DGPTFTR",60,0)
REC ;
"RTN","DGPTFTR",61,0)
 S DGSENFLG=""
"RTN","DGPTFTR",62,0)
 S DIE="^DGP(45.83,",DA=DGD,DR="10///"_DGK,DR(2,45.831)="1///TODAY;2///"_XMZ D ^DIE K DA,DR,DIE
"RTN","DGPTFTR",63,0)
 S DIE="^DGPT(",DR="6///3",DA=DGK D ^DIE K DA,DR,DIE
"RTN","DGPTFTR",64,0)
 K DGSENFLG
"RTN","DGPTFTR",65,0)
 Q
"RTN","DGPTFTR",66,0)
 ;
"RTN","DGPTFTR",67,0)
COM S T1=0,T2=9999999 S:'$D(PTF) PTF=J S:PTF'=J PTF=J
"RTN","DGPTFTR",68,0)
COM1 F K=0,70,71,101,"401P" S @("DG"_K)=$S($D(^DGPT(J,K)):^(K),1:"")
"RTN","DGPTFTR",69,0)
 F K=10,.11,.3,.32,.321,.52,57 S @("DG"_$S(K[".":$E(K,2,99),1:K))=$S($D(^DGP(45.84,J,K)):^(K),$D(^DPT(+^DGPT(J,0),$S(K'=10:K,1:0))):$S(K'=10:^(K),1:^(0)),1:"")
"RTN","DGPTFTR",70,0)
 F K=.02,.06 M @("DG"_$S(K[".":$E(K,2,99),1:K))=^DPT(+^DGPT(J,0),K)
"RTN","DGPTFTR",71,0)
 D ^DGPTFTR0:DGPTFMT=1,^DGPTR0:DGPTFMT=2
"RTN","DGPTFTR",72,0)
 ;
"RTN","DGPTFTR",73,0)
Q L -^DGP(45.83) F K=0,10,701,"401P",101,11,3,32,41,52,57,70,321,502,702,"02","06" K @("DG"_K) ;787 change L  to full - lock.
"RTN","DGPTFTR",74,0)
 K DGCDR,DGT,DIC,DGADM,DGAO,DGDOB,DGHEAD,DGJ,DGK,DGL,DGM,DGNAM,DGNT,DGO,DGSSN,DGSUD,DGSUR,DGTD,DGX,DGXLS,E,ERR,F,G,H,I,K,L,T,W,Z,DGPROC,DGPROCD ;** NOTE: do not kill variables needed by PTF load/edit option!!!
"RTN","DGPTFTR",75,0)
 I $D(DGERR),DGERR<1 D ^DGPTFVC1 D:'T1 ^DGPTFVC3
"RTN","DGPTFTR",76,0)
 I $D(DGERR),DGERR<1 D EN^DGPTFVC2
"RTN","DGPTFTR",77,0)
 Q
"RTN","DGPTFTR",78,0)
 ;
"RTN","DGPTFTR",79,0)
LOG ;called from PRINT+1^DGPTF2,CLS+1^DGPTF2,EN^DGPTFVC
"RTN","DGPTFTR",80,0)
 D LOG^DGPTFTR1:DGPTFMT=1,LOG^DGPTR1:DGPTFMT=2,COM:$D(DGERR)
"RTN","DGPTFTR",81,0)
 Q
"RTN","DGPTFTR",82,0)
 ;
"RTN","DGPTFTR",83,0)
 ;-- check for real queue if census should be removed for national rel
"RTN","DGPTFTR",84,0)
ROUTER S XMDUZ=.5 F DGSDI=0:0 S DGSDI=$O(VAT(DGSDI)) Q:'DGSDI  S X=VAT(DGSDI),XMN=0,XMDF="" D INST^XMA21 K XMN,XMDF
"RTN","DGPTFTR",85,0)
 S XMY(DUZ)=""
"RTN","DGPTFTR",86,0)
 Q
"RTN","DGPTTS3")
0^1^B23553405^B22744602
"RTN","DGPTTS3",1,0)
DGPTTS3 ;ALB/MJK - Physical Mvt ; 2/10/11 6:19pm
"RTN","DGPTTS3",2,0)
 ;;5.3;Registration;**26,61,549,729,787**;Aug 13, 1993;Build 1
"RTN","DGPTTS3",3,0)
 ;
"RTN","DGPTTS3",4,0)
EN ; -- entry used to update PTF rec
"RTN","DGPTTS3",5,0)
 ;  input: PTF := PTF#
"RTN","DGPTTS3",6,0)
 ;         DFN := pt#
"RTN","DGPTTS3",7,0)
 ;      DGPMCA := adm mvt #
"RTN","DGPTTS3",8,0)
 ;        DGDT := d/c date
"RTN","DGPTTS3",9,0)
 ;
"RTN","DGPTTS3",10,0)
 S DGPTIFN=PTF
"RTN","DGPTTS3",11,0)
 D FDT^DGPTUTL G ENQ:$S(DGDT:DGDT,1:DT)<Y
"RTN","DGPTTS3",12,0)
 I '$D(ZTQUEUED),'$G(DGQUIET) W !,"Now updating ward MPCR information..."
"RTN","DGPTTS3",13,0)
 S (DGBEG,DGSTART,DGLAST)=Y-.0000001
"RTN","DGPTTS3",14,0)
 S X=Y I $E(X,6,7)="00" S X1=X,X2=-1 D C^%DTC
"RTN","DGPTTS3",15,0)
 S DGPFYDT=$P(X,".")_".2359" ; last date/time in previous FY
"RTN","DGPTTS3",16,0)
 D KILL
"RTN","DGPTTS3",17,0)
 N DGRT S DGRT="^DGPM(""APCA"",DFN,DGPMCA)"
"RTN","DGPTTS3",18,0)
 ;
"RTN","DGPTTS3",19,0)
 ; -- build ward table
"RTN","DGPTTS3",20,0)
 S DGDATA="",DGADM0=$S($D(^DGPM(DGPMCA,0)):^(0),1:"")
"RTN","DGPTTS3",21,0)
 I DGADM0,DGADM0'>DGSTART S DGT=DGPFYDT D ^DGINPW I +DG1 S $P(DGXFR0,U,4)=+DG1 D TABLE
"RTN","DGPTTS3",22,0)
 I DGADM0,DGADM0>DGSTART S $P(DGXFR0,U,4)=$P(DGADM0,U,6),DGBEG=+DGADM0 D TABLE
"RTN","DGPTTS3",23,0)
 F DGXDT=DGSTART:0 S DGXDT=$O(@DGRT@(DGXDT)) Q:'DGXDT  F DGMVT=0:0 S DGMVT=$O(@DGRT@(DGXDT,DGMVT)) Q:'DGMVT  I $D(^DGPM(DGMVT,0)) S X=^(0) I $P(X,U,2)=2 S DGXFR0=$P(X,U,18)_"^^^"_$P(X,U,6) D TABLE
"RTN","DGPTTS3",24,0)
 G ENQ:DGDATA=""
"RTN","DGPTTS3",25,0)
 S DGEND=$S(DGDT:DGDT,1:DT) D DAYS S DGXDT=($S(DGDT:DGDT,1:"")),$P(DGDATA,U,3,4)=LEAVE_U_PASS,$P(DGDATA,U,7)=1 D CREATE
"RTN","DGPTTS3",26,0)
 ;
"RTN","DGPTTS3",27,0)
ENQ I $D(DGSACNT),DGSACNT>25 D FLCHK
"RTN","DGPTTS3",28,0)
 S L=DGPTIFN
"RTN","DGPTTS3",29,0)
 K DGRT,DGADM0,DG1,DGDATA,DGMDT,DGPTIFN,DGXFR0,DGXDT,DGM,X,DGM0,LEAVE,PASS,DGBEG,DGEND,DGSTART,DGWD,DGCDR,DGSP,DGADM0,DGPFYDT,DGT,DGA1,DGSAFTF,DGSACNT,DGWI,DGI
"RTN","DGPTTS3",30,0)
 Q
"RTN","DGPTTS3",31,0)
 ;
"RTN","DGPTTS3",32,0)
TABLE ; -- setup 535 node data
"RTN","DGPTTS3",33,0)
 ;  DGDATA := 1:ward cdr ^ 2:ward specialty  ^ 3:leave days ^ 4:pass days ^ ^ 6:ward ^ ^ ^ ^ 10:mvt date/time
"RTN","DGPTTS3",34,0)
 ;
"RTN","DGPTTS3",35,0)
 S DGWD=+$P(DGXFR0,U,4)
"RTN","DGPTTS3",36,0)
 G TABLEQ:'$D(^DIC(42,DGWD,0)) S DGSP=+$P(^(0),U,12)
"RTN","DGPTTS3",37,0)
 G TABLEQ:'$D(^DIC(42.4,DGSP,0)) S DGCDR=$P(^(0),U,6)
"RTN","DGPTTS3",38,0)
 ; -- create MPCR mvt if ward mpcr changes
"RTN","DGPTTS3",39,0)
 I DGDATA]"",+DGDATA'=DGCDR S DGEND=DGXDT D DAYS S $P(DGDATA,U,3,4)=LEAVE_U_PASS D CREATE S DGDATA=DGCDR_"^"_DGSP_"^^^^"_DGWD,DGLAST=DGBEG,DGBEG=DGEND
"RTN","DGPTTS3",40,0)
 I DGDATA="",DGCDR]"" S DGDATA=DGCDR_"^"_DGSP_"^^^^"_DGWD
"RTN","DGPTTS3",41,0)
TABLEQ Q
"RTN","DGPTTS3",42,0)
 ;
"RTN","DGPTTS3",43,0)
CREATE ; -- create MPCR mvt
"RTN","DGPTTS3",44,0)
 F  L +^DGPT(DGPTIFN,535):$G(DILOCKTM,3) Q:$T  W !,"Another user is editing this record, trying again...",!
"RTN","DGPTTS3",45,0)
 S Y=^DGPT(DGPTIFN,535,0),I=$P(Y,U,3)
"RTN","DGPTTS3",46,0)
L S I=I+1 G L:$D(^DGPT(DGPTIFN,535,I))
"RTN","DGPTTS3",47,0)
 S $P(^DGPT(DGPTIFN,535,0),U,3,4)=I_U_($P(Y,U,4)+1)
"RTN","DGPTTS3",48,0)
 S X=DGDATA,^DGPT(DGPTIFN,535,I,0)=I_U_$P(X,U,2)_U_$P(X,U,3)_U_$P(X,U,4)_"^^"_$P(X,U,6)_"^"_$P(X,U,7)_"^^^"_DGXDT L -^DGPT(DGPTIFN,535)
"RTN","DGPTTS3",49,0)
 K DA S DA=I,DA(1)=DGPTIFN,DIK="^DGPT("_DGPTIFN_",535," D IX1^DIK
"RTN","DGPTTS3",50,0)
CREATEQ S DGSACNT=I
"RTN","DGPTTS3",51,0)
 K DA,I,DIK Q
"RTN","DGPTTS3",52,0)
 ;
"RTN","DGPTTS3",53,0)
KILL ; -- clean out ward mvts
"RTN","DGPTTS3",54,0)
 F DGWI=0:0 S DGWI=$O(^DGPT(DGPTIFN,535,DGWI)) Q:'DGWI  S:$P(^(DGWI,0),U,17)="n" DGSAFTF(DGWI)=^(0) K DA S DA(1)=DGPTIFN,DA=DGWI,DIK="^DGPT("_DGPTIFN_",535," D ^DIK K DA
"RTN","DGPTTS3",55,0)
 S:'$D(^DGPT(DGPTIFN,535,0)) ^(0)="^45.0535^"
"RTN","DGPTTS3",56,0)
 K DIK,DGWI,DA Q
"RTN","DGPTTS3",57,0)
 ;
"RTN","DGPTTS3",58,0)
T ; -- test tag
"RTN","DGPTTS3",59,0)
 S DIC(0)="AEMQZ",DIC=45,DIC("S")="I $P(^(0),U,11)=1" D ^DIC K DIC Q:Y<0
"RTN","DGPTTS3",60,0)
PTF S PTF=+Y,DGDT=$S($D(^DGPT(L,70)):+^(70),1:0),DFN=+Y(0) D PM^DGPTUTL,EN:DGPMCA
"RTN","DGPTTS3",61,0)
 Q
"RTN","DGPTTS3",62,0)
 ;
"RTN","DGPTTS3",63,0)
DAYS ; -- calc leave and pass days from DGBEG to DGEND
"RTN","DGPTTS3",64,0)
 ; -- if last 501 date is after last 535 date then
"RTN","DGPTTS3",65,0)
 ;    calc from last 535 mvt d/t to last 501 mvt d/t
"RTN","DGPTTS3",66,0)
 ;
"RTN","DGPTTS3",67,0)
 ;      535          501    501        535
"RTN","DGPTTS3",68,0)
 ;       |------------|------|----------|
"RTN","DGPTTS3",69,0)
 ;        <<<<<<<<<<< total >>>>>>>>>>
"RTN","DGPTTS3",70,0)
 ;        <<<<<<< diff >>>>>>+<< pass >>
"RTN","DGPTTS3",71,0)
 ;
"RTN","DGPTTS3",72,0)
 S (PASS,LEAVE,DGDIFP,DGDIFL)=0 D MVT
"RTN","DGPTTS3",73,0)
 I DGMDT>DGBEG S DGE=DGEND,DGEND=DGMDT D DAYS0 S DGDIFL=LEAVE,DGDIFP=PASS,DGEND=DGE
"RTN","DGPTTS3",74,0)
 ; -- calc from last 535 mvt d/t to new 535 mvt d/t
"RTN","DGPTTS3",75,0)
 S (PASS,LEAVE)=0 D DAYS0
"RTN","DGPTTS3",76,0)
 ; -- substract 'diff' from 'total'
"RTN","DGPTTS3",77,0)
 S PASS=PASS-DGDIFP,LEAVE=LEAVE-DGDIFL
"RTN","DGPTTS3",78,0)
 K DGDIFL,DGDIFP,DGE Q
"RTN","DGPTTS3",79,0)
 ;
"RTN","DGPTTS3",80,0)
DAYS0 ;
"RTN","DGPTTS3",81,0)
 N DGMVT
"RTN","DGPTTS3",82,0)
 F DGMVTDT=(DGBEG-.0000001):0 S DGMVTDT=$O(@DGRT@(DGMVTDT)) Q:'DGMVTDT  F DGMVT=0:0 S DGMVT=$O(@DGRT@(DGMVTDT,DGMVT)) Q:'DGMVT  I $D(^DGPM(DGMVT,0)),$P(^(0),U,2)=2 S C=$P(^(0),U,18) I C=1!(C=2)!(C=3) D NEXT,DAYS1
"RTN","DGPTTS3",83,0)
 K DGMVTDT Q
"RTN","DGPTTS3",84,0)
 ;
"RTN","DGPTTS3",85,0)
DAYS1 S I=DGMVTDT,X2=$S(I<DGBEG:DGBEG,1:I),X1=$S(Y>DGBEG&(Y'>DGEND):Y,Y>DGEND!('Y):DGEND,1:X2)
"RTN","DGPTTS3",86,0)
 I X1>X2 D ^%DTC S:C=1 PASS=PASS+X S:C=2 LEAVE=LEAVE+X
"RTN","DGPTTS3",87,0)
 K C,X,Y,X1,X2,I
"RTN","DGPTTS3",88,0)
 Q
"RTN","DGPTTS3",89,0)
 ;
"RTN","DGPTTS3",90,0)
NEXT ; -- find next x-ref date
"RTN","DGPTTS3",91,0)
 N DGMVT
"RTN","DGPTTS3",92,0)
 F Y=DGMVTDT:0 S Y=$O(@DGRT@(Y)) Q:'Y  F DGMVT=0:0 S DGMVT=$O(@DGRT@(Y,DGMVT)) Q:'DGMVT  I $D(^DGPM(DGMVT,0)),$P(^(0),U,2)=2 G NEXTQ
"RTN","DGPTTS3",93,0)
NEXTQ Q
"RTN","DGPTTS3",94,0)
 ;
"RTN","DGPTTS3",95,0)
MVT ; -- find last 501 mvt d/t since the last 535 mvt d/t
"RTN","DGPTTS3",96,0)
 ;    and before the new 535 mvt d/t
"RTN","DGPTTS3",97,0)
 S DGMDT=""
"RTN","DGPTTS3",98,0)
 F M=DGLAST:0 S M=$O(^DGPT(DGPTIFN,"M","AM",M)) Q:'M!(M>DGEND)  S DGMDT=M
"RTN","DGPTTS3",99,0)
 K M Q
"RTN","DGPTTS3",100,0)
 ;
"RTN","DGPTTS3",101,0)
FLCHK ; -- check if more than 25 535s, then re-set x-mit flags
"RTN","DGPTTS3",102,0)
 I '$D(DGSACNT) G FLQ
"RTN","DGPTTS3",103,0)
 I DGSACNT<25 G FLQ
"RTN","DGPTTS3",104,0)
 S DGF1=0
"RTN","DGPTTS3",105,0)
 F DGWI=0:0 S DGWI=$O(DGSAFTF(DGWI)) Q:'DGWI!('$D(^DGPT(DGPTIFN,535,+DGWI,0)))  F DGI=1,2,10,16 S:$P(^(0),U,DGI)'=$P(DGSAFTF(DGWI),U,DGI) DGF1=1
"RTN","DGPTTS3",106,0)
 I 'DGF1,'DGWI F DGWI=0:0 S DGWI=$O(DGSAFTF(DGWI)) Q:'DGWI  S DA=DGWI,DA(1)=DGPTIFN,DIE="^DGPT("_DGPTIFN_",535,",DR="17///n" D ^DIE
"RTN","DGPTTS3",107,0)
FLQ K DGI,DGF1,DGWI,DGSAFTF,DGSACNT,DR,DA,DIE
"RTN","DGPTTS3",108,0)
 Q
"RTN","DGPTTS3",109,0)
 ;
"VER")
8.0^22.0
"BLD",8604,6)
^744
**END**
**END**
