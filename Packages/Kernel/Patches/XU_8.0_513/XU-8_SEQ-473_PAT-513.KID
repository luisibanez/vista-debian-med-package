Released XU*8*513 SEQ #473
Extracted from mail message
**KIDS**:XU*8.0*513^

**INSTALL NAME**
XU*8.0*513
"BLD",1376,0)
XU*8.0*513^KERNEL^0^3120223^y
"BLD",1376,1,0)
^^2^2^3111230^
"BLD",1376,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",1376,1,2,0)
under patch XU*8*513.
"BLD",1376,4,0)
^9.64PA^8992.3^1
"BLD",1376,4,8992.3,0)
8992.3
"BLD",1376,4,8992.3,222)
y^n^f^^n^^y^o^n
"BLD",1376,4,"B",8992.3,8992.3)

"BLD",1376,6.3)
13
"BLD",1376,"KRN",0)
^9.67PA^9002226^21
"BLD",1376,"KRN",.4,0)
.4
"BLD",1376,"KRN",.401,0)
.401
"BLD",1376,"KRN",.402,0)
.402
"BLD",1376,"KRN",.403,0)
.403
"BLD",1376,"KRN",.5,0)
.5
"BLD",1376,"KRN",.84,0)
.84
"BLD",1376,"KRN",3.6,0)
3.6
"BLD",1376,"KRN",3.8,0)
3.8
"BLD",1376,"KRN",9.2,0)
9.2
"BLD",1376,"KRN",9.8,0)
9.8
"BLD",1376,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",1376,"KRN",9.8,"NM",1,0)
XQALSURO^^0^B90015726
"BLD",1376,"KRN",9.8,"NM",2,0)
XQALSUR2^^0^B3811185
"BLD",1376,"KRN",9.8,"NM",3,0)
XQALSET1^^0^B4976921
"BLD",1376,"KRN",9.8,"NM",4,0)
XQALGUI^^0^B18911432
"BLD",1376,"KRN",9.8,"NM",5,0)
XQALERT^^0^B18400944
"BLD",1376,"KRN",9.8,"NM",6,0)
XQALERT1^^0^B79700717
"BLD",1376,"KRN",9.8,"NM",7,0)
XQALDATA^^0^B11750303
"BLD",1376,"KRN",9.8,"NM","B","XQALDATA",7)

"BLD",1376,"KRN",9.8,"NM","B","XQALERT",5)

"BLD",1376,"KRN",9.8,"NM","B","XQALERT1",6)

"BLD",1376,"KRN",9.8,"NM","B","XQALGUI",4)

"BLD",1376,"KRN",9.8,"NM","B","XQALSET1",3)

"BLD",1376,"KRN",9.8,"NM","B","XQALSUR2",2)

"BLD",1376,"KRN",9.8,"NM","B","XQALSURO",1)

"BLD",1376,"KRN",19,0)
19
"BLD",1376,"KRN",19,"NM",0)
^9.68A^^
"BLD",1376,"KRN",19.1,0)
19.1
"BLD",1376,"KRN",101,0)
101
"BLD",1376,"KRN",409.61,0)
409.61
"BLD",1376,"KRN",771,0)
771
"BLD",1376,"KRN",779.2,0)
779.2
"BLD",1376,"KRN",870,0)
870
"BLD",1376,"KRN",8989.51,0)
8989.51
"BLD",1376,"KRN",8989.52,0)
8989.52
"BLD",1376,"KRN",8994,0)
8994
"BLD",1376,"KRN",9002226,0)
9002226
"BLD",1376,"KRN","B",.4,.4)

"BLD",1376,"KRN","B",.401,.401)

"BLD",1376,"KRN","B",.402,.402)

"BLD",1376,"KRN","B",.403,.403)

"BLD",1376,"KRN","B",.5,.5)

"BLD",1376,"KRN","B",.84,.84)

"BLD",1376,"KRN","B",3.6,3.6)

"BLD",1376,"KRN","B",3.8,3.8)

"BLD",1376,"KRN","B",9.2,9.2)

"BLD",1376,"KRN","B",9.8,9.8)

"BLD",1376,"KRN","B",19,19)

"BLD",1376,"KRN","B",19.1,19.1)

"BLD",1376,"KRN","B",101,101)

"BLD",1376,"KRN","B",409.61,409.61)

"BLD",1376,"KRN","B",771,771)

"BLD",1376,"KRN","B",779.2,779.2)

"BLD",1376,"KRN","B",870,870)

"BLD",1376,"KRN","B",8989.51,8989.51)

"BLD",1376,"KRN","B",8989.52,8989.52)

"BLD",1376,"KRN","B",8994,8994)

"BLD",1376,"KRN","B",9002226,9002226)

"BLD",1376,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",1376,"QUES",0)
^9.62^^
"BLD",1376,"REQB",0)
^9.611^^
"DATA",8992.3,1,0)
CRITICAL
"DATA",8992.3,2,0)
ABNORMAL IMA
"DATA",8992.3,3,0)
POSSIBLE MALIG
"DATA",8992.3,4,0)
TESTING-ALERTID-ONLY^TESTONLY
"FIA",8992.3)
ALERT CRITICAL TEXT
"FIA",8992.3,0)
^XTV(8992.3,
"FIA",8992.3,0,0)
8992.3
"FIA",8992.3,0,1)
y^n^f^^n^^y^o^n
"FIA",8992.3,0,10)

"FIA",8992.3,0,11)

"FIA",8992.3,0,"RLRO")

"FIA",8992.3,0,"VR")
8.0^XU
"FIA",8992.3,8992.3)
0
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3090706^3090706^6
"PKG",3,22,1,"PAH",1,0)
513^3120223^20
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3120223
"PKG",3,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",3,22,1,"PAH",1,1,2,0)
under patch XU*8*513.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","XQALDATA")
0^7^B11750303^B8047519
"RTN","XQALDATA",1,0)
XQALDATA ;ISC/JLI ISD/HGW - PROVIDE DATA ON ALERTS ;02/16/12  08:29
"RTN","XQALDATA",2,0)
 ;;8.0;KERNEL;**207,285,443,513**;Jul 10, 1995;Build 13
"RTN","XQALDATA",3,0)
 Q
"RTN","XQALDATA",4,0)
GETUSER(ROOT,XQAUSER,FRSTDATE,LASTDATE) ;
"RTN","XQALDATA",5,0)
 N XREF,XVAL,X,X2,X3,I,NCNT ; P443
"RTN","XQALDATA",6,0)
 S:$G(XQAUSER)'>0 XQAUSER=DUZ
"RTN","XQALDATA",7,0)
 S:$G(FRSTDATE)'>0 FRSTDATE=0
"RTN","XQALDATA",8,0)
 S:$G(LASTDATE)'>0 LASTDATE=0
"RTN","XQALDATA",9,0)
 S NCNT=0 K @ROOT
"RTN","XQALDATA",10,0)
 I FRSTDATE=0 D  Q
"RTN","XQALDATA",11,0)
 . F I=0:0 S I=$O(^XTV(8992,XQAUSER,"XQA",I)) Q:I'>0  S X=^(I,0),X3=$G(^(3)),X2=$G(^(2)) D
"RTN","XQALDATA",12,0)
 . . S NCNT=NCNT+1
"RTN","XQALDATA",13,0)
 . . S @ROOT@(NCNT)=$S($P(X3,U)'="":"G  ",$P(X,U,7,8)="^ ":"I  ",1:"   ")_$P(X,U,3)_U_$P(X,U,2)_$S($P(X2,U,3)'="":U_$P(X2,U,3),1:"") ; P443
"RTN","XQALDATA",14,0)
 . S @ROOT=NCNT
"RTN","XQALDATA",15,0)
 S XREF="R"
"RTN","XQALDATA",16,0)
 S XVAL=XQAUSER
"RTN","XQALDATA",17,0)
 D CHKTRAIL
"RTN","XQALDATA",18,0)
 Q
"RTN","XQALDATA",19,0)
GETPAT(ROOT,PATIENT,FRSTDATE,LASTDATE) ;
"RTN","XQALDATA",20,0)
 N XREF,XVAL,NCNT
"RTN","XQALDATA",21,0)
 S NCNT=0 K @ROOT
"RTN","XQALDATA",22,0)
 I $G(PATIENT)'>0 S @ROOT=0 Q
"RTN","XQALDATA",23,0)
 S XREF="C"
"RTN","XQALDATA",24,0)
 S XVAL=PATIENT
"RTN","XQALDATA",25,0)
 D CHKTRAIL
"RTN","XQALDATA",26,0)
 Q
"RTN","XQALDATA",27,0)
CHKTRAIL ;
"RTN","XQALDATA",28,0)
 N XQ1,X,X1,X2,X3
"RTN","XQALDATA",29,0)
 ; ZEXCEPT: FRSTDATE,LASTDATE,NCNT,ROOT,XREF,XVAL  -- from GETPAT or GETUSER
"RTN","XQALDATA",30,0)
 F XQ1=0:0 S XQ1=$O(^XTV(8992.1,XREF,XVAL,XQ1)) Q:XQ1'>0  D
"RTN","XQALDATA",31,0)
 . S X=$G(^XTV(8992.1,XQ1,0)),X1=$G(^(1)),X3=$G(^(3)),X2=$G(^(2)) Q:X=""
"RTN","XQALDATA",32,0)
 . I FRSTDATE'>0,'$D(^XTV(8992,"AXQA",$P(X,U))) Q
"RTN","XQALDATA",33,0)
 . I FRSTDATE>0,$P(X,U,2)<FRSTDATE Q
"RTN","XQALDATA",34,0)
 . I FRSTDATE>0,LASTDATE>0,$P(X,U,2)>LASTDATE Q
"RTN","XQALDATA",35,0)
 . S NCNT=NCNT+1
"RTN","XQALDATA",36,0)
 . S @ROOT@(NCNT)=$S($P(X3,U)'="":"G  ",$P(X1,U,2,3)="^":"I  ",$P(X1,U,2,3)="":"I  ",1:"   ")_$P(X1,U)_U_$P(X,U)_$S($P(X2,U,3)'="":U_$P(X2,U,3),1:"") ; P443
"RTN","XQALDATA",37,0)
 S @ROOT=NCNT
"RTN","XQALDATA",38,0)
 Q
"RTN","XQALDATA",39,0)
GETUSER1(ROOT,XQAUSER,FRSTDATE,LASTDATE) ;
"RTN","XQALDATA",40,0)
 N NCNT,KEY
"RTN","XQALDATA",41,0)
 S:$G(XQAUSER)'>0 XQAUSER=DUZ
"RTN","XQALDATA",42,0)
 S:$G(FRSTDATE)'>0 FRSTDATE=0
"RTN","XQALDATA",43,0)
 S:$G(LASTDATE)'>0 LASTDATE=0
"RTN","XQALDATA",44,0)
 I $$ACTVSURO^XQALSURO(XQAUSER)'>0 D RETURN^XQALSUR1(XQAUSER) ; P513
"RTN","XQALDATA",45,0)
 S NCNT=0 K @ROOT
"RTN","XQALDATA",46,0)
 I FRSTDATE=0 D  Q
"RTN","XQALDATA",47,0)
 . N X,X2,X3,X4,I S I="" F  S I=$O(^XTV(8992,XQAUSER,"XQA",I),-1) Q:I'>0  S X=^(I,0),X2=$G(^(2)),X3=$G(^(3)),X4=$D(^(4)) D
"RTN","XQALDATA",48,0)
 . . ;I $P(X,U,4)'="" S $P(^XTV(8992,XQAUSER,"XQA",I,0),U,4)="" ; MARK SEEN
"RTN","XQALDATA",49,0)
 . . I $P(X,U,4)'="" D
"RTN","XQALDATA",50,0)
 . . . N XQAID,XQXX,XQXY,XQADAT ; P513, update ALERT TRACKING FILE
"RTN","XQALDATA",51,0)
 . . . S $P(^XTV(8992,XQAUSER,"XQA",I,0),U,4)="" ; P513 moved from above - MARK SEEN
"RTN","XQALDATA",52,0)
 . . . S XQAID=$P(X,U,2) ; P513
"RTN","XQALDATA",53,0)
 . . . S XQXX=$O(^XTV(8992.1,"B",XQAID,0)),XQXY=0,XQADAT=$$NOW^XLFDT() ; P513
"RTN","XQALDATA",54,0)
 . . . I XQXX>0 S XQXY=$O(^XTV(8992.1,XQXX,20,"B",XQAUSER,0)) I XQXY>0 D
"RTN","XQALDATA",55,0)
 . . . . I $P(^XTV(8992.1,XQXX,20,XQXY,0),U,2)="" S $P(^XTV(8992.1,XQXX,20,XQXY,0),U,2)=XQADAT
"RTN","XQALDATA",56,0)
 . . . . I $P(^XTV(8992.1,XQXX,20,XQXY,0),U,3)="" S $P(^XTV(8992.1,XQXX,20,XQXY,0),U,3)=XQADAT
"RTN","XQALDATA",57,0)
 . . S NCNT=NCNT+1
"RTN","XQALDATA",58,0)
 . . S KEY=$S($P(X3,U)'="":"G  ",X4>1:"L  ",$P(X,U,7,8)="^ ":"I  ",1:"R  "),@ROOT@(NCNT)=KEY_$P(X,U,3)_U_$P(X,U,2)
"RTN","XQALDATA",59,0)
 . . I X2'="" D
"RTN","XQALDATA",60,0)
 . . . S NCNT=NCNT+1,@ROOT@(NCNT)=KEY_"-----Forwarded by: "_$$GET1^DIQ(200,($P(X2,U)_","),.01)_"   Generated: "_$$DAT8^XQALERT($P(X2,U,2),1)_U_$P(X,U,2)
"RTN","XQALDATA",61,0)
 . . . I $P(X2,U,3)'="" S NCNT=NCNT+1,@ROOT@(NCNT)=KEY_"-----"_$P(X2,U,3)_U_$P(X,U,2)
"RTN","XQALDATA",62,0)
 . . . Q
"RTN","XQALDATA",63,0)
 . S @ROOT=NCNT
"RTN","XQALDATA",64,0)
 . Q
"RTN","XQALDATA",65,0)
 Q
"RTN","XQALERT")
0^5^B18400944^B16208814
"RTN","XQALERT",1,0)
XQALERT ;ISC-SF.SEA/JLI - ALERT HANDLER ;12/27/11  16:15
"RTN","XQALERT",2,0)
 ;;8.0;KERNEL;**1,65,125,173,285,366,513**;Jul 10, 1995;Build 13
"RTN","XQALERT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XQALERT",4,0)
 Q
"RTN","XQALERT",5,0)
 ;
"RTN","XQALERT",6,0)
SETUP ;SR.
"RTN","XQALERT",7,0)
 D SETUP^XQALSET
"RTN","XQALERT",8,0)
 Q
"RTN","XQALERT",9,0)
 ;
"RTN","XQALERT",10,0)
SETUP1() ;SR.
"RTN","XQALERT",11,0)
 N I S I=$$SETUP1^XQALSET()
"RTN","XQALERT",12,0)
 Q I
"RTN","XQALERT",13,0)
 ;
"RTN","XQALERT",14,0)
DISPLAY ;SR. Display any new alerts
"RTN","XQALERT",15,0)
 I '$D(XQAUSER) S XQAUSER=DUZ I $$ACTVSURO^XQALSURO(XQAUSER)'>0 D RETURN^XQALSUR1(XQAUSER) ; P513 (ISD/HGW 20111227)
"RTN","XQALERT",16,0)
 Q:$O(^XTV(8992,DUZ,"XQA",0))'>0
"RTN","XQALERT",17,0)
 N X,XQI,XQX,XQX1,DIR,XQA,Y,XQON,XQOFF,XQ1ON,XQ1OFF,XQXDAT S XQX=0,XQX1=0,Y=1,DIR(0)="E" ; P285
"RTN","XQALERT",18,0)
 I $$ACTVSURO^XQALSURO(DUZ)'>0 D RETURN^XQALSUR1(DUZ) ; P366
"RTN","XQALERT",19,0)
 F XQI=0:0 D:XQX1&'(XQX1#20) ^DIR Q:'Y  S XQI=$O(^XTV(8992,DUZ,"XQA",XQI)) Q:XQI'>0  S XQX=XQX+1,X=$G(^XTV(8992,DUZ,"XQA",XQI,0)) I $P(X,U,4) D
"RTN","XQALERT",20,0)
 . N XQXXX,XQXX,XQXY
"RTN","XQALERT",21,0)
 . S XQXXX=X,(XQXX,XQXY)=0,XQXX=$P(X,U,2) I XQXX'="" S XQXX=$O(^XTV(8992.1,"B",$E(XQXX,1,50),0)) I XQXX>0 S XQXY=$O(^XTV(8992.1,XQXX,20,"B",DUZ,0)) I XQXY>0 S XQXDAT=$$NOW^XLFDT(),$P(^XTV(8992.1,XQXX,20,XQXY,0),U,2)=XQXDAT ; P173
"RTN","XQALERT",22,0)
 . S XQON="$C(0)",XQOFF="$C(0)"
"RTN","XQALERT",23,0)
 . ;S XQOUT=$P(XQXXX,U,3) I ($$UP^XLFSTR(XQOUT)["CRITICAL")!($$UP^XLFSTR(XQOUT)["ABNORMAL IMA") D:'$D(XQ1ON) SETREV S XQON=XQ1ON,XQOFF=XQ1OFF ; P285 modified to highlight critical and abnormal imaging alerts
"RTN","XQALERT",24,0)
 . I $$CHKCRIT^XQALSUR2(XQXXX) D:'$D(XQ1ON) SETREV S XQON=XQ1ON,XQOFF=XQ1OFF ; P513 modified to add use data from file 8992.3 for identifying critical alerts
"RTN","XQALERT",25,0)
 . S X=XQXXX W:XQX1=0 $C(7) W !,@XQON,$P(X,U,3),@XQOFF S XQX1=XQX1+1,$P(^XTV(8992,DUZ,"XQA",XQI,0),U,4)="" I $D(^(2)) S X1=^(2) D  ; P285
"RTN","XQALERT",26,0)
 . . S X2=$P(X1,U,3)
"RTN","XQALERT",27,0)
 . . W !?5,"*** FORWARDED BY: ",$P(^VA(200,+X1,0),U),"   Generated: " S X1=$P($P(X,U,2),";",3) W $$DAT8(X1,1)
"RTN","XQALERT",28,0)
 . . I X2'="" W !?5,X2
"RTN","XQALERT",29,0)
 . I $P(X,U,5)="D" S XQA=$P(X,U,2) K ^XTV(8992,DUZ,"XQA",XQI) D  S XQX=XQX-1 D:XQA'="" D
"RTN","XQALERT",30,0)
 . . I $G(XQXX)>0,$G(XQXY)>0 S $P(^XTV(8992.1,XQXX,20,XQXY,0),U,5)=XQXDAT
"RTN","XQALERT",31,0)
 . K XQXX,XQXY
"RTN","XQALERT",32,0)
 I XQX>0 W:XQX1=0 !!,"You have PENDING ALERTS" W !?10,"Enter  ""VA to jump to VIEW ALERTS option",! ; ISL-0898-51279
"RTN","XQALERT",33,0)
 W:XQX1>0 !
"RTN","XQALERT",34,0)
 K XQI,XQX,XQX1,DIR,XQA,Y
"RTN","XQALERT",35,0)
 Q
"RTN","XQALERT",36,0)
D K ^XTV(8992,"AXQA",XQA,DUZ),^XTV(8992,"AXQAN",$P(XQA,";"),DUZ)
"RTN","XQALERT",37,0)
 Q
"RTN","XQALERT",38,0)
 ;
"RTN","XQALERT",39,0)
 ;
"RTN","XQALERT",40,0)
DAT8(FMDAT,TFLG) ;
"RTN","XQALERT",41,0)
 N X
"RTN","XQALERT",42,0)
 S X=$E(FMDAT,4,5)_"/"_$E(FMDAT,6,7)_"/"_$E(FMDAT,2,3)
"RTN","XQALERT",43,0)
 I $G(TFLG)>0 S FMDAT=FMDAT_"0000000",X=X_" "_$E(FMDAT,9,10)_":"_$E(FMDAT,11,12)_":"_$E(FMDAT,13,14)
"RTN","XQALERT",44,0)
 Q X
"RTN","XQALERT",45,0)
DOIT ;OPT. Process Alerts
"RTN","XQALERT",46,0)
 N XQALAST,XQALFWD,XQAUSER K DTOUT,DIRUT,DUOUT,DIROUT
"RTN","XQALERT",47,0)
 S XQAUSER=DUZ D DOIT^XQALERT1,COUNT^XQALDEL(0,XQAUSER)
"RTN","XQALERT",48,0)
 Q
"RTN","XQALERT",49,0)
 ;
"RTN","XQALERT",50,0)
DELETE ;
"RTN","XQALERT",51,0)
 D DELETE^XQALDEL
"RTN","XQALERT",52,0)
 Q
"RTN","XQALERT",53,0)
 ;
"RTN","XQALERT",54,0)
DELETEA ;
"RTN","XQALERT",55,0)
 D DELETEA^XQALDEL
"RTN","XQALERT",56,0)
 Q
"RTN","XQALERT",57,0)
 ;
"RTN","XQALERT",58,0)
OLDDEL ;OPT.
"RTN","XQALERT",59,0)
 D OLDDEL^XQALDEL
"RTN","XQALERT",60,0)
 Q
"RTN","XQALERT",61,0)
 ;
"RTN","XQALERT",62,0)
USERDEL ;OPT.
"RTN","XQALERT",63,0)
 D USERDEL^XQALDEL
"RTN","XQALERT",64,0)
 Q
"RTN","XQALERT",65,0)
 ;
"RTN","XQALERT",66,0)
USER(ROOT,XQAUSER,FRSTDATE,LASTDATE) ; Returns current alerts for the user in an array located under root
"RTN","XQALERT",67,0)
 I '$D(XQAUSER) S XQAUSER=DUZ
"RTN","XQALERT",68,0)
 I $$ACTVSURO^XQALSURO(XQAUSER)'>0 D RETURN^XQALSUR1(XQAUSER) ; P366
"RTN","XQALERT",69,0)
 D GETUSER^XQALDATA(ROOT,XQAUSER,$G(FRSTDATE),$G(LASTDATE))
"RTN","XQALERT",70,0)
 Q
"RTN","XQALERT",71,0)
 ;
"RTN","XQALERT",72,0)
PATIENT(ROOT,PATIENT,FRSTDATE,LASTDATE) ;
"RTN","XQALERT",73,0)
 I $G(PATIENT)'>0 Q
"RTN","XQALERT",74,0)
 D GETPAT^XQALDATA(ROOT,PATIENT,$G(FRSTDATE),$G(LASTDATE))
"RTN","XQALERT",75,0)
 Q
"RTN","XQALERT",76,0)
ACTION(ALERTID) ;
"RTN","XQALERT",77,0)
 D ACTION^XQALDOIT(ALERTID)
"RTN","XQALERT",78,0)
 Q
"RTN","XQALERT",79,0)
GETACT(ALERTID) ; Return to calling routine the information needed to act on
"RTN","XQALERT",80,0)
 ; the specified alert.
"RTN","XQALERT",81,0)
 ; On return the following variables are defined:
"RTN","XQALERT",82,0)
 ;  XQAID = the full alert id
"RTN","XQALERT",83,0)
 ;  XQADATA = Any data passed as XQADATA at the time the alert was generated
"RTN","XQALERT",84,0)
 ;  XQAROU  = Indicates routine to be run (includes tag if necessary)
"RTN","XQALERT",85,0)
 ;    This value may have three meanings
"RTN","XQALERT",86,0)
 ;      1.  A null value indicates no routine to be used (XQAOPT contains
"RTN","XQALERT",87,0)
 ;          option name to be run)
"RTN","XQALERT",88,0)
 ;      2.  A value of ^<space>  indicates that the alert is information
"RTN","XQALERT",89,0)
 ;          only (no routine or option action involved).
"RTN","XQALERT",90,0)
 ;      3.  The name of the routine as ^ROUTINE  or TAG^ROUTINE
"RTN","XQALERT",91,0)
 ;  XQAOPT  = Indicates the name of the option to be run if not null.
"RTN","XQALERT",92,0)
 ;
"RTN","XQALERT",93,0)
 N XQX,XQZ,XQAGETAC
"RTN","XQALERT",94,0)
 S XQAGETAC=1,XQX="",XQZ=""
"RTN","XQALERT",95,0)
 D ACTION^XQALDOIT(ALERTID)
"RTN","XQALERT",96,0)
 S XQAID=$P(XQX,U,2)
"RTN","XQALERT",97,0)
 S XQADATA=$S(XQZ'="":XQZ,1:$P(XQX,U,9,99))
"RTN","XQALERT",98,0)
 S XQAROU=$S($P(XQX,U,8)="":"",1:$P(XQX,U,7,8))
"RTN","XQALERT",99,0)
 S XQAOPT=$S($P(XQX,U,8)="":$P(XQX,U,7),1:"")
"RTN","XQALERT",100,0)
 Q
"RTN","XQALERT",101,0)
 ;
"RTN","XQALERT",102,0)
SETREV ; Set on (XQ1ON) and off (XQ1OFF) variables for Reverse video ; P285
"RTN","XQALERT",103,0)
 N XQ1ON1,XQ1OFF1
"RTN","XQALERT",104,0)
 S XQ1ON="$C(0)",XQ1OFF="$C(0)" I IOST(0)>0 D
"RTN","XQALERT",105,0)
 . S XQ1ON1=$$GET1^DIQ(3.2,IOST(0)_",",14) I XQ1ON1'="" S XQ1ON=XQ1ON1
"RTN","XQALERT",106,0)
 . S XQ1OFF1=$$GET1^DIQ(3.2,IOST(0)_",",15) I XQ1OFF1'="" S XQ1OFF=XQ1OFF1
"RTN","XQALERT",107,0)
 . Q
"RTN","XQALERT",108,0)
 Q
"RTN","XQALERT1")
0^6^B79700717^B78786817
"RTN","XQALERT1",1,0)
XQALERT1 ;ISC-SF.SEA/JLI - ALERT HANDLER ;07/24/11  15:11
"RTN","XQALERT1",2,0)
 ;;8.0;KERNEL;**20,65,114,123,125,164,173,285,366,443,513**;Jul 10, 1995;Build 13
"RTN","XQALERT1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XQALERT1",4,0)
 Q
"RTN","XQALERT1",5,0)
 ;
"RTN","XQALERT1",6,0)
DOIT I $D(XQX1),XQX1'>0 K XQX1
"RTN","XQALERT1",7,0)
 I $D(XQAID) D  I '$D(XQAID) G EXIT
"RTN","XQALERT1",8,0)
 . N XQACHOIC,REASK S REASK=0
"RTN","XQALERT1",9,0)
 . I '$D(XQX1),$O(^XTV(8992,XQAUSER,"XQA",+$O(^XTV(8992,XQAUSER,"XQA",0))))'>0,$G(XQAROUX)="^ " S XQAROU=""
"RTN","XQALERT1",10,0)
AGAIN . S XQACHOIC="Y:YES;N:NO;C:CONTINUE;",XQAQ("?")="Enter Y (or C) to continue, N to exit alert processing"
"RTN","XQALERT1",11,0)
 . S XQACHOIC=$G(XQACHOIC)_"F:FORWARD ALERT;R:RENEW(MAKE NEW AGAIN);" S XQAQ("?",1)="Enter F to forward this alert to someone else",XQAQ("?",2)="Enter R to Renew (Make New) this alert"
"RTN","XQALERT1",12,0)
 . D  I REASK=1 G AGAIN
"RTN","XQALERT1",13,0)
 . . S REASK=0 W !! K DIR S DIR(0)="SA^"_XQACHOIC,DIR("A")=$S(XQACHOIC["F:":"Continue (Y/N) or F(orward) or R(enew) ",1:"Continue Processing (Y/N) "),DIR("B")="YES" M DIR("?")=XQAQ("?") D ^DIR K DIR
"RTN","XQALERT1",14,0)
 . . I $D(DUOUT)!$D(DIRUT) S Y="N" K DUOUT,DIRUT
"RTN","XQALERT1",15,0)
 . . I Y="N" D:$D(XQAKILL) DELETEA^XQALERT K XQAID
"RTN","XQALERT1",16,0)
 . . I Y="R" S REASK=REASK+1 K XQAKILL I '$D(^XTV(8992,"AXQA",XQAID,DUZ)) D RESTORE
"RTN","XQALERT1",17,0)
 . . I Y="F" D:'$D(^XTV(8992,"AXQA",XQAID,DUZ)) RESTORE D FRWRDONE S REASK=REASK+1
"RTN","XQALERT1",18,0)
 . . Q
"RTN","XQALERT1",19,0)
 . Q
"RTN","XQALERT1",20,0)
 I $D(XQAKILL) D DELETEA^XQALERT
"RTN","XQALERT1",21,0)
 S XQAREV=1,XQXOUT=0,XQK=0,XQACNT=0 K XQADATA,XQAID,XQAROU,XQAKILL,XQAROUX
"RTN","XQALERT1",22,0)
 I '$D(XQX1) S XQX1=0 K ^TMP("XQ",$J,"XQA"),^("XQA1"),^("XQA2") I $O(^XTV(8992,XQAUSER,"XQA",0))'>0 K XQX1 D:'$G(^TMP("XQALERT1",$J,"NOTFIRST")) CHKSURO G:$O(^XTV(8992,XQAUSER,"XQA",0))'>0 EXIT S XQX1=0 ; P366
"RTN","XQALERT1",23,0)
 I $$ACTVSURO^XQALSURO(XQAUSER)'>0 D RETURN^XQALSUR1(XQAUSER) ; P366
"RTN","XQALERT1",24,0)
 S ^TMP("XQALERT1",$J,"NOTFIRST")=1 ; Added 2/2/99 jli to clear flag for initial entry
"RTN","XQALERT1",25,0)
 ;Sort and remove display only
"RTN","XQALERT1",26,0)
 I 'XQX1 W !!! D
"RTN","XQALERT1",27,0)
 . D SORT
"RTN","XQALERT1",28,0)
 ; Now display them.
"RTN","XQALERT1",29,0)
SUBLOOP W @IOF
"RTN","XQALERT1",30,0)
 N XQZ1,XQZ
"RTN","XQALERT1",31,0)
 S XQK=0 F XQI=0:0 Q:XQX1!XQXOUT  S XQI=$O(^TMP("XQ",$J,"XQA",XQI)) Q:XQI'>0  S XQX=^(XQI),XQII=^(XQI,1),XQZ=^(2),XQZ1=^(3),XQZ4=^(4) D  I XQX'="" D DOIT1
"RTN","XQALERT1",32,0)
 . I '$D(^XTV(8992,XQAUSER,"XQA",XQII)) S XQX="" K ^TMP("XQ",$J,"XQA",XQI),^TMP("XQ",$J,"XQA1",(999999-XQI))
"RTN","XQALERT1",33,0)
 . Q
"RTN","XQALERT1",34,0)
 S:'$D(XQXOUT) XQXOUT=0 G:XQXOUT EXIT G:XQK'>0&'XQX1 EXIT I 'XQX1 D ASK G:XQXOUT EXIT
"RTN","XQALERT1",35,0)
 G:+XQX1=0 EXIT I XQX1<0 S XQX1=0 G DOIT
"RTN","XQALERT1",36,0)
 I $D(XQALDELE)!$D(XQALFWD) Q
"RTN","XQALERT1",37,0)
 ;D WAIT(+XQX1) G:XQXOUT EXIT
"RTN","XQALERT1",38,0)
 G:XQXOUT EXIT
"RTN","XQALERT1",39,0)
 G EN^XQALDOIT
"RTN","XQALERT1",40,0)
 ;
"RTN","XQALERT1",41,0)
RESTORE ; Restore a deleted message for use
"RTN","XQALERT1",42,0)
 N ALERTREF,XTVGLOB,ADUZ,X,X0,X1,X2,TIME,MESG,OPT,TAG,ROU,X4,LONG
"RTN","XQALERT1",43,0)
 S XTVGLOB=$NA(^XTV(8992,DUZ,"XQA"))
"RTN","XQALERT1",44,0)
 S ADUZ=$O(^XTV(8992,"AXQA",XQAID,0)) I ADUZ>0 S TIME=$O(^(ADUZ,0)) D  I 1
"RTN","XQALERT1",45,0)
 . M @XTVGLOB@(TIME)=^XTV(8992,ADUZ,"XQA",TIME) K @XTVGLOB@(TIME,2) ; copy alert, kill comment if any
"RTN","XQALERT1",46,0)
 E  S ALERTREF=$O(^XTV(8992.1,"B",XQAID,0)) Q:ALERTREF'>0  D  ; otherwise rebuild from alert tracking file if possible
"RTN","XQALERT1",47,0)
 . S X0=^XTV(8992.1,ALERTREF,0),X1=$G(^(1)),X2=$G(^(2)),X4=$O(^(4,0))
"RTN","XQALERT1",48,0)
 . S TIME=$P($P(X0,U),";",3),MESG=$P(X1,U),OPT=$P(X1,U,2),TAG=$P(X1,U,3),ROU=$P(X1,U,4),LONG=(X4>0)
"RTN","XQALERT1",49,0)
 . S X=TIME_U_XQAID_U_MESG_U_U_$S(OPT'=""!(ROU'=""):"R",LONG:"L",1:"I")_U_U_$S(OPT'="":OPT,TAG'="":TAG,1:"")_U_$S(OPT'="":"",ROU'="":ROU,1:" ")
"RTN","XQALERT1",50,0)
 . S @XTVGLOB@(TIME,0)=X I $G(X2)'="" S ^(1)=X2
"RTN","XQALERT1",51,0)
 S ^XTV(8992,"AXQA",XQAID,DUZ,TIME)="",^XTV(8992,"AXQAN",$E($P(XQAID,";"),1,30),DUZ,TIME)=""
"RTN","XQALERT1",52,0)
 Q
"RTN","XQALERT1",53,0)
 ;
"RTN","XQALERT1",54,0)
EXIT ;
"RTN","XQALERT1",55,0)
 I $G(XQALAST)="I",$G(DUZ("AUTO")) D WAIT2
"RTN","XQALERT1",56,0)
 I $D(XQALDELE)!$D(XQALFWD) Q
"RTN","XQALERT1",57,0)
 K ^TMP("XQ",$J,"XQA"),^("XQA1"),^("XQA2"),XQI,XQX,XQJ,XQK,XQX1,XQX2,XQXOUT,XQ1,XQII,XQACNT,XQA1,XQAREV,%ZIS,XQAROU,XQALAST,XQAROUX,XQON,XQOFF,XQ1ON,XQ1OFF,XQOUT,XQAQ
"RTN","XQALERT1",58,0)
 K ^TMP("XQALERT1",$J)
"RTN","XQALERT1",59,0)
 Q
"RTN","XQALERT1",60,0)
 ;
"RTN","XQALERT1",61,0)
 ; CHKSURO added 2/2/99 to give user opportunity to add/remove surrogate if no alerts present
"RTN","XQALERT1",62,0)
CHKSURO ; If user selects process alerts with no alerts present, give him/her the opportunity to add or delete a surrogate
"RTN","XQALERT1",63,0)
 ; P366 - list currently established surrogates if any
"RTN","XQALERT1",64,0)
 I '$G(^TMP("XQALERT1",$J,"NOTFIRST")) W !!,"You have no alerts for processing.",!
"RTN","XQALERT1",65,0)
 D SURROGAT^XQALSURO ; XU*8*17
"RTN","XQALERT1",66,0)
 Q
"RTN","XQALERT1",67,0)
 ;
"RTN","XQALERT1",68,0)
DOIT1 ;
"RTN","XQALERT1",69,0)
 I XQK=0 S XQALINFO=0 I '$D(XQALFWD) W @IOF
"RTN","XQALERT1",70,0)
 ;S XQON="$C(0)",XQOFF="$C(0)" S XQOUT=$P(XQX,U,3) I ($$UP^XLFSTR(XQOUT)["CRITICAL")!($$UP^XLFSTR(XQOUT)["ABNORMAL IMA") D:'$D(XQ1ON) SETREV^XQALERT S XQON=XQ1ON,XQOFF=XQ1OFF ; P285
"RTN","XQALERT1",71,0)
 S XQON="$C(0)",XQOFF="$C(0)" I $$CHKCRIT^XQALSUR2(XQX) D:'$D(XQ1ON) SETREV^XQALERT S XQON=XQ1ON,XQOFF=XQ1OFF ; P513 modified to add use data from file 8992.3 for identifying critical alerts
"RTN","XQALERT1",72,0)
 S XQK=XQK+1 W !,$J(XQK,2),".",$S(XQZ4:"L",$P(XQX,U,8)=" ":"I",1:" "),"  ",@XQON,$E($P(XQX,U,3),1,70),@XQOFF S:$P(XQX,U,8)=" " XQALINFO=XQALINFO+1 D:XQZ1'=""  ; P285
"RTN","XQALERT1",73,0)
 . W !?8,"Forwarded by: ",$P(^VA(200,+XQZ1,0),U),"  Generated: ",$$DAT8^XQALERT(+$P($P(XQX,U,2),";",3),1)
"RTN","XQALERT1",74,0)
 . I $P(XQZ1,U,3)'="" W !?8,$P(XQZ1,U,3)
"RTN","XQALERT1",75,0)
 S ^TMP("XQ",$J,"XQA1",XQK)=XQX,^(XQK,1)=XQII,^(2)=XQZ,^(3)=XQZ1
"RTN","XQALERT1",76,0)
 I ($Y+6)>IOSL N XQKVALUE S XQKVALUE=XQK D ASK0(XQI) S:'$D(XQK) XQK=XQKVALUE Q:XQX1!(XQXOUT)  W @IOF
"RTN","XQALERT1",77,0)
 Q
"RTN","XQALERT1",78,0)
 ;
"RTN","XQALERT1",79,0)
ASK0(XQI) ;Stack XQI
"RTN","XQALERT1",80,0)
ASK ;
"RTN","XQALERT1",81,0)
 N XQALNEWF K XQALAST
"RTN","XQALERT1",82,0)
 ;I '$D(XQALDELE)&'$D(XQALFWD) S XQALNEWF=$P(^XTV(8992,XQAUSER,0),U,5) I XQALNEWF<20 D
"RTN","XQALERT1",83,0)
 ;. N XQALFDA
"RTN","XQALERT1",84,0)
 ;. S XQALNEWF=XQALNEWF+1,XQALFDA=(8992,(XQAUSER_","),.05)=XQALNEWF D FILE^DIE("","XQALFDA")
"RTN","XQALERT1",85,0)
 ;. W !,"NEW OPTIONS: S-to add/remove SURROGATE and D-to selectively Delete SOME alerts"
"RTN","XQALERT1",86,0)
 S XQ1=0,XQXOUT=0 W !?10,"Select from 1 to ",XQK W:$D(XQALDELE) " to DELETE" W:$D(XQALFWD) " to FORWARD"
"RTN","XQALERT1",87,0)
 W !?10,"or enter ?, A, " W:'$D(XQALDELE)&'$D(XQALFWD)&(XQALINFO>0) "I, D, " W:'$D(XQALDELE)&'$D(XQALFWD) "F, S, P, M, R, " W "or ^ to exit" I XQI>0,$O(^XTV(8992,XQAUSER,"XQA",XQI))>0 W !?10,"or RETURN to continue" S XQ1=1
"RTN","XQALERT1",88,0)
 R ": ",XQII:DTIME S:'$T!(XQII[U)!(XQII=""&'XQ1) XQXOUT=1 Q:XQXOUT
"RTN","XQALERT1",89,0)
 I '$D(XQALDELE)&'$D(XQALFWD),"PpMm"[$E(XQII_".") D MORP^XQALDOIT D:"Pp"[$E(XQII_".") PRINT^XQALDOIT D:"Mm"[$E(XQII_".") MAIL^XQALDOIT K ^TMP("XQ",$J,"XQA2") G ASK
"RTN","XQALERT1",90,0)
 I XQII'="",XQII["?" D HELP G ASK
"RTN","XQALERT1",91,0)
 I XQII=""&XQ1 Q
"RTN","XQALERT1",92,0)
 I "IiAaFfRrSsDd"'[$E(XQII_"."),$L(XQII)>31,$E(XQII,1,32)?1N.N W !,$C(7),"  ??  Invalid number entered",! G ASK
"RTN","XQALERT1",93,0)
 I "IiAaFfRrSsDd"'[$E(XQII_"."),(XQII<1)!(XQII>XQK) W $C(7),"  ??",! G ASK
"RTN","XQALERT1",94,0)
 I '$D(XQALDELE)&'$D(XQALFWD),"Ff"[$E(XQII) D FWRD^XQALFWD S XQX1=-2 Q  ; MODIFIED 7-6
"RTN","XQALERT1",95,0)
 I '$D(XQALDELE)&'$D(XQALFWD),"Ss"[$E(XQII) D CHKSURO S XQX1=-1 Q
"RTN","XQALERT1",96,0)
 I '$D(XQALDELE)&'$D(XQALFWD),"Dd"[$E(XQII) D ASKDEL S XQX1=-2 Q  ; MODIFIED 7-6
"RTN","XQALERT1",97,0)
 I '$D(XQALDELE),"Rr"[$E(XQII) S XQX1=-2 Q
"RTN","XQALERT1",98,0)
 I "Aa"[$E(XQII) S X="1-"_XQACNT,DIR(0)="LV^1:"_XQACNT D ^DIR K DIR,XQX1 M XQX1=Y S XQII="" K Y ;Merge list from Y
"RTN","XQALERT1",99,0)
 I XQII'="","Ii"[$E(XQII) S XQX1(0)="",XQX2=0,XQII="" F XQK=0:0 S XQK=$O(^TMP("XQ",$J,"XQA1",XQK)) S:XQK'>0 XQX1=XQX1(0) Q:XQK'>0  I $P(^(XQK),U,7,8)="^ " S XQX1(XQX2)=XQX1(XQX2)_XQK_"," S:$L(XQX1(XQX2))>240 XQX2=XQX2+1,XQX1(XQX2)=""
"RTN","XQALERT1",100,0)
 I XQII="" Q
"RTN","XQALERT1",101,0)
 S X=XQII,DIR(0)="LV^1:"_XQK D ^DIR I '$D(Y) W $C(7),"  ??" D HELP G ASK ;Use of 'LV' is special
"RTN","XQALERT1",102,0)
 K XQX1 M XQX1=Y K Y S Y=XQX1 ;Merge list from Y
"RTN","XQALERT1",103,0)
 Q
"RTN","XQALERT1",104,0)
WAIT(IFN) ;Wait for user input if last alert is INFO and next isn't.
"RTN","XQALERT1",105,0)
 N X,YY Q:$G(XQXOUT)
"RTN","XQALERT1",106,0)
 S X=$G(^TMP("XQ",$J,"XQA1",IFN)),YY=$P(X,U,7,8),YY=$S(YY="^ ":"I",YY="^":"O",1:"R")
"RTN","XQALERT1",107,0)
 I $G(XQALAST)="I","OR"[YY D WAIT2
"RTN","XQALERT1",108,0)
 I YY="I",$Y+4>IOSL D WAIT2 W @IOF
"RTN","XQALERT1",109,0)
 S XQALAST=YY
"RTN","XQALERT1",110,0)
 Q
"RTN","XQALERT1",111,0)
WAIT2 ;Wait for user input before continuing
"RTN","XQALERT1",112,0)
 N DIR,Y,DIROUT,DIRUT S DIR(0)="E",DIR("?")="The next ALERT may cause the loss of info on the screen."
"RTN","XQALERT1",113,0)
 D ^DIR S:$D(DIRUT) XQXOUT=1
"RTN","XQALERT1",114,0)
 Q
"RTN","XQALERT1",115,0)
 ;
"RTN","XQALERT1",116,0)
HELP W !!,"YOU MAY ENTER:",!?3,$S(XQK>1:"One or more numbers",1:"A number")," in the range 1 to ",XQK," to select specific alert(s)"
"RTN","XQALERT1",117,0)
 W !?6,"for "_$S($D(XQALDELE):"DELETION.",$D(XQALFWD):"FORWARDING",1:"processing.") W:XQK>1 "  This may be a series of numbers, e.g., 2,3,6-9"
"RTN","XQALERT1",118,0)
 W !?3,"A to "_$S($D(XQALDELE):"DELETE",$D(XQALFWD):"FORWARD",1:"process")," all of the pending alerts in the order shown."
"RTN","XQALERT1",119,0)
 W:'$D(XQALDELE)&'$D(XQALFWD) !?3,"I to process all of the INFORMATION ONLY alerts, if any, without further ado."
"RTN","XQALERT1",120,0)
 W:'$D(XQALDELE)&'$D(XQALFWD) !?3,"S to add or remove a surrogate to receive alerts for you"
"RTN","XQALERT1",121,0)
 W:'$D(XQALDELE)&'$D(XQALFWD) !?3,"F to forward one or more specific alerts.  Forwarding may be as an ALERT",!,"to specific user(s) and/or mail group(s), or as a MAIL MESSAGE, or to a",!,"specific PRINTER."
"RTN","XQALERT1",122,0)
 W:'$D(XQALDELE)&'$D(XQALFWD) !?3,"D to delete specific alerts (some alerts may not be deleted)"
"RTN","XQALERT1",123,0)
 W:'$D(XQALDELE)&'$D(XQALFWD) !?3,"P to print a copy of the pending alerts on a printer"
"RTN","XQALERT1",124,0)
 W:'$D(XQALDELE)&'$D(XQALFWD) !?3,"M to receive a MailMan message containing a copy of these pending alerts"
"RTN","XQALERT1",125,0)
 W:'$D(XQALDELE) !?3,"R to Redisplay the available alerts"
"RTN","XQALERT1",126,0)
 W !?3,"^ to exit"
"RTN","XQALERT1",127,0)
 I XQI W !?5,"or RETURN to see additional pending ALERTS"
"RTN","XQALERT1",128,0)
 W !!
"RTN","XQALERT1",129,0)
 Q
"RTN","XQALERT1",130,0)
 ;
"RTN","XQALERT1",131,0)
SORT ;Sort and remove display only
"RTN","XQALERT1",132,0)
 N XQZ,XQZ1,XQZ4,XQI,XQK,XQX,XQJ
"RTN","XQALERT1",133,0)
 F XQI=0:0 S XQI=$O(^XTV(8992,XQAUSER,"XQA",XQI)) Q:XQI'>0  S XQX=^(XQI,0),XQZ=$G(^(1)),XQZ1=$G(^(2)),XQZ4=$O(^(4,0)) S XQJ=$P(XQX,U,7,8) K:XQJ=U ^XTV(8992,XQAUSER,"XQA",XQI) I XQJ'=U D
"RTN","XQALERT1",134,0)
 . S XQACNT=XQACNT+1,XQJ=$S(XQAREV:999999-XQACNT,1:XQACNT),^TMP("XQ",$J,"XQA",XQJ)=XQX,^(XQJ,1)=XQI,^(2)=XQZ,^(3)=XQZ1,^(4)=XQZ4
"RTN","XQALERT1",135,0)
 S XQK=0 F XQI=0:0 S XQI=$O(^TMP("XQ",$J,"XQA",XQI)) Q:XQI'>0  S XQK=XQK+1 M ^TMP("XQ",$J,"XQA1",XQK)=^TMP("XQ",$J,"XQA",XQI)
"RTN","XQALERT1",136,0)
 Q
"RTN","XQALERT1",137,0)
 ;
"RTN","XQALERT1",138,0)
ASKDEL ;
"RTN","XQALERT1",139,0)
 N XQALDELE,XQX1COPY,XQAID,DA,XQAKILL,XQXOUT,XQAUSERD,XQALVALU
"RTN","XQALERT1",140,0)
 S XQALDELE=1
"RTN","XQALERT1",141,0)
 K XQX1
"RTN","XQALERT1",142,0)
 D DOIT^XQALERT1
"RTN","XQALERT1",143,0)
 K XQALDELE S XQAUSERD=1
"RTN","XQALERT1",144,0)
 I $D(XQX1),XQX1>0 D
"RTN","XQALERT1",145,0)
 . M XQX1COPY=XQX1
"RTN","XQALERT1",146,0)
 . F  Q:XQX1=""  S DA=+XQX1,XQX1=$P(XQX1,",",2,99) D  I XQX1="" S Y=$O(XQX1(0)) I Y>0 S XQX1=XQX1(Y) K XQX1(Y)
"RTN","XQALERT1",147,0)
 . . S XQAID=$P(^TMP("XQ",$J,"XQA1",DA),U,2),XQALVALU=^(DA),XQAKILL=1
"RTN","XQALERT1",148,0)
 . . I $P(XQALVALU,U,8)=" "!$P(XQALVALU,U,10) D
"RTN","XQALERT1",149,0)
 . . . I XQAID="" K ^XTV(8992,XQAUSER,"XQA",+^TMP("XQ",$J,"XQA1",DA,1))
"RTN","XQALERT1",150,0)
 . . . I XQAID'="" D DELETE^XQALDEL
"RTN","XQALERT1",151,0)
 . . . K ^TMP("XQ",$J,"XQA1",DA),^TMP("XQ",$J,"XQA",(999999-DA))
"RTN","XQALERT1",152,0)
 . K XQX1 M XQX1=XQX1COPY S XQAID=0
"RTN","XQALERT1",153,0)
 . F  Q:XQX1=""  S DA=+XQX1,XQX1=$P(XQX1,",",2,99) D  I XQX1="" S Y=$O(XQX1(0)) I Y>0 S XQX1=XQX1(Y) K XQX1(Y)
"RTN","XQALERT1",154,0)
 . . I $D(^TMP("XQ",$J,"XQA1",DA)) W:'XQAID !!,"Unable to delete alerts which require action: ",DA W:XQAID ",",DA S XQAID=1
"RTN","XQALERT1",155,0)
 . I XQAID=1 K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","XQALERT1",156,0)
 K XQX1,XQAKILL
"RTN","XQALERT1",157,0)
 Q
"RTN","XQALERT1",158,0)
 ;
"RTN","XQALERT1",159,0)
FRWRDONE ;
"RTN","XQALERT1",160,0)
 N XQX1,XQALFWDL S XQALFWDL(1)=XQAID
"RTN","XQALERT1",161,0)
 N XQAID
"RTN","XQALERT1",162,0)
 D FWDONE^XQALFWD
"RTN","XQALERT1",163,0)
 Q
"RTN","XQALGUI")
0^4^B18911432^B18668830
"RTN","XQALGUI",1,0)
XQALGUI ; SFCIOFO/JLI - KERNEL COMPONENTS FOR ALERTS ;07/24/11  15:02
"RTN","XQALGUI",2,0)
 ;;8.0;KERNEL;**207,513**;Jul 10, 1995;Build 13
"RTN","XQALGUI",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XQALGUI",4,0)
 ;
"RTN","XQALGUI",5,0)
 ;  added CURRSURO and SETSURO entry points  3/21/00  jli
"RTN","XQALGUI",6,0)
 ;
"RTN","XQALGUI",7,0)
 ; All entry is at the ENTRY tag.  The type of processing is indicated by the
"RTN","XQALGUI",8,0)
 ; variable LOC which contains the name of the tag to be used for processing.
"RTN","XQALGUI",9,0)
 ; The following tags currently exist and expect the variable names indicated
"RTN","XQALGUI",10,0)
 ;
"RTN","XQALGUI",11,0)
 ;  SEND
"RTN","XQALGUI",12,0)
 ;  GETLIST
"RTN","XQALGUI",13,0)
 ;  ISPEND
"RTN","XQALGUI",14,0)
 ;  ISNEW
"RTN","XQALGUI",15,0)
 ;  DELETE
"RTN","XQALGUI",16,0)
 ;  FORWARD
"RTN","XQALGUI",17,0)
 ;  CURRSURO
"RTN","XQALGUI",18,0)
 ;  SETSURO
"RTN","XQALGUI",19,0)
 ;
"RTN","XQALGUI",20,0)
ENTRY(XQALRSLT,DATA) ;
"RTN","XQALGUI",21,0)
 K ^TMP($J) N I,LOC,XQA,XQACTMSG,XQAEND,XQAID,XQALFWD,XQALRSL1,XQAMSG,XQASTART,XQASURO,XQATEXT
"RTN","XQALGUI",22,0)
 N NAME,XQALSTO S NAME="" S XQALSTO=$NA(^TMP("XQALXQAL",$J)) K @XQALSTO
"RTN","XQALGUI",23,0)
 F  S NAME=$O(DATA(NAME)) Q:NAME=""  D  I $E(NAME)'=U S @("^TMP(""XQALXQAL"",$J,"_NAME1_")")=DATA(NAME)
"RTN","XQALGUI",24,0)
 . I $E(NAME)=U S @NAME=DATA(NAME) Q
"RTN","XQALGUI",25,0)
 . S NAME1=""""
"RTN","XQALGUI",26,0)
 . F I=1:1 S X=$P(NAME,",",I) Q:X=""  S NAME1=NAME1_$S(I>1:",""",1:"")_X_""""
"RTN","XQALGUI",27,0)
 S NAME="" F  S NAME=$O(@XQALSTO@(NAME)) Q:NAME=""  D:$D(@XQALSTO@(NAME))>1  I $D(@XQALSTO@(NAME))=1 N @NAME S @NAME=@XQALSTO@(NAME)
"RTN","XQALGUI",28,0)
 . N NAME1 S NAME1=""
"RTN","XQALGUI",29,0)
 . F  S NAME1=$O(@XQALSTO@(NAME,NAME1)) Q:NAME1=""  S @(NAME_"("""_NAME1_""")")=^(NAME1)
"RTN","XQALGUI",30,0)
 Q:'$D(LOC)
"RTN","XQALGUI",31,0)
 ; need to add code here to check key if XQAUSER is defined and not DUZ
"RTN","XQALGUI",32,0)
 G @LOC
"RTN","XQALGUI",33,0)
 ;
"RTN","XQALGUI",34,0)
2 ;
"RTN","XQALGUI",35,0)
SEND ;
"RTN","XQALGUI",36,0)
SETUP ; ENTRY FOR SETUP NEW ALERT
"RTN","XQALGUI",37,0)
 I '$D(XQAUSER) S XQAUSER=DUZ
"RTN","XQALGUI",38,0)
 Q:($O(XQA(""))="")  Q:'$D(XQAMSG)
"RTN","XQALGUI",39,0)
 I $D(^TMP($J,"XQAL1")) S XQATEXT=$NA(^TMP($J,"XQAL1"))
"RTN","XQALGUI",40,0)
 D SETUP^XQALERT ; Supported Reference
"RTN","XQALGUI",41,0)
 Q
"RTN","XQALGUI",42,0)
 ;
"RTN","XQALGUI",43,0)
GETLIST ; GET LIST OF ALERTS FOR USER
"RTN","XQALGUI",44,0)
 I '$D(XQAUSER) S XQAUSER=DUZ
"RTN","XQALGUI",45,0)
 S XQALRSLT=$NA(^TMP($J)),XQALRSL1=$NA(^TMP("XQALXQAL",$J)) K @XQALRSL1,@XQALRSLT
"RTN","XQALGUI",46,0)
 D GETUSER1^XQALDATA(XQALRSL1,XQAUSER) ;
"RTN","XQALGUI",47,0)
 F I=0:0 S I=$O(@XQALRSL1@(I)) Q:I'>0  S X=^(I) K ^(I) S @XQALRSLT@(I)=X
"RTN","XQALGUI",48,0)
 Q
"RTN","XQALGUI",49,0)
 ;
"RTN","XQALGUI",50,0)
ISPEND ;
"RTN","XQALGUI",51,0)
 S XQALRSLT=$NA(^TMP($J,"XQALXQAL")) K @XQALRSLT
"RTN","XQALGUI",52,0)
 I $O(^XTV(8992,DUZ,"XQA",0))>0 S @XQALRSLT@(1)=1
"RTN","XQALGUI",53,0)
 E  S @XQALRSLT@(1)=0
"RTN","XQALGUI",54,0)
 Q
"RTN","XQALGUI",55,0)
 ;
"RTN","XQALGUI",56,0)
ISNEW ;
"RTN","XQALGUI",57,0)
 S XQALRSLT=$NA(^TMP($J,"XQALXQAL")) K @XQALRSLT
"RTN","XQALGUI",58,0)
 S @XQALRSLT@(1)=0
"RTN","XQALGUI",59,0)
 F I=0:0 S I=$O(^XTV(8992,DUZ,"XQA",I)) Q:I'>0  I $P($G(^(I,0)),U,4)>0 S @XQALRSLT@(1)=1 Q
"RTN","XQALGUI",60,0)
 Q
"RTN","XQALGUI",61,0)
 ;
"RTN","XQALGUI",62,0)
DELETE ;
"RTN","XQALGUI",63,0)
 I '$D(XQAUSER) S XQAUSER=DUZ
"RTN","XQALGUI",64,0)
 D DELETE^XQALERT
"RTN","XQALGUI",65,0)
 Q
"RTN","XQALGUI",66,0)
 ;
"RTN","XQALGUI",67,0)
FORWARD ;
"RTN","XQALGUI",68,0)
 I '$D(XQAUSER) N XQAUSER S XQAUSER=DUZ
"RTN","XQALGUI",69,0)
 S XQALFWD(1)=IEN
"RTN","XQALGUI",70,0)
 D FORWARD^XQALFWD(.XQALFWD,.XQA,"A",$G(XQACTMSG))
"RTN","XQALGUI",71,0)
 Q
"RTN","XQALGUI",72,0)
 ;
"RTN","XQALGUI",73,0)
GETSURO ; GET CURRENT SURROGATE INFORMATION (IF ANY)
"RTN","XQALGUI",74,0)
 I '$D(XQAUSER) S XQAUSER=DUZ
"RTN","XQALGUI",75,0)
 N X S X=$$GETSURO^XQALSURO(XQAUSER) I X'>0 S X="" ; SUPPORTED REFERENCE
"RTN","XQALGUI",76,0)
 S XQALRSLT=$NA(^TMP($J,"XQALXQAL")) K @XQALRSLT
"RTN","XQALGUI",77,0)
 S @XQALRSLT@(1)=X
"RTN","XQALGUI",78,0)
 Q
"RTN","XQALGUI",79,0)
 ;
"RTN","XQALGUI",80,0)
SETSURO ; SET NEW SURROGATE
"RTN","XQALGUI",81,0)
 Q:XQASURO'>0
"RTN","XQALGUI",82,0)
 I '$D(XQAUSER) S XQAUSER=DUZ
"RTN","XQALGUI",83,0)
 S XQALRSLT=$NA(^TMP("XQALRSLT",$J)) K @XQALRSLT
"RTN","XQALGUI",84,0)
 S @XQALRSLT@(1)=$$SETSURO1^XQALSURO(XQAUSER,XQASURO,XQASTART,XQAEND) ; SUPPORTED REFERENCE
"RTN","XQALGUI",85,0)
 Q
"RTN","XQALGUI",86,0)
 ;
"RTN","XQALGUI",87,0)
SUROFOR ;
"RTN","XQALGUI",88,0)
 N SUROLIST S XQALRSLT=$NA(^TMP("XQALRSLT",$J)) K @XQALRSLT
"RTN","XQALGUI",89,0)
 I '$D(XQAUSER) S XQAUSER=DUZ
"RTN","XQALGUI",90,0)
 D SUROFOR^XQALSURO(.SUROLIST,XQAUSER)
"RTN","XQALGUI",91,0)
 M @XQALRSLT=SUROLIST
"RTN","XQALGUI",92,0)
 Q
"RTN","XQALGUI",93,0)
 Q
"RTN","XQALGUI",94,0)
 ;
"RTN","XQALGUI",95,0)
REMVSURO ; REMOVE SURROGATE
"RTN","XQALGUI",96,0)
 I '$D(XQAUSER) S XQAUSER=DUZ
"RTN","XQALGUI",97,0)
 D REMVSURO^XQALSURO(XQAUSER) ; SUPPORTED REFERENCE
"RTN","XQALGUI",98,0)
 Q
"RTN","XQALGUI",99,0)
 ;
"RTN","XQALGUI",100,0)
GETDATA ;
"RTN","XQALGUI",101,0)
 S XQALRSLT=$NA(^TMP("XQALRSLT",$J)) K @XQALRSLT
"RTN","XQALGUI",102,0)
 N IEN S IEN=$O(^XTV(8992,"AXQA",XQAID,DUZ,0)) Q:IEN'>0
"RTN","XQALGUI",103,0)
 S @XQALRSLT@(1)=$P(^XTV(8992,DUZ,"XQA",IEN,0),U,7,8)
"RTN","XQALGUI",104,0)
 S @XQALRSLT@(2)=$G(^XTV(8992,DUZ,"XQA",IEN,1))
"RTN","XQALGUI",105,0)
 S @XQALRSLT@(3)=$P($G(^XTV(8992,DUZ,"XQA",IEN,3)),U)
"RTN","XQALGUI",106,0)
 Q
"RTN","XQALGUI",107,0)
 ;
"RTN","XQALGUI",108,0)
GETLONG ; TAKE LONG TEXT BACK TO THE CLIENT
"RTN","XQALGUI",109,0)
 S XQALRSLT=$NA(^TMP("XQALRSLT",$J)) K @XQALRSLT
"RTN","XQALGUI",110,0)
 I '$D(XQAUSER) N XQAUSER S XQAUSER=DUZ
"RTN","XQALGUI",111,0)
 N IEN,IENS,XQALTMP S IEN=$O(^XTV(8992,"AXQA",XQAID,XQAUSER,0)) Q:IEN'>0
"RTN","XQALGUI",112,0)
 S IENS=IEN_","_XQAUSER_",",XQALTMP=$NA(^TMP($J)) K @XQALTMP
"RTN","XQALGUI",113,0)
 D GETS^DIQ(8992.01,(IEN_","_XQAUSER_","),"4","",XQALTMP)
"RTN","XQALGUI",114,0)
 F I=0:0 S I=$O(@XQALTMP@(8992.01,IENS,4,I)) Q:I'>0  S @XQALRSLT@(I)=^(I)
"RTN","XQALGUI",115,0)
 K @XQALTMP
"RTN","XQALGUI",116,0)
 Q
"RTN","XQALGUI",117,0)
 ;
"RTN","XQALGUI",118,0)
CHKADPAC ; Check for ADPAC or IRM status
"RTN","XQALGUI",119,0)
 S XQALRSLT=$NA(^TMP("XQALRSLT",$J)) K @XQALRSLT
"RTN","XQALGUI",120,0)
 N XQALVAL,RESULT S XQALVAL=0
"RTN","XQALGUI",121,0)
 D OWNSKEY^XUSRB(.RESULT,"XQAL-DELETE") S XQALVAL=RESULT(0)
"RTN","XQALGUI",122,0)
 S @XQALRSLT@(1)=XQALVAL
"RTN","XQALGUI",123,0)
 Q
"RTN","XQALGUI",124,0)
 ;
"RTN","XQALSET1")
0^3^B4976921^B4576629
"RTN","XQALSET1",1,0)
XQALSET1 ;ISC-SF.SEA/JLI - SETUP ALERTS (OVERFLOW) ;07/24/11  15:13
"RTN","XQALSET1",2,0)
 ;;8.0;KERNEL;**285,443,513**;Jul 10, 1995;Build 13
"RTN","XQALSET1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XQALSET1",4,0)
 Q
"RTN","XQALSET1",5,0)
GROUP ;
"RTN","XQALSET1",6,0)
 N XQI,XQL,XQL1,XQL2,XQLIST
"RTN","XQALSET1",7,0)
 ; ZEXCEPT: XQA,XQJ - defined in calling routine
"RTN","XQALSET1",8,0)
 S XQL=$E(XQJ,3,$L(XQJ)) ; P443 - changed from code that forced upper case
"RTN","XQALSET1",9,0)
 I $D(^TMP("XQAGROUP",$J,XQL)) Q  ; P443 group has already been processed - prevent cycling
"RTN","XQALSET1",10,0)
 S ^TMP("XQAGROUP",$J,XQL)="" ; P443 mark that the group has been seen
"RTN","XQALSET1",11,0)
 S XQI=$$FIND1^DIC(3.8,,"X",XQL) I XQI'>0 K XQA(XQJ) Q  ; P513 remove entry if not available
"RTN","XQALSET1",12,0)
 N XQLIST D LIST^DIC(3.81,","_XQI_",",".01","I",,,,,,,.XQLIST) I XQLIST("ORDER")>0 D
"RTN","XQALSET1",13,0)
 . N XQI F XQI=0:0 S XQI=$O(@XQLIST@("ID",XQI)) Q:XQI'>0  S XQA(^(XQI,.01))=""
"RTN","XQALSET1",14,0)
 . Q
"RTN","XQALSET1",15,0)
 K @XQLIST,XQLIST D LIST^DIC(3.811,","_XQI_",",".01",,,,,,,,.XQLIST) I XQLIST("ORDER")>0 D
"RTN","XQALSET1",16,0)
 . N XQAGROUP M XQAGROUP=@XQLIST@("ID") ; P443 - store group list data locally so it is not over written by recursive call to LIST^DIC
"RTN","XQALSET1",17,0)
 . N XQI F XQI=0:0 S XQI=$O(XQAGROUP(XQI)) Q:XQI'>0  N XQJ S XQJ="G."_XQAGROUP(XQI,.01) D GROUP ; P443 - change to reference XQAGROUP
"RTN","XQALSET1",18,0)
 . Q
"RTN","XQALSET1",19,0)
 K @XQLIST,XQLIST
"RTN","XQALSET1",20,0)
 K XQA(XQJ)
"RTN","XQALSET1",21,0)
 D CHEKACTV(.XQA)
"RTN","XQALSET1",22,0)
 Q
"RTN","XQALSET1",23,0)
 ;
"RTN","XQALSET1",24,0)
 ; Check and remove any entries in array that don't have active surrogates and aren't active
"RTN","XQALSET1",25,0)
CHEKACTV(XQARRAY) ;
"RTN","XQALSET1",26,0)
 N XQJ
"RTN","XQALSET1",27,0)
 F XQJ=0:0 S XQJ=$O(XQARRAY(XQJ)) Q:XQJ'>0  I $$CHEKUSER(XQJ)'>0 K XQARRAY(XQJ)
"RTN","XQALSET1",28,0)
 Q
"RTN","XQALSET1",29,0)
 ;
"RTN","XQALSET1",30,0)
CHEKUSER(XQAUSER) ; Returns 0 if no valid user or surrogate, otherwise returns IEN of user or surrogate
"RTN","XQALSET1",31,0)
 N VALUE
"RTN","XQALSET1",32,0)
 S VALUE=$$ACTVSURO^XQALSURO(XQAUSER)
"RTN","XQALSET1",33,0)
 I VALUE'>0 S VALUE=XQAUSER I '$$ACTIVE^XUSER(XQAUSER) Q 0
"RTN","XQALSET1",34,0)
 Q VALUE
"RTN","XQALSET1",35,0)
 ;
"RTN","XQALSUR2")
0^2^B3811185^B6279756
"RTN","XQALSUR2",1,0)
XQALSUR2 ;FO-OAK.SEA/JLI-Continuation of alert surrogate processing ;07/24/11  15:15
"RTN","XQALSUR2",2,0)
 ;;8.0;KERNEL;**366,513**;Jul 10, 1995;Build 13
"RTN","XQALSUR2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XQALSUR2",4,0)
 Q
"RTN","XQALSUR2",5,0)
 ; added to handle adjustment for manual or Fileman editing of surrogate on top zero node
"RTN","XQALSUR2",6,0)
CHEKSUBS(XQAUSER) ;
"RTN","XQALSUR2",7,0)
 N XQA0,XQASTR1,XQANOW,XQB0,XQB1
"RTN","XQALSUR2",8,0)
 S XQANOW=$$NOW^XLFDT()
"RTN","XQALSUR2",9,0)
 S XQA0=$G(^XTV(8992,XQAUSER,0)) I $P(XQA0,U,2)>0 D
"RTN","XQALSUR2",10,0)
 . N XQAFDA,XQAIEN,XQADA
"RTN","XQALSUR2",11,0)
 . S XQASTR1=$P(XQA0,U,3) S:XQASTR1'>0 XQASTR1=XQANOW,XQAFDA(8992,XQAUSER_",",.03)=XQASTR1 D
"RTN","XQALSUR2",12,0)
 . . S XQADA=0 F  S XQADA=$O(^XTV(8992,XQAUSER,2,"B",XQASTR1,XQADA)) Q:XQADA'>0  Q:$P(^XTV(8992,XQAUSER,2,XQADA,0),U,2)=$P(XQA0,U,2)
"RTN","XQALSUR2",13,0)
 . . S XQAIEN=$S(XQADA>0:XQADA,1:"+1")_","_XQAUSER_"," S XQAFDA(8992.02,XQAIEN,.01)=XQASTR1
"RTN","XQALSUR2",14,0)
 . . S XQAFDA(8992.02,XQAIEN,.02)=$P(XQA0,U,2) S:$P(XQA0,U,4)>0 XQAFDA(8992.02,XQAIEN,.03)=$P(XQA0,U,4)
"RTN","XQALSUR2",15,0)
 . . D:XQADA'>0 UPDATE^DIE("","XQAFDA")
"RTN","XQALSUR2",16,0)
 . . D:XQADA>0 FILE^DIE("","XQAFDA")
"RTN","XQALSUR2",17,0)
 . . Q
"RTN","XQALSUR2",18,0)
 . Q
"RTN","XQALSUR2",19,0)
 Q
"RTN","XQALSUR2",20,0)
 ;
"RTN","XQALSUR2",21,0)
CHKCRIT(ZERONODE) ;EXTRINSIC - check for critical indication for alert
"RTN","XQALSUR2",22,0)
 ; ZERONODE - input - Value for zero node for alert data
"RTN","XQALSUR2",23,0)
 ; RETURN VALUE - 1 if the alert is indicated as critical
"RTN","XQALSUR2",24,0)
 ;                0 otherwise
"RTN","XQALSUR2",25,0)
 N RESULT,IEN
"RTN","XQALSUR2",26,0)
 S RESULT=0
"RTN","XQALSUR2",27,0)
 F IEN=0:0 S IEN=$O(^XTV(8992.3,IEN)) Q:IEN'>0  D  Q:RESULT
"RTN","XQALSUR2",28,0)
 . N IENS,RES,MSG,CRITTEXT,PKGID,ALERTTXT
"RTN","XQALSUR2",29,0)
 . S IENS=IEN_","
"RTN","XQALSUR2",30,0)
 . D GETS^DIQ(8992.3,IENS,".01:.02",,"RES","MSG")
"RTN","XQALSUR2",31,0)
 . S CRITTEXT=$$UP^XLFSTR(RES(8992.3,IENS,.01)),PKGID=$$UP^XLFSTR(RES(8992.3,IENS,.02))
"RTN","XQALSUR2",32,0)
 . I PKGID'="",$$UP^XLFSTR($P(ZERONODE,U,2))'[PKGID Q
"RTN","XQALSUR2",33,0)
 . S ALERTTXT=$$UP^XLFSTR($P(ZERONODE,U,3))
"RTN","XQALSUR2",34,0)
 . I ALERTTXT[CRITTEXT,ALERTTXT'["NOT "_CRITTEXT S RESULT=1
"RTN","XQALSUR2",35,0)
 Q RESULT
"RTN","XQALSURO")
0^1^B90015726^B77946006
"RTN","XQALSURO",1,0)
XQALSURO ;ISC-SF.SEA/JLI,ISD/HGW - SURROGATES FOR ALERTS ;12/30/11  11:01
"RTN","XQALSURO",2,0)
 ;;8.0;KERNEL;**114,125,173,285,366,443,513**;Jul 10, 1995;Build 13
"RTN","XQALSURO",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XQALSURO",4,0)
 Q
"RTN","XQALSURO",5,0)
OTHRSURO ; OPT:- XQALERT SURROGATE SET/REMOVE -- OTHERS SPECIFY SURROGATE FOR SELECTED USER
"RTN","XQALSURO",6,0)
 N XQAUSER,DIR,Y
"RTN","XQALSURO",7,0)
 S DIR(0)="PD^200:AEMQ",DIR("A",1)="SURROGATE related to which"
"RTN","XQALSURO",8,0)
 S DIR("A")="NEW PERSON entry"
"RTN","XQALSURO",9,0)
 D ^DIR K DIR Q:Y'>0  W "  ",$P(Y,U,2)
"RTN","XQALSURO",10,0)
 S XQAUSER=+Y
"RTN","XQALSURO",11,0)
 G SURROGAT
"RTN","XQALSURO",12,0)
 Q
"RTN","XQALSURO",13,0)
 ;
"RTN","XQALSURO",14,0)
SURROGAT ; USER SPECIFICATION OF SURROGATE
"RTN","XQALSURO",15,0)
 I '$D(XQAUSER) N XQAUSER S XQAUSER=DUZ
"RTN","XQALSURO",16,0)
 D SURRO1^XQALSUR1(XQAUSER)
"RTN","XQALSURO",17,0)
 Q
"RTN","XQALSURO",18,0)
CYCLIC(XQALSURO,XQAUSER,XQASTRT,XQAEND) ; code added to prevent cyclical surrogates
"RTN","XQALSURO",19,0)
 I '$$ACTIVE^XUSER(XQALSURO) Q "You cannot have an INACTIVE USER ("_XQALSURO_") as a surrogate!" ;P443
"RTN","XQALSURO",20,0)
 I XQALSURO=XQAUSER Q "You cannot specify yourself as your own surrogate!" ; moved in P443
"RTN","XQALSURO",21,0)
 I $G(XQASTRT)>0 Q $$DCYCLIC^XQALSUR1(XQALSURO,XQAUSER,XQASTRT,$G(XQAEND))
"RTN","XQALSURO",22,0)
 N XQALSTRT
"RTN","XQALSURO",23,0)
 S XQALSTRT=$$CURRSURO(XQALSURO) I XQALSTRT>0 D
"RTN","XQALSURO",24,0)
 . I XQALSTRT=XQAUSER S XQALSURO="YOU are designated as the surrogate for this user ("_XQALSURO_") - can't do it!" Q
"RTN","XQALSURO",25,0)
 . F  S XQALSTRT=$$CURRSURO(XQALSTRT) Q:XQALSTRT'>0  I XQALSTRT=XQAUSER S XQALSURO="This forms a circle which leads back to you - can't do it!" Q
"RTN","XQALSURO",26,0)
 . Q
"RTN","XQALSURO",27,0)
 Q XQALSURO
"RTN","XQALSURO",28,0)
 ;
"RTN","XQALSURO",29,0)
SETSURO(XQAUSER,XQALSURO,XQALSTRT,XQALEND) ; Use SETSURO1 instead
"RTN","XQALSURO",30,0)
 N XQALVAL ; P443
"RTN","XQALSURO",31,0)
 S XQALVAL=$$SETSURO1(XQAUSER,XQALSURO,$G(XQALSTRT),$G(XQALEND)) ; P443
"RTN","XQALSURO",32,0)
 Q
"RTN","XQALSURO",33,0)
 ;
"RTN","XQALSURO",34,0)
SETSUROX(XQAUSER,XQALSURO,XQALSTRT,XQALEND) ; SETSURO CODE MOVED TO HERE TO PERMIT AN ERROR TO BE GENERATED AT THE OLD ENTRY POINT
"RTN","XQALSURO",35,0)
 N XQALFM,XQALIEN,XQAIENS
"RTN","XQALSURO",36,0)
 I '$D(^XTV(8992,XQAUSER,0)) D
"RTN","XQALSURO",37,0)
 . N XQALFM,XQALFM1
"RTN","XQALSURO",38,0)
 . S XQALFM1(1)=XQAUSER
"RTN","XQALSURO",39,0)
 . S XQALFM(8992,"+1,",.01)=XQAUSER
"RTN","XQALSURO",40,0)
 . D UPDATE^DIE("","XQALFM","XQALFM1")
"RTN","XQALSURO",41,0)
 . Q
"RTN","XQALSURO",42,0)
 S XQAIENS=XQAUSER_","
"RTN","XQALSURO",43,0)
 ; P366 - force no start date/time to NOW
"RTN","XQALSURO",44,0)
 ; P366 - change to force anything less than NOW to NOW - 8/22/05
"RTN","XQALSURO",45,0)
 I $G(XQALSTRT)<$$NOW^XLFDT() S XQALSTRT=$$NOW^XLFDT()
"RTN","XQALSURO",46,0)
 ; P366 - add values to new multiple
"RTN","XQALSURO",47,0)
 S XQALFM(8992.02,"+1,"_XQAIENS,.01)=XQALSTRT
"RTN","XQALSURO",48,0)
 S XQALFM(8992.02,"+1,"_XQAIENS,.02)=XQALSURO
"RTN","XQALSURO",49,0)
 I XQALEND>0 S XQALFM(8992.02,"+1,"_XQAIENS,.03)=XQALEND
"RTN","XQALSURO",50,0)
 K XQALIEN D UPDATE^DIE("","XQALFM","XQALIEN")
"RTN","XQALSURO",51,0)
 ; P366 - if start date time is already in effect - place in old locations to make active
"RTN","XQALSURO",52,0)
 ;I XQALSTRT'>$$NOW^XLFDT() D ACTIVATE(XQAUSER,XQALIEN(1)) ; P513 commented out
"RTN","XQALSURO",53,0)
 D ACTIVATE(XQAUSER,XQALIEN(1)) ; P513 activate if current or next
"RTN","XQALSURO",54,0)
 N XQAMESG,XMSUB,XMTEXT
"RTN","XQALSURO",55,0)
 S XQAMESG(1,0)="You have been specified as a surrogate recipient for alerts for"
"RTN","XQALSURO",56,0)
 S XQAMESG(2,0)=$$GET1^DIQ(200,XQAIENS,.01,"E")_" (IEN="_XQAUSER_") effective "_$$FMTE^XLFDT(XQALSTRT)
"RTN","XQALSURO",57,0)
 I $G(XQALEND)'>0 S XQAMESG(2,0)=XQAMESG(2,0)_"."
"RTN","XQALSURO",58,0)
 E  S XQAMESG(3,0)="until "_$$FMTE^XLFDT(XQALEND)
"RTN","XQALSURO",59,0)
 S XMSUB="Surrogate Recipient for "_$$GET1^DIQ(200,XQAIENS,.01,"E")
"RTN","XQALSURO",60,0)
 S XMTEXT="XQAMESG("
"RTN","XQALSURO",61,0)
 ; ZEXCEPT: XTMUNIT   - Defined if unit tests are being run
"RTN","XQALSURO",62,0)
 D:'$D(XTMUNIT) SENDMESG
"RTN","XQALSURO",63,0)
 Q
"RTN","XQALSURO",64,0)
 ;
"RTN","XQALSURO",65,0)
ACTIVATE(XQAUSER,XQALIEN) ; activates a surrogate
"RTN","XQALSURO",66,0)
 N X0,XQALFM,XQALSURO,XQALSTRT,XQALEND
"RTN","XQALSURO",67,0)
 S X0=$G(^XTV(8992,XQAUSER,2,XQALIEN,0)) Q:X0=""  S XQALSTRT=$P(X0,U),XQALSURO=$P(X0,U,2),XQALEND=$P(X0,U,3)
"RTN","XQALSURO",68,0)
 S X0=^XTV(8992,XQAUSER,0)
"RTN","XQALSURO",69,0)
 I $P(X0,U,2)>0,$P(X0,U,3)'>$$NOW^XLFDT() D REMVSURO(XQAUSER) ; If we are activaing a new surrogate, if one exists simply remove.
"RTN","XQALSURO",70,0)
 K XQALFM S XQALFM(8992,XQAUSER_",",.03)=XQALSTRT
"RTN","XQALSURO",71,0)
 S XQALFM(8992,XQAUSER_",",.02)=XQALSURO
"RTN","XQALSURO",72,0)
 S XQALFM(8992,XQAUSER_",",.04)=$S($G(XQALEND)>0:XQALEND,1:"@")
"RTN","XQALSURO",73,0)
 D FILE^DIE("","XQALFM")
"RTN","XQALSURO",74,0)
 Q
"RTN","XQALSURO",75,0)
 ;
"RTN","XQALSURO",76,0)
 ; usage $$SETSURO1(XQAUSER,XQALSURO,XQALSTRT,XQALEND)  returns 0 if invalid, otherwise > 0
"RTN","XQALSURO",77,0)
SETSURO1(XQAUSER,XQALSURO,XQALSTRT,XQALEND) ; SR. This should be used instead of SETSURO
"RTN","XQALSURO",78,0)
 I $G(XQAUSER)'>0 Q "Invalid Internal Entry Number for user ("_XQAUSER_")" ; P513 moved from SETSUROX+2
"RTN","XQALSURO",79,0)
 I $G(XQALSURO)'>0 Q "Invalid Internal Entry Number for surrogate ("_XQALSURO_")" ; P513 moved from SETSUROX+3
"RTN","XQALSURO",80,0)
 I $G(XQALSTRT)'>0 S XQALSTRT=$$NOW^XLFDT()
"RTN","XQALSURO",81,0)
 N XQAVAL
"RTN","XQALSURO",82,0)
 S XQAVAL=$$CYCLIC(XQALSURO,XQAUSER,XQALSTRT,$G(XQALEND)) I XQAVAL'>0 Q XQAVAL ; Can't use as surrogate
"RTN","XQALSURO",83,0)
 D SETSUROX(XQAUSER,XQALSURO,XQALSTRT,$G(XQALEND)) ; P443
"RTN","XQALSURO",84,0)
 Q XQALSURO
"RTN","XQALSURO",85,0)
 ;
"RTN","XQALSURO",86,0)
CHKREMV ;
"RTN","XQALSURO",87,0)
 N DIR,XQAI,XQASLIST,XQAVAL,YVAL,Y
"RTN","XQALSURO",88,0)
 ; ZEXCEPT: XQAUSER    (EXTERNAL VALUE)
"RTN","XQALSURO",89,0)
 D SUROLIST^XQALSUR1(XQAUSER,.XQASLIST)
"RTN","XQALSURO",90,0)
 W !,"Current Surrogate(s):",?35,"START DATE",?60,"END DATE"
"RTN","XQALSURO",91,0)
 F XQAI=0:0 S XQAI=$O(XQASLIST(XQAI)) Q:XQAI'>0  W !,XQAI,"  ",$P(XQASLIST(XQAI),U,2),?35,$$FMTE^XLFDT($P(XQASLIST(XQAI),U,3)),?60,$$FMTE^XLFDT($P(XQASLIST(XQAI),U,4))
"RTN","XQALSURO",92,0)
 W ! I XQASLIST'>0 W !,"  No current surrogates",! Q
"RTN","XQALSURO",93,0)
 S DIR(0)="Y",DIR("A")="Do you want to REMOVE "_$S(XQASLIST>1:"a",1:"THIS")_" surrogate recipient",DIR("?")="A surrogate will receive your alerts until they are removed as surrogate." D ^DIR K DIR Q:Y'>0
"RTN","XQALSURO",94,0)
 S Y=1 I XQASLIST>1 S DIR(0)="L^1:"_XQASLIST,DIR("A")="Enter a list (comma separated, e.g., 1,2) of the surrogate(s) to remove" D ^DIR K DIR
"RTN","XQALSURO",95,0)
 I Y>0 S YVAL=Y F XQAI=1:1 S XQAVAL=+$P(YVAL,",",XQAI) Q:XQAVAL'>0  D REMVSURO(XQAUSER,$P(XQASLIST(XQAVAL),U),$P(XQASLIST(XQAVAL),U,3))
"RTN","XQALSURO",96,0)
 Q
"RTN","XQALSURO",97,0)
 ;
"RTN","XQALSURO",98,0)
 ; P366 - added OPTIONAL second and third arguments to permit deletion of a specific pending surrogate and start date
"RTN","XQALSURO",99,0)
REMVSURO(XQAUSER,XQALSURO,XQALSTRT) ; SR - ends the currently active surrogate relationship
"RTN","XQALSURO",100,0)
 I $G(XQAUSER)'>0 Q
"RTN","XQALSURO",101,0)
 D REMVSURO^XQALSUR1(XQAUSER,$G(XQALSURO),$G(XQALSTRT))
"RTN","XQALSURO",102,0)
 Q
"RTN","XQALSURO",103,0)
 ;
"RTN","XQALSURO",104,0)
 ; P366 - added OPTIONAL second and third arguments to determine surrogate for specified time range
"RTN","XQALSURO",105,0)
CURRSURO(XQAUSER,XQASTRT,XQAEND) ;SR. - returns current surrogate for user or -1  usage $$CURRSURO^XQALSURO(DUZ)
"RTN","XQALSURO",106,0)
 N X,ACTIVE,XQANOW,XQASTR1,XQAIVAL,XQA0,XQAI
"RTN","XQALSURO",107,0)
 D CHEKSUBS^XQALSUR2(XQAUSER)
"RTN","XQALSURO",108,0)
 I $G(XQASTRT)>0 Q $$DATESURO^XQALSUR1(XQAUSER,XQASTRT,$G(XQAEND)) ; P366 - check for current in specified date/times
"RTN","XQALSURO",109,0)
 ;
"RTN","XQALSURO",110,0)
 ; P366 - find the latest start time which is now or past or the first one in the future
"RTN","XQALSURO",111,0)
 S XQANOW=$$NOW^XLFDT() D
"RTN","XQALSURO",112,0)
 . S XQAIVAL=0,XQASTR1=0
"RTN","XQALSURO",113,0)
 . F XQASTRT=0:0 S XQASTRT=$O(^XTV(8992,XQAUSER,2,"B",XQASTRT)) Q:XQASTRT'>0  Q:XQASTRT'<XQANOW  S XQASTR1=XQASTRT F XQAI=0:0 S XQAI=$O(^XTV(8992,XQAUSER,2,"B",XQASTRT,XQAI)) Q:XQAI'>0  D
"RTN","XQALSURO",114,0)
 . . S XQAEND=$P(^XTV(8992,XQAUSER,2,XQAI,0),U,3) I (XQAEND="")!(XQAEND>XQANOW) S XQAIVAL=XQAI
"RTN","XQALSURO",115,0)
 . . Q
"RTN","XQALSURO",116,0)
 . ; to be compatible with the past, if there is not a current surrogate, show the next scheduled on the zero node if there is one
"RTN","XQALSURO",117,0)
 . I XQAIVAL=0 S XQASTRT=$O(^XTV(8992,XQAUSER,2,"B",XQASTR1)) Q:XQASTRT=""  F XQAI=0:0 S XQAI=$O(^XTV(8992,XQAUSER,2,"B",XQASTRT,XQAI)) Q:XQAI'>0  D  Q:XQAIVAL>0
"RTN","XQALSURO",118,0)
 . . S XQAEND=$P(^XTV(8992,XQAUSER,2,XQAI,0),U,3) I (XQAEND="")!(XQAEND>XQANOW) S XQAIVAL=XQAI
"RTN","XQALSURO",119,0)
 . . Q
"RTN","XQALSURO",120,0)
 . I XQAIVAL>0 S XQA0=^XTV(8992,XQAUSER,2,XQAIVAL,0),XQASTRT=^XTV(8992,XQAUSER,0) I ($P(XQA0,U,2)'=$P(XQASTRT,U,2))!($P(XQA0,U)'=$P(XQASTRT,U,3))!(+$P(XQA0,U,3)'=+$P(XQASTRT,U,4)) D ACTIVATE(XQAUSER,XQAIVAL)
"RTN","XQALSURO",121,0)
 . Q
"RTN","XQALSURO",122,0)
 ; P366 - end
"RTN","XQALSURO",123,0)
 S X=$G(^XTV(8992,XQAUSER,0))
"RTN","XQALSURO",124,0)
 ; now check for a CURRENT surrogate, already started and not expired or cyclic
"RTN","XQALSURO",125,0)
 I $P(X,U,2)>0,+$P(X,U,3)'>XQANOW D  I $P($G(^XTV(8992,XQAUSER,0)),U,2)>0 Q +$P(^XTV(8992,XQAUSER,0),U,2)
"RTN","XQALSURO",126,0)
 . N DATE ;   Get Current date/time to check date/times if present
"RTN","XQALSURO",127,0)
 . ; FOLLOWING LINES MODIFIED IN P443 TO ELIMINATE A STACK ERROR WHEN SURROGATE WAS CIRCULAR
"RTN","XQALSURO",128,0)
 . ;  Current Date/time past End date for surrogate
"RTN","XQALSURO",129,0)
 . S DATE=$P(X,U,4) I (DATE>0&(DATE<XQANOW)) D REMVSURO(XQAUSER) Q
"RTN","XQALSURO",130,0)
 . ; P513 quit if not already active
"RTN","XQALSURO",131,0)
 . S DATE=$P(X,U,3) S:DATE="" DATE=XQANOW I DATE>XQANOW Q  ; P513
"RTN","XQALSURO",132,0)
 . N XQASURO,XQASURO1 S XQASURO1=+$P(^XTV(8992,XQAUSER,0),U,2)
"RTN","XQALSURO",133,0)
 . ; REMOVE IF SURROGATE IS USER
"RTN","XQALSURO",134,0)
 . I XQASURO1=XQAUSER D REMVSURO(XQAUSER) Q
"RTN","XQALSURO",135,0)
 . N XQALLIST,XQAUDATE S XQAUDATE=DATE,XQALLIST(XQAUSER,DATE)="" ; P513 JLI 100504 add XQAUDATE to be able to check earlier start time
"RTN","XQALSURO",136,0)
 . ; REMOVE IF CYCLES BACK TO USER - thought about removing inactive, but best to let those be handled by groups for unprocessed alerts
"RTN","XQALSURO",137,0)
 . ; P513 but ignore if surrogate isn't already active - JLI 100504
"RTN","XQALSURO",138,0)
 . ; begin changes in P513
"RTN","XQALSURO",139,0)
 . S XQASURO1=XQAUSER
"RTN","XQALSURO",140,0)
 . F  S XQASURO=$P($G(^XTV(8992,XQASURO1,0)),U,2) Q:XQASURO'>0  Q:'$$ISACTIVE(XQASURO)  S DATE=$P(^XTV(8992,XQASURO,0),U,3) Q:DATE>XQANOW  D  S XQASURO1=XQASURO ; JLI 100504
"RTN","XQALSURO",141,0)
 . . I $D(XQALLIST(XQASURO1)) D
"RTN","XQALSURO",142,0)
 . . . N DATE1 S DATE1=$O(XQALLIST(XQASURO1,""))
"RTN","XQALSURO",143,0)
 . . . ; remove the surrogate relationship that started earliest
"RTN","XQALSURO",144,0)
 . . . I DATE<DATE1 D REMVSURO(XQASURO)
"RTN","XQALSURO",145,0)
 . . . I DATE1<=DATE D REMVSURO(XQASURO1)
"RTN","XQALSURO",146,0)
 . . . S XQASURO=XQAUSER K XQALLIST S DATE=XQAUDATE ; start over
"RTN","XQALSURO",147,0)
 . . . Q
"RTN","XQALSURO",148,0)
 . . S XQALLIST(XQASURO,DATE)=""
"RTN","XQALSURO",149,0)
 . . ; end of P513 modification
"RTN","XQALSURO",150,0)
 . . Q
"RTN","XQALSURO",151,0)
 . ; END OF P443 MODIFICATION
"RTN","XQALSURO",152,0)
 . Q
"RTN","XQALSURO",153,0)
 Q -1
"RTN","XQALSURO",154,0)
 ;
"RTN","XQALSURO",155,0)
ISACTIVE(XQAUSER) ; checks for whether a surrogate relationship is active or not (returns 0 or 1)
"RTN","XQALSURO",156,0)
 N DATA
"RTN","XQALSURO",157,0)
 S DATA=$G(^XTV(8992,XQAUSER,0)) Q:$P(DATA,U,2)="" 0  ; NO SURROGATE SPECIFIED
"RTN","XQALSURO",158,0)
 I $P(DATA,U,3)>0,$P(DATA,U,3)>$$NOW^XLFDT() Q 0  ; START DATE/TIME NOT YET
"RTN","XQALSURO",159,0)
 I $P(DATA,U,4)>0,$P(DATA,U,4)<$$NOW^XLFDT() Q 0  ; PAST END DATE/TIME
"RTN","XQALSURO",160,0)
 Q 1
"RTN","XQALSURO",161,0)
 ;
"RTN","XQALSURO",162,0)
ACTVSURO(XQAUSER) ;SR. - returns the actual surrogate at this time
"RTN","XQALSURO",163,0)
 N CURRSURO,NEXTSURO,SURODATA,NOW
"RTN","XQALSURO",164,0)
 S NOW=$$NOW^XLFDT()
"RTN","XQALSURO",165,0)
 S CURRSURO=$$CURRSURO(XQAUSER),SURODATA=$$GETSURO(XQAUSER) I (CURRSURO'>0)!(+$P(SURODATA,U,3)>NOW)!('(+$$ACTIVE^XUSER(CURRSURO))) Q -1
"RTN","XQALSURO",166,0)
 F  S NEXTSURO=$$CURRSURO(CURRSURO),SURODATA=$$GETSURO(CURRSURO) Q:NEXTSURO'>0  Q:+$P(SURODATA,U,3)>NOW  Q:'(+$$ACTIVE^XUSER(NEXTSURO))  S CURRSURO=NEXTSURO
"RTN","XQALSURO",167,0)
 Q CURRSURO
"RTN","XQALSURO",168,0)
 ;
"RTN","XQALSURO",169,0)
GETSURO(XQAUSER) ;SR. - returns data for surrogate for user including times
"RTN","XQALSURO",170,0)
 I $$CURRSURO(XQAUSER)'>0 Q ""
"RTN","XQALSURO",171,0)
 N GLOBREF,IENS,X
"RTN","XQALSURO",172,0)
 S IENS=XQAUSER_",",GLOBREF=$NA(^TMP($J,"XQALSURO")) K @GLOBREF
"RTN","XQALSURO",173,0)
 D GETS^DIQ(8992,IENS,".02;.03;.04","IE",GLOBREF)
"RTN","XQALSURO",174,0)
 S GLOBREF=$NA(@GLOBREF@(8992,IENS))
"RTN","XQALSURO",175,0)
 S X=$G(@GLOBREF@(.02,"I"))_U_$G(@GLOBREF@(.02,"E"))_U_$G(@GLOBREF@(.03,"I"))_U_$G(@GLOBREF@(.04,"I"))
"RTN","XQALSURO",176,0)
 K @GLOBREF
"RTN","XQALSURO",177,0)
 Q X
"RTN","XQALSURO",178,0)
 ;
"RTN","XQALSURO",179,0)
GETFOR ;OPT.
"RTN","XQALSURO",180,0)
 N XQAUSER,VALUES,XQACNT,DIR,DIRUT,I,Y
"RTN","XQALSURO",181,0)
 S DIR(0)="PD^200:AEMQ",DIR("A",1)="View Users who have selected a specified User as their Surrogate."
"RTN","XQALSURO",182,0)
 S DIR("A")="Select User (NEW PERSON entry)"
"RTN","XQALSURO",183,0)
 D ^DIR K DIR Q:Y'>0  W "  ",$P(Y,U,2)
"RTN","XQALSURO",184,0)
 S XQAUSER=+Y
"RTN","XQALSURO",185,0)
 D SUROFOR(.VALUES,XQAUSER) I VALUES'>0 W !,"No entries found.",!! Q
"RTN","XQALSURO",186,0)
 S XQACNT=0 K DIRUT F I=0:0 S I=$O(VALUES(I)) Q:I'>0  D:(XQACNT>(IOSL-4))  Q:$D(DIRUT)  W !,?5,$P(VALUES(I),U,2) S XQACNT=XQACNT+1
"RTN","XQALSURO",187,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","XQALSURO",188,0)
 . Q
"RTN","XQALSURO",189,0)
 K DIRUT
"RTN","XQALSURO",190,0)
 Q
"RTN","XQALSURO",191,0)
 ;
"RTN","XQALSURO",192,0)
SUROLIST(XQAUSER,XQALIST) ; SR. returns list of current and scheduled surrogates for XQAUSER
"RTN","XQALSURO",193,0)
 D SUROLIST^XQALSUR1(XQAUSER,.XQALIST)
"RTN","XQALSURO",194,0)
 Q
"RTN","XQALSURO",195,0)
 ;
"RTN","XQALSURO",196,0)
SUROFOR(LIST,XQAUSER) ;SR. - returns list of users XQAUSER is acting as a surrogate for
"RTN","XQALSURO",197,0)
 I $G(XQAUSER)="" Q
"RTN","XQALSURO",198,0)
 N I,COUNT S I=0,COUNT=0 F  S I=$O(^XTV(8992,"AC",XQAUSER,I)) Q:I'>0  I $$CURRSURO(I)>0 D
"RTN","XQALSURO",199,0)
 . S COUNT=COUNT+1,LIST(COUNT)=I_U_$$GET1^DIQ(200,(I_","),".01","E")_U_$$GET1^DIQ(8992,(I_","),".03","E")_U_$$GET1^DIQ(8992,(I_","),".04","E")
"RTN","XQALSURO",200,0)
 S LIST=COUNT
"RTN","XQALSURO",201,0)
 Q
"RTN","XQALSURO",202,0)
 ;
"RTN","XQALSURO",203,0)
SENDMESG ;
"RTN","XQALSURO",204,0)
 N XMY,XMDUZ,XMCHAN
"RTN","XQALSURO",205,0)
 ; ZEXCEPT: XQALSURO   (EXTERNAL VALUE)
"RTN","XQALSURO",206,0)
 S XMY(XQALSURO)="",XMDUZ=.5
"RTN","XQALSURO",207,0)
 D ^XMD
"RTN","XQALSURO",208,0)
 Q
"VER")
8.0^22.0
"^DD",8992.3,8992.3,0)
FIELD^^.03^3
"^DD",8992.3,8992.3,0,"DT")
3110114
"^DD",8992.3,8992.3,0,"IX","B",8992.3,.01)

"^DD",8992.3,8992.3,0,"NM","ALERT CRITICAL TEXT")

"^DD",8992.3,8992.3,0,"VRPK")
XU
"^DD",8992.3,8992.3,.01,0)
CRITICAL TEXT^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",8992.3,8992.3,.01,1,0)
^.1
"^DD",8992.3,8992.3,.01,1,1,0)
8992.3^B
"^DD",8992.3,8992.3,.01,1,1,1)
S ^XTV(8992.3,"B",$E(X,1,30),DA)=""
"^DD",8992.3,8992.3,.01,1,1,2)
K ^XTV(8992.3,"B",$E(X,1,30),DA)
"^DD",8992.3,8992.3,.01,3)
Enter a string of text which, if present in the message text for an alert, indicates a critical alert.  Answer must be 3-30 characters in length.  This is not case-sensitive.
"^DD",8992.3,8992.3,.01,21,0)
^^13^13^3110121^
"^DD",8992.3,8992.3,.01,21,1,0)
This is a string of text which if present in the message text for an alert
"^DD",8992.3,8992.3,.01,21,2,0)
should be identified as text identifying a critical alert and the alert
"^DD",8992.3,8992.3,.01,21,3,0)
emphasized in whatever manner available.
"^DD",8992.3,8992.3,.01,21,4,0)
 
"^DD",8992.3,8992.3,.01,21,5,0)
A second field PACKAGE-ID (#.02) may contain the identifier used by a
"^DD",8992.3,8992.3,.01,21,6,0)
package in the ALERTID when creating an alert.  If that field is non-null,
"^DD",8992.3,8992.3,.01,21,7,0)
an alert will only be marked critical if the PACKAGE-ID value is present
"^DD",8992.3,8992.3,.01,21,8,0)
in the ALERTID for the current alert.  This may be used to make critical
"^DD",8992.3,8992.3,.01,21,9,0)
text package-specific.
"^DD",8992.3,8992.3,.01,21,10,0)
 
"^DD",8992.3,8992.3,.01,21,11,0)
The comparison of the text entered with the text in the alert is NOT case
"^DD",8992.3,8992.3,.01,21,12,0)
sensitive.  Also, if the critical text in the alert is preceded by the
"^DD",8992.3,8992.3,.01,21,13,0)
word 'NOT', it will not be identified as a critical alert.
"^DD",8992.3,8992.3,.01,"DT")
3110111
"^DD",8992.3,8992.3,.02,0)
PACKAGE-ID^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",8992.3,8992.3,.02,3)
Optional.  Enter the PACKAGE-ID used when creating alerts that the CRITICAL TEXT should be associated with.  Enter 1-30 characters, it is not case-sensitive.
"^DD",8992.3,8992.3,.02,21,0)
^.001^8^8^3110121^^^
"^DD",8992.3,8992.3,.02,21,1,0)
This field is used to specify, if desired, a specific package ID to be 
"^DD",8992.3,8992.3,.02,21,2,0)
associated with the CRITICAL TEXT entered in field #.01.  The value 
"^DD",8992.3,8992.3,.02,21,3,0)
entered should be the textual part of the value used for XQAID when 
"^DD",8992.3,8992.3,.02,21,4,0)
creating the alert(s) (e.g., OR for Order Entry or TIU for Text
"^DD",8992.3,8992.3,.02,21,5,0)
Integration Utility).  If a non-null value is in this field, alerts
"^DD",8992.3,8992.3,.02,21,6,0)
containing the CRITICAL TEXT string will only be indicated as critical
"^DD",8992.3,8992.3,.02,21,7,0)
alerts if they also have text matching the PACKAGE-ID as a part of the
"^DD",8992.3,8992.3,.02,21,8,0)
ALERTID field.  Matching of this value will not be case sensitive.
"^DD",8992.3,8992.3,.02,"DT")
3110114
"^DD",8992.3,8992.3,.03,0)
CREATING PACKAGE^P9.4'^DIC(9.4,^0;3^Q
"^DD",8992.3,8992.3,.03,3)
Answer with the PACKAGE NAME that is responsible for creating this CRITICAL TEXT entry.
"^DD",8992.3,8992.3,.03,21,0)
^^2^2^3110725^
"^DD",8992.3,8992.3,.03,21,1,0)
This is the package which is responsible for creating this CRITICAL TEXT
"^DD",8992.3,8992.3,.03,21,2,0)
entry.
"^DD",8992.3,8992.3,.03,"DT")
3110114
"^DIC",8992.3,8992.3,0)
ALERT CRITICAL TEXT^8992.3
"^DIC",8992.3,8992.3,0,"GL")
^XTV(8992.3,
"^DIC",8992.3,"B","ALERT CRITICAL TEXT",8992.3)

"BLD",1376,6)
^473
**END**
**END**
