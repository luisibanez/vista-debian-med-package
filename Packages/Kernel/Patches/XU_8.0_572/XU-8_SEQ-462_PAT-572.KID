Released XU*8*572 SEQ #462
Extracted from mail message
**KIDS**:XU*8.0*572^

**INSTALL NAME**
XU*8.0*572
"BLD",1367,0)
XU*8.0*572^KERNEL^0^3110830^y
"BLD",1367,1,0)
^^2^2^3110606^
"BLD",1367,1,1,0)
Please see the National Patch Module on Forum for the description.
"BLD",1367,1,2,0)

"BLD",1367,4,0)
^9.64PA^^
"BLD",1367,6.3)
7
"BLD",1367,"ABPKG")
n
"BLD",1367,"INID")
^y
"BLD",1367,"INIT")
POST^XU8P572
"BLD",1367,"KRN",0)
^9.67PA^9002226^21
"BLD",1367,"KRN",.4,0)
.4
"BLD",1367,"KRN",.401,0)
.401
"BLD",1367,"KRN",.402,0)
.402
"BLD",1367,"KRN",.403,0)
.403
"BLD",1367,"KRN",.5,0)
.5
"BLD",1367,"KRN",.84,0)
.84
"BLD",1367,"KRN",3.6,0)
3.6
"BLD",1367,"KRN",3.8,0)
3.8
"BLD",1367,"KRN",9.2,0)
9.2
"BLD",1367,"KRN",9.8,0)
9.8
"BLD",1367,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",1367,"KRN",9.8,"NM",1,0)
ZIS1^^0^B29088522
"BLD",1367,"KRN",9.8,"NM",2,0)
ZIS5^^0^B16057553
"BLD",1367,"KRN",9.8,"NM",4,0)
XU8P572^^0^B29201
"BLD",1367,"KRN",9.8,"NM","B","XU8P572",4)

"BLD",1367,"KRN",9.8,"NM","B","ZIS1",1)

"BLD",1367,"KRN",9.8,"NM","B","ZIS5",2)

"BLD",1367,"KRN",19,0)
19
"BLD",1367,"KRN",19.1,0)
19.1
"BLD",1367,"KRN",101,0)
101
"BLD",1367,"KRN",409.61,0)
409.61
"BLD",1367,"KRN",771,0)
771
"BLD",1367,"KRN",779.2,0)
779.2
"BLD",1367,"KRN",870,0)
870
"BLD",1367,"KRN",8989.51,0)
8989.51
"BLD",1367,"KRN",8989.52,0)
8989.52
"BLD",1367,"KRN",8994,0)
8994
"BLD",1367,"KRN",9002226,0)
9002226
"BLD",1367,"KRN","B",.4,.4)

"BLD",1367,"KRN","B",.401,.401)

"BLD",1367,"KRN","B",.402,.402)

"BLD",1367,"KRN","B",.403,.403)

"BLD",1367,"KRN","B",.5,.5)

"BLD",1367,"KRN","B",.84,.84)

"BLD",1367,"KRN","B",3.6,3.6)

"BLD",1367,"KRN","B",3.8,3.8)

"BLD",1367,"KRN","B",9.2,9.2)

"BLD",1367,"KRN","B",9.8,9.8)

"BLD",1367,"KRN","B",19,19)

"BLD",1367,"KRN","B",19.1,19.1)

"BLD",1367,"KRN","B",101,101)

"BLD",1367,"KRN","B",409.61,409.61)

"BLD",1367,"KRN","B",771,771)

"BLD",1367,"KRN","B",779.2,779.2)

"BLD",1367,"KRN","B",870,870)

"BLD",1367,"KRN","B",8989.51,8989.51)

"BLD",1367,"KRN","B",8989.52,8989.52)

"BLD",1367,"KRN","B",8994,8994)

"BLD",1367,"KRN","B",9002226,9002226)

"BLD",1367,"QUES",0)
^9.62^^
"BLD",1367,"REQB",0)
^9.611^1^1
"BLD",1367,"REQB",1,0)
XU*8.0*546^2
"BLD",1367,"REQB","B","XU*8.0*546",1)

"INIT")
POST^XU8P572
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^1^1
"PKG",3,20,1,0)
200^^XDRM200N
"PKG",3,20,1,1)

"PKG",3,20,"B",200,1)

"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3090706^3090706^6
"PKG",3,22,1,"PAH",1,0)
572^3110830
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3110830
"PKG",3,22,1,"PAH",1,1,1,0)
Please see the National Patch Module on Forum for the description.
"PKG",3,22,1,"PAH",1,1,2,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","XU8P572")
0^4^B29201^n/a
"RTN","XU8P572",1,0)
XU8P572 ;ISF/CJM- Patch XU-572 Post init ;06/06/2011
"RTN","XU8P572",2,0)
 ;;8.0;KERNEL;**572**;;Build 7
"RTN","XU8P572",3,0)
 ;
"RTN","XU8P572",4,0)
POST ;
"RTN","XU8P572",5,0)
 D PATCH^ZTMGRSET(572)
"RTN","XU8P572",6,0)
 Q
"RTN","ZIS1")
0^1^B29088522^B27515391
"RTN","ZIS1",1,0)
%ZIS1 ;SFISC/AC,RWF -- DEVICE HANDLER (DEVICE INPUT) ;08/30/2011
"RTN","ZIS1",2,0)
 ;;8.0;KERNEL;**18,49,69,104,112,199,391,440,499,518,546,572**;JUL 10, 1995;Build 7
"RTN","ZIS1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZIS1",4,0)
MAIN ;Called from %ZIS with a GOTO
"RTN","ZIS1",5,0)
 ;Check for "ASK DEVICE"
"RTN","ZIS1",6,0)
 I '$D(IOP),$D(^%ZIS(1,%E,0)),'$P(^(0),"^",3) S %A=%H,%Z=^(0) D L2^%ZIS2 G EXIT
"RTN","ZIS1",7,0)
L1 ;Main Device Lookup Loop
"RTN","ZIS1",8,0)
 I '$D(IOP),$D(IO("Q")),POP D AQUE^%ZIS3 K:%=2 IO("Q") S:%=2 %ZISB=$S(%ZIS'["N":2,1:0) I %=-1 S POP=1 G EXIT
"RTN","ZIS1",9,0)
 S %E=%H,POP=0,%IS=%ZIS ;Reset %IS from %ZIS
"RTN","ZIS1",10,0)
 I %ZIS'["Q",$D(XQNOGO) S POP=1 W:'$D(IOP) !,$C(7),"OUTPUT IS NEVER ALLOWED FOR THIS OPTION" G EXIT
"RTN","ZIS1",11,0)
 D IOP:$D(IOP),R:'$D(IOP)
"RTN","ZIS1",12,0)
 G EXIT:$D(DTOUT)!$D(DUOUT)!(POP&$D(IOP)),L1:POP&'$D(IOP)
"RTN","ZIS1",13,0)
 D LKUP I %A'>0 S POP=1 D:'$D(DUOUT) MSG1 K DUOUT
"RTN","ZIS1",14,0)
 I %A>0,'$D(^%ZIS(1,%A,0)) D MSG2 K %ZISIOS S POP=1
"RTN","ZIS1",15,0)
 I POP G EXIT:$D(IOP),L1:'$D(IOP)
"RTN","ZIS1",16,0)
 S %E=%A,%Z1=$G(^%ZIS(1,%A,1)),%Z=^(0) ;Set naked for screen
"RTN","ZIS1",17,0)
 I $D(%ZIS("S")) N Y S Y=%E D XS^ZISX S:'$T POP=1 G G:POP ;Screen Code
"RTN","ZIS1",18,0)
 W:'$D(IOP)&($P(%Z,"^",2)'=$I)&($P(%Z1,"^")]"") "  ",$P(%Z1,"^")
"RTN","ZIS1",19,0)
 D L2^%ZIS2 ;Call
"RTN","ZIS1",20,0)
G G L1:POP&'$D(IOP)&'($D(DTOUT)!$D(DUOUT)) ;Didn't get it
"RTN","ZIS1",21,0)
 ;
"RTN","ZIS1",22,0)
EXIT ;
"RTN","ZIS1",23,0)
 I POP G EX2 ;Did not get the device.
"RTN","ZIS1",24,0)
 ;For type[TRM reset $X & $Y
"RTN","ZIS1",25,0)
 I %ZTYPE["TRM",IO]"",$D(IO(1,IO)) U IO S:'(IO=IO(0)&'$D(IO("S"))&'$D(ZTQUEUED)) $X=0,$Y=0
"RTN","ZIS1",26,0)
 ;Do count of number of times device opened.  Field 51.
"RTN","ZIS1",27,0)
 I $L($G(IO)),$D(IO(1,IO))#2,$G(%ZISIOS) D
"RTN","ZIS1",28,0)
 . S $P(^(5),"^",1)=$P($G(^%ZIS(1,%ZISIOS,5)),"^",1)+1
"RTN","ZIS1",29,0)
 I %ZIS["H" S IO(0)=IO,IO("HOME")=%ZISIOS_"^"_IO ;Make home device
"RTN","ZIS1",30,0)
 I '$D(IO("Q")),$D(%ZISLOCK) S ^XUTL("XQ",$J,"lock",%ZISIOS)=%ZISLOCK
"RTN","ZIS1",31,0)
 I $D(IO)#2,IO]"",$D(IO(1,IO))#2,$D(%Z1),$P(%Z1,"^",11) S IO(1,IO,"NOFF")=1
"RTN","ZIS1",32,0)
EX2 ;
"RTN","ZIS1",33,0)
 I %ZIS'[0,$G(IO(0))]"" U IO(0) ;Make sure return with home active
"RTN","ZIS1",34,0)
 G SETVAR:'POP!(%ZIS["T"),KILVAR
"RTN","ZIS1",35,0)
 ;
"RTN","ZIS1",36,0)
IOP ;Request with IOP set
"RTN","ZIS1",37,0)
 S (%ZISVT,%X)=IOP S:%X'?1.UNP %X=$$UP(%X) I %X'="Q" D SETQ Q
"RTN","ZIS1",38,0)
 S %ZIS=%ZIS_%X,%IS=%ZIS K IOP W %X D SETQ
"RTN","ZIS1",39,0)
 Q
"RTN","ZIS1",40,0)
 ;Get ready to ask user for device
"RTN","ZIS1",41,0)
R I %ZIS["Q",$D(XQNOGO) W !,$C(7),"at this time, Output MUST be QUEUED"
"RTN","ZIS1",42,0)
 S %A=$S($D(%ZIS("B")):%ZIS("B"),1:"HOME") ;Setup default
"RTN","ZIS1",43,0)
 I %ZIS["P",%A="HOME",$D(^%ZIS(1,%E,99)),$D(^%ZIS(1,+^(99),0)) S %A=$P(^(0),"^",1)
"RTN","ZIS1",44,0)
RD W !,$S($D(%ZIS("A")):%ZIS("A"),1:"DEVICE: ") W:%A]"" %A,"// " D SBR S:%X="" %X=%A S %ZISVT=%X
"RTN","ZIS1",45,0)
 I %X?2"?".E D EN2^%ZIS7 G R
"RTN","ZIS1",46,0)
 I %X?1"?".E D EN1^%ZIS7 G R
"RTN","ZIS1",47,0)
 I $D(DTOUT)!$D(DUOUT)!(%X'?.ANP)!($L($P(%X,";"))>31) S:%ZIS["T" IO="" S POP=1 Q
"RTN","ZIS1",48,0)
 S:%X'?1.UNP %X=$$UP(%X) D SETQ G R:$T
"RTN","ZIS1",49,0)
 Q
"RTN","ZIS1",50,0)
SETQ ;User wants to queue output
"RTN","ZIS1",51,0)
 S %Y=$P(%X,";",2,9),%X=$P(%X,";",1) S:$L(";"_%Y,";/")=2 IO("P")=$P(";"_%Y,";/",2)
"RTN","ZIS1",52,0)
 I %X="Q",%ZIS'["Q" W:'$D(IOP) "  Application doesn't support Queuing",!
"RTN","ZIS1",53,0)
 I %ZIS["Q",%X="Q" S %X=%Y,%ZISVT=$P(%ZISVT,";",2,9),%ZISB=0,IO("Q")=1,%ZIS("A")="DEVICE: " S:$D(IOP) %Y=$P(%X,";",2,9),%X=$P(%X,";",1)
"RTN","ZIS1",54,0)
 I $T,'$D(IOP) W "UEUE TO PRINT ON" Q  ; Return $T value
"RTN","ZIS1",55,0)
 Q
"RTN","ZIS1",56,0)
 ;%X is uppercase of %ZISVT
"RTN","ZIS1",57,0)
LKUP ;Lookup device name
"RTN","ZIS1",58,0)
 S %ZISMY=$P(%ZISVT,";",2,999),%ZISVT=$P(%ZISVT,";")
"RTN","ZIS1",59,0)
 I %X="H" W:'$D(IOP) "ome" S %X=0
"RTN","ZIS1",60,0)
 I 0[%X!(%X="HOME")!(%X=$I) S %A=%H Q
"RTN","ZIS1",61,0)
 I $E(%ZISVT)="`",$D(IOP) S %A=+$E(%ZISVT,2,999) I $D(^%ZIS(1,%A,0))#2 Q
"RTN","ZIS1",62,0)
 S %A=0 I "P"[%X Q:$D(IOP)&('$D(^%ZIS(1,%E,99)))  I $D(^%ZIS(1,%E,99)) S %A=+^(99) Q  ;Closest Printer
"RTN","ZIS1",63,0)
 ;
"RTN","ZIS1",64,0)
 ;**P572 START CJM
"RTN","ZIS1",65,0)
 ;I %X=" ",$D(DUZ)#2,$D(^DISV(+DUZ,"^%ZIS(1,")) S %A=^("^%ZIS(1,") Q
"RTN","ZIS1",66,0)
 I %X=" ",$D(DUZ)#2,$D(^DISV(+DUZ,"ZIS","^%ZIS(1,")) S %A=^("^%ZIS(1,") Q
"RTN","ZIS1",67,0)
 I %X=" ",$D(DUZ)#2,$D(^DISV(+DUZ,"^%ZIS(1,")) S %A=^("^%ZIS(1,") Q
"RTN","ZIS1",68,0)
 ;**P572 END CJM
"RTN","ZIS1",69,0)
 ;
"RTN","ZIS1",70,0)
 S %A=+$O(^%ZIS(1,"B",%ZISVT,0)) Q:%A>0  ;mixed case lookup
"RTN","ZIS1",71,0)
 I %X'=%ZISVT S %A=+$O(^%ZIS(1,"B",%X,0)) Q:%A>0  ;uppercase lookup
"RTN","ZIS1",72,0)
 D VTLKUP^%ZIS S %A=%E Q:%A>0  ;mixed case lookup
"RTN","ZIS1",73,0)
 I %X'=%ZISVT S %ZISVT=%X D VTLKUP^%ZIS S %A=%E Q:%A>0  ;uppercase lookup
"RTN","ZIS1",74,0)
 N %XX,%YY S %XX=%X D 1^%ZIS5 S %A=+%YY
"RTN","ZIS1",75,0)
 Q
"RTN","ZIS1",76,0)
SBR ;Read Sub-routine, Output %X
"RTN","ZIS1",77,0)
 K DTOUT,DUOUT R %X:%ZISDTIM E  W $C(7) S DTOUT=1 Q
"RTN","ZIS1",78,0)
 S:%X="."!(%X="^") DUOUT=1,%X=""
"RTN","ZIS1",79,0)
 Q
"RTN","ZIS1",80,0)
 ;
"RTN","ZIS1",81,0)
LOW(%) Q $TR(%,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","ZIS1",82,0)
UP(%) Q $TR(%,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ZIS1",83,0)
 ;
"RTN","ZIS1",84,0)
 ;Call/Return % = 1 (yes), 2 (no) -1 (^)
"RTN","ZIS1",85,0)
YN W "? ",$P("Yes// ^No// ",U,%)
"RTN","ZIS1",86,0)
RYN R %X:%ZISDTIM E  S DTOUT=1,%X=U W $C(7)
"RTN","ZIS1",87,0)
 S:$L(%X)!'% %X=$E(%X),%=$S("Yy"[%X:1,"Nn"[%X:2,"^"[%X:-1,1:0)
"RTN","ZIS1",88,0)
 I '%,%X'?."?" W $C(7),"??",!?4,"ANSWER 'Yes' OR 'No': " G RYN
"RTN","ZIS1",89,0)
 W:$X>73 ! W $P("  (Yes)^  (No)",U,%)
"RTN","ZIS1",90,0)
 Q
"RTN","ZIS1",91,0)
MSG1 I '$D(IOP) W ?20,$C(7),"  [DEVICE DOES NOT EXIST]"
"RTN","ZIS1",92,0)
 Q
"RTN","ZIS1",93,0)
MSG2 I '$D(IOP) W ?20,$C(7),"  [DEVICE FILE ERROR]"
"RTN","ZIS1",94,0)
 Q
"RTN","ZIS1",95,0)
 ;
"RTN","ZIS1",96,0)
SETVAR ;Come here to setup the variables for the selected device
"RTN","ZIS1",97,0)
 S:$D(IO)[0 IO="" G KILVAR:%ZIS["T"&(IO="")
"RTN","ZIS1",98,0)
 I $G(%Z)="" S ION="Unknown device",POP=1 G KILVAR
"RTN","ZIS1",99,0)
 ;**P572 START CJM
"RTN","ZIS1",100,0)
 ;S:IO'=IO(0)&($D(DUZ)#2) ^DISV(+DUZ,"^%ZIS(1,")=%E
"RTN","ZIS1",101,0)
 I IO'=IO(0)&($D(DUZ)#2),'$D(IOP) S ^DISV(+DUZ,"ZIS","^%ZIS(1,")=%E
"RTN","ZIS1",102,0)
 ;**P572 END CJM
"RTN","ZIS1",103,0)
 S ION=$P(%Z,"^",1),IOM=+%Z91,IOF=$P(%Z91,"^",2),IOSL=$P(%Z91,"^",3),IOBS=$P(%Z91,"^",4),IOXY=$P(%Z91,"^",5)
"RTN","ZIS1",104,0)
 I IOSL>65534 S IOSL=65534 ;Cache rolls $Y at 65535
"RTN","ZIS1",105,0)
 S IOT=%ZTYPE,IOST(0)=%ZISIOST(0),IOST=%ZISIOST,IOPAR=%ZISOPAR,IOUPAR=%ZISUPAR,IOHG="" ;p546 %ZISHG
"RTN","ZIS1",106,0)
 S:IOF="" IOF="#" ;See that IOF has something
"RTN","ZIS1",107,0)
 I $D(IO("Q")),'$D(%ZIS("afn")) K IO("HFSIO") ;Let TM build it at run time.
"RTN","ZIS1",108,0)
 K IOCPU S:$D(%ZISCPU) IOCPU=%ZISCPU
"RTN","ZIS1",109,0)
 G KIL
"RTN","ZIS1",110,0)
 ;
"RTN","ZIS1",111,0)
KILVAR ;Come here to restore the calling variables
"RTN","ZIS1",112,0)
 D SYMBOL^%ZISUTL(1,"%ZISOLD")
"RTN","ZIS1",113,0)
 S:'$L($G(IOF)) IOF="#" S:'$D(IOST(0)) IOST(0)=0
"RTN","ZIS1",114,0)
 ;See that all standard variables are defined
"RTN","ZIS1",115,0)
 F %I="IO","ION","IOM","IOBS","IOSL","IOST" S:$D(@%I)[0 @%I=""
"RTN","ZIS1",116,0)
 K IO("HFSIO"),IO("OPEN") I $D(%ZISCPU) S:'$D(IOCPU) IOCPU=%ZISCPU
"RTN","ZIS1",117,0)
KIL ;Final exit cleanup
"RTN","ZIS1",118,0)
 S:'POP IOS=%ZISIOS I POP K:%ZIS'["T" %ZISIOS I %ZIS["T" K IOS S:$D(%ZISIOS) IOS=%ZISIOS
"RTN","ZIS1",119,0)
 S:%ZIS["T" IO("T")=1
"RTN","ZIS1",120,0)
 K %ZIS,%IS,%ZISOS,%ZISV,IOP
"RTN","ZIS1",121,0)
K2 ;Called from %ZIS
"RTN","ZIS1",122,0)
 K %ZISCHK,%ZISCPU,%ZISI,%ZISR,%ZISVT,%ZISB,%ZISX,ZISI,%ZISHP,%ZISIO,%ZISIOS,%ZISIOM
"RTN","ZIS1",123,0)
 K %ZISIOF,%ZISIOSL,%ZISIOBS,%ZISIOST,%ZISIOST(0),%ZISTO,%ZISTP,%ZISSIO,%ZISOPEN,%ZISOPAR,%ZISUPAR
"RTN","ZIS1",124,0)
 K %ZISMY,%ZISQUIT,%ZISLOCK
"RTN","ZIS1",125,0)
 Q
"RTN","ZIS5")
0^2^B16057553^B14306275
"RTN","ZIS5",1,0)
%ZIS5 ;SFISC/STAFF --DEVICE LOOK-UP ;08/30/2011
"RTN","ZIS5",2,0)
 ;;8.0;KERNEL;**18,24,69,499,518,546,572**;JUL 10, 1995;Build 7
"RTN","ZIS5",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZIS5",4,0)
 ;Does a DIC like lookup. %XX,%YY are call in/out parameters
"RTN","ZIS5",5,0)
 N %DO,%DIY,%DD,%DIX
"RTN","ZIS5",6,0)
 S U="^",%DO="" K DUOUT
"RTN","ZIS5",7,0)
 I $D(^%ZIS(%ZISDFN,0)) S %DO=^(0)
"RTN","ZIS5",8,0)
A G:%ZIS(0)'["A" X
"RTN","ZIS5",9,0)
 ;Ask Device
"RTN","ZIS5",10,0)
 I $D(%ZIS("A")) S %DD=%ZIS("A") G B
"RTN","ZIS5",11,0)
 S %DD="Select "_$P(%DO,U,1)_": "
"RTN","ZIS5",12,0)
B I $D(%ZIS("B")),%ZIS("B")]"" S %YY=%ZIS("B"),%XX=$O(^%ZIS(%ZISDFN,%D,%YY)),%DIY=$S($F(%XX,%YY)-1=$L(%YY):%XX,$D(^%ZIS(%ZISDFN,%YY,0)):$P(^(0),U,1),1:%YY) W %DD,%DIY,"// " R %XX:%ZISDTIM G G:%XX]"" S %XX=%DIY G G
"RTN","ZIS5",13,0)
 W !,%DD R %XX:%ZISDTIM
"RTN","ZIS5",14,0)
G G NO:'$T,NO:%XX["^" G:%XX?.N&(+%XX=%XX) NUM I %XX'?.ANP!($L(%XX)>30) W:%ZIS(0)["Q" *7," ??" G A
"RTN","ZIS5",15,0)
 ;Lookup
"RTN","ZIS5",16,0)
X ;**P572 START CJM
"RTN","ZIS5",17,0)
 ;I %XX=" ",$D(DUZ)#2,$D(^DISV(+DUZ,"^%ZIS("_%ZISDFN_",")) S %YY=+^("^%ZIS("_%ZISDFN_",") D S G:'$T NO G GOT
"RTN","ZIS5",18,0)
 I %XX=" ",$D(DUZ)#2,$D(^DISV(+DUZ,"ZIS","^%ZIS("_%ZISDFN_","))!$D(^DISV(+DUZ,"^%ZIS("_%ZISDFN_",")) D  D S G:'$T NO G GOT
"RTN","ZIS5",19,0)
 .S %YY=$S($D(^DISV(+DUZ,"ZIS","^%ZIS("_%ZISDFN_",")):+^("^%ZIS("_%ZISDFN_","),1:^DISV(+DUZ,"^%ZIS("_%ZISDFN_","))
"RTN","ZIS5",20,0)
 ;**P572 END CJM
"RTN","ZIS5",21,0)
F G NO:%XX="" K %DS S %DS=0,%DS(0)=1,%DIX=%XX,%DIY=0
"RTN","ZIS5",22,0)
 I $D(^%ZIS(%ZISDFN,%D,%XX)) G T1
"RTN","ZIS5",23,0)
TRY S %DIX=$O(^%ZIS(%ZISDFN,%D,%DIX)) G:$P(%DIX,%XX,1)'=""!(%DIX="") T2 S %DIY=0
"RTN","ZIS5",24,0)
T1 S %DIY=$O(^%ZIS(%ZISDFN,%D,%DIX,+%DIY)) G:%DIY'>0 TRY S %YY=+%DIY D S G:'$T T1
"RTN","ZIS5",25,0)
 I %DS,'(%DS#10) D LST G NO:%XX=U,ADD:%YY<0,GOT:%YY>0
"RTN","ZIS5",26,0)
 S %DS=%DS+1,%DS(%DS)=%DIY G T1
"RTN","ZIS5",27,0)
LSYN ;
"RTN","ZIS5",28,0)
S I $D(^%ZIS(%ZISDFN,%YY,0)) G S1
"RTN","ZIS5",29,0)
 Q
"RTN","ZIS5",30,0)
S1 G S2:%ZISDFN'=1!(%D'="LSYN") I $P(^%ZIS(1,%YY,0),U,9)=%ZISV!($P(^(0),U,9)="") G S2
"RTN","ZIS5",31,0)
 Q
"RTN","ZIS5",32,0)
S2 N Y S Y=%YY D:$D(%ZIS("S")) XS^ZISX Q
"RTN","ZIS5",33,0)
T2 G:'%DS NO S %DIY="" D LST G NO:%XX=U,ADD:%YY<1,GOT
"RTN","ZIS5",34,0)
LST I %DS=1,'$D(%ZISLST) S %YY=%DS(1) Q
"RTN","ZIS5",35,0)
 S %YY=-1 Q:%ZIS(0)'["E"  W !
"RTN","ZIS5",36,0)
 F %DZ=%DS(0):1:%DS W !,$J(%DZ,2)," ",$P(^%ZIS(%ZISDFN,%DS(%DZ),0),U,1) D:%ZISDFN=1  I $D(%ZIS("W")),$D(^(0)) W "  " D XW^ZISX
"RTN","ZIS5",37,0)
 . ;Show Location
"RTN","ZIS5",38,0)
 . S %=$G(^(1)) W:$X+$L($P(%,U))>74 !?75-$L(X) W "   "_$P(%,U)
"RTN","ZIS5",39,0)
L1 W:%DIY !,"Type '^' to Stop, or" W !,"Choose 1" W:%DS>1 "-",%DS
"RTN","ZIS5",40,0)
 R "> ",%YY:%ZISDTIM S %ZISLST=1 I %YY="",%DIY S %DS(0)=%DS+1,%YY=0 W ! Q
"RTN","ZIS5",41,0)
 I %YY=U!(%YY="") S %YY=-1,DUOUT=1 S:%YY=U %XX=U Q
"RTN","ZIS5",42,0)
 I +%YY'=%YY!(%YY<1)!(%YY>%DS) W:%ZIS(0)["Q" *7," ??" G L1
"RTN","ZIS5",43,0)
 S %YY=%DS(%YY) Q
"RTN","ZIS5",44,0)
GOT S %DZ=^%ZIS(%ZISDFN,+%YY,0)
"RTN","ZIS5",45,0)
 W:%ZIS(0)["E" "  ",$P(%DZ,U,1)
"RTN","ZIS5",46,0)
 ;**P572 START CJM
"RTN","ZIS5",47,0)
R ;
"RTN","ZIS5",48,0)
 ;I %ZIS(0)'["F" S:$S($D(DUZ)#2:$S(DUZ:1,1:0),1:0) ^DISV(DUZ,"^%ZIS("_%ZISDFN_",")=+%YY
"RTN","ZIS5",49,0)
 I %ZIS(0)'["F" I '$D(IOP),$S($D(DUZ)#2:$S(DUZ:1,1:0),1:0) S ^DISV(DUZ,"ZIS","^%ZIS("_%ZISDFN_",")=+%YY
"RTN","ZIS5",50,0)
 ;**P572 END CJM
"RTN","ZIS5",51,0)
 ;
"RTN","ZIS5",52,0)
 I %ZIS(0)["Z" S %YY(0)=^%ZIS(%ZISDFN,+%YY,0)
"RTN","ZIS5",53,0)
Q K %ZISDFN,%DO,%DD,%DIX,%DIY,%DZ Q
"RTN","ZIS5",54,0)
ADD ;can't add to files
"RTN","ZIS5",55,0)
NO S %YY=-1 G Q
"RTN","ZIS5",56,0)
NUM I $D(^%ZIS(%ZISDFN,%XX)) S %YY=%XX D S I $T G GOT
"RTN","ZIS5",57,0)
 G F
"RTN","ZIS5",58,0)
 ;
"RTN","ZIS5",59,0)
1 ;Entry point for Device lookup
"RTN","ZIS5",60,0)
 N %D,%DS,%ZISDFN,%ZISLST ;p518
"RTN","ZIS5",61,0)
 F %D="B","LSYN" S %ZISDFN=1,%ZIS(0)=$S($D(IOP):"M",1:"EMQ") D %ZIS5 Q:(%YY>0)!$D(DUOUT)
"RTN","ZIS5",62,0)
 Q
"RTN","ZIS5",63,0)
2 ;Entry point for Terminal type lookup
"RTN","ZIS5",64,0)
 N %D,%DS,%ZISDFN,%ZISLST ;p518
"RTN","ZIS5",65,0)
 S %D="B",%ZISDFN=2,%ZIS(0)=$S($D(IOP):"M",1:"EMQ") D %ZIS5
"RTN","ZIS5",66,0)
 Q
"RTN","ZIS5",67,0)
 ;
"RTN","ZIS5",68,0)
 ;A=all printers, P=local printers, C=complete list, D=local devices
"RTN","ZIS5",69,0)
LD1 ;Called from %ZIS7
"RTN","ZIS5",70,0)
 S %E=0,%Y=0 D LCPU:"PD"[$E(%X) S %E=0 W !
"RTN","ZIS5",71,0)
L S %E=$S("PD"[$E(%X):$O(^UTILITY("ZIS",$J,"DEVLST","B",%E)),1:$O(^%ZIS(1,"B",%E))) G:%E="" RESTART S %A=+$O(^(%E,0))
"RTN","ZIS5",72,0)
 G L:'$D(^%ZIS(1,%A,0)) ;,L:$P(^(0),"^",2)=46,L:$P(^(0),"^",2)=63 p546 Skip check for device numbers
"RTN","ZIS5",73,0)
 I $D(%ZIS("S")) N Y S Y=%A D XS^ZISX G L:'$T ;Screen
"RTN","ZIS5",74,0)
 I "AP"[$E(%X) G L:$P($G(^%ZIS(2,+$G(^%ZIS(1,%A,"SUBTYPE")),0)),U)'?1"P".E
"RTN","ZIS5",75,0)
 W $P(^%ZIS(1,%A,0),"^",1) W:$D(^(1)) " ",$P(^(1),"^",1) I $D(^(90)),^(90) W " ** OUT OF SERVICE"
"RTN","ZIS5",76,0)
 W ?39 I $X>40 W ! S %Y=%Y+1 I %Y>20 R "'^' TO STOP: ",%Y:%ZISDTIM,! G RESTART:%Y?1P S %Y=0
"RTN","ZIS5",77,0)
 G L
"RTN","ZIS5",78,0)
 ;
"RTN","ZIS5",79,0)
LCPU S %A=%ZISV
"RTN","ZIS5",80,0)
LC1 S %A=$O(^%ZIS(1,"CPU",%A)) Q:$P(%A,".")'=%ZISV  S %E=0
"RTN","ZIS5",81,0)
LC2 S %E=+$O(^%ZIS(1,"CPU",%A,%E)) G LC1:%E'>0,LC1:'$D(^%ZIS(1,%E,0)) S ^UTILITY("ZIS",$J,"DEVLST","B",$P(^(0),"^",1),%E)="" G LC2
"RTN","ZIS5",82,0)
 ;
"RTN","ZIS5",83,0)
RESTART S:$D(%H) %E=+%H K %X,^UTILITY("ZIS",$J,"DEVLST")
"RTN","ZIS5",84,0)
 Q
"VER")
8.0^22.0
"BLD",1367,6)
^462
**END**
**END**
