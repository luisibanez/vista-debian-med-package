Released GMRC*3*76 SEQ #68
Extracted from mail message
**KIDS**:GMRC*3.0*76^

**INSTALL NAME**
GMRC*3.0*76
"BLD",9198,0)
GMRC*3.0*76^CONSULT/REQUEST TRACKING^0^3130109^y
"BLD",9198,1,0)
^^5^5^3130109^^^^
"BLD",9198,1,1,0)
This patch corrects the wording in the description for the 
"BLD",9198,1,2,0)
GMRC RPT PER MON report.  Also, the addition of clarification
"BLD",9198,1,3,0)
wording for the Group Update function of Consult Alterts.
"BLD",9198,1,4,0)
The clarification wording addresses PSPO #2198.  Consults
"BLD",9198,1,5,0)
Update Manual is also being updated.
"BLD",9198,4,0)
^9.64PA^^
"BLD",9198,6)
2^
"BLD",9198,6.3)
7
"BLD",9198,"ABPKG")
n
"BLD",9198,"KRN",0)
^9.67PA^779.2^20
"BLD",9198,"KRN",.4,0)
.4
"BLD",9198,"KRN",.4,"NM",0)
^9.68A^^
"BLD",9198,"KRN",.401,0)
.401
"BLD",9198,"KRN",.402,0)
.402
"BLD",9198,"KRN",.403,0)
.403
"BLD",9198,"KRN",.5,0)
.5
"BLD",9198,"KRN",.84,0)
.84
"BLD",9198,"KRN",3.6,0)
3.6
"BLD",9198,"KRN",3.8,0)
3.8
"BLD",9198,"KRN",9.2,0)
9.2
"BLD",9198,"KRN",9.8,0)
9.8
"BLD",9198,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9198,"KRN",9.8,"NM",1,0)
GMRCSTS^^0^B43894361
"BLD",9198,"KRN",9.8,"NM",2,0)
GMRCSTL7^^0^B109494560
"BLD",9198,"KRN",9.8,"NM","B","GMRCSTL7",2)

"BLD",9198,"KRN",9.8,"NM","B","GMRCSTS",1)

"BLD",9198,"KRN",19,0)
19
"BLD",9198,"KRN",19,"NM",0)
^9.68A^^
"BLD",9198,"KRN",19.1,0)
19.1
"BLD",9198,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9198,"KRN",101,0)
101
"BLD",9198,"KRN",101,"NM",0)
^9.68A^^
"BLD",9198,"KRN",409.61,0)
409.61
"BLD",9198,"KRN",771,0)
771
"BLD",9198,"KRN",779.2,0)
779.2
"BLD",9198,"KRN",870,0)
870
"BLD",9198,"KRN",8989.51,0)
8989.51
"BLD",9198,"KRN",8989.52,0)
8989.52
"BLD",9198,"KRN",8994,0)
8994
"BLD",9198,"KRN","B",.4,.4)

"BLD",9198,"KRN","B",.401,.401)

"BLD",9198,"KRN","B",.402,.402)

"BLD",9198,"KRN","B",.403,.403)

"BLD",9198,"KRN","B",.5,.5)

"BLD",9198,"KRN","B",.84,.84)

"BLD",9198,"KRN","B",3.6,3.6)

"BLD",9198,"KRN","B",3.8,3.8)

"BLD",9198,"KRN","B",9.2,9.2)

"BLD",9198,"KRN","B",9.8,9.8)

"BLD",9198,"KRN","B",19,19)

"BLD",9198,"KRN","B",19.1,19.1)

"BLD",9198,"KRN","B",101,101)

"BLD",9198,"KRN","B",409.61,409.61)

"BLD",9198,"KRN","B",771,771)

"BLD",9198,"KRN","B",779.2,779.2)

"BLD",9198,"KRN","B",870,870)

"BLD",9198,"KRN","B",8989.51,8989.51)

"BLD",9198,"KRN","B",8989.52,8989.52)

"BLD",9198,"KRN","B",8994,8994)

"BLD",9198,"QUES",0)
^9.62^^
"BLD",9198,"REQB",0)
^9.611^^0
"MBREQ")
0
"PKG",300,-1)
1^1
"PKG",300,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",300,20,0)
^9.402P^^
"PKG",300,22,0)
^9.49I^1^1
"PKG",300,22,1,0)
3.0^2980101^2980417^1271
"PKG",300,22,1,"PAH",1,0)
76^3130109^33274
"PKG",300,22,1,"PAH",1,1,0)
^^5^5^3130109
"PKG",300,22,1,"PAH",1,1,1,0)
This patch corrects the wording in the description for the 
"PKG",300,22,1,"PAH",1,1,2,0)
GMRC RPT PER MON report.  Also, the addition of clarification
"PKG",300,22,1,"PAH",1,1,3,0)
wording for the Group Update function of Consult Alterts.
"PKG",300,22,1,"PAH",1,1,4,0)
The clarification wording addresses PSPO #2198.  Consults
"PKG",300,22,1,"PAH",1,1,5,0)
Update Manual is also being updated.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRCSTL7")
0^2^B109494560^B102658312
"RTN","GMRCSTL7",1,0)
GMRCSTL7 ;SLC/JFR/WAT - DRIVER FOR CSLT PER MONITOR ;4/8/05 10:28
"RTN","GMRCSTL7",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**41,60,76**;DEC 27, 1997;Build 7
"RTN","GMRCSTL7",3,0)
 ;
"RTN","GMRCSTL7",4,0)
 ;This routine invokes ICRs 
"RTN","GMRCSTL7",5,0)
 ;1519(XUTMDEVQ,10103(XLFDT),10104(XLFSTR),3744(VADPT),10089(%ZISC),10026(DIR)
"RTN","GMRCSTL7",6,0)
 Q
"RTN","GMRCSTL7",7,0)
 ;
"RTN","GMRCSTL7",8,0)
EN ; start here
"RTN","GMRCSTL7",9,0)
 K GMRCQUT
"RTN","GMRCSTL7",10,0)
 N DIROUT,DTOUT,DUOUT,DIR,Y,X,GMRCTMP,GMRCDG,GMRCSVC,GMRCSVNM,GMRCDT1
"RTN","GMRCSTL7",11,0)
 N GMRCDT2,GMRCFMT,GMRCGRP,VALMBCK,GMRCSAVE
"RTN","GMRCSTL7",12,0)
 N GMRC30ST,GMRC30SP
"RTN","GMRCSTL7",13,0)
 D CAVEATS
"RTN","GMRCSTL7",14,0)
 ;Ask for service
"RTN","GMRCSTL7",15,0)
 S DIR(0)="P^123.5:EMQ",DIR("??")="^D LISTALL^GMRCASV"
"RTN","GMRCSTL7",16,0)
 S DIR("A")="Select Service/Specialty"
"RTN","GMRCSTL7",17,0)
 D ^DIR
"RTN","GMRCSTL7",18,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT))!(X="") D EXIT Q
"RTN","GMRCSTL7",19,0)
 S GMRCDG=+Y,GMRCSVNM=$P(Y,U,2)
"RTN","GMRCSTL7",20,0)
  ;Ask for current FY
"RTN","GMRCSTL7",21,0)
 N DIROUT,DTOUT,DUOUT,DIR,Y,X,GMRCFY
"RTN","GMRCSTL7",22,0)
 S DIR(0)="F^4:4^K:(X-1700)>($E(DT,1,3)+1) X"
"RTN","GMRCSTL7",23,0)
 S DIR("A")="Current Fiscal Year (i.e. 2008)"
"RTN","GMRCSTL7",24,0)
 S DIR("A",1)="Ensure you are providing fiscal year, NOT calendar year."
"RTN","GMRCSTL7",25,0)
 D ^DIR
"RTN","GMRCSTL7",26,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT))!(X="") D EXIT Q
"RTN","GMRCSTL7",27,0)
 S GMRCFY=X
"RTN","GMRCSTL7",28,0)
 N DIROUT,DTOUT,DUOUT,DIR,Y,X,GMRCQTR,GMRCYR
"RTN","GMRCSTL7",29,0)
 S DIR(0)="N^1:4"
"RTN","GMRCSTL7",30,0)
 S DIR("A")="Enter a number 1 - 4"
"RTN","GMRCSTL7",31,0)
 S DIR("A",1)="For which quarter are you running the report: first, second, third or fourth?"
"RTN","GMRCSTL7",32,0)
 D ^DIR
"RTN","GMRCSTL7",33,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT))!(X="") D EXIT Q
"RTN","GMRCSTL7",34,0)
 S GMRCQTR=X
"RTN","GMRCSTL7",35,0)
 ;if first quarter
"RTN","GMRCSTL7",36,0)
 I $G(GMRCQTR)=1 D
"RTN","GMRCSTL7",37,0)
 .;use FY-1 to set year part of date range to the previous calendar year
"RTN","GMRCSTL7",38,0)
 .S GMRCYR=$G(GMRCFY)-1700 S GMRCYR=$G(GMRCYR)-1,GMRCDT1=$E($G(GMRCYR),1,3)_"1001" S GMRCDT2=$G(GMRCYR)_"1231"
"RTN","GMRCSTL7",39,0)
 I $G(GMRCQTR)=2 D
"RTN","GMRCSTL7",40,0)
 .S GMRCYR=$G(GMRCFY)-1700 S GMRCDT1=$E($G(GMRCYR),1,3)_"0101" S GMRCDT2=$G(GMRCYR)_"0331"
"RTN","GMRCSTL7",41,0)
 I $G(GMRCQTR)=3 D
"RTN","GMRCSTL7",42,0)
 .S GMRCYR=$G(GMRCFY)-1700 S GMRCDT1=$E($G(GMRCYR),1,3)_"0401" S GMRCDT2=$G(GMRCYR)_"0630"
"RTN","GMRCSTL7",43,0)
 I $G(GMRCQTR)=4 D
"RTN","GMRCSTL7",44,0)
 .S GMRCYR=$G(GMRCFY)-1700 S GMRCDT1=$E($G(GMRCYR),1,3)_"0701" S GMRCDT2=$G(GMRCYR)_"0930"
"RTN","GMRCSTL7",45,0)
 S GMRC30ST=$$FMADD^XLFDT(GMRCDT1,-30),GMRC30SP=$$FMADD^XLFDT(GMRCDT2,-30)
"RTN","GMRCSTL7",46,0)
 ; what type of report
"RTN","GMRCSTL7",47,0)
 N DIROUT,DTOUT,DUOUT,DIR,Y,X
"RTN","GMRCSTL7",48,0)
 S DIR(0)="S:O^S:Summary;D:Delimited",DIR("A")="What type of report"
"RTN","GMRCSTL7",49,0)
 D ^DIR
"RTN","GMRCSTL7",50,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT))!(X="") D EXIT Q
"RTN","GMRCSTL7",51,0)
 S GMRCFMT=$S(Y="S":"CP",1:"DEL")
"RTN","GMRCSTL7",52,0)
 ;
"RTN","GMRCSTL7",53,0)
 W @IOF
"RTN","GMRCSTL7",54,0)
 S GMRCSAVE("GMRCFMT")=""
"RTN","GMRCSTL7",55,0)
 S GMRCSAVE("GMRCDG")=""
"RTN","GMRCSTL7",56,0)
 S GMRCSAVE("GMRCDT1")=""
"RTN","GMRCSTL7",57,0)
 S GMRCSAVE("GMRCDT2")=""
"RTN","GMRCSTL7",58,0)
 S GMRCSAVE("GMRC30ST")=""
"RTN","GMRCSTL7",59,0)
 S GMRCSAVE("GMRC30SP")=""
"RTN","GMRCSTL7",60,0)
 S GMRCSAVE("GMRCSVNM")=""
"RTN","GMRCSTL7",61,0)
 S GMRCSAVE("GMRCFY")=""
"RTN","GMRCSTL7",62,0)
 S GMRCSAVE("GMRCQTR")=""
"RTN","GMRCSTL7",63,0)
 ;
"RTN","GMRCSTL7",64,0)
 N DIROUT,DTOUT,DUOUT,DIR,Y,X S DIR(0)="FO",DIR("A")="ENTER ""?"" FOR MORE HELP OR RETURN TO CONTINUE"
"RTN","GMRCSTL7",65,0)
 S DIR("A",1)="MARGIN WIDTH IS BEST AT 256"
"RTN","GMRCSTL7",66,0)
 S DIR("?")="^D MARGHLP^GMRCSTL7"
"RTN","GMRCSTL7",67,0)
 D:GMRCFMT="DEL" ^DIR
"RTN","GMRCSTL7",68,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT)) D EXIT Q
"RTN","GMRCSTL7",69,0)
 D EN^XUTMDEVQ("PRNTQ^GMRCSTL7","CONSULT PERFORMANCE MONITOR",.GMRCSAVE)
"RTN","GMRCSTL7",70,0)
 ;
"RTN","GMRCSTL7",71,0)
 D EXIT
"RTN","GMRCSTL7",72,0)
 ;
"RTN","GMRCSTL7",73,0)
 Q
"RTN","GMRCSTL7",74,0)
MARGHLP ;help text to set margins
"RTN","GMRCSTL7",75,0)
 W !,"Specify a device with optional parameters in the format"
"RTN","GMRCSTL7",76,0)
 W !,?8,"Device Name;Right Margin;Page Length"
"RTN","GMRCSTL7",77,0)
 W !,?21,"or"
"RTN","GMRCSTL7",78,0)
 W !,?5,"Device Name;Subtype;Right Margin;Page Length"
"RTN","GMRCSTL7",79,0)
 W !!,"Or in the new format"
"RTN","GMRCSTL7",80,0)
 W !,?14,"Device Name;/settings"
"RTN","GMRCSTL7",81,0)
 W !,?21,"or"
"RTN","GMRCSTL7",82,0)
 W !,?10,"Device Name;Subtype;/settings"
"RTN","GMRCSTL7",83,0)
 W !,"For example"
"RTN","GMRCSTL7",84,0)
 W !,?17,"HOME;80;999"
"RTN","GMRCSTL7",85,0)
 W !,?21,"or"
"RTN","GMRCSTL7",86,0)
 W !,?13,"HOME;C-VT320;/M80L999"
"RTN","GMRCSTL7",87,0)
 Q
"RTN","GMRCSTL7",88,0)
 ;
"RTN","GMRCSTL7",89,0)
ENOR(RETURN,GMRCSVC,GMRC30ST,GMRC30SP,GMRCSTAT,GMRCST2,GMRCARRN) ;Entry point 
"RTN","GMRCSTL7",90,0)
 ;.RETURN:   This is the root to the returned temp array.
"RTN","GMRCSTL7",91,0)
 ;GMRCSVC:  Service for which consults are to be displayed.
"RTN","GMRCSTL7",92,0)
 ;GMRC30ST:  30 days prior to quarter start date
"RTN","GMRCSTL7",93,0)
 ;GMRC30SP:  30 days prior to quarter end date
"RTN","GMRCSTL7",94,0)
 ;GMRCSTAT: The list of status to include separated by commas
"RTN","GMRCSTL7",95,0)
 ;GMRCARRN: Format of report becomes ^TMP array element
"RTN","GMRCSTL7",96,0)
 ;          "CP": Summary Report; "DEL": Delimited Report
"RTN","GMRCSTL7",97,0)
 ;
"RTN","GMRCSTL7",98,0)
 ;This temp array is used internally by the report:
"RTN","GMRCSTL7",99,0)
 ;^TMP("GMRCSLIST",$J,n)=ien^name^parient ien^"+" if grouper^status
"RTN","GMRCSTL7",100,0)
 ;  status is "" tracking and/or grouper
"RTN","GMRCSTL7",101,0)
 ;            1  grouper only
"RTN","GMRCSTL7",102,0)
 ;            2  tracking only
"RTN","GMRCSTL7",103,0)
 ;            9  disabled
"RTN","GMRCSTL7",104,0)
 ;
"RTN","GMRCSTL7",105,0)
 N GMRCEDT1,GMRCEDT2,GMRCDG,GMRCHEAD,GMRCGRP,VALMCNT,VALMBCK
"RTN","GMRCSTL7",106,0)
 K ^TMP("GMRCR",$J,GMRCARRN)
"RTN","GMRCSTL7",107,0)
 S RETURN="^TMP(""GMRCR"",$J,GMRCARRN)"
"RTN","GMRCSTL7",108,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTL7",109,0)
 Q:'$D(^GMR(123.5,$G(GMRCSVC),0))
"RTN","GMRCSTL7",110,0)
 ;Build service array
"RTN","GMRCSTL7",111,0)
 S GMRCDG=GMRCSVC
"RTN","GMRCSTL7",112,0)
 D SERV1^GMRCASV
"RTN","GMRCSTL7",113,0)
 ;Get external form of date range
"RTN","GMRCSTL7",114,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,$G(GMRCDT2),.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTL7",115,0)
 ;
"RTN","GMRCSTL7",116,0)
 N GMRCDA,INDEX,STATUS,STATUS2,LOOP,GROUPER
"RTN","GMRCSTL7",117,0)
 N GMRCSVCG,GMRCPT,GMRCSVCP,GRP,PIECE,TYPE
"RTN","GMRCSTL7",118,0)
 ;
"RTN","GMRCSTL7",119,0)
 K ^TMP("GMRCR",$J,GMRCARRN),^TMP("GMRCRINDEX",$J),^TMP("GMRCT",$J)
"RTN","GMRCSTL7",120,0)
 ;
"RTN","GMRCSTL7",121,0)
 S GROUPER=0
"RTN","GMRCSTL7",122,0)
 S GROUPER(0)=0
"RTN","GMRCSTL7",123,0)
 I GMRCARRN="DEL" D
"RTN","GMRCSTL7",124,0)
 . N STR
"RTN","GMRCSTL7",125,0)
 . S STR="Svc;30DayRng;60DayRng;CmpIn30;Cmp31-60;B4Qtr;PndB4Qtr;%Cmp30;%Cmp60;%UnRsB4Qtr;IS30Rng;IS60Rng;ISCmp30;ISCmp31-60;ISB4Qtr;ISPndB4Qtr;%ISCmp30;%ISCmp60;%ISUnRsB4Qtr;"
"RTN","GMRCSTL7",126,0)
 . S STR=STR_"IR30Rng;IR60Rng;IRCmp30;IRCmp31-60;IRB4Qtr;IRPndB4Qtr;%IRCmp30;%IRCmp60;%IRUnRsB4Qtr"
"RTN","GMRCSTL7",127,0)
 . S ^TMP("GMRCR",$J,GMRCARRN,1,0)=STR
"RTN","GMRCSTL7",128,0)
 S INDEX=""
"RTN","GMRCSTL7",129,0)
 ;Loop on Service
"RTN","GMRCSTL7",130,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTL7",131,0)
 .S GMRCSVC=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTL7",132,0)
 .S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,INDEX),"^",2)
"RTN","GMRCSTL7",133,0)
 .S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)
"RTN","GMRCSTL7",134,0)
 .N SUBIDX
"RTN","GMRCSTL7",135,0)
 .;pieces for tmp arrays, 1 to 6 are local, 7 to 12 are IFC placer, 13 to 18 are IFC filler
"RTN","GMRCSTL7",136,0)
 .;;total for 30 day start/end^total for 60 day start/end^results n 30 days^results n 60 days^total before quarter^total pending before quarter
"RTN","GMRCSTL7",137,0)
 .S ^TMP("GMRCT",$J,1,GMRCSVC,"DATA")="0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0"
"RTN","GMRCSTL7",138,0)
 .S ^TMP("GMRCT",$J,2,GMRCSVC,"DATA")="0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0^0"
"RTN","GMRCSTL7",139,0)
 .;Check if starting a new Grouper
"RTN","GMRCSTL7",140,0)
 .F  Q:GROUPER(GROUPER)=GMRCSVCG  D
"RTN","GMRCSTL7",141,0)
 ..;End of a group so print the group totals
"RTN","GMRCSTL7",142,0)
 ..I GROUPER(GROUPER)=GMRCSVCG D 
"RTN","GMRCSTL7",143,0)
 ... I GMRCARRN="CP" D
"RTN","GMRCSTL7",144,0)
 ....D PRTTOT^GMRCSTL8(2,GROUPER(GROUPER),GMRCARRN)
"RTN","GMRCSTL7",145,0)
 ...I GMRCARRN="DEL" D
"RTN","GMRCSTL7",146,0)
 ....D DELTOT^GMRCSTL8(2,GROUPER(GROUPER),GMRCARRN)
"RTN","GMRCSTL7",147,0)
 ..;pop grouper from stack
"RTN","GMRCSTL7",148,0)
 ..S GROUPER=GROUPER-1
"RTN","GMRCSTL7",149,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",4)="+" D
"RTN","GMRCSTL7",150,0)
 ..;push new grouper on stack
"RTN","GMRCSTL7",151,0)
 ..S GROUPER=GROUPER+1
"RTN","GMRCSTL7",152,0)
 ..S GROUPER(GROUPER)=GMRCSVC
"RTN","GMRCSTL7",153,0)
 .;Loop for one status at a time
"RTN","GMRCSTL7",154,0)
 .F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) D
"RTN","GMRCSTL7",155,0)
 ..D ONESTAT^GMRCSTL8(GMRCARRN,INDEX,STATUS,GMRC30ST,GMRC30SP,"30")
"RTN","GMRCSTL7",156,0)
 .F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) D
"RTN","GMRCSTL7",157,0)
 ..D ONESTAT^GMRCSTL8(GMRCARRN,INDEX,STATUS,$$FMADD^XLFDT(GMRC30ST,-30),$$FMADD^XLFDT(GMRC30SP,-30),"60")
"RTN","GMRCSTL7",158,0)
 .S GMRCDT1=$$FMADD^XLFDT(GMRC30ST,30) ;add 30 days back to set date back to start of FY quarter.
"RTN","GMRCSTL7",159,0)
 .F LOOP=1:1:$L(GMRCST2,",") S STATUS2=$P(GMRCST2,",",LOOP) D
"RTN","GMRCSTL7",160,0)
 ..D ONESTAT2^GMRCSTL8(GMRCARRN,INDEX,STATUS2,$$FMADD^XLFDT(GMRCDT1,-60))
"RTN","GMRCSTL7",161,0)
 .F GRP=GROUPER:-1:1 D
"RTN","GMRCSTL7",162,0)
 ..F PIECE=1:1:18 D
"RTN","GMRCSTL7",163,0)
 ...S $P(^TMP("GMRCT",$J,2,GROUPER(GRP),"DATA"),U,PIECE)=$P(^TMP("GMRCT",$J,2,GROUPER(GRP),"DATA"),U,PIECE)+$P(^TMP("GMRCT",$J,1,GMRCSVC,"DATA"),U,PIECE)
"RTN","GMRCSTL7",164,0)
 .;
"RTN","GMRCSTL7",165,0)
 .;Print the totals for this service that are >0
"RTN","GMRCSTL7",166,0)
 .I GMRCARRN="CP" D
"RTN","GMRCSTL7",167,0)
 ..D PRTTOT^GMRCSTL8(1,GMRCSVC,GMRCSVCP,GMRCARRN)
"RTN","GMRCSTL7",168,0)
 .I GMRCARRN="DEL" D
"RTN","GMRCSTL7",169,0)
 ..D DELTOT^GMRCSTL8(1,GMRCSVC,GMRCSVCP,GMRCARRN)
"RTN","GMRCSTL7",170,0)
 .Q
"RTN","GMRCSTL7",171,0)
 ;
"RTN","GMRCSTL7",172,0)
 ;Done, so now list the group totals for the top group
"RTN","GMRCSTL7",173,0)
 ;F GROUPER=GROUPER:-1:1 D  ; left for looking at all totals in future
"RTN","GMRCSTL7",174,0)
 I $G(GROUPER) S GROUPER=1 D
"RTN","GMRCSTL7",175,0)
 .I GMRCARRN="CP" D
"RTN","GMRCSTL7",176,0)
 ..D PRTTOT^GMRCSTL8(2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),GMRCARRN)
"RTN","GMRCSTL7",177,0)
 .I GMRCARRN="DEL" D
"RTN","GMRCSTL7",178,0)
 ..D DELTOT^GMRCSTL8(2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),GMRCARRN)
"RTN","GMRCSTL7",179,0)
 Q
"RTN","GMRCSTL7",180,0)
PRNTQ   ;Build report and print it
"RTN","GMRCSTL7",181,0)
 ;
"RTN","GMRCSTL7",182,0)
 N GMRCPG,GMRCTMP,IDX,GMRCQUT,TEMP
"RTN","GMRCSTL7",183,0)
 S GMRCPG=1
"RTN","GMRCSTL7",184,0)
 D SERV1^GMRCASV
"RTN","GMRCSTL7",185,0)
 D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",186,0)
 S TEMP=$S($G(GMRCQTR)=4:"4",$G(GMRCQTR)=3:"3",$G(GMRCQTR)=2:"2",1:"1")_"Q"_"FY"_$E($G(GMRCFY),3,4)
"RTN","GMRCSTL7",187,0)
 S TEMP="Consult/Request Performance Monitor - "_TEMP
"RTN","GMRCSTL7",188,0)
 W $J("",40-($L(TEMP)/2)+.5)_TEMP
"RTN","GMRCSTL7",189,0)
 S TEMP="Fiscal Quarter Dates: "_$$FMTE^XLFDT(GMRCDT1)_" - "_$$FMTE^XLFDT(GMRCDT2)
"RTN","GMRCSTL7",190,0)
 W !,$J("",40-($L(TEMP)/2)+.5)_TEMP
"RTN","GMRCSTL7",191,0)
 S TEMP="30 Days Before Start/End: "_$$FMTE^XLFDT(GMRC30ST)_" - "_$$FMTE^XLFDT(GMRC30SP)
"RTN","GMRCSTL7",192,0)
 W !,$J("",40-($L(TEMP)/2)+.5)_TEMP
"RTN","GMRCSTL7",193,0)
 S TEMP="60 Days Before Start/End: "_$$FMTE^XLFDT($$FMADD^XLFDT(GMRC30ST,-30))_" - "_$$FMTE^XLFDT($$FMADD^XLFDT(GMRC30SP,-30))
"RTN","GMRCSTL7",194,0)
 W !,$J("",40-($L(TEMP)/2)+.5)_TEMP,!
"RTN","GMRCSTL7",195,0)
 I '$D(IO("Q")) D WAIT^DICD W !!
"RTN","GMRCSTL7",196,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) D  G EXIT
"RTN","GMRCSTL7",197,0)
 .W !!,"No records to print"
"RTN","GMRCSTL7",198,0)
 D ENOR^GMRCSTL7(.GMRCTMP,GMRCDG,GMRC30ST,GMRC30SP,"2,5,6,8,9","1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,99",GMRCFMT)
"RTN","GMRCSTL7",199,0)
 I '$D(^TMP("GMRCR",$J,GMRCFMT)) D
"RTN","GMRCSTL7",200,0)
 .W !!,"No records to print",!
"RTN","GMRCSTL7",201,0)
 S IDX=""
"RTN","GMRCSTL7",202,0)
 F  S IDX=$O(^TMP("GMRCR",$J,GMRCFMT,IDX)) Q:'IDX!($G(GMRCQUT))  D
"RTN","GMRCSTL7",203,0)
 .I IOSL-$Y<3 D
"RTN","GMRCSTL7",204,0)
 ..I $E(IOST,1,2)["C-" D
"RTN","GMRCSTL7",205,0)
 ...N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTL7",206,0)
 ...I 'Y S GMRCQUT=1
"RTN","GMRCSTL7",207,0)
 ..Q:$G(GMRCQUT)
"RTN","GMRCSTL7",208,0)
 ..D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",209,0)
 .Q:$G(GMRCQUT)
"RTN","GMRCSTL7",210,0)
 .W ^TMP("GMRCR",$J,GMRCFMT,IDX,0),!
"RTN","GMRCSTL7",211,0)
 D:$D(^TMP("GMRCR",$J,GMRCFMT)) CAVEATS
"RTN","GMRCSTL7",212,0)
 I GMRCFMT="CP",'$G(GMRCQUT) D
"RTN","GMRCSTL7",213,0)
 .Q:$O(^TMP("GMRCT",$J,0,""))=""
"RTN","GMRCSTL7",214,0)
 .I IOSL-$Y<6 D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",215,0)
 .W !!!,$$REPEAT^XLFSTR("-",IOM-5)
"RTN","GMRCSTL7",216,0)
 .W !,"Consult services not meeting the criteria of this report for",!,"the specified date range:",!
"RTN","GMRCSTL7",217,0)
 .S IDX=""
"RTN","GMRCSTL7",218,0)
 .F  S IDX=$O(^TMP("GMRCT",$J,0,IDX)) Q:IDX=""!($G(GMRCQUT))  D
"RTN","GMRCSTL7",219,0)
 ..I IOSL-$Y<3 D
"RTN","GMRCSTL7",220,0)
 ...I $E(IOST,1,2)["C-" D
"RTN","GMRCSTL7",221,0)
 ....N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTL7",222,0)
 ....I 'Y S GMRCQUT=1
"RTN","GMRCSTL7",223,0)
 ...Q:$G(GMRCQUT)
"RTN","GMRCSTL7",224,0)
 ...D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",225,0)
 ..Q:$G(GMRCQUT)
"RTN","GMRCSTL7",226,0)
 ..W ?4,IDX,!
"RTN","GMRCSTL7",227,0)
 D ^%ZISC
"RTN","GMRCSTL7",228,0)
 D EXIT
"RTN","GMRCSTL7",229,0)
 Q
"RTN","GMRCSTL7",230,0)
 ;
"RTN","GMRCSTL7",231,0)
HEAD(PAGE) ; print header for CPM
"RTN","GMRCSTL7",232,0)
 W @IOF
"RTN","GMRCSTL7",233,0)
 I PAGE>1 D
"RTN","GMRCSTL7",234,0)
 .S TEMP=$S($G(GMRCQTR)=4:"4",$G(GMRCQTR)=3:"3",$G(GMRCQTR)=2:"2",1:"1")_"Q"_"FY"_$E($G(GMRCFY),3,4)
"RTN","GMRCSTL7",235,0)
 .S TEMP="Consult/Request Performance Monitor - "_TEMP
"RTN","GMRCSTL7",236,0)
 .W !,$J("",40-($L(TEMP)/2)+.5)_TEMP,!
"RTN","GMRCSTL7",237,0)
 W !,$J("Run Date: "_$$HTE^XLFDT($H),0),$J("Page: "_PAGE,48)
"RTN","GMRCSTL7",238,0)
 W !,$$REPEAT^XLFSTR("-",IOM-2),!!
"RTN","GMRCSTL7",239,0)
 Q
"RTN","GMRCSTL7",240,0)
 ;
"RTN","GMRCSTL7",241,0)
CAVEATS ; brief explanatory text
"RTN","GMRCSTL7",242,0)
 W !!,"Resubmitted requests are evaluated based on the original Date of Request."
"RTN","GMRCSTL7",243,0)
 W !!,"The following are excluded from this report:"
"RTN","GMRCSTL7",244,0)
 W !," -Requests sent to test patients."
"RTN","GMRCSTL7",245,0)
 W !," -Requests not marked as Outpatient in the REQUEST/CONSULTATION file."
"RTN","GMRCSTL7",246,0)
 W !," -Services flagged as part of the interface between Consults/Request Tracking"
"RTN","GMRCSTL7",247,0)
 W !,?2,"and Prosthetics."
"RTN","GMRCSTL7",248,0)
 W !," -Administrative requests flagged via the Administrative fields in the"
"RTN","GMRCSTL7",249,0)
 W !,?2,"REQUEST SERVICES and REQUEST/CONSULTATION files. This is not retroactive"
"RTN","GMRCSTL7",250,0)
 W !,?2,"and only applies to services/requests leveraging the Administrative-flagging"
"RTN","GMRCSTL7",251,0)
 W !,?2,"capability included in GMRC*3.0*60, available on or about June 2008."
"RTN","GMRCSTL7",252,0)
 W !," -The report utilizes the EARLIEST APPROPRIATE DATE field from the "
"RTN","GMRCSTL7",253,0)
 W !,?2,"REQUEST/CONSULTATION file to determine request totals for a given date"
"RTN","GMRCSTL7",254,0)
 W !,?2,"range.  This is true even for requests that have been re-submitted using"
"RTN","GMRCSTL7",255,0)
 W !,?2,"the Edit/Resubmit functionality.",!!
"RTN","GMRCSTL7",256,0)
 Q
"RTN","GMRCSTL7",257,0)
 ;
"RTN","GMRCSTL7",258,0)
EXIT F ARR="GMRCR","GMRCS","GMRCSLIST","GMRCT" K ^TMP(ARR,$J)
"RTN","GMRCSTL7",259,0)
 K ARR
"RTN","GMRCSTL7",260,0)
 Q
"RTN","GMRCSTL7",261,0)
 ;
"RTN","GMRCSTS")
0^1^B43894361^B42769284
"RTN","GMRCSTS",1,0)
GMRCSTS ;SLC/DLT,JFR,MA - Group update status of consult and order; 11/25/2000
"RTN","GMRCSTS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**8,18,21,76**;DEC 27, 1997;Build 7
"RTN","GMRCSTS",3,0)
 ; Patch 18 - Change UPDCMT to use Editor to add comment and
"RTN","GMRCSTS",4,0)
 ; Added Scheduled consults to selection list.
"RTN","GMRCSTS",5,0)
 ; Patch 21 - Added warning message in line tag WARNING().
"RTN","GMRCSTS",6,0)
 ; This routine invokes IA #2876,3121
"RTN","GMRCSTS",7,0)
 N GMRCTO,GMRCDG,GMRCSVC,GMRCSVCN,GMRCEND,GMRCSTRT,GMRCSTOP,GMRCGRP
"RTN","GMRCSTS",8,0)
 N GMRCCVT,GMRCM,GMRCMT,GMRCDO,DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSTS",9,0)
 D GETSRV I 'GMRCDG D END Q
"RTN","GMRCSTS",10,0)
 D GETDTR I GMRCEND D END Q
"RTN","GMRCSTS",11,0)
 S GMRCM=$$METHOD I GMRCEND D END Q
"RTN","GMRCSTS",12,0)
 S GMRCCVT=$$UPD1 I GMRCEND D END Q
"RTN","GMRCSTS",13,0)
 D UPDCMT(.GMRCMT)
"RTN","GMRCSTS",14,0)
 D VERIFY I GMRCEND D END Q
"RTN","GMRCSTS",15,0)
 D GETENTS^GMRCSTS1(GMRCSVC,GMRCSTRT,GMRCSTOP,GMRCM)
"RTN","GMRCSTS",16,0)
 S GMRCDO=$$WHATTODO I 'GMRCDO D END Q
"RTN","GMRCSTS",17,0)
 D DEVICE I $G(GMRCEND) D END Q
"RTN","GMRCSTS",18,0)
 I $D(IO("Q")) D QUEUE,^%ZISC,END Q
"RTN","GMRCSTS",19,0)
 D PRINT^GMRCSTS1(GMRCM,GMRCCVT,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP,GMRCDO)
"RTN","GMRCSTS",20,0)
 D END Q
"RTN","GMRCSTS",21,0)
GETSRV ;Get a service that the user is authorized to update status for
"RTN","GMRCSTS",22,0)
 D ^GMRCASV Q:'GMRCDG
"RTN","GMRCSTS",23,0)
 S GMRCSVC=+GMRCDG,GMRCSVCN=$P($G(^GMR(123.5,+GMRCSVC,0)),U,1)
"RTN","GMRCSTS",24,0)
 I $P($G(^GMR(123.5,+GMRCDG,0)),"^",4)=DUZ Q  ;user has special privileges
"RTN","GMRCSTS",25,0)
 ;Check for parent service authorization
"RTN","GMRCSTS",26,0)
 N AUTH,PARENT
"RTN","GMRCSTS",27,0)
 I $P(^GMR(123.5,1,0),U,4)=DUZ Q
"RTN","GMRCSTS",28,0)
 S (AUTH,PARENT)=0 F  S PARENT=$O(^GMR(123.5,"APC",+GMRCDG,PARENT)) Q:'PARENT  S:$P($G(^GMR(123.5,+PARENT,0)),U,4)=DUZ AUTH=PARENT
"RTN","GMRCSTS",29,0)
 I 'AUTH D UNAUTH S GMRCDG=0 G GETSRV
"RTN","GMRCSTS",30,0)
 Q
"RTN","GMRCSTS",31,0)
 ;
"RTN","GMRCSTS",32,0)
UNAUTH ;Unauthorized to do special update processing for service or its parent.
"RTN","GMRCSTS",33,0)
 N GMRCMSG
"RTN","GMRCSTS",34,0)
 W !
"RTN","GMRCSTS",35,0)
 S GMRCMSG="You are not defined as the SPECIAL UPDATES INDIVIDUAL for the"
"RTN","GMRCSTS",36,0)
 S GMRCMSG(1)=GMRCSVCN_" service or its parent service."
"RTN","GMRCSTS",37,0)
 S GMRCDG=0
"RTN","GMRCSTS",38,0)
 D EXAC^GMRCADC(.GMRCMSG)
"RTN","GMRCSTS",39,0)
 Q
"RTN","GMRCSTS",40,0)
 ;
"RTN","GMRCSTS",41,0)
GETDTR ;Get the date range
"RTN","GMRCSTS",42,0)
 ;END=# of days (T-END) for stop default limitations
"RTN","GMRCSTS",43,0)
 ;GMRCSTRT=Start date/time
"RTN","GMRCSTS",44,0)
 ;GMRCSTOP=Stop date/time
"RTN","GMRCSTS",45,0)
 ;GMRCEND=1 if user timed out or "^"
"RTN","GMRCSTS",46,0)
 S GMRCEND=0
"RTN","GMRCSTS",47,0)
 N X1,X2,X,END
"RTN","GMRCSTS",48,0)
 S X1=$$DT^XLFDT,X2=-30 D C^%DTC S END=X K X
"RTN","GMRCSTS",49,0)
 D START Q:GMRCEND
"RTN","GMRCSTS",50,0)
 D STOP Q:GMRCEND
"RTN","GMRCSTS",51,0)
 Q
"RTN","GMRCSTS",52,0)
 ;
"RTN","GMRCSTS",53,0)
START ;Get the start date
"RTN","GMRCSTS",54,0)
 N DIR,Y,ORDER,FIRST,GMRCIEN
"RTN","GMRCSTS",55,0)
 S ORDER=$O(^GMR(123,"AC",0)),GMRCIEN=$O(^GMR(123,"AC",+ORDER,""))
"RTN","GMRCSTS",56,0)
 I +$G(GMRCIEN) D
"RTN","GMRCSTS",57,0)
 . S Y=$P($G(^GMR(123,GMRCIEN,0)),U,1)
"RTN","GMRCSTS",58,0)
 . X ^DD("DD") S FIRST=$P(Y,"@",1)
"RTN","GMRCSTS",59,0)
 . S DIR("B")=FIRST
"RTN","GMRCSTS",60,0)
 . W !!,"The first order in Consults has an entry date of "_DIR("B"),!
"RTN","GMRCSTS",61,0)
 . Q
"RTN","GMRCSTS",62,0)
 S DIR(0)="D^:"_END_":AEX",DIR("A")="Update Status Start Date"
"RTN","GMRCSTS",63,0)
 S DIR("?")="^D HELP^%DTC"
"RTN","GMRCSTS",64,0)
 D ^DIR
"RTN","GMRCSTS",65,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",66,0)
 S GMRCSTRT=Y
"RTN","GMRCSTS",67,0)
 Q
"RTN","GMRCSTS",68,0)
 ;
"RTN","GMRCSTS",69,0)
STOP ;Get the stop date
"RTN","GMRCSTS",70,0)
 N DIR,Y,X
"RTN","GMRCSTS",71,0)
 S DIR(0)="D^:"_END_":AEX",DIR("A")="Update Status Stop Date"
"RTN","GMRCSTS",72,0)
 D ^DIR
"RTN","GMRCSTS",73,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",74,0)
 I Y<GMRCSTRT S GMRCSTOP=GMRCSTRT,GMRCSTRT=Y
"RTN","GMRCSTS",75,0)
 E  S GMRCSTOP=Y
"RTN","GMRCSTS",76,0)
 Q
"RTN","GMRCSTS",77,0)
 ;
"RTN","GMRCSTS",78,0)
METHOD() ;Get method to determine which consults to change
"RTN","GMRCSTS",79,0)
 N DIR,Y,X
"RTN","GMRCSTS",80,0)
 ;S DIR(0)="SM^P:Pending;A:Active;S:Scheduled;ALL:For All"
"RTN","GMRCSTS",81,0)
 ;S DIR("A")="Status(es) to search for updating"
"RTN","GMRCSTS",82,0)
 S DIR("A",1)=""
"RTN","GMRCSTS",83,0)
 S DIR("A",2)=""
"RTN","GMRCSTS",84,0)
 S DIR("A",3)="                  1 = Pending"
"RTN","GMRCSTS",85,0)
 S DIR("A",4)="                  2 = Active"
"RTN","GMRCSTS",86,0)
 S DIR("A",5)="                  3 = Scheduled"
"RTN","GMRCSTS",87,0)
 S DIR("A",6)="                  4 = All"
"RTN","GMRCSTS",88,0)
 S DIR("A",7)=""
"RTN","GMRCSTS",89,0)
 S DIR("A",8)="    Enter any combination of numbers separated"
"RTN","GMRCSTS",90,0)
 S DIR("A")="    by a comma or hyphen"
"RTN","GMRCSTS",91,0)
 S DIR(0)="LO^1:4"
"RTN","GMRCSTS",92,0)
 D ^DIR
"RTN","GMRCSTS",93,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1
"RTN","GMRCSTS",94,0)
 Q Y
"RTN","GMRCSTS",95,0)
 S DIR(0)="SM^S:Order Status of Pending or Active;R:Result Activity"
"RTN","GMRCSTS",96,0)
 S DIR("A")="Method to find Consults to Update"
"RTN","GMRCSTS",97,0)
 D ^DIR
"RTN","GMRCSTS",98,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1 Q Y
"RTN","GMRCSTS",99,0)
 Q Y
"RTN","GMRCSTS",100,0)
 ;
"RTN","GMRCSTS",101,0)
VERIFY ;Verify the criteria is correct
"RTN","GMRCSTS",102,0)
 W !
"RTN","GMRCSTS",103,0)
 D UPDCRIT^GMRCSTS1(GMRCCVT,GMRCM,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP)
"RTN","GMRCSTS",104,0)
 N DIR
"RTN","GMRCSTS",105,0)
 S DIR(0)="Y",DIR("A")="Is this correct",DIR("B")="NO"
"RTN","GMRCSTS",106,0)
 D ^DIR I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",107,0)
 Q
"RTN","GMRCSTS",108,0)
UPD1() ;Determine update status
"RTN","GMRCSTS",109,0)
 N DIR,X,Y
"RTN","GMRCSTS",110,0)
 W !!,"If orders in the date range still have the selected status, this option"
"RTN","GMRCSTS",111,0)
 W !,"will change their status in consults, and update the order."
"RTN","GMRCSTS",112,0)
 W !!,"You may change the status to COMPLETE or DISCONTINUED."
"RTN","GMRCSTS",113,0)
 W !!,"Ordering provider will not receive notification of Group Update."
"RTN","GMRCSTS",114,0)
 W !
"RTN","GMRCSTS",115,0)
 S DIR(0)="SAM^D:Discontinued;C:Complete"
"RTN","GMRCSTS",116,0)
 S DIR("A")="Change their status to: "
"RTN","GMRCSTS",117,0)
 D ^DIR I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1 Q Y
"RTN","GMRCSTS",118,0)
 Q $S(Y="D":"1^DC",1:"2^C")
"RTN","GMRCSTS",119,0)
 ;
"RTN","GMRCSTS",120,0)
DEVICE ; device for printout of entries to group update
"RTN","GMRCSTS",121,0)
 N %ZIS,POP
"RTN","GMRCSTS",122,0)
 W !!,"The device selected will print a list of entries from file 123 that will be"
"RTN","GMRCSTS",123,0)
 W !,"updated to ",$S(+GMRCCVT=1:"DISCONTINUED",1:"COMPLETE"),"."
"RTN","GMRCSTS",124,0)
 W !!,"If you choose to update records, the update of the consult entries will take"
"RTN","GMRCSTS",125,0)
 W !,"place upon completion of the report."
"RTN","GMRCSTS",126,0)
 W !!,"It is highly advised that a printer be selected!"
"RTN","GMRCSTS",127,0)
RETRY S %ZIS="QM",%ZIS("A")="Select device for report: ",%ZIS("B")=""
"RTN","GMRCSTS",128,0)
 D ^%ZIS
"RTN","GMRCSTS",129,0)
 I POP S GMRCEND=1 Q
"RTN","GMRCSTS",130,0)
 I $E(IOST,1,2)="C-" D  G:Y<1 RETRY
"RTN","GMRCSTS",131,0)
 . W !!,$C(7),"You have not chosen a printer!  If you do not choose a printer there will",!,"be no record of the entries that were updated."
"RTN","GMRCSTS",132,0)
 . N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSTS",133,0)
 . S DIR(0)="Y",DIR("A")="Are you sure you want to use this device"
"RTN","GMRCSTS",134,0)
 . S DIR("B")="NO" D ^DIR I $D(DIRUT) S GMRCEND=1
"RTN","GMRCSTS",135,0)
 Q
"RTN","GMRCSTS",136,0)
QUEUE ; send task for print and update
"RTN","GMRCSTS",137,0)
 I GMRCDO=2,'$$WARNING D ^%ZISC,END Q  ; Killed report
"RTN","GMRCSTS",138,0)
 N ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSAVE,ZTSK
"RTN","GMRCSTS",139,0)
 S ZTRTN="PRTTSK^GMRCSTS1",ZTDESC="UPDATE OF RECORDS FILE 123"
"RTN","GMRCSTS",140,0)
 S ZTIO=ION
"RTN","GMRCSTS",141,0)
 S ZTSAVE("^TMP(""GMRCLS"",$J,")="",ZTSAVE("GMRC*")=""
"RTN","GMRCSTS",142,0)
 D ^%ZTLOAD I $G(ZTSK) W !,"Task # ",ZTSK
"RTN","GMRCSTS",143,0)
 I '$G(ZTSK) W !,"Unable to queue report!  Try again later."
"RTN","GMRCSTS",144,0)
 Q
"RTN","GMRCSTS",145,0)
UPDCMT(COMMENT) ; get comment to stuff in consult activity
"RTN","GMRCSTS",146,0)
 W !
"RTN","GMRCSTS",147,0)
 N DWPK,DWLW,DIC,DIWEPSE,INDEX
"RTN","GMRCSTS",148,0)
 W !,"Enter the Comment to be applied to all selected Consults"
"RTN","GMRCSTS",149,0)
 S DIC="^TMP(""GMRCTMP"","_$J_",1,",DWLW=80,DWPK=1,DIWEPSE=1
"RTN","GMRCSTS",150,0)
 D EN^DIWE
"RTN","GMRCSTS",151,0)
 S INDEX=0
"RTN","GMRCSTS",152,0)
 F   S INDEX=$O(^TMP("GMRCTMP",$J,1,INDEX))  Q:'INDEX  D
"RTN","GMRCSTS",153,0)
 . S COMMENT(INDEX,0)=^TMP("GMRCTMP",$J,1,INDEX,0)
"RTN","GMRCSTS",154,0)
 K ^TMP("GMRCTMP",$J)
"RTN","GMRCSTS",155,0)
 Q
"RTN","GMRCSTS",156,0)
WHATTODO() ;how to handle the update
"RTN","GMRCSTS",157,0)
 N DIR
"RTN","GMRCSTS",158,0)
 S DIR(0)="SO^1:Print report only;2:Print report & update records;3:Quit"
"RTN","GMRCSTS",159,0)
 S DIR("A")="Choose the method to handle the report"
"RTN","GMRCSTS",160,0)
 D ^DIR I $D(DIRUT)!(Y=3) Q 0
"RTN","GMRCSTS",161,0)
 Q +Y
"RTN","GMRCSTS",162,0)
WARNING() ; If REPORT/UPDATE is being task issue warning message.
"RTN","GMRCSTS",163,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSTS",164,0)
 I $D(IO("Q")) D
"RTN","GMRCSTS",165,0)
 . W !,"WARNING - Records will automatically be updated since the"
"RTN","GMRCSTS",166,0)
 . W !,"report is being tasked.",!
"RTN","GMRCSTS",167,0)
 S DIR("B")="NO",DIR(0)="Y",DIR("A")="Do you wish to continue??"
"RTN","GMRCSTS",168,0)
 D ^DIR I $D(DIRUT) S Y=0
"RTN","GMRCSTS",169,0)
 Q +Y
"RTN","GMRCSTS",170,0)
END K ^TMP("GMRCLS",$J) Q
"VER")
8.0^22.0
"BLD",9198,6)
^68
**END**
**END**
