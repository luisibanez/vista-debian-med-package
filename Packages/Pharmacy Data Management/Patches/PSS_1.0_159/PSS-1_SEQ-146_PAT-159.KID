Released PSS*1*159 SEQ #146
Extracted from mail message
**KIDS**:PSS*1.0*159^

**INSTALL NAME**
PSS*1.0*159
"BLD",7560,0)
PSS*1.0*159^PHARMACY DATA MANAGEMENT^0^3111013^y
"BLD",7560,1,0)
^^55^55^3111013^
"BLD",7560,1,1,0)
This enhancement, approved by the Pharmacy Legacy Enhancement (PLE) User
"BLD",7560,1,2,0)
Group, will resolve Patient Safety Issue PSI-08-026/PSPO #852 reported in
"BLD",7560,1,3,0)
Remedy Ticket HD233682.
"BLD",7560,1,4,0)
 
"BLD",7560,1,5,0)
This patch will help mitigate incorrect medication routes being displayed
"BLD",7560,1,6,0)
for selection in the Computerized Patient Record System (CPRS) V. 3.0.
"BLD",7560,1,7,0)
This enhancement affects Inpatient Medications unit dose orders, IV Fluids
"BLD",7560,1,8,0)
orders, and Outpatient Pharmacy orders entered via CPRS orders dialog.
"BLD",7560,1,9,0)
 
"BLD",7560,1,10,0)
The pharmacy Integration Control Registration (ICR) #2418 is modified
"BLD",7560,1,11,0)
to return appropriate medication routes for the orderable item (OI) in
"BLD",7560,1,12,0)
CPRS ordering dialog with the following conditions.
"BLD",7560,1,13,0)
 
"BLD",7560,1,14,0)
Note: The fields referenced below are from the PHARMACY ORDERABLE ITEM
"BLD",7560,1,15,0)
      file (#50.7):
"BLD",7560,1,16,0)
 
"BLD",7560,1,17,0)
  1. ICR Modifications
"BLD",7560,1,18,0)
   - Default Med Route
"BLD",7560,1,19,0)
     It will be derived from the DEFAULT MED ROUTE field (#.06) if it's
"BLD",7560,1,20,0)
     populated or from the POSSIBLE MED ROUTES multiple (#50.711) if it's
"BLD",7560,1,21,0)
     populated with single entry and the USE DOSAGE FORM MED ROUTE LIST
"BLD",7560,1,22,0)
     field (#10) is set to "NO."
"BLD",7560,1,23,0)
 
"BLD",7560,1,24,0)
   - Optional Med Routes
"BLD",7560,1,25,0)
     The medication route selection list in CPRS will be populated with
"BLD",7560,1,26,0)
     entries from the POSSIBLE MED ROUTES multiple (#50.711) if the USE
"BLD",7560,1,27,0)
     DOSAGE FORM MED ROUTE LIST field (#10) is set to "NO." Otherwise, it
"BLD",7560,1,28,0)
     will be populated from the medication routes associated with the
"BLD",7560,1,29,0)
     orderable item's dosage form, which is the current logic.
"BLD",7560,1,30,0)
 
"BLD",7560,1,31,0)
  2. The logic for editing the medication route has been modified in the 
"BLD",7560,1,32,0)
     following options:
"BLD",7560,1,33,0)
     - Edit Orderable Items [PSS EDIT ORDERABLE ITEMS]
"BLD",7560,1,34,0)
     - Drug Enter/Edit [PSS DRUG ENTER/EDIT]
"BLD",7560,1,35,0)
     - Dispense Drug/Orderable Item Maintenance [PSS MAINTAIN ORDERABLE
"BLD",7560,1,36,0)
       ITEMS]
"BLD",7560,1,37,0)
 
"BLD",7560,1,38,0)
     The software will now ensure that the DEFAULT MED ROUTE field (#.06)
"BLD",7560,1,39,0)
     of the PHARMACY ORDERABLE ITEM file (#50.7) is either defined and/or
"BLD",7560,1,40,0)
     at least one entry is defined in the POSSIBLE MED ROUTES multiple
"BLD",7560,1,41,0)
     (#50.711) or the USE DOSAGE FORM MED ROUTE LIST field (#10) is set to
"BLD",7560,1,42,0)
     YES so that the medication route selection during order entry is
"BLD",7560,1,43,0)
     listed appropriately.
"BLD",7560,1,44,0)
 
"BLD",7560,1,45,0)
     Note: This patch will change USE DOSAGE FORM MED ROUTE LIST field
"BLD",7560,1,46,0)
           (#10) of the PHARMACY ORDERABLE ITEM file (#50.7) from not
"BLD",7560,1,47,0)
           required to a required field. In order to use the new
"BLD",7560,1,48,0)
           functionality introduced in this patch, it is imperative that
"BLD",7560,1,49,0)
           the user marks this field YES or NO. This field will be used to
"BLD",7560,1,50,0)
           determine the medication route selection during order entry.
"BLD",7560,1,51,0)
 
"BLD",7560,1,52,0)
  3. The Pharmacy System Parameters Edit [PSS SYS EDIT] option is modified
"BLD",7560,1,53,0)
     to remove the DEFAULT MED ROUTE FOR CPRS field (#80.7) of the 
"BLD",7560,1,54,0)
     PHARMACY SYSTEM file (#59.7) from the list of fields that can be
"BLD",7560,1,55,0)
     edited.
"BLD",7560,4,0)
^9.64PA^50.7^1
"BLD",7560,4,50.7,0)
50.7
"BLD",7560,4,50.7,2,0)
^9.641^50.7^1
"BLD",7560,4,50.7,2,50.7,0)
PHARMACY ORDERABLE ITEM  (File-top level)
"BLD",7560,4,50.7,2,50.7,1,0)
^9.6411^10^1
"BLD",7560,4,50.7,2,50.7,1,10,0)
USE DOSAGE FORM MED ROUTE LIST
"BLD",7560,4,50.7,222)
y^y^p^^^^n^^n
"BLD",7560,4,50.7,224)

"BLD",7560,4,"APDD",50.7,50.7)

"BLD",7560,4,"APDD",50.7,50.7,10)

"BLD",7560,4,"B",50.7,50.7)

"BLD",7560,6)
2^
"BLD",7560,6.3)
29
"BLD",7560,"ABPKG")
n
"BLD",7560,"INID")
y^y
"BLD",7560,"INIT")
POST^PSSP159
"BLD",7560,"KRN",0)
^9.67PA^779.2^20
"BLD",7560,"KRN",.4,0)
.4
"BLD",7560,"KRN",.401,0)
.401
"BLD",7560,"KRN",.402,0)
.402
"BLD",7560,"KRN",.403,0)
.403
"BLD",7560,"KRN",.5,0)
.5
"BLD",7560,"KRN",.84,0)
.84
"BLD",7560,"KRN",3.6,0)
3.6
"BLD",7560,"KRN",3.8,0)
3.8
"BLD",7560,"KRN",9.2,0)
9.2
"BLD",7560,"KRN",9.8,0)
9.8
"BLD",7560,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",7560,"KRN",9.8,"NM",1,0)
PSSJORDF^^0^B55766382
"BLD",7560,"KRN",9.8,"NM",2,0)
PSSYSP^^0^B143904
"BLD",7560,"KRN",9.8,"NM",3,0)
PSSPOIMO^^0^B131205688
"BLD",7560,"KRN",9.8,"NM",4,0)
PSSPOIM1^^0^B57105824
"BLD",7560,"KRN",9.8,"NM","B","PSSJORDF",1)

"BLD",7560,"KRN",9.8,"NM","B","PSSPOIM1",4)

"BLD",7560,"KRN",9.8,"NM","B","PSSPOIMO",3)

"BLD",7560,"KRN",9.8,"NM","B","PSSYSP",2)

"BLD",7560,"KRN",19,0)
19
"BLD",7560,"KRN",19.1,0)
19.1
"BLD",7560,"KRN",101,0)
101
"BLD",7560,"KRN",409.61,0)
409.61
"BLD",7560,"KRN",771,0)
771
"BLD",7560,"KRN",779.2,0)
779.2
"BLD",7560,"KRN",870,0)
870
"BLD",7560,"KRN",8989.51,0)
8989.51
"BLD",7560,"KRN",8989.52,0)
8989.52
"BLD",7560,"KRN",8994,0)
8994
"BLD",7560,"KRN","B",.4,.4)

"BLD",7560,"KRN","B",.401,.401)

"BLD",7560,"KRN","B",.402,.402)

"BLD",7560,"KRN","B",.403,.403)

"BLD",7560,"KRN","B",.5,.5)

"BLD",7560,"KRN","B",.84,.84)

"BLD",7560,"KRN","B",3.6,3.6)

"BLD",7560,"KRN","B",3.8,3.8)

"BLD",7560,"KRN","B",9.2,9.2)

"BLD",7560,"KRN","B",9.8,9.8)

"BLD",7560,"KRN","B",19,19)

"BLD",7560,"KRN","B",19.1,19.1)

"BLD",7560,"KRN","B",101,101)

"BLD",7560,"KRN","B",409.61,409.61)

"BLD",7560,"KRN","B",771,771)

"BLD",7560,"KRN","B",779.2,779.2)

"BLD",7560,"KRN","B",870,870)

"BLD",7560,"KRN","B",8989.51,8989.51)

"BLD",7560,"KRN","B",8989.52,8989.52)

"BLD",7560,"KRN","B",8994,8994)

"BLD",7560,"PRE")
PSS159EN
"BLD",7560,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7560,"QUES",0)
^9.62^^
"BLD",7560,"REQB",0)
^9.611^3^2
"BLD",7560,"REQB",2,0)
PSS*1.0*153^2
"BLD",7560,"REQB",3,0)
PSS*1.0*142^2
"BLD",7560,"REQB","B","PSS*1.0*142",3)

"BLD",7560,"REQB","B","PSS*1.0*153",2)

"FIA",50.7)
PHARMACY ORDERABLE ITEM
"FIA",50.7,0)
^PS(50.7,
"FIA",50.7,0,0)
50.7I
"FIA",50.7,0,1)
y^y^p^^^^n^^n
"FIA",50.7,0,10)

"FIA",50.7,0,11)

"FIA",50.7,0,"RLRO")

"FIA",50.7,0,"VR")
1.0^PSS
"FIA",50.7,50.7)
1
"FIA",50.7,50.7,10)

"INIT")
POST^PSSP159
"MBREQ")
0
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
159^3111013^11843
"PKG",517,22,1,"PAH",1,1,0)
^^55^55^3111013
"PKG",517,22,1,"PAH",1,1,1,0)
This enhancement, approved by the Pharmacy Legacy Enhancement (PLE) User
"PKG",517,22,1,"PAH",1,1,2,0)
Group, will resolve Patient Safety Issue PSI-08-026/PSPO #852 reported in
"PKG",517,22,1,"PAH",1,1,3,0)
Remedy Ticket HD233682.
"PKG",517,22,1,"PAH",1,1,4,0)
 
"PKG",517,22,1,"PAH",1,1,5,0)
This patch will help mitigate incorrect medication routes being displayed
"PKG",517,22,1,"PAH",1,1,6,0)
for selection in the Computerized Patient Record System (CPRS) V. 3.0.
"PKG",517,22,1,"PAH",1,1,7,0)
This enhancement affects Inpatient Medications unit dose orders, IV Fluids
"PKG",517,22,1,"PAH",1,1,8,0)
orders, and Outpatient Pharmacy orders entered via CPRS orders dialog.
"PKG",517,22,1,"PAH",1,1,9,0)
 
"PKG",517,22,1,"PAH",1,1,10,0)
The pharmacy Integration Control Registration (ICR) #2418 is modified
"PKG",517,22,1,"PAH",1,1,11,0)
to return appropriate medication routes for the orderable item (OI) in
"PKG",517,22,1,"PAH",1,1,12,0)
CPRS ordering dialog with the following conditions.
"PKG",517,22,1,"PAH",1,1,13,0)
 
"PKG",517,22,1,"PAH",1,1,14,0)
Note: The fields referenced below are from the PHARMACY ORDERABLE ITEM
"PKG",517,22,1,"PAH",1,1,15,0)
      file (#50.7):
"PKG",517,22,1,"PAH",1,1,16,0)
 
"PKG",517,22,1,"PAH",1,1,17,0)
  1. ICR Modifications
"PKG",517,22,1,"PAH",1,1,18,0)
   - Default Med Route
"PKG",517,22,1,"PAH",1,1,19,0)
     It will be derived from the DEFAULT MED ROUTE field (#.06) if it's
"PKG",517,22,1,"PAH",1,1,20,0)
     populated or from the POSSIBLE MED ROUTES multiple (#50.711) if it's
"PKG",517,22,1,"PAH",1,1,21,0)
     populated with single entry and the USE DOSAGE FORM MED ROUTE LIST
"PKG",517,22,1,"PAH",1,1,22,0)
     field (#10) is set to "NO."
"PKG",517,22,1,"PAH",1,1,23,0)
 
"PKG",517,22,1,"PAH",1,1,24,0)
   - Optional Med Routes
"PKG",517,22,1,"PAH",1,1,25,0)
     The medication route selection list in CPRS will be populated with
"PKG",517,22,1,"PAH",1,1,26,0)
     entries from the POSSIBLE MED ROUTES multiple (#50.711) if the USE
"PKG",517,22,1,"PAH",1,1,27,0)
     DOSAGE FORM MED ROUTE LIST field (#10) is set to "NO." Otherwise, it
"PKG",517,22,1,"PAH",1,1,28,0)
     will be populated from the medication routes associated with the
"PKG",517,22,1,"PAH",1,1,29,0)
     orderable item's dosage form, which is the current logic.
"PKG",517,22,1,"PAH",1,1,30,0)
 
"PKG",517,22,1,"PAH",1,1,31,0)
  2. The logic for editing the medication route has been modified in the 
"PKG",517,22,1,"PAH",1,1,32,0)
     following options:
"PKG",517,22,1,"PAH",1,1,33,0)
     - Edit Orderable Items [PSS EDIT ORDERABLE ITEMS]
"PKG",517,22,1,"PAH",1,1,34,0)
     - Drug Enter/Edit [PSS DRUG ENTER/EDIT]
"PKG",517,22,1,"PAH",1,1,35,0)
     - Dispense Drug/Orderable Item Maintenance [PSS MAINTAIN ORDERABLE
"PKG",517,22,1,"PAH",1,1,36,0)
       ITEMS]
"PKG",517,22,1,"PAH",1,1,37,0)
 
"PKG",517,22,1,"PAH",1,1,38,0)
     The software will now ensure that the DEFAULT MED ROUTE field (#.06)
"PKG",517,22,1,"PAH",1,1,39,0)
     of the PHARMACY ORDERABLE ITEM file (#50.7) is either defined and/or
"PKG",517,22,1,"PAH",1,1,40,0)
     at least one entry is defined in the POSSIBLE MED ROUTES multiple
"PKG",517,22,1,"PAH",1,1,41,0)
     (#50.711) or the USE DOSAGE FORM MED ROUTE LIST field (#10) is set to
"PKG",517,22,1,"PAH",1,1,42,0)
     YES so that the medication route selection during order entry is
"PKG",517,22,1,"PAH",1,1,43,0)
     listed appropriately.
"PKG",517,22,1,"PAH",1,1,44,0)
 
"PKG",517,22,1,"PAH",1,1,45,0)
     Note: This patch will change USE DOSAGE FORM MED ROUTE LIST field
"PKG",517,22,1,"PAH",1,1,46,0)
           (#10) of the PHARMACY ORDERABLE ITEM file (#50.7) from not
"PKG",517,22,1,"PAH",1,1,47,0)
           required to a required field. In order to use the new
"PKG",517,22,1,"PAH",1,1,48,0)
           functionality introduced in this patch, it is imperative that
"PKG",517,22,1,"PAH",1,1,49,0)
           the user marks this field YES or NO. This field will be used to
"PKG",517,22,1,"PAH",1,1,50,0)
           determine the medication route selection during order entry.
"PKG",517,22,1,"PAH",1,1,51,0)
 
"PKG",517,22,1,"PAH",1,1,52,0)
  3. The Pharmacy System Parameters Edit [PSS SYS EDIT] option is modified
"PKG",517,22,1,"PAH",1,1,53,0)
     to remove the DEFAULT MED ROUTE FOR CPRS field (#80.7) of the 
"PKG",517,22,1,"PAH",1,1,54,0)
     PHARMACY SYSTEM file (#59.7) from the list of fields that can be
"PKG",517,22,1,"PAH",1,1,55,0)
     edited.
"PRE")
PSS159EN
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PSS159EN")
0^^B4735666^n/a
"RTN","PSS159EN",1,0)
PSS159EN ;BIR/SJA-ENVIRONMENT CHECK ROUTINE FOR PSS*1*159 ;09/13/11
"RTN","PSS159EN",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**159**;9/30/97;Build 29
"RTN","PSS159EN",3,0)
 ;
"RTN","PSS159EN",4,0)
 Q:'$G(XPDENV)
"RTN","PSS159EN",5,0)
 ;
"RTN","PSS159EN",6,0)
EN ;
"RTN","PSS159EN",7,0)
 N PSSMES,PSSAR,PSSARX,PSSLP,PSSFLG,DIC,DTOUT,DUOUT,X,Y,DIRUT,DIROUT,DIR
"RTN","PSS159EN",8,0)
 S PSSMES(1)="Upon completion of the post-install, a mail message will be sent"
"RTN","PSS159EN",9,0)
 S PSSMES(2)="to the patch installer, and at least one pharmacy user. Please"
"RTN","PSS159EN",10,0)
 S PSSMES(3)="enter one or more Pharmacy users (e.g., Pharmacy ADPAC or designee)"
"RTN","PSS159EN",11,0)
 S PSSMES(4)="who should receive this message."
"RTN","PSS159EN",12,0)
 D MES^XPDUTL(.PSSMES)
"RTN","PSS159EN",13,0)
 S PSSAR(DUZ)=""
"RTN","PSS159EN",14,0)
 S PSSFLG=0
"RTN","PSS159EN",15,0)
 ;
"RTN","PSS159EN",16,0)
ASK ;
"RTN","PSS159EN",17,0)
 D BMES^XPDUTL(" ")
"RTN","PSS159EN",18,0)
 K DIC S DIC=200,DIC(0)="QEAMZ",DIC("A")="Enter Pharmacy User: "
"RTN","PSS159EN",19,0)
 D ^DIC K DIC I $D(DTOUT)!($D(DUOUT))!(+Y'>0) G END
"RTN","PSS159EN",20,0)
 I $D(PSSAR(+Y)) D BMES^XPDUTL("Already selected.") G ASK
"RTN","PSS159EN",21,0)
 S PSSFLG=1
"RTN","PSS159EN",22,0)
 S PSSAR(+Y)=""
"RTN","PSS159EN",23,0)
 G ASK
"RTN","PSS159EN",24,0)
 ;
"RTN","PSS159EN",25,0)
END ;
"RTN","PSS159EN",26,0)
 I 'PSSFLG D BMES^XPDUTL("At least one recipient must be selected. Install aborted.") S XPDABORT=2 Q
"RTN","PSS159EN",27,0)
 D BMES^XPDUTL(" ")
"RTN","PSS159EN",28,0)
 K DIR,Y S DIR(0)="Y",DIR("B")="Y",DIR("A")="Continue with install",DIR("?")="Enter 'Y' to continue with install, enter 'N' or '^' to abort install" D ^DIR K DIR
"RTN","PSS159EN",29,0)
 I Y'=1!($D(DTOUT))!($D(DUOUT)) S XPDABORT=2 Q
"RTN","PSS159EN",30,0)
 D BMES^XPDUTL(" ")
"RTN","PSS159EN",31,0)
 F PSSLP=0:0 S PSSLP=$O(PSSAR(PSSLP)) Q:'PSSLP  S @XPDGREF@("PSSARX",PSSLP)=""
"RTN","PSS159EN",32,0)
 Q
"RTN","PSSJORDF")
0^1^B55766382^B46862726
"RTN","PSSJORDF",1,0)
PSSJORDF ;BIR/MV-RETURN MED ROUTES(MR) AND INSTRUCTIONS(INS) ;06/26/98
"RTN","PSSJORDF",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**5,13,34,38,69,113,94,140,142,159**;9/30/97;Build 29
"RTN","PSSJORDF",3,0)
 ;;
"RTN","PSSJORDF",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSSJORDF",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSSJORDF",6,0)
 ; Reference to ^PS(50.606 is supported by DBIA 2174.
"RTN","PSSJORDF",7,0)
 ; 
"RTN","PSSJORDF",8,0)
 ;* PSJORD is the Orderable Item IEN pass to Pharmacy by OE/RR.  
"RTN","PSSJORDF",9,0)
 ;* 1. If the dosage form is valid, this routine will return: 
"RTN","PSSJORDF",10,0)
 ;*    If the orderable item has a default med route in the DEFAULT MED ROUTE field #.06 in 
"RTN","PSSJORDF",11,0)
 ;*    file #50.7 set it as the default;  and then get the other med routes from the POSSIBLE MED ROUTES
"RTN","PSSJORDF",12,0)
 ;*    field #11 if the USE DOSAGE FORM MED ROUTE LIST field #10 is set to "NO". 
"RTN","PSSJORDF",13,0)
 ;*    If the orderable item has a default med route in the DEFAULT MED ROUTE field #.06 in file #50.7
"RTN","PSSJORDF",14,0)
 ;*    set it as the default;  and then get the other med routes from the Dosage Form med routes if the 
"RTN","PSSJORDF",15,0)
 ;*    USE DOSAGE FORM MED ROUTE LIST field #10 is set to "YES". 
"RTN","PSSJORDF",16,0)
 ;*    Otherwise, use existing functionality.
"RTN","PSSJORDF",17,0)
 ;  2. If the dose form is null, this routine will return all med routes
"RTN","PSSJORDF",18,0)
 ;*    that exist in the medication routes file.
"RTN","PSSJORDF",19,0)
 ; 
"RTN","PSSJORDF",20,0)
 ;* 3. ^TMP format:
"RTN","PSSJORDF",21,0)
 ;*    ^TMP("PSJMR",$J,#)=MED ROUTE^MED ROUTE ABREVATION^IEN^OUTPATIENT
"RTN","PSSJORDF",22,0)
 ;*                       EXPANSION^IV FLAG^DEFAULT FLAG
"RTN","PSSJORDF",23,0)
 ;*    ^TMP("PSJNOUN",$J,D0)=NOUN^VERB^PREPOSITION
"RTN","PSSJORDF",24,0)
 ;*    ^TMP("PSJSCH",$J)=DEFAULT SCHEDULE NAME
"RTN","PSSJORDF",25,0)
 ;
"RTN","PSSJORDF",26,0)
START(PSJORD,PSJOPAC) ;
"RTN","PSSJORDF",27,0)
 N MR,MRNODE,PSJDFNO,X,MCT,Z,PSJOISC
"RTN","PSSJORDF",28,0)
 I '+PSJORD D MEDROUTE Q
"RTN","PSSJORDF",29,0)
 S PSJDFNO=+$P($G(^PS(50.7,+PSJORD,0)),U,2)
"RTN","PSSJORDF",30,0)
 S PSJOISC=$P($G(^PS(50.7,+PSJORD,0)),"^",8)
"RTN","PSSJORDF",31,0)
 I $G(PSJOPAC)="O"!($G(PSJOPAC)="X") D:$G(PSJOISC)'="" EN^PSSOUTSC(.PSJOISC) S:$G(PSJOISC)'="" ^TMP("PSJSCH",$J)=$G(PSJOISC) G SCPASS
"RTN","PSSJORDF",32,0)
 I $G(PSJOISC)'="" D EN^PSSGSGUI(.PSJOISC,"I") S:$G(PSJOISC)'="" ^TMP("PSJSCH",$J)=$G(PSJOISC)
"RTN","PSSJORDF",33,0)
SCPASS ;
"RTN","PSSJORDF",34,0)
 I $G(^PS(50.606,PSJDFNO,0))="" D NOD Q:$D(^TMP("PSJMR",$J,1))  D MEDROUTE Q
"RTN","PSSJORDF",35,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J)
"RTN","PSSJORDF",36,0)
 D DF
"RTN","PSSJORDF",37,0)
 Q
"RTN","PSSJORDF",38,0)
 ;
"RTN","PSSJORDF",39,0)
DF ;* Loop thru DF node to find all available med routes, nouns, and instructions.
"RTN","PSSJORDF",40,0)
 N VERB,MR,X,PM,II
"RTN","PSSJORDF",41,0)
 S (MR,X)=0,MCT=1
"RTN","PSSJORDF",42,0)
 S VERB=$P($G(^PS(50.606,PSJDFNO,"MISC")),U),MR=+$P($G(^PS(50.7,+PSJORD,0)),"^",6)
"RTN","PSSJORDF",43,0)
 I MR,$D(^PS(51.2,MR,0)),$P($G(^(0)),"^",4)=1 S ^TMP("PSJMR",$J,1)=$P(^PS(51.2,MR,0),"^")_U_$P(^(0),"^",3)_U_MR_U_$P(^(0),"^",2)_U_$S($P(^(0),"^",6):1,1:0)_"^D",MCT=MCT+1
"RTN","PSSJORDF",44,0)
 ; Populate possible med routes
"RTN","PSSJORDF",45,0)
 I $P($G(^PS(50.7,+PSJORD,0)),"^",13)'="Y" D  S:$O(^TMP("PSJMR",$J,""),-1)=1 $P(^TMP("PSJMR",$J,1),U,6)="D" Q
"RTN","PSSJORDF",46,0)
 . S II=0 F  S II=$O(^PS(50.7,+PSJORD,3,II)) Q:'II  S PM=$G(^(II,0)) D
"RTN","PSSJORDF",47,0)
 . . Q:PM=+$P($G(^PS(50.7,+PSJORD,0)),"^",6)  I PM,$D(^PS(51.2,PM,0)),$P($G(^(0)),"^",4)=1 S ^TMP("PSJMR",$J,MCT)=$P(^PS(51.2,PM,0),"^")_U_$P(^(0),"^",3)_U_PM_U_$P(^(0),"^",2)_U_$S($P(^(0),"^",6):1,1:0),MCT=MCT+1
"RTN","PSSJORDF",48,0)
 S MR=0 F  S MR=$O(^PS(50.606,PSJDFNO,"MR",MR)) Q:'MR  D
"RTN","PSSJORDF",49,0)
 . S X=+$G(^PS(50.606,PSJDFNO,"MR",MR,0)) Q:'X!($P($G(^TMP("PSJMR",$J,1)),"^",3)=X)
"RTN","PSSJORDF",50,0)
 . S MRNODE=$G(^PS(51.2,X,0))
"RTN","PSSJORDF",51,0)
 . I $P($G(MRNODE),"^",4)'=1 Q
"RTN","PSSJORDF",52,0)
 . S ^TMP("PSJMR",$J,MCT)=$P(MRNODE,U)_U_$P(MRNODE,U,3)_U_X_U_$P(MRNODE,U,2)_U_$S($P(MRNODE,U,6):1,1:0),MCT=MCT+1
"RTN","PSSJORDF",53,0)
 S X=0
"RTN","PSSJORDF",54,0)
 I $D(^PS(50.606,PSJDFNO,"NOUN")) F Z=0:0 S Z=$O(^PS(50.606,PSJDFNO,"NOUN",Z)) Q:'Z  S X=X+1,^TMP("PSJNOUN",$J,X)=$P($G(^PS(50.606,PSJDFNO,"NOUN",Z,0)),U)_U_$P($G(^PS(50.606,PSJDFNO,"MISC")),U)_U_$P($G(^("MISC")),U,3)
"RTN","PSSJORDF",55,0)
 Q
"RTN","PSSJORDF",56,0)
 ;
"RTN","PSSJORDF",57,0)
MEDROUTE ;* Return all med routes in the med routes file.
"RTN","PSSJORDF",58,0)
 S (MR,MCT)=0 K ^TMP("PSJMR",$J)
"RTN","PSSJORDF",59,0)
 F  S MR=$O(^PS(51.2,MR)) Q:'MR  S MRNODE=^PS(51.2,MR,0) I $P(^PS(51.2,MR,0),"^",4)=1 S MCT=MCT+1,^TMP("PSJMR",$J,MCT)=$P(MRNODE,U)_U_$P(MRNODE,U,3)_U_MR_U_$P(MRNODE,U,2)_U_$S($P(MRNODE,U,6):1,1:0)
"RTN","PSSJORDF",60,0)
 Q
"RTN","PSSJORDF",61,0)
NOD K ^TMP("PSJMR",$J)
"RTN","PSSJORDF",62,0)
 S MR=+$P($G(^PS(50.7,+PSJORD,0)),"^",6) I MR,$D(^PS(51.2,MR,0)),$P(^PS(51.2,MR,0),"^",4)=1 S ^TMP("PSJMR",$J,1)=$P(^PS(51.2,MR,0),"^")_U_$P(^(0),"^",3)_U_MR_U_$P(^(0),"^",2)_U_$S($P(^(0),"^",6):1,1:0)_"^D"
"RTN","PSSJORDF",63,0)
 Q
"RTN","PSSJORDF",64,0)
START1(PSJORD,PSJQOF) ;Entry point for IV dialog PSS*1*94
"RTN","PSSJORDF",65,0)
 ; This is the new entry point for the IV Dialog box from CPRS GUI 27.  PSJORD will be an array
"RTN","PSSJORDF",66,0)
 ; sent by CPRS that contains all the IENS for all orderable items that are part of the order.  The zero node of the array
"RTN","PSSJORDF",67,0)
 ; will contain the total number of orderable items in the order.
"RTN","PSSJORDF",68,0)
 ; 
"RTN","PSSJORDF",69,0)
 ; PSJQOF is the quick order flag.  0=not a quick order 1=quick order
"RTN","PSSJORDF",70,0)
 ; 
"RTN","PSSJORDF",71,0)
 ; If there is only one orderable item, any default defined in the Pharmacy Orderable Item file (50.7) will be
"RTN","PSSJORDF",72,0)
 ; marked with a D at the end of the data string.
"RTN","PSSJORDF",73,0)
 ; 
"RTN","PSSJORDF",74,0)
 ; PSS*1*142
"RTN","PSSJORDF",75,0)
 ; If there is more than one orderable item in the order,
"RTN","PSSJORDF",76,0)
 ; and if all orderable items share the same default med route, the med route will be denoted
"RTN","PSSJORDF",77,0)
 ; with a "D" at the end of the data string, and a union (the overlapping)
"RTN","PSSJORDF",78,0)
 ; of the med routes will be returned.  For example if Dextrose can be given IV or IM, and the Ampicillin is only
"RTN","PSSJORDF",79,0)
 ; given IM, IM is the only med route that will be returned because it is the only overlapping med route between
"RTN","PSSJORDF",80,0)
 ; the two orderable items.  If there is no overlapping med route to be returned, then a NULL will be returned to CPRS.
"RTN","PSSJORDF",81,0)
 ; 
"RTN","PSSJORDF",82,0)
 ; If the quick order flag PSJQOF is set to 1, then CPRS is expecting the overlapping med routes for the orderable items
"RTN","PSSJORDF",83,0)
 ; as well as the entire list of med routes that are flagged for IV's.
"RTN","PSSJORDF",84,0)
 ; 
"RTN","PSSJORDF",85,0)
 I PSJQOF="" S PSJQOF=0
"RTN","PSSJORDF",86,0)
 K PSJORD1,^TMP("PSJMR",$J)
"RTN","PSSJORDF",87,0)
 I $G(PSJORD(0))=1 S PSJOPAC="I" D  Q
"RTN","PSSJORDF",88,0)
 . S PSJORD=$P($G(PSJORD(1)),"^",1)
"RTN","PSSJORDF",89,0)
 . D MEDRT(PSJORD)
"RTN","PSSJORDF",90,0)
 . I PSJQOF=1 S MCT=$O(^TMP("PSJMR",$J,"A"),-1) D ALLMED(MCT)
"RTN","PSSJORDF",91,0)
 . M PSJORD1=^TMP("PSJMR",$J)
"RTN","PSSJORDF",92,0)
 . D REMDUP
"RTN","PSSJORDF",93,0)
 . K PSJORD
"RTN","PSSJORDF",94,0)
 . M PSJORD=PSJORD1
"RTN","PSSJORDF",95,0)
 . K PSJORD1,^TMP("PSJMR",$J)
"RTN","PSSJORDF",96,0)
 S X=0
"RTN","PSSJORDF",97,0)
 F  S X=$O(PSJORD(X)) Q:X=""  D
"RTN","PSSJORDF",98,0)
 . S PSJORD=$P($G(PSJORD(X)),"^",1)
"RTN","PSSJORDF",99,0)
 . D MEDRT(PSJORD)
"RTN","PSSJORDF",100,0)
 . M PSJORD1(X)=^TMP("PSJMR",$J) K ^TMP("PSJMR",$J)  ;Start with fresh TMP for each OI
"RTN","PSSJORDF",101,0)
 D OVERLAP
"RTN","PSSJORDF",102,0)
 I PSJQOF=1 S MCT=$O(MRTEMP2("A"),-1) D ALLMED(MCT)
"RTN","PSSJORDF",103,0)
 M PSJORD1=^TMP("PSJMR",$J)
"RTN","PSSJORDF",104,0)
 D REMDUP
"RTN","PSSJORDF",105,0)
 D MULTIDEF(.PSJORD,.PSJORD1)  ;Multiple orderable items in order - do they share same default med route?
"RTN","PSSJORDF",106,0)
 K PSJORD
"RTN","PSSJORDF",107,0)
 M PSJORD=PSJORD1
"RTN","PSSJORDF",108,0)
 K PSJORD1,MRTEMP2,MRTEMP,MRNODE,MRNODE1,^TMP("PSJMR",$J),PSSCNTR1,PSJOPAC,ZZX,SAMEDEF,DEFAULT
"RTN","PSSJORDF",109,0)
 Q
"RTN","PSSJORDF",110,0)
MEDRT(PSJORD) ;All Med Routes for dosage form.
"RTN","PSSJORDF",111,0)
 N MR,X,PSJDFNO,MCT,PM,II
"RTN","PSSJORDF",112,0)
 S (MR,MCT,X,PSJDFNO)=0,MCT=1
"RTN","PSSJORDF",113,0)
 S PSJDFNO=+$P($G(^PS(50.7,+PSJORD,0)),U,2)
"RTN","PSSJORDF",114,0)
 S MR=+$P($G(^PS(50.7,+PSJORD,0)),"^",6) I MR,$D(^PS(51.2,MR,0)),$P($G(^(0)),"^",4)=1 S ^TMP("PSJMR",$J,1)=MR_U_$P(^PS(51.2,MR,0),"^")_U_$P(^(0),"^",3)_U_$P(^(0),"^",2)_U_"D",MCT=MCT+1
"RTN","PSSJORDF",115,0)
 ; Populate possible med routes
"RTN","PSSJORDF",116,0)
 I $P($G(^PS(50.7,+PSJORD,0)),"^",13)'="Y" D  S:$O(^TMP("PSJMR",$J,""),-1)=1 $P(^TMP("PSJMR",$J,1),U,5)="D" Q
"RTN","PSSJORDF",117,0)
 . S II=0 F  S II=$O(^PS(50.7,+PSJORD,3,II)) Q:'II  S PM=$G(^(II,0)) D
"RTN","PSSJORDF",118,0)
 . . Q:PM=+$P($G(^PS(50.7,+PSJORD,0)),"^",6)  I PM,$D(^PS(51.2,PM,0)),$P($G(^(0)),"^",4)=1 S ^TMP("PSJMR",$J,MCT)=PM_U_$P(^PS(51.2,PM,0),"^")_U_$P(^(0),"^",3)_U_$P(^(0),"^",2)_U,MCT=MCT+1
"RTN","PSSJORDF",119,0)
 S MR=0 F  S MR=$O(^PS(50.606,PSJDFNO,"MR",MR)) Q:'MR  D
"RTN","PSSJORDF",120,0)
 . S X=+$G(^PS(50.606,PSJDFNO,"MR",MR,0))
"RTN","PSSJORDF",121,0)
 . I X=$P($G(^PS(50.7,+PSJORD,0)),"^",6) Q  ;Already counted as the default.  Don't count twice.
"RTN","PSSJORDF",122,0)
 . S MRNODE=$G(^PS(51.2,X,0))
"RTN","PSSJORDF",123,0)
 . I $P($G(MRNODE),"^",4)'=1 Q
"RTN","PSSJORDF",124,0)
 . S ^TMP("PSJMR",$J,MCT)=X_U_$P(MRNODE,U)_U_$P(MRNODE,U,3)_U_$P(MRNODE,U,2)_U,MCT=MCT+1
"RTN","PSSJORDF",125,0)
 Q
"RTN","PSSJORDF",126,0)
ALLMED(MCT) ;Return all med routes with IV flag set to 1
"RTN","PSSJORDF",127,0)
 N MR,MRNODE
"RTN","PSSJORDF",128,0)
 I MCT="" S MCT=0
"RTN","PSSJORDF",129,0)
 S (MR,MRNODE)=""
"RTN","PSSJORDF",130,0)
 F  S MR=$O(^PS(51.2,MR)) Q:MR=""  D
"RTN","PSSJORDF",131,0)
 . S MRNODE=$G(^PS(51.2,MR,0))
"RTN","PSSJORDF",132,0)
 . I $P(MRNODE,U,4)'=1 Q  ;Not defined for all packages
"RTN","PSSJORDF",133,0)
 . I $P(MRNODE,U,6)'=1 Q  ;IV flag not set
"RTN","PSSJORDF",134,0)
 . S MCT=MCT+1,^TMP("PSJMR",$J,MCT)=MR_U_$P(MRNODE,U)_U_$P(MRNODE,U,3)_U_$P(MRNODE,U,2)_U
"RTN","PSSJORDF",135,0)
 Q
"RTN","PSSJORDF",136,0)
OVERLAP ; Only maintains any overlapping med routes between orderable items in order
"RTN","PSSJORDF",137,0)
 N MR,MRNODE,X,PSSCNTR1
"RTN","PSSJORDF",138,0)
 K MRTEMP,MRTEMP2
"RTN","PSSJORDF",139,0)
 S (MR,MRNODE,X)=""
"RTN","PSSJORDF",140,0)
 F  S X=$O(PSJORD1(X)) Q:X=""  D
"RTN","PSSJORDF",141,0)
 . F  S MR=$O(PSJORD1(X,MR)) Q:MR=""  D
"RTN","PSSJORDF",142,0)
 . . S MRNODE=$P($G(PSJORD1(X,MR)),"^",1)
"RTN","PSSJORDF",143,0)
 . . S MRTEMP(MRNODE)=$G(MRTEMP(MRNODE))+1
"RTN","PSSJORDF",144,0)
 S MR=""
"RTN","PSSJORDF",145,0)
 F  S MR=$O(MRTEMP(MR)) Q:MR=""  D
"RTN","PSSJORDF",146,0)
 . I MRTEMP(MR)'=$G(PSJORD(0)) K MRTEMP(MR) Q
"RTN","PSSJORDF",147,0)
 I '$D(MRTEMP) K PSJORD1 S PSJORD1="" Q  ;No overlapping med routes between orderable items.
"RTN","PSSJORDF",148,0)
 S (MR,MRNODE)="",PSSCNTR1=1
"RTN","PSSJORDF",149,0)
 F  S MR=$O(MRTEMP(MR)) Q:MR=""  D
"RTN","PSSJORDF",150,0)
 . S MRNODE=$G(^PS(51.2,MR,0))
"RTN","PSSJORDF",151,0)
 . S MRTEMP2(PSSCNTR1)=MR_U_$P(MRNODE,U,1)_U_$P(MRNODE,U,3)_U_$P(MRNODE,U,2)_U,PSSCNTR1=PSSCNTR1+1
"RTN","PSSJORDF",152,0)
 K PSJORD1,MRTEMP
"RTN","PSSJORDF",153,0)
 M PSJORD1=MRTEMP2
"RTN","PSSJORDF",154,0)
 Q
"RTN","PSSJORDF",155,0)
REMDUP ; Remove duplicate entries
"RTN","PSSJORDF",156,0)
 N MR,MRNODE
"RTN","PSSJORDF",157,0)
 S MR="",MRNODE=""
"RTN","PSSJORDF",158,0)
 F  S MR=$O(PSJORD1(MR)) Q:MR=""  D
"RTN","PSSJORDF",159,0)
 . S MRNODE=$P($G(PSJORD1(MR)),"^",2)
"RTN","PSSJORDF",160,0)
 . I $D(MRTEMP(MRNODE)) K PSJORD1(MR) Q
"RTN","PSSJORDF",161,0)
 . S MRTEMP(MRNODE)=$G(PSJORD1(MR))
"RTN","PSSJORDF",162,0)
 . I MR=1,$P($G(PSJORD1(MR)),"^",5)="D" S MRTEMP(MR)=PSJORD1(MR) Q  ;Maintain default if there is one.
"RTN","PSSJORDF",163,0)
 . S MRTEMP(MR)=PSJORD1(MR)
"RTN","PSSJORDF",164,0)
 S MR=""
"RTN","PSSJORDF",165,0)
 F  S MR=$O(MRTEMP(MR)) Q:MR=""  D
"RTN","PSSJORDF",166,0)
 . I MR'?1.N K MRTEMP(MR)
"RTN","PSSJORDF",167,0)
 I PSJORD(0)=1 M PSJORD1=MRTEMP
"RTN","PSSJORDF",168,0)
 K MRTEMP
"RTN","PSSJORDF",169,0)
 Q
"RTN","PSSJORDF",170,0)
MULTIDEF(PSJORD,PSJORD1) ; PSS*1*142
"RTN","PSSJORDF",171,0)
 ;Loop through the orderable items for the order.  Determine what (if any) default
"RTN","PSSJORDF",172,0)
 ;med route is for each orderable item.  Save this in the DEFAULT local array.
"RTN","PSSJORDF",173,0)
 ;Then compare the DEFAULT array entries with each other.  If any one of the subsequent
"RTN","PSSJORDF",174,0)
 ;entries does not match the first one, that means the orderable items do not all share
"RTN","PSSJORDF",175,0)
 ;the same default, and no med route will be marked as the default when the information
"RTN","PSSJORDF",176,0)
 ;is returned to CPRS.  If all of the orderable items share the same default, find that
"RTN","PSSJORDF",177,0)
 ;entry in the array of orderable items, and mark it as the default with a "D".
"RTN","PSSJORDF",178,0)
 S ZZX=0,DEFAULT=""
"RTN","PSSJORDF",179,0)
 F  S ZZX=$O(PSJORD(ZZX)) Q:ZZX=""  D
"RTN","PSSJORDF",180,0)
 . S DEFAULT=$G(PSJORD(ZZX))
"RTN","PSSJORDF",181,0)
 . S DEFAULT(ZZX)=$P($G(^PS(50.7,DEFAULT,0)),"^",6)
"RTN","PSSJORDF",182,0)
 S ZZX="",SAMEDEF=0
"RTN","PSSJORDF",183,0)
 F  S ZZX=$O(DEFAULT(ZZX)) Q:ZZX=""  D  Q:SAMEDEF=0
"RTN","PSSJORDF",184,0)
 . I DEFAULT(ZZX)'=$G(DEFAULT(1)) S SAMEDEF=0 Q
"RTN","PSSJORDF",185,0)
 . S SAMEDEF=1_"^"_$G(DEFAULT(1))
"RTN","PSSJORDF",186,0)
 Q:SAMEDEF=0
"RTN","PSSJORDF",187,0)
 I $P($G(SAMEDEF),"^")=1,$P($G(SAMEDEF),"^",2)="" Q  ;No orderable item has a valid default - default is ""
"RTN","PSSJORDF",188,0)
 S ZZX=""
"RTN","PSSJORDF",189,0)
 F  S ZZX=$O(PSJORD1(ZZX)) Q:ZZX=""  D
"RTN","PSSJORDF",190,0)
 . I $P($G(PSJORD1(ZZX)),"^",1)=$P($G(SAMEDEF),"^",2) S PSJORD1(ZZX)=PSJORD1(ZZX)_"D"
"RTN","PSSJORDF",191,0)
 Q
"RTN","PSSP159")
0^^B8242782^n/a
"RTN","PSSP159",1,0)
PSSP159 ;BIRM/SJA-Pharmacy system site parameters ;09/24/10
"RTN","PSSP159",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**159**;9/30/97;Build 29
"RTN","PSSP159",3,0)
 ;
"RTN","PSSP159",4,0)
 Q
"RTN","PSSP159",5,0)
POST ; delete data of the DEFAULT MED ROUTE FOR CPRS field (#80.7)
"RTN","PSSP159",6,0)
 K DIE,DA,DR S DIE=59.7,DR="80.7///@",DA=1 D ^DIE K DA,DIE,DR
"RTN","PSSP159",7,0)
 ;
"RTN","PSSP159",8,0)
 ; delete DD for the DEFAULT MED ROUTE FOR CPRS field (#80.7)
"RTN","PSSP159",9,0)
 S DIK="^DD(59.7,",DA=80.7,DA(1)=59.7 D ^DIK K DA,DIK
"RTN","PSSP159",10,0)
 ;
"RTN","PSSP159",11,0)
 ; if no default med route, no possible med routes and the USE DOSAGE FORM MED ROUTE LIST field is set to NO
"RTN","PSSP159",12,0)
 ; change the field to "YES" and generate mailman message.
"RTN","PSSP159",13,0)
 S MCT=1,PSSIEN=0 F  S PSSIEN=$O(^PS(50.7,PSSIEN)) Q:'PSSIEN  I $D(^(PSSIEN,0)) S PSSNODE0=$G(^PS(50.7,PSSIEN,0)) D
"RTN","PSSP159",14,0)
 .I $P(PSSNODE0,"^",13)="N",'$P($G(^PS(50.7,PSSIEN,0)),"^",6)&('$O(^PS(50.7,PSSIEN,3,0))) D
"RTN","PSSP159",15,0)
 ..S $P(^PS(50.7,PSSIEN,0),"^",13)="Y",^TMP($J,"PSSP159",MCT)=$J(PSSIEN,10)_"     "_$E($P(PSSNODE0,"^"),1,20),MCT=MCT+1
"RTN","PSSP159",16,0)
MAIL ; create mail message
"RTN","PSSP159",17,0)
 D BMES^XPDUTL(" Generating Mail Message....")
"RTN","PSSP159",18,0)
 N XMDUZ,XMSUB,XMTEXT,XMY,DIFROM
"RTN","PSSP159",19,0)
 S XMDUZ="Patch PSS*1*159 Post Install"
"RTN","PSSP159",20,0)
 F PSSFDS=0:0 S PSSFDS=$O(@XPDGREF@("PSSARX",PSSFDS)) Q:'PSSFDS  S XMY(PSSFDS)=""
"RTN","PSSP159",21,0)
 S XMSUB="Pharmacy Orderable Item Updates",XMTEXT="PSSTMP("
"RTN","PSSP159",22,0)
 S PSSTMP(1)="Pharmacy Orderable Item Auto-change:",PSSTMP(2)=""
"RTN","PSSP159",23,0)
 S PSSTMP(3)="The USE DOSAGE FORM MED ROUTE LIST field of the following Orderable Items"
"RTN","PSSP159",24,0)
 S PSSTMP(4)="has been changed from NO to YES because these Orderable Items did not have the"
"RTN","PSSP159",25,0)
 S PSSTMP(5)="DEFAULT MED ROUTE and/or any POSSIBLE MED ROUTES populated. The medication"
"RTN","PSSP159",26,0)
 S PSSTMP(6)="routes associated with the Dosage Form for these Orderable Items will be "
"RTN","PSSP159",27,0)
 S PSSTMP(7)="displayed for selection in CPRS, as they were prior to this patch."
"RTN","PSSP159",28,0)
 S PSSTMP(8)=""
"RTN","PSSP159",29,0)
 S PSSTMP(9)="If you wish to make adjustments to the Medication Routes that display in CPRS "
"RTN","PSSP159",30,0)
 S PSSTMP(10)="for these Orderable Items, use the Edit Orderable Items [PSS EDIT ORDERABLE "
"RTN","PSSP159",31,0)
 S PSSTMP(11)="ITEMS] option."
"RTN","PSSP159",32,0)
 S PSSTMP(12)=""
"RTN","PSSP159",33,0)
 S PSSTMP(13)="",PSSTMP(14)="OI Number      OI NAME",PSSTMP(15)="==========     ===================="
"RTN","PSSP159",34,0)
 S CNT=15,X=0 F  S X=$O(^TMP($J,"PSSP159",X)) Q:'X  S CNT=CNT+1,PSSTMP(CNT)=$G(^(X))
"RTN","PSSP159",35,0)
 I '$O(^TMP($J,"PSSP159",0)) S CNT=16,PSSTMP(16)="               None Found"
"RTN","PSSP159",36,0)
 D ^XMD K PSSTMP,^TMP($J,"PSSP159")
"RTN","PSSP159",37,0)
 D BMES^XPDUTL(" Mail message sent.")
"RTN","PSSP159",38,0)
 Q
"RTN","PSSPOIM1")
0^4^B57105824^B56773373
"RTN","PSSPOIM1",1,0)
PSSPOIM1 ;BIR/RTR,WRT-Manual create of Orderable Item continued ; 4/28/09 4:36pm
"RTN","PSSPOIM1",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**29,38,47,141,153,159**;9/30/97;Build 29
"RTN","PSSPOIM1",3,0)
 ;
"RTN","PSSPOIM1",4,0)
CHK S PSNO=0 I $G(PSMAN) W !!,"Matching ",PSNAME,!,"   to",!,SPHOLD," ",$P($G(^PS(50.606,+DOSEPTR,0)),"^"),!
"RTN","PSSPOIM1",5,0)
 I '$G(PSMAN) S PSMC=$P($G(^PS(50.7,PSSP,0)),"^") W !!,"Matching ",PSNAME,!,"   to",!,PSMC," ",$P($G(^PS(50.606,+$P(^PS(50.7,PSSP,0),"^",2),0)),"^"),!
"RTN","PSSPOIM1",6,0)
 K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK" D ^DIR
"RTN","PSSPOIM1",7,0)
 K PSMAN S:Y=0 PSNO=1 I Y'=1,'PSNO S PSOUT=1
"RTN","PSSPOIM1",8,0)
 Q
"RTN","PSSPOIM1",9,0)
END K ^TMP($J,"PSSOO"),PSSSSS,PSCREATE,^TMP("PSSLOOP",$J)
"RTN","PSSPOIM1",10,0)
 K AAA,ANS,APLU,COMM,DA,DIC,DIE,DOSEFORM,DOSEFV,DOSEPTR,DR,FFF,MATCH,NEWSP,NODE,NOFLAG,OTH,POINT,PSCNT,PSIEN,PSMAN,PSMC,PSNAME,PSNO,PSSP,PSND,PSOUT,SPHOLD,SPR,TMPTR,TT,VAGEN,X,Y,ZZ,PSOOOUT,PSXDATE,PSXADATE,PSXSDATE,AAAAA,BBBBB,ZXX,PSXDDATE Q
"RTN","PSSPOIM1",11,0)
MESS W !!,"This option enables you to match Dispense Drugs to an entry in the Pharmacy",!,"Orderable Item file, or create a new Pharmacy Orderable Item entry for a",!,"Dispense Drug.",! Q
"RTN","PSSPOIM1",12,0)
MESSZ S ^TMP("PSSLOOP",$J,DUZ)="" W !!,"This option is for matching IV Additives, IV Solutions, and all Dispense Drugs",!,"marked with an I, O, or U in the Application Packages' Use field to an",!,"Orderable Item."
"RTN","PSSPOIM1",13,0)
 W !,"You will need to keep accessing this option until all drugs are matched.",!,"A check will be done every time this option is exited to see if the matching",!,"process is complete.",!!
"RTN","PSSPOIM1",14,0)
 K DIR S DIR(0)="E" D ^DIR K DIR I X["^"!($D(DTOUT)) S PSOUT=1
"RTN","PSSPOIM1",15,0)
 Q
"RTN","PSSPOIM1",16,0)
CHECK W !!!,"Checking Drug files, please wait..."
"RTN","PSSPOIM1",17,0)
 S X1=DT,X2=-365 D C^%DTC S PSZXDATE=X,DONEFLAG=1
"RTN","PSSPOIM1",18,0)
 F FFFF=0:0 S FFFF=$O(^PSDRUG(FFFF)) Q:'FFFF!('DONEFLAG)  S QQNM=$P($G(^PSDRUG(FFFF,0)),"^") I QQNM'="",$D(^PSDRUG("B",QQNM)) D  I ZZG I USAGE["O"!(USAGE["I")!(USAGE["U") I '$P($G(^PSDRUG(FFFF,2)),"^") S DONEFLAG=0
"RTN","PSSPOIM1",19,0)
 .S USAGE=$P($G(^PSDRUG(FFFF,2)),"^",3)
"RTN","PSSPOIM1",20,0)
 .S ZZG=1 S PSZZDATE=+$P($G(^PSDRUG(FFFF,"I")),"^") I PSZZDATE,PSZZDATE<PSZXDATE S ZZG=0
"RTN","PSSPOIM1",21,0)
 I DONEFLAG=1 D
"RTN","PSSPOIM1",22,0)
 .F QQQ=0:0 S QQQ=$O(^PS(52.6,QQQ)) Q:'QQQ!('DONEFLAG)  S PSZNAME=$P($G(^PS(52.6,QQQ,0)),"^") I PSZNAME'="",$D(^PS(52.6,"B",PSZNAME)),$P($G(^PS(52.6,QQQ,0)),"^",2),'$P($G(^(0)),"^",11) D  I ZZG S DONEFLAG=0
"RTN","PSSPOIM1",23,0)
 ..S ZZG=1 S PSZZDATE=+$P($G(^PS(52.6,QQQ,"I")),"^") I PSZZDATE,PSZZDATE<PSZXDATE S ZZG=0
"RTN","PSSPOIM1",24,0)
 .I DONEFLAG F QQQ=0:0 S QQQ=$O(^PS(52.7,QQQ)) Q:'QQQ!('DONEFLAG)  S PSZNAME=$P($G(^PS(52.7,QQQ,0)),"^") I PSZNAME'="",$D(^PS(52.7,"B",PSZNAME)),$P($G(^PS(52.7,QQQ,0)),"^",2),'$P($G(^(0)),"^",11) D  I ZZG S DONEFLAG=0
"RTN","PSSPOIM1",25,0)
 ..S ZZG=1 S PSZZDATE=+$P($G(^PS(52.7,QQQ,"I")),"^") I PSZZDATE,PSZZDATE<PSZXDATE S ZZG=0
"RTN","PSSPOIM1",26,0)
MAIL I DONEFLAG W !!!,?3,"You are finished matching to the Orderable Item File!",!!,"A clean-up job is being queued now, and when it is finished, you will"
"RTN","PSSPOIM1",27,0)
 I  W !,"receive a mail message informing you of its completion.",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSPOIM1",28,0)
 I $G(DONEFLAG) S PSSOMAIL=1,PSOUDUZ=DUZ S ZTRTN="DATE^PSSPOIM1",ZTIO="",ZTDTH=$H,ZTDESC="ORDERABLE ITEM CLEAN UP",ZTSAVE("DUZ")="",ZTSAVE("PSSOMAIL")="" D ^%ZTLOAD
"RTN","PSSPOIM1",29,0)
 I 'DONEFLAG W $C(7),$C(7),!!?5,"There are still Drugs not matched, you will need to come back",!?5,"and continue matching Drugs!",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSPOIM1",30,0)
 K DONEFLAG,QQQ,QQNM,PSZZDATE,PSZXDATE,ZZG,USAGE,FFFF,PSZNAME Q
"RTN","PSSPOIM1",31,0)
OTHER W @IOF W !,"There are other Dispense Drugs with the same VA Generic Name and same Dose",!,"Form already matched to orderable items. Choose a number to match, or enter",!,"'^' to enter a new one.",!!?6,"Disp. drug -> ",PSNAME,! Q
"RTN","PSSPOIM1",32,0)
EN(PSVAR) ;
"RTN","PSSPOIM1",33,0)
 W !?3,"Now editing Orderable Item:",!?3,$P(^PS(50.7,PSVAR,0),"^"),"   ",$P($G(^PS(50.606,+$P(^(0),"^",2),0)),"^")
"RTN","PSSPOIM1",34,0)
 W ! K DIE N MFLG S PSBEFORE=$P(^PS(50.7,PSVAR,0),"^",4),PSBEFORE1=+$P(^PS(50.7,PSVAR,0),"^",2),PSAFTER=0,PSINORDE=""
"RTN","PSSPOIM1",35,0)
 S PSSOTH=$P($G(^PS(59.7,1,40.2)),"^"),DIE="^PS(50.7,",DIE("NO^")="BACK"
"RTN","PSSPOIM1",36,0)
 S DR="5;6;.04;.05;@3;.06;D DFR^PSSPOIMO(PSBEFORE1),DFRL^PSSPOIMO;10//YES;I X=""Y"" S Y=""@2"";D PDCHK^PSSPOIMO;I $$DP^PSSPOIMO(PSVAR) S Y=""@3"";@2;.07;.08;7;S:'$G(PSSOTH) Y=""@1"";7.1;@1",DA=PSVAR
"RTN","PSSPOIM1",37,0)
 D ^DIE S PSAFTER=$P(^PS(50.7,PSVAR,0),"^",4) K DIE,PSSOTH
"RTN","PSSPOIM1",38,0)
 S:PSBEFORE&('PSAFTER) PSINORDE="D" S:PSAFTER PSINORDE="I"
"RTN","PSSPOIM1",39,0)
 I PSINORDE'="" D REST^PSSPOIDT(PSVAR)
"RTN","PSSPOIM1",40,0)
 K PSBEFORE,PSBEFORE1,PSAFTER,PSINORDE
"RTN","PSSPOIM1",41,0)
IMMUN ;PSS*1*141 FOR 'IMMUNIZATIONS DOCUMENTATION BY BCMA'
"RTN","PSSPOIM1",42,0)
 I $O(^PSDRUG("AOC",PSVAR,"IM000"))'["IM" G SYN ;ASK WHEN APPROPRIATE
"RTN","PSSPOIM1",43,0)
 W ! S DIE="^PS(50.7,",DA=PSVAR,DR=9 D ^DIE K DIE
"RTN","PSSPOIM1",44,0)
SYN W ! K DIC S:'$D(^PS(50.7,PSVAR,2,0)) ^PS(50.7,PSVAR,2,0)="^50.72^0^0" S DIC="^PS(50.7,"_PSVAR_",2,",DA(1)=PSVAR,DIC(0)="QEAMZL",DIC("A")="Select SYNONYM: ",DLAYGO=50.72 D ^DIC K DIC
"RTN","PSSPOIM1",45,0)
 I Y<0!($D(DTOUT))!($D(DUOUT)) K:'$O(^PS(50.7,PSVAR,2,0)) ^PS(50.7,PSVAR,2,0) G FIN
"RTN","PSSPOIM1",46,0)
 W ! S DA=+Y,DIE="^PS(50.7,"_PSVAR_",2,",DA(1)=PSVAR,DR=.01 D ^DIE K DIE G SYN
"RTN","PSSPOIM1",47,0)
FIN D EN^PSSPOIDT(PSVAR) I $G(PSVAR1) D EN2^PSSHL1(PSVAR,"MAD") G FINS
"RTN","PSSPOIM1",48,0)
 D EN2^PSSHL1(PSVAR,"MUP")
"RTN","PSSPOIM1",49,0)
FINS K PSVAR,PSVAR1 Q
"RTN","PSSPOIM1",50,0)
 ;
"RTN","PSSPOIM1",51,0)
DATE ;
"RTN","PSSPOIM1",52,0)
 F ZZZ=0:0 S ZZZ=$O(^PS(50.7,ZZZ)) Q:'ZZZ  S PSOTYPE=$P($G(^PS(50.7,ZZZ,0)),"^",3) D
"RTN","PSSPOIM1",53,0)
 .I PSOTYPE,'$D(^PS(52.6,"AOI",ZZZ)),'$D(^PS(52.7,"AOI",ZZZ)),'$P($G(^PS(50.7,ZZZ,0)),"^",4) K DIE S DIE="^PS(50.7,",DA=ZZZ,DR=".04////"_DT D ^DIE K DIE Q
"RTN","PSSPOIM1",54,0)
 .Q:PSOTYPE
"RTN","PSSPOIM1",55,0)
 .D SUPP
"RTN","PSSPOIM1",56,0)
 .I '$D(^PSDRUG("ASP",ZZZ)),'$P($G(^PS(50.7,ZZZ,0)),"^",4) K DIE S DIE="^PS(50.7,",DA=ZZZ,DR=".04////"_DT D ^DIE K DIE Q
"RTN","PSSPOIM1",57,0)
 .D:'$P($G(^PS(50.7,ZZZ,0)),"^",4)
"RTN","PSSPOIM1",58,0)
 ..S PSDFLAG=0 F WW=0:0 S WW=$O(^PSDRUG("ASP",ZZZ,WW)) Q:'WW!(PSDFLAG)  S PSAPPL=$P($G(^PSDRUG(WW,2)),"^",3) I PSAPPL["I"!(PSAPPL["O")!(PSAPPL["U") S PSDFLAG=1
"RTN","PSSPOIM1",59,0)
 ..I 'PSDFLAG K DIE S DIE="^PS(50.7,",DA=ZZZ,DR=".04////"_DT D ^DIE K DIE
"RTN","PSSPOIM1",60,0)
 F ZZZ=0:0 S ZZZ=$O(^PS(52.7,ZZZ)) Q:'ZZZ  S RRRR=$P($G(^PS(52.7,ZZZ,0)),"^",11) I RRRR,'$P($G(^PS(50.7,RRRR,0)),"^",3) K DIE S DA=ZZZ,DIE="^PS(52.7,",DR="9////"_"@" D ^DIE K DIE
"RTN","PSSPOIM1",61,0)
 F ZZZ=0:0 S ZZZ=$O(^PS(52.6,ZZZ)) Q:'ZZZ  S RRRR=$P($G(^PS(52.6,ZZZ,0)),"^",11) I RRRR,'$P($G(^PS(50.7,RRRR,0)),"^",3) K DIE S DA=ZZZ,DIE="^PS(52.6,",DR="15////"_"@" D ^DIE K DIE
"RTN","PSSPOIM1",62,0)
 D:$G(PSCREATE) MAIL^PSSCREAT
"RTN","PSSPOIM1",63,0)
 I '$G(PSSOMAIL) K PSOTYPE,DA,DIE,WW,RRRR,PSDFLAG,PSAPPL,GGG,HHH,ZZZZZ Q
"RTN","PSSPOIM1",64,0)
 S PSOTEXT(1)="You have completed the matching process required for the installation of",PSOTEXT(2)="Outpatient V. 7.0 and Inpatient Medications V. 5.0!"
"RTN","PSSPOIM1",65,0)
 S XMDUZ=.5,XMY(DUZ)="",XMTEXT="PSOTEXT(",XMSUB="Pharmacy Orderable Item File" D ^XMD
"RTN","PSSPOIM1",66,0)
 S PSSITE=+$O(^PS(59.7,0)) S $P(^PS(59.7,PSSITE,80),"^",2)=3 K PSSITE
"RTN","PSSPOIM1",67,0)
 D ^%ZISC K PSOTYPE,DA,DIE,WW,RRRR,PSDFLAG,PSAPPL,GGG,HHH,ZZZZZ,PSSOMAIL S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSSPOIM1",68,0)
RMES W !!,"This report takes a long time to first build the data to print, then to",!,"actually print the data. To avoid tying up a terminal for a long period of time,",!,"the report must be QUEUED to a printer."
"RTN","PSSPOIM1",69,0)
 W !!,"This report must be QUEUED to a printer!"
"RTN","PSSPOIM1",70,0)
 Q
"RTN","PSSPOIM1",71,0)
KMES W !!,"Due to the length of this report, and to avoid tying up a terminal for a long",!,"time, this report must be QUEUED to a printer!"
"RTN","PSSPOIM1",72,0)
 Q
"RTN","PSSPOIM1",73,0)
SUPP ;Mark as supply
"RTN","PSSPOIM1",74,0)
 N SSSUP,SSSIN,SSSAP,SSLOOP,SSSQUE,SSSQUEY,SSSQDATE,SLIP,SLDO,SLDP
"RTN","PSSPOIM1",75,0)
 S (SSSQUE,SSSQUEY)=0 F SSLOOP=0:0 S SSLOOP=$O(^PSDRUG("ASP",ZZZ,SSLOOP)) Q:'SSLOOP!(SSSQUEY)  D
"RTN","PSSPOIM1",76,0)
 .I $P($G(^PSDRUG(SSLOOP,0)),"^",3)["S" S SSSAP=$P($G(^(2)),"^",3),SSSIN=$P($G(^("I")),"^") D
"RTN","PSSPOIM1",77,0)
 ..I SSSAP["O"!(SSSAP["I")!(SSSAP["U") I 'SSSIN S $P(^PS(50.7,ZZZ,0),"^",9)=1 S (SSSQUEY,SSSQUE)=1 Q
"RTN","PSSPOIM1",78,0)
 ..I SSSAP["O"!(SSSAP["I")!(SSSAP["U") I +SSSIN>DT S $P(^PS(50.7,ZZZ,0),"^",9)=1 S SSSQUE=1,SSSQDATE($E(SSSIN,1,7))=""
"RTN","PSSPOIM1",79,0)
 I 'SSSQUEY,SSSQUE,$O(SSSQDATE(0)) F SLIP=0:0 S SLIP=$O(SSSQDATE(SLIP)) Q:'SLIP  D
"RTN","PSSPOIM1",80,0)
 .S ZTRTN="ENT^PSSPOIDT",ZTDESC="Supply update for Orderable Item",ZTIO="",ZTDTH=SLIP_.01 S SLDO=$G(PSSORDIT),SLDP=$G(PSSCROSS) S PSSORDIT=ZZZ,PSSCROSS=1 S ZTSAVE("PSSORDIT")="",ZTSAVE("PSSCROSS")="" D ^%ZTLOAD D
"RTN","PSSPOIM1",81,0)
 ..S PSSORDIT=$G(SLDO) K:'PSSORDIT PSSORDIT
"RTN","PSSPOIM1",82,0)
 ..S PSSCROSS=$G(SLDP) K:'PSSCROSS PSSCROSS
"RTN","PSSPOIMO")
0^3^B131205688^B110356198
"RTN","PSSPOIMO",1,0)
PSSPOIMO ;BIR/RTR/WRT-Edit Orderable Item Name and Inactive date ; 4/28/09 4:39pm
"RTN","PSSPOIMO",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**29,32,38,47,68,102,125,141,153,159**;9/30/97;Build 29
"RTN","PSSPOIMO",3,0)
 S PSSITE=+$O(^PS(59.7,0)) I +$P($G(^PS(59.7,PSSITE,80)),"^",2)<2 W !!?3,"Orderable Item Auto-Create has not been completed yet!",! K PSSITE K DIR S DIR("A")="Press RETURN to continue",DIR(0)="E" D ^DIR K DIR Q
"RTN","PSSPOIMO",4,0)
 K PSSITE W !!,"This option enables you to edit Orderable Item names, Formulary status,",!,"drug text, Inactive Dates, and Synonyms."
"RTN","PSSPOIMO",5,0)
EN I $D(PSOIEN) L -^PS(50.7,PSOIEN)
"RTN","PSSPOIMO",6,0)
 K PSSCROSS
"RTN","PSSPOIMO",7,0)
 K DIC ; S PY=$P($G(^PS(59.7,1,31)),"^",2)
"RTN","PSSPOIMO",8,0)
 S PSS1="W ""  ""_$P(^PS(50.606,$P(^PS(50.7,+Y,0),""^"",2),0),""^"")_""  ""_$S($P($G(^PS(50.7,+Y,0)),""^"",4):$E($P(^(0),""^"",4),4,5)_""-""_$E($P(^(0),""^"",4),6,7)_""-""_$E($P(^(0),""^"",4),2,3),1:"""")"
"RTN","PSSPOIMO",9,0)
 S PSS2=" S NF=$P($G(^PS(50.7,+Y,0)),""^"",12) I NF S NF=""   N/F"" W NF"
"RTN","PSSPOIMO",10,0)
 S DIC("W")=PSS1_PSS2,DIC("S")="I '$P($G(^PS(50.7,+Y,0)),""^"",3)"
"RTN","PSSPOIMO",11,0)
 ;PSO*7*102;ONLY SEARCH B AND C X-REFS
"RTN","PSSPOIMO",12,0)
 S $P(PLINE,"-",79)="" W !! K PSOUT S DIC="^PS(50.7,",DIC(0)="QEAMZ",D="B^C" D MIX^DIC1 K DIC,PY,D G:Y<0!($D(DTOUT))!($D(DUOUT)) END
"RTN","PSSPOIMO",13,0)
 S PSOIEN=+Y,PSOINAME=$P(Y,"^",2),PSDOSE=+$P(^PS(50.7,PSOIEN,0),"^",2) L +^PS(50.7,PSOIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSPOIMO",14,0)
 W !!!,?5,"Orderable Item -> ",PSOINAME,!?5,"Dosage Form    -> ",$P($G(^PS(50.606,PSDOSE,0)),"^"),!
"RTN","PSSPOIMO",15,0)
 ;I $P($G(^PS(50.7,PSOIEN,0)),"^",3) W !?3,"*** This Orderable Item is flagged for IV use! ***",!
"RTN","PSSPOIMO",16,0)
 ;G:$P($G(^PS(50.7,PSOIEN,0)),"^",3) ADDIT
"RTN","PSSPOIMO",17,0)
 K DIR S DIR("?")=" ",DIR("?",1)="Enter 'Yes' to see all of the Dispense Drugs, IV Additives, and IV Solutions",DIR("?",2)="that are matched to this Orderable Item. IV Additives will be identified with"
"RTN","PSSPOIMO",18,0)
  S DIR("?",3)="an (A), and IV Solutions with an (S)."
"RTN","PSSPOIMO",19,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="List all Drugs/Additives/Solutions tied to this Orderable Item" D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) G EN
"RTN","PSSPOIMO",20,0)
 I Y D DISP
"RTN","PSSPOIMO",21,0)
EDIT K DIR W ! S DIR(0)="Y",DIR("A")="Are you sure you want to edit this Orderable Item",DIR("B")="NO",DIR("?")="Answer YES to edit the fields associated with this Orderable Item." D ^DIR K DIR I 'Y!($D(DTOUT))!($D(DUOUT)) G EN
"RTN","PSSPOIMO",22,0)
 W !!?3,"Now editing Orderable Item:",!?3,PSOINAME,"   ",$P($G(^PS(50.606,PSDOSE,0)),"^")
"RTN","PSSPOIMO",23,0)
DIR K DIR S DIR(0)="F^3:40",DIR("B")=PSOINAME,DIR("A")="Orderable Item Name" D ^DIR
"RTN","PSSPOIMO",24,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) G EN
"RTN","PSSPOIMO",25,0)
 I X[""""!($A(X)=45)!('(X'?1P.E))!(X?2"z".E) W $C(7),!!?5,"??" G DIR
"RTN","PSSPOIMO",26,0)
 I X'=PSOINAME S ZZFLAG=0 D @$S('$P($G(^PS(50.7,PSOIEN,0)),"^",3):"CHECK",1:"ZCHECK") I ZZFLAG G DIR
"RTN","PSSPOIMO",27,0)
 S PSONEW=X,DIE="^PS(50.7,",DA=PSOIEN,DR=".01////"_X D ^DIE I PSONEW'=PSOINAME W !!,"Name changed from  ",PSOINAME,!?15,"to  ",PSONEW
"RTN","PSSPOIMO",28,0)
 ;I $P($G(^PS(59.7,1,20.4)),"^",16)=1,$P(^PS(50.7,PSOIEN,0),"^",3)=1,$P(^PS(50.7,PSOIEN,0),"^",11)="" D UDMSG K DIE S DIE="^PS(50.7,",DR="3",DA=PSOIEN D ^DIE
"RTN","PSSPOIMO",29,0)
 ;I $P($G(^PS(59.7,1,20.4)),"^",16)=1,$P(^PS(50.7,PSOIEN,0),"^",3)'=1,$P(^PS(50.7,PSOIEN,0),"^",10)="" D IVMSG K DIE S DIE="^PS(50.7,",DR="4",DA=PSOIEN D ^DIE
"RTN","PSSPOIMO",30,0)
 S PSSDTENT=0 W ! K DIE N MFLG S PSBEFORE=$P(^PS(50.7,PSOIEN,0),"^",4),PSAFTER=0,PSINORDE="" D
"RTN","PSSPOIMO",31,0)
 .;If reactivate OI, prompt to reactivate DD's only if there are any, then always give message saying OI now Active. If Inactivate, prompt to inactivate any active DD's if there are any, and give message
"RTN","PSSPOIMO",32,0)
 .;but if OI is reactivated, and there are no activities matched to it, and user does not want to activate the drugs, then inactivate the OI again, and give a clear message explaining this.
"RTN","PSSPOIMO",33,0)
 .W !,"This Orderable Item is "_$S($P($G(^PS(50.7,PSOIEN,0)),"^",12):"Non-Formulary.",1:"Formulary."),!
"RTN","PSSPOIMO",34,0)
 .I $P($G(^PS(50.7,PSOIEN,0)),"^",10) W !,"This Orderable Item is marked as a Non-VA Med.",!
"RTN","PSSPOIMO",35,0)
 .S DIE="^PS(50.7,",DA=PSOIEN,DR=6 S PSCREATE=1 D ^DIE K DIE,PSCREATE I $D(DTOUT)!($D(Y)) Q
"RTN","PSSPOIMO",36,0)
 .;PSS*1*102;ADD DRUG TEXT AS SYNONYM IS REQUESTED BY USER
"RTN","PSSPOIMO",37,0)
 .D ADDSYN^PSSPOIMP
"RTN","PSSPOIMO",38,0)
 .K DIR S DIR(0)="DO",DIR("A")="INACTIVE DATE" D  D ^DIR K DIR I $G(Y)["^"!($D(DTOUT))!($G(DUOUT)) Q
"RTN","PSSPOIMO",39,0)
 ..I $G(PSBEFORE) S Y=PSBEFORE D DD^%DT S DIR("B")=$G(Y)
"RTN","PSSPOIMO",40,0)
 .I $G(PSBEFORE),'$G(Y) W ?40,"Inactive Date deleted!"
"RTN","PSSPOIMO",41,0)
 .S PSSDTENT=$G(Y) I $G(Y) D DD^%DT W ?40,$G(Y)
"RTN","PSSPOIMO",42,0)
 .S PSSOTH=$S($P($G(^PS(59.7,1,40.2)),"^"):1,1:0)
"RTN","PSSPOIMO",43,0)
 .S DIE="^PS(50.7,",DA=PSOIEN,DIE("NO^")="BACK"
"RTN","PSSPOIMO",44,0)
 .S DR=".05;@1;.06;D DFR^PSSPOIMO(PSDOSE),DFRL^PSSPOIMO;10//YES;I X=""Y"" S Y=""@2"";D PDCHK^PSSPOIMO;I $$DP^PSSPOIMO(PSOIEN) S Y=""@1"";@2;.07;.08;7;S:'$G(PSSOTH) Y=""@3"";7.1;@3"
"RTN","PSSPOIMO",45,0)
 .S PSCREATE=1 D ^DIE K DIE,PSCREATE,PSSOTH
"RTN","PSSPOIMO",46,0)
 .S $P(^PS(50.7,PSOIEN,0),"^",4)=PSSDTENT,PSAFTER=PSSDTENT
"RTN","PSSPOIMO",47,0)
 S:PSBEFORE&('$P(^PS(50.7,PSOIEN,0),"^",4)) PSINORDE="D" S:$P(^PS(50.7,PSOIEN,0),"^",4) PSINORDE="I"
"RTN","PSSPOIMO",48,0)
 I PSINORDE'="" D CHECK^PSSPOID2(PSOIEN) D
"RTN","PSSPOIMO",49,0)
 .I PSINORDE="D" D  Q
"RTN","PSSPOIMO",50,0)
 ..I $O(PSSDACTI(0))!($O(PSSSACTI(0)))!($O(PSSAACTI(0))) D
"RTN","PSSPOIMO",51,0)
 ...W !!,"There are inactive "_$S($O(PSSDACTI(0)):"drugs, ",1:"")_$S($O(PSSAACTI(0)):"additives, ",1:"")_$S($O(PSSSACTI(0)):"solutions,",1:""),!,"matched to this Pharmacy Orderable Item."
"RTN","PSSPOIMO",52,0)
 .I $O(PSSDACT(0))!($O(PSSSACT(0)))!($O(PSSAACT(0))) D
"RTN","PSSPOIMO",53,0)
 ..W !!,"There are active "_$S($O(PSSDACT(0)):"drugs, ",1:"")_$S($O(PSSAACT(0)):"additives, ",1:"")_$S($O(PSSSACT(0)):"solutions,",1:""),!,"matched to this Pharmacy Orderable Item."
"RTN","PSSPOIMO",54,0)
 I $G(PSINORDE)="D" I $O(PSSDACTI(0))!($O(PSSSACTI(0)))!($O(PSSAACTI(0))) D REST^PSSPOIDT(PSOIEN)
"RTN","PSSPOIMO",55,0)
 I $G(PSINORDE)="I" I $O(PSSDACT(0))!($O(PSSSACT(0)))!($O(PSSAACT(0))) D REST^PSSPOIDT(PSOIEN)
"RTN","PSSPOIMO",56,0)
 S DIK="^PS(50.7,",DA=PSOIEN,DIK(1)=.04 D EN^DIK K DIK
"RTN","PSSPOIMO",57,0)
 K PSBEFORE,PSAFTER,PSINORDE,PSSDTENT,PSSDACT,PSSDACTI,PSSSACT,PSSSACTI,PSSAACT,PSSAACTI
"RTN","PSSPOIMO",58,0)
IMMUN ;PSS*1*141 FOR 'IMMUNIZATIONS DOCUMENTATION BY BCMA'
"RTN","PSSPOIMO",59,0)
 I $O(^PSDRUG("AOC",PSOIEN,"IM000"))'["IM" G SYN ;ASK WHEN APPROPRIATE
"RTN","PSSPOIMO",60,0)
 W ! S DIE="^PS(50.7,",DA=PSOIEN,DR=9 D ^DIE K DIE
"RTN","PSSPOIMO",61,0)
SYN W ! K DIC S:'$D(^PS(50.7,PSOIEN,2,0)) ^PS(50.7,PSOIEN,2,0)="^50.72^0^0" S DIC="^PS(50.7,"_PSOIEN_",2,",DA(1)=PSOIEN,DIC(0)="QEAMZL",DIC("A")="Select SYNONYM: ",DLAYGO=50.72 D ^DIC K DIC
"RTN","PSSPOIMO",62,0)
 I Y<0!($D(DUOUT))!($D(DTOUT)) K:'$O(^PS(50.7,PSOIEN,2,0)) ^PS(50.7,PSOIEN,2,0) D EN^PSSPOIDT(PSOIEN),EN2^PSSHL1(PSOIEN,"MUP") G EN
"RTN","PSSPOIMO",63,0)
 W ! S DA=+Y,DIE="^PS(50.7,"_PSOIEN_",2,",DA(1)=PSOIEN,DR=.01 D ^DIE K DIE G SYN
"RTN","PSSPOIMO",64,0)
 D EN^PSSPOIDT(PSOIEN),EN2^PSSHL1(PSOIEN,"MUP")
"RTN","PSSPOIMO",65,0)
 G EN
"RTN","PSSPOIMO",66,0)
END K ZZFLAG,DIC,DIR,DIE,DTOUT,DUOUT,FLAG,PSOINAME,PSOUT,PSDOSE,PSONEW,UPFLAG,VV,ZZ,AA,BB,Y,AAA,SSS,PSOARR,PSOARRAD,PLINE I $D(PSOIEN) L -^PS(50.7,PSOIEN) K PSOIEN
"RTN","PSSPOIMO",67,0)
 Q
"RTN","PSSPOIMO",68,0)
DISP N PSSLFLAG,PSSLDATE S FLAG=1 D HEAD F ZZ=0:0 S ZZ=$O(^PSDRUG("ASP",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  S FLAG=0 D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ W !,$P($G(^PSDRUG(ZZ,0)),"^") W:$P($G(^PSDRUG(ZZ,0)),"^",9) "   N/F" D DTE
"RTN","PSSPOIMO",69,0)
 Q:$G(PSOUT)
"RTN","PSSPOIMO",70,0)
 S (FLAG,PSSLFLAG)=0
"RTN","PSSPOIMO",71,0)
 F ZZ=0:0 S ZZ=$O(^PS(52.6,"AOI",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ D
"RTN","PSSPOIMO",72,0)
 .S PSSLFLAG=1
"RTN","PSSPOIMO",73,0)
 .W !,$P($G(^PS(52.6,ZZ,0)),"^"),?42,"(A)"
"RTN","PSSPOIMO",74,0)
 .S PSSLDATE=$P($G(^PS(52.6,ZZ,"I")),"^") I PSSLDATE D DTEX
"RTN","PSSPOIMO",75,0)
 Q:$G(PSOUT)
"RTN","PSSPOIMO",76,0)
 ;I $G(PSSLFLAG) W !
"RTN","PSSPOIMO",77,0)
 F ZZ=0:0 S ZZ=$O(^PS(52.7,"AOI",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ D
"RTN","PSSPOIMO",78,0)
 .W !,$P($G(^PS(52.7,ZZ,0)),"^"),?31,$P($G(^(0)),"^",3),?42,"(S)"
"RTN","PSSPOIMO",79,0)
 .S PSSLDATE=$P($G(^PS(52.7,ZZ,"I")),"^") I PSSLDATE D DTEX
"RTN","PSSPOIMO",80,0)
 Q
"RTN","PSSPOIMO",81,0)
HEAD I 'FLAG W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR I 'Y S PSOUT=1 Q
"RTN","PSSPOIMO",82,0)
 W @IOF W !,?6,"Orderable Item ->  ",PSOINAME,!?6,"Dosage Form    ->  ",$P($G(^PS(50.606,+$P($G(^PS(50.7,PSOIEN,0)),"^",2),0)),"^"),!!,"Dispense Drugs:"_$S('FLAG:" (continued)",1:""),!,"---------------"
"RTN","PSSPOIMO",83,0)
 Q
"RTN","PSSPOIMO",84,0)
ADDIT ;If orderable item is flagged for IV
"RTN","PSSPOIMO",85,0)
 S AA=$O(^PS(52.6,"AOI",PSOIEN,0))
"RTN","PSSPOIMO",86,0)
 S BB=$O(^PS(52.7,"AOI",PSOIEN,0))
"RTN","PSSPOIMO",87,0)
 I 'AA,'BB W $C(7),!,"This Orderable Item is flagged for IV use, but currently there are no IV",!,"Additives or IV Solutions matched to this Orderable Item!" G EDIT
"RTN","PSSPOIMO",88,0)
 G SOL
"RTN","PSSPOIMO",89,0)
CHECK ;
"RTN","PSSPOIMO",90,0)
 S ZZFLAG=0 F VV=0:0 S VV=$O(^PS(50.7,"ADF",X,PSDOSE,VV)) Q:'VV  I VV,'$P($G(^PS(50.7,VV,0)),"^",3) S ZZFLAG=1
"RTN","PSSPOIMO",91,0)
 I ZZFLAG W $C(7),!!?5,"There is already an Orderable Item with this same name and Dosage Form",!?5,"that is not flagged as 'IV'. Use the 'DISPENSE DRUG/ORDERABLE ITEM",!?5,"MAINTENANCE' option if you want to re-match to this Orderable Item!",!
"RTN","PSSPOIMO",92,0)
 Q
"RTN","PSSPOIMO",93,0)
ZCHECK ;
"RTN","PSSPOIMO",94,0)
 S ZZFLAG=0 F VV=0:0 S VV=$O(^PS(50.7,"ADF",X,PSDOSE,VV)) Q:'VV  I VV,$P($G(^PS(50.7,VV,0)),"^",3) S ZZFLAG=1
"RTN","PSSPOIMO",95,0)
 I ZZFLAG W $C(7),!!?5,"There is already an Orderable Item with the same name and Dosage Form,",!?5,"that is flagged for 'IV' use.",!
"RTN","PSSPOIMO",96,0)
 Q
"RTN","PSSPOIMO",97,0)
SOL ;
"RTN","PSSPOIMO",98,0)
 K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="List all Additives and Solutions tied to this Orderable Item" D ^DIR K DIR G:Y["^"!($D(DTOUT)) EN G:Y=0 EDIT
"RTN","PSSPOIMO",99,0)
 H 1 K PSOARR,PSOARRAD S AAA=$O(^PS(52.6,"AOI",PSOIEN,0)) I AAA,$D(^PS(52.6,AAA,0)) S PSOARRAD=AAA
"RTN","PSSPOIMO",100,0)
 F SSS=0:0 S SSS=$O(^PS(52.7,"AOI",PSOIEN,SSS)) Q:'SSS  S:$D(^PS(52.7,SSS,0)) PSOARR(SSS)=""
"RTN","PSSPOIMO",101,0)
 S FLAG=1,UPFLAG=0 D SHEAD F ZZ=0:0 S ZZ=$O(PSOARR(ZZ)) Q:'ZZ!($G(PSOUT))!($G(UPFLAG))  S FLAG=0 D:($Y+7)>IOSL SHEAD Q:$G(PSOUT)!($G(UPFLAG))  I ZZ W !,$P($G(^PS(52.7,ZZ,0)),"^"),"   ",$P($G(^(0)),"^",3)
"RTN","PSSPOIMO",102,0)
 G:$G(PSOUT) EN
"RTN","PSSPOIMO",103,0)
 G EDIT
"RTN","PSSPOIMO",104,0)
SHEAD I 'FLAG W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR I 'Y S:Y="" PSOUT=1 S:Y=0 UPFLAG=1 Q
"RTN","PSSPOIMO",105,0)
 W @IOF W !?6,"Orderable Item ->  ",PSOINAME,?68,"(IV)",!?6,"Dosage Form    ->  ",$P($G(^PS(50.606,+$P($G(^PS(50.7,PSOIEN,0)),"^",2),0)),"^"),!,PLINE I FLAG,'$G(PSOARRAD) W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",106,0)
 I 'FLAG W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",107,0)
 I FLAG,$G(PSOARRAD) W !,$P($G(^PS(52.6,PSOARRAD,0)),"^"),"    ","(IV Additive)",! I $D(PSOARR) W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",108,0)
 Q
"RTN","PSSPOIMO",109,0)
DTE I $D(^PSDRUG(ZZ,"I")) S Y=$P(^PSDRUG(ZZ,"I"),"^") D DD^%DT W ?50,Y K Y
"RTN","PSSPOIMO",110,0)
 Q
"RTN","PSSPOIMO",111,0)
DTEX S Y=$G(PSSLDATE) D DD^%DT W ?50,$G(Y) K Y
"RTN","PSSPOIMO",112,0)
 Q
"RTN","PSSPOIMO",113,0)
IVMSG ; display a message if the CORRESPONDING IV field is entered
"RTN","PSSPOIMO",114,0)
 ;
"RTN","PSSPOIMO",115,0)
 S PSSIVMSG=$P(^PS(50.7,PSOIEN,0),"^",11) I PSSIVMSG="" Q
"RTN","PSSPOIMO",116,0)
 S PSSIVFRM=$P(^PS(50.7,PSSIVMSG,0),"^",2) I PSSIVFRM S PSSIVFRM=$P(^PS(50.606,PSSIVFRM,0),"^")
"RTN","PSSPOIMO",117,0)
 S PSSIVMSG=$P(^PS(50.7,PSSIVMSG,0),"^")_" "_PSSIVFRM
"RTN","PSSPOIMO",118,0)
 W !!,"The Corresponding IV Item is currently identified as: "_PSSIVMSG,!
"RTN","PSSPOIMO",119,0)
 K PSSIVFRM,PSSIVMSG
"RTN","PSSPOIMO",120,0)
 Q
"RTN","PSSPOIMO",121,0)
UDMSG ; display a message if the CORRESPONDING UD field is entered
"RTN","PSSPOIMO",122,0)
 ;
"RTN","PSSPOIMO",123,0)
 S PSSUDMSG=$P(^PS(50.7,PSOIEN,0),"^",10) I PSSUDMSG="" Q
"RTN","PSSPOIMO",124,0)
 S PSSUDFRM=$P(^PS(50.7,PSSUDMSG,0),"^",2) I PSSUDFRM S PSSUDFRM=$P(^PS(50.606,PSSUDFRM,0),"^")
"RTN","PSSPOIMO",125,0)
 S PSSUDMSG=$P(^PS(50.7,PSSUDMSG,0),"^")_" "_PSSUDFRM
"RTN","PSSPOIMO",126,0)
 W !!,"The Corresponding UD Item is currently identified as: "_PSSUDMSG,!
"RTN","PSSPOIMO",127,0)
 K PSSUDMSG,PSSUDFRM
"RTN","PSSPOIMO",128,0)
 Q
"RTN","PSSPOIMO",129,0)
DFR(PSDOSE) ; dosage form med routes - called by DR string at DIR+20^PSSPOIMO
"RTN","PSSPOIMO",130,0)
 N MCT,MR,MRNODE,XX K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",131,0)
 S (MCT,MR)=0 F  S MR=$O(^PS(50.606,PSDOSE,"MR",MR)) Q:'MR  D
"RTN","PSSPOIMO",132,0)
 .S XX=+$G(^PS(50.606,PSDOSE,"MR",MR,0)) Q:'XX  S MRNODE=$G(^PS(51.2,XX,0)) I $P($G(MRNODE),"^",4)'=1 Q
"RTN","PSSPOIMO",133,0)
 .S MCT=MCT+1,^TMP("PSSMR",$J,MCT)=$P(MRNODE,U),^TMP("PSSMR",$J,"B",XX)=""
"RTN","PSSPOIMO",134,0)
 Q
"RTN","PSSPOIMO",135,0)
DFRL W !!," List of med routes associated with the DOSAGE FORM of the orderable item:",!
"RTN","PSSPOIMO",136,0)
 S MCT=0 I '$O(^TMP("PSSMR",$J,MCT)) W !,?3,"NO MED ROUTE DEFINED"
"RTN","PSSPOIMO",137,0)
 F  S MCT=$O(^TMP("PSSMR",$J,MCT)) Q:'MCT  W !,?3,$G(^(MCT))
"RTN","PSSPOIMO",138,0)
 D EN^DDIOL(" If you answer YES to the next prompt, the DEFAULT MED ROUTE (if populated)",,"!!")
"RTN","PSSPOIMO",139,0)
 D EN^DDIOL(" and this list (if populated) will be displayed as selectable med routes",,"!")
"RTN","PSSPOIMO",140,0)
 D EN^DDIOL(" during medication ordering dialog. If you answer NO, the DEFAULT MED ROUTE",,"!")
"RTN","PSSPOIMO",141,0)
 D EN^DDIOL(" (if populated) and POSSIBLE MED ROUTES list will be displayed instead.",,"!") W !
"RTN","PSSPOIMO",142,0)
 K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",143,0)
 Q
"RTN","PSSPOIMO",144,0)
PDR ; possible med routes - called by DR string at DIR+20^PSSPOIMO
"RTN","PSSPOIMO",145,0)
 N MCT,MR,MRNODE,XX K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",146,0)
 S (XX,MCT)=0 F  S XX=$O(^PS(50.7,$S($G(PSVAR):PSVAR,1:PSOIEN),3,"B",XX)) Q:'XX  S MRNODE=$G(^PS(51.2,XX,0)),MCT=MCT+1,^TMP("PSSMR",$J,MCT)=$P(MRNODE,U)
"RTN","PSSPOIMO",147,0)
 I $O(^TMP("PSSMR",$J,0)) D
"RTN","PSSPOIMO",148,0)
 .W !!," List of Possible Med Routes associated with the orderable item:",!
"RTN","PSSPOIMO",149,0)
 .S MCT=0 F  S MCT=$O(^TMP("PSSMR",$J,MCT)) Q:'MCT  W !,?3,$G(^(MCT))
"RTN","PSSPOIMO",150,0)
 W ! K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",151,0)
 Q
"RTN","PSSPOIMO",152,0)
PDCHK ; called by called by DR string at DIR+20^PSSPOIMO
"RTN","PSSPOIMO",153,0)
 N ANS,D,DIC,DIE,DO,DICR,DR,DIR,PSOUT,PSSDA,PSSX,PSSXA,PSSY,Q,X,Y,Z
"RTN","PSSPOIMO",154,0)
 S DIR(0)="PO^51.2:EMZ",DIR("A")="POSSIBLE MED ROUTES",DIR("S")="I $P(^(0),U,4)" S PSOUT=0
"RTN","PSSPOIMO",155,0)
 S DIR("PRE")="I X=""?"" D MRTHLP^PSSPOIMO"
"RTN","PSSPOIMO",156,0)
 F  D PDR,^DIR D  I PSOUT Q
"RTN","PSSPOIMO",157,0)
 .I (X="")!$D(DTOUT)!$D(DUOUT) S PSOUT=1 Q
"RTN","PSSPOIMO",158,0)
 .I X="@",$D(PSSY) S ANS=DA D:$$DASK  Q
"RTN","PSSPOIMO",159,0)
 ..N DIK,DA S DA(1)=ANS,DIK="^PS(50.7,"_DA(1)_",3,"
"RTN","PSSPOIMO",160,0)
 ..S DA=$O(^PS(50.7,DA(1),3,"B",PSSY,"")) I DA="" Q
"RTN","PSSPOIMO",161,0)
 ..D ^DIK K PSSY,DIR("B")
"RTN","PSSPOIMO",162,0)
 .I Y="" W "  ??" Q
"RTN","PSSPOIMO",163,0)
 .I $D(^PS(50.7,DA,3,"B",+Y)) D  Q
"RTN","PSSPOIMO",164,0)
 ..I $D(DIR("B")) K PSSY,DIR("B") Q
"RTN","PSSPOIMO",165,0)
 ..S DIR("B")=Y(0,0),PSSY=+Y Q
"RTN","PSSPOIMO",166,0)
 .S PSSXA=Y(0,0),PSSX=+Y D DFR(+$P(^PS(50.7,DA,0),"^",2))
"RTN","PSSPOIMO",167,0)
 .I $G(PSSX) S ANS=$$ASK() I 'ANS Q
"RTN","PSSPOIMO",168,0)
 .S PSSDA(50.711,"+1,"_DA_",",.01)=+PSSX
"RTN","PSSPOIMO",169,0)
 .D UPDATE^DIE("","PSSDA")
"RTN","PSSPOIMO",170,0)
 .K ^TMP("PSSMR",$J)
"RTN","PSSPOIMO",171,0)
  Q
"RTN","PSSPOIMO",172,0)
ASK() ; confirm adding the new entry
"RTN","PSSPOIMO",173,0)
 N DIR,X,Y W ! S DIR(0)="YO",DIR("B")="YES"
"RTN","PSSPOIMO",174,0)
 I '$D(^TMP("PSSMR",$J,"B",PSSX)) S DIR("B")="NO",DIR("A",1)="The selected entry does not match any of the dosage form med routes."
"RTN","PSSPOIMO",175,0)
 W $C(7) S DIR("A")="  Are you adding '"_PSSXA_"' as a new POSSIBLE MED ROUTE" D ^DIR
"RTN","PSSPOIMO",176,0)
 Q $S(Y=1:1,1:0)
"RTN","PSSPOIMO",177,0)
DASK() ; delete possible med route
"RTN","PSSPOIMO",178,0)
 N DIR
"RTN","PSSPOIMO",179,0)
 W $C(7) S DIR("A")="     SURE YOU WANT TO DELETE ",DIR(0)="Y" D ^DIR
"RTN","PSSPOIMO",180,0)
 Q $S(Y=1:1,1:0)
"RTN","PSSPOIMO",181,0)
MRTHLP ; help of possible med route
"RTN","PSSPOIMO",182,0)
 N DIC,RTE,D
"RTN","PSSPOIMO",183,0)
 S RTE=0 F  S RTE=$O(^PS(50.7,DA,3,"B",RTE)) Q:'RTE   D EN^DDIOL($P($G(^PS(51.2,RTE,0)),"^"),,"!,?4")
"RTN","PSSPOIMO",184,0)
 W ! D EN^DDIOL("Enter the most common MED ROUTE associated with this Orderable Item.",,"!,?5")
"RTN","PSSPOIMO",185,0)
 D EN^DDIOL("ONLY MED ROUTES MARKED FOR USE BY ALL PACKAGES ARE SELECTABLE.",,"!,?5")
"RTN","PSSPOIMO",186,0)
 Q
"RTN","PSSPOIMO",187,0)
DP(PSOIEN) ; check the existence of Default Med Route & Possible Med Routes
"RTN","PSSPOIMO",188,0)
 N D,DIC,DIE,DO,DICR,DR,DIR,PSSFG,Q,X,Y,Z S PSSFG=0
"RTN","PSSPOIMO",189,0)
 I '$P($G(^PS(50.7,PSOIEN,0)),"^",6)&('$O(^PS(50.7,PSOIEN,3,0))) D
"RTN","PSSPOIMO",190,0)
 .S PSR(1)=" You have not selected ANY med routes to display during order entry. In"
"RTN","PSSPOIMO",191,0)
 .S PSR(2)=" order to have med routes displayed during order entry, you must either"
"RTN","PSSPOIMO",192,0)
 .S PSR(3)=" define a DEFAULT MED ROUTE and/or at least one POSSIBLE MED ROUTE, or"
"RTN","PSSPOIMO",193,0)
 .S PSR(4)=" answer YES to the USE DOSAGE FORM MED ROUTE LIST prompt."
"RTN","PSSPOIMO",194,0)
 .S PSR(5)=" **WITH THE CURRENT SETTINGS, NO MED ROUTES WILL DISPLAY FOR SELECTION ",PSR(5,"F")="!!"
"RTN","PSSPOIMO",195,0)
 .S PSR(6)=" DURING ORDER ENTRY FOR THIS ORDERABLE ITEM**"
"RTN","PSSPOIMO",196,0)
 .D EN^DDIOL(.PSR),EN^DDIOL(" ","","!")
"RTN","PSSPOIMO",197,0)
 .K DIR S DIR(0)="Y",DIR("?",1)="If you select NO, you will continue to loop back to the Default Med Route"
"RTN","PSSPOIMO",198,0)
 .S DIR("?")="prompt until either a selection is made or you answer YES to this prompt to proceed."
"RTN","PSSPOIMO",199,0)
 .S DIR("A",1)="",DIR("A",2)="The current setting is usually only appropriate for supply items."
"RTN","PSSPOIMO",200,0)
 .S DIR("A")="Continue with no med routes displaying for selection during order entry",DIR("B")="NO"
"RTN","PSSPOIMO",201,0)
 .D ^DIR K DIR W ! I 'Y!($D(DTOUT))!($D(DUOUT)) S PSSFG=1
"RTN","PSSPOIMO",202,0)
 Q PSSFG
"RTN","PSSYSP")
0^2^B143904^B162983
"RTN","PSSYSP",1,0)
PSSYSP ;BIR/WRT-Pharmacy system site parameters routine ;5/22/08 11:00am
"RTN","PSSYSP",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**20,38,87,120,137,140,159**;9/30/97;Build 29
"RTN","PSSYSP",3,0)
 ; CHANGE TYPE OF ORDER (FINISH) FROM OERR
"RTN","PSSYSP",4,0)
 W ! S DIE="^PS(59.7,",DR="13;14;16;16.1;16.2;40.16",DA=1 D ^DIE
"RTN","PSSYSP",5,0)
 K DIE,DA,DR W !
"RTN","PSSYSP",6,0)
 Q
"VER")
8.0^22.0
"^DD",50.7,50.7,10,0)
USE DOSAGE FORM MED ROUTE LIST^RS^Y:YES;N:NO;^0;13^Q
"^DD",50.7,50.7,10,3)
Enter YES to use the med routes from the Dosage Form file associated to the orderable item or NO to use the possible med routes associated to the orderable item.
"^DD",50.7,50.7,10,21,0)
^.001^5^5^3110208^^^^
"^DD",50.7,50.7,10,21,1,0)
This flag governs the source of the medication routes that will be 
"^DD",50.7,50.7,10,21,2,0)
used during medication order entry. If this field is set to YES, the
"^DD",50.7,50.7,10,21,3,0)
optional list of med routes will be derived from the Dosage Form file
"^DD",50.7,50.7,10,21,4,0)
associated to the orderable item. Otherwise, it will be derived from 
"^DD",50.7,50.7,10,21,5,0)
the Possible Med Routes Sub-file associated to the orderable item.
"^DD",50.7,50.7,10,23,0)
^.001^3^3^3110208^^^^
"^DD",50.7,50.7,10,23,1,0)
A "YES" indicates the med routes from the Dosage Form (#50.606) will 
"^DD",50.7,50.7,10,23,2,0)
be used for the Orderable item. A "NO" indicates the med routes from 
"^DD",50.7,50.7,10,23,3,0)
the POSSIBLE MED ROUTES sub-file #50.711 will be used.
"^DD",50.7,50.7,10,"DT")
3110825
"BLD",7560,6)
^146
**END**
**END**
