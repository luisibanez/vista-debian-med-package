Released PSS*1*150 SEQ #154
Extracted from mail message
**KIDS**:PSS*1.0*150^

**INSTALL NAME**
PSS*1.0*150
"BLD",8793,0)
PSS*1.0*150^PHARMACY DATA MANAGEMENT^0^3120905^y
"BLD",8793,1,0)
^^8^8^3120831^
"BLD",8793,1,1,0)
This patch will correct the following issues:
"BLD",8793,1,2,0)
 
"BLD",8793,1,3,0)
 Update the calculation for slashed dosages in outpatient pharmacy by 
"BLD",8793,1,4,0)
 correctly calculating duration in reation to dosage.
"BLD",8793,1,5,0)
 
"BLD",8793,1,6,0)
 Prevent display of non-editable field IV FLAG (#.03) in the PHARMACY 
"BLD",8793,1,7,0)
 ORDERABLE ITEM FILE (#50.7) from displaying when attempting to edit 
"BLD",8793,1,8,0)
 via fileman.
"BLD",8793,4,0)
^9.64PA^^
"BLD",8793,6.3)
2
"BLD",8793,"ABPKG")
n
"BLD",8793,"INID")
^y
"BLD",8793,"INIT")
EN^PSSP150
"BLD",8793,"KRN",0)
^9.67PA^779.2^20
"BLD",8793,"KRN",.4,0)
.4
"BLD",8793,"KRN",.401,0)
.401
"BLD",8793,"KRN",.402,0)
.402
"BLD",8793,"KRN",.403,0)
.403
"BLD",8793,"KRN",.5,0)
.5
"BLD",8793,"KRN",.84,0)
.84
"BLD",8793,"KRN",3.6,0)
3.6
"BLD",8793,"KRN",3.8,0)
3.8
"BLD",8793,"KRN",9.2,0)
9.2
"BLD",8793,"KRN",9.8,0)
9.8
"BLD",8793,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8793,"KRN",9.8,"NM",1,0)
PSSORPH^^0^B78689829
"BLD",8793,"KRN",9.8,"NM","B","PSSORPH",1)

"BLD",8793,"KRN",19,0)
19
"BLD",8793,"KRN",19.1,0)
19.1
"BLD",8793,"KRN",101,0)
101
"BLD",8793,"KRN",409.61,0)
409.61
"BLD",8793,"KRN",771,0)
771
"BLD",8793,"KRN",779.2,0)
779.2
"BLD",8793,"KRN",870,0)
870
"BLD",8793,"KRN",8989.51,0)
8989.51
"BLD",8793,"KRN",8989.52,0)
8989.52
"BLD",8793,"KRN",8994,0)
8994
"BLD",8793,"KRN","B",.4,.4)

"BLD",8793,"KRN","B",.401,.401)

"BLD",8793,"KRN","B",.402,.402)

"BLD",8793,"KRN","B",.403,.403)

"BLD",8793,"KRN","B",.5,.5)

"BLD",8793,"KRN","B",.84,.84)

"BLD",8793,"KRN","B",3.6,3.6)

"BLD",8793,"KRN","B",3.8,3.8)

"BLD",8793,"KRN","B",9.2,9.2)

"BLD",8793,"KRN","B",9.8,9.8)

"BLD",8793,"KRN","B",19,19)

"BLD",8793,"KRN","B",19.1,19.1)

"BLD",8793,"KRN","B",101,101)

"BLD",8793,"KRN","B",409.61,409.61)

"BLD",8793,"KRN","B",771,771)

"BLD",8793,"KRN","B",779.2,779.2)

"BLD",8793,"KRN","B",870,870)

"BLD",8793,"KRN","B",8989.51,8989.51)

"BLD",8793,"KRN","B",8989.52,8989.52)

"BLD",8793,"KRN","B",8994,8994)

"BLD",8793,"QUES",0)
^9.62^^
"BLD",8793,"REQB",0)
^9.611^1^1
"BLD",8793,"REQB",1,0)
PSS*1.0*69^2
"BLD",8793,"REQB","B","PSS*1.0*69",1)

"INIT")
EN^PSSP150
"MBREQ")
0
"PKG",586,-1)
1^1
"PKG",586,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",586,20,0)
^9.402P^^
"PKG",586,22,0)
^9.49I^1^1
"PKG",586,22,1,0)
1.0^2970930^2971128^1
"PKG",586,22,1,"PAH",1,0)
150^3120905
"PKG",586,22,1,"PAH",1,1,0)
^^8^8^3120905
"PKG",586,22,1,"PAH",1,1,1,0)
This patch will correct the following issues:
"PKG",586,22,1,"PAH",1,1,2,0)
 
"PKG",586,22,1,"PAH",1,1,3,0)
 Update the calculation for slashed dosages in outpatient pharmacy by 
"PKG",586,22,1,"PAH",1,1,4,0)
 correctly calculating duration in reation to dosage.
"PKG",586,22,1,"PAH",1,1,5,0)
 
"PKG",586,22,1,"PAH",1,1,6,0)
 Prevent display of non-editable field IV FLAG (#.03) in the PHARMACY 
"PKG",586,22,1,"PAH",1,1,7,0)
 ORDERABLE ITEM FILE (#50.7) from displaying when attempting to edit 
"PKG",586,22,1,"PAH",1,1,8,0)
 via fileman.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSSORPH")
0^1^B78689829^B77028088
"RTN","PSSORPH",1,0)
PSSORPH ;BIR/RSB/RTR-Dosage choices by Dispense Drug ; 8/31/12 1:57pm
"RTN","PSSORPH",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**34,38,49,69,150**;9/30/97;Build 2
"RTN","PSSORPH",3,0)
 ;Reference to ^PS(50.607 supported by DBIA 2221
"RTN","PSSORPH",4,0)
 ;Reference to ^YSCL(603.01 supported by DBIA 2697
"RTN","PSSORPH",5,0)
 ;Reference to ^PSNAPIS supported by DBIA 2531
"RTN","PSSORPH",6,0)
 ;
"RTN","PSSORPH",7,0)
DOSE(PSSX,PD,TYPE,PSSDFN,PSSUPD) ;
"RTN","PSSORPH",8,0)
 K PSSX
"RTN","PSSORPH",9,0)
 ; PSSX - Target variable for returned data
"RTN","PSSORPH",10,0)
 ; PD - Pharmacy Dispense Drug
"RTN","PSSORPH",11,0)
 ; TYPE - Type of Drug (O:Outpt, U:Unit Dose, I:IV, X:Non-VA Med)
"RTN","PSSORPH",12,0)
 ; PSSDFN - Patient IEN
"RTN","PSSORPH",13,0)
 ; PSSUPD - Units per Dose
"RTN","PSSORPH",14,0)
 N DLOOP,DCNT1,DLOOP1,LOW,FORM,PSSOIU,PSSLOW,PSSLOW1,PSSLOW2,PSOLC,PL,PSSHOLD,PSSA,PSSZ,PSSC,PSIEN,PSSTRN,PSSDSE,PSSVERB,PSSPREP,PSSCLO,PSSDEA,PSSMAX,PSSDLP,PSNN,PSNNN,PSSREQS,PSSLOW4,PL2,PSSA1,PL3,POPD,PSSUNITZ,PSSLDV,PSSLDN,PSSUNITX
"RTN","PSSORPH",15,0)
 N PSSDOSE,PSSUNTS,PSSUDOS,PSSMD,PSSMD1,PSSMDN,PSSBC,PSSOLDN
"RTN","PSSORPH",16,0)
 S POPD=+$P($G(^PSDRUG(PD,2)),"^")
"RTN","PSSORPH",17,0)
 S PSSOIU=$S(TYPE="I":1,TYPE="U":1,1:0)
"RTN","PSSORPH",18,0)
 I $G(PSSUPD) G ^PSSORPH1
"RTN","PSSORPH",19,0)
 S DLOOP=PD D
"RTN","PSSORPH",20,0)
 .Q:'$O(^PSDRUG(DLOOP,"DOS1",0))
"RTN","PSSORPH",21,0)
 .S PSSTRN=$P($G(^PSDRUG(DLOOP,"DOS")),"^"),PSSUNITZ=$P($G(^("DOS")),"^",2) Q:PSSTRN=""
"RTN","PSSORPH",22,0)
 .S PSSUNITX=$S($P($G(^PS(50.607,+$G(PSSUNITZ),0)),"^")'=""&($P($G(^(0)),"^")'["/"):$P($G(^(0)),"^"),1:"")
"RTN","PSSORPH",23,0)
 .Q:$G(^PSDRUG(DLOOP,"I"))]""&($G(^("I"))'>DT)  ; omit inactive drugs
"RTN","PSSORPH",24,0)
 .;Q:$P($G(^PSDRUG(DLOOP,2)),"^",3)'[TYPE
"RTN","PSSORPH",25,0)
 .S PSSDSE=+$P($G(^PS(50.7,POPD,0)),"^",2),PSSVERB=$P($G(^PS(50.606,PSSDSE,"MISC")),"^"),PSSPREP=$P($G(^("MISC")),"^",3)
"RTN","PSSORPH",26,0)
 .K PSNNN F PSNN=0:0 S PSNN=$O(^PS(50.606,PSSDSE,"NOUN",PSNN)) Q:'PSNN!($D(PSNNN))  S:$P($G(^(PSNN,0)),"^")'="" PSNNN=$P($G(^(0)),"^")
"RTN","PSSORPH",27,0)
 .; Set each possible dose node
"RTN","PSSORPH",28,0)
 .F DLOOP1=0:0 S DLOOP1=$O(^PSDRUG(DLOOP,"DOS1",DLOOP1)) Q:'DLOOP1  D
"RTN","PSSORPH",29,0)
 ..Q:'$D(^PSDRUG(DLOOP,"DOS1",DLOOP1,0))
"RTN","PSSORPH",30,0)
 ..I PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^",3)'["I" Q
"RTN","PSSORPH",31,0)
 ..I 'PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^",3)'["O" Q
"RTN","PSSORPH",32,0)
 ..S (PSSDOSE,PSSUNTS,PSSUDOS,PSSBC)=""
"RTN","PSSORPH",33,0)
 ..S PSSDOSE=$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^",2)
"RTN","PSSORPH",34,0)
 ..S PSSUNTS=$P($G(^PS(50.607,+$P($G(^PSDRUG(DLOOP,"DOS")),"^",2),0)),"^")
"RTN","PSSORPH",35,0)
 ..S PSSUDOS=$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^"),PSSBC=$P($G(^(0)),"^",4)
"RTN","PSSORPH",36,0)
 ..I PSSDOSE]""&(PSSUDOS]"") D
"RTN","PSSORPH",37,0)
 ...S DCNT1=$S('$D(DCNT1):1,1:DCNT1+1)
"RTN","PSSORPH",38,0)
 ...S LOW(PSSDOSE,PSSUDOS,DCNT1)=""
"RTN","PSSORPH",39,0)
 ...S FORM(PSSDOSE,$S($P($G(^PSDRUG(DLOOP,0)),"^",9)=1:1,1:0),DCNT1)=PSSUDOS
"RTN","PSSORPH",40,0)
 ...D PARN
"RTN","PSSORPH",41,0)
 ...S PSSX(DCNT1)=PSSDOSE_"^"_$S("OX"[$G(TYPE):$G(PSSUNITZ),1:$G(PSSUNTS))_"^"_PSSUDOS_"^"_DLOOP_"^"_$G(PSSTRN)_"^"_$S($G(PSSNP)'="":$G(PSSNP),1:$G(PSNNN))_"^"_$P($G(^PS(50.606,+$G(PSSDSE),0)),"^")_"^"_$G(PSSVERB)_"^"_$G(PSSPREP)
"RTN","PSSORPH",42,0)
 ...S PSSX(DCNT1)=PSSX(DCNT1)_$S("OX"'[$G(TYPE):"^^^"_$G(PSSBC),1:"")
"RTN","PSSORPH",43,0)
 ...K PSSNP,PSSBC
"RTN","PSSORPH",44,0)
 I '$O(PSSX(0)) G DOSE2
"RTN","PSSORPH",45,0)
 ; delete non-formulary doses if formulary doses exist
"RTN","PSSORPH",46,0)
 S PSSLOW="" F  S PSSLOW=$O(FORM(PSSLOW)) Q:PSSLOW=""  D
"RTN","PSSORPH",47,0)
 .I $O(FORM(PSSLOW,0,0)) S PSSLOW2="" F  S PSSLOW2=$O(FORM(PSSLOW,1,PSSLOW2)) Q:PSSLOW2=""  K PSSX(PSSLOW2),LOW(PSSLOW,+$G(FORM(PSSLOW,1,PSSLOW2)),PSSLOW2)
"RTN","PSSORPH",48,0)
 ;Find lowest units per dose
"RTN","PSSORPH",49,0)
 S PSSLOW="" F  S PSSLOW=$O(LOW(PSSLOW)) Q:PSSLOW=""  D
"RTN","PSSORPH",50,0)
 .S PSOLC=0 S PSSLOW1="" F  S PSSLOW1=$O(LOW(PSSLOW,PSSLOW1)) Q:PSSLOW1=""  D
"RTN","PSSORPH",51,0)
 ..S PSOLC=PSOLC+1 S:PSOLC=1 PSSLOW4=$O(LOW(PSSLOW,PSSLOW1,0))
"RTN","PSSORPH",52,0)
 ..S PSSLOW2="" F  S PSSLOW2=$O(LOW(PSSLOW,PSSLOW1,PSSLOW2)) Q:PSSLOW2=""  D
"RTN","PSSORPH",53,0)
 ...I PSOLC>1 S PSSX(PSSLOW4,(PSOLC-1))=PSSX(PSSLOW2) K PSSX(PSSLOW2)
"RTN","PSSORPH",54,0)
 K PSSHOLD S PL="" F  S PL=$O(PSSX(PL)) Q:PL=""  S PSSHOLD($P(PSSX(PL),"^"),PL)=PSSX(PL) I $O(PSSX(PL,0)) D
"RTN","PSSORPH",55,0)
 .S PL2="" F  S PL2=$O(PSSX(PL,PL2)) Q:PL2=""  S PSSHOLD($P(PSSX(PL,PL2),"^"),PL,PL2)=PSSX(PL,PL2)
"RTN","PSSORPH",56,0)
 K PSSX S PSSA=1,PSSZ="" F  S PSSZ=$O(PSSHOLD(PSSZ)) Q:PSSZ=""  F PSSC=0:0 S PSSC=$O(PSSHOLD(PSSZ,PSSC)) Q:'PSSC  S PSSX(PSSA)=PSSHOLD(PSSZ,PSSC) D SLS D:'$D(PSSX("DD",+$P(PSSX(PSSA),"^",4)))  D:$O(PSSHOLD(PSSZ,PSSC,0)) MULTI S PSSA=PSSA+1
"RTN","PSSORPH",57,0)
 .S (PSIEN,DLOOP)=+$P(PSSX(PSSA),"^",4) K PSSMAX D:$G(TYPE)["O" MAX
"RTN","PSSORPH",58,0)
 .S PSSX("DD",PSIEN)=$P($G(^PSDRUG(PSIEN,0)),"^")_"^"_$P($G(^(660)),"^",6)_"^"_$P($G(^(0)),"^",9)_"^"_$P($G(^(660)),"^",8)_"^"_$P($G(^("DOS")),"^")_"^"_$G(PSSUNITX)_"^"_$G(PSSMAX)
"RTN","PSSORPH",59,0)
 .D REQS S PSSX("DD",PSIEN)=PSSX("DD",PSIEN)_"^"_$G(PSSREQS)_"^"_$G(PSNNN)_"^"_$G(PSSVERB)_"^"_1
"RTN","PSSORPH",60,0)
 K PSSHOLD
"RTN","PSSORPH",61,0)
 D LEADP^PSSUTLA1
"RTN","PSSORPH",62,0)
 Q
"RTN","PSSORPH",63,0)
DOSE2 ;Local Dose
"RTN","PSSORPH",64,0)
 N PSOCT,PSONDS,PSOND,PSOND1,PSONDX,PSONDU,PSODOS,PSLOC,PSLOCV,PSODUPD
"RTN","PSSORPH",65,0)
 S PSOCT=1
"RTN","PSSORPH",66,0)
 S DLOOP=PD D
"RTN","PSSORPH",67,0)
 .I $P($G(^PSDRUG(DLOOP,"I")),"^"),+$P($G(^("I")),"^")<DT Q
"RTN","PSSORPH",68,0)
 .;Q:$P($G(^PSDRUG(DLOOP,2)),"^",3)'[TYPE
"RTN","PSSORPH",69,0)
 .Q:'$O(^PSDRUG(DLOOP,"DOS2",0))
"RTN","PSSORPH",70,0)
 .S PSONDS=$P($G(^PSDRUG(DLOOP,"DOS")),"^"),PSONDU=$P($G(^("DOS")),"^",2),PSOND=$P($G(^("ND")),"^",3),PSOND1=$P($G(^("ND")),"^")
"RTN","PSSORPH",71,0)
 .I PSOND,PSOND1 I PSONDS=""!('PSONDU) S PSONDX=$$DFSU^PSNAPIS(PSOND1,PSOND)
"RTN","PSSORPH",72,0)
 .I PSONDS="",PSOND,PSOND1 S PSONDS=$P($G(PSONDX),"^",4)
"RTN","PSSORPH",73,0)
 .I 'PSONDU,PSOND,PSOND1 S PSONDU=$P($G(PSONDX),"^",5)
"RTN","PSSORPH",74,0)
 .S PSODOS=+$P($G(^PS(50.7,POPD,0)),"^",2)
"RTN","PSSORPH",75,0)
 .;LOOK IN DOS2 NODE FOR LOCAL DOSES
"RTN","PSSORPH",76,0)
 .F PSLOC=0:0 S PSLOC=$O(^PSDRUG(DLOOP,"DOS2",PSLOC)) Q:'PSLOC  D
"RTN","PSSORPH",77,0)
 ..S PSLOCV=$P($G(^PSDRUG(DLOOP,"DOS2",PSLOC,0)),"^") Q:PSLOCV=""
"RTN","PSSORPH",78,0)
 ..S PSSBC=$P($G(^PSDRUG(DLOOP,"DOS2",PSLOC,0)),"^",3)
"RTN","PSSORPH",79,0)
 ..S PSSOLDN=$P($G(^PSDRUG(DLOOP,"DOS2",PSLOC,0)),"^",4)
"RTN","PSSORPH",80,0)
 ..I PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS2",PSLOC,0)),"^",2)'["I" Q
"RTN","PSSORPH",81,0)
 ..I 'PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS2",PSLOC,0)),"^",2)'["O" Q
"RTN","PSSORPH",82,0)
 ..D SET2
"RTN","PSSORPH",83,0)
 ;IF NO LOCAL DOSES, RETURN ANY DRUGS YOU CAN
"RTN","PSSORPH",84,0)
 K PSSBC,PSSOLDN
"RTN","PSSORPH",85,0)
 I '$O(PSSX(0)) K PSLOCV S PSOCT=1 D
"RTN","PSSORPH",86,0)
 .S DLOOP=PD D
"RTN","PSSORPH",87,0)
 ..I $P($G(^PSDRUG(DLOOP,"I")),"^"),+$P($G(^("I")),"^")<DT Q
"RTN","PSSORPH",88,0)
 ..;Q:$P($G(^PSDRUG(DLOOP,2)),"^",3)'[TYPE
"RTN","PSSORPH",89,0)
 ..S PSONDS=$P($G(^PSDRUG(DLOOP,"DOS")),"^"),PSONDU=$P($G(^("DOS")),"^",2),PSOND=$P($G(^("ND")),"^",3),PSOND1=$P($G(^("ND")),"^")
"RTN","PSSORPH",90,0)
 ..K PSONDX I PSOND,PSOND1 I PSONDS=""!('PSONDU) S PSONDX=$$DFSU^PSNAPIS(PSOND1,PSOND)
"RTN","PSSORPH",91,0)
 ..I PSONDS="",PSOND,PSOND1 S PSONDS=$P($G(PSONDX),"^",4)
"RTN","PSSORPH",92,0)
 ..I 'PSONDU,PSOND,PSOND1 S PSONDU=$P($G(PSONDX),"^",5)
"RTN","PSSORPH",93,0)
 ..S PSODOS=+$P($G(^PS(50.7,POPD,0)),"^",2)
"RTN","PSSORPH",94,0)
 ..D SET2
"RTN","PSSORPH",95,0)
 D LEADP^PSSUTLA1
"RTN","PSSORPH",96,0)
 Q
"RTN","PSSORPH",97,0)
SET2 ;
"RTN","PSSORPH",98,0)
 D ZSET
"RTN","PSSORPH",99,0)
 I $G(PSLOCV)'="",$G(PSLOCV)["&" D AMP^PSSORPH1
"RTN","PSSORPH",100,0)
 S PSSX(PSOCT)="^"_$S($G(PSONDU)=0:"",1:$G(PSONDU))_"^"_$G(PSLOCV)_"^"_DLOOP_"^"_$G(PSONDS)_"^"_$G(PSSLDN)_"^"_$P($G(^PS(50.606,+$G(PSODOS),0)),"^")_"^"_$P($G(^("MISC")),"^")_"^"_$P($G(^("MISC")),"^",3)
"RTN","PSSORPH",101,0)
 S PSSX(PSOCT)=PSSX(PSOCT)_"^"_$P($G(^PS(50.606,+$G(PSODOS),"MISC")),"^",4)_$S("OX"'[$G(TYPE):"^^"_$G(PSSBC),1:"")
"RTN","PSSORPH",102,0)
 S $P(PSSX(PSOCT),"^",13)=$G(PSSOLDN)
"RTN","PSSORPH",103,0)
 I '$D(PSSX("DD",DLOOP)) D
"RTN","PSSORPH",104,0)
 .D REQS
"RTN","PSSORPH",105,0)
 .K PSSMAX I $G(TYPE)["O" D MAX
"RTN","PSSORPH",106,0)
 .S PSSX("DD",DLOOP)=$P($G(^PSDRUG(DLOOP,0)),"^")_"^"_$P($G(^(660)),"^",6)_"^"_$P($G(^(0)),"^",9)_"^"_$P($G(^(660)),"^",8)_"^"_$G(PSONDS)_"^"_$S($G(PSONDU):$P($G(^PS(50.607,+$G(PSONDU),0)),"^"),1:"")_"^"_$G(PSSMAX)_"^"_$G(PSSREQS)
"RTN","PSSORPH",107,0)
 .S PSSX("DD",DLOOP)=PSSX("DD",DLOOP)_"^"_$G(PSSLDN)_"^"_$G(PSSLDV)_"^"_0
"RTN","PSSORPH",108,0)
 S PSOCT=PSOCT+1
"RTN","PSSORPH",109,0)
 Q
"RTN","PSSORPH",110,0)
ZSET ;
"RTN","PSSORPH",111,0)
 K PSSLDN,PSSLNV
"RTN","PSSORPH",112,0)
 S PSSLDV=$P($G(^PS(50.606,+$G(PSODOS),"MISC")),"^")
"RTN","PSSORPH",113,0)
 ;K PSSLDN F PSSLDNN=0:0 S PSSLDNN=$O(^PS(50.606,+$G(PSODOS),"NOUN",PSSLDNN)) Q:'PSSLDNN!($D(PSSLDN))  S:$P($G(^(PSSLDNN,0)),"^")'="" PSSLDN=$P($G(^(0)),"^")
"RTN","PSSORPH",114,0)
 K PSSLDNN
"RTN","PSSORPH",115,0)
 Q
"RTN","PSSORPH",116,0)
MAX ;
"RTN","PSSORPH",117,0)
 K PSSMAX S PSSDEA=$P($G(^PSDRUG(DLOOP,0)),"^",3)
"RTN","PSSORPH",118,0)
 I PSSDEA["1"!(PSSDEA["2") S PSSMAX=0 Q
"RTN","PSSORPH",119,0)
 I PSSDEA["A",PSSDEA'["B" S PSSMAX=0 Q
"RTN","PSSORPH",120,0)
 I $P($G(^PSDRUG(DLOOP,"CLOZ1")),"^")="PSOCLO1",$G(PSSDFN) D  Q
"RTN","PSSORPH",121,0)
 .S PSSCLO=$O(^YSCL(603.01,"C",PSSDFN,0)) I PSSCLO,$P($G(^YSCL(603.01,+PSSCLO,0)),"^",3)="B" S PSSMAX=1 Q
"RTN","PSSORPH",122,0)
 .S PSSMAX=0
"RTN","PSSORPH",123,0)
 I PSSDEA["3"!(PSSDEA["4")!(PSSDEA["5") S PSSMAX=5 Q
"RTN","PSSORPH",124,0)
 S PSSMAX=11
"RTN","PSSORPH",125,0)
 Q
"RTN","PSSORPH",126,0)
SLS ;Convert dosage with /
"RTN","PSSORPH",127,0)
 Q:'$D(PSSX(PSSA))
"RTN","PSSORPH",128,0)
 ;*150 Correct Slash dosages
"RTN","PSSORPH",129,0)
 K PSSDZUNT
"RTN","PSSORPH",130,0)
 N PSSF,PSSF1,PSSF2,PSSG,PSSFA,PSSFA1,PSSFB,PSSFB1,PSSDZI,PSSDZSL,PSSDZND,PSSDZSL1,PSSDZSL2,PSSDZSL3,PSSDZSL4,PSSDZSL5,PSSDZ50,PSSGIEN
"RTN","PSSORPH",131,0)
 S PSSF=$P($G(PSSX(PSSA)),"^"),PSSG=$P($G(PSSX(PSSA)),"^",2)
"RTN","PSSORPH",132,0)
 I $G(^PS(50.607,PSSG,0))]"" S PSSGIEN=PSSG,PSSG=$P($G(^PS(50.607,PSSG,0)),"^")
"RTN","PSSORPH",133,0)
 I PSSG'["/" S $P(PSSX(PSSA),"^",11)=$P($G(PSSX(PSSA)),"^")_$G(PSSUNTS) Q
"RTN","PSSORPH",134,0)
 S PSSDZSL=0,PSSDZI=+$P($G(PSSX(PSSA)),"^",4),PSSDZ50=$P($G(^PSDRUG(PSSDZI,"DOS")),"^")
"RTN","PSSORPH",135,0)
 S PSSDZND=$$PSJST^PSNAPIS(+$P($G(^PSDRUG(PSSDZI,"ND")),"^"),+$P($G(^PSDRUG(PSSDZI,"ND")),"^",3)) S PSSDZND=+$P($G(PSSDZND),"^",2) ;I $G(PSSDZND),$G(PSSDZ50),+$G(PSSDZND)'=+$G(PSSDZ50) S PSSDZSL=1
"RTN","PSSORPH",136,0)
 S PSSFA=$P(PSSG,"/"),PSSFB=$P(PSSG,"/",2),PSSFA1=+$G(PSSFA),PSSFB1=+$G(PSSFB)
"RTN","PSSORPH",137,0)
 I '$G(PSSDZND) S $P(PSSX(PSSA),"^",11)=$P(PSSX(PSSA),"^") G SLSQ
"RTN","PSSORPH",138,0)
 S PSSDZSL2=PSSDZ50/PSSDZND,PSSDZSL3=PSSDZSL2*+$P($G(PSSX(PSSA)),"^",3) S PSSDZSL4=PSSDZSL3*$S($G(PSSFB1):PSSFB1,1:1) S PSSDZSL5=$S('$G(PSSFB1):PSSDZSL4_$G(PSSFB),1:PSSDZSL4_$P(PSSFB,PSSFB1,2))
"RTN","PSSORPH",139,0)
 S PSSF2=$S('$G(PSSFA1):PSSF,1:($G(PSSFA1)*PSSF))_$S($G(PSSFA1):$P(PSSFA,PSSFA1,2),1:PSSFA)_"/"_$G(PSSDZSL5)
"RTN","PSSORPH",140,0)
 ;S PSSDZUNT=$P(PSSG,"/")_"/"_$G(PSSDZSL4)_$S('$G(PSSFB1):$G(PSSFB),1:$P(PSSFB,PSSFB1,2)) S $P(PSSX(PSSA),"^",2)=PSSDZUNT
"RTN","PSSORPH",141,0)
 S PSSDZUNT=$P(PSSG,"/")_"/"_$G(PSSDZSL4)_$S('$G(PSSFB1):$G(PSSFB),1:$P(PSSFB,PSSFB1,2)) S $P(PSSX(PSSA),"^",2)=PSSDZUNT
"RTN","PSSORPH",142,0)
 S $P(PSSX(PSSA),"^",11)=PSSF2
"RTN","PSSORPH",143,0)
 S:$G(PSSGIEN) $P(PSSX(PSSA),"^",2)=PSSGIEN
"RTN","PSSORPH",144,0)
SLSQ K PSSDZUNT
"RTN","PSSORPH",145,0)
 Q
"RTN","PSSORPH",146,0)
REQS ;Schedule requirement flag
"RTN","PSSORPH",147,0)
 N PSSRF,PSSRFX,PSSRFZ
"RTN","PSSORPH",148,0)
 S PSSREQS=1
"RTN","PSSORPH",149,0)
 ;No longer needed
"RTN","PSSORPH",150,0)
 Q
"RTN","PSSORPH",151,0)
MULTI ;
"RTN","PSSORPH",152,0)
 S PL3="" F  S PL3=$O(PSSHOLD(PSSZ,PSSC,PL3)) Q:PL3=""  S PSSX(PSSA,PL3)=PSSHOLD(PSSZ,PSSC,PL3) D:'$D(PSSX("DD",+$P(PSSX(PSSA,PL3),"^",4)))
"RTN","PSSORPH",153,0)
 .S (PSIEN,DLOOP)=+$P(PSSX(PSSA,PL3),"^",4) K PSSMAX D:$G(TYPE)["O" MAX
"RTN","PSSORPH",154,0)
 .S PSSX("DD",PSIEN)=$P($G(^PSDRUG(PSIEN,0)),"^")_"^"_$P($G(^(660)),"^",6)_"^"_$P($G(^(0)),"^",9)_"^"_$P($G(^(660)),"^",8)_"^"_$P($G(^("DOS")),"^")_"^"_$G(PSSUNITX)_"^"_$G(PSSMAX)
"RTN","PSSORPH",155,0)
 .D REQS S PSSX("DD",PSIEN)=PSSX("DD",PSIEN)_"^"_$G(PSSREQS)_"^"_$G(PSNNN)_"^"_$G(PSSVERB)_"^"_1
"RTN","PSSORPH",156,0)
 Q
"RTN","PSSORPH",157,0)
PARN ;
"RTN","PSSORPH",158,0)
 N PSSNPL K PSSNP
"RTN","PSSORPH",159,0)
 Q:$G(PSNNN)=""
"RTN","PSSORPH",160,0)
 Q:$L(PSNNN)'>3
"RTN","PSSORPH",161,0)
 S PSSNPL=$E(PSNNN,($L(PSNNN)-2),$L(PSNNN))
"RTN","PSSORPH",162,0)
 I $G(PSSNPL)="(S)"!($G(PSSNPL)="(s)") D
"RTN","PSSORPH",163,0)
 .I $G(PSSUDOS)'>1 S PSSNP=$E(PSNNN,1,($L(PSNNN)-3))
"RTN","PSSORPH",164,0)
 .I $G(PSSUDOS)>1 S PSSNP=$E(PSNNN,1,($L(PSNNN)-3))_$E(PSSNPL,2)
"RTN","PSSORPH",165,0)
 Q
"RTN","PSSORPH",166,0)
LEAD ;Add leading zeros
"RTN","PSSORPH",167,0)
 F PSSMD=0:0 S PSSMD=$O(PSSX(PSSMD)) Q:'PSSMD  D
"RTN","PSSORPH",168,0)
 .F PSSMDN=1,5,11 I $E($P(PSSX(PSSMD),"^",PSSMDN),1)="." S $P(PSSX(PSSMD),"^",PSSMDN)="0"_$P(PSSX(PSSMD),"^",PSSMDN)
"RTN","PSSORPH",169,0)
 .I $O(PSSX(PSSMD,0)) D
"RTN","PSSORPH",170,0)
 ..F PSSMD1=0:0 S PSSMD1=$O(PSSX(PSSMD,PSSMD1)) Q:'PSSMD1  D
"RTN","PSSORPH",171,0)
 ...F PSSMDN=1,5,11 I $E($P(PSSX(PSSMD,PSSMD1),"^",PSSMDN),1)="." S $P(PSSX(PSSMD,PSSMD1),"^",PSSMDN)="0"_$P(PSSX(PSSMD,PSSMD1),"^",PSSMDN)
"RTN","PSSORPH",172,0)
 S PSSMD="" F  S PSSMD=$O(PSSX("DD",PSSMD)) Q:PSSMD=""  D
"RTN","PSSORPH",173,0)
 .I $E($P(PSSX("DD",PSSMD),"^",5),1)="." S $P(PSSX("DD",PSSMD),"^",5)="0"_$P(PSSX("DD",PSSMD),"^",5)
"RTN","PSSORPH",174,0)
 Q
"RTN","PSSP150")
0^^B29912^n/a
"RTN","PSSP150",1,0)
PSSP150 ;SMT - PSS*150 Post Install ; 8/31/2012
"RTN","PSSP150",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**150**;9/30/97;Build 2
"RTN","PSSP150",3,0)
 ;
"RTN","PSSP150",4,0)
 ; To correct Remedy HD344317, 
"RTN","PSSP150",5,0)
 ; Field .03 (IV FLAG) of File 50.7 (Pharmacy Orderable Item)
"RTN","PSSP150",6,0)
 ; will have write access from fileman restricted.
"RTN","PSSP150",7,0)
 ;
"RTN","PSSP150",8,0)
EN ;
"RTN","PSSP150",9,0)
 ;Update write access for IV FLAG field
"RTN","PSSP150",10,0)
 S ^DD(50.7,.03,9)="^"
"RTN","PSSP150",11,0)
 Q
"VER")
8.0^22.0
"BLD",8793,6)
^154
**END**
**END**
