EMERGENCY Released LR*5.2*420 SEQ #333
Extracted from mail message
**KIDS**:LR*5.2*420^

**INSTALL NAME**
LR*5.2*420
"BLD",8259,0)
LR*5.2*420^LAB SERVICE^0^3121026^y
"BLD",8259,4,0)
^9.64PA^^
"BLD",8259,6.3)
5
"BLD",8259,"ABPKG")
n
"BLD",8259,"KRN",0)
^9.67PA^779.2^20
"BLD",8259,"KRN",.4,0)
.4
"BLD",8259,"KRN",.401,0)
.401
"BLD",8259,"KRN",.402,0)
.402
"BLD",8259,"KRN",.403,0)
.403
"BLD",8259,"KRN",.5,0)
.5
"BLD",8259,"KRN",.84,0)
.84
"BLD",8259,"KRN",3.6,0)
3.6
"BLD",8259,"KRN",3.8,0)
3.8
"BLD",8259,"KRN",9.2,0)
9.2
"BLD",8259,"KRN",9.8,0)
9.8
"BLD",8259,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8259,"KRN",9.8,"NM",1,0)
LRCAPDAR^^0^B36352191
"BLD",8259,"KRN",9.8,"NM","B","LRCAPDAR",1)

"BLD",8259,"KRN",19,0)
19
"BLD",8259,"KRN",19.1,0)
19.1
"BLD",8259,"KRN",101,0)
101
"BLD",8259,"KRN",409.61,0)
409.61
"BLD",8259,"KRN",771,0)
771
"BLD",8259,"KRN",779.2,0)
779.2
"BLD",8259,"KRN",870,0)
870
"BLD",8259,"KRN",8989.51,0)
8989.51
"BLD",8259,"KRN",8989.52,0)
8989.52
"BLD",8259,"KRN",8994,0)
8994
"BLD",8259,"KRN","B",.4,.4)

"BLD",8259,"KRN","B",.401,.401)

"BLD",8259,"KRN","B",.402,.402)

"BLD",8259,"KRN","B",.403,.403)

"BLD",8259,"KRN","B",.5,.5)

"BLD",8259,"KRN","B",.84,.84)

"BLD",8259,"KRN","B",3.6,3.6)

"BLD",8259,"KRN","B",3.8,3.8)

"BLD",8259,"KRN","B",9.2,9.2)

"BLD",8259,"KRN","B",9.8,9.8)

"BLD",8259,"KRN","B",19,19)

"BLD",8259,"KRN","B",19.1,19.1)

"BLD",8259,"KRN","B",101,101)

"BLD",8259,"KRN","B",409.61,409.61)

"BLD",8259,"KRN","B",771,771)

"BLD",8259,"KRN","B",779.2,779.2)

"BLD",8259,"KRN","B",870,870)

"BLD",8259,"KRN","B",8989.51,8989.51)

"BLD",8259,"KRN","B",8989.52,8989.52)

"BLD",8259,"KRN","B",8994,8994)

"BLD",8259,"QUES",0)
^9.62^^
"BLD",8259,"REQB",0)
^9.611^1^1
"BLD",8259,"REQB",1,0)
LR*5.2*399^1
"BLD",8259,"REQB","B","LR*5.2*399",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2941128
"PKG",26,22,1,"PAH",1,0)
420^3121026^101049
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","LRCAPDAR")
0^1^B36352191^B15683759
"RTN","LRCAPDAR",1,0)
LRCAPDAR ;DALOI/FHS/RBN - LAB DSS RESULTS EXTRACT (LAR) ;6/29/12  16:42
"RTN","LRCAPDAR",2,0)
 ;;5.2;LAB SERVICE;**143,169,258,307,326,386,385,394,399,420**;Sep 27, 1994;Build 5
"RTN","LRCAPDAR",3,0)
 ;
"RTN","LRCAPDAR",4,0)
 ; Call with Start Date (LRSDT)  End Date (LREDT) FileMan format
"RTN","LRCAPDAR",5,0)
 ; Calling routine should have already purged ^LAR(64.036)
"RTN","LRCAPDAR",6,0)
EN S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LRCAPDAR",7,0)
 I $S($G(LRSDT)'?7N:1,$G(LREDT)'?7N:1,1:0) Q
"RTN","LRCAPDAR",8,0)
 L +^LAR(64.036):2 G:'$T END
"RTN","LRCAPDAR",9,0)
 N DIR,DIC,DIE,X,I,LR3,LRAA,LRAD,LRAN,LRC,LRSPDT,LRSPTM,UID,Y,DLAYGO,NEXTMO,RERUN ;420
"RTN","LRCAPDAR",10,0)
 N LRDFN,LRDN,LRY,LRNLT,LRLOINC,ARRAY,LRP8
"RTN","LRCAPDAR",11,0)
 S DLAYGO=64
"RTN","LRCAPDAR",12,0)
 I LRSDT>LREDT S X=LRSDT,LRSDT=LREDT,LREDT=X
"RTN","LRCAPDAR",13,0)
 S LRX1=9999999-(LRSDT_.0001),LRX2=9999999-(LREDT_.235959)
"RTN","LRCAPDAR",14,0)
 S:'$D(^LAR(64.036,0))#2 ^LAR(64.036,0)="LAB DSS LAR EXTRACT^64.036^2"
"RTN","LRCAPDAR",15,0)
LR ;
"RTN","LRCAPDAR",16,0)
 K ARRAY S ARRAY("ALL")="" D LOINC^ECXUTL6(.ARRAY) ;Build ^TMP($J,"ECXUTL6")
"RTN","LRCAPDAR",17,0)
 S NEXTMO=$E($$FMADD^XLFDT(LREDT,1),1,5) ;420 Get next month, year and month
"RTN","LRCAPDAR",18,0)
 S RERUN=$D(^XTMP("LRECX",NEXTMO)) ;420 Need to know if we're re-running an extract.
"RTN","LRCAPDAR",19,0)
 D MISSED ;420 Look at skipped entries from previous month's extract
"RTN","LRCAPDAR",20,0)
 S LRDFN=0 F  S LRDFN=$O(^LR(LRDFN)) Q:LRDFN<1  I $P($G(^LR(LRDFN,0)),U,2)=2 S LRN=^(0) D
"RTN","LRCAPDAR",21,0)
 . S DFN=$P(LRN,U,3),LRDPF=$P(LRN,U,2)
"RTN","LRCAPDAR",22,0)
 . S LRIDT=LRX2
"RTN","LRCAPDAR",23,0)
 . F  S LRIDT=$O(^LR(LRDFN,"CH",LRIDT)) Q:LRIDT<1!(LRIDT>LRX1)  I $D(^(LRIDT,0)) S LRVSPEC=$P(^(0),U,5),LRN0=^(0) D
"RTN","LRCAPDAR",24,0)
 . . I '$P(^LR(LRDFN,"CH",LRIDT,0),U,3) D SAVE Q  ;420 If accessioned and no result, put on list for next month.
"RTN","LRCAPDAR",25,0)
 . . I RERUN I +$G(^XTMP("LRECX",NEXTMO,LRDFN,LRIDT))=1 Q  ;420 Don't consider this record as it's already been counted in the following month's extract.
"RTN","LRCAPDAR",26,0)
 . . I RERUN I $G(ECXTL)'="LAR" K ^XTMP("LRECX",NEXTMO,LRDFN,LRIDT) ;420 If re-running the extract and it's not the untranslatable report then remove entry from next month's list as we now have a result
"RTN","LRCAPDAR",27,0)
 . . S LRDN=0 F  S LRDN=$O(^LR(LRDFN,"CH",LRIDT,LRDN)) Q:LRDN<1  D
"RTN","LRCAPDAR",28,0)
 . . . S LRY=$$TSTRES^LRRPU(LRDFN,"CH",LRIDT,LRDN,"",1)
"RTN","LRCAPDAR",29,0)
 . . . S LRP8=$P(LRY,U,8)
"RTN","LRCAPDAR",30,0)
 . . . S LRNLT=$P($P(LRP8,"!",2),";"),LRLOINC=$P($P(LRP8,"!",3),";")
"RTN","LRCAPDAR",31,0)
 . . . Q:'(+LRLOINC)
"RTN","LRCAPDAR",32,0)
 . . . I +$G(^TMP($J,"ECXUTL6",LRLOINC))>0 D SET
"RTN","LRCAPDAR",33,0)
 . . I $O(LRVV(0)) D FILE
"RTN","LRCAPDAR",34,0)
WRAP K DA,DR,DIC,DIE,DD,DO
"RTN","LRCAPDAR",35,0)
 S (X,DINUM)=1
"RTN","LRCAPDAR",36,0)
 S DIC="^LAR(64.036,",DIC(0)="LNM" D FILE^DICN S DA=+Y
"RTN","LRCAPDAR",37,0)
 G:Y<1 END
"RTN","LRCAPDAR",38,0)
 S DR="9///"_DT,DR(2,64.369)=".01///"_DT_";1///"_LRSDT_";2///"_LREDT_";3///"_$$NOW^LRAFUNC1_";4////"_$G(DUZ)
"RTN","LRCAPDAR",39,0)
 S DIE=DIC D ^DIE G END
"RTN","LRCAPDAR",40,0)
 Q
"RTN","LRCAPDAR",41,0)
SET S LRVV(+$P(^TMP($J,"ECXUTL6",LRLOINC),U,2),LRDN)=$TR($E($P(LRY,U),1,20),";","-")_U_$P(LRY,U,2)_U_LRNLT_U_LRLOINC
"RTN","LRCAPDAR",42,0)
 Q
"RTN","LRCAPDAR",43,0)
END L -^LAR(64.036)
"RTN","LRCAPDAR",44,0)
 K D,D0,D1,DA,DFN,DI,DIC,DIE,DR,I,II,LRDA,LRDPF,LRIDT,LRN,LRN0
"RTN","LRCAPDAR",45,0)
 K LRNOW,LRSB,LRSP,LRTS,LRVR,LRVSPEC,LRVV,LRX1,LRX2,X,DLAYGO
"RTN","LRCAPDAR",46,0)
 K LRDFN,D2,LRSP,LRTS,DINUM,^TMP($J,"ECXUTL6") Q
"RTN","LRCAPDAR",47,0)
FILE K DR,DA,DIC,DIR,LRPROV
"RTN","LRCAPDAR",48,0)
 D UID
"RTN","LRCAPDAR",49,0)
 S LRN0T1=$P(LRN0,U),LRN0T2=$P(LRN0,U,3),LRPROV=$P(LRN0,U,10)
"RTN","LRCAPDAR",50,0)
 S $P(LRN0,U)=$S(LRN0T2<LRN0T1:LRN0T2,1:LRN0T1)
"RTN","LRCAPDAR",51,0)
 S X=$P(^LAR(64.036,0),U,3) S:X<2 X=2 F X=X:1 Q:'$D(^LAR(64.036,X))
"RTN","LRCAPDAR",52,0)
 S DA=X,DIC="^LAR(64.036,",DINUM=X,DIC(0)="LNMF"
"RTN","LRCAPDAR",53,0)
 S LRN0T1=$E($P($P(LRN0,U),".",2),1,4) S:'LRN0T1 LRN0T1=0 I LRN0T1,$E(LRN0T1,3,4)>59 S LRN0T1=$E(LRN0T1,1,2)_"59"
"RTN","LRCAPDAR",54,0)
 S LRN0T2=$E($P($P(LRN0,U,3),".",2),1,4) S:'LRN0T2 LRN0T2=0
"RTN","LRCAPDAR",55,0)
 S DIC("DR")="1///"_LRDPF_";2///"_DFN_";3///"_$P($P(LRN0,U),".")_";4///"_LRN0T1_";5///"_$P($P(LRN0,U,3),".")_";6///"_LRN0T2_";7///`"_LRVSPEC_";12///`"_LRPROV
"RTN","LRCAPDAR",56,0)
 K DD,DO D FILE^DICN K DA S LRDA=Y Q:LRDA<1
"RTN","LRCAPDAR",57,0)
 S $P(^LAR(64.036,+LRDA,0),U,9)=LRSPDT,$P(^(0),U,10)=LRSPTM
"RTN","LRCAPDAR",58,0)
F2 S DA(1)=+LRDA
"RTN","LRCAPDAR",59,0)
 S DIC=DIC_DA(1)_",1,"
"RTN","LRCAPDAR",60,0)
 S DIC(0)="L",DIC("P")=$P(^DD(64.036,8,0),"^",2)
"RTN","LRCAPDAR",61,0)
 F LRTS=0:0 S LRTS=$O(LRVV(LRTS)) Q:LRTS<1  D
"RTN","LRCAPDAR",62,0)
 .S LRDN=0 F  S LRDN=$O(LRVV(LRTS,LRDN)) Q:LRDN<1  D DR1
"RTN","LRCAPDAR",63,0)
 K LRVV,LRN0T1,LRN0T2
"RTN","LRCAPDAR",64,0)
 Q
"RTN","LRCAPDAR",65,0)
DR1 K DR,DIR,DIE S DA=+LRDA
"RTN","LRCAPDAR",66,0)
 S DIC("DR")=".01///"_LRTS_";1///"_$P(LRVV(LRTS,LRDN),U)_";2///"_$P(LRVV(LRTS,LRDN),U,2)_";3///"_$P(LRVV(LRTS,LRDN),U,3)_";4///"_$P(LRVV(LRTS,LRDN),U,4)
"RTN","LRCAPDAR",67,0)
 S X=LRTS
"RTN","LRCAPDAR",68,0)
 K D0 D FILE^DICN
"RTN","LRCAPDAR",69,0)
 Q
"RTN","LRCAPDAR",70,0)
FIX S X=$P(^LAR(64.036,0),U,1,2) K ^LAR(64.036) S ^LAR(64.036,0)=X Q
"RTN","LRCAPDAR",71,0)
UID ;
"RTN","LRCAPDAR",72,0)
 S LRN0T2=$P(LRN0,U,3)
"RTN","LRCAPDAR",73,0)
 S LRSPDT=$P($P(LRN0,U),"."),LRSPTM=$E($P($P(LRN0,U),".",2),1,4)
"RTN","LRCAPDAR",74,0)
 D
"RTN","LRCAPDAR",75,0)
 . I 'LRSPTM S LRSPTM=1 Q
"RTN","LRCAPDAR",76,0)
 . I LRSPTM,$E(LRSPTM,3,4)>59 S LRSPTM=$E(LRSPTM,1,2)_"59"
"RTN","LRCAPDAR",77,0)
 S LRN0T1=LRSPDT_"."_LRSPTM,$P(LRN0,U)=LRN0T1
"RTN","LRCAPDAR",78,0)
 S UID=$P($G(^LR(LRDFN,"CH",LRIDT,"ORU")),U) Q:'$L(UID)
"RTN","LRCAPDAR",79,0)
 S LRC=$Q(^LRO(68,"C",UID)) Q:$QS(LRC,3)'=UID
"RTN","LRCAPDAR",80,0)
 S LRAA=$QS(LRC,4),LRAD=$QS(LRC,5),LRAN=$QS(LRC,6)
"RTN","LRCAPDAR",81,0)
 D
"RTN","LRCAPDAR",82,0)
 . N LR3,LRODT,LROODT,LRSN
"RTN","LRCAPDAR",83,0)
 . Q:'$G(^LRO(68,LRAA,1,LRAD,1,LRAN,0))  S LR3=^(0)
"RTN","LRCAPDAR",84,0)
 . S LRODT=$P(LR3,U,4),LRSN=$P(LR3,U,5)
"RTN","LRCAPDAR",85,0)
 . S LROODT=$P($G(^LRO(69,LRODT,1,LRSN,0)),U,5)
"RTN","LRCAPDAR",86,0)
 . I $G(LROODT) S $P(LRN0,U)=LROODT
"RTN","LRCAPDAR",87,0)
 Q
"RTN","LRCAPDAR",88,0)
 ;
"RTN","LRCAPDAR",89,0)
SAVE ;added in patch 420, save records for next month's review if no result
"RTN","LRCAPDAR",90,0)
 ;In this section we're saving any records that don't have a value in
"RTN","LRCAPDAR",91,0)
 ;the date report completed field in the CHEM multiple of the LAB DATA
"RTN","LRCAPDAR",92,0)
 ;file.  We don't save records if the user is running the lab
"RTN","LRCAPDAR",93,0)
 ;untranslatable report.  If we're re-running the extract for the month
"RTN","LRCAPDAR",94,0)
 ;then we don't count the record if it's been counted in a subsequent
"RTN","LRCAPDAR",95,0)
 ;month's extract. Finally, we set the record into the XTMP global for
"RTN","LRCAPDAR",96,0)
 ;later retrieval.  It will be deleted one year from being stored.
"RTN","LRCAPDAR",97,0)
 I $G(ECXTL)="LAR" Q  ;Don't add to the list if running untranslatable report.
"RTN","LRCAPDAR",98,0)
 I RERUN I +$G(^XTMP("LRECX",NEXTMO,LRDFN,LRIDT)) Q  ;Don't update an entry on the list if we've already counted it.
"RTN","LRCAPDAR",99,0)
 I '$D(^XTMP("LRECX",NEXTMO,0)) S ^XTMP("LRECX",NEXTMO,0)=$$FMADD^XLFDT($$DT^XLFDT,365)_"^"_$$DT^XLFDT_"^"_"Accessioned tests without results"
"RTN","LRCAPDAR",100,0)
 S ^XTMP("LRECX",NEXTMO,LRDFN,LRIDT)="" ;save specific record
"RTN","LRCAPDAR",101,0)
 Q
"RTN","LRCAPDAR",102,0)
 ;
"RTN","LRCAPDAR",103,0)
MISSED ;added in patch 420, process any records missed in previous month's extract
"RTN","LRCAPDAR",104,0)
 ;In this section we will look at the lab tests from the previous month
"RTN","LRCAPDAR",105,0)
 ;that didn't have a result when the extract was run.  If they now have
"RTN","LRCAPDAR",106,0)
 ;a result, they'll be counted if they match the LOINC criteria.  We 
"RTN","LRCAPDAR",107,0)
 ;only check records in the month after they were identified as no lab
"RTN","LRCAPDAR",108,0)
 ;test that we report on should take more than 30 days to result.  When
"RTN","LRCAPDAR",109,0)
 ;we count a test that we previously skipped, the entry in the XTMP
"RTN","LRCAPDAR",110,0)
 ;global is set equal to 1 to denote that we've processed this record
"RTN","LRCAPDAR",111,0)
 ;and it shouldn't be counted in future extracts or in reruns of
"RTN","LRCAPDAR",112,0)
 ;an extract month.
"RTN","LRCAPDAR",113,0)
 N CURMO,LRDFN,LRN,LRDN,LRIDT,LRVSPEC,LRN0,LRY,LRP8,LRNLT,LRLOINC,LRVV
"RTN","LRCAPDAR",114,0)
 S CURMO=$E(LRSDT,1,5) ;Year and month we're extracting
"RTN","LRCAPDAR",115,0)
 I '$D(^XTMP("LRECX",CURMO,0)) Q  ;No records to review
"RTN","LRCAPDAR",116,0)
 S LRDFN=0 F  S LRDFN=$O(^XTMP("LRECX",CURMO,LRDFN)) Q:LRDFN<1  I $P($G(^LR(LRDFN,0)),U,2)=2 S LRN=^(0) D
"RTN","LRCAPDAR",117,0)
 . S DFN=$P(LRN,U,3),LRDPF=$P(LRN,U,2)
"RTN","LRCAPDAR",118,0)
 . S LRIDT=0
"RTN","LRCAPDAR",119,0)
 . F  S LRIDT=$O(^XTMP("LRECX",CURMO,LRDFN,LRIDT)) Q:LRIDT<1  I $D(^LR(LRDFN,"CH",LRIDT,0)),$P(^(0),U,3) S LRVSPEC=$P(^(0),U,5),LRN0=^(0) D
"RTN","LRCAPDAR",120,0)
 . . S LRDN=0 F  S LRDN=$O(^LR(LRDFN,"CH",LRIDT,LRDN)) Q:LRDN<1  D
"RTN","LRCAPDAR",121,0)
 . . . S LRY=$$TSTRES^LRRPU(LRDFN,"CH",LRIDT,LRDN,"",1)
"RTN","LRCAPDAR",122,0)
 . . . S LRP8=$P(LRY,U,8)
"RTN","LRCAPDAR",123,0)
 . . . S LRNLT=$P($P(LRP8,"!",2),";"),LRLOINC=$P($P(LRP8,"!",3),";")
"RTN","LRCAPDAR",124,0)
 . . . Q:'(+LRLOINC)
"RTN","LRCAPDAR",125,0)
 . . . I +$G(^TMP($J,"ECXUTL6",LRLOINC))>0 D SET
"RTN","LRCAPDAR",126,0)
 . . I $O(LRVV(0)) D FILE I $G(ECXTL)'="LAR" S ^XTMP("LRECX",CURMO,LRDFN,LRIDT)=1 ;Mark it as counted in this month's extract
"RTN","LRCAPDAR",127,0)
 Q
"VER")
8.0^22.0
"BLD",8259,6)
^333
**END**
**END**
