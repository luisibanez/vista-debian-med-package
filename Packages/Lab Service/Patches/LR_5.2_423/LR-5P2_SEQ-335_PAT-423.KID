Released LR*5.2*423 SEQ #335
Extracted from mail message
**KIDS**:LR*5.2*423^

**INSTALL NAME**
LR*5.2*423
"BLD",9150,0)
LR*5.2*423^LAB SERVICE^0^3121114^y
"BLD",9150,1,0)
^^10^10^3121114^^
"BLD",9150,1,1,0)
 
"BLD",9150,1,2,0)
This patch is a VM patch that addresses 2 issues in the Lab package.
"BLD",9150,1,3,0)
 
"BLD",9150,1,4,0)
 
"BLD",9150,1,5,0)
 
"BLD",9150,1,6,0)
1.      In building the collection list, if an order fails to accession,
"BLD",9150,1,7,0)
    sometimes subsequent orders fail to accession for the same reason
"BLD",9150,1,8,0)
    even though the subsequent orders are ok.
"BLD",9150,1,9,0)
 
"BLD",9150,1,10,0)
2.      Laboratory-related locking issues when doing accessioning
"BLD",9150,4,0)
^9.64PA^^
"BLD",9150,6)
1^
"BLD",9150,6.3)
2
"BLD",9150,"ABPKG")
n
"BLD",9150,"KRN",0)
^9.67PA^779.2^20
"BLD",9150,"KRN",.4,0)
.4
"BLD",9150,"KRN",.401,0)
.401
"BLD",9150,"KRN",.402,0)
.402
"BLD",9150,"KRN",.403,0)
.403
"BLD",9150,"KRN",.5,0)
.5
"BLD",9150,"KRN",.84,0)
.84
"BLD",9150,"KRN",3.6,0)
3.6
"BLD",9150,"KRN",3.8,0)
3.8
"BLD",9150,"KRN",9.2,0)
9.2
"BLD",9150,"KRN",9.8,0)
9.8
"BLD",9150,"KRN",9.8,"NM",0)
^9.68A^3^2
"BLD",9150,"KRN",9.8,"NM",2,0)
LRPHSET1^^0^B10152359
"BLD",9150,"KRN",9.8,"NM",3,0)
LROE^^0^B34630277
"BLD",9150,"KRN",9.8,"NM","B","LROE",3)

"BLD",9150,"KRN",9.8,"NM","B","LRPHSET1",2)

"BLD",9150,"KRN",19,0)
19
"BLD",9150,"KRN",19.1,0)
19.1
"BLD",9150,"KRN",101,0)
101
"BLD",9150,"KRN",409.61,0)
409.61
"BLD",9150,"KRN",771,0)
771
"BLD",9150,"KRN",779.2,0)
779.2
"BLD",9150,"KRN",870,0)
870
"BLD",9150,"KRN",8989.51,0)
8989.51
"BLD",9150,"KRN",8989.52,0)
8989.52
"BLD",9150,"KRN",8994,0)
8994
"BLD",9150,"KRN","B",.4,.4)

"BLD",9150,"KRN","B",.401,.401)

"BLD",9150,"KRN","B",.402,.402)

"BLD",9150,"KRN","B",.403,.403)

"BLD",9150,"KRN","B",.5,.5)

"BLD",9150,"KRN","B",.84,.84)

"BLD",9150,"KRN","B",3.6,3.6)

"BLD",9150,"KRN","B",3.8,3.8)

"BLD",9150,"KRN","B",9.2,9.2)

"BLD",9150,"KRN","B",9.8,9.8)

"BLD",9150,"KRN","B",19,19)

"BLD",9150,"KRN","B",19.1,19.1)

"BLD",9150,"KRN","B",101,101)

"BLD",9150,"KRN","B",409.61,409.61)

"BLD",9150,"KRN","B",771,771)

"BLD",9150,"KRN","B",779.2,779.2)

"BLD",9150,"KRN","B",870,870)

"BLD",9150,"KRN","B",8989.51,8989.51)

"BLD",9150,"KRN","B",8989.52,8989.52)

"BLD",9150,"KRN","B",8994,8994)

"BLD",9150,"QUES",0)
^9.62^^
"BLD",9150,"REQB",0)
^9.611^2^2
"BLD",9150,"REQB",1,0)
LR*5.2*240^2
"BLD",9150,"REQB",2,0)
LR*5.2*360^2
"BLD",9150,"REQB","B","LR*5.2*240",1)

"BLD",9150,"REQB","B","LR*5.2*360",2)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
423^3121114^33308
"PKG",26,22,1,"PAH",1,1,0)
^^10^10^3121114
"PKG",26,22,1,"PAH",1,1,1,0)
 
"PKG",26,22,1,"PAH",1,1,2,0)
This patch is a VM patch that addresses 2 issues in the Lab package.
"PKG",26,22,1,"PAH",1,1,3,0)
 
"PKG",26,22,1,"PAH",1,1,4,0)
 
"PKG",26,22,1,"PAH",1,1,5,0)
 
"PKG",26,22,1,"PAH",1,1,6,0)
1.      In building the collection list, if an order fails to accession,
"PKG",26,22,1,"PAH",1,1,7,0)
    sometimes subsequent orders fail to accession for the same reason
"PKG",26,22,1,"PAH",1,1,8,0)
    even though the subsequent orders are ok.
"PKG",26,22,1,"PAH",1,1,9,0)
 
"PKG",26,22,1,"PAH",1,1,10,0)
2.      Laboratory-related locking issues when doing accessioning
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","LROE")
0^3^B34630277^B34568741
"RTN","LROE",1,0)
LROE ;DALOI/CJS/FHS-LAB ORDER ENTRY AND ACCESSION ;8/11/97
"RTN","LROE",2,0)
 ;;5.2;LAB SERVICE;**100,121,201,221,263,286,360,423**;Sep 27, 1994;Build 2
"RTN","LROE",3,0)
 K LRORIFN,LRNATURE,LREND,LRORDRR
"RTN","LROE",4,0)
 S LRLWC="WC"
"RTN","LROE",5,0)
 D ^LRPARAM
"RTN","LROE",6,0)
 I $G(LREND) S LREND=0 Q
"RTN","LROE",7,0)
L5 ;
"RTN","LROE",8,0)
NEXT ;from LROE1
"RTN","LROE",9,0)
 K DIR
"RTN","LROE",10,0)
 I $D(LROESTAT) D:$P(LRPARAM,U,14) ^LRCAPV I $G(LREND) K LRLONG,LRPANEL Q
"RTN","LROE",11,0)
 S (LRODT,X,DT)=$$DT^XLFDT(),LRODT0=$$FMTE^XLFDT(DT,5)
"RTN","LROE",12,0)
 I '$D(^LRO(69,DT,1,0)) S ^LRO(69,DT,0)=DT,^LRO(69,DT,1,0)="^69.01PA^^",^LRO(69,"B",DT,DT)=""
"RTN","LROE",13,0)
 I $D(^LAB(69.9,1,"RO")),+$H'=+$P(^("RO"),U) D
"RTN","LROE",14,0)
 . W $C(7),!,"ROLLOVER ",$S($P(^("RO"),U,2):"IS RUNNING.",1:"HAS NOT RUN.")," ACCESSIONING SHOULDN'T BE DONE NOW.",$C(7),!
"RTN","LROE",15,0)
 . S DIR("A")="  Are you sure you want to continue",DIR(0)="Y",DIR("B")="No"
"RTN","LROE",16,0)
 I $T D ^DIR G END:$D(DIRUT) I Y'=1 W !,"OK, try later." Q
"RTN","LROE",17,0)
 S X="T-7",%DT="" D ^%DT S LRTM7=+Y
"RTN","LROE",18,0)
 ;W @IOF
"RTN","LROE",19,0)
 K DIC,LRSND,LRSN
"RTN","LROE",20,0)
 W !!,"Select Order number: " R LRORD:DTIME Q:LRORD["^"!(LRORD[".")!($D(LRLONG)&(LRORD=""))
"RTN","LROE",21,0)
 W @IOF S M9=0 G QUICK^LROE1:LRORD=""
"RTN","LROE",22,0)
 I $L(LRORD)>8 W !,"The order number entered is too long." H 1 G NEXT
"RTN","LROE",23,0)
 S:LRORD?.N LRORD=+LRORD IF LRORD'?.N D QMSG G NEXT
"RTN","LROE",24,0)
 I '$D(^LRO(69,"C",LRORD)) W !!?10,"No order exist with that number ",$C(7),! G NEXT
"RTN","LROE",25,0)
 S (LRCHK,LRNONE)=1,(M9,LRODT)=0
"RTN","LROE",26,0)
 F  S LRODT=+$O(^LRO(69,"C",LRORD,LRODT)) Q:LRODT<1  D
"RTN","LROE",27,0)
 . S DA=0 F  S DA=$O(^LRO(69,"C",LRORD,LRODT,DA)) Q:DA<1  S LRCHK=LRCHK-1 S:LRNONE'=2 LRNONE=0 D LROE2
"RTN","LROE",28,0)
 I DOD'="" S Y=DOD D DD^LRX W !,!,?5,@LRVIDO,"Patient ",PNM," died on: ",Y,@LRVIDOF W !
"RTN","LROE",29,0)
 I DOD'="" D  I Y=0!($D(DIRUT)) K DIRUT,DTOUT,DUOUT,Y D KVAR^LRX G NEXT
"RTN","LROE",30,0)
 . K Y
"RTN","LROE",31,0)
 . S DIR(0)="Y"
"RTN","LROE",32,0)
 . S DIR("A")="Do you wish to continue with this accession [Yes/No]"
"RTN","LROE",33,0)
 . S DIR("T")=120
"RTN","LROE",34,0)
 . D ^DIR K DIR
"RTN","LROE",35,0)
 I LRNONE=2,LRCHK<1 W !,"The order has already been partially accessioned." H 1
"RTN","LROE",36,0)
 I LRNONE=2,LRCHK>0 W !,"The order has already been accessioned." H 1 G NEXT
"RTN","LROE",37,0)
 I LRNONE=1 W !,"No order exists with that number." H 1 G NEXT
"RTN","LROE",38,0)
 I '$$GOT(LRORD,LRODT) G NEXT ;W !!,"All tests for this order have been canceled.",!,"Are you sure you want to accession it" S %=1 D YN^DICN I %'=1 G NEXT
"RTN","LROE",39,0)
 K DIR S DIR("A")="Is this the correct order",DIR(0)="Y"
"RTN","LROE",40,0)
 S DIR("B")="Yes"
"RTN","LROE",41,0)
 D ^DIR K DIR
"RTN","LROE",42,0)
 I $D(DIRUT)!(Y'=1) K LRSN G NEXT
"RTN","LROE",43,0)
 L +^LRO(69,"C",LRORD):$G(DILOCKTM,3)
"RTN","LROE",44,0)
 I '$T W !?5,"Someone else is editing this Order",!!,$C(7) G NEXT
"RTN","LROE",45,0)
 K %DT
"RTN","LROE",46,0)
 S LRSTATUS="C",%DT("B")=""
"RTN","LROE",47,0)
 D TIME K %DT
"RTN","LROE",48,0)
 D:$G(LRCDT)<1 UNL69 G NEXT:LRCDT<1
"RTN","LROE",49,0)
 S LRTIM=+LRCDT
"RTN","LROE",50,0)
 ;S:'$P(^LRO(69,LRODT,1,LRSN,0),U,8) $P(^(0),U,8)=LRTIM
"RTN","LROE",51,0)
 S LRUN=$P(LRCDT,U,2) K LRCDT,LRSN
"RTN","LROE",52,0)
MORE I M9>1 K DIR S DIR("A")="Do you have the entire order",DIR(0)="Y" D ^DIR K DIR S:Y=1 M9=0
"RTN","LROE",53,0)
 I $D(DIRUT) D UNL69 G NEXT
"RTN","LROE",54,0)
 S (LRODT,LRSND)=0
"RTN","LROE",55,0)
 F  S LRODT=$O(^LRO(69,"C",LRORD,LRODT)) Q:LRODT<1  D
"RTN","LROE",56,0)
 . S LRSND=0
"RTN","LROE",57,0)
 . F  S LRSND=$O(^LRO(69,"C",LRORD,LRODT,LRSND)) Q:LRSND<1  D
"RTN","LROE",58,0)
 . . I $D(^LRO(69,LRODT,1,LRSND,1)),$P(^(1),U,4)="C" Q
"RTN","LROE",59,0)
 . . S LRSN(LRSND)=LRSND,LRSN=LRSND
"RTN","LROE",60,0)
 . . K LRAA D Q15^LROE2 K LRSN
"RTN","LROE",61,0)
 D TASK,UNL69
"RTN","LROE",62,0)
 G NEXT
"RTN","LROE",63,0)
 ;
"RTN","LROE",64,0)
 ;
"RTN","LROE",65,0)
LROE2 ;
"RTN","LROE",66,0)
 I $D(^LRO(69,LRODT,1,DA,1)),$P(^(1),U,4)="C" S LRNONE=2,LRCHK=LRCHK+1
"RTN","LROE",67,0)
 K LRSN
"RTN","LROE",68,0)
 S (LRSN,LRSN(DA))=+DA
"RTN","LROE",69,0)
 I '$D(^LRO(69,LRODT,1,LRSN,0)) Q
"RTN","LROE",70,0)
 S M9=$G(M9)+1,LRZX=^LRO(69,LRODT,1,LRSN,0),LRDFN=+LRZX,LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3) D PT^LRX W !,PNM,?30,SSN S LRWRDS=LRWRD
"RTN","LROE",71,0)
 W ?45,"Requesting location: ",$P(LRZX,U,7) S Y=$P(LRZX,U,5) D DD^LRX W !,"Date/Time Ordered: ",Y,?45,"By: ",$S($D(^VA(200,+$P(LRZX,U,2),0)):$P(^(0),U),1:"")
"RTN","LROE",72,0)
 S LRSVSN=LRSN D ORDER^LROS S LRSN=LRSVSN
"RTN","LROE",73,0)
 Q
"RTN","LROE",74,0)
 ;
"RTN","LROE",75,0)
 ;
"RTN","LROE",76,0)
QMSG W !,"Enter the order entry number assigned when the test was ordered."
"RTN","LROE",77,0)
 W:'$D(LRLONG) !,"If the test has not been ordered, type the RETURN key to order the test."
"RTN","LROE",78,0)
 W !,"To exit, type the ""^"" key and RETURN key."
"RTN","LROE",79,0)
 Q
"RTN","LROE",80,0)
 ;
"RTN","LROE",81,0)
 ;
"RTN","LROE",82,0)
YN R X:DTIME S:'$T DTOUT=1 Q:X=""!(X["N")!(X["Y")
"RTN","LROE",83,0)
 W !,"Answer 'Y' or 'N': " G YN
"RTN","LROE",84,0)
 ;
"RTN","LROE",85,0)
 ;
"RTN","LROE",86,0)
EN ;
"RTN","LROE",87,0)
LROEN S LRNCWL=1
"RTN","LROE",88,0)
 D LROE,END K LRNCWL
"RTN","LROE",89,0)
 Q
"RTN","LROE",90,0)
 ;
"RTN","LROE",91,0)
 ;
"RTN","LROE",92,0)
EN01 ; ENTER ORDER # THEN ENTER DATA
"RTN","LROE",93,0)
STAT ;
"RTN","LROE",94,0)
 D ^LRPARAM
"RTN","LROE",95,0)
 I '$D(LRLABKY) W !!?10,"You do not have the proper security Keys",! Q
"RTN","LROE",96,0)
 ;
"RTN","LROE",97,0)
 ; Select peforming laboratory
"RTN","LROE",98,0)
 S X=$$SELPL^LRVERA(DUZ(2))
"RTN","LROE",99,0)
 I X<1 D END Q
"RTN","LROE",100,0)
 I X'=DUZ(2) N LRPL S LRPL=X
"RTN","LROE",101,0)
 ;
"RTN","LROE",102,0)
 S LRLONG="",LRPANEL=0,LROESTAT=""
"RTN","LROE",103,0)
 S %H=$H-60 D YMD^LRX S LRTM60=9999999-X
"RTN","LROE",104,0)
 D LROE K LRTM60,LRLONG,LREND,LROESTAT
"RTN","LROE",105,0)
 D END
"RTN","LROE",106,0)
 Q
"RTN","LROE",107,0)
 ;
"RTN","LROE",108,0)
 ;
"RTN","LROE",109,0)
TIME ;from LROE1, LRORD1
"RTN","LROE",110,0)
 S %DT="SET" W !,"Collection Date@Time: ",$S($D(%DT("B")):%DT("B"),1:"NOW"),"//" R X:DTIME I '$T!(X="^") S LRCDT=-1 Q
"RTN","LROE",111,0)
 S:X="" X=$S($D(%DT("B")):%DT("B"),1:"N")
"RTN","LROE",112,0)
 W:X["?" !!,"You may enter ""T@U"" or just ""U"", for Today at Unknown time",!!
"RTN","LROE",113,0)
 I X["@U",$P(X,"@U",2)="" S X=$P(X,"@U",1) D ^%DT G TIME:Y<1 S LRCDT=+Y_"^1" Q
"RTN","LROE",114,0)
 S:X="U" LRCDT=DT_"^1"
"RTN","LROE",115,0)
 I X'="U" D ^%DT D:X'["?" TIME1 G TIME:X["?" S LRCDT=+Y_"^" G TIME:Y'["."
"RTN","LROE",116,0)
 Q
"RTN","LROE",117,0)
 ;
"RTN","LROE",118,0)
TIME1 S X1=X,Y1=Y D TIME2 S X=X1,Y=Y1 K X1,Y1
"RTN","LROE",119,0)
 Q
"RTN","LROE",120,0)
 ;
"RTN","LROE",121,0)
TIME2 S X="N",%DT="ST" D ^%DT Q:Y1'>Y  F  W !,"You have specified a collection time in the future.  Are you sure" S %=2 D YN^DICN Q:%  W !,"Answer 'Y'es or 'N'o."
"RTN","LROE",122,0)
 S:%'=1 X="?" S X1=X
"RTN","LROE",123,0)
 Q
"RTN","LROE",124,0)
 ;
"RTN","LROE",125,0)
 ;
"RTN","LROE",126,0)
TASK ;
"RTN","LROE",127,0)
 I $D(LRLABLIO),$D(LRLBL) S ZTRTN="ENT^LRLABLD",ZTDTH=$H,ZTDESC="LAB LABELS",ZTIO=LRLABLIO,ZTSAVE("LRLBL(")="" D ^%ZTLOAD
"RTN","LROE",128,0)
 K LRLBL
"RTN","LROE",129,0)
 I $D(LRCSQ),'$O(^XTMP("LRCAP",LRCSQ,DUZ,0)) K ^XTMP("LRCAP",LRCSQ,DUZ),LRCSQ
"RTN","LROE",130,0)
 I $D(LRCSQ),$P($G(^LRO(68,+LRAA,0)),U,16) D STD^LRCAPV
"RTN","LROE",131,0)
 D STOP^LRCAPV K LRCOM,LRSPCDSC,LRCCOM,LRTCOM
"RTN","LROE",132,0)
 Q
"RTN","LROE",133,0)
 ;
"RTN","LROE",134,0)
 ;
"RTN","LROE",135,0)
END K DIR,DIRUT,GOT
"RTN","LROE",136,0)
 D ^LRORDK,LROEND^LRORDK,STOP^LRCAPV
"RTN","LROE",137,0)
 Q
"RTN","LROE",138,0)
 ;
"RTN","LROE",139,0)
 ;
"RTN","LROE",140,0)
GOT(ORD,ODT) ;See if all tests have been canceled
"RTN","LROE",141,0)
 N I,SN,ODT
"RTN","LROE",142,0)
 S (GOT,ODT,SN)=0
"RTN","LROE",143,0)
 F  S ODT=$O(^LRO(69,"C",ORD,ODT)) Q:ODT<1  D
"RTN","LROE",144,0)
 . S SN=0 F  S SN=$O(^LRO(69,"C",ORD,ODT,SN)) Q:SN<1!(GOT)  D
"RTN","LROE",145,0)
 . . Q:'$D(^LRO(69,ODT,1,SN,0))
"RTN","LROE",146,0)
 . . S I=0 F  S I=$O(^LRO(69,ODT,1,SN,2,I)) Q:I<1  I $D(^(I,0)),'$P(^(0),"^",11) S GOT=1 Q
"RTN","LROE",147,0)
 Q GOT
"RTN","LROE",148,0)
 ;
"RTN","LROE",149,0)
 ;
"RTN","LROE",150,0)
UNL69 ;
"RTN","LROE",151,0)
 L -^LRO(69,"C",+$G(LRORD))
"RTN","LROE",152,0)
 Q
"RTN","LRPHSET1")
0^2^B10152359^B10170497
"RTN","LRPHSET1",1,0)
LRPHSET1 ;SLC/CJS-COLLECTION LIST TO ACCESSIONS ;8/11/97
"RTN","LRPHSET1",2,0)
 ;;5.2;LAB SERVICE;**121,191,221,240,423**;Sep 27, 1994;Build 2
"RTN","LRPHSET1",3,0)
 Q
"RTN","LRPHSET1",4,0)
EN ;from LRPHSET
"RTN","LRPHSET1",5,0)
 K ^LRO(69,DT,1,"AD") S $P(^LAB(69.9,1,5),"^",10,12)=1_"^"_$H_"^"_$S($D(DUZ):DUZ,1:"")
"RTN","LRPHSET1",6,0)
 S LRDFN=0 F  S LRDFN=$O(^LRO(69,DT,1,"AA",LRDFN)) Q:LRDFN<1  K T D S6
"RTN","LRPHSET1",7,0)
 S LRLOC="",LRCOUNT=0,LRDUZ(2)=$S($D(DUZ(2)):DUZ(2),1:"") F LRPH=0:0 S LRLOC=$O(^LRO(69,DT,1,"AD",LRLOC)) Q:LRLOC=""  D S4
"RTN","LRPHSET1",8,0)
 S $P(^LAB(69.9,1,5),"^",10)=0
"RTN","LRPHSET1",9,0)
 G END
"RTN","LRPHSET1",10,0)
S4 K DIC S D="C",X=LRLOC,DIC(0)="Z",DIC=44 D IX^DIC S LRDUZ(2)=$S(Y<1:DUZ(2),1:$S($P(Y(0),U,4):$P(Y(0),U,4),1:DUZ(2)))
"RTN","LRPHSET1",11,0)
 S LRDFN=0 F  S LRDFN=$O(^LRO(69,DT,1,"AD",LRLOC,LRDFN)) Q:LRDFN<1  D S4A
"RTN","LRPHSET1",12,0)
 Q
"RTN","LRPHSET1",13,0)
S4A S LRSN=0 F  S LRSN=$O(^LRO(69,DT,1,"AD",LRLOC,LRDFN,LRSN)) Q:LRSN<1  D:$D(^LRO(69,DT,1,LRSN,1)) S4C D:'($D(^LRO(69,DT,1,LRSN,1))#2)&($D(^(0))) S4B
"RTN","LRPHSET1",14,0)
 Q
"RTN","LRPHSET1",15,0)
S4B S X=^LRO(69,DT,1,LRSN,0) I $P(X,U,4)="LC",LRDFN=+X,$P(X,U,8)'>LRDTI S:$$GOT(DT,LRSN) LRCOUNT=LRCOUNT+1 D S5
"RTN","LRPHSET1",16,0)
 Q
"RTN","LRPHSET1",17,0)
S4C I $P(^LRO(69,DT,1,LRSN,1),U)'>LRDTI S X=^(0) I $P(X,U,4)="LC",LRDFN=+X,$P(X,U,8)'>LRDTI D S5
"RTN","LRPHSET1",18,0)
 Q
"RTN","LRPHSET1",19,0)
S5 S ^LRO(69,DT,1,"AC",LRLOC,LRSN)=1,LRSCR=$S($D(^LRO(69,DT,1,LRSN,1)):$P(^(1),U,3,99),1:""),^(1)=LRDTI_"^1^"_LRSCR,LRTJ=$P(^(0),U,3,4)_"^"_DT,LRSAMP=$P(LRTJ,U,1)
"RTN","LRPHSET1",20,0)
 S LRSPEC=$P(^LAB(62,LRSAMP,0),U,2),I=$O(^LRO(69,DT,1,LRSN,6,0)) K LRSPCDSC S:I LRSPCDSC=^(I,0)
"RTN","LRPHSET1",21,0)
 I $D(^LRO(69,DT,1,LRSN,1)),'$L($P(^(1),U,4)),$D(^(3)) S LRLLOC=$P(^LRO(69,DT,1,LRSN,0),U,7),LROLLOC=$P(^(0),U,9) D REUP^LRPHSET2
"RTN","LRPHSET1",22,0)
 D OLD^LRORDST K LRTJ Q
"RTN","LRPHSET1",23,0)
S6 S T="",LRSN=0 F  S LRSN=$O(^LRO(69,DT,1,"AA",LRDFN,LRSN)) Q:LRSN<1  D S6A
"RTN","LRPHSET1",24,0)
 S LRSAMP=0 F  S LRSAMP=$O(T(LRSAMP)) Q:LRSAMP<1  S LRSTEP=0 D S7^LRPHSET2 S LRSTEP=1 D S7^LRPHSET2
"RTN","LRPHSET1",25,0)
 Q
"RTN","LRPHSET1",26,0)
S6A I '$S($D(^LRO(69,DT,1,LRSN,0)):$L($P(^(0),U,2)),1:0) Q
"RTN","LRPHSET1",27,0)
 Q:$P(^LRO(69,DT,1,LRSN,0),U,4)'="LC"  Q:$P(^(0),U,8)>LRDTI  I $D(^(1)),$L($P(^(1),U,4)) Q
"RTN","LRPHSET1",28,0)
 Q:'$D(^LRO(69,DT,1,LRSN,2,0))  Q:'$$GOT(DT,LRSN)
"RTN","LRPHSET1",29,0)
 S LRSAMP=$P(^LRO(69,DT,1,LRSN,0),U,3),LRLLOC=$E($P(^(0),U,7),1,30),LROLLOC=$P(^(0),U,9)
"RTN","LRPHSET1",30,0)
 S X=^LR(LRDFN,0),LRDPF=$P(X,U,2) I LRDPF=2,$D(^DPT(+$P(X,U,3),.1)) S LRLLOC=^(.1) D DPT^LRWU S $P(^LRO(69,DT,1,LRSN,0),U,7)=$S($L(LRLLOC):LRLLOC,1:"UNKNOWN")
"RTN","LRPHSET1",31,0)
 S:'$L(LRLLOC) LRLLOC="UNKNOWN" Q:LRSAMP<1  S ^LRO(69,DT,1,"AD",LRLLOC,LRDFN,LRSN)=""
"RTN","LRPHSET1",32,0)
 S I=0 F  S I=$O(^LRO(69,DT,1,LRSN,2,I)) Q:I<1  S X=^(I,0) I '$P(X,"^",6),'$P(X,"^",11) S T(LRSAMP,+X,LRSN)=I_U_$P(X,U,2)
"RTN","LRPHSET1",33,0)
 Q
"RTN","LRPHSET1",34,0)
END Q  ;BACK TO LRPHSET
"RTN","LRPHSET1",35,0)
GOT(ODT,SN) ;See if all tests have been canceled
"RTN","LRPHSET1",36,0)
 N I S GOT=0
"RTN","LRPHSET1",37,0)
 I $D(^LRO(69,ODT,1,SN)) S I=0 F  S I=$O(^LRO(69,ODT,1,SN,2,I)) Q:I<1  I $D(^(I,0)),'$P(^(0),"^",11) S GOT=1 Q
"RTN","LRPHSET1",38,0)
 Q GOT
"VER")
8.0^22.0
"BLD",9150,6)
^335
**END**
**END**
