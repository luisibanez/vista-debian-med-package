Released XT*7.3*122 SEQ #102
Extracted from mail message
**KIDS**:XT*7.3*122^

**INSTALL NAME**
XT*7.3*122
"BLD",1252,0)
XT*7.3*122^TOOLKIT^0^3110725^y
"BLD",1252,1,0)
^^3^3^3110215^^
"BLD",1252,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"BLD",1252,1,2,0)
XT*7.3*122 Kermit fix.
"BLD",1252,1,3,0)

"BLD",1252,4,0)
^9.64PA^^
"BLD",1252,6.3)
4
"BLD",1252,"INIT")
POST^ZTP1
"BLD",1252,"KRN",0)
^9.67PA^9002226^21
"BLD",1252,"KRN",.4,0)
.4
"BLD",1252,"KRN",.401,0)
.401
"BLD",1252,"KRN",.402,0)
.402
"BLD",1252,"KRN",.403,0)
.403
"BLD",1252,"KRN",.5,0)
.5
"BLD",1252,"KRN",.84,0)
.84
"BLD",1252,"KRN",3.6,0)
3.6
"BLD",1252,"KRN",3.8,0)
3.8
"BLD",1252,"KRN",9.2,0)
9.2
"BLD",1252,"KRN",9.8,0)
9.8
"BLD",1252,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",1252,"KRN",9.8,"NM",1,0)
XTKERM1^^0^B10044288
"BLD",1252,"KRN",9.8,"NM",2,0)
XTKERM2^^0^B13430818
"BLD",1252,"KRN",9.8,"NM",3,0)
ZTP1^^0^B21465548
"BLD",1252,"KRN",9.8,"NM",4,0)
ZTPP^^0^B13596537
"BLD",1252,"KRN",9.8,"NM","B","XTKERM1",1)

"BLD",1252,"KRN",9.8,"NM","B","XTKERM2",2)

"BLD",1252,"KRN",9.8,"NM","B","ZTP1",3)

"BLD",1252,"KRN",9.8,"NM","B","ZTPP",4)

"BLD",1252,"KRN",19,0)
19
"BLD",1252,"KRN",19.1,0)
19.1
"BLD",1252,"KRN",101,0)
101
"BLD",1252,"KRN",409.61,0)
409.61
"BLD",1252,"KRN",771,0)
771
"BLD",1252,"KRN",779.2,0)
779.2
"BLD",1252,"KRN",870,0)
870
"BLD",1252,"KRN",8989.51,0)
8989.51
"BLD",1252,"KRN",8989.52,0)
8989.52
"BLD",1252,"KRN",8994,0)
8994
"BLD",1252,"KRN",9002226,0)
9002226
"BLD",1252,"KRN","B",.4,.4)

"BLD",1252,"KRN","B",.401,.401)

"BLD",1252,"KRN","B",.402,.402)

"BLD",1252,"KRN","B",.403,.403)

"BLD",1252,"KRN","B",.5,.5)

"BLD",1252,"KRN","B",.84,.84)

"BLD",1252,"KRN","B",3.6,3.6)

"BLD",1252,"KRN","B",3.8,3.8)

"BLD",1252,"KRN","B",9.2,9.2)

"BLD",1252,"KRN","B",9.8,9.8)

"BLD",1252,"KRN","B",19,19)

"BLD",1252,"KRN","B",19.1,19.1)

"BLD",1252,"KRN","B",101,101)

"BLD",1252,"KRN","B",409.61,409.61)

"BLD",1252,"KRN","B",771,771)

"BLD",1252,"KRN","B",779.2,779.2)

"BLD",1252,"KRN","B",870,870)

"BLD",1252,"KRN","B",8989.51,8989.51)

"BLD",1252,"KRN","B",8989.52,8989.52)

"BLD",1252,"KRN","B",8994,8994)

"BLD",1252,"KRN","B",9002226,9002226)

"BLD",1252,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",1252,"QUES",0)
^9.62^^
"BLD",1252,"REQB",0)
^9.611^1^1
"BLD",1252,"REQB",1,0)
XT*7.3*105^0
"BLD",1252,"REQB","B","XT*7.3*105",1)

"INIT")
POST^ZTP1
"MBREQ")
0
"PKG",6,-1)
1^1
"PKG",6,0)
TOOLKIT^XT^PROGRAMMERS OPTIONS, MULTI. TERM LOOKUP^
"PKG",6,20,0)
^9.402P^^0
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.3^3040428^2970513^2
"PKG",6,22,1,"PAH",1,0)
122^3110725
"PKG",6,22,1,"PAH",1,1,0)
^^3^3^3110725
"PKG",6,22,1,"PAH",1,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"PKG",6,22,1,"PAH",1,1,2,0)
XT*7.3*122 Kermit fix.
"PKG",6,22,1,"PAH",1,1,3,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","XTKERM1")
0^1^B10044288^B9699066
"RTN","XTKERM1",1,0)
XTKERM1 ;SF/RWF - Kermit Send a file ;10/21/09  16:44
"RTN","XTKERM1",2,0)
 ;;7.3;TOOLKIT;**122**;Apr 25, 1995;Build 4
"RTN","XTKERM1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","XTKERM1",4,0)
S D BSPAR^XTKERM4,STO S XTKS("PT")="S",F1=0
"RTN","XTKERM1",5,0)
 I '$D(ZTQUEUED) U IO(0) D
"RTN","XTKERM1",6,0)
 . I IO=IO(0) W !,"Now start a KERMIT receive on your system.",!,"Starting [REMOTE] KERMIT send.",! H 5
"RTN","XTKERM1",7,0)
 . E  W !,"Starting a [LOCAL] KERMIT send.",!
"RTN","XTKERM1",8,0)
 . Q
"RTN","XTKERM1",9,0)
 U IO S XTKET=$H
"RTN","XTKERM1",10,0)
 F XTKERR=0:0 D @("S"_XTKS("PT")) Q:XTKERR!(XTKS("PT")="")
"RTN","XTKERM1",11,0)
 S %=$H,XTKET=%-XTKET*86400+$P(%,",",2)-$P(XTKET,",",2)
"RTN","XTKERM1",12,0)
 I '$D(ZTQUEUED) U IO(0) D
"RTN","XTKERM1",13,0)
 . W !,"Done with ",$S(IO=IO(0):"[REMOTE]",1:"[LOCAL]")," send, File transfer ",$S('XTKERR:"was successful.",1:"failed. ("_XTKERR_")")
"RTN","XTKERM1",14,0)
 . W:'XTKERR !,?10,"Bytes: ",XTKS("CCNT")," Sec: ",XTKET W:XTKET>0 " cps: ",$J($S(XTKET>0:XTKS("CCNT")/XTKET,1:""),3,1)
"RTN","XTKERM1",15,0)
 Q
"RTN","XTKERM1",16,0)
SS S XTKS("PN")=0 D SEND,RTO S XTKSDAT=XTKRDAT D SPAR^XTKERM4 S XTKS("PT")="F" Q
"RTN","XTKERM1",17,0)
SF S XTKSDAT=XTKFILE D SEND,RACK:(XTKR("PN")'=XTKS("PN")) S XTKS("PT")="D" Q
"RTN","XTKERM1",18,0)
SD D GDATA I 'F1 D SZ Q
"RTN","XTKERM1",19,0)
 D SDATA Q
"RTN","XTKERM1",20,0)
SZ S XTKSDAT="",XTKS("PT")="Z" D SEND S XTKS("PT")="B" Q:XTKERR
"RTN","XTKERM1",21,0)
 Q  ;MARK FILE AS SENT.
"RTN","XTKERM1",22,0)
SB S XTKSDAT="",XTKS("PT")="B" D SEND S XTKS("PT")="" Q
"RTN","XTKERM1",23,0)
SEND D:XTKS("PT")'="S" BUMP D SPACK ;Fall into RACK
"RTN","XTKERM1",24,0)
RACK S XTKS("TRY")=XTKS("TRY")+1 I XTKS("TRY")>XTKS("MAXTRY") G ABORT
"RTN","XTKERM1",25,0)
 D RPACK^XTKERM3 I "EY"'[XTKR("PT")!XTKERR D SPACK G RACK
"RTN","XTKERM1",26,0)
 I XTKR("PN")'=XTKS("PN") D SPACK G RACK
"RTN","XTKERM1",27,0)
 S:"E"=XTKR("PT") XTKERR="8 Error packet" Q
"RTN","XTKERM1",28,0)
 Q
"RTN","XTKERM1",29,0)
SEQ S X=(XTKS("PN")'=XTKS("PN")) Q:'X  D NAK S X=1 Q
"RTN","XTKERM1",30,0)
 Q
"RTN","XTKERM1",31,0)
ABORT S:'XTKERR XTKERR="7 Aborting send operation" Q
"RTN","XTKERM1",32,0)
BUMP S XTKS("TRY")=0,XTKS("PN")=XTKS("PN")+1#64 Q
"RTN","XTKERM1",33,0)
PREV S XTKS("PN")=$S(XTKS("PN"):XTKS("PN")-1,1:63) Q
"RTN","XTKERM1",34,0)
NAK S XTKS("PT")="N",XTKSDAT="" D SPACK Q
"RTN","XTKERM1",35,0)
ACK S XTKS("PT")="Y",XTKSDAT="" D SPACK S XTKS("TRY")=0 Q
"RTN","XTKERM1",36,0)
SPACK G SPACK^XTKERM3
"RTN","XTKERM1",37,0)
RPACK G RPACK^XTKERM3
"RTN","XTKERM1",38,0)
SDATA ;Send the data from the file.
"RTN","XTKERM1",39,0)
 S XTKSDAT="",XTKS("SA")=X G IDATA:'XTKMODE
"RTN","XTKERM1",40,0)
 I X'[XTKS("QA")&(X?1.ANP) S XTKSDAT=$E(X,1,XTKS("SIZ")),I=XTKS("SIZ")+1 G SD2
"RTN","XTKERM1",41,0)
 F I=1:1:$L(XTKS("SA")) S %1=$E(XTKS("SA"),I),%2=(%1[XTKS("QA")!(%1?1C)) Q:$L(XTKSDAT)+1+%2>XTKS("SIZ")  D
"RTN","XTKERM1",42,0)
 . S XTKSDAT=XTKSDAT_$S('%2:%1,%1[XTKS("QA"):%1_%1,1:XTKS("QA")_$C($A(%1)+64)),%2=0
"RTN","XTKERM1",43,0)
 . Q
"RTN","XTKERM1",44,0)
 S:'%2&(I=$L(XTKS("SA"))) I=I+1
"RTN","XTKERM1",45,0)
SD2 S XTKS("SA")=$E(XTKS("SA"),I,999) D SEND Q:XTKERR  S X=XTKS("SA") G SDATA:X]""
"RTN","XTKERM1",46,0)
 Q
"RTN","XTKERM1",47,0)
IDATA F F3=0:0 S X=$E(XTKS("SA"),1,XTKS("SIZ")),XTKS("SA")=$E(XTKS("SA"),XTKS("SIZ")+1,999) D SEND Q:XTKS("SA")=""
"RTN","XTKERM1",48,0)
 Q
"RTN","XTKERM1",49,0)
 Q
"RTN","XTKERM1",50,0)
GDATA ;Get data from global
"RTN","XTKERM1",51,0)
 S @("F1=$O("_XTKDIC_"F1))") Q:F1'>0  S X=@(XTKDIC_"F1,0)"),XTKS("CCNT")=XTKS("CCNT")+$L(X) S:XTKMODE=2 X=X_$C(13) S:XTKMODE=3 X=X_$C(13,10) Q
"RTN","XTKERM1",52,0)
 Q
"RTN","XTKERM1",53,0)
STO ;Save timeout data for startup
"RTN","XTKERM1",54,0)
 S XTKR("TOS")=XTKR("TO"),XTKR("TO")=5,XTKS("MAXTRY")=30
"RTN","XTKERM1",55,0)
 Q
"RTN","XTKERM1",56,0)
RTO ;Restore saved timeout
"RTN","XTKERM1",57,0)
 S XTKR("TO")=XTKR("TOS"),XTKS("MAXTRY")=10 K XTKR("TOS")
"RTN","XTKERM1",58,0)
 Q
"RTN","XTKERM2")
0^2^B13430818^B12598666
"RTN","XTKERM2",1,0)
XTKERM2 ;SF/RWF - Kermit Receive a file. ;11/8/93  11:50 ;
"RTN","XTKERM2",2,0)
 ;;7.3;TOOLKIT;**122**;Apr 25, 1995;Build 4
"RTN","XTKERM2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","XTKERM2",4,0)
R I '$D(ZTQUEUED) U IO(0) D
"RTN","XTKERM2",5,0)
 . I IO=IO(0) W !,"Now start a KERMIT send from your system.",!,"Starting [REMOTE] KERMIT receive.",!
"RTN","XTKERM2",6,0)
 . E  W !,"Starting a [LOCAL] KERMIT receive.",!
"RTN","XTKERM2",7,0)
 . Q
"RTN","XTKERM2",8,0)
 U IO S XTKET=$H
"RTN","XTKERM2",9,0)
 F XTKERR=0:0 D GET,@("R"_XTKR("PT")):'XTKERR Q:XTKERR!(XTKR("PT")="B")
"RTN","XTKERM2",10,0)
 D:XTKERR RB
"RTN","XTKERM2",11,0)
 S %=$H,XTKET=$H-XTKET*86400+$P(%,",",2)-$P(XTKET,",",2)
"RTN","XTKERM2",12,0)
 I '$D(ZTQUEUED) U IO(0) D
"RTN","XTKERM2",13,0)
 . W !,"Done with ",$S(IO=IO(0):"[REMOTE]",1:"[LOCAL]")," receive, File transfer ",$S('XTKERR:"was successful.  ("_XTKR("CCNT")_" bytes)",1:"failed. ("_XTKERR_")")
"RTN","XTKERM2",14,0)
 W:'XTKERR !,?10,"Bytes: ",XTKR("CCNT")," Sec: ",XTKET," cps: ",$J($S(XTKET>0:XTKR("CCNT")/XTKET,1:""),3,1)
"RTN","XTKERM2",15,0)
 Q
"RTN","XTKERM2",16,0)
RS S XTKS("PN")=XTKR("PN") D RPAR^XTKERM4,BSPAR^XTKERM4 S XTKS("PT")="Y" D SPACK,BUMP Q
"RTN","XTKERM2",17,0)
RF D SEQ Q:X  S X=XTKRDAT D FILE,ACK,BUMP Q
"RTN","XTKERM2",18,0)
RD D SEQ Q:X  D STORE,ACK,BUMP Q
"RTN","XTKERM2",19,0)
RZ D SEQ G:X ABORT S XTKRDAT="" D STORE:XTKR("SA")]"",ACK,BUMP,CLOSE Q
"RTN","XTKERM2",20,0)
RB D SEQ Q:X  D ACK Q
"RTN","XTKERM2",21,0)
RY ;
"RTN","XTKERM2",22,0)
RN ;
"RTN","XTKERM2",23,0)
RE G ABORT
"RTN","XTKERM2",24,0)
SEQ S X=(XTKR("PN")'=XTKS("PN")) Q:'X  D NAK S X=1 Q
"RTN","XTKERM2",25,0)
 Q
"RTN","XTKERM2",26,0)
GET S XTKR("TRY")=XTKR("TRY")+1 I XTKR("TRY")>XTKR("MAXTRY") G ABORT
"RTN","XTKERM2",27,0)
 D RPACK^XTKERM3
"RTN","XTKERM2",28,0)
 I XTKERR D DEBUG("E:"_XTKERR):$D(XTKDEBUG),NAK G GET
"RTN","XTKERM2",29,0)
 I "SFEDNZYB"'[XTKR("PT") S XTKERR="6 Unknown packet type" Q
"RTN","XTKERM2",30,0)
 Q
"RTN","XTKERM2",31,0)
ABORT S:'XTKERR XTKERR="5 Aborting receive operation" Q
"RTN","XTKERM2",32,0)
BUMP S XTKR("TRY")=0,XTKS("PN")=XTKS("PN")+1#64 Q
"RTN","XTKERM2",33,0)
PREV S XTKS("PN")=$S(XTKS("PN"):XTKS("PN")-1,1:63) Q
"RTN","XTKERM2",34,0)
NAK S XTKS("PT")="N",XTKSDAT="" D SPACK Q
"RTN","XTKERM2",35,0)
ACK S XTKS("PT")="Y",XTKSDAT="" D SPACK S XTKR("TRY")=0 Q
"RTN","XTKERM2",36,0)
SPACK G SPACK^XTKERM3
"RTN","XTKERM2",37,0)
RPACK G RPACK^XTKERM3
"RTN","XTKERM2",38,0)
DEBUG(MSG) ;
"RTN","XTKERM2",39,0)
 S XTKDEBUG=XTKDEBUG+1,^TMP("XTKERM",$J,XTKDEBUG)=MSG
"RTN","XTKERM2",40,0)
 Q
"RTN","XTKERM2",41,0)
FILE ;See if need to change file name.
"RTN","XTKERM2",42,0)
 I XTKDIC["DIZ(8980,",XTKR("RFN")="y" S XTKFILE(0)=XTKFILE,XTKFILE=X
"RTN","XTKERM2",43,0)
 ;Other wise toss file name we don't need it.
"RTN","XTKERM2",44,0)
 Q
"RTN","XTKERM2",45,0)
STORE ;Store the data (XTKRDAT) in file.
"RTN","XTKERM2",46,0)
 I 'XTKMODE S X=XTKRDAT D PDATA Q
"RTN","XTKERM2",47,0)
 F I=0:0 S I=$F(XTKRDAT,XTKR("QA"),I) Q:I<1  S X=$E(XTKRDAT,1,I-2),Y=$E(XTKRDAT,I) D TEXT:XTKMODE=2,REPLACE:XTKMODE=1
"RTN","XTKERM2",48,0)
 S X="" S:$L(XTKRDAT)+$L(XTKR("SA"))'>245 XTKR("SA")=XTKR("SA")_XTKRDAT,XTKRDAT="" S:$L(XTKRDAT)+$L(XTKR("SA"))>245 X=XTKR("SA"),XTKR("SA")=XTKRDAT,XTKRDAT="" S:XTKR("PT")="Z" X=XTKR("SA")
"RTN","XTKERM2",49,0)
 D:X]"" PDATA Q
"RTN","XTKERM2",50,0)
 ;Y=M end of line, L form feed, J line feed, other make into control
"RTN","XTKERM2",51,0)
TEXT I "L"[Y D TX2 S X="|TOP|" D PDATA Q
"RTN","XTKERM2",52,0)
 I "M"'[Y S XTKRDAT=X_$S(Y=XTKR("QA"):Y,"J"[Y:"",1:$C($A(Y)-64))_$E(XTKRDAT,I+1,999),I=I-(Y'=XTKR("QA")) Q
"RTN","XTKERM2",53,0)
TX2 I $L(XTKR("SA")) S X1=XTKR("SA"),X2=X,Z=245-$L(X1),X=X1_$E(X2,1,Z),XTKR("SA")=$E(X2,Z+1,999)
"RTN","XTKERM2",54,0)
 D PDATA S X="" G TX2:$L(XTKR("SA")) S XTKRDAT=$E(XTKRDAT,I+1,999),I=0 Q
"RTN","XTKERM2",55,0)
PDATA ;Put data in global
"RTN","XTKERM2",56,0)
 S DWLC=DWLC+1,@(XTKDIC_"DWLC,0)")=X,XTKR("CCNT")=XTKR("CCNT")+$L(X) Q
"RTN","XTKERM2",57,0)
 Q
"RTN","XTKERM2",58,0)
REPLACE S XTKRDAT=X_$S(Y=XTKR("QA"):Y,1:$C($A(Y)-64))_$E(XTKRDAT,I+1,999),I=$L(X)+(Y=XTKR("QA")) Q
"RTN","XTKERM2",59,0)
 Q
"RTN","XTKERM2",60,0)
CLOSE ;Close and update the filename if file 8980
"RTN","XTKERM2",61,0)
 I XTKDIC["DIZ(8980,",XTKR("RFN")="y" S $P(^DIZ(8980,XTKDA,0),"^",1)=XTKFILE,^DIZ(8980,"B",$E(XTKFILE,1,30),XTKDA)="" K ^DIZ(8980,"B",XTKFILE(0),XTKDA)
"RTN","XTKERM2",62,0)
 S @("X=$S($D("_XTKDIC_"0)):^(0),1:"""")"),^(0)=$P(X_"^^",U,1,2)_U_DWLC_U_DWLC
"RTN","XTKERM2",63,0)
 Q
"RTN","ZTP1")
0^3^B21465548^B17552324
"RTN","ZTP1",1,0)
%ZTP1 ;SF/RWF - Prints 1ST lines in Name, Date, Patch or Size order ;08/18/09  16:25
"RTN","ZTP1",2,0)
 ;;7.3;TOOLKIT;**20,70,91,105,122**;Apr 25, 1995;Build 4
"RTN","ZTP1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ZTP1",4,0)
A W !!,"PRINTS FIRST LINES",!!
"RTN","ZTP1",5,0)
 K ^UTILITY($J) S DTIME=$G(DTIME,300)
"RTN","ZTP1",6,0)
 X ^%ZOSF("RSEL") G KIL:$O(^UTILITY($J,0))=""
"RTN","ZTP1",7,0)
A1 ;
"RTN","ZTP1",8,0)
 N ZTP1,ZTP2,X
"RTN","ZTP1",9,0)
A2 R !,"(A)lpha, (D)ate ,(P)atched, OR (S)ize ORDER: A//",ZTP1:DTIME
"RTN","ZTP1",10,0)
 S:ZTP1="" ZTP1="A" S ZTP1=$E(ZTP1,1) G KIL:ZTP1="^",A2:"ADPS"'[ZTP1
"RTN","ZTP1",11,0)
 S ZTP2=$S(ZTP1="P":"2",1:"None")
"RTN","ZTP1",12,0)
A3 W !,"Include line (2), Include lines 2&(3), (N)one: ",ZTP2,"//" R X:DTIME
"RTN","ZTP1",13,0)
 S X=$TR(X,"n","N")
"RTN","ZTP1",14,0)
 G KIL:X["^"!('$T) S:X="" X=ZTP2 G A3:"23N"'[$E(X) S ZTP2=+X
"RTN","ZTP1",15,0)
 S %ZIS="QM" D ^%ZIS G KIL:POP
"RTN","ZTP1",16,0)
 I $D(IO("Q")) D  D ^%ZISC Q
"RTN","ZTP1",17,0)
 . K IO("Q") S ZTRTN="DQ^%ZTP1",ZTSAVE("ZTP1")="",ZTSAVE("^UTILITY($J,")="",ZTSAVE("ZTP2")="",ZTDESC="FIRST LINES PRINT"
"RTN","ZTP1",18,0)
 . D ^%ZTLOAD K ZTSK Q
"RTN","ZTP1",19,0)
 ;Set RN for all loops
"RTN","ZTP1",20,0)
DQ ;Taskman entry point
"RTN","ZTP1",21,0)
 N %L,%R,%ZN,A,B,C,HED,JR,S,X,Y,ZTP,ZP,RN,CCNT
"RTN","ZTP1",22,0)
 S RN=2 G DATE:ZTP1="D",SIZE:ZTP1="S",PATCH:ZTP1="P"
"RTN","ZTP1",23,0)
 ;
"RTN","ZTP1",24,0)
ALPHA ;By name
"RTN","ZTP1",25,0)
 F JP=1:1 S RN=$O(^UTILITY($J,RN)) Q:RN=""  S ^UTILITY($J,1,JP,RN)=0
"RTN","ZTP1",26,0)
 S HED=" FIRST LINE LIST "
"RTN","ZTP1",27,0)
 G LIST
"RTN","ZTP1",28,0)
 ;
"RTN","ZTP1",29,0)
SIZE ;Sort by routine size
"RTN","ZTP1",30,0)
 F  S RN=$O(^UTILITY($J,RN)) Q:RN=""  D
"RTN","ZTP1",31,0)
 . D LOAD(RN)
"RTN","ZTP1",32,0)
 . S Y=$$SIZE2(.CCNT) I '$D(ZTQUEUED) W RN," ",Y,?$X\19+1*19 W:$X>66 !
"RTN","ZTP1",33,0)
 . D KEEP(Y,RN,CCNT)
"RTN","ZTP1",34,0)
 S HED=" SIZE RANKING "
"RTN","ZTP1",35,0)
 G LIST
"RTN","ZTP1",36,0)
 ;
"RTN","ZTP1",37,0)
LOAD(X,R) ;Load routine
"RTN","ZTP1",38,0)
 N DIF,XCNP K ^TMP($J)
"RTN","ZTP1",39,0)
 S DIF="^TMP($J,",XCNP=0 X ^%ZOSF("LOAD")
"RTN","ZTP1",40,0)
 I $D(R) S R(1)=$G(^TMP($J,1,0)),R(2)=$G(^TMP($J,2,0)),R(3)=$G(^TMP($J,3,0))
"RTN","ZTP1",41,0)
 Q
"RTN","ZTP1",42,0)
 ;
"RTN","ZTP1",43,0)
KEEP(IX1,IX2,IX4) ;
"RTN","ZTP1",44,0)
 S ^UTILITY($J,1,IX1,IX2)=2
"RTN","ZTP1",45,0)
 S ^UTILITY($J,1,IX1,IX2,1)=^TMP($J,1,0),^UTILITY($J,1,IX1,IX2,2)=^TMP($J,2,0),^UTILITY($J,1,IX1,IX2,3)=$G(^TMP($J,3,0))
"RTN","ZTP1",46,0)
 S:$D(IX4) ^UTILITY($J,1,IX1,IX2,4)=IX4
"RTN","ZTP1",47,0)
 Q
"RTN","ZTP1",48,0)
 ;
"RTN","ZTP1",49,0)
LIST ;All 3 sorts come here to print the list.
"RTN","ZTP1",50,0)
 N %X,QUIT,L,L1,L2,S,PL,X
"RTN","ZTP1",51,0)
 S PL=IOSL-3-ZTP2,X=$H X ^%ZOSF("ZD")
"RTN","ZTP1",52,0)
 X ^%ZOSF("UCI") S HED=HED_"  UCI: "_Y,X=$H X ^%ZOSF("ZD")
"RTN","ZTP1",53,0)
 S HED=HED_"   "_Y,HED(1)="Total/Comments"
"RTN","ZTP1",54,0)
 U IO D HED
"RTN","ZTP1",55,0)
 S ZP=0,X=0,QUIT=0,S=0
"RTN","ZTP1",56,0)
 F  S S=$O(^UTILITY($J,1,S)),RN="" Q:(S'>0)!(QUIT)  D
"RTN","ZTP1",57,0)
 . F  S RN=$O(^UTILITY($J,1,S,RN)) Q:'$L(RN)!QUIT  D
"RTN","ZTP1",58,0)
 . . D:$Y>PL WAIT I X["^" S RN="zz",QUIT=1,S=" " Q
"RTN","ZTP1",59,0)
 . . S ZP=ZP+1 D L2
"RTN","ZTP1",60,0)
 I 'QUIT W !!?14,ZP," ROUTINES",!
"RTN","ZTP1",61,0)
KIL D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ZTP1",62,0)
 K ^UTILITY($J)
"RTN","ZTP1",63,0)
 Q
"RTN","ZTP1",64,0)
 ;
"RTN","ZTP1",65,0)
L2 ;Write one
"RTN","ZTP1",66,0)
 N LI
"RTN","ZTP1",67,0)
 I ^UTILITY($J,1,S,RN) M LI=^(RN) ;S LI(1)=^(RN,1),LI(2)=^(2),LI(3)=^(3)
"RTN","ZTP1",68,0)
 I '$T S LI=0 D LOAD(RN,.LI) S LI(1)=$P(LI(1)," ",2,999)
"RTN","ZTP1",69,0)
 W RN,?10 W:ZTP1="S" $J(S,5),"/",LI(4),?20," - " S %X=$X-1 D WR(LI(1))
"RTN","ZTP1",70,0)
 I ZTP2 W ?%X D WR(LI(2)) I ZTP2>2 W ?%X D WR(LI(3))
"RTN","ZTP1",71,0)
 Q
"RTN","ZTP1",72,0)
 ;
"RTN","ZTP1",73,0)
WR(STR) ;Write line w/ wrap
"RTN","ZTP1",74,0)
 N %1,%2
"RTN","ZTP1",75,0)
 S %1=$X+1,%2=IOM-1-%1
"RTN","ZTP1",76,0)
 F  W $E(STR,1,%2) S STR=$E(STR,%2+1,9999) Q:'$L(STR)  W !,?%1
"RTN","ZTP1",77,0)
 W:$X>0 !
"RTN","ZTP1",78,0)
 Q
"RTN","ZTP1",79,0)
 ;
"RTN","ZTP1",80,0)
WAIT ;Wait at end of page
"RTN","ZTP1",81,0)
 I IOST["C-" R !,"Enter Return to continue ",X:DTIME Q:X["^"
"RTN","ZTP1",82,0)
HED W @IOF,!?12,HED,! W:ZTP1="S" ?10,HED(1),! Q
"RTN","ZTP1",83,0)
 ;
"RTN","ZTP1",84,0)
DATE ;Sort by date
"RTN","ZTP1",85,0)
 F  S RN=$O(^UTILITY($J,RN)) Q:RN=""  D
"RTN","ZTP1",86,0)
 . N L S L=0 D LOAD(RN,.L)
"RTN","ZTP1",87,0)
 . S X=$$DTF(L(1)) D KEEP(9999999-X,RN)
"RTN","ZTP1",88,0)
 . W RN," ",X,?$X\19+1*19 W:$X>66 !
"RTN","ZTP1",89,0)
 . Q
"RTN","ZTP1",90,0)
 S HED=" REVERSE DATE ORDER "
"RTN","ZTP1",91,0)
 G LIST
"RTN","ZTP1",92,0)
DTF(L) ;Find the date
"RTN","ZTP1",93,0)
 N %,PC,%DT,B,S,Y,X
"RTN","ZTP1",94,0)
 S Y=-1
"RTN","ZTP1",95,0)
 F PC=2:1:$L(L,";") S B=1,X=$P(L,";",PC) D  Q:Y>0
"RTN","ZTP1",96,0)
 . S %DT="T"
"RTN","ZTP1",97,0)
 . S:X?.E1"["1.2N1"/"1.2N1"/"2.4N.E1"]".E X=$P($P(X,"[",2),"]",1) ;Look for [10/23/2008 14:23]
"RTN","ZTP1",98,0)
 . I X?1.2N1P1.2N1P2.4N.E D ^%DT Q:Y>0
"RTN","ZTP1",99,0)
 . F %=1:1:$L(X) D  Q:Y>0
"RTN","ZTP1",100,0)
 . . S S=$E(X,%)?1P S:B&S X=$E(X,1,%-1)_$E(X,%+1,999),%=%-1
"RTN","ZTP1",101,0)
 . . S:'S B=0 S:$E(X,%+1,999)?1N.N1":".E X=$E(X,1,%-1)_"@"_$E(X,%+1,999),%=999
"RTN","ZTP1",102,0)
 . . I %>$L(X) N % D ^%DT
"RTN","ZTP1",103,0)
 . . Q
"RTN","ZTP1",104,0)
 . Q
"RTN","ZTP1",105,0)
 Q Y
"RTN","ZTP1",106,0)
 ;,X=$P(ZTP,"" ;"",3) X A(1) S B=1,X=$P(ZTP,"";"",4) X:Y<0 A(1)
"RTN","ZTP1",107,0)
 ;
"RTN","ZTP1",108,0)
PATCH ;Sort by first patch number
"RTN","ZTP1",109,0)
 N S2
"RTN","ZTP1",110,0)
 F S2=0:0 S RN=$O(^UTILITY($J,RN)) Q:RN=""  D
"RTN","ZTP1",111,0)
 . N L S L=0 D LOAD(RN,.L)
"RTN","ZTP1",112,0)
 . S X=$P(L(2),";",5) I X]"" S S=+$P(X,"**",2) D KEEP(S,RN)
"RTN","ZTP1",113,0)
 S HED=" PATCHED ROUTINES "
"RTN","ZTP1",114,0)
 G LIST
"RTN","ZTP1",115,0)
 ;
"RTN","ZTP1",116,0)
SIZE2(CCNT) ; Return size in bytes of routine in ^TMP($J)
"RTN","ZTP1",117,0)
 N NUM,LINE,SIZE,R4,I ; line number, line text, size
"RTN","ZTP1",118,0)
 S (SIZE,CCNT)=0
"RTN","ZTP1",119,0)
 F NUM=1:1 S LINE=$G(^TMP($J,NUM,0)) Q:LINE=""  S SIZE=SIZE+$L(LINE)+2,R4=$P(LINE," ",2,999) D
"RTN","ZTP1",120,0)
 . S I=0 I " ."[$E(R4) F I=1:1:$L(R4) Q:" ."'[$E(R4,I)
"RTN","ZTP1",121,0)
 . I I S R4=$E(R4,I,$L(R4))
"RTN","ZTP1",122,0)
 . I $E(R4)=";",$E(R4,2)'=";" S CCNT=CCNT+$L(R4) ;Comment size
"RTN","ZTP1",123,0)
 Q SIZE
"RTN","ZTP1",124,0)
 ;
"RTN","ZTP1",125,0)
BUILD ;
"RTN","ZTP1",126,0)
 N Y,BLDA,%N,S2
"RTN","ZTP1",127,0)
 I '$D(^XPD(9.6,0)) W !,"No BUILD file to work from." Q
"RTN","ZTP1",128,0)
 S Y=$$BUILD^XTRUTL1 G KIL:Y'>0 S BLDA=+Y
"RTN","ZTP1",129,0)
 D RTN^XTRUTL1(BLDA)
"RTN","ZTP1",130,0)
 I '$D(^UTILITY($J)) W !,"No routines in this build." G KIL
"RTN","ZTP1",131,0)
 G A1
"RTN","ZTP1",132,0)
 ;
"RTN","ZTP1",133,0)
POST ;POST-INIT
"RTN","ZTP1",134,0)
 N %D,%S,I,SCR,ZTOS,ZTMODE
"RTN","ZTP1",135,0)
 S ZTMODE=2,ZTOS=$$OS^ZTMGRSET()
"RTN","ZTP1",136,0)
 S %S="ZTP1^ZTPP",%D="%ZTP1^%ZTPP",SCR="I 1" D MOVE^ZTMGRSET
"RTN","ZTP1",137,0)
 Q
"RTN","ZTPP")
0^4^B13596537^B11701778
"RTN","ZTPP",1,0)
%ZTPP ;SF/RWF - ROUTINE PRETTY PRINT OUTPUT ;10/19/09  14:56
"RTN","ZTPP",2,0)
 ;;7.3;TOOLKIT;**4,11,20,70,122**;Apr 25, 1995;Build 4
"RTN","ZTPP",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ZTPP",4,0)
 ;This program can produce routine listings in a paper-saving format
"RTN","ZTPP",5,0)
A W !,"Routine Print:"
"RTN","ZTPP",6,0)
 N FF,LN,ZTSK I $G(DTIME)'>0 N DTIME S DTIME=360
"RTN","ZTPP",7,0)
A2 R !,"Want to start each routine on a new page: Yes// ",FF:DTIME,! G EXIT:FF["^" I FF["?" W !,"Enter Yes to start each routine on a new page.",!?5,"No for the old way." G A2
"RTN","ZTPP",8,0)
A3 R !,"Want line numbers: No//",LN:DTIME,!
"RTN","ZTPP",9,0)
 G EXIT:LN["^" I LN["?" W !,"Enter Yes to have line numbers, O for offset numbers, No for no line numbers." G A3
"RTN","ZTPP",10,0)
 S FF=$TR($E(FF_"Y"),"YyNn","1100"),LN=$TR($E(LN_"N"),"YyNnOo","110022")
"RTN","ZTPP",11,0)
 K ^UTILITY($J) X ^%ZOSF("RSEL") I $O(^UTILITY($J," "))="" W !!,"NO routines selected." G EXIT
"RTN","ZTPP",12,0)
 K %ZIS,IOP,ZTIO S %ZIS="MQ" D ^%ZIS G:POP EXIT
"RTN","ZTPP",13,0)
 I $D(IO("Q")) S ZTRTN="DQ^%ZTPP",ZTDTH="",ZTDESC="ROUTINE LIST" F I="FF","LN","^UTILITY($J," S ZTSAVE(I)=""
"RTN","ZTPP",14,0)
 I $D(IO("Q")) K IO("Q") D ^%ZTLOAD W !,"REQUEST QUEUED" G EXIT
"RTN","ZTPP",15,0)
DQ ;FF start each routine on a new page, LN line numbers
"RTN","ZTPP",16,0)
 N RN,ST,HDR,LC,PG,BYTECNT,CCNT,X,RSUM,RSUM2,DIF,IOC,IOC2,LI,OF,XCNP
"RTN","ZTPP",17,0)
 S U="^" D NOW^%DTC S Y=% D DD S HDR(2)=Y
"RTN","ZTPP",18,0)
 X ^%ZOSF("UCI") S HDR(1)="UCI: "_Y_"    Site: "_$G(^DD("SITE"),"VAMC")
"RTN","ZTPP",19,0)
 S IOC=(IO=IO(0)),IOC2=$E(IOST,1,2)["C-"
"RTN","ZTPP",20,0)
 U IO W:IOC2 @IOF I 'IOC U IO(0) W !!
"RTN","ZTPP",21,0)
 S RN=" ",%Y=IOSL-(255\IOM+1) K %D,%T,%TIM
"RTN","ZTPP",22,0)
 F  S RN=$O(^UTILITY($J,RN)) Q:RN=""  D  I 'ST D %Z5:IOC2&IOC
"RTN","ZTPP",23,0)
 . S X=RN,XCNP=0,DIF="RTN(" K RTN X ^%ZOSF("LOAD") S LC=XCNP-1
"RTN","ZTPP",24,0)
 . IF 'IOC U IO(0) W $J(RN,10) W:$X>70 !
"RTN","ZTPP",25,0)
 . U IO S (CCNT,BYTECNT,PG,OF)=0
"RTN","ZTPP",26,0)
 . D RSUM,%Z3
"RTN","ZTPP",27,0)
 . F LI=1:1:LC S X=RTN(LI,0) D:%Y'>$Y %Z3 Q:ST  S Y=$P(X," ",1),X=$P(X," ",2,999) D  ;
"RTN","ZTPP",28,0)
 . . I 'LN F J=1:1 W !,Y,?J>1+6," " W:$X>8 "--",!,?8 W $E(X,1,IOM-(J>1+8)) S X=$E(X,IOM-(J>1+7),999),Y="" Q:X=""
"RTN","ZTPP",29,0)
 . . I LN S OF=$S(LN=1:LI,$L(Y):0,1:OF+1),J1=$S(LN=1:$J(LI,3),$L(Y):"",1:"+"_OF)
"RTN","ZTPP",30,0)
 . . I LN F J=1:1 W !,J1,?4,Y,?J>1+10," " W:$X>12 "--",!,?12 W $E(X,1,IOM-(J>1+12)) S X=$E(X,IOM-(J>1+11),999),Y="",J1="" Q:X=""
"RTN","ZTPP",31,0)
 . . Q
"RTN","ZTPP",32,0)
 . W:$Y<IOSL !
"RTN","ZTPP",33,0)
 . Q
"RTN","ZTPP",34,0)
 U IO W !
"RTN","ZTPP",35,0)
EXIT K %,%Y,RTN,ST,I,J,J1,%Z33,S,X,Y
"RTN","ZTPP",36,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ZTPP",37,0)
 Q
"RTN","ZTPP",38,0)
 ;
"RTN","ZTPP",39,0)
DD S:Y Y=$S($E(Y,4,5):$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",+$E(Y,4,5))_" ",1:"")_$S($E(Y,6,7):+$E(Y,6,7)_",",1:"")_($E(Y,1,3)+1700)_$P("@"_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),"^",Y[".")
"RTN","ZTPP",40,0)
 Q
"RTN","ZTPP",41,0)
EXEC ;
"RTN","ZTPP",42,0)
RSUM ;Checksum and byte counts ;p122
"RTN","ZTPP",43,0)
 N Y,Y2,R,R1,R2,R3,R4,I S (Y,Y2,BYTECNT,CCNT)=0
"RTN","ZTPP",44,0)
 F R=1:1:LC S R1=RTN(R,0) D
"RTN","ZTPP",45,0)
 . I R'=2 S R3=$F(R1," "),R3=$S($E(R1,R3)'=";":$L(R1),$E(R1,R3+1)=";":$L(R1),1:R3-2) F R2=1:1:R3 S Y=$A(R1,R2)*R2+Y,Y2=$A(R1,R2)*(R2+R)+Y2
"RTN","ZTPP",46,0)
 . S BYTECNT=BYTECNT+$L(R1)+2,R4=$P(R1," ",2,999),I=0
"RTN","ZTPP",47,0)
 . I " ."[$E(R4) F I=1:1:$L(R4) Q:" ."'[$E(R4,I)
"RTN","ZTPP",48,0)
 . I I S R4=$E(R4,I,$L(R4))
"RTN","ZTPP",49,0)
 . I $E(R4)=";",$E(R4,2)'=";" S CCNT=CCNT+$L(R4)
"RTN","ZTPP",50,0)
 . Q
"RTN","ZTPP",51,0)
 S RSUM=Y,RSUM2=Y2
"RTN","ZTPP",52,0)
 Q
"RTN","ZTPP",53,0)
%Z3 S PG=PG+1,ST=0 D:(PG>1)&IOC2&IOC %Z5 Q:ST
"RTN","ZTPP",54,0)
 W:((LC+9+$Y'<IOSL)!FF)&($Y>3)!(PG>1) @IOF
"RTN","ZTPP",55,0)
 W RN," * *  ",$S(PG>1:"(cont.)",1:LC_" LINES,  (total "_BYTECNT_", comments "_CCNT_") BYTES"),?60,"Page ",PG
"RTN","ZTPP",56,0)
 W:PG=1 !?8,"RSUM: old "_RSUM_", new "_RSUM2
"RTN","ZTPP",57,0)
 W !,?8,HDR(1),?49,HDR(2),!
"RTN","ZTPP",58,0)
 Q
"RTN","ZTPP",59,0)
%Z5 R !,"Press RETURN to continue or '^' to exit: ",ST:600 S ST=$S(ST["^":1,1:0) S:ST LI=9999,LC=0,RN="zzzz",X=""
"RTN","ZTPP",60,0)
 Q
"RTN","ZTPP",61,0)
 ;
"RTN","ZTPP",62,0)
POST ;POST-INIT
"RTN","ZTPP",63,0)
 N %D,%S,I,SCR,ZTOS,ZTMODE
"RTN","ZTPP",64,0)
 S ZTMODE=2,ZTOS=$$OS^ZTMGRSET()
"RTN","ZTPP",65,0)
 S %S="ZTPP",%D="%ZTPP",SCR="I 1" D MOVE^ZTMGRSET
"RTN","ZTPP",66,0)
 Q
"VER")
8.0^22.0
"BLD",1252,6)
^102
**END**
**END**
