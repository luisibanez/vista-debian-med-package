Released SD*5.3*504 SEQ #473
Extracted from mail message
**KIDS**:SD*5.3*504^

**INSTALL NAME**
SD*5.3*504
"BLD",6849,0)
SD*5.3*504^SCHEDULING^0^3100331^y
"BLD",6849,1,0)
^^3^3^3080605^
"BLD",6849,1,1,0)
This patch enhances PCMM (Patient Care Management Module) functionality.
"BLD",6849,1,2,0)
Please .  Please 
"BLD",6849,1,3,0)
review the FORUM patch module for a complete description.
"BLD",6849,4,0)
^9.64PA^404.42^1
"BLD",6849,4,404.42,0)
404.42
"BLD",6849,4,404.42,2,0)
^9.641^404.42^1
"BLD",6849,4,404.42,2,404.42,0)
PATIENT TEAM ASSIGNMENT  (File-top level)
"BLD",6849,4,404.42,2,404.42,1,0)
^9.6411^.16^2
"BLD",6849,4,404.42,2,404.42,1,.15,0)
STATUS
"BLD",6849,4,404.42,2,404.42,1,.16,0)
MULTIPLE PCP
"BLD",6849,4,404.42,222)
y^n^p^^^^n^^n
"BLD",6849,4,404.42,224)

"BLD",6849,4,"APDD",404.42,404.42)

"BLD",6849,4,"APDD",404.42,404.42,.15)

"BLD",6849,4,"APDD",404.42,404.42,.16)

"BLD",6849,4,"B",404.42,404.42)

"BLD",6849,6)
13^
"BLD",6849,6.3)
21
"BLD",6849,"ABPKG")
n
"BLD",6849,"INI")
PRE^SD53P504
"BLD",6849,"INIT")
POST^SD53P504
"BLD",6849,"KRN",0)
^9.67PA^8989.52^19
"BLD",6849,"KRN",.4,0)
.4
"BLD",6849,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",6849,"KRN",.4,"NM",1,0)
SCMCTP    FILE #404.51^404.51^0
"BLD",6849,"KRN",.4,"NM","B","SCMCTP    FILE #404.51",1)

"BLD",6849,"KRN",.401,0)
.401
"BLD",6849,"KRN",.401,"NM",0)
^9.68A^1^1
"BLD",6849,"KRN",.401,"NM",1,0)
SCMCTP    FILE #404.51^404.51^0
"BLD",6849,"KRN",.401,"NM","B","SCMCTP    FILE #404.51",1)

"BLD",6849,"KRN",.402,0)
.402
"BLD",6849,"KRN",.403,0)
.403
"BLD",6849,"KRN",.403,"NM",0)
^9.68A^^
"BLD",6849,"KRN",.5,0)
.5
"BLD",6849,"KRN",.84,0)
.84
"BLD",6849,"KRN",3.6,0)
3.6
"BLD",6849,"KRN",3.8,0)
3.8
"BLD",6849,"KRN",9.2,0)
9.2
"BLD",6849,"KRN",9.8,0)
9.8
"BLD",6849,"KRN",9.8,"NM",0)
^9.68A^13^8
"BLD",6849,"KRN",9.8,"NM",1,0)
SCMCTSKG^^0^B95917161
"BLD",6849,"KRN",9.8,"NM",2,0)
SCMCPREC^^0^B4146089
"BLD",6849,"KRN",9.8,"NM",3,0)
SCMCTSK1^^0^B83874650
"BLD",6849,"KRN",9.8,"NM",7,0)
SCMCTPUR^^0^B445864
"BLD",6849,"KRN",9.8,"NM",10,0)
SD53P504^^0^B59534765
"BLD",6849,"KRN",9.8,"NM",11,0)
SCAPU1^^0^B5697016
"BLD",6849,"KRN",9.8,"NM",12,0)
SCMCDDA^^0^B3262760
"BLD",6849,"KRN",9.8,"NM",13,0)
SCMCTSK2^^0^B103317459
"BLD",6849,"KRN",9.8,"NM","B","SCAPU1",11)

"BLD",6849,"KRN",9.8,"NM","B","SCMCDDA",12)

"BLD",6849,"KRN",9.8,"NM","B","SCMCPREC",2)

"BLD",6849,"KRN",9.8,"NM","B","SCMCTPUR",7)

"BLD",6849,"KRN",9.8,"NM","B","SCMCTSK1",3)

"BLD",6849,"KRN",9.8,"NM","B","SCMCTSK2",13)

"BLD",6849,"KRN",9.8,"NM","B","SCMCTSKG",1)

"BLD",6849,"KRN",9.8,"NM","B","SD53P504",10)

"BLD",6849,"KRN",19,0)
19
"BLD",6849,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",6849,"KRN",19,"NM",1,0)
SCMC PCMM GUI WORKSTATION^^0
"BLD",6849,"KRN",19,"NM",2,0)
SCMC PCMM TEAM PURPOSE LIST^^0
"BLD",6849,"KRN",19,"NM","B","SCMC PCMM GUI WORKSTATION",1)

"BLD",6849,"KRN",19,"NM","B","SCMC PCMM TEAM PURPOSE LIST",2)

"BLD",6849,"KRN",19.1,0)
19.1
"BLD",6849,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6849,"KRN",101,0)
101
"BLD",6849,"KRN",409.61,0)
409.61
"BLD",6849,"KRN",771,0)
771
"BLD",6849,"KRN",870,0)
870
"BLD",6849,"KRN",8989.51,0)
8989.51
"BLD",6849,"KRN",8989.52,0)
8989.52
"BLD",6849,"KRN",8994,0)
8994
"BLD",6849,"KRN",8994,"NM",0)
^9.68A^4^4
"BLD",6849,"KRN",8994,"NM",1,0)
SCMC AUTO INACTIVATION RPT^^0
"BLD",6849,"KRN",8994,"NM",2,0)
SCMC PRECEPTOR MOVE - LIST^^0
"BLD",6849,"KRN",8994,"NM",3,0)
SCMC PRECEPTOR MOVE - MOVE^^0
"BLD",6849,"KRN",8994,"NM",4,0)
SCMC PCMM CHECK FTEE^^0
"BLD",6849,"KRN",8994,"NM","B","SCMC AUTO INACTIVATION RPT",1)

"BLD",6849,"KRN",8994,"NM","B","SCMC PCMM CHECK FTEE",4)

"BLD",6849,"KRN",8994,"NM","B","SCMC PRECEPTOR MOVE - LIST",2)

"BLD",6849,"KRN",8994,"NM","B","SCMC PRECEPTOR MOVE - MOVE",3)

"BLD",6849,"KRN","B",.4,.4)

"BLD",6849,"KRN","B",.401,.401)

"BLD",6849,"KRN","B",.402,.402)

"BLD",6849,"KRN","B",.403,.403)

"BLD",6849,"KRN","B",.5,.5)

"BLD",6849,"KRN","B",.84,.84)

"BLD",6849,"KRN","B",3.6,3.6)

"BLD",6849,"KRN","B",3.8,3.8)

"BLD",6849,"KRN","B",9.2,9.2)

"BLD",6849,"KRN","B",9.8,9.8)

"BLD",6849,"KRN","B",19,19)

"BLD",6849,"KRN","B",19.1,19.1)

"BLD",6849,"KRN","B",101,101)

"BLD",6849,"KRN","B",409.61,409.61)

"BLD",6849,"KRN","B",771,771)

"BLD",6849,"KRN","B",870,870)

"BLD",6849,"KRN","B",8989.51,8989.51)

"BLD",6849,"KRN","B",8989.52,8989.52)

"BLD",6849,"KRN","B",8994,8994)

"BLD",6849,"PRE")

"BLD",6849,"QDEF")
^^^^^^^^^^
"BLD",6849,"QUES",0)
^9.62^^
"BLD",6849,"REQB",0)
^9.611^1^1
"BLD",6849,"REQB",1,0)
SD*5.3*532^1
"BLD",6849,"REQB","B","SD*5.3*532",1)

"FIA",404.42)
PATIENT TEAM ASSIGNMENT
"FIA",404.42,0)
^SCPT(404.42,
"FIA",404.42,0,0)
404.42PIA
"FIA",404.42,0,1)
y^n^p^^^^n^^n
"FIA",404.42,0,10)

"FIA",404.42,0,11)

"FIA",404.42,0,"RLRO")

"FIA",404.42,0,"VR")
5.3^SD
"FIA",404.42,404.42)
1
"FIA",404.42,404.42,.15)

"FIA",404.42,404.42,.16)

"INI")
PRE^SD53P504
"INIT")
POST^SD53P504
"KRN",.4,5202,-1)
0^1
"KRN",.4,5202,0)
SCMCTP^3090922.1409^@^404.51^^@^3090922
"KRN",.4,5202,"F",2)
.01~.03~
"KRN",.4,5202,"H")
PCMM Team Purpose List
"KRN",.401,449529,-1)
0^1
"KRN",.401,449529,0)
SCMCTP^3090401.1008^@^404.51^^@^3090922
"KRN",.401,449529,2,0)
^.4014^2^2
"KRN",.401,449529,2,1,0)
404.51^.01^NAME^^^^^^^4
"KRN",.401,449529,2,1,"F")
AAA@z^AAAA
"KRN",.401,449529,2,1,"GET")
S DISX(1)=$P($G(^SCTM(404.51,D0,0)),U)
"KRN",.401,449529,2,1,"IX")
^SCTM(404.51,"B",^SCTM(404.51,^2
"KRN",.401,449529,2,1,"QCON")
I (DISX(1)]]"AAA@z")&(DISX(1)']]"ZZZZZZZZ")
"KRN",.401,449529,2,1,"SER")
0.0638^0.0600
"KRN",.401,449529,2,1,"T")
ZZZZZZZZ^ZZZZZZZZ
"KRN",.401,449529,2,1,"TXT")
NAME from AAAA to ZZZZZZZZ
"KRN",.401,449529,2,2,0)
404.51^^TEAM PURPOSE^".03^^^^^^4
"KRN",.401,449529,2,2,"CM")
S Y(1)=$S($D(^SCTM(404.51,D0,0)):^(0),1:"") S X=$P($G(^SD(403.47,+$P(Y(1),U,3),0)),U) I D0>0 S DISX(2)=X
"KRN",.401,449529,2,2,"F")
OIF OEEz^OIF OEF
"KRN",.401,449529,2,2,"GET")
S Y(1)=$S($D(^SCTM(404.51,D0,0)):^(0),1:"") S X=$P($G(^SD(403.47,+$P(Y(1),U,3),0)),U) I D0>0 S DISX(2)=X
"KRN",.401,449529,2,2,"QCON")
I (DISX(2)]]"OIF OEEz")&(DISX(2)']]"OIF OEFZZZ")
"KRN",.401,449529,2,2,"T")
OIF OEFZZZ^OIF OEFZZZ
"KRN",.401,449529,2,2,"TXT")
TEAM PURPOSE from OIF OEF to OIF OEFZZZ
"KRN",.401,449529,2,"B",404.51,1)

"KRN",.401,449529,2,"B",404.51,2)

"KRN",.401,449529,"%D",0)
^^1^1^3090401^
"KRN",.401,449529,"%D",1,0)
Template to screen TEAM PURPOSE field, entry OIF OEF.
"KRN",19,2916272,-1)
0^1
"KRN",19,2916272,0)
SCMC PCMM GUI WORKSTATION^PCMM GUI WORKSTATION^^B^^^^^^^^SCHEDULING^^
"KRN",19,2916272,1,0)
^19.06^6^6^3080729^^^^
"KRN",19,2916272,1,1,0)
'B' type option for use after installation of PCMM client version
"KRN",19,2916272,1,2,0)
1.2.0.0/server version SD*5.3*177.  For users to be able to use the
"KRN",19,2916272,1,3,0)
Primary Care Management Module's GUI front-end, this option must be on
"KRN",19,2916272,1,4,0)
either their primary or secondary menu options.  Putting this option on a
"KRN",19,2916272,1,5,0)
menu will give users who have access to that menu, access to PCMM.  Note:
"KRN",19,2916272,1,6,0)
'B' type options are not visible to roll & scroll users.
"KRN",19,2916272,20)

"KRN",19,2916272,99)
58812,34318
"KRN",19,2916272,99.1)
59389,47775
"KRN",19,2916272,"RPC",0)
^19.05P^103^103
"KRN",19,2916272,"RPC",2,0)
SC BLD PAT CLN LIST
"KRN",19,2916272,"RPC",3,0)
SC BLD PAT LIST
"KRN",19,2916272,"RPC",6,0)
SC CHANGE HISTORY OK
"KRN",19,2916272,"RPC",7,0)
SC DELETE ENTRY
"KRN",19,2916272,"RPC",8,0)
SC DELETE HISTORY
"KRN",19,2916272,"RPC",9,0)
SC FILE NUMBER
"KRN",19,2916272,"RPC",10,0)
SC FILE PAT TM ASGN
"KRN",19,2916272,"RPC",12,0)
SC FILE SINGLE VALUE
"KRN",19,2916272,"RPC",13,0)
SC FILER
"KRN",19,2916272,"RPC",14,0)
SC FIND
"KRN",19,2916272,"RPC",15,0)
SC GET PAT BLOCK
"KRN",19,2916272,"RPC",18,0)
SC GETS ENTRY DATA
"KRN",19,2916272,"RPC",19,0)
SC GLOBAL NODE
"KRN",19,2916272,"RPC",20,0)
SC GLOBAL NODE COUNT
"KRN",19,2916272,"RPC",21,0)
SC HISTORY STATUS OK
"KRN",19,2916272,"RPC",22,0)
SC INACTIVATE ENTRY
"KRN",19,2916272,"RPC",23,0)
SC LISTER
"KRN",19,2916272,"RPC",24,0)
SC LOCK/UNLOCK NODE
"KRN",19,2916272,"RPC",25,0)
SC MAILMAN
"KRN",19,2916272,"RPC",26,0)
SC MEAN TEST
"KRN",19,2916272,"RPC",27,0)
SC NEW HISTORY OK
"KRN",19,2916272,"RPC",28,0)
SC PATIENT LOOKUP
"KRN",19,2916272,"RPC",29,0)
SC POSITION MEMBERS
"KRN",19,2916272,"RPC",30,0)
SC PRIMARY CARE TEAM
"KRN",19,2916272,"RPC",31,0)
SC PRTP
"KRN",19,2916272,"RPC",32,0)
SC STAFF LOOKUP
"KRN",19,2916272,"RPC",33,0)
SC TEAM LIST
"KRN",19,2916272,"RPC",34,0)
SC USER CLASS STATUS
"KRN",19,2916272,"RPC",35,0)
SC VALIDATOR
"KRN",19,2916272,"RPC",36,0)
SCRP DEFINITION GETRECORD
"KRN",19,2916272,"RPC",37,0)
SCRP FILE ENTRY GETSELECTION
"KRN",19,2916272,"RPC",38,0)
SCRP QUERY CHECK NAME
"KRN",19,2916272,"RPC",39,0)
SCRP QUERY DELETE
"KRN",19,2916272,"RPC",40,0)
SCRP QUERY GETRECORD
"KRN",19,2916272,"RPC",41,0)
SCRP QUERY SAVE
"KRN",19,2916272,"RPC",42,0)
SCRP QUERY VALIDATE
"KRN",19,2916272,"RPC",43,0)
SCRP REPORT PRINT
"KRN",19,2916272,"RPC",44,0)
SCRP SELECTION SOURCE
"KRN",19,2916272,"RPC",45,0)
SCTM AUTOLINK GETLINK
"KRN",19,2916272,"RPC",46,0)
SCTM AUTOLINK GETRECORD
"KRN",19,2916272,"RPC",47,0)
SCTM AUTOLINK SETRECORD
"KRN",19,2916272,"RPC",48,0)
SCUT GET USER RECORD
"KRN",19,2916272,"RPC",49,0)
SCUT SET USER QUERY DEFAULT
"KRN",19,2916272,"RPC",50,0)
SC KEY CHECK
"KRN",19,2916272,"RPC",51,0)
SC BLD PAT SCDE LIST
"KRN",19,2916272,"RPC",52,0)
SC BLD PAT TM LIST
"KRN",19,2916272,"RPC",53,0)
SC FILE PAT POS ASGN
"KRN",19,2916272,"RPC",54,0)
SC BLD PAT POS LIST
"KRN",19,2916272,"RPC",55,0)
SC PAT ENROLL CLN
"KRN",19,2916272,"RPC",56,0)
SC CHECK FOR PC POS
"KRN",19,2916272,"RPC",57,0)
SC FILE ALL PAT TM ASGN
"KRN",19,2916272,"RPC",58,0)
SC BLD PAT APT LIST
"KRN",19,2916272,"RPC",59,0)
SC FILE ALL PAT POS ASGN
"KRN",19,2916272,"RPC",60,0)
SC BLD NOPC TM LIST
"KRN",19,2916272,"RPC",61,0)
SC PAT ASGN MAILMAN
"KRN",19,2916272,"RPC",62,0)
DDR FILER
"KRN",19,2916272,"RPC",63,0)
DDR FIND1
"KRN",19,2916272,"RPC",64,0)
DDR FINDER
"KRN",19,2916272,"RPC",65,0)
DDR GET DD HELP
"KRN",19,2916272,"RPC",66,0)
DDR DELETE ENTRY
"KRN",19,2916272,"RPC",67,0)
DDR GETS ENTRY DATA
"KRN",19,2916272,"RPC",68,0)
DDR LISTER
"KRN",19,2916272,"RPC",69,0)
DDR LOCK/UNLOCK NODE
"KRN",19,2916272,"RPC",70,0)
DDR VALIDATOR
"KRN",19,2916272,"RPC",71,0)
SC ACTIVE POSITION ASSIGNMENTS
"KRN",19,2916272,"RPC",72,0)
SCMC DIS TEAM POS
"KRN",19,2916272,"RPC",73,0)
SCMC BLD TEAM PAT LIST
"KRN",19,2916272,"RPC",75,0)
SCMC BLD REASSIGN PAT LIST
"KRN",19,2916272,"RPC",76,0)
SCMC FILE PAT POS REASGN
"KRN",19,2916272,"RPC",77,0)
SCMC FILE PAT TM REASGN
"KRN",19,2916272,"RPC",78,0)
SCMC BLD POS PAT LIST
"KRN",19,2916272,"RPC",79,0)
SCMC POSITION ASSIGN LIST
"KRN",19,2916272,"RPC",80,0)
SCMC GET PARAMETER IEN
"KRN",19,2916272,"RPC",81,0)
SCMC VERIFY C/S SYNC
"KRN",19,2916272,"RPC",82,0)
DG CHK BS5 XREF Y/N
"KRN",19,2916272,"RPC",83,0)
DG CHK PAT/DIV MEANS TEST
"KRN",19,2916272,"RPC",84,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,2916272,"RPC",85,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,2916272,"RPC",86,0)
SC FTEE BUILD LIST
"KRN",19,2916272,"RPC",87,0)
SC FTEE FILE LIST
"KRN",19,2916272,"RPC",88,0)
SC PC PROVIDER
"KRN",19,2916272,"RPC",89,0)
SCMC WAIT LIST ENTRY
"KRN",19,2916272,"RPC",90,0)
SC SC CONDITION LIST
"KRN",19,2916272,"RPC",91,0)
SC CHECK FOR ENROLLMENT
"KRN",19,2916272,"RPC",92,0)
SC EXTEND BUILD LIST
"KRN",19,2916272,"RPC",93,0)
SC EXTEND FILE LIST
"KRN",19,2916272,"RPC",94,0)
SC FILE ASSOCIATE CLINICS
"KRN",19,2916272,"RPC",95,0)
SC GET ASSOCIATE CLINICS
"KRN",19,2916272,"RPC",96,0)
SC POSITION RESIDENT ROLE
"KRN",19,2916272,"RPC",97,0)
SCMC FILE INACTIVATION END
"KRN",19,2916272,"RPC",98,0)
SCMC PCMM CHECK FTEE
"KRN",19,2916272,"RPC",99,0)
SCMC POSITION PC CHECK
"KRN",19,2916272,"RPC",100,0)
SCMC ROLE
"KRN",19,2916272,"RPC",101,0)
SCMC PRECEPTOR MOVE - MOVE
"KRN",19,2916272,"RPC",102,0)
SCMC PRECEPTOR MOVE - LIST
"KRN",19,2916272,"RPC",103,0)
SCMC AUTO INACTIVATION RPT
"KRN",19,2916272,"U")
PCMM GUI WORKSTATION
"KRN",19,2920401,-1)
0^2
"KRN",19,2920401,0)
SCMC PCMM TEAM PURPOSE LIST^Team Purpose List^^P^^^^^^^^SCHEDULING
"KRN",19,2920401,1,0)
^19.06^1^1^3090401^^^
"KRN",19,2920401,1,1,0)
This option displays TEAMS with a TEAM PURPOSE  of OIF OEF.
"KRN",19,2920401,60)
SCTM(404.51,
"KRN",19,2920401,63)
[SCMCTP]
"KRN",19,2920401,64)
[SCMCTP]
"KRN",19,2920401,"U")
TEAM PURPOSE LIST
"KRN",8994,2621,-1)
0^4
"KRN",8994,2621,0)
SCMC PCMM CHECK FTEE^FTEECHK^SCMCTSK1^1^P^0
"KRN",8994,2621,1,0)
^8994.01^1^1^3030306^^^^
"KRN",8994,2621,1,1,0)
Determine if provider has exceeded 1.0 FTEE
"KRN",8994,2621,2,0)
^8994.02A^2^2
"KRN",8994,2621,2,1,0)
SCPATCH^1^60^1^1
"KRN",8994,2621,2,1,1,0)
^^1^1^2991209^
"KRN",8994,2621,2,1,1,1,0)
PatchVersion ^ ClientVersion
"KRN",8994,2621,2,2,0)
TPIEN^1^^1
"KRN",8994,2621,2,2,1,0)
^8994.021^1^1^3030306^^
"KRN",8994,2621,2,2,1,1,0)
POSITION ASSIGNMENT HISTORY IEN ^ FTEE VALUE
"KRN",8994,2621,2,"B","SCPATCH",1)

"KRN",8994,2621,2,"B","TPIEN",2)

"KRN",8994,2621,2,"PARAMSEQ",1,1)

"KRN",8994,2621,3,0)
^8994.03^1^1^3030306^^^
"KRN",8994,2621,3,1,0)
Zero if OK otherwise 1^current FTEE
"KRN",8994,2648,-1)
0^2
"KRN",8994,2648,0)
SCMC PRECEPTOR MOVE - LIST^LISTPREC^SCMCPREC^2^P^^^1
"KRN",8994,2648,2,0)
^8994.02A
"KRN",8994,2649,-1)
0^3
"KRN",8994,2649,0)
SCMC PRECEPTOR MOVE - MOVE^MOVEPREC^SCMCPREC^2^^^^1
"KRN",8994,2650,-1)
0^1
"KRN",8994,2650,0)
SCMC AUTO INACTIVATION RPT^EN^SCMCTSKG^4^P^^^1
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930930
"PKG",16,22,1,"PAH",1,0)
504^3100331^520651086
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3100331
"PKG",16,22,1,"PAH",1,1,1,0)
This patch enhances PCMM (Patient Care Management Module) functionality.
"PKG",16,22,1,"PAH",1,1,2,0)
Please .  Please 
"PKG",16,22,1,"PAH",1,1,3,0)
review the FORUM patch module for a complete description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","SCAPU1")
0^11^B5697016^B5694042
"RTN","SCAPU1",1,0)
SCAPU1 ;ALB/REW - TEAM API UTILITIES ; 9/17/09 4:30pm
"RTN","SCAPU1",2,0)
 ;;5.3;Scheduling;**41,504**;AUG 13, 1993;Build 21
"RTN","SCAPU1",3,0)
 ;;1.0
"RTN","SCAPU1",4,0)
DTCHK2(SCDATES,ACTDT,INACTDT) ;given scdates array was it active?
"RTN","SCAPU1",5,0)
 N SCBEGIN,SCEND,SCINCL
"RTN","SCAPU1",6,0)
 D INIT^SCAPMCU1(1) ;set default array
"RTN","SCAPU1",7,0)
 Q $$DTCHK(SCBEGIN,SCEND,SCINCL,ACTDT,.INACTDT)
"RTN","SCAPU1",8,0)
 ;
"RTN","SCAPU1",9,0)
DTCHK(BEGINDT,ENDDT,INCL,ACTDT,INACTDT) ; -- given activation/inactivation dates and begin & end dates and include flag was it active?
"RTN","SCAPU1",10,0)
 ;Parameters:
"RTN","SCAPU1",11,0)
 ;  BEGINDT - begining date
"RTN","SCAPU1",12,0)
 ;  ENDDT   - ending date
"RTN","SCAPU1",13,0)
 ;  INCL    - 1= must be active for whole period to get a 'yes'/0 o/w
"RTN","SCAPU1",14,0)
 ;  ACTDT   - activation date for record
"RTN","SCAPU1",15,0)
 ;  INACTDT - inactivation date for record 
"RTN","SCAPU1",16,0)
 ;  returns: 1 = Active
"RTN","SCAPU1",17,0)
 ;           0 = Inactive
"RTN","SCAPU1",18,0)
 ;          -1 = Error
"RTN","SCAPU1",19,0)
 ; 
"RTN","SCAPU1",20,0)
 N OK
"RTN","SCAPU1",21,0)
 S OK=-1
"RTN","SCAPU1",22,0)
 G DTCHKQ:'$G(BEGINDT)!('$G(ENDDT))!('$G(ACTDT))
"RTN","SCAPU1",23,0)
 S OK=0
"RTN","SCAPU1",24,0)
 ; begin is after inactivation
"RTN","SCAPU1",25,0)
 IF $G(INACTDT),BEGINDT'<INACTDT G DTCHKQ
"RTN","SCAPU1",26,0)
 ; end is before effective date
"RTN","SCAPU1",27,0)
 IF ENDDT<ACTDT G DTCHKQ
"RTN","SCAPU1",28,0)
 ; just need 1 day in range
"RTN","SCAPU1",29,0)
 IF $G(INCL)=0 S OK=1 G DTCHKQ
"RTN","SCAPU1",30,0)
 ; begin is not before effective date
"RTN","SCAPU1",31,0)
 IF ACTDT>BEGINDT G DTCHKQ
"RTN","SCAPU1",32,0)
 ; inactivation exists & isn't after end
"RTN","SCAPU1",33,0)
 IF $G(INACTDT),INACTDT<ENDDT G DTCHKQ
"RTN","SCAPU1",34,0)
 S OK=1
"RTN","SCAPU1",35,0)
DTCHKQ Q OK
"RTN","SCAPU1",36,0)
 ;
"RTN","SCAPU1",37,0)
ERR(SEQ,ERNUM,PARMS,OUTPUT,SCER) ;-- process errors
"RTN","SCAPU1",38,0)
 ;if no dialog entry 4040000 will be processed
"RTN","SCAPU1",39,0)
 S ERNUM=$G(ERNUM,4040000)
"RTN","SCAPU1",40,0)
 S:'$$GET1^DIQ(.84,$G(ERNUM)_",",.01) ERNUM=4040000
"RTN","SCAPU1",41,0)
 IF SCER]"" D
"RTN","SCAPU1",42,0)
 . S SEQ=SEQ+1
"RTN","SCAPU1",43,0)
 . S SCER(SEQ)=ERNUM
"RTN","SCAPU1",44,0)
 .D BLD^DIALOG(.ERNUM,.PARMS,.OUTPUT,.SCER)
"RTN","SCAPU1",45,0)
 Q
"RTN","SCAPU1",46,0)
 ;
"RTN","SCAPU1",47,0)
OKARRAY(ARRAY,CHECK) ; see if input array says 'check' should be used
"RTN","SCAPU1",48,0)
 ;  DOES NOT change any varriables - $$okarray(.xx,.yy) is safe...
"RTN","SCAPU1",49,0)
 ;  if array is null OR undefined it is ok
"RTN","SCAPU1",50,0)
 ;  if @array@(check) is defined it is ok
"RTN","SCAPU1",51,0)
 ;  if @array@('exclude') is defined results switch
"RTN","SCAPU1",52,0)
 ;  RETURNS: 1: Yes use/0: No don't
"RTN","SCAPU1",53,0)
 Q $S('$L($G(CHECK)):1,'$L($G(ARRAY)):1,(ARRAY'?1A1.7AN):0,1:'(($D(@ARRAY@(CHECK))#2)=($D(@ARRAY@("EXCLUDE"))#2)))  ;changed to quit if check is not defined
"RTN","SCAPU1",54,0)
 ;
"RTN","SCAPU1",55,0)
OKUSRCL(USRARRAY,CHECK) ; see if input user class array says 'check' is ok
"RTN","SCAPU1",56,0)
 N SCOK,SCU
"RTN","SCAPU1",57,0)
 S SCOK=0
"RTN","SCAPU1",58,0)
 IF '$L($G(CHECK))!('$L($G(USRARRAY))) S SCOK=1 G QTOKUSR
"RTN","SCAPU1",59,0)
 IF (USRARRAY'?1A1.7AN)&(USRARRAY'?1"^"1A.E) G QTOKUSR
"RTN","SCAPU1",60,0)
 S SCU=0
"RTN","SCAPU1",61,0)
 IF $D(@USRARRAY@("EXCLUDE"))#2 D
"RTN","SCAPU1",62,0)
 .S SCOK=1
"RTN","SCAPU1",63,0)
 .F  S SCU=$O(@USRARRAY@(SCU)) Q:'SCU  S:(CHECK=SCU)!($$SUBCLASS^USRLM(CHECK,SCU)) SCOK=0
"RTN","SCAPU1",64,0)
 ELSE  D
"RTN","SCAPU1",65,0)
 .S SCOK=0
"RTN","SCAPU1",66,0)
 .F  S SCU=$O(@USRARRAY@(SCU)) Q:'SCU  S:(CHECK=SCU)!($$SUBCLASS^USRLM(CHECK,SCU)) SCOK=1
"RTN","SCAPU1",67,0)
 .
"RTN","SCAPU1",68,0)
QTOKUSR Q SCOK
"RTN","SCMCDDA")
0^12^B3262760^B2917179
"RTN","SCMCDDA",1,0)
SCMCDDA ;bp/cmf - extension of SCMCDD ; 9/17/09 4:33pm
"RTN","SCMCDDA",2,0)
 ;;5.3;Scheduling;**204,297,504**;AUG 13, 1993;Build 21
"RTN","SCMCDDA",3,0)
 ;1
"RTN","SCMCDDA",4,0)
BADNEWDT() ; not a stand alone function!!  called from NEWHIST^SCMCDD
"RTN","SCMCDDA",5,0)
 ;       ; ensure team/team position is active on DATE
"RTN","SCMCDDA",6,0)
 I FILE=404.59 D  I +SCOK=0 Q 1
"RTN","SCMCDDA",7,0)
 . D OKTMTP(IEN,DATE)
"RTN","SCMCDDA",8,0)
 . Q
"RTN","SCMCDDA",9,0)
 ;
"RTN","SCMCDDA",10,0)
 I FILE=404.52 D  I +SCOK=0 Q 1
"RTN","SCMCDDA",11,0)
 . D OKTMTP(IEN,DATE)
"RTN","SCMCDDA",12,0)
 . D OKTP(IEN,DATE)
"RTN","SCMCDDA",13,0)
 . ;;bp/cmf if not active, delete newhist entry here?!? [SCHIEN]
"RTN","SCMCDDA",14,0)
 . Q
"RTN","SCMCDDA",15,0)
 ; added **504**
"RTN","SCMCDDA",16,0)
 I FILE=404.53 D  I +SCOK=0 Q 1
"RTN","SCMCDDA",17,0)
 . D OKTMTP(IEN,DATE)
"RTN","SCMCDDA",18,0)
 . D OKTP(IEN,DATE)
"RTN","SCMCDDA",19,0)
 . Q
"RTN","SCMCDDA",20,0)
 ;
"RTN","SCMCDDA",21,0)
 Q 0
"RTN","SCMCDDA",22,0)
 ;
"RTN","SCMCDDA",23,0)
BADCHGDT() ; not a stand alone function!!  called from OKCHGDT^SCMCDD
"RTN","SCMCDDA",24,0)
 I FILE=404.59 D  I +SCOK=0 Q 1
"RTN","SCMCDDA",25,0)
 . N SCTP
"RTN","SCMCDDA",26,0)
 . S SCTP=$P(SCNODE,U)
"RTN","SCMCDDA",27,0)
 . D OKTMTP(SCTP,DATE)
"RTN","SCMCDDA",28,0)
 . Q
"RTN","SCMCDDA",29,0)
 ;
"RTN","SCMCDDA",30,0)
 I FILE=404.52 D  I +SCOK=0 Q 1
"RTN","SCMCDDA",31,0)
 . N SCTP
"RTN","SCMCDDA",32,0)
 . S SCTP=$P(SCNODE,U)
"RTN","SCMCDDA",33,0)
 . D OKTMTP(SCTP,DATE)
"RTN","SCMCDDA",34,0)
 . D OKTP(SCTP,DATE)
"RTN","SCMCDDA",35,0)
 . Q
"RTN","SCMCDDA",36,0)
 ;
"RTN","SCMCDDA",37,0)
 Q 0
"RTN","SCMCDDA",38,0)
 ;
"RTN","SCMCDDA",39,0)
OKTMTP(SC1,SC2) ;
"RTN","SCMCDDA",40,0)
 ; sc1 := team position ien
"RTN","SCMCDDA",41,0)
 ; sc2 := assignment date
"RTN","SCMCDDA",42,0)
 N SCNODE,SCTM
"RTN","SCMCDDA",43,0)
 S SCNODE=$G(^SCTM(404.57,SC1,0),"BAD")
"RTN","SCMCDDA",44,0)
 I SCNODE="BAD" S SCOK="0^Bad Team Position entry." Q
"RTN","SCMCDDA",45,0)
 S SCTM=$P(SCNODE,U,2)
"RTN","SCMCDDA",46,0)
 S SCNODE=$G(^SCTM(404.51,SCTM,0),"BAD")
"RTN","SCMCDDA",47,0)
 I SCNODE="BAD" S SCOK="0^Bad Team entry." Q
"RTN","SCMCDDA",48,0)
 S SCX=+$$DATES^SCAPMCU1(404.58,SCTM,SC2)
"RTN","SCMCDDA",49,0)
 I SCX<1 S SCOK="0^Team not active on selected date."
"RTN","SCMCDDA",50,0)
 Q
"RTN","SCMCDDA",51,0)
 ;
"RTN","SCMCDDA",52,0)
OKTP(SC1,SC2) ;
"RTN","SCMCDDA",53,0)
 ; sc1 := team position ien
"RTN","SCMCDDA",54,0)
 ; sc2 := assignment date
"RTN","SCMCDDA",55,0)
 S SCX=+$$DATES^SCAPMCU1(404.59,SC1,SC2)
"RTN","SCMCDDA",56,0)
 I SCX<1 S SCOK="0^Team Position not active on selected date."
"RTN","SCMCDDA",57,0)
 Q
"RTN","SCMCDDA",58,0)
 ;
"RTN","SCMCPREC")
0^2^B4146089^n/a
"RTN","SCMCPREC",1,0)
SCMCPREC ;bpoifo/swo move preceptors;3.20.08
"RTN","SCMCPREC",2,0)
 ;;5.3;Scheduling;**504**;AUG 13, 1993;Build 21
"RTN","SCMCPREC",3,0)
 Q
"RTN","SCMCPREC",4,0)
LISTPREC(SCRESULT,SCPIEN)  ;
"RTN","SCMCPREC",5,0)
 ;List preceptees for a preceptor position
"RTN","SCMCPREC",6,0)
 ;Input
"RTN","SCMCPREC",7,0)
 ;   SCPIEN   := preceptor pos ien (404.57) (required)
"RTN","SCMCPREC",8,0)
 ;   SCRESULT := return array
"RTN","SCMCPREC",9,0)
 ;               Piece     Description
"RTN","SCMCPREC",10,0)
 ;                 1       IEN of NEW PERSON file entry (#200)
"RTN","SCMCPREC",11,0)
 ;                 2       Name of person
"RTN","SCMCPREC",12,0)
 ;                 3       IEN of TEAM POSITION file (#404.57)
"RTN","SCMCPREC",13,0)
 ;                 4       Name of Position
"RTN","SCMCPREC",14,0)
 ;                 5       IEN OF USR CLASS(8930) of POSITION (404.57)
"RTN","SCMCPREC",15,0)
 ;                 6       USR Class Name
"RTN","SCMCPREC",16,0)
 ;                 7       IEN of STANDARD POSITION (#403.46)
"RTN","SCMCPREC",17,0)
 ;                 8       Standard Role (Position) Name
"RTN","SCMCPREC",18,0)
 ;                 9       Activation Date for 404.52 (not 404.59!)
"RTN","SCMCPREC",19,0)
 ;                 10      Inactivation Date for 404.52
"RTN","SCMCPREC",20,0)
 ;                 11      IEN of Position Asgn History (404.52)
"RTN","SCMCPREC",21,0)
 ;                 12      IEN of Current(=DT) Preceptor Position
"RTN","SCMCPREC",22,0)
 ;                 13      Name of Current(=DT) Preceptor Position
"RTN","SCMCPREC",23,0)
 ;                 14      precept start date
"RTN","SCMCPREC",24,0)
 ;                 15      precept end date
"RTN","SCMCPREC",25,0)
 ;                 16      IEN of Preceptor Asgn History (404.53)
"RTN","SCMCPREC",26,0)
 N SCDATES,V1
"RTN","SCMCPREC",27,0)
 I SCPIEN="" S SCRESULT(0)=0 Q 0
"RTN","SCMCPREC",28,0)
 S SCDATES("BEGIN")=DT
"RTN","SCMCPREC",29,0)
 S SCDATES("END")=DT
"RTN","SCMCPREC",30,0)
 S SCDATES("INCL")=0
"RTN","SCMCPREC",31,0)
 S V1=$$PRECHIS^SCMCLK(SCPIEN,"SCDATES","SCRESULT") I $D(SCRESULT) K SCRESULT("SCPR") Q 1
"RTN","SCMCPREC",32,0)
 S SCRESULT(0)=0
"RTN","SCMCPREC",33,0)
 Q 0
"RTN","SCMCPREC",34,0)
MOVEPREC(SCRESULT,SCPIEN1,SCED1,SCPIEN2,SCED2)  ;
"RTN","SCMCPREC",35,0)
 ;Move preceptees from one position to another
"RTN","SCMCPREC",36,0)
 ;Input
"RTN","SCMCPREC",37,0)
 ;   SCPIEN1   := FROM preceptor pos ien (404.57) (required)
"RTN","SCMCPREC",38,0)
 ;   SCPIEN2   := TO preceptor pos ien (404.57) (required)
"RTN","SCMCPREC",39,0)
 ;   SCED1     := FROM preceptor effective date
"RTN","SCMCPREC",40,0)
 ;   SCED2     := TO preceptor effective date
"RTN","SCMCPREC",41,0)
 ;   SCRESULT  := return array 0 = fail 1 = success
"RTN","SCMCPREC",42,0)
 I SCPIEN1="" S SCRESULT(0)=0 Q 0
"RTN","SCMCPREC",43,0)
 I SCPIEN2="" S SCRESULT(0)=0 Q 0
"RTN","SCMCPREC",44,0)
 S SCED1=$S($G(SCED1)="":"T-1",1:SCED1)
"RTN","SCMCPREC",45,0)
 S SCED2=$S($G(SCED2)="":"TODAY",1:SCED2)
"RTN","SCMCPREC",46,0)
 N V1,ZNODE,DIC,DIE,DR,DA,SCARRAY
"RTN","SCMCPREC",47,0)
 S DIE="^SCTM(404.53,"
"RTN","SCMCPREC",48,0)
 S DR=".02///"_SCED1_";.04///0;.05///CHANGE PRECEPTOR LINK;.08///NOW;.07///"_DUZ
"RTN","SCMCPREC",49,0)
 ;Loop thru "FROM" preceptor for current preceptees and inactivate them
"RTN","SCMCPREC",50,0)
 S V1=0 F  S V1=$O(^SCTM(404.53,"D",SCPIEN1,V1)) Q:'V1  D
"RTN","SCMCPREC",51,0)
 .S ZNODE=$G(^SCTM(404.53,V1,0)) Q:ZNODE=""
"RTN","SCMCPREC",52,0)
 .I '$P(ZNODE,"^",4) Q  ;INACTIVE
"RTN","SCMCPREC",53,0)
 .S SCARRAY($P(ZNODE,U))=""
"RTN","SCMCPREC",54,0)
 .S DA=V1
"RTN","SCMCPREC",55,0)
 .D ^DIE
"RTN","SCMCPREC",56,0)
 ;Create new assignments for the "TO" preceptor
"RTN","SCMCPREC",57,0)
 S DIC="^SCTM(404.53,"
"RTN","SCMCPREC",58,0)
 S DIC(0)="Z"
"RTN","SCMCPREC",59,0)
 S DIC("DR")=".02///"_SCED2_";.04///1;.05///ACTIVATE PRECEPTOR LINK;.06///"_SCPIEN2_";.08///NOW;.07///"_DUZ
"RTN","SCMCPREC",60,0)
 S V1=0 F  S V1=$O(SCARRAY(V1)) Q:'V1  D
"RTN","SCMCPREC",61,0)
 .K D0
"RTN","SCMCPREC",62,0)
 .S X=V1
"RTN","SCMCPREC",63,0)
 .D FILE^DICN
"RTN","SCMCPREC",64,0)
 S SCRESULT(0)=1
"RTN","SCMCPREC",65,0)
 Q 1
"RTN","SCMCTPUR")
0^7^B445864^n/a
"RTN","SCMCTPUR",1,0)
SCMCTPUR ;BP/DMR - PCMM GUI OEF/OIF SCREEN; 2/24/09
"RTN","SCMCTPUR",2,0)
 ;;5.3;Scheduling;**504**;AUG 13, 1993;Build 21
"RTN","SCMCTPUR",3,0)
 ;
"RTN","SCMCTPUR",4,0)
 ;
"RTN","SCMCTPUR",5,0)
START(Y) ;
"RTN","SCMCTPUR",6,0)
 S STOP=1,XX=0
"RTN","SCMCTPUR",7,0)
 I Y="" Q STOP
"RTN","SCMCTPUR",8,0)
 I $$GET1^DIQ(403.47,Y_",",.01)'="OIF OEF" Q STOP
"RTN","SCMCTPUR",9,0)
 ;
"RTN","SCMCTPUR",10,0)
 F  S XX=$O(^SCTM(404.51,XX)) Q:'XX  D
"RTN","SCMCTPUR",11,0)
 .S PUR="" S PUR=$P($G(^SCTM(404.51,XX,0)),"^",3)
"RTN","SCMCTPUR",12,0)
 .I PUR'="" D
"RTN","SCMCTPUR",13,0)
 ..I $P($G(^SD(403.47,PUR,0)),"^",1)="OIF OEF" S STOP=0
"RTN","SCMCTPUR",14,0)
 Q STOP
"RTN","SCMCTSK1")
0^3^B83874650^B79165926
"RTN","SCMCTSK1",1,0)
SCMCTSK1 ;ALB/JDS - PCMM Inactivations; 18 Apr 2003  9:36 AM ; 10/24/07 12:24pm  ; Compiled January 25, 2008 12:11:43  ; Compiled March 26, 2008 22:27:26
"RTN","SCMCTSK1",2,0)
 ;;5.3;Scheduling;**297,498,527,499,532,504**;AUG 13, 1993;Build 21
"RTN","SCMCTSK1",3,0)
 Q
"RTN","SCMCTSK1",4,0)
INACTIVE ;
"RTN","SCMCTSK1",5,0)
 ;Flag patients
"RTN","SCMCTSK1",6,0)
 N I,CNT,SC297,TPZ,TYDT,TEAMN,STDT,Q,SDDT,STDD S CNT=0
"RTN","SCMCTSK1",7,0)
 D DT^DICRW
"RTN","SCMCTSK1",8,0)
 N SD1 S SDDT="" F SD1=DT,DT-1 I $D(^XTMP("SCMCTSK2-"_SD1,$J,"START")) S SDDT=SD1 Q
"RTN","SCMCTSK1",9,0)
 I SDDT'>0 D DT^DICRW S SDDT=DT
"RTN","SCMCTSK1",10,0)
 S %DT="",X="T-11M" D ^%DT S STDD=+Y
"RTN","SCMCTSK1",11,0)
 S A="^SCPT(404.43,""ADFN""",L=""""""
"RTN","SCMCTSK1",12,0)
 S Q=A_")"
"RTN","SCMCTSK1",13,0)
 F  S Q=$Q(@Q) Q:Q'[A  D
"RTN","SCMCTSK1",14,0)
 .S ENTRY=+$P(Q,",",6)
"RTN","SCMCTSK1",15,0)
 .S ZERO=$G(^SCPT(404.43,+ENTRY,0))
"RTN","SCMCTSK1",16,0)
 .I $P(ZERO,U,15) Q
"RTN","SCMCTSK1",17,0)
 .S POS=+$P(ZERO,U,2)
"RTN","SCMCTSK1",18,0)
 .I $P(ZERO,U,4) Q  ;UNASS
"RTN","SCMCTSK1",19,0)
 .I '$P(ZERO,U,5) Q  ;Not PC
"RTN","SCMCTSK1",20,0)
 .I $P(ZERO,U,3)>STDD Q  ;<11 months
"RTN","SCMCTSK1",21,0)
 .;get preceptor
"RTN","SCMCTSK1",22,0)
 .S PREC=$$DATES^SCAPMCU1(404.53,+POS),PREC=$S(PREC:$P($G(^SCTM(404.53,+$P(PREC,U,4),0)),U,6),1:+POS)
"RTN","SCMCTSK1",23,0)
 .S DFN=$P(Q,",",3)
"RTN","SCMCTSK1",24,0)
 .I $G(XPDIDTOT),('(DFN#5)) D UPDATE^XPDID(DFN)
"RTN","SCMCTSK1",25,0)
 .S TEAM=$P(Q,",",4),TEAMNM=$P($G(^SCTM(404.51,+TEAM,0)),U)
"RTN","SCMCTSK1",26,0)
 .N STDT S %DT="",X="T-12M" D ^%DT S STDT=+Y
"RTN","SCMCTSK1",27,0)
 .;N-new or E-est
"RTN","SCMCTSK1",28,0)
 .N NEW
"RTN","SCMCTSK1",29,0)
 .I $P(ZERO,U,3)<STDT S NEW=0
"RTN","SCMCTSK1",30,0)
 .E  S NEW=1
"RTN","SCMCTSK1",31,0)
 .N TYDT
"RTN","SCMCTSK1",32,0)
 .I NEW N STDT S %DT="",X="T-11M" D ^%DT S STDT=+Y D
"RTN","SCMCTSK1",33,0)
 ..S X1=STDT,X2=-7 D C^%DTC S TYDT=X
"RTN","SCMCTSK1",34,0)
 .I 'NEW N STDT S %DT="",X="T-23M" D ^%DT S STDT=+Y Q:$P(ZERO,U,3)'<STDT  D
"RTN","SCMCTSK1",35,0)
 ..S X1=STDT,X2=-7 D C^%DTC S TYDT=X
"RTN","SCMCTSK1",36,0)
 .N PROV,SEEN,PRECP D SEEN(DFN,POS,TYDT,SDDT,.PROV,.PRECP,.SEEN) Q:SEEN
"RTN","SCMCTSK1",37,0)
 .;flag
"RTN","SCMCTSK1",38,0)
 .S DIE="^SCPT(404.43,",DR=".15////"_SDDT,DA=ENTRY D ^DIE
"RTN","SCMCTSK1",39,0)
 .S TPZ=$G(^SCTM(404.57,+POS,2))
"RTN","SCMCTSK1",40,0)
 .I "TP"[$P(TPZ,U,9) I $G(PROV) S CNT=CNT+1,^TMP("SCF",$J,PROV,CNT,ENTRY)=""
"RTN","SCMCTSK1",41,0)
 .I $P(TPZ,U,10),$G(PRECP) S CNT=CNT+1,^TMP("SCF",$J,PRECP,CNT,ENTRY)=""
"RTN","SCMCTSK1",42,0)
 Q
"RTN","SCMCTSK1",43,0)
SEEN(DFN,POS,TYDT,SDDT,PROV,PROVP,SEEN) ;
"RTN","SCMCTSK1",44,0)
 S SEEN=0,PROVP=""
"RTN","SCMCTSK1",45,0)
 N SCPRO,I,PRO,X,SCPRDTS,SCPR,PREC
"RTN","SCMCTSK1",46,0)
 S PROV=+$$GETPRTP^SCAPMCU2(POS,SDDT)
"RTN","SCMCTSK1",47,0)
 S SCPRDTS("BEGIN")=TYDT,SCPRDTS("END")=SDDT,SCPRDTS("INCL")=0
"RTN","SCMCTSK1",48,0)
 S X=$$PRTP^SCAPMC(POS,"SCPRDTS","SCPR")
"RTN","SCMCTSK1",49,0)
 S I=0 F  S I=$O(SCPR(I)) Q:'I  S SCPRO(+SCPR(I))="",SCPRO(+SCPR(I),I)=$P(SCPR(I),U,9,10) D
"RTN","SCMCTSK1",50,0)
 .S PREC=$P(SCPR(I),U,12)
"RTN","SCMCTSK1",51,0)
 .I PREC,PREC'=POS S PROVP=+$$GETPRTP^SCAPMCU2(PREC,SDDT) S SCPRO(+PROVP)="" S SCPRO(+PROVP,I)=$P(SCPR(I),U,9,10)
"RTN","SCMCTSK1",52,0)
 F I=TYDT:0 S I=$O(^SCE("ADFN",DFN,I)) Q:'I  D  Q:SEEN
"RTN","SCMCTSK1",53,0)
 .S J=0 F  S J=$O(^SCE("ADFN",DFN,I,J)) Q:'J  D  Q:SEEN
"RTN","SCMCTSK1",54,0)
 ..N VISIT S VISIT=+$P($G(^SCE(J,0)),U,5) I $G(^SCE(J,0))<$G(TYDT) Q
"RTN","SCMCTSK1",55,0)
 ..S PRO=0 F  S PRO=$O(SCPRO(PRO)) Q:'PRO  D  Q:SEEN
"RTN","SCMCTSK1",56,0)
 ...I $D(^SDD(409.44,"AO",J,$G(PRO))) D CHK I SEEN=1 Q
"RTN","SCMCTSK1",57,0)
 ...N V F V=0:0 S V=$O(^AUPNVPRV("AD",VISIT,V)) Q:'V  I PRO=(+$G(^AUPNVPRV(V,0))) D CHK I SEEN=1 Q
"RTN","SCMCTSK1",58,0)
 Q
"RTN","SCMCTSK1",59,0)
CHK ;
"RTN","SCMCTSK1",60,0)
 N SDX S SDX="" F  S SDX=$O(SCPRO(PRO,SDX)) Q:SDX=""  D  Q:SEEN
"RTN","SCMCTSK1",61,0)
 .I $P(SCPRO(PRO,SDX),U,2)="" D  Q
"RTN","SCMCTSK1",62,0)
 ..I I'<$P(SCPRO(PRO,SDX),U) S SEEN=1
"RTN","SCMCTSK1",63,0)
 .I I'<TYDT&(I'>$P(SCPRO(PRO,SDX),U,2)) S SEEN=1
"RTN","SCMCTSK1",64,0)
 Q
"RTN","SCMCTSK1",65,0)
DIS ;disch
"RTN","SCMCTSK1",66,0)
 N ZERO S ZERO=$G(^SCPT(404.43,+ENTRY,0))
"RTN","SCMCTSK1",67,0)
 I $P(ZERO,U,4) Q
"RTN","SCMCTSK1",68,0)
 D DIS2^SCMCTSK7
"RTN","SCMCTSK1",69,0)
 Q
"RTN","SCMCTSK1",70,0)
CHKENR(DATA,INFO) ;check if patient enrolled in teamposition clinic
"RTN","SCMCTSK1",71,0)
 S DATA(0)=-1
"RTN","SCMCTSK1",72,0)
 Q
"RTN","SCMCTSK1",73,0)
EXTEND(DATA,SCTEAM) ;to inact. in next 60 days
"RTN","SCMCTSK1",74,0)
 ;IEN^POSITION^PATIENT^EXTENDED^REASON
"RTN","SCMCTSK1",75,0)
 K DATA,SCDATA,SDDATA
"RTN","SCMCTSK1",76,0)
 N CNT,I,J,K,A,POSA S CNT=1 S SCTEAM=$G(SCTEAM),DATA(1)="<DATA>"
"RTN","SCMCTSK1",77,0)
 D DT^DICRW
"RTN","SCMCTSK1",78,0)
 N SD1 S SDDT="" F SD1=DT,DT-1 I $D(^XTMP("SCMCTSK2-"_SD1,$J,"START")) S SDDT=SD1 Q
"RTN","SCMCTSK1",79,0)
 I SDDT'>0 D DT^DICRW S SDDT=DT
"RTN","SCMCTSK1",80,0)
 S X="T-9M" D ^%DT S STDT=Y
"RTN","SCMCTSK1",81,0)
 S X="T-21M" D ^%DT S TYDT=+Y  ;MAKE THIS 21
"RTN","SCMCTSK1",82,0)
 S POSA=""
"RTN","SCMCTSK1",83,0)
 S POS=+$P(SCTEAM,U,2) I POS D POS,EX1 Q
"RTN","SCMCTSK1",84,0)
 F  S POSA=$O(^SCTM(404.57,"ATMPOS",+SCTEAM,POSA)) Q:POSA=""  D  Q:CNT>100
"RTN","SCMCTSK1",85,0)
 .F POS=0:0 S POS=$O(^SCTM(404.57,"ATMPOS",+SCTEAM,POSA,POS)) Q:'POS  D POS Q:CNT>100
"RTN","SCMCTSK1",86,0)
 I CNT>100 S DATA(1)="TOO MANY" Q
"RTN","SCMCTSK1",87,0)
EX1 S A="SDDATA",CNT=1 F  S A=$Q(@A) Q:A=""  D
"RTN","SCMCTSK1",88,0)
 .S B=@A
"RTN","SCMCTSK1",89,0)
 .S DATA(CNT)=(+$P(B,U,3))_U_$TR($P($P(A,"(",2),","),$C(34))_U_$TR($P(B,U,2),$C(34))_U_$P($G(^SCPT(404.43,+$P(B,U,3),0)),U,13)_U_$P($G(^SCPT(404.43,+$P(B,U,3),0)),U,14)
"RTN","SCMCTSK1",90,0)
 .S CNT=CNT+1
"RTN","SCMCTSK1",91,0)
 Q
"RTN","SCMCTSK1",92,0)
POS I '$$DATES^SCAPMCU1(404.59,POS) Q  ;Position inact
"RTN","SCMCTSK1",93,0)
 I '$P($G(^SCTM(404.57,POS,0)),U,4) Q  ;Not PC
"RTN","SCMCTSK1",94,0)
 ;patients for position
"RTN","SCMCTSK1",95,0)
 K ^TMP("SC TMP LIST",$J)
"RTN","SCMCTSK1",96,0)
 S X=$$PTTP^SCAPMC(POS,"",.SCLIST,.SCERR)
"RTN","SCMCTSK1",97,0)
 S J=0 F  S J=$O(@SCLIST@(J)) Q:'J  S SCDATA=^(J) D
"RTN","SCMCTSK1",98,0)
 .N J I $P(SCDATA,U,4)>STDT Q
"RTN","SCMCTSK1",99,0)
 .I '$P($G(^SCPT(404.43,+$P(SCDATA,U,3),0)),U,5) Q
"RTN","SCMCTSK1",100,0)
 .I '$P($G(^SCPT(404.43,+$P(SCDATA,U,3),0)),U,15) Q
"RTN","SCMCTSK1",101,0)
 .S DFN=+SCDATA
"RTN","SCMCTSK1",102,0)
 .D SEEN(DFN,POS,TYDT,SDDT,.PROV,.PRECP,.SEEN) Q:SEEN
"RTN","SCMCTSK1",103,0)
 .S SDDATA($P($G(^SCTM(404.57,POS,0)),U),$P(SCDATA,U,2),+SCDATA)=SCDATA,CNT=CNT+1
"RTN","SCMCTSK1",104,0)
 K @SCLIST
"RTN","SCMCTSK1",105,0)
 Q
"RTN","SCMCTSK1",106,0)
FILE(RES,DATA) ;File data on FTEE
"RTN","SCMCTSK1",107,0)
 N I
"RTN","SCMCTSK1",108,0)
 F I=1:1 Q:'$D(DATA(I))  D
"RTN","SCMCTSK1",109,0)
 .S $P(DATA(I),U,7)=$TR($P(DATA(I),U,7),"[]")
"RTN","SCMCTSK1",110,0)
 .S ZERO=$G(^SCPT(404.43,+DATA(I),0))
"RTN","SCMCTSK1",111,0)
 .I $P(ZERO,U,13)=$P(DATA(I),U,6) I $P(ZERO,U,14)=$P(DATA(I),U,7) Q
"RTN","SCMCTSK1",112,0)
 .S FLDA(404.43,(+DATA(I))_",",.13)=$P(DATA(I),U,6)
"RTN","SCMCTSK1",113,0)
 .S FLDA(404.43,(+DATA(I))_",",.14)=$E($P(DATA(I),U,7),1,50)
"RTN","SCMCTSK1",114,0)
 .S FLDA(404.43,(+DATA(I))_",",.16)="`"_(+$G(DUZ))
"RTN","SCMCTSK1",115,0)
 I $O(FLDA(0)) D FILE^DIE("E","FLDA","ERR")
"RTN","SCMCTSK1",116,0)
 Q
"RTN","SCMCTSK1",117,0)
SCREEN ;Active assign. screen
"RTN","SCMCTSK1",118,0)
 N A S A=$G(^SCTM(404.52,D0,0))
"RTN","SCMCTSK1",119,0)
 N J S J=-(DT+1),J=$O(^SCTM(404.52,"AIDT",+A,1,J)) I J="" S X=0 Q
"RTN","SCMCTSK1",120,0)
 I '$P($G(^SCTM(404.57,+A,0)),U,4) Q  ;Not PC
"RTN","SCMCTSK1",121,0)
 I '$$DATES^SCAPMCU1(404.59,+A) Q   ;Not an active position
"RTN","SCMCTSK1",122,0)
 I $O(^SCTM(404.52,"AIDT",+A,0,-(DT+1)))<J S X=0 Q
"RTN","SCMCTSK1",123,0)
 I '$D(^SCTM(404.52,"AIDT",+A,1,J,D0)) S X=0 Q
"RTN","SCMCTSK1",124,0)
 S X=1 Q
"RTN","SCMCTSK1",125,0)
SUM(PR,POSI) ;get pos for prov
"RTN","SCMCTSK1",126,0)
 N I,INS,ZERO,SCA,TEAM,FTEE,Z
"RTN","SCMCTSK1",127,0)
 S I="",FTEE=0
"RTN","SCMCTSK1",128,0)
 F  S I=$O(^SCTM(404.52,"C",PR,I),-1) Q:'I  D
"RTN","SCMCTSK1",129,0)
 .S ZERO=$G(^SCTM(404.52,I,0)) Q:$D(SCA(+ZERO))  Q:(POSI=(+ZERO))  S SCA(+ZERO)=""
"RTN","SCMCTSK1",130,0)
 .S INS=$P($G(^SCTM(404.51,+$P($G(^SCTM(404.57,+ZERO,0)),U,2),0)),U,7)
"RTN","SCMCTSK1",131,0)
 .S ACTIVE=$$DATES^SCAPMCU1(404.52,+ZERO,DT+.5) Q:'ACTIVE
"RTN","SCMCTSK1",132,0)
 .S (Z,ZERO)=$G(^SCTM(404.52,+$P(ACTIVE,U,4),0)) Q:$P(Z,U,3)'=PR
"RTN","SCMCTSK1",133,0)
 .S ACTIVE=$$DATES^SCAPMCU1(404.59,+Z,DT+.5) Q:'ACTIVE
"RTN","SCMCTSK1",134,0)
 .S Z=$G(^SCTM(404.57,+Z,0))
"RTN","SCMCTSK1",135,0)
 .Q:'$P(Z,U,4)  ;Cannot be primary
"RTN","SCMCTSK1",136,0)
 .S TEAM=$G(^SCTM(404.51,+$P(Z,U,2),0))
"RTN","SCMCTSK1",137,0)
 .Q:'$P(TEAM,U,5)
"RTN","SCMCTSK1",138,0)
 .S FTEE=FTEE+$P(ZERO,U,9)
"RTN","SCMCTSK1",139,0)
 Q FTEE
"RTN","SCMCTSK1",140,0)
FTEECHK(DATA,PAIEN) ;check Ftee>1
"RTN","SCMCTSK1",141,0)
 ;SD*5.3*504 change begin - ensure passed FTEE is numeric
"RTN","SCMCTSK1",142,0)
 N X,X1,X2,FTEE
"RTN","SCMCTSK1",143,0)
 S DATA=0
"RTN","SCMCTSK1",144,0)
 D:$P(PAIEN,U,2)'=""  Q:DATA=99.1
"RTN","SCMCTSK1",145,0)
 .S X=$$TRIM^XLFSTR($P(PAIEN,U,2),"R"," ")
"RTN","SCMCTSK1",146,0)
 .S X1=$P(X,"."),X1=$S(X1'="":X1,1:0)
"RTN","SCMCTSK1",147,0)
 .S X2=$P(X,".",2,3),X2=$$TRIM^XLFSTR(X2,"L","0"),X2=$S(X2'="":X2,1:0)
"RTN","SCMCTSK1",148,0)
 .S:X1<0!(+X1'=X1)!(+X2'=X2)!(X2'=$TR(X2,".","")) DATA=99.1
"RTN","SCMCTSK1",149,0)
 .Q
"RTN","SCMCTSK1",150,0)
 ;SD*5.3*504 change end
"RTN","SCMCTSK1",151,0)
 N A S A=$G(^SCTM(404.52,+PAIEN,0)),FTEE=$$SUM(+$P(PAIEN,U,3),+A)
"RTN","SCMCTSK1",152,0)
 S DATA=0
"RTN","SCMCTSK1",153,0)
 S DATA=FTEE+$P(PAIEN,U,2)
"RTN","SCMCTSK1",154,0)
 Q
"RTN","SCMCTSK1",155,0)
SORT(DIPA,SDD) ;sort tmpl
"RTN","SCMCTSK1",156,0)
 N DIC
"RTN","SCMCTSK1",157,0)
 S DIC=4,DIC(0)="ZME"
"RTN","SCMCTSK1",158,0)
 S DIC("S")="I $D(^SCTM(404.51,""AINST"",+Y))"
"RTN","SCMCTSK1",159,0)
 S DIR("A")="Start with Institution",DIR("B")="FIRST",DIR(0)="F" D ^DIR
"RTN","SCMCTSK1",160,0)
 I X="FIRST" S DIPA("SI")="",DIPA("EI")="zzz",SDD=1 Q
"RTN","SCMCTSK1",161,0)
 D ^DIC I Y<0 S DIPA("SI")=X S SDD=X Q:SDD[U  D
"RTN","SCMCTSK1",162,0)
 .S DIR("A")="Go to Institutiton",DIR("B")="LAST" S DIR(0)="F" D ^DIR
"RTN","SCMCTSK1",163,0)
 .I X="LAST" S DIPA("EI")="zzz"
"RTN","SCMCTSK1",164,0)
 I Y>0 S DIPA("SI")=$P(Y(0),U),DIC(0)="AZQME",DIC("A")="Go to Institution: "
"RTN","SCMCTSK1",165,0)
 D ^DIC
"RTN","SCMCTSK1",166,0)
 I Y>0 S DIPA("EI")=$P(Y(0),U)
"RTN","SCMCTSK1",167,0)
 I Y<0 S DIPA("EI")=X S SDD=X Q:SDD[U
"RTN","SCMCTSK1",168,0)
 S SDD=1 Q
"RTN","SCMCTSK1",169,0)
FTEERPT ;FTEE REPORT
"RTN","SCMCTSK1",170,0)
 D FTERPT^SCMCTSK6 Q
"RTN","SCMCTSK1",171,0)
 Q
"RTN","SCMCTSK1",172,0)
POSCHK(DATA,INFO) ;
"RTN","SCMCTSK1",173,0)
 N PCLASS
"RTN","SCMCTSK1",174,0)
 ;TEAM POSITION IEN^PC^STANDARD POSITITION IEN
"RTN","SCMCTSK1",175,0)
 I '$P(INFO,U,3) S DATA="1^Role Must be Entered" Q
"RTN","SCMCTSK1",176,0)
 I $P(INFO,U,2) I '$P($G(^SD(403.46,+$P(INFO,U,3),0)),U,3) S DATA="1^This Role cannot provide Primary Care" Q
"RTN","SCMCTSK1",177,0)
 I $P(INFO,U,2),($P($G(^SD(403.46,+$P(INFO,U,3),0)),U,3)=2) I '$$DATES^SCAPMCU1(404.53,+INFO) S DATA="1^This Role cannot provide Primary Care unless Precepted" Q
"RTN","SCMCTSK1",178,0)
 S DATA=0
"RTN","SCMCTSK1",179,0)
 I ('INFO)!('$P(INFO,U,2)) Q
"RTN","SCMCTSK1",180,0)
 ;Is provider role acceptable?
"RTN","SCMCTSK1",181,0)
 S J=-(DT+1) S J=$O(^SCTM(404.52,"AIDT",+INFO,1,J)) Q:J=""
"RTN","SCMCTSK1",182,0)
 I $O(^SCTM(404.52,"AIDT",+INFO,0,-(DT+1)))<J Q
"RTN","SCMCTSK1",183,0)
 S K=0 S K=$O(^SCTM(404.52,"AIDT",+INFO,1,J,K)) Q:'K
"RTN","SCMCTSK1",184,0)
 S ZERO=$G(^SCTM(404.52,+K,0))
"RTN","SCMCTSK1",185,0)
 ;Get person class for provider
"RTN","SCMCTSK1",186,0)
 S PCLASS=$$GET^XUA4A72(+$P(ZERO,U,3))
"RTN","SCMCTSK1",187,0)
 ;IEN^Occupation^specialty^sub-specialty^Effective date^expiration date^VA Code^specialty code
"RTN","SCMCTSK1",188,0)
 I '$D(^SD(403.46,+$P(INFO,U,3),2,"B",+PCLASS)) S DATA="1^Person Class of "_$$GET1^DIQ(200,(+$P(ZERO,U,3))_",",.01)_" is not valid in this Role." D POSCHK^SCMCTSK4
"RTN","SCMCTSK1",189,0)
 Q
"RTN","SCMCTSK1",190,0)
SEED ;seed one patient/provider
"RTN","SCMCTSK1",191,0)
 W !,"To retransmit all patients for a given provider press return to select the provider",!!
"RTN","SCMCTSK1",192,0)
 N DIC,SCADT,SCDDT,SCPAI
"RTN","SCMCTSK1",193,0)
 S SC177=$$PDAT^SCMCGU("SD*5.3*177")
"RTN","SCMCTSK1",194,0)
 I +SC177=0 D  Q
"RTN","SCMCTSK1",195,0)
 . S SC2="  Unable to obtain SD*5.3*177 Installation Date."
"RTN","SCMCTSK1",196,0)
 . D MSG^SCMCCV6(SC1,SC2)
"RTN","SCMCTSK1",197,0)
 . Q
"RTN","SCMCTSK1",198,0)
 S DIC="^DPT(",DIC(0)="MEQA" D ^DIC G PRSEED:Y'>0
"RTN","SCMCTSK1",199,0)
 ;event filer for 1 patient
"RTN","SCMCTSK1",200,0)
 S SCDFN=+Y W !,SCDFN
"RTN","SCMCTSK1",201,0)
SCDFN S SC1="^SCPT(404.43,""APCPOS"",SCDFN,1)"
"RTN","SCMCTSK1",202,0)
 ;quit if no PC assign
"RTN","SCMCTSK1",203,0)
 Q:'$D(@SC1)
"RTN","SCMCTSK1",204,0)
 S SCADT=0
"RTN","SCMCTSK1",205,0)
 F  S SCADT=$O(@SC1@(SCADT)) Q:SCADT=""  D
"RTN","SCMCTSK1",206,0)
 .S SCTP=0
"RTN","SCMCTSK1",207,0)
 .F  S SCTP=$O(@SC1@(SCADT,SCTP)) Q:'SCTP  D
"RTN","SCMCTSK1",208,0)
 ..; quit if team position does not exist
"RTN","SCMCTSK1",209,0)
 ..Q:'$D(^SCTM(404.57,SCTP,0))
"RTN","SCMCTSK1",210,0)
 ..S SCPAI=0
"RTN","SCMCTSK1",211,0)
 ..F  S SCPAI=$O(@SC1@(SCADT,SCTP,SCPAI)) Q:'SCPAI  D
"RTN","SCMCTSK1",212,0)
 ...S SCDDT=$P($G(^SCPT(404.43,SCPAI,0)),U,4)
"RTN","SCMCTSK1",213,0)
 ...;quit if not active within date range
"RTN","SCMCTSK1",214,0)
 ...Q:$$DTCHK^SCAPU1(SC177,DT,0,SCADT,SCDDT)<1
"RTN","SCMCTSK1",215,0)
 ...N SCVAR S SCVAR=SCPAI_";SCPT(404.43,"
"RTN","SCMCTSK1",216,0)
 ...;add to HL7 event file
"RTN","SCMCTSK1",217,0)
 ...Q:$D(^SCPT(404.48,"AACXMIT",SCVAR))
"RTN","SCMCTSK1",218,0)
 ...Q:$$CHECK^SCMCHLB1(SCVAR)'=1
"RTN","SCMCTSK1",219,0)
 ...D ADD^SCMCHLE("NOW",SCVAR,SCDFN,SCTP)
"RTN","SCMCTSK1",220,0)
 Q
"RTN","SCMCTSK1",221,0)
PRSEED ;seed practitioner
"RTN","SCMCTSK1",222,0)
 N AH,SC177
"RTN","SCMCTSK1",223,0)
 S SC177=$$PDAT^SCMCGU("SD*5.3*177")
"RTN","SCMCTSK1",224,0)
 I +SC177=0 D  Q
"RTN","SCMCTSK1",225,0)
 . S SC2=" No SD*5.3*177 Installation Date."
"RTN","SCMCTSK1",226,0)
 . D MSG^SCMCCV6(SC1,SC2)
"RTN","SCMCTSK1",227,0)
 S DIC=200,DIC(0)="MEQA",DIC("A")="Select Provider: " D ^DIC Q:Y'>0
"RTN","SCMCTSK1",228,0)
 S SCPROV=+Y
"RTN","SCMCTSK1",229,0)
 F AH=0:0 S AH=$O(^SCTM(404.52,"C",SCPROV,AH)) Q:'AH  S TP=+$G(^SCTM(404.52,+AH,0)) D
"RTN","SCMCTSK1",230,0)
 . Q:$D(SCTP(TP))
"RTN","SCMCTSK1",231,0)
 . S SCTP(TP)=1
"RTN","SCMCTSK1",232,0)
 . F SCDFN=0:0 S SCDFN=$O(^SCPT(404.43,"ADFN",SCDFN)) Q:'SCDFN  I $D(^(SCDFN,TP)) I '$D(SCU(SCDFN)) D SCDFN S SCU(SCDFN)=1
"RTN","SCMCTSK1",233,0)
 . Q:'$P($G(^SCTM(404.57,TP,0)),U,4)
"RTN","SCMCTSK1",234,0)
 . S SCVAR=AH_";SCTM(404.52,"
"RTN","SCMCTSK1",235,0)
 . ;Quit if an event entry already exists
"RTN","SCMCTSK1",236,0)
 . N QUIT,I S QUIT=0
"RTN","SCMCTSK1",237,0)
 . F I=0:0 S I=$O(^SCPT(404.48,"AACXMIT",SCVAR,I)) Q:'I  I $P($G(^SCPT(404.48,I,0)),U,8) S QUIT=1 Q
"RTN","SCMCTSK1",238,0)
 . Q:QUIT
"RTN","SCMCTSK1",239,0)
 . D ADD^SCMCHLE("NOW",SCVAR,,AH,1)
"RTN","SCMCTSK1",240,0)
 Q
"RTN","SCMCTSK1",241,0)
INCON ;inconsistent PC assignments
"RTN","SCMCTSK1",242,0)
 N POS
"RTN","SCMCTSK1",243,0)
 D INCON^SCMCTSK3
"RTN","SCMCTSK1",244,0)
 Q
"RTN","SCMCTSK1",245,0)
INCONR ;inconsistent report
"RTN","SCMCTSK1",246,0)
 N BY
"RTN","SCMCTSK1",247,0)
 K ^TMP("SCMCTSK",$J)
"RTN","SCMCTSK1",248,0)
 S DIC="^SCTM(404.57,",(FLDS,BY)="[SCMC INCONSISTENT]",DIOBEG="D INCON^SCMCTSK1"
"RTN","SCMCTSK1",249,0)
 D EN1^DIP
"RTN","SCMCTSK1",250,0)
 Q
"RTN","SCMCTSK1",251,0)
INACTDT(PA) ;Scheduled inactivation date.
"RTN","SCMCTSK1",252,0)
 D INACT^SCMCTSK3 Q
"RTN","SCMCTSK1",253,0)
IU(DFN) ;is patient inactivity unassigned
"RTN","SCMCTSK1",254,0)
 Q $$IU^SCMCTSK3(DFN)
"RTN","SCMCTSK1",255,0)
 N I,A,B,DATA
"RTN","SCMCTSK2")
0^13^B103317459^B97672367
"RTN","SCMCTSK2",1,0)
SCMCTSK2 ;ALB/JDS - PCMM Inactivation Nightly Job; 18 Apr 2003  9:36 AM ; 10/24/07 12:23pm  ; Compiled November 21, 2007 13:32:47  ; 9/22/09 8:43am
"RTN","SCMCTSK2",2,0)
 ;;5.3;Scheduling;**297,498,527,499,532,504**;AUG 13, 1993;Build 21
"RTN","SCMCTSK2",3,0)
 Q
"RTN","SCMCTSK2",4,0)
NIGHT ;
"RTN","SCMCTSK2",5,0)
 N ENDDT,NOINAC,SIXM,FLGDT,L,PATDT,SEEN,SDDT,LDOM
"RTN","SCMCTSK2",6,0)
 D DT^DICRW S SDDT=$P($G(^XTMP("SCMCTSK2-"_DT,0)),U,2)
"RTN","SCMCTSK2",7,0)
 I SDDT="" S SDDT=DT
"RTN","SCMCTSK2",8,0)
 S ALPHA=$G(^SCTM(404.44,1,1)),ALPHA=$P(ALPHA,U,8) I ALPHA<SDDT S ALPHA=0
"RTN","SCMCTSK2",9,0)
 ;if 'ALPHA NOINAC=1 except 15th and the Last Day of a Month (LDoM)
"RTN","SCMCTSK2",10,0)
 ;inact only on 15th and on LDoM
"RTN","SCMCTSK2",11,0)
 S (NOINAC,LDOM)=0
"RTN","SCMCTSK2",12,0)
 S X1=SDDT,X2=1 D C^%DTC
"RTN","SCMCTSK2",13,0)
 I ($E(SDDT,1,5)'=$E(X,1,5)) S LDOM=1
"RTN","SCMCTSK2",14,0)
 I 'ALPHA D
"RTN","SCMCTSK2",15,0)
 .I ($E(SDDT,6,7)'=15)&('LDOM) S NOINAC=1
"RTN","SCMCTSK2",16,0)
 .D INACTIVE^SCMCTSK1
"RTN","SCMCTSK2",17,0)
 S SIXM=$P($G(^SCTM(404.44,1,1)),U,9)
"RTN","SCMCTSK2",18,0)
 I SIXM!(LDOM) D PRFLAG
"RTN","SCMCTSK2",19,0)
 I ALPHA D INACTIVE^SCMCTSK1
"RTN","SCMCTSK2",20,0)
 ;determine ENDDT-Inactn Date-30 days if flagged today
"RTN","SCMCTSK2",21,0)
 F DATE=0:0 S DATE=$O(^SCPT(404.43,"AFLG",DATE)) Q:'DATE  D
"RTN","SCMCTSK2",22,0)
 .F ENTRY=0:0 S ENTRY=$O(^SCPT(404.43,"AFLG",DATE,ENTRY)) Q:'ENTRY  D
"RTN","SCMCTSK2",23,0)
 ..S ZERO=$G(^SCPT(404.43,ENTRY,0)) Q:'ZERO
"RTN","SCMCTSK2",24,0)
 ..S DFN=+$G(^SCPT(404.42,+ZERO,0)) Q:'DFN
"RTN","SCMCTSK2",25,0)
 ..S POS=$P(ZERO,U,2)
"RTN","SCMCTSK2",26,0)
 ..I $P(ZERO,U,4) D UNFLG Q  ;unass.
"RTN","SCMCTSK2",27,0)
 ..S X1=DATE,X2=$S(ALPHA:+2,1:+30) D C^%DTC S ENDDT=X
"RTN","SCMCTSK2",28,0)
 ..N SDASS S SDASS=$P(ZERO,U,3)
"RTN","SCMCTSK2",29,0)
 ..;N-new or E-stbl.
"RTN","SCMCTSK2",30,0)
 ..;assig >12 months since flagging, not NEW, E-stbl)
"RTN","SCMCTSK2",31,0)
 ..N NEW
"RTN","SCMCTSK2",32,0)
 ..S NEW=0 S X1=DATE,X2=SDASS D ^%DTC I X<365 S NEW=1
"RTN","SCMCTSK2",33,0)
 ..I NEW S %DT="",X="T-12M" D ^%DT S STDT=+Y D
"RTN","SCMCTSK2",34,0)
 ...S X1=STDT,X2=-7 D C^%DTC S TYDT=X
"RTN","SCMCTSK2",35,0)
 ..I 'NEW S %DT="",X="T-24M" D ^%DT S STDT=+Y D
"RTN","SCMCTSK2",36,0)
 ...S X1=STDT,X2=-7 D C^%DTC S TYDT=X
"RTN","SCMCTSK2",37,0)
 ..;
"RTN","SCMCTSK2",38,0)
 ..;I $P(ZERO,U,17) D UNFLG Q  ;react.
"RTN","SCMCTSK2",39,0)
 ..;get prec 
"RTN","SCMCTSK2",40,0)
 ..;S %DT="",X="T-12M" D ^%DT S STDT=+Y
"RTN","SCMCTSK2",41,0)
 ..;S PREC=$$DATES^SCAPMCU1(404.53,+POS),PREC=$S(PREC:$P($G(^SCTM(404.53,+$P(PREC,U,4),0)),U,6),1:+POS)
"RTN","SCMCTSK2",42,0)
 ..I '$P(ZERO,U,5) D UNFLG Q  ;Not PC
"RTN","SCMCTSK2",43,0)
 ..D SEEN^SCMCTSK1(DFN,POS,TYDT,SDDT,.PROV,.PRECP,.SEEN)
"RTN","SCMCTSK2",44,0)
 ..;S PC=$$GET^XUA4A72(+PROV)
"RTN","SCMCTSK2",45,0)
 ..I SEEN D UNFLG Q
"RTN","SCMCTSK2",46,0)
 ..I $P(ZERO,U,13) S X1=DATE,X2=$S(ALPHA:4,1:90) D C^%DTC S FLGDT=X I FLGDT>SDDT Q  ;do not inactivate yet; extended
"RTN","SCMCTSK2",47,0)
 ..I ('NOINAC)&(SDDT'<ENDDT) D DIS^SCMCTSK1
"RTN","SCMCTSK2",48,0)
 ;flag prov 6m after install sd/297
"RTN","SCMCTSK2",49,0)
 I NOINAC D:ALPHA BULL I '$D(^SCPT(404.43,"AFLG",SDDT)) K ^TMP($J,"SCMCTSK2") Q
"RTN","SCMCTSK2",50,0)
 ;flag prov 6m after install sd/297
"RTN","SCMCTSK2",51,0)
 ;I SIXM&(SIXM'>SDDT)!LDOM D
"RTN","SCMCTSK2",52,0)
 I LDOM!ALPHA D
"RTN","SCMCTSK2",53,0)
 .D PRINAC
"RTN","SCMCTSK2",54,0)
 .;N FLDA
"RTN","SCMCTSK2",55,0)
 .;S FLDA(404.44,"1,",19)=""
"RTN","SCMCTSK2",56,0)
 .;D FILE^DIE("I","FLDA","ERR")
"RTN","SCMCTSK2",57,0)
 D BULL K ^TMP($J,"SCMCTSK2")
"RTN","SCMCTSK2",58,0)
 Q
"RTN","SCMCTSK2",59,0)
UNFLG ;Unflagging
"RTN","SCMCTSK2",60,0)
 N DR,DIE,DA
"RTN","SCMCTSK2",61,0)
 S DR=".15///@;.13///@;.12///@",DIE="^SCPT(404.43,",DA=ENTRY D ^DIE
"RTN","SCMCTSK2",62,0)
 Q
"RTN","SCMCTSK2",63,0)
PRFLAG ;flag incorrect provider pos
"RTN","SCMCTSK2",64,0)
 N POS
"RTN","SCMCTSK2",65,0)
 ;prov inact. has run once
"RTN","SCMCTSK2",66,0)
 ;I $P($G(^SCTM(404.44,1,1)),U,11)'="" Q
"RTN","SCMCTSK2",67,0)
 D PRFLAG^SCMCTSK3
"RTN","SCMCTSK2",68,0)
 Q
"RTN","SCMCTSK2",69,0)
PRINAC ;inact. flagged providers
"RTN","SCMCTSK2",70,0)
 N I,II
"RTN","SCMCTSK2",71,0)
 ;Prov inact. run already
"RTN","SCMCTSK2",72,0)
 I $G(SDDT)="" S SDDT=DT
"RTN","SCMCTSK2",73,0)
 ;S II=$P($G(^SCTM(404.44,1,1)),U,11) I II'="",II'=SDDT Q
"RTN","SCMCTSK2",74,0)
 F I=0:0 S I=$O(^SCTM(404.52,I)) Q:'I  S ZERO=$G(^(I,0)) I $P(ZERO,U,10) D
"RTN","SCMCTSK2",75,0)
 .S ZEROIEN=I
"RTN","SCMCTSK2",76,0)
 .;uncomment next line for testing only bpfo/swo 11.19.2008
"RTN","SCMCTSK2",77,0)
 .;S X1=$P(ZERO,U,10),X2=$S(ALPHA:2,1:30) D C^%DTC I SDDT<X Q  ;not time yet
"RTN","SCMCTSK2",78,0)
 .;I $P(ZERO,U,10)>$G(ENDDT) Q   ;not time yet
"RTN","SCMCTSK2",79,0)
 .I +$$EN^SCMCTSKI(1)<SDDT Q
"RTN","SCMCTSK2",80,0)
 .I $O(^SCTM(404.52,"AIDT",+ZERO,0,-9999999))<(-$P(ZERO,U,2)) Q   ;inactivated
"RTN","SCMCTSK2",81,0)
 .;Check valid criteria
"RTN","SCMCTSK2",82,0)
 .S POS=+ZERO
"RTN","SCMCTSK2",83,0)
 .S PROV=+$$GETPRTP^SCAPMCU2(POS,SDDT)
"RTN","SCMCTSK2",84,0)
 .S PC=$$GET^XUA4A72(+PROV)
"RTN","SCMCTSK2",85,0)
 .S DR=".091///@",DIE="^SCTM(404.52,",DA=ZEROIEN D ^DIE  ;remove flag
"RTN","SCMCTSK2",86,0)
 .S ZERO1=$G(^SCTM(404.57,POS,0))
"RTN","SCMCTSK2",87,0)
 .I '$D(^SD(403.46,+$P(ZERO1,U,3),2,+PC)) D
"RTN","SCMCTSK2",88,0)
 ..;inactivation
"RTN","SCMCTSK2",89,0)
 ..K DO
"RTN","SCMCTSK2",90,0)
 ..S DIC="^SCTM(404.52,",X=+ZERO,DIC("DR")=".02////"_DT_";.03////"_$P(ZERO,U,3)_";.04////0;.05///EMPLOYEE LEAVES POSITION;.11////1"
"RTN","SCMCTSK2",91,0)
 ..S DIC(0)="Z" D FILE^DICN
"RTN","SCMCTSK2",92,0)
 ..;S DIE="^SCTM(404.52,",DA=+ZERO,DR=".02////"_SDDT_";.03////"_$P(ZERO,U,3)_";.04////0;.05///EMPLOYEE LEAVES POSITION;.11////1"
"RTN","SCMCTSK2",93,0)
 ..;D ^DIE
"RTN","SCMCTSK2",94,0)
 ;only run inact. once
"RTN","SCMCTSK2",95,0)
 S $P(^SCTM(404.44,1,1),U,11)=SDDT
"RTN","SCMCTSK2",96,0)
 Q
"RTN","SCMCTSK2",97,0)
FUTAPP(DFN) ;print future appts
"RTN","SCMCTSK2",98,0)
 N TAB,SCDT0,SCARRAY,SCDTMP S TAB=$X
"RTN","SCMCTSK2",99,0)
 I $G(SDDT)="" S SDDT=DT
"RTN","SCMCTSK2",100,0)
 S SCDT=SDDT+.24
"RTN","SCMCTSK2",101,0)
 S SCARRAY(1)=SCDT  ;date/time filter
"RTN","SCMCTSK2",102,0)
 S SCARRAY(4)=DFN  ;patient filter
"RTN","SCMCTSK2",103,0)
 S SCARRAY("SORT")="P"  ;sort filter
"RTN","SCMCTSK2",104,0)
 S SCARRAY("FLDS")="1;2;3"
"RTN","SCMCTSK2",105,0)
 I ($$SDAPI^SDAMA301(.SCARRAY)>0) D
"RTN","SCMCTSK2",106,0)
 .S SCDTMP=0 F  S SCDTMP=$O(^TMP($J,"SDAMA301",DFN,SCDTMP)) Q:'SCDTMP  D
"RTN","SCMCTSK2",107,0)
 ..S SCDT0=$G(^TMP($J,"SDAMA301",DFN,SCDTMP)) Q:($P($P(SCDT0,U,3),U)="R")
"RTN","SCMCTSK2",108,0)
 ..S Y=SCDTMP X ^DD("DD") W $E(Y_" ",1,17)_" "_$E($P($P(SCDT0,U,2),";",2),1,10)
"RTN","SCMCTSK2",109,0)
 Q
"RTN","SCMCTSK2",110,0)
GETASC(DATA,ENTRY) ;get assoc. clinics
"RTN","SCMCTSK2",111,0)
 N I,CNT S CNT=0
"RTN","SCMCTSK2",112,0)
 F I=0:0 S I=$O(^SCTM(404.57,+$G(ENTRY),5,I)) Q:'I  S CNT=CNT+1,DATA(CNT)=I_U_$P($G(^SC(I,0)),U)
"RTN","SCMCTSK2",113,0)
 Q
"RTN","SCMCTSK2",114,0)
SETASC(RESULT,DATA) ;set assoc. clinics
"RTN","SCMCTSK2",115,0)
 D SETASC^SCMCTSK7(.RESULT,DATA) Q
"RTN","SCMCTSK2",116,0)
MSG(SCTP,DFN) ;send inact. message
"RTN","SCMCTSK2",117,0)
 ;given valid positions get current practitioners
"RTN","SCMCTSK2",118,0)
 S SCLIST="SCL"
"RTN","SCMCTSK2",119,0)
 I $G(SDDT)="" S SDDT=DT
"RTN","SCMCTSK2",120,0)
 I "N"'[$P($G(^SCTM(404.57,SCTP,2)),U,9) D
"RTN","SCMCTSK2",121,0)
 .S SCOK=$$PRTP^SCAPMC(SCTP,"",.SCLIST,.SCERR)
"RTN","SCMCTSK2",122,0)
 .;if preceptor notice turned on for message type
"RTN","SCMCTSK2",123,0)
 I +$P($G(^SCTM(404.57,SCTP,2)),U,9) D
"RTN","SCMCTSK2",124,0)
 .S SCX=+$$OKPREC2^SCMCLK(SCTP,SDDT)
"RTN","SCMCTSK2",125,0)
 .;if preceptor duz returned, add to array
"RTN","SCMCTSK2",126,0)
 .I SCX S @SCLIST@("SCPR",SCX)=""
"RTN","SCMCTSK2",127,0)
 N XMY F I=0:0 S I=$O(@SCLIST@("SCPR",I)) Q:'I  S XMY(I)=""
"RTN","SCMCTSK2",128,0)
 S SCTEXT(1,0)="PATIENT "_$P($G(^DPT(DFN,0)),U)_" has been inactivated from PC team position "_$P($G(^SCTM(404.57,SCTP,0)),U)
"RTN","SCMCTSK2",129,0)
 S XMSUB="Provider's Inactivated Primary Care Patients" D ^XMD
"RTN","SCMCTSK2",130,0)
 Q
"RTN","SCMCTSK2",131,0)
BULL ;EOM Bulletin
"RTN","SCMCTSK2",132,0)
 N DISUPNO,BY,DHIT,HEAD
"RTN","SCMCTSK2",133,0)
 S DISUPNO=1,L=0
"RTN","SCMCTSK2",134,0)
 S XMSUB="Patients Scheduled for Inactivation from PC Panel"
"RTN","SCMCTSK2",135,0)
 S XMY("G.PCMM PATIENT/PROVIDER INACTIVE")=""
"RTN","SCMCTSK2",136,0)
 K ^TMP("SCMC",$J),^TMP("SCMCTXT",$J),^TMP("SCML",$J)
"RTN","SCMCTSK2",137,0)
 S XMTEXT="^TMP(""SCMCTXT"",$J," ;S @XMTEXT@(0)=""
"RTN","SCMCTSK2",138,0)
 S DIC="^SCPT(404.43,",BY="[SCMC FLAGGED BULLETIN]",FLDS="[SC BULLETIN]",CNT=0
"RTN","SCMCTSK2",139,0)
 S:0 FLDS="" S IOP="",DHD="@@",(FR,TO)="" D EN1^DIP
"RTN","SCMCTSK2",140,0)
 S ^TMP("SCMCTXT",$J,1,0)="There are "_$O(^TMP("SCMC",$J,""),-1)_" Patients scheduled for inactivation in next 30 days"
"RTN","SCMCTSK2",141,0)
 D LINES(1)
"RTN","SCMCTSK2",142,0)
 D ^XMD
"RTN","SCMCTSK2",143,0)
 D PRMAIL^SCMCTSK5(1)
"RTN","SCMCTSK2",144,0)
 F SCI=0:0 S SCI=$O(^TMP("SCF",$J,SCI)) Q:'SCI  D
"RTN","SCMCTSK2",145,0)
 .K XMY S XMY(SCI)="" K ^TMP("SCMC",$J),^TMP("SCMCTXT",$J)
"RTN","SCMCTSK2",146,0)
 .M ^TMP("SCMC",$J)=^TMP("SCF",$J,SCI)
"RTN","SCMCTSK2",147,0)
 .S XMSUB="Patients Scheduled for Inactivation from PC Panel"
"RTN","SCMCTSK2",148,0)
 .S XMTEXT="^TMP(""SCMCTXT"",$J,"
"RTN","SCMCTSK2",149,0)
 S DISUPNO=1
"RTN","SCMCTSK2",150,0)
 K ^TMP("SCMC",$J),^TMP("SCMCTXT")
"RTN","SCMCTSK2",151,0)
 I $G(NOINAC) K ^TMP($J,"SCMCTSK2") Q  ; SD/499
"RTN","SCMCTSK2",152,0)
 S XMSUB="Patients With Extended PCMM Inactivation Dates"
"RTN","SCMCTSK2",153,0)
 S XMY("G.PCMM PATIENT/PROVIDER INACTIVE")=""
"RTN","SCMCTSK2",154,0)
 K ^TMP("SCMC",$J)
"RTN","SCMCTSK2",155,0)
 S XMTEXT="^TMP(""SCMCTXT"",$J," ;S @XMTEXT@(0)=""
"RTN","SCMCTSK2",156,0)
 S DIC="^SCPT(404.43,",BY="[SCMC EXTENDED BULLETIN]",DHIT="S CNT=$G(CNT)+1,^TMP(""SCMC"",$J,CNT,D0)=""""",CNT=0
"RTN","SCMCTSK2",157,0)
 S FR=",,,",TO=FR,FLDS="",IOP="",DHD="@@" D EN1^DIP
"RTN","SCMCTSK2",158,0)
 S ^TMP("SCMCTXT",$J,1,0)="There are "_$O(^TMP("SCMC",$J,""),-1)_" Patients Extended from inactivation"
"RTN","SCMCTSK2",159,0)
 D LINES(3)
"RTN","SCMCTSK2",160,0)
 D ^XMD
"RTN","SCMCTSK2",161,0)
 D PRMAIL^SCMCTSK5(3)
"RTN","SCMCTSK2",162,0)
 S DISUPNO=1
"RTN","SCMCTSK2",163,0)
 K ^TMP("SCMC",$J),^TMP("SCMCTXT")
"RTN","SCMCTSK2",164,0)
 S XMSUB="Patients Automated Inactivations from PC Panels"
"RTN","SCMCTSK2",165,0)
 S XMY("G.PCMM PATIENT/PROVIDER INACTIVE")=""
"RTN","SCMCTSK2",166,0)
 K ^TMP("SCMC",$J)
"RTN","SCMCTSK2",167,0)
 S XMTEXT="^TMP(""SCMCTXT"",$J," ;S @XMTEXT@(0)=""
"RTN","SCMCTSK2",168,0)
 S DIC="^SCPT(404.43,",BY="[SCMC INACTIVATED]",DHIT="S CNT=$G(CNT)+1,^TMP(""SCMC"",$J,CNT,D0)=""""",CNT=0
"RTN","SCMCTSK2",169,0)
 S FLDS="",IOP="",DHD="@@",FR=",T-30,,",TO=",,,,," D EN1^DIP
"RTN","SCMCTSK2",170,0)
 S ^TMP("SCMCTXT",$J,1,0)="There are "_$O(^TMP("SCMC",$J,""),-1)_" Patients Inactivated in last 30 days"
"RTN","SCMCTSK2",171,0)
 D LINES(2)
"RTN","SCMCTSK2",172,0)
 D ^XMD
"RTN","SCMCTSK2",173,0)
TST ;
"RTN","SCMCTSK2",174,0)
 S DISUPNO=1
"RTN","SCMCTSK2",175,0)
 D PRMAIL^SCMCTSK5(2)
"RTN","SCMCTSK2",176,0)
 K ^TMP("SCMC",$J),^TMP("SCMCTXT")
"RTN","SCMCTSK2",177,0)
 ;I $P($G(^SCTM(404.44,1,1)),U,11)="" D
"RTN","SCMCTSK2",178,0)
 S XMSUB="PC Providers Scheduled for Inactivation"
"RTN","SCMCTSK2",179,0)
 S XMY("G.PCMM PATIENT/PROVIDER INACTIVE")=""
"RTN","SCMCTSK2",180,0)
 K ^TMP("SCMC",$J)
"RTN","SCMCTSK2",181,0)
 S XMTEXT="^TMP(""SCMCTXT"",$J,"
"RTN","SCMCTSK2",182,0)
 S DIC="^SCTM(404.52,",BY="[SC PROVIDER FLAGGED BULLE]",DHIT="S CNT=$G(CNT)+1,^TMP(""SCMC"",$J,CNT,D0)=""""",CNT=0
"RTN","SCMCTSK2",183,0)
 S FLDS="",IOP="",DHD="@@",FR="",TO="" D EN1^DIP
"RTN","SCMCTSK2",184,0)
 D LINES(4)
"RTN","SCMCTSK2",185,0)
 D ^XMD
"RTN","SCMCTSK2",186,0)
 D PRMAIL^SCMCTSK5(4)
"RTN","SCMCTSK2",187,0)
 D BULL^SCMCTSK6
"RTN","SCMCTSK2",188,0)
 Q
"RTN","SCMCTSK2",189,0)
LINES(TYPE) ;Lines of Bulletin
"RTN","SCMCTSK2",190,0)
 D LINES^SCMCTSK5(TYPE) Q
"RTN","SCMCTSK2",191,0)
ROLE(DATA,INFO) ;SCMC ROLE
"RTN","SCMCTSK2",192,0)
 N ROLE,TP,I,SCRSLT,SCTF,SCLS,SCPOR
"RTN","SCMCTSK2",193,0)
 S (SCPOR,SCRSLT)=0
"RTN","SCMCTSK2",194,0)
 S ROLE=+$G(INFO),TP=+$P($G(INFO),U,2)
"RTN","SCMCTSK2",195,0)
 I 'ROLE Q
"RTN","SCMCTSK2",196,0)
 I 'TP Q
"RTN","SCMCTSK2",197,0)
 ;get values
"RTN","SCMCTSK2",198,0)
 S DATA(0)=+$P($G(^SD(403.46,ROLE,0)),U,3)
"RTN","SCMCTSK2",199,0)
 I $$DATES^SCAPMCU1(404.53,+TP) S SCPOR=1
"RTN","SCMCTSK2",200,0)
 N PREC S PREC=0
"RTN","SCMCTSK2",201,0)
 F I=0:0 S I=$O(^SCTM(404.53,"AD",TP,I)) Q:'I  D   Q:PREC
"RTN","SCMCTSK2",202,0)
 .I $D(^SCTM(404.53,"AD",TP,I,1)) I '$D(^(0)) S PREC=1
"RTN","SCMCTSK2",203,0)
 I +DATA(0)'=0 D
"RTN","SCMCTSK2",204,0)
 . S SCTF=$$GETPRTP^SCAPMCU2(TP) Q:+SCTF=0
"RTN","SCMCTSK2",205,0)
 . S SCLS=$$GET^XUA4A72(+SCTF)
"RTN","SCMCTSK2",206,0)
 . I SCLS S SCRSLT=$S('$D(^SD(403.46,ROLE,2,"B",+SCLS)):1,1:0)
"RTN","SCMCTSK2",207,0)
 ;end of get
"RTN","SCMCTSK2",208,0)
 ;type of role^preceptor^preceptee^person class check
"RTN","SCMCTSK2",209,0)
 S DATA(0)=DATA(0)_U_SCPOR_U_PREC_U_SCRSLT
"RTN","SCMCTSK2",210,0)
 Q
"RTN","SCMCTSK2",211,0)
INRPT ; REPORT
"RTN","SCMCTSK2",212,0)
 N DIOEND,SCDHD
"RTN","SCMCTSK2",213,0)
 D PROMPT^SCMCTSK3("** Date Range Selection **","DATE PATIENTS INACTIVATED FROM PC PANELS")
"RTN","SCMCTSK2",214,0)
 Q:'$D(^TMP("SC",$J,"XR"))
"RTN","SCMCTSK2",215,0)
 D UNASSIGN^SCMCTSK3
"RTN","SCMCTSK2",216,0)
 S Q=""""
"RTN","SCMCTSK2",217,0)
 S DIC="^SCPT(404.43," ;=0,BY="[SCMC INACTIVATION SORT]"
"RTN","SCMCTSK2",218,0)
 D BY
"RTN","SCMCTSK2",219,0)
 S (SCDHD,DHD)="AUTOMATED PATIENT INACTIVATION FROM PRIMARY CARE PANELS REPORT"
"RTN","SCMCTSK2",220,0)
 S DIOBEG="D DIOBEG^SCMCTSK4"
"RTN","SCMCTSK2",221,0)
 S DIOEND="D DIOEND1^SCMCTSK4"
"RTN","SCMCTSK2",222,0)
 S FLDS="[SCMC INACTIVATED]" ;,FR="?,,"_$TR(DIPA("SI"),","," "),TO="T,,"_$TR(DIPA("EI")_"z",","," ")
"RTN","SCMCTSK2",223,0)
 D EN1^DIP
"RTN","SCMCTSK2",224,0)
 Q
"RTN","SCMCTSK2",225,0)
IN30 ;inact. last month
"RTN","SCMCTSK2",226,0)
 N DIPA,SDD D SORT^SCMCTSK1(.DIPA,.SDD) Q:'SDD  ;SD/499
"RTN","SCMCTSK2",227,0)
 S Q=""""
"RTN","SCMCTSK2",228,0)
 S DIC="^SCPT(404.43,",L=0,BY="[SCMC INACTIVATION SORT]"
"RTN","SCMCTSK2",229,0)
 S DHD="Patients Inactivated from Primary Care Panels in the Past Month"
"RTN","SCMCTSK2",230,0)
 S FLDS="[SCMC INACTIVATED]",FR="T-31,,"_$TR(DIPA("SI"),","," "),TO="T,,"_$TR(DIPA("EI")_"z",","," ")
"RTN","SCMCTSK2",231,0)
 D EN1^DIP
"RTN","SCMCTSK2",232,0)
 Q
"RTN","SCMCTSK2",233,0)
EXRPT ;EXTEND REPORT
"RTN","SCMCTSK2",234,0)
 K CLIN,TEAM,INST
"RTN","SCMCTSK2",235,0)
 D PROMPT^SCMCTSK3("PCMM Patients with Extended Inactivations","Scheduled Inactivation Date")
"RTN","SCMCTSK2",236,0)
 Q:'$D(^TMP("SC",$J,"XR"))
"RTN","SCMCTSK2",237,0)
 S Q="""",SORT=1
"RTN","SCMCTSK2",238,0)
 D EXTEND^SCMCTSK3
"RTN","SCMCTSK2",239,0)
 S DIC="^SCPT(404.43," ;,L=0,BY="[SCMC EXTENDED]"
"RTN","SCMCTSK2",240,0)
 S (SCDHD,DHD)="PCMM Patients with extended Inactivations"
"RTN","SCMCTSK2",241,0)
 S DIOBEG="D DIOBEG^SCMCTSK4",DIOEND="D EXTKEY^SCMCTSK9"
"RTN","SCMCTSK2",242,0)
 D BY
"RTN","SCMCTSK2",243,0)
 S FLDS="[SCMC EXTENDED]"
"RTN","SCMCTSK2",244,0)
 D EN1^DIP
"RTN","SCMCTSK2",245,0)
 Q 
"RTN","SCMCTSK2",246,0)
BY N DISPAR
"RTN","SCMCTSK2",247,0)
 S BY(0)="^TMP(""SCSORT"",$J)",L(0)=$O(^TMP("SC",$J,"SORT",99),-1)+1,DISPAR(0,1)="+",L=0 I $G(SCDHD)["FTEE" S DISPAR(0,1)="+#" ;BY="@'.01"
"RTN","SCMCTSK2",248,0)
 F I=1:1:$L(SORTN,U) S A=$P(SORTN,U,I) Q:'$L(A)  S $P(DISPAR(0,I),U,2)=";"_Q_A_": "_Q D
"RTN","SCMCTSK2",249,0)
 .I A["PATIENT" I (I>1)!($G(SCDHD)["Patients Scheduled for Inactivation from PC Panel") S $P(DISPAR(0,I),U)="@"
"RTN","SCMCTSK2",250,0)
 .I $G(SCDHD)["FTEE" D
"RTN","SCMCTSK2",251,0)
 ..I A["PROV" S $P(DISPAR(0,I),U)="@"
"RTN","SCMCTSK2",252,0)
 ..I I>1 I (A["CLI")!(A["POS") S $P(DISPAR(0,I),U)="@"_$P($G(DISPAR(0,I)),U)
"RTN","SCMCTSK2",253,0)
 S ZTSAVE("^TMP(""SC"",$J,")="",ZTSAVE("^TMP(""SCSORT"",$J,")=""
"RTN","SCMCTSK2",254,0)
 Q
"RTN","SCMCTSK2",255,0)
FLRPT ;FLAGGED REPORT
"RTN","SCMCTSK2",256,0)
 D PROMPT^SCMCTSK3("Patients Scheduled for Inactivation from PC Panels","Date Scheduled for Inactivation")
"RTN","SCMCTSK2",257,0)
 Q:'$D(^TMP("SC",$J,"XR"))
"RTN","SCMCTSK2",258,0)
 D FLAGG^SCMCTSK3
"RTN","SCMCTSK2",259,0)
 S Q=""""
"RTN","SCMCTSK2",260,0)
 S DIC="^SCPT(404.43,",L=0
"RTN","SCMCTSK2",261,0)
 S (SCDHD,DHD)="Patients Scheduled for Inactivation from PC Panels"
"RTN","SCMCTSK2",262,0)
 D BY
"RTN","SCMCTSK2",263,0)
 S DIOBEG="D DIOBEG^SCMCTSK4"
"RTN","SCMCTSK2",264,0)
 S FLDS="[SCMC PENDING UNASSIGN]"
"RTN","SCMCTSK2",265,0)
 I $G(DISPAR(0,1))["PATIENT" S FLDS="[SCMC PENDING UNASSIGN PAT]"
"RTN","SCMCTSK2",266,0)
 S DIOEND="D DIOEND^SCMCTSK4"
"RTN","SCMCTSK2",267,0)
 D EN1^DIP
"RTN","SCMCTSKG")
0^1^B95917161^n/a
"RTN","SCMCTSKG",1,0)
SCMCTSKG ;bpoifo/dmr PCMM Inactivation GUI Rpt.;3/18/08
"RTN","SCMCTSKG",2,0)
 ;;5.3;Scheduling;**504**;AUG 13, 1993;Build 21
"RTN","SCMCTSKG",3,0)
 ;;
"RTN","SCMCTSKG",4,0)
EN(SCRESULT,SCARRAY) ;
"RTN","SCMCTSKG",5,0)
 S (STAT,TN,IEN,INST,INSTN,UNDATE,UNREA,TEAMPN,SSN,SSNN)="" S NUM=0
"RTN","SCMCTSKG",6,0)
 S (TEAM,TEAMP,PROVN,PROV,BDATE,EDATE,PAT,INAME,HOLD)="" S NN=0,CC=0,CT=0
"RTN","SCMCTSKG",7,0)
 K ^TMP("SCARRAY")
"RTN","SCMCTSKG",8,0)
 M ^TMP("SCARRAY")=SCARRAY
"RTN","SCMCTSKG",9,0)
 D DATE
"RTN","SCMCTSKG",10,0)
 K ^TMP("SCRESULT","B")
"RTN","SCMCTSKG",11,0)
 D FINAL
"RTN","SCMCTSKG",12,0)
 S SCRESULT=$NA(^TMP("SCRESULT"))
"RTN","SCMCTSKG",13,0)
 D EXIT
"RTN","SCMCTSKG",14,0)
 Q
"RTN","SCMCTSKG",15,0)
DATE ;
"RTN","SCMCTSKG",16,0)
 S BDATE=$G(^TMP("SCARRAY","AA")) S X=$P(BDATE,"""",2) D ^%DT S BDATE=Y
"RTN","SCMCTSKG",17,0)
 S EDATE=$G(^TMP("SCARRAY","AB")) S X=$P(EDATE,"""",2) D ^%DT S EDATE=Y
"RTN","SCMCTSKG",18,0)
 D START
"RTN","SCMCTSKG",19,0)
 Q
"RTN","SCMCTSKG",20,0)
START ;
"RTN","SCMCTSKG",21,0)
 S STAT="" F  S STAT=$O(^SCPT(404.43,"ASTATB",STAT)) Q:STAT=""  D
"RTN","SCMCTSKG",22,0)
 .S IEN=""  F  S IEN=$O(^SCPT(404.43,"ASTATB",STAT,IEN)) Q:'IEN  D
"RTN","SCMCTSKG",23,0)
 ..S UNDATE="" S UNDATE=$$GET1^DIQ(404.43,IEN_",",.04,"I") IF $D(UNDATE) D
"RTN","SCMCTSKG",24,0)
 ...I (UNDATE<BDATE)!(UNDATE>EDATE) Q
"RTN","SCMCTSKG",25,0)
 ...S PAT="" S PAT=$$GET1^DIQ(404.43,IEN_",",.01)
"RTN","SCMCTSKG",26,0)
 ...S (SN,SSN,SSNN)="" S SN=$$GET1^DIQ(404.43,IEN_",",.01,"I")
"RTN","SCMCTSKG",27,0)
 ...S SSNN=$$GET1^DIQ(404.42,SN_",",.01,"I") S SSN=$$GET1^DIQ(2,SSNN_",",.09)
"RTN","SCMCTSKG",28,0)
 ...D TEAMP
"RTN","SCMCTSKG",29,0)
 ...Q
"RTN","SCMCTSKG",30,0)
 Q
"RTN","SCMCTSKG",31,0)
TEAMP ;
"RTN","SCMCTSKG",32,0)
 S (TEAMP,TPN,TPN2)=""
"RTN","SCMCTSKG",33,0)
 S TPN=$$GET1^DIQ(404.43,IEN_",",.02,"I")
"RTN","SCMCTSKG",34,0)
 S TEAMP=$$GET1^DIQ(404.43,IEN_",",.02)
"RTN","SCMCTSKG",35,0)
 I $G(^TMP("SCARRAY","TP^0"))="""ALL^0""" D TEAM Q
"RTN","SCMCTSKG",36,0)
 I '$D(^TMP("SCARRAY","TP^0")) D
"RTN","SCMCTSKG",37,0)
 .S TPN2=$G(^TMP("SCARRAY","TP^"_TPN)) I TPN2'="" D
"RTN","SCMCTSKG",38,0)
 ..S TPN2=$P(TPN2,"""",2) I $P(TPN2,"^",1)=TEAMP D TEAM
"RTN","SCMCTSKG",39,0)
 Q
"RTN","SCMCTSKG",40,0)
TEAM ;
"RTN","SCMCTSKG",41,0)
 S (TEAMN,TN,TN2,PREC)=""
"RTN","SCMCTSKG",42,0)
 S TN=$$GET1^DIQ(404.57,TPN_",",.02,"I")
"RTN","SCMCTSKG",43,0)
 S TEAMN=$$GET1^DIQ(404.57,TPN_",",.02)
"RTN","SCMCTSKG",44,0)
 S PREC=$$GET1^DIQ(404.57,TPN_",",.1)
"RTN","SCMCTSKG",45,0)
 I $G(^TMP("SCARRAY","T^0"))="""ALL^0""" D INST
"RTN","SCMCTSKG",46,0)
 I '$D(^TMP("SCARRAY","T^0")) D
"RTN","SCMCTSKG",47,0)
 .S TN2=$G(^TMP("SCARRAY","T^"_TN)) I TN2'="" D
"RTN","SCMCTSKG",48,0)
 ..S TN2=$P(TN2,"""",2),TN2=$P(TN2,"^",1)
"RTN","SCMCTSKG",49,0)
 ..I TN2=TEAMN D INST
"RTN","SCMCTSKG",50,0)
 Q
"RTN","SCMCTSKG",51,0)
INST ;
"RTN","SCMCTSKG",52,0)
 S (INST,INSTN,INUM)=""
"RTN","SCMCTSKG",53,0)
 S INSTN=$$GET1^DIQ(404.51,TN_",",.07,"I")
"RTN","SCMCTSKG",54,0)
 I $G(^TMP("SCARRAY","D^0"))="""ALL^0""" D
"RTN","SCMCTSKG",55,0)
 .S INST=$$GET1^DIQ(404.51,TN_",",.07)
"RTN","SCMCTSKG",56,0)
 .D PROV
"RTN","SCMCTSKG",57,0)
 .Q
"RTN","SCMCTSKG",58,0)
 I $G(^TMP("SCARRAY","D^0"))'="""ALL""" D
"RTN","SCMCTSKG",59,0)
 .S INUM=$G(^TMP("SCARRAY","D^"_INSTN)) I INUM'="" D
"RTN","SCMCTSKG",60,0)
 ..S INUM=$P(INUM,"""",2)
"RTN","SCMCTSKG",61,0)
 ..I $P(INUM,"^",2)=INSTN D
"RTN","SCMCTSKG",62,0)
 ...S INST=$$GET1^DIQ(404.51,TN_",",.07)
"RTN","SCMCTSKG",63,0)
 ...D PROV
"RTN","SCMCTSKG",64,0)
 ...Q
"RTN","SCMCTSKG",65,0)
 Q
"RTN","SCMCTSKG",66,0)
PROV ;
"RTN","SCMCTSKG",67,0)
 S (PROV,PROVN,J,JJ,PDATE,EFFD,SCLIST,ERROR,FILE,ST,P1,P2,P3)=""
"RTN","SCMCTSKG",68,0)
 I $G(^TMP("SCARRAY","P^0"))'="""ALL^0""" D
"RTN","SCMCTSKG",69,0)
 .S J="N" F  S J=$O(^TMP("SCARRAY",J)) Q:J=""  D
"RTN","SCMCTSKG",70,0)
 ..Q:$P(J,"^",1)'="P"  D
"RTN","SCMCTSKG",71,0)
 ...S PROVN="" S PROVN=+$P(^TMP("SCARRAY",J),"^",2) D
"RTN","SCMCTSKG",72,0)
 ....S JJ="" F  S JJ=$O(^SCTM(404.52,"C",PROVN,JJ)) Q:'JJ  D
"RTN","SCMCTSKG",73,0)
 .....S POS="" S POS=$$GET1^DIQ(404.52,JJ_",",.01) I POS=TEAMP D
"RTN","SCMCTSKG",74,0)
 ......S (PDATE,ST)="" S PDATE=$$GET1^DIQ(404.52,JJ_",",.02,"I"),ST=$$GET1^DIQ(404.52,JJ_",",.04,"I") D
"RTN","SCMCTSKG",75,0)
 .......I PDATE>UNDATE Q
"RTN","SCMCTSKG",76,0)
 .......I ST=0&(PDATE<UNDATE) Q
"RTN","SCMCTSKG",77,0)
 .......S PROV="" S PROV=$$GET1^DIQ(404.52,JJ_",",.03)
"RTN","SCMCTSKG",78,0)
 .......D UNREA,SAVE
"RTN","SCMCTSKG",79,0)
 .......Q
"RTN","SCMCTSKG",80,0)
 I $G(^TMP("SCARRAY","P^0"))="""ALL^0""" D
"RTN","SCMCTSKG",81,0)
 .S PROVN="" F  S PROVN=$O(^SCTM(404.52,"C",PROVN)) Q:PROVN=""  D
"RTN","SCMCTSKG",82,0)
 ..S JJ="" F  S JJ=$O(^SCTM(404.52,"C",PROVN,JJ)) Q:'JJ  D
"RTN","SCMCTSKG",83,0)
 ...S POS="" S POS=$$GET1^DIQ(404.52,JJ_",",.01) I POS=TEAMP D
"RTN","SCMCTSKG",84,0)
 ....S (PDATE,ST)="" S PDATE=$$GET1^DIQ(404.52,JJ_",",.02,"I"),ST=$$GET1^DIQ(404.52,JJ_",",.04,"I") D
"RTN","SCMCTSKG",85,0)
 .....I PDATE>UNDATE Q
"RTN","SCMCTSKG",86,0)
 .....I ST=0&(PDATE<UNDATE) Q
"RTN","SCMCTSKG",87,0)
 .....S PROV="" S PROV=$$GET1^DIQ(404.52,JJ_",",.03)
"RTN","SCMCTSKG",88,0)
 .....D UNREA,SAVE
"RTN","SCMCTSKG",89,0)
 .....Q
"RTN","SCMCTSKG",90,0)
 Q
"RTN","SCMCTSKG",91,0)
UNREA ;Unassign Reason
"RTN","SCMCTSKG",92,0)
 S UNREA=""
"RTN","SCMCTSKG",93,0)
 S UNREA=$$GET1^DIQ(404.43,IEN_",",.12,"I")
"RTN","SCMCTSKG",94,0)
 Q
"RTN","SCMCTSKG",95,0)
SAVE ;
"RTN","SCMCTSKG",96,0)
 I $G(^TMP("SCARRAY","S1"))="""ALL""" D SAVE1 Q
"RTN","SCMCTSKG",97,0)
 I $G(^TMP("SCARRAY","S1"))'="""ALL""" D SAVE2,SAVE3
"RTN","SCMCTSKG",98,0)
 Q
"RTN","SCMCTSKG",99,0)
SAVE1 ;
"RTN","SCMCTSKG",100,0)
 S Y=UNDATE D DD^%DT S UNDATE=Y
"RTN","SCMCTSKG",101,0)
 S NUM=NUM+1
"RTN","SCMCTSKG",102,0)
 S ^TMP("SCRESULT",INST,PAT,NUM)=PAT_"^"_SSN_"^"_INST_"^"_TEAMN_"^"_PROV_"^"_TEAMP_"^"_PREC_"^"_UNDATE_"^"_UNREA
"RTN","SCMCTSKG",103,0)
 Q
"RTN","SCMCTSKG",104,0)
SAVE2 ;
"RTN","SCMCTSKG",105,0)
 S (S1,S2,S3,S4,S5,S6,S7)="",CC="",SORT=""
"RTN","SCMCTSKG",106,0)
 F NN=1:1:7 S SORT=$G(^TMP("SCARRAY","S"_NN)) Q:SORT=""  D
"RTN","SCMCTSKG",107,0)
 .S SORT=$P(SORT,"""",2)
"RTN","SCMCTSKG",108,0)
 .S XX=$S(SORT="Patient":PAT,SORT="Institution":INST,SORT="Team":TEAMN,SORT="Provider":PROV,SORT="Team Position":TEAMP,SORT="Date":UNDATE,SORT="Reason":UNREA,1:"")
"RTN","SCMCTSKG",109,0)
 .S HOLD=NN
"RTN","SCMCTSKG",110,0)
 .I NN=1 S S1=XX,^TMP("SCRESULT",S1)=""
"RTN","SCMCTSKG",111,0)
 .I NN=2 S S2=XX,^TMP("SCRESULT",S1,S2)=""
"RTN","SCMCTSKG",112,0)
 .I NN=3 S S3=XX,^TMP("SCRESULT",S1,S2,S3)=""
"RTN","SCMCTSKG",113,0)
 .I NN=4 S S4=XX,^TMP("SCRESULT",S1,S2,S3,S4)=""
"RTN","SCMCTSKG",114,0)
 .I NN=5 S S5=XX,^TMP("SCRESULT",S1,S2,S3,S4,S5)=""
"RTN","SCMCTSKG",115,0)
 .I NN=6 S S6=XX,^TMP("SCRESULT",S1,S2,S3,S4,S5,S6)=""
"RTN","SCMCTSKG",116,0)
 .I NN=7 S S7=XX,^TMP("SCRESULT",S1,S2,S3,S4,S5,S6,S7)=""
"RTN","SCMCTSKG",117,0)
 Q
"RTN","SCMCTSKG",118,0)
SAVE3 ;
"RTN","SCMCTSKG",119,0)
 S CC=$S(HOLD=1:"SORT1",HOLD=2:"SORT2",HOLD=3:"SORT3",HOLD=4:"SORT4",HOLD=5:"SORT5",HOLD=6:"SORT6",HOLD=7:"SORT7",1:"")
"RTN","SCMCTSKG",120,0)
 S UNDATE2="" S UNDATE2=UNDATE
"RTN","SCMCTSKG",121,0)
 S Y=UNDATE2 D DD^%DT S UNDATE2=Y
"RTN","SCMCTSKG",122,0)
 D @CC
"RTN","SCMCTSKG",123,0)
 Q
"RTN","SCMCTSKG",124,0)
SORT1 ;
"RTN","SCMCTSKG",125,0)
 I $D(^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)) Q
"RTN","SCMCTSKG",126,0)
 S CT=CT+1
"RTN","SCMCTSKG",127,0)
 S ^TMP("SCRESULT",S1,CT)=PAT_"^"_SSN_"^"_INST_"^"_TEAMN_"^"_PROV_"^"_TEAMP_"^"_PREC_"^"_UNDATE2_"^"_UNREA
"RTN","SCMCTSKG",128,0)
 S ^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)=""
"RTN","SCMCTSKG",129,0)
 Q
"RTN","SCMCTSKG",130,0)
SORT2 ;
"RTN","SCMCTSKG",131,0)
 I $D(^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)) Q
"RTN","SCMCTSKG",132,0)
 S CT=CT+1
"RTN","SCMCTSKG",133,0)
 S ^TMP("SCRESULT",S1,S2,CT)=PAT_"^"_SSN_"^"_INST_"^"_TEAMN_"^"_PROV_"^"_TEAMP_"^"_PREC_"^"_UNDATE2_"^"_UNREA
"RTN","SCMCTSKG",134,0)
 S ^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)=""
"RTN","SCMCTSKG",135,0)
 Q
"RTN","SCMCTSKG",136,0)
SORT3 ;
"RTN","SCMCTSKG",137,0)
 I $D(^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)) Q
"RTN","SCMCTSKG",138,0)
 S CT=CT+1
"RTN","SCMCTSKG",139,0)
 S ^TMP("SCRESULT",S1,S2,S3,CT)=PAT_"^"_SSN_"^"_INST_"^"_TEAMN_"^"_PROV_"^"_TEAMP_"^"_PREC_"^"_UNDATE2_"^"_UNREA
"RTN","SCMCTSKG",140,0)
 S ^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)=""
"RTN","SCMCTSKG",141,0)
 Q
"RTN","SCMCTSKG",142,0)
SORT4 ;
"RTN","SCMCTSKG",143,0)
 I $D(^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)) Q
"RTN","SCMCTSKG",144,0)
 S CT=CT+1
"RTN","SCMCTSKG",145,0)
 S ^TMP("SCRESULT",S1,S2,S3,S4,CT)=PAT_"^"_SSN_"^"_INST_"^"_TEAMN_"^"_PROV_"^"_TEAMP_"^"_PREC_"^"_UNDATE2_"^"_UNREA
"RTN","SCMCTSKG",146,0)
 S ^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)=""
"RTN","SCMCTSKG",147,0)
 Q
"RTN","SCMCTSKG",148,0)
SORT5 ;
"RTN","SCMCTSKG",149,0)
 I $D(^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)) Q
"RTN","SCMCTSKG",150,0)
 S CT=CT+1
"RTN","SCMCTSKG",151,0)
 S ^TMP("SCRESULT",S1,S2,S3,S4,S5,CT)=PAT_"^"_SSN_"^"_INST_"^"_TEAMN_"^"_PROV_"^"_TEAMP_"^"_PREC_"^"_UNDATE2_"^"_UNREA
"RTN","SCMCTSKG",152,0)
 S ^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)=""
"RTN","SCMCTSKG",153,0)
 Q
"RTN","SCMCTSKG",154,0)
SORT6 ;
"RTN","SCMCTSKG",155,0)
 I $D(^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)) Q
"RTN","SCMCTSKG",156,0)
 S CT=CT+1
"RTN","SCMCTSKG",157,0)
 S ^TMP("SCRESULT",S1,S2,S3,S4,S5,S6,CT)=PAT_"^"_SSN_"^"_INST_"^"_TEAMN_"^"_PROV_"^"_TEAMP_"^"_PREC_"^"_UNDATE2_"^"_UNREA
"RTN","SCMCTSKG",158,0)
 S ^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)=""
"RTN","SCMCTSKG",159,0)
 Q
"RTN","SCMCTSKG",160,0)
SORT7 ;
"RTN","SCMCTSKG",161,0)
 I $D(^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)) Q
"RTN","SCMCTSKG",162,0)
 S CT=CT+1
"RTN","SCMCTSKG",163,0)
 S ^TMP("SCRESULT",S1,S2,S3,S4,S5,S6,S7,CT)=PAT_"^"_SSN_"^"_INST_"^"_TEAMN_"^"_PROV_"^"_TEAMP_"^"_PREC_"^"_UNDATE2_"^"_UNREA
"RTN","SCMCTSKG",164,0)
 S ^TMP("SCRESULT","B",PAT,SSN,INST,TEAMN)=""
"RTN","SCMCTSKG",165,0)
 Q
"RTN","SCMCTSKG",166,0)
FINAL ;
"RTN","SCMCTSKG",167,0)
 I $G(^TMP("SCARRAY","S1"))="""ALL""" D
"RTN","SCMCTSKG",168,0)
 .S (INST,PAT,NUM)="" S CC=0,C=0
"RTN","SCMCTSKG",169,0)
 .S INST="" F  S INST=$O(^TMP("SCRESULT",INST)) Q:INST=""  D
"RTN","SCMCTSKG",170,0)
 ..S PAT="" F  S PAT=$O(^TMP("SCRESULT",INST,PAT)) Q:PAT=""  D
"RTN","SCMCTSKG",171,0)
 ...S NUM="" F  S NUM=$O(^TMP("SCRESULT",INST,PAT,NUM)) Q:NUM=""  D
"RTN","SCMCTSKG",172,0)
 ....S CC=CC+1 S ^TMP("SCRESULT",CC)=^TMP("SCRESULT",INST,PAT,NUM)
"RTN","SCMCTSKG",173,0)
 ....K ^TMP("SCRESULT",INST,PAT,NUM)
"RTN","SCMCTSKG",174,0)
 I $G(^TMP("SCARRAY","S1"))'="""ALL""" D
"RTN","SCMCTSKG",175,0)
 .S (S1,S2,S3,S4,S5,S6,S7)="",CT=0,C=0
"RTN","SCMCTSKG",176,0)
 .IF CC="SORT1" D
"RTN","SCMCTSKG",177,0)
 ..S S1="" F  S S1=$O(^TMP("SCRESULT",S1)) Q:S1=""  D
"RTN","SCMCTSKG",178,0)
 ...S C="" F  S C=$O(^TMP("SCRESULT",S1,C)) Q:C=""  D
"RTN","SCMCTSKG",179,0)
 ....S CT=CT+1 S ^TMP("SCRESULT",CT)=^TMP("SCRESULT",S1,C)
"RTN","SCMCTSKG",180,0)
 ....K ^TMP("SCRESULT",S1,C)
"RTN","SCMCTSKG",181,0)
 .I CC="SORT2" D
"RTN","SCMCTSKG",182,0)
 ..S S1="" F  S S1=$O(^TMP("SCRESULT",S1)) Q:S1=""  D
"RTN","SCMCTSKG",183,0)
 ...S S2="" F  S S2=$O(^TMP("SCRESULT",S1,S2)) Q:S2=""  D
"RTN","SCMCTSKG",184,0)
 ....S C="" F  S C=$O(^TMP("SCRESULT",S1,S2,C)) Q:C=""  D
"RTN","SCMCTSKG",185,0)
 .....S CT=CT+1 S ^TMP("SCRESULT",CT)=^TMP("SCRESULT",S1,S2,C)
"RTN","SCMCTSKG",186,0)
 .....K ^TMP("SCRESULT",S1,S2,C)
"RTN","SCMCTSKG",187,0)
 .I CC="SORT3" D
"RTN","SCMCTSKG",188,0)
 ..S S1="" F  S S1=$O(^TMP("SCRESULT",S1)) Q:S1=""  D
"RTN","SCMCTSKG",189,0)
 ...S S2="" F  S S2=$O(^TMP("SCRESULT",S1,S2)) Q:S2=""  D
"RTN","SCMCTSKG",190,0)
 ....S S3="" F  S S3=$O(^TMP("SCRESULT",S1,S2,S3)) Q:S3=""  D
"RTN","SCMCTSKG",191,0)
 .....S C="" F  S C=$O(^TMP("SCRESULT",S1,S2,S3,C)) Q:C=""  D
"RTN","SCMCTSKG",192,0)
 ......S CT=CT+1 S ^TMP("SCRESULT",CT)=^TMP("SCRESULT",S1,S2,S3,C)
"RTN","SCMCTSKG",193,0)
 ......K ^TMP("SCRESULT",S1,S2,S3,C)
"RTN","SCMCTSKG",194,0)
 .I CC="SORT4" D
"RTN","SCMCTSKG",195,0)
 ..S S1="" F  S S1=$O(^TMP("SCRESULT",S1)) Q:S1=""  D
"RTN","SCMCTSKG",196,0)
 ...S S2="" F  S S2=$O(^TMP("SCRESULT",S1,S2)) Q:S2=""  D
"RTN","SCMCTSKG",197,0)
 ....S S3="" F  S S3=$O(^TMP("SCRESULT",S1,S2,S3)) Q:S3=""  D
"RTN","SCMCTSKG",198,0)
 .....S S4="" F  S S4=$O(^TMP("SCRESULT",S1,S2,S3,S4)) Q:S4=""  D
"RTN","SCMCTSKG",199,0)
 ......S C="" F  S C=$O(^TMP("SCRESULT",S1,S2,S3,S4,C)) Q:C=""  D
"RTN","SCMCTSKG",200,0)
 .......S CT=CT+1 S ^TMP("SCRESULT",CT)=^TMP("SCRESULT",S1,S2,S3,S4,C)
"RTN","SCMCTSKG",201,0)
 .......K ^TMP("SCRESULT",S1,S2,S3,S4,C)
"RTN","SCMCTSKG",202,0)
 .I CC="SORT5" D
"RTN","SCMCTSKG",203,0)
 ..S S1="" F  S S1=$O(^TMP("SCRESULT",S1)) Q:S1=""  D
"RTN","SCMCTSKG",204,0)
 ...S S2="" F  S S2=$O(^TMP("SCRESULT",S1,S2)) Q:S2=""  D
"RTN","SCMCTSKG",205,0)
 ....S S3="" F  S S3=$O(^TMP("SCRESULT",S1,S2,S3)) Q:S3=""  D
"RTN","SCMCTSKG",206,0)
 .....S S4="" F  S S4=$O(^TMP("SCRESULT",S1,S2,S3,S4)) Q:S4=""  D
"RTN","SCMCTSKG",207,0)
 ......S S5="" F  S S5=$O(^TMP("SCRESULT",S1,S2,S3,S4,S5)) Q:S5=""  D
"RTN","SCMCTSKG",208,0)
 .......S C="" F  S C=$O(^TMP("SCRESULT",S1,S2,S3,S4,S5,C)) Q:C=""  D
"RTN","SCMCTSKG",209,0)
 ........S CT=CT+1 S ^TMP("SCRESULT",CT)=^TMP("SCRESULT",S1,S2,S3,S4,S5,C)
"RTN","SCMCTSKG",210,0)
 ........K ^TMP("SCRESULT",S1,S2,S3,S4,S5,C)
"RTN","SCMCTSKG",211,0)
 .I CC="SORT6" D
"RTN","SCMCTSKG",212,0)
 ..S S1="" F  S S1=$O(^TMP("SCRESULT",S1)) Q:S1=""  D
"RTN","SCMCTSKG",213,0)
 ...S S2="" F  S S2=$O(^TMP("SCRESULT",S1,S2)) Q:S2=""  D
"RTN","SCMCTSKG",214,0)
 ....S S3="" F  S S3=$O(^TMP("SCRESULT",S1,S2,S3)) Q:S3=""  D
"RTN","SCMCTSKG",215,0)
 .....S S4="" F  S S4=$O(^TMP("SCRESULT",S1,S2,S3,S4)) Q:S4=""  D
"RTN","SCMCTSKG",216,0)
 ......S S5="" F  S S5=$O(^TMP("SCRESULT",S1,S2,S3,S4,S5)) Q:S5=""  D
"RTN","SCMCTSKG",217,0)
 .......S S6="" F  S S6=$O(^TMP("SCRESULT",S1,S2,S3,S4,S5,S6)) Q:S6=""  D
"RTN","SCMCTSKG",218,0)
 ........S C="" F  S C=$O(^TMP("SCRESULT",S1,S2,S3,S4,S5,S6,C)) Q:C=""  D
"RTN","SCMCTSKG",219,0)
 .........S CT=CT+1 S ^TMP("SCRESULT",CT)=^TMP("SCRESULT",S1,S2,S3,S4,S5,S6,C)
"RTN","SCMCTSKG",220,0)
 .........K ^TMP("SCRESULT",S1,S2,S3,S4,S5,S6,C)
"RTN","SCMCTSKG",221,0)
 .I CC="SORT7" D
"RTN","SCMCTSKG",222,0)
 ..S S1="" F  S S1=$O(^TMP("SCRESULT",S1)) Q:S1=""  D
"RTN","SCMCTSKG",223,0)
 ...S S2="" F  S S2=$O(^TMP("SCRESULT",S1,S2)) Q:S2=""  D
"RTN","SCMCTSKG",224,0)
 ....S S3="" F  S S3=$O(^TMP("SCRESULT",S1,S2,S3)) Q:S3=""  D
"RTN","SCMCTSKG",225,0)
 .....S S4="" F  S S4=$O(^TMP("SCRESULT",S1,S2,S3,S4)) Q:S4=""  D
"RTN","SCMCTSKG",226,0)
 ......S S5="" F  S S5=$O(^TMP("SCRESULT",S1,S2,S3,S4,S5)) Q:S5=""  D
"RTN","SCMCTSKG",227,0)
 .......S S6="" F  S S6=$O(^TMP("SCRESULT",S1,S2,S3,S4,S5,S6)) Q:S6=""  D
"RTN","SCMCTSKG",228,0)
 ........S S7="" F  S S7=$O(^TMP("SCRESULT",S1,S2,S3,S4,S5,S6,S7)) Q:S7=""  D
"RTN","SCMCTSKG",229,0)
 .........S C="" F  S C=$O(^TMP("SCRESULT",S1,S2,S3,S4,S5,S6,S7,C)) Q:C=""  D
"RTN","SCMCTSKG",230,0)
 ..........S CT=CT+1 S ^TMP("SCRESULT",CT)=^TMP("SCRESULT",S1,S2,S3,S4,S5,S6,S7,C)
"RTN","SCMCTSKG",231,0)
 ..........K ^TMP("SCRESULT",S1,S2,S3,S4,S5,S6,S7,C)
"RTN","SCMCTSKG",232,0)
 Q
"RTN","SCMCTSKG",233,0)
EXIT ;
"RTN","SCMCTSKG",234,0)
 K STAT,TN,TPN,IEN,INST,INSTN,UNDATE,UNREA,TEAMPN,SSN,SSNN,S1,S2,S3,S4,S5,S6,S7,S8
"RTN","SCMCTSKG",235,0)
 K TEAM,TEAMN,TEAMP,PROVN,PROV,BDATE,EDATE,PAT,INAME,HOLD,NUM,NU,CC,C,CT,XX,ST
"RTN","SCMCTSKG",236,0)
 K TN2,TPN2,UNDATE2,DATE2,EFFD,ERROR,SORT,SN,PDATE,POS,PREC,JJ,J,INUM,NN,P1,P2,P3
"RTN","SCMCTSKG",237,0)
 K ^TMP("SCARRAY")
"RTN","SCMCTSKG",238,0)
 Q
"RTN","SD53P504")
0^10^B59534765^n/a
"RTN","SD53P504",1,0)
SD53P504 ;BP/DMR - Check PCMM OIF/OEF entries. 6/23/2009 ; 9/22/09 11:14am
"RTN","SD53P504",2,0)
 ;;5.3;Scheduling;**504**;AUG 13, 1993;Build 21
"RTN","SD53P504",3,0)
PRE ;
"RTN","SD53P504",4,0)
 N ZZ
"RTN","SD53P504",5,0)
 S ZZ=$$GET1^DIQ(404.91,1_",",803,"I") I ZZ'="" D
"RTN","SD53P504",6,0)
 .IF ZZ=1 S $P(^SD(404.91,1,"PCMM"),"^",3)=0
"RTN","SD53P504",7,0)
 I $$INIT()=0 D   ;run config checks for OIF OEF
"RTN","SD53P504",8,0)
 . D BMES^XPDUTL("The OIF OEF team is not set up correctly.")
"RTN","SD53P504",9,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","SD53P504",10,0)
 . S XPDABORT=1
"RTN","SD53P504",11,0)
 Q
"RTN","SD53P504",12,0)
POST ;
"RTN","SD53P504",13,0)
 D CLEAN(1)
"RTN","SD53P504",14,0)
 Q
"RTN","SD53P504",15,0)
INIT() ;
"RTN","SD53P504",16,0)
 ;inputs    none
"RTN","SD53P504",17,0)
 ;outputs   0=fail
"RTN","SD53P504",18,0)
 ;          1=success
"RTN","SD53P504",19,0)
 S (DFN,IEN,JJ,TEAM,TIEN,TPOS,TPOSC,TPIEN,TPUR,PUR,ROLE,COUNT,PC,STAT)="" S HOLD=0
"RTN","SD53P504",20,0)
 K ^TMP("SCMMT"),^TMP("SCMMR")
"RTN","SD53P504",21,0)
 N SCTFG    ;success/fail team config
"RTN","SD53P504",22,0)
 N SCRFG    ;success/fail role config
"RTN","SD53P504",23,0)
 S SCTFG=$$TEAM()
"RTN","SD53P504",24,0)
 S SCRFG=$$ROLE()
"RTN","SD53P504",25,0)
 D EXIT
"RTN","SD53P504",26,0)
 Q $S(SCTFG=0:0,SCRFG=0:0,1:1)
"RTN","SD53P504",27,0)
TEAM() ;
"RTN","SD53P504",28,0)
 ;if only one active team w/oif oef purp and pc=no count=9
"RTN","SD53P504",29,0)
 S TEAM="" S COUNT=8 F  S TEAM=$O(^SCTM(404.51,"B",TEAM)) Q:TEAM=""  D
"RTN","SD53P504",30,0)
 .S TIEN="" F  S TIEN=$O(^SCTM(404.51,"B",TEAM,TIEN)) Q:TIEN=""  D
"RTN","SD53P504",31,0)
 ..D HISTM Q:STAT'=1
"RTN","SD53P504",32,0)
 ..S TPUR="" S TPUR=$$GET1^DIQ(404.51,TIEN_",",.03,"E")
"RTN","SD53P504",33,0)
 ..IF TPUR["OIF"!(TPUR["OEF") D
"RTN","SD53P504",34,0)
 ...S COUNT=COUNT+1
"RTN","SD53P504",35,0)
 ...S PC="" S PC=$$GET1^DIQ(404.51,TIEN_",",.05)
"RTN","SD53P504",36,0)
 ...IF PC="YES" S COUNT=COUNT+1
"RTN","SD53P504",37,0)
 ...S ^TMP("SCMMT",$J,COUNT)="TEAM: "_TEAM
"RTN","SD53P504",38,0)
 ...S COUNT=COUNT+1 S ^TMP("SCMMT",$J,COUNT)="PRIMARY CARE TEAM: "_PC
"RTN","SD53P504",39,0)
 ...S COUNT=COUNT+1 S ^TMP("SCMMT",$J,COUNT)=""
"RTN","SD53P504",40,0)
 ...Q
"RTN","SD53P504",41,0)
 IF COUNT>11 D MESS1 Q 0  ;oif oef team set to pc
"RTN","SD53P504",42,0)
 IF COUNT=8 D MESS1 Q 0   ;no active oif oef team
"RTN","SD53P504",43,0)
 Q 1
"RTN","SD53P504",44,0)
ROLE() ;
"RTN","SD53P504",45,0)
 S (TEAM,TPUR,ROIF,TOIF,TPOIF,TPHS,TPHN,STAT,TPH,STAT,RIEN,APC)="",CC=6
"RTN","SD53P504",46,0)
 S TPOS="" F  S TPOS=$O(^SCTM(404.57,"B",TPOS)) Q:TPOS=""  D
"RTN","SD53P504",47,0)
 .S TPIEN="" F  S TPIEN=$O(^SCTM(404.57,"B",TPOS,TPIEN)) Q:TPIEN=""  D
"RTN","SD53P504",48,0)
 ..D HIST
"RTN","SD53P504",49,0)
 ..Q:STAT=0
"RTN","SD53P504",50,0)
 ..S RIEN="" S RIEN=$$GET1^DIQ(404.57,TPIEN_",",.03,"I")
"RTN","SD53P504",51,0)
 ..S ROLE="" S ROLE=$$GET1^DIQ(404.57,TPIEN_",",.03,"E")
"RTN","SD53P504",52,0)
 ..S ROIF="" IF ROLE["OIF"!(ROLE["OEF") S ROIF="Y"
"RTN","SD53P504",53,0)
 ..S TEAM=$$GET1^DIQ(404.57,TPIEN_",",.02),TIEN=$$GET1^DIQ(404.57,TPIEN_",",.02,"I")
"RTN","SD53P504",54,0)
 ..D HISTM Q:STAT'=1  ;exclude positions on inactive teams
"RTN","SD53P504",55,0)
 ..S (TOIF,TPOIF)="" S TPUR=$$GET1^DIQ(404.51,TIEN_",",.03) IF TPUR["OIF"!(TPUR["OEF") S (TOIF,TPOIF)="Y"
"RTN","SD53P504",56,0)
 ..S PPP=$$GET1^DIQ(404.57,TPIEN_",",.04,"E")
"RTN","SD53P504",57,0)
 ..D SAVE IF SAVE="Y" D
"RTN","SD53P504",58,0)
 ...S CC=CC+1 S ^TMP("SCMMR",$J,CC)=""
"RTN","SD53P504",59,0)
 ...S CC=CC+1 S ^TMP("SCMMR",$J,CC)="TEAM: "_TEAM
"RTN","SD53P504",60,0)
 ...S CC=CC+1 S ^TMP("SCMMR",$J,CC)="TEAM POSITION: "_TPOS
"RTN","SD53P504",61,0)
 ...S CC=CC+1 S ^TMP("SCMMR",$J,CC)="TEAM PURPOSE: "_TPUR
"RTN","SD53P504",62,0)
 ...S CC=CC+1 S ^TMP("SCMMR",$J,CC)="ROLE: "_ROLE
"RTN","SD53P504",63,0)
 ...S CC=CC+1 S ^TMP("SCMMR",$J,CC)="POSSIBLE PRIMARY PRACTITIONER: "_PPP
"RTN","SD53P504",64,0)
 ...Q
"RTN","SD53P504",65,0)
 IF CC>6 D MESS2 Q 0
"RTN","SD53P504",66,0)
 Q 1
"RTN","SD53P504",67,0)
HIST ;Get TEAM POSITION HISTORY status.
"RTN","SD53P504",68,0)
 S (STAT,TPH,TPHN)=""
"RTN","SD53P504",69,0)
 S TPHN="" F  S TPHN=$O(^SCTM(404.59,"B",TPIEN,TPHN)) Q:TPHN=""  D
"RTN","SD53P504",70,0)
 .S TPH="" S STAT=$$GET1^DIQ(404.59,TPHN_",",.03,"I")
"RTN","SD53P504",71,0)
 .S TPHDT=$$GET1^DIQ(404.59,TPHN_",",.02,"I")
"RTN","SD53P504",72,0)
 .IF TPHDT>DT S STAT='STAT
"RTN","SD53P504",73,0)
 .Q
"RTN","SD53P504",74,0)
 Q
"RTN","SD53P504",75,0)
HISTM ;Get TEAM HISTORY status
"RTN","SD53P504",76,0)
 S IEN="" F  S IEN=$O(^SCTM(404.58,"B",TIEN,IEN)) Q:IEN=""  D
"RTN","SD53P504",77,0)
 .S STAT=$$GET1^DIQ(404.58,IEN_",",.03,"I")
"RTN","SD53P504",78,0)
 .S THDT=$$GET1^DIQ(404.58,IEN_",",.02,"I")
"RTN","SD53P504",79,0)
 .IF THDT>DT S STAT='STAT
"RTN","SD53P504",80,0)
 Q
"RTN","SD53P504",81,0)
SAVE ;
"RTN","SD53P504",82,0)
 S SAVE=""
"RTN","SD53P504",83,0)
 Q:ROIF=""&(TOIF=""&(TPOIF=""))
"RTN","SD53P504",84,0)
 IF ROIF="Y"&(TOIF=""!(TPOIF="")) S SAVE="Y"
"RTN","SD53P504",85,0)
 IF ROIF=""&(TOIF="Y"!(TPOIF="Y")) S SAVE="Y"
"RTN","SD53P504",86,0)
 IF TOIF="Y"&(ROIF=""!(TPOIF="")) S SAVE="Y"
"RTN","SD53P504",87,0)
 IF TOIF=""&(ROIF="Y"!(TPOIF="Y")) S SAVE="Y"
"RTN","SD53P504",88,0)
 IF TPOIF="Y"&(ROIF=""!(TOIF="")) S SAVE="Y"
"RTN","SD53P504",89,0)
 IF TPOIF=""&(ROIF="Y"!(TOIF="")) S SAVE="Y"
"RTN","SD53P504",90,0)
 Q
"RTN","SD53P504",91,0)
 ;
"RTN","SD53P504",92,0)
MESS1 ;Create message if more than 1 oif oef team.
"RTN","SD53P504",93,0)
 S ^TMP("SCMMT",$J,1)="The setup of the OIF OEF team at this site is incorrect."
"RTN","SD53P504",94,0)
 S ^TMP("SCMMT",$J,2)="The business rules governing PCMM OIF OEF teams state that each"
"RTN","SD53P504",95,0)
 S ^TMP("SCMMT",$J,3)="site can have only one OIF OEF team. That team cannot provide primary care."
"RTN","SD53P504",96,0)
 S ^TMP("SCMMT",$J,4)="Please correct errors as soon as possible; you will continue "
"RTN","SD53P504",97,0)
 S ^TMP("SCMMT",$J,5)="to receive this message until all errors are resolved."
"RTN","SD53P504",98,0)
 S ^TMP("SCMMT",$J,6)=""
"RTN","SD53P504",99,0)
 S ^TMP("SCMMT",$J,7)="THE FOLLOWING IS A LIST OF OIF OEF TEAMS AT THIS INSTITUTION:"
"RTN","SD53P504",100,0)
 S ^TMP("SCMMT",$J,8)=""
"RTN","SD53P504",101,0)
 N XMSUB,XMY,XMTEST,XMDUZ
"RTN","SD53P504",102,0)
 S XMSUB="PCMM OIF OEF TEAMS"
"RTN","SD53P504",103,0)
 S XMY("G.PCMM HL7 MESSAGES")=""
"RTN","SD53P504",104,0)
 S XMTEXT="^TMP(""SCMMT"",$J,"
"RTN","SD53P504",105,0)
 D ^XMD
"RTN","SD53P504",106,0)
 S HOLD="Y"
"RTN","SD53P504",107,0)
 Q
"RTN","SD53P504",108,0)
MESS2 ;Create message for bad entries involving oif oef teams.
"RTN","SD53P504",109,0)
 S ^TMP("SCMMR",$J,1)="The PCMM TEAM POSITIONS listed below have inconsistencies"
"RTN","SD53P504",110,0)
 S ^TMP("SCMMR",$J,2)="in the set up of OIF OEF Teams and Positions in the PCMM package."
"RTN","SD53P504",111,0)
 S ^TMP("SCMMR",$J,3)="Please review the business rules pertaining to the set up of"
"RTN","SD53P504",112,0)
 S ^TMP("SCMMR",$J,4)="OIF OEF Teams and Positions. The PCMM HL7 Transmission will not"
"RTN","SD53P504",113,0)
 S ^TMP("SCMMR",$J,5)="transmit until these errors are corrected. If additional assistance"
"RTN","SD53P504",114,0)
 S ^TMP("SCMMR",$J,6)="is needed please contact the national helpdesk."
"RTN","SD53P504",115,0)
 N XMSUB,XMY,XMTEST,XMDUZ
"RTN","SD53P504",116,0)
 S XMSUB="PCMM OIF OEF ERROR MESSAGE"
"RTN","SD53P504",117,0)
 S XMY("G.PCMM HL7 MESSAGES")=""
"RTN","SD53P504",118,0)
 S XMTEXT="^TMP(""SCMMR"",$J,"
"RTN","SD53P504",119,0)
 D ^XMD
"RTN","SD53P504",120,0)
 S HOLD="Y"
"RTN","SD53P504",121,0)
 Q
"RTN","SD53P504",122,0)
CLEAN(SCOIFG) ;clean up errors in transmission log
"RTN","SD53P504",123,0)
 ;inputs
"RTN","SD53P504",124,0)
 ;  0=bad OIF OEF config
"RTN","SD53P504",125,0)
 ;  1=good OIF OEF config
"RTN","SD53P504",126,0)
 ;
"RTN","SD53P504",127,0)
 ;error profile
"RTN","SD53P504",128,0)
 ;  patient=null
"RTN","SD53P504",129,0)
 ;  practitioner=null
"RTN","SD53P504",130,0)
 ;  status=rj
"RTN","SD53P504",131,0)
 ;  ZPC ID exists
"RTN","SD53P504",132,0)
 ;
"RTN","SD53P504",133,0)
 N SCI,SCJ,SCK,SCA,DFN,SC1
"RTN","SD53P504",134,0)
 N SC0            ;0 node 404.471
"RTN","SD53P504",135,0)
 N SC043          ;0 node 404.43
"RTN","SD53P504",136,0)
 N SCT,SCT1,SCT2  ;counters
"RTN","SD53P504",137,0)
 N SCTP           ;position ien
"RTN","SD53P504",138,0)
 N SCEPS          ;return value 
"RTN","SD53P504",139,0)
 N SCSTAT         ;return value
"RTN","SD53P504",140,0)
 N SCERR          ;error text
"RTN","SD53P504",141,0)
 N SCARRAY        ;array of ZPC segments
"RTN","SD53P504",142,0)
 N SCIENS         ;ien 404.47141
"RTN","SD53P504",143,0)
 ;;;
"RTN","SD53P504",144,0)
 S (SC043,SCK,SCT,SCT1,SCT2)=0
"RTN","SD53P504",145,0)
 D BMES^XPDUTL("Cleaning PCMM Transmission Log")
"RTN","SD53P504",146,0)
 F SCI=0:0 S SCI=$O(^SCPT(404.471,"ASTAT","RJ",SCI)) Q:SCI'>0  D
"RTN","SD53P504",147,0)
 . S SC0=$G(^SCPT(404.471,SCI,0))  ;get 0 node
"RTN","SD53P504",148,0)
 . I (+$P(SC0,U,2)_U_(+$P(SC0,U,8)))'="0^0" Q  ;exclude
"RTN","SD53P504",149,0)
 . S SCA=0 F SCK=0:0 S SCK=$O(^SCPT(404.471,SCI,"ZPC",SCK)) Q:SCK=""!(+SCA>0)  D
"RTN","SD53P504",150,0)
 .. S SCIENS=SCK_","_SCI,SCA=+($$GET1^DIQ(404.47141,SCIENS,.02))
"RTN","SD53P504",151,0)
 . Q:SCA=0  ;exclude if no ZPC ID
"RTN","SD53P504",152,0)
 . S SC043=$G(^SCPT(404.43,SCA,0))
"RTN","SD53P504",153,0)
 . ;close log entry
"RTN","SD53P504",154,0)
 . F SCK=0:0 S SCK=$O(^SCPT(404.471,SCI,"ERR",SCK)) Q:SCK'>0  D
"RTN","SD53P504",155,0)
 .. S SCEPS=$$UPDEPS^SCMCHLA(SCI,SCK,2,.SCERR)
"RTN","SD53P504",156,0)
 . S SCSTAT=$$UPDSTAT^SCMCHLA(SCI,"RT",.SCERR)
"RTN","SD53P504",157,0)
 . I SCERR'="" D  Q
"RTN","SD53P504",158,0)
 .. S SCT2=SCT2+1
"RTN","SD53P504",159,0)
 .. S SCARRAY(SCI)=SCERR
"RTN","SD53P504",160,0)
 . S SCT1=SCT1+1 W:SCT1\5 "."
"RTN","SD53P504",161,0)
 . Q:SC043=0  ;stop processing log entries with no 404.43
"RTN","SD53P504",162,0)
 . S DFN=+$P($G(^SCPT(404.42,+SC043,0)),U)
"RTN","SD53P504",163,0)
 . S SCTP=+$P(SC043,U,2)
"RTN","SD53P504",164,0)
 . ;only re-send if good 404.43 record and no OIF OEF errors
"RTN","SD53P504",165,0)
 . I DFN>0&(SCOIFG) D
"RTN","SD53P504",166,0)
 .. D ADD^SCMCHLE("NOW",+SCA_";SCPT(404.43,",DFN,SCTP)
"RTN","SD53P504",167,0)
 .. S SCT=SCT+1
"RTN","SD53P504",168,0)
 I SCT_U_SCT1'=(0_U_0) D MSG(SCT_U_SCT1_U_SCT2,.SCARRAY)
"RTN","SD53P504",169,0)
 K ^TMP("SCOIF",$J)
"RTN","SD53P504",170,0)
 Q
"RTN","SD53P504",171,0)
MSG(SC1,SCARRAY) ;
"RTN","SD53P504",172,0)
 ;inputs
"RTN","SD53P504",173,0)
 N XMY,XMDUZ,XMSUB,XMTEXT
"RTN","SD53P504",174,0)
 N SCIX,SCI
"RTN","SD53P504",175,0)
 S XMDUZ="PCMM Module"
"RTN","SD53P504",176,0)
 S XMY("G.PCMM HL7 MESSAGES")=""
"RTN","SD53P504",177,0)
 S XMSUB="PCMM Transmission Log Clean Up"
"RTN","SD53P504",178,0)
 S XMTEXT="^TMP(""SCOIF"",$J,"
"RTN","SD53P504",179,0)
 K ^TMP("SCOIF",$J)
"RTN","SD53P504",180,0)
 S ^TMP("SCOIF",$J,1)=""
"RTN","SD53P504",181,0)
 S ^TMP("SCOIF",$J,2)="Number of transmission log entries that were closed: "_+$P(SC1,U,2)
"RTN","SD53P504",182,0)
 S ^TMP("SCOIF",$J,3)="Number of OIF OEF patient assignments that will be re-transmitted: "_+$P(SC1,U)
"RTN","SD53P504",183,0)
 S ^TMP("SCOIF",$J,4)=""
"RTN","SD53P504",184,0)
 I +$P(SC1,U,3) D
"RTN","SD53P504",185,0)
 . S ^TMP("SCOIF",$J,5)="The following transmission log entries could not be closed: "
"RTN","SD53P504",186,0)
 . S ^TMP("SCOIF",$J,6)="IEN"_$J(" ",7)_"Msg ID"_$J(" ",11)_"Error"
"RTN","SD53P504",187,0)
 . S SCI="" F SCIX=7:1 S SCI=$O(SCARRAY(SCI)) Q:SCI=""  D
"RTN","SD53P504",188,0)
 .. S ^TMP("SCOIF",$J,SCIX)=SCI_$J(" ",10-$L(SCI))_$$GET1^DIQ(404.471,SCI,.01,"E")_$J(" ",7)_SCARRAY(SCI)
"RTN","SD53P504",189,0)
 ..S ^TMP("SCOIF",$J,SCIX+1)=""
"RTN","SD53P504",190,0)
 D ^XMD
"RTN","SD53P504",191,0)
 Q
"RTN","SD53P504",192,0)
EXIT ;End routine
"RTN","SD53P504",193,0)
 K DFN,IEN,JJ,TEAM,TIEN,TPOS,TPOSC,TPIEN,TPUR,PUR,ROLE,COUNT
"RTN","SD53P504",194,0)
 K TEAM,TPUR,TIEN,ROIF,TOIF,TPOIF,TPHS,TPHN,STAT,RIEN,APC
"RTN","SD53P504",195,0)
 K CC,PC,PPP,SAVE,THDT,TPH,TPHDT,XMTEXT,HOLD,IENS
"RTN","SD53P504",196,0)
 K ^TMP("SCMMT",$J),^TMP("SCMMR",$J)
"RTN","SD53P504",197,0)
 Q
"VER")
8.0^22.0
"^DD",404.42,404.42,.15,0)
STATUS^S^DU:DEATH UNASSIGNMENT;IU:INACTIVITY UNASSIGNMENT;DD:REASSIGNED AFTER DATE OF DEATH REMOVED;PR:PATIENT RELOCATED;RP:REQUESTED BY PATIENT;NN:NO LONGER NEEDED;PC:PCP CHANGE;^0;15^Q
"^DD",404.42,404.42,.15,21,0)
^^1^1^3080313^
"^DD",404.42,404.42,.15,21,1,0)
Status reason patient unassigned from Team.
"^DD",404.42,404.42,.15,"DT")
3080313
"^DD",404.42,404.42,.16,0)
MULTIPLE PCP^S^0:NO;1:YES;^0;16^Q
"^DD",404.42,404.42,.16,3)
Will patient have a PCP at more than one facility?
"^DD",404.42,404.42,.16,21,0)
^^2^2^3080317^
"^DD",404.42,404.42,.16,21,1,0)
This flag indicates whether a patient may have additional Primary Care 
"^DD",404.42,404.42,.16,21,2,0)
Providers at other facilities.
"^DD",404.42,404.42,.16,"DT")
3080317
"BLD",6849,6)
^473
**END**
**END**
