Released SD*5.3*572 SEQ #478
Extracted from mail message
**KIDS**:SD*5.3*572^

**INSTALL NAME**
SD*5.3*572
"BLD",8621,0)
SD*5.3*572^SCHEDULING^0^3111017^y
"BLD",8621,1,0)
^^10^10^3110712^
"BLD",8621,1,1,0)
Patch fixes incorrect time that occasionally occurs when an appointment 
"BLD",8621,1,2,0)
is cancelled, also 'No Action Taken' appointments not appearing on the No 
"BLD",8621,1,3,0)
Show report (when requested).  Finally, patch fixes a few issues with the 
"BLD",8621,1,4,0)
Appointment List.  If one clinic is selected and availability has not 
"BLD",8621,1,5,0)
been set up for the selected date, the clinic name does not print in the 
"BLD",8621,1,6,0)
report header.  If all clinics or a list of clinics are selected, any 
"BLD",8621,1,7,0)
clinics not set up with availability for the selected date are ignored 
"BLD",8621,1,8,0)
and not included on the report.  Finally, by design, inactive clinics can 
"BLD",8621,1,9,0)
be selected for the report, but no indication is given to the user to let 
"BLD",8621,1,10,0)
them know a selected clinic is inactive.
"BLD",8621,4,0)
^9.64PA^^
"BLD",8621,6.3)
13
"BLD",8621,"ABPKG")
n
"BLD",8621,"KRN",0)
^9.67PA^779.2^20
"BLD",8621,"KRN",.4,0)
.4
"BLD",8621,"KRN",.401,0)
.401
"BLD",8621,"KRN",.402,0)
.402
"BLD",8621,"KRN",.403,0)
.403
"BLD",8621,"KRN",.5,0)
.5
"BLD",8621,"KRN",.84,0)
.84
"BLD",8621,"KRN",3.6,0)
3.6
"BLD",8621,"KRN",3.8,0)
3.8
"BLD",8621,"KRN",9.2,0)
9.2
"BLD",8621,"KRN",9.8,0)
9.8
"BLD",8621,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",8621,"KRN",9.8,"NM",1,0)
SDAL^^0^B31245513
"BLD",8621,"KRN",9.8,"NM",2,0)
SDAL0^^0^B36699440
"BLD",8621,"KRN",9.8,"NM",3,0)
SDCNP0^^0^B34578981
"BLD",8621,"KRN",9.8,"NM",4,0)
SDNOS0^^0^B28515965
"BLD",8621,"KRN",9.8,"NM","B","SDAL",1)

"BLD",8621,"KRN",9.8,"NM","B","SDAL0",2)

"BLD",8621,"KRN",9.8,"NM","B","SDCNP0",3)

"BLD",8621,"KRN",9.8,"NM","B","SDNOS0",4)

"BLD",8621,"KRN",19,0)
19
"BLD",8621,"KRN",19.1,0)
19.1
"BLD",8621,"KRN",101,0)
101
"BLD",8621,"KRN",409.61,0)
409.61
"BLD",8621,"KRN",771,0)
771
"BLD",8621,"KRN",779.2,0)
779.2
"BLD",8621,"KRN",870,0)
870
"BLD",8621,"KRN",8989.51,0)
8989.51
"BLD",8621,"KRN",8989.52,0)
8989.52
"BLD",8621,"KRN",8994,0)
8994
"BLD",8621,"KRN","B",.4,.4)

"BLD",8621,"KRN","B",.401,.401)

"BLD",8621,"KRN","B",.402,.402)

"BLD",8621,"KRN","B",.403,.403)

"BLD",8621,"KRN","B",.5,.5)

"BLD",8621,"KRN","B",.84,.84)

"BLD",8621,"KRN","B",3.6,3.6)

"BLD",8621,"KRN","B",3.8,3.8)

"BLD",8621,"KRN","B",9.2,9.2)

"BLD",8621,"KRN","B",9.8,9.8)

"BLD",8621,"KRN","B",19,19)

"BLD",8621,"KRN","B",19.1,19.1)

"BLD",8621,"KRN","B",101,101)

"BLD",8621,"KRN","B",409.61,409.61)

"BLD",8621,"KRN","B",771,771)

"BLD",8621,"KRN","B",779.2,779.2)

"BLD",8621,"KRN","B",870,870)

"BLD",8621,"KRN","B",8989.51,8989.51)

"BLD",8621,"KRN","B",8989.52,8989.52)

"BLD",8621,"KRN","B",8994,8994)

"BLD",8621,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8621,"QUES",0)
^9.62^^
"BLD",8621,"REQB",0)
^9.611^2^2
"BLD",8621,"REQB",1,0)
SD*5.3*491^2
"BLD",8621,"REQB",2,0)
SD*5.3*523^2
"BLD",8621,"REQB","B","SD*5.3*491",1)

"BLD",8621,"REQB","B","SD*5.3*523",2)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
572^3111017
"PKG",16,22,1,"PAH",1,1,0)
^^10^10^3111017
"PKG",16,22,1,"PAH",1,1,1,0)
Patch fixes incorrect time that occasionally occurs when an appointment 
"PKG",16,22,1,"PAH",1,1,2,0)
is cancelled, also 'No Action Taken' appointments not appearing on the No 
"PKG",16,22,1,"PAH",1,1,3,0)
Show report (when requested).  Finally, patch fixes a few issues with the 
"PKG",16,22,1,"PAH",1,1,4,0)
Appointment List.  If one clinic is selected and availability has not 
"PKG",16,22,1,"PAH",1,1,5,0)
been set up for the selected date, the clinic name does not print in the 
"PKG",16,22,1,"PAH",1,1,6,0)
report header.  If all clinics or a list of clinics are selected, any 
"PKG",16,22,1,"PAH",1,1,7,0)
clinics not set up with availability for the selected date are ignored 
"PKG",16,22,1,"PAH",1,1,8,0)
and not included on the report.  Finally, by design, inactive clinics can 
"PKG",16,22,1,"PAH",1,1,9,0)
be selected for the report, but no indication is given to the user to let 
"PKG",16,22,1,"PAH",1,1,10,0)
them know a selected clinic is inactive.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SDAL")
0^1^B31245513^B25084907
"RTN","SDAL",1,0)
SDAL ;ALB/GRR,MJK - APPOINTMENT LIST ; 29 Jun 99  04:11PM  ; Compiled August 20, 2007 14:24:59
"RTN","SDAL",2,0)
 ;;5.3;Scheduling;**37,46,106,171,177,80,266,491,572**;Aug 13, 1993;Build 13
"RTN","SDAL",3,0)
EN W ! S SDEND=1 D ASK2^SDDIV G:Y<0 END
"RTN","SDAL",4,0)
 W ! S VAUTNI=1 D NCOUNT^SDAL0 I SDCONC=U G END
"RTN","SDAL",5,0)
 W ! D NCLINIC^SDAL0 G:Y<0 END
"RTN","SDAL",6,0)
RD1 W ! N %DT K DIC("S") S %DT("A")="For date: ",%DT="AEX" D ^%DT
"RTN","SDAL",7,0)
 I (X["^")!(Y<0) K %,VAUTD,VAUTC,X,Y Q
"RTN","SDAL",8,0)
 S SDD=Y
"RTN","SDAL",9,0)
 N DIR S DIR(0)="Y",DIR("B")="NO"
"RTN","SDAL",10,0)
 S DIR("A")="Include Primary Care assignment information in the output"
"RTN","SDAL",11,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) K SDD,VAUTC,VAUTD,X,Y Q
"RTN","SDAL",12,0)
 W ! S SDPCMM=Y
"RTN","SDAL",13,0)
N K SDX,SDX1 R !,"Number of copies: 1// ",M:DTIME S:M="" M=1
"RTN","SDAL",14,0)
 I M["^" K M,SDD,VAUTC,VAUTD,X,Y Q
"RTN","SDAL",15,0)
 I (M'?.N)!((M'>0)!($L(M)>3)) W !,"ENTER A WHOLE NUMBER TO SELECT THE # OF COPIES OF THE APPOINTMENT LIST THAT ARE NEEDED- (1-999)" G N
"RTN","SDAL",16,0)
 S SDCOPY=M
"RTN","SDAL",17,0)
 ; -- specify device
"RTN","SDAL",18,0)
 W ! N %ZIS K IO("Q") S %ZIS="QMP" D ^%ZIS G END:POP
"RTN","SDAL",19,0)
 S SDBC=$$BARQ(+IOST(0),IOM) I SDBC="^" G END
"RTN","SDAL",20,0)
 I $D(IO("Q")) D QUE W:$D(ZTSK) "   (Task#: ",ZTSK,")" G END
"RTN","SDAL",21,0)
 ;
"RTN","SDAL",22,0)
START U IO N CNT,SDCLAR,SDCOUNT S (SDCOUNT,CNT)=0
"RTN","SDAL",23,0)
 ;SET UP A TEMP ARRAY -SDCLAR- WITH CLASSIFICATION ABBREVIATIONS
"RTN","SDAL",24,0)
 F  S CNT=$O(^SD(409.41,CNT)) Q:CNT'>0  D
"RTN","SDAL",25,0)
 .S SDCLAR(CNT)=$P(^SD(409.41,CNT,0),U,7)
"RTN","SDAL",26,0)
 S:'$D(DTIME) DTIME=300 I '$D(DT) D DT^SDUTL
"RTN","SDAL",27,0)
 S SDASH="",$P(SDASH,"_",IOM+1)="" S SDBC=+$G(SDBC),SDCOPY=$S($D(SDCOPY):+SDCOPY,$D(M):+M,1:1)
"RTN","SDAL",28,0)
 D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2)
"RTN","SDAL",29,0)
 I SDBC S SDBC=$S(IOM<120:0,1:$$BARC^SDAMU(+IOST(0),.SDBCON,.SDBCOFF))
"RTN","SDAL",30,0)
 S (SDEND,SD1,PCNT)=0,Y=DT D D^DIQ S SDNT=Y,Y=SDD,X=Y D D^DIQ S SDPD=Y D DW^%DTC S SDPD=X_" "_SDPD
"RTN","SDAL",31,0)
 ;if user has selected 'all' clinics, populate VAUTC with all uncancelled TYPE=C clinics from ^SC
"RTN","SDAL",32,0)
 I VAUTC=1 S SDIEN=0 F  S SDIEN=$O(^SC(SDIEN)) Q:+SDIEN=0  D
"RTN","SDAL",33,0)
 . I $P(^SC(SDIEN,0),"^",3)="C",$G(^SC(SDIEN,"ST",SDD,1))'["CANCELLED" D
"RTN","SDAL",34,0)
 .. S SDNAME=$P(^SC(SDIEN,0),"^",1) I $G(SDNAME)]"" S VAUTC(SDNAME)=SDIEN
"RTN","SDAL",35,0)
 ;-------------CALL TO SDAPI^SDAMA301 TO RETRIEVE APPT DATA------------------
"RTN","SDAL",36,0)
 K ^TMP($J,"SDAMA301") N SDARRAY,SDIEN,SDNAME,SDERR,SDCL,SDDFN,SDDT,SDRESULT
"RTN","SDAL",37,0)
 S SDARRAY(1)=SDD_";"_SDD,SDARRAY(3)="I;R;NT",SDARRAY("FLDS")="4;6;7;8;10;19;20;21"
"RTN","SDAL",38,0)
 ;if user has selected clinics, build clinic filter list
"RTN","SDAL",39,0)
 I VAUTC'=1 D  I $L(SDARRAY(2)) S SDARRAY(2)=$E(SDARRAY(2),1,$L(SDARRAY(2))-1) ;remove last ';' from end
"RTN","SDAL",40,0)
 . S SD="" F  S SD=$O(VAUTC(SD)) Q:SD']""  S SC=$G(VAUTC(SD)) I $G(SC)]"" S SDARRAY(2)=$G(SDARRAY(2))_SC_";"
"RTN","SDAL",41,0)
 ;call SDAPI to retrieve appointment data
"RTN","SDAL",42,0)
 S SDRESULT=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","SDAL",43,0)
 ;if error returned from SDAPI, display on report and quit
"RTN","SDAL",44,0)
 I SDRESULT<0 S SDERR=$$SDAPIERR^SDAMUTDT() I $L(SDERR) S SC=0 S SDPAGE=1 D HED W !!,SDERR,! D:$E(IOST,1,2)="C-" OUT^SDUTL D EXIT Q
"RTN","SDAL",45,0)
 ;if appts returned from SDAPI, sort output by clinic, appt d/t, patient
"RTN","SDAL",46,0)
 I SDRESULT>0 D
"RTN","SDAL",47,0)
 . S SDCL=0 F  S SDCL=$O(^TMP($J,"SDAMA301",SDCL)) Q:'SDCL  D
"RTN","SDAL",48,0)
 .. S SDDFN=0 F  S SDDFN=$O(^TMP($J,"SDAMA301",SDCL,SDDFN)) Q:'SDDFN  D
"RTN","SDAL",49,0)
 ... S SDDT=0 F  S SDDT=$O(^TMP($J,"SDAMA301",SDCL,SDDFN,SDDT)) Q:'SDDT  D
"RTN","SDAL",50,0)
 .... M ^TMP($J,"SDAMA301","S",SDCL,SDDT,SDDFN)=^TMP($J,"SDAMA301",SDCL,SDDFN,SDDT)
"RTN","SDAL",51,0)
 ;---------------------------------------------------------------------------
"RTN","SDAL",52,0)
LOOPA ;if no error returned from SDAPI, start looping through clinics in VAUTC (sorted by name)
"RTN","SDAL",53,0)
 I SDRESULT'<0 S SD=0 F  S SD=$O(VAUTC(SD)) Q:SD']""!SDEND  D CLIN
"RTN","SDAL",54,0)
 G:SDEND END
"RTN","SDAL",55,0)
OVER ;S PCNT=PCNT+1 I PCNT<SDCOPY,SDCOUNT S VAUTC=0 G LOOPA
"RTN","SDAL",56,0)
 S PCNT=PCNT+1 I PCNT<SDCOPY,SDCOUNT G LOOPA
"RTN","SDAL",57,0)
END I $G(SDCOUNT)="" G EXIT
"RTN","SDAL",58,0)
 I SDCOUNT=0 S SDPCT="No activity found for this date!" S SDPAGE=1,SC=0 D HED W !!?$L(SDPCT)\2,SDPCT,!
"RTN","SDAL",59,0)
 I $E(IOST,1,2)="C-" D:'$G(SDEND)&$G(SDCOUNT) OUT^SDUTL W @IOF
"RTN","SDAL",60,0)
EXIT K %,%H,%H,A,ALL,DFN,DIC,I,INC,K,M,PCNT,POP,PT,SC,SD,SD1,SDCC,SDCONC,SDCP,SDD,SDEM1,SDDIF,SDDIF1,SDEA,SDEC,SDEDT,SDEM,SDEND,SDFLG,SDFS,SDIN,SDNT
"RTN","SDAL",61,0)
 K DIRUT,SDCOPY,SDPAGE,SDPCT,SDPNOW,SDPT0,SDOI,SDPD,SDREV,SDT,SDX,SDXX,SDZ,VADAT,VADATE,VAUTC,VAUTNI,VAUTSTR,VAUTVB,VAUTD,VAQK,X,Y,Y1,Y2,Z
"RTN","SDAL",62,0)
 K SDBC,SDBCON,SDBCOFF,SDASH,SDPCMM,^TMP($J,"SDAMA301")
"RTN","SDAL",63,0)
 D CLOSE^DGUTQ Q
"RTN","SDAL",64,0)
 ;
"RTN","SDAL",65,0)
CLIN ;process each clinic IEN from VAUTC array
"RTN","SDAL",66,0)
 S (SDFLG,SC)=0 S SC=$G(VAUTC(SD)) I $G(SC)>0,$D(^SC(SC,0)) D LOOP^SDAL0
"RTN","SDAL",67,0)
 Q
"RTN","SDAL",68,0)
 ;
"RTN","SDAL",69,0)
BARQ(TTYPE,MARGIN) ;
"RTN","SDAL",70,0)
 N ON,OFF,Y
"RTN","SDAL",71,0)
 I MARGIN<120 S Y=0 G BARCQ
"RTN","SDAL",72,0)
 I '$$BARC^SDAMU(.TTYPE,.ON,.OFF) S Y=0 G BARCQ
"RTN","SDAL",73,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="SHOULD BARCODES BE PRINTED ON LIST(S)"
"RTN","SDAL",74,0)
 D ^DIR K DIR S:$D(DIRUT) Y="^"
"RTN","SDAL",75,0)
BARCQ Q Y
"RTN","SDAL",76,0)
 ;
"RTN","SDAL",77,0)
QUE ;Queue output
"RTN","SDAL",78,0)
 N ZTDESC,ZTSAVE,ZTRTN
"RTN","SDAL",79,0)
 K ZTSK,IO("Q")
"RTN","SDAL",80,0)
 S ZTDESC="Appointment Lists",ZTRTN="START^SDAL"
"RTN","SDAL",81,0)
 F X="VAUTD(","VAUTC(","SDCOPY","SDD","SDBC","VAUTD","VAUTC","SDCONC","SDPCMM" S ZTSAVE(X)=""
"RTN","SDAL",82,0)
 D ^%ZTLOAD
"RTN","SDAL",83,0)
 Q
"RTN","SDAL",84,0)
 ;
"RTN","SDAL",85,0)
STOP ;Check for stop task request
"RTN","SDAL",86,0)
 S:$D(ZTQUEUED) (SDEND,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SDAL",87,0)
 ;
"RTN","SDAL",88,0)
HED ;Print report header
"RTN","SDAL",89,0)
 I SD1,$E(IOST)="C" D OUT^SDUTL Q:SDEND
"RTN","SDAL",90,0)
 D STOP Q:SDEND
"RTN","SDAL",91,0)
 S SDCOUNT=SDCOUNT+1,SD1=1
"RTN","SDAL",92,0)
 W:SDCOUNT>1!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0)
"RTN","SDAL",93,0)
 W:SC "Appointments for ",$P(^SC(SC,0),"^",1)," clinic on ",SDPD
"RTN","SDAL",94,0)
 ;SD*572 added following naked reference logic
"RTN","SDAL",95,0)
 I 'SC D
"RTN","SDAL",96,0)
 .I VAUTC W "Appointments for ALL clinics for ",SDPD Q
"RTN","SDAL",97,0)
 .S CT=0,SNAM=""
"RTN","SDAL",98,0)
 .F  S SNAM=$O(VAUTC(SNAM)) Q:SNAM=""  S CT=CT+1,SC=$G(VAUTC(SNAM))
"RTN","SDAL",99,0)
 .I CT=1 W "Appointments for ",$P(^SC(SC,0),U,1)," clinic on ",SDPD D INACT
"RTN","SDAL",100,0)
 .I CT>1!(CT<1) W "Appointments for Selected clinics for ",SDPD
"RTN","SDAL",101,0)
 .K CT,SNAM,SC
"RTN","SDAL",102,0)
 W !,"Date printed: ",SDPNOW,?(IOM-6-$L(SDPAGE)),"Page: ",SDPAGE,!
"RTN","SDAL",103,0)
 W !," Appt.",?11,"Patient Name",?44,"SSN",?53,"Lab",?62,"X-Ray",?73,"EKG"
"RTN","SDAL",104,0)
 W !," Time",?53,"Time",?62,"Time",?73,"Time",!,?15,"Other Information",?40,"Ward Location",!,?41,"Room-Bed"
"RTN","SDAL",105,0)
 W !,SDASH S SDPAGE=SDPAGE+1
"RTN","SDAL",106,0)
 D:SDBC PAINT(SC,SDD)
"RTN","SDAL",107,0)
 Q
"RTN","SDAL",108,0)
 ;
"RTN","SDAL",109,0)
PAINT(CLINIC,DATE) ; -- paint header barcodes
"RTN","SDAL",110,0)
 ; input:  CLINIC := clinic ifn
"RTN","SDAL",111,0)
 ;           DATE := appt date only
"RTN","SDAL",112,0)
 ;
"RTN","SDAL",113,0)
 W !?10,"Date",?45,"Clinic#",?85,"No",?110,"Yes",!
"RTN","SDAL",114,0)
 D BARC(10,$E(DATE,4,7)_$E(DATE,2,3))
"RTN","SDAL",115,0)
 D BARC(45,"%"_CLINIC_"$")
"RTN","SDAL",116,0)
 D BARC(85,"N"),BARC(110,"Y")
"RTN","SDAL",117,0)
 W !!!!,SDASH
"RTN","SDAL",118,0)
 Q
"RTN","SDAL",119,0)
 ;
"RTN","SDAL",120,0)
BARC(TAB,X) ; --print barcode
"RTN","SDAL",121,0)
 ; input: TAB := tab position
"RTN","SDAL",122,0)
 ;          X := string to print
"RTN","SDAL",123,0)
 ;
"RTN","SDAL",124,0)
 W *13,?TAB W @SDBCON,X,@SDBCOFF
"RTN","SDAL",125,0)
 Q
"RTN","SDAL",126,0)
 ;
"RTN","SDAL",127,0)
INACT ;SD*572 if single clinic selected check if inactive on selected date
"RTN","SDAL",128,0)
 I $D(^SC(SC,"I")) I SDD=$P($G(^("I")),U,1)!(SDD>$P($G(^("I")),U,1)),'$P($G(^("I")),U,2) S SDPCT="Clinic Inactive on this date!" Q
"RTN","SDAL",129,0)
 I $D(^SC(SC,"I")) I SDD=$P($G(^("I")),U,1)!(SDD>$P($G(^("I")),U,1))&(SDD<$P($G(^("I")),U,2)) S SDPCT="Clinic Inactive on this date!" Q
"RTN","SDAL",130,0)
 S SDPCT="No Clinic Availability on this date!"
"RTN","SDAL",131,0)
 Q
"RTN","SDAL",132,0)
 ;
"RTN","SDAL0")
0^2^B36699440^B40643176
"RTN","SDAL0",1,0)
SDAL0 ;ALB/GRR,TMP,MJK - APPOINTMENT LIST (CONTINUED FROM SDAL) ; 29 Jun 99  04:11PM
"RTN","SDAL0",2,0)
 ;;5.3;Scheduling;**28,37,106,149,171,177,193,305,373,266,572**;Aug 13, 1993;Build 13
"RTN","SDAL0",3,0)
LOOP I 'VAUTC,$G(^SC(SC,"ST",SDD,1))["CANCELLED"  D  Q
"RTN","SDAL0",4,0)
 .S SDPAGE=1 D HED^SDAL
"RTN","SDAL0",5,0)
 .S SDPCT="Clinic cancelled for this date!"
"RTN","SDAL0",6,0)
 .W !!?(IOM-$L(SDPCT)\2),SDPCT
"RTN","SDAL0",7,0)
 I $$CHECK(),$$NCHECK(),$$ACTIVE() D
"RTN","SDAL0",8,0)
 .S SDPAGE=1 D HED^SDAL Q:SDEND  S SDPCT=0,SDFLG=1   ;SD*572 set flag
"RTN","SDAL0",9,0)
 .;loop through sorted appointment data for the clinic
"RTN","SDAL0",10,0)
 .N SDT,SDDFN,SDDATA,SDDATAC S SDT="" F  S SDT=$O(^TMP($J,"SDAMA301","S",SC,SDT)) Q:'SDT  D
"RTN","SDAL0",11,0)
 ..S SDDFN="" F  S SDDFN=$O(^TMP($J,"SDAMA301","S",SC,SDT,SDDFN)) Q:'SDDFN!SDEND  D
"RTN","SDAL0",12,0)
 ...;store appt data and comments for later reference
"RTN","SDAL0",13,0)
 ...S SDDATA=$G(^TMP($J,"SDAMA301","S",SC,SDT,SDDFN)),SDDATAC=$G(^(SDDFN,"C"))
"RTN","SDAL0",14,0)
 ...D MORE
"RTN","SDAL0",15,0)
 .W ! D CCLK Q:SDEND
"RTN","SDAL0",16,0)
 .I 'SDPCT S SDPCT="No activity found for this clinic date!" W !!?(IOM-$L(SDPCT)\2),SDPCT
"RTN","SDAL0",17,0)
 S SDPAGE=1 Q
"RTN","SDAL0",18,0)
 ;
"RTN","SDAL0",19,0)
PTL N SDAPPT
"RTN","SDAL0",20,0)
 S DFN=+$P(SDDATA,"^",4),SDOI=$G(SDDATAC)
"RTN","SDAL0",21,0)
 S SDAPPT=""
"RTN","SDAL0",22,0)
 D ^VAUQWK,GETA
"RTN","SDAL0",23,0)
 I ($Y+7>IOSL) D HED^SDAL Q:SDEND
"RTN","SDAL0",24,0)
 I '$D(SDFS) S SDFS=1,X=PT D TM^SDROUT0 W !,$J(X,8)
"RTN","SDAL0",25,0)
 N SDCLY D CL^SDCO21(DFN,SDT,"",.SDCLY)
"RTN","SDAL0",26,0)
 N SDY S SDY=$Y
"RTN","SDAL0",27,0)
 W ! D:SDBC BARC^SDAL(85,$P(VAQK(2),"^"))
"RTN","SDAL0",28,0)
 ;check for Combat Vet
"RTN","SDAL0",29,0)
 N SDCV
"RTN","SDAL0",30,0)
 S SDCV=$$CVEDT^DGCV(DFN,$G(SDD))
"RTN","SDAL0",31,0)
 S SDCV=$P(SDCV,U,3)
"RTN","SDAL0",32,0)
 W !?3,$S($G(SDCV)=1:"(CV)",1:""),?9,$S($P(SDDATA,"^",7)="Y":"*",1:""),?10,$S(VAQK(1)]"":VAQK(1),1:"UNKNOWN PATIENT"),?41,$S(VAQK(2)]"":$E(VAQK(2),1,9),1:"")
"RTN","SDAL0",33,0)
 S INC=0 F SDZ=3,4,5 S X=SDZ(SDZ) D:X]"" TM^SDROUT0 S INC=SDZ#3*8+3 W ?48+INC,$J(X,8) W:INC<16 "  "
"RTN","SDAL0",34,0)
 I VAQK(12)]"" W !,?41,VAQK(12) W:VAQK(13)]"" !,?41,VAQK(13)
"RTN","SDAL0",35,0)
 W:SDOI]"" !,?15,SDOI W:SDEM]"" !,?15,SDEM,$S($D(SDCP):$P(^SC(SDCP,0),"^"),1:$P(^SC(SC,0),"^")),!,?15,SDEM1
"RTN","SDAL0",36,0)
 W !,?10,"Phone #: ",$P($G(^DPT(DFN,.13)),"^",1) ;Phone Number [Residence]
"RTN","SDAL0",37,0)
 S SDX="" F I=7:1:9 I VAQK(I) S SDX=1 Q
"RTN","SDAL0",38,0)
 ;Primary Care information
"RTN","SDAL0",39,0)
 I +$G(SDPCMM) D TDATA^SDPPTEM(DFN,"",SDD,"P",15)
"RTN","SDAL0",40,0)
 ;; GAF SCORE CHECK
"RTN","SDAL0",41,0)
 N SDGAF,SDGAFST
"RTN","SDAL0",42,0)
 ;use Appt Type here since COLLATERAL VISIT field not supported by encapsulation API
"RTN","SDAL0",43,0)
 I $$MHCLIN^SDUTL2(SC),'($$COLLAT^SDUTL2(+VAQK(6))!$P($P(SDDATA,"^",10),";",2)["COLLATERAL OF VET") D
"RTN","SDAL0",44,0)
 . S SDGAF=$$NEWGAF^SDUTL2(DFN),SDGAFST=$P(SDGAF,"^")
"RTN","SDAL0",45,0)
 . W:SDGAFST !,?15,"** New GAF Score Required **"
"RTN","SDAL0",46,0)
 ;;
"RTN","SDAL0",47,0)
 I $O(SDCLY(0))  D
"RTN","SDAL0",48,0)
 .N PCL
"RTN","SDAL0",49,0)
 .S PCL=0
"RTN","SDAL0",50,0)
 .W !,?15,"** Required for facility workload credit => "
"RTN","SDAL0",51,0)
 .F  S PCL=$O(SDCLY(PCL)) Q:'PCL  D
"RTN","SDAL0",52,0)
 ..  W " ",SDCLAR(PCL)," "
"RTN","SDAL0",53,0)
 ..  I (SDCLAR(PCL)="SC")&($G(^DPT(DFN,0))]"") D
"RTN","SDAL0",54,0)
 ...  K SDELAR
"RTN","SDAL0",55,0)
 ...  S VAROOT="SDELAR"
"RTN","SDAL0",56,0)
 ...  D ELIG^VADPT
"RTN","SDAL0",57,0)
 ...  Q:'$P($G(SDELAR(3)),"^")
"RTN","SDAL0",58,0)
 ...  W $P(SDELAR(3),"^",2),"% "
"RTN","SDAL0",59,0)
 ...  K SDELAR,VAROOT
"RTN","SDAL0",60,0)
 .W "**"
"RTN","SDAL0",61,0)
 I $P(VAQK(11),"^",2)]"" W !,?15,"Means Test: ** ",$P(VAQK(11),"^",2)," **" W "   Last Test: ",$$FDATE^SDUL1($P($$LST^DGMTU(DFN),U,2))
"RTN","SDAL0",62,0)
 S SDCOPS=$$LST^DGMTU(DFN,DT,2) I +SDCOPS W !,?15,"Co-Pay Status: ","**"_$P(SDCOPS,U,3)_"**"," Last Test: ",$$FDATE^SDUL1($P(SDCOPS,U,2)) K SDCOPS
"RTN","SDAL0",63,0)
 I $D(^DIC(8,+VAQK(6),0)),$P(^(0),U,9)=13 W !,?15,"** COLLATERAL **" G Q
"RTN","SDAL0",64,0)
 I +$P(SDDATA,"^",8)]"" D  I V W !,?15,"** COLLATERAL **" G Q
"RTN","SDAL0",65,0)
 .S V=+$P(SDDATA,"^",8),V=$S($D(^DIC(8,+V,0)):$P(^(0),"^",9)=13,1:0)
"RTN","SDAL0",66,0)
 ;use Appt Type here since COLLATERAL VISIT field not supported by encapsulation API
"RTN","SDAL0",67,0)
 I $P($P(SDDATA,"^",10),";",2)["COLLATERAL OF VET" W !,?15,"** COLLATERAL VISIT **"
"RTN","SDAL0",68,0)
 I +$P($G(SDDATA),"^",8)=0 S V=0
"RTN","SDAL0",69,0)
Q I SDBC,(SDY+5)>$Y F I=1:1 Q:(SDY+5)'>$Y  W !
"RTN","SDAL0",70,0)
 I SDBC W !?9,$E(SDASH,9,255)
"RTN","SDAL0",71,0)
 S SDPCT=SDPCT+1 K V,SDX,SDMT,VAQK Q
"RTN","SDAL0",72,0)
 ;
"RTN","SDAL0",73,0)
GETA K SDCP S SDZ(3)=$P($G(SDDATA),"^",21),SDZ(4)=$P($G(SDDATA),"^",20),SDZ(5)=$P($G(SDDATA),"^",19)
"RTN","SDAL0",74,0)
 S SDEM="",SDEC=+VAQK(6) Q:'SDEC
"RTN","SDAL0",75,0)
 S SDXX=$S('$D(^DIC(8,SDEC,0)):1,$P(^(0),"^",5)'="Y":1,$P(^(0),"^",4)=4:0,$P(^(0),"^",4)=5:0,1:1) Q:SDXX
"RTN","SDAL0",76,0)
 I $D(^SC(SC,"SL")),$P(^("SL"),U,5)]"",$D(^SC($P(^("SL"),U,5),0)) S SDCP=$P(^SC(SC,"SL"),U,5)
"RTN","SDAL0",77,0)
 S SDCP=$S($D(SDCP):SDCP,1:SC) I $D(^DPT(DFN,"DE","B",SDCP)),VAQK(12)']"" S SDEA=$O(^DPT(DFN,"DE","B",SDCP,0)) I $D(^DPT(DFN,"DE",+SDEA,0)),$P(^(0),"^",2)']"",$O(^(1,0))'="" D CKCED
"RTN","SDAL0",78,0)
 Q
"RTN","SDAL0",79,0)
 ;
"RTN","SDAL0",80,0)
MORE K SDFS S PT=SDT D PTL
"RTN","SDAL0",81,0)
 Q
"RTN","SDAL0",82,0)
 ;
"RTN","SDAL0",83,0)
CCLK S SDCC=0 F  S SDCC=$O(^SC(SC,"C",SDD,1,SDCC)) Q:'SDCC!SDEND  S SDPT0=$G(^DPT(+^(SDCC,0),0)) I $L(SDPT0) D
"RTN","SDAL0",84,0)
 .I ($Y+4>IOSL) D HED^SDAL Q:SDEND  W !
"RTN","SDAL0",85,0)
 .W !,"CHART REQUEST: ",$P(SDPT0,"^",1),?34,$P(SDPT0,"^",9)
"RTN","SDAL0",86,0)
 Q
"RTN","SDAL0",87,0)
 ;
"RTN","SDAL0",88,0)
CKCED S A=0 F  S A=$O(^DPT(DFN,"DE",SDEA,1,A)) Q:'A  I $P(^DPT(DFN,"DE",SDEA,1,A,0),"^",3)']"" D ENR Q
"RTN","SDAL0",89,0)
 Q
"RTN","SDAL0",90,0)
 ;
"RTN","SDAL0",91,0)
ENR S SDEDT=$P(^(0),"^",1)\1,SDDIF=DT-SDEDT,SDREV=$P(^(0),"^",5),SDDIF1=$S(SDREV:DT-SDREV,1:"") ;NAKED REFERENCE - ^DPT(DFN,"DE",SDEA,1,A,0)
"RTN","SDAL0",92,0)
 I $P(^DPT(DFN,"DE",SDEA,1,A,0),"^",2)="O",$S(SDDIF1']""&(SDDIF>10000):1,SDDIF1>10000:1,1:0) S SDEM="PATIENT HAS BEEN ENROLLED IN ",SDEM1="FOR MORE THAN 1 YEAR, PLEASE RE-EVALUATE"
"RTN","SDAL0",93,0)
 Q
"RTN","SDAL0",94,0)
 ;
"RTN","SDAL0",95,0)
CHECK() I $D(^SC(SC,0)),$P(^(0),"^",3)="C",$S(VAUTD:1,$D(VAUTD(+$P(^(0),"^",15))):1,'$P(^(0),"^",15)&$D(VAUTD(+$O(^DG(40.8,0)))):1,1:0)
"RTN","SDAL0",96,0)
 I $T,$D(^SC(SC,"ST",SDD,1)),^(1)'["**CANCELLED",$S('$D(^SC(SC,"I")):1,+^("I")'>0:1,+^("I")>SDD:1,+^("I")'>SDD&(+$P(^("I"),"^",2)>SDD!(+$P(^("I"),"^",2)=0)):0,1:1) Q 1
"RTN","SDAL0",97,0)
 Q 0
"RTN","SDAL0",98,0)
 ;
"RTN","SDAL0",99,0)
NCOUNT ;COUNT, NON-COUNT, or BOTH FOR CLINIC SELECTION
"RTN","SDAL0",100,0)
 W !,"Count, Non Count, or Both: C//" R SDCONC:DTIME
"RTN","SDAL0",101,0)
 I '$T!(SDCONC="") S SDCONC="C" Q
"RTN","SDAL0",102,0)
 Q:SDCONC=U
"RTN","SDAL0",103,0)
 I $L(SDCONC)=1,$E(SDCONC)="?" W !,"Type C, N or B" G NCOUNT
"RTN","SDAL0",104,0)
 I $E(SDCONC,1,2)="??" D  G NCOUNT
"RTN","SDAL0",105,0)
 . W !!,"Choosing ""C"" will limit the selection to COUNT clinics."
"RTN","SDAL0",106,0)
 . W !,"         ""N"" will limit the selection to NON COUNT clinics."
"RTN","SDAL0",107,0)
 . W !,"         ""B"" will give BOTH count and non count clinics.",!
"RTN","SDAL0",108,0)
 S SDCONC=$E(SDCONC),SDCONC=$TR(SDCONC,"bcn","BCN")
"RTN","SDAL0",109,0)
 I "BCN"'[SDCONC W !,"C, N or B" G NCOUNT
"RTN","SDAL0",110,0)
 Q
"RTN","SDAL0",111,0)
 ;
"RTN","SDAL0",112,0)
NCHECK() ;EXTEND $T LOGIC COUNT, NO COUNT,or BOTH  
"RTN","SDAL0",113,0)
 N NOC S NOC=$P($G(^SC(SC,0)),U,17)
"RTN","SDAL0",114,0)
 I SDCONC="B" Q 1
"RTN","SDAL0",115,0)
 I SDCONC="C"&(NOC="N") Q 1
"RTN","SDAL0",116,0)
 I SDCONC="N"&(NOC="Y") Q 1
"RTN","SDAL0",117,0)
 Q 0
"RTN","SDAL0",118,0)
 ;
"RTN","SDAL0",119,0)
NCLINIC ;SCREEN CLINICS
"RTN","SDAL0",120,0)
 N NOCC
"RTN","SDAL0",121,0)
 I SDCONC="B" S NOCC="&1"
"RTN","SDAL0",122,0)
 I SDCONC="N" S NOCC="&($P(^(0),U,17)=""Y"")"
"RTN","SDAL0",123,0)
 I SDCONC="C" S NOCC="&($P(^(0),U,17)=""N"")"
"RTN","SDAL0",124,0)
 S DIC="^SC(",DIC("S")="I $P(^(0),U,3)=""C""&'$G(^(""OOS""))"_NOCC_"&$S(VAUTD:1,$D(VAUTD(+$P(^(0),U,15))):1,'+$P(^(0),U,15)&$D(VAUTD(+$O(^DG(40.8,0)))):1,1:0)",VAUTSTR="clinic",VAUTVB="VAUTC" G FIRST^VAUTOMA
"RTN","SDAL0",125,0)
 ;
"RTN","SDAL0",126,0)
ACTIVE() ;Determine if clinic has activity to print
"RTN","SDAL0",127,0)
 ;Output: '1' if activity or selected clinic, '0' otherwise
"RTN","SDAL0",128,0)
 Q:'VAUTC 1  ;selected clinics
"RTN","SDAL0",129,0)
 Q:$O(^SC(SC,"C",SDD,1,0)) 1  ;chart request list
"RTN","SDAL0",130,0)
 ;if clinic has no appts, return 0
"RTN","SDAL0",131,0)
 S SDX=1 I '$D(^TMP($J,"SDAMA301",SC)) S SDX=0
"RTN","SDAL0",132,0)
 Q SDX
"RTN","SDCNP0")
0^3^B34578981^B34170117
"RTN","SDCNP0",1,0)
SDCNP0 ;ALB/LDB - CANCEL APPT. FOR A PATIENT ; 3/2/05 3:13pm
"RTN","SDCNP0",2,0)
 ;;5.3;Scheduling;**132,167,478,517,572**;Aug 13, 1993;Build 13
"RTN","SDCNP0",3,0)
EN2 D WAIT^DICD S NDT=HDT/1,L=0 F J=1:1 S NDT=$O(^DPT(DFN,"S",NDT)) Q:NDT'>0!(SDPV&(NDT'<SDTM))  S SD0=^(NDT,0) I $P(SD0,"^",2)'["C" S SC=+SD0,L=L\1+1,APL="" D FLEN^SDCNP1A S ^UTILITY($J,"SDCNP",L)=NDT_"^"_SC_"^"_COV_"^"_APL_"^^"_APL D CHKSO
"RTN","SDCNP0",4,0)
WH1 G:L'>0 NO S (SDCTRL,SDCTR)=0,APP="" N SDITEM W:'SDERR @IOF
"RTN","SDCNP0",5,0)
 W ! F Z=0:0 S Z=$O(^UTILITY($J,"SDCNP",Z)) Q:Z'>0  S SDITEM=$J($S(Z\1=Z:"("_$J(Z,2)_") ",1:""),5) D  Q:SDCTRL
"RTN","SDCNP0",6,0)
 .I SDITEM["(" W !,SDITEM S HLDCSND=""
"RTN","SDCNP0",7,0)
 .I SDITEM'["(" W SDITEM
"RTN","SDCNP0",8,0)
 .S AT=$S($P(^(Z),"^",2)'?.N:1,1:0),Y=$P($P(^(Z),"^"),".") D DT^SDM0 S X=$P(^(Z),"^"),^(Z,"CNT")="" X ^DD("FUNC",2,1) W " ",$J(X,8) D MORE W:AT ! Q:SDCTRL
"RTN","SDCNP0",9,0)
 S:SDERR SDCTRL=1 I Z>0 G:SDCTRL&(APP']"") NOPE^SDCNP1 G:SDCTRL DEL
"RTN","SDCNP0",10,0)
 D WH G NOPE^SDCNP1:APP']"",DEL
"RTN","SDCNP0",11,0)
WH W !!,"SELECT APPOINTMENTS TO BE CANCELLED" W:Z>0 " OR HIT RETURN TO CONTINUE DISPLAY" R ": ",APP:DTIME I '$T!(APP="^") S SDCTRL=1,APP="" Q
"RTN","SDCNP0",12,0)
 S SDMSG="W !,""Enter appt. numbers separated by commas and/or a range separated"",!,""by dashes (ie 2,4,6-9)"" H 2" I APP["?" X SDMSG G WH
"RTN","SDCNP0",13,0)
 S SDCTRL=$S(APP']"":0,1:1) Q
"RTN","SDCNP0",14,0)
DEL S SDERR=0 F J=1:1 S SDDH=$P(APP,",",J) Q:SDDH']""  D MTCH^SDCNP1
"RTN","SDCNP0",15,0)
 G:SDERR WH1
"RTN","SDCNP0",16,0)
DEL1 F J=1:1 S SDDH=$P(APP,",",J) Q:SDDH']""  S SDDI=$P(SDDH,"-"),SDDM=$P(SDDH,"-",2) D CKK^SDCNP1A Q:SDERR  D CKK1^SDCNP1A Q:SDERR  Q:'SDDI  F A1=SDDI:1:$S(SDDM:SDDM,1:SDDI) D BEGD
"RTN","SDCNP0",17,0)
 G:SDERR WH1 G NOPE^SDCNP1
"RTN","SDCNP0",18,0)
BEGD S (SD,S)=$P(^UTILITY($J,"SDCNP",A1),"^",1),I=$P(^UTILITY($J,"SDCNP",A1),"^",2)
"RTN","SDCNP0",19,0)
 S SL=^SC(I,"SL"),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),SB=STARTDAY-1/100,X=$P(SL,U,6),HSI=$S(X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4),STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2) K Y
"RTN","SDCNP0",20,0)
 I $$CODT^SDCOU(DFN,+^UTILITY($J,"SDCNP",A1),+$P(^(A1),U,2)) W !,*7,">>> Appointment #",A1," has a check out date and cannot be cancelled." Q
"RTN","SDCNP0",21,0)
 D PROT^SDCNP1A Q:SDPRT=1  D CAN S $P(^UTILITY($J,"SDCNP",A1),"^",4)="*** JUST CANCELLED ***" Q
"RTN","SDCNP0",22,0)
CAN Q:$P(^UTILITY($J,"SDCNP",A1),"^",4)["JUST CANCELLED"  S CNT=CNT+1,DIV=$S($P(^SC(I,0),"^",15)]"":" "_$P(^(0),"^",15),1:" 1") I $D(^DPT("ASDPSD","C",DIV,I,S,DFN)) K ^(DFN)
"RTN","SDCNP0",23,0)
 N SDATA,SDCPHDL S SDCPHDL=$$HANDLE^SDAMEVT(1) D BEFORE^SDAMEVT(.SDATA,DFN,S,I,"",SDCPHDL)
"RTN","SDCNP0",24,0)
 S:'$D(^DPT(DFN,"S",0)) ^(0)="^2.98P^^" I $D(SDREM) S DIE="^DPT("_DFN_",""S"",",(DA,Y)=S,DA(1)=DFN,DR="17///^S X="_"""""_SDREM_""""" D ^DIE K DIE,DR
"RTN","SDCNP0",25,0)
 S ^DPT("ASDCN",I,DA,DA(1))=$S(SDWH["P":1,1:"") K DA
"RTN","SDCNP0",26,0)
 S $P(^DPT(DFN,"S",S,0),"^",2)=SDWH S:$D(DUZ) $P(^(0),"^",12)=DUZ D NOW^%DTC S SDT=$J(%,4,2),$P(^(0),"^",14)=SDT,$P(^(0),"^",15)=SDSCR,(DA,Y)=0 F X=0:0 S X=+$O(^SC(I,"S",S,1,X)) Q:'$D(^(X,0))  D C Q:Y&(DA)   ;SD*572 fixed $J func
"RTN","SDCNP0",27,0)
 I $D(^DPT("ASDPSD","B",DIV,S\1,DFN)) D CK1
"RTN","SDCNP0",28,0)
 Q:'Y  S SL=$P(^SC(I,"S",S,1,Y,0),U,2) I DA,'$D(^("OB")) K ^SC(I,"S",S,1,DA,"OB")
"RTN","SDCNP0",29,0)
 S SDDA=DA,SDTTM=S,SDRT="D",SDPL=Y,SDSC=I D RT^SDUTL D CANCEL^SDCNSLT S Y=SDPL,S=SDTTM,I=SDSC,DA=SDDA K SDDA ;SD/478
"RTN","SDCNP0",30,0)
 S SDNODE=^SC(I,"S",S,1,Y,0),^SC("ARAD",I,S,DFN)="N",TLNK=$P($G(^SC(I,"S",S,1,Y,"CONS")),U) K ^SC(I,"S",S,1,Y) K:$O(^SC(I,"S",S,0))'>0 ^SC(I,"S",S,0) D CLRK^SDCNP1  ;SD/478
"RTN","SDCNP0",31,0)
 K:TLNK'="" ^SC("AWAS1",TLNK),TLNK ;SD/478
"RTN","SDCNP0",32,0)
 ;S SDNODE=^SC(I,"S",S,1,Y,0),^SC("ARAD",I,S,DFN)="N" S DA(2)=I,DA(1)=S,DA=Y,DIK="^SC("_DA(2)_",""S"","_DA(1)_",1," D ^DIK K:$O(^SC(I,"S",S,0))'>0 ^SC(I,"S",S,0) D CLRK^SDCNP1 ;SD/478
"RTN","SDCNP0",33,0)
 D EVT
"RTN","SDCNP0",34,0)
 Q:'$D(^SC(I,"ST",SD\1,1))
"RTN","SDCNP0",35,0)
EN01 S S=^SC(I,"ST",SD\1,1),Y=SD#1-SB*100,ST=Y#1*SI\.6+(Y\1*SI),SS=SL*HSI/60
"RTN","SDCNP0",36,0)
 I Y'<1 F I=ST+ST:SDDIF S Y=$E(STR,$F(STR,$E(S,I+1))) Q:Y=""  S S=$E(S,1,I)_Y_$E(S,I+2,999),SS=SS-1 Q:SS'>0
"RTN","SDCNP0",37,0)
 S ^(1)=S Q  ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDCNP0",38,0)
C I +^SC(I,"S",S,1,X,0)=DFN S Y=X Q
"RTN","SDCNP0",39,0)
 Q:'$D(^("OB"))!DA  S:^("OB")?1"O".E DA=X Q
"RTN","SDCNP0",40,0)
NO W !,"NO ",$S('SDPV:"PENDING",1:"PREVIOUS")," APPOINTMENTS",*7,*7,*7
"RTN","SDCNP0",41,0)
 D END^SDCNP G RD^SDCNP
"RTN","SDCNP0",42,0)
 Q
"RTN","SDCNP0",43,0)
CHKSO S COV=$S($P(^DPT(DFN,"S",NDT,0),"^",11)=1:" (COLLATERAL) ",1:"") F SDJ=3,4,5 I $P(^DPT(DFN,"S",NDT,0),"^",SDJ)]"" S L=L+.1,^UTILITY($J,"SDCNP",L)=$P(^(0),"^",SDJ)_"^"_$S(SDJ=3:"LAB",SDJ=4:"XRAY",1:"EKG")_"^0^0"
"RTN","SDCNP0",44,0)
 Q
"RTN","SDCNP0",45,0)
MORE S SDCTR=SDCTR+2 I AT W ?41,$P(^UTILITY($J,"SDCNP",Z),"^",2) G OVR
"RTN","SDCNP0",46,0)
 W " ",$S($P(^UTILITY($J,"SDCNP",Z),"^",4)?.N:"("_$P(^(Z),"^",4)_" MIN) ",1:$P(^(Z),"^",4))," ",$S($D(^SC($P(^(Z),"^",2),0)):$P(^(0),"^",1),1:"DELETED CLINIC"),$P(^UTILITY($J,"SDCNP",Z),"^",3) ;SD/478
"RTN","SDCNP0",47,0)
 N CSND,CSDT,CSSD,CONSULT,Y
"RTN","SDCNP0",48,0)
 S CSND=^UTILITY($J,"SDCNP",Z),CSDT=$P(CSND,U),CSSD=$P(CSND,U,2),HLDCSND=CSND S CONSULT=$$CONSULT(CSSD,CSDT) I +$G(CONSULT) S Y=$P(^GMR(123,CONSULT,0),U) D DD^%DT W !?5,"CONSULT ",Y,"/ ",CONSULT
"RTN","SDCNP0",49,0)
 D STATUS($X>55)
"RTN","SDCNP0",50,0)
OVR ;Following code added SD/517
"RTN","SDCNP0",51,0)
 I '$D(CSND) I $G(HLDCSND) I (($P(HLDCSND,U,4)="")!($P(HLDCSND,U,6)="")) D
"RTN","SDCNP0",52,0)
 .W !!,"**********************************************************************"
"RTN","SDCNP0",53,0)
 .W !,"* WARNING: There is a data inconsistency or data corruption problem  *"
"RTN","SDCNP0",54,0)
 .W !,"* with the above appointment.  Corrective action needs to be taken.  *"
"RTN","SDCNP0",55,0)
 .W !,"* Please cancel the appointment above.  If it is a valid appointment,*"
"RTN","SDCNP0",56,0)
 .W !,"* it will have to be re-entered via Appointment Management.          *"
"RTN","SDCNP0",57,0)
 .W !,"**********************************************************************"
"RTN","SDCNP0",58,0)
 .S SDCTR=21
"RTN","SDCNP0",59,0)
 .K HLDCSND
"RTN","SDCNP0",60,0)
 ;
"RTN","SDCNP0",61,0)
 I SDCTR>20,$O(^UTILITY($J,"SDCNP",Z)) S (SDCTRL,SDCTR)=0 W *7 D WH W:'SDCTRL @IOF
"RTN","SDCNP0",62,0)
 Q
"RTN","SDCNP0",63,0)
 ;
"RTN","SDCNP0",64,0)
CONSULT(CSSD,CSDT) ;
"RTN","SDCNP0",65,0)
 N CSI S CONSULT=""
"RTN","SDCNP0",66,0)
 S CSI=0 F  S CSI=$O(^SC(CSSD,"S",CSDT,1,CSI)) Q:'+CSI  I $P($G(^SC(CSSD,"S",CSDT,1,CSI,0)),U)=DFN S CONSULT=$P($G(^SC(CSSD,"S",CSDT,1,CSI,"CONS")),U) Q  ;SD/478
"RTN","SDCNP0",67,0)
 Q CONSULT
"RTN","SDCNP0",68,0)
CK1 S SDX=0 F SD1=S\1:0 S SD1=$O(^DPT(DFN,"S",SD1)) Q:'SD1!((SD1\1)'=(S\1))  I $P(^(SD1,0),"^",2)'["C",$P(^(0),"^",2)'["N" S SDX=1 Q
"RTN","SDCNP0",69,0)
 Q:SDX  F SD1=2,4 I $D(^SC("AAS",SD1,S\1,DFN)) S SDX=1 Q
"RTN","SDCNP0",70,0)
 Q:SDX  IF $D(^SCE(+$$EXAE^SDOE(DFN,S\1,S\1),0)) S SDX=1
"RTN","SDCNP0",71,0)
 Q:SDX  K ^DPT("ASDPSD","B",DIV,S\1,DFN) Q
"RTN","SDCNP0",72,0)
 ;
"RTN","SDCNP0",73,0)
STATUS(LF) ;
"RTN","SDCNP0",74,0)
 W:LF !
"RTN","SDCNP0",75,0)
 W ?55,"(",$E($$LOWER^VALM1($P($$STATUS^SDAM1(DFN,+^UTILITY($J,"SDCNP",Z),+$P(^(Z),U,2),$G(^DPT(DFN,"S",+^(Z),0))),";",3)),1,23),")"
"RTN","SDCNP0",76,0)
 W:'LF !
"RTN","SDCNP0",77,0)
 Q
"RTN","SDCNP0",78,0)
 ;
"RTN","SDCNP0",79,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDCNP0",80,0)
 N I,STR,SS,SL,SD,SB,SI,HSI,J,APP,S,A1,STARTDAY,CNT,DIV,SDERR,SDDIF
"RTN","SDCNP0",81,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SDTTM,SDSC,SDPL,0,SDCPHDL)
"RTN","SDCNP0",82,0)
 Q
"RTN","SDNOS0")
0^4^B28515965^B28179889
"RTN","SDNOS0",1,0)
SDNOS0 ;ALB/LDB - NO SHOW REPORT ; 07 May 99 10:21 AM
"RTN","SDNOS0",2,0)
 ;;5.3;Scheduling;**20,194,410,517,523,572**;Aug 13, 1993;Build 13
"RTN","SDNOS0",3,0)
 D END1^SDNOS
"RTN","SDNOS0",4,0)
 S (SDV1,SDIN,SDNM,SDNM1)=0,SDDIVO=SDDIV
"RTN","SDNOS0",5,0)
 I $D(^DG(43,1,"GL")),$P(^("GL"),U,2) S SDV1=1
"RTN","SDNOS0",6,0)
 I SDDIV'="A" S (^UTILITY($J,"SDNO",SDDIV,"***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***N***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***NA***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***SDNMS***"))=0
"RTN","SDNOS0",7,0)
 I SDDIV="A" D DIVRPT
"RTN","SDNOS0",8,0)
 I SDCL(1)="ALL" S SDCL=0 D SDCL
"RTN","SDNOS0",9,0)
 I SDCL(1)'="ALL" F SDSUB=0:0 S SDSUB=$O(SDCL(SDSUB)) Q:SDSUB=""  S SDCL=SDCL(SDSUB),SDLAB=$S(SDCL?.N1"*".E:"RANGE",1:"SDTST") D @SDLAB
"RTN","SDNOS0",10,0)
 S (P1,SDTOT,SDTOT1)=0,DGTCH="NO-SHOW REPORT^CLINIC^PAGE#",(SDEND,SDHD)=0
"RTN","SDNOS0",11,0)
 D ^SDNOS1
"RTN","SDNOS0",12,0)
 Q
"RTN","SDNOS0",13,0)
 ;
"RTN","SDNOS0",14,0)
DIVRPT F SDDIV=0:0 S SDDIV=$O(^DG(40.8,SDDIV)) Q:'SDDIV  S (^UTILITY($J,"SDNO",SDDIV,"***N***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***NA***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***SDNMS***"))=0
"RTN","SDNOS0",15,0)
 Q
"RTN","SDNOS0",16,0)
 ;
"RTN","SDNOS0",17,0)
SDCL F SDZ=1:1 S SDCL=$O(^SC(SDCL)) Q:'SDCL  D SDTST
"RTN","SDNOS0",18,0)
 Q
"RTN","SDNOS0",19,0)
 ;
"RTN","SDNOS0",20,0)
SDTST S SDNM=0,SDCL1=^SC(SDCL,0) I $P(SDCL1,U,3)'="C" Q
"RTN","SDNOS0",21,0)
 I SDDIVO,SDCL(1),'$D(SDR1) D DATES Q
"RTN","SDNOS0",22,0)
 I $S((SDDIVO&'SDCL(1)&(SDDIVO=$P(SDCL1,U,15))):1,'SDDIVO:1,$D(SDR1)&SDDIVO&($P(SDCL1,U,15)=SDDIVO):1,'$P(SDCL1,U,15)&(SDDIVO=$P(^DG(43,1,"GL"),U,3)):1,'SDV1:1,1:0) S SDIN=0 D:$D(^SC(SDCL,"I")) INAC^SDNOS1A Q:SDIN  D DATES
"RTN","SDNOS0",23,0)
 Q
"RTN","SDNOS0",24,0)
 ;
"RTN","SDNOS0",25,0)
DATES S:'SDDIVO SDDIV=$S($P(SDCL1,U,15)&SDV1:$P(SDCL1,U,15),$D(^DG(43,"GL")):$P(^("GL"),U,3),1:$O(^DG(40.8,0)))
"RTN","SDNOS0",26,0)
 Q:$D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***"))  S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")=0,^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***SDNMS***")=0
"RTN","SDNOS0",27,0)
 S (SDEN,SDBEG)=0,SDBEG1=SDBD F SDZ1=1:1 S SDBEG1=$O(^SC(SDCL,"S",SDBEG1)) Q:SDBEG1'>0  D SDED Q:SDBEG!SDEN  D CHK
"RTN","SDNOS0",28,0)
 S ^UTILITY($J,"SDNO",SDDIV,"***SDNMS***")=SDNM+^UTILITY($J,"SDNO",SDDIV,"***SDNMS***")
"RTN","SDNOS0",29,0)
 Q
"RTN","SDNOS0",30,0)
 ;
"RTN","SDNOS0",31,0)
SDED S SDBEG=0,SDEN=0 I $D(SDED),(SDBEG1>(SDED+.99999)) S SDEN=1 Q
"RTN","SDNOS0",32,0)
 I '$D(SDED),(SDBEG1>(SDBD+.99999)) S SDBEG=1 Q
"RTN","SDNOS0",33,0)
 Q
"RTN","SDNOS0",34,0)
 ;Added 2nd Quit below SD/517
"RTN","SDNOS0",35,0)
 ;SD/523 - added Q:SDPAT="" to For loop
"RTN","SDNOS0",36,0)
CHK S SDAPP=0 F  S SDAPP=$O(^SC(SDCL,"S",SDBEG1,1,SDAPP)) Q:'SDAPP  Q:'$D(^(SDAPP,0))  I $D(^SC(SDCL,"S",SDBEG1,1,SDAPP))=10,$P(^(SDAPP,0),U,9)'="C" S SDPAT=$P(^SC(SDCL,"S",SDBEG1,1,SDAPP,0),U,1) Q:SDPAT=""  I $D(^DPT(SDPAT,"S",SDBEG1)) D CHK1
"RTN","SDNOS0",37,0)
 Q
"RTN","SDNOS0",38,0)
 ;
"RTN","SDNOS0",39,0)
CHK1 S SD="SD" F SDCHK=1,2,10,12,14 S @(SD_SDCHK)=$P(^DPT(SDPAT,"S",SDBEG1,0),U,SDCHK)
"RTN","SDNOS0",40,0)
 S:'SDDIVO&$P(SDCL1,U,15) SDDIV=$P(SDCL1,U,15) S:'SDDIVO&'$P(SDCL1,U,15) SDDIV=$O(^DG(40.8,0))
"RTN","SDNOS0",41,0)
 S:'$D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")) ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")=0
"RTN","SDNOS0",42,0)
 I SDFMT=1 D
"RTN","SDNOS0",43,0)
 .I (SD2="N")!(SD2="NA"),$$NOSHOW(SDPAT,SDBEG1,SDCL,$G(^DPT(SDPAT,"S",SDBEG1,0)),SDAPP) D 
"RTN","SDNOS0",44,0)
 ..D SET,TOTAL Q
"RTN","SDNOS0",45,0)
 I SDFMT=2 D
"RTN","SDNOS0",46,0)
 .I (SD2=""&('$D(^SC(SDCL,"S",SDBEG1,1,SDAPP,"C"))))!(SD2="N")!(SD2="NA")!(SD2="NT"),$$NOSHOW(SDPAT,SDBEG1,SDCL,$G(^DPT(SDPAT,"S",SDBEG1,0)),SDAPP) D
"RTN","SDNOS0",47,0)
 ..D SET Q:SD2=""  D TOTAL Q    ;SD*572 only count No Show appts
"RTN","SDNOS0",48,0)
 I SD2'["C" S SDNM=SDNM+1,^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***SDNMS***")=SDNM
"RTN","SDNOS0",49,0)
 Q
"RTN","SDNOS0",50,0)
 ;
"RTN","SDNOS0",51,0)
SET S:$P(SDCL1,U,15)&SDDIVO&SDV1 SDDIV=$P(SDCL1,U,15) S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),SDBEG1,$P(^DPT(SDPAT,0),U),+$P(^(0),U,9))=SD2_U_SD10_U_SD12
"RTN","SDNOS0",52,0)
 Q
"RTN","SDNOS0",53,0)
 ;
"RTN","SDNOS0",54,0)
TOTAL S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***"_SD2_"***","***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***"_SD2_"***","***TOT***")):^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***"_SD2_"***","***TOT***")+1,1:1)
"RTN","SDNOS0",55,0)
 S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),$P(SDBEG1,"."),"***"_SD2_"***","***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),$P(SDBEG1,"."),"***"_SD2_"***","***TOT***")):^("***TOT***")+1,1:1)
"RTN","SDNOS0",56,0)
 S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")):^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")+1,1:1)
"RTN","SDNOS0",57,0)
 S ^("***TOT***")=^UTILITY($J,"SDNO",SDDIV,"***TOT***")+1,^("***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,"***"_SD2_"***","***TOT***")):^UTILITY($J,"SDNO",SDDIV,"***"_SD2_"***","***TOT***")+1,1:1)
"RTN","SDNOS0",58,0)
 Q
"RTN","SDNOS0",59,0)
 ;
"RTN","SDNOS0",60,0)
RANGE S SDREST=$E(SDCL,$F(SDCL,"*"),$L(SDCL)),SDCL=$E(SDCL,1,($F(SDCL,"*")-2)),SDCL1=^SC(SDCL,0)
"RTN","SDNOS0",61,0)
 S:'SDDIVO SDDIV=$S($P(SDCL1,U,15):$P(SDCL1,U,15),'$P(SDCL1,U,15)&$D(^DG(43,"GL")):$P(^DG(43,"GL"),U,3),1:$O(^DG(40.8,0)))
"RTN","SDNOS0",62,0)
 S SDR1=1,SDR=$P(SDCL1,U) D SDTST K SDR1
"RTN","SDNOS0",63,0)
 S SDREST="1"_""""_SDREST_""""_".E" F SDCXX=1:1 S SDR=$O(^SC("B",SDR)) Q:'(SDR?@SDREST)!(SDR="")  S SDCL=$O(^SC("B",SDR,-1)) S SDR1=1 D RANGE1 K SDR1
"RTN","SDNOS0",64,0)
 Q
"RTN","SDNOS0",65,0)
 ;
"RTN","SDNOS0",66,0)
RANGE1 S:'SDDIVO SDDIV=$S($P(SDCL1,U,15):$P(SDCL1,U,15),'$P(SDCL1,U,15)&$D(^DG(43,"GL")):$P(^DG(43,"GL"),U,3),1:$O(^DG(40.8,0))) D SDTST
"RTN","SDNOS0",67,0)
 Q
"RTN","SDNOS0",68,0)
 ;
"RTN","SDNOS0",69,0)
NOSHOW(DFN,SDT,CIFN,PAT,DA) ;Input:  DFN=Patient IFN, SDT=Appointment D/T
"RTN","SDNOS0",70,0)
 ;  CIFN=Clinic IFN, PAT=Zero node of pat. appt., DA=Clinic appt. IFN
"RTN","SDNOS0",71,0)
 ;                        Output:  1 or 0 for noshow yes/no
"RTN","SDNOS0",72,0)
 N NSQUERY,NS S NS=1,NSQUERY=$$STATUS^SDAM1(DFN,SDT,CIFN,PAT,DA)
"RTN","SDNOS0",73,0)
 I $P(NSQUERY,";",3)["ACTION REQ" S NS=0
"RTN","SDNOS0",74,0)
NOSHOWQ Q NS
"VER")
8.0^22.0
"BLD",8621,6)
^478
**END**
**END**
