Released SD*5.3*591 SEQ #483
Extracted from mail message
**KIDS**:SD*5.3*591^

**INSTALL NAME**
SD*5.3*591
"BLD",8918,0)
SD*5.3*591^SCHEDULING^0^3120110^y
"BLD",8918,1,0)
^^1^1^3120109^^
"BLD",8918,1,1,0)
Fixes subscript error introduced with patch SD*5.3*567.
"BLD",8918,4,0)
^9.64PA^^
"BLD",8918,6.3)
8
"BLD",8918,"ABPKG")
n
"BLD",8918,"KRN",0)
^9.67PA^779.2^20
"BLD",8918,"KRN",.4,0)
.4
"BLD",8918,"KRN",.401,0)
.401
"BLD",8918,"KRN",.402,0)
.402
"BLD",8918,"KRN",.403,0)
.403
"BLD",8918,"KRN",.5,0)
.5
"BLD",8918,"KRN",.84,0)
.84
"BLD",8918,"KRN",3.6,0)
3.6
"BLD",8918,"KRN",3.8,0)
3.8
"BLD",8918,"KRN",9.2,0)
9.2
"BLD",8918,"KRN",9.8,0)
9.8
"BLD",8918,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8918,"KRN",9.8,"NM",1,0)
SDAM1^^0^B31062484
"BLD",8918,"KRN",9.8,"NM","B","SDAM1",1)

"BLD",8918,"KRN",19,0)
19
"BLD",8918,"KRN",19.1,0)
19.1
"BLD",8918,"KRN",101,0)
101
"BLD",8918,"KRN",409.61,0)
409.61
"BLD",8918,"KRN",771,0)
771
"BLD",8918,"KRN",779.2,0)
779.2
"BLD",8918,"KRN",870,0)
870
"BLD",8918,"KRN",8989.51,0)
8989.51
"BLD",8918,"KRN",8989.52,0)
8989.52
"BLD",8918,"KRN",8994,0)
8994
"BLD",8918,"KRN","B",.4,.4)

"BLD",8918,"KRN","B",.401,.401)

"BLD",8918,"KRN","B",.402,.402)

"BLD",8918,"KRN","B",.403,.403)

"BLD",8918,"KRN","B",.5,.5)

"BLD",8918,"KRN","B",.84,.84)

"BLD",8918,"KRN","B",3.6,3.6)

"BLD",8918,"KRN","B",3.8,3.8)

"BLD",8918,"KRN","B",9.2,9.2)

"BLD",8918,"KRN","B",9.8,9.8)

"BLD",8918,"KRN","B",19,19)

"BLD",8918,"KRN","B",19.1,19.1)

"BLD",8918,"KRN","B",101,101)

"BLD",8918,"KRN","B",409.61,409.61)

"BLD",8918,"KRN","B",771,771)

"BLD",8918,"KRN","B",779.2,779.2)

"BLD",8918,"KRN","B",870,870)

"BLD",8918,"KRN","B",8989.51,8989.51)

"BLD",8918,"KRN","B",8989.52,8989.52)

"BLD",8918,"KRN","B",8994,8994)

"BLD",8918,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",8918,"QUES",0)
^9.62^^
"BLD",8918,"REQB",0)
^9.611^1^1
"BLD",8918,"REQB",1,0)
SD*5.3*567^2
"BLD",8918,"REQB","B","SD*5.3*567",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
591^3120110
"PKG",16,22,1,"PAH",1,1,0)
^^1^1^3120110
"PKG",16,22,1,"PAH",1,1,1,0)
Fixes subscript error introduced with patch SD*5.3*567.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SDAM1")
0^1^B31062484^B33476298
"RTN","SDAM1",1,0)
SDAM1 ;MJK/ALB - Appt Mgt (Patient);Apr 23 1999 ; 1/6/12 3:36pm
"RTN","SDAM1",2,0)
 ;;5.3;Scheduling;**149,155,193,189,445,478,466,567,591**;Aug 13, 1993;Build 8
"RTN","SDAM1",3,0)
 ;
"RTN","SDAM1",4,0)
INIT ; -- get init pat appt data
"RTN","SDAM1",5,0)
 ;  input:          DFN := ifn of pat
"RTN","SDAM1",6,0)
 ; output:  ^TMP("SDAM" := appt array
"RTN","SDAM1",7,0)
 S X=$P($G(^DG(43,1,"SCLR")),U,12),SDPRD=$S(X:X,1:2)
"RTN","SDAM1",8,0)
 S X1=DT,X2=-SDPRD D C^%DTC S SDBEG=X
"RTN","SDAM1",9,0)
 S X1=DT,X2=999 D C^%DTC S SDEND=X
"RTN","SDAM1",10,0)
 D CHGCAP^VALM("NAME","Clinic")
"RTN","SDAM1",11,0)
 S X="ALL" D LIST^SDAM
"RTN","SDAM1",12,0)
 Q
"RTN","SDAM1",13,0)
 ;
"RTN","SDAM1",14,0)
BLD ; -- scan apts
"RTN","SDAM1",15,0)
 N SDAMDD,SDNAME,SDMAX,SDLARGE,DFN,SDCL,BL,XC,XW,AC,AW,TC,TW,NC,NW,SC,SW,SDT,CC,CW,CN,CNPAT,CNSTLNK,CSTAT ; done for speed see INIT
"RTN","SDAM1",16,0)
 D INIT^SDAM10
"RTN","SDAM1",17,0)
 S DFN=SDFN
"RTN","SDAM1",18,0)
 F SDT=SDBEG:0 S SDT=$O(^DPT(DFN,"S",SDT)) Q:'SDT!($P(SDT,".",1)>SDEND)  I $D(^(SDT,0)) S SDATA=^(0),SDCL=+SDATA,SDNAME=$P($G(^SC(SDCL,0)),U) D  K:CNSTLNK="" CNSTLNK D BLD1  ;SD/478
"RTN","SDAM1",19,0)
 .S CNSTLNK="",CN=0 F  S CN=$O(^SC(SDCL,"S",SDT,1,CN)) Q:'+CN  S CNPAT=$P($G(^SC(SDCL,"S",SDT,1,CN,0)),U) I CNPAT=DFN S CNSTLNK=$P($G(^SC(SDCL,"S",SDT,1,CN,"CONS")),U),CSTAT="" S:CNSTLNK'="" CSTAT=$P($G(^GMR(123,CNSTLNK,0)),U,12) Q  ;SD/478
"RTN","SDAM1",20,0)
 D NUL^SDAM10,LARGE^SDAM10:$D(SDLARGE)
"RTN","SDAM1",21,0)
 S $P(^TMP("SDAM",$J,0),U,4)=VALMCNT
"RTN","SDAM1",22,0)
 Q
"RTN","SDAM1",23,0)
 ;
"RTN","SDAM1",24,0)
BLD1 ; -- build array
"RTN","SDAM1",25,0)
 N SDX,X,Y,Y1,SDSTAT,SDELIG
"RTN","SDAM1",26,0)
 S SDSTAT=$$STATUS(DFN,SDT,SDCL,SDATA,$S($D(SDDA):SDDA,1:""))
"RTN","SDAM1",27,0)
 G BLD1Q:'$$CHK(DFN,SDT,SDCL,SDATA,.SDAMLIST,SDSTAT)
"RTN","SDAM1",28,0)
 ;; Changes for GAF enhancement
"RTN","SDAM1",29,0)
 S SDGAFREQ=" "
"RTN","SDAM1",30,0)
 S SDELIG=$$ELSTAT^SDUTL2(DFN)
"RTN","SDAM1",31,0)
 I $$MHCLIN^SDUTL2(SDCL),'($$COLLAT^SDUTL2(SDELIG)!$P(SDATA,U,11)) D
"RTN","SDAM1",32,0)
 .S SDGAF=$$NEWGAF^SDUTL2(DFN),SDGAFST=$P(SDGAF,"^")
"RTN","SDAM1",33,0)
 .S:SDGAFST SDGAFREQ="*"
"RTN","SDAM1",34,0)
 S SDACNT=SDACNT+1,X="",$P(X," ",VALMWD+1)=""
"RTN","SDAM1",35,0)
 W:(SDACNT#10)=0 "."
"RTN","SDAM1",36,0)
 I SDACNT=SDMAX,$P(SDT,".")'=SDEND S SDEND=$P(SDT,"."),SDLARGE=""
"RTN","SDAM1",37,0)
 S X=SDGAFREQ_$E(X,2,AC-1)_$E(SDACNT_BL,1,AW)_$E(X,AC+AW+1,VALMWD)
"RTN","SDAM1",38,0)
 S X=$E(X,1,NC-1)_$E($$LOWER(SDNAME)_BL,1,NW)_$E(X,NC+NW+1,VALMWD)
"RTN","SDAM1",39,0)
 S X=$E(X,1,XC-1)_$E($$FMTE^XLFDT(SDT,"5Z")_BL,1,XW)_$E(X,XC+XW+1,VALMWD)  ;to make date field work for SD*5.3*189 - uses FM List Template
"RTN","SDAM1",40,0)
 S:'$D(CSTAT) CSTAT="" ;SD/478
"RTN","SDAM1",41,0)
 S X=$E(X,1,CC-1)_$E($S((CSTAT=1!(CSTAT=2)!(CSTAT=13)):" ",$G(CNSTLNK):"Consult",1:"        ")_BL,1,CW)_$E(X,CC+CW+1,VALMWD) K CNSTLNK,CSTAT ;SD/478
"RTN","SDAM1",42,0)
 S Y=$P(SDSTAT,";",3)
"RTN","SDAM1",43,0)
 I Y'["FUTURE" S X=$E(X,1,SC-1)_$E($$LOWER(Y)_BL,1,SW)_$E(X,SC+SW+1,VALMWD)
"RTN","SDAM1",44,0)
 I Y["FUTURE" S X=$E(X,1,SC-1)_$E($$LOWER(Y)_$$ANC_BL,1,SW+TW+1)
"RTN","SDAM1",45,0)
 S Y1=$S($P(SDSTAT,";",5):$P(SDSTAT,";",5),1:$P(SDSTAT,";",4)),Y1=$S($P(Y1,".")=DT:$$TIME($P(Y1,".",2)),1:"")
"RTN","SDAM1",46,0)
 S:Y1]"" X=$E(X,1,TC-1)_$E(Y1_BL,1,TW)_$E(X,TC+TW+1,VALMWD)
"RTN","SDAM1",47,0)
 D SET(X)
"RTN","SDAM1",48,0)
 I $D(SDAMBOLD(DFN,SDT,SDCL)) D FLDCTRL^VALM10(VALMCNT,"STAT",IOINHI,IOINORM),FLDCTRL^VALM10(VALMCNT,"TIME",IOINHI,IOINORM)
"RTN","SDAM1",49,0)
 S ^TMP("SDAMIDX",$J,SDACNT)=VALMCNT_U_DFN_U_SDT_U_SDCL_U_$S($D(SDDA):SDDA,1:"")
"RTN","SDAM1",50,0)
BLD1Q Q
"RTN","SDAM1",51,0)
 ;
"RTN","SDAM1",52,0)
ANC() ; -- set ancillary info
"RTN","SDAM1",53,0)
 N I,Y,C
"RTN","SDAM1",54,0)
 S Y="",C=0
"RTN","SDAM1",55,0)
 F I=3:1:5 I $P(SDATA,U,I)]"" S Y=Y_" "_$P("^^Lab^XRay^EKG",U,I)_"@"_$$TIME($P($P(SDATA,U,I),".",2)),C=C+1 Q:C=2
"RTN","SDAM1",56,0)
 I Y]"" S Y="/"_$E(Y,2,99)
"RTN","SDAM1",57,0)
 Q Y
"RTN","SDAM1",58,0)
 ;  
"RTN","SDAM1",59,0)
SET(X) ;
"RTN","SDAM1",60,0)
 S VALMCNT=VALMCNT+1,^TMP("SDAM",$J,VALMCNT,0)=X
"RTN","SDAM1",61,0)
 S:SDACNT ^TMP("SDAM",$J,"IDX",VALMCNT,SDACNT)=""
"RTN","SDAM1",62,0)
 Q
"RTN","SDAM1",63,0)
 ;
"RTN","SDAM1",64,0)
CHK(DFN,SDT,SDCL,SDATA,SDAMLIST,SDSTAT,SDDA) ; -- does appt meet criteria
"RTN","SDAM1",65,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM1",66,0)
 ;                 SDT := appt d/t
"RTN","SDAM1",67,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM1",68,0)
 ;               SDATA := 0th node of pat appt entry
"RTN","SDAM1",69,0)
 ;            SDAMLIST := list definition
"RTN","SDAM1",70,0)
 ;              SDSTAT := appt status data from $$STATUS call
"RTN","SDAM1",71,0)
 ;                SDDA := ifn for ^SC(clinic,"S",date,1,ifn) {optional}
"RTN","SDAM1",72,0)
 ;  output: [returned] := meets criteria for list [0 - no | 1 - yes ]
"RTN","SDAM1",73,0)
 ;
"RTN","SDAM1",74,0)
 S Y=0
"RTN","SDAM1",75,0)
 I $D(SDAMLIST(+SDSTAT)) S Y=1 G CHKQ
"RTN","SDAM1",76,0)
 I $P(SDAMLIST,U)="ALL" S Y=1
"RTN","SDAM1",77,0)
 I $P(SDAMLIST,U)="CHECKED IN" I $P(SDSTAT,";",3)="ACT REQ/CHECKED IN" S Y=1  ; - SD*5.3*445
"RTN","SDAM1",78,0)
CHKQ I Y,$D(SDAMLIST("SCR")) X SDAMLIST("SCR") S Y=$T
"RTN","SDAM1",79,0)
 Q Y
"RTN","SDAM1",80,0)
 ;
"RTN","SDAM1",81,0)
STATUS(DFN,SDT,SDCL,SDATA,SDDA) ; -- return appt status
"RTN","SDAM1",82,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM1",83,0)
 ;                 SDT := appt d/t
"RTN","SDAM1",84,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM1",85,0)
 ;               SDATA := 0th node of pat appt entry
"RTN","SDAM1",86,0)
 ;                SDDA := ifn for ^SC(clinic,"S",date,1,ifn) {optional}
"RTN","SDAM1",87,0)
 ;  output: [returned] := appt status ifn ^ status name ^ print status ^
"RTN","SDAM1",88,0)
 ;                        check in d/t ^ check out d/t ^ adm mvt ifn
"RTN","SDAM1",89,0)
 ;
"RTN","SDAM1",90,0)
 ;S = status ; C = ci/co indicator ; Y = 'C' node ; P = print status
"RTN","SDAM1",91,0)
 N S,C,Y,P,VADMVT,VAINDT
"RTN","SDAM1",92,0)
 ;
"RTN","SDAM1",93,0)
 ; -- get data for evaluation
"RTN","SDAM1",94,0)
 S:'$G(SDDA) SDDA=+$$FIND^SDAM2(DFN,SDT,SDCL)
"RTN","SDAM1",95,0)
 S Y=$G(^SC(SDCL,"S",SDT,1,SDDA,"C"))
"RTN","SDAM1",96,0)
 ;retrieve CHECK OUT from OUTPATIENT ENCOUNTER file if not in Hospital Location file 
"RTN","SDAM1",97,0)
 I 'Y,SDT<$$NOW^XLFDT N SDSCE S SDSCE=$P($G(^DPT(DFN,"S",SDT,0)),U,20) D  ;pointer to OE
"RTN","SDAM1",98,0)
 .I SDSCE S $P(Y,U,3)=$P($G(^SCE(SDSCE,0)),U,7) ;check out date
"RTN","SDAM1",99,0)
 ;
"RTN","SDAM1",100,0)
 ; -- set initial status value ; non-count clinic?
"RTN","SDAM1",101,0)
 S S=$S($P(SDATA,"^",2)]"":$P($P($P(^DD(2.98,3,0),"^",3),$P(SDATA,"^",2)_":",2),";"),$P($G(^SC(SDCL,0)),U,17)="Y":"NON-COUNT",1:"")
"RTN","SDAM1",102,0)
 ;
"RTN","SDAM1",103,0)
 ; -- inpatient?
"RTN","SDAM1",104,0)
 S VAINDT=SDT D ADM^VADPT2
"RTN","SDAM1",105,0)
 I S["INPATIENT",$S('VADMVT:1,'$P(^DG(43,1,0),U,21):0,1:$P($G(^DIC(42,+$P($G(^DGPM(VADMVT,0)),U,6),0)),U,3)="D") S S=""
"RTN","SDAM1",106,0)
 ;
"RTN","SDAM1",107,0)
 ; -- determine ci/co indicator
"RTN","SDAM1",108,0)
 S C=$S($P(Y,"^",3):"CHECKED OUT",Y:"CHECKED IN",S]"":"",SDT>(DT+.2359):"FUTURE",1:"NO ACTION TAKEN") S:S="" S=C
"RTN","SDAM1",109,0)
 I S="NO ACTION TAKEN",$P(SDT,".")=DT,C'["CHECKED" S C="TODAY"
"RTN","SDAM1",110,0)
 ; -- $$REQ & $$COCMP in SDM1A not used for speed
"RTN","SDAM1",111,0)
 I S="CHECKED OUT"!(S="CHECKED IN"),SDT'<$P(^DG(43,1,"SCLR"),U,23),'$P($G(^SCE(+$P(SDATA,U,20),0)),U,7) S S="NO ACTION TAKEN"
"RTN","SDAM1",112,0)
 ;
"RTN","SDAM1",113,0)
 ; -- determine print status
"RTN","SDAM1",114,0)
 S P=$S(S=C!(C=""):S,1:"")
"RTN","SDAM1",115,0)
 I P="" D
"RTN","SDAM1",116,0)
 .I S["INPATIENT",$P($G(^SC(SDCL,0)),U,17)'="Y",$P($G(^SCE(+$P(SDATA,U,20),0)),U,7)="" S P=$P(S," ")_"/ACT REQ" Q
"RTN","SDAM1",117,0)
 .I S="NO ACTION TAKEN",C="CHECKED OUT"!(C="CHECKED IN") S P="ACT REQ/"_C Q
"RTN","SDAM1",118,0)
 .S P=$S(S="NO ACTION TAKEN":S,1:$P(S," "))_"/"_C
"RTN","SDAM1",119,0)
 I S["INPATIENT",C="" D
"RTN","SDAM1",120,0)
 .I SDT>(DT+.2359) S P=$P(S," ")_"/FUTURE" Q
"RTN","SDAM1",121,0)
 .S P=$P(S," ")_"/NO ACT TAKN"
"RTN","SDAM1",122,0)
 ;
"RTN","SDAM1",123,0)
STATUSQ Q +$O(^SD(409.63,"AC",S,0))_";"_S_";"_P_";"_$P(Y,"^")_";"_$P(Y,"^",3)_";"_+VADMVT
"RTN","SDAM1",124,0)
 ;
"RTN","SDAM1",125,0)
 ;
"RTN","SDAM1",126,0)
LOWER(X) ; convert to lowercase ; same as LOWER^VALM1 ; here for speed
"RTN","SDAM1",127,0)
 N Y,C,I
"RTN","SDAM1",128,0)
 S Y=$E(X)_$TR($E(X,2,999),"ABCDEFGHIJKLMNOPQRSTUVWXYZ@","abcdefghijklmnopqrstuvwxyz ")
"RTN","SDAM1",129,0)
 F C=" ",",","/" S I=0 F  S I=$F(Y,C,I) Q:'I  S Y=$E(Y,1,I-1)_$TR($E(Y,I),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(Y,I+1,999)
"RTN","SDAM1",130,0)
 Q Y
"RTN","SDAM1",131,0)
 ;
"RTN","SDAM1",132,0)
TIME(X) ; -- format time only :=   hr:min
"RTN","SDAM1",133,0)
 Q $E(X_"0000",1,2)_":"_$E(X_"0000",3,4)
"VER")
8.0^22.0
"BLD",8918,6)
^483
**END**
**END**
