Released SD*5.3*598 SEQ #498
Extracted from mail message
**KIDS**:SD*5.3*598^

**INSTALL NAME**
SD*5.3*598
"BLD",9119,0)
SD*5.3*598^SCHEDULING^0^3130227^y
"BLD",9119,1,0)
^^12^12^3130227^
"BLD",9119,1,1,0)
 
"BLD",9119,1,2,0)
1. The user has the ability to reactivate an automatically inactivated 
"BLD",9119,1,3,0)
   patient to an inactive team and position.
"BLD",9119,1,4,0)
 
"BLD",9119,1,5,0)
 
"BLD",9119,1,6,0)
2. The user has the ability to reactivate an automatically inactivated 
"BLD",9119,1,7,0)
   deceased patient to their previously assigned team and position.
"BLD",9119,1,8,0)
 
"BLD",9119,1,9,0)
 
"BLD",9119,1,10,0)
3. When running the Historical Provider Position Assignment Listing 
"BLD",9119,1,11,0)
   report by provider no assignment data is returned due to an incorrect 
"BLD",9119,1,12,0)
   variable name.
"BLD",9119,4,0)
^9.64PA^^
"BLD",9119,6.3)
12
"BLD",9119,"KRN",0)
^9.67PA^779.2^20
"BLD",9119,"KRN",.4,0)
.4
"BLD",9119,"KRN",.401,0)
.401
"BLD",9119,"KRN",.402,0)
.402
"BLD",9119,"KRN",.403,0)
.403
"BLD",9119,"KRN",.5,0)
.5
"BLD",9119,"KRN",.84,0)
.84
"BLD",9119,"KRN",3.6,0)
3.6
"BLD",9119,"KRN",3.8,0)
3.8
"BLD",9119,"KRN",9.2,0)
9.2
"BLD",9119,"KRN",9.8,0)
9.8
"BLD",9119,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9119,"KRN",9.8,"NM",1,0)
SCMCQK^^0^B23522932
"BLD",9119,"KRN",9.8,"NM",2,0)
SCRPO3^^0^B61149436
"BLD",9119,"KRN",9.8,"NM","B","SCMCQK",1)

"BLD",9119,"KRN",9.8,"NM","B","SCRPO3",2)

"BLD",9119,"KRN",19,0)
19
"BLD",9119,"KRN",19.1,0)
19.1
"BLD",9119,"KRN",101,0)
101
"BLD",9119,"KRN",409.61,0)
409.61
"BLD",9119,"KRN",771,0)
771
"BLD",9119,"KRN",779.2,0)
779.2
"BLD",9119,"KRN",870,0)
870
"BLD",9119,"KRN",8989.51,0)
8989.51
"BLD",9119,"KRN",8989.52,0)
8989.52
"BLD",9119,"KRN",8994,0)
8994
"BLD",9119,"KRN","B",.4,.4)

"BLD",9119,"KRN","B",.401,.401)

"BLD",9119,"KRN","B",.402,.402)

"BLD",9119,"KRN","B",.403,.403)

"BLD",9119,"KRN","B",.5,.5)

"BLD",9119,"KRN","B",.84,.84)

"BLD",9119,"KRN","B",3.6,3.6)

"BLD",9119,"KRN","B",3.8,3.8)

"BLD",9119,"KRN","B",9.2,9.2)

"BLD",9119,"KRN","B",9.8,9.8)

"BLD",9119,"KRN","B",19,19)

"BLD",9119,"KRN","B",19.1,19.1)

"BLD",9119,"KRN","B",101,101)

"BLD",9119,"KRN","B",409.61,409.61)

"BLD",9119,"KRN","B",771,771)

"BLD",9119,"KRN","B",779.2,779.2)

"BLD",9119,"KRN","B",870,870)

"BLD",9119,"KRN","B",8989.51,8989.51)

"BLD",9119,"KRN","B",8989.52,8989.52)

"BLD",9119,"KRN","B",8994,8994)

"BLD",9119,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",9119,"QUES",0)
^9.62^^
"BLD",9119,"REQB",0)
^9.611^1^1
"BLD",9119,"REQB",1,0)
SD*5.3*563^2
"BLD",9119,"REQB","B","SD*5.3*563",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
598^3130227
"PKG",16,22,1,"PAH",1,1,0)
^^12^12^3130227
"PKG",16,22,1,"PAH",1,1,1,0)
 
"PKG",16,22,1,"PAH",1,1,2,0)
1. The user has the ability to reactivate an automatically inactivated 
"PKG",16,22,1,"PAH",1,1,3,0)
   patient to an inactive team and position.
"PKG",16,22,1,"PAH",1,1,4,0)
 
"PKG",16,22,1,"PAH",1,1,5,0)
 
"PKG",16,22,1,"PAH",1,1,6,0)
2. The user has the ability to reactivate an automatically inactivated 
"PKG",16,22,1,"PAH",1,1,7,0)
   deceased patient to their previously assigned team and position.
"PKG",16,22,1,"PAH",1,1,8,0)
 
"PKG",16,22,1,"PAH",1,1,9,0)
 
"PKG",16,22,1,"PAH",1,1,10,0)
3. When running the Historical Provider Position Assignment Listing 
"PKG",16,22,1,"PAH",1,1,11,0)
   report by provider no assignment data is returned due to an incorrect 
"PKG",16,22,1,"PAH",1,1,12,0)
   variable name.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","SCMCQK")
0^1^B23522932^B21155109
"RTN","SCMCQK",1,0)
SCMCQK ;ALB/REW - Single Pt Tm/Pt Tm Pos Assign and Discharge ; 5/17/12 1:39pm
"RTN","SCMCQK",2,0)
 ;;5.3;Scheduling;**148,177,297,563,598**;AUG 13, 1993;Build 12
"RTN","SCMCQK",3,0)
 ;
"RTN","SCMCQK",4,0)
 ;
"RTN","SCMCQK",5,0)
 ; Reference/ICR
"RTN","SCMCQK",6,0)
 ; ^DPT(DFN,.35)/10035
"RTN","SCMCQK",7,0)
 ;
"RTN","SCMCQK",8,0)
 ;
"RTN","SCMCQK",9,0)
EN ; - main call
"RTN","SCMCQK",10,0)
 W !,"Primary Care Team/PC Assignment/Unassignment",!
"RTN","SCMCQK",11,0)
 W !,?6,"Prior to using this option, PCMM's Graphical User Interface (GUI)"
"RTN","SCMCQK",12,0)
 W !,?6,"must be used to:"
"RTN","SCMCQK",13,0)
 W !,?10,"1) Setup active primary care and non-primary care team(s)"
"RTN","SCMCQK",14,0)
 W !,?10,"2) Setup active PC and non-primary care Practitioner position(s)"
"RTN","SCMCQK",15,0)
 W !,?10,"3) Setup any necessary preceptor/preceptee relationships"
"RTN","SCMCQK",16,0)
 W !,?10,"4) Assign practitioner to position(s)"
"RTN","SCMCQK",17,0)
 W !!?6,"A patient can only have one PC team and one"
"RTN","SCMCQK",18,0)
 W !?6,"PC Position assignment on a given day.  The patient must be"
"RTN","SCMCQK",19,0)
 W !?6,"assigned to a position's team to be assigned to the position."
"RTN","SCMCQK",20,0)
 W !!?6,"Note: You must use the PCMM GUI if the patient was:"
"RTN","SCMCQK",21,0)
 W !?10,"o unassigned from PC assignment today or in the future"
"RTN","SCMCQK",22,0)
 W !?10,"o assigned to a future PC assignment."
"RTN","SCMCQK",23,0)
 N DFN
"RTN","SCMCQK",24,0)
 F  S DFN=$$PATIENT() Q:DFN<0  D PAT
"RTN","SCMCQK",25,0)
 Q
"RTN","SCMCQK",26,0)
 ;
"RTN","SCMCQK",27,0)
PAT ;process patient
"RTN","SCMCQK",28,0)
 Q:'$G(DFN)
"RTN","SCMCQK",29,0)
 N SCTPSTAT,SCTMSTAT,SCSTAT,SCTM,SCTP,SDDOD,SDDODRES,SDUSRANS
"RTN","SCMCQK",30,0)
 ;If patient is deceased prompt user to continue SD*5.3*563
"RTN","SCMCQK",31,0)
 I $P($G(^DPT(DFN,.35)),U)'="" D  I SDUSRANS'="Y" Q
"RTN","SCMCQK",32,0)
 .S SDDOD=$P(^DPT(DFN,.35),U)
"RTN","SCMCQK",33,0)
 .S SDDODRES=$$FMTE^XLFDT(SDDOD)
"RTN","SCMCQK",34,0)
 .W !!,"This Patient is deceased as of "_SDDODRES_". Would you like to continue?"
"RTN","SCMCQK",35,0)
 .S DIR(0)="SA^Y:YES;N:NO"
"RTN","SCMCQK",36,0)
 .S DIR("B")="NO"
"RTN","SCMCQK",37,0)
 .S DIR("?")="[Y]ES=continue with current patient, [N]o=select a new patient or quit"
"RTN","SCMCQK",38,0)
 .W ! D ^DIR K DIR S SDUSRANS=Y
"RTN","SCMCQK",39,0)
 .I $D(DIRUT) K DIRUT,DUOUT,DTOUT,X,Y Q
"RTN","SCMCQK",40,0)
 ;End SD*5.3*563
"RTN","SCMCQK",41,0)
 W !,"Checking PC Team and Position Status...",!
"RTN","SCMCQK",42,0)
 ;display PC info, check if patient has a current PC team
"RTN","SCMCQK",43,0)
 D PCMM^SCRPU4(DFN,DT)
"RTN","SCMCQK",44,0)
 D DSPL^SCMCQK2
"RTN","SCMCQK",45,0)
 N DATA
"RTN","SCMCQK",46,0)
 S DATA=$$IU^SCMCTSK1(DFN)
"RTN","SCMCQK",47,0)
 I $E(DATA)=1 I $D(^XUSEC("SC PCMM SETUP",+$G(DUZ))) D
"RTN","SCMCQK",48,0)
 .;If patient is deceased do not allow reactivation SD*5.3*598
"RTN","SCMCQK",49,0)
 .I $P($G(^DPT(DFN,.35)),U)'="" Q
"RTN","SCMCQK",50,0)
 .;If the team or position are not currently active do not allow reactivation SD*5.3*598
"RTN","SCMCQK",51,0)
 .I '$$ACTHISTB^SCAPMCU2(404.58,$P(DATA,"~",3))!('$$ACTHISTB^SCAPMCU2(404.59,$P(DATA,"~",5))) Q
"RTN","SCMCQK",52,0)
 .W !,"This patient was inactivated from "_$P(DATA,"~",2)_" TEAM"
"RTN","SCMCQK",53,0)
 .W !,$P(DATA,"~",4)_" Position"
"RTN","SCMCQK",54,0)
 .W !,"Do you wish to reactivate" S %=2 D YN^DICN
"RTN","SCMCQK",55,0)
 .I %=1 D FILEIN^SCMCTSK3(.DATA,+$P(DATA,"~",6))
"RTN","SCMCQK",56,0)
 W !,"Do you want to make a primary care assignment/unassignment" S %=1 D YN^DICN Q:%<0
"RTN","SCMCQK",57,0)
 I %=2 G NPC^SCMCQK2
"RTN","SCMCQK",58,0)
 ;below functions return status^message^pointer
"RTN","SCMCQK",59,0)
 S SCTMSTAT=$$YSPTTMPC^SCMCTMU2(DFN,DT)  ;ok to assign new PC team?
"RTN","SCMCQK",60,0)
 S SCTPSTAT=$$YSPTTPPC^SCMCTPU2(DFN,DT,1)  ;ok to assign new PC prac?
"RTN","SCMCQK",61,0)
 ;what is current/future PC assignment status?
"RTN","SCMCQK",62,0)
 S SCSTAT=$S((SCTMSTAT&SCTPSTAT):"NONE",('SCTMSTAT&SCTPSTAT):"TEAM",('SCTMSTAT&'SCTPSTAT):"BOTH",1:"ERROR")  ;error if PC pract w/o PC team assignment
"RTN","SCMCQK",63,0)
 W:SCSTAT="NONE" !,"No current PC Team/PC Practitioner Assignments"
"RTN","SCMCQK",64,0)
 IF $S(SCTMSTAT:0,(SCTMSTAT["future"):1,1:0) W !,$P(SCTMSTAT,U,2) S SCSTAT="FUTURE"
"RTN","SCMCQK",65,0)
 IF $S(SCTPSTAT:0,(SCTPSTAT["future"):1,1:0) W !,$P(SCTPSTAT,U,2) S SCSTAT="FUTURE"
"RTN","SCMCQK",66,0)
 S SCTM=$P(SCTMSTAT,U,3)
"RTN","SCMCQK",67,0)
 S SCTP=$P(SCTPSTAT,U,3)
"RTN","SCMCQK",68,0)
 D @SCSTAT
"RTN","SCMCQK",69,0)
 D BREAK
"RTN","SCMCQK",70,0)
 Q
"RTN","SCMCQK",71,0)
 ;
"RTN","SCMCQK",72,0)
BREAK ;
"RTN","SCMCQK",73,0)
 N DIR,X,Y
"RTN","SCMCQK",74,0)
 S DIR(0)="EA",DIR("A",1)="",DIR("A")="Press enter to continue."
"RTN","SCMCQK",75,0)
 D ^DIR
"RTN","SCMCQK",76,0)
 Q
"RTN","SCMCQK",77,0)
 ;
"RTN","SCMCQK",78,0)
NONE ;
"RTN","SCMCQK",79,0)
 N SCASSDT
"RTN","SCMCQK",80,0)
 D ASTM^SCMCQK1
"RTN","SCMCQK",81,0)
 Q
"RTN","SCMCQK",82,0)
TEAM ;
"RTN","SCMCQK",83,0)
 N DIR,X,Y,SCDISCH,SCASSDT,SCSELECT
"RTN","SCMCQK",84,0)
 S DIR(0)="SO^1:POSITION ASSIGNMENT - BY PRACTITIONER NAME;2:POSITION ASSIGNMENT - BY POSITION NAME;3:TEAM UNASSIGNMENT"
"RTN","SCMCQK",85,0)
 D ^DIR
"RTN","SCMCQK",86,0)
 IF $P(Y,U,1)=1!($P(Y,U,1)=2) D
"RTN","SCMCQK",87,0)
 .S SCSELECT=$S($P(Y,U,1)=1:"PRACT",1:"POSIT")
"RTN","SCMCQK",88,0)
 .D ASTP^SCMCQK1
"RTN","SCMCQK",89,0)
 ELSE  D:$P(Y,U,1)=3 UNTM^SCMCQK1
"RTN","SCMCQK",90,0)
 Q
"RTN","SCMCQK",91,0)
 ;
"RTN","SCMCQK",92,0)
BOTH ;
"RTN","SCMCQK",93,0)
 N DIR,X,Y,SCDISCH
"RTN","SCMCQK",94,0)
 S DIR(0)="SO^1:PC ASSIGNMENT UNASSIGNMENT;2:TEAM UNASSIGNMENT"
"RTN","SCMCQK",95,0)
 D ^DIR
"RTN","SCMCQK",96,0)
 IF $P(Y,U,1)=1 D
"RTN","SCMCQK",97,0)
 .D UNTP^SCMCQK1
"RTN","SCMCQK",98,0)
 ELSE  D:$P(Y,U,1)=2 UNTM^SCMCQK1
"RTN","SCMCQK",99,0)
 Q
"RTN","SCMCQK",100,0)
 ;
"RTN","SCMCQK",101,0)
FUTURE ;
"RTN","SCMCQK",102,0)
 W !,"This patient has future assignments for Primary Care"
"RTN","SCMCQK",103,0)
 W !,"Team and/or Practitioner"
"RTN","SCMCQK",104,0)
 W !!!,"You must use PCMM's Graphical User Interface to change"
"RTN","SCMCQK",105,0)
 Q
"RTN","SCMCQK",106,0)
 ;
"RTN","SCMCQK",107,0)
ERROR ;
"RTN","SCMCQK",108,0)
 W !,"This patient has NO active Primary Care Team, but does have"
"RTN","SCMCQK",109,0)
 W !,"an active PC Position Assignment"
"RTN","SCMCQK",110,0)
 W !!!,"You must use PCMM's Graphical User Interface to correct"
"RTN","SCMCQK",111,0)
 Q
"RTN","SCMCQK",112,0)
 ;
"RTN","SCMCQK",113,0)
PATIENT() ;Return Patient DFN or -1
"RTN","SCMCQK",114,0)
 ;
"RTN","SCMCQK",115,0)
 N DIC,X,Y
"RTN","SCMCQK",116,0)
 W !!!
"RTN","SCMCQK",117,0)
 S DIC=2
"RTN","SCMCQK",118,0)
 S DIC(0)="AEMQZ"
"RTN","SCMCQK",119,0)
 D ^DIC
"RTN","SCMCQK",120,0)
 Q $S($D(DTOUT):-1,$D(DUOUT):-1,(Y<0):-1,1:+Y)
"RTN","SCRPO3")
0^2^B61149436^B60376313
"RTN","SCRPO3",1,0)
SCRPO3 ;BP-CIOFO/KEITH - Historical Provider Position Assignment Listing ; 9/14/99 10:06am
"RTN","SCRPO3",2,0)
 ;;5.3;Scheduling;**177,598**;AUG 13, 1993;Build 12
"RTN","SCRPO3",3,0)
 ;
"RTN","SCRPO3",4,0)
EN ;Queue report
"RTN","SCRPO3",5,0)
 N LIST,SORT,RTN,DESC,SCSP
"RTN","SCRPO3",6,0)
 S LIST="DIV,TEAM,POS,ASPR,CLINIC",SORT="DV,TM,TP,PR,EC",SCSP="PR"
"RTN","SCRPO3",7,0)
 S RTN="RUN^SCRPO3"
"RTN","SCRPO3",8,0)
 S DESC="Historical Provider Position Assignment Listing"
"RTN","SCRPO3",9,0)
 D PROMPT^SCRPO1(LIST,SORT,SCSP,RTN,DESC) Q
"RTN","SCRPO3",10,0)
 ;
"RTN","SCRPO3",11,0)
RUN ;Print report
"RTN","SCRPO3",12,0)
 N SCFMT,SCTITL,SCTITL2,SCLINE,SCPAGE,SCOUT,SCFF,SCX,SCPNOW,SCFD
"RTN","SCRPO3",13,0)
 N SC1,SC2,SC3,SC4,SC5,SC6,SCN,SCI,SCPNOW,SCY,SCFF,SCLINE,SCPAGE
"RTN","SCRPO3",14,0)
 S SCFMT=$E(^TMP("SC",$J,"FMT")),(SCFF,SCOUT)=0
"RTN","SCRPO3",15,0)
 D BUILD(SCFMT) Q:SCOUT  S SCI=0
"RTN","SCRPO3",16,0)
 D HINI D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPO3",17,0)
 ;print report parameters
"RTN","SCRPO3",18,0)
 S SCTITL(2)=$$HDRX("P") D HDR^SCRPO(.SCTITL,132) Q:SCOUT  S SCOUT=$$PPAR^SCRPO(.SC,,.SCTITL)=0
"RTN","SCRPO3",19,0)
 Q:SCOUT
"RTN","SCRPO3",20,0)
 ;print negative report
"RTN","SCRPO3",21,0)
 I '$D(^TMP("SCRPT",$J,0)) D  G EXIT
"RTN","SCRPO3",22,0)
 .K SCTITL(2) D HDR^SCRPO(.SCTITL,132) Q:SCOUT
"RTN","SCRPO3",23,0)
 .S SCX="No provider position assignments found within selected report parameters!"
"RTN","SCRPO3",24,0)
 .W !!?(132-$L(SCX)\2),SCX
"RTN","SCRPO3",25,0)
 .Q
"RTN","SCRPO3",26,0)
 S SCPAGE=1
"RTN","SCRPO3",27,0)
 ;print detailed report
"RTN","SCRPO3",28,0)
 I SCFMT="D" S SCTITL(2)=$$HDRX("D") D HDR^SCRPO(.SCTITL,132),SHDR("D") Q:SCOUT  D
"RTN","SCRPO3",29,0)
 .S SC1=""
"RTN","SCRPO3",30,0)
 .F  S SC1=$O(^TMP("SCRPT",$J,1,SC1)) Q:SC1=""!SCOUT  D
"RTN","SCRPO3",31,0)
 ..S SC2=""
"RTN","SCRPO3",32,0)
 ..F  S SC2=$O(^TMP("SCRPT",$J,1,SC1,SC2)) Q:SC2=""!SCOUT  D
"RTN","SCRPO3",33,0)
 ...S SC3=""
"RTN","SCRPO3",34,0)
 ...F  S SC3=$O(^TMP("SCRPT",$J,1,SC1,SC2,SC3)) Q:SC3=""!SCOUT  D
"RTN","SCRPO3",35,0)
 ....S SCN=^TMP("SCRPT",$J,1,SC1,SC2,SC3),SC4=""
"RTN","SCRPO3",36,0)
 ....F  S SC4=$O(^TMP("SCRPT",$J,2,SCN,SC4)) Q:SC4=""!SCOUT  D
"RTN","SCRPO3",37,0)
 .....S SC5=""
"RTN","SCRPO3",38,0)
 .....F  S SC5=$O(^TMP("SCRPT",$J,2,SCN,SC4,SC5)) Q:SC5=""!SCOUT  D
"RTN","SCRPO3",39,0)
 ......S SC6=""
"RTN","SCRPO3",40,0)
 ......F  S SC6=$O(^TMP("SCRPT",$J,2,SCN,SC4,SC5,SC6)) Q:SC6=""!SCOUT  D
"RTN","SCRPO3",41,0)
 .......S SCX=^TMP("SCRPT",$J,2,SCN,SC4,SC5,SC6)
"RTN","SCRPO3",42,0)
 .......I $Y>(IOSL-11) D FOOT1,HDR^SCRPO(.SCTITL,132),SHDR("D") Q:SCOUT
"RTN","SCRPO3",43,0)
 .......S SCY="0^21^41^46^67^86^94^102^110^118^126" W !
"RTN","SCRPO3",44,0)
 .......F SCI=1:1:5 W ?($P(SCY,U,SCI)),$P(SCX,U,SCI)
"RTN","SCRPO3",45,0)
 .......F SCI=6:1:11 W ?($P(SCY,U,SCI)),$J($P(SCX,U,SCI),6,0)
"RTN","SCRPO3",46,0)
 ......Q
"RTN","SCRPO3",47,0)
 .....Q
"RTN","SCRPO3",48,0)
 ....Q
"RTN","SCRPO3",49,0)
 ...Q
"RTN","SCRPO3",50,0)
 ..Q
"RTN","SCRPO3",51,0)
 .D:'SCOUT FOOT1
"RTN","SCRPO3",52,0)
 .Q
"RTN","SCRPO3",53,0)
 G:SCOUT EXIT
"RTN","SCRPO3",54,0)
 ;print summary report
"RTN","SCRPO3",55,0)
 S SCTITL(2)=$$HDRX("S") D HDR^SCRPO(.SCTITL,132),SHDR("S") G:SCOUT EXIT
"RTN","SCRPO3",56,0)
 S (SCFD,SCDIV)=0
"RTN","SCRPO3",57,0)
 F  S SCDIV=$O(^TMP("SCRPT",$J,0,SCDIV)) Q:SCDIV=""!SCOUT  D
"RTN","SCRPO3",58,0)
 .S SCPC=$S($D(^TMP("SCRPT",$J,0,SCDIV,"PC")):"YES",1:"NO")
"RTN","SCRPO3",59,0)
 .S SCX=^TMP("SCRPT",$J,0,SCDIV)
"RTN","SCRPO3",60,0)
 .D:$Y>(IOSL-11) FOOT2,HDR^SCRPO(.SCTITL,132),SHDR("S") Q:SCOUT
"RTN","SCRPO3",61,0)
 .W:SCFD ! D SLINE(SCDIV,SCPC,SCX) S SCTEAM="",SCFD=1
"RTN","SCRPO3",62,0)
 .F  S SCTEAM=$O(^TMP("SCRPT",$J,0,SCDIV,1,SCTEAM)) Q:SCTEAM=""!SCOUT  D
"RTN","SCRPO3",63,0)
 ..S SCPC=$S($D(^TMP("SCRPT",$J,0,SCDIV,1,SCTEAM,"PC")):"YES",1:"NO")
"RTN","SCRPO3",64,0)
 ..S SCX=^TMP("SCRPT",$J,0,SCDIV,1,SCTEAM)
"RTN","SCRPO3",65,0)
 ..D:$Y>(IOSL-10) FOOT2,HDR^SCRPO(.SCTITL,132),SHDR("S") Q:SCOUT
"RTN","SCRPO3",66,0)
 ..D SLINE("  "_SCTEAM,SCPC,SCX)
"RTN","SCRPO3",67,0)
 ..Q
"RTN","SCRPO3",68,0)
 .Q
"RTN","SCRPO3",69,0)
 G:SCOUT EXIT
"RTN","SCRPO3",70,0)
 ;bp/djb Stop displaying PC? on Total line
"RTN","SCRPO3",71,0)
 ;Old code begin
"RTN","SCRPO3",72,0)
 ;S SCPC=$S($D(^TMP("SCRPT",$J,0,0,"PC")):"YES",1:"NO")
"RTN","SCRPO3",73,0)
 ;Old code end
"RTN","SCRPO3",74,0)
 ;New code begin
"RTN","SCRPO3",75,0)
 S SCPC=""
"RTN","SCRPO3",76,0)
 ;New code end
"RTN","SCRPO3",77,0)
 S SCX=^TMP("SCRPT",$J,0,0)
"RTN","SCRPO3",78,0)
 W ! D SLINE("REPORT TOTAL:",SCPC,SCX)
"RTN","SCRPO3",79,0)
 D FOOT2
"RTN","SCRPO3",80,0)
 ;
"RTN","SCRPO3",81,0)
EXIT I $E(IOST)="C",'$G(SCOUT) W ! N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPO3",82,0)
 F SCI="SC","SCARR","SCRPT" K ^TMP(SCI,$J)
"RTN","SCRPO3",83,0)
 K SC D END^SCRPW50 Q
"RTN","SCRPO3",84,0)
 ;
"RTN","SCRPO3",85,0)
SLINE(SCNAME,SCPC,SCX) ;Print report summary line
"RTN","SCRPO3",86,0)
 ;Input: SCNAME=division or team name to print
"RTN","SCRPO3",87,0)
 ;Input: SCPC=primary care y/n
"RTN","SCRPO3",88,0)
 ;Input: SCX=slot/assignment data
"RTN","SCRPO3",89,0)
 ;
"RTN","SCRPO3",90,0)
 W !?22,$P(SCNAME,U),?56,SCPC
"RTN","SCRPO3",91,0)
 F SCI=1:1:6 W ?(53+(8*SCI)),$J($P(SCX,U,SCI),6,0)
"RTN","SCRPO3",92,0)
 Q
"RTN","SCRPO3",93,0)
 ;
"RTN","SCRPO3",94,0)
HINI ;Initialize header variables
"RTN","SCRPO3",95,0)
 N Y
"RTN","SCRPO3",96,0)
 S SCTITL(1)="<*>  HISTORICAL PROVIDER POSITION ASSIGNMENT LISTING  <*>"
"RTN","SCRPO3",97,0)
 S SCLINE="",$P(SCLINE,"-",133)="",SCPAGE=1
"RTN","SCRPO3",98,0)
 S Y=$$NOW^XLFDT() X ^DD("DD") S SCPNOW=$P(Y,":",1,2)
"RTN","SCRPO3",99,0)
 Q
"RTN","SCRPO3",100,0)
 ;
"RTN","SCRPO3",101,0)
SHDR(SCX) ;Print report subheader
"RTN","SCRPO3",102,0)
 ;Input: SCX='D' for detail, 'S' for summary
"RTN","SCRPO3",103,0)
 Q:SCOUT
"RTN","SCRPO3",104,0)
 I SCX="S" D  Q
"RTN","SCRPO3",105,0)
 .W !?63,"Max.",?69,"---Assigned---",?93,"---Precepted--"
"RTN","SCRPO3",106,0)
 .W !?22,"Division",?63,"Pts.",?69,"---Patients---",?87,"Open"
"RTN","SCRPO3",107,0)
 .W ?93,"---Patients---",!?24,"Team",?56,"PC?  Allow.  PC"
"RTN","SCRPO3",108,0)
 .W ?77,"Non-PC   Slots  PC      Non-PC"
"RTN","SCRPO3",109,0)
 .W !?22,"--------------------------------  ---  ------  ------  ------  ------  ------  ------"
"RTN","SCRPO3",110,0)
 .Q
"RTN","SCRPO3",111,0)
 W !?88,"Max.  ---Assigned---",?118,"---Precepted--",!
"RTN","SCRPO3",112,0)
 W ?88,"Pts.  ---Patients---    Open  ---Patients---",!,"Provider Name"
"RTN","SCRPO3",113,0)
 W ?21,"Position",?41,"PC?  Team",?67,"Associated Clinic"
"RTN","SCRPO3",114,0)
 W ?86,"Allow.  PC      Non-PC   Slots  PC      Non-PC"
"RTN","SCRPO3",115,0)
 W !,"-------------------  ------------------  ---  -------------------  -----------------  ------  ------  ------  ------  ------  ------"
"RTN","SCRPO3",116,0)
 Q
"RTN","SCRPO3",117,0)
 ;
"RTN","SCRPO3",118,0)
HDRX(SCX) ;extra header line
"RTN","SCRPO3",119,0)
 ;Input: SCX='P' for parameters, 'D' for detail, 'S' for summary
"RTN","SCRPO3",120,0)
 Q:SCX="P" "Selected Report Parameters"
"RTN","SCRPO3",121,0)
 Q $S(SCX="D":"Detail",1:"Summary")_" for Provider Position Assignments Effective: "_^TMP("SC",$J,"DTR","PBDT")_" to "_^TMP("SC",$J,"DTR","PEDT")
"RTN","SCRPO3",122,0)
 ;
"RTN","SCRPO3",123,0)
STOP ;Check for stop task request
"RTN","SCRPO3",124,0)
 S:$D(ZTQUEUED) (SCOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPO3",125,0)
 ;
"RTN","SCRPO3",126,0)
BUILD(SCFMT) ;Build report data
"RTN","SCRPO3",127,0)
 ;Input: SCFMT=report format (detail or summary)
"RTN","SCRPO3",128,0)
 N SCTM,SCTP,SCPR,SCARR,ERR,SCI
"RTN","SCRPO3",129,0)
 ;Build from provider list
"RTN","SCRPO3",130,0)
 I $O(^TMP("SC",$J,"ASPR",0)) S SCPR=0 D  Q
"RTN","SCRPO3",131,0)
 .;Corrected variable name SCTP to SCPR SD*5.3*598
"RTN","SCRPO3",132,0)
 .F  S SCPR=$O(^TMP("SC",$J,"ASPR",SCPR)) Q:'SCPR!SCOUT  D
"RTN","SCRPO3",133,0)
 ..D STOP Q:SCOUT
"RTN","SCRPO3",134,0)
 ..M SCDT=^TMP("SC",$J,"DTR") S SCDT="SCDT"
"RTN","SCRPO3",135,0)
 ..S SCARR="^TMP(""SCARR"",$J,1)" K @SCARR
"RTN","SCRPO3",136,0)
 ..S SCI=$$TPPR^SCAPMC(SCPR,.SCDT,,,SCARR,"ERR")
"RTN","SCRPO3",137,0)
 ..S SCTM=0 F  S SCTM=$O(^TMP("SCARR",$J,1,"SCTP",SCTM)) Q:'SCTM  D
"RTN","SCRPO3",138,0)
 ...S SCTP=0 F  S SCTP=$O(^TMP("SCARR",$J,1,"SCTP",SCTM,SCTP)) Q:'SCTP  D
"RTN","SCRPO3",139,0)
 ....S ^TMP("SCARR",$J,0,SCTP)=""
"RTN","SCRPO3",140,0)
 ....Q
"RTN","SCRPO3",141,0)
 ...Q
"RTN","SCRPO3",142,0)
 ..Q
"RTN","SCRPO3",143,0)
 .S SCTP=0 F  S SCTP=$O(^TMP("SCARR",$J,0,SCTP)) Q:'SCTP!SCOUT  D
"RTN","SCRPO3",144,0)
 ..D CKPOS(SCTP,SCFMT),STOP
"RTN","SCRPO3",145,0)
 ..Q
"RTN","SCRPO3",146,0)
 .Q
"RTN","SCRPO3",147,0)
 ;Build from position list
"RTN","SCRPO3",148,0)
 I $O(^TMP("SC",$J,"POS",0)) S SCTP=0 D  Q
"RTN","SCRPO3",149,0)
 .F  S SCTP=$O(^TMP("SC",$J,"POS",SCTP)) Q:'SCTP!SCOUT  D
"RTN","SCRPO3",150,0)
 ..D CKPOS(SCTP,SCFMT),STOP
"RTN","SCRPO3",151,0)
 ..Q
"RTN","SCRPO3",152,0)
 .Q
"RTN","SCRPO3",153,0)
 ;Build from all positions
"RTN","SCRPO3",154,0)
 S SCTP=0 F  S SCTP=$O(^SCTM(404.57,SCTP)) Q:'SCTP!SCOUT  D
"RTN","SCRPO3",155,0)
 .D CKPOS(SCTP,SCFMT),STOP
"RTN","SCRPO3",156,0)
 .Q
"RTN","SCRPO3",157,0)
 Q
"RTN","SCRPO3",158,0)
 ;
"RTN","SCRPO3",159,0)
CKPOS(SCTP,SCFMT) ;Check team position
"RTN","SCRPO3",160,0)
 ;Input: SCTP=TEAM POSITION ifn
"RTN","SCRPO3",161,0)
 ;Input: SCFMT=report format (detail or summary)
"RTN","SCRPO3",162,0)
 ;
"RTN","SCRPO3",163,0)
 N SCDIV,SCTEAM,SCPOS,SCLINIC,SCTP0,SCX
"RTN","SCRPO3",164,0)
 S SCTP0=$G(^SCTM(404.57,+SCTP,0)) Q:'$L(SCTP0)
"RTN","SCRPO3",165,0)
 S SCX=$P(SCTP0,U) Q:'$L(SCX)
"RTN","SCRPO3",166,0)
 S SCPOS=SCX_U_SCTP
"RTN","SCRPO3",167,0)
 S SCTEAM=$P(SCTP0,U,2) Q:'$$TMDV^SCRPO1(.SCTEAM,.SCDIV)
"RTN","SCRPO3",168,0)
 S SCLINIC=$P(SCTP0,U,9) Q:'$$TPCL^SCRPO1(.SCLINIC)
"RTN","SCRPO3",169,0)
 D BTPOS(SCTP,SCDIV,SCTEAM,SCPOS,SCLINIC,SCFMT)
"RTN","SCRPO3",170,0)
 Q
"RTN","SCRPO3",171,0)
 ;
"RTN","SCRPO3",172,0)
BTPOS(SCTP,SCDIV,SCTEAM,SCPOS,SCLINIC,SCFMT) ;Build from team position
"RTN","SCRPO3",173,0)
 ;Input: SCTP=team position ifn
"RTN","SCRPO3",174,0)
 ;Input: SCDIV=division^ifn
"RTN","SCRPO3",175,0)
 ;Input: SCTEAM=team^ifn
"RTN","SCRPO3",176,0)
 ;Input: SCPOS=team position^ifn
"RTN","SCRPO3",177,0)
 ;Input: SCLINIC=associated clinic^ifn (if one exists)
"RTN","SCRPO3",178,0)
 ;Input: SCFMT=report format (detail or summary)
"RTN","SCRPO3",179,0)
 ;
"RTN","SCRPO3",180,0)
 N SCARR,SCDT,SCI,SCPASS,ERR
"RTN","SCRPO3",181,0)
 S SCARR="^TMP(""SCARR"",$J,1)" K @SCARR
"RTN","SCRPO3",182,0)
 M SCDT=^TMP("SC",$J,"DTR") S SCDT="SCDT"
"RTN","SCRPO3",183,0)
 S SCI=$$PRTP^SCAPMC(SCTP,.SCDT,SCARR,"ERR",0,0),SCI=0
"RTN","SCRPO3",184,0)
 F  S SCI=$O(^TMP("SCARR",$J,1,SCI)) Q:'SCI  D
"RTN","SCRPO3",185,0)
 .S SCPASS=^TMP("SCARR",$J,1,SCI)
"RTN","SCRPO3",186,0)
 .D BPRPA^SCRPO4(SCPASS,SCDIV,SCTEAM,SCPOS,SCLINIC,SCFMT)
"RTN","SCRPO3",187,0)
 .Q
"RTN","SCRPO3",188,0)
 Q
"RTN","SCRPO3",189,0)
 ;
"RTN","SCRPO3",190,0)
FOOT1 ;Detail report footer
"RTN","SCRPO3",191,0)
 N SCI
"RTN","SCRPO3",192,0)
 F SCI=1:1:80 W ! Q:$Y>(IOSL-9)
"RTN","SCRPO3",193,0)
 W !,SCLINE
"RTN","SCRPO3",194,0)
 W !,"NOTE: This report reflects a count of all unique patients assigned to Primary Care and non-Primary Care within the date range"
"RTN","SCRPO3",195,0)
 W !?6,"selected.  If a date range larger than one day has been selected, the total patients assigned to a provider may be greater"
"RTN","SCRPO3",196,0)
 W !?6,"than the maximum defined for the position.  However, this does not imply that the provider had more than their maximum"
"RTN","SCRPO3",197,0)
 W !?6,"number of patients on any single date."
"RTN","SCRPO3",198,0)
 W !,SCLINE
"RTN","SCRPO3",199,0)
 Q
"RTN","SCRPO3",200,0)
 ;
"RTN","SCRPO3",201,0)
FOOT2 ;Summary report footer
"RTN","SCRPO3",202,0)
 N SCI
"RTN","SCRPO3",203,0)
 F SCI=1:1:80 W ! Q:$Y>(IOSL-8)
"RTN","SCRPO3",204,0)
 W !,SCLINE
"RTN","SCRPO3",205,0)
 W !,"NOTE: Although presented by division and team, the maximum patients allowed, assigned patients, open slots and precepted patients"
"RTN","SCRPO3",206,0)
 W !?6,"reflected in this summary represent a sum of those categories for the provider position assignments identified within the"
"RTN","SCRPO3",207,0)
 W !?6,"user specified parameters of this report and may not match the maximum patients, etc. defined for the team as a whole."
"RTN","SCRPO3",208,0)
 W !,SCLINE
"RTN","SCRPO3",209,0)
 Q
"VER")
8.0^22.0
**END**
**END**
