Released SD*5.3*589 SEQ #493
Extracted from mail message
**KIDS**:SD*5.3*589^

**INSTALL NAME**
SD*5.3*589
"BLD",8027,0)
SD*5.3*589^SCHEDULING^0^3121121^y
"BLD",8027,4,0)
^9.64PA^404.61^1
"BLD",8027,4,404.61,0)
404.61
"BLD",8027,4,404.61,222)
y^n^f^^^^n^^
"BLD",8027,4,404.61,224)

"BLD",8027,4,"B",404.61,404.61)

"BLD",8027,6)
18^
"BLD",8027,6.3)
41
"BLD",8027,"ABNS",0)
^9.66A^^
"BLD",8027,"ABPKG")
n^n
"BLD",8027,"INID")
^n
"BLD",8027,"INIT")
SD53589P
"BLD",8027,"KRN",0)
^9.67PA^779.2^20
"BLD",8027,"KRN",.4,0)
.4
"BLD",8027,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",8027,"KRN",.401,0)
.401
"BLD",8027,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",8027,"KRN",.402,0)
.402
"BLD",8027,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",8027,"KRN",.403,0)
.403
"BLD",8027,"KRN",.5,0)
.5
"BLD",8027,"KRN",.5,"NM",0)
^9.68A^^0
"BLD",8027,"KRN",.84,0)
.84
"BLD",8027,"KRN",3.6,0)
3.6
"BLD",8027,"KRN",3.6,"NM",0)
^9.68A^^0
"BLD",8027,"KRN",3.8,0)
3.8
"BLD",8027,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",8027,"KRN",9.2,0)
9.2
"BLD",8027,"KRN",9.2,"NM",0)
^9.68A^^0
"BLD",8027,"KRN",9.8,0)
9.8
"BLD",8027,"KRN",9.8,"NM",0)
^9.68A^9^8
"BLD",8027,"KRN",9.8,"NM",1,0)
SCMCMHPP^^0^B88195737
"BLD",8027,"KRN",9.8,"NM",2,0)
SCMCMHP2^^0^B72814610
"BLD",8027,"KRN",9.8,"NM",3,0)
SCMCMHHP^^0^B30383570
"BLD",8027,"KRN",9.8,"NM",4,0)
SCMCMHHT^^0^B70999794
"BLD",8027,"KRN",9.8,"NM",5,0)
SCMCMHE^^0^B26498569
"BLD",8027,"KRN",9.8,"NM",7,0)
SCMCMHU1^^0^B29225057
"BLD",8027,"KRN",9.8,"NM",8,0)
SCMCMHO7^^0^B50655147
"BLD",8027,"KRN",9.8,"NM",9,0)
SD53589P^^0^B14073216
"BLD",8027,"KRN",9.8,"NM","B","SCMCMHE",5)

"BLD",8027,"KRN",9.8,"NM","B","SCMCMHHP",3)

"BLD",8027,"KRN",9.8,"NM","B","SCMCMHHT",4)

"BLD",8027,"KRN",9.8,"NM","B","SCMCMHO7",8)

"BLD",8027,"KRN",9.8,"NM","B","SCMCMHP2",2)

"BLD",8027,"KRN",9.8,"NM","B","SCMCMHPP",1)

"BLD",8027,"KRN",9.8,"NM","B","SCMCMHU1",7)

"BLD",8027,"KRN",9.8,"NM","B","SD53589P",9)

"BLD",8027,"KRN",19,0)
19
"BLD",8027,"KRN",19,"NM",0)
^9.68A^7^5
"BLD",8027,"KRN",19,"NM",1,0)
SCMC MH PCMM CLINICIAN PAT RPT^^0
"BLD",8027,"KRN",19,"NM",2,0)
SCMC MH PCMM ENCOUNTER RPT^^0
"BLD",8027,"KRN",19,"NM",4,0)
SCMC MH PCMM HIST PAT RPT^^0
"BLD",8027,"KRN",19,"NM",6,0)
SCMC MH PCMM RPT MENU^^0
"BLD",8027,"KRN",19,"NM",7,0)
SCMC MH PCMM HIST TEAM SUMMARY^^0
"BLD",8027,"KRN",19,"NM","B","SCMC MH PCMM CLINICIAN PAT RPT",1)

"BLD",8027,"KRN",19,"NM","B","SCMC MH PCMM ENCOUNTER RPT",2)

"BLD",8027,"KRN",19,"NM","B","SCMC MH PCMM HIST PAT RPT",4)

"BLD",8027,"KRN",19,"NM","B","SCMC MH PCMM HIST TEAM SUMMARY",7)

"BLD",8027,"KRN",19,"NM","B","SCMC MH PCMM RPT MENU",6)

"BLD",8027,"KRN",19.1,0)
19.1
"BLD",8027,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",8027,"KRN",101,0)
101
"BLD",8027,"KRN",101,"NM",0)
^9.68A^^0
"BLD",8027,"KRN",409.61,0)
409.61
"BLD",8027,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",8027,"KRN",771,0)
771
"BLD",8027,"KRN",779.2,0)
779.2
"BLD",8027,"KRN",870,0)
870
"BLD",8027,"KRN",8989.51,0)
8989.51
"BLD",8027,"KRN",8989.52,0)
8989.52
"BLD",8027,"KRN",8994,0)
8994
"BLD",8027,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",8027,"KRN","B",.4,.4)

"BLD",8027,"KRN","B",.401,.401)

"BLD",8027,"KRN","B",.402,.402)

"BLD",8027,"KRN","B",.403,.403)

"BLD",8027,"KRN","B",.5,.5)

"BLD",8027,"KRN","B",.84,.84)

"BLD",8027,"KRN","B",3.6,3.6)

"BLD",8027,"KRN","B",3.8,3.8)

"BLD",8027,"KRN","B",9.2,9.2)

"BLD",8027,"KRN","B",9.8,9.8)

"BLD",8027,"KRN","B",19,19)

"BLD",8027,"KRN","B",19.1,19.1)

"BLD",8027,"KRN","B",101,101)

"BLD",8027,"KRN","B",409.61,409.61)

"BLD",8027,"KRN","B",771,771)

"BLD",8027,"KRN","B",779.2,779.2)

"BLD",8027,"KRN","B",870,870)

"BLD",8027,"KRN","B",8989.51,8989.51)

"BLD",8027,"KRN","B",8989.52,8989.52)

"BLD",8027,"KRN","B",8994,8994)

"BLD",8027,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8027,"QUES",0)
^9.62^^
"BLD",8027,"REQB",0)
^9.611^2^2
"BLD",8027,"REQB",1,0)
SD*5.3*575^1
"BLD",8027,"REQB",2,0)
SD*5.3*596^1
"BLD",8027,"REQB","B","SD*5.3*575",1)

"BLD",8027,"REQB","B","SD*5.3*596",2)

"FIA",404.61)
MH PCMM STOP CODES
"FIA",404.61,0)
^SCTM(404.61,
"FIA",404.61,0,0)
404.61P
"FIA",404.61,0,1)
y^n^f^^^^n^^
"FIA",404.61,0,10)

"FIA",404.61,0,11)

"FIA",404.61,0,"RLRO")

"FIA",404.61,0,"VR")
5.3^SD
"FIA",404.61,404.61)
0
"INIT")
SD53589P
"KRN",19,2920914,-1)
0^7
"KRN",19,2920914,0)
SCMC MH PCMM HIST TEAM SUMMARY^MH Historical Team Assignment Summary Report^^R^^^^^^^^SCHEDULING
"KRN",19,2920914,1,0)
^19.06^2^2^3120329^^^^
"KRN",19,2920914,1,1,0)
This report will display Mental Health PCMM Team Assignment
"KRN",19,2920914,1,2,0)
 history. The report is a summary of the assignment history.
"KRN",19,2920914,25)
SCMCMHHT
"KRN",19,2920914,"U")
MH HISTORICAL TEAM ASSIGNMENT 
"KRN",19,2920915,-1)
0^4
"KRN",19,2920915,0)
SCMC MH PCMM HIST PAT RPT^MH Historical Patient Assignment Detail Report^^R^^^^^^^^SCHEDULING
"KRN",19,2920915,1,0)
^19.06^2^2^3120329^^^
"KRN",19,2920915,1,1,0)
This report is a history of Mental Health patient assignments
"KRN",19,2920915,1,2,0)
 within PCMM.
"KRN",19,2920915,25)
SCMCMHHP
"KRN",19,2920915,"U")
MH HISTORICAL PATIENT ASSIGNME
"KRN",19,2920917,-1)
0^2
"KRN",19,2920917,0)
SCMC MH PCMM ENCOUNTER RPT^MH Encounter Report^^R^^^^^^^^
"KRN",19,2920917,1,0)
^19.06^3^3^3120329^^
"KRN",19,2920917,1,1,0)
This report will allow for the identification of patients who need a MH
"KRN",19,2920917,1,2,0)
assignment.  This will be done using DSS Identifiers to determine if a
"KRN",19,2920917,1,3,0)
patient has been seen in a MH clinic.
"KRN",19,2920917,25)
SCMCMHE
"KRN",19,2920917,"U")
MH ENCOUNTER REPORT
"KRN",19,2920918,-1)
0^1
"KRN",19,2920918,0)
SCMC MH PCMM CLINICIAN PAT RPT^MH Clinician's Patient Report^^R^^^^^^^^
"KRN",19,2920918,1,0)
^19.06^2^2^3120329^^
"KRN",19,2920918,1,1,0)
This report identifies the size and constituents of a Mental Health
"KRN",19,2920918,1,2,0)
Clinician within PCMM.
"KRN",19,2920918,25)
SCMCMHPP
"KRN",19,2920918,99.1)
62577,85918
"KRN",19,2920918,"U")
MH CLINICIAN'S PATIENT REPORT
"KRN",19,2920919,-1)
0^6
"KRN",19,2920919,0)
SCMC MH PCMM RPT MENU^MH PCMM Report Menu^^M^^^^^^^^SCHEDULING
"KRN",19,2920919,1,0)
^19.06^1^1^3120920^^^^
"KRN",19,2920919,1,1,0)
Mental Health PCMM Reort Menu.
"KRN",19,2920919,10,0)
^19.01IP^4^4
"KRN",19,2920919,10,1,0)
2920918^1
"KRN",19,2920919,10,1,"^")
SCMC MH PCMM CLINICIAN PAT RPT
"KRN",19,2920919,10,2,0)
2920915^3
"KRN",19,2920919,10,2,"^")
SCMC MH PCMM HIST PAT RPT
"KRN",19,2920919,10,3,0)
2920914^4
"KRN",19,2920919,10,3,"^")
SCMC MH PCMM HIST TEAM SUMMARY
"KRN",19,2920919,10,4,0)
2920917^2
"KRN",19,2920919,10,4,"^")
SCMC MH PCMM ENCOUNTER RPT
"KRN",19,2920919,99)
62763,19047
"KRN",19,2920919,99.1)
62535,48346
"KRN",19,2920919,"U")
MH PCMM REPORT MENU
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930930
"PKG",16,22,1,"PAH",1,0)
589^3121121^520665223
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","SCMCMHE")
0^5^B26498569^n/a
"RTN","SCMCMHE",1,0)
SCMCMHE ;BP/DMR - PCMM Mental Health Report; 8 FEB 12
"RTN","SCMCMHE",2,0)
 ;;5.3;Scheduling;**589**;AUG 13, 1993;Build 41
"RTN","SCMCMHE",3,0)
 ;
"RTN","SCMCMHE",4,0)
 ;Report to identify MH patients to load into PCMM. The report
"RTN","SCMCMHE",5,0)
 ;uses the Outpatient Encounter file and CPT codes to identify the
"RTN","SCMCMHE",6,0)
 ;MH patients.
"RTN","SCMCMHE",7,0)
 ;
"RTN","SCMCMHE",8,0)
 ;Input - Beginning & Ending Date
"RTN","SCMCMHE",9,0)
 ;        Institution (1 or all (all being 3 digit parent station)
"RTN","SCMCMHE",10,0)
 ;        Number of Mental Health Stop Codes to search for in the given timeframe
"RTN","SCMCMHE",11,0)
 ;
"RTN","SCMCMHE",12,0)
 ;Output - Pat.Name^SSN(Last4)^days since last encounter^Future Appointment date/location
"RTN","SCMCMHE",13,0)
 ;         ^Encounter Date^Clinic Name^ Location of Encounter
"RTN","SCMCMHE",14,0)
INIT ;
"RTN","SCMCMHE",15,0)
 K ^TMP("MHEN",$J)
"RTN","SCMCMHE",16,0)
 K ^TMP("MHEN1",$J)
"RTN","SCMCMHE",17,0)
 ;
"RTN","SCMCMHE",18,0)
DATE ;
"RTN","SCMCMHE",19,0)
 S (BEG,END,DATE)=""
"RTN","SCMCMHE",20,0)
 ;
"RTN","SCMCMHE",21,0)
 W !!,"This report should be run during non peak hours and can take hours to run!",!!
"RTN","SCMCMHE",22,0)
 ;
"RTN","SCMCMHE",23,0)
 S %DT="AE",%DT("A")="Enter BEGINNING Date: " D ^%DT G EXIT:Y<0 S BEG=Y
"RTN","SCMCMHE",24,0)
 S %DT="AE",%DT("A")="Enter ENDING Date: " D ^%DT G EXIT:Y<0 S END=Y
"RTN","SCMCMHE",25,0)
 I BEG>END W !,"Beginning date must be before end date!" G DATE
"RTN","SCMCMHE",26,0)
 ;
"RTN","SCMCMHE",27,0)
INST ;
"RTN","SCMCMHE",28,0)
 S (INST,DEF,IN)=""
"RTN","SCMCMHE",29,0)
 S DIC=4,DIC(0)="AQMEZ",DIC("A")="Select Institution: " D ^DIC
"RTN","SCMCMHE",30,0)
 I Y=-1 G EXIT
"RTN","SCMCMHE",31,0)
 S IN=$P(Y,"^") S INST=$$GET1^DIQ(4,IN,99) I $L(INST)=3 S INST="ALL"
"RTN","SCMCMHE",32,0)
 I $L(INST)>3 S INST=$P(Y,"^",2)
"RTN","SCMCMHE",33,0)
EN ;
"RTN","SCMCMHE",34,0)
 S DEF=3
"RTN","SCMCMHE",35,0)
 R !!,"Enter number of Outpatient Encounters (1 to 10): 3// ",DEF:30
"RTN","SCMCMHE",36,0)
 S:DEF="" DEF=3 I DEF="^" G EXIT
"RTN","SCMCMHE",37,0)
 I DEF>10!(DEF<1) W !,"Enter Number from 1 to 10 or '^' to Exit!" G EN
"RTN","SCMCMHE",38,0)
 ;
"RTN","SCMCMHE",39,0)
 S %ZIS="Q" D ^%ZIS G:POP EXIT
"RTN","SCMCMHE",40,0)
 I $D(IO("Q")) S ZTRTN="PRT^SCMCMHE",ZTSAVE("*")="" D ^%ZTLOAD K ZTRTN,ZTSAVE G EXIT
"RTN","SCMCMHE",41,0)
 I '$D(IO("Q")) U IO
"RTN","SCMCMHE",42,0)
 ;
"RTN","SCMCMHE",43,0)
PRT ;
"RTN","SCMCMHE",44,0)
 D LOOP
"RTN","SCMCMHE",45,0)
 D SAVE
"RTN","SCMCMHE",46,0)
 ;
"RTN","SCMCMHE",47,0)
 W "Patient^SSN(Last4)^Days Since Last Encounter^Future Appointment Date^Location^Encounter Date^Clinic Name^Location of Encounter"
"RTN","SCMCMHE",48,0)
 ;
"RTN","SCMCMHE",49,0)
 S (DTE,DTE2,IEN,DFN,CC)=""
"RTN","SCMCMHE",50,0)
 S DTE="" F  S DTE=$O(^TMP("MHEN",$J,DTE)) Q:DTE=""  D
"RTN","SCMCMHE",51,0)
 .S DFN="" F  S DFN=$O(^TMP("MHEN",$J,DTE,DFN)) Q:DFN=""  D
"RTN","SCMCMHE",52,0)
 ..W !,^TMP("MHEN",$J,DTE,DFN)
"RTN","SCMCMHE",53,0)
 ..S DTE2="" F  S DTE2=$O(^TMP("MHEN1",$J,DFN,DTE2)) Q:DTE2=""  D
"RTN","SCMCMHE",54,0)
 ...S CC="" F  S CC=$O(^TMP("MHEN1",$J,DFN,DTE2,CC)) Q:CC=""  D
"RTN","SCMCMHE",55,0)
 ....W ^TMP("MHEN1",$J,DFN,DTE2,CC)
"RTN","SCMCMHE",56,0)
 ....Q
"RTN","SCMCMHE",57,0)
 D ^%ZISC
"RTN","SCMCMHE",58,0)
 G EXIT
"RTN","SCMCMHE",59,0)
 Q
"RTN","SCMCMHE",60,0)
 ;
"RTN","SCMCMHE",61,0)
LOOP ;
"RTN","SCMCMHE",62,0)
 S (EN,ENC,ESC,ECL,JJ,CSC,CLIN,SC,SCIEN,EIEN,IEN,DFN,MHSC,MHTC,FAC,HOLD,HDT,HDT2,CODE,SCODE,SSTOP)=""
"RTN","SCMCMHE",63,0)
 S CC=0,END=END+.999999
"RTN","SCMCMHE",64,0)
 S DFN="" F  S DFN=$O(^SCE("C",DFN)) Q:DFN=""  D
"RTN","SCMCMHE",65,0)
 .Q:$$GET1^DIQ(2,DFN,.351)'=""
"RTN","SCMCMHE",66,0)
 .S MHTC="" S MHTC=$$START^SCMCMHTC(DFN) Q:MHTC'=""
"RTN","SCMCMHE",67,0)
 .I CC'=DEF&(DFN'=HOLD) D FORMAT
"RTN","SCMCMHE",68,0)
 .S CC=0,EIEN="" F  S EIEN=$O(^SCE("C",DFN,EIEN)) Q:EIEN=""!(CC=DEF)  D
"RTN","SCMCMHE",69,0)
 ..S DATE="",DATE=$$GET1^DIQ(409.68,EIEN,.01,"I") Q:DATE=""
"RTN","SCMCMHE",70,0)
 ..Q:DATE<BEG!(DATE>END)
"RTN","SCMCMHE",71,0)
 ..Q:$E(HDT2,1,7)=$E(DATE,1,7)&(DFN=HOLD)
"RTN","SCMCMHE",72,0)
 ..Q:$$GET1^DIQ(409.68,EIEN,.12,"I")'=2
"RTN","SCMCMHE",73,0)
 ..S FAC="" S FAC=$$GET1^DIQ(409.68,EIEN,.11)
"RTN","SCMCMHE",74,0)
 ..Q:INST'="ALL"&(FAC'=INST)
"RTN","SCMCMHE",75,0)
 ..S SCIEN="",SCIEN=$$GET1^DIQ(409.68,EIEN,.03,"I") Q:SCIEN=""
"RTN","SCMCMHE",76,0)
 ..S MHSC="" F  S MHSC=$O(^SCTM(404.61,"B",SCIEN,MHSC)) Q:MHSC=""  D
"RTN","SCMCMHE",77,0)
 ...Q:$D(^SCTM(404.61,"AC","1",MHSC))
"RTN","SCMCMHE",78,0)
 ...S (ECL,SSTOP)="" S ECL=$$GET1^DIQ(409.68,EIEN,.04,"I")
"RTN","SCMCMHE",79,0)
 ...I ECL'="" S CSC="" S CSC=$$GET1^DIQ(44,ECL,2503,"I")
"RTN","SCMCMHE",80,0)
 ...I CSC'="" S SSC="" F  S SSC=$O(^SCTM(404.61,"B",CSC,SSC)) Q:SSC=""!(SSTOP=1)  D
"RTN","SCMCMHE",81,0)
 ....I $D(^SCTM(404.61,"AC","1",SSC)) S SSTOP=1
"RTN","SCMCMHE",82,0)
 ...Q:SSTOP=1
"RTN","SCMCMHE",83,0)
 ...S CLIN="" S CLIN=$$GET1^DIQ(409.68,EIEN,.04)
"RTN","SCMCMHE",84,0)
 ...S CC=CC+1
"RTN","SCMCMHE",85,0)
 ...I CC=1 S (HDT,HDT2)="" S HDT=DATE D
"RTN","SCMCMHE",86,0)
 ....S ^TMP("MHEN",$J,DATE,DFN)=""
"RTN","SCMCMHE",87,0)
 ....S ^TMP("MHEN1",$J,DFN,DATE,CC)="^"_CLIN_"^"_FAC_"^"
"RTN","SCMCMHE",88,0)
 ...I CC>1 S ^TMP("MHEN1",$J,DFN,DATE,CC)="^"_CLIN_"^"_FAC_"^"
"RTN","SCMCMHE",89,0)
 ...S HOLD=DFN,HDT2=DATE
"RTN","SCMCMHE",90,0)
 ...Q
"RTN","SCMCMHE",91,0)
 Q
"RTN","SCMCMHE",92,0)
FORMAT ;
"RTN","SCMCMHE",93,0)
 Q:HOLD=""!(CC=0)
"RTN","SCMCMHE",94,0)
 Q:HDT="" 
"RTN","SCMCMHE",95,0)
 K ^TMP("MHEN",$J,HDT,HOLD)
"RTN","SCMCMHE",96,0)
 K ^TMP("MHEN1",$J,HOLD)
"RTN","SCMCMHE",97,0)
 Q
"RTN","SCMCMHE",98,0)
SAVE ; 
"RTN","SCMCMHE",99,0)
 S (DFN,IEN,EN,LEN,PN,SSN,DTE,DTE2,EDT,LTE,CC,DAYS)=""
"RTN","SCMCMHE",100,0)
 S DTE="" F  S DTE=$O(^TMP("MHEN",$J,DTE)) Q:DTE=""  D
"RTN","SCMCMHE",101,0)
 .S DFN="" F  S DFN=$O(^TMP("MHEN",$J,DTE,DFN)) Q:DFN=""  D
"RTN","SCMCMHE",102,0)
 ..S PN="" S PN=$$GET1^DIQ(2,DFN,.01)
"RTN","SCMCMHE",103,0)
 ..S SSN="" S SSN=$$GET1^DIQ(2,DFN,.09,"I") I SSN'="" S SSN=$E(SSN,6,9)
"RTN","SCMCMHE",104,0)
 ..S Y=DTE X ^DD("DD") S EDT=Y
"RTN","SCMCMHE",105,0)
 ..S $P(^TMP("MHEN",$J,DTE,DFN),"^",6)=""
"RTN","SCMCMHE",106,0)
 ..S $P(^TMP("MHEN",$J,DTE,DFN),"^",1)=PN
"RTN","SCMCMHE",107,0)
 ..S $P(^TMP("MHEN",$J,DTE,DFN),"^",2)=SSN
"RTN","SCMCMHE",108,0)
 ..S DTE2="" F  S DTE2=$O(^TMP("MHEN1",$J,DFN,DTE2)) Q:DTE2=""  D
"RTN","SCMCMHE",109,0)
 ...S CC="" F  S CC=$O(^TMP("MHEN1",$J,DFN,DTE2,CC)) Q:CC=""  D
"RTN","SCMCMHE",110,0)
 ....S Y=DTE2 X ^DD("DD") S EDT=Y
"RTN","SCMCMHE",111,0)
 ....S $P(^TMP("MHEN1",$J,DFN,DTE2,CC),"^",1)=EDT
"RTN","SCMCMHE",112,0)
 ....I CC=DEF S X1=DT,X2=DTE D ^%DTC S DAYS=X
"RTN","SCMCMHE",113,0)
 ....S $P(^TMP("MHEN",$J,DTE,DFN),"^",3)=DAYS
"RTN","SCMCMHE",114,0)
 ....D FUT
"RTN","SCMCMHE",115,0)
 ....Q
"RTN","SCMCMHE",116,0)
 Q
"RTN","SCMCMHE",117,0)
FUT ;
"RTN","SCMCMHE",118,0)
 S (SC,ST,ADT,DTT,CL)="" S DTT=DT
"RTN","SCMCMHE",119,0)
 F  S DTT=$O(^DPT(DFN,"S",DTT)) Q:DTT=""!(ADT'="")  D
"RTN","SCMCMHE",120,0)
 .I DTT>DT S ST="" S ST=$$GET1^DIQ(2.98,DTT_","_DFN_",",3)
"RTN","SCMCMHE",121,0)
 .Q:ST'=""  S ADT="" S Y=DTT X ^DD("DD") S ADT=Y
"RTN","SCMCMHE",122,0)
 .S CL="" S CL=$$GET1^DIQ(2.98,DTT_","_DFN_",",.01)
"RTN","SCMCMHE",123,0)
 .S $P(^TMP("MHEN",$J,DTE,DFN),"^",4)=ADT
"RTN","SCMCMHE",124,0)
 .S $P(^TMP("MHEN",$J,DTE,DFN),"^",5)=CL
"RTN","SCMCMHE",125,0)
 .Q
"RTN","SCMCMHE",126,0)
 Q
"RTN","SCMCMHE",127,0)
EXIT ;
"RTN","SCMCMHE",128,0)
 K BEG,CC,CH,CL,END,DATE,SC,SCIEN,INST,DEF,IN,EN,ENC,JJ,PAT,DEF,DTE,DTE2,LEN
"RTN","SCMCMHE",129,0)
 K APP,ADT,CLIN,SC,EIEN,IEN,DFN,MHSC,MHTC,FAC,ST,DTT,DATE,DAYS,EDT,HDT,SSTOP
"RTN","SCMCMHE",130,0)
 K PN,SSN,X,X1,POP,LTE,HOLD,X2,Y,HDT2,DIC,ENC,ECL,CSC,CODE,SCODE,ESC,SSC
"RTN","SCMCMHE",131,0)
 K ^TMP("MHEN",$J)
"RTN","SCMCMHE",132,0)
 K ^TMP("MHEN1",$J)
"RTN","SCMCMHE",133,0)
 Q
"RTN","SCMCMHHP")
0^3^B30383570^n/a
"RTN","SCMCMHHP",1,0)
SCMCMHHP ;BP-CIOFO/KEITH - Historical Patient Assignment Detail ; 23 Feb 12  3:30 PM
"RTN","SCMCMHHP",2,0)
 ;;5.3;Scheduling;**589**;AUG 13, 1993;Build 41
"RTN","SCMCMHHP",3,0)
 ;
"RTN","SCMCMHHP",4,0)
 ;  llh - copy of SCRPO5 with changes for Mental Health patients
"RTN","SCMCMHHP",5,0)
 ;
"RTN","SCMCMHHP",6,0)
PTDET N DIC,SC,DFN,SCPT0,X,Y,SCDT,DTOUT,DUOUT
"RTN","SCMCMHHP",7,0)
 D TITL^SCRPW50("Mental Health Historical Patient Assignment Detail")
"RTN","SCMCMHHP",8,0)
 S DIC="^DPT(",DIC(0)="AEMQZ" D ^DIC I $D(DTOUT)!$D(DUOUT) G EXIT
"RTN","SCMCMHHP",9,0)
 G:Y<1 EXIT S DFN=+Y,SCPT0=Y(0),SC="SC",SCDT("B")="TODAY"
"RTN","SCMCMHHP",10,0)
 G:'$$DTR^SCRPO(.SC,.SCDT,.SCDT) EXIT
"RTN","SCMCMHHP",11,0)
 ; Patch 589 - added screen to allow only Patients assigned on a team whose
"RTN","SCMCMHHP",12,0)
 ; TEAM PURPOSE equals "MENTAL HEALTH TREATMENT" to be selected.
"RTN","SCMCMHHP",13,0)
 I '$$MHTEAM(DFN) D  G PTDET
"RTN","SCMCMHHP",14,0)
 .K DIR S DIR(0)="FO^1^1"
"RTN","SCMCMHHP",15,0)
 .S DIR("A",1)="No Mental Health Team Assignments for this patient during"
"RTN","SCMCMHHP",16,0)
 .S DIR("A")="this time period.  Press the return key to continue"
"RTN","SCMCMHHP",17,0)
 .W ! D ^DIR K DIR
"RTN","SCMCMHHP",18,0)
 ;
"RTN","SCMCMHHP",19,0)
 N ZTSAVE F X="DFN","SCPT0","SC(" S ZTSAVE(X)=""
"RTN","SCMCMHHP",20,0)
 W ! D EN^XUTMDEVQ("RUN^SCMCMHHP","Historical Patient Assignment Detail",.ZTSAVE)
"RTN","SCMCMHHP",21,0)
EXIT D DISP0^SCRPW23,END^SCRPW50 Q
"RTN","SCMCMHHP",22,0)
 ;
"RTN","SCMCMHHP",23,0)
RUN ;Print report
"RTN","SCMCMHHP",24,0)
 N SCI,SCPNOW,SCLINE,SCPAGE,SCSUB,SCFF,SCFOUND,SCLN,SCAGE,SCDATA
"RTN","SCMCMHHP",25,0)
 N SCDOB,SCGEND,SCIFN,SCOUT,SCPNAME,SCREC,SCSH,SCSSN,SCTITL,SCDT
"RTN","SCMCMHHP",26,0)
 N SCEU,SCEUNM,SCLEBNM,SCLEDT,SCSTAT,SCSTNM,SCX,SCY
"RTN","SCMCMHHP",27,0)
 K ^TMP("SCRPT",$J) M SCDT=SC("DTR") S SCDT="SCDT"
"RTN","SCMCMHHP",28,0)
 S SCI=$$GETALL^SCAPMCA(DFN,.SCDT),SCSUB="",(SCFF,SCLN,SCFOUND,SCOUT)=0
"RTN","SCMCMHHP",29,0)
 F  S SCSUB=$O(^TMP("SC",$J,DFN,SCSUB)) Q:SCSUB=""!(SCSUB]"PCTM")  D
"RTN","SCMCMHHP",30,0)
 .S SCX=$P($T(@SCSUB),";;",2) F SCI=1:1:9 S SCX(SCI)=$P(SCX,U,SCI)
"RTN","SCMCMHHP",31,0)
 .S ^TMP("SCRPT",$J,SCX(1))=SCX(2),SCX(3)=U_SCX(3)
"RTN","SCMCMHHP",32,0)
 .S SCI=0 F  S SCI=$O(^TMP("SC",$J,DFN,SCSUB,SCI)) Q:'SCI  D
"RTN","SCMCMHHP",33,0)
 ..S SCDATA=^TMP("SC",$J,DFN,SCSUB,SCI)
"RTN","SCMCMHHP",34,0)
 ..S SCNAME=$P(SCDATA,U,SCX(8))  ;provider/position/team name
"RTN","SCMCMHHP",35,0)
 ..S SCIFN=$P(SCDATA,U,SCX(4))  ;history record ifn
"RTN","SCMCMHHP",36,0)
 ..S SCACT=$P(SCDATA,U,SCX(5))  ;active date
"RTN","SCMCMHHP",37,0)
 ..Q:'SCACT
"RTN","SCMCMHHP",38,0)
 ..S SCINAC=$P(SCDATA,U,SCX(6))  ;inactive date
"RTN","SCMCMHHP",39,0)
 ..S SCREC=$G(@SCX(3)@(SCIFN,0))  ;history record
"RTN","SCMCMHHP",40,0)
 ..Q:'$L(SCREC)
"RTN","SCMCMHHP",41,0)
 ..S SCUSER=$P(SCREC,U,SCX(7))  ;user duz
"RTN","SCMCMHHP",42,0)
 ..S SCDENT=$P(SCREC,U,SCX(9))  ;date entered
"RTN","SCMCMHHP",43,0)
 ..S SCEU=$P(SCREC,U,6),SCEUNM=$$GET1^DIQ(200,SCEU_",",.01)  ;editing user
"RTN","SCMCMHHP",44,0)
 ..S SCSTAT=$P(SCREC,U,12),SCSTNM=$$GET1^DIQ(404.43,SCIFN_",",.12)  ;status
"RTN","SCMCMHHP",45,0)
 ..S SCLEDT=$P(SCREC,U,8),SCLEBNM=$$GET1^DIQ(200,SCLEDT_",",.01)  ;last edited by
"RTN","SCMCMHHP",46,0)
 ..D SLINE(SCX(1),SCNAME,SCACT,SCINAC,SCUSER,SCDENT,SCEUNM,SCSTNM,SCLEBNM,.SCLN)
"RTN","SCMCMHHP",47,0)
 ..Q
"RTN","SCMCMHHP",48,0)
 .Q
"RTN","SCMCMHHP",49,0)
 S SCTITL(1)="<*>  HISTORICAL PATIENT ASSIGNMENT DETAIL  <*>"
"RTN","SCMCMHHP",50,0)
 S SCTITL(2)="For assignments effective "_SC("DTR","PBDT")_" to "_SC("DTR","PEDT")
"RTN","SCMCMHHP",51,0)
 S SCLINE="",$P(SCLINE,"-",81)="",SCPAGE=1
"RTN","SCMCMHHP",52,0)
 S Y=$$NOW^XLFDT() X ^DD("DD") S SCPNOW=$P(Y,":",1,2)
"RTN","SCMCMHHP",53,0)
 S SCPNAME=$P(SCPT0,U),SCSSN=$P(SCPT0,U,9)
"RTN","SCMCMHHP",54,0)
 S SCGEND=$S($P(SCPT0,U,2)="M":"MALE",1:"FEMALE")
"RTN","SCMCMHHP",55,0)
 S (Y,SCAGE)=$P(SCPT0,U,3) X ^DD("DD") S SCDOB=Y
"RTN","SCMCMHHP",56,0)
 S SCAGE=$E(DT,1,3)-$E(SCAGE,1,3)-($E(DT,4,7)<$E(SCAGE,4,7))
"RTN","SCMCMHHP",57,0)
 D:$E(IOST)="C" DISP0^SCRPW23 D HDR^SCRPO(.SCTITL,80),SHDR
"RTN","SCMCMHHP",58,0)
 W:'SCFOUND !!?21,"No assignments found for this patient."
"RTN","SCMCMHHP",59,0)
 I SCFOUND S SCSUB=0 F  S SCSUB=$O(^TMP("SCRPT",$J,SCSUB)) Q:'SCSUB!SCOUT  D
"RTN","SCMCMHHP",60,0)
 .D:$Y>(IOSL-5) HDR^SCRPO(.SCTITL,80),SHDR Q:SCOUT
"RTN","SCMCMHHP",61,0)
 .S SCSH=^TMP("SCRPT",$J,SCSUB)
"RTN","SCMCMHHP",62,0)
 .W:SCSUB>1 ! D SSHDR(SCSH) S SCACT=""
"RTN","SCMCMHHP",63,0)
 .I '$O(^TMP("SCRPT",$J,SCSUB,"")) W "  (none found)" Q
"RTN","SCMCMHHP",64,0)
 .F  S SCACT=$O(^TMP("SCRPT",$J,SCSUB,SCACT)) Q:SCACT=""!SCOUT  D
"RTN","SCMCMHHP",65,0)
 ..S SCI=0 F  S SCI=$O(^TMP("SCRPT",$J,SCSUB,SCACT,SCI)) Q:'SCI!SCOUT  D
"RTN","SCMCMHHP",66,0)
 ...D:$Y>(IOSL-3) HDR^SCRPO(.SCTITL,80),SHDR,SSHDR(SCSH,1) Q:SCOUT
"RTN","SCMCMHHP",67,0)
 ...S SCX=^TMP("SCRPT",$J,SCSUB,SCACT,SCI)
"RTN","SCMCMHHP",68,0)
 ...W !,$P(SCX,U),?28,$P(SCX,U,2),?40,$P(SCX,U,3),?52,$P(SCX,U,4)
"RTN","SCMCMHHP",69,0)
 ...I SCSUB=3 D
"RTN","SCMCMHHP",70,0)
 ....W !,"User Entering: ",$P(SCX,U,6)
"RTN","SCMCMHHP",71,0)
 ....W !,"Last Edited By: ",$P(SCX,U,7)
"RTN","SCMCMHHP",72,0)
 ....W !,"Status: ",$P(SCX,U,5)
"RTN","SCMCMHHP",73,0)
 ...Q
"RTN","SCMCMHHP",74,0)
 ..Q
"RTN","SCMCMHHP",75,0)
 .Q
"RTN","SCMCMHHP",76,0)
 I 'SCOUT,$E(IOST)="C" N DIR S DIR(0)="E" W ! D ^DIR
"RTN","SCMCMHHP",77,0)
 K ^TMP("SCRPT",$J) Q
"RTN","SCMCMHHP",78,0)
 ;
"RTN","SCMCMHHP",79,0)
SHDR ;Subheader
"RTN","SCMCMHHP",80,0)
 Q:SCOUT
"RTN","SCMCMHHP",81,0)
 W !,"Patient: ",$E(SCPNAME,1,18),?29,"SSN: ",SCSSN,?46,"DOB: ",SCDOB
"RTN","SCMCMHHP",82,0)
 W ?64,"AGE: ",SCAGE,?74,$J(SCGEND,6),!,SCLINE
"RTN","SCMCMHHP",83,0)
 Q:'SCFOUND
"RTN","SCMCMHHP",84,0)
 W !,"Assignment",?28,"Active",?40,"Inactive",?52,"Assigned by/date"
"RTN","SCMCMHHP",85,0)
 W !,"--------------------------  ----------  ----------  ----------------------------"
"RTN","SCMCMHHP",86,0)
 Q
"RTN","SCMCMHHP",87,0)
 ;
"RTN","SCMCMHHP",88,0)
SSHDR(X,CONT) ;Subheader
"RTN","SCMCMHHP",89,0)
 ;Input: X=category
"RTN","SCMCMHHP",90,0)
 ;Input: CONT='1' for continuation (optional)
"RTN","SCMCMHHP",91,0)
 W !,X,$S($G(CONT):" (cont.)",1:""),":"
"RTN","SCMCMHHP",92,0)
 Q
"RTN","SCMCMHHP",93,0)
 ;
"RTN","SCMCMHHP",94,0)
SLINE(SCORD,SCNAME,SCACT,SCINAC,SCUSER,SCDENT,SUNM,SCTNM,SCBNM,SCLN) ;Set report global
"RTN","SCMCMHHP",95,0)
 ;Input: SCORD=output order
"RTN","SCMCMHHP",96,0)
 ;Input: SCNAME=provider/position/team name
"RTN","SCMCMHHP",97,0)
 ;Input: SCACT=active date
"RTN","SCMCMHHP",98,0)
 ;Input: SCINAC=inactive date
"RTN","SCMCMHHP",99,0)
 ;Input: SCUSER=user duz
"RTN","SCMCMHHP",100,0)
 ;Input: SCDENT=date entered
"RTN","SCMCMHHP",101,0)
 ;Input: SUNM=entered by
"RTN","SCMCMHHP",102,0)
 ;Input: SCTNM=status
"RTN","SCMCMHHP",103,0)
 ;Input: SCBNM=last edited by
"RTN","SCMCMHHP",104,0)
 ;
"RTN","SCMCMHHP",105,0)
 ;N SCX,SCY
"RTN","SCMCMHHP",106,0)
 S SCFOUND=1,SCLN=SCLN+1
"RTN","SCMCMHHP",107,0)
 S SCX=$E(SCNAME,1,25)_U_$$SDT(SCACT)_U_$$SDT(SCINAC),SCY=$$SDT(SCDENT)
"RTN","SCMCMHHP",108,0)
 S:$L(SCY) SCY=" ("_SCY_")"
"RTN","SCMCMHHP",109,0)
 S SCX=SCX_U_$E($P($G(^VA(200,+SCUSER,0)),U),1,(28-$L(SCY)))_SCY_U_SCTNM_U_SUNM_U_SCBNM
"RTN","SCMCMHHP",110,0)
 S ^TMP("SCRPT",$J,SCORD,-SCACT,SCLN)=SCX
"RTN","SCMCMHHP",111,0)
 Q
"RTN","SCMCMHHP",112,0)
 ;
"RTN","SCMCMHHP",113,0)
CODE ;Data handling instructions
"RTN","SCMCMHHP",114,0)
 ;  The following $TEXT lines contain data handling instructions
"RTN","SCMCMHHP",115,0)
 ;  in the format:  $PIECE 1 = output order
"RTN","SCMCMHHP",116,0)
 ;                         2 = subtitle
"RTN","SCMCMHHP",117,0)
 ;                         3 = global reference of history record
"RTN","SCMCMHHP",118,0)
 ;                         4 = $piece of history record ifn
"RTN","SCMCMHHP",119,0)
 ;                         5 = $piece of active date
"RTN","SCMCMHHP",120,0)
 ;                         6 = $piece of inactive date
"RTN","SCMCMHHP",121,0)
 ;                         7 = $piece of user (in history record)
"RTN","SCMCMHHP",122,0)
 ;                         8 = $piece of provider/position/team name
"RTN","SCMCMHHP",123,0)
 ;                         9 = $piece of date entered
"RTN","SCMCMHHP",124,0)
 ;
"RTN","SCMCMHHP",125,0)
NPCPOS ;;7^Non-PC Position^SCPT(404.43)^4^5^6^6^2^7
"RTN","SCMCMHHP",126,0)
NPCPPOS ;;9^Non-PC Preceptor Position^SCTM(404.53)^16^14^15^7^2^8
"RTN","SCMCMHHP",127,0)
NPCPPR ;;8^Non-PC Preceptor Provider^SCTM(404.52)^11^9^10^7^2^8
"RTN","SCMCMHHP",128,0)
NPCPR ;;6^Non-PC Provider^SCTM(404.52)^11^9^10^7^2^8
"RTN","SCMCMHHP",129,0)
NPCTM ;;10^Non-PC Team^SCPT(404.42)^3^4^5^11^2^12
"RTN","SCMCMHHP",130,0)
PCAP ;;2^PC Associate Provider^SCTM(404.52)^11^9^10^7^2^8
"RTN","SCMCMHHP",131,0)
PCPOS ;;3^PC Position^SCPT(404.43)^4^5^6^6^2^7
"RTN","SCMCMHHP",132,0)
PCPPOS ;;4^PC Preceptor Position^SCTM(404.53)^16^14^15^7^2^8
"RTN","SCMCMHHP",133,0)
PCPR ;;1^PC Provider^SCTM(404.52)^11^9^10^7^2^8
"RTN","SCMCMHHP",134,0)
PCTM ;;5^PC Team^SCPT(404.42)^3^4^5^11^2^12
"RTN","SCMCMHHP",135,0)
 ;
"RTN","SCMCMHHP",136,0)
SDT(X) ;Slashed date
"RTN","SCMCMHHP",137,0)
 S X=$E(X,1,7) Q:X'?7N ""
"RTN","SCMCMHHP",138,0)
 Q $E(X,4,5)_"/"_$E(X,6,7)_"/"_(17+$E(X))_$E(X,2,3)
"RTN","SCMCMHHP",139,0)
 ;
"RTN","SCMCMHHP",140,0)
MHTEAM(DFN) ;Patch 589 used to exclude all teams that are not Mental Health
"RTN","SCMCMHHP",141,0)
 ; Input
"RTN","SCMCMHHP",142,0)
 ;  DFN = Patient DFN
"RTN","SCMCMHHP",143,0)
 ;
"RTN","SCMCMHHP",144,0)
 ;Output
"RTN","SCMCMHHP",145,0)
 ;  1 = Team Purpose is "MENTAL HEALTH TREATMENT"
"RTN","SCMCMHHP",146,0)
 ;  0 = Team Purpose not "MENTAL HEALTH TREATMENT"
"RTN","SCMCMHHP",147,0)
 ;
"RTN","SCMCMHHP",148,0)
 ; need to filter on Team Purpose = Mental Health Treatment, IEN = 4
"RTN","SCMCMHHP",149,0)
 N TPIEN,TP,TPDT,SCARR,SCI
"RTN","SCMCMHHP",150,0)
 S TPIEN=$O(^SD(403.47,"B","MENTAL HEALTH TREATMENT",""))
"RTN","SCMCMHHP",151,0)
 I '$G(TPIEN) Q 0
"RTN","SCMCMHHP",152,0)
 S TP="TP",TP(TPIEN)=""
"RTN","SCMCMHHP",153,0)
 M TPDT=SC("DTR") S TPDT="TPDT"
"RTN","SCMCMHHP",154,0)
 S SCARR="^TMP(""SCARR"",$J)" K @SCARR
"RTN","SCMCMHHP",155,0)
 S SCI=$$TMPT^SCAPMC(DFN,.TPDT,.TP,SCARR)
"RTN","SCMCMHHP",156,0)
 I '$D(@SCARR@(0)) Q 0
"RTN","SCMCMHHP",157,0)
 K @SCARR
"RTN","SCMCMHHP",158,0)
 Q 1
"RTN","SCMCMHHT")
0^4^B70999794^n/a
"RTN","SCMCMHHT",1,0)
SCMCMHHT ;BP-CIOFO/LLH - Historical Team Assign Sum for Mental Health ; 2/6/12 10:00am
"RTN","SCMCMHHT",2,0)
 ;;5.3;Scheduling;**589**;AUG 13, 1993;Build 41
"RTN","SCMCMHHT",3,0)
 ;
"RTN","SCMCMHHT",4,0)
 ;  copied from SCRPO6 and modified to only display information for
"RTN","SCMCMHHT",5,0)
 ;  mental health teams
"RTN","SCMCMHHT",6,0)
 ;
"RTN","SCMCMHHT",7,0)
EN ;Queue report
"RTN","SCMCMHHT",8,0)
 N LIST,RTN,DESC
"RTN","SCMCMHHT",9,0)
 S SUMON=0
"RTN","SCMCMHHT",10,0)
 W !,"Print Final Summary Only" S %=2 D YN^DICN I %=1 S SUMON=1
"RTN","SCMCMHHT",11,0)
 ;Patch 589 - need to screen for Mental Health teams only, see below
"RTN","SCMCMHHT",12,0)
 ;S LIST="DIV,TEAM"
"RTN","SCMCMHHT",13,0)
 S LIST="DIV"
"RTN","SCMCMHHT",14,0)
 S RTN="RUN^SCMCMHHT"
"RTN","SCMCMHHT",15,0)
 S DESC="Historical Mental Health Team Assignment Summary"
"RTN","SCMCMHHT",16,0)
 D PROMPT(LIST,RTN,DESC) Q
"RTN","SCMCMHHT",17,0)
 ;
"RTN","SCMCMHHT",18,0)
PROMPT(LIST,SCRTN,SCDESC) ;Prompt for report parameters, queue report
"RTN","SCMCMHHT",19,0)
 ;Input: LIST=comma delimited string of list subscripts to prompt for
"RTN","SCMCMHHT",20,0)
 ;Input: SCRTN=report routine entry point
"RTN","SCMCMHHT",21,0)
 ;Input: SCDESC=tasked job description
"RTN","SCMCMHHT",22,0)
 ;
"RTN","SCMCMHHT",23,0)
 N SCDIV,SCBDT,SCEDT,SC,SCI,SCX,SCOUT,SCT
"RTN","SCMCMHHT",24,0)
 S SC="^TMP(""SC"",$J)" K @SC S SCOUT=0
"RTN","SCMCMHHT",25,0)
 D TITL^SCRPW50(SCDESC)
"RTN","SCMCMHHT",26,0)
 D SUBT^SCRPW50("**** Date Range Selection ****")
"RTN","SCMCMHHT",27,0)
 S (SCBDT("B"),SCEDT("B"))="TODAY"
"RTN","SCMCMHHT",28,0)
 G:'$$DTR^SCRPO(.SC,.SCBDT,.SCEDT) END
"RTN","SCMCMHHT",29,0)
 D SUBT^SCRPW50("**** Report Parameter Selection ****")
"RTN","SCMCMHHT",30,0)
 F SCI=1:1:$L(LIST,",") S SCX=$P(LIST,",",SCI) D  Q:SCOUT
"RTN","SCMCMHHT",31,0)
 .S SCOUT='$$LIST^SCRPO(.SC,SCX,1)
"RTN","SCMCMHHT",32,0)
 .Q
"RTN","SCMCMHHT",33,0)
 ;Patch 589 - need to screen for Mental Health teams only,modified LIST from SCRPO
"RTN","SCMCMHHT",34,0)
 S SCOUT='$$LIST(.SC,"TEAM",1)
"RTN","SCMCMHHT",35,0)
 ;
"RTN","SCMCMHHT",36,0)
 G:SCOUT END
"RTN","SCMCMHHT",37,0)
 S SCT(1)="**** Report Parameters Selected ****" D SUBT^SCRPW50(SCT(1))
"RTN","SCMCMHHT",38,0)
 G:'$$PPAR^SCRPO(.SC,1,.SCT) END
"RTN","SCMCMHHT",39,0)
 W !!,"This report requires 132 column output!"
"RTN","SCMCMHHT",40,0)
 W ! N ZTSAVE S ZTSAVE("^TMP(""SC"",$J,")="",ZTSAVE("SC")="",ZTSAVE("SUMON")=""
"RTN","SCMCMHHT",41,0)
 D EN^XUTMDEVQ(SCRTN,SCDESC,.ZTSAVE)
"RTN","SCMCMHHT",42,0)
END K ^TMP("SC",$J) D DISP0^SCRPW23,END^SCRPW50 Q
"RTN","SCMCMHHT",43,0)
 ;
"RTN","SCMCMHHT",44,0)
STOP ;Check for stop task request
"RTN","SCMCMHHT",45,0)
 S:$D(ZTQUEUED) (SCOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCMCMHHT",46,0)
 ;
"RTN","SCMCMHHT",47,0)
RUN ;Print report
"RTN","SCMCMHHT",48,0)
 N SCI,SCOUT
"RTN","SCMCMHHT",49,0)
 K ^TMP("SCRPT",$J)
"RTN","SCMCMHHT",50,0)
 S SCOUT=0
"RTN","SCMCMHHT",51,0)
 ;patch 589 changed SCRPO7 to SCMCMHO7
"RTN","SCMCMHHT",52,0)
 D BUILD Q:SCOUT  D COUNT^SCMCMHO7 D STOP Q:SCOUT
"RTN","SCMCMHHT",53,0)
 D PRINT
"RTN","SCMCMHHT",54,0)
 K ^TMP("SCRPT",$J),^TMP("SCRATCH",$J) Q
"RTN","SCMCMHHT",55,0)
 ;
"RTN","SCMCMHHT",56,0)
BUILD ;gather report information
"RTN","SCMCMHHT",57,0)
 N SCTM
"RTN","SCMCMHHT",58,0)
 ;build from list of teams
"RTN","SCMCMHHT",59,0)
 I $O(^TMP("SC",$J,"TEAM",0)) S SCTM=0 D  Q
"RTN","SCMCMHHT",60,0)
 .F  S SCTM=$O(^TMP("SC",$J,"TEAM",SCTM)) Q:'SCTM!SCOUT  D
"RTN","SCMCMHHT",61,0)
 ..;patch 589 changed SCRPO7 to SCMCMH07
"RTN","SCMCMHHT",62,0)
 ..D CKTEAM^SCMCMHO7(SCTM),STOP
"RTN","SCMCMHHT",63,0)
 ..Q
"RTN","SCMCMHHT",64,0)
 .Q
"RTN","SCMCMHHT",65,0)
 ;build from all teams
"RTN","SCMCMHHT",66,0)
 S SCTM=0 F  S SCTM=$O(^SCTM(404.51,SCTM)) Q:'SCTM!SCOUT  D
"RTN","SCMCMHHT",67,0)
 .; Patch 589 - only include Mental Health teams
"RTN","SCMCMHHT",68,0)
 .I $$GET1^DIQ(404.51,SCTM,.03)'="MENTAL HEALTH TREATMENT" Q
"RTN","SCMCMHHT",69,0)
 .;patch 589 changed SCRPO7 to SCMCMH07 
"RTN","SCMCMHHT",70,0)
 .D CKTEAM^SCMCMHO7(SCTM),STOP
"RTN","SCMCMHHT",71,0)
 .Q
"RTN","SCMCMHHT",72,0)
 Q
"RTN","SCMCMHHT",73,0)
 ;
"RTN","SCMCMHHT",74,0)
PRINT ;Print report
"RTN","SCMCMHHT",75,0)
 N SCLF,SCFF,SCLINE,SCPAGE,SCPNOW,SCTITL
"RTN","SCMCMHHT",76,0)
 S (SCLF,SCFF)=0
"RTN","SCMCMHHT",77,0)
 D HINI D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCMCMHHT",78,0)
 S SCTITL(2)=$$HDRX("P") D HDR^SCRPO(.SCTITL,132) Q:SCOUT  S SCOUT=$$PPAR^SCRPO(.SC,,.SCTITL)=0
"RTN","SCMCMHHT",79,0)
 Q:SCOUT
"RTN","SCMCMHHT",80,0)
 I '$D(^TMP("SCRPT",$J,0)) D  Q
"RTN","SCMCMHHT",81,0)
 .K SCTITL(2) D HDR^SCRPO(.SCTITL,132) Q:SCOUT
"RTN","SCMCMHHT",82,0)
 .S SCX="No team or team position assignments found within selected report parameters!"
"RTN","SCMCMHHT",83,0)
 .W !!?(132-$L(SCX)\2),SCX
"RTN","SCMCMHHT",84,0)
 .Q
"RTN","SCMCMHHT",85,0)
 S SCPAGE=1
"RTN","SCMCMHHT",86,0)
 S SCTITL(2)=$$HDRX("S") D HDR^SCRPO(.SCTITL,132),SHDR("S") Q:SCOUT
"RTN","SCMCMHHT",87,0)
 S SCDIV="" F  S SCDIV=$O(^TMP("SCRPT",$J,1,SCDIV)) Q:SCDIV=""!SCOUT  D
"RTN","SCMCMHHT",88,0)
 .S SCX=^TMP("SCRPT",$J,1,SCDIV) D SLINE(SCDIV,SCX,12,.SCLF) S SCTEAM=""
"RTN","SCMCMHHT",89,0)
 .F  S SCTEAM=$O(^TMP("SCRPT",$J,1,SCDIV,"TEAM",SCTEAM)) Q:SCTEAM=""!SCOUT  D
"RTN","SCMCMHHT",90,0)
 ..S SCX=^TMP("SCRPT",$J,1,SCDIV,"TEAM",SCTEAM)
"RTN","SCMCMHHT",91,0)
 ..D SLINE("  "_SCTEAM,SCX,10,.SCLF)
"RTN","SCMCMHHT",92,0)
 ..Q
"RTN","SCMCMHHT",93,0)
 .Q
"RTN","SCMCMHHT",94,0)
 Q:SCOUT
"RTN","SCMCMHHT",95,0)
 S SCX=^TMP("SCRPT",$J,0,0) D SLINE("REPORT TOTAL:",SCX,12,.SCLF)
"RTN","SCMCMHHT",96,0)
 ; patch 589 - removed doing the footer
"RTN","SCMCMHHT",97,0)
 Q:SCOUT  ; D FOOT^SCRPO7
"RTN","SCMCMHHT",98,0)
 Q:$G(SUMON)
"RTN","SCMCMHHT",99,0)
 I $D(^TMP("SCRPT",$J,0,0,"TLIST")) D
"RTN","SCMCMHHT",100,0)
 .S SCTITL(2)=$$HDRX("T") D HDR^SCRPO(.SCTITL,132),SHDR("T") Q:SCOUT
"RTN","SCMCMHHT",101,0)
 .S SCDIV=""
"RTN","SCMCMHHT",102,0)
 .F  S SCDIV=$O(^TMP("SCRPT",$J,0,0,"TLIST",SCDIV)) Q:SCDIV=""!SCOUT  D
"RTN","SCMCMHHT",103,0)
 ..S SCTEAM=""
"RTN","SCMCMHHT",104,0)
 ..F  S SCTEAM=$O(^TMP("SCRPT",$J,0,0,"TLIST",SCDIV,SCTEAM)) Q:SCTEAM=""!SCOUT  D
"RTN","SCMCMHHT",105,0)
 ...S SCPNAM=""
"RTN","SCMCMHHT",106,0)
 ...F  S SCPNAM=$O(^TMP("SCRPT",$J,0,0,"TLIST",SCDIV,SCTEAM,SCPNAM)) Q:SCPNAM=""!SCOUT  D
"RTN","SCMCMHHT",107,0)
 ....S SCI=0
"RTN","SCMCMHHT",108,0)
 ....F  S SCI=$O(^TMP("SCRPT",$J,0,0,"TLIST",SCDIV,SCTEAM,SCPNAM,SCI)) Q:'SCI!SCOUT  D
"RTN","SCMCMHHT",109,0)
 .....S SCX=^TMP("SCRPT",$J,0,0,"TLIST",SCDIV,SCTEAM,SCPNAM,SCI)
"RTN","SCMCMHHT",110,0)
 .....D TLINE(SCDIV,SCTEAM,SCPNAM,SCX)
"RTN","SCMCMHHT",111,0)
 .....Q
"RTN","SCMCMHHT",112,0)
 ....Q
"RTN","SCMCMHHT",113,0)
 ...Q
"RTN","SCMCMHHT",114,0)
 ..Q
"RTN","SCMCMHHT",115,0)
 .Q
"RTN","SCMCMHHT",116,0)
 Q:SCOUT  I $D(^TMP("SCRPT",$J,0,0,"PLIST")) D
"RTN","SCMCMHHT",117,0)
 .S SCTITL(2)=$$HDRX("TP") D HDR^SCRPO(.SCTITL,132),SHDR("P") Q:SCOUT
"RTN","SCMCMHHT",118,0)
 .S SCDIV=""
"RTN","SCMCMHHT",119,0)
 .F  S SCDIV=$O(^TMP("SCRPT",$J,0,0,"PLIST",SCDIV)) Q:SCDIV=""!SCOUT  D
"RTN","SCMCMHHT",120,0)
 ..S SCTEAM=""
"RTN","SCMCMHHT",121,0)
 ..F  S SCTEAM=$O(^TMP("SCRPT",$J,0,0,"PLIST",SCDIV,SCTEAM)) Q:SCTEAM=""!SCOUT  D
"RTN","SCMCMHHT",122,0)
 ...S SCPNAM=""
"RTN","SCMCMHHT",123,0)
 ...F  S SCPNAM=$O(^TMP("SCRPT",$J,0,0,"PLIST",SCDIV,SCTEAM,SCPNAM)) Q:SCPNAM=""!SCOUT  D
"RTN","SCMCMHHT",124,0)
 ....S SCI=0
"RTN","SCMCMHHT",125,0)
 ....F  S SCI=$O(^TMP("SCRPT",$J,0,0,"PLIST",SCDIV,SCTEAM,SCPNAM,SCI)) Q:'SCI!SCOUT  D
"RTN","SCMCMHHT",126,0)
 .....S SCX=^TMP("SCRPT",$J,0,0,"PLIST",SCDIV,SCTEAM,SCPNAM,SCI)
"RTN","SCMCMHHT",127,0)
 .....D PLINE(SCDIV,SCTEAM,SCPNAM,SCX)
"RTN","SCMCMHHT",128,0)
 .....Q
"RTN","SCMCMHHT",129,0)
 ....Q
"RTN","SCMCMHHT",130,0)
 ...Q
"RTN","SCMCMHHT",131,0)
 ..Q
"RTN","SCMCMHHT",132,0)
 .Q
"RTN","SCMCMHHT",133,0)
 I 'SCOUT,$E(IOST)="C" N DIR S DIR(0)="E" W ! D ^DIR
"RTN","SCMCMHHT",134,0)
 Q
"RTN","SCMCMHHT",135,0)
 ;
"RTN","SCMCMHHT",136,0)
SLINE(SCN,SCX,SCPF,SCLF) ;Print summary line
"RTN","SCMCMHHT",137,0)
 ;Input: SCN=name of item to print
"RTN","SCMCMHHT",138,0)
 ;Input: SCX=string of item values
"RTN","SCMCMHHT",139,0)
 ;Input: SCPF=minimum lines without page feed
"RTN","SCMCMHHT",140,0)
 ;Input: SCLF=extra line feed flag
"RTN","SCMCMHHT",141,0)
 ;
"RTN","SCMCMHHT",142,0)
 N SCI,SCY
"RTN","SCMCMHHT",143,0)
 S SCY="2^3^6^11^12^"  ; Patch 589 - removed fields no longer printing
"RTN","SCMCMHHT",144,0)
 ; removed D FOOT^SCRPO7 - don't do footer, patch 589
"RTN","SCMCMHHT",145,0)
 ;I $Y>(IOSL-SCPF) D FOOT^SCRPO7,HDR^SCRPO(.SCTITL,132),SHDR("S") S SCLF=0
"RTN","SCMCMHHT",146,0)
 I $Y>(IOSL-SCPF) D HDR^SCRPO(.SCTITL,132),SHDR("S") S SCLF=0
"RTN","SCMCMHHT",147,0)
 Q:SCOUT  W:SCPF>10&SCLF !
"RTN","SCMCMHHT",148,0)
 ;Patch 589 - removed If/Else, no longer need to print the PC column
"RTN","SCMCMHHT",149,0)
 W !,$E($P(SCN,U),1,28)
"RTN","SCMCMHHT",150,0)
 ; changed from 1:1:11 patch 589
"RTN","SCMCMHHT",151,0)
 F SCI=1:1:5 W ?(27+(9*SCI)),$J(+$P(SCX,U,$P(SCY,U,SCI)),6,0)
"RTN","SCMCMHHT",152,0)
 S SCLF=1
"RTN","SCMCMHHT",153,0)
 Q
"RTN","SCMCMHHT",154,0)
 ;
"RTN","SCMCMHHT",155,0)
TLINE(SCDIV,SCTEAM,SCPNAM,SCX) ;Print broken team assignment line
"RTN","SCMCMHHT",156,0)
 ;Input: SCDIV=division
"RTN","SCMCMHHT",157,0)
 ;Input: SCTEAM=team
"RTN","SCMCMHHT",158,0)
 ;Input: SCPNAM=patient name
"RTN","SCMCMHHT",159,0)
 ;Input: SCX=string of patient assignment data
"RTN","SCMCMHHT",160,0)
 ;
"RTN","SCMCMHHT",161,0)
 N SCI,Y
"RTN","SCMCMHHT",162,0)
 F SCI=3,4 S Y=$P($P(SCX,U,SCI),".") X ^DD("DD") S $P(SCX,U,SCI)=Y
"RTN","SCMCMHHT",163,0)
 I $Y>(IOSL-4) D HDR^SCRPO(.SCTITL,132),SHDR("T") Q:SCOUT
"RTN","SCMCMHHT",164,0)
 W !,$P(SCDIV,U),?32,$P(SCTEAM,U),?64,SCPNAM
"RTN","SCMCMHHT",165,0)
 ; Patch 589 added "xxxxx" + $E to print the last 4 of the SSN
"RTN","SCMCMHHT",166,0)
 W ?96,"xxxxx"_$E($TR($P(SCX,U,2),"-",""),6,9),?108,$P(SCX,U,3),?121,$P(SCX,U,4)
"RTN","SCMCMHHT",167,0)
 Q
"RTN","SCMCMHHT",168,0)
 ;
"RTN","SCMCMHHT",169,0)
PLINE(SCDIV,SCTEAM,SCPNAM,SCX) ;Print broken team assignment line
"RTN","SCMCMHHT",170,0)
 ;Input: SCDIV=division
"RTN","SCMCMHHT",171,0)
 ;Input: SCTEAM=team
"RTN","SCMCMHHT",172,0)
 ;Input: SCPNAM=patient name
"RTN","SCMCMHHT",173,0)
 ;Input: SCX=string of patient assignment data
"RTN","SCMCMHHT",174,0)
 ;
"RTN","SCMCMHHT",175,0)
 N SCI,Y
"RTN","SCMCMHHT",176,0)
 F SCI=3,4 S Y=$P($P(SCX,U,SCI),".") X ^DD("DD") S $P(SCX,U,SCI)=Y
"RTN","SCMCMHHT",177,0)
 I $Y>(IOSL-4) D HDR^SCRPO(.SCTITL,132),SHDR("P") Q:SCOUT
"RTN","SCMCMHHT",178,0)
 ; Patch 589 - added "xxxxx" + $E to print the last 4 of the SSN
"RTN","SCMCMHHT",179,0)
 W !,$P(SCDIV,U),?24,$P(SCTEAM,U),?48,SCPNAM,?72,"xxxxx"_$E($TR($P(SCX,U,2),"-",""),6,9)
"RTN","SCMCMHHT",180,0)
 W ?84,$P(SCX,U,5),?108,$P(SCX,U,3),?121,$P(SCX,U,4)
"RTN","SCMCMHHT",181,0)
 Q
"RTN","SCMCMHHT",182,0)
 ;
"RTN","SCMCMHHT",183,0)
HDRX(SCX) ;extra header line
"RTN","SCMCMHHT",184,0)
 ;Input: SCX='P' for parameters, 'S' for summary, 'T' for broken team
"RTN","SCMCMHHT",185,0)
 ;            assignments, 'TP' for broken team position assignments
"RTN","SCMCMHHT",186,0)
 ;
"RTN","SCMCMHHT",187,0)
 Q:SCX="P" "Selected Report Parameters"
"RTN","SCMCMHHT",188,0)
 Q:SCX="S" "Summary of Team and Team Position Assignments Effective: "_^TMP("SC",$J,"DTR","PBDT")_" to "_^TMP("SC",$J,"DTR","PEDT")
"RTN","SCMCMHHT",189,0)
 Q:SCX="T" "Team Assignments Without Active Position Assignments Effective: "_^TMP("SC",$J,"DTR","PBDT")_" to "_^TMP("SC",$J,"DTR","PEDT")
"RTN","SCMCMHHT",190,0)
 Q:SCX="TP" "Position Assignments Without Active Team Assignments Effective: "_^TMP("SC",$J,"DTR","PBDT")_" to "_^TMP("SC",$J,"DTR","PEDT")
"RTN","SCMCMHHT",191,0)
 Q:"" 
"RTN","SCMCMHHT",192,0)
 ;
"RTN","SCMCMHHT",193,0)
HINI ;Initialize header variables
"RTN","SCMCMHHT",194,0)
 N Y
"RTN","SCMCMHHT",195,0)
 S SCTITL(1)="<*>  MH HISTORICAL TEAM ASSIGNMENT SUMMARY  <*>"
"RTN","SCMCMHHT",196,0)
 S SCLINE="",$P(SCLINE,"-",133)="",SCPAGE=1
"RTN","SCMCMHHT",197,0)
 S Y=$$NOW^XLFDT() X ^DD("DD") S SCPNOW=$P(Y,":",1,2)
"RTN","SCMCMHHT",198,0)
 Q
"RTN","SCMCMHHT",199,0)
 ;
"RTN","SCMCMHHT",200,0)
SHDR(X) ;Print subheader
"RTN","SCMCMHHT",201,0)
 Q:SCOUT
"RTN","SCMCMHHT",202,0)
 N SCI
"RTN","SCMCMHHT",203,0)
 I X="S" D  Q
"RTN","SCMCMHHT",204,0)
 .; modified for 589
"RTN","SCMCMHHT",205,0)
 .W !?63,"Pts w/o  Pts w/o"
"RTN","SCMCMHHT",206,0)
 .W !,"Division",?38,"Max.   MH Team  Open     MHTC     MH Team"
"RTN","SCMCMHHT",207,0)
 .W !?2,"MH Team",?38,"Pts.   Assign.  ",?47,"Slots    Assign.  Assign."
"RTN","SCMCMHHT",208,0)
 .W !,$E(SCLINE,1,28),?37," ---- " F SCI=0:1:3 W ?(45+(9*SCI)),"-------"
"RTN","SCMCMHHT",209,0)
 .Q
"RTN","SCMCMHHT",210,0)
 I X="T" D  Q
"RTN","SCMCMHHT",211,0)
 .W !,"Division",?32,"MH Team",?64,"Patient Name",?96,"SSN",?108,"Active Date",?121,"Inact. Date"
"RTN","SCMCMHHT",212,0)
 .W ! F SCI=1:1:3 W $E(SCLINE,1,30),"  "
"RTN","SCMCMHHT",213,0)
 .W "----------  -----------  -----------"
"RTN","SCMCMHHT",214,0)
 .Q
"RTN","SCMCMHHT",215,0)
 I X="P" D  Q
"RTN","SCMCMHHT",216,0)
 .W !,"Division",?24,"MH Team",?48,"Patient Name",?72,"SSN",?84,"MH Team Position",?108,"Active Date",?121,"Inact. Date"
"RTN","SCMCMHHT",217,0)
 .W ! F SCI=1:1:3 W $E(SCLINE,1,22),"  "
"RTN","SCMCMHHT",218,0)
 .W "----------  ",$E(SCLINE,1,22),"  -----------  -----------"
"RTN","SCMCMHHT",219,0)
 .Q
"RTN","SCMCMHHT",220,0)
 Q
"RTN","SCMCMHHT",221,0)
 ;
"RTN","SCMCMHHT",222,0)
 ;copied from SCRPO, modified to only return Mental Health teams
"RTN","SCMCMHHT",223,0)
 ;
"RTN","SCMCMHHT",224,0)
LIST(SC,WHAT,SUBH,LIMIT) ;Get list of entries from a file
"RTN","SCMCMHHT",225,0)
 ;Input: SC=array to return values (pass by reference)
"RTN","SCMCMHHT",226,0)
 ;       @SC@(WHAT)="ALL" for all entries, or,
"RTN","SCMCMHHT",227,0)
 ;       @SC@(WHAT,ifn)=name of record
"RTN","SCMCMHHT",228,0)
 ;       @SC@(WHAT,name,ifn)=""
"RTN","SCMCMHHT",229,0)
 ;Input: WHAT="TEAM"
"RTN","SCMCMHHT",230,0)
 ;Input: SUBH='1' to display category subheader (optional)
"RTN","SCMCMHHT",231,0)
 ;Input: LIMIT=maximum selections (optional, default 20)
"RTN","SCMCMHHT",232,0)
 ;Output: '1' for success, '0' otherwise
"RTN","SCMCMHHT",233,0)
 ;
"RTN","SCMCMHHT",234,0)
 N SCW,SCI,SCOUT,DIC,X,Y,SCA,SCB,SCQUIT,SCS,DTOUT,DUOUT
"RTN","SCMCMHHT",235,0)
 Q:'$L(WHAT) 0  S:'$G(LIMIT) LIMIT=20 S (SCOUT,SCQUIT)=0
"RTN","SCMCMHHT",236,0)
 F SCI="TEAM" S SCW(SCI)=""
"RTN","SCMCMHHT",237,0)
 Q:'$D(SCW(WHAT)) 0
"RTN","SCMCMHHT",238,0)
 D @WHAT S DIC(0)="AEMQ"
"RTN","SCMCMHHT",239,0)
 I $G(SUBH) D SUBT^SCRPW50("**** "_SCA_" Selection ****")
"RTN","SCMCMHHT",240,0)
 S SCB=$J("Select "_SCA_":  ",29),DIC("A")=SCB_"ALL// "
"RTN","SCMCMHHT",241,0)
 I $L($G(SCS)) S DIC("S")=SCS
"RTN","SCMCMHHT",242,0)
 F SCI=1:1:LIMIT D  Q:SCOUT!SCQUIT
"RTN","SCMCMHHT",243,0)
 .W ! D ^DIC I $D(DTOUT)!$D(DUOUT) S SCQUIT=1 Q
"RTN","SCMCMHHT",244,0)
 .I SCI=1,X="" W "  (ALL)" S @SC@(WHAT)="ALL",SCOUT=1 Q
"RTN","SCMCMHHT",245,0)
 .I X="" S SCOUT=1 Q
"RTN","SCMCMHHT",246,0)
 .I Y>0 S @SC@(WHAT,+Y)=$P(Y,U,2),@SC@(WHAT,$P(Y,U,2),+Y)=""
"RTN","SCMCMHHT",247,0)
 .S DIC("A")=SCB
"RTN","SCMCMHHT",248,0)
 .Q
"RTN","SCMCMHHT",249,0)
 D XR(.SC,WHAT,SCA) Q 'SCQUIT
"RTN","SCMCMHHT",250,0)
 Q
"RTN","SCMCMHHT",251,0)
 ;
"RTN","SCMCMHHT",252,0)
TEAM S DIC="^SCTM(404.51,",SCA="Team",SCS="I $P(^SD(403.47,$P(^(0),U,3),0),U,1)=""MENTAL HEALTH TREATMENT""" Q
"RTN","SCMCMHHT",253,0)
 ;
"RTN","SCMCMHHT",254,0)
XR(SC,SUB,VAL) ;Create x-ref for printing parameters
"RTN","SCMCMHHT",255,0)
 ;Input: SC=array to return parameters
"RTN","SCMCMHHT",256,0)
 ;Input: SUB=name of subscript holding parameters being x-ref'd
"RTN","SCMCMHHT",257,0)
 ;Input: VAL=value for item subtitle (optional)
"RTN","SCMCMHHT",258,0)
 ;
"RTN","SCMCMHHT",259,0)
 S @SC@("XR")=$G(@SC@("XR"))+1,@SC@("XR",@SC@("XR"),SUB)=$G(VAL)
"RTN","SCMCMHHT",260,0)
 Q 
"RTN","SCMCMHO7")
0^8^B50655147^n/a
"RTN","SCMCMHO7",1,0)
SCMCMHO7 ;BP-CIOFO/LLH - Historical Team Assignment Sum for MH (cont.) ; 14 May 12  11:15 AM
"RTN","SCMCMHO7",2,0)
 ;;5.3;Scheduling;**589**;AUG 13, 1993;Build 41
"RTN","SCMCMHO7",3,0)
 ;
"RTN","SCMCMHO7",4,0)
 ; Routine SCRPO7 copied and modified to only count patients with a MHTC assigned
"RTN","SCMCMHO7",5,0)
 ;
"RTN","SCMCMHO7",6,0)
CKTEAM(SCTM) ;Build from team
"RTN","SCMCMHO7",7,0)
 ;Input: SCTM=team ifn
"RTN","SCMCMHO7",8,0)
 N SCTM0,SCDIV,SCTPC,SCTMAX,SCTEAM,SCDT,SCRATCH,ERR,SCI
"RTN","SCMCMHO7",9,0)
 N SCACT,SCII,SCIII,SCINAC,SCPC,SCPNAM,SCTP
"RTN","SCMCMHO7",10,0)
 N DFN,SCTMASS,SCTMUNI,SCX,SCPTA,SCY
"RTN","SCMCMHO7",11,0)
 F SCI=1:1:12 S SCY(SCI)=""
"RTN","SCMCMHO7",12,0)
 S SCTM0=$G(^SCTM(404.51,SCTM,0)) Q:'$L(SCTM0)
"RTN","SCMCMHO7",13,0)
 S SCTEAM=$P(SCTM0,U)_U_SCTM  ;team name
"RTN","SCMCMHO7",14,0)
 S SCDIV=$P(SCTM0,U,7) Q:'SCDIV  ;division
"RTN","SCMCMHO7",15,0)
 I $O(^TMP("SC",$J,"DIV",0)),'$D(^TMP("SC",$J,"DIV",SCDIV)) Q
"RTN","SCMCMHO7",16,0)
 S SCDIV=$P($G(^DIC(4,SCDIV,0)),U)_U_SCDIV
"RTN","SCMCMHO7",17,0)
 S SCY(1)=$S($P(SCTM0,U,5)=1:"YES",1:"NO")  ;pc team?
"RTN","SCMCMHO7",18,0)
 S SCY(2)=$P(SCTM0,U,8)  ;max. patients
"RTN","SCMCMHO7",19,0)
 M SCDT=^TMP("SC",$J,"DTR") S SCDT="SCDT"
"RTN","SCMCMHO7",20,0)
 S SCRATCH="^TMP(""SCRATCH"",$J,1)" K @SCRATCH,^TMP("SCRPT",$J,2)
"RTN","SCMCMHO7",21,0)
 S SCI=$$PTTM^SCAPMC(SCTM,.SCDT,SCRATCH,"ERR")
"RTN","SCMCMHO7",22,0)
 S SCI=0 F  S SCI=$O(^TMP("SCRATCH",$J,1,SCI)) Q:'SCI  D
"RTN","SCMCMHO7",23,0)
 .S SCX=^TMP("SCRATCH",$J,1,SCI)
"RTN","SCMCMHO7",24,0)
 .S DFN=$P(SCX,U) Q:'DFN
"RTN","SCMCMHO7",25,0)
 .S DATA=$P(SCX,U,2)_U_$P(SCX,U,6)_U_$P(SCX,U,4,5)
"RTN","SCMCMHO7",26,0)
 .S SCPTA=$P(SCX,U,3) Q:'SCPTA
"RTN","SCMCMHO7",27,0)
 .F SCII=0,1,2 S ^TMP("SCRPT",$J,SCII,$$RPT(SCII),"TPTS",DFN,SCPTA)=DATA
"RTN","SCMCMHO7",28,0)
 ;Count team assignments and uniques
"RTN","SCMCMHO7",29,0)
 S DFN=0 F  S DFN=$O(^TMP("SCRPT",$J,2,SCTEAM,"TPTS",DFN)) Q:'DFN  D
"RTN","SCMCMHO7",30,0)
 .S SCY(7)=SCY(7)+1,SCPTA=0
"RTN","SCMCMHO7",31,0)
 .F  S SCPTA=$O(^TMP("SCRPT",$J,2,SCTEAM,"TPTS",DFN,SCPTA)) Q:'SCPTA  D
"RTN","SCMCMHO7",32,0)
 ..S SCY(3)=SCY(3)+1
"RTN","SCMCMHO7",33,0)
 ..Q
"RTN","SCMCMHO7",34,0)
 .Q
"RTN","SCMCMHO7",35,0)
 ;Get team positions
"RTN","SCMCMHO7",36,0)
 K @SCRATCH
"RTN","SCMCMHO7",37,0)
 S SCI=$$TPTM^SCAPMC(SCTM,.SCDT,,,SCRATCH,"ERR")
"RTN","SCMCMHO7",38,0)
 S SCI=0 F  S SCI=$O(^TMP("SCRATCH",$J,1,SCI)) Q:'SCI  D
"RTN","SCMCMHO7",39,0)
 .N SCDT2 M SCDT2=SCDT S SCDT2="SCDT2"
"RTN","SCMCMHO7",40,0)
 .S SCX=^TMP("SCRATCH",$J,1,SCI)
"RTN","SCMCMHO7",41,0)
 .S SCTP=$P(SCX,U) Q:'SCTP
"RTN","SCMCMHO7",42,0)
 .S SCPOSN=$P(SCX,U,2)
"RTN","SCMCMHO7",43,0)
 .S SCACT=$P(SCX,U,5),SCINAC=$P(SCX,U,6)
"RTN","SCMCMHO7",44,0)
 .S:SCACT>SCDT2("BEGIN") SCDT2("BEGIN")=SCACT
"RTN","SCMCMHO7",45,0)
 .I SCINAC,SCINAC<SCDT2("END") S SCDT2("END")=SCINAC
"RTN","SCMCMHO7",46,0)
 .S SCRATCH="^TMP(""SCRATCH"",$J,2)" K @SCRATCH
"RTN","SCMCMHO7",47,0)
 .;Get list of position patients
"RTN","SCMCMHO7",48,0)
 .S SCII=$$PTTP^SCAPMC(SCTP,.SCDT2,SCRATCH,"ERR")
"RTN","SCMCMHO7",49,0)
 .S SCII=0  F  S SCII=$O(^TMP("SCRATCH",$J,2,SCII)) Q:'SCII  D
"RTN","SCMCMHO7",50,0)
 ..S SCX=^TMP("SCRATCH",$J,2,SCII)
"RTN","SCMCMHO7",51,0)
 ..S DFN=$P(SCX,U) Q:'DFN
"RTN","SCMCMHO7",52,0)
 ..S DATA=$P(SCX,U,2)_U_$P(SCX,U,6)_U_$P(SCX,U,4,5)_U_SCPOSN
"RTN","SCMCMHO7",53,0)
 ..S SCPTPA=$P(SCX,U,3) Q:'SCPTPA
"RTN","SCMCMHO7",54,0)
 ..S SCPTPA0=$G(^SCPT(404.43,SCPTPA,0)) Q:'$L(SCPTPA0)
"RTN","SCMCMHO7",55,0)
 ..S SCPC=$P(SCPTPA0,U,5)>0  ;pc position?
"RTN","SCMCMHO7",56,0)
 ..F SCIII=0,1,2 S ^TMP("SCRPT",$J,SCIII,$$RPT(SCIII),"PPTS",SCPC,DFN,SCPTPA)=DATA
"RTN","SCMCMHO7",57,0)
 ..Q
"RTN","SCMCMHO7",58,0)
 .Q
"RTN","SCMCMHO7",59,0)
 ;Count team position assignment assignments and uniques
"RTN","SCMCMHO7",60,0)
 F SCI=0,1 S DFN=0 D
"RTN","SCMCMHO7",61,0)
 .F  S DFN=$O(^TMP("SCRPT",$J,2,SCTEAM,"PPTS",SCI,DFN)) Q:'DFN  D
"RTN","SCMCMHO7",62,0)
 ..S SCY(8+SCI)=SCY(8+SCI)+1,SCPTPA=0
"RTN","SCMCMHO7",63,0)
 ..F  S SCPTPA=$O(^TMP("SCRPT",$J,2,SCTEAM,"PPTS",SCI,DFN,SCPTPA)) Q:'SCPTPA  D
"RTN","SCMCMHO7",64,0)
 ...S SCY(4+SCI)=SCY(4+SCI)+1
"RTN","SCMCMHO7",65,0)
 ...Q
"RTN","SCMCMHO7",66,0)
 ..Q
"RTN","SCMCMHO7",67,0)
 .Q
"RTN","SCMCMHO7",68,0)
 ;check for broken team assignments
"RTN","SCMCMHO7",69,0)
 M ^TMP("SCRPT",$J,2,SCTEAM,"PPTS",1)=^TMP("SCRPT",$J,2,SCTEAM,"PPTS",0)
"RTN","SCMCMHO7",70,0)
 S DFN=0 F  S DFN=$O(^TMP("SCRPT",$J,2,SCTEAM,"TPTS",DFN)) Q:'DFN  D
"RTN","SCMCMHO7",71,0)
 .Q:$D(^TMP("SCRPT",$J,2,SCTEAM,"PPTS",1,DFN))
"RTN","SCMCMHO7",72,0)
 .;patch 589 - only count patients w/o an MHTC assignment
"RTN","SCMCMHO7",73,0)
 .S SCPTA=0 I '+$$START^SCMCMHTC(DFN) S SCY(11)=SCY(11)+1
"RTN","SCMCMHO7",74,0)
 .;S SCPTA=0,SCY(11)=SCY(11)+1
"RTN","SCMCMHO7",75,0)
 .F  S SCPTA=$O(^TMP("SCRPT",$J,2,SCTEAM,"TPTS",DFN,SCPTA)) Q:'SCPTA  D
"RTN","SCMCMHO7",76,0)
 ..S DATA=^TMP("SCRPT",$J,2,SCTEAM,"TPTS",DFN,SCPTA)
"RTN","SCMCMHO7",77,0)
 ..S SCPNAM=$P(DATA,U) Q:'$L(SCPNAM)
"RTN","SCMCMHO7",78,0)
 ..S ^TMP("SCRPT",$J,0,0,"TLIST",SCDIV,SCTEAM,SCPNAM,SCPTA)=DATA
"RTN","SCMCMHO7",79,0)
 ..S ^TMP("SCRPT",$J,0,0,"BTA",SCDIV,DFN)=""
"RTN","SCMCMHO7",80,0)
 ..S ^TMP("SCRPT",$J,0,0,"BTA",0,DFN)=""
"RTN","SCMCMHO7",81,0)
 ..Q
"RTN","SCMCMHO7",82,0)
 .Q
"RTN","SCMCMHO7",83,0)
 ;check for broken team position assignments
"RTN","SCMCMHO7",84,0)
 S DFN=0 F  S DFN=$O(^TMP("SCRPT",$J,2,SCTEAM,"PPTS",1,DFN)) Q:'DFN  D
"RTN","SCMCMHO7",85,0)
 .Q:$D(^TMP("SCRPT",$J,2,SCTEAM,"TPTS",DFN))
"RTN","SCMCMHO7",86,0)
 .S SCPTPA=0,SCY(12)=SCY(12)+1
"RTN","SCMCMHO7",87,0)
 .F  S SCPTPA=$O(^TMP("SCRPT",$J,2,SCTEAM,"PPTS",1,DFN,SCPTPA)) Q:'SCPTPA  D
"RTN","SCMCMHO7",88,0)
 ..S DATA=^TMP("SCRPT",$J,2,SCTEAM,"PPTS",1,DFN,SCPTPA)
"RTN","SCMCMHO7",89,0)
 ..S SCPNAM=$P(DATA,U) Q:'$L(SCPNAM)
"RTN","SCMCMHO7",90,0)
 ..S ^TMP("SCRPT",$J,0,0,"PLIST",SCDIV,SCTEAM,SCPNAM,SCPTPA)=DATA
"RTN","SCMCMHO7",91,0)
 ..S ^TMP("SCRPT",$J,0,0,"BTPA",SCDIV,DFN)=""
"RTN","SCMCMHO7",92,0)
 ..S ^TMP("SCRPT",$J,0,0,"BTPA",0,DFN)=""
"RTN","SCMCMHO7",93,0)
 ..Q
"RTN","SCMCMHO7",94,0)
 .Q
"RTN","SCMCMHO7",95,0)
 ;count total uniques and open slots
"RTN","SCMCMHO7",96,0)
 M ^TMP("SCRPT",$J,2,SCTEAM,"TPTS")=^TMP("SCRPT",$J,2,SCTEAM,"PPTS",1)
"RTN","SCMCMHO7",97,0)
 K ^TMP("SCRPT",$J,2,SCTEAM,"PPTS")
"RTN","SCMCMHO7",98,0)
 S DFN=0 F  S DFN=$O(^TMP("SCRPT",$J,2,SCTEAM,"TPTS",DFN)) Q:'DFN  D
"RTN","SCMCMHO7",99,0)
 .S SCY(10)=SCY(10)+1
"RTN","SCMCMHO7",100,0)
 .Q
"RTN","SCMCMHO7",101,0)
 S SCY(6)=SCY(2)-SCY(10) S:SCY(6)<0 SCY(6)=0
"RTN","SCMCMHO7",102,0)
 K ^TMP("SCRPT",$J,2)
"RTN","SCMCMHO7",103,0)
 ;Move team data to report and division totals
"RTN","SCMCMHO7",104,0)
 I SCY(1)="YES" D
"RTN","SCMCMHO7",105,0)
 .S $P(^TMP("SCRPT",$J,0,0),U)="YES"
"RTN","SCMCMHO7",106,0)
 .S $P(^TMP("SCRPT",$J,1,SCDIV),U)="YES"
"RTN","SCMCMHO7",107,0)
 .S $P(^TMP("SCRPT",$J,1,SCDIV,"TEAM",SCTEAM),U)="YES"
"RTN","SCMCMHO7",108,0)
 .Q
"RTN","SCMCMHO7",109,0)
 F SCI=2:1:6 D
"RTN","SCMCMHO7",110,0)
 .S $P(^TMP("SCRPT",$J,0,0),U,SCI)=$P($G(^TMP("SCRPT",$J,0,0)),U,SCI)+SCY(SCI)
"RTN","SCMCMHO7",111,0)
 .S $P(^TMP("SCRPT",$J,1,SCDIV),U,SCI)=$P($G(^TMP("SCRPT",$J,1,SCDIV)),U,SCI)+SCY(SCI)
"RTN","SCMCMHO7",112,0)
 .S $P(^TMP("SCRPT",$J,1,SCDIV,"TEAM",SCTEAM),U,SCI)=$P($G(^TMP("SCRPT",$J,1,SCDIV,"TEAM",SCTEAM)),U,SCI)+SCY(SCI)
"RTN","SCMCMHO7",113,0)
 .Q
"RTN","SCMCMHO7",114,0)
 F SCI=7:1:12 D
"RTN","SCMCMHO7",115,0)
 .S $P(^TMP("SCRPT",$J,1,SCDIV,"TEAM",SCTEAM),U,SCI)=SCY(SCI)
"RTN","SCMCMHO7",116,0)
 .Q
"RTN","SCMCMHO7",117,0)
 Q
"RTN","SCMCMHO7",118,0)
 ;
"RTN","SCMCMHO7",119,0)
RPT(X) ;Return report section value
"RTN","SCMCMHO7",120,0)
 Q $S(X=1:SCDIV,X=2:SCTEAM,1:0)
"RTN","SCMCMHO7",121,0)
 ;
"RTN","SCMCMHO7",122,0)
COUNT ;Count division and report uniques
"RTN","SCMCMHO7",123,0)
 S SCDIV="" F  S SCDIV=$O(^TMP("SCRPT",$J,1,SCDIV)) Q:SCDIV=""  D
"RTN","SCMCMHO7",124,0)
 .K SCY F SCI=7:1:12 S SCY(SCI)=""
"RTN","SCMCMHO7",125,0)
 .S DFN=0 F  S DFN=$O(^TMP("SCRPT",$J,1,SCDIV,"TPTS",DFN)) Q:'DFN  D
"RTN","SCMCMHO7",126,0)
 ..S SCY(7)=SCY(7)+1
"RTN","SCMCMHO7",127,0)
 ..Q
"RTN","SCMCMHO7",128,0)
 .F SCI=0,1 S DFN=0 D
"RTN","SCMCMHO7",129,0)
 ..F  S DFN=$O(^TMP("SCRPT",$J,1,SCDIV,"PPTS",SCI,DFN)) Q:'DFN  D
"RTN","SCMCMHO7",130,0)
 ...S SCY(8+SCI)=SCY(8+SCI)+1
"RTN","SCMCMHO7",131,0)
 ...Q
"RTN","SCMCMHO7",132,0)
 ..Q
"RTN","SCMCMHO7",133,0)
 .M ^TMP("SCRPT",$J,1,SCDIV,"PPTS",1)=^TMP("SCRPT",$J,1,SCDIV,"PPTS",0)
"RTN","SCMCMHO7",134,0)
 .M ^TMP("SCRPT",$J,1,SCDIV,"TPTS")=^TMP("SCRPT",$J,1,SCDIV,"PPTS",1)
"RTN","SCMCMHO7",135,0)
 .K ^TMP("SCRPT",$J,1,SCDIV,"PPTS")
"RTN","SCMCMHO7",136,0)
 .S DFN=0 F  S DFN=$O(^TMP("SCRPT",$J,1,SCDIV,"TPTS",DFN)) Q:'DFN  D
"RTN","SCMCMHO7",137,0)
 ..S SCY(10)=SCY(10)+1
"RTN","SCMCMHO7",138,0)
 ..Q
"RTN","SCMCMHO7",139,0)
 .K ^TMP("SCRPT",$J,1,SCDIV,"TPTS")
"RTN","SCMCMHO7",140,0)
 .F SCI="BTA","BTPA" S DFN=0 D
"RTN","SCMCMHO7",141,0)
 ..F  S DFN=$O(^TMP("SCRPT",$J,0,0,SCI,SCDIV,DFN)) Q:'DFN  D
"RTN","SCMCMHO7",142,0)
 ...S SCY($S(SCI="BTA":11,1:12))=SCY($S(SCI="BTA":11,1:12))+1
"RTN","SCMCMHO7",143,0)
 ...Q
"RTN","SCMCMHO7",144,0)
 ..K ^TMP("SCRPT",$J,0,0,SCI,SCDIV)
"RTN","SCMCMHO7",145,0)
 ..Q
"RTN","SCMCMHO7",146,0)
 .F SCI=7:1:12 D
"RTN","SCMCMHO7",147,0)
 ..S $P(^TMP("SCRPT",$J,1,SCDIV),U,SCI)=SCY(SCI)
"RTN","SCMCMHO7",148,0)
 ..Q
"RTN","SCMCMHO7",149,0)
 .Q
"RTN","SCMCMHO7",150,0)
 ;count report uniques
"RTN","SCMCMHO7",151,0)
 K SCY F SCI=7:1:12 S SCY(SCI)=""
"RTN","SCMCMHO7",152,0)
 S DFN=0 F  S DFN=$O(^TMP("SCRPT",$J,0,0,"TPTS",DFN)) Q:'DFN  D
"RTN","SCMCMHO7",153,0)
 .S SCY(7)=SCY(7)+1
"RTN","SCMCMHO7",154,0)
 .Q
"RTN","SCMCMHO7",155,0)
 F SCI=0,1 S DFN=0 D
"RTN","SCMCMHO7",156,0)
 .F  S DFN=$O(^TMP("SCRPT",$J,0,0,"PPTS",SCI,DFN)) Q:'DFN  D
"RTN","SCMCMHO7",157,0)
 ..S SCY(8+SCI)=SCY(8+SCI)+1
"RTN","SCMCMHO7",158,0)
 ..Q
"RTN","SCMCMHO7",159,0)
 .Q
"RTN","SCMCMHO7",160,0)
 M ^TMP("SCRPT",$J,0,0,"PPTS",1)=^TMP("SCRPT",$J,0,0,"PPTS",0)
"RTN","SCMCMHO7",161,0)
 M ^TMP("SCRPT",$J,0,0,"TPTS")=^TMP("SCRPT",$J,0,0,"PPTS",1)
"RTN","SCMCMHO7",162,0)
 K ^TMP("SCRPT",$J,0,0,"PPTS")
"RTN","SCMCMHO7",163,0)
 S DFN=0 F  S DFN=$O(^TMP("SCRPT",$J,0,0,"TPTS",DFN)) Q:'DFN  D
"RTN","SCMCMHO7",164,0)
 .S SCY(10)=SCY(10)+1
"RTN","SCMCMHO7",165,0)
 .Q
"RTN","SCMCMHO7",166,0)
 K ^TMP("SCRPT",$J,0,0,"TPTS")
"RTN","SCMCMHO7",167,0)
 F SCI="BTA","BTPA" S DFN=0 D
"RTN","SCMCMHO7",168,0)
 .F  S DFN=$O(^TMP("SCRPT",$J,0,0,SCI,0,DFN)) Q:'DFN  D
"RTN","SCMCMHO7",169,0)
 ..S SCY($S(SCI="BTA":11,1:12))=SCY($S(SCI="BTA":11,1:12))+1
"RTN","SCMCMHO7",170,0)
 ..Q
"RTN","SCMCMHO7",171,0)
 .K ^TMP("SCRPT",$J,0,0,SCI,0)
"RTN","SCMCMHO7",172,0)
 .Q
"RTN","SCMCMHO7",173,0)
 F SCI=7:1:12 D
"RTN","SCMCMHO7",174,0)
 .S $P(^TMP("SCRPT",$J,0,0),U,SCI)=SCY(SCI)
"RTN","SCMCMHO7",175,0)
 .Q
"RTN","SCMCMHO7",176,0)
 Q
"RTN","SCMCMHO7",177,0)
 ;
"RTN","SCMCMHO7",178,0)
FOOT ;Summary report footer
"RTN","SCMCMHO7",179,0)
 N SCI
"RTN","SCMCMHO7",180,0)
 F SCI=1:1:80 W ! Q:$Y>(IOSL-9)
"RTN","SCMCMHO7",181,0)
 W !,SCLINE
"RTN","SCMCMHO7",182,0)
 W !,"NOTE: This report represents a count of team and team position assignments within the date range selected.  If a date range"
"RTN","SCMCMHO7",183,0)
 W !?6,"larger than one day has been selected, the total unique patients and assignments may be greater than the maximum defined"
"RTN","SCMCMHO7",184,0)
 W !?6,"for the team, reducing the open slots reflected by this report accordingly.  However, this does not imply that the team"
"RTN","SCMCMHO7",185,0)
 W !?6,"had more than its maximum number of patients on any single date."
"RTN","SCMCMHO7",186,0)
 W !,SCLINE
"RTN","SCMCMHO7",187,0)
 Q
"RTN","SCMCMHP2")
0^2^B72814610^n/a
"RTN","SCMCMHP2",1,0)
SCMCMHP2 ;ALB/CMM - Practitioner's Patients ; 12/12/00 3:46pm
"RTN","SCMCMHP2",2,0)
 ;;5.3;Scheduling;**589**;AUG 13, 1993;Build 41
"RTN","SCMCMHP2",3,0)
 ;
"RTN","SCMCMHP2",4,0)
 ;Patch 589, copy of SCRPPAT2, modified for MH Practitioner's Patients Report
"RTN","SCMCMHP2",5,0)
 ;
"RTN","SCMCMHP2",6,0)
DRIVE ;
"RTN","SCMCMHP2",7,0)
 ;driver module
"RTN","SCMCMHP2",8,0)
 N PRAC,INF,ARRY,ERROR,NXT,OKAY,PIEN,TPRC
"RTN","SCMCMHP2",9,0)
 S ARRY="^TMP(""SCARRAY"","_$J_")",ERROR="ERR"
"RTN","SCMCMHP2",10,0)
 S TPRC="^TMP(""SCRP"",$J,""PRACT"")" M @TPRC=PRACT
"RTN","SCMCMHP2",11,0)
 K @ARRY,@ERROR,PRACT
"RTN","SCMCMHP2",12,0)
 I @TPRC=1 D ALL^SCRPPAT3 ;all practitioners selected
"RTN","SCMCMHP2",13,0)
 S NXT=0
"RTN","SCMCMHP2",14,0)
 F  S NXT=$O(@TPRC@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCMCMHP2",15,0)
 .I @TPRC=0 S PIEN=NXT
"RTN","SCMCMHP2",16,0)
 .I @TPRC=1 S PIEN=$P(@TPRC@(NXT),"^")
"RTN","SCMCMHP2",17,0)
 .K @ARRY,@ERROR
"RTN","SCMCMHP2",18,0)
 .S OKAY=$$PTPR^SCAPMC14(PIEN,"","","",ARRY,ERROR) ;patients for practitioner
"RTN","SCMCMHP2",19,0)
 .I '+OKAY Q
"RTN","SCMCMHP2",20,0)
 .D LOOPPT(ARRY,PIEN) ;loop through patients for practitioner
"RTN","SCMCMHP2",21,0)
 K @ARRY,@ERROR,@TPRC
"RTN","SCMCMHP2",22,0)
 K:SUMM @STORE@("PT")
"RTN","SCMCMHP2",23,0)
 Q
"RTN","SCMCMHP2",24,0)
 ;
"RTN","SCMCMHP2",25,0)
LOOPPT(ARY,PRAC) ;loop through patients for practitioner
"RTN","SCMCMHP2",26,0)
 ;ARY - array of patients for selected practitioner
"RTN","SCMCMHP2",27,0)
 ;PRAC - practitioner ien
"RTN","SCMCMHP2",28,0)
 N NXT,PIEN,TPIEN,PNAME,TPIEN,NODE,PTP,TPI,TPN,CLIEN,PTA,PTAN,TIEN
"RTN","SCMCMHP2",29,0)
 N PC,TNODE,TNAME,PINF,POSN,PRCP,CNAME
"RTN","SCMCMHP2",30,0)
 S NXT=0
"RTN","SCMCMHP2",31,0)
 F  S NXT=$O(@ARY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCMCMHP2",32,0)
 .S NODE=$G(@ARY@(NXT))
"RTN","SCMCMHP2",33,0)
 .Q:NODE=""
"RTN","SCMCMHP2",34,0)
 .S PIEN=+$P(NODE,"^") ;ien of patient file entry
"RTN","SCMCMHP2",35,0)
 .S TPIEN=+$P(NODE,"^",3) ;ien of patient team position assignment
"RTN","SCMCMHP2",36,0)
 .S PTP=$G(^SCPT(404.43,TPIEN,0))
"RTN","SCMCMHP2",37,0)
 .Q:PTP=""
"RTN","SCMCMHP2",38,0)
 .S PTA=+$P(PTP,"^") ;patient team assignment ien (404.42)
"RTN","SCMCMHP2",39,0)
 .S PTAN=$G(^SCPT(404.42,PTA,0))
"RTN","SCMCMHP2",40,0)
 .Q:PTAN=""
"RTN","SCMCMHP2",41,0)
 .S TIEN=+$P(PTAN,"^",3) ;team file ien (404.51)
"RTN","SCMCMHP2",42,0)
 .I $G(TEAM)'=1,'$D(TEAM(TIEN)) Q  ;not a selected team
"RTN","SCMCMHP2",43,0)
 .S TNODE=$G(^SCTM(404.51,TIEN,0))
"RTN","SCMCMHP2",44,0)
 .Q:TNODE=""  I $G(INST)'=1,'$D(INST(+$P(TNODE,U,7))) Q
"RTN","SCMCMHP2",45,0)
 .S TNAME=$P(TNODE,"^") ;team name
"RTN","SCMCMHP2",46,0)
 .S TPI=+$P(PTP,"^",2) ;Team Position file ien (404.57)
"RTN","SCMCMHP2",47,0)
 .S TPN=$G(^SCTM(404.57,TPI,0))
"RTN","SCMCMHP2",48,0)
 .Q:TPN=""
"RTN","SCMCMHP2",49,0)
 .I $G(ROLE)'=1,'$D(ROLE(+$P(TPN,U,3))) Q  ;not a selected role
"RTN","SCMCMHP2",50,0)
 .S POSN=$P(TPN,"^") ;position name
"RTN","SCMCMHP2",51,0)
 .D SETASCL^SCRPRAC2(TPI,.CNAME,.CLIEN)  ;get clinics from multiple
"RTN","SCMCMHP2",52,0)
 .;S CLIEN=+$P(TPN,"^",9) ;associated clinic ien
"RTN","SCMCMHP2",53,0)
 .;commented next line off - clinic enrollment no longer needed SD*5.3*433
"RTN","SCMCMHP2",54,0)
 .;D CECHK(CLIEN,.CNAME,PIEN) ;is patient enrolled in associated clinic?
"RTN","SCMCMHP2",55,0)
 .;S CNAME=$P($G(^SC(CLIEN,0)),"^")  ; SD*5.3*433 remove enroll check
"RTN","SCMCMHP2",56,0)
 .S PC=$S($P(PTP,"^",5)=0:0,1:1) ;primary care position 1or2-yes/0-no
"RTN","SCMCMHP2",57,0)
 .S PNAME=$P($G(^VA(200,+PRAC,0)),"^") ;clinician name
"RTN","SCMCMHP2",58,0)
 .Q:PNAME=""
"RTN","SCMCMHP2",59,0)
 .S PRCP=$P($$OKPREC2^SCMCLK(TPI,DT),U,2)
"RTN","SCMCMHP2",60,0)
 .D GETPINF(PIEN,.CLIEN,.PINF)  ;get patient information and appointments
"RTN","SCMCMHP2",61,0)
 .S CNAME=$G(CNAME(0))  ;first line will capture position information
"RTN","SCMCMHP2",62,0)
 .S PINF=$G(PINF(0))
"RTN","SCMCMHP2",63,0)
 .I PINF=""  D 
"RTN","SCMCMHP2",64,0)
 ..S PINF=PIEN_"^"_$$PDATA(PIEN,CNAME,CNAME,1)
"RTN","SCMCMHP2",65,0)
 .D FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP)
"RTN","SCMCMHP2",66,0)
 .D SETFORM(PIEN,.CNAME,.PINF)
"RTN","SCMCMHP2",67,0)
SETFORM(PIEN,CNAME,PINF) ;Format for clinic info only for multiples
"RTN","SCMCMHP2",68,0)
 N SCCNT
"RTN","SCMCMHP2",69,0)
 S SCCNT=0 F  S SCCNT=$O(PINF(SCCNT)) Q:SCCNT=""  D FORMATAC(CNAME(SCCNT),PINF(SCCNT),PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP)
"RTN","SCMCMHP2",70,0)
 Q
"RTN","SCMCMHP2",71,0)
GETPINF(PIEN,CLIEN,PINF)  ;get patient info 
"RTN","SCMCMHP2",72,0)
 N SCCNT
"RTN","SCMCMHP2",73,0)
 S SCCNT="" F  S SCCNT=$O(CLIEN(SCCNT)) Q:SCCNT=""  D 
"RTN","SCMCMHP2",74,0)
 .S PINF(SCCNT)=PIEN_"^"_$$PDATA^SCRPEC(PIEN,CLIEN(SCCNT),CNAME(SCCNT),1)
"RTN","SCMCMHP2",75,0)
 .;Patch 589 -- format SSN (3rd piece) to xxxxxNNNN
"RTN","SCMCMHP2",76,0)
 .S $P(PINF(SCCNT),U,3)="xxxxx"_$E($P(PINF(SCCNT),U,3),6,9)
"RTN","SCMCMHP2",77,0)
 Q
"RTN","SCMCMHP2",78,0)
 ;
"RTN","SCMCMHP2",79,0)
FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ; format data for display
"RTN","SCMCMHP2",80,0)
 ;CNAME - clinic name
"RTN","SCMCMHP2",81,0)
 ;PINF - patient/clinic data
"RTN","SCMCMHP2",82,0)
 ;PC - primary care 1/0
"RTN","SCMCMHP2",83,0)
 ;TIEN - team file ien (#404.51)
"RTN","SCMCMHP2",84,0)
 ;TNAME - team name
"RTN","SCMCMHP2",85,0)
 ;PRAC - practitioner ien (#200)
"RTN","SCMCMHP2",86,0)
 ;PNAME - practitioner name
"RTN","SCMCMHP2",87,0)
 ;POSN - position name
"RTN","SCMCMHP2",88,0)
 ;TPI - team position ien (#404.57)
"RTN","SCMCMHP2",89,0)
 ;PRCP - preceptor name
"RTN","SCMCMHP2",90,0)
 ;
"RTN","SCMCMHP2",91,0)
 N IIEN,INAME,ERR
"RTN","SCMCMHP2",92,0)
 ;patch 589 - copied SETUP from SCRPPAT3, put in this routine, changed call
"RTN","SCMCMHP2",93,0)
 S ERR=$$SETUP^SCMCMHP2(.IIEN,.INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP)
"RTN","SCMCMHP2",94,0)
 I ERR Q
"RTN","SCMCMHP2",95,0)
 ;
"RTN","SCMCMHP2",96,0)
 I SORT=1 D STOR(IIEN,TIEN,PRAC,PINF,PNAME,TNAME,TPI) ;sort division,team,clinician
"RTN","SCMCMHP2",97,0)
 I SORT=2 D STOR(IIEN,PRAC,TIEN,PINF,PNAME,TNAME,TPI) ;sort division,clinician,team
"RTN","SCMCMHP2",98,0)
 I SORT=3 D STOR(1,PRAC,1,PINF,PNAME,"T3",TPI)
"RTN","SCMCMHP2",99,0)
 Q
"RTN","SCMCMHP2",100,0)
 ;
"RTN","SCMCMHP2",101,0)
FORMATAC(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ; format data for display
"RTN","SCMCMHP2",102,0)
 ;CNAME - clinic name
"RTN","SCMCMHP2",103,0)
 ;PINF - patient/clinic data
"RTN","SCMCMHP2",104,0)
 ;PC - primary care 1/0
"RTN","SCMCMHP2",105,0)
 ;TIEN - team file ien (#404.51)
"RTN","SCMCMHP2",106,0)
 ;TNAME - team name
"RTN","SCMCMHP2",107,0)
 ;PRAC - practitioner ien (#200)
"RTN","SCMCMHP2",108,0)
 ;PNAME - practitioner name
"RTN","SCMCMHP2",109,0)
 ;POSN - position name
"RTN","SCMCMHP2",110,0)
 ;TPI - team position ien (#404.57)
"RTN","SCMCMHP2",111,0)
 ;PRCP - preceptor name
"RTN","SCMCMHP2",112,0)
 ;
"RTN","SCMCMHP2",113,0)
 N IIEN,INAME,ERR
"RTN","SCMCMHP2",114,0)
 ;patch 589 - copied SETUP from SCRPPAT3, put in this routine, changed call
"RTN","SCMCMHP2",115,0)
 S ERR=$$SETUP^SCMCMHP2(.IIEN,.INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP)
"RTN","SCMCMHP2",116,0)
 I ERR Q
"RTN","SCMCMHP2",117,0)
 ;
"RTN","SCMCMHP2",118,0)
 I SORT=1 D STORA(IIEN,TIEN,PRAC,PINF,PNAME,TNAME,TPI,SCCNT) ;sort division,team,practitioner
"RTN","SCMCMHP2",119,0)
 I SORT=2 D STORA(IIEN,PRAC,TIEN,PINF,PNAME,TNAME,TPI,SCCNT) ;sort division,practitioner,team
"RTN","SCMCMHP2",120,0)
 I SORT=3 D STORA(1,PRAC,1,PINF,PNAME,"T3",TPI,SCCNT)
"RTN","SCMCMHP2",121,0)
 Q
"RTN","SCMCMHP2",122,0)
 ;
"RTN","SCMCMHP2",123,0)
STOR(IIEN,SEC,TRD,PINF,PNAME,TNAME,TPI,SCCNT) ;
"RTN","SCMCMHP2",124,0)
 ;IIEN - ien institution
"RTN","SCMCMHP2",125,0)
 ;SEC - second sort subscript, IEN team or IEN practitioner
"RTN","SCMCMHP2",126,0)
 ;TRD - third sort subscript, IEN team or IEN practitioner
"RTN","SCMCMHP2",127,0)
 ;PINF - patient/clinic info
"RTN","SCMCMHP2",128,0)
 ;PNAME - practitioner name
"RTN","SCMCMHP2",129,0)
 ;TNAME - team name
"RTN","SCMCMHP2",130,0)
 ;TPI - team position ien
"RTN","SCMCMHP2",131,0)
 ;
"RTN","SCMCMHP2",132,0)
 N PIEN,PTNAME,PID
"RTN","SCMCMHP2",133,0)
 S PIEN=+$P(PINF,"^") ;patient ien 
"RTN","SCMCMHP2",134,0)
 S PTNAME=$E($P(PINF,"^",2),1,10) ;patient name
"RTN","SCMCMHP2",135,0)
 Q:$D(@STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN))
"RTN","SCMCMHP2",136,0)
 S @STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN)=""
"RTN","SCMCMHP2",137,0)
 I 'SUMM,'$D(@STORE@("PTOT",IIEN,SEC,TRD,PIEN)) D
"RTN","SCMCMHP2",138,0)
 .;count each unique patient for any given practitioner for grand total
"RTN","SCMCMHP2",139,0)
 .S @STORE@("PTOT",IIEN,SEC,TRD,PIEN)=""
"RTN","SCMCMHP2",140,0)
 .S @STORE@("TOTAL",IIEN,PRAC,0)=$G(@STORE@("TOTAL",IIEN,PRAC,0))+1 ;patient count by practitioner
"RTN","SCMCMHP2",141,0)
 ;
"RTN","SCMCMHP2",142,0)
 S @STORE@("TOTAL",IIEN,PRAC,$S(SORT=3:1,1:TIEN),TPI)=$G(@STORE@("TOTAL",IIEN,PRAC,$S(SORT=3:1,1:TIEN),TPI))+1 ;patient count by practitioner and team
"RTN","SCMCMHP2",143,0)
 Q:SUMM
"RTN","SCMCMHP2",144,0)
 ;
"RTN","SCMCMHP2",145,0)
 S @STORE@(IIEN,SEC,TRD,TPI,PIEN)=PTNAME
"RTN","SCMCMHP2",146,0)
 S PID=$P(PINF,"^",3),PID=$TR(PID,"-","")
"RTN","SCMCMHP2",147,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),13)=PID ;ssn
"RTN","SCMCMHP2",148,0)
 ;Removed by patch 589 for Mental Health
"RTN","SCMCMHP2",149,0)
 ;S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),25)=$P(PINF,"^",4) ;means test status
"RTN","SCMCMHP2",150,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),31)=$P(PINF,"^",5) ;eligibility
"RTN","SCMCMHP2",151,0)
 ;Removed by patch 174
"RTN","SCMCMHP2",152,0)
 ;S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),40)=$P(PINF,"^",6) ;patient status
"RTN","SCMCMHP2",153,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),42)=$P(PINF,"^",8) ;last appt
"RTN","SCMCMHP2",154,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),54)=$P(PINF,"^",9) ;nxt appt
"RTN","SCMCMHP2",155,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),66)=$E(CNAME,1,15) ;clinic
"RTN","SCMCMHP2",156,0)
 Q
"RTN","SCMCMHP2",157,0)
STORA(IIEN,SEC,TRD,PINF,PNAME,TNAME,TPI,SCCNT) ;
"RTN","SCMCMHP2",158,0)
 I '$D(@STORE@(IIEN,SEC,TRD,TPI,PIEN,SCCNT))  D
"RTN","SCMCMHP2",159,0)
 .S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN,SCCNT),42)=$P(PINF,"^",8) ;last appt
"RTN","SCMCMHP2",160,0)
 .S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN,SCCNT),54)=$P(PINF,"^",9) ;nxt appt
"RTN","SCMCMHP2",161,0)
 .S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN,SCCNT),66)=$E(CNAME,1,15) ;clinic
"RTN","SCMCMHP2",162,0)
 .Q
"RTN","SCMCMHP2",163,0)
 Q
"RTN","SCMCMHP2",164,0)
PDATA(DFN,CLNEN,CNAME,FLAG) ;
"RTN","SCMCMHP2",165,0)
 ;  Patch 589 - copied from SCRPEC so that the SSN can be formatted:
"RTN","SCMCMHP2",166,0)
 ;              xxxxxNNNN
"RTN","SCMCMHP2",167,0)
 ;
"RTN","SCMCMHP2",168,0)
 ;Collect and format data for report
"RTN","SCMCMHP2",169,0)
 ;
"RTN","SCMCMHP2",170,0)
 N NODE,NAME,PID,PELIG,MT,PSTAT,STATD,DATA,LAST,NEXT
"RTN","SCMCMHP2",171,0)
 S DATA=""
"RTN","SCMCMHP2",172,0)
 S NODE=$G(^DPT(DFN,0))
"RTN","SCMCMHP2",173,0)
 S NAME=$P(NODE,"^") ;patient name
"RTN","SCMCMHP2",174,0)
 S PID=$P($G(^DPT(DFN,.36)),"^",3),PID=$TR(PID,"-","") ;PID without '-'s
"RTN","SCMCMHP2",175,0)
 ;Patc 589 - format SSN
"RTN","SCMCMHP2",176,0)
 S PID="xxxxx"_$E(PID,6,9)
"RTN","SCMCMHP2",177,0)
 S MT=$$LST^DGMTU(DFN),MT=$P(MT,"^",4)  ;means test status SD*5.3*431
"RTN","SCMCMHP2",178,0)
 S PELIG=$$ELIG^SCRPU3(DFN) ;primary eligibility
"RTN","SCMCMHP2",179,0)
 S PSTAT="N/A"
"RTN","SCMCMHP2",180,0)
 S STATD=""
"RTN","SCMCMHP2",181,0)
 S LAST=$$GETLAST^SCRPU3(DFN,.CLNEN) ;last Clinic appointment
"RTN","SCMCMHP2",182,0)
 S NEXT=$$GETNEXT^SCRPU3(DFN,.CLNEN) ;next clinic appointment
"RTN","SCMCMHP2",183,0)
 ;I '$D(FLAG) S DATA=$$FORMAT^SCRPEC2(PTIEN,INS,TIEN,PDATA,CNAME,CIEN)
"RTN","SCMCMHP2",184,0)
 I '$D(FLAG) S DATA=$$FORMAT^SCRPEC2(NAME,PID,MT,PELIG,PSTAT,STATD,LAST,NEXT,CNAME),DATA=$E(NAME,1,12)_"^"_DATA
"RTN","SCMCMHP2",185,0)
 I $D(FLAG) S DATA=$E(NAME,1,12)_"^"_PID_"^"_MT_"^"_PELIG_"^"_PSTAT_"^"_STATD_"^"_LAST_"^"_NEXT
"RTN","SCMCMHP2",186,0)
 Q DATA
"RTN","SCMCMHP2",187,0)
 ;
"RTN","SCMCMHP2",188,0)
SETUP(IIEN,INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ;
"RTN","SCMCMHP2",189,0)
 ;setup data
"RTN","SCMCMHP2",190,0)
 S IIEN=+$P($G(^SCTM(404.51,TIEN,0)),"^",7) ;institution ien
"RTN","SCMCMHP2",191,0)
 S INAME=$P($G(^DIC(4,IIEN,0)),"^") ;institution name
"RTN","SCMCMHP2",192,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCMCMHP2",193,0)
 ;
"RTN","SCMCMHP2",194,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCMCMHP2",195,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCMCMHP2",196,0)
 I $G(SORT)=3 S IIEN=1,TIEN=1
"RTN","SCMCMHP2",197,0)
 ; Patch 589 - changed Practitioner to Clinician
"RTN","SCMCMHP2",198,0)
 I '$D(@STORE@("PN",IIEN,PRAC,TIEN,TPI)) S @STORE@("PN",IIEN,PRAC,TIEN,TPI)="Clinician: "_PNAME_$S(SORT=3:"",1:" ("_POSN_")")
"RTN","SCMCMHP2",199,0)
 I $L(PRCP) S @STORE@("PN",IIEN,PRAC,TIEN,TPI,"PRCP")="   Preceptor: "_PRCP
"RTN","SCMCMHP2",200,0)
 I '$D(@STORE@("TN",IIEN,$S($G(SORT)=3:1,1:TIEN))) S @STORE@("TN",IIEN,$S($G(SORT)=3:1,1:TIEN))="        Team: "_TNAME
"RTN","SCMCMHP2",201,0)
 ;
"RTN","SCMCMHP2",202,0)
 I '$D(@STORE@("I",$S($G(SORT)=3:"S3",1:INAME),IIEN)) S @STORE@("I",$S($G(SORT)=3:"S3",1:INAME),IIEN)="",@STORE@(IIEN)=$S(SORT=3:"",1:"    Division: "_INAME)
"RTN","SCMCMHP2",203,0)
 S @STORE@("T",IIEN,$S($G(SORT)=3:"T3",1:TNAME),$S($G(SORT)=3:1,1:TIEN))=""
"RTN","SCMCMHP2",204,0)
 I '$D(@STORE@("P",IIEN,PNAME,PRAC,TPI)) S @STORE@("P",IIEN,PNAME,PRAC,TPI)=""
"RTN","SCMCMHP2",205,0)
 I '$D(@STORE@("TOTAL",IIEN,PRAC,0)) S @STORE@("TOTAL",IIEN,PRAC,0)=0
"RTN","SCMCMHP2",206,0)
 I '$D(@STORE@("TOTAL",IIEN,PRAC,TIEN)) S @STORE@("TOTAL",IIEN,PRAC,TIEN)=0
"RTN","SCMCMHP2",207,0)
 ;
"RTN","SCMCMHP2",208,0)
 S @STORE@("TH",IIEN,PRAC)="Patient Count for "_PNAME_": "
"RTN","SCMCMHP2",209,0)
 S @STORE@("TH",IIEN,PRAC,TIEN,TPI)="Patient Count for "_PNAME_": "
"RTN","SCMCMHP2",210,0)
 N SCX
"RTN","SCMCMHP2",211,0)
 S SCX=$E(PNAME,1,22),$E(SCX,25)=$E(POSN,1,22),$E(SCX,49)=$E(TNAME,1,22)
"RTN","SCMCMHP2",212,0)
 S @STORE@("SUM0",IIEN,PRAC,TIEN,TPI)=SCX
"RTN","SCMCMHP2",213,0)
 ;
"RTN","SCMCMHP2",214,0)
 S @STORE@("TH",IIEN)="** Note: Patient Panel Count is a count of unique patients for each practitioner"
"RTN","SCMCMHP2",215,0)
 Q 0
"RTN","SCMCMHPP")
0^1^B88195737^n/a
"RTN","SCMCMHPP",1,0)
SCMCMHPP ;BP-CIOFO/LLH - MH Clinician's Patients ; 2/7/2012 10:00am
"RTN","SCMCMHPP",2,0)
 ;;5.3;Scheduling;**589**;AUG 13, 1993;Build 41
"RTN","SCMCMHPP",3,0)
 ;
"RTN","SCMCMHPP",4,0)
 ;Routine copied from SCRPPAT and modified for Mental Health. 
"RTN","SCMCMHPP",5,0)
 ;Specific modification is to screen for Mental Health teams and
"RTN","SCMCMHPP",6,0)
 ;if all selected it will be all MH teams
"RTN","SCMCMHPP",7,0)
 ;as well as outputting an '^' delimited summary report.
"RTN","SCMCMHPP",8,0)
 ;
"RTN","SCMCMHPP",9,0)
PROMPTS ;
"RTN","SCMCMHPP",10,0)
 ;Prompt for division, team, role, clinician, summary only and 
"RTN","SCMCMHPP",11,0)
 ;print device
"RTN","SCMCMHPP",12,0)
 ;
"RTN","SCMCMHPP",13,0)
 N QTIME,PRNT,VAUTP,Y,VAUTD,VAUTT,VAUTR,VAUTS,SORT,NUMBER,VADEL
"RTN","SCMCMHPP",14,0)
 K SCUP
"RTN","SCMCMHPP",15,0)
 S QTIME=""
"RTN","SCMCMHPP",16,0)
 W ! D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCMCMHPP",17,0)
 ;Patch 589 - screen teams for Mental Health only
"RTN","SCMCMHPP",18,0)
 W ! K Y D PRMTT^SCMCMHU1 I '$D(VAUTT) G ERR
"RTN","SCMCMHPP",19,0)
 W ! K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCMCMHPP",20,0)
 W ! D PRACT^SCMCMHU1 I '$D(VAUTP) G ERR
"RTN","SCMCMHPP",21,0)
 W ! S VAUTS=$$SUMM^SCRPU2() I VAUTS<0 G ERR
"RTN","SCMCMHPP",22,0)
 ;Patch 589 - if summary report being requested, ask for ^ delimited output
"RTN","SCMCMHPP",23,0)
 S:'VAUTS VADEL=0
"RTN","SCMCMHPP",24,0)
 I VAUTS W ! S VADEL=$$DELOUT^SCMCMHU1() I VADEL<0 G ERR
"RTN","SCMCMHPP",25,0)
 S SORT=""
"RTN","SCMCMHPP",26,0)
 I VADEL=1 S SORT=1
"RTN","SCMCMHPP",27,0)
 I SORT'=1 W ! S SORT=$$SORT^SCMCMHU1() I SORT<1 G ERR
"RTN","SCMCMHPP",28,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCMCMHPP",29,0)
 I PRNT=-1 G ERR
"RTN","SCMCMHPP",30,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCMCMHPP",31,0)
 I QTIME=-1 G ERR
"RTN","SCMCMHPP",32,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCMCMHPP",33,0)
 ;Patch 589 - added VADEL
"RTN","SCMCMHPP",34,0)
 S NUMBER=$$ENTRY2(.VAUTD,.VAUTT,.VAUTR,.VAUTP,VAUTS,SORT,PRNT,QTIME,VADEL)
"RTN","SCMCMHPP",35,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCMCMHPP",36,0)
 Q
"RTN","SCMCMHPP",37,0)
 ;
"RTN","SCMCMHPP",38,0)
ENTRY2(INST,TEAM,ROLE,PRACT,SUMM,SORT,IOP,ZTDTH,VADEL) ;
"RTN","SCMCMHPP",39,0)
 ;Second entry point for GUI to use
"RTN","SCMCMHPP",40,0)
 ;Input Parameters:
"RTN","SCMCMHPP",41,0)
 ;INST - institutions selected (variable and array)
"RTN","SCMCMHPP",42,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCMCMHPP",43,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCMCMHPP",44,0)
 ;PRACT - clinicians selected (ien new person file) - (variable and array)
"RTN","SCMCMHPP",45,0)
 ;SUMM - summary info? y/n (1-yes/0-no) yes don't print patient data
"RTN","SCMCMHPP",46,0)
 ;SORT - sort criteria (1-d,t,p/2-d,p,t)
"RTN","SCMCMHPP",47,0)
 ;IOP - print device
"RTN","SCMCMHPP",48,0)
 ;ZTDTH - queue time (optional)
"RTN","SCMCMHPP",49,0)
 ;
"RTN","SCMCMHPP",50,0)
 ;validate parameters
"RTN","SCMCMHPP",51,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(PRACT)!'$D(SUMM)!'$D(SORT)!'$D(IOP)!(IOP="")!'$D(VADEL) Q
"RTN","SCMCMHPP",52,0)
 ;
"RTN","SCMCMHPP",53,0)
 N NUMBER
"RTN","SCMCMHPP",54,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCMCMHPP",55,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCMCMHPP",56,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCMCMHPP",57,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCMCMHPP",58,0)
 S ZTRTN="QENTRY^SCMCMHPP"
"RTN","SCMCMHPP",59,0)
 ;patch 589 changed clinician's to Clinician's
"RTN","SCMCMHPP",60,0)
 S ZTDESC="MH Clinician's Patients",ZTIO=IOP
"RTN","SCMCMHPP",61,0)
 N II
"RTN","SCMCMHPP",62,0)
 ;Patch 589 added VADEL
"RTN","SCMCMHPP",63,0)
 F II="IOSL","INST","INST(","TEAM","TEAM(","ROLE","ROLE(","PRACT(","PRACT","SUMM","IOP","SORT","VADEL" S ZTSAVE(II)=""
"RTN","SCMCMHPP",64,0)
 D ^%ZTLOAD
"RTN","SCMCMHPP",65,0)
RET S NUMBER=0
"RTN","SCMCMHPP",66,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCMCMHPP",67,0)
 D EXIT1
"RTN","SCMCMHPP",68,0)
 Q NUMBER
"RTN","SCMCMHPP",69,0)
 ;
"RTN","SCMCMHPP",70,0)
QENTRY ;
"RTN","SCMCMHPP",71,0)
 ;driver entry point
"RTN","SCMCMHPP",72,0)
 ;patch 589 changed clinician's to Clinician's
"RTN","SCMCMHPP",73,0)
 S TITL="MH Clinician's Patients"
"RTN","SCMCMHPP",74,0)
 I SUMM S TITL=TITL_" Summary Report"
"RTN","SCMCMHPP",75,0)
 S STORE="^TMP("_$J_",""SCRPPAT"")"
"RTN","SCMCMHPP",76,0)
 K @STORE
"RTN","SCMCMHPP",77,0)
 S @STORE=0
"RTN","SCMCMHPP",78,0)
 ;Patch 589, changed from ^SCRPPAT2 to ^SCMCMHP2
"RTN","SCMCMHPP",79,0)
 D DRIVE^SCMCMHP2
"RTN","SCMCMHPP",80,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCMCMHPP",81,0)
 ;Patch 589 - if output is sent to a delimited format, use selected device
"RTN","SCMCMHPP",82,0)
 ; but do special formating
"RTN","SCMCMHPP",83,0)
 I '$D(NODATA)&VADEL D SPECFMT(STORE)
"RTN","SCMCMHPP",84,0)
 I '$D(NODATA)&'VADEL D PRINTIT(STORE,IOP,TITL,SORT)
"RTN","SCMCMHPP",85,0)
 D EXIT2
"RTN","SCMCMHPP",86,0)
 Q
"RTN","SCMCMHPP",87,0)
 ;
"RTN","SCMCMHPP",88,0)
ERR ;
"RTN","SCMCMHPP",89,0)
EXIT1 ;
"RTN","SCMCMHPP",90,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,VAUTD,VAUTT,VAUTP,VAUTR
"RTN","SCMCMHPP",91,0)
 K SCUP,VAUTS,SORT
"RTN","SCMCMHPP",92,0)
 Q
"RTN","SCMCMHPP",93,0)
 ;
"RTN","SCMCMHPP",94,0)
EXIT2 ;
"RTN","SCMCMHPP",95,0)
 K @STORE
"RTN","SCMCMHPP",96,0)
 K STORE,TITL,IOP,PRACT,INST,TEAM,ROLE,SORT,SUMM,NODATA,STOP
"RTN","SCMCMHPP",97,0)
 Q
"RTN","SCMCMHPP",98,0)
 ;
"RTN","SCMCMHPP",99,0)
PRINTIT(STORE,IOP,TITL,SORT) ; Print All Data
"RTN","SCMCMHPP",100,0)
 ;STORE - global location of data
"RTN","SCMCMHPP",101,0)
 ;IOP - device to print to
"RTN","SCMCMHPP",102,0)
 ;TITL - title of report
"RTN","SCMCMHPP",103,0)
 ;SORT - sort order 1-div,team,clinician/2-div,clinician,team
"RTN","SCMCMHPP",104,0)
 ;
"RTN","SCMCMHPP",105,0)
 N PAGE
"RTN","SCMCMHPP",106,0)
 S PAGE=1,STOP=0 W:$E(IOST)="C" @IOF
"RTN","SCMCMHPP",107,0)
 N SEC1,SEC2,SEC2,SEC3,SEC4,ST1,ST2,ST3,ST4
"RTN","SCMCMHPP",108,0)
 I SORT=1 S SEC1="""T""",SEC2="""P""",SEC3="""TN""",SEC4="""PN"""
"RTN","SCMCMHPP",109,0)
 I SORT=2!(SORT=3) S SEC1="""P""",SEC2="""T""",SEC3="""PN""",SEC4="""TN"""
"RTN","SCMCMHPP",110,0)
 N SEC,TRD,INS,INAME,SECN,TRDN,PT,FIRST
"RTN","SCMCMHPP",111,0)
 S (INAME,INS)="",FIRST=1
"RTN","SCMCMHPP",112,0)
 F  S INAME=$O(@STORE@("I",INAME)) Q:INAME=""!(STOP)  D
"RTN","SCMCMHPP",113,0)
 .S INS=$O(@STORE@("I",INAME,""))
"RTN","SCMCMHPP",114,0)
 .Q:INS=""!STOP
"RTN","SCMCMHPP",115,0)
 .D S
"RTN","SCMCMHPP",116,0)
 D S1
"RTN","SCMCMHPP",117,0)
 Q
"RTN","SCMCMHPP",118,0)
S ;
"RTN","SCMCMHPP",119,0)
 S SECN="",ST1=$E(STORE,1,($L(STORE)-1))_","_SEC1_")"
"RTN","SCMCMHPP",120,0)
 F  S SECN=$O(@ST1@(INS,SECN)) Q:SECN=""!(STOP)  D
"RTN","SCMCMHPP",121,0)
 .S SEC=$O(@ST1@(INS,SECN,"")) ;ien of team or clinician
"RTN","SCMCMHPP",122,0)
 .Q:SEC=""
"RTN","SCMCMHPP",123,0)
 .S ST3=$E(STORE,1,($L(STORE)-1))_","_SEC3_")"
"RTN","SCMCMHPP",124,0)
 .S TRDN="",ST2=$E(STORE,1,($L(STORE)-1))_","_SEC2_")"
"RTN","SCMCMHPP",125,0)
 .F  S TRDN=$O(@ST2@(INS,TRDN)) Q:TRDN=""!(STOP)  D
"RTN","SCMCMHPP",126,0)
 ..S TRD=$O(@ST2@(INS,TRDN,"")) ;ien of team or clinician
"RTN","SCMCMHPP",127,0)
 ..Q:TRD=""
"RTN","SCMCMHPP",128,0)
 ..;have first team and first clinician ien
"RTN","SCMCMHPP",129,0)
 ..S ST4=$E(STORE,1,($L(STORE)-1))_","_SEC4_")"
"RTN","SCMCMHPP",130,0)
 ..D PRNT(ST4,ST3,SEC3,.PAGE,TITL,INS,SEC,TRD) Q:STOP
"RTN","SCMCMHPP",131,0)
 Q
"RTN","SCMCMHPP",132,0)
S1 I $E(IOST)="C",'STOP W ! N DIR S DIR(0)="E" D ^DIR S STOP=Y'=1
"RTN","SCMCMHPP",133,0)
 I 'STOP,SUMM=0 S (FIRST,SUMM)=1,TITL=TITL_" Summary Report" W @IOF D PRINTIT(STORE,$G(IOP),TITL,SORT)
"RTN","SCMCMHPP",134,0)
 Q
"RTN","SCMCMHPP",135,0)
 ;
"RTN","SCMCMHPP",136,0)
PRNT(ST4,ST3,SEC3,PAGE,TITL,INS,SEC,TRD) ;
"RTN","SCMCMHPP",137,0)
 ;
"RTN","SCMCMHPP",138,0)
 N POS
"RTN","SCMCMHPP",139,0)
 I (SEC3="""PN""")&($D(@ST3@(INS,SEC,TRD))) D
"RTN","SCMCMHPP",140,0)
 .;get each position for clinician
"RTN","SCMCMHPP",141,0)
 .N MORE S POS="",MORE=0
"RTN","SCMCMHPP",142,0)
 .F  S POS=$O(@ST3@(INS,SEC,TRD,POS)) Q:POS=""!(STOP)  D
"RTN","SCMCMHPP",143,0)
 ..I 'SUMM I SORT=3 D  Q
"RTN","SCMCMHPP",144,0)
 ...;I MORE ;S FIRST=0
"RTN","SCMCMHPP",145,0)
 ...K @STORE@("H1") D SHEAD
"RTN","SCMCMHPP",146,0)
 ...I 'MORE I (PAGE=1)!(IOST?1"C-".E) D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCMCMHPP",147,0)
 ...;patch 589 -- modified to print, Clinician rather than Practitioner
"RTN","SCMCMHPP",148,0)
 ...I 'MORE N STR S STR=$G(@ST3@(INS,SEC,TRD,POS)) W !," Clinician:"_$P(STR,":",2),!
"RTN","SCMCMHPP",149,0)
 ...;I 'MORE W !,$G(@ST3@(INS,SEC,TRD,POS)),!
"RTN","SCMCMHPP",150,0)
 ...D PAT^SCRPPAT3(INS,SEC,TRD,SEC3,ST3,ST4,POS) S MORE=1
"RTN","SCMCMHPP",151,0)
 ...I $O(@ST3@(INS,SEC,TRD,POS))="" D
"RTN","SCMCMHPP",152,0)
 ....I (IOST?1"C-".E) D HOLD(.PAGE,"") S PAGE=PAGE+1 Q:STOP
"RTN","SCMCMHPP",153,0)
 ....I (IOST'?1"C-".E) D NEWP1^SCRPU3(.PAGE,TITL) Q:STOP
"RTN","SCMCMHPP",154,0)
 ..I SUMM D  Q
"RTN","SCMCMHPP",155,0)
 ...I FIRST D TITLE^SCRPU3(.PAGE,TITL),SHEAD,SSH S FIRST=0
"RTN","SCMCMHPP",156,0)
 ...I (IOST'?1"C-".E),$Y>(IOSL-4) D NEWP1^SCRPU3(.PAGE,TITL) Q:STOP  D SSH
"RTN","SCMCMHPP",157,0)
 ...I (IOST?1"C-".E),$Y>(IOSL-6) D HOLD^SCRPU3(.PAGE,TITL) Q:STOP  D SSH
"RTN","SCMCMHPP",158,0)
 ...W !,@STORE@("SUM0",INS,SEC,TRD,POS)
"RTN","SCMCMHPP",159,0)
 ...W ?72,$J($G(@STORE@("TOTAL",INS,SEC,TRD,POS)),8)
"RTN","SCMCMHPP",160,0)
 ...Q
"RTN","SCMCMHPP",161,0)
 ..Q:SORT=3
"RTN","SCMCMHPP",162,0)
 ..I FIRST D:'MORE TITLE^SCRPU3(.PAGE,TITL) D SHEAD
"RTN","SCMCMHPP",163,0)
 ..;patch 589 - commented W commands out, it wrote the division header incorrectly
"RTN","SCMCMHPP",164,0)
 ..I (IOST'?1"C-".E),'SUMM,'FIRST D NEWP1^SCRPU3(.PAGE,TITL) ;W:'STOP !,$G(@STORE@(INS))
"RTN","SCMCMHPP",165,0)
 ..I (IOST?1"C-".E),'SUMM,'FIRST D HOLD^SCRPU3(.PAGE,TITL) ;W:'STOP !,$G(@STORE@(INS))
"RTN","SCMCMHPP",166,0)
 ..Q:STOP  S FIRST=1 I 'MORE S FIRST=0
"RTN","SCMCMHPP",167,0)
 ..;patch 589 - modified to print, Clinician rather than Practitioner
"RTN","SCMCMHPP",168,0)
 ..N STR S STR=$G(@ST3@(INS,SEC,TRD,POS)) W !," Clinician:"_$P(STR,":",2)
"RTN","SCMCMHPP",169,0)
 ..;W !,$G(@ST3@(INS,SEC,TRD,POS)) ;write clinician (sort 1)
"RTN","SCMCMHPP",170,0)
 ..I $L($G(@ST3@(INS,SEC,TRD,POS,"PRCP"))) W !,@ST3@(INS,SEC,TRD,POS,"PRCP")
"RTN","SCMCMHPP",171,0)
 ..I $G(SORT)'=3 W !,$G(@ST4@(INS,TRD)) ;write team (sort 2)
"RTN","SCMCMHPP",172,0)
 ..W !,$G(@STORE@(INS))
"RTN","SCMCMHPP",173,0)
 ..;$o through patients for clinician on team
"RTN","SCMCMHPP",174,0)
 ..D PAT^SCRPPAT3(INS,SEC,TRD,SEC3,ST3,ST4,POS) Q:STOP
"RTN","SCMCMHPP",175,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-4) D NEWP1^SCRPU3(.PAGE,TITL) Q:STOP
"RTN","SCMCMHPP",176,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-6) D HOLD^SCRPU3(.PAGE,TITL) Q:STOP
"RTN","SCMCMHPP",177,0)
 ..D TOTAL1^SCRPPAT3(INS,SEC,TRD,POS) ;print team/clinician total
"RTN","SCMCMHPP",178,0)
 ;
"RTN","SCMCMHPP",179,0)
 I (SEC3="""TN""")&($D(@ST4@(INS,TRD,SEC))) D
"RTN","SCMCMHPP",180,0)
 .S POS=""
"RTN","SCMCMHPP",181,0)
 .F  S POS=$O(@ST4@(INS,TRD,SEC,POS)) Q:POS=""!(STOP)  D
"RTN","SCMCMHPP",182,0)
 ..I SUMM D  Q
"RTN","SCMCMHPP",183,0)
 ...I FIRST D TITLE^SCRPU3(.PAGE,TITL),SHEAD,SSH S FIRST=0
"RTN","SCMCMHPP",184,0)
 ...I (IOST'?1"C-".E),$Y>(IOSL-4) D NEWP1^SCRPU3(.PAGE,TITL) Q:STOP  D SSH
"RTN","SCMCMHPP",185,0)
 ...I (IOST?1"C-".E),$Y>(IOSL-6) D HOLD^SCRPU3(.PAGE,TITL) Q:STOP  D SSH
"RTN","SCMCMHPP",186,0)
 ...W !,@STORE@("SUM0",INS,TRD,SEC,POS)
"RTN","SCMCMHPP",187,0)
 ...W ?72,$J(@STORE@("TOTAL",INS,TRD,SEC,POS),8)
"RTN","SCMCMHPP",188,0)
 ...Q
"RTN","SCMCMHPP",189,0)
 ..I FIRST D TITLE^SCRPU3(.PAGE,TITL),SHEAD
"RTN","SCMCMHPP",190,0)
 ..I (IOST'?1"C-".E),'SUMM,'FIRST D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCMCMHPP",191,0)
 ..I (IOST?1"C-".E),'SUMM,'FIRST D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCMCMHPP",192,0)
 ..Q:STOP  S FIRST=0
"RTN","SCMCMHPP",193,0)
 ..I $G(SORT)'=3 W !,$G(@ST3@(INS,SEC)) ;write team (sort 1)
"RTN","SCMCMHPP",194,0)
 ..W !,$G(@STORE@(INS))
"RTN","SCMCMHPP",195,0)
 ..;patch 589 - modified to print, Clinician rather than Practitioner
"RTN","SCMCMHPP",196,0)
 ..I $G(SORT)'=3 N STR D
"RTN","SCMCMHPP",197,0)
 ...S STR=$G(@ST4@(INS,TRD,SEC,POS)) W !," Clinician:"_$P(STR,":",2)
"RTN","SCMCMHPP",198,0)
 ..;I $G(SORT)'=3 W !,$G(@ST4@(INS,TRD,SEC,POS)) ;write clinician (sort 2)
"RTN","SCMCMHPP",199,0)
 ..I $L($G(@ST4@(INS,TRD,SEC,POS,"PRCP"))) W !,@ST4@(INS,TRD,SEC,POS,"PRCP")
"RTN","SCMCMHPP",200,0)
 ..W !
"RTN","SCMCMHPP",201,0)
 ..;$o through patients for clinician on team
"RTN","SCMCMHPP",202,0)
 ..D PAT^SCRPPAT3(INS,SEC,TRD,SEC3,ST3,ST4,POS) Q:STOP
"RTN","SCMCMHPP",203,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-4) D NEWP1^SCRPU3(.PAGE,TITL) Q:STOP
"RTN","SCMCMHPP",204,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-6) D HOLD^SCRPU3(.PAGE,TITL) Q:STOP
"RTN","SCMCMHPP",205,0)
 ..D TOTAL1^SCRPPAT3(INS,SEC,TRD,POS) ;print team/clinician total
"RTN","SCMCMHPP",206,0)
 Q
"RTN","SCMCMHPP",207,0)
 ;
"RTN","SCMCMHPP",208,0)
SPECFMT(STORE) ; Patch 589 - format delimited output
"RTN","SCMCMHPP",209,0)
 ;STORE - global location of data
"RTN","SCMCMHPP",210,0)
 ;IOP - device to print to
"RTN","SCMCMHPP",211,0)
 ;TITL - title of report
"RTN","SCMCMHPP",212,0)
 ;SORT - sort order 1-div,team,clinician/2-div,clinician,team
"RTN","SCMCMHPP",213,0)
 ;
"RTN","SCMCMHPP",214,0)
 N DATA,INS,POS,SEC,TRD
"RTN","SCMCMHPP",215,0)
 ;Patch 589 changed Practitioner's to Clinician
"RTN","SCMCMHPP",216,0)
 W !,"Printed on: "_$$FMTE^XLFDT(DT,"5D")_U_"Clinician's Patients Summary Report"
"RTN","SCMCMHPP",217,0)
 W !,"Clinician"_U_"Position"_U_"Team"_U_"Patients Assigned"
"RTN","SCMCMHPP",218,0)
 S INS=0 F  S INS=$O(@STORE@("SUM0",INS)) Q:INS'>0  D
"RTN","SCMCMHPP",219,0)
 .S SEC=0 F  S SEC=$O(@STORE@("SUM0",INS,SEC)) Q:SEC'>0  D
"RTN","SCMCMHPP",220,0)
 ..S TRD=0 F  S TRD=$O(@STORE@("SUM0",INS,SEC,TRD)) Q:TRD'>0  D
"RTN","SCMCMHPP",221,0)
 ...S POS=0 F  S POS=$O(@STORE@("SUM0",INS,SEC,TRD,POS)) Q:POS'>0  D
"RTN","SCMCMHPP",222,0)
 ....S DATA=@STORE@("SUM0",INS,SEC,TRD,POS)
"RTN","SCMCMHPP",223,0)
 ....W !,$$FMTDATA(DATA)_U_$G(@STORE@("TOTAL",INS,SEC,TRD,POS))
"RTN","SCMCMHPP",224,0)
 Q
"RTN","SCMCMHPP",225,0)
 ;
"RTN","SCMCMHPP",226,0)
FMTDATA(DATA) ;
"RTN","SCMCMHPP",227,0)
 ; patch 589, used to strip trailing spaces from the formated data
"RTN","SCMCMHPP",228,0)
 ; input - DATA = formatted data, clinician, Position, Team and Patients Assigned
"RTN","SCMCMHPP",229,0)
 ; output - STR = data in DATA, with trailing spaces removed
"RTN","SCMCMHPP",230,0)
 ;
"RTN","SCMCMHPP",231,0)
 N K,D1,D2,D3,STR
"RTN","SCMCMHPP",232,0)
 S STR=""
"RTN","SCMCMHPP",233,0)
 I $G(DATA)="" Q "^^^"
"RTN","SCMCMHPP",234,0)
 S D1=$E(DATA,1,22),D2=$E(DATA,25,48),D3=$E(DATA,49,71)
"RTN","SCMCMHPP",235,0)
 F K=$L(D1):-1 Q:$E(D1,K)'=" "  S D1=$E(D1,1,$L(D1)-1)
"RTN","SCMCMHPP",236,0)
 F K=$L(D2):-1 Q:$E(D2,K)'=" "  S D2=$E(D2,1,$L(D2)-1)
"RTN","SCMCMHPP",237,0)
 F K=$L(D3):-1 Q:$E(D3,K)'=" "  S D3=$E(D3,1,$L(D3)-1)
"RTN","SCMCMHPP",238,0)
 S STR=D1_U_D2_U_D3
"RTN","SCMCMHPP",239,0)
 Q STR
"RTN","SCMCMHPP",240,0)
 ;
"RTN","SCMCMHPP",241,0)
SSH ;Summary subheader
"RTN","SCMCMHPP",242,0)
 ;Patch 589 changed "Practitioner" to "Clinician"
"RTN","SCMCMHPP",243,0)
 W !?72,"Patients",!,"Clinician",?24,"Position",?48,"Team"
"RTN","SCMCMHPP",244,0)
 W ?72,"Assigned",! N SCI F SCI=1:1:80 W "="
"RTN","SCMCMHPP",245,0)
 Q
"RTN","SCMCMHPP",246,0)
HOLD(PAGE,TIT,MARG) ;
"RTN","SCMCMHPP",247,0)
 ;device is home, reached end of page
"RTN","SCMCMHPP",248,0)
 N X
"RTN","SCMCMHPP",249,0)
 S MARG=$G(MARG) S:MARG'>80 MARG=80
"RTN","SCMCMHPP",250,0)
 W !!,"Press Any Key to Continue or '^' to Quit" R X:DTIME
"RTN","SCMCMHPP",251,0)
 I '$T!(X="^") S STOP=1 Q
"RTN","SCMCMHPP",252,0)
 W @IOF
"RTN","SCMCMHPP",253,0)
 Q
"RTN","SCMCMHPP",254,0)
SHEAD ;
"RTN","SCMCMHPP",255,0)
 ;Patch 589 - moved SHEAD from SCRPPAT3 and removed M.T. Stat
"RTN","SCMCMHPP",256,0)
 S @STORE@("H2")="Pt Name"
"RTN","SCMCMHPP",257,0)
 S $E(@STORE@("H2"),15)="Pt ID"
"RTN","SCMCMHPP",258,0)
 ;Removed by patch 589
"RTN","SCMCMHPP",259,0)
 ;S $E(@STORE@("H1"),25)="M.T."
"RTN","SCMCMHPP",260,0)
 ;S $E(@STORE@("H2"),25)="Stat"
"RTN","SCMCMHPP",261,0)
 S $E(@STORE@("H1"),31)="Prim"
"RTN","SCMCMHPP",262,0)
 S $E(@STORE@("H2"),31)="Elig"
"RTN","SCMCMHPP",263,0)
 S $E(@STORE@("H1"),42)="Last"
"RTN","SCMCMHPP",264,0)
 S $E(@STORE@("H2"),42)="Appt"
"RTN","SCMCMHPP",265,0)
 S $E(@STORE@("H1"),54)="Next"
"RTN","SCMCMHPP",266,0)
 S $E(@STORE@("H2"),54)="Appt"
"RTN","SCMCMHPP",267,0)
 S $E(@STORE@("H2"),66)="Clinic"
"RTN","SCMCMHPP",268,0)
 S $P(@STORE@("H3"),"=",81)=""
"RTN","SCMCMHPP",269,0)
 Q
"RTN","SCMCMHU1")
0^7^B29225057^n/a
"RTN","SCMCMHU1",1,0)
SCMCMHU1 ;BP-CIOFO/LLH - Mental Health Reports (cont.) ; 02/08/2012 09:15 AM
"RTN","SCMCMHU1",2,0)
 ;;5.3;Scheduling;**589**;AUG 13, 1993;Build 41
"RTN","SCMCMHU1",3,0)
 ;
"RTN","SCMCMHU1",4,0)
 ; created to use with new Mental Health reports
"RTN","SCMCMHU1",5,0)
 ;
"RTN","SCMCMHU1",6,0)
PRMTT ;Prompt for team.
"RTN","SCMCMHU1",7,0)
 ;
"RTN","SCMCMHU1",8,0)
 ;This subroutine was copied from SCRPU1 and modified to return MH teams. Additionally, 
"RTN","SCMCMHU1",9,0)
 ;the code was modified to set all mental health teams into the VAUTT array if all was 
"RTN","SCMCMHU1",10,0)
 ;selected. This was done so that all other routines could be used to process the data
"RTN","SCMCMHU1",11,0)
 ;
"RTN","SCMCMHU1",12,0)
 I '$D(VAUTD) G ERR
"RTN","SCMCMHU1",13,0)
 S VAUTVB="VAUTT",DIC="^SCTM(404.51,",VAUTNI=2,VAUTSTR="Team",DIC("B")=""
"RTN","SCMCMHU1",14,0)
 ;screen for mental health teams
"RTN","SCMCMHU1",15,0)
 S DIC("S")="I $$MHTEAM^SCMCMHU1(Y)"
"RTN","SCMCMHU1",16,0)
 G FIRST
"RTN","SCMCMHU1",17,0)
 ;
"RTN","SCMCMHU1",18,0)
MHTEAM(IEN) ; Screen for mental health teams only
"RTN","SCMCMHU1",19,0)
 ; input: IEN - internal record number for the team
"RTN","SCMCMHU1",20,0)
 ;output: VALID - 1 if a valid mental health team, 0 if not
"RTN","SCMCMHU1",21,0)
 ;
"RTN","SCMCMHU1",22,0)
 N VALID
"RTN","SCMCMHU1",23,0)
 I $P(^SD(403.47,$P(^SCTM(404.51,IEN,0),U,3),0),U,1)'="MENTAL HEALTH TREATMENT" Q 0
"RTN","SCMCMHU1",24,0)
 I $D(VAUTD(+$P(^SCTM(404.51,IEN,0),U,7))) Q 1
"RTN","SCMCMHU1",25,0)
 I VAUTD=1 Q 1
"RTN","SCMCMHU1",26,0)
 Q 0
"RTN","SCMCMHU1",27,0)
 ;
"RTN","SCMCMHU1",28,0)
 ;
"RTN","SCMCMHU1",29,0)
PRACT ; Patch 589, Change Practitioner to Clinician/Provider
"RTN","SCMCMHU1",30,0)
 ;Prompt for One (set VAUTPO) or One,Many,All,None Practitioner(s)
"RTN","SCMCMHU1",31,0)
 I '$D(VAUTT) G ERR
"RTN","SCMCMHU1",32,0)
 S VAUTVB="VAUTP",VAUTSTR="Clinician/Provider",VAUTNI=2,DIC="^VA(200,"
"RTN","SCMCMHU1",33,0)
 S DIC("S")="I $$PRACS^SCRPU1()"
"RTN","SCMCMHU1",34,0)
 G FIRST
"RTN","SCMCMHU1",35,0)
 ;
"RTN","SCMCMHU1",36,0)
PRACS() ;Practitioner screen - off of team selection
"RTN","SCMCMHU1",37,0)
 N EN,STOP,NODE,TEAM
"RTN","SCMCMHU1",38,0)
 S EN="",STOP=0
"RTN","SCMCMHU1",39,0)
 I '$D(^SCTM(404.52,"C",+Y)) Q 0
"RTN","SCMCMHU1",40,0)
 ;Position Assignment History file
"RTN","SCMCMHU1",41,0)
 F  S EN=$O(^SCTM(404.52,"C",+Y,EN)) Q:EN=""!(STOP)  D
"RTN","SCMCMHU1",42,0)
 .I '$D(^SCTM(404.52,EN)) Q
"RTN","SCMCMHU1",43,0)
 .S NODE=$G(^SCTM(404.52,EN,0))
"RTN","SCMCMHU1",44,0)
 .S TEAM=+$P($G(^SCTM(404.57,$P(NODE,"^"),0)),"^",2)
"RTN","SCMCMHU1",45,0)
 .I $P(NODE,"^",4),$D(VAUTT(TEAM)) S STOP=1
"RTN","SCMCMHU1",46,0)
 .I VAUTT=1 S STOP=1
"RTN","SCMCMHU1",47,0)
 Q STOP
"RTN","SCMCMHU1",48,0)
 ; 
"RTN","SCMCMHU1",49,0)
 ;PRACT ; patch 589 - added subroutine, changed Practitioner to Clinician/Provider 
"RTN","SCMCMHU1",50,0)
 ; ;Prompt for One (set VAUTPO) or One,Many,All,None Clinician/Provider(s)
"RTN","SCMCMHU1",51,0)
 ; I '$D(VAUTT) G ERR
"RTN","SCMCMHU1",52,0)
 ;S VAUTVB="VAUTP",VAUTSTR="Clinician/Provider(s)",VAUTNI=2,DIC="^VA(200,"
"RTN","SCMCMHU1",53,0)
 ;S DIC("S")="I $$PRACS^SCMCMHU1()"
"RTN","SCMCMHU1",54,0)
 ;G FIRST
"RTN","SCMCMHU1",55,0)
 ;
"RTN","SCMCMHU1",56,0)
 ;PRACS() ;Practitioner screen - off of team selection
"RTN","SCMCMHU1",57,0)
 ;N EN,STOP,NODE,TEAM
"RTN","SCMCMHU1",58,0)
 ;S EN="",STOP=0
"RTN","SCMCMHU1",59,0)
 ;I '$D(^SCTM(404.52,"C",+Y)) Q 0
"RTN","SCMCMHU1",60,0)
 ;Position Assignment History file
"RTN","SCMCMHU1",61,0)
 ;F S EN=$O(^SCTM(404.52,"C",+Y,EN)) Q:EN=""!(STOP) D
"RTN","SCMCMHU1",62,0)
 ;.I '$D(^SCTM(404.52,EN)) Q
"RTN","SCMCMHU1",63,0)
 ;.S NODE=$G(^SCTM(404.52,EN,0))
"RTN","SCMCMHU1",64,0)
 ;.S TEAM=+$P($G(^SCTM(404.57,$P(NODE,"^"),0)),"^",2)
"RTN","SCMCMHU1",65,0)
 ;.I $P(NODE,"^",4),$D(VAUTT(TEAM)) S STOP=1
"RTN","SCMCMHU1",66,0)
 ;.I VAUTT=1 S STOP=1
"RTN","SCMCMHU1",67,0)
 ;Q STOP
"RTN","SCMCMHU1",68,0)
 ; 
"RTN","SCMCMHU1",69,0)
FIRST ;
"RTN","SCMCMHU1",70,0)
 S DIC(0)="EQMNZ",DIC("A")="Select "_VAUTSTR_": " K @VAUTVB
"RTN","SCMCMHU1",71,0)
 S (@VAUTVB,Y)=0
"RTN","SCMCMHU1",72,0)
 ;
"RTN","SCMCMHU1",73,0)
REDO W !,DIC("A") R X:DTIME G ERR:(X="^")!'$T D:X["?"!(X=""&('$G(SCOKNULL))) HELP
"RTN","SCMCMHU1",74,0)
 G:$G(SCOKNULL)&(X="") QUIT
"RTN","SCMCMHU1",75,0)
 ;patch 589 call to GETALL is to get all Mental health teams, also must set
"RTN","SCMCMHU1",76,0)
 ;VAUTVB if Clinican/Provider = All
"RTN","SCMCMHU1",77,0)
 I X="A"!(X="ALL")&'$D(VAUTNA) D  G QUIT
"RTN","SCMCMHU1",78,0)
 .I VAUTVB="VAUTT" D GETALL Q
"RTN","SCMCMHU1",79,0)
 .I VAUTVB="VAUTP" S @VAUTVB=1 Q
"RTN","SCMCMHU1",80,0)
 .Q
"RTN","SCMCMHU1",81,0)
 S DIC("A")="Select another "_VAUTSTR_": " D ^DIC G:Y'>0 FIRST D SET
"RTN","SCMCMHU1",82,0)
 I '$D(VAUTPO) F VAI=1:0:19 W !,DIC("A") R X:DTIME G ERR:(X="")!(X="^")!'$T K Y D HELP:X["?" S:$E(X)="-" VAUTX=X,X=$E(VAUTX,2,999) D ^DIC I Y>0 D SET G:VAX REDO S:'VAERR VAI=VAI+1
"RTN","SCMCMHU1",83,0)
 G QUIT
"RTN","SCMCMHU1",84,0)
 ;
"RTN","SCMCMHU1",85,0)
SET S VAX=0 I $D(VAUTX) S J=$S(VAUTNI=2:+Y,1:$P(Y(0),"^")) K VAUTX S VAERR=$S($D(@VAUTVB@(J)):0,1:1) W $S('VAERR:"...removed from list...",1:"...not on list...can't remove") Q:VAERR  S VAI=VAI-1 K @VAUTVB@(J) S:$O(@VAUTVB@(0))']"" VAX=1 Q
"RTN","SCMCMHU1",86,0)
 S VAERR=0 I $S($D(@VAUTVB@($P(Y(0),U))):1,$D(@VAUTVB@(+Y)):1,1:0) W !?3,*7,"You have already selected that ",VAUTSTR,". Try again." S VAERR=1
"RTN","SCMCMHU1",87,0)
 S @VAUTVB@(+Y)=$P(Y(0),U)
"RTN","SCMCMHU1",88,0)
 Q
"RTN","SCMCMHU1",89,0)
 ;
"RTN","SCMCMHU1",90,0)
ERR S Y=-1 I $O(@VAUTVB@(0))="" K @VAUTVB I X="^" S SCUP=""
"RTN","SCMCMHU1",91,0)
QUIT S:'$D(Y) Y=1
"RTN","SCMCMHU1",92,0)
 I $D(@VAUTVB),VAUTSTR="Team",@VAUTVB=1 D:'$G(DGQUIET) EN^DDIOL("All Teams selected, this report may take some time...","","!,?10")
"RTN","SCMCMHU1",93,0)
 K DIC,J,VAERR,VAI,VAJ,VAJ1,VAX,VAUTNI,VAUTSTR,VAUTVB,X
"RTN","SCMCMHU1",94,0)
 Q
"RTN","SCMCMHU1",95,0)
 ;
"RTN","SCMCMHU1",96,0)
HELP ; 
"RTN","SCMCMHU1",97,0)
 W:'$D(VAUTNA) !,"ENTER:",!?5,"- A or ALL for all Mental Health ",VAUTSTR,"s, or"
"RTN","SCMCMHU1",98,0)
 W !?5,"- Select individual Mental Health "_VAUTSTR W:'$D(VAUTPO) " -- limit 20"
"RTN","SCMCMHU1",99,0)
 W !?5,"Imprecise selections will yield an additional prompt."
"RTN","SCMCMHU1",100,0)
 I $O(@VAUTVB@(0))]"" W !?5,"- An entry preceeded by a minus [-] sign to remove entry from list."
"RTN","SCMCMHU1",101,0)
 I $O(@VAUTVB@(0))]"" W !,"NOTE, you have already selected:" S VAJ=0 F VAJ1=0:0 S VAJ=$O(@VAUTVB@(VAJ)) Q:VAJ=""  W !?8,$S(VAUTNI=1:VAJ,1:@VAUTVB@(VAJ))
"RTN","SCMCMHU1",102,0)
 Q
"RTN","SCMCMHU1",103,0)
 ;
"RTN","SCMCMHU1",104,0)
GETALL ; user selected all MH teams, rather than manipulate other routines
"RTN","SCMCMHU1",105,0)
 ; will set all the mental health teams for the division into the team array
"RTN","SCMCMHU1",106,0)
 ;
"RTN","SCMCMHU1",107,0)
 ; input: none
"RTN","SCMCMHU1",108,0)
 ;output: VAUTT array
"RTN","SCMCMHU1",109,0)
 ;
"RTN","SCMCMHU1",110,0)
 K @VAUTVB
"RTN","SCMCMHU1",111,0)
 S @VAUTVB=0
"RTN","SCMCMHU1",112,0)
 N CNT,MHT,STR
"RTN","SCMCMHU1",113,0)
 S (CNT,MHT)=0
"RTN","SCMCMHU1",114,0)
 F  S MHT=$O(^SCTM(404.51,MHT)) Q:(MHT'>0)!(CNT>20)  D
"RTN","SCMCMHU1",115,0)
 .S STR=$G(^SCTM(404.51,MHT,0))
"RTN","SCMCMHU1",116,0)
 .I $P(^SD(403.47,$P(STR,U,3),0),U,1)'="MENTAL HEALTH TREATMENT" Q
"RTN","SCMCMHU1",117,0)
 .I VAUTD=1!($D(VAUTD(+$P(STR,U,7)))) S @VAUTVB@(MHT)=$P(STR,U,1),CNT=CNT+1
"RTN","SCMCMHU1",118,0)
 Q
"RTN","SCMCMHU1",119,0)
DELOUT() ; ask user if Summary should be in a delimited output format
"RTN","SCMCMHU1",120,0)
 ; input - none
"RTN","SCMCMHU1",121,0)
 ;output - 1 if delimited output
"RTN","SCMCMHU1",122,0)
 ; 0 if a regular report format is desired
"RTN","SCMCMHU1",123,0)
 ;
"RTN","SCMCMHU1",124,0)
 N X,DTOUT,DUOUT,DIROUT,Y
"RTN","SCMCMHU1",125,0)
 S DIR("A")="Should the Summary be a '^' delimited format?",DIR("B")="N"
"RTN","SCMCMHU1",126,0)
 S DIR("?")="Enter 'Y' for '^' output, 'N' for a formatted report."
"RTN","SCMCMHU1",127,0)
 S DIR(0)="Y"
"RTN","SCMCMHU1",128,0)
 D ^DIR
"RTN","SCMCMHU1",129,0)
 ;I $D(DTOUT)!(X="") S Y=$S(DIR("B")="Y":1,1:0)
"RTN","SCMCMHU1",130,0)
 I $D(DUOUT)!($D(DIROUT)) S Y=-1
"RTN","SCMCMHU1",131,0)
 K DIR
"RTN","SCMCMHU1",132,0)
 Q +Y
"RTN","SCMCMHU1",133,0)
 ;
"RTN","SCMCMHU1",134,0)
 ;patch 589 - copied from SORT^SCRPU2 and modified to change Practitioner with
"RTN","SCMCMHU1",135,0)
 ; Clinician
"RTN","SCMCMHU1",136,0)
SORT() ;
"RTN","SCMCMHU1",137,0)
 ;Prompt for sorting by Division, Team, Clinician or Division, Practitioner, Team
"RTN","SCMCMHU1",138,0)
 ;
"RTN","SCMCMHU1",139,0)
EN1 N X
"RTN","SCMCMHU1",140,0)
 W !,"Sort By:",!?10,"[1] Division, Team, Clinician",!?10,"[2] Division, Clinician, Team"
"RTN","SCMCMHU1",141,0)
 W !?10,"[3] Clinician,Associated Clinic"
"RTN","SCMCMHU1",142,0)
 W !!,"Select 1 or 2 or 3: "
"RTN","SCMCMHU1",143,0)
 R X:DTIME
"RTN","SCMCMHU1",144,0)
 I (X="^")!'$T Q 0
"RTN","SCMCMHU1",145,0)
 I (X'="1")&(X'="2")&(X'=3) D HLP3 G EN1
"RTN","SCMCMHU1",146,0)
 I (X["?")!(X="") D HLP3 G EN1
"RTN","SCMCMHU1",147,0)
 Q X
"RTN","SCMCMHU1",148,0)
HLP3 ;
"RTN","SCMCMHU1",149,0)
 ;help prompt
"RTN","SCMCMHU1",150,0)
 W !,"Enter: ",!?5,"- 1 to sort by Division, Team, Clinician "
"RTN","SCMCMHU1",151,0)
 W !?10,"- 2 to sort by Division, Clinician, Team"
"RTN","SCMCMHU1",152,0)
 Q 
"RTN","SD53589P")
0^9^B14073216^n/a
"RTN","SD53589P",1,0)
SD53589P ;BP/DMR POST INIT ROUTINE
"RTN","SD53589P",2,0)
 ;;5.3;Scheduling;**589**;Aug 13, 1993;Build 41
"RTN","SD53589P",3,0)
 ;
"RTN","SD53589P",4,0)
 ;Populate file MH PCMM STOP CODES (#404.61).
"RTN","SD53589P",5,0)
 ;
"RTN","SD53589P",6,0)
INIT ;Set temp global
"RTN","SD53589P",7,0)
 S ^TMP("SD53589P",$J,524)="ACTIVE DUTY SEXUAL TRAUMA"
"RTN","SD53589P",8,0)
 S ^TMP("SD53589P",$J,445)="C&P VIA CVT PROV SITE^YES"
"RTN","SD53589P",9,0)
 S ^TMP("SD53589P",$J,444)="C&P VIA CVT PT SITE^YES"
"RTN","SD53589P",10,0)
 S ^TMP("SD53589P",$J,450)="COMP & PENS (C&P) EXAMS^YES"
"RTN","SD53589P",11,0)
 S ^TMP("SD53589P",$J,554)="DAY HOSPITAL-GROUP"
"RTN","SD53589P",12,0)
 S ^TMP("SD53589P",$J,506)="DAY HOSPITAL-INDIVIDUAL"
"RTN","SD53589P",13,0)
 S ^TMP("SD53589P",$J,553)="DAY TREATMENT-GROUP"
"RTN","SD53589P",14,0)
 S ^TMP("SD53589P",$J,505)="DAY TREATMENT-INDIVIDUAL"
"RTN","SD53589P",15,0)
 S ^TMP("SD53589P",$J,448)="DES EXAM^YES"
"RTN","SD53589P",16,0)
 S ^TMP("SD53589P",$J,504)="GRANT & PER DIEM GROUP"
"RTN","SD53589P",17,0)
 S ^TMP("SD53589P",$J,511)="GRANT & PER DIEM INDIV"
"RTN","SD53589P",18,0)
 S ^TMP("SD53589P",$J,508)="HCHV/HCMI GROUP"
"RTN","SD53589P",19,0)
 S ^TMP("SD53589P",$J,529)="HCHV/HCMI INDIV"
"RTN","SD53589P",20,0)
 S ^TMP("SD53589P",$J,507)="HUD/VASH GROUP"
"RTN","SD53589P",21,0)
 S ^TMP("SD53589P",$J,522)="HUD/VASH INDIV"
"RTN","SD53589P",22,0)
 S ^TMP("SD53589P",$J,447)="IDES VIA CVT PROV SITE^YES"
"RTN","SD53589P",23,0)
 S ^TMP("SD53589P",$J,446)="IDES VIA CVT PT SITE^YES"
"RTN","SD53589P",24,0)
 S ^TMP("SD53589P",$J,547)="INTNSE SUB USE DSRDER GRP"
"RTN","SD53589P",25,0)
 S ^TMP("SD53589P",$J,548)="INTNSE SUB USE DSRDER IND"
"RTN","SD53589P",26,0)
 S ^TMP("SD53589P",$J,502)="MENTAL HEALTH CLINIC - IND"
"RTN","SD53589P",27,0)
 S ^TMP("SD53589P",$J,550)="MENTAL HEALTH CLINIC-GROUP"
"RTN","SD53589P",28,0)
 S ^TMP("SD53589P",$J,568)="MH CWT/SE FACE TO FACE"
"RTN","SD53589P",29,0)
 S ^TMP("SD53589P",$J,574)="MH CWT/TWE FACE TO FACE"
"RTN","SD53589P",30,0)
 S ^TMP("SD53589P",$J,573)="MH INCENTIVE THERAPY F TO F"
"RTN","SD53589P",31,0)
 S ^TMP("SD53589P",$J,503)="MH RESIDENTIAL CARE IND"
"RTN","SD53589P",32,0)
 S ^TMP("SD53589P",$J,535)="MH VOCATIONAL ASSISTANCE - IND"
"RTN","SD53589P",33,0)
 S ^TMP("SD53589P",$J,575)="MH VOCATIONAL ASSISTANCE-GRP"
"RTN","SD53589P",34,0)
 S ^TMP("SD53589P",$J,567)="MHICM - GROUP"
"RTN","SD53589P",35,0)
 S ^TMP("SD53589P",$J,552)="MHICM - INDIVIDUAL"
"RTN","SD53589P",36,0)
 S ^TMP("SD53589P",$J,373)="MOVE! PGM GROUP^YES"
"RTN","SD53589P",37,0)
 S ^TMP("SD53589P",$J,372)="MOVE! PGM INDIV^YES"
"RTN","SD53589P",38,0)
 S ^TMP("SD53589P",$J,523)="OPIOID SUBSTITUTION"
"RTN","SD53589P",39,0)
 S ^TMP("SD53589P",$J,561)="PCT-POST TRAUMATIC STRESS-GRP"
"RTN","SD53589P",40,0)
 S ^TMP("SD53589P",$J,583)="PRRC GROUP"
"RTN","SD53589P",41,0)
 S ^TMP("SD53589P",$J,582)="PRRC INDIVIDUAL"
"RTN","SD53589P",42,0)
 S ^TMP("SD53589P",$J,557)="PSYCHIATRY - GROUP"
"RTN","SD53589P",43,0)
 S ^TMP("SD53589P",$J,509)="PSYCHIATRY - INDIVIDUAL"
"RTN","SD53589P",44,0)
 S ^TMP("SD53589P",$J,577)="PSYCHOGERIATRIC - GROUP"
"RTN","SD53589P",45,0)
 S ^TMP("SD53589P",$J,576)="PSYCHOGERIATRIC - INDIVIDUAL"
"RTN","SD53589P",46,0)
 S ^TMP("SD53589P",$J,558)="PSYCHOLOGY-GROUP"
"RTN","SD53589P",47,0)
 S ^TMP("SD53589P",$J,510)="PSYCHOLOGY-INDIVIDUAL"
"RTN","SD53589P",48,0)
 S ^TMP("SD53589P",$J,516)="PTSD - GROUP"
"RTN","SD53589P",49,0)
 S ^TMP("SD53589P",$J,562)="PTSD - INDIVIDUAL"
"RTN","SD53589P",50,0)
 S ^TMP("SD53589P",$J,540)="PTSD CLINICAL TEAM PTS IND"
"RTN","SD53589P",51,0)
 S ^TMP("SD53589P",$J,580)="PTSD DAY HOSPITAL"
"RTN","SD53589P",52,0)
 S ^TMP("SD53589P",$J,596)="RRTP ADMISSION SCREENING SRVCS"
"RTN","SD53589P",53,0)
 S ^TMP("SD53589P",$J,595)="RRTP AFTERCARE GRP"
"RTN","SD53589P",54,0)
 S ^TMP("SD53589P",$J,588)="RRTP AFTERCARE IND"
"RTN","SD53589P",55,0)
 S ^TMP("SD53589P",$J,598)="RRTP PRE-ADMIT IND"
"RTN","SD53589P",56,0)
 S ^TMP("SD53589P",$J,572)="SERV-MH GROUP"
"RTN","SD53589P",57,0)
 S ^TMP("SD53589P",$J,571)="SERV-MH INDIVIDUAL"
"RTN","SD53589P",58,0)
 S ^TMP("SD53589P",$J,707)="SMOKING CESSATION^YES"
"RTN","SD53589P",59,0)
 S ^TMP("SD53589P",$J,514)="SUB USE DISORDER HOME VST"
"RTN","SD53589P",60,0)
 S ^TMP("SD53589P",$J,519)="SUBST USE DISORDER/PTSD TEAMS"
"RTN","SD53589P",61,0)
 S ^TMP("SD53589P",$J,513)="SUBSTANCE USE DISORDER IND"
"RTN","SD53589P",62,0)
 S ^TMP("SD53589P",$J,560)="SUBSTANCE USE DISORDR GRP"
"RTN","SD53589P",63,0)
 S ^TMP("SD53589P",$J,708)="TELE SMOKE CESS PROV SITE^YES"
"RTN","SD53589P",64,0)
 S ^TMP("SD53589P",$J,525)="WOMEN'S STRESS DISORDER TEAMS"
"RTN","SD53589P",65,0)
 ;
"RTN","SD53589P",66,0)
 D START
"RTN","SD53589P",67,0)
 S $P(^SCTM(404.61,0),"^",3)=CC
"RTN","SD53589P",68,0)
 S $P(^SCTM(404.61,0),"^",4)=CC
"RTN","SD53589P",69,0)
 D EXIT
"RTN","SD53589P",70,0)
 Q
"RTN","SD53589P",71,0)
 ;
"RTN","SD53589P",72,0)
START ;
"RTN","SD53589P",73,0)
 ;
"RTN","SD53589P",74,0)
 S (IEN,SC,CC,REC)=""
"RTN","SD53589P",75,0)
 S SC="" F  S SC=$O(^TMP("SD53589P",$J,SC)) Q:SC=""  D
"RTN","SD53589P",76,0)
 .S IEN="" F  S IEN=$O(^DIC(40.7,"C",SC,IEN)) Q:IEN=""  D
"RTN","SD53589P",77,0)
 ..Q:$$GET1^DIQ(40.7,IEN,2)'=""
"RTN","SD53589P",78,0)
 ..S CC=CC+1 S REC=""
"RTN","SD53589P",79,0)
 ..I $P(^TMP("SD53589P",$J,SC),"^",2)="YES" D
"RTN","SD53589P",80,0)
 ...S ^SCTM(404.61,CC,0)=IEN_"^"_1 S REC=1
"RTN","SD53589P",81,0)
 ...S ^SCTM(404.61,"AC",1,CC)=""
"RTN","SD53589P",82,0)
 ..I REC="" S ^SCTM(404.61,CC,0)=IEN
"RTN","SD53589P",83,0)
 ..S ^SCTM(404.61,"B",IEN,CC)=""
"RTN","SD53589P",84,0)
 Q
"RTN","SD53589P",85,0)
 ;
"RTN","SD53589P",86,0)
EXIT ;
"RTN","SD53589P",87,0)
 K IEN,CC,SC,REC
"RTN","SD53589P",88,0)
 K ^TMP("SD53589P",$J)
"RTN","SD53589P",89,0)
 Q
"VER")
8.0^22.0
"^DD",404.61,404.61,0)
FIELD^^1^2
"^DD",404.61,404.61,0,"DDA")
N
"^DD",404.61,404.61,0,"DT")
3121102
"^DD",404.61,404.61,0,"IX","AC",404.61,1)

"^DD",404.61,404.61,0,"IX","B",404.61,.01)

"^DD",404.61,404.61,0,"NM","MH PCMM STOP CODES")

"^DD",404.61,404.61,0,"VRPK")
SD
"^DD",404.61,404.61,.01,0)
CLINIC STOP NAME^RP40.7'^DIC(40.7,^0;1^Q
"^DD",404.61,404.61,.01,1,0)
^.1
"^DD",404.61,404.61,.01,1,1,0)
404.61^B
"^DD",404.61,404.61,.01,1,1,1)
S ^SCTM(404.61,"B",$E(X,1,30),DA)=""
"^DD",404.61,404.61,.01,1,1,2)
K ^SCTM(404.61,"B",$E(X,1,30),DA)
"^DD",404.61,404.61,.01,3)
Select Clinic Stop.
"^DD",404.61,404.61,.01,21,0)
^.001^3^3^3121102^^^^
"^DD",404.61,404.61,.01,21,1,0)
This is a clinic stop used by Mental Health Service within the 
"^DD",404.61,404.61,.01,21,2,0)
PCMM. Clinic stops entered here are used to produce a Mental Health PCMM 
"^DD",404.61,404.61,.01,21,3,0)
report.
"^DD",404.61,404.61,.01,"DT")
3121102
"^DD",404.61,404.61,1,0)
EXCLUDE CODE^S^1:YES;^0;2^Q
"^DD",404.61,404.61,1,1,0)
^.1
"^DD",404.61,404.61,1,1,1,0)
404.61^AC
"^DD",404.61,404.61,1,1,1,1)
S ^SCTM(404.61,"AC",$E(X,1,30),DA)=""
"^DD",404.61,404.61,1,1,1,2)
K ^SCTM(404.61,"AC",$E(X,1,30),DA)
"^DD",404.61,404.61,1,1,1,"DT")
3121102
"^DD",404.61,404.61,1,3)
Enter Y or YES if the Clinic Stop Code is a secondary/credit stop within Mental Health.
"^DD",404.61,404.61,1,21,0)
^^5^5^3121102^
"^DD",404.61,404.61,1,21,1,0)
This field is used to exclude any Mental Health encounter with the entered
"^DD",404.61,404.61,1,21,2,0)
Clinic Stop Code as a secondary/credit stop. The Clinic Stop should have a
"^DD",404.61,404.61,1,21,3,0)
RESTRICTION TYPE(#5) of "Secondary" or "Either" in file CLINIC STOP(#40.7)
"^DD",404.61,404.61,1,21,4,0)
file. The secondary/credit stop is entered in the CREDIT STOP CODE(#2503)
"^DD",404.61,404.61,1,21,5,0)
field of the HOSPITAL LOCATION(#44) file.
"^DD",404.61,404.61,1,"DT")
3121102
"^DIC",404.61,404.61,0)
MH PCMM STOP CODES^404.61
"^DIC",404.61,404.61,0,"GL")
^SCTM(404.61,
"^DIC",404.61,404.61,"%D",0)
^1.001^7^7^3121116^^^
"^DIC",404.61,404.61,"%D",1,0)
This file contains Stop Codes used by Mental Health to produce reports 
"^DIC",404.61,404.61,"%D",2,0)
within PCMM. The following report uses this file to produce output:
"^DIC",404.61,404.61,"%D",3,0)
 
"^DIC",404.61,404.61,"%D",4,0)
        MH Encounter Report [SCMC MH PCMM ENCOUNTER RPT]
"^DIC",404.61,404.61,"%D",5,0)
 
"^DIC",404.61,404.61,"%D",6,0)
Future updates to this file will be handled through the National Patch 
"^DIC",404.61,404.61,"%D",7,0)
Release Module.
"^DIC",404.61,"B","MH PCMM STOP CODES",404.61)

"BLD",8027,6)
^493
**END**
**END**
