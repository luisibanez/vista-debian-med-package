Released SD*5.3*554 SEQ #484
Extracted from mail message
**KIDS**:SD*5.3*554^

**INSTALL NAME**
SD*5.3*554
"BLD",8628,0)
SD*5.3*554^SCHEDULING^0^3110719^y
"BLD",8628,1,0)
^^5^5^3110426^
"BLD",8628,1,1,0)
This patch addresses the following issues: A date without a year will no
"BLD",8628,1,2,0)
longer bring up a past date. A cancelled appointment will now bring up 
"BLD",8628,1,3,0)
the Electronic Wait List if the patient has other pending appointments.
"BLD",8628,1,4,0)
The INACTIVATION DATE ENTERED BY Field will no longer be filled when the
"BLD",8628,1,5,0)
user views a clinic.
"BLD",8628,4,0)
^9.64PA^^
"BLD",8628,6.3)
11
"BLD",8628,"KRN",0)
^9.67PA^779.2^20
"BLD",8628,"KRN",.4,0)
.4
"BLD",8628,"KRN",.401,0)
.401
"BLD",8628,"KRN",.402,0)
.402
"BLD",8628,"KRN",.403,0)
.403
"BLD",8628,"KRN",.5,0)
.5
"BLD",8628,"KRN",.84,0)
.84
"BLD",8628,"KRN",3.6,0)
3.6
"BLD",8628,"KRN",3.8,0)
3.8
"BLD",8628,"KRN",9.2,0)
9.2
"BLD",8628,"KRN",9.8,0)
9.8
"BLD",8628,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",8628,"KRN",9.8,"NM",1,0)
SDAMC^^0^B16744986
"BLD",8628,"KRN",9.8,"NM",2,0)
SDCNP1^^0^B33998963
"BLD",8628,"KRN",9.8,"NM",3,0)
SDWLE110^^0^B24136390
"BLD",8628,"KRN",9.8,"NM",4,0)
SDWLPE^^0^B33375093
"BLD",8628,"KRN",9.8,"NM","B","SDAMC",1)

"BLD",8628,"KRN",9.8,"NM","B","SDCNP1",2)

"BLD",8628,"KRN",9.8,"NM","B","SDWLE110",3)

"BLD",8628,"KRN",9.8,"NM","B","SDWLPE",4)

"BLD",8628,"KRN",19,0)
19
"BLD",8628,"KRN",19.1,0)
19.1
"BLD",8628,"KRN",101,0)
101
"BLD",8628,"KRN",409.61,0)
409.61
"BLD",8628,"KRN",771,0)
771
"BLD",8628,"KRN",779.2,0)
779.2
"BLD",8628,"KRN",870,0)
870
"BLD",8628,"KRN",8989.51,0)
8989.51
"BLD",8628,"KRN",8989.52,0)
8989.52
"BLD",8628,"KRN",8994,0)
8994
"BLD",8628,"KRN","B",.4,.4)

"BLD",8628,"KRN","B",.401,.401)

"BLD",8628,"KRN","B",.402,.402)

"BLD",8628,"KRN","B",.403,.403)

"BLD",8628,"KRN","B",.5,.5)

"BLD",8628,"KRN","B",.84,.84)

"BLD",8628,"KRN","B",3.6,3.6)

"BLD",8628,"KRN","B",3.8,3.8)

"BLD",8628,"KRN","B",9.2,9.2)

"BLD",8628,"KRN","B",9.8,9.8)

"BLD",8628,"KRN","B",19,19)

"BLD",8628,"KRN","B",19.1,19.1)

"BLD",8628,"KRN","B",101,101)

"BLD",8628,"KRN","B",409.61,409.61)

"BLD",8628,"KRN","B",771,771)

"BLD",8628,"KRN","B",779.2,779.2)

"BLD",8628,"KRN","B",870,870)

"BLD",8628,"KRN","B",8989.51,8989.51)

"BLD",8628,"KRN","B",8989.52,8989.52)

"BLD",8628,"KRN","B",8994,8994)

"BLD",8628,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",8628,"QUES",0)
^9.62^^
"BLD",8628,"REQB",0)
^9.611^3^3
"BLD",8628,"REQB",1,0)
SD*5.3*454^2
"BLD",8628,"REQB",2,0)
SD*5.3*491^2
"BLD",8628,"REQB",3,0)
SD*5.3*538^2
"BLD",8628,"REQB","B","SD*5.3*454",1)

"BLD",8628,"REQB","B","SD*5.3*491",2)

"BLD",8628,"REQB","B","SD*5.3*538",3)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
554^3110719
"PKG",16,22,1,"PAH",1,1,0)
^^5^5^3110719
"PKG",16,22,1,"PAH",1,1,1,0)
This patch addresses the following issues: A date without a year will no
"PKG",16,22,1,"PAH",1,1,2,0)
longer bring up a past date. A cancelled appointment will now bring up 
"PKG",16,22,1,"PAH",1,1,3,0)
the Electronic Wait List if the patient has other pending appointments.
"PKG",16,22,1,"PAH",1,1,4,0)
The INACTIVATION DATE ENTERED BY Field will no longer be filled when the
"PKG",16,22,1,"PAH",1,1,5,0)
user views a clinic.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SDAMC")
0^1^B16744986^B14033006
"RTN","SDAMC",1,0)
SDAMC ;ALB/MJK - Cancel Appt Action ; 8/31/05 3:02pm  ; 12/26/08 12:26pm  ; Compiled January 8, 2009 15:41:48
"RTN","SDAMC",2,0)
 ;;5.3;Scheduling;**20,28,32,46,263,414,444,478,538,554**;Aug 13, 1993;Build 11
"RTN","SDAMC",3,0)
 ;
"RTN","SDAMC",4,0)
EN ; -- protocol SDAM APPT CANCEL entry pt
"RTN","SDAMC",5,0)
 ; input:  VALMY := array entries
"RTN","SDAMC",6,0)
 ;
"RTN","SDAMC",7,0)
 N SDI,SDAT,VALMY,SDAMCIDT,CNT,L,SDWH,SDCP,SDREM,SDSCR,SDMSG,SCLHOLD
"RTN","SDAMC",8,0)
 K ^UTILITY($J)
"RTN","SDAMC",9,0)
 ;
"RTN","SDAMC",10,0)
 ;
"RTN","SDAMC",11,0)
 I '$D(DFN),$G(SDFN),($G(SDAMTYP)="P") S DFN=SDFN
"RTN","SDAMC",12,0)
 ;
"RTN","SDAMC",13,0)
 S VALMBCK=""
"RTN","SDAMC",14,0)
 D SEL^VALM2,CHK G ENQ:'$O(VALMY(0))
"RTN","SDAMC",15,0)
 D FULL^VALM1 S VALMBCK="R"
"RTN","SDAMC",16,0)
 S SDWH=$$WHO,SDCP=$S(SDWH="C":0,1:1) G ENQ:SDWH=-1
"RTN","SDAMC",17,0)
 S SDSCR=$$RSN(SDWH) G ENQ:SDSCR=-1
"RTN","SDAMC",18,0)
 S (TMPD,SDREM)=$$REM G ENQ:SDREM=-1 ;SD/478
"RTN","SDAMC",19,0)
 S (SDI,CNT,L)=0
"RTN","SDAMC",20,0)
 F  S SDI=$O(VALMY(SDI)) Q:'SDI  I $D(^TMP("SDAMIDX",$J,SDI)) K SDAT S SDAT=^(SDI) W !,^TMP("SDAM",$J,+SDAT,0) D CAN($P(SDAT,U,2),$P(SDAT,U,3),.CNT,.L,SDWH,SDCP,SDSCR,SDREM)
"RTN","SDAMC",21,0)
 I SDAMTYP="P" D BLD^SDAM1
"RTN","SDAMC",22,0)
 I SDAMTYP="C" D BLD^SDAM3
"RTN","SDAMC",23,0)
ENQ Q
"RTN","SDAMC",24,0)
 ;
"RTN","SDAMC",25,0)
CAN(DFN,SDT,CNT,L,SDWH,SDCP,SDSCR,SDREM) ;
"RTN","SDAMC",26,0)
 N A1,NDT S NDT=SDT
"RTN","SDAMC",27,0)
 S:'$G(L) L=0 ; If there is no data in L set L to 0 - PATCH SD*5.3*554
"RTN","SDAMC",28,0)
 S:'$G(SDAMTYP) SDAMTYP="P" ; If there is no data in SDAMTYP set SDAMTYP to 0" - PATCH SD*5.3*554
"RTN","SDAMC",29,0)
 I $P($G(^DPT(DFN,"S",NDT,0)),U,2)["C" W !!,"Appointment already cancelled" H 2 D CANQ(DFN,SDCLN,SDAMTYP) Q  ; SD*5.3*554
"RTN","SDAMC",30,0)
 I $D(^DPT(DFN,"S",NDT,0)) S SD0=^(0) I $P(SD0,"^",2)'["C" S SC=+SD0,L=L\1+1,APL="" D FLEN^SDCNP1A S ^UTILITY($J,"SDCNP",L)=NDT_"^"_SC_"^"_COV_"^"_APL_"^^"_APL_"^^^^^^"_SDSP D CHKSO^SDCNP0 ;SD/478
"RTN","SDAMC",31,0)
 ;SD*5.3*414 next line added to set hold variable SCLHOLD for clinic ptr
"RTN","SDAMC",32,0)
 S APP=1,A1=L\1 S SCLHOLD=$P(^UTILITY($J,"SDCNP",A1),U,2) D BEGD^SDCNP0
"RTN","SDAMC",33,0)
 S SDFN=DFN ; Sets SDFN - PATCH SD*5.3*554
"RTN","SDAMC",34,0)
 D MES,NOPE W ! S (CNT,L)=0 K ^UTILITY($J,"SDCNP")
"RTN","SDAMC",35,0)
 Q
"RTN","SDAMC",36,0)
CANQ(SDFN,SDCLN,SDAMTYP) ; SD*5.3*554 - Passes in SDFN, SDCLN, and SDAMTYP
"RTN","SDAMC",37,0)
 ;Wait List Message
"RTN","SDAMC",38,0)
 ;
"RTN","SDAMC",39,0)
 Q:(SDFN=""!SDCLN="")  ; Checks to make sure that SDFN and SDCLN are set to a non null value - PATCH SD*5.3*554
"RTN","SDAMC",40,0)
 I $G(SCLHOLD)'="" S:'$D(SDCLN) SDCLN=SCLHOLD  ; SD*5.3*414
"RTN","SDAMC",41,0)
 N SDOMES S SDOMES="" I $G(SDCLN)'="",$D(^SDWL(409.3,"SC",SDCLN)) D
"RTN","SDAMC",42,0)
 .N SDWL S SDWL="" F  S SDWL=$O(^SDWL(409.3,"SC",SDCLN,SDWL)) Q:SDWL=""  D  Q:SDOMES
"RTN","SDAMC",43,0)
 ..I $P(^SDWL(409.3,SDWL,0),U,17)="O" I $P(^SDWL(409.3,SDWL,0),U)=$G(SDFN) D  S SDOMES=1
"RTN","SDAMC",44,0)
 ...W !,?1,"There are Wait List entries waiting for an Appointment for this patient in ",!?1,$P(^SC(SDCLN,0),U,1)," Clinic.",!
"RTN","SDAMC",45,0)
 S DIR(0)="E" D ^DIR W !
"RTN","SDAMC",46,0)
 K:$G(SDAMTYP)="P" SDCLN ; - PATCH SD*5.3*554
"RTN","SDAMC",47,0)
 K SCLHOLD,SC,COV,APP
"RTN","SDAMC",48,0)
 Q
"RTN","SDAMC",49,0)
MES ; -- set error message
"RTN","SDAMC",50,0)
 S SDMSG="W !,""Enter appt. numbers separated by commas and/or a range separated"",!,""by dashes (ie 2,4,6-9)"" H 2"
"RTN","SDAMC",51,0)
 Q
"RTN","SDAMC",52,0)
 ;
"RTN","SDAMC",53,0)
WHO() ;
"RTN","SDAMC",54,0)
 W ! S DIR(0)="SOA^PC:PATIENT;C:CLINIC",DIR("A")="Appointments cancelled by (P)atient or (C)linic: ",DIR("B")="Patient"
"RTN","SDAMC",55,0)
 D ^DIR K DIR
"RTN","SDAMC",56,0)
 Q $S(Y=""!(Y="^"):-1,1:Y)
"RTN","SDAMC",57,0)
 ;
"RTN","SDAMC",58,0)
RSN(SDWH) ;
"RTN","SDAMC",59,0)
RSN1 W ! S DIC="^SD(409.2,",DIC(0)="AEMQ",DIC("S")="I '$P(^(0),U,4),"""_$E(SDWH)_"B""[$P(^(0),U,2)" D ^DIC K DIC
"RTN","SDAMC",60,0)
 I X["^" G RSNQ
"RTN","SDAMC",61,0)
 I Y<0 W *7 G RSN1
"RTN","SDAMC",62,0)
RSNQ Q +Y
"RTN","SDAMC",63,0)
 ;
"RTN","SDAMC",64,0)
REM() ;
"RTN","SDAMC",65,0)
 W ! S DIR(0)="2.98,17" D ^DIR K DIR
"RTN","SDAMC",66,0)
 I $E(X)="^" S Y=-1
"RTN","SDAMC",67,0)
 Q Y
"RTN","SDAMC",68,0)
 ;
"RTN","SDAMC",69,0)
NOPE ;
"RTN","SDAMC",70,0)
 N SDEND,SDPAUSE
"RTN","SDAMC",71,0)
 S:'CNT SDPAUSE=1
"RTN","SDAMC",72,0)
 D NOPE^SDCNP1
"RTN","SDAMC",73,0)
 D:$G(SDPAUSE) PAUSE^VALM1
"RTN","SDAMC",74,0)
 Q
"RTN","SDAMC",75,0)
 ;
"RTN","SDAMC",76,0)
CHK ; -- check if status of appt permits cancelling
"RTN","SDAMC",77,0)
 N SDI S SDI=0
"RTN","SDAMC",78,0)
 F  S SDI=$O(VALMY(SDI)) Q:'SDI  I $D(^TMP("SDAMIDX",$J,SDI)) K SDAT S SDAT=^(SDI) I '$D(^SD(409.63,"ACAN",1,+$$STATUS^SDAM1($P(SDAT,U,2),$P(SDAT,U,3),+$G(^DPT(+$P(SDAT,U,2),"S",+$P(SDAT,U,3),0)),$G(^(0))))) D
"RTN","SDAMC",79,0)
 .W !,^TMP("SDAM",$J,+SDAT,0),!!,*7,"You cannot cancel this appointment."
"RTN","SDAMC",80,0)
 .K VALMY(SDI) D PAUSE^VALM1
"RTN","SDAMC",81,0)
 Q
"RTN","SDCNP1")
0^2^B33998963^B31981215
"RTN","SDCNP1",1,0)
SDCNP1 ;ALB/LDB - CANCEL APPOINTMENT (cont.) ; 14 MAR 88@13:00
"RTN","SDCNP1",2,0)
 ;;5.3;Scheduling;**398,467,478,554**;Aug 13, 1993;Build 11
"RTN","SDCNP1",3,0)
 ;
"RTN","SDCNP1",4,0)
 ;SD/467 - EWL Open Matched Entry with rebook
"RTN","SDCNP1",5,0)
NOPE W !,*7,$S(CNT:CNT_" Appointment"_$S(CNT>1:"s",1:"")_" cancelled",1:"NOTHING CANCELLED")
"RTN","SDCNP1",6,0)
 S SDCNT=CNT,SDA=1,SDCNT1=0 I CNT,$S('$D(^DPT(DFN,.35)):1,'$P(^(.35),U):1,1:0) S (SDA,X8)=0 D ASK G:X8="^" END
"RTN","SDCNP1",7,0)
 ;no rebooking to take place; open EWL entries only if applicable
"RTN","SDCNP1",8,0)
 I $D(DFN)>0 D EWL(DFN) ;SD/467
"RTN","SDCNP1",9,0)
 I SDA,SDCNT W !,*7,"NO AUTO-REBOOKING --Patient has died."
"RTN","SDCNP1",10,0)
 I 'SDA,SDCNT S A=DFN D LOOP1^SDCNP1A,LET
"RTN","SDCNP1",11,0)
END K:'$D(DIROUT) DFN D END^SDCNP Q:$D(DIROUT)  G RD^SDCNP
"RTN","SDCNP1",12,0)
ASK S (SDCTR,SDCTRL)=0,%=2 W !!,"DO YOU WISH TO REBOOK ANY APPOINTMENT(S) THAT YOU HAVE CANCELLED" D YN^DICN S ALS=% D:'% REASK G:'% ASK I %-1 S CNT=0 S:%<0 X8="^" D  Q
"RTN","SDCNP1",13,0)
 .W !,"OK"
"RTN","SDCNP1",14,0)
 W !!,"PLEASE NOTE THAT YOU MUST ENTER A DEVICE TO AUTO-REBOOK",!
"RTN","SDCNP1",15,0)
ZIS S %ZIS("A")="DEVICE TO OUTPUT REBOOKED APPT(S). :",%ZIS="QN" D ^%ZIS I POP S X8="^" Q
"RTN","SDCNP1",16,0)
 S L=0 F  S L=$O(^UTILITY($J,"SDCNP",L)) Q:'L  I $P(^(L),U,4)="*** JUST CANCELLED ***" S ^UTILITY($J,"SDCNP1",DFN,$P(^(L),"^",2),$P(^(L),"^"))=^(L)
"RTN","SDCNP1",17,0)
 D SDLST
"RTN","SDCNP1",18,0)
LST S B=0 F  S B=$O(^UTILITY($J,"SDCNP2",DFN,B)) Q:'B  W !!,$J($S(B\1=B:"("_$J(B,2)_") ",1:""),5) S AT=$S($P(^(B),"^",2)'?.N:1,1:0),Y=$P($P(^(B),"^"),".") D DT^SDM0 S X=$P(^(B),"^") X ^DD("FUNC",2,1) W " ",$J(X,8) S Z1(B)="" D MORE Q:SDCTRL
"RTN","SDCNP1",19,0)
 D WH
"RTN","SDCNP1",20,0)
 I B>0 G:SDCTRL&(A8']"") NOPE1 G:SDCTRL DEL
"RTN","SDCNP1",21,0)
 Q
"RTN","SDCNP1",22,0)
SDLST S L1=0 S Z5=0 F  S Z5=$O(^UTILITY($J,"SDCNP1",DFN,Z5)) Q:'Z5  F Z6=0:0 S Z7=Z6,Z6=$O(^UTILITY($J,"SDCNP1",DFN,Z5,Z6)) I Z6="" S L1=L1+1,^UTILITY($J,"SDCNP2",DFN,L1)=Z7_"^"_Z5_"^"_$P(^(Z7),"^",3,6) Q
"RTN","SDCNP1",23,0)
 Q
"RTN","SDCNP1",24,0)
MORE S SDCTR=SDCTR+2 I AT W ?41,$P(^UTILITY($J,"SDCNP2",B),"^",2) G OVR
"RTN","SDCNP1",25,0)
 S S5=^UTILITY($J,"SDCNP2",DFN,B) W " (",$P(S5,"^",6)," MINUTES)  ",$S($D(^SC($P(S5,"^",2),0)):$P(^(0),"^",1),1:"DELETED CLINIC"),$P(S5,"^",3) S M1=$P(^SC($P(S5,"^",2),"SDP"),"^",4) W !,?41,"Max days for rebooking= ",M1
"RTN","SDCNP1",26,0)
OVR I SDCTR>20,$O(^UTILITY($J,"SDCNP2",B))>0 S (SDCTRL,SDCTR)=0 W *7 D WH W:'SDCTRL @IOF
"RTN","SDCNP1",27,0)
 Q
"RTN","SDCNP1",28,0)
WH W !!,"SELECT APPOINTMENT(S) TO BE REBOOKED" W:B>0 " OR HIT RETURN TO CONTINUE DISPLAY" R ": ",A8:DTIME I '$T!(A8="^") S SDCTRL=1,A8="",X8="^" Q
"RTN","SDCNP1",29,0)
 I A8["?" X SDMSG G WH
"RTN","SDCNP1",30,0)
DEL S SDERR=0 F J=1:1 S SDDH=$P(A8,",",J) Q:SDDH']""  D MTCH
"RTN","SDCNP1",31,0)
 I SDERR G LST
"RTN","SDCNP1",32,0)
DEL1 S SDERR=0 F J=1:1 S SDDH=$P(A8,",",J) Q:SDDH']""  S SDDI=$P(SDDH,"-"),SDDM=$P(SDDH,"-",2) D CKK^SDCNP1A Q:SDERR  D CKK2^SDCNP1A Q:SDERR  F Z9=SDDI:1:$S(SDDM:SDDM,1:SDDI) D:SDDI REBK I 'SDDI S SDERR=1 Q
"RTN","SDCNP1",33,0)
 G:SDERR LST Q:A8["^"!(A8="")  S SDERR=0 D ^SDCNP1A Q:X8="^"
"RTN","SDCNP1",34,0)
 D:MAX QUE
"RTN","SDCNP1",35,0)
 D NOPE1
"RTN","SDCNP1",36,0)
 Q 
"RTN","SDCNP1",37,0)
LET ;
"RTN","SDCNP1",38,0)
 S %=2 W !!,"DO YOU WISH TO PRINT LETTERS FOR THE CANCELLED APPOINTMENT(S)" D YN^DICN D CANQ^SDAMC(DFN,SC) S ANS="Y" D:'% REASK G:'% LET Q:(%-1)  ; Calls subroutine CANQ to display wait list message if applicable. - PATCH SD*5.3*554
"RTN","SDCNP1",39,0)
 I $$BADADR^DGUTL3(+DFN) D  Q  ;display, don't print BAI list
"RTN","SDCNP1",40,0)
 . W *7,!,"** THIS PATIENT HAS BEEN FLAGGED WITH A BAD ADDRESS INDICATOR, NO LETTER"
"RTN","SDCNP1",41,0)
 . W !,"WILL BE PRINTED."
"RTN","SDCNP1",42,0)
 . S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDCNP1",43,0)
QUE2 ;S DGPGM="SDLET^SDCNP1A",DGVAR="SDCL#^DUZ^DFN^DT^A^SDWH" D ZIS^DGUTQ D:POP CLOSE^DGUTQ Q:POP  D SDLET^SDCNP1A Q
"RTN","SDCNP1",44,0)
 S %ZIS="MQ" K IO("Q") D ^%ZIS Q:POP  ;SD/478
"RTN","SDCNP1",45,0)
 I $D(IO("Q")) D  D:IO'=IO(0) NOTELTR D ^%ZISC W @IOF Q  ;SD/478
"RTN","SDCNP1",46,0)
 .S ZTRTN="SDLET^SDCNP1A" F ZTS="SDCL(","DUZ","DFN","DT","A","SDWH","AUTO(" S ZTSAVE(ZTS)=""  ;SD/478
"RTN","SDCNP1",47,0)
 .K ZTS D ^%ZTLOAD  ;SD/478
"RTN","SDCNP1",48,0)
 D:IO'=IO(0) NOTELTR D SDLET^SDCNP1A,^%ZISC W @IOF  ;SD/478
"RTN","SDCNP1",49,0)
 Q  ;SD/478
"RTN","SDCNP1",50,0)
NOTELTR I ANS["Y",ALS=1 S:$D(CNDIE) @(CNDIE_CNDA_",1,CNINDX,0)")="CANCEL APPOINTMENT AUTO REBOOK letter printed." K CNDIE,CNDA,CNINDX ;SD/478 CANCEL APPT AUTO REBOOK LETTER PRINTED.
"RTN","SDCNP1",51,0)
 I ANS["Y" S:$D(CNDIE) @(CNDIE_CNDA_",1,CNINDX,0)")="CANCEL APPOINTMENT letter printed." K CNDIE,CNDA,CNINDX ;SD/478 CANCEL APPT LETTER IS PRINTED.
"RTN","SDCNP1",52,0)
 Q
"RTN","SDCNP1",53,0)
QUE I IO'=IO(0) S DGPGM="^SDCNP2",DGVAR="SDCL#^NDATE^A^GDATE^DT^DUZ",IOP=IO,X="NOW" D Q1^DGUTQ Q
"RTN","SDCNP1",54,0)
 U IO I IO=IO(0),$E(IOST,1,2)="C-" S SDIO=1 D ^SDCNP2 Q
"RTN","SDCNP1",55,0)
NOPE1 W @IOF,!,*7,$S(SDCNT1:SDCNT1_" Appointment"_$S(SDCNT1>1:"s",1:"")_" rebooked",1:"NOTHING REBOOKED") Q
"RTN","SDCNP1",56,0)
REBK K ^UTILITY($J,"SDCNP") S ^UTILITY($J,"SDCNP2","REBK",DFN,Z9)=^UTILITY($J,"SDCNP2",DFN,Z9)
"RTN","SDCNP1",57,0)
 Q
"RTN","SDCNP1",58,0)
 F A9=SDDI,SDDM Q:'SDDM&(SDDI-A9)  I '$D(Z1(A9)) S SDERR=1 W !,*7,"There is no appointment number ",A9
"RTN","SDCNP1",59,0)
 Q
"RTN","SDCNP1",60,0)
REASK W !,"ANSWER (Y)ES OR (N)O" Q
"RTN","SDCNP1",61,0)
CLRK S $P(^DPT(DFN,"S",S,0),"^",19)=$P(SDNODE,"^",7),$P(^DPT(DFN,"S",S,0),"^",18)=$P(SDNODE,"^",6) Q
"RTN","SDCNP1",62,0)
MTCH Q:SDDH?1N.N!(SDDH?1.N1"-".N)  S SDERR=1 X SDMSG
"RTN","SDCNP1",63,0)
 Q
"RTN","SDCNP1",64,0)
EWL(DFN) ;
"RTN","SDCNP1",65,0)
 I '$D(^UTILITY($J,"SDCNP1")) I '$D(^UTILITY($J,"SDCNP")) Q
"RTN","SDCNP1",66,0)
 ;call to EWL to open and optionally close EWL entry with rebooked appointment
"RTN","SDCNP1",67,0)
 N SDFRB,SDT,SC,SDREB K ^TMP("SDWLREB",$J),^TMP($J,"SDWPL"),^TMP($J,"APPT")
"RTN","SDCNP1",68,0)
 I $D(^UTILITY($J,"SDCNP1")) S SDFRB="^UTILITY($J,""SDCNP1"")"  D REB I $D(^TMP("SDWLREB",$J)) D MESS^SDWLREB Q
"RTN","SDCNP1",69,0)
 E  S SDFRB="^UTILITY($J,""SDCNP"")" D CAN I $D(^TMP("SDWLREB",$J)) D MESS^SDWLREB
"RTN","SDCNP1",70,0)
 Q
"RTN","SDCNP1",71,0)
REB I $D(^UTILITY($J,"SDCNP1")) F  S SDFRB=$Q(@SDFRB) Q:SDFRB'["SDCNP1"  S SDT=$P(@SDFRB,U),SC=$P(@SDFRB,U,2),SDREB=0 D
"RTN","SDCNP1",72,0)
 .;N NN F NN=1:1 Q:'$D(^UTILITY($J,"SDCNP","REBK",DFN,NN))  I $P($G(^UTILITY($J,"SDCNP2","REBK",DFN,NN)),U)=SDT S SDREB=1 Q
"RTN","SDCNP1",73,0)
 .N RBFLG,SDTRB D REBOOK^SDWLREB(DFN,SDT,SC,.RBFLG,.SDTRB)
"RTN","SDCNP1",74,0)
 .I $E(RBFLG,1,2)'="CC" Q  ;not canceled by clinic
"RTN","SDCNP1",75,0)
 .I RBFLG="CCR" S SDREB=1 D DISREB^SDWLREB(DFN,SDTRB,SC)
"RTN","SDCNP1",76,0)
 .D OPENEWL^SDWLREB(DFN,SDT,SC,SDREB) K ^TMP($J,"APPT"),^TMP($J,"SDWLPL")
"RTN","SDCNP1",77,0)
 Q
"RTN","SDCNP1",78,0)
CAN I $D(^UTILITY($J,"SDCNP")) F  S SDFRB=$Q(@SDFRB) Q:SDFRB'["SDCNP"  I @SDFRB["CANCELLED" S SDT=$P(@SDFRB,U),SC=$P(@SDFRB,U,2),SDREB=0 D
"RTN","SDCNP1",79,0)
 .N RBFLG,SDTRB D REBOOK^SDWLREB(DFN,SDT,SC,.RBFLG,.SDTRB)
"RTN","SDCNP1",80,0)
 .I $E(RBFLG,1,2)'="CC" Q  ;not canceled by clinic
"RTN","SDCNP1",81,0)
 .I RBFLG="CCR" S SDREB=1 D DISREB^SDWLREB(DFN,SDTRB,SC)
"RTN","SDCNP1",82,0)
 .D OPENEWL^SDWLREB(DFN,SDT,SC,SDREB) K ^TMP($J,"APPT"),^TMP($J,"SDWLPL")
"RTN","SDCNP1",83,0)
 Q
"RTN","SDWLE110")
0^3^B24136390^B23512324
"RTN","SDWLE110",1,0)
SDWLE110 ;;IOFO BAY PINES/TEH - WAITING LIST-ENTER/EDIT;06/12/2002 ; 29 Aug 2002  2:54 PM
"RTN","SDWLE110",2,0)
 ;;5.3;scheduling;**263,273,424,454,554**;AUG 13 1993;Build 11
"RTN","SDWLE110",3,0)
 ;
"RTN","SDWLE110",4,0)
 ;
"RTN","SDWLE110",5,0)
 ;******************************************************************
"RTN","SDWLE110",6,0)
 ;                             CHANGE LOG
"RTN","SDWLE110",7,0)
 ;                                               
"RTN","SDWLE110",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLE110",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLE110",10,0)
 ;   11/27/02                  SD*5.3*273            Add "/", line SA1+11,+13,FA2+13
"RTN","SDWLE110",11,0)
 ;   
"RTN","SDWLE110",12,0)
 ;   
"RTN","SDWLE110",13,0)
EN K DIR
"RTN","SDWLE110",14,0)
 I $D(^SDWL(409.3,SDWLDA,0)) S DIR("B")=$$EXTERNAL^DILFD(409.3,10,,$P(^(0),U,11))
"RTN","SDWLE110",15,0)
 I DIR("B")="" K DIR("B")
"RTN","SDWLE110",16,0)
 S DIR(0)="SO^1:Future Date;2:ASAP"
"RTN","SDWLE110",17,0)
 S DIR("L",1)="Priority",DIR("L",2)=""
"RTN","SDWLE110",18,0)
 S DIR("L",3)="1. Future Date",DIR("L")="2. ASAP"
"RTN","SDWLE110",19,0)
 D ^DIR I X["^" S DUOUT=1 Q  ;-'^' here will remove patient from wait list
"RTN","SDWLE110",20,0)
 I X="@" W *7," ??" G EN
"RTN","SDWLE110",21,0)
 I X="" W *7,"Required or '^' to quit." G EN
"RTN","SDWLE110",22,0)
 I $D(DTOUT) S DUOUT=1 Q
"RTN","SDWLE110",23,0)
 S X=$E(X,1)
"RTN","SDWLE110",24,0)
 S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCEDFGHIJKLMNOPQRSTUVWXYZ")
"RTN","SDWLE110",25,0)
 S SDWLPRIE=$S(X["A":"A",X["F":"F",X[1:"F",X[2:"A",1:"F")
"RTN","SDWLE110",26,0)
 S DIE="^SDWL(409.3,",DA=SDWLDA,DR="10////^S X=SDWLPRIE" D ^DIE
"RTN","SDWLE110",27,0)
 ;
"RTN","SDWLE110",28,0)
 ;If priority is ASAP ask requesting provider
"RTN","SDWLE110",29,0)
 ;
"RTN","SDWLE110",30,0)
 I SDWLPRIE="A" S Y=DT D DD^%DT W " ",Y D SA,DUP G END:$D(DUOUT) Q
"RTN","SDWLE110",31,0)
 I SDWLPRIE="F" D FA G END:$D(DUOUT) Q  ;to enter future date
"RTN","SDWLE110",32,0)
 Q
"RTN","SDWLE110",33,0)
 ;
"RTN","SDWLE110",34,0)
SA K DIR,DR,DIE S SDWLERR=0,SDWLX=$S($D(SDWLPROV):$$EXTERNAL^DILFD(409.3,12,,SDWLPROV),1:"")
"RTN","SDWLE110",35,0)
 I $D(SDWLPROV),SDWLPROV,SDWLX'="" S DIR("B")=SDWLX
"RTN","SDWLE110",36,0)
 I $D(^SDWL(409.3,SDWLDA,0)) S DIR("B")=$$EXTERNAL^DILFD(409.3,11,,$P(^(0),U,12))
"RTN","SDWLE110",37,0)
 I DIR("B")="" K DIR("B")
"RTN","SDWLE110",38,0)
 K %DT,DR S DIR(0)="SO^1:Provider;2:Patient"
"RTN","SDWLE110",39,0)
 S DIR("L",1)="Request By",DIR("L",2)=""
"RTN","SDWLE110",40,0)
 S DIR("L",3)="1. Provider",DIR("L")="2. Patient"
"RTN","SDWLE110",41,0)
 D ^DIR I X["^" S DUOUT=1,DIR("A")="ASAP" Q
"RTN","SDWLE110",42,0)
 S X=Y
"RTN","SDWLE110",43,0)
 I $D(DTOUT) S DUOUT=1,DIR("A")="ASAP" Q
"RTN","SDWLE110",44,0)
 S SDWLRBE=$S(X=1:1,X["PR":1,X["pr":1,X["Pr":1,X=2:2,X["PA":2,X["pa":2,X["Pa":2,1:0) I 'SDWLRBE W *7," ??" G SA
"RTN","SDWLE110",45,0)
 S DR="11////^S X=SDWLRBE",DA=SDWLDA,DIE="^SDWL(409.3," D ^DIE
"RTN","SDWLE110",46,0)
 ;
"RTN","SDWLE110",47,0)
SA1 I SDWLRBE=1 D
"RTN","SDWLE110",48,0)
 .S DIC("S")="I $$SCREEN^SDUTL2(Y,DT)"
"RTN","SDWLE110",49,0)
 .S SDWLX=$S($D(SDWLPROV):$$EXTERNAL^DILFD(409.3,12,,SDWLPROV),1:"") I SDWLX'="" S DIC("B")=SDWLPROV
"RTN","SDWLE110",50,0)
 .I $D(^SDWL(409.3,SDWLDA,0)) S DIR("B")=$$EXTERNAL^DILFD(409.3,11,,$P(^(0),U,12))
"RTN","SDWLE110",51,0)
 .S SDWLERR=0,DIC(0)="AEQ",DIC=200,DIC("A")="Provider Requesting Appointment: " D ^DIC
"RTN","SDWLE110",52,0)
 .I X["^" S DUOUT=1 Q
"RTN","SDWLE110",53,0)
 .I Y<1 S SDWLERR=1 Q
"RTN","SDWLE110",54,0)
 .I $D(DUOUT) Q
"RTN","SDWLE110",55,0)
 .I $D(DTOUT) S DUOUT=1 Q
"RTN","SDWLE110",56,0)
 .K DIC,DIC("S"),DIC("A"),DIC(0),DIC("B")
"RTN","SDWLE110",57,0)
 .S SDWLPROV=+Y,SDWLPRON=$P(Y,U,2),DIE="^SDWL(409.3,",DA=SDWLDA
"RTN","SDWLE110",58,0)
 .S DR="12////^S X=SDWLPROV" D ^DIE S SDWLPRVE=SDWLPROV
"RTN","SDWLE110",59,0)
 I SDWLERR W *7," Required" G SA1
"RTN","SDWLE110",60,0)
 S DR="11////^S X=SDWLRBE" D ^DIE
"RTN","SDWLE110",61,0)
 S DR="22///TODAY" D ^DIE K DIE,DR,DIC,DIR,SDWLPRVE,SDWLPROV,SDWLPRON
"RTN","SDWLE110",62,0)
 Q
"RTN","SDWLE110",63,0)
 ;
"RTN","SDWLE110",64,0)
 ;If Priority is 'FUTURE' ask Desired Date of Appointment and Requesting by Provider or Patient
"RTN","SDWLE110",65,0)
 ;
"RTN","SDWLE110",66,0)
FA S SDWLERR=0 K DIR,DUOUT,DR,DIE I $D(SDWLDAPE) S Y=SDWLDAPE D DD^%DT S DIR("B")=Y
"RTN","SDWLE110",67,0)
 I $D(^SDWL(409.3,SDWLDA,0)),$P(^(0),U,16) S %DT("B")=$$EXTERNAL^DILFD(409.3,22,,$P(^(0),U,16))  ;SD*5.3*424
"RTN","SDWLE110",68,0)
 S %DT="AEF",%DT("A")="Desired Date of Appointment: " D ^%DT ; Added "F" to set to a future date - PATCH SD*5.3*554
"RTN","SDWLE110",69,0)
 I $D(DTOUT)!(X="^") G EN
"RTN","SDWLE110",70,0)
 I X="" W *7,!!,"This is a required response. Enter '^' to exit.",! G EN  ;SD*5.3*454
"RTN","SDWLE110",71,0)
 S SDWLDAPE=Y,DR="22////^S X=SDWLDAPE",DIE="^SDWL(409.3,",DA=SDWLDA D ^DIE
"RTN","SDWLE110",72,0)
 K SDWLDAPE,Y,DA,DIE,%DT,%DT(0),%DT("A"),%DT("B")
"RTN","SDWLE110",73,0)
 ;
"RTN","SDWLE110",74,0)
FA1 K DIR,%DT,DR S DIR(0)="SO^1:Provider;2:Patient"
"RTN","SDWLE110",75,0)
 S SDWLX=$S($D(SDWLPROV):$$EXTERNAL^DILFD(409.3,12,,SDWLPROV),1:"") I SDWLX'="" S DIR("B")=SDWLPROV
"RTN","SDWLE110",76,0)
 I $D(^SDWL(409.3,SDWLDA,0)) S DIR("B")=$$EXTERNAL^DILFD(409.3,11,,$P(^(0),U,12))
"RTN","SDWLE110",77,0)
 I DIR("B")="" K DIR("B")
"RTN","SDWLE110",78,0)
 S DIR("L",1)="Request By",DIR("L",2)=""
"RTN","SDWLE110",79,0)
 S DIR("L",3)="1. Provider",DIR("L")="2. Patient"
"RTN","SDWLE110",80,0)
 D ^DIR I X["^" S DIR("B")=$S($D(SDWLDAPE):SDWLDAPE,1:"") G FA
"RTN","SDWLE110",81,0)
 S X=Y
"RTN","SDWLE110",82,0)
 I $D(DTOUT) S DUOUT=1 S DIR("B")=SDWLDAPE G FA
"RTN","SDWLE110",83,0)
 S SDWLRBE=$S(X=1:1,X["PR":1,X["pr":1,X["Pr":1,X=2:2,X["PA":2,X["pa":2,X["Pa":2,1:0) I 'SDWLRBE W *7," ??" G FA1
"RTN","SDWLE110",84,0)
 S DR="11////^S X=SDWLRBE",DA=SDWLDA,DIE="^SDWL(409.3," D ^DIE
"RTN","SDWLE110",85,0)
 ;
"RTN","SDWLE110",86,0)
FA2 I SDWLRBE=1 D
"RTN","SDWLE110",87,0)
 .;
"RTN","SDWLE110",88,0)
 .;if provider is selected look-up valid provider from new person (File 200)
"RTN","SDWLE110",89,0)
 .;
"RTN","SDWLE110",90,0)
 .S DIC("S")="I $$SCREEN^SDUTL2(Y,DT)"
"RTN","SDWLE110",91,0)
 .S SDWLX=$S($D(SDWLPROV):$$EXTERNAL^DILFD(409.3,12,,SDWLPROV),1:""),DIC("B")=$S($D(SDWLPROV):SDWLX,1:"")
"RTN","SDWLE110",92,0)
 .S SDWLERR=0,DIC(0)="AEQ",DIC=200,DIC("A")="Provider Requesting Appointment: " D ^DIC
"RTN","SDWLE110",93,0)
 .I X["^" S DUOUT=1 Q
"RTN","SDWLE110",94,0)
 .I Y<1 S SDWLERR=1 Q
"RTN","SDWLE110",95,0)
 .I $D(DTOUT) S DUOUT=1 Q
"RTN","SDWLE110",96,0)
 .Q:$D(DUOUT)  D
"RTN","SDWLE110",97,0)
 ..K DIC,DIC("S"),DIC("A"),DIC(0),DIC("B")
"RTN","SDWLE110",98,0)
 ..S SDWLPROV=+Y,SDWLPRON=$P(Y,U,2),DIE="^SDWL(409.3,",DA=SDWLDA
"RTN","SDWLE110",99,0)
 ..S DR="12////^S X=SDWLPROV" D ^DIE S SDWLPRVE=SDWLPROV K DIE
"RTN","SDWLE110",100,0)
 I SDWLERR W *7," Required" G FA2
"RTN","SDWLE110",101,0)
END K DIC,DIE,DIR I $D(DUOUT) S DIR("B")=$S(SDWLPRIE="F":"Future",1:"ASAP")
"RTN","SDWLE110",102,0)
 K SDWLPRVE,SDWLPROV,SDWLPRON
"RTN","SDWLE110",103,0)
 Q
"RTN","SDWLE110",104,0)
 ;
"RTN","SDWLE110",105,0)
DUP ;
"RTN","SDWLE110",106,0)
 Q
"RTN","SDWLPE")
0^4^B33375093^B27362076
"RTN","SDWLPE",1,0)
SDWLPE ;IOFO BAY PINES/TEH - WAIT LIST - PARAMETER WAIT LIST ENTER/EDIT ; 5/24/11 11:27am
"RTN","SDWLPE",2,0)
 ;;5.3;scheduling;**263,280,288,397,491,554**;AUG 13 1993;Build 11
"RTN","SDWLPE",3,0)
 ;
"RTN","SDWLPE",4,0)
 ;SD/491 - identify clinic institution through DIVISION ---> INSTITUTION path
"RTN","SDWLPE",5,0)
EN ;
"RTN","SDWLPE",6,0)
 ;OPTION HEADER
"RTN","SDWLPE",7,0)
 ;
"RTN","SDWLPE",8,0)
 D HD
"RTN","SDWLPE",9,0)
 ;
"RTN","SDWLPE",10,0)
 ;SELECT FILE TO EDIT
"RTN","SDWLPE",11,0)
 ;
"RTN","SDWLPE",12,0)
EN1 D SEL G END:X["^",END:X=""
"RTN","SDWLPE",13,0)
 ;
"RTN","SDWLPE",14,0)
 ;EDIT PARAMETER FILE
"RTN","SDWLPE",15,0)
 ;
"RTN","SDWLPE",16,0)
 D EDIT G EN:'$D(Y)
"RTN","SDWLPE",17,0)
 G END
"RTN","SDWLPE",18,0)
 Q
"RTN","SDWLPE",19,0)
 ;
"RTN","SDWLPE",20,0)
SEL ;SELECT PARAMETER FILE
"RTN","SDWLPE",21,0)
 S DIR(0)="SO^1:Wait List Service/Specialty File;2:Wait List Clinic Location"
"RTN","SDWLPE",22,0)
 S DIR("L",1)="Select one of the following:"
"RTN","SDWLPE",23,0)
 S DIR("L",2)=""
"RTN","SDWLPE",24,0)
 S DIR("L",3)="    1. Wait List Service/Specialty (409.31)"
"RTN","SDWLPE",25,0)
 S DIR("L")="    2. Wait List Clinic Location (409.32)"
"RTN","SDWLPE",26,0)
 D ^DIR S SDWLF=X
"RTN","SDWLPE",27,0)
 K DIR,DILN,DINDEX
"RTN","SDWLPE",28,0)
 Q
"RTN","SDWLPE",29,0)
EDIT ;EDIT FILE PARAMETERS
"RTN","SDWLPE",30,0)
 I SDWLF=1 D SB1 Q:$D(DUOUT)
"RTN","SDWLPE",31,0)
 I SDWLF=2 D SB2 Q:$D(DUOUT)
"RTN","SDWLPE",32,0)
 Q
"RTN","SDWLPE",33,0)
SB1 S DIC(0)="AEQMZ",DIC("A")="Select DSS ID: ",DIC="^DIC(40.7,",DIC("S")="I '$P(^DIC(40.7,+Y,0),U,3)"
"RTN","SDWLPE",34,0)
 D ^DIC
"RTN","SDWLPE",35,0)
 I X["^" I $D(DA),'$D(^SDWL(409.31,DA,"I")) S DIK="^SDWL(409.31," D ^DIK S DUOUT=1 Q
"RTN","SDWLPE",36,0)
 Q:Y<0  Q:$D(DUOUT)  S SDWLDSS=+Y
"RTN","SDWLPE",37,0)
 I '$D(^SDWL(409.31,"B",SDWLDSS)) D
"RTN","SDWLPE",38,0)
 .S DIC(0)="LX",X=SDWLDSS,DIC="^SDWL(409.31," K DO D FILE^DICN
"RTN","SDWLPE",39,0)
 S DA=$O(^SDWL(409.31,"B",SDWLDSS,""))
"RTN","SDWLPE",40,0)
SB1A S DIR(0)="PAO^4:EMZ" D ^DIR
"RTN","SDWLPE",41,0)
 I X="" W *7," Required" G SB1A
"RTN","SDWLPE",42,0)
 I X["^" D:'$D(^SDWL(409.31,DA,"I"))  S DUOUT=1 Q
"RTN","SDWLPE",43,0)
 .S DIK="^SDWL(409.31," D ^DIK
"RTN","SDWLPE",44,0)
 S X=$$GET1^DIQ(4,+Y_",",11)
"RTN","SDWLPE",45,0)
 I X'["N"!'$$TF^XUAF4(+Y) W !,*7,"Invalid Entry. Must be 'National' Institution." G SB1A
"RTN","SDWLPE",46,0)
 I '$D(^SDWL(409.31,DA,"I","B",+Y)) D
"RTN","SDWLPE",47,0)
 .S DA(1)=DA,DIC="^SDWL(409.31,"_DA(1)_","_"""I"""_",",DIC("P")=409.311,X=+Y K D0 D FILE^DICN I +Y S DA=+Y
"RTN","SDWLPE",48,0)
 I $D(^SDWL(409.31,DA,"I","B",+Y)) S DA(1)=DA,DA=$O(^(+Y,0))
"RTN","SDWLPE",49,0)
 K DIC,DIE,DIR,DR
"RTN","SDWLPE",50,0)
 W ! S DR="1;3",DIE="^SDWL(409.31,"_DA(1)_","_"""I"""_"," D ^DIE
"RTN","SDWLPE",51,0)
 I $P(^SDWL(409.31,DA(1),"I",DA,0),U,2)="" D
"RTN","SDWLPE",52,0)
 .W *7,!,"This ENTRY requires an ACTIVATION DATE. ENTRY deleted."
"RTN","SDWLPE",53,0)
 .S DIK="^SDWL(409.31,"_DA(1)_","_"""I"""_"," D ^DIK I '$P(^SDWL(409.31,DA(1),"I",0),U,3) D
"RTN","SDWLPE",54,0)
 ..S DIK="^SDWL(409.31,",DA=DA(1) D ^DIK
"RTN","SDWLPE",55,0)
 K DA,DA(1),SDWLDSS,DIC,DR,DIE,DI,DIEDA,DIG,DIH,DIIENS,DIR,DIU,DIV
"RTN","SDWLPE",56,0)
 Q
"RTN","SDWLPE",57,0)
SB2 N STR,INST,DIC,SDWLSC,SDWLSTOP S SDWLSTOP=0
"RTN","SDWLPE",58,0)
 W ! S DIC(0)="AEMNZ",DIC("A")="Select Clinic: ",DIC=44
"RTN","SDWLPE",59,0)
 S DIC("S")="S SDWLX=$G(^SC(+Y,0)),SDWLY=$G(^(""I"")) I $P(SDWLX,U,3)=""C"",$P(SDWLY,U,1)'>$P(SDWLY,U,2)"
"RTN","SDWLPE",60,0)
 S DIC("W")="S STR=$$CLIN^SDWLPE(+Y) I STR W ?50,""- "",$E($P(STR,U,3),1,25),""("",$P(STR,U,2),"")"""
"RTN","SDWLPE",61,0)
 D ^DIC I Y<1 K DIC,DA Q
"RTN","SDWLPE",62,0)
 Q:$D(DUOUT)  S SDWLSC=+Y S INST=+STR  ;$$CLIN(SDWLSC)
"RTN","SDWLPE",63,0)
 I $P(STR,U,6)'="" W !,*7,$P(STR,U,6) G SB2
"RTN","SDWLPE",64,0)
 N SDANEW S SDANEW=""
"RTN","SDWLPE",65,0)
 I '$D(^SDWL(409.32,"B",SDWLSC)) D
"RTN","SDWLPE",66,0)
 .S DIC(0)="LX",X=SDWLSC,DIC="^SDWL(409.32," D FILE^DICN
"RTN","SDWLPE",67,0)
 .N DA S DA=$O(^SDWL(409.32,"B",SDWLSC,"")) S SDANEW=DA
"RTN","SDWLPE",68,0)
 .S DIE="^SDWL(409.32,",DR=".02////^S X=INST" D ^DIE
"RTN","SDWLPE",69,0)
 N DA,SDA S DA=$O(^SDWL(409.32,"B",SDWLSC,"")),SDA=DA
"RTN","SDWLPE",70,0)
 S DR="1",DIE="^SDWL(409.32," D ^DIE
"RTN","SDWLPE",71,0)
 I SDANEW,'X D  D ESB2 H 1 G SB2
"RTN","SDWLPE",72,0)
 .W *7,!!,"This ENTRY requires an ACTIVATION DATE. ENTRY deleted."
"RTN","SDWLPE",73,0)
 .S DA=SDANEW S DIK="^SDWL(409.32," D ^DIK
"RTN","SDWLPE",74,0)
 I '$P(^SDWL(409.32,SDA,0),U,3) I $P(^SDWL(409.32,SDA,0),U,2) S DR="2////^S X=DUZ" D ^DIE ;Checks to see whether the ACTIVATION DATE ENTERED BY field is filled before filling it  SD*5.3*554
"RTN","SDWLPE",75,0)
 N DIC
"RTN","SDWLPE",76,0)
 S SDWLSCN=$P($G(^SDWL(409.32,SDA,0)),U,1) D  Q:SDWLSTOP
"RTN","SDWLPE",77,0)
 .I $D(^SDWL(409.3,"SC",SDWLSCN)) D
"RTN","SDWLPE",78,0)
 ..S SDWLN="",SDWLCNT=0 F  S SDWLN=$O(^SDWL(409.3,"SC",SDWLSCN,SDWLN)) Q:SDWLN=""  D
"RTN","SDWLPE",79,0)
 ...S X=$G(^SDWL(409.3,SDWLN,0)) I '$D(^SDWL(409.3,SDWLN,"DIS")) S SDWLCNT=SDWLCNT+1,^TMP("SDWLPE",$J,"DIS",SDWLN,SDWLCNT)=X,SDWLSTOP=1
"RTN","SDWLPE",80,0)
 ..I SDWLSTOP W !,"This Clinic has Patients on the Wait List and can not be inactivated."  H 2 Q
"RTN","SDWLPE",81,0)
 N SDTEST S SDTEST="" I $G(SDWLN) S SDTEST=$$GET1^DIQ(409.32,SDWLN,3) ;Set Variable SDTEST equal to the information in the INACTIVATED DATE field
"RTN","SDWLPE",82,0)
 S DR="3",DIE="^SDWL(409.32," D ^DIE I $G(X)'=SDTEST D  ; Populates the INACTIVATED DATE ENTERED BY field only if the INACTIVATED DATE field is filled - SD*5.3*554
"RTN","SDWLPE",83,0)
 .I X'="" S DR="4////^S X=+DUZ" D ^DIE
"RTN","SDWLPE",84,0)
 .E  S DR="4////^S X=@" D ^DIE ;SD*5.3*554
"RTN","SDWLPE",85,0)
ESB2 ;
"RTN","SDWLPE",86,0)
 K DR,DIE,DIC,Y,X,SDWLY,DIC(0),DO,DA,DI,DIW,SDWLX,SDWLSCN,SDWLF
"RTN","SDWLPE",87,0)
 Q
"RTN","SDWLPE",88,0)
SWT ;SWITCH FOR INACTIVATION OF PARAMETER FILE
"RTN","SDWLPE",89,0)
 Q
"RTN","SDWLPE",90,0)
HD ;HEADER
"RTN","SDWLPE",91,0)
 W:$D(IOF) @IOF W !!,?80-$L("Wait List Parameter Enter/Edit")\2,"Wait List Parameter Enter/Edit",!
"RTN","SDWLPE",92,0)
 W !,?80-$L("------------------------------")\2,"------------------------------",!
"RTN","SDWLPE",93,0)
END K SDWLSTOP,DIR,DIC,DR,DIK,SDWLX,SDWLSCN,SDWLF,SDWLY,SDWLSC,SDWLN,SDWLCNT,SDWLDSS,DUOUT,X,Y
"RTN","SDWLPE",94,0)
 Q
"RTN","SDWLPE",95,0)
CLIN(CL) ;identify clinic institution through DIVISON ----> INSTITUTION path.
"RTN","SDWLPE",96,0)
 ; function to return:
"RTN","SDWLPE",97,0)
 ;                     1                        2                     3               4                    5       6        7
"RTN","SDWLPE",98,0)
 ; - Institution pointer to ^DIC(4 _U_ STATION number (# 99) _U_ INST Name _U_ DIV Pointer to ^DG(40.8 _U_N/L_U_Message_U_TYPE
"RTN","SDWLPE",99,0)
 ;           ( INST^STA NUM^SNAM^DIV^N/L^MESS^TYPE )
"RTN","SDWLPE",100,0)
 ;           N/L - N -National/L -Local
"RTN","SDWLPE",101,0)
 ;           TYPE - type of entry in file # 44 (field #2)
"RTN","SDWLPE",102,0)
 ;                 C:CLINIC
"RTN","SDWLPE",103,0)
 ;                 M:MODULE
"RTN","SDWLPE",104,0)
 ;                 W:WARD
"RTN","SDWLPE",105,0)
 ;                 Z:OTHER LOCATION
"RTN","SDWLPE",106,0)
 ;                 N:NON-CLINIC STOP
"RTN","SDWLPE",107,0)
 ;                 F:FILE AREA
"RTN","SDWLPE",108,0)
 ;                 I:IMAGING
"RTN","SDWLPE",109,0)
 ;                OR:OPERATING ROOM
"RTN","SDWLPE",110,0)
 ;           
"RTN","SDWLPE",111,0)
 ;        with optional Message:
"RTN","SDWLPE",112,0)
 ;        
"RTN","SDWLPE",113,0)
 ;        if STA=""
"RTN","SDWLPE",114,0)
 ;        -  INST^^SNAM^DIV^N/L^' - No Station Number on file' ^ TYPE
"RTN","SDWLPE",115,0)
 ;          or
"RTN","SDWLPE",116,0)
 ;        -  0^^^DIV^^' - No Institution has been identified '^ TYPE
"RTN","SDWLPE",117,0)
 ;        -  0^^^-1^^'  - No Division has been identified' ^ TYPE
"RTN","SDWLPE",118,0)
 ;        
"RTN","SDWLPE",119,0)
 ;        if entry is inactivated:
"RTN","SDWLPE",120,0)
 ;        
"RTN","SDWLPE",121,0)
 ;        -  INST^^SNAM^DIV^N/L^' - Inactive treating medical facility' ^ TYPE
"RTN","SDWLPE",122,0)
 ;        -  -1^^^^^' -  No clinic on file' ^
"RTN","SDWLPE",123,0)
 ;        
"RTN","SDWLPE",124,0)
 I +CL=0!'$D(^SC(+CL)) Q -1_"^^^^^ - No clinic on file^"
"RTN","SDWLPE",125,0)
 N SDWMES,STN,DIV,INS,SNL,STR,SNAM S SDWMES="",STN=""
"RTN","SDWLPE",126,0)
 N TYPE S TYPE=$$GET1^DIQ(44,CL_",",2,"E")
"RTN","SDWLPE",127,0)
 S DIV=+$$GET1^DIQ(44,CL_",",3.5,"I")
"RTN","SDWLPE",128,0)
 I DIV=0 S SDWMES=" - No Division has been identified" Q 0_"^^^"_-1_"^^"_SDWMES_U_TYPE
"RTN","SDWLPE",129,0)
 S INS=+$$GET1^DIQ(40.8,DIV_",",.07,"I")
"RTN","SDWLPE",130,0)
 I INS=0 S SDWMES=" - No Institution has been identified" Q 0_"^^^"_DIV_"^^"_SDWMES_U_TYPE
"RTN","SDWLPE",131,0)
 E  S STR=$$NS^XUAF4(INS),STN=$P(STR,U,2),SNAM=$P(STR,U) ;station number and name
"RTN","SDWLPE",132,0)
 I STN="" S SDWMES=" - No Station Number on file"
"RTN","SDWLPE",133,0)
 I '$$TF^XUAF4(INS) S SDWMES=SDWMES_" - Inactive treating medical facility"
"RTN","SDWLPE",134,0)
 S SNL=$$GET1^DIQ(4,INS_",",11,"I")
"RTN","SDWLPE",135,0)
 Q INS_U_STN_U_SNAM_U_DIV_U_SNL_U_SDWMES_U_TYPE
"VER")
8.0^22.0
"BLD",8628,6)
^484
**END**
**END**
