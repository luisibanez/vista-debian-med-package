Released SD*5.3*571 SEQ #477
Extracted from mail message
**KIDS**:SD*5.3*571^

**INSTALL NAME**
SD*5.3*571
"BLD",8588,0)
SD*5.3*571^SCHEDULING^0^3110823^y
"BLD",8588,1,0)
^^3^3^3110107^
"BLD",8588,1,1,0)
This patch will fix an issue with the security key for providers, an 
"BLD",8588,1,2,0)
issue with displaying recall reminders on the CPRS cover sheet and 
"BLD",8588,1,3,0)
prohibit selecting an inactive provider when adding a new recall reminder.
"BLD",8588,4,0)
^9.64PA^^0
"BLD",8588,6.3)
3
"BLD",8588,"ABPKG")
n
"BLD",8588,"KRN",0)
^9.67PA^779.2^20
"BLD",8588,"KRN",.4,0)
.4
"BLD",8588,"KRN",.401,0)
.401
"BLD",8588,"KRN",.402,0)
.402
"BLD",8588,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",8588,"KRN",.402,"NM",1,0)
SDRR RECALL CARD ADD    FILE #403.5^403.5^0
"BLD",8588,"KRN",.402,"NM","B","SDRR RECALL CARD ADD    FILE #403.5",1)

"BLD",8588,"KRN",.403,0)
.403
"BLD",8588,"KRN",.5,0)
.5
"BLD",8588,"KRN",.84,0)
.84
"BLD",8588,"KRN",3.6,0)
3.6
"BLD",8588,"KRN",3.8,0)
3.8
"BLD",8588,"KRN",9.2,0)
9.2
"BLD",8588,"KRN",9.8,0)
9.8
"BLD",8588,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",8588,"KRN",9.8,"NM",1,0)
SDRRDEL^^0^B6149328
"BLD",8588,"KRN",9.8,"NM",2,0)
SDRROR^^0^B4946192
"BLD",8588,"KRN",9.8,"NM",3,0)
SDRRUTL^^0^B50446681
"BLD",8588,"KRN",9.8,"NM","B","SDRRDEL",1)

"BLD",8588,"KRN",9.8,"NM","B","SDRROR",2)

"BLD",8588,"KRN",9.8,"NM","B","SDRRUTL",3)

"BLD",8588,"KRN",19,0)
19
"BLD",8588,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",8588,"KRN",19,"NM",1,0)
SDRR CARD ADD^^0
"BLD",8588,"KRN",19,"NM","B","SDRR CARD ADD",1)

"BLD",8588,"KRN",19.1,0)
19.1
"BLD",8588,"KRN",101,0)
101
"BLD",8588,"KRN",101,"NM",0)
^9.68A^1^1
"BLD",8588,"KRN",101,"NM",1,0)
SDRR EVENT^^0
"BLD",8588,"KRN",101,"NM","B","SDRR EVENT",1)

"BLD",8588,"KRN",409.61,0)
409.61
"BLD",8588,"KRN",771,0)
771
"BLD",8588,"KRN",779.2,0)
779.2
"BLD",8588,"KRN",870,0)
870
"BLD",8588,"KRN",8989.51,0)
8989.51
"BLD",8588,"KRN",8989.52,0)
8989.52
"BLD",8588,"KRN",8994,0)
8994
"BLD",8588,"KRN","B",.4,.4)

"BLD",8588,"KRN","B",.401,.401)

"BLD",8588,"KRN","B",.402,.402)

"BLD",8588,"KRN","B",.403,.403)

"BLD",8588,"KRN","B",.5,.5)

"BLD",8588,"KRN","B",.84,.84)

"BLD",8588,"KRN","B",3.6,3.6)

"BLD",8588,"KRN","B",3.8,3.8)

"BLD",8588,"KRN","B",9.2,9.2)

"BLD",8588,"KRN","B",9.8,9.8)

"BLD",8588,"KRN","B",19,19)

"BLD",8588,"KRN","B",19.1,19.1)

"BLD",8588,"KRN","B",101,101)

"BLD",8588,"KRN","B",409.61,409.61)

"BLD",8588,"KRN","B",771,771)

"BLD",8588,"KRN","B",779.2,779.2)

"BLD",8588,"KRN","B",870,870)

"BLD",8588,"KRN","B",8989.51,8989.51)

"BLD",8588,"KRN","B",8989.52,8989.52)

"BLD",8588,"KRN","B",8994,8994)

"BLD",8588,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8588,"QUES",0)
^9.62^^
"BLD",8588,"REQB",0)
^9.611^2^2
"BLD",8588,"REQB",1,0)
SD*5.3*536^2
"BLD",8588,"REQB",2,0)
SD*5.3*561^2
"BLD",8588,"REQB","B","SD*5.3*536",1)

"BLD",8588,"REQB","B","SD*5.3*561",2)

"KRN",.402,2814,-1)
0^1
"KRN",.402,2814,0)
SDRR RECALL CARD ADD^3110819.1425^^403.5^^^3110819
"KRN",.402,2814,"DR",1,403.5)
.01;5;5.5;@01;4;S SDFLAG=$$SCREEN^SDRRUTL;S:SDFLAG="" Y="@01";S:$G(SDFLAG)<1 Y="@99";4.5;4.7;3;2.6;2.5;7////^S X=DUZ;@99;I $D(SDFLAG),SDFLAG="" S SDDIK="";I $D(SDFLAG),SDFLAG=0 S SDDIK=DA;
"KRN",19,13479,-1)
0^1
"KRN",19,13479,0)
SDRR CARD ADD^Add/Edit Clinic Recall Patient^^R^^^^^^^^SCHEDULING^^^1
"KRN",19,13479,1,0)
^19.06^2^2^3110815^^^^
"KRN",19,13479,1,1,0)
This option allows users to enter or edit a patient into
"KRN",19,13479,1,2,0)
the Recall Reminder file without using Appointment Management.
"KRN",19,13479,15)
I $G(SDDIK)>0 N DIK,DA S DIK="^SD(403.5,",DA=SDDIK D ^DIK K SDDIK,DA,DIK W !!?10,"No Recall Record created." H 2
"KRN",19,13479,25)
SDRRCLR2
"KRN",19,13479,99.1)
62082,39923
"KRN",19,13479,"U")
ADD/EDIT CLINIC RECALL PATIENT
"KRN",101,4379,-1)
0^1
"KRN",101,4379,0)
SDRR EVENT^Recall Reminder Action^^A^^^^^^^^
"KRN",101,4379,1,0)
^101.06^3^3^3110815^^^^
"KRN",101,4379,1,1,0)
This protocol will hang off SDAM menu - it is used for the RECALL REMINDER
"KRN",101,4379,1,2,0)
project. This protocol will allow for user to enter or edit information 
"KRN",101,4379,1,3,0)
that has been stored in the RECALL REMINDERS file.
"KRN",101,4379,15)
I $G(SDDIK)>0 N DIK,DA S DIK="^SD(403.5,",DA=SDDIK D ^DIK K SDDIK,DA,DIK W !!?10,"No Recall Record created." H 2
"KRN",101,4379,20)
D SDAM^SDRR1
"KRN",101,4379,99)
62097,59738
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
571^3110823
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3110823
"PKG",16,22,1,"PAH",1,1,1,0)
This patch will fix an issue with the security key for providers, an 
"PKG",16,22,1,"PAH",1,1,2,0)
issue with displaying recall reminders on the CPRS cover sheet and 
"PKG",16,22,1,"PAH",1,1,3,0)
prohibit selecting an inactive provider when adding a new recall reminder.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","SDRRDEL")
0^1^B6149328^B3357699
"RTN","SDRRDEL",1,0)
SDRRDEL ;10N20/MAH;DELETE/EDIT RECALL REMINDERS ;01/18/2008
"RTN","SDRRDEL",2,0)
 ;;5.3;Scheduling;**536,571**;Aug 13, 1993;Build 3
"RTN","SDRRDEL",3,0)
 ;;THIS ROUTINE WILL USE OPTION SDRR DELETE RECALL
"RTN","SDRRDEL",4,0)
 ;
"RTN","SDRRDEL",5,0)
EN S DIDEL=403.5,Q=0,(CLIN,CLINZ)=""  ;SD*571 added linetag EN
"RTN","SDRRDEL",6,0)
 S DIC=403.5,DIC(0)="AELM",DIC("A")="Select Clinic Recall Patient:  " D ^DIC  S Q=+Y I +Y<0 G EXIT
"RTN","SDRRDEL",7,0)
 I +Y>0 S CLIN=$P($G(^SD(403.5,+Y,0)),U,2) I $G(CLIN)]"" S CLINZ=$$GET1^DIQ(44,CLIN_",",.01)
"RTN","SDRRDEL",8,0)
 ;SD*571 added following logic to check if user has security key assigned to provider
"RTN","SDRRDEL",9,0)
 S (SDPRV,KEY,SDFLAG)="" S SDPRV=$P($G(^SD(403.5,+Y,0)),U,5) I SDPRV'="" S KEY=$P($G(^SD(403.54,SDPRV,0)),U,7) D
"RTN","SDRRDEL",10,0)
 .Q:KEY=""
"RTN","SDRRDEL",11,0)
 .N VALUE
"RTN","SDRRDEL",12,0)
 .S VALUE=$$LKUP^XPDKEY(KEY) K KY D OWNSKEY^XUSRB(.KY,VALUE,DUZ)
"RTN","SDRRDEL",13,0)
 .I $G(KY(0))=0 W !!,*7,?12,"THE PROVIDER ASSIGNED TO THIS RECALL REMINDER IS",!,?12,"ASSIGNED A SECURITY KEY WHICH YOU DO NOT HAVE.",!,?12,"PLEASE CONTACT YOUR RECALL COORDINATOR.",! R X:3 D EXIT S SDFLAG=1
"RTN","SDRRDEL",14,0)
 .Q
"RTN","SDRRDEL",15,0)
 I SDFLAG G EN
"RTN","SDRRDEL",16,0)
 ;
"RTN","SDRRDEL",17,0)
 I +Y>0 S DIR(0)="Y",DIR("A")="Are you sure you want to delete: "_$G(CLINZ),DIR("B")="NO" D ^DIR
"RTN","SDRRDEL",18,0)
 I Y'=1 G EXIT
"RTN","SDRRDEL",19,0)
 I Y=1 G KIL
"RTN","SDRRDEL",20,0)
 Q
"RTN","SDRRDEL",21,0)
KIL N SDRRFTR
"RTN","SDRRDEL",22,0)
 S Y=0
"RTN","SDRRDEL",23,0)
 K DIR
"RTN","SDRRDEL",24,0)
 S DIR(0)="SO^1:Failure to respond;2:Moved;3:Deceased;4:Doesn't want VA services;5:Received care at another VA;6:Other",DIR("A")="Reason for Removal" D ^DIR Q:$D(DIRUT) 
"RTN","SDRRDEL",25,0)
 I Y>0 S SDRRFTR=Y
"RTN","SDRRDEL",26,0)
 S DA=+Q S DIE="^SD(403.5,",DR="[SDRREMARKS]",DIE("NO^")="BACKOUTOK" D ^DIE
"RTN","SDRRDEL",27,0)
 S DIK="^SD(403.5,",DA=+Q D ^DIK
"RTN","SDRRDEL",28,0)
 W !!?20,"*** Now Deleting Patient Recall ***" H .5
"RTN","SDRRDEL",29,0)
EXIT ;
"RTN","SDRRDEL",30,0)
 K SDRRFTR,Q,DA,DIC,X,Y,DIDEL,DIC,DIK,DIR,CLIN,CLINZ,DIE,DR,DIRUT,KEY,SDPRV,SDFLAG
"RTN","SDRRDEL",31,0)
 Q
"RTN","SDRROR")
0^2^B4946192^B4074384
"RTN","SDRROR",1,0)
SDRROR ;10N20/MAH;Recall Reminder CPRS Display;01/15/2008
"RTN","SDRROR",2,0)
 ;;5.3;Scheduling;**536,561,571**;Aug 13, 1993;Build 3
"RTN","SDRROR",3,0)
 ;;This routine is called from ORWCV
"RTN","SDRROR",4,0)
 ;;and will be called if Outpatient Clinic param entry is either
"RTN","SDRROR",5,0)
 ;;null or cards
"RTN","SDRROR",6,0)
 ;VAR BEG,END,AND DFN WILL BE KILLED WITH OR ROUTINES
"RTN","SDRROR",7,0)
COVER ; GET RECALL DATES FOR A PATIENT
"RTN","SDRROR",8,0)
 ;At ORWCV TAG VST+24 ADD D COVER^SDRROR
"RTN","SDRROR",9,0)
 Q:BEG<1!(END<1)
"RTN","SDRROR",10,0)
 F RCIFN=0:0 S RCIFN=$O(^SD(403.5,"B",DFN,RCIFN)) Q:RCIFN<1  D
"RTN","SDRROR",11,0)
 .S RCX=$G(^SD(403.5,RCIFN,0)) Q:RCX=""
"RTN","SDRROR",12,0)
 .S RCDT=$P(RCX,U,6) Q:RCDT<BEG  Q:RCDT>END
"RTN","SDRROR",13,0)
 .S RCTYPE=$P(RCX,U,4),RCCLIN=$P(RCX,U,2)
"RTN","SDRROR",14,0)
 .S:RCTYPE]"" RCTYPE=$P($G(^SD(403.51,RCTYPE,0)),U,2)
"RTN","SDRROR",15,0)
 .S:RCCLIN]"" RCCLIN=$$GET1^DIQ(44,RCCLIN_",",.01)
"RTN","SDRROR",16,0)
 .S DATE1=RCDT S:$D(^TMP("ORVSTLIST",$J,RCDT)) DATE1=RCDT+.0001_RCIFN  ;SD*571 added RCIFN so all recalls for same date for patient display in CPRS
"RTN","SDRROR",17,0)
 .S RCNODE="RECALL ("_RCTYPE_") "_RCCLIN,RCNODE=$E(RCNODE,1,45)
"RTN","SDRROR",18,0)
 .S ^TMP("ORVSTLIST",$J,DATE1,"R",1)="R;"_RCDT_";"_RCIFN_U_RCDT_U_RCNODE
"RTN","SDRROR",19,0)
 K RCIFN,RCX,RCTYPE,RCCLIN,RCDT,RCNODE,DATE1
"RTN","SDRROR",20,0)
 Q
"RTN","SDRROR",21,0)
RCDTL ; RECALL DETAILS At ORWCV TAG DTLVST+18 ADD I $P(APPTINFO,";")="R" D RCDTL^SDRROR
"RTN","SDRROR",22,0)
 S RPT(1)="The patient will be sent a letter prior to this date reminding them to make an"  ;SD*561 text changed to read 'prior to this date'
"RTN","SDRROR",23,0)
 S RPT(2)="appointment with the listed clinic."
"RTN","SDRROR",24,0)
 S RCIFN=$P(APPTINFO,";",3) Q:RCIFN=""
"RTN","SDRROR",25,0)
 S APPTINFO=$G(^SD(403.5,RCIFN,0)) Q:APPTINFO=""
"RTN","SDRROR",26,0)
 S COMM=$P(APPTINFO,U,7),FAST=$P(APPTINFO,U,8)
"RTN","SDRROR",27,0)
 S:FAST]"" FAST=$P($P(^DD(403.5,2.6,0),FAST_":",2),";")
"RTN","SDRROR",28,0)
 S RPT(3)="  "
"RTN","SDRROR",29,0)
 S:FAST]"" RPT(4)="Patient should be "_FAST
"RTN","SDRROR",30,0)
 S RPT($S(FAST]"":5,1:4))="Comment: "_COMM
"RTN","SDRROR",31,0)
 K RCIFN,COMM,FAST
"RTN","SDRROR",32,0)
 Q
"RTN","SDRRUTL")
0^3^B50446681^B34000828
"RTN","SDRRUTL",1,0)
SDRRUTL ;10N20/MAH;Recall Reminder-Clinic Utilities;01/18/2008  11:32
"RTN","SDRRUTL",2,0)
 ;;5.3;Scheduling;**536,571**;Aug 13, 1993;Build 3
"RTN","SDRRUTL",3,0)
ASKDIV(SDRRDIV) ;
"RTN","SDRRUTL",4,0)
 N DIC,X,Y,I,DUOUT,DTOUT
"RTN","SDRRUTL",5,0)
 K SDRRDIV
"RTN","SDRRUTL",6,0)
 S SDRRDIV=0
"RTN","SDRRUTL",7,0)
 W !
"RTN","SDRRUTL",8,0)
 S DIC("A")="Select Medical Center Division: All// "
"RTN","SDRRUTL",9,0)
 S DIC="^DG(40.8,"
"RTN","SDRRUTL",10,0)
 S DIC(0)="AEQMN"
"RTN","SDRRUTL",11,0)
 F  D  Q:Y=-1
"RTN","SDRRUTL",12,0)
 . D ^DIC Q:Y=-1
"RTN","SDRRUTL",13,0)
 . S SDRRDIV(+Y)=$P(Y,U,2)
"RTN","SDRRUTL",14,0)
 . S DIC("A")="Another Medical Center Division: "
"RTN","SDRRUTL",15,0)
 Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDRRUTL",16,0)
 S I=0
"RTN","SDRRUTL",17,0)
 I $O(SDRRDIV(0)) D  Q
"RTN","SDRRUTL",18,0)
 . F  S I=$O(SDRRDIV(I)) Q:'I  S SDRRDIV=SDRRDIV+1
"RTN","SDRRUTL",19,0)
 F  S I=$O(^DG(40.8,I)) Q:'I  S SDRRDIV(I)=$P(^(I,0),U),SDRRDIV=SDRRDIV+1
"RTN","SDRRUTL",20,0)
 Q
"RTN","SDRRUTL",21,0)
ASKSTOP(SDRRSC,SDRRST,SDRRND) ;
"RTN","SDRRUTL",22,0)
 N DIC,X,Y,I,DUOUT,DTOUT,SDRRREC
"RTN","SDRRUTL",23,0)
 K SDRRSC
"RTN","SDRRUTL",24,0)
 S SDRRSC=0
"RTN","SDRRUTL",25,0)
 W !
"RTN","SDRRUTL",26,0)
 S DIC("A")="Select Clinic Stop Code: All// "
"RTN","SDRRUTL",27,0)
 S DIC="^DIC(40.7,"
"RTN","SDRRUTL",28,0)
 S:$G(SDRRST) DIC("S")="N SDRRXD S SDRRXD=$P(^(0),U,3) I 'SDRRXD!(SDRRXD'<SDRRST)"
"RTN","SDRRUTL",29,0)
 S DIC(0)="AEQMZ"
"RTN","SDRRUTL",30,0)
 F  D  Q:Y=-1
"RTN","SDRRUTL",31,0)
 . D ^DIC Q:Y=-1
"RTN","SDRRUTL",32,0)
 . S SDRRSC(+Y)=$P(Y(0),U,2)
"RTN","SDRRUTL",33,0)
 . S DIC("A")="Another Clinic Stop Code: "
"RTN","SDRRUTL",34,0)
 Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDRRUTL",35,0)
 S I=0
"RTN","SDRRUTL",36,0)
 I $O(SDRRSC(0)) D  Q
"RTN","SDRRUTL",37,0)
 . F  S I=$O(SDRRSC(I)) Q:'I  S SDRRSC=SDRRSC+1
"RTN","SDRRUTL",38,0)
 F  S I=$O(^DIC(40.7,I)) Q:'I  S SDRRREC=^(I,0) D
"RTN","SDRRUTL",39,0)
 . Q:$P(SDRRREC,U,3)<SDRRST
"RTN","SDRRUTL",40,0)
 . S SDRRSC(I)=$P(SDRRREC,U),SDRRSC=SDRRSC+1
"RTN","SDRRUTL",41,0)
 Q
"RTN","SDRRUTL",42,0)
ASKCLIN(SDRRCLIN,SDRRDIV,SDRRST,SDRRND) ;
"RTN","SDRRUTL",43,0)
 N DIR,X,Y,DIRUT
"RTN","SDRRUTL",44,0)
 K SDRRCLIN
"RTN","SDRRUTL",45,0)
 S SDRRCLIN=0
"RTN","SDRRUTL",46,0)
 W !
"RTN","SDRRUTL",47,0)
 S DIR(0)="Y"
"RTN","SDRRUTL",48,0)
 S DIR("A")="All Clinics"
"RTN","SDRRUTL",49,0)
 S DIR("B")="No"
"RTN","SDRRUTL",50,0)
 D ^DIR Q:$D(DIRUT)
"RTN","SDRRUTL",51,0)
 I Y S SDRRCLIN="ALL" Q
"RTN","SDRRUTL",52,0)
 D ASKRANGE^SDRRUTL1(.SDRRCLIN,.SDRRDIV,.SDRRST,.SDRRND)
"RTN","SDRRUTL",53,0)
 Q
"RTN","SDRRUTL",54,0)
DELIM() ;
"RTN","SDRRUTL",55,0)
 N DIR,X,Y,DIRUT
"RTN","SDRRUTL",56,0)
 S DIR(0)="Y"
"RTN","SDRRUTL",57,0)
 S DIR("A")="Delimited Output"
"RTN","SDRRUTL",58,0)
 S DIR("B")="No"
"RTN","SDRRUTL",59,0)
 D ^DIR Q:$D(DIRUT) -1
"RTN","SDRRUTL",60,0)
 Q Y
"RTN","SDRRUTL",61,0)
REVERSE(SDRRST,SDRRND) ; Given starting and ending dates return reverse starting and ending dates
"RTN","SDRRUTL",62,0)
 N SDRRRST,SDRRRND
"RTN","SDRRUTL",63,0)
 S SDRRRST=9999999-SDRRST+.9999
"RTN","SDRRUTL",64,0)
 S SDRRRND=9999999-SDRRND
"RTN","SDRRUTL",65,0)
 S SDRRST=SDRRRND
"RTN","SDRRUTL",66,0)
 S SDRRND=SDRRRST
"RTN","SDRRUTL",67,0)
 Q
"RTN","SDRRUTL",68,0)
DRANGE(SDRRST,SDRRND,SDRRSTX,SDRRNDX,SDRRABORT,SDRRMIN,SDRRMAX,SDRRFUTR) ;
"RTN","SDRRUTL",69,0)
 ; Set SDRRFUTR=1 if dates in the future are OK.
"RTN","SDRRUTL",70,0)
 N DIR,DIRUT,X,Y
"RTN","SDRRUTL",71,0)
 I $G(SDRRFUTR) S DIR(0)="D^"_$G(SDRRMIN)_":"_$G(SDRRMAX)_":AEFX"
"RTN","SDRRUTL",72,0)
 E  S DIR(0)="D^"_$G(SDRRMIN)_":"_$G(SDRRMAX,DT)_":AEPX"
"RTN","SDRRUTL",73,0)
 S DIR("A")="Enter start date"
"RTN","SDRRUTL",74,0)
 I $D(SDRRST) D
"RTN","SDRRUTL",75,0)
 . S SDRRSTX=$$FMTE^XLFDT(SDRRST,5)
"RTN","SDRRUTL",76,0)
 . S DIR("B")=SDRRSTX
"RTN","SDRRUTL",77,0)
 D ^DIR I $D(DIRUT) S SDRRABORT=1 Q
"RTN","SDRRUTL",78,0)
 S SDRRST=Y
"RTN","SDRRUTL",79,0)
 K DIR
"RTN","SDRRUTL",80,0)
 I $G(SDRRFUTR) S DIR(0)="D^"_SDRRST_":"_$G(SDRRMAX)_":AEFX"
"RTN","SDRRUTL",81,0)
 E  S DIR(0)="D^"_SDRRST_":"_$G(SDRRMAX,DT)_":AEPX"
"RTN","SDRRUTL",82,0)
 S DIR("A")="Enter end date"
"RTN","SDRRUTL",83,0)
 I $D(SDRRND) D
"RTN","SDRRUTL",84,0)
 . S SDRRNDX=$$FMTE^XLFDT(SDRRND,5)
"RTN","SDRRUTL",85,0)
 . S DIR("B")=SDRRNDX
"RTN","SDRRUTL",86,0)
 D ^DIR I $D(DIRUT) S SDRRABORT=1 Q
"RTN","SDRRUTL",87,0)
 S SDRRND=Y
"RTN","SDRRUTL",88,0)
 S SDRRNDX=$$FMTE^XLFDT(SDRRND,2)
"RTN","SDRRUTL",89,0)
 S SDRRSTX=$$FMTE^XLFDT(SDRRST,2)
"RTN","SDRRUTL",90,0)
 Q
"RTN","SDRRUTL",91,0)
ASKDATE(SDRRST,SDRRSTX,SDRRABORT,SDRRMIN,SDRRMAX,SDRRFUTR) ;
"RTN","SDRRUTL",92,0)
 N DIR,DIRUT,X,Y
"RTN","SDRRUTL",93,0)
 I $G(SDRRFUTR) S DIR(0)="D^"_$G(SDRRMIN)_":"_$G(SDRRMAX)_":AEFX"
"RTN","SDRRUTL",94,0)
 E  S DIR(0)="D^"_$G(SDRRMIN)_":"_$G(SDRRMAX,DT)_":AEPX"
"RTN","SDRRUTL",95,0)
 S DIR("A")="Enter start date"
"RTN","SDRRUTL",96,0)
 I $D(SDRRST) D
"RTN","SDRRUTL",97,0)
 . S SDRRSTX=$$FMTE^XLFDT(SDRRST,2)
"RTN","SDRRUTL",98,0)
 . S DIR("B")=SDRRSTX
"RTN","SDRRUTL",99,0)
 D ^DIR I $D(DIRUT) S SDRRABORT=1 Q
"RTN","SDRRUTL",100,0)
 S SDRRST=Y
"RTN","SDRRUTL",101,0)
 S SDRRSTX=$$FMTE^XLFDT(SDRRST,2)
"RTN","SDRRUTL",102,0)
 Q
"RTN","SDRRUTL",103,0)
FYRANGE(SDRRST,SDRRND,SDRRSTX,SDRRNDX,SDRRABORT,SDRRMIN,SDRRMAX) ;
"RTN","SDRRUTL",104,0)
 N SDRRMAXFY,SDRRFRFY,SDRRTOFY
"RTN","SDRRUTL",105,0)
 S (SDRRMAXFY,SDRRTOFY)=$$FY($$FMADD^XLFDT($E(DT,1,5)_"01",-1)) ; FY of last month
"RTN","SDRRUTL",106,0)
 S SDRRFRFY=$$ASKFY($G(SDRRMIN),$G(SDRRMAX),,"From")
"RTN","SDRRUTL",107,0)
 I SDRRFRFY=0 S SDRRABORT=1 Q
"RTN","SDRRUTL",108,0)
 I SDRRFRFY'=SDRRMAXFY D  Q:SDRRABORT
"RTN","SDRRUTL",109,0)
 . S SDRRTOFY=$$ASKFY($P(SDRRFRFY,U,3),$G(SDRRMAX),+$P(SDRRMAXFY," ",2),"Through")
"RTN","SDRRUTL",110,0)
 . I SDRRTOFY=0 S SDRRABORT=1
"RTN","SDRRUTL",111,0)
 S SDRRST=$P(SDRRFRFY,U,2)
"RTN","SDRRUTL",112,0)
 S SDRRND=$P(SDRRTOFY,U,3)
"RTN","SDRRUTL",113,0)
 S SDRRSTX=$$FMTE^XLFDT($E(SDRRST,1,5)_"01",2)
"RTN","SDRRUTL",114,0)
 S SDRRNDX=$$FMTE^XLFDT($$FMADD^XLFDT($E(SDRRND,1,5)_"01",-1),2)
"RTN","SDRRUTL",115,0)
 S SDRRSTX("FY")=$P(SDRRFRFY,U)
"RTN","SDRRUTL",116,0)
 S SDRRNDX("FY")=$P(SDRRTOFY,U)
"RTN","SDRRUTL",117,0)
 Q
"RTN","SDRRUTL",118,0)
ASKFY(SDRRMIN,SDRRMAX,SDRRDEF,SDRRPRMPT) ; Function asks user which FY.
"RTN","SDRRUTL",119,0)
 N DIR,X,Y,DIRUT,SDRRFY
"RTN","SDRRUTL",120,0)
 S DIR("A")=$G(SDRRPRMPT,"Select")_" FY ("
"RTN","SDRRUTL",121,0)
 I '$G(SDRRMAX) D
"RTN","SDRRUTL",122,0)
 . S SDRRMAX=$$FMADD^XLFDT($E(DT,1,5)_"01",-1) ; last month
"RTN","SDRRUTL",123,0)
 . S SDRRMAX=$E($P($$FY(SDRRMAX),U,3),1,3)_"0000"
"RTN","SDRRUTL",124,0)
 I $G(SDRRMIN) S DIR("A")=DIR("A")_($E(SDRRMIN,1,3)+1700)_" "
"RTN","SDRRUTL",125,0)
 S DIR("A")=DIR("A")_"through "_($E(SDRRMAX,1,3)+1700)_"): "
"RTN","SDRRUTL",126,0)
 S DIR(0)="DA^"_$G(SDRRMIN)_":"_SDRRMAX_":AEM"
"RTN","SDRRUTL",127,0)
 S DIR("B")=$$FMTE^XLFDT($G(SDRRDEF,SDRRMAX))
"RTN","SDRRUTL",128,0)
 D ^DIR I $D(DIRUT) Q 0
"RTN","SDRRUTL",129,0)
 S SDRRFY=$$FY(Y)
"RTN","SDRRUTL",130,0)
 W "     ",$P(SDRRFY,U)
"RTN","SDRRUTL",131,0)
 Q SDRRFY
"RTN","SDRRUTL",132,0)
FY(SDRRDT) ; Pass in a date (default = today's date),
"RTN","SDRRUTL",133,0)
 ; and this function returns what FY we are in,
"RTN","SDRRUTL",134,0)
 ; followed by the FY start date and FY end date.
"RTN","SDRRUTL",135,0)
 ; ie. S X=$$FY^SDRRUTL(3050208) results in X="FY 2005^3041000^3051000"
"RTN","SDRRUTL",136,0)
 N SDRRST,SDRRND
"RTN","SDRRUTL",137,0)
 S:'$D(SDRRDT) SDRRDT=DT
"RTN","SDRRUTL",138,0)
 S SDRRST=$E(SDRRDT,1,3)-($E(SDRRDT,4,5)<10)_"1000"
"RTN","SDRRUTL",139,0)
 S SDRRND=$E(SDRRST,1,3)+1_"1000"
"RTN","SDRRUTL",140,0)
 Q "FY "_(1701+$E(SDRRST,1,3))_U_SDRRST_U_SDRRND
"RTN","SDRRUTL",141,0)
ASKMON(SDRRMON) ; Function asks user which month.
"RTN","SDRRUTL",142,0)
 ; SDRRMON - (optional) default month
"RTN","SDRRUTL",143,0)
 N DIR,X,Y,DIRUT,SDRRDT
"RTN","SDRRUTL",144,0)
 S DIR("A")="Select Month"
"RTN","SDRRUTL",145,0)
 I $D(SDRRMON) S SDRRDT=SDRRMON
"RTN","SDRRUTL",146,0)
 E  D
"RTN","SDRRUTL",147,0)
 . S SDRRDT=$$FMADD^XLFDT($E(DT,1,5)_"01",-1) ; last month
"RTN","SDRRUTL",148,0)
 . S SDRRDT=$E(SDRRDT,1,5)_"00"
"RTN","SDRRUTL",149,0)
 S DIR(0)="D^:"_SDRRDT_":AEM"
"RTN","SDRRUTL",150,0)
 S DIR("B")=$$FMTE^XLFDT(SDRRDT)
"RTN","SDRRUTL",151,0)
 D ^DIR I $D(DIRUT) Q 0
"RTN","SDRRUTL",152,0)
 Q Y
"RTN","SDRRUTL",153,0)
MON(SDRRDT) ; Pass in a date (default = today's date),
"RTN","SDRRUTL",154,0)
 ; and this function returns the first and last dates of the month.
"RTN","SDRRUTL",155,0)
 N SDRRMST,SDRRMND
"RTN","SDRRUTL",156,0)
 S:'$D(SDRRDT) SDRRDT=DT
"RTN","SDRRUTL",157,0)
 S SDRRMST=$E(SDRRDT,1,5)_"01"
"RTN","SDRRUTL",158,0)
 S SDRRMND=$$SCH^XLFDT("1M(1)",SDRRMST)\1
"RTN","SDRRUTL",159,0)
 Q SDRRMST_U_SDRRMND
"RTN","SDRRUTL",160,0)
BDAY ;
"RTN","SDRRUTL",161,0)
 N GDAYS,JDAYS,YR1DAYS
"RTN","SDRRUTL",162,0)
 S GDAYS=$$FMDIFF^XLFDT(3050830,3050628) W !,"GDAYS=",GDAYS
"RTN","SDRRUTL",163,0)
 S JDAYS=$$FMDIFF^XLFDT(3050830,3050811) W !,"JDAYS=",JDAYS
"RTN","SDRRUTL",164,0)
 S YR1DAYS=365-GDAYS-JDAYS W !,"YR1DAYS=",YR1DAYS
"RTN","SDRRUTL",165,0)
 W !,"99th Birthday= ",$$FMADD^XLFDT(3050830,YR1DAYS\4)
"RTN","SDRRUTL",166,0)
 W !,"100th Birthday=",$$FMADD^XLFDT(3050830,(YR1DAYS+365)\4)
"RTN","SDRRUTL",167,0)
 W !,"101st Birthday=",$$FMADD^XLFDT(3050830,YR1DAYS+730\4)
"RTN","SDRRUTL",168,0)
 Q
"RTN","SDRRUTL",169,0)
 ;
"RTN","SDRRUTL",170,0)
SCREEN() ;SD*571 for new RRs, screen provider for key and status
"RTN","SDRRUTL",171,0)
 N KEY,VALUE
"RTN","SDRRUTL",172,0)
 S SDIEN="",SDIEN=DA
"RTN","SDRRUTL",173,0)
 S SDFLAG=0
"RTN","SDRRUTL",174,0)
 I '$P($G(^SD(403.54,+X,0)),U,7),$P($G(^(0)),U,6)="A" S SDFLAG=1 Q SDFLAG   ;allow selection, provider has no key and is active
"RTN","SDRRUTL",175,0)
 I $P($G(^SD(403.54,+X,0)),U,6)="I" D MSG1 Q SDFLAG   ;do not allow, provider is inactive
"RTN","SDRRUTL",176,0)
 I $P($G(^SD(403.54,+X,0)),U,7) S KEY=$P(^(0),U,7) D
"RTN","SDRRUTL",177,0)
 .S VALUE=$$LKUP^XPDKEY(KEY) K KY D OWNSKEY^XUSRB(.KY,VALUE,DUZ)
"RTN","SDRRUTL",178,0)
 .I $G(KY(0))=1 S SDFLAG=1 K KY
"RTN","SDRRUTL",179,0)
 I SDFLAG Q SDFLAG   ;allow, provider and user both have security key
"RTN","SDRRUTL",180,0)
 I 'SDFLAG D MSG2   ;do not allow, provider has key user does not
"RTN","SDRRUTL",181,0)
 Q SDFLAG
"RTN","SDRRUTL",182,0)
 ;
"RTN","SDRRUTL",183,0)
MSG1 ;SD*571 print Inactive provider warning message to user
"RTN","SDRRUTL",184,0)
 W " ??"
"RTN","SDRRUTL",185,0)
 W !?10,"Provider selected is Inactive."
"RTN","SDRRUTL",186,0)
 W !?10,"Please contact your Recall Coordinator.",!
"RTN","SDRRUTL",187,0)
 D:$D(PROV1) FDA Q
"RTN","SDRRUTL",188,0)
 Q
"RTN","SDRRUTL",189,0)
 ;
"RTN","SDRRUTL",190,0)
MSG2 ;SD*571 print Security Key warning message to user
"RTN","SDRRUTL",191,0)
 W " ??"
"RTN","SDRRUTL",192,0)
 W !?10,"Provider selected is assigned Security Key"
"RTN","SDRRUTL",193,0)
 W !?10,"which you do not hold."
"RTN","SDRRUTL",194,0)
 W !?10,"Please contact your Recall Coordinator.",!
"RTN","SDRRUTL",195,0)
 D:$D(PROV1) FDA Q
"RTN","SDRRUTL",196,0)
 Q
"RTN","SDRRUTL",197,0)
 ;
"RTN","SDRRUTL",198,0)
FDA ;SD*571 insure original provider pointer is back in 403.5 record
"RTN","SDRRUTL",199,0)
 Q:'$D(PROV1)
"RTN","SDRRUTL",200,0)
 S (FDA,SDFLD)=""
"RTN","SDRRUTL",201,0)
 S SDFLD=4,FDA(403.5,SDIEN_",",SDFLD)=PROV1
"RTN","SDRRUTL",202,0)
 D FILE^DIE("","FDA")
"RTN","SDRRUTL",203,0)
 D CLEAN^DILF
"RTN","SDRRUTL",204,0)
 K FDA,SDFLD,SDIEN
"RTN","SDRRUTL",205,0)
 S SDFLAG=""   ;null indicates edit so ^DIK will not be called at exit
"RTN","SDRRUTL",206,0)
 Q
"RTN","SDRRUTL",207,0)
 ;
"VER")
8.0^22.0
"BLD",8588,6)
^477
**END**
**END**
