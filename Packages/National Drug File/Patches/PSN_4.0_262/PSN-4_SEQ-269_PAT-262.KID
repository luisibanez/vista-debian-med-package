Released PSN*4*262 SEQ #269
Extracted from mail message
**KIDS**:PSN*4.0*262^

**INSTALL NAME**
PSN*4.0*262
"BLD",7113,0)
PSN*4.0*262^NATIONAL DRUG FILE^0^3100902^y
"BLD",7113,1,0)
^^61^61^3100902^
"BLD",7113,1,1,0)
This patch addresses the New Service Request (NSR) #20070434 to prevent
"BLD",7113,1,2,0)
the inadvertent creation of supra-therapeutic possible dosages for high
"BLD",7113,1,3,0)
risk medications during dosage creation performed during the matching and
"BLD",7113,1,4,0)
re-matching of dispense drugs to National Drug File (NDF) entries within
"BLD",7113,1,5,0)
the Pharmacy Data Management (PDM) V. 1.0 application.
"BLD",7113,1,6,0)
 
"BLD",7113,1,7,0)
Patch PSN*4*261 has been previously released in preparation for this
"BLD",7113,1,8,0)
project. It added the following 3 new fields to the VA PRODUCT file
"BLD",7113,1,9,0)
(#50.68):
"BLD",7113,1,10,0)
 
"BLD",7113,1,11,0)
       CREATE DEFAULT POSSIBLE DOSAGE (#40)
"BLD",7113,1,12,0)
       POSSIBLE DOSAGES TO CREATE (#41)
"BLD",7113,1,13,0)
       PACKAGE (#42)
"BLD",7113,1,14,0)
 
"BLD",7113,1,15,0)
Patch PSN*4*262 is being released in conjunction with PDM patch PSS*1*155,
"BLD",7113,1,16,0)
which has the functionality in place to determine if possible dosages
"BLD",7113,1,17,0)
should be auto-created or not during the match/re-match process.
"BLD",7113,1,18,0)
 
"BLD",7113,1,19,0)
This patch contains changes to the Inquire to National Files [PSNACT]
"BLD",7113,1,20,0)
and Inquire to VA Product Info For Local Drug [PSNLOOK] options to include
"BLD",7113,1,21,0)
the display of the new fields. Below are some screen captures of how the
"BLD",7113,1,22,0)
new fields will display to the screen for both options:
"BLD",7113,1,23,0)
 
"BLD",7113,1,24,0)
   Example #1:
"BLD",7113,1,25,0)
         ...
"BLD",7113,1,26,0)
 
"BLD",7113,1,27,0)
         Override DF Exclude from Dosage Checks: No
"BLD",7113,1,28,0)
 
"BLD",7113,1,29,0)
         Auto-Create Default Possible Dosage? Yes
"BLD",7113,1,30,0)
 
"BLD",7113,1,31,0)
 
"BLD",7113,1,32,0)
   Example #2:
"BLD",7113,1,33,0)
         ...
"BLD",7113,1,34,0)
         Auto-Create Default Possible Dosage? No
"BLD",7113,1,35,0)
             Possible Dosages To Auto-Create: No Possible Dosages
"BLD",7113,1,36,0)
 
"BLD",7113,1,37,0)
 
"BLD",7113,1,38,0)
   Example #3:
"BLD",7113,1,39,0)
         ...
"BLD",7113,1,40,0)
 
"BLD",7113,1,41,0)
         Override DF Exclude from Dosage Checks: No
"BLD",7113,1,42,0)
 
"BLD",7113,1,43,0)
         Auto-Create Default Possible Dosage? No
"BLD",7113,1,44,0)
             Possible Dosages To Auto-Create: 1x and 2x Possible Dosages
"BLD",7113,1,45,0)
                                     Package: Inpatient
"BLD",7113,1,46,0)
 
"BLD",7113,1,47,0)
 
"BLD",7113,1,48,0)
NOTE: For more information about the new fields, please refer to the patch
"BLD",7113,1,49,0)
      PSN*4*261. For information on how the new fields affect
"BLD",7113,1,50,0)
      auto-creation of possible dosages during match and re-match
"BLD",7113,1,51,0)
      process, refer to patch PSS*1*155.
"BLD",7113,1,52,0)
 
"BLD",7113,1,53,0)
Also, this patch adds the component $$POSDOS to the routine PSNAPIS,
"BLD",7113,1,54,0)
supported by Integration Control Registration (ICR) #2153, to retrieve the
"BLD",7113,1,55,0)
content of these 3 new fields.
"BLD",7113,1,56,0)
 
"BLD",7113,1,57,0)
In addition, a post-install routine will run to update the CREATE DEFAULT
"BLD",7113,1,58,0)
POSSIBLE DOSAGE field (#40) with the default value of "YES" for entries
"BLD",7113,1,59,0)
added to the VA PRODUCT file (#50.68) after patch PSN*4*261 was installed.
"BLD",7113,1,60,0)
The post-install routine will be automatically deleted from the system
"BLD",7113,1,61,0)
upon completion of the installation.
"BLD",7113,4,0)
^9.64PA^^
"BLD",7113,6.3)
6
"BLD",7113,"INID")
^y
"BLD",7113,"INIT")
PSN262P
"BLD",7113,"KRN",0)
^9.67PA^779.2^20
"BLD",7113,"KRN",.4,0)
.4
"BLD",7113,"KRN",.401,0)
.401
"BLD",7113,"KRN",.402,0)
.402
"BLD",7113,"KRN",.403,0)
.403
"BLD",7113,"KRN",.5,0)
.5
"BLD",7113,"KRN",.84,0)
.84
"BLD",7113,"KRN",3.6,0)
3.6
"BLD",7113,"KRN",3.8,0)
3.8
"BLD",7113,"KRN",9.2,0)
9.2
"BLD",7113,"KRN",9.8,0)
9.8
"BLD",7113,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",7113,"KRN",9.8,"NM",1,0)
PSNAPIS^^0^B46745959
"BLD",7113,"KRN",9.8,"NM",2,0)
PSNACT^^0^B112706557
"BLD",7113,"KRN",9.8,"NM",3,0)
PSNLOOK^^0^B48511720
"BLD",7113,"KRN",9.8,"NM",4,0)
PSN262P^^0^B321955
"BLD",7113,"KRN",9.8,"NM","B","PSN262P",4)

"BLD",7113,"KRN",9.8,"NM","B","PSNACT",2)

"BLD",7113,"KRN",9.8,"NM","B","PSNAPIS",1)

"BLD",7113,"KRN",9.8,"NM","B","PSNLOOK",3)

"BLD",7113,"KRN",19,0)
19
"BLD",7113,"KRN",19.1,0)
19.1
"BLD",7113,"KRN",101,0)
101
"BLD",7113,"KRN",409.61,0)
409.61
"BLD",7113,"KRN",771,0)
771
"BLD",7113,"KRN",779.2,0)
779.2
"BLD",7113,"KRN",870,0)
870
"BLD",7113,"KRN",8989.51,0)
8989.51
"BLD",7113,"KRN",8989.52,0)
8989.52
"BLD",7113,"KRN",8994,0)
8994
"BLD",7113,"KRN","B",.4,.4)

"BLD",7113,"KRN","B",.401,.401)

"BLD",7113,"KRN","B",.402,.402)

"BLD",7113,"KRN","B",.403,.403)

"BLD",7113,"KRN","B",.5,.5)

"BLD",7113,"KRN","B",.84,.84)

"BLD",7113,"KRN","B",3.6,3.6)

"BLD",7113,"KRN","B",3.8,3.8)

"BLD",7113,"KRN","B",9.2,9.2)

"BLD",7113,"KRN","B",9.8,9.8)

"BLD",7113,"KRN","B",19,19)

"BLD",7113,"KRN","B",19.1,19.1)

"BLD",7113,"KRN","B",101,101)

"BLD",7113,"KRN","B",409.61,409.61)

"BLD",7113,"KRN","B",771,771)

"BLD",7113,"KRN","B",779.2,779.2)

"BLD",7113,"KRN","B",870,870)

"BLD",7113,"KRN","B",8989.51,8989.51)

"BLD",7113,"KRN","B",8989.52,8989.52)

"BLD",7113,"KRN","B",8994,8994)

"BLD",7113,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7113,"QUES",0)
^9.62^^
"BLD",7113,"REQB",0)
^9.611^2^2
"BLD",7113,"REQB",1,0)
PSN*4.0*261^2
"BLD",7113,"REQB",2,0)
PSN*4.0*108^2
"BLD",7113,"REQB","B","PSN*4.0*108",2)

"BLD",7113,"REQB","B","PSN*4.0*261",1)

"INIT")
PSN262P
"MBREQ")
0
"PKG",136,-1)
1^1
"PKG",136,0)
NATIONAL DRUG FILE^PSN^This is the National Drug File Package V 4
"PKG",136,20,0)
^9.402P^^
"PKG",136,22,0)
^9.49I^1^1
"PKG",136,22,1,0)
4.0^2981030^2981223^11595
"PKG",136,22,1,"PAH",1,0)
262^3100902
"PKG",136,22,1,"PAH",1,1,0)
^^61^61^3100902
"PKG",136,22,1,"PAH",1,1,1,0)
This patch addresses the New Service Request (NSR) #20070434 to prevent
"PKG",136,22,1,"PAH",1,1,2,0)
the inadvertent creation of supra-therapeutic possible dosages for high
"PKG",136,22,1,"PAH",1,1,3,0)
risk medications during dosage creation performed during the matching and
"PKG",136,22,1,"PAH",1,1,4,0)
re-matching of dispense drugs to National Drug File (NDF) entries within
"PKG",136,22,1,"PAH",1,1,5,0)
the Pharmacy Data Management (PDM) V. 1.0 application.
"PKG",136,22,1,"PAH",1,1,6,0)
 
"PKG",136,22,1,"PAH",1,1,7,0)
Patch PSN*4*261 has been previously released in preparation for this
"PKG",136,22,1,"PAH",1,1,8,0)
project. It added the following 3 new fields to the VA PRODUCT file
"PKG",136,22,1,"PAH",1,1,9,0)
(#50.68):
"PKG",136,22,1,"PAH",1,1,10,0)
 
"PKG",136,22,1,"PAH",1,1,11,0)
       CREATE DEFAULT POSSIBLE DOSAGE (#40)
"PKG",136,22,1,"PAH",1,1,12,0)
       POSSIBLE DOSAGES TO CREATE (#41)
"PKG",136,22,1,"PAH",1,1,13,0)
       PACKAGE (#42)
"PKG",136,22,1,"PAH",1,1,14,0)
 
"PKG",136,22,1,"PAH",1,1,15,0)
Patch PSN*4*262 is being released in conjunction with PDM patch PSS*1*155,
"PKG",136,22,1,"PAH",1,1,16,0)
which has the functionality in place to determine if possible dosages
"PKG",136,22,1,"PAH",1,1,17,0)
should be auto-created or not during the match/re-match process.
"PKG",136,22,1,"PAH",1,1,18,0)
 
"PKG",136,22,1,"PAH",1,1,19,0)
This patch contains changes to the Inquire to National Files [PSNACT]
"PKG",136,22,1,"PAH",1,1,20,0)
and Inquire to VA Product Info For Local Drug [PSNLOOK] options to include
"PKG",136,22,1,"PAH",1,1,21,0)
the display of the new fields. Below are some screen captures of how the
"PKG",136,22,1,"PAH",1,1,22,0)
new fields will display to the screen for both options:
"PKG",136,22,1,"PAH",1,1,23,0)
 
"PKG",136,22,1,"PAH",1,1,24,0)
   Example #1:
"PKG",136,22,1,"PAH",1,1,25,0)
         ...
"PKG",136,22,1,"PAH",1,1,26,0)
 
"PKG",136,22,1,"PAH",1,1,27,0)
         Override DF Exclude from Dosage Checks: No
"PKG",136,22,1,"PAH",1,1,28,0)
 
"PKG",136,22,1,"PAH",1,1,29,0)
         Auto-Create Default Possible Dosage? Yes
"PKG",136,22,1,"PAH",1,1,30,0)
 
"PKG",136,22,1,"PAH",1,1,31,0)
 
"PKG",136,22,1,"PAH",1,1,32,0)
   Example #2:
"PKG",136,22,1,"PAH",1,1,33,0)
         ...
"PKG",136,22,1,"PAH",1,1,34,0)
         Auto-Create Default Possible Dosage? No
"PKG",136,22,1,"PAH",1,1,35,0)
             Possible Dosages To Auto-Create: No Possible Dosages
"PKG",136,22,1,"PAH",1,1,36,0)
 
"PKG",136,22,1,"PAH",1,1,37,0)
 
"PKG",136,22,1,"PAH",1,1,38,0)
   Example #3:
"PKG",136,22,1,"PAH",1,1,39,0)
         ...
"PKG",136,22,1,"PAH",1,1,40,0)
 
"PKG",136,22,1,"PAH",1,1,41,0)
         Override DF Exclude from Dosage Checks: No
"PKG",136,22,1,"PAH",1,1,42,0)
 
"PKG",136,22,1,"PAH",1,1,43,0)
         Auto-Create Default Possible Dosage? No
"PKG",136,22,1,"PAH",1,1,44,0)
             Possible Dosages To Auto-Create: 1x and 2x Possible Dosages
"PKG",136,22,1,"PAH",1,1,45,0)
                                     Package: Inpatient
"PKG",136,22,1,"PAH",1,1,46,0)
 
"PKG",136,22,1,"PAH",1,1,47,0)
 
"PKG",136,22,1,"PAH",1,1,48,0)
NOTE: For more information about the new fields, please refer to the patch
"PKG",136,22,1,"PAH",1,1,49,0)
      PSN*4*261. For information on how the new fields affect
"PKG",136,22,1,"PAH",1,1,50,0)
      auto-creation of possible dosages during match and re-match
"PKG",136,22,1,"PAH",1,1,51,0)
      process, refer to patch PSS*1*155.
"PKG",136,22,1,"PAH",1,1,52,0)
 
"PKG",136,22,1,"PAH",1,1,53,0)
Also, this patch adds the component $$POSDOS to the routine PSNAPIS,
"PKG",136,22,1,"PAH",1,1,54,0)
supported by Integration Control Registration (ICR) #2153, to retrieve the
"PKG",136,22,1,"PAH",1,1,55,0)
content of these 3 new fields.
"PKG",136,22,1,"PAH",1,1,56,0)
 
"PKG",136,22,1,"PAH",1,1,57,0)
In addition, a post-install routine will run to update the CREATE DEFAULT
"PKG",136,22,1,"PAH",1,1,58,0)
POSSIBLE DOSAGE field (#40) with the default value of "YES" for entries
"PKG",136,22,1,"PAH",1,1,59,0)
added to the VA PRODUCT file (#50.68) after patch PSN*4*261 was installed.
"PKG",136,22,1,"PAH",1,1,60,0)
The post-install routine will be automatically deleted from the system
"PKG",136,22,1,"PAH",1,1,61,0)
upon completion of the installation.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSN262P")
0^4^B321955^n/a
"RTN","PSN262P",1,0)
PSN262P ;BIR/MR Set missing CREATE DEFAULT POSSIBLE DOSAGE field (#40) in VA PRODUCT file (#50.68) ;06/09/10
"RTN","PSN262P",2,0)
 ;;4.0; NATIONAL DRUG FILE;**262**; 30 Oct 98;Build 6
"RTN","PSN262P",3,0)
 ;
"RTN","PSN262P",4,0)
 D BMES^XPDUTL(" Please wait...")
"RTN","PSN262P",5,0)
 ;
"RTN","PSN262P",6,0)
 N DIE,DR,DA
"RTN","PSN262P",7,0)
 S DIE="^PSNDF(50.68,",DR="40////Y"
"RTN","PSN262P",8,0)
 S DA=0 F  S DA=$O(^PSNDF(50.68,DA)) Q:'DA  D
"RTN","PSN262P",9,0)
 . I '$D(^PSNDF(50.68,+DA,0)) Q
"RTN","PSN262P",10,0)
 . I $P($G(^PSNDF(50.68,+DA,"DOS")),"^")'="" Q
"RTN","PSN262P",11,0)
 . D ^DIE
"RTN","PSN262P",12,0)
 Q
"RTN","PSNACT")
0^2^B112706557^B101592484
"RTN","PSNACT",1,0)
PSNACT ;BIR/DMA&WRT-inquiries by VAPN, CMOP ID, or NDC ; 07/02/03 14:01
"RTN","PSNACT",2,0)
 ;;4.0; NATIONAL DRUG FILE;**22,35,47,62,65,70,160,169,262**; 30 Oct 98;Build 6
"RTN","PSNACT",3,0)
 ;
"RTN","PSNACT",4,0)
 ;Reference to ^PS(50.606 supported by DBIA #2174
"RTN","PSNACT",5,0)
 ;
"RTN","PSNACT",6,0)
 I '$D(IORVON) S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","PSNACT",7,0)
 K DIC,DIR F ZXX=0:0 W ! D TEXT,ASKIT Q:$D(DIRUT)
"RTN","PSNACT",8,0)
 K QUIT,DIR,DIC,OLDDA,PROMPT,J,I,IEN,PPP,Y,Y1,Y3,Y5,Y6,Y7,Z0,Z1,Z3,Z5,Z6,Z7,ZA,ZXX,ASK,NDX,SIE,PSN,PSN1,MORE,SIE1,PMIS,QQQ,ENG,MAP,D,ANS,ZCT,DYAYGO,DUOUT,DTOUT
"RTN","PSNACT",9,0)
 Q
"RTN","PSNACT",10,0)
TEXT W !,"This option allows you to lookup NDF file information three ways (VA Product",!,"Name, NDC, or CMOP ID number).",!
"RTN","PSNACT",11,0)
 Q
"RTN","PSNACT",12,0)
ASKIT S DIR(0)="SA^VA:VA PRODUCT;N:NDC;C:CMOP ID",DIR("A")="LOOKUP BY (VA) PRODUCT, (N)DC, OR (C)MOP ID ? " D ^DIR G END:$D(DIRUT) S ASK=Y(0)
"RTN","PSNACT",13,0)
 I ASK="NDC" D NDC
"RTN","PSNACT",14,0)
 I ASK="VA PRODUCT"  D LISTNDC
"RTN","PSNACT",15,0)
 I ASK="CMOP ID" D CMOP
"RTN","PSNACT",16,0)
 Q
"RTN","PSNACT",17,0)
ENTER K QQQ N PSNELIEN,PSNELXY S (DA,PSNELIEN)=+Y,Y1=^PSNDF(50.68,DA,1),Y3=^(3),Y7=$G(^(7)),Y5=$G(^(5)),Y6=$G(^PSNDF(50.68,DA,6,1,0)),QQQ=$P(Y1,"^",5) D GCN D
"RTN","PSNACT",18,0)
 .W @IOF,!,"VA Product Name: ",$P(Y(0),"^"),$$DT($P(Y7,"^",3))
"RTN","PSNACT",19,0)
 .W !,"VA Generic Name: ",$P(^PSNDF(50.6,+$P(Y(0),"^",2),0),"^") D NDOSE(PSNELIEN)
"RTN","PSNACT",20,0)
 .W !,"National Formulary Name: ",$P(Y(0),"^",6),!,"VA Print Name: ",$P(Y1,"^"),!,"VA Product Identifier: ",$P(Y1,"^",2)," Transmit to CMOP: ",$S($P(Y1,"^",3):"Yes",1:"No")
"RTN","PSNACT",21,0)
 .W " VA Dispense Unit: ",$P($G(^PSNDF(50.64,+$P(Y1,"^",4),0)),"^")
"RTN","PSNACT",22,0)
 .W !,"PMIS: ",PMIS,!,"Active Ingredients: " S K=0 F  S K=$O(^PSNDF(50.68,PSNELIEN,2,K)) Q:'K!($G(QUIT))  S (PSNELXY,X)=^(K,0),ING=^PS(50.416,K,0) S:$P(ING,"^",2) ING=^PS(50.416,$P(ING,"^",2),0) D
"RTN","PSNACT",23,0)
 ..D:($Y+5)>IOSL&('$G(QUIT)) HANG Q:$G(QUIT)  W ?23,$P(ING,"^"),"  Strength: ",$P(PSNELXY,"^",2)," Units: ",$P($G(^PS(50.607,+$P(PSNELXY,"^",3),0)),"^"),!
"RTN","PSNACT",24,0)
 .Q:$G(QUIT)  W !,"Primary VA Drug Class: ",$P($G(^PS(50.605,+Y3,0),"Unknown"),"^"),!,"Secondary VA Drug Class: " S K=0 F  S K=$O(^PSNDF(50.68,PSNELIEN,4,K)) Q:'K  W ?26,$P($G(^PS(50.605,+K,0),"Unknown"),"^"),!
"RTN","PSNACT",25,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  W !,"CS Federal Schedule: "_$S($P($G(^PSNDF(50.68,PSNELIEN,7)),"^")]"":$P(^PSNDF(50.68,PSNELIEN,7),"^"),1:"") D EXPAN(PSNELIEN)
"RTN","PSNACT",26,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  W !,"National Formulary Indicator: " W:$P(Y5,"^")=1 "Yes" W:$P(Y5,"^")=0 "No"
"RTN","PSNACT",27,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  W !,"National Formulary Restriction: ",! D NFIP(PSNELIEN) Q:$G(QUIT)
"RTN","PSNACT",28,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  I $G(^PSNDF(50.68,PSNELIEN,8)) W !,"Exclude Drg-Drg Interaction Ck: Yes (No check for Drug-Drug Interactions)"
"RTN","PSNACT",29,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  D OVEX(PSNELIEN)
"RTN","PSNACT",30,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  D POSDOS(PSNELIEN)
"RTN","PSNACT",31,0)
 .W ! D HANG
"RTN","PSNACT",32,0)
 Q
"RTN","PSNACT",33,0)
 K DA,DIE,DIE,DIRUT,DR,ING,K,OLDDA,X,Y,Y1,Y3,Y7 Q
"RTN","PSNACT",34,0)
 ;
"RTN","PSNACT",35,0)
NDC ;OR UPN
"RTN","PSNACT",36,0)
 K PROMPT S DIR(0)="SA^N:NDC;U:UPN",DIR("A")="NDC (N) or UPN (U) ? " D ^DIR G END:$D(DIRUT) S PROMPT=Y(0)
"RTN","PSNACT",37,0)
 I PROMPT="NDC" S DIR(0)="F",DIR("A")="Enter NDC with or without Dashes (-)" D ^DIR G END:$D(DIRUT) D:X["-" PAD S DIC=50.67,DIC(0)="EQZN",D=PROMPT D IX^DIC Q:Y<0  S DA=+Y,NDF=Y(0) D LKNDC
"RTN","PSNACT",38,0)
 I PROMPT="UPN" S DIC=50.67,DIC(0)="AEQZN",DIC("A")="Select "_PROMPT_":"_" ",D=PROMPT D IX^DIC Q:Y<0  S DA=+Y,NDF=Y(0) D LKNDC
"RTN","PSNACT",39,0)
 Q
"RTN","PSNACT",40,0)
LKNDC W @IOF,!,"NDC: ",$P(NDF,"^",2),$$DT($P(NDF,"^",7)),"  UPN: ",$P(NDF,"^",3),!,"VA Product Name: ",$P(^PSNDF(50.68,$P(NDF,"^",6),0),"^"),!,"Manufacturer: ",$P($G(^PS(55.95,+$P(NDF,"^",4),0)),"^"),"  Trade Name: ",$P(NDF,"^",5),!,"Route: "
"RTN","PSNACT",41,0)
 S K=0 F  S K=$O(^PSNDF(50.67,DA,1,K)) Q:'K  W $P(^(K,0),"^")," "
"RTN","PSNACT",42,0)
 W !,"Package Size: ",$P(^PS(50.609,$P(NDF,"^",8),0),"^"),"  Package Type: ",$P(^PS(50.608,$P(NDF,"^",9),0),"^")
"RTN","PSNACT",43,0)
 S ZA=$P(NDF,"^",6) D ENTER1
"RTN","PSNACT",44,0)
 Q
"RTN","PSNACT",45,0)
END K DA,DA,DIC,DIE,DIR,DR,IN,ING,J,K,L,NEW,NDF,OLD,OLDDA,PROMPT,X,Y,Y1,Y3,Y7,^TMP($J) Q
"RTN","PSNACT",46,0)
 Q
"RTN","PSNACT",47,0)
 ;
"RTN","PSNACT",48,0)
PRODI ;INQUIRE INTO 50.68
"RTN","PSNACT",49,0)
 F  S DIC="^PSNDF(50.68,",DIC(0)="AEQM" D ^DIC Q:Y<0  S DA=+Y D EN^DIQ
"RTN","PSNACT",50,0)
 K DA,DIC,X,Y Q
"RTN","PSNACT",51,0)
 ;
"RTN","PSNACT",52,0)
NDCI ;INQUIRE INTO 50.67
"RTN","PSNACT",53,0)
 S DIR(0)="SA^N:NDC;U:UPN;T:TRADE;P:PRODUCT",DIR("A")="NDC (N), UPN (U), Trade name (T), or Product (P) " D ^DIR G END:$D(DIRUT) S PROMPT=Y(0) G LISTNDC:PROMPT["PRO",LISTNDC1:PROMPT="NDC" I PROMPT["T" S PROMPT="T"
"RTN","PSNACT",54,0)
 F  S DIC="^PSNDF(50.67,",DIC(0)="AEQZS",DIC("A")="Select "_PROMPT S:PROMPT="T" DIC("A")=DIC("A")_"rade name" S DIC("A")=DIC("A")_" ",D=PROMPT D IX^DIC Q:Y<0  S DA=+Y D EN^DIQ
"RTN","PSNACT",55,0)
 K DA,DIC,DIR,PROMPT,X,Y Q
"RTN","PSNACT",56,0)
 ;
"RTN","PSNACT",57,0)
LINK ;LINK NDCS OR UPNS
"RTN","PSNACT",58,0)
 S DIR(0)="SA^N:NDC;U:UPN",DIR("A")="NDC (N) or UPN (U) ",DIR("B")="NDC" D ^DIR G END:$D(DIRUT) S PROMPT=Y(0)
"RTN","PSNACT",59,0)
 F  Q:$D(DIRUT)!(Y<0)  S DIC=50.67,DIC(0)="AEQZ",DIC("A")="Enter Current "_PROMPT_" ",D=PROMPT D IX^DIC Q:Y<0  S DA=+Y,OLD=$P(Y(0),"^",$S(PROMPT="NDC":2,1:3)) D
"RTN","PSNACT",60,0)
 .K DIR S DIR(0)="F^"_$S(PROMPT="NDC":"12:12",1:"1:40")_"^W:$D(^PSNDF(50.67,PROMPT,X)) !!,""That "_PROMPT_" already exists"",! K:$D(^PSNDF(50.67,PROMPT,X)) X",DIR("A")="Enter a new "_PROMPT_" " D ^DIR K DIR Q:$D(DIRUT)  S NEW=Y
"RTN","PSNACT",61,0)
 .I PROMPT="NDC" D
"RTN","PSNACT",62,0)
 ..S IN=$O(^PSNDF(50.67,DA,2,"B",NEW,0)) I IN S DIR(0)="Y" W !,"Those NDCs are already linked" S DIR("A")="Do you want to unlink them " D ^DIR Q:$D(DIRUT)  Q:'Y
"RTN","PSNACT",63,0)
 ..I IN S DA(1)=DA,DA=IN,DIE="^PSNDF(50.67,"_DA(1)_",2,",DR=".01///@;" D ^DIE W !,"Unlinked",! Q
"RTN","PSNACT",64,0)
 ..I 'IN S DIE="^PSNDF(50.67,",DR="1////"_NEW D ^DIE K DD,DO S DA(1)=DA,DIC="^PSNDF(50.67,"_DA(1)_",2,",DIC(0)="L",DLAYGO=50.67,DIC("P")=$P(^DD(50.67,11,0),"^",2),X=OLD D ^DIC W !,"Linked",! Q
"RTN","PSNACT",65,0)
 .I PROMPT="UPN" D
"RTN","PSNACT",66,0)
 ..S IN=$O(^PSNDF(50.67,DA,3,"B",NEW,0)) I IN S DIR(0)="Y" W !,"Those UPNs are already linked" S DIR("A")="Do you want to unlink them " D ^DIR Q:$D(DIRUT)  Q:'Y
"RTN","PSNACT",67,0)
  ..S DA(1)=DA,DA=IN,DIE="^PSNDF(50.67,"_DA(1)_",3,",DR=".01///@;" D ^DIE W !,"Unlinked",! Q
"RTN","PSNACT",68,0)
 ..I 'IN S DIE="^PSNDF(50.67,",DR="1////"_NEW D ^DIE K DD,DO S DA(1)=DA,DIC="^PSNDF(50.67,"_DA(1)_",3,",DIC(0)="L",DLAYGO=50.67,DIC("P")=$P(^DD(50.67,12,0),"^",2),X=OLD D ^DIC W !,"Linked",! Q
"RTN","PSNACT",69,0)
 G LINK
"RTN","PSNACT",70,0)
 ;
"RTN","PSNACT",71,0)
LISTNDC ;LOOK UP NDCS BY PRODUCT
"RTN","PSNACT",72,0)
 K L,DA,^TMP($J),DIC
"RTN","PSNACT",73,0)
 S DIC=50.68,DIC(0)="AQEMZ" D ^DIC G END:Y<0 S IEN=+Y D ENTER F SIE=0:0 S SIE=$O(^PSNDF(50.68,"ANDC",IEN,SIE)) Q:'SIE!($G(QUIT))  D PRNT ; S ^TMP($J,"A"_$P(^PSNDF(50.67,SIE,0),"^",2)_"^"_SIE)=""
"RTN","PSNACT",74,0)
 Q
"RTN","PSNACT",75,0)
PRT D:($Y+5)>IOSL&('$G(QUIT)) HANG Q:$G(QUIT)  S DA=SIE,DIC="^PSNDF(50.67," W ! D EN^DIQ
"RTN","PSNACT",76,0)
 Q
"RTN","PSNACT",77,0)
 ;
"RTN","PSNACT",78,0)
LISTNDC1 ;LOOK UP PARTIAL NDC
"RTN","PSNACT",79,0)
 ;
"RTN","PSNACT",80,0)
 F  K ^TMP($J) S QUIT=0,DIR(0)="F^1:12",DIR("A")="Select NDC " D ^DIR Q:$D(DIRUT)  S PSN1=Y,PSN=Y D
"RTN","PSNACT",81,0)
 .I $D(^PSNDF(50.67,"NDC",PSN1)) S DA=0 F  S DA=$O(^PSNDF(50.67,"NDC",PSN1,DA)) S:'DA QUIT=1 Q:QUIT  S DIC="^PSNDF(50.67," W ! D EN^DIQ
"RTN","PSNACT",82,0)
 .Q:QUIT
"RTN","PSNACT",83,0)
 .I PSN1?."0".E S PSN1=PSN1_"/"
"RTN","PSNACT",84,0)
 .I PSN1?.N,PSN1=+PSN1 S PSN1=$$LJ^XLFSTR(PSN1,12,0)-1
"RTN","PSNACT",85,0)
 .S ZCT=0 F  Q:QUIT  S PSN1=$O(^PSNDF(50.67,"NDC",PSN1)),DA=0 Q:$E(PSN1,1,$L(PSN))'=PSN  F  Q:QUIT  S DA=$O(^PSNDF(50.67,"NDC",PSN1,DA)) Q:'DA  S ZCT=ZCT+1,^TMP($J,ZCT)=DA W !,$J(ZCT,5),"  ",PSN1 D
"RTN","PSNACT",86,0)
 ..S MORE=$E($O(^PSNDF(50.67,"NDC",PSN1)),1,$L(PSN))=PSN!$O(^(PSN1,DA)) I ZCT#5&MORE Q
"RTN","PSNACT",87,0)
 ..S DIR(0)="NOA^1:"_ZCT,DIR("A")="Choose 1 - "_ZCT_" or ^ to quit " S:MORE DIR("A")=DIR("A")_"or return to see more "
"RTN","PSNACT",88,0)
 ..D ^DIR I $D(DUOUT)!$D(DTOUT) S QUIT=1 Q
"RTN","PSNACT",89,0)
 ..I Y="" Q
"RTN","PSNACT",90,0)
 ..S DA=^TMP($J,Y),QUIT=1,DIC="^PSNDF(50.67," W !! D EN^DIQ Q
"RTN","PSNACT",91,0)
 G END
"RTN","PSNACT",92,0)
ENTER1 K QQQ N PSNELXEN,PSNELXA S PSNELXEN=ZA S Z0=^PSNDF(50.68,ZA,0),Z1=^PSNDF(50.68,ZA,1),Z3=^PSNDF(50.68,ZA,3),Z7=$G(^PSNDF(50.68,ZA,7)),Z5=$G(^PSNDF(50.68,ZA,5)),Z6=$G(^PSNDF(50.68,ZA,6,1,0)),QQQ=$P(Z1,"^",5) D GCN D
"RTN","PSNACT",93,0)
 .W !,"VA Product Name: ",$P(Z0,"^"),!,"VA Generic Name: ",$P(^PSNDF(50.6,+$P(Z0,"^",2),0),"^") D NDOSE(PSNELXEN)
"RTN","PSNACT",94,0)
 .W !,"National Formulary Name: ",$P(Z0,"^",6),!,"VA Print Name: ",$P(Z1,"^"),!,"VA Product Identifier: ",$P(Z1,"^",2)," Transmit to CMOP: ",$S($P(Z1,"^",3):"Yes",1:"No")
"RTN","PSNACT",95,0)
 .W " VA Dispense Unit: ",$P($G(^PSNDF(50.64,+$P(Z1,"^",4),0)),"^")
"RTN","PSNACT",96,0)
 .W !,"PMIS: ",PMIS,!,"Active Ingredients: " S K=0 F  S K=$O(^PSNDF(50.68,PSNELXEN,2,K)) Q:'K!($G(QUIT))  S (PSNELXA,X)=^(K,0),ING=^PS(50.416,K,0) S:$P(ING,"^",2) ING=^PS(50.416,$P(ING,"^",2),0) D
"RTN","PSNACT",97,0)
 ..D:($Y+5)>IOSL&('$G(QUIT)) HANG Q:$G(QUIT)  W ?23,$P(ING,"^"),"  Strength: ",$P(PSNELXA,"^",2)," Units: ",$P($G(^PS(50.607,+$P(PSNELXA,"^",3),0)),"^"),!
"RTN","PSNACT",98,0)
 .Q:$G(QUIT)  W !,"Primary VA Drug Class: ",$P($G(^PS(50.605,+Z3,0),"Unknown"),"^"),!,"Secondary VA Drug Class: " S K=0 F  S K=$O(^PSNDF(50.68,PSNELXEN,4,K)) Q:'K  W ?26,$P($G(^PS(50.605,+K,0),"Unknown"),"^"),!
"RTN","PSNACT",99,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  W !,"CS Federal Schedule: "_$S($P(Z7,"^")]"":$P(Z7,"^"),1:"") D EXPAN(PSNELXEN)
"RTN","PSNACT",100,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  W !,"National Formulary Indicator: " W:$P(Z5,"^")=1 "Yes" W:$P(Z5,"^")=0 "No"
"RTN","PSNACT",101,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  W !,"National Formulary Restriction: ",! D NFIP(PSNELXEN) Q:$G(QUIT)
"RTN","PSNACT",102,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  I $G(^PSNDF(50.68,PSNELXEN,8)) W !,"Exclude Drg-Drg Interaction Ck: Yes (No check for Drug-Drug Interactions)"
"RTN","PSNACT",103,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  D OVEX(PSNELXEN)
"RTN","PSNACT",104,0)
 .D:($Y+5)>IOSL HANG Q:$G(QUIT)  D POSDOS(PSNELXEN)
"RTN","PSNACT",105,0)
 .W ! D HANG
"RTN","PSNACT",106,0)
 Q
"RTN","PSNACT",107,0)
CMOP K DIC S DIC="^PSNDF(50.68,",DIC(0)="QEAZ",D="C",DIC("A")="CMOP ID: " D MIX^DIC1 Q:Y<0  S IEN=+Y D ENTER F SIE=0:0 S SIE=$O(^PSNDF(50.68,"ANDC",IEN,SIE)) Q:'SIE  D PRNT
"RTN","PSNACT",108,0)
 Q
"RTN","PSNACT",109,0)
HANG K DIR S DIR(0)="E",DIR("A")="Press return to continue or '^' to exit" D ^DIR W @IOF S $X=0 S:Y'=1 QUIT=1
"RTN","PSNACT",110,0)
 Q
"RTN","PSNACT",111,0)
PRNT D:($Y+5)>IOSL&('$G(QUIT)) HANG Q:$G(QUIT)
"RTN","PSNACT",112,0)
 S NDX=^PSNDF(50.67,SIE,0)
"RTN","PSNACT",113,0)
 W !!,"NDC: ",$P(NDX,"^",2),"  UPN: ",$P(NDX,"^",3),!,"VA Product Name: ",$P(^PSNDF(50.68,$P(NDX,"^",6),0),"^"),!,"Manufacturer: ",$P($G(^PS(55.95,+$P(NDX,"^",4),0)),"^"),"  Trade Name: ",$P(NDX,"^",5),!,"Route: "
"RTN","PSNACT",114,0)
 S SIE1=0 F  S SIE1=$O(^PSNDF(50.67,SIE,1,SIE1)) Q:'SIE1  W $P(^(SIE1,0),"^")
"RTN","PSNACT",115,0)
 W !,"Package Size: ",$P(^PS(50.609,$P(NDX,"^",8),0),"^"),"  Package Type: ",$P(^PS(50.608,$P(NDX,"^",9),0),"^")
"RTN","PSNACT",116,0)
 Q
"RTN","PSNACT",117,0)
PAD S ANS=Y F VV=1:1:3 S VV1=$S(VV=1:6,VV=2:4,VV=3:2) D PAD1
"RTN","PSNACT",118,0)
 S ANS=$P(ANS,"-",1)_$P(ANS,"-",2)_$P(ANS,"-",3) K VV,VV1
"RTN","PSNACT",119,0)
 S ANS=$TR(ANS,"-"),X=ANS
"RTN","PSNACT",120,0)
 Q
"RTN","PSNACT",121,0)
PAD1 I $L($P(ANS,"-",VV))<VV1 S $P(ANS,"-",VV)=$E("0000000",1,VV1-$L($P(ANS,"-",VV)))_$P(ANS,"-",VV)
"RTN","PSNACT",122,0)
 Q
"RTN","PSNACT",123,0)
DT(Y) ;Inactivation Date display
"RTN","PSNACT",124,0)
 X:Y ^DD("DD") Q $S(Y]"":IORVON_" ***INACTIVE: "_Y_" ***"_IORVOFF,1:"")
"RTN","PSNACT",125,0)
 Q
"RTN","PSNACT",126,0)
GCN I QQQ']"" S PMIS="None"
"RTN","PSNACT",127,0)
 I QQQ]"",'$D(^PS(50.623,"B",QQQ)) S PMIS="None"
"RTN","PSNACT",128,0)
 I QQQ]"",$D(^PS(50.623,"B",QQQ)) S MAP=$O(^PS(50.623,"B",QQQ,0)),ENG=$P(^PS(50.623,MAP,0),"^",2),PMIS=$P(^PS(50.621,+ENG,0),"^")
"RTN","PSNACT",129,0)
 Q
"RTN","PSNACT",130,0)
 I QQQ]"",$D(^PS(50.623,"B",QQQ)) S MAP=$O(^PS(50.623,"B",QQQ,0)),ENG=$P(^PS(50.623,MAP,0),"^",2),PMIS=$P(^PS(50.621,+ENG,0),"^")
"RTN","PSNACT",131,0)
 Q
"RTN","PSNACT",132,0)
 ;
"RTN","PSNACT",133,0)
NDOSE(PSNELXXX) ;New Dose Form/Strength/Unit display added with patch PSN*4*169
"RTN","PSNACT",134,0)
 N PSNELSTL,PSNELUNL,PSNELZER
"RTN","PSNACT",135,0)
 S PSNELZER=$G(^PSNDF(50.68,PSNELXXX,0))
"RTN","PSNACT",136,0)
 I '$P(PSNELZER,"^",3) W !,"Dose Form: "
"RTN","PSNACT",137,0)
 I $P(PSNELZER,"^",3) W !,"Dose Form: ",$P($G(^PS(50.606,+$P(PSNELZER,"^",3),0)),"^")_$S($P($G(^PS(50.606,+$P(PSNELZER,"^",3),1)),"^")=1:"  (Exclude from Dosing Cks)",1:"")
"RTN","PSNACT",138,0)
 S PSNELSTL=$L($P(PSNELZER,"^",4))
"RTN","PSNACT",139,0)
 I $P(PSNELZER,"^",5) S PSNELUNL=$L($P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^"))
"RTN","PSNACT",140,0)
 I '$P(PSNELZER,"^",5) S PSNELUNL=0
"RTN","PSNACT",141,0)
 I (PSNELSTL+PSNELUNL)<62 W !,"Strength: ",$P(PSNELZER,"^",4)," Units: ",$S($P(PSNELZER,"^",5):$P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^"),1:"") Q
"RTN","PSNACT",142,0)
 W !,"Strength: ",$P(PSNELZER,"^",4)
"RTN","PSNACT",143,0)
 W !,"Units: " I PSNELUNL<72 W $S($P(PSNELZER,"^",5):$P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^"),1:"") Q
"RTN","PSNACT",144,0)
 W !,"  "_$P($G(^PS(50.607,+$P(PSNELZER,"^",5),0)),"^")
"RTN","PSNACT",145,0)
 Q
"RTN","PSNACT",146,0)
 ;
"RTN","PSNACT",147,0)
OVEX(PSNELORX) ;New Override Dose Form display added with patch PSN*4*169
"RTN","PSNACT",148,0)
 N PSNELDFF
"RTN","PSNACT",149,0)
 W !,"Override DF Exclude from Dosage Checks: "_$S($P($G(^PSNDF(50.68,PSNELORX,9)),"^")=1:"Yes",$P($G(^PSNDF(50.68,PSNELORX,9)),"^")=0:"No",1:"") I $P($G(^PSNDF(50.68,PSNELORX,9)),"^")=1 D
"RTN","PSNACT",150,0)
 .S PSNELDFF=$P($G(^PSNDF(50.68,PSNELORX,0)),"^",3)
"RTN","PSNACT",151,0)
 .I 'PSNELDFF Q
"RTN","PSNACT",152,0)
 .I '$D(^PS(50.606,PSNELDFF,0)) Q
"RTN","PSNACT",153,0)
 .I $P($G(^PS(50.606,PSNELDFF,1)),"^")=1 W " (Dosage Checks shall be performed)" Q
"RTN","PSNACT",154,0)
 .I $P($G(^PS(50.606,PSNELDFF,1)),"^")=0 W " (No dosage checks performed)"
"RTN","PSNACT",155,0)
 Q
"RTN","PSNACT",156,0)
EXPAN(PSNELFZA) ;
"RTN","PSNACT",157,0)
 N PSNELFZB,PSNELFZC
"RTN","PSNACT",158,0)
 I $P($G(^PSNDF(50.68,PSNELFZA,7)),"^")="" Q
"RTN","PSNACT",159,0)
 S PSNELFZB=PSNELFZA_"," S PSNELFZC=$$GET1^DIQ(50.68,PSNELFZB,19)
"RTN","PSNACT",160,0)
 W "  "_$G(PSNELFZC)
"RTN","PSNACT",161,0)
 Q
"RTN","PSNACT",162,0)
NFIP(PSNELFJ) ;
"RTN","PSNACT",163,0)
 N PSNELFJZ,PSNELFJC
"RTN","PSNACT",164,0)
 S PSNELFJC=0
"RTN","PSNACT",165,0)
 F PSNELFJZ=0:0 S PSNELFJZ=$O(^PSNDF(50.68,PSNELFJ,6,PSNELFJZ)) Q:'PSNELFJZ!($G(QUIT))  D
"RTN","PSNACT",166,0)
 .I PSNELFJC W !
"RTN","PSNACT",167,0)
 .W $G(^PSNDF(50.68,PSNELFJ,6,PSNELFJZ,0))
"RTN","PSNACT",168,0)
 .S PSNELFJC=1
"RTN","PSNACT",169,0)
 .D:($Y+5)>IOSL HANG
"RTN","PSNACT",170,0)
 I '$G(QUIT),$G(PSNELFJC) W !
"RTN","PSNACT",171,0)
 Q
"RTN","PSNACT",172,0)
 ;
"RTN","PSNACT",173,0)
POSDOS(VAPRD) ; Dispaly Possible Dosage Auto-Create Setting fields
"RTN","PSNACT",174,0)
 ; Input: VAPRD - VA PRODUCT (#50.68) entry IEN
"RTN","PSNACT",175,0)
 ;
"RTN","PSNACT",176,0)
 N POSDOS Q:'$G(VAPRD)
"RTN","PSNACT",177,0)
 S POSDOS=$$POSDOS^PSNAPIS(VAPRD)
"RTN","PSNACT",178,0)
 W !!,"Auto-Create Default Possible Dosage? ",$S($P(POSDOS,"^")="Y":"Yes",1:"No")
"RTN","PSNACT",179,0)
 I $P(POSDOS,"^")="N" D
"RTN","PSNACT",180,0)
 . W !,"    Possible Dosages To Auto-Create: ",$S($P(POSDOS,"^",2)="N":"No Possible Dosages",$P(POSDOS,"^",2)="O":"1x Possible Dosage",$P(POSDOS,"^",2)="B":"1x and 2x Possible Dosages",1:"")
"RTN","PSNACT",181,0)
 . I ($P(POSDOS,"^",2)'="N") D
"RTN","PSNACT",182,0)
 . . W !,"                            Package: ",$S($P(POSDOS,"^",3)="O":"Outpatient",$P(POSDOS,"^",3)="I":"Inpatient",$P(POSDOS,"^",3)="IO":"Both Inpatient and Outpatient",1:"")
"RTN","PSNACT",183,0)
 Q
"RTN","PSNAPIS")
0^1^B46745959^B46215661
"RTN","PSNAPIS",1,0)
PSNAPIS ;BIR/DMA-APIs for NDF ; 27 Jan 2010  7:44 AM
"RTN","PSNAPIS",2,0)
 ;;4.0; NATIONAL DRUG FILE;**2,3,47,70,169,108,262**; 30 Oct 98;Build 6
"RTN","PSNAPIS",3,0)
 ;
"RTN","PSNAPIS",4,0)
 ;Reference to ^PSDRUG supported by DBIA #2192
"RTN","PSNAPIS",5,0)
 ;Reference to ^PS(50.606 supported by DBIA #2174
"RTN","PSNAPIS",6,0)
 ;
"RTN","PSNAPIS",7,0)
PSA(NDC,LIST) ;ENTRY FOR DRUG ACCOUNTABILITY
"RTN","PSNAPIS",8,0)
 N Y,PN,PN1,P50,J
"RTN","PSNAPIS",9,0)
 S Y=$Q(^PSNDF(50.67,"NDC",NDC)) I $QS(Y,3)'=NDC Q 0
"RTN","PSNAPIS",10,0)
 S Y=^PSNDF(50.67,$QS(Y,4),0),Y=$P(Y,"^",6),PN=$P(^PSNDF(50.68,Y,0),"^"),PN1=$E(PN,1,30)
"RTN","PSNAPIS",11,0)
 S P50=0,J=0 F  S P50=$O(^PSDRUG("VAPN",PN1,P50)) Q:'P50  I $P(^PSDRUG(P50,"ND"),"^",2)=PN S LIST(P50)=$P(^PSDRUG(P50,0),"^"),J=J+1
"RTN","PSNAPIS",12,0)
 Q J
"RTN","PSNAPIS",13,0)
 ;
"RTN","PSNAPIS",14,0)
PSJING(DA1,K,LIST) ;ENTRY FOR INGREDIENTS
"RTN","PSNAPIS",15,0)
 N X,CT
"RTN","PSNAPIS",16,0)
 ;DA1 IS SUPERFLUOUS, BUT WE LEAVE IN FOR COMPATABILITY
"RTN","PSNAPIS",17,0)
 I 'K!('$D(^PSNDF(50.68,+K))) Q 0
"RTN","PSNAPIS",18,0)
 S DA=0 F CT=0:1 S DA=$O(^PSNDF(50.68,K,2,DA)) Q:'DA  S X=^(DA,0),LIST(+X)=+X_"^"_$P(^PS(50.416,+X,0),"^")_"^"_$P(X,"^",2)_"^" S:$P(X,"^",3)]"" LIST(+X)=LIST(+X)_$P($G(^PS(50.607,$P(X,"^",3),0)),"^")
"RTN","PSNAPIS",19,0)
 Q CT
"RTN","PSNAPIS",20,0)
 ;
"RTN","PSNAPIS",21,0)
PSJDF(DA,K) ;GET DOSE FORM
"RTN","PSNAPIS",22,0)
 N X,DF
"RTN","PSNAPIS",23,0)
 ;AGAIN DA IS SUPERFLUOUS
"RTN","PSNAPIS",24,0)
 I 'K!('$D(^PSNDF(50.68,+K))) Q 0
"RTN","PSNAPIS",25,0)
 S X=$P(^PSNDF(50.68,K,0),"^",3),DF=$P($G(^PS(50.606,X,0)),"^")
"RTN","PSNAPIS",26,0)
 Q X_"^"_DF
"RTN","PSNAPIS",27,0)
 ;
"RTN","PSNAPIS",28,0)
PSJST(DA,K) ;ENTRY FOR STRENGTH
"RTN","PSNAPIS",29,0)
 I 'K!('$D(^PSNDF(50.68,K))) Q 0
"RTN","PSNAPIS",30,0)
 Q 1_"^"_$P(^PSNDF(50.68,K,0),"^",4)
"RTN","PSNAPIS",31,0)
 ;
"RTN","PSNAPIS",32,0)
CLASS(CL) ;ENTRY FOR OE/RR TO GET CLASS $D
"RTN","PSNAPIS",33,0)
 I CL']"" Q 0
"RTN","PSNAPIS",34,0)
 Q $D(^PS(50.605,"C",CL))>0
"RTN","PSNAPIS",35,0)
 ;
"RTN","PSNAPIS",36,0)
DRUG(DA) ;ENTRY FOR OE/RR TO GET DRUG $D
"RTN","PSNAPIS",37,0)
 I DA']"" Q 0
"RTN","PSNAPIS",38,0)
 Q $D(^PSNDF(50.6,"B",DA))!$D(^PSNDF(50.67,"T",DA))
"RTN","PSNAPIS",39,0)
 ;
"RTN","PSNAPIS",40,0)
PROD0(P1,P2) ;GET INFO IN THE FORM OF THE OLD 0 PRODUCT NODE
"RTN","PSNAPIS",41,0)
 N A,B
"RTN","PSNAPIS",42,0)
 ;P1 IS SUPERFLUOUS
"RTN","PSNAPIS",43,0)
 I P2']"" Q ""
"RTN","PSNAPIS",44,0)
 S A=$G(^PSNDF(50.68,P2,0)),B=$G(^(1))
"RTN","PSNAPIS",45,0)
 Q $P(A,"^")_"^"_$P(A,"^",3,5)_"^^^"_$P(B,"^",5,6)
"RTN","PSNAPIS",46,0)
 ;
"RTN","PSNAPIS",47,0)
PROD2(P1,P2) ;GET OLD 2 NODE
"RTN","PSNAPIS",48,0)
 ;P1 STILL SUPERFLUOUS
"RTN","PSNAPIS",49,0)
 I P2']"" Q ""
"RTN","PSNAPIS",50,0)
 Q $P($G(^PSNDF(50.68,P2,1)),"^",1,3)_"^"_$P($G(^PSNDF(50.64,+$P(^PSNDF(50.68,P2,1),"^",4),0)),"^")
"RTN","PSNAPIS",51,0)
 ;
"RTN","PSNAPIS",52,0)
DCLASS(DA,K) ;GET CLASS FOR PRODUCT
"RTN","PSNAPIS",53,0)
 I K']"" Q ""
"RTN","PSNAPIS",54,0)
 S X=+$P($G(^PSNDF(50.68,+K,3)),"^"),Y=$P($G(^PS(50.605,X,0)),"^",2)
"RTN","PSNAPIS",55,0)
 Q X_"^"_Y
"RTN","PSNAPIS",56,0)
 ;
"RTN","PSNAPIS",57,0)
DCLCODE(DA,K) ;RETURN VA CLASS CODE
"RTN","PSNAPIS",58,0)
 I K']"" Q ""
"RTN","PSNAPIS",59,0)
 S X=+$P($G(^PSNDF(50.68,+K,3)),"^"),X=$P($G(^PS(50.605,X,0)),"^")
"RTN","PSNAPIS",60,0)
 Q X
"RTN","PSNAPIS",61,0)
 ;
"RTN","PSNAPIS",62,0)
 ;DA IS SUPERFLUOUS
"RTN","PSNAPIS",63,0)
VAGN(DA) ;GET VA GENERIC NAME
"RTN","PSNAPIS",64,0)
 I 'DA!'$D(^PSNDF(50.6,+DA,0)) Q 0
"RTN","PSNAPIS",65,0)
 Q $P(^PSNDF(50.6,+DA,0),"^")
"RTN","PSNAPIS",66,0)
 ;
"RTN","PSNAPIS",67,0)
FORMI(DA,K) ;GET FORMULARY INDICATOR FOR VA PRODUCT
"RTN","PSNAPIS",68,0)
 ;DA IS SUPERFLUOUS
"RTN","PSNAPIS",69,0)
 ;1 if yes, 0 if no, null if not entered
"RTN","PSNAPIS",70,0)
 Q $P($G(^PSNDF(50.68,+K,5)),"^")
"RTN","PSNAPIS",71,0)
 ;
"RTN","PSNAPIS",72,0)
FORMR(DA,K) ;GET EXISTENCE OF FORMULARY RESTRICTIONS
"RTN","PSNAPIS",73,0)
 ;DA IS SUPERFLUOUS
"RTN","PSNAPIS",74,0)
 Q $O(^PSNDF(50.68,+K,6,0))]""
"RTN","PSNAPIS",75,0)
 ;
"RTN","PSNAPIS",76,0)
DFSU(DA,K) ;RETURN DOSE FORM, STRENGTH, AND UNITS FOR PDM AND CPRS
"RTN","PSNAPIS",77,0)
 N U1,UN
"RTN","PSNAPIS",78,0)
 I 'K!('$D(^PSNDF(50.68,+K,0))) Q 0
"RTN","PSNAPIS",79,0)
 S U1=+$P(^PSNDF(50.68,+K,0),"^",5),UN=$P($G(^PS(50.607,U1,0)),"^")
"RTN","PSNAPIS",80,0)
 Q $$PSJDF(DA,K)_"^"_$$PSJST(DA,K)_"^"_U1_"^"_UN
"RTN","PSNAPIS",81,0)
 ;
"RTN","PSNAPIS",82,0)
VAP(DA,LIST) ;GIVEN GENERIC RETURN ARRAY LIST(IEN)=IEN^PRODUCT^DF PTR^DOSE FOMR
"RTN","PSNAPIS",83,0)
 N PR,J,X
"RTN","PSNAPIS",84,0)
 I 'DA!'$D(^PSNDF(50.6,+DA)) Q 0
"RTN","PSNAPIS",85,0)
 S PR=0,J=0 F  S PR=$O(^PSNDF(50.6,"APRO",DA,PR)) Q:'PR  S X=^PSNDF(50.68,PR,0),DAT=$P($G(^(7)),"^",3) D
"RTN","PSNAPIS",86,0)
 .S LIST(PR)=PR_"^"_$P(X,"^")_"^"_$P(X,"^",3)_"^"_$P($G(^PS(50.606,+$P(X,"^",3),0)),"^")_"^"_$P(^PSNDF(50.68,PR,3),"^")_"^"_$P($G(^PS(50.605,+$P(^PSNDF(50.68,PR,3),"^"),0)),"^"),J=J+1 I DAT,(DAT<DT) S LIST(PR)=LIST(PR)_"^I"
"RTN","PSNAPIS",87,0)
 Q J
"RTN","PSNAPIS",88,0)
 ;
"RTN","PSNAPIS",89,0)
PSPT(DA,K,LIST) ;GIVEN PRODUCT K RETURN LIST(INE1^IEN2)=IEN1^PSIZE^IEN1^PTYPE
"RTN","PSNAPIS",90,0)
 N NDC,J,PT,PS
"RTN","PSNAPIS",91,0)
 ;DA SUPERFLUOUS
"RTN","PSNAPIS",92,0)
 I 'K!'$D(^PSNDF(50.68,+K)) Q 0
"RTN","PSNAPIS",93,0)
 S NDC=0 F J=0:1 S NDC=$O(^PSNDF(50.68,"ANDC",K,NDC)) Q:'NDC  S X=^PSNDF(50.67,NDC,0),PS=$P(X,"^",8),PT=$P(X,"^",9),LIST(PS_"^"_PT)=PS_"^"_$P($G(^PS(50.609,PS,0)),"^")_"^"_PT_"^"_$P($G(^PS(50.608,PT,0)),"^")
"RTN","PSNAPIS",94,0)
 Q J
"RTN","PSNAPIS",95,0)
 ;
"RTN","PSNAPIS",96,0)
DSS(DA,K,DATE) ;RETURN DSS FEEDER KEY
"RTN","PSNAPIS",97,0)
 ;NEW STYLE IF DATE IS MISSING OR NOT LESS THAN 199810
"RTN","PSNAPIS",98,0)
 ;OLD STYLE OTHERWISE
"RTN","PSNAPIS",99,0)
 S DATE=$G(DATE,999999)
"RTN","PSNAPIS",100,0)
 I DATE'<199810 Q $S($D(^PSNDF(50.68,+K)):$$RJ^XLFSTR(K,5,0),1:"00000")
"RTN","PSNAPIS",101,0)
 I $D(^PSNDF(50.6,+DA)),$D(^PSNDF(50.68,+K,7)) Q $$RJ^XLFSTR(DA,4,0)_$$RJ^XLFSTR($P(^PSNDF(50.68,+K,7),"^",9),3,0)
"RTN","PSNAPIS",102,0)
 Q "0000000"
"RTN","PSNAPIS",103,0)
 ;
"RTN","PSNAPIS",104,0)
CPRS(DA,K) ;CALL FOR CPRS
"RTN","PSNAPIS",105,0)
 N CL,X,DF,ST,UN
"RTN","PSNAPIS",106,0)
 ;RETURNS X=DOSE FORM^CLASS^STRENGTH^UNITS
"RTN","PSNAPIS",107,0)
 I '$D(^PSNDF(50.68,+K)) Q 0
"RTN","PSNAPIS",108,0)
 S CL=$P($G(^PS(50.605,+$P(^PSNDF(50.68,K,3),"^"),0)),"^")
"RTN","PSNAPIS",109,0)
 S X=^PSNDF(50.68,K,0),DF=+$P(X,"^",3),ST=$P(X,"^",4),UN=+$P(X,"^",5)
"RTN","PSNAPIS",110,0)
 Q $P($G(^PS(50.606,DF,0)),"^")_"^"_CL_"^"_ST_"^"_$P($G(^PS(50.607,UN,0)),"^")
"RTN","PSNAPIS",111,0)
 ;
"RTN","PSNAPIS",112,0)
CIRN(NDC,LIST) ;CALL FOR CIRN
"RTN","PSNAPIS",113,0)
 N DA,X,A
"RTN","PSNAPIS",114,0)
 I NDC["-" S NDC=$$RJ^XLFSTR($P(NDC,"-"),6,0)_$$RJ^XLFSTR($P(NDC,"-",2),4,0)_$$RJ^XLFSTR($P(NDC,"-",3),2,0)
"RTN","PSNAPIS",115,0)
 K LIST S LIST="000000000000" F J=1:1:7 S LIST(J)=""
"RTN","PSNAPIS",116,0)
 S DA=$O(^PSNDF(50.67,"NDC",NDC,0)) Q:'DA  S X=^PSNDF(50.67,DA,0),LIST(7)=$P(X,"^",2)_"^"_$P(X,"^",4,6)_"^",A=0 F  S A=$O(^PSNDF(50.67,DA,1,A)) Q:'A  S LIST(7)=LIST(7)_^(A,0)_" "
"RTN","PSNAPIS",117,0)
 S LIST(6)=$P(X,"^",9),LIST(5)=$P(X,"^",8),A=$P(X,"^",6),X=^PSNDF(50.68,A,0)
"RTN","PSNAPIS",118,0)
  S LIST(2)=$P(X,"^",3)_"^^"_$P(^PSNDF(50.68,A,3),"^"),LIST(3)=$P(X,"^",4),LIST(4)=$P(X,"^",5)
"RTN","PSNAPIS",119,0)
 S LIST(0)=$P(X,"^",2),LIST(1)=^PSNDF(50.6,$P(X,"^",2),0),LIST=NDC
"RTN","PSNAPIS",120,0)
 F J=1:1:7 I LIST(J)="NO DATA" S LIST(J)=""
"RTN","PSNAPIS",121,0)
 Q
"RTN","PSNAPIS",122,0)
 ;
"RTN","PSNAPIS",123,0)
B() ;RETURNS THE GLOBAL ROOT OF THE "B" CROSSREFERENCE IN NDF
"RTN","PSNAPIS",124,0)
 Q "^PSNDF(50.6,""B"")"
"RTN","PSNAPIS",125,0)
 ;
"RTN","PSNAPIS",126,0)
T() ;RETURNS THE GLOBAL ROOT OF THE "T" CROSSREFERENCE IN NDF
"RTN","PSNAPIS",127,0)
 Q "^PSNDF(50.67,""T"")"
"RTN","PSNAPIS",128,0)
 ;
"RTN","PSNAPIS",129,0)
TTOG(TRADE,LIST) ;RETURNS LIST(IEN)=IEN_"^"GENERIC FOR EVERY ENTRY IN 50.6 WHICH MATCHES THE TRADE NAME
"RTN","PSNAPIS",130,0)
 I TRADE="" Q 0
"RTN","PSNAPIS",131,0)
 N X,CT
"RTN","PSNAPIS",132,0)
 I '$O(^PSNDF(50.67,"T",TRADE,0)) Q 0
"RTN","PSNAPIS",133,0)
 S (X,CT)=0 F  S X=$O(^PSNDF(50.67,"T",TRADE,X)) Q:'X  S Y=$P(^PSNDF(50.67,X,0),"^",6),Y=$P(^PSNDF(50.68,Y,0),"^",2) I '$D(LIST(Y)) S LIST(Y)=Y_"^"_$P(^PSNDF(50.6,Y,0),"^"),CT=CT+1
"RTN","PSNAPIS",134,0)
 Q CT
"RTN","PSNAPIS",135,0)
 ;
"RTN","PSNAPIS",136,0)
CLIST(DA,LIST) ;RETURNS LIST(IEN)=IEN IN 50.605^CLASS CODE
"RTN","PSNAPIS",137,0)
 ;FOR EVERY CLASS IN PSNDF(50.6,DA)
"RTN","PSNAPIS",138,0)
 I 'DA Q 0
"RTN","PSNAPIS",139,0)
 I '$D(^PSNDF(50.6,+DA)) Q 0
"RTN","PSNAPIS",140,0)
 N K,CT S (K,CT)=0 F  S K=$O(^PSNDF(50.6,"APRO",DA,K)) Q:'K  S IEN=$P(^PSNDF(50.68,K,3),"^") I '$D(LIST(IEN)) S LIST(IEN)=IEN_"^"_$P(^PS(50.605,IEN,0),"^"),CT=CT+1
"RTN","PSNAPIS",141,0)
 Q CT
"RTN","PSNAPIS",142,0)
 ;
"RTN","PSNAPIS",143,0)
TGTOG(NAME) ;GIVEN NAME TRY TO FIND IT IN T OR B CROSS REFERENCE AND RETURN IEN
"RTN","PSNAPIS",144,0)
 N X
"RTN","PSNAPIS",145,0)
 I NAME="" Q 0
"RTN","PSNAPIS",146,0)
 S X=$O(^PSNDF(50.6,"B",NAME,0)) I X Q X
"RTN","PSNAPIS",147,0)
 I '$O(^PSNDF(50.67,"T",NAME,0)) Q 0
"RTN","PSNAPIS",148,0)
 S X=$O(^PSNDF(50.67,"T",NAME,0)),X=$P(^PSNDF(50.67,X,0),"^",6),X=$P(^PSNDF(50.68,X,0),"^",2) Q X
"RTN","PSNAPIS",149,0)
 ;
"RTN","PSNAPIS",150,0)
TGTOG2(NAME,LIST) ;PARTIAL LOOKUP ON T OR B
"RTN","PSNAPIS",151,0)
 I NAME="" Q
"RTN","PSNAPIS",152,0)
 N NAM,X,Y,CT
"RTN","PSNAPIS",153,0)
 S CT=0
"RTN","PSNAPIS",154,0)
 S NAM=$E(NAME,1,$L(NAME)-1)_$C($A($E(NAME,$L(NAME)))-1)_"z" F  S NAM=$O(^PSNDF(50.6,"B",NAM)),X=0 Q:NAM'[NAME  F  S X=$O(^PSNDF(50.6,"B",NAM,X)) Q:'X  S LIST(X)=X_"^"_$P(^PSNDF(50.6,X,0),"^"),CT=CT+1
"RTN","PSNAPIS",155,0)
 S NAM=$E(NAME,1,$L(NAME)-1)_$C($A($E(NAME,$L(NAME)))-1)_"z" F  S NAM=$O(^PSNDF(50.67,"T",NAM)),X=0 Q:NAM'[NAME  F  S X=$O(^PSNDF(50.67,"T",NAM,X)) Q:'X  S Y=$P(^PSNDF(50.67,X,0),"^",6),Y=$P(^PSNDF(50.68,Y,0),"^",2) D
"RTN","PSNAPIS",156,0)
 .I '$D(LIST(Y)) S LIST(Y)=Y_"^"_$P(^PSNDF(50.6,Y,0),"^"),CT=CT+1
"RTN","PSNAPIS",157,0)
 Q CT
"RTN","PSNAPIS",158,0)
 ;
"RTN","PSNAPIS",159,0)
CIRN2(P1,P3,LIST) ;RETURN LIST OF NDCS FOR A PRODUCT
"RTN","PSNAPIS",160,0)
 I 'P3 Q 0
"RTN","PSNAPIS",161,0)
 I '$D(^PSNDF(50.68,+P3)) Q 0
"RTN","PSNAPIS",162,0)
 N D,N,J
"RTN","PSNAPIS",163,0)
 S N=0
"RTN","PSNAPIS",164,0)
 F J=0:1 S N=$O(^PSNDF(50.68,"ANDC",P3,N)) Q:'N  S LIST(J)=$P(^PSNDF(50.67,N,0),"^",2)
"RTN","PSNAPIS",165,0)
 Q J
"RTN","PSNAPIS",166,0)
 ;
"RTN","PSNAPIS",167,0)
CLASS2(IEN) ;RETURNS FIRST 2 PIECES OF ZERO NODE OF 50.605
"RTN","PSNAPIS",168,0)
 Q $P($G(^PS(50.605,+IEN,0)),"^",1,2)
"RTN","PSNAPIS",169,0)
 ;
"RTN","PSNAPIS",170,0)
CMOP(CODE) ;CODE = 5 CHARACTER CMOP CODE RETURNS PRODUCT NAME
"RTN","PSNAPIS",171,0)
 I CODE="" Q ""
"RTN","PSNAPIS",172,0)
 I '$O(^PSNDF(50.68,"C",CODE,0)) Q ""
"RTN","PSNAPIS",173,0)
 Q $P(^PSNDF(50.68,+$O(^PSNDF(50.68,"C",CODE,0)),0),"^")
"RTN","PSNAPIS",174,0)
 ;
"RTN","PSNAPIS",175,0)
FORMRX(DA,K,LIST) ;RETURN X=1 FOR RESTRICTIONS, 0 FOR NO
"RTN","PSNAPIS",176,0)
 ;RETURNS LIST=WORD PROCESSING FIELD FOR RESTRICTIONS
"RTN","PSNAPIS",177,0)
 ;
"RTN","PSNAPIS",178,0)
 I '$O(^PSNDF(50.68,+K,6,0)) Q 0
"RTN","PSNAPIS",179,0)
 M LIST=^PSNDF(50.68,+K,6) Q 1
"RTN","PSNAPIS",180,0)
 ;
"RTN","PSNAPIS",181,0)
DDIEX(DA,K) ;RETURN X=1 FOR EXCLUDE DDI CHECK, 0 FOR CONTINUE DDI CHECK
"RTN","PSNAPIS",182,0)
 ;
"RTN","PSNAPIS",183,0)
 I '$G(^PSNDF(50.68,+K,8)) Q 0
"RTN","PSNAPIS",184,0)
 I $G(^PSNDF(50.68,+K,8)) Q 1
"RTN","PSNAPIS",185,0)
 ;
"RTN","PSNAPIS",186,0)
OVRIDE(PSNPOV1,PSNPOV3) ;Return Override Dose Form Exclusion
"RTN","PSNAPIS",187,0)
 I '$G(PSNPOV3) Q ""
"RTN","PSNAPIS",188,0)
 Q $P($G(^PSNDF(50.68,+PSNPOV3,9)),"^")
"RTN","PSNAPIS",189,0)
 ;
"RTN","PSNAPIS",190,0)
FDAMG(IEN) ;RETURN URL FOR MED GUIDE OR NULL
"RTN","PSNAPIS",191,0)
 Q $P($G(^PSNDF(50.68,IEN,"MG")),"^")
"RTN","PSNAPIS",192,0)
 ;
"RTN","PSNAPIS",193,0)
POSDOS(IEN) ; Return Possible Dosage Auto-Creation Related fields
"RTN","PSNAPIS",194,0)
 ; Input: IEN - VA Product (#50.68) IEN
"RTN","PSNAPIS",195,0)
 ;Output: Possible Dosage Creation field (separated by "^")
"RTN","PSNAPIS",196,0)
 ;           1. CREATE DEFAULT POSSIBLE DOSAGE (Y/N) - Field #40
"RTN","PSNAPIS",197,0)
 ;           2. POSSIBLE DOSAGES TO CREATE (N/O/B) - Field #41
"RTN","PSNAPIS",198,0)
 ;           3. PACKAGE (I/O/IO) - Field #42
"RTN","PSNAPIS",199,0)
 ;
"RTN","PSNAPIS",200,0)
 Q $G(^PSNDF(50.68,IEN,"DOS"))
"RTN","PSNAPIS",201,0)
 ;
"RTN","PSNLOOK")
0^3^B48511720^B48278618
"RTN","PSNLOOK",1,0)
PSNLOOK ;BIR/WRT-Look up into drug file ; 06/19/03 15:00
"RTN","PSNLOOK",2,0)
 ;;4.0; NATIONAL DRUG FILE;**2,3,5,11,22,27,62,70,169,262**; 30 Oct 98;Build 6
"RTN","PSNLOOK",3,0)
 ;
"RTN","PSNLOOK",4,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192
"RTN","PSNLOOK",5,0)
 ; Reference to ^PS(50.606 supported by DBIA# 2174
"RTN","PSNLOOK",6,0)
 ;
"RTN","PSNLOOK",7,0)
 ;USE PSNLK*
"RTN","PSNLOOK",8,0)
BEGIN ;
"RTN","PSNLOOK",9,0)
 D ASK
"RTN","PSNLOOK",10,0)
 N PSNLKDA,PSNLKIND,PSNLKCL,PSNLKNOD,PSNLKVPN,PSNLKID,PSNLKVDU,PSNLKTR,PSNLKDAV,PSNLKGK,PSNLKPMI,PSNLKQQ,DIC,X,Y,DLAYGO,DTOUT,DUOUT,DIR,DIRUT,DIROUT,%DT
"RTN","PSNLOOK",11,0)
 N PSNLKMAP,PSNLKENG,PSNLKDF,PSNLKSTR,PSNLKUN,PSNLKFRM,PSNLKUNT,PSNLKNFN,PSNLKBB,PSNLKAND,PSNLKGR,PSNLKIST,PSNLKIUT,PSNLKSEV,PSNLKCSF,PSNLKSP,PSNLKNND,PSNLKCC,PSNLKSCL,PSNLKZ,PSNLKRE,PSNLKWRT,PSNZZFS
"RTN","PSNLOOK",12,0)
 N PSNLKL1,PSNLKL2,PSNLKIUN,PSNZZFSA
"RTN","PSNLOOK",13,0)
SELD ;Select Drug
"RTN","PSNLOOK",14,0)
 K PSNLKDA,PSNLKIND,PSNLKCL,PSNLKNOD,PSNLKVPN,PSNLKID,PSNLKVDU,PSNLKTR,PSNLKDAV,PSNLKGK,PSNLKPMI,PSNLKQQ,DIC,X,Y,DLAYGO,DTOUT,DUOUT,DIR,DIRUT,DIROUT,%DT
"RTN","PSNLOOK",15,0)
 K PSNLKMAP,PSNLKENG,PSNLKDF,PSNLKSTR,PSNLKUN,PSNLKFRM,PSNLKUNT,PSNLKNFN,PSNLKBB,PSNLKAND,PSNLKGR,PSNLKIST,PSNLKIUT,PSNLKSEV,PSNLKCSF,PSNLKSP,PSNLKNND,PSNLKCC,PSNLKSCL,PSNLKZ,PSNLKRE,PSNLKWRT,PSNZZFS
"RTN","PSNLOOK",16,0)
 K PSNLKL1,PSNLKL2,PSNLKIUN,PSNZZFSA
"RTN","PSNLOOK",17,0)
 W ! K DIC S DIC=50,DIC(0)="QEAM" D ^DIC I Y<0!($D(DTOUT))!($D(DUOUT)) Q
"RTN","PSNLOOK",18,0)
 S PSNLKDA=+Y K Y
"RTN","PSNLOOK",19,0)
 S PSNLKIND=$P($G(^PSDRUG(PSNLKDA,"I")),"^") I PSNLKIND,PSNLKIND<DT  S Y=PSNLKIND D DD^%DT W !!,"This drug has an Inactive date of "_$G(Y),! D MESS G SELD
"RTN","PSNLOOK",20,0)
 D DSPLY
"RTN","PSNLOOK",21,0)
 D HG
"RTN","PSNLOOK",22,0)
 G SELD
"RTN","PSNLOOK",23,0)
 ;
"RTN","PSNLOOK",24,0)
ASK W !!,"This option will allow you to look up entries in your local DRUG file. It will",!,"display National Drug File software match information.",!
"RTN","PSNLOOK",25,0)
 Q
"RTN","PSNLOOK",26,0)
DSPLY W @IOF W !?14,"DRUG Generic Name:  ",$P($G(^PSDRUG(PSNLKDA,0)),"^") I $D(^PSDRUG(PSNLKDA,"ND")) S PSNLKCL=$P(^("ND"),"^",6)
"RTN","PSNLOOK",27,0)
 I $D(^PSDRUG(PSNLKDA,"ND")),$P(^PSDRUG(PSNLKDA,"ND"),"^",2)]"" S PSNLKNOD=^PSDRUG(PSNLKDA,"ND") D DSPLY1,DSPLY2,PRODF,DSP,ING,SV,DSP1,RESTN Q
"RTN","PSNLOOK",28,0)
 W !?8,"*** NO NATIONAL DRUG FILE INFORMATION ***",!
"RTN","PSNLOOK",29,0)
 Q
"RTN","PSNLOOK",30,0)
DSPLY1 W !?5,"VA Product Name: ",$P(PSNLKNOD,"^",2)
"RTN","PSNLOOK",31,0)
 W !?5,"VA Generic Name: ",$P($G(^PSNDF(50.6,$P(PSNLKNOD,"^"),0)),"^")
"RTN","PSNLOOK",32,0)
 Q
"RTN","PSNLOOK",33,0)
DSPLY2 ;
"RTN","PSNLOOK",34,0)
 S (PSNLKVPN,PSNLKID,PSNLKVDU,PSNLKTR)=""
"RTN","PSNLOOK",35,0)
 K X S PSNLKDAV=$P(PSNLKNOD,"^"),PSNLKGK=$P(PSNLKNOD,"^",3),X=$$PROD2^PSNAPIS(PSNLKDAV,PSNLKGK) I $P(X,"^")]"" S PSNLKVPN=$P(X,"^"),PSNLKID=$P(X,"^",2),PSNLKTR=$P(X,"^",3),PSNLKVDU=$P(X,"^",4)
"RTN","PSNLOOK",36,0)
 K PSNLKPMI I X]"" S PSNLKQQ=$P(^PSNDF(50.68,PSNLKGK,1),"^",5) D GCN
"RTN","PSNLOOK",37,0)
 K X
"RTN","PSNLOOK",38,0)
 Q
"RTN","PSNLOOK",39,0)
GCN I PSNLKQQ']"" S PSNLKPMI="None" Q
"RTN","PSNLOOK",40,0)
 ;
"RTN","PSNLOOK",41,0)
GCN1 ; 
"RTN","PSNLOOK",42,0)
 I $D(^PS(50.623,"B",PSNLKQQ)) S PSNLKMAP=$O(^PS(50.623,"B",PSNLKQQ,0)),PSNLKENG=$P(^PS(50.623,PSNLKMAP,0),"^",2),PSNLKPMI=$P(^PS(50.621,+PSNLKENG,0),"^") Q
"RTN","PSNLOOK",43,0)
 S PSNLKPMI="None"
"RTN","PSNLOOK",44,0)
 Q
"RTN","PSNLOOK",45,0)
DSPLY3 W ?50,"Transmit To CMOP: "
"RTN","PSNLOOK",46,0)
 I PSNLKTR=1 W "YES"
"RTN","PSNLOOK",47,0)
 I PSNLKTR=0 W "NO"
"RTN","PSNLOOK",48,0)
 Q
"RTN","PSNLOOK",49,0)
PRODF ;
"RTN","PSNLOOK",50,0)
 S X=$$PROD0^PSNAPIS(PSNLKDAV,PSNLKGK)
"RTN","PSNLOOK",51,0)
 S PSNLKDF=+$P(X,"^",2),PSNLKSTR=$P(X,"^",3),PSNLKUN=+$P(X,"^",4),PSNLKFRM=$S($G(PSNLKDF):$P($G(^PS(50.606,PSNLKDF,0)),"^"),1:""),PSNLKUNT=$S($G(PSNLKUN):$P($G(^PS(50.607,PSNLKUN,0)),"^"),1:""),PSNLKNFN=$P(^PSNDF(50.68,PSNLKGK,0),"^",6)
"RTN","PSNLOOK",52,0)
 K X
"RTN","PSNLOOK",53,0)
 Q
"RTN","PSNLOOK",54,0)
ING F PSNLKBB=0:0 S PSNLKBB=$O(^PSNDF(50.68,PSNLKGK,2,PSNLKBB)) Q:'PSNLKBB  D
"RTN","PSNLOOK",55,0)
 .I $D(^PSNDF(50.68,PSNLKGK,2,PSNLKBB,0)) S PSNLKAND=$G(^PSNDF(50.68,PSNLKGK,2,PSNLKBB,0)),PSNLKGR=$P(^PS(50.416,$P(PSNLKAND,"^",1),0),"^"),PSNLKIST=$P(PSNLKAND,"^",2),PSNLKIUT=$P(PSNLKAND,"^",3) K PSNLKIUN D ING1,IN2
"RTN","PSNLOOK",56,0)
 Q
"RTN","PSNLOOK",57,0)
IN2 W ?3,PSNLKGR,?50,"Str: ",PSNLKIST W:PSNLKIUT ?65,"Unt: ",$G(PSNLKIUN) W !
"RTN","PSNLOOK",58,0)
 Q
"RTN","PSNLOOK",59,0)
ING1 S:$P(^PS(50.416,$P(PSNLKAND,"^"),0),"^",2) PSNLKGR=$P($G(^PS(50.416,$P(^PS(50.416,$P(PSNLKAND,"^"),0),"^",2),0)),"^") I PSNLKIUT S PSNLKIUN=$P(^PS(50.607,PSNLKIUT,0),"^")
"RTN","PSNLOOK",60,0)
 Q
"RTN","PSNLOOK",61,0)
SC I $O(^PSNDF(50.68,PSNLKGK,4,0)) W !,"Secondary Class(es): ",! F PSNLKCC=0:0 S PSNLKCC=$O(^PSNDF(50.68,PSNLKGK,4,PSNLKCC)) Q:'PSNLKCC  S PSNLKZ=$P($G(^PSNDF(50.68,PSNLKGK,4,PSNLKCC,0)),"^") I PSNLKZ D
"RTN","PSNLOOK",62,0)
 .S PSNLKSCL=$P($G(^PS(50.605,PSNLKZ,0)),"^") D SC1
"RTN","PSNLOOK",63,0)
 Q
"RTN","PSNLOOK",64,0)
SC1 W "   ",PSNLKSCL
"RTN","PSNLOOK",65,0)
 Q
"RTN","PSNLOOK",66,0)
SV S PSNLKSEV=$G(^PSNDF(50.68,PSNLKGK,7)) I PSNLKSEV]"" S PSNLKCSF=$P(PSNLKSEV,"^"),PSNLKSP=$P(PSNLKSEV,"^",2) S:PSNLKSP="M" PSNLKSP="Multi" S:PSNLKSP="S" PSNLKSP="Single" D SV1
"RTN","PSNLOOK",67,0)
 Q
"RTN","PSNLOOK",68,0)
SV1 S PSNZZFSA=PSNLKGK_"," S PSNZZFS=$$GET1^DIQ(50.68,PSNZZFSA,19) I $G(PSNZZFS)="" S PSNZZFS="None"
"RTN","PSNLOOK",69,0)
 S PSNLKNND=$P(^PSNDF(50.68,PSNLKGK,7),"^",3)
"RTN","PSNLOOK",70,0)
 Q
"RTN","PSNLOOK",71,0)
DSP W !,"Dosage Form: ",PSNLKFRM_$S('$G(PSNLKDF):"",$P($G(^PS(50.606,PSNLKDF,1)),"^")=1:"  (Exclude from Dosing Cks)",1:"")
"RTN","PSNLOOK",72,0)
 S PSNLKL1=$L(PSNLKSTR),PSNLKL2=$S($G(PSNLKUN):$L(PSNLKUNT),1:0)
"RTN","PSNLOOK",73,0)
 I (PSNLKL1+PSNLKL2)<62 W !,"Strength: ",PSNLKSTR W:$G(PSNLKUN) " Units: "_PSNLKUNT G PSDZZ
"RTN","PSNLOOK",74,0)
 W !,"Strength: ",PSNLKSTR
"RTN","PSNLOOK",75,0)
 I $G(PSNLKUN) D
"RTN","PSNLOOK",76,0)
 .W !,"Units: " I PSNLKL2<72 W PSNLKUNT Q
"RTN","PSNLOOK",77,0)
 .W !,PSNLKUNT
"RTN","PSNLOOK",78,0)
PSDZZ ;
"RTN","PSNLOOK",79,0)
 W !,"National Formulary Name: ",PSNLKNFN,!,"VA Print Name: ",PSNLKVPN,!,"VA Product Identifier: ",PSNLKID D DSPLY3 W !,"VA Dispense Unit: ",PSNLKVDU I $D(PSNLKPMI) W !,"PMIS: ",PSNLKPMI
"RTN","PSNLOOK",80,0)
 W !,"Active Ingredients: ",!
"RTN","PSNLOOK",81,0)
 Q
"RTN","PSNLOOK",82,0)
DSP1 D HG W "Primary Drug Class: ",$P(^PS(50.605,PSNLKCL,0),"^") D SC W !,"CS Federal Schedule: ",$G(PSNLKCSF)_"  "_$G(PSNZZFS),!,"Single/Multi Source Product: ",$G(PSNLKSP)
"RTN","PSNLOOK",83,0)
 I $G(PSNLKNND)]"" W !,"Inactivation Date: " S Y=PSNLKNND D DD^%DT W Y K Y
"RTN","PSNLOOK",84,0)
 W !,"Max Single Dose: ",$P(PSNLKSEV,"^",4),?45,"Min Single Dose: ",$P(PSNLKSEV,"^",5)
"RTN","PSNLOOK",85,0)
 W !,"Max Daily Dose: ",$P(PSNLKSEV,"^",6),?45,"Min Daily Dose: ",$P(PSNLKSEV,"^",7),!,"Max Cumulative Dose: ",$P(PSNLKSEV,"^",8)
"RTN","PSNLOOK",86,0)
 W !,"National Formulary Indicator: " I $D(^PSNDF(50.68,PSNLKGK,5)) W:$P(^PSNDF(50.68,PSNLKGK,5),"^")=0 "No" W:$P(^PSNDF(50.68,PSNLKGK,5),"^")=1 "Yes"
"RTN","PSNLOOK",87,0)
 W !
"RTN","PSNLOOK",88,0)
 I $G(^PSNDF(50.68,PSNLKGK,8)) W !,"Exclude Drg-Drg Interaction Ck: Yes (No check for Drug-Drug Interactions)"
"RTN","PSNLOOK",89,0)
 D OVER
"RTN","PSNLOOK",90,0)
 D POSDOS^PSNACT(PSNLKGK)
"RTN","PSNLOOK",91,0)
 W !
"RTN","PSNLOOK",92,0)
 Q
"RTN","PSNLOOK",93,0)
RESTN I $O(^PSNDF(50.68,PSNLKGK,6,0)) W !,"Restriction: " F PSNLKRE=0:0 S PSNLKRE=$O(^PSNDF(50.68,PSNLKGK,6,PSNLKRE)) Q:'PSNLKRE  S PSNLKWRT=$G(^PSNDF(50.68,PSNLKGK,6,PSNLKRE,0)) W !,PSNLKWRT
"RTN","PSNLOOK",94,0)
 Q
"RTN","PSNLOOK",95,0)
HG ;
"RTN","PSNLOOK",96,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSNLOOK",97,0)
 W @IOF
"RTN","PSNLOOK",98,0)
 Q
"RTN","PSNLOOK",99,0)
MESS ;
"RTN","PSNLOOK",100,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSNLOOK",101,0)
 Q
"RTN","PSNLOOK",102,0)
 ;
"RTN","PSNLOOK",103,0)
OVER ;
"RTN","PSNLOOK",104,0)
 W !,"Override DF Exclude from Dosage Checks: "_$S($P($G(^PSNDF(50.68,PSNLKGK,9)),"^")=1:"Yes",$P($G(^PSNDF(50.68,PSNLKGK,9)),"^")=0:"No",1:"") I $P($G(^PSNDF(50.68,PSNLKGK,9)),"^")=1 D
"RTN","PSNLOOK",105,0)
 .I '$G(PSNLKDF) Q
"RTN","PSNLOOK",106,0)
 .I '$D(^PS(50.606,PSNLKDF,0)) Q
"RTN","PSNLOOK",107,0)
 .I $P($G(^PS(50.606,PSNLKDF,1)),"^")=1 W " (Dosage Checks shall be performed)" Q
"RTN","PSNLOOK",108,0)
 .I $P($G(^PS(50.606,PSNLKDF,1)),"^")=0 W " (No Dosage Checks performed)"
"RTN","PSNLOOK",109,0)
 Q
"VER")
8.0^22.0
"BLD",7113,6)
^269
**END**
**END**
