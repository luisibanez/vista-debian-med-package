Released PSJ*5*267 SEQ #232
Extracted from mail message
**KIDS**:PSJ*5.0*267^

**INSTALL NAME**
PSJ*5.0*267
"BLD",8210,0)
PSJ*5.0*267^INPATIENT MEDICATIONS^0^3120809^y
"BLD",8210,1,0)
^^378^378^3120809^
"BLD",8210,1,1,0)
******************************* WARNING **********************************
"BLD",8210,1,2,0)
 
"BLD",8210,1,3,0)
If your facility has the Pyxis/Omnicell/McKesson interface from ILC this
"BLD",8210,1,4,0)
patch will overwrite any local modifications in routines PSJOEA2, PSGOEE, 
"BLD",8210,1,5,0)
PSGOETO, and PSGOEV. This could affect certain orders being sent across
"BLD",8210,1,6,0)
this interface. The modifications will have to be reintroduced following
"BLD",8210,1,7,0)
installation of this patch.
"BLD",8210,1,8,0)
 
"BLD",8210,1,9,0)
**************************************************************************
"BLD",8210,1,10,0)
******************************* ATTENTION ********************************
"BLD",8210,1,11,0)
 
"BLD",8210,1,12,0)
                          PSB*3*68 and PSS*1*171
"BLD",8210,1,13,0)
 
"BLD",8210,1,14,0)
This patch (PSJ*5*267) should be installed before PSS*1*171 in order to
"BLD",8210,1,15,0)
activate the NO ALLERGY ASSESSMENT enhancement. The NO ALLERGY ASSESSMENT
"BLD",8210,1,16,0)
enhancement will not be fully activated until patch PSS*1*171 and 
"BLD",8210,1,17,0)
PSJ*5*267 are both installed.
"BLD",8210,1,18,0)
 
"BLD",8210,1,19,0)
This patch (PSJ*5*267) should be installed with PSB*3*68 in order to
"BLD",8210,1,20,0)
activate the UNLIMITED SI/OPI enhancement in BCMA. This patch (PSJ*5*267)
"BLD",8210,1,21,0)
is required by PSB*3*68 and must be installed after PSB*3*68.
"BLD",8210,1,22,0)
 
"BLD",8210,1,23,0)
************************************************************************* 
"BLD",8210,1,24,0)
 
"BLD",8210,1,25,0)
Enhancements
"BLD",8210,1,26,0)
=====================
"BLD",8210,1,27,0)
 
"BLD",8210,1,28,0)
1. Special Instructions/Other Print Info
"BLD",8210,1,29,0)
 ________________________________________
"BLD",8210,1,30,0)
 With this enhancement, Special Instructions and Other Print Info have
"BLD",8210,1,31,0)
 been modified to support an unlimited amount of text. The existing
"BLD",8210,1,32,0)
 functionality that copies the provider comments from the Computerized
"BLD",8210,1,33,0)
 Patient Record System (CPRS) to be copied into each field has been
"BLD",8210,1,34,0)
<=======T=======T=======T=======T=======T=======T=======T=======T=======T>
"BLD",8210,1,35,0)
======
"BLD",8210,1,36,0)
 
"BLD",8210,1,37,0)
 
"BLD",8210,1,38,0)
 
"BLD",8210,1,39,0)
 
"BLD",8210,1,40,0)
 
"BLD",8210,1,41,0)
 
"BLD",8210,1,42,0)
 
"BLD",8210,1,43,0)
 
"BLD",8210,1,44,0)
 
"BLD",8210,1,45,0)
                    editing MESSAGE TEXT
"BLD",8210,1,46,0)
 
"BLD",8210,1,47,0)
Do you want to copy a packman message into the Message Text? No// 
"BLD",8210,1,48,0)
 
"BLD",8210,1,49,0)
  MESSAGE TEXT:. . .
"BLD",8210,1,50,0)
       . . .
"BLD",8210,1,51,0)
"^DD",53.45,53.456,0,"NM","OTHER PRINT INFO")
"BLD",8210,1,52,0)
 
"BLD",8210,1,53,0)
"^DD",53.45,53.456,0,"UP")
"BLD",8210,1,54,0)
53.45
"BLD",8210,1,55,0)
"^DD",53.45,53.456,.01,0)
"BLD",8210,1,56,0)
OTHER PRINT INFO (LONG)^WLx^^0;1^Q
"BLD",8210,1,57,0)
"^DD",53.45,53.456,.01,"DT")
"BLD",8210,1,58,0)
3111104
"BLD",8210,1,59,0)
  
"BLD",8210,1,60,0)
 
"BLD",8210,1,61,0)
    Edit? NO// 
"BLD",8210,1,62,0)
Select ROUTINE NAME: PSGOTR// ^
"BLD",8210,1,63,0)
 
"BLD",8210,1,64,0)
Select PATCH: 
"BLD",8210,1,65,0)
 
"BLD",8210,1,66,0)
You have 402 new messages.  (Last arrival: 07/06/12@08:11)
"BLD",8210,1,67,0)
 
"BLD",8210,1,68,0)
You've got PRIORITY mail!
"BLD",8210,1,69,0)
 
"BLD",8210,1,70,0)
 
"BLD",8210,1,71,0)
Select Developer's Menu Option: ^DISPLAY A PATch
"BLD",8210,1,72,0)
 
"BLD",8210,1,73,0)
Select PATCH: PSJ*%*267 ??
"BLD",8210,1,74,0)
 
"BLD",8210,1,75,0)
Select PATCH: PSj*5*267    IMR4 NO ALLERGY ASSESSMENT, UNLIMITED LENGTH 
"BLD",8210,1,76,0)
UND JCH
"BLD",8210,1,77,0)
 
"BLD",8210,1,78,0)
DEVICE: HOME//   SSH VIRTUAL TERMINAL
"BLD",8210,1,79,0)
 
"BLD",8210,1,80,0)
 
"BLD",8210,1,81,0)
 
"BLD",8210,1,82,0)
 
"BLD",8210,1,83,0)
 
"BLD",8210,1,84,0)
 
"BLD",8210,1,85,0)
 
"BLD",8210,1,86,0)
 
"BLD",8210,1,87,0)
VistA Patch Display                                                   
"BLD",8210,1,88,0)
Page: 1
"BLD",8210,1,89,0)
==========================================================================
"BLD",8210,1,90,0)
===
"BLD",8210,1,91,0)
Run Date: JUL 06, 2012                      Designation: PSJ*5*267  TEST 
"BLD",8210,1,92,0)
v23
"BLD",8210,1,93,0)
Package : INPATIENT MEDICATIONS             Priority   : MANDATORY
"BLD",8210,1,94,0)
Version : 5                                 Status     : UNDER DEVELOPMENT
"BLD",8210,1,95,0)
==========================================================================
"BLD",8210,1,96,0)
===
"BLD",8210,1,97,0)
 
"BLD",8210,1,98,0)
Associated patches: (v)PSJ*5*200   <<= must be installed BEFORE 
"BLD",8210,1,99,0)
`PSJ*5*267'
"BLD",8210,1,100,0)
                    (v)PSJ*5*253   <<= must be installed BEFORE 
"BLD",8210,1,101,0)
`PSJ*5*267'
"BLD",8210,1,102,0)
                    (v)PSJ*5*254   <<= must be installed BEFORE 
"BLD",8210,1,103,0)
`PSJ*5*267'
"BLD",8210,1,104,0)
                    (v)PSJ*5*263   <<= must be installed BEFORE 
"BLD",8210,1,105,0)
`PSJ*5*267'
"BLD",8210,1,106,0)
                    (v)PSJ*5*265   <<= must be installed BEFORE 
"BLD",8210,1,107,0)
`PSJ*5*267'
"BLD",8210,1,108,0)
                    (v)PSJ*5*273   <<= must be installed BEFORE 
"BLD",8210,1,109,0)
`PSJ*5*267'
"BLD",8210,1,110,0)
                    
"BLD",8210,1,111,0)
 
"BLD",8210,1,112,0)
Subject:  IMR4 NO ALLERGY ASSESSMENT, UNLIMITED LENGTH SI/OPI
"BLD",8210,1,113,0)
 
"BLD",8210,1,114,0)
Category:  ROUTINE
"BLD",8210,1,115,0)
           ENHANCEMENT
"BLD",8210,1,116,0)
           OTHER
"BLD",8210,1,117,0)
 
"BLD",8210,1,118,0)
 
"BLD",8210,1,119,0)
Press RETURN to continue or '^' to stop 
"BLD",8210,1,120,0)
 
"BLD",8210,1,121,0)
 
"BLD",8210,1,122,0)
 
"BLD",8210,1,123,0)
 
"BLD",8210,1,124,0)
 
"BLD",8210,1,125,0)
 
"BLD",8210,1,126,0)
 
"BLD",8210,1,127,0)
VistA Patch Display                                                   
"BLD",8210,1,128,0)
Page: 2
"BLD",8210,1,129,0)
==========================================================================
"BLD",8210,1,130,0)
===
"BLD",8210,1,131,0)
Run Date: JUL 06, 2012                      Designation: PSJ*5*267  TEST 
"BLD",8210,1,132,0)
v23
"BLD",8210,1,133,0)
Package : INPATIENT MEDICATIONS             Priority   : MANDATORY
"BLD",8210,1,134,0)
Version : 5                                 Status     : UNDER DEVELOPMENT
"BLD",8210,1,135,0)
==========================================================================
"BLD",8210,1,136,0)
===
"BLD",8210,1,137,0)
 
"BLD",8210,1,138,0)
Description:
"BLD",8210,1,139,0)
===========
"BLD",8210,1,140,0)
 
"BLD",8210,1,141,0)
******************************* WARNING **********************************
"BLD",8210,1,142,0)
 
"BLD",8210,1,143,0)
If your facility has the Pyxis/Omnicell/McKesson interface from ILC this
"BLD",8210,1,144,0)
patch will overwrite any local modifications in routines PSJOEA2, PSGOEE, 
"BLD",8210,1,145,0)
PSGOETO, and PSGOEV. This could affect certain orders being sent across
"BLD",8210,1,146,0)
this interface. The modifications will have to be reintroduced following
"BLD",8210,1,147,0)
installation of this patch.
"BLD",8210,1,148,0)
 
"BLD",8210,1,149,0)
**************************************************************************
"BLD",8210,1,150,0)
 
"BLD",8210,1,151,0)
 
"BLD",8210,1,152,0)
 
"BLD",8210,1,153,0)
Press RETURN to continue or '^' to stop ^
"BLD",8210,1,154,0)
 
"BLD",8210,1,155,0)
 
"BLD",8210,1,156,0)
 
"BLD",8210,1,157,0)
Select PATCH: PSJ*5*267    IMR4 NO ALLERGY ASSESSMENT, UNLIMITED LENGTH 
"BLD",8210,1,158,0)
UND JCH
"BLD",8210,1,159,0)
 
"BLD",8210,1,160,0)
DEVICE: HOME// ;;99999  SSH VIRTUAL TERMINAL
"BLD",8210,1,161,0)
 
"BLD",8210,1,162,0)
 
"BLD",8210,1,163,0)
 
"BLD",8210,1,164,0)
 
"BLD",8210,1,165,0)
 
"BLD",8210,1,166,0)
 
"BLD",8210,1,167,0)
 
"BLD",8210,1,168,0)
 
"BLD",8210,1,169,0)
VistA Patch Display                                                   
"BLD",8210,1,170,0)
Page: 1
"BLD",8210,1,171,0)
==========================================================================
"BLD",8210,1,172,0)
===
"BLD",8210,1,173,0)
Run Date: JUL 06, 2012                      Designation: PSJ*5*267  TEST 
"BLD",8210,1,174,0)
v23
"BLD",8210,1,175,0)
Package : INPATIENT MEDICATIONS             Priority   : MANDATORY
"BLD",8210,1,176,0)
Version : 5                                 Status     : UNDER DEVELOPMENT
"BLD",8210,1,177,0)
==========================================================================
"BLD",8210,1,178,0)
===
"BLD",8210,1,179,0)
 
"BLD",8210,1,180,0)
Associated patches: (v)PSJ*5*200   <<= must be installed BEFORE 
"BLD",8210,1,181,0)
`PSJ*5*267'
"BLD",8210,1,182,0)
                    (v)PSJ*5*253   <<= must be installed BEFORE 
"BLD",8210,1,183,0)
`PSJ*5*267'
"BLD",8210,1,184,0)
                    (v)PSJ*5*254   <<= must be installed BEFORE 
"BLD",8210,1,185,0)
`PSJ*5*267'
"BLD",8210,1,186,0)
                    (v)PSJ*5*263   <<= must be installed BEFORE 
"BLD",8210,1,187,0)
`PSJ*5*267'
"BLD",8210,1,188,0)
                    (v)PSJ*5*265   <<= must be installed BEFORE 
"BLD",8210,1,189,0)
`PSJ*5*267'
"BLD",8210,1,190,0)
                    (v)PSJ*5*273   <<= must be installed BEFORE 
"BLD",8210,1,191,0)
`PSJ*5*267'
"BLD",8210,1,192,0)
                    
"BLD",8210,1,193,0)
 
"BLD",8210,1,194,0)
Subject:  IMR4 NO ALLERGY ASSESSMENT, UNLIMITED LENGTH SI/OPI
"BLD",8210,1,195,0)
 
"BLD",8210,1,196,0)
Category:  ROUTINE
"BLD",8210,1,197,0)
           ENHANCEMENT
"BLD",8210,1,198,0)
           OTHER
"BLD",8210,1,199,0)
 
"BLD",8210,1,200,0)
Description:
"BLD",8210,1,201,0)
===========
"BLD",8210,1,202,0)
 
"BLD",8210,1,203,0)
******************************* WARNING **********************************
"BLD",8210,1,204,0)
 
"BLD",8210,1,205,0)
If your facility has the Pyxis/Omnicell/McKesson interface from ILC this
"BLD",8210,1,206,0)
patch will overwrite any local modifications in routines PSJOEA2, PSGOEE, 
"BLD",8210,1,207,0)
PSGOETO, and PSGOEV. This could affect certain orders being sent across
"BLD",8210,1,208,0)
this interface. The modifications will have to be reintroduced following
"BLD",8210,1,209,0)
installation of this patch.
"BLD",8210,1,210,0)
 
"BLD",8210,1,211,0)
**************************************************************************
"BLD",8210,1,212,0)
 
"BLD",8210,1,213,0)
Enhancements
"BLD",8210,1,214,0)
=====================
"BLD",8210,1,215,0)
 
"BLD",8210,1,216,0)
1. Special Instructions/Other Print Info
"BLD",8210,1,217,0)
 ________________________________________
"BLD",8210,1,218,0)
 With this enhancement, Special Instructions and Other Print Info have
"BLD",8210,1,219,0)
 been modified to support an unlimited amount of text. The existing
"BLD",8210,1,220,0)
 functionality that copies the provider comments from the Computerized
"BLD",8210,1,221,0)
 Patient Record System (CPRS) to be copied into each field has been
"BLD",8210,1,222,0)
 retained, and an additional action has been added to optionally open a
"BLD",8210,1,223,0)
 word processing edit dialog after copying the provider comments into the
"BLD",8210,1,224,0)
 appropriate field (Special Instructions for Unit Dose, Other Print Info 
"BLD",8210,1,225,0)
 for IV).
"BLD",8210,1,226,0)
 
"BLD",8210,1,227,0)
 Special Instructions and Other Print Info may also be entered
"BLD",8210,1,228,0)
 and/or edited from within Inpatient Medications V. 5.0 order entry 
"BLD",8210,1,229,0)
 options.
"BLD",8210,1,230,0)
 
"BLD",8210,1,231,0)
 Prior to this enhancement, Inpatient Medications maximum character
"BLD",8210,1,232,0)
 length for Special Instructions was 180 characters and for Other Print
"BLD",8210,1,233,0)
 Info the maximum length was 60 characters. This enhancement resolves
"BLD",8210,1,234,0)
 Patient Safety Issues PSPO 42, 1466 / Remedy Ticket HD336419
"BLD",8210,1,235,0)
 - Comment lengths between CPRS and Pharmacy.
"BLD",8210,1,236,0)
 
"BLD",8210,1,237,0)
2. No Allergy Assessment
"BLD",8210,1,238,0)
 ________________________ 
"BLD",8210,1,239,0)
 The No Allergy Assessment enhancement provides an interactive alert to
"BLD",8210,1,240,0)
 the pharmacist in Inpatient Medications V. 5.0 when no allergy assessment
"BLD",8210,1,241,0)
 is on file for the patient, and a method for the pharmacist to enter an
"BLD",8210,1,242,0)
 allergy assessment after receiving the alert.  A pharmacy intervention 
"BLD",8210,1,243,0)
 is automatically created if the pharmacist chooses to not enter an
"BLD",8210,1,244,0)
 assessment. 
"BLD",8210,1,245,0)
 
"BLD",8210,1,246,0)
 The No Allergy Assessment functionality will be available at the 
"BLD",8210,1,247,0)
 following options:
"BLD",8210,1,248,0)
 
"BLD",8210,1,249,0)
   Inpatient Order Entry [PSJ OE]
"BLD",8210,1,250,0)
   Non-Verified/Pending Orders [PSJU VBW]
"BLD",8210,1,251,0)
   Order Entry [PSJU NE]
"BLD",8210,1,252,0)
   Order Entry (IV) [PSJI ORDER]
"BLD",8210,1,253,0)
   Profile (IV) [PSJI PROFILE]
"BLD",8210,1,254,0)
 
"BLD",8210,1,255,0)
When a patient with no allergy assessment is selected from one of the
"BLD",8210,1,256,0)
affected options, the following message will be displayed to the
"BLD",8210,1,257,0)
pharmacist: 
"BLD",8210,1,258,0)
 
"BLD",8210,1,259,0)
"NO ALLERGY ASSESSMENT exists for this patient! Would you like to enter
"BLD",8210,1,260,0)
one now?" 
"BLD",8210,1,261,0)
 
"BLD",8210,1,262,0)
 - If the pharmacist enters 'YES' at this prompt, they are prompted
"BLD",8210,1,263,0)
   for allergy information. 
"BLD",8210,1,264,0)
 - If the pharmacist enters 'NO' at this prompt, a pharmacist intervention
"BLD",8210,1,265,0)
   is created, with a type of 'NO ALLERGY ASSESSMENT'. The pharmacist is
"BLD",8210,1,266,0)
   then prompted for Provider and Recommendation. A new Recommendation,
"BLD",8210,1,267,0)
   'UNABLE TO ASSESS', has been created specifically  for this type of 
"BLD",8210,1,268,0)
   intervention.
"BLD",8210,1,269,0)
 
"BLD",8210,1,270,0)
 This enhancement will address Patient Safety Issue PSPO 445.
"BLD",8210,1,271,0)
 
"BLD",8210,1,272,0)
 
"BLD",8210,1,273,0)
Defects Addressed
"BLD",8210,1,274,0)
=========================
"BLD",8210,1,275,0)
 
"BLD",8210,1,276,0)
1. HD 187184 - IV Med Stop Date
"BLD",8210,1,277,0)
 
"BLD",8210,1,278,0)
   Problem
"BLD",8210,1,279,0)
   -------
"BLD",8210,1,280,0)
   When an IV order is renewed the status automatically changes to
"BLD",8210,1,281,0)
   expired, but the stop date does not change to the time the order
"BLD",8210,1,282,0)
   actually stops.
"BLD",8210,1,283,0)
 
"BLD",8210,1,284,0)
   Resolution
"BLD",8210,1,285,0)
   ----------
"BLD",8210,1,286,0)
   Routine PSJHL3 has been modified to correctly set the stop date of the
"BLD",8210,1,287,0)
   order that has been renewed to the time of renewal. 
"BLD",8210,1,288,0)
 
"BLD",8210,1,289,0)
 
"BLD",8210,1,290,0)
 2. HD 176676/PSPO 480 - Inpatient doesn't change order status to Expired.
"BLD",8210,1,291,0)
    
"BLD",8210,1,292,0)
    Problem
"BLD",8210,1,293,0)
    -------
"BLD",8210,1,294,0)
    The Inpatient Medications V. 5.0 package does not change order status
"BLD",8210,1,295,0)
    to Expired when sending orders to CPRS with Stop Date/Time in the 
"BLD",8210,1,296,0)
    past.
"BLD",8210,1,297,0)
 
"BLD",8210,1,298,0)
    Solution:
"BLD",8210,1,299,0)
    ---------
"BLD",8210,1,300,0)
    Routine PSJHL3 has been modified to change the order status to 
"BLD",8210,1,301,0)
    Expired, if the order's Stop Date/Time is in the past, when sending 
"BLD",8210,1,302,0)
    orders to CPRS. 
"BLD",8210,1,303,0)
    **This is a partial solution addressing Inpatient Medications V.5.0
"BLD",8210,1,304,0)
      functionality only. Patch OR*3*350 addresses CPRS GUI functionality.
"BLD",8210,1,305,0)
 
"BLD",8210,1,306,0)
 3. HD 377288 (original) - Default response should be "No"
"BLD",8210,1,307,0)
    
"BLD",8210,1,308,0)
    Problem
"BLD",8210,1,309,0)
    -------
"BLD",8210,1,310,0)
    When an Inpatient Unit Dose order's Dosage Ordered field does not 
"BLD",8210,1,311,0)
    match the dosage indicated by the Dispense Drug and Units per 
"BLD",8210,1,312,0)
    Dose fields, the warning prompt "Would you like to continue
"BLD",8210,1,313,0)
    verifying the order?" is displayed after accepting the order via the 
"BLD",8210,1,314,0)
    AC-Accept action. The prompt's default response is "Yes", even though 
"BLD",8210,1,315,0)
    the order is flawed.
"BLD",8210,1,316,0)
                         
"BLD",8210,1,317,0)
    The Inpatient Medications Workgroup has requested 
"BLD",8210,1,318,0)
    this be changed to "No".
"BLD",8210,1,319,0)
 
"BLD",8210,1,320,0)
    Solution
"BLD",8210,1,321,0)
    -------- 
"BLD",8210,1,322,0)
    When an Inpatient Unit Dose order's Dosage Ordered fi eld does not 
"BLD",8210,1,323,0)
    match the dosage indicated by the Dispense Drug and Units per 
"BLD",8210,1,324,0)
    Dose fields, the default response for the prompt "Would you like to
"BLD",8210,1,325,0)
    continue verifying the order?" will be changed to "No", as requested 
"BLD",8210,1,326,0)
    by the Inpatient Medications Workgroup.
"BLD",8210,1,327,0)
 
"BLD",8210,1,328,0)
 
"BLD",8210,1,329,0)
 4. HD 273000 (original) - Field Validation Not Correct
"BLD",8210,1,330,0)
 
"BLD",8210,1,331,0)
    Problem
"BLD",8210,1,332,0)
    -------
"BLD",8210,1,333,0)
    When a second Dispense drug is added to a Unit Dose medication order,
"BLD",8210,1,334,0)
    and no Dosage Ordered is selected, the following message display:
"BLD",8210,1,335,0)
 
"BLD",8210,1,336,0)
        THE FOLLOWING IS EITHER INVALID OR MISSING FROM THIS ORDER:
"BLD",8210,1,337,0)
 
"BLD",8210,1,338,0)
        THIS FIELD IS NECESSARY FOR VERIFICATION.
"BLD",8210,1,339,0)
        Enter RETURN to continue or '^' to exit: 
"BLD",8210,1,340,0)
 
"BLD",8210,1,341,0)
    Note that there is no actual field name displayed as an invalid field.
"BLD",8210,1,342,0)
    This is incorrect. 
"BLD",8210,1,343,0)
 
"BLD",8210,1,344,0)
    Solution
"BLD",8210,1,345,0)
    --------
"BLD",8210,1,346,0)
    In CHK^PSGOEV the variable CHK gets set to 8 and there is no handling
"BLD",8210,1,347,0)
    for a value of 8. The message is correct when CHK is set to 7.
"BLD",8210,1,348,0)
 
"BLD",8210,1,349,0)
 
"BLD",8210,1,350,0)
 5. HD 517634/PSPO 2137 - Provider Comments not displayed.
"BLD",8210,1,351,0)
 
"BLD",8210,1,352,0)
    Problem
"BLD",8210,1,353,0)
    -------
"BLD",8210,1,354,0)
    Provider Comments for continuous IV orders are not displaying in CPRS
"BLD",8210,1,355,0)
    after the order is verified in Inpatient Medications.
"BLD",8210,1,356,0)
 
"BLD",8210,1,357,0)
    Resolution
"BLD",8210,1,358,0)
    ----------
"BLD",8210,1,359,0)
    When IV orders are verified in Inpatient Medications, if the order
"BLD",8210,1,360,0)
    contains Provider Comments, include the Provider Comments in the
"BLD",8210,1,361,0)
    update sent to CPRS in order to keep the order synchronized.
"BLD",8210,1,362,0)
 
"BLD",8210,1,363,0)
 6. HD 586428/PSPO 2137 - Provider Comments not displayed after Verify.
"BLD",8210,1,364,0)
 
"BLD",8210,1,365,0)
    Problem
"BLD",8210,1,366,0)
    -------
"BLD",8210,1,367,0)
    When an IV order is created with Provider Comments, and then edited
"BLD",8210,1,368,0)
    prior to verification so as to trigger the creation of a new order,
"BLD",8210,1,369,0)
    Provider Comments do not carry over to the new order if auto-verify 
"BLD",8210,1,370,0)
    is not used. As a result, the verifying pharmacist may not see the
"BLD",8210,1,371,0)
    original Provider Comments.
"BLD",8210,1,372,0)
 
"BLD",8210,1,373,0)
    Solution
"BLD",8210,1,374,0)
    --------
"BLD",8210,1,375,0)
    Prior to the initial verification of an order, the original Provider 
"BLD",8210,1,376,0)
    Comments should carry over to new a order created due to edit, so that
"BLD",8210,1,377,0)
    the pharmacist verifying the order has an opportunity to see the 
"BLD",8210,1,378,0)
    Provider Comments.
"BLD",8210,4,0)
^9.64PA^53.45^2
"BLD",8210,4,53.1,0)
53.1
"BLD",8210,4,53.1,2,0)
^9.641^53.1^1
"BLD",8210,4,53.1,2,53.1,0)
NON-VERIFIED ORDERS  (File-top level)
"BLD",8210,4,53.1,2,53.1,1,0)
^9.6411^136^2
"BLD",8210,4,53.1,2,53.1,1,135,0)
SPECIAL INSTRUCTIONS (LONG)
"BLD",8210,4,53.1,2,53.1,1,136,0)
OTHER PRINT INFO (LONG)
"BLD",8210,4,53.1,222)
y^y^p^^^^n^^n
"BLD",8210,4,53.1,224)

"BLD",8210,4,53.45,0)
53.45
"BLD",8210,4,53.45,2,0)
^9.641^53.45^1
"BLD",8210,4,53.45,2,53.45,0)
INPATIENT USER PARAMETERS  (File-top level)
"BLD",8210,4,53.45,2,53.45,1,0)
^9.6411^5^2
"BLD",8210,4,53.45,2,53.45,1,5,0)
SPECIAL INSTRUCTIONS
"BLD",8210,4,53.45,2,53.45,1,6,0)
OTHER PRINT INFO
"BLD",8210,4,53.45,222)
y^y^p^^^^n^^n
"BLD",8210,4,53.45,224)

"BLD",8210,4,"APDD",53.1,53.1)

"BLD",8210,4,"APDD",53.1,53.1,135)

"BLD",8210,4,"APDD",53.1,53.1,136)

"BLD",8210,4,"APDD",53.45,53.45)

"BLD",8210,4,"APDD",53.45,53.45,5)

"BLD",8210,4,"APDD",53.45,53.45,6)

"BLD",8210,4,"B",53.1,53.1)

"BLD",8210,4,"B",53.45,53.45)

"BLD",8210,6)
18^
"BLD",8210,6.3)
158
"BLD",8210,"ABPKG")
n
"BLD",8210,"KRN",0)
^9.67PA^779.2^20
"BLD",8210,"KRN",.4,0)
.4
"BLD",8210,"KRN",.401,0)
.401
"BLD",8210,"KRN",.402,0)
.402
"BLD",8210,"KRN",.403,0)
.403
"BLD",8210,"KRN",.5,0)
.5
"BLD",8210,"KRN",.84,0)
.84
"BLD",8210,"KRN",3.6,0)
3.6
"BLD",8210,"KRN",3.8,0)
3.8
"BLD",8210,"KRN",9.2,0)
9.2
"BLD",8210,"KRN",9.8,0)
9.8
"BLD",8210,"KRN",9.8,"NM",0)
^9.68A^78^53
"BLD",8210,"KRN",9.8,"NM",24,0)
PSJRXI^^0^B20674326
"BLD",8210,"KRN",9.8,"NM",25,0)
PSJDPT^^0^B13914109
"BLD",8210,"KRN",9.8,"NM",26,0)
PSGP^^0^B12038299
"BLD",8210,"KRN",9.8,"NM",27,0)
PSJP^^0^B21519406
"BLD",8210,"KRN",9.8,"NM",28,0)
PSIV^^0^B24205537
"BLD",8210,"KRN",9.8,"NM",29,0)
PSJLMPRU^^0^B14898207
"BLD",8210,"KRN",9.8,"NM",30,0)
PSJHL3^^0^B90089505
"BLD",8210,"KRN",9.8,"NM",32,0)
PSJBCMA5^^0^B78422093
"BLD",8210,"KRN",9.8,"NM",33,0)
PSJUTL^^0^B135053726
"BLD",8210,"KRN",9.8,"NM",34,0)
PSJO^^0^B23946604
"BLD",8210,"KRN",9.8,"NM",35,0)
PSJLMUDE^^0^B65175235
"BLD",8210,"KRN",9.8,"NM",36,0)
PSJLMGUD^^0^B30433867
"BLD",8210,"KRN",9.8,"NM",37,0)
PSJLIVMD^^0^B95539776
"BLD",8210,"KRN",9.8,"NM",38,0)
PSIVORFB^^0^B83047869
"BLD",8210,"KRN",9.8,"NM",39,0)
PSIVEDT1^^0^B63913566
"BLD",8210,"KRN",9.8,"NM",41,0)
PSGOT^^0^B22872398
"BLD",8210,"KRN",9.8,"NM",42,0)
PSGOETO^^0^B36634660
"BLD",8210,"KRN",9.8,"NM",43,0)
PSGOEF1^^0^B28843982
"BLD",8210,"KRN",9.8,"NM",44,0)
PSGOEE^^0^B96504063
"BLD",8210,"KRN",9.8,"NM",45,0)
PSGOE91^^0^B37672131
"BLD",8210,"KRN",9.8,"NM",46,0)
PSGOE81^^0^B32608596
"BLD",8210,"KRN",9.8,"NM",47,0)
PSGOE41^^0^B27985656
"BLD",8210,"KRN",9.8,"NM",48,0)
PSGAL5^^0^B28188853
"BLD",8210,"KRN",9.8,"NM",49,0)
PSGMUTL^^0^B28358090
"BLD",8210,"KRN",9.8,"NM",50,0)
PSJLIVFD^^0^B54237436
"BLD",8210,"KRN",9.8,"NM",51,0)
PSIVVW1^^0^B23979189
"BLD",8210,"KRN",9.8,"NM",52,0)
PSIVORAL^^0^B19351743
"BLD",8210,"KRN",9.8,"NM",53,0)
PSJHLU^^0^B45862286
"BLD",8210,"KRN",9.8,"NM",54,0)
PSGOEV^^0^B68395983
"BLD",8210,"KRN",9.8,"NM",55,0)
PSIVORV2^^0^B15709057
"BLD",8210,"KRN",9.8,"NM",56,0)
PSIVORFA^^0^B27786981
"BLD",8210,"KRN",9.8,"NM",57,0)
PSGMIV^^0^B42223209
"BLD",8210,"KRN",9.8,"NM",58,0)
PSGMMIV^^0^B42167886
"BLD",8210,"KRN",9.8,"NM",59,0)
PSGMMIVC^^0^B25628895
"BLD",8210,"KRN",9.8,"NM",60,0)
PSJOE0^^0^B25370612
"BLD",8210,"KRN",9.8,"NM",61,0)
PSGOE7^^0^B19281966
"BLD",8210,"KRN",9.8,"NM",62,0)
PSJCOM^^0^B39982545
"BLD",8210,"KRN",9.8,"NM",63,0)
PSJOEA2^^0^B28764670
"BLD",8210,"KRN",9.8,"NM",64,0)
PSJCOMV^^0^B40002868
"BLD",8210,"KRN",9.8,"NM",65,0)
PSIVORC2^^0^B59003278
"BLD",8210,"KRN",9.8,"NM",66,0)
PSJBCMA1^^0^B94159665
"BLD",8210,"KRN",9.8,"NM",67,0)
PSGVW^^0^B31699559
"BLD",8210,"KRN",9.8,"NM",68,0)
PSGVW0^^0^B10085740
"BLD",8210,"KRN",9.8,"NM",69,0)
PSJINVW^^0^B101370185
"BLD",8210,"KRN",9.8,"NM",70,0)
PSJINHIS^^0^B7395737
"BLD",8210,"KRN",9.8,"NM",71,0)
PSJHL9^^0^B61245429
"BLD",8210,"KRN",9.8,"NM",72,0)
PSGOEL^^0^B13821654
"BLD",8210,"KRN",9.8,"NM",73,0)
PSJLIUTL^^0^B52930175
"BLD",8210,"KRN",9.8,"NM",74,0)
PSJBCMA^^0^B81219931
"BLD",8210,"KRN",9.8,"NM",75,0)
PSGOTR^^0^B19415814
"BLD",8210,"KRN",9.8,"NM",76,0)
PSJPDV1^^0^B16075972
"BLD",8210,"KRN",9.8,"NM",77,0)
PSJBCMA2^^0^B57484334
"BLD",8210,"KRN",9.8,"NM",78,0)
PSJLIORD^^0^B9927943
"BLD",8210,"KRN",9.8,"NM","B","PSGAL5",48)

"BLD",8210,"KRN",9.8,"NM","B","PSGMIV",57)

"BLD",8210,"KRN",9.8,"NM","B","PSGMMIV",58)

"BLD",8210,"KRN",9.8,"NM","B","PSGMMIVC",59)

"BLD",8210,"KRN",9.8,"NM","B","PSGMUTL",49)

"BLD",8210,"KRN",9.8,"NM","B","PSGOE41",47)

"BLD",8210,"KRN",9.8,"NM","B","PSGOE7",61)

"BLD",8210,"KRN",9.8,"NM","B","PSGOE81",46)

"BLD",8210,"KRN",9.8,"NM","B","PSGOE91",45)

"BLD",8210,"KRN",9.8,"NM","B","PSGOEE",44)

"BLD",8210,"KRN",9.8,"NM","B","PSGOEF1",43)

"BLD",8210,"KRN",9.8,"NM","B","PSGOEL",72)

"BLD",8210,"KRN",9.8,"NM","B","PSGOETO",42)

"BLD",8210,"KRN",9.8,"NM","B","PSGOEV",54)

"BLD",8210,"KRN",9.8,"NM","B","PSGOT",41)

"BLD",8210,"KRN",9.8,"NM","B","PSGOTR",75)

"BLD",8210,"KRN",9.8,"NM","B","PSGP",26)

"BLD",8210,"KRN",9.8,"NM","B","PSGVW",67)

"BLD",8210,"KRN",9.8,"NM","B","PSGVW0",68)

"BLD",8210,"KRN",9.8,"NM","B","PSIV",28)

"BLD",8210,"KRN",9.8,"NM","B","PSIVEDT1",39)

"BLD",8210,"KRN",9.8,"NM","B","PSIVORAL",52)

"BLD",8210,"KRN",9.8,"NM","B","PSIVORC2",65)

"BLD",8210,"KRN",9.8,"NM","B","PSIVORFA",56)

"BLD",8210,"KRN",9.8,"NM","B","PSIVORFB",38)

"BLD",8210,"KRN",9.8,"NM","B","PSIVORV2",55)

"BLD",8210,"KRN",9.8,"NM","B","PSIVVW1",51)

"BLD",8210,"KRN",9.8,"NM","B","PSJBCMA",74)

"BLD",8210,"KRN",9.8,"NM","B","PSJBCMA1",66)

"BLD",8210,"KRN",9.8,"NM","B","PSJBCMA2",77)

"BLD",8210,"KRN",9.8,"NM","B","PSJBCMA5",32)

"BLD",8210,"KRN",9.8,"NM","B","PSJCOM",62)

"BLD",8210,"KRN",9.8,"NM","B","PSJCOMV",64)

"BLD",8210,"KRN",9.8,"NM","B","PSJDPT",25)

"BLD",8210,"KRN",9.8,"NM","B","PSJHL3",30)

"BLD",8210,"KRN",9.8,"NM","B","PSJHL9",71)

"BLD",8210,"KRN",9.8,"NM","B","PSJHLU",53)

"BLD",8210,"KRN",9.8,"NM","B","PSJINHIS",70)

"BLD",8210,"KRN",9.8,"NM","B","PSJINVW",69)

"BLD",8210,"KRN",9.8,"NM","B","PSJLIORD",78)

"BLD",8210,"KRN",9.8,"NM","B","PSJLIUTL",73)

"BLD",8210,"KRN",9.8,"NM","B","PSJLIVFD",50)

"BLD",8210,"KRN",9.8,"NM","B","PSJLIVMD",37)

"BLD",8210,"KRN",9.8,"NM","B","PSJLMGUD",36)

"BLD",8210,"KRN",9.8,"NM","B","PSJLMPRU",29)

"BLD",8210,"KRN",9.8,"NM","B","PSJLMUDE",35)

"BLD",8210,"KRN",9.8,"NM","B","PSJO",34)

"BLD",8210,"KRN",9.8,"NM","B","PSJOE0",60)

"BLD",8210,"KRN",9.8,"NM","B","PSJOEA2",63)

"BLD",8210,"KRN",9.8,"NM","B","PSJP",27)

"BLD",8210,"KRN",9.8,"NM","B","PSJPDV1",76)

"BLD",8210,"KRN",9.8,"NM","B","PSJRXI",24)

"BLD",8210,"KRN",9.8,"NM","B","PSJUTL",33)

"BLD",8210,"KRN",19,0)
19
"BLD",8210,"KRN",19,"NM",0)
^9.68A^^0
"BLD",8210,"KRN",19.1,0)
19.1
"BLD",8210,"KRN",101,0)
101
"BLD",8210,"KRN",101,"NM",0)
^9.68A^12^12
"BLD",8210,"KRN",101,"NM",1,0)
PSJ LM NEW ORDER^^0
"BLD",8210,"KRN",101,"NM",2,0)
PSJ LM NEW ORDER FROM PROFILE^^0
"BLD",8210,"KRN",101,"NM",3,0)
PSJ LM SELECT ORDER^^0
"BLD",8210,"KRN",101,"NM",4,0)
PSJ LM FINISH^^0
"BLD",8210,"KRN",101,"NM",5,0)
PSJ LM SHOW PROFILE^^0
"BLD",8210,"KRN",101,"NM",6,0)
PSJ LM OE MENU^^2
"BLD",8210,"KRN",101,"NM",7,0)
PSJI LM VERIFY^^0
"BLD",8210,"KRN",101,"NM",8,0)
PSJ LM NEW SELECT ORDER^^0
"BLD",8210,"KRN",101,"NM",9,0)
PSJU LM VERIFY^^0
"BLD",8210,"KRN",101,"NM",10,0)
PSJI LM FINISH^^0
"BLD",8210,"KRN",101,"NM",11,0)
PSJ LM PATIENT INFO^^4^
"BLD",8210,"KRN",101,"NM",12,0)
PSJ LM PATIENT DATA^^4^
"BLD",8210,"KRN",101,"NM","B","PSJ LM FINISH",4)

"BLD",8210,"KRN",101,"NM","B","PSJ LM NEW ORDER",1)

"BLD",8210,"KRN",101,"NM","B","PSJ LM NEW ORDER FROM PROFILE",2)

"BLD",8210,"KRN",101,"NM","B","PSJ LM NEW SELECT ORDER",8)

"BLD",8210,"KRN",101,"NM","B","PSJ LM OE MENU",6)

"BLD",8210,"KRN",101,"NM","B","PSJ LM PATIENT DATA",12)

"BLD",8210,"KRN",101,"NM","B","PSJ LM PATIENT INFO",11)

"BLD",8210,"KRN",101,"NM","B","PSJ LM SELECT ORDER",3)

"BLD",8210,"KRN",101,"NM","B","PSJ LM SHOW PROFILE",5)

"BLD",8210,"KRN",101,"NM","B","PSJI LM FINISH",10)

"BLD",8210,"KRN",101,"NM","B","PSJI LM VERIFY",7)

"BLD",8210,"KRN",101,"NM","B","PSJU LM VERIFY",9)

"BLD",8210,"KRN",409.61,0)
409.61
"BLD",8210,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",8210,"KRN",409.61,"NM",1,0)
PSJ LM IV AC/EDIT^^0
"BLD",8210,"KRN",409.61,"NM","B","PSJ LM IV AC/EDIT",1)

"BLD",8210,"KRN",771,0)
771
"BLD",8210,"KRN",771,"NM",0)
^9.68A^^
"BLD",8210,"KRN",779.2,0)
779.2
"BLD",8210,"KRN",870,0)
870
"BLD",8210,"KRN",8989.51,0)
8989.51
"BLD",8210,"KRN",8989.52,0)
8989.52
"BLD",8210,"KRN",8994,0)
8994
"BLD",8210,"KRN","B",.4,.4)

"BLD",8210,"KRN","B",.401,.401)

"BLD",8210,"KRN","B",.402,.402)

"BLD",8210,"KRN","B",.403,.403)

"BLD",8210,"KRN","B",.5,.5)

"BLD",8210,"KRN","B",.84,.84)

"BLD",8210,"KRN","B",3.6,3.6)

"BLD",8210,"KRN","B",3.8,3.8)

"BLD",8210,"KRN","B",9.2,9.2)

"BLD",8210,"KRN","B",9.8,9.8)

"BLD",8210,"KRN","B",19,19)

"BLD",8210,"KRN","B",19.1,19.1)

"BLD",8210,"KRN","B",101,101)

"BLD",8210,"KRN","B",409.61,409.61)

"BLD",8210,"KRN","B",771,771)

"BLD",8210,"KRN","B",779.2,779.2)

"BLD",8210,"KRN","B",870,870)

"BLD",8210,"KRN","B",8989.51,8989.51)

"BLD",8210,"KRN","B",8989.52,8989.52)

"BLD",8210,"KRN","B",8994,8994)

"BLD",8210,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8210,"QUES",0)
^9.62^^
"BLD",8210,"REQB",0)
^9.611^11^8
"BLD",8210,"REQB",1,0)
PSJ*5.0*254^2
"BLD",8210,"REQB",2,0)
PSJ*5.0*226^2
"BLD",8210,"REQB",3,0)
PSJ*5.0*200^2
"BLD",8210,"REQB",4,0)
PSJ*5.0*253^2
"BLD",8210,"REQB",6,0)
PSJ*5.0*263^2
"BLD",8210,"REQB",7,0)
PSJ*5.0*273^2
"BLD",8210,"REQB",10,0)
PSJ*5.0*265^2
"BLD",8210,"REQB",11,0)
PSS*1.0*171^2
"BLD",8210,"REQB","B","PSJ*5.0*200",3)

"BLD",8210,"REQB","B","PSJ*5.0*226",2)

"BLD",8210,"REQB","B","PSJ*5.0*253",4)

"BLD",8210,"REQB","B","PSJ*5.0*254",1)

"BLD",8210,"REQB","B","PSJ*5.0*263",6)

"BLD",8210,"REQB","B","PSJ*5.0*265",10)

"BLD",8210,"REQB","B","PSJ*5.0*273",7)

"BLD",8210,"REQB","B","PSS*1.0*171",11)

"FIA",53.1)
NON-VERIFIED ORDERS
"FIA",53.1,0)
^PS(53.1,
"FIA",53.1,0,0)
53.1I
"FIA",53.1,0,1)
y^y^p^^^^n^^n
"FIA",53.1,0,10)

"FIA",53.1,0,11)

"FIA",53.1,0,"RLRO")

"FIA",53.1,0,"VR")
5.0^PSJ
"FIA",53.1,53.1)
1
"FIA",53.1,53.1,135)

"FIA",53.1,53.1,136)

"FIA",53.1,53.1135)
0
"FIA",53.1,53.1136)
0
"FIA",53.45)
INPATIENT USER PARAMETERS
"FIA",53.45,0)
^PS(53.45,
"FIA",53.45,0,0)
53.45P
"FIA",53.45,0,1)
y^y^p^^^^n^^n
"FIA",53.45,0,10)

"FIA",53.45,0,11)

"FIA",53.45,0,"RLRO")

"FIA",53.45,0,"VR")
5.0^PSJ
"FIA",53.45,53.45)
1
"FIA",53.45,53.45,5)

"FIA",53.45,53.45,6)

"FIA",53.45,53.455)
0
"FIA",53.45,53.456)
0
"KRN",101,3850,-1)
4^11
"KRN",101,3850,0)
PSJ LM PATIENT INFO
"KRN",101,3851,-1)
4^12
"KRN",101,3851,0)
PSJ LM PATIENT DATA
"KRN",101,3852,-1)
0^3
"KRN",101,3852,0)
PSJ LM SELECT ORDER^Select Order^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3852,4)
26^4^^SO
"KRN",101,3852,10,0)
^101.01PA^0^0
"KRN",101,3852,15)
D KILL^PSJBCMA5(+$G(PSJSYSP))
"KRN",101,3852,20)
K ^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP)) D SELECT^PSJOE
"KRN",101,3852,99)
62628,74324
"KRN",101,3853,-1)
0^1
"KRN",101,3853,0)
PSJ LM NEW ORDER^New Order Entry^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3853,1,0)
^101.06^2^2^3120118^^^^
"KRN",101,3853,1,1,0)
Allows the user to enter a new order for the selected patient without
"KRN",101,3853,1,2,0)
seeing a medication profile.
"KRN",101,3853,4)
26^4
"KRN",101,3853,15)
D KILL^PSJBCMA5(+$G(PSJSYSP)) I PSJLK S X=DFN_";DPT(" D ULK^ORX2 S VALMBCK="Q"
"KRN",101,3853,20)
K PSJSTARI,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP)) D HOLDHDR^PSJOE K PSJLK S X=DFN_";DPT(" D LK^ORX2 S PSJLK=Y I Y D LMNEW^PSJOE0(DFN,PSJPROT)
"KRN",101,3853,99)
62628,74324
"KRN",101,3854,-1)
0^4
"KRN",101,3854,0)
PSJ LM FINISH^Finish^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3854,1,0)
^101.06^1^1^3120412^^^^
"KRN",101,3854,1,1,0)
Allows a user to finish IV, UD, or pending orders for a patient.
"KRN",101,3854,4)
36^4^^FN
"KRN",101,3854,15)
K PSJINFIN,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP))
"KRN",101,3854,20)
S PSJINFIN=1 K ^TMP("PSJINTER",$J) D OVRDISF^PSGSICH2($G(DFN),$G(PSGORD),3) D FINISH^PSGOEF
"KRN",101,3854,99)
62628,74324
"KRN",101,3861,-1)
0^5
"KRN",101,3861,0)
PSJ LM SHOW PROFILE^View Profile^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3861,1,0)
^101.06^2^2^3120105^^^^
"KRN",101,3861,1,1,0)
Allows the user to choose to display a short, long, or no medication
"KRN",101,3861,1,2,0)
profile for the selected patient.
"KRN",101,3861,4)

"KRN",101,3861,15)
S VALMBCK="Q" K ^PS(53.45,+$G(DUZ),5),^PS(53.45,+$G(DUZ),6)
"KRN",101,3861,20)
K ^PS(53.45,+$G(DUZ),5),^PS(53.45,+$G(DUZ),6) D ENL^PSJO3 I "LSN"[PSJOL S PSJLMCON=1
"KRN",101,3861,24)
B
"KRN",101,3861,30)
.
"KRN",101,3861,99)
62628,74324
"KRN",101,3868,-1)
0^10
"KRN",101,3868,0)
PSJI LM FINISH^Finish^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3868,1,0)
^101.06^1^1^3120118^^^^
"KRN",101,3868,1,1,0)
This action allows the user to complete an IV pending order.
"KRN",101,3868,4)
25^4^^FN
"KRN",101,3868,15)
K PSJINFIN,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP))
"KRN",101,3868,20)
S PSJINFIN=1 K ^TMP("PSJINTER",$J) D OVRDISF^PSGSICH2($G(DFN),$G(PSJORD),2) D FINISH^PSJLIFN D SETIVINT^PSGSICH1
"KRN",101,3868,24)

"KRN",101,3868,99)
62628,74324
"KRN",101,3873,-1)
0^9
"KRN",101,3873,0)
PSJU LM VERIFY^Verify^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3873,15)
S VALMBCK="Q" D SETUDINT^PSGSICH1($G(PSJORD)) K ^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP))
"KRN",101,3873,20)
D EN^PSGOEV(PSJORD)
"KRN",101,3873,99)
62628,74324
"KRN",101,3884,-1)
0^8
"KRN",101,3884,0)
PSJ LM NEW SELECT ORDER^^^A^^^^^^^^
"KRN",101,3884,1,0)
^101.06^1^1^3120118^^^^
"KRN",101,3884,1,1,0)
Allows the user to select the order from the profile by number.
"KRN",101,3884,15)
D KILL^PSJBCMA5(+$G(PSJSYSP))
"KRN",101,3884,20)
K ^TMP("PSJINTER",$J),PSJSTARI D KILL^PSJBCMA5(+$G(PSJSYSP)) D NEWSEL^PSJOE
"KRN",101,3884,26)

"KRN",101,3908,-1)
0^2
"KRN",101,3908,0)
PSJ LM NEW ORDER FROM PROFILE^New Order Entry^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3908,1,0)
^101.06^2^2^3120118^^^^
"KRN",101,3908,1,1,0)
This is used to create new Inpatient Medication orders from the profile
"KRN",101,3908,1,2,0)
list. 
"KRN",101,3908,15)
D KILL^PSJBCMA5(+$G(PSJSYSP)) I PSJLK S X=DFN_";DPT(" D ULK^ORX2 D INIT^PSJLMHED(PSJPROT) S VALMBCK="Q"
"KRN",101,3908,20)
K PSJSTARI,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP)) K PSJLK S X=DFN_";DPT(" D LK^ORX2 S PSJLK=Y I Y D LMNEW^PSJOE0(DFN,PSJPROT)
"KRN",101,3908,99)
62628,74324
"KRN",101,3916,-1)
2^6
"KRN",101,3916,0)
PSJ LM OE MENU^ORDER ENTRY MENU^^M^10000000009^^^^^^^197
"KRN",101,3916,10,0)
^101.01PA^7^7
"KRN",101,3916,10,3,0)
3852^SO^31^
"KRN",101,3916,10,3,"^")
PSJ LM SELECT ORDER
"KRN",101,3916,10,5,0)
3908^NO^32^
"KRN",101,3916,10,5,"^")
PSJ LM NEW ORDER FROM PROFILE
"KRN",101,3916,10,6,0)
3850^PI^11^
"KRN",101,3916,10,6,"^")
PSJ LM PATIENT INFO
"KRN",101,3916,10,7,0)
3851^PU^12^
"KRN",101,3916,10,7,"^")
PSJ LM PATIENT DATA
"KRN",101,4891,-1)
0^7
"KRN",101,4891,0)
PSJI LM VERIFY^Verify^^A^^^^^^^^
"KRN",101,4891,1,0)
^101.06^1^1^3120118^^^^
"KRN",101,4891,1,1,0)
This action allows the user to verify an IV order.
"KRN",101,4891,4)
25^4^^VF
"KRN",101,4891,15)
D SETIVINT^PSGSICH1 K ^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP))
"KRN",101,4891,20)
N PSJIOPIV S PSJIOPIV=1 D VF^PSJLIACT D SETIVINT^PSGSICH1 K PSJIOPIV
"KRN",101,4891,99)
62628,74325
"KRN",409.61,440,-1)
0^1
"KRN",409.61,440,0)
PSJ LM IV AC/EDIT^1^^80^6^20^1^1^^PSJ PC IV AC/EDIT ACTION^^2^^1
"KRN",409.61,440,1)
^PSJ LM ORDER VIEW HIDDEN ACTIONS
"KRN",409.61,440,"ARRAY")
 ^TMP("PSJI",$J)
"KRN",409.61,440,"FNL")
S VALMBCK="Q" D AEEXIT^PSJLIACT K ^PS(53.45,+$G(PSJSYSP),6)
"KRN",409.61,440,"HDR")
D HDR^PSJLMHED(DFN)
"KRN",409.61,440,"INIT")
D ASKOVR^PSGOEE($G(Y(1)),$G(PSJORD),.PSJSTARI) D ACEDIT^PSJLIACT
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;LME1^XPDIA1;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
267^3120809^10000000009
"PKG",197,22,1,"PAH",1,1,0)
^^378^378^3120809
"PKG",197,22,1,"PAH",1,1,1,0)
******************************* WARNING **********************************
"PKG",197,22,1,"PAH",1,1,2,0)
 
"PKG",197,22,1,"PAH",1,1,3,0)
If your facility has the Pyxis/Omnicell/McKesson interface from ILC this
"PKG",197,22,1,"PAH",1,1,4,0)
patch will overwrite any local modifications in routines PSJOEA2, PSGOEE, 
"PKG",197,22,1,"PAH",1,1,5,0)
PSGOETO, and PSGOEV. This could affect certain orders being sent across
"PKG",197,22,1,"PAH",1,1,6,0)
this interface. The modifications will have to be reintroduced following
"PKG",197,22,1,"PAH",1,1,7,0)
installation of this patch.
"PKG",197,22,1,"PAH",1,1,8,0)
 
"PKG",197,22,1,"PAH",1,1,9,0)
**************************************************************************
"PKG",197,22,1,"PAH",1,1,10,0)
******************************* ATTENTION ********************************
"PKG",197,22,1,"PAH",1,1,11,0)
 
"PKG",197,22,1,"PAH",1,1,12,0)
                          PSB*3*68 and PSS*1*171
"PKG",197,22,1,"PAH",1,1,13,0)
 
"PKG",197,22,1,"PAH",1,1,14,0)
This patch (PSJ*5*267) should be installed before PSS*1*171 in order to
"PKG",197,22,1,"PAH",1,1,15,0)
activate the NO ALLERGY ASSESSMENT enhancement. The NO ALLERGY ASSESSMENT
"PKG",197,22,1,"PAH",1,1,16,0)
enhancement will not be fully activated until patch PSS*1*171 and 
"PKG",197,22,1,"PAH",1,1,17,0)
PSJ*5*267 are both installed.
"PKG",197,22,1,"PAH",1,1,18,0)
 
"PKG",197,22,1,"PAH",1,1,19,0)
This patch (PSJ*5*267) should be installed with PSB*3*68 in order to
"PKG",197,22,1,"PAH",1,1,20,0)
activate the UNLIMITED SI/OPI enhancement in BCMA. This patch (PSJ*5*267)
"PKG",197,22,1,"PAH",1,1,21,0)
is required by PSB*3*68 and must be installed after PSB*3*68.
"PKG",197,22,1,"PAH",1,1,22,0)
 
"PKG",197,22,1,"PAH",1,1,23,0)
************************************************************************* 
"PKG",197,22,1,"PAH",1,1,24,0)
 
"PKG",197,22,1,"PAH",1,1,25,0)
Enhancements
"PKG",197,22,1,"PAH",1,1,26,0)
=====================
"PKG",197,22,1,"PAH",1,1,27,0)
 
"PKG",197,22,1,"PAH",1,1,28,0)
1. Special Instructions/Other Print Info
"PKG",197,22,1,"PAH",1,1,29,0)
 ________________________________________
"PKG",197,22,1,"PAH",1,1,30,0)
 With this enhancement, Special Instructions and Other Print Info have
"PKG",197,22,1,"PAH",1,1,31,0)
 been modified to support an unlimited amount of text. The existing
"PKG",197,22,1,"PAH",1,1,32,0)
 functionality that copies the provider comments from the Computerized
"PKG",197,22,1,"PAH",1,1,33,0)
 Patient Record System (CPRS) to be copied into each field has been
"PKG",197,22,1,"PAH",1,1,34,0)
<=======T=======T=======T=======T=======T=======T=======T=======T=======T>
"PKG",197,22,1,"PAH",1,1,35,0)
======
"PKG",197,22,1,"PAH",1,1,36,0)
 
"PKG",197,22,1,"PAH",1,1,37,0)
 
"PKG",197,22,1,"PAH",1,1,38,0)
 
"PKG",197,22,1,"PAH",1,1,39,0)
 
"PKG",197,22,1,"PAH",1,1,40,0)
 
"PKG",197,22,1,"PAH",1,1,41,0)
 
"PKG",197,22,1,"PAH",1,1,42,0)
 
"PKG",197,22,1,"PAH",1,1,43,0)
 
"PKG",197,22,1,"PAH",1,1,44,0)
 
"PKG",197,22,1,"PAH",1,1,45,0)
                    editing MESSAGE TEXT
"PKG",197,22,1,"PAH",1,1,46,0)
 
"PKG",197,22,1,"PAH",1,1,47,0)
Do you want to copy a packman message into the Message Text? No// 
"PKG",197,22,1,"PAH",1,1,48,0)
 
"PKG",197,22,1,"PAH",1,1,49,0)
  MESSAGE TEXT:. . .
"PKG",197,22,1,"PAH",1,1,50,0)
       . . .
"PKG",197,22,1,"PAH",1,1,51,0)
"^DD",53.45,53.456,0,"NM","OTHER PRINT INFO")
"PKG",197,22,1,"PAH",1,1,52,0)
 
"PKG",197,22,1,"PAH",1,1,53,0)
"^DD",53.45,53.456,0,"UP")
"PKG",197,22,1,"PAH",1,1,54,0)
53.45
"PKG",197,22,1,"PAH",1,1,55,0)
"^DD",53.45,53.456,.01,0)
"PKG",197,22,1,"PAH",1,1,56,0)
OTHER PRINT INFO (LONG)^WLx^^0;1^Q
"PKG",197,22,1,"PAH",1,1,57,0)
"^DD",53.45,53.456,.01,"DT")
"PKG",197,22,1,"PAH",1,1,58,0)
3111104
"PKG",197,22,1,"PAH",1,1,59,0)
  
"PKG",197,22,1,"PAH",1,1,60,0)
 
"PKG",197,22,1,"PAH",1,1,61,0)
    Edit? NO// 
"PKG",197,22,1,"PAH",1,1,62,0)
Select ROUTINE NAME: PSGOTR// ^
"PKG",197,22,1,"PAH",1,1,63,0)
 
"PKG",197,22,1,"PAH",1,1,64,0)
Select PATCH: 
"PKG",197,22,1,"PAH",1,1,65,0)
 
"PKG",197,22,1,"PAH",1,1,66,0)
You have 402 new messages.  (Last arrival: 07/06/12@08:11)
"PKG",197,22,1,"PAH",1,1,67,0)
 
"PKG",197,22,1,"PAH",1,1,68,0)
You've got PRIORITY mail!
"PKG",197,22,1,"PAH",1,1,69,0)
 
"PKG",197,22,1,"PAH",1,1,70,0)
 
"PKG",197,22,1,"PAH",1,1,71,0)
Select Developer's Menu Option: ^DISPLAY A PATch
"PKG",197,22,1,"PAH",1,1,72,0)
 
"PKG",197,22,1,"PAH",1,1,73,0)
Select PATCH: PSJ*%*267 ??
"PKG",197,22,1,"PAH",1,1,74,0)
 
"PKG",197,22,1,"PAH",1,1,75,0)
Select PATCH: PSj*5*267    IMR4 NO ALLERGY ASSESSMENT, UNLIMITED LENGTH 
"PKG",197,22,1,"PAH",1,1,76,0)
UND JCH
"PKG",197,22,1,"PAH",1,1,77,0)
 
"PKG",197,22,1,"PAH",1,1,78,0)
DEVICE: HOME//   SSH VIRTUAL TERMINAL
"PKG",197,22,1,"PAH",1,1,79,0)
 
"PKG",197,22,1,"PAH",1,1,80,0)
 
"PKG",197,22,1,"PAH",1,1,81,0)
 
"PKG",197,22,1,"PAH",1,1,82,0)
 
"PKG",197,22,1,"PAH",1,1,83,0)
 
"PKG",197,22,1,"PAH",1,1,84,0)
 
"PKG",197,22,1,"PAH",1,1,85,0)
 
"PKG",197,22,1,"PAH",1,1,86,0)
 
"PKG",197,22,1,"PAH",1,1,87,0)
VistA Patch Display                                                   
"PKG",197,22,1,"PAH",1,1,88,0)
Page: 1
"PKG",197,22,1,"PAH",1,1,89,0)
==========================================================================
"PKG",197,22,1,"PAH",1,1,90,0)
===
"PKG",197,22,1,"PAH",1,1,91,0)
Run Date: JUL 06, 2012                      Designation: PSJ*5*267  TEST 
"PKG",197,22,1,"PAH",1,1,92,0)
v23
"PKG",197,22,1,"PAH",1,1,93,0)
Package : INPATIENT MEDICATIONS             Priority   : MANDATORY
"PKG",197,22,1,"PAH",1,1,94,0)
Version : 5                                 Status     : UNDER DEVELOPMENT
"PKG",197,22,1,"PAH",1,1,95,0)
==========================================================================
"PKG",197,22,1,"PAH",1,1,96,0)
===
"PKG",197,22,1,"PAH",1,1,97,0)
 
"PKG",197,22,1,"PAH",1,1,98,0)
Associated patches: (v)PSJ*5*200   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,99,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,100,0)
                    (v)PSJ*5*253   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,101,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,102,0)
                    (v)PSJ*5*254   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,103,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,104,0)
                    (v)PSJ*5*263   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,105,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,106,0)
                    (v)PSJ*5*265   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,107,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,108,0)
                    (v)PSJ*5*273   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,109,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,110,0)
                    
"PKG",197,22,1,"PAH",1,1,111,0)
 
"PKG",197,22,1,"PAH",1,1,112,0)
Subject:  IMR4 NO ALLERGY ASSESSMENT, UNLIMITED LENGTH SI/OPI
"PKG",197,22,1,"PAH",1,1,113,0)
 
"PKG",197,22,1,"PAH",1,1,114,0)
Category:  ROUTINE
"PKG",197,22,1,"PAH",1,1,115,0)
           ENHANCEMENT
"PKG",197,22,1,"PAH",1,1,116,0)
           OTHER
"PKG",197,22,1,"PAH",1,1,117,0)
 
"PKG",197,22,1,"PAH",1,1,118,0)
 
"PKG",197,22,1,"PAH",1,1,119,0)
Press RETURN to continue or '^' to stop 
"PKG",197,22,1,"PAH",1,1,120,0)
 
"PKG",197,22,1,"PAH",1,1,121,0)
 
"PKG",197,22,1,"PAH",1,1,122,0)
 
"PKG",197,22,1,"PAH",1,1,123,0)
 
"PKG",197,22,1,"PAH",1,1,124,0)
 
"PKG",197,22,1,"PAH",1,1,125,0)
 
"PKG",197,22,1,"PAH",1,1,126,0)
 
"PKG",197,22,1,"PAH",1,1,127,0)
VistA Patch Display                                                   
"PKG",197,22,1,"PAH",1,1,128,0)
Page: 2
"PKG",197,22,1,"PAH",1,1,129,0)
==========================================================================
"PKG",197,22,1,"PAH",1,1,130,0)
===
"PKG",197,22,1,"PAH",1,1,131,0)
Run Date: JUL 06, 2012                      Designation: PSJ*5*267  TEST 
"PKG",197,22,1,"PAH",1,1,132,0)
v23
"PKG",197,22,1,"PAH",1,1,133,0)
Package : INPATIENT MEDICATIONS             Priority   : MANDATORY
"PKG",197,22,1,"PAH",1,1,134,0)
Version : 5                                 Status     : UNDER DEVELOPMENT
"PKG",197,22,1,"PAH",1,1,135,0)
==========================================================================
"PKG",197,22,1,"PAH",1,1,136,0)
===
"PKG",197,22,1,"PAH",1,1,137,0)
 
"PKG",197,22,1,"PAH",1,1,138,0)
Description:
"PKG",197,22,1,"PAH",1,1,139,0)
===========
"PKG",197,22,1,"PAH",1,1,140,0)
 
"PKG",197,22,1,"PAH",1,1,141,0)
******************************* WARNING **********************************
"PKG",197,22,1,"PAH",1,1,142,0)
 
"PKG",197,22,1,"PAH",1,1,143,0)
If your facility has the Pyxis/Omnicell/McKesson interface from ILC this
"PKG",197,22,1,"PAH",1,1,144,0)
patch will overwrite any local modifications in routines PSJOEA2, PSGOEE, 
"PKG",197,22,1,"PAH",1,1,145,0)
PSGOETO, and PSGOEV. This could affect certain orders being sent across
"PKG",197,22,1,"PAH",1,1,146,0)
this interface. The modifications will have to be reintroduced following
"PKG",197,22,1,"PAH",1,1,147,0)
installation of this patch.
"PKG",197,22,1,"PAH",1,1,148,0)
 
"PKG",197,22,1,"PAH",1,1,149,0)
**************************************************************************
"PKG",197,22,1,"PAH",1,1,150,0)
 
"PKG",197,22,1,"PAH",1,1,151,0)
 
"PKG",197,22,1,"PAH",1,1,152,0)
 
"PKG",197,22,1,"PAH",1,1,153,0)
Press RETURN to continue or '^' to stop ^
"PKG",197,22,1,"PAH",1,1,154,0)
 
"PKG",197,22,1,"PAH",1,1,155,0)
 
"PKG",197,22,1,"PAH",1,1,156,0)
 
"PKG",197,22,1,"PAH",1,1,157,0)
Select PATCH: PSJ*5*267    IMR4 NO ALLERGY ASSESSMENT, UNLIMITED LENGTH 
"PKG",197,22,1,"PAH",1,1,158,0)
UND JCH
"PKG",197,22,1,"PAH",1,1,159,0)
 
"PKG",197,22,1,"PAH",1,1,160,0)
DEVICE: HOME// ;;99999  SSH VIRTUAL TERMINAL
"PKG",197,22,1,"PAH",1,1,161,0)
 
"PKG",197,22,1,"PAH",1,1,162,0)
 
"PKG",197,22,1,"PAH",1,1,163,0)
 
"PKG",197,22,1,"PAH",1,1,164,0)
 
"PKG",197,22,1,"PAH",1,1,165,0)
 
"PKG",197,22,1,"PAH",1,1,166,0)
 
"PKG",197,22,1,"PAH",1,1,167,0)
 
"PKG",197,22,1,"PAH",1,1,168,0)
 
"PKG",197,22,1,"PAH",1,1,169,0)
VistA Patch Display                                                   
"PKG",197,22,1,"PAH",1,1,170,0)
Page: 1
"PKG",197,22,1,"PAH",1,1,171,0)
==========================================================================
"PKG",197,22,1,"PAH",1,1,172,0)
===
"PKG",197,22,1,"PAH",1,1,173,0)
Run Date: JUL 06, 2012                      Designation: PSJ*5*267  TEST 
"PKG",197,22,1,"PAH",1,1,174,0)
v23
"PKG",197,22,1,"PAH",1,1,175,0)
Package : INPATIENT MEDICATIONS             Priority   : MANDATORY
"PKG",197,22,1,"PAH",1,1,176,0)
Version : 5                                 Status     : UNDER DEVELOPMENT
"PKG",197,22,1,"PAH",1,1,177,0)
==========================================================================
"PKG",197,22,1,"PAH",1,1,178,0)
===
"PKG",197,22,1,"PAH",1,1,179,0)
 
"PKG",197,22,1,"PAH",1,1,180,0)
Associated patches: (v)PSJ*5*200   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,181,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,182,0)
                    (v)PSJ*5*253   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,183,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,184,0)
                    (v)PSJ*5*254   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,185,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,186,0)
                    (v)PSJ*5*263   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,187,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,188,0)
                    (v)PSJ*5*265   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,189,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,190,0)
                    (v)PSJ*5*273   <<= must be installed BEFORE 
"PKG",197,22,1,"PAH",1,1,191,0)
`PSJ*5*267'
"PKG",197,22,1,"PAH",1,1,192,0)
                    
"PKG",197,22,1,"PAH",1,1,193,0)
 
"PKG",197,22,1,"PAH",1,1,194,0)
Subject:  IMR4 NO ALLERGY ASSESSMENT, UNLIMITED LENGTH SI/OPI
"PKG",197,22,1,"PAH",1,1,195,0)
 
"PKG",197,22,1,"PAH",1,1,196,0)
Category:  ROUTINE
"PKG",197,22,1,"PAH",1,1,197,0)
           ENHANCEMENT
"PKG",197,22,1,"PAH",1,1,198,0)
           OTHER
"PKG",197,22,1,"PAH",1,1,199,0)
 
"PKG",197,22,1,"PAH",1,1,200,0)
Description:
"PKG",197,22,1,"PAH",1,1,201,0)
===========
"PKG",197,22,1,"PAH",1,1,202,0)
 
"PKG",197,22,1,"PAH",1,1,203,0)
******************************* WARNING **********************************
"PKG",197,22,1,"PAH",1,1,204,0)
 
"PKG",197,22,1,"PAH",1,1,205,0)
If your facility has the Pyxis/Omnicell/McKesson interface from ILC this
"PKG",197,22,1,"PAH",1,1,206,0)
patch will overwrite any local modifications in routines PSJOEA2, PSGOEE, 
"PKG",197,22,1,"PAH",1,1,207,0)
PSGOETO, and PSGOEV. This could affect certain orders being sent across
"PKG",197,22,1,"PAH",1,1,208,0)
this interface. The modifications will have to be reintroduced following
"PKG",197,22,1,"PAH",1,1,209,0)
installation of this patch.
"PKG",197,22,1,"PAH",1,1,210,0)
 
"PKG",197,22,1,"PAH",1,1,211,0)
**************************************************************************
"PKG",197,22,1,"PAH",1,1,212,0)
 
"PKG",197,22,1,"PAH",1,1,213,0)
Enhancements
"PKG",197,22,1,"PAH",1,1,214,0)
=====================
"PKG",197,22,1,"PAH",1,1,215,0)
 
"PKG",197,22,1,"PAH",1,1,216,0)
1. Special Instructions/Other Print Info
"PKG",197,22,1,"PAH",1,1,217,0)
 ________________________________________
"PKG",197,22,1,"PAH",1,1,218,0)
 With this enhancement, Special Instructions and Other Print Info have
"PKG",197,22,1,"PAH",1,1,219,0)
 been modified to support an unlimited amount of text. The existing
"PKG",197,22,1,"PAH",1,1,220,0)
 functionality that copies the provider comments from the Computerized
"PKG",197,22,1,"PAH",1,1,221,0)
 Patient Record System (CPRS) to be copied into each field has been
"PKG",197,22,1,"PAH",1,1,222,0)
 retained, and an additional action has been added to optionally open a
"PKG",197,22,1,"PAH",1,1,223,0)
 word processing edit dialog after copying the provider comments into the
"PKG",197,22,1,"PAH",1,1,224,0)
 appropriate field (Special Instructions for Unit Dose, Other Print Info 
"PKG",197,22,1,"PAH",1,1,225,0)
 for IV).
"PKG",197,22,1,"PAH",1,1,226,0)
 
"PKG",197,22,1,"PAH",1,1,227,0)
 Special Instructions and Other Print Info may also be entered
"PKG",197,22,1,"PAH",1,1,228,0)
 and/or edited from within Inpatient Medications V. 5.0 order entry 
"PKG",197,22,1,"PAH",1,1,229,0)
 options.
"PKG",197,22,1,"PAH",1,1,230,0)
 
"PKG",197,22,1,"PAH",1,1,231,0)
 Prior to this enhancement, Inpatient Medications maximum character
"PKG",197,22,1,"PAH",1,1,232,0)
 length for Special Instructions was 180 characters and for Other Print
"PKG",197,22,1,"PAH",1,1,233,0)
 Info the maximum length was 60 characters. This enhancement resolves
"PKG",197,22,1,"PAH",1,1,234,0)
 Patient Safety Issues PSPO 42, 1466 / Remedy Ticket HD336419
"PKG",197,22,1,"PAH",1,1,235,0)
 - Comment lengths between CPRS and Pharmacy.
"PKG",197,22,1,"PAH",1,1,236,0)
 
"PKG",197,22,1,"PAH",1,1,237,0)
2. No Allergy Assessment
"PKG",197,22,1,"PAH",1,1,238,0)
 ________________________ 
"PKG",197,22,1,"PAH",1,1,239,0)
 The No Allergy Assessment enhancement provides an interactive alert to
"PKG",197,22,1,"PAH",1,1,240,0)
 the pharmacist in Inpatient Medications V. 5.0 when no allergy assessment
"PKG",197,22,1,"PAH",1,1,241,0)
 is on file for the patient, and a method for the pharmacist to enter an
"PKG",197,22,1,"PAH",1,1,242,0)
 allergy assessment after receiving the alert.  A pharmacy intervention 
"PKG",197,22,1,"PAH",1,1,243,0)
 is automatically created if the pharmacist chooses to not enter an
"PKG",197,22,1,"PAH",1,1,244,0)
 assessment. 
"PKG",197,22,1,"PAH",1,1,245,0)
 
"PKG",197,22,1,"PAH",1,1,246,0)
 The No Allergy Assessment functionality will be available at the 
"PKG",197,22,1,"PAH",1,1,247,0)
 following options:
"PKG",197,22,1,"PAH",1,1,248,0)
 
"PKG",197,22,1,"PAH",1,1,249,0)
   Inpatient Order Entry [PSJ OE]
"PKG",197,22,1,"PAH",1,1,250,0)
   Non-Verified/Pending Orders [PSJU VBW]
"PKG",197,22,1,"PAH",1,1,251,0)
   Order Entry [PSJU NE]
"PKG",197,22,1,"PAH",1,1,252,0)
   Order Entry (IV) [PSJI ORDER]
"PKG",197,22,1,"PAH",1,1,253,0)
   Profile (IV) [PSJI PROFILE]
"PKG",197,22,1,"PAH",1,1,254,0)
 
"PKG",197,22,1,"PAH",1,1,255,0)
When a patient with no allergy assessment is selected from one of the
"PKG",197,22,1,"PAH",1,1,256,0)
affected options, the following message will be displayed to the
"PKG",197,22,1,"PAH",1,1,257,0)
pharmacist: 
"PKG",197,22,1,"PAH",1,1,258,0)
 
"PKG",197,22,1,"PAH",1,1,259,0)
"NO ALLERGY ASSESSMENT exists for this patient! Would you like to enter
"PKG",197,22,1,"PAH",1,1,260,0)
one now?" 
"PKG",197,22,1,"PAH",1,1,261,0)
 
"PKG",197,22,1,"PAH",1,1,262,0)
 - If the pharmacist enters 'YES' at this prompt, they are prompted
"PKG",197,22,1,"PAH",1,1,263,0)
   for allergy information. 
"PKG",197,22,1,"PAH",1,1,264,0)
 - If the pharmacist enters 'NO' at this prompt, a pharmacist intervention
"PKG",197,22,1,"PAH",1,1,265,0)
   is created, with a type of 'NO ALLERGY ASSESSMENT'. The pharmacist is
"PKG",197,22,1,"PAH",1,1,266,0)
   then prompted for Provider and Recommendation. A new Recommendation,
"PKG",197,22,1,"PAH",1,1,267,0)
   'UNABLE TO ASSESS', has been created specifically  for this type of 
"PKG",197,22,1,"PAH",1,1,268,0)
   intervention.
"PKG",197,22,1,"PAH",1,1,269,0)
 
"PKG",197,22,1,"PAH",1,1,270,0)
 This enhancement will address Patient Safety Issue PSPO 445.
"PKG",197,22,1,"PAH",1,1,271,0)
 
"PKG",197,22,1,"PAH",1,1,272,0)
 
"PKG",197,22,1,"PAH",1,1,273,0)
Defects Addressed
"PKG",197,22,1,"PAH",1,1,274,0)
=========================
"PKG",197,22,1,"PAH",1,1,275,0)
 
"PKG",197,22,1,"PAH",1,1,276,0)
1. HD 187184 - IV Med Stop Date
"PKG",197,22,1,"PAH",1,1,277,0)
 
"PKG",197,22,1,"PAH",1,1,278,0)
   Problem
"PKG",197,22,1,"PAH",1,1,279,0)
   -------
"PKG",197,22,1,"PAH",1,1,280,0)
   When an IV order is renewed the status automatically changes to
"PKG",197,22,1,"PAH",1,1,281,0)
   expired, but the stop date does not change to the time the order
"PKG",197,22,1,"PAH",1,1,282,0)
   actually stops.
"PKG",197,22,1,"PAH",1,1,283,0)
 
"PKG",197,22,1,"PAH",1,1,284,0)
   Resolution
"PKG",197,22,1,"PAH",1,1,285,0)
   ----------
"PKG",197,22,1,"PAH",1,1,286,0)
   Routine PSJHL3 has been modified to correctly set the stop date of the
"PKG",197,22,1,"PAH",1,1,287,0)
   order that has been renewed to the time of renewal. 
"PKG",197,22,1,"PAH",1,1,288,0)
 
"PKG",197,22,1,"PAH",1,1,289,0)
 
"PKG",197,22,1,"PAH",1,1,290,0)
 2. HD 176676/PSPO 480 - Inpatient doesn't change order status to Expired.
"PKG",197,22,1,"PAH",1,1,291,0)
    
"PKG",197,22,1,"PAH",1,1,292,0)
    Problem
"PKG",197,22,1,"PAH",1,1,293,0)
    -------
"PKG",197,22,1,"PAH",1,1,294,0)
    The Inpatient Medications V. 5.0 package does not change order status
"PKG",197,22,1,"PAH",1,1,295,0)
    to Expired when sending orders to CPRS with Stop Date/Time in the 
"PKG",197,22,1,"PAH",1,1,296,0)
    past.
"PKG",197,22,1,"PAH",1,1,297,0)
 
"PKG",197,22,1,"PAH",1,1,298,0)
    Solution:
"PKG",197,22,1,"PAH",1,1,299,0)
    ---------
"PKG",197,22,1,"PAH",1,1,300,0)
    Routine PSJHL3 has been modified to change the order status to 
"PKG",197,22,1,"PAH",1,1,301,0)
    Expired, if the order's Stop Date/Time is in the past, when sending 
"PKG",197,22,1,"PAH",1,1,302,0)
    orders to CPRS. 
"PKG",197,22,1,"PAH",1,1,303,0)
    **This is a partial solution addressing Inpatient Medications V.5.0
"PKG",197,22,1,"PAH",1,1,304,0)
      functionality only. Patch OR*3*350 addresses CPRS GUI functionality.
"PKG",197,22,1,"PAH",1,1,305,0)
 
"PKG",197,22,1,"PAH",1,1,306,0)
 3. HD 377288 (original) - Default response should be "No"
"PKG",197,22,1,"PAH",1,1,307,0)
    
"PKG",197,22,1,"PAH",1,1,308,0)
    Problem
"PKG",197,22,1,"PAH",1,1,309,0)
    -------
"PKG",197,22,1,"PAH",1,1,310,0)
    When an Inpatient Unit Dose order's Dosage Ordered field does not 
"PKG",197,22,1,"PAH",1,1,311,0)
    match the dosage indicated by the Dispense Drug and Units per 
"PKG",197,22,1,"PAH",1,1,312,0)
    Dose fields, the warning prompt "Would you like to continue
"PKG",197,22,1,"PAH",1,1,313,0)
    verifying the order?" is displayed after accepting the order via the 
"PKG",197,22,1,"PAH",1,1,314,0)
    AC-Accept action. The prompt's default response is "Yes", even though 
"PKG",197,22,1,"PAH",1,1,315,0)
    the order is flawed.
"PKG",197,22,1,"PAH",1,1,316,0)
                         
"PKG",197,22,1,"PAH",1,1,317,0)
    The Inpatient Medications Workgroup has requested 
"PKG",197,22,1,"PAH",1,1,318,0)
    this be changed to "No".
"PKG",197,22,1,"PAH",1,1,319,0)
 
"PKG",197,22,1,"PAH",1,1,320,0)
    Solution
"PKG",197,22,1,"PAH",1,1,321,0)
    -------- 
"PKG",197,22,1,"PAH",1,1,322,0)
    When an Inpatient Unit Dose order's Dosage Ordered fi eld does not 
"PKG",197,22,1,"PAH",1,1,323,0)
    match the dosage indicated by the Dispense Drug and Units per 
"PKG",197,22,1,"PAH",1,1,324,0)
    Dose fields, the default response for the prompt "Would you like to
"PKG",197,22,1,"PAH",1,1,325,0)
    continue verifying the order?" will be changed to "No", as requested 
"PKG",197,22,1,"PAH",1,1,326,0)
    by the Inpatient Medications Workgroup.
"PKG",197,22,1,"PAH",1,1,327,0)
 
"PKG",197,22,1,"PAH",1,1,328,0)
 
"PKG",197,22,1,"PAH",1,1,329,0)
 4. HD 273000 (original) - Field Validation Not Correct
"PKG",197,22,1,"PAH",1,1,330,0)
 
"PKG",197,22,1,"PAH",1,1,331,0)
    Problem
"PKG",197,22,1,"PAH",1,1,332,0)
    -------
"PKG",197,22,1,"PAH",1,1,333,0)
    When a second Dispense drug is added to a Unit Dose medication order,
"PKG",197,22,1,"PAH",1,1,334,0)
    and no Dosage Ordered is selected, the following message display:
"PKG",197,22,1,"PAH",1,1,335,0)
 
"PKG",197,22,1,"PAH",1,1,336,0)
        THE FOLLOWING IS EITHER INVALID OR MISSING FROM THIS ORDER:
"PKG",197,22,1,"PAH",1,1,337,0)
 
"PKG",197,22,1,"PAH",1,1,338,0)
        THIS FIELD IS NECESSARY FOR VERIFICATION.
"PKG",197,22,1,"PAH",1,1,339,0)
        Enter RETURN to continue or '^' to exit: 
"PKG",197,22,1,"PAH",1,1,340,0)
 
"PKG",197,22,1,"PAH",1,1,341,0)
    Note that there is no actual field name displayed as an invalid field.
"PKG",197,22,1,"PAH",1,1,342,0)
    This is incorrect. 
"PKG",197,22,1,"PAH",1,1,343,0)
 
"PKG",197,22,1,"PAH",1,1,344,0)
    Solution
"PKG",197,22,1,"PAH",1,1,345,0)
    --------
"PKG",197,22,1,"PAH",1,1,346,0)
    In CHK^PSGOEV the variable CHK gets set to 8 and there is no handling
"PKG",197,22,1,"PAH",1,1,347,0)
    for a value of 8. The message is correct when CHK is set to 7.
"PKG",197,22,1,"PAH",1,1,348,0)
 
"PKG",197,22,1,"PAH",1,1,349,0)
 
"PKG",197,22,1,"PAH",1,1,350,0)
 5. HD 517634/PSPO 2137 - Provider Comments not displayed.
"PKG",197,22,1,"PAH",1,1,351,0)
 
"PKG",197,22,1,"PAH",1,1,352,0)
    Problem
"PKG",197,22,1,"PAH",1,1,353,0)
    -------
"PKG",197,22,1,"PAH",1,1,354,0)
    Provider Comments for continuous IV orders are not displaying in CPRS
"PKG",197,22,1,"PAH",1,1,355,0)
    after the order is verified in Inpatient Medications.
"PKG",197,22,1,"PAH",1,1,356,0)
 
"PKG",197,22,1,"PAH",1,1,357,0)
    Resolution
"PKG",197,22,1,"PAH",1,1,358,0)
    ----------
"PKG",197,22,1,"PAH",1,1,359,0)
    When IV orders are verified in Inpatient Medications, if the order
"PKG",197,22,1,"PAH",1,1,360,0)
    contains Provider Comments, include the Provider Comments in the
"PKG",197,22,1,"PAH",1,1,361,0)
    update sent to CPRS in order to keep the order synchronized.
"PKG",197,22,1,"PAH",1,1,362,0)
 
"PKG",197,22,1,"PAH",1,1,363,0)
 6. HD 586428/PSPO 2137 - Provider Comments not displayed after Verify.
"PKG",197,22,1,"PAH",1,1,364,0)
 
"PKG",197,22,1,"PAH",1,1,365,0)
    Problem
"PKG",197,22,1,"PAH",1,1,366,0)
    -------
"PKG",197,22,1,"PAH",1,1,367,0)
    When an IV order is created with Provider Comments, and then edited
"PKG",197,22,1,"PAH",1,1,368,0)
    prior to verification so as to trigger the creation of a new order,
"PKG",197,22,1,"PAH",1,1,369,0)
    Provider Comments do not carry over to the new order if auto-verify 
"PKG",197,22,1,"PAH",1,1,370,0)
    is not used. As a result, the verifying pharmacist may not see the
"PKG",197,22,1,"PAH",1,1,371,0)
    original Provider Comments.
"PKG",197,22,1,"PAH",1,1,372,0)
 
"PKG",197,22,1,"PAH",1,1,373,0)
    Solution
"PKG",197,22,1,"PAH",1,1,374,0)
    --------
"PKG",197,22,1,"PAH",1,1,375,0)
    Prior to the initial verification of an order, the original Provider 
"PKG",197,22,1,"PAH",1,1,376,0)
    Comments should carry over to new a order created due to edit, so that
"PKG",197,22,1,"PAH",1,1,377,0)
    the pharmacist verifying the order has an opportunity to see the 
"PKG",197,22,1,"PAH",1,1,378,0)
    Provider Comments.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
53
"RTN","PSGAL5")
0^48^B28188853^B17746718
"RTN","PSGAL5",1,0)
PSGAL5 ;BIR/CML3-ACTIVITY LOGGER ;22 Jan 99 / 8:00 AM
"RTN","PSGAL5",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**3,22,50,267**;16 DEC 97;Build 158
"RTN","PSGAL5",3,0)
 ;
"RTN","PSGAL5",4,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGAL5",5,0)
 ;Reference to ^DD is supported by DBIA 903
"RTN","PSGAL5",6,0)
 ;
"RTN","PSGAL5",7,0)
EN ;
"RTN","PSGAL5",8,0)
 N PSJ9,PSJ99 F Q=1:1 Q:'$D(DA(Q+1))
"RTN","PSGAL5",9,0)
 S PSGAL("D0")=DA(Q),PSGAL("D1")=$S(Q=1:DA,1:DA(Q-1)) Q:PSGAL("D0")["U"
"RTN","PSGAL5",10,0)
 I PSGAL("C")'=6000,$D(PSGALO),PSGALO S PSGAL("C")=PSGALO
"RTN","PSGAL5",11,0)
 I PSGAL("C")=6000,$D(PSGALR),PSGALR]"" S PSGAL("C")=PSGAL("C")+PSGALR
"RTN","PSGAL5",12,0)
 I $E(PSGAL("C"),1,2)=60 S OLD=X,FLD=$S($D(PSGALFF):PSGALFF,1:0),FN=$S($D(PSGALFN):PSGALFN,1:55.06) D FIELD^DID(FN,FLD,,"SPECIFIER","PSJ9") I OLD]"",$G(PSJ9("SPECIFIER"))["P" S XX=FN,YY=FLD D PNTR
"RTN","PSGAL5",13,0)
 I $E(PSGAL("C"),1,2)=60,OLD]"" D FIELD^DID(FN,FLD,,"SPECIFIER","PSJ9") I $G(PSJ9("SPECIFIER"))["S" S OLDS=$P($P(";"_$P(^DD(FN,FLD,0),"^",3),";"_OLD_":",2),";") I OLDS]"" S OLD=OLDS
"RTN","PSGAL5",14,0)
 S QQ=$G(^PS(55,PSGAL("D0"),5,PSGAL("D1"),9,0)) S:QQ="" QQ="^55.09D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSGAL5",15,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSGAL5",16,0)
 S Q=%_"^"_$S(PSGAL("C")=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGAL("C")_$S($E(PSGAL("C"),1,2)=60:"^"_$S('$D(^DD(FN,FLD,0)):FLD,$P(^(0),"^")]"":$P(^(0),"^"),1:FLD)_"^"_OLD,1:"")
"RTN","PSGAL5",17,0)
 I Q'["SPECIAL INSTRUCTIONS" S ^PS(55,PSGAL("D0"),5,PSGAL("D1"),9,PSGAL("N"),0)=Q I PSGAL("C")=6000,$D(PSGALEF) S PSGALEF=PSGALEF+1
"RTN","PSGAL5",18,0)
 I Q["SPECIAL INSTRUCTIONS",$$DIFFSI^PSJBCMA5(PSGAL("D0"),PSGAL("D1")) D
"RTN","PSGAL5",19,0)
 .Q:'$G(PSJSYSP)  Q:($G(^PS(53.45,PSJSYSP,5))="AL")
"RTN","PSGAL5",20,0)
 .S ^PS(55,PSGAL("D0"),5,PSGAL("D1"),9,PSGAL("N"),0)=Q
"RTN","PSGAL5",21,0)
 .S ^PS(55,PSGAL("D0"),5,PSGAL("D1"),9,PSGAL("N"),1,0)=$G(^PS(55,PSGAL("D0"),5,PSGAL("D1"),15,0))
"RTN","PSGAL5",22,0)
 .N LN S LN=0 F  S LN=$O(^PS(55,PSGAL("D0"),5,PSGAL("D1"),15,LN)) Q:'LN  D
"RTN","PSGAL5",23,0)
 ..S ^PS(55,PSGAL("D0"),5,PSGAL("D1"),9,PSGAL("N"),1,LN,0)=^PS(55,PSGAL("D0"),5,PSGAL("D1"),15,LN,0)
"RTN","PSGAL5",24,0)
 ;
"RTN","PSGAL5",25,0)
DONE ;
"RTN","PSGAL5",26,0)
 S PSGAL("D")=% K OLDS,FLD,FN,OLD,PSGALFF,PSGALFN,SS,XX,YY Q
"RTN","PSGAL5",27,0)
 ;
"RTN","PSGAL5",28,0)
PNTR ; find pointer value
"RTN","PSGAL5",29,0)
 F  D FIELD^DID(XX,YY,,"POINTER","PSJ99") S SS=PSJ99("POINTER"),XX=+$P(@("^"_SS_"0)"),"^",2),OLD=$P(@("^"_SS_OLD_",0)"),"^") D FIELD^DID(XX,.01,,"SPECIFIER","PSJ99") Q:$G(PSJ99("SPECIFIER"))'["P"  S YY=.01
"RTN","PSGAL5",30,0)
 Q
"RTN","PSGAL5",31,0)
 ;
"RTN","PSGAL5",32,0)
KILL ; if user merely reenters same data (tsk, tsk), kill record just written
"RTN","PSGAL5",33,0)
 I Q["SPECIAL INSTRUCTIONS" Q:$$COMPSI()
"RTN","PSGAL5",34,0)
 K ^PS(55,PSGAL("D0"),5,PSGAL("D1"),9,PSGAL("N"),0) I PSGAL("C")=6000,$D(PSGALEF),PSGALEF S PSGALEF=PSGALEF-1
"RTN","PSGAL5",35,0)
 Q
"RTN","PSGAL5",36,0)
 ;
"RTN","PSGAL5",37,0)
COMPSI() ; Compare old Special Instructions (long) to new Special Instructions (long)
"RTN","PSGAL5",38,0)
 N Q2,DIFF Q:'$G(DUZ) 0
"RTN","PSGAL5",39,0)
 S DIFF=0,Q2=0 F  S Q2=$O(^PS(55,PSGAL("D0"),5,PSGAL("D1"),15,Q2)) Q:'Q2!$G(DIFF)  D
"RTN","PSGAL5",40,0)
 .I $G(^PS(53.45,DUZ,5,Q2,0))'=^PS(55,PSGAL("D0"),5,PSGAL("D1"),15,Q2,0) S DIFF=1
"RTN","PSGAL5",41,0)
 Q $S(DIFF:1,1:0)
"RTN","PSGAL5",42,0)
 ;
"RTN","PSGAL5",43,0)
 ; Create new activity log entry in file #55.
"RTN","PSGAL5",44,0)
NEWUDAL(PSGALGP,PSGALORD,PSGALC,PSGFLD,PSGOLD,PSGOLDAR)  ;
"RTN","PSGAL5",45,0)
 ;
"RTN","PSGAL5",46,0)
 ;Where  PSGALGP  = PSGP (Required)
"RTN","PSGAL5",47,0)
 ;       PSGALORD = PSGORD (Required)
"RTN","PSGAL5",48,0)
 ;       PSGALC   = ACTIVITY CODE FROM #53.3 (Required)
"RTN","PSGAL5",49,0)
 ;       PSGFLD   = FIELD THAT CHANGED (Free text, optional)
"RTN","PSGAL5",50,0)
 ;       PSGOLD   = THE FIELDS OLD DATA VALUE (Free text, optional)
"RTN","PSGAL5",51,0)
 ;
"RTN","PSGAL5",52,0)
 ; Create 0 node activity log for order if not exists, and get next entry number
"RTN","PSGAL5",53,0)
 Q:PSGALGP["U"
"RTN","PSGAL5",54,0)
 S QQ=$G(^PS(55,PSGALGP,5,+PSGALORD,9,0)) S:QQ="" QQ="^55.09D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSGAL5",55,0)
 ;Set up data to be held in activity log record
"RTN","PSGAL5",56,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSGAL5",57,0)
 I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSGAL5",58,0)
 S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSGAL5",59,0)
 ; Create activity log entry     
"RTN","PSGAL5",60,0)
 I $D(PSGOLDAR),$$DIFFSI^PSJBCMA5(PSGALGP,PSGALORD) D
"RTN","PSGAL5",61,0)
 .S ^PS(55,PSGALGP,5,+PSGALORD,9,PSGAL("N"),0)=Q,^PS(55,PSGALGP,5,+PSGALORD,9,PSGAL("N"),1,0)=PSGOLDAR(0)
"RTN","PSGAL5",62,0)
 .N LN S LN=0 F  S LN=$O(PSGOLDAR(LN)) Q:'LN  D
"RTN","PSGAL5",63,0)
 ..S ^PS(55,PSGALGP,5,+PSGALORD,9,PSGAL("N"),1,LN,0)=PSGOLDAR(LN,0)
"RTN","PSGAL5",64,0)
 .N LN S LN=0 F  S LN=$O(^PS(53.45,+$G(PSJSYSP),5,LN)) Q:'LN  D
"RTN","PSGAL5",65,0)
 ..S ^PS(55,PSGALGP,5,+PSGALORD,9,PSGAL("N"),2,LN,0)=^PS(53.45,+$G(PSJSYSP),5,LN,0)
"RTN","PSGAL5",66,0)
 .S ^PS(53.45,+$G(PSJSYSP),5)="AL"
"RTN","PSGAL5",67,0)
 Q
"RTN","PSGAL5",68,0)
 ; Create new activity log entry
"RTN","PSGAL5",69,0)
NEWNVAL(PSGALORD,PSGALC,PSGFLD,PSGOLD,PSGOLDAR)  ;
"RTN","PSGAL5",70,0)
 ;
"RTN","PSGAL5",71,0)
 ;Where  PSGALORD = PSGORD (Required)
"RTN","PSGAL5",72,0)
 ;       PSGALC   = ACTIVITY CODE FROM #53.3 (Required)
"RTN","PSGAL5",73,0)
 ;       PSGFLD   = FIELD THAT CHANGED (Free text, optional)
"RTN","PSGAL5",74,0)
 ;       PSGOLD   = THE FIELDS OLD DATA VALUE (Free text, optional)
"RTN","PSGAL5",75,0)
 ;       PSGOLDAR = THE FIELDS OLD DATA VALUE, IF WP FIELD (array, optional)
"RTN","PSGAL5",76,0)
 ;
"RTN","PSGAL5",77,0)
 ;N PSGALORD,PSGALC,PSGFLD,PSGOLD
"RTN","PSGAL5",78,0)
 ;
"RTN","PSGAL5",79,0)
 ; Create 0 node activity log for order if not exists, and get next entry number
"RTN","PSGAL5",80,0)
 S QQ=$G(^PS(53.1,+PSGALORD,"A",0)) S:QQ="" QQ="^53.1119D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSGAL5",81,0)
 ;Set up data to be held in activity log record
"RTN","PSGAL5",82,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSGAL5",83,0)
 I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSGAL5",84,0)
 S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSGAL5",85,0)
 ; Create activity log entry
"RTN","PSGAL5",86,0)
 S ^PS(53.1,+PSGALORD,"A",PSGAL("N"),0)=Q
"RTN","PSGAL5",87,0)
 I $D(PSGOLDAR)&(Q["SPECIAL INSTRUCTIONS"!(Q["OTHER PRINT INFO")) D
"RTN","PSGAL5",88,0)
 .I Q["SPECIAL INSTRUCTIONS" Q:'$$DIFFSI^PSJBCMA5(+$G(DFN),PSGALORD)
"RTN","PSGAL5",89,0)
 .I Q["OTHER PRINT INFO" Q:'$$DIFFOPI^PSJBCMA5(+$G(DFN),PSGALORD)
"RTN","PSGAL5",90,0)
 .N LNCNT S LNCNT=$O(PSGOLDAR(""),-1) S ^PS(53.1,+PSGALORD,"A",PSGAL("N"),1,0)="^53.11195^"_+LNCNT_"^"_+LNCNT,^(1,0)=" "
"RTN","PSGAL5",91,0)
 .N LN S LN=0 F  S LN=$O(PSGOLDAR(LN)) Q:'LN  S ^PS(53.1,+PSGALORD,"A",PSGAL("N"),1,LN,0)=PSGOLDAR(LN,0)
"RTN","PSGAL5",92,0)
 Q
"RTN","PSGAL5",93,0)
 ;
"RTN","PSGAL5",94,0)
KILLNV   ; if user merely reenters same data (tsk, tsk), kill record just written
"RTN","PSGAL5",95,0)
 K ^PS(53.1,PSGAL("D0"),"A",PSGAL("N"),0) I PSGAL("C")=6000,$D(PSGALEF),PSGALEF S PSGALEF=PSGALEF-1
"RTN","PSGAL5",96,0)
 Q
"RTN","PSGMIV")
0^57^B42223209^B47833428
"RTN","PSGMIV",1,0)
PSGMIV ;BIR/MV-IV ORDER FOR THE 24 HOUR MAR. ;25 Nov 98 / 9:07 AM
"RTN","PSGMIV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,20,21,28,58,111,131,145,267**;16 DEC 97;Build 158
"RTN","PSGMIV",3,0)
 ;
"RTN","PSGMIV",4,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMIV",5,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMIV",6,0)
 ;
"RTN","PSGMIV",7,0)
START ;*** Read IV orders
"RTN","PSGMIV",8,0)
 S ON=""
"RTN","PSGMIV",9,0)
 F PSGMARED=PSGPLS-.0001:0 S PSGMARED=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED)) Q:'PSGMARED  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED,ON)) Q:ON=""  D IV
"RTN","PSGMIV",10,0)
 Q
"RTN","PSGMIV",11,0)
IV ;*** Sort IV orders for 24 Hrs MAR.
"RTN","PSGMIV",12,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT55^PSIVORFB
"RTN","PSGMIV",13,0)
 Q:P(2)>PSGPLF
"RTN","PSGMIV",14,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGMIV",15,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGMIV",16,0)
 S QST=$S(P(9)["PRN":"OVP",QST="O":"OVO",1:"CV")_XTYPE
"RTN","PSGMIV",17,0)
 N PSGMARWC  ;DEM (05/30/2006) - PSGMARWC is used to preserve original value of PSGMARWN (patient location) in case location is changed by an order with a clinic location.
"RTN","PSGMIV",18,0)
 S PSGMARWC=PSGMARWN
"RTN","PSGMIV",19,0)
 I $G(DRG) S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_ON_"V" D
"RTN","PSGMIV",20,0)
 . N A
"RTN","PSGMIV",21,0)
 . S A=$G(^PS(55,PSGP,"IV",+ON,"DSS")) I $P(A,"^")]"" S PSGMARWN="C!"_$P(A,"^") I $G(SUB1)]"",$G(SUB2)]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D
"RTN","PSGMIV",22,0)
 . . N X,X1,Y
"RTN","PSGMIV",23,0)
 . . D SPN^PSGMAR0
"RTN","PSGMIV",24,0)
 . . Q
"RTN","PSGMIV",25,0)
 . I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q
"RTN","PSGMIV",26,0)
 . S:PSGRBPPN="P" ^TMP($J,TM,PSGMARWN,PPN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMIV",27,0)
 . S:PSGRBPPN="R" ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMIV",28,0)
 S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC
"RTN","PSGMIV",29,0)
 Q
"RTN","PSGMIV",30,0)
PRT ;*** Print IV orders.
"RTN","PSGMIV",31,0)
 K TS,P,DRG NEW ON55,LN,PSJLABEL S PSJLABEL=1
"RTN","PSGMIV",32,0)
 S ON=$P(DAO,U,2),DFN=$P(PN,U,2) D:ON["V" GT55^PSIVORFB
"RTN","PSGMIV",33,0)
 D:ON["P" GT531^PSIVORFA(DFN,ON)
"RTN","PSGMIV",34,0)
 S TS=1,TMSTR="" I P(9)]"" D ORSET,TS^PSGMAR3(P(11))
"RTN","PSGMIV",35,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC1^PSGMI(P(X))
"RTN","PSGMIV",36,0)
 S PSGST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I PSGST'="O" S PSGST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGMIV",37,0)
 S PSGLFFD=PSGPLF
"RTN","PSGMIV",38,0)
 D INITOPI^PSGMMIVC
"RTN","PSGMIV",39,0)
 NEW NAMENEED,NEED,X S NAMENEED=0
"RTN","PSGMIV",40,0)
 D LNNEED,PRTIV
"RTN","PSGMIV",41,0)
 Q
"RTN","PSGMIV",42,0)
LNNEED ;*** Find lines needed per label.
"RTN","PSGMIV",43,0)
 ;*** If OPI<29 char, it is ok to put INITs in the same line.
"RTN","PSGMIV",44,0)
 ;*** Add number of lines needed for additives and solutions and 1 line
"RTN","PSGMIV",45,0)
 ;*** for infusion rate and x line for OPI. Divide by 5 to determine
"RTN","PSGMIV",46,0)
 ;*** of label(s) needed for this order.
"RTN","PSGMIV",47,0)
 F X="AD","SOL" D NAMENEED^PSJMUTL(X,47,.NEED) S NAMENEED=NAMENEED+NEED
"RTN","PSGMIV",48,0)
 N OPILEN,OPILAST S OPILAST=$S(($G(ON55)["V"):$O(^PS(55,DFN,"IV",ON55,10," "),-1),1:"") S OPILEN=$S(OPILAST:(74*OPILAST),1:$L(P("OPI")))
"RTN","PSGMIV",49,0)
 S X=(OPILEN\47)+((OPILEN#47)>28)+1+($P(P("OPI"),"^")]""&(P(4)="C"))
"RTN","PSGMIV",50,0)
 S X=(NAMENEED+X+2) S X=$S(X<6:1,1:((X-6)\5)+2)
"RTN","PSGMIV",51,0)
 S LN=$S(TS/6>X:TS/6,1:X)
"RTN","PSGMIV",52,0)
 Q
"RTN","PSGMIV",53,0)
 ;
"RTN","PSGMIV",54,0)
OS ; order record set
"RTN","PSGMIV",55,0)
 Q
"RTN","PSGMIV",56,0)
 ;
"RTN","PSGMIV",57,0)
PRTIV ;*** Print IV order on MAR
"RTN","PSGMIV",58,0)
 D ONHOLD^PSGMMAR2
"RTN","PSGMIV",59,0)
 I PSGMAROC,(PSGMAROC+LN)>6 D BOT^PSGMAR3,HEADER^PSGMAR3
"RTN","PSGMIV",60,0)
 NEW PSGL S PSGL="|"
"RTN","PSGMIV",61,0)
 S PSGMAROC=PSGMAROC+1 W !?6,"|",?19,"|",?48,PSGL,$G(TS(1)),?55,"|"
"RTN","PSGMIV",62,0)
 W !,$E(P("LOG"),1,5)," |"
"RTN","PSGMIV",63,0)
 I ON["V" D
"RTN","PSGMIV",64,0)
 . I $G(ONHOLD) W "O N  H O L D" Q
"RTN","PSGMIV",65,0)
 . W $E(P(2),1,5)_$E(P(2),9,14)," |",P(3)
"RTN","PSGMIV",66,0)
 . Q
"RTN","PSGMIV",67,0)
 W:ON["P" "P E N D I N G"
"RTN","PSGMIV",68,0)
 W ?39,"(",$E(PSGP(0))_$E(PSSN,8,12)_")"
"RTN","PSGMIV",69,0)
 W ?48,PSGL,$G(TS(2)),?55,"|" S L=3
"RTN","PSGMIV",70,0)
 NEW NAME,PSIVX
"RTN","PSGMIV",71,0)
 F PSIVX=0:0 S PSIVX=$O(DRG("AD",PSIVX)) Q:'PSIVX  D NAME^PSIVUTL(DRG("AD",PSIVX),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  W !,NAME(Y) W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:(PSIVX=1&((PSGST="O")!(PSGST="C"))) TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",72,0)
 W:$G(DRG("SOL",0)) !,"in "
"RTN","PSGMIV",73,0)
 NEW PSJPRT2
"RTN","PSGMIV",74,0)
 F PSIVX=0:0 S PSIVX=$O(DRG("SOL",PSIVX)) Q:'PSIVX  D NAME^PSIVUTL(DRG("SOL",PSIVX),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  D
"RTN","PSGMIV",75,0)
 . W:(Y>1!(PSIVX>1)) ! W ?4,NAME(Y) W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:L=3 TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",76,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",PSIVX),0),U,4) I PSJPRT2]"" W !?7,PSJPRT2 W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:L=3 TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",77,0)
 W !,$P(P("MR"),U,2)," ",P(9)," ",P(8) W ?48,PSGL,$G(TS(L)),?55,"|" I L>5,(L#5) W !
"RTN","PSGMIV",78,0)
 I '$O(DRG("AD",0))!('$O(DRG("SOL",0))) W !?48,PSGL,$G(TS(L)),?55,"|" S L=5
"RTN","PSGMIV",79,0)
 I P(4)="C",'(L#5),P("OPI")="" W !,"*CAUTION-CHEMOTHERAPY*" S L=L+1 Q
"RTN","PSGMIV",80,0)
 I P(4)="C" D L(1) W !,"*CAUTION-CHEMOTHERAPY*",?48,PSGL,$G(TS(L)),?55,"|"
"RTN","PSGMIV",81,0)
 I (L#5)=0,($L($P(P("OPI"),"^"))<29),(TS<7) S L=L+1
"RTN","PSGMIV",82,0)
 E  D L(1)
"RTN","PSGMIV",83,0)
 W:P("OPI")=""&(TS>6) !
"RTN","PSGMIV",84,0)
 I P("OPI")'="" I '$$OPI(PSGP,ON55) D
"RTN","PSGMIV",85,0)
 . W:(L#6)=1 !
"RTN","PSGMIV",86,0)
 . F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=$P($P(P("OPI"),"^")," ",Y) D  W Y1," "
"RTN","PSGMIV",87,0)
 . I ($X+$L(Y1))>47 W ?48,PSGL,$G(TS(L)),?55,"|" D L(1) W !
"RTN","PSGMIV",88,0)
 I L>TS,(L#6) W ?48,PSGL,$G(TS(L)),?55,"|" S L=L+1 W:L#6=0 !
"RTN","PSGMIV",89,0)
 I (TS-1)>L W ?48,PSGL,$G(TS(L)),?55,"|" D
"RTN","PSGMIV",90,0)
 . F L=L+1:1:TS-1 D L(0) W !?48,PSGL,$G(TS(L)),?55,"|"
"RTN","PSGMIV",91,0)
 . S L=L+1
"RTN","PSGMIV",92,0)
 F  Q:'(L#6)  W !?48,PSGL,$G(TS(L)),?55,"|" S L=L+1
"RTN","PSGMIV",93,0)
 I '(L#6),(P("OPI")="") W !
"RTN","PSGMIV",94,0)
 I P("OPI")]"",(L>6) W !
"RTN","PSGMIV",95,0)
 W ?29,"RPH: ",PSGLRPH,?38,"RN: ",PSGLRN,?48,PSGL,$G(TS(L)),?55,"|" W:PSGMAROC<6 !?7,LN2
"RTN","PSGMIV",96,0)
 Q
"RTN","PSGMIV",97,0)
 ;
"RTN","PSGMIV",98,0)
OPI(DFN,ORDER) ; Retrieve, format, and print Other Print Info
"RTN","PSGMIV",99,0)
 N TXTLN S TXTLN=$$GETSIOPI^PSJBCMA5($G(PSGP),$G(ON55),1) I 'TXTLN Q 0
"RTN","PSGMIV",100,0)
 N TXTLN,TXT,I,TMPMARX,MARXTXT,LAST,II,Y K MARX S LAST=0,TMPMARX="" S PSGL=$S(($G(PSGL)]""):PSGL,1:"|")
"RTN","PSGMIV",101,0)
 I ORDER["V" S TXTLN=0 F I=1:1 S TXTLN=$O(^PS(55,DFN,"IV",+ORDER,10,TXTLN)) Q:'TXTLN  D
"RTN","PSGMIV",102,0)
 .S MARXTXT=^PS(55,DFN,"IV",+ORDER,10,TXTLN,0) D TXT^PSGMUTL(MARXTXT,47) S LAST=$O(TMPMARX(" "),-1) S II=0 F  S II=$O(MARX(II)) Q:'II  S TMPMARX(LAST+II)=MARX(II)
"RTN","PSGMIV",103,0)
 I ORDER["P" S TXTLN=0 F I=1:1 S TXTLN=$O(^PS(53.1,+ORDER,16,TXTLN)) Q:'TXTLN  D
"RTN","PSGMIV",104,0)
 .S MARXTXT=^PS(53.1,+ORDER,16,TXTLN,0) D TXT^PSGMUTL(MARXTXT,47) S LAST=$O(TMPMARX(" "),-1) S II=0 F  S II=$O(MARX(II)) Q:'II  S TMPMARX(LAST+II)=MARX(II)
"RTN","PSGMIV",105,0)
 K MARX M MARX=TMPMARX S I=0 F  S I=$O(MARX(I)) Q:'I  D
"RTN","PSGMIV",106,0)
 . W:(L#6)=0 !
"RTN","PSGMIV",107,0)
 . S Y1=MARX(I) W Y1," ",?48,PSGL,$G(TS(L)),?55,"|" D L(1) W !
"RTN","PSGMIV",108,0)
 Q 1
"RTN","PSGMIV",109,0)
L(X) ;***Check to see if a new block is needed.
"RTN","PSGMIV",110,0)
 S L=L+X
"RTN","PSGMIV",111,0)
 I L#6=0,PSGMAROC<6 W !,"See next label for continuation",?48,PSGL,$G(TS(L)),?55,"|" W:PSGMAROC<6 !?7,LN2 S PSGMAROC=PSGMAROC+1,L=L+1 D
"RTN","PSGMIV",112,0)
 .I LN>6,(PSGMAROC>5) S MSG1="*** CONTINUE ON NEXT PAGE ***" D BOT^PSGMAR3,HEADER^PSGMAR3 S PSGMAROC=1
"RTN","PSGMIV",113,0)
 Q
"RTN","PSGMIV",114,0)
ORSET ; order record set
"RTN","PSGMIV",115,0)
 Q:PST["P"!P(9)=""
"RTN","PSGMIV",116,0)
 S PSGMFOR="",(SD,X)=$P(P(2),".") Q:X>PSGPLF  S FD=$P(P(3),"."),PSGOES="",X=P(9) D EN^PSGS0 S T=PSGS0XT
"RTN","PSGMIV",117,0)
 S X="" I "OB"]PST,$P(P(9),"^")'["@",P(2)'>PSGPLS,P(3)'<PSGPLF,P(11),T<1441,T'="D" S X=P(11),PSGPLC=1
"RTN","PSGMIV",118,0)
 E  I "OB"]PST!(PST["OV") K PSGMAR D SETL0 S (Q,X)="" F QX=0:0 S Q=$O(PSGMAR(Q)) Q:Q=""  S X=X_$E("0",2-$L(Q))_Q_"-"
"RTN","PSGMIV",119,0)
 S TMSTR=X
"RTN","PSGMIV",120,0)
 K HCD,HM,I,J,PSGD,PLSD,CD,M,MID,MN,ND,ND1,OD,ST,QD1,QD2,QQ,TS,UD,WDT,WS,WS1,X,X1,X2 Q
"RTN","PSGMIV",121,0)
 Q
"RTN","PSGMIV",122,0)
SETL0 ;*** Set variable to use in ^PSGPL0 to calculate admin time.
"RTN","PSGMIV",123,0)
 K PSGMAR S PSGPLC=0
"RTN","PSGMIV",124,0)
 S ND1=P(4),ST=P(2),PLSD=P(3),TS=P(11),MN=T,ND=P(9) I $S(ST'?7N1"."1N.E:1,1:PLSD'?7N1"."1N.E) S PSGPLC="OI" Q
"RTN","PSGMIV",125,0)
 D ENIV^PSGPL0
"RTN","PSGMIV",126,0)
 Q
"RTN","PSGMIV",127,0)
 ;
"RTN","PSGMIV",128,0)
RPHINIT(RPH) ; Find initial for the person who completed the IV order.
"RTN","PSGMIV",129,0)
 S RPH=$P($G(^PS(55,PSGP,"IV",+ON,4)),U,4)
"RTN","PSGMIV",130,0)
 S:+RPH RPH=$$DEFINIT(+RPH)
"RTN","PSGMIV",131,0)
 I RPH="" S RPH="_____"
"RTN","PSGMIV",132,0)
 Q
"RTN","PSGMIV",133,0)
DEFINIT(X)         ;
"RTN","PSGMIV",134,0)
 S X=$G(^VA(200,X,0)),RPH=$P(X,U,2) Q:RPH]"" RPH
"RTN","PSGMIV",135,0)
 S X=$P(X,U),RPH=$E(X,$F(X,","))_$E(X) Q RPH
"RTN","PSGMMIV")
0^58^B42167886^B45072835
"RTN","PSGMMIV",1,0)
PSGMMIV ;BIR/MV-IV ORDER FOR THE 7/14 DAY MAR. ;25 Nov 98 / 9:24 AM
"RTN","PSGMMIV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**20,21,58,111,131,145,267**;16 DEC 97;Build 158
"RTN","PSGMMIV",3,0)
 ;
"RTN","PSGMMIV",4,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMMIV",5,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMMIV",6,0)
 ;
"RTN","PSGMMIV",7,0)
START ;*** Read IV orders
"RTN","PSGMMIV",8,0)
 NEW MULTIPG
"RTN","PSGMMIV",9,0)
 S ON=""
"RTN","PSGMMIV",10,0)
 F PSGMARED=PSGMARSD-.0001:0 S PSGMARED=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED)) Q:'PSGMARED  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED,ON)) Q:ON=""  D IV
"RTN","PSGMMIV",11,0)
 Q
"RTN","PSGMMIV",12,0)
IV ;*** Sort IV orders for 24 Hrs, 7/14 Day MAR.
"RTN","PSGMMIV",13,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT55^PSIVORFB
"RTN","PSGMMIV",14,0)
 Q:P(2)>PSGMARFD
"RTN","PSGMMIV",15,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGMMIV",16,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGMMIV",17,0)
 S QST=$S(P(9)["PRN":"OVP",QST="O":"OVO",1:"CV")_XTYPE
"RTN","PSGMMIV",18,0)
 Q:(PSGMARS=2&(QST["C"))
"RTN","PSGMMIV",19,0)
 Q:(PSGMARS=1&(QST["O"))
"RTN","PSGMMIV",20,0)
 N PSGMARWC  ;DEM (05/30/2006) - PSGMARWC is used to preserve original value of PSGMARWN (patient location) in case location is changed by an order with a clinic location.
"RTN","PSGMMIV",21,0)
 S PSGMARWC=PSGMARWN
"RTN","PSGMMIV",22,0)
 I $G(DRG) S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_+ON_"V" D
"RTN","PSGMMIV",23,0)
 . N A
"RTN","PSGMMIV",24,0)
 . S A=$G(^PS(55,PSGP,"IV",+ON,"DSS")) I $P(A,"^")]"" S PSGMARWN="C!"_$P(A,"^") I $G(SUB1)]"",$G(SUB2)]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D
"RTN","PSGMMIV",25,0)
 . . N X,Y
"RTN","PSGMMIV",26,0)
 . . D SPN^PSGMMAR0
"RTN","PSGMMIV",27,0)
 . . Q
"RTN","PSGMMIV",28,0)
 . . ;
"RTN","PSGMMIV",29,0)
 . I PSGSS="P" S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q                         ;DAM  5-01-07 Print by PATIENT
"RTN","PSGMMIV",30,0)
 . I PSGSS="L" Q:((PSGINWDG="")&(PSGMARWN'["C!"))  S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q     ;DAM  5-01-07 Print by clinic group
"RTN","PSGMMIV",31,0)
 . I PSGSS="C" Q:((PSGINWD="")&(PSGMARWN'["C!"))  I ((PSGMARWN[PSGCLNC)!(PSGMARWN'["C!")) S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""  Q    ;DAM 5-01-07 Print by Clinic
"RTN","PSGMMIV",32,0)
 . ;
"RTN","PSGMMIV",33,0)
 . ;DAM 5-01-07 Set up XTMP global where location and patient names are switched for printing by WARD/PATIENT or WARD GROUP/PATIENT
"RTN","PSGMMIV",34,0)
 . I '$G(PSGREP) N PSGDEM1 S PSGDEM1=X D    ;transfer contents of patient drug information contained in "X" above to  a new variable temporarily
"RTN","PSGMMIV",35,0)
 . . S PSGREP="PSGM_"_$J
"RTN","PSGMMIV",36,0)
 . . S X1=DT,X2=1 D C^%DTC K %,%H,%T
"RTN","PSGMMIV",37,0)
 . . S ^XTMP(PSGREP,0)=X_U_DT
"RTN","PSGMMIV",38,0)
 . I PSGRBPPN="P",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D         ;Construct XTMP global for printing by WARD and sort by PATIENT
"RTN","PSGMMIV",39,0)
 . . S ^XTMP(PSGREP,TM,PPN,PSGMARWN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),PSGDEM1)=""
"RTN","PSGMMIV",40,0)
 . . D SPN^PSGMMAR0
"RTN","PSGMMIV",41,0)
 . I PSGRBPPN="P",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D       ;Construct XTMP global for printing by WARD GROUP and sort by PATIENT
"RTN","PSGMMIV",42,0)
 . . S ^XTMP(PSGREP,TM,PPN,PSGMARWN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),PSGDEM1)=""
"RTN","PSGMMIV",43,0)
 . . D SPN^PSGMMAR0
"RTN","PSGMMIV",44,0)
 . S X=$G(PSGDEM1)      ;Return value of X from PSGDEM1 back to X
"RTN","PSGMMIV",45,0)
 . ;
"RTN","PSGMMIV",46,0)
 . I PSGRBPPN="R",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D        ;Construct TMP global for printing by WARD and sort by ROOM/BED
"RTN","PSGMMIV",47,0)
 . . S ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMIV",48,0)
 . I PSGRBPPN="R",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D      ;Construct TMP global for printing by WARD GROUP and sort by ROOM/BED
"RTN","PSGMMIV",49,0)
 . . S ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMIV",50,0)
  . ;End DAM modifications 5-01-07
"RTN","PSGMMIV",51,0)
  . ;
"RTN","PSGMMIV",52,0)
 S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC
"RTN","PSGMMIV",53,0)
 Q
"RTN","PSGMMIV",54,0)
IVPRN ;*** Set ^tmp to store IV orders that have schedule of PRN.
"RTN","PSGMMIV",55,0)
 K P,DRG NEW ON55,CHEMO,TXT,PSJLABEL
"RTN","PSGMMIV",56,0)
 S ON=$P(DAOO,U,2),DFN=$P(PN,U,2),PSJLABEL=1
"RTN","PSGMMIV",57,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSGMMIV",58,0)
 D:ON["P" GT531^PSIVORFA(DFN,ON)
"RTN","PSGMMIV",59,0)
 D SETVAR,SETLTRT
"RTN","PSGMMIV",60,0)
 ;the two naked references below refer to the full reference to the right of the = sign
"RTN","PSGMMIV",61,0)
 S ^(1)=$G(^TMP($J,"1PRN",PG,LAB,1))_UP_"      |            |"
"RTN","PSGMMIV",62,0)
 S ^(2)=$G(^TMP($J,"1PRN",PG,LAB,2))_UP_$E(P("LOG"),1,5)_" |",LN=3
"RTN","PSGMMIV",63,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",64,0)
 S:ON["P" ^(2)=^(2)_"P E N D I N G"
"RTN","PSGMMIV",65,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",66,0)
 S:ON["V" ^(2)=^(2)_$E(P(2),1,5)_$E(P(2),9,14)_" |"_P(3)
"RTN","PSGMMIV",67,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",68,0)
 S ^(2)=$$SETSTR^VALM1("("_$E(PSGP(0))_$E(PSSN,8,12)_")",^(2),40,7)
"RTN","PSGMMIV",69,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  S TXT=$$WRTDRG^PSIVUTL(DRG("AD",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT)
"RTN","PSGMMIV",70,0)
 S TXT="in "
"RTN","PSGMMIV",71,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D
"RTN","PSGMMIV",72,0)
 . S TXT=TXT_$$WRTDRG^PSIVUTL(DRG("SOL",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",73,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",X),0),U,4) I PSJPRT2]"" S TXT=TXT_"   "_PSJPRT2 S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",74,0)
 S TXT=$P(P("MR"),U,2)_" "_P(9)_" "_P(8) D CHK(.TXT)
"RTN","PSGMMIV",75,0)
 I P(4)="C" S CHEMO="*CAUTION-CHEMOTHERAPY*" D:P("OPI")]"" CHK(CHEMO)
"RTN","PSGMMIV",76,0)
 I '$$OPI^PSGMIV(PSGP,ON55) S Y1="" F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=Y1_$P($P(P("OPI"),"^")," ",Y)_" " I $L(Y1)>47 D CHK(Y1) S Y1=""
"RTN","PSGMMIV",77,0)
 I $L(Y1)>28 D CHK(Y1) S Y1=""
"RTN","PSGMMIV",78,0)
 I Y1<29,'(LN#6) S TXT=$S((P("OPI")=""&$D(CHEMO)):CHEMO,1:Y1),X=29-$L(TXT),TXT=TXT_$$SP(X)_INIT
"RTN","PSGMMIV",79,0)
 E  D  S TXT=$$SP(29)_INIT,LN=LN+1
"RTN","PSGMMIV",80,0)
 . ;the following three naked references below refer to the full references to the right of the = sign
"RTN","PSGMMIV",81,0)
 .  I LN=5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_Y1
"RTN","PSGMMIV",82,0)
 .  E  D:$L(Y1) CHK(Y1) F LN=LN:1:5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_""
"RTN","PSGMMIV",83,0)
 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_TXT
"RTN","PSGMMIV",84,0)
 Q
"RTN","PSGMMIV",85,0)
SETVAR ;***Initialize variables.
"RTN","PSGMMIV",86,0)
 NEW TMSTR
"RTN","PSGMMIV",87,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC^PSGMI(P(X))
"RTN","PSGMMIV",88,0)
 S PSGST=$S(P(9)["PRN":"P",P(2)=P(3):"O",1:"C"),TMSTR=P(11),PSGLFFD=PSGMARFD
"RTN","PSGMMIV",89,0)
 D INITOPI^PSGMMIVC
"RTN","PSGMMIV",90,0)
 S INIT="RPH: "_PSGLRPH,INIT=INIT_$$SP(38-($L(INIT)+29))_"RN: "_PSGLRN
"RTN","PSGMMIV",91,0)
 ;*** If OPI<29 char, it is ok to put INITs in the same line.
"RTN","PSGMMIV",92,0)
 ;*** If OPI=""&it's a Chemo order, warning & Inits prt on same line.
"RTN","PSGMMIV",93,0)
 ;*** Add number lines needed for additives and solutions and 1 line
"RTN","PSGMMIV",94,0)
 ;*** for infusion rate and 1 line for start/stop date.
"RTN","PSGMMIV",95,0)
 ;*** Multiple labels can have up to 5 lines per label and the last
"RTN","PSGMMIV",96,0)
 ;*** label can have up to 6 lines..
"RTN","PSGMMIV",97,0)
 ;
"RTN","PSGMMIV",98,0)
 NEW X S NAMENEED=0
"RTN","PSGMMIV",99,0)
 F X="AD","SOL" D NAMENEED^PSJMUTL(X,47,.NEED) S NAMENEED=NAMENEED+NEED
"RTN","PSGMMIV",100,0)
 S MULTIPG=0,NEED=1
"RTN","PSGMMIV",101,0)
 ;* Find # of lines needed for OPI -- (($L(P("OPI"))\47)
"RTN","PSGMMIV",102,0)
 ;* If the last line in OPI < 29 --(($L(P("OPI")#47)>28) include init.
"RTN","PSGMMIV",103,0)
 S X=($L($P(P("OPI"),"^"))\47)+(($L($P(P("OPI"),"^"))#47)>28)+1+($P(P("OPI"),"^")]""&(P(4)="C"))
"RTN","PSGMMIV",104,0)
 S X=(NAMENEED+X+2) S:X>5 NEED=((X-6)\5)+2
"RTN","PSGMMIV",105,0)
 S:NEED>BL MULTIPG=1
"RTN","PSGMMIV",106,0)
 Q
"RTN","PSGMMIV",107,0)
CHK(TXT) ;
"RTN","PSGMMIV",108,0)
 ;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",109,0)
 I '(LN#6) S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_"See next label for continuation",LN=1 D
"RTN","PSGMMIV",110,0)
 . I PSGMAROC+1>(BL/2) D
"RTN","PSGMMIV",111,0)
 . . I PSGMAROC=BL-1,MULTIPG D
"RTN","PSGMMIV",112,0)
 . . .;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",113,0)
 . . .F LN=LN:1:6 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_"" S:LN=3 ^(LN)=UP_"*** CONTINUE ON NEXT PAGE ***"
"RTN","PSGMMIV",114,0)
 . . .S PG=PG+1,(LN,LT,RT)=1,(PSGMAROC,MULTIPG)=0 D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",115,0)
 . . E  D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",116,0)
 . E  D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",117,0)
 ;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",118,0)
 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_TXT,LN=LN+1,TXT=""
"RTN","PSGMMIV",119,0)
 Q
"RTN","PSGMMIV",120,0)
SETLTRT ;*** Increment line number for left or right label on PRN sheet.
"RTN","PSGMMIV",121,0)
 I (NEED+PSGMAROC)>BL S:PSGMAROC PG=PG+1,(LT,RT)=1,PSGMAROC=0
"RTN","PSGMMIV",122,0)
 I NEED+PSGMAROC=BL D  Q
"RTN","PSGMMIV",123,0)
 . I PSGMAROC<(BL/2) D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",124,0)
 . E  D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",125,0)
 I PSGMAROC,((NEED+PSGMAROC)>(BL/2)) S PSGMAROC=$S(PSGMAROC>(BL/2):PSGMAROC,1:(BL/2)) D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",126,0)
 E  D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",127,0)
 Q
"RTN","PSGMMIV",128,0)
SP(X) ;***Set up spaces need between info on TXT for the label.
"RTN","PSGMMIV",129,0)
 N Y S $P(Y," ",X)=" "
"RTN","PSGMMIV",130,0)
 Q $G(Y)
"RTN","PSGMMIVC")
0^59^B25628895^B25751401
"RTN","PSGMMIVC",1,0)
PSGMMIVC ;BIR/MV-PRT MULT DAYS MAR C ORDERS(IV) ;16 Mar 99 / 2:10 PM
"RTN","PSGMMIVC",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**20,21,28,31,35,67,58,110,267**;16 DEC 97;Build 158
"RTN","PSGMMIVC",3,0)
 ;
"RTN","PSGMMIVC",4,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMMIVC",5,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMMIVC",6,0)
 ;
"RTN","PSGMMIVC",7,0)
PRT ;*** Print IV orders.
"RTN","PSGMMIVC",8,0)
 K P,DRG,PSGLRN,PSGMARTS,PSGMARGD,PSGLFFD,TS N ON55,PSJLABEL S TS=1,PSGMARGD="",PSJLABEL=1
"RTN","PSGMMIVC",9,0)
 S ON=$P(DAO,U,2),DFN=$P(PN,U,2) D:$P(DAO,U,2)["V" GT55^PSIVORFB D:$P(DAO,U,2)["P" GT531^PSIVORFA(DFN,ON)  D:P(9)]"" OS S PSGLSSD=P(2),PSGLFFD=P(3)
"RTN","PSGMMIVC",10,0)
 I $G(P("DTYP"))'=1 K P(11)
"RTN","PSGMMIVC",11,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC1^PSGMI(P(X))
"RTN","PSGMMIVC",12,0)
 D INITOPI
"RTN","PSGMMIVC",13,0)
 S PSGST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I PSGST'="O" S PSGST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGMMIVC",14,0)
 I PSGST="O",(P(2)="") S PSGST=""
"RTN","PSGMMIVC",15,0)
 NEW NAMENEED,NEED,X S NAMENEED=0
"RTN","PSGMMIVC",16,0)
 D LNNEED^PSGMIV,PRTIV
"RTN","PSGMMIVC",17,0)
 Q
"RTN","PSGMMIVC",18,0)
 ;
"RTN","PSGMMIVC",19,0)
OS ; order record set
"RTN","PSGMMIVC",20,0)
 S FD=P(3),PSGOES="",X=P(9),SD=P(2) D EN^PSGS0 S T=PSGS0XT
"RTN","PSGMMIVC",21,0)
 S QQ="" I PST["C" D DTS^PSGMMAR0(P(9)) S SD=$P(SD,"."),QQ="" F X=0:0 S X=$O(PSGD(X)) Q:'X  S QQ=QQ_$S(X<SD:"",X>FD:"",'S:$P(PSGD(X),U),$D(S(X)):$P(PSGD(X),U),1:"")
"RTN","PSGMMIVC",22,0)
 I T="D",P(11)="" S P(11)=$E($P(P(2),".",2)_"0000",1,4)
"RTN","PSGMMIVC",23,0)
 S PSGMARTS=P(11),PSGMARGD=QQ
"RTN","PSGMMIVC",24,0)
 K TS D TS^PSGMAR3(P(11))
"RTN","PSGMMIVC",25,0)
 Q
"RTN","PSGMMIVC",26,0)
 ;
"RTN","PSGMMIVC",27,0)
PRTIV ;*** Print IV order on MAR
"RTN","PSGMMIVC",28,0)
 I PSGMAROC,(PSGMAROC+LN)>6 D BOT^PSGMMAR2,HEADER^PSGMMAR2
"RTN","PSGMMIVC",29,0)
 S PSGMAROC=PSGMAROC+1 W !?6,"|",?19,"|",?48,"|",$G(TS(1)) D CELL(1,0)
"RTN","PSGMMIVC",30,0)
 W !,$E(P("LOG"),1,5)," |"
"RTN","PSGMMIVC",31,0)
 W:ON["V" $E(P(2),1,5)_$E(P(2),9,14)," |",P(3)
"RTN","PSGMMIVC",32,0)
 W:ON["P" "P E N D I N G"
"RTN","PSGMMIVC",33,0)
 W ?39,"("_$E(PSGP(0))_$E(PSSN,8,12)_")"
"RTN","PSGMMIVC",34,0)
 W ?48,"|",$G(TS(2)) D CELL(2,0) S L=3
"RTN","PSGMMIVC",35,0)
 NEW NAME
"RTN","PSGMMIVC",36,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  D NAME^PSIVUTL(DRG("AD",X),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  W !,NAME(Y) W:L=3 ?47,PSGST W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) D L(1)
"RTN","PSGMMIVC",37,0)
 I '$G(DRG("AD",0)) D
"RTN","PSGMMIVC",38,0)
 .W !
"RTN","PSGMMIVC",39,0)
 .W:L=3 ?47,PSGST W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) D L(1)
"RTN","PSGMMIVC",40,0)
 W:$G(DRG("SOL",0)) !,"in "
"RTN","PSGMMIVC",41,0)
 NEW PSJPRT2
"RTN","PSGMMIVC",42,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D NAME^PSIVUTL(DRG("SOL",X),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  D
"RTN","PSGMMIVC",43,0)
 . W:(Y>1!(X>1)) ! W ?4,NAME(Y) W:L=3 ?47,PSGST W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) D L(1)
"RTN","PSGMMIVC",44,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",X),0),U,4) I PSJPRT2]"" W !?7,PSJPRT2 W:L=3 ?47,PSGST W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) D L(1)
"RTN","PSGMMIVC",45,0)
 W !,$P(P("MR"),U,2)," ",P(9)," ",P(8) W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) I L>5 S PSJTMPL=L\6,PSJDIV=PSJTMPL+4 I L>PSJDIV,(L#PSJDIV>1) W ! ;I L>5,(L#5>1) W !
"RTN","PSGMMIVC",46,0)
 I '$G(DRG("SOL",0)) S L=L+1 W !,?48,"|",$G(TS(L)) D CELL(L,'(L#6))
"RTN","PSGMMIVC",47,0)
 I P(4)="C",'(L#5),P("OPI")="" D
"RTN","PSGMMIVC",48,0)
 . D L(1)
"RTN","PSGMMIVC",49,0)
 . W !,"*CAUTION-CHEMOTHERAPY*",?48,"|",$G(TS(L))
"RTN","PSGMMIVC",50,0)
 . D CELL(L,'(L#6)) W ! ;S L=L+1
"RTN","PSGMMIVC",51,0)
 E  I P(4)="C" D
"RTN","PSGMMIVC",52,0)
 . D L(1)
"RTN","PSGMMIVC",53,0)
 . W:L#7=0 !
"RTN","PSGMMIVC",54,0)
 . W "*CAUTION-CHEMOTHERAPY*",?48,"|",$G(TS(L))
"RTN","PSGMMIVC",55,0)
 . D CELL(L,'(L#6))
"RTN","PSGMMIVC",56,0)
 . I (L+1)#6'=0 W !
"RTN","PSGMMIVC",57,0)
 I (L#5)=0,($L($P(P("OPI"),"^"))<29),(TS<7) S L=L+1
"RTN","PSGMMIVC",58,0)
 E  D L(1)
"RTN","PSGMMIVC",59,0)
 W:P("OPI")=""&(TS>6) !
"RTN","PSGMMIVC",60,0)
 I P("OPI")'="",'$$OPI^PSGMIV(PSGP,ON55) D
"RTN","PSGMMIVC",61,0)
 . I L#7=0 W !
"RTN","PSGMMIVC",62,0)
 . I L#5=1 W !
"RTN","PSGMMIVC",63,0)
 . N PSJTMPX S PSJTMPX=0
"RTN","PSGMMIVC",64,0)
 . F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=$P($P(P("OPI"),"^")," ",Y) D
"RTN","PSGMMIVC",65,0)
 .. I $L(Y1)>47 W $E(Y1,1,47)
"RTN","PSGMMIVC",66,0)
 .. I (PSJTMPX+$L(Y1))>47 W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)),L(1) S PSJTMPX=0 W !
"RTN","PSGMMIVC",67,0)
 .. I $L(Y1)>47 W $E(Y1,48,$L(Y1)) S PSJTMPX=$L($E(Y1,48,$L(Y1)))
"RTN","PSGMMIVC",68,0)
 .. E  W Y1," " S PSJTMPX=PSJTMPX+$L(Y1)+1
"RTN","PSGMMIVC",69,0)
 N PSGIVFL I '$O(DRG("AD",0))!'$O(DRG("SOL",0)) S PSGIVFL=1
"RTN","PSGMMIVC",70,0)
 I L>TS,(L#6) W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) S L=L+1
"RTN","PSGMMIVC",71,0)
 I (TS-1)>L W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) D
"RTN","PSGMMIVC",72,0)
 . F L=L+1:1:TS-1 D L(0) W !?48,"|",$G(TS(L)) D CELL(L,'(L#6))
"RTN","PSGMMIVC",73,0)
 . S L=L+1
"RTN","PSGMMIVC",74,0)
 F  Q:'(L#6)  W !?48,"|",$G(TS(L)) D CELL(L,'(L#6)) S L=L+1
"RTN","PSGMMIVC",75,0)
 I '(L#6),(P("OPI")="") W !
"RTN","PSGMMIVC",76,0)
 I P("OPI")]"",(L>6) W !
"RTN","PSGMMIVC",77,0)
 W ?29,"RPH: ",PSGLRPH,?38,"RN: ",PSGLRN,?48,"|",$G(TS(L)) D CELL(L,'(L#6)) W:PSGMAROC<6 !?7,LN2
"RTN","PSGMMIVC",78,0)
 Q
"RTN","PSGMMIVC",79,0)
 ;
"RTN","PSGMMIVC",80,0)
L(X) ;***Check to see if a new block if needed.
"RTN","PSGMMIVC",81,0)
 S L=L+X
"RTN","PSGMMIVC",82,0)
 I L#6=0,PSGMAROC<6 D
"RTN","PSGMMIVC",83,0)
 . W !,"See next label for continuation",?48,"|",$G(TS(L)) D CELL(L,'(L#6))
"RTN","PSGMMIVC",84,0)
 . W:PSGMAROC<6 !?7,LN2,$C(13) S $X=0 S PSGMAROC=PSGMAROC+1,L=L+1 D
"RTN","PSGMMIVC",85,0)
 . . I LN>6,(PSGMAROC>5) S MSG1="*** CONTINUE ON NEXT PAGE ***" D BOT^PSGMMAR2,HEADER^PSGMMAR2 S PSGMAROC=1
"RTN","PSGMMIVC",86,0)
 Q
"RTN","PSGMMIVC",87,0)
LN(L) ;*** Print lines within block.
"RTN","PSGMMIVC",88,0)
 N X S X=$S(L#6:LN4,1:LN7)
"RTN","PSGMMIVC",89,0)
 Q X
"RTN","PSGMMIVC",90,0)
CELL(X,X1)         ;
"RTN","PSGMMIVC",91,0)
 I ON["P",(X=6) NEW PSGLFFD,PSGMARGD S P(9)="",PSGLFFD="9999999",PSGMARGD="" W ?55 D ASTERS^PSGMMAR2 Q
"RTN","PSGMMIVC",92,0)
 I TS=1,'$G(P(11)),(X=6) W ?55 D ASTERS^PSGMMAR2 Q
"RTN","PSGMMIVC",93,0)
 I TS=1,'$G(P(11)) W ?55,$$LN(X) Q
"RTN","PSGMMIVC",94,0)
 D CELL^PSGMMAR2(X,X1)
"RTN","PSGMMIVC",95,0)
 Q
"RTN","PSGMMIVC",96,0)
INITOPI ;* Set nurse's initial and the other print info.
"RTN","PSGMMIVC",97,0)
 D RPHINIT^PSGMIV(.PSGLRPH)
"RTN","PSGMMIVC",98,0)
 S PSGLRN="_____"
"RTN","PSGMMIVC",99,0)
 I ON["V" N ND4 S ND4=$G(^PS(55,DFN,"IV",+ON,4))
"RTN","PSGMMIVC",100,0)
 I $G(ND4) D
"RTN","PSGMMIVC",101,0)
 .I $G(DFN),$G(ON) N PSGLREN S PSGLREN=+$$LASTREN^PSJLMPRI(DFN,ON) D
"RTN","PSGMMIVC",102,0)
 ..N PSGLRNDT S PSGLRNDT=$P(ND4,"^",2),ND4=+ND4 I PSGLRNDT,$G(PSGLREN) I $G(PSGLREN)>PSGLRNDT S ND4=0
"RTN","PSGMMIVC",103,0)
 .I ND4 D NAME(+ND4,"",.PSGLRN)
"RTN","PSGMMIVC",104,0)
 I ON["P" D
"RTN","PSGMMIVC",105,0)
 . I P("OPI")="",$O(^PS(53.1,ON,12,0)) S X=0 F  S X=$O(^PS(53.1,ON,12,X)) Q:'X  S Z=$G(^(X,0)),Y=$L(P("OPI")) S:Y+$L(Z)'>179 P("OPI")=P("OPI")_Z_" " I Y+$L(Z)>179 S P("OPI")="SEE PROVIDER COMMENTS"
"RTN","PSGMMIVC",106,0)
 . S PSGST=""
"RTN","PSGMMIVC",107,0)
 . D NAME(+$G(^PS(53.1,+ON,4)),"",.PSGLRN)
"RTN","PSGMMIVC",108,0)
 Q
"RTN","PSGMMIVC",109,0)
NAME(X,NAME,INIT)  ;Lookup in ^VA(200.
"RTN","PSGMMIVC",110,0)
 ;X = IEN in ^VA(200
"RTN","PSGMMIVC",111,0)
 ;NAME = Return the name in 200
"RTN","PSGMMIVC",112,0)
 ;INIT = Return the initial
"RTN","PSGMMIVC",113,0)
 NEW DIC,Y
"RTN","PSGMMIVC",114,0)
 S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSGMMIVC",115,0)
 S NAME=$G(Y(0,0))
"RTN","PSGMMIVC",116,0)
 S INIT=$P($G(Y(0)),U,2)
"RTN","PSGMMIVC",117,0)
 Q
"RTN","PSGMUTL")
0^49^B28358090^B22961901
"RTN","PSGMUTL",1,0)
PSGMUTL ;BIR/MV-UTLILITY USE FOR THE MAR AND MEDWS. ;15 SEP 97 / 2:10 PM 
"RTN","PSGMUTL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,104,110,111,131,267**;16 DEC 97;Build 158
"RTN","PSGMUTL",3,0)
 ;
"RTN","PSGMUTL",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGMUTL",5,0)
 ; 
"RTN","PSGMUTL",6,0)
MARFORM ;Prompt for the MAR form (Blank and Non-blank)
"RTN","PSGMUTL",7,0)
 S DIR(0)="SA^1:Print Blank MARs only;2:Print Non-Blank MARs only;3:Print both Blank and Non-Blank MARs"
"RTN","PSGMUTL",8,0)
 S DIR("A")="Select the MAR forms: ",DIR("B")="3"
"RTN","PSGMUTL",9,0)
 S DIR("?")=""
"RTN","PSGMUTL",10,0)
 S DIR("?",1)="Enter 1 to print BLANK (no data) MARs for the patient(s) you select."
"RTN","PSGMUTL",11,0)
 S DIR("?",2)="Enter 2 to print MARs complete with orders."
"RTN","PSGMUTL",12,0)
 S DIR("?",3)="Enter 3 to print both the blank MARs and the MARs complete with orders."
"RTN","PSGMUTL",13,0)
 S DIR("?",4)="Enter an  '^' to exit this option now."
"RTN","PSGMUTL",14,0)
 D ^DIR S PSGMARB=$S($D(DIRUT):0,1:Y)
"RTN","PSGMUTL",15,0)
 Q
"RTN","PSGMUTL",16,0)
BLANK(LEN) ;
"RTN","PSGMUTL",17,0)
 NEW X
"RTN","PSGMUTL",18,0)
 S $P(X," ",LEN)=" "
"RTN","PSGMUTL",19,0)
 Q $G(X)
"RTN","PSGMUTL",20,0)
 ;
"RTN","PSGMUTL",21,0)
TXT(TXT,LEN)   ;
"RTN","PSGMUTL",22,0)
 ;* Input: TXT = TXT string
"RTN","PSGMUTL",23,0)
 ;*        LEN = format length
"RTN","PSGMUTL",24,0)
 ;* Output: MARX array.
"RTN","PSGMUTL",25,0)
 ;*
"RTN","PSGMUTL",26,0)
 NEW OLD,X1,Y D SPLIT K MARX
"RTN","PSGMUTL",27,0)
 S X=0,X1=1,Y="" F  S X=$O(OLD(X)) Q:'X  D
"RTN","PSGMUTL",28,0)
 . I $L(Y_OLD(X))>LEN S MARX(X1)=Y,X1=X1+1,Y="" D
"RTN","PSGMUTL",29,0)
 .. I $E(MARX(X1-1),$L(MARX(X1-1)))'=" " Q
"RTN","PSGMUTL",30,0)
 .. S MARX(X1-1)=$E(MARX(X1-1),1,$L(MARX(X1-1))-1)
"RTN","PSGMUTL",31,0)
 . S Y=Y_OLD(X)
"RTN","PSGMUTL",32,0)
 S:Y]"" MARX(X1)=Y
"RTN","PSGMUTL",33,0)
 S MARX=X1
"RTN","PSGMUTL",34,0)
 Q
"RTN","PSGMUTL",35,0)
 ;
"RTN","PSGMUTL",36,0)
LONGTXT(LEN,DFN,ORDER) ; Build array of long special instructions
"RTN","PSGMUTL",37,0)
 N TXTLN,TXT,I,TMPMARX,MARXTXT,LAST,II K MARX S LAST=0,TMPMARX=""
"RTN","PSGMUTL",38,0)
 I ORDER["U" S TXTLN=0 F I=1:1 S TXTLN=$O(^PS(55,DFN,5,+ORDER,15,TXTLN)) Q:'TXTLN  D
"RTN","PSGMUTL",39,0)
 .S MARXTXT=^PS(55,DFN,5,+ORDER,15,TXTLN,0) D TXT(MARXTXT,LEN) S LAST=$O(TMPMARX(" "),-1) S II=0 F  S II=$O(MARX(II)) Q:'II  S TMPMARX(LAST+II)=MARX(II)
"RTN","PSGMUTL",40,0)
 I ORDER["P" S TXTLN=0 F I=1:1 S TXTLN=$O(^PS(53.1,+ORDER,15,TXTLN)) Q:'TXTLN  D
"RTN","PSGMUTL",41,0)
 .S MARXTXT=^PS(53.1,+ORDER,15,TXTLN,0) D TXT(MARXTXT,LEN) S LAST=$O(TMPMARX(" "),-1) S II=0 F  S II=$O(MARX(II)) Q:'II  S TMPMARX(LAST+II)=MARX(II)
"RTN","PSGMUTL",42,0)
 K MARX M MARX=TMPMARX
"RTN","PSGMUTL",43,0)
 Q $O(MARX(0))
"RTN","PSGMUTL",44,0)
SPLIT ;* Split a word string into individual words.
"RTN","PSGMUTL",45,0)
 ;* Output: OLD(X)
"RTN","PSGMUTL",46,0)
 ;*
"RTN","PSGMUTL",47,0)
 NEW BSD,NEW,X,X1,Y
"RTN","PSGMUTL",48,0)
 S OLD(1)=TXT Q:$L(TXT)<LEN
"RTN","PSGMUTL",49,0)
 F BSD=" ","/","-" S:'$O(OLD(0)) OLD(1)=TXT D:TXT[BSD DELIM(BSD)
"RTN","PSGMUTL",50,0)
 I '$O(OLD(1)),($L(TXT)>LEN) D LEN(1,TXT) K OLD D
"RTN","PSGMUTL",51,0)
 . F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)
"RTN","PSGMUTL",52,0)
 Q
"RTN","PSGMUTL",53,0)
LEN(X1,OLD) ;* Wrap word around if it doesn't fit the display length
"RTN","PSGMUTL",54,0)
 NEW X
"RTN","PSGMUTL",55,0)
 Q:$L(OLD)'>LEN
"RTN","PSGMUTL",56,0)
 S X=$E(OLD,1,($L(OLD)-1)) I X["/"!((X["-")&(X'["ON-CALL")) Q
"RTN","PSGMUTL",57,0)
 I $L(OLD)>LEN F X=1:1 S NEW(X1)=$E(OLD,((LEN*X)-LEN+1),(LEN*X)),X1=X1+1 Q:($L(OLD)'>(LEN*X))
"RTN","PSGMUTL",58,0)
 Q
"RTN","PSGMUTL",59,0)
DELIM(BSD) ;* BSD=" ","/","-"
"RTN","PSGMUTL",60,0)
 K NEW
"RTN","PSGMUTL",61,0)
 S X=0,X1=0 F  S X=$O(OLD(X)) Q:'X  K ONCALL F Y=1:1:$L(OLD(X),BSD) D
"RTN","PSGMUTL",62,0)
 . Q:($G(ONCALL)=Y)   ; If ON-CALL is delimited string, ignore
"RTN","PSGMUTL",63,0)
 . S X1=X1+1
"RTN","PSGMUTL",64,0)
 . S NEW(X1)=$P(OLD(X),BSD,Y)
"RTN","PSGMUTL",65,0)
 . I $L(OLD(X),BSD)>1,(Y<$L(OLD(X),BSD)) S NEW(X1)=NEW(X1)_BSD
"RTN","PSGMUTL",66,0)
 . I BSD="-",OLD(X)["ON-CALL" D   ;If dashes, check for ON-CALL
"RTN","PSGMUTL",67,0)
 .. S NEW(X1)=OLD(X),ONCALL=Y+1   ;Keep ON-CALL intact
"RTN","PSGMUTL",68,0)
 . D LEN(.X1,NEW(X1))
"RTN","PSGMUTL",69,0)
 K OLD F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)
"RTN","PSGMUTL",70,0)
 Q
"RTN","PSGMUTL",71,0)
 ;
"RTN","PSGMUTL",72,0)
MARLB(LEN)         ;
"RTN","PSGMUTL",73,0)
 ;;;LEN=LENGTH
"RTN","PSGMUTL",74,0)
 NEW L,X,TXT K MARLB,DRUGNAME,ON S ON=PSGORD D ONHOLD^PSGMMAR2
"RTN","PSGMUTL",75,0)
 S L=1
"RTN","PSGMUTL",76,0)
 S MARLB(L)=$$BLANK(6)_"|"_$$BLANK(12)_"|",L=L+1
"RTN","PSGMUTL",77,0)
 I $G(PST)["CZ"!($G(PST)["OZ") S MARLB(L)=PSGLOD_" | P E N D I N G"
"RTN","PSGMUTL",78,0)
 E  S MARLB(L)=PSGLOD_" |"_PSGLSD_" |"_PSGLFD
"RTN","PSGMUTL",79,0)
 I $G(ONHOLD) S MARLB(L)=PSGLOD_" | O N  H O L D "
"RTN","PSGMUTL",80,0)
 S MARLB(L)=$$SETSTR^VALM1("("_$E(PPN)_$E(PSSN,8,12)_")",MARLB(L),40,7)
"RTN","PSGMUTL",81,0)
 S L=L+1
"RTN","PSGMUTL",82,0)
 D DRGDISP^PSJLMUT1(PSGP,+PSGORD_$S(PSGORD["P":"P",1:"U"),45,39,.DRUGNAME,0)
"RTN","PSGMUTL",83,0)
 F X=0:0 S X=$O(DRUGNAME(X)) Q:'X  S MARLB(L)=DRUGNAME(X)_$S(X=1:$$BLANK(47-$L(DRUGNAME(X)))_PSGLST,1:""),L=L+1
"RTN","PSGMUTL",84,0)
 I '$$LONGTXT(LEN,DFN,PSGORD) D TXT^PSGMUTL(PSGLSI,LEN)
"RTN","PSGMUTL",85,0)
 S X=0 F  S X=$O(MARX(X)) Q:'X  S MARLB(L)=MARX(X),L=L+1
"RTN","PSGMUTL",86,0)
 K MARX
"RTN","PSGMUTL",87,0)
 I $G(PSGP),$G(PSGORD),(PSGLRN]""),(PSGLRN'="O") D
"RTN","PSGMUTL",88,0)
 .N ND4 S ND4=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,4)),PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:"")
"RTN","PSGMUTL",89,0)
 .N PSGLREN,PSGLRNDT S PSGLREN=+$$LASTREN^PSJLMPRI(PSGP,PSGORD),PSGLRNDT=$P(ND4,"^",2) I PSGLREN,PSGLRNDT I PSGLREN>PSGLRNDT S PSGLRN=""
"RTN","PSGMUTL",90,0)
 S X=$E("WS",1,PSGLWS*2)_$S(PSGLSM:$E("HSM",PSGLSM,3),1:"")_$E("NF",1,PSGLNF*2)
"RTN","PSGMUTL",91,0)
 I X="",($L(MARLB(L-1))<30),(L=6) S L=L-1 D
"RTN","PSGMUTL",92,0)
 . S X=MARLB(L)_$$BLANK(29-$L(MARLB(L)))_"RPH: "_$S(PSGLRPH]""&(PSGLRPH'="0"):PSGLRPH,1:"_____")
"RTN","PSGMUTL",93,0)
 . S X=X_$$BLANK(39-$L(X))_"RN: "_$S(PSGLRN]""&(PSGLRN'="0"):PSGLRN,1:"_____")
"RTN","PSGMUTL",94,0)
 . S MARLB(L)=X
"RTN","PSGMUTL",95,0)
 E  D
"RTN","PSGMUTL",96,0)
 . S:L=4 MARLB(5)="",L=5
"RTN","PSGMUTL",97,0)
 . S X=$E("WS",1,PSGLWS*2)
"RTN","PSGMUTL",98,0)
 . S X=X_$$BLANK(4-$L(X))_$S(PSGLSM:$E("HSM",PSGLSM,3),1:"")
"RTN","PSGMUTL",99,0)
 . S X=X_$$BLANK(8-$L(X))_$E("NF",1,PSGLNF*2)
"RTN","PSGMUTL",100,0)
 . S X=X_$$BLANK(29-$L(X))_"RPH: "_$S(PSGLRPH]""&(PSGLRPH'="0"):PSGLRPH,1:"____")
"RTN","PSGMUTL",101,0)
 . S X=X_$$BLANK(39-$L(X))_"RN: "_$S(PSGLRN]""&(PSGLRN'="0"):PSGLRN,1:"_____")
"RTN","PSGMUTL",102,0)
 . S MARLB(L)=X
"RTN","PSGMUTL",103,0)
 S L=L+1,MARLB(L)=""
"RTN","PSGMUTL",104,0)
 S MARLB=L
"RTN","PSGMUTL",105,0)
 I MARLB>6!($G(TS)>6) D MARLB2
"RTN","PSGMUTL",106,0)
 Q
"RTN","PSGMUTL",107,0)
 ;
"RTN","PSGMUTL",108,0)
MARLB2 ;Split array into 2 labels.
"RTN","PSGMUTL",109,0)
 ;TS array must be defined. (TS^PSGMAR3(ADMIN TIMES))
"RTN","PSGMUTL",110,0)
 NEW INIT,X,Y
"RTN","PSGMUTL",111,0)
 S INIT=MARLB(MARLB),Y=6
"RTN","PSGMUTL",112,0)
 F X=6:1:MARLB S X(X)=MARLB(X)
"RTN","PSGMUTL",113,0)
 F X=6:1:($S(MARLB>TS:MARLB,1:TS)-1) D
"RTN","PSGMUTL",114,0)
 . I (X#6)=0 S MARLB(X)="See next label for continuation" Q
"RTN","PSGMUTL",115,0)
 . I Y<(MARLB) S MARLB(X)=X(Y),Y=Y+1 Q
"RTN","PSGMUTL",116,0)
 . S MARLB(X)=""
"RTN","PSGMUTL",117,0)
 S X=X+1 F Y=Y:1:MARLB-1 S MARLB(X)=$G(X(Y)),X=X+1
"RTN","PSGMUTL",118,0)
 F X=X:0 Q:(X#6)=0  S MARLB(X)="",X=X+1
"RTN","PSGMUTL",119,0)
 S MARLB(X)=INIT,MARLB=X
"RTN","PSGMUTL",120,0)
 Q
"RTN","PSGMUTL",121,0)
 N X F X=6:1:MARLB S X(X+1)=MARLB(X)
"RTN","PSGMUTL",122,0)
 S MARLB(6)="See next label for continuation"
"RTN","PSGMUTL",123,0)
 F X=7:1:MARLB S MARLB(X)=X(X)
"RTN","PSGMUTL",124,0)
 F X=X+1:1:11 S MARLB(X)=""
"RTN","PSGMUTL",125,0)
 S MARLB(12)=X(MARLB+1)
"RTN","PSGMUTL",126,0)
 S MARLB=12
"RTN","PSGMUTL",127,0)
 Q
"RTN","PSGMUTL",128,0)
 ;
"RTN","PSGOE41")
0^47^B27985656^B27908531
"RTN","PSGOE41",1,0)
PSGOE41 ;BIR/CML3-REGULAR ORDER ENTRY (CONT.) ;09 JAN 97 / 9:13 AM 
"RTN","PSGOE41",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,63,64,69,58,111,136,113,267**;16 DEC 97;Build 158
"RTN","PSGOE41",3,0)
 ;
"RTN","PSGOE41",4,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSGOE41",5,0)
 ; Reference to %DT is supported by DBIA 10003.
"RTN","PSGOE41",6,0)
 ; Reference to %DTC is supported by DBIA 10000.
"RTN","PSGOE41",7,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGOE41",8,0)
 ;
"RTN","PSGOE41",9,0)
39 ; admin times
"RTN","PSGOE41",10,0)
 G:$P(PSGNEDFD,"^",3)="P"!($P(PSGNEDFD,"^",3)="OC") 8
"RTN","PSGOE41",11,0)
 I $$ODD^PSGS0(PSGS0XT) G 8
"RTN","PSGOE41",12,0)
 W !,"ADMIN TIMES: "_$S(PSGS0Y:PSGS0Y_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",13,0)
 I X="",PSGS0Y]"" S X=PSGS0Y
"RTN","PSGOE41",14,0)
 I X="",$G(PSGS0XT)="D" I $L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGS0Y)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE41",15,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G 39
"RTN","PSGOE41",16,0)
 I X="@" D DEL G:%'=1 39 S (PSGFOK(39),PSGS0Y)="" G 39
"RTN","PSGOE41",17,0)
 S PSGF2=39 I $E(X)="^" D FF G:Y>0 @Y G 39
"RTN","PSGOE41",18,0)
 I (PSGS0XT="D")&('$G(X)!(X["@"&($P($G(X),"@",2)))) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G 39
"RTN","PSGOE41",19,0)
 . W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE41",20,0)
 I $G(PSGS0XT)'="D",$G(PSGS0XT)'="P",$G(PSGS0XT)'="OC" D TIMES I '$D(X) G 39
"RTN","PSGOE41",21,0)
 I $G(PSGS0XT)="O",X="" S (PSGAT,PSGS0Y)=X,PSGFOK(39)="" G 8
"RTN","PSGOE41",22,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" G 39
"RTN","PSGOE41",23,0)
 S (PSGAT,PSGS0Y)=X,PSGFOK(39)=""
"RTN","PSGOE41",24,0)
 ;
"RTN","PSGOE41",25,0)
8 ; special instructions
"RTN","PSGOE41",26,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD))
"RTN","PSGOE41",27,0)
 S PSGF2=8 I $E(X)="^" D FF G:Y>0 @Y G 8
"RTN","PSGOE41",28,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",29,0)
 I X="@" D DEL G:%'=1 8 S (PSGFOK(8),PSGSI)="" G:'$G(PSGOE3) 10
"RTN","PSGOE41",30,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",31,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<3)):$G(^PS(53.45,+PSJSYSP,5,1,0))_" "_$G(^PS(53.45,+PSJSYSP,5,2,0)),PSGSI>2:"Instructions too long. See Order View or BCMA for full text",1:"")
"RTN","PSGOE41",32,0)
 I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U"),PSGFOK(8)=""
"RTN","PSGOE41",33,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",34,0)
10 ; start date/time
"RTN","PSGOE41",35,0)
 D ^PSGNE3
"RTN","PSGOE41",36,0)
 S:'$D(PSGNESDO) PSGNESDO=$$ENDD^PSGMI(PSGNESD) S PSGSD=PSGNESDO
"RTN","PSGOE41",37,0)
A10 W !,"START DATE/TIME: "_PSGSD_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",38,0)
 I X="",PSGNESD W "  "_PSGSD G O25
"RTN","PSGOE41",39,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGNESD=+X,PSGSD=$$ENDD^PSGMI(+X) W "  ",PSGSD G O25
"RTN","PSGOE41",40,0)
 S PSGF2=10 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE41",41,0)
 I $E(X)="^" D FF G:Y>0 @Y G A10
"RTN","PSGOE41",42,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE41",43,0)
 S PSGNESD=+Y,PSGSD=$$ENDD^PSGMI(+Y),(PSGNEFD,PSGFD)=""
"RTN","PSGOE41",44,0)
 ;
"RTN","PSGOE41",45,0)
O25 ;
"RTN","PSGOE41",46,0)
 S PSGFOK(10)="" I $P(PSGNEDFD,"^",3)="O" S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" S PSGFD=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGOE41",47,0)
 ;
"RTN","PSGOE41",48,0)
25 ; stop date
"RTN","PSGOE41",49,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",50,0)
 I 'PSGNEFD D ENFD^PSGNE3(PSGDT) S PSGFD=PSGNEFDO
"RTN","PSGOE41",51,0)
A25 W !,"STOP DATE/TIME: "_$S(PSGFD]"":PSGFD_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",52,0)
 I X="",PSGNEFD W "   "_PSGFD S PSGFOK(25)=""  G W25
"RTN","PSGOE41",53,0)
 S PSGF2=25 I $E(X)="^" D FF G:Y>0 @Y G A25
"RTN","PSGOE41",54,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE41",55,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D EN1^PSGDL
"RTN","PSGOE41",56,0)
 K %DT S %DT="ERTX",%DT(0)=PSGNESD D ^%DT K %DT G:Y'>0 A25 S PSGNEFD=+Y,PSGFD=$$ENDD^PSGMI(+Y),PSGFOK(25)=""
"RTN","PSGOE41",57,0)
W25 ;
"RTN","PSGOE41",58,0)
 N Z
"RTN","PSGOE41",59,0)
 D DOSE I $G(Z)]"",Z>PSGNEFD D  G A25
"RTN","PSGOE41",60,0)
 . W !,"There must be an admin time that falls between the Start Date/Time"
"RTN","PSGOE41",61,0)
 . W !,"and the Stop Date/Time."
"RTN","PSGOE41",62,0)
 I PSGNEFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOE41",63,0)
 D EFDNEW^PSJUTL  ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE41",64,0)
NEXT ;
"RTN","PSGOE41",65,0)
 G 1^PSGOE42
"RTN","PSGOE41",66,0)
 ;
"RTN","PSGOE41",67,0)
DONE ;
"RTN","PSGOE41",68,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE41",69,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE41",70,0)
 ;
"RTN","PSGOE41",71,0)
FF ; up-arrow to another field
"RTN","PSGOE41",72,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE4"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:$P(Y,U)=2 FB=PSGF2_"^PSGOE41"
"RTN","PSGOE41",73,0)
 Q
"RTN","PSGOE41",74,0)
 ;
"RTN","PSGOE41",75,0)
DEL ; delete entry
"RTN","PSGOE41",76,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE41",77,0)
 Q
"RTN","PSGOE41",78,0)
TIMES    ;At least one admin time, not more than interval allows.
"RTN","PSGOE41",79,0)
 I $G(PSGS0XT)'="O",X="" W !,"This order requires at least one administration time." K X Q  ;No times
"RTN","PSGOE41",80,0)
 N H,I,MAX
"RTN","PSGOE41",81,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE41",82,0)
 I $G(PSGST)="O",$L(X,"-")>1 W !,"This is a One Time Order - only one admin time is permitted." K X Q
"RTN","PSGOE41",83,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE41",84,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE41",85,0)
 S MAX=1440/I
"RTN","PSGOE41",86,0)
 I MAX<1 D  Q
"RTN","PSGOE41",87,0)
 . I $L(X,"-")'=1 W !,"This order requires one admin time." K X Q
"RTN","PSGOE41",88,0)
 I MAX'<1,$L(X,"-")>MAX W !,"The number of admin times entered is greater than indicated by the schedule." K X Q  ;Too many times
"RTN","PSGOE41",89,0)
 I MAX'<1,$L(X,"-")<MAX W !,"The number of admin times entered is fewer than indicated by the schedule."  ;Too few times
"RTN","PSGOE41",90,0)
 Q
"RTN","PSGOE41",91,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE41",92,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE41",93,0)
 N INFO,X
"RTN","PSGOE41",94,0)
 S Z="",INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE41",95,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE41",96,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE41",97,0)
 Q
"RTN","PSGOE7")
0^61^B19281966^B19317930
"RTN","PSGOE7",1,0)
PSGOE7 ;BIR/CML3-SELECT DRUG ;15 MAY 00 / 1:43 PM
"RTN","PSGOE7",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**9,26,34,52,55,50,87,111,181,254,267**;16 DEC 97;Build 158
"RTN","PSGOE7",3,0)
 ;
"RTN","PSGOE7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSGOE7",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSGOE7",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOE7",7,0)
 ; NFI-UD chgs for FR#: 1
"RTN","PSGOE7",8,0)
 ; 
"RTN","PSGOE7",9,0)
 ;S PSGDICS="U"_$S($D(PSJOERR):",I",1:"")
"RTN","PSGOE7",10,0)
 S PSGDICS="U"
"RTN","PSGOE7",11,0)
 ;
"RTN","PSGOE7",12,0)
AD ; Ask Drug
"RTN","PSGOE7",13,0)
 K PSJDOSE,PSJDOX ;var array use in ^PSJDOSE
"RTN","PSGOE7",14,0)
 K PSGODO,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP))
"RTN","PSGOE7",15,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="EMQZVT",D="B^C" I '$P(PSJSYSU,";",4) S DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")"
"RTN","PSGOE7",16,0)
 E  S DIC("T")="",DIC="^PSDRUG(",DIC("S")="I +$G(^PSDRUG(+Y,2)),$P($G(^PSDRUG(+Y,2)),""^"",3)[""U"" S X(1)=+$G(^(""I"")) I $S('X(1):1,1:X(1)'<DT)",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSGOE7",17,0)
 ;
"RTN","PSGOE7",18,0)
AD1 ;
"RTN","PSGOE7",19,0)
 K PSGORD,PSJORD,PSJALLGY,^TMP("PSJINTER",$J),^PS(53.45,+$G(PSJSYSP),5),^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSGOE7",20,0)
 S PSGORQF=0 R !!,"Select DRUG: ",X:DTIME I '$T W $C(7) S X="^"
"RTN","PSGOE7",21,0)
 I ("^"[X)!(X="") S PSGORQF=1 G DONE
"RTN","PSGOE7",22,0)
 G:X?1"S."1.E DONE
"RTN","PSGOE7",23,0)
 I X?1."?" W !!?2,"Select the medication you wish the patient to receive." W:PSJSYSU<3 "  You should consult",!,"with your pharmacy before ordering any non-formulary medication." W !
"RTN","PSGOE7",24,0)
 D MIX^DIC1 G:X?1."?" AD1 G:"^"[X!(Y'>0) AD1 S (PSGDO,PSGDRG,PSGDRGN,PSGNEDFD,PSGPDRG,PSGPDRGN)=""
"RTN","PSGOE7",25,0)
 I $P(PSJSYSU,";",4) D  G DO
"RTN","PSGOE7",26,0)
 .S PSGDRG=+Y,PSGDRGN=Y(0,0)
"RTN","PSGOE7",27,0)
 .D DIN^PSJDIN(+$G(^PSDRUG(PSGDRG,2)),PSGDRG)
"RTN","PSGOE7",28,0)
 .I $P(Y(0),"^",9) D NF S:Y>0 PSGDRG=+Y(0),PSGDRGN=Y(0,0) D SNFM
"RTN","PSGOE7",29,0)
 .S PSGPDRG=+$G(^PSDRUG(PSGDRG,2)),PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",30,0)
 S PSGPDRG=+Y,PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",31,0)
 S X=$O(^PSDRUG("ASP",PSGPDRG,0)) I X,'$O(^(X)) S PSGDRG=X,PSGDRGN=$$ENDDN^PSGMI(X)
"RTN","PSGOE7",32,0)
 ;
"RTN","PSGOE7",33,0)
DO ; dosage ordered
"RTN","PSGOE7",34,0)
 NEW PSJALLGY
"RTN","PSGOE7",35,0)
 S PSGNEDFD=$$GTNEDFD("U",PSGPDRG)
"RTN","PSGOE7",36,0)
 I $G(PSGDRG),$P(PSJSYSU,";",4) S PSJALLGY(PSGDRG)="" D ENDDC^PSGSICHK(PSGP,PSGDRG) G:$G(PSGORQF) AD
"RTN","PSGOE7",37,0)
 I '$P(PSJSYSU,";",4) S PSGX=PSGPDRG D END^PSGSICHK G:Y<0 AD
"RTN","PSGOE7",38,0)
 S PSGDO=""
"RTN","PSGOE7",39,0)
 ;
"RTN","PSGOE7",40,0)
DONE ;
"RTN","PSGOE7",41,0)
 K DIC,%,%Y,PSGDICS,PSJLUAPP,Q1,Q2,Q3,Z,PSJALLGY Q
"RTN","PSGOE7",42,0)
 ;
"RTN","PSGOE7",43,0)
 ;
"RTN","PSGOE7",44,0)
NF ;
"RTN","PSGOE7",45,0)
 S Y=0 W $C(7),!!,"PLEASE NOTE: The selected item is not currently on your medical center's",!?13,"formulary." Q:'$P(PSJSYSU,";",2)
"RTN","PSGOE7",46,0)
 N CNT S CNT=0 F Q1=0:0 S Q1=$O(^PSDRUG(PSGDRG,65,Q1)) Q:'Q1  I $$CHKDRG(+$G(^(Q1,0))) S CNT=CNT+1
"RTN","PSGOE7",47,0)
 I CNT=0 W !!,"There are no formulary alternatives entered for this item." W:PSJSYSU>2 "  You should consult",!,"with your pharmacy before ordering this item." S Y=0 Q
"RTN","PSGOE7",48,0)
 I CNT=1 S Q1=$O(^PSDRUG(PSGDRG,65,0)),Q1=+$G(^(Q1,0)),Q3=$P(^PSDRUG(Q1,0),"^") W !!,Q3," has been entered as a formulary " W:$X>67 ! W "alternative."
"RTN","PSGOE7",49,0)
 I  F Q=1:1 S %=2 W !!,"Is ",$S(Q=1:"this",1:Q3)," acceptable" D YN^DICN Q:%  D NFOH
"RTN","PSGOE7",50,0)
 I CNT=1 S:%=1 (Y(0),Y)=Q1,Y(0,0)=Q3 S:%<0 Y=-1 Q
"RTN","PSGOE7",51,0)
 K DA,DIC S DA(1)=PSGDRG,DIC="^PSDRUG("_PSGDRG_",65,",DIC(0)="AEMQZ",DIC("A")="Select FORMULARY ALTERNATIVE: " W ! D ^DIC K DIC Q
"RTN","PSGOE7",52,0)
 ;
"RTN","PSGOE7",53,0)
NFOH ;
"RTN","PSGOE7",54,0)
 S X="Answer 'YES' to order this formulary alternative ("_Q3_") for the patient instead of the non-formulary item originally selected.  Answer 'NO' to use the drug originally selected."
"RTN","PSGOE7",55,0)
 W !!?2 F Y=1:1:$L(X," ") S Z=$P(X," ",Y) W:$L(Z)+$X+2>IOM ! W Z," "
"RTN","PSGOE7",56,0)
 Q
"RTN","PSGOE7",57,0)
CHKDRG(DRG) ; Determine if dispense drug is valid for Unit Dose.
"RTN","PSGOE7",58,0)
 I $D(^PSDRUG(DRG,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>DT) Q DRG
"RTN","PSGOE7",59,0)
 Q 0
"RTN","PSGOE7",60,0)
 ;
"RTN","PSGOE7",61,0)
SNFM ; show non-formulary message
"RTN","PSGOE7",62,0)
 S Y=1 Q:PSJSYSU=3!'$O(^PS(59.7,1,21,0))  W $C(7),! S Q=0 F  S Q=$O(^PS(59.7,1,21,Q)) Q:'Q  W !,$G(^(Q,0))
"RTN","PSGOE7",63,0)
 W ! D READ^PSJUTL S Y=1 Q
"RTN","PSGOE7",64,0)
 ;
"RTN","PSGOE7",65,0)
GTNEDFD(APP,PDRG) ; Find defaults from Orderable Item.
"RTN","PSGOE7",66,0)
 Q $P($G(^PS(50.7,+PDRG,0)),"^",5,8)
"RTN","PSGOE7",67,0)
 N Q,X S X=""
"RTN","PSGOE7",68,0)
 F Q=1:1:$L(APP) S X=$E(APP,Q) Q:X=""  S X=$O(^PS(50.3,+PDRG,1,"B",X,0)) I X S X=$P($G(^PS(50.3,+PDRG,1,X,0)),"^",5,8) Q
"RTN","PSGOE7",69,0)
 Q X
"RTN","PSGOE81")
0^46^B32608596^B36275295
"RTN","PSGOE81",1,0)
PSGOE81 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ; 7/20/12 12:43am
"RTN","PSGOE81",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**26,50,64,58,82,110,111,136,113,267**;16 DEC 97;Build 158
"RTN","PSGOE81",3,0)
 ;
"RTN","PSGOE81",4,0)
39 ; admin times
"RTN","PSGOE81",5,0)
 S MSG=0,PSGF2=39 S:PSGOEEF(PSGF2) BACK="39^PSGOE81",ORIG=$G(PSGAT)
"RTN","PSGOE81",6,0)
A39 I $$ODD^PSGS0(PSGS0XT)!(PSGST="P")!$$PRNOK^PSGS0($G(PSGSCH)) G DONE
"RTN","PSGOE81",7,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!('$T) W:'$T $C(7) S PSGOEE=0 S:X="^" (X,PSGAT)=ORIG G DONE
"RTN","PSGOE81",8,0)
 I X="" S:(($G(PSGS0XT)="D")&'PSGS0Y) PSGOEE=0 S:$G(PSGAT) X=PSGAT
"RTN","PSGOE81",9,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A39
"RTN","PSGOE81",10,0)
 I X=" "!(X?1."?") D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",11,0)
 I PSGS0XT="D"&'$G(X) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G A39
"RTN","PSGOE81",12,0)
 .W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE81",13,0)
 I X="@" D DEL G:%'=1 A39 S PSGAT="",X=""
"RTN","PSGOE81",14,0)
 I $G(PSGS0XT),'$$ODD^PSGS0(PSGS0XT),$G(PSGS0XT)'="P",$G(PSGS0XT)'="OC",'$$PRNOK^PSGS0(PSGSCH),($G(PSGST)'="O") D TIMES I '$D(X) G A39
"RTN","PSGOE81",15,0)
 I (($G(PSGST)="O")!($G(PSGST)="OC")) I (X="") S (PSGAT,PSGS0Y)=X G DONE
"RTN","PSGOE81",16,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7) G A39
"RTN","PSGOE81",17,0)
 S PSGOAT=PSGAT
"RTN","PSGOE81",18,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE81",19,0)
 ;
"RTN","PSGOE81",20,0)
8 ; special instructions
"RTN","PSGOE81",21,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE81"
"RTN","PSGOE81",22,0)
A8 ; special instructions
"RTN","PSGOE81",23,0)
 ;I $E($G(X))=U D ENFF^PSGOE82 G:Y>0 @Y G A8
"RTN","PSGOE81",24,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD)) I $G(PSGP),$G(PSGORD) I '$$DIFFSI^PSJBCMA5(PSGP,PSGORD) S PSGOEE=0 G DONE
"RTN","PSGOE81",25,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<4)):$G(^PS(53.45,+PSJSYSP,5,1,0))_" "_$G(^PS(53.45,+PSJSYSP,5,2,0)),PSGSI>3:"Instructions too long. See Order View or BCMA for full text",1:"")
"RTN","PSGOE81",26,0)
 I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE81",27,0)
 Q
"RTN","PSGOE81",28,0)
 ;
"RTN","PSGOE81",29,0)
10 ; start date/time
"RTN","PSGOE81",30,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE81"
"RTN","PSGOE81",31,0)
A10 ; start date/time
"RTN","PSGOE81",32,0)
 K PSGSDX N DUR,DURMIN,TMPFD
"RTN","PSGOE81",33,0)
 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE81",34,0)
 . W !?5,"Start Date may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE81",35,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",36,0)
 I X="",PSGSD W "  "_$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",37,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",38,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE81",39,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A10
"RTN","PSGOE81",40,0)
 NEW TMPX S TMPX=X,X1=+$G(PSGLI),X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE81",41,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE81",42,0)
 S (PSGSDX,PSGSD,PSGNESD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD)
"RTN","PSGOE81",43,0)
 I $G(PSGORD)["P",$G(PSGP) S DUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,"P",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN D
"RTN","PSGOE81",44,0)
 . S TMPFD=$$FMADD^XLFDT(PSGSD,,,DURMIN) K:(TMPFD<PSGSD) TMPFD I $G(TMPFD) S PSGFD=TMPFD,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE81",45,0)
 G DONE
"RTN","PSGOE81",46,0)
 ;
"RTN","PSGOE81",47,0)
25 ; stop date
"RTN","PSGOE81",48,0)
 S MSG=0,PSGF2=25 S:PSGOEEF(PSGF2) BACK="25^PSGOE81"
"RTN","PSGOE81",49,0)
A25 ;
"RTN","PSGOE81",50,0)
 K PSGFDX
"RTN","PSGOE81",51,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",52,0)
 I X="",PSGFD S X=$P(PSGFDN,"^") ;W "   "_$P(PSGFDN,"^")
"RTN","PSGOE81",53,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A25
"RTN","PSGOE81",54,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE81",55,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE81",56,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A25 S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE81",57,0)
W25 ;
"RTN","PSGOE81",58,0)
 N Z,MSG
"RTN","PSGOE81",59,0)
 D DOSE I $G(Z)]"",Z>PSGNEFD D  G A25
"RTN","PSGOE81",60,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSGOE81",61,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSGOE81",62,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE81",63,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE81",64,0)
 ;
"RTN","PSGOE81",65,0)
DONE ;
"RTN","PSGOE81",66,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE81",67,0)
 D EFDNV^PSJUTL
"RTN","PSGOE81",68,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE81",69,0)
 K ORIG
"RTN","PSGOE81",70,0)
 Q
"RTN","PSGOE81",71,0)
 ;
"RTN","PSGOE81",72,0)
FF ; up-arrow to another field
"RTN","PSGOE81",73,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE8"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE81"
"RTN","PSGOE81",74,0)
 Q
"RTN","PSGOE81",75,0)
 ;
"RTN","PSGOE81",76,0)
DEL ; delete entry
"RTN","PSGOE81",77,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE81",78,0)
 Q
"RTN","PSGOE81",79,0)
 ;
"RTN","PSGOE81",80,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSGOE81",81,0)
 I ($G(PSGS0XT)'="O"),($G(PSGST)'="OC"),'$$PRNOK^PSGS0(PSGSCH) I X="" D EN^DDIOL("This order requires at least one administration time.") K X Q  ;No times
"RTN","PSGOE81",82,0)
 N H,I,MAX
"RTN","PSGOE81",83,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE81",84,0)
 I $G(PSGST)="O",$L(X,"-")>1 D EN^DDIOL("This is a One Time Order. Only one administration time is permitted.") K X Q
"RTN","PSGOE81",85,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE81",86,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE81",87,0)
 S MAX=1440/I
"RTN","PSGOE81",88,0)
 I MAX<1,$L(X,"-")>1 D EN^DDIOL("This order requires one administration time.") K X Q
"RTN","PSGOE81",89,0)
 I MAX'<1,$L(X,"-")>MAX D EN^DDIOL("The number of admin times entered is greater than indicated by the schedule.") K X Q  ;Too many times
"RTN","PSGOE81",90,0)
 I MAX'<1,$L(X,"-")<MAX D EN^DDIOL("The number of admin times entered is fewer than indicated by the schedule.")  ;Too few times
"RTN","PSGOE81",91,0)
 Q
"RTN","PSGOE81",92,0)
 ;
"RTN","PSGOE81",93,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE81",94,0)
 N INFO,X
"RTN","PSGOE81",95,0)
 S Z="",INFO=$S($G(PSGNESD):PSGNESD,1:$G(PSGSD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE81",96,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE81",97,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE81",98,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE81",99,0)
 Q
"RTN","PSGOE91")
0^45^B37672131^B41731482
"RTN","PSGOE91",1,0)
PSGOE91 ;BIR/CML3-ACTIVE ORDER EDIT (CONT.) ; 8/4/10 7:07am
"RTN","PSGOE91",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,64,58,110,111,136,113,179,265,267**;16 DEC 97;Build 158
"RTN","PSGOE91",3,0)
 ;
"RTN","PSGOE91",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE91",5,0)
 ;
"RTN","PSGOE91",6,0)
41 ; admin times
"RTN","PSGOE91",7,0)
 S MSG=0,PSGF2=41,ORIG=$G(PSGAT) S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",8,0)
 I $$ODD^PSGS0(PSGS0XT)!(PSGST="P")!$$PRNOK^PSGS0($G(PSGSCH)) G DONE
"RTN","PSGOE91",9,0)
A41 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",10,0)
 . W !!?5,"ADMIN TIMES may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",11,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!('$T) W:'$T $C(7) S PSGOEE=0 S:X="^" (X,PSGAT)=ORIG G DONE
"RTN","PSGOE91",12,0)
 I X="" S:$G(PSGAT) X=PSGAT
"RTN","PSGOE91",13,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A41
"RTN","PSGOE91",14,0)
 I X="@" I (PSGS0XT="D")!(PSGSCH["@") I ((",P,R,OC,O,")'[(","_$G(PSGST)_",")) D  G A41
"RTN","PSGOE91",15,0)
 .W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(55.06,41)
"RTN","PSGOE91",16,0)
 I X="@" D DEL G:%'=1 A41 S PSGAT="",X=""
"RTN","PSGOE91",17,0)
 I (PSGST="O")!($G(PSGST)="OC")!($G(PSGST)="P")!$$ODD^PSGS0($P(ZZND,"^",3))!($P(ZZND,"^",5)="O") I X="" S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE91",18,0)
 I $G(PSGS0XT) I '$$ODD^PSGS0(PSGS0XT),$G(PSGST)'="P",$G(PSGST)'="OC",'$$PRNOK^PSGS0(PSGSCH) I ($G(PSGST)'="O") D TIMES I '$D(X) G A41
"RTN","PSGOE91",19,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",20,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",21,0)
 S PSGOAT=PSGAT
"RTN","PSGOE91",22,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE91",23,0)
 ;
"RTN","PSGOE91",24,0)
8 ; special instructions
"RTN","PSGOE91",25,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE91"
"RTN","PSGOE91",26,0)
A8 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE91",27,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE91",28,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE91",29,0)
 I $E(X)=U D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",30,0)
 S PSGSI=$$EDITSI^PSJBCMA5($G(PSGP),$G(PSGORD)) I $G(PSGP),$G(PSGORD) I '$$DIFFSI^PSJBCMA5(PSGP,PSGORD) S PSGOEE=0 G DONE
"RTN","PSGOE91",31,0)
 S PSGSI=$S((PSGSI>0&(PSGSI<4)):$G(^PS(53.45,+PSJSYSP,5,1,0))_" "_$G(^PS(53.45,+PSJSYSP,5,2,0)),PSGSI>3:"Instructions too long. See Order View or BCMA for full text.",1:"")
"RTN","PSGOE91",32,0)
 I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE91",33,0)
 Q
"RTN","PSGOE91",34,0)
 ;
"RTN","PSGOE91",35,0)
10 ; start date/time
"RTN","PSGOE91",36,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE91"
"RTN","PSGOE91",37,0)
A10 ;
"RTN","PSGOE91",38,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",39,0)
 . W !!?5,"Start Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",40,0)
 K PSGSDX
"RTN","PSGOE91",41,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",42,0)
 I X="",PSGSD W "  "_PSGSDN G DONE
"RTN","PSGOE91",43,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE91",44,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,10)
"RTN","PSGOE91",45,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A10
"RTN","PSGOE91",46,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(55.06,10) G A10
"RTN","PSGOE91",47,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE91",48,0)
 S (PSGSDX,PSGSD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) G DONE
"RTN","PSGOE91",49,0)
 ;
"RTN","PSGOE91",50,0)
34 ; stop date
"RTN","PSGOE91",51,0)
 S MSG=0,PSGF2=34 S:PSGOEEF(PSGF2) BACK="34^PSGOE91"
"RTN","PSGOE91",52,0)
A34 ;
"RTN","PSGOE91",53,0)
 K PSGFDX
"RTN","PSGOE91",54,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",55,0)
 . W !!?5,"Stop Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",56,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",57,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W34
"RTN","PSGOE91",58,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A34
"RTN","PSGOE91",59,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,34)
"RTN","PSGOE91",60,0)
 I X=+X,(X>0),(X'>2000000) G A34:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE91",61,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A34 S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE91",62,0)
W34 ;Compare to Start Date
"RTN","PSGOE91",63,0)
 N Z,MSG
"RTN","PSGOE91",64,0)
 D DOSE I $G(Z)]"",Z>$S($G(PSGFD):PSGFD,1:$G(PSGNEFD)) D  G A34
"RTN","PSGOE91",65,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSGOE91",66,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSGOE91",67,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE91",68,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE91",69,0)
 ;
"RTN","PSGOE91",70,0)
DONE ;
"RTN","PSGOE91",71,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE91",72,0)
 ;BHW;PSJ*5*179; - Remove EFD call.  Added to PSGOEE.
"RTN","PSGOE91",73,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE91",74,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT,ORIG Q
"RTN","PSGOE91",75,0)
 ;
"RTN","PSGOE91",76,0)
FF ; up-arrow to another field
"RTN","PSGOE91",77,0)
 D ENFF^PSGOEM I Y>0,Y'=41,Y'=8,Y'=10,Y'=34 S Y=Y_"^PSGOE9"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE91"
"RTN","PSGOE91",78,0)
 Q
"RTN","PSGOE91",79,0)
 ;
"RTN","PSGOE91",80,0)
DEL ; delete entry
"RTN","PSGOE91",81,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE91",82,0)
 Q
"RTN","PSGOE91",83,0)
 ;
"RTN","PSGOE91",84,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSGOE91",85,0)
 I $G(PSGST)'="O",($G(PSGST)'="OC"),($G(PSGST)'="R") I X="" D EN^DDIOL("This order requires at least one administration time.") K X Q  ;No times
"RTN","PSGOE91",86,0)
 N H,I,MAX
"RTN","PSGOE91",87,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE91",88,0)
 I $G(PSGST)="O",$L(X,"-")>1 D EN^DDIOL("This is a One Time Order. Only one administration time is permitted.") K X Q
"RTN","PSGOE91",89,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE91",90,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE91",91,0)
 S MAX=1440/I
"RTN","PSGOE91",92,0)
 I MAX<1,$L(X,"-")>1 D EN^DDIOL("This order requires one administration time.") K X Q
"RTN","PSGOE91",93,0)
 I MAX'<1,$L(X,"-")>MAX D EN^DDIOL("The number of admin times entered is greater than indicated by the schedule.") K X Q  ;Too many times
"RTN","PSGOE91",94,0)
 I MAX'<1,$L(X,"-")<MAX D EN^DDIOL("The number of admin times entered is fewer than indicated by the schedule.")  ;Too few times
"RTN","PSGOE91",95,0)
 Q
"RTN","PSGOE91",96,0)
 ;
"RTN","PSGOE91",97,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE91",98,0)
 N INFO,X
"RTN","PSGOE91",99,0)
 S Z="",INFO=($S($G(PSGSD):PSGSD,1:$G(PSGNESD)))_U_($S($G(PSGFD):PSGFD,1:$G(PSGNEFD)))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE91",100,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE91",101,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE91",102,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE91",103,0)
 Q
"RTN","PSGOEE")
0^44^B96504063^B82566620
"RTN","PSGOEE",1,0)
PSGOEE ;BIR/CML3-EDIT ACTIVE OR NON-VERIFIED ORDERS ; 8/12/10 5:59pm
"RTN","PSGOEE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,7,29,47,64,58,82,91,110,111,112,142,179,181,254,267**;16 DEC 97;Build 158
"RTN","PSGOEE",3,0)
 ;
"RTN","PSGOEE",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEE",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA# 2789.
"RTN","PSGOEE",6,0)
 ;
"RTN","PSGOEE",7,0)
 D NOW^%DTC S PSGDT=% K PSGEFN,PSGOEEF S PSGOEEF=0 I PSGORD["A"!(PSGORD["O") G ACT
"RTN","PSGOEE",8,0)
531 ; edit orders in 53.1
"RTN","PSGOEE",9,0)
ENF ; Entry point
"RTN","PSGOEE",10,0)
 D EN2^PSGOEEW
"RTN","PSGOEE",11,0)
 K PSJACEPT D EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",12,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",13,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",14,0)
 E  D
"RTN","PSGOEE",15,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",16,0)
 I $G(PSGOEAV) D ACT1 Q
"RTN","PSGOEE",17,0)
 D DONE1
"RTN","PSGOEE",18,0)
 S PSGOEEF=0,PSJORD=PSGORD D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD)
"RTN","PSGOEE",19,0)
 Q
"RTN","PSGOEE",20,0)
ACT ; Perform Edit
"RTN","PSGOEE",21,0)
 NEW PSJALGY1
"RTN","PSGOEE",22,0)
 K PSGOEER
"RTN","PSGOEE",23,0)
 D EN2^PSGOEEW,EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",24,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",25,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",26,0)
 E  D
"RTN","PSGOEE",27,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",28,0)
 S:$D(PSGOEF)!$G(PSGOEENO) PSGCANFL=-1
"RTN","PSGOEE",29,0)
ACT1 ; Continue editing
"RTN","PSGOEE",30,0)
 D DONE1
"RTN","PSGOEE",31,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD) D:PSGOEAV UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOEE",32,0)
 Q
"RTN","PSGOEE",33,0)
EDIT ; Edit
"RTN","PSGOEE",34,0)
 I $G(Y) D ASKOVR(Y,$G(PSGORD),.PSJSTARI)
"RTN","PSGOEE",35,0)
 D FULL^VALM1
"RTN","PSGOEE",36,0)
 W ! S PSGOEER="" F Q=1:1 S Q1=$P(Y,",",Q) Q:'Q1  S X=$P($T(@(PSGOEEG_Q1)),";",3),PSGOEER=PSGOEER_X_";",PSGOEEF(+X)=Q S:Q1=1 PSJALGY1=1
"RTN","PSGOEE",37,0)
 S LIMIT=$L(PSGOEER,";")-1,(PSGDEF,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>LIMIT  I +$P(PSGOEER,";",PSGOEE)=101 S PSGDEF=1
"RTN","PSGOEE",38,0)
 S PSGOEER=$E(PSGOEER,1,$L(PSGOEER)-1),(MSG,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>$L(PSGOEER,";")  S F1=$S(PSGOEEG=3:53.1,1:55.06) I 'PSGDEF!((PSGDEF)&(+$P(PSGOEER,";",PSGOEE)'=2)) D @$P(PSGOEER,";",PSGOEE) Q:'PSGOEE
"RTN","PSGOEE",39,0)
 Q
"RTN","PSGOEE",40,0)
EDLOOP ; Continue prompting for fields to edit.
"RTN","PSGOEE",41,0)
 K PSJNOO,PSGPRIF
"RTN","PSGOEE",42,0)
 D:$G(Y) EDIT
"RTN","PSGOEE",43,0)
 D ENNOU^PSGOEE0 I '$G(PSGOEENO),DR="" S VALMBCK="R" Q
"RTN","PSGOEE",44,0)
 K VALMSG
"RTN","PSGOEE",45,0)
 I '$G(PSGOEENO),$G(PSGPDNX) D CKDT
"RTN","PSGOEE",46,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",47,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS,CHKDD,CKDT
"RTN","PSGOEE",48,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT)
"RTN","PSGOEE",49,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSGOEE",50,0)
 K VALMBCK,PSJACEPT,PSGPDNX D EN^VALM("PSJU LM ACCEPT") Q:'$G(PSJACEPT)
"RTN","PSGOEE",51,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y) I ((",P,R,")'[(","_$G(PSGST)_",")) D  Q
"RTN","PSGOEE",52,0)
 .S PSJACEPT=0 W !!,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D PAUSE^VALM1
"RTN","PSGOEE",53,0)
 I ($G(PSGOEER)["26^PSGOE9")!($G(PSGOEER)["26^PSGOE8")!($G(PSGOEER)["109^PSGOE9")!($G(PSGOEER)["109^PSGOE8")!($G(PSGOEER)["3^PSGOE9")!($G(PSGOEER)["3^PSGOE8")!($G(PSGOEER)["101^PSGOE9")!($G(PSGOEER)["101^PSGOE8") S PSGOEENO=1
"RTN","PSGOEE",54,0)
 I $G(PSGOEENO)!($G(PSGOEER)["2^PSGOE92")!($G(PSGOEER)["2^PSGOE82") D OC
"RTN","PSGOEE",55,0)
 I $G(PSGORQF) S PSJNOO=-1
"RTN","PSGOEE",56,0)
 I '$G(PSJNOO),$G(PSGOEENO) S PSJNOO=$$ENNOO^PSJUTL5("E")
"RTN","PSGOEE",57,0)
 D K1 S PSJACEPT=$S($G(PSJNOO)<0:0,1:1)
"RTN","PSGOEE",58,0)
 S VALMBCK=$S('PSJACEPT:"R",'PSGOEAV:"R",1:"Q")
"RTN","PSGOEE",59,0)
 Q
"RTN","PSGOEE",60,0)
OC ;Perform OC (only when OI was edited) & dosing check
"RTN","PSGOEE",61,0)
 NEW PSJDD,PSJALLGY
"RTN","PSGOEE",62,0)
 K PSGORQF
"RTN","PSGOEE",63,0)
 D FULL^VALM1
"RTN","PSGOEE",64,0)
 S PSJDD=+$$DD53P45^PSJMISC() I 'PSJDD S PSGORQF=1 Q
"RTN","PSGOEE",65,0)
 I $G(PSJALGY1),$G(PSGOEENO) D
"RTN","PSGOEE",66,0)
 . D ENDDC^PSGSICHK(PSGP,PSJDD)
"RTN","PSGOEE",67,0)
 D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOEE",68,0)
 Q
"RTN","PSGOEE",69,0)
CHKDD ;*** Check inactive Dispense drug within the order.
"RTN","PSGOEE",70,0)
 D CHKDRG^PSGOE2
"RTN","PSGOEE",71,0)
 Q
"RTN","PSGOEE",72,0)
CKDT ; Check if new start/stop dates should be calculated.
"RTN","PSGOEE",73,0)
 S PSGS0Y=$S($D(PSGS0Y):PSGS0Y,1:$G(PSGAT))
"RTN","PSGOEE",74,0)
 ;PSJ*5*179 Recalc start date if Before last given
"RTN","PSGOEE",75,0)
 I ($P($G(PSBSTR),"^")>PSGSD)!('$G(PSGNEWDT)&(PSGSD=$G(PSGOSD))&(PSGFD=$G(PSGOFD)))!($G(PSGOST)'=PSGST)!(PSGSCH'=$G(PSGOSCH))!($G(PSGPDNX)) D
"RTN","PSGOEE",76,0)
 .N PSGOES S PSGOES=1,PSGOFD=PSGFD D ^PSGNE3 I $G(PSGOFD) S PSGNEFD=PSGFD
"RTN","PSGOEE",77,0)
 .S PSGSD=PSGNESD,PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFD=PSGNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD),PSGNEWDT=1
"RTN","PSGOEE",78,0)
 .I $D(PSGOFD),PSGOFD]"",PSGFD'=PSGOFD S PSGOEEF(25)=1
"RTN","PSGOEE",79,0)
 .I $D(PSGOSD),PSGOSD]"",PSGSD'=PSGOSD S PSGOEEF(10)=1
"RTN","PSGOEE",80,0)
 ;BHW;PSJ*5*179;Add EFD call here, removed from PSGOE91
"RTN","PSGOEE",81,0)
 D EFDACT^PSJUTL
"RTN","PSGOEE",82,0)
 Q
"RTN","PSGOEE",83,0)
NEW3 ;
"RTN","PSGOEE",84,0)
 ;S:PSGOEAV PSGOEAV="0^1"
"RTN","PSGOEE",85,0)
NEW ;
"RTN","PSGOEE",86,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) N PSJFSI S PSJFSI=1 D FILESI^PSJBCMA5(DFN,PSGORD) N SIARRAY S SIARRAY="" D
"RTN","PSGOEE",87,0)
 .I PSGORD["P" M SIARRAY=^PS(53.1,+PSGORD,15) D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",88,0)
 .I PSGORD["U" M SIARRAY=^PS(55,DFN,5,+PSGORD,15) D NEWUDAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",89,0)
 W !,"...discontinuing original order..."
"RTN","PSGOEE",90,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSGOEE",91,0)
 ;DC and Unlock order.
"RTN","PSGOEE",92,0)
 S PSGEDIT="DE" D ENOR^PSGOECS,UNL^PSSLOCK(PSGP,PSGORD) K PSGEDIT
"RTN","PSGOEE",93,0)
 W !!," ...creating new order..." W:'PSGOEAV "(you will now work on this new order)"
"RTN","PSGOEE",94,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSGOEE",95,0)
 S PSGOORD=PSGORD D ^PSGOETO K PSGOEOS
"RTN","PSGOEE",96,0)
 I PSGOORD["U" S $P(^PS(55,PSGP,5,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",97,0)
 E  S $P(^PS(53.1,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",98,0)
 I $G(PSJFSI) I $$GETSI^PSJBCMA5(DFN,PSGOORD) D FILESI^PSJBCMA5(DFN,PSGORD)
"RTN","PSGOEE",99,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSGOEE",100,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSGOEE",101,0)
 I PSGOEAV,+PSJSYSU=3,'$D(PSGOES) D EN^PSGPEN(PSGORD),UNL^PSSLOCK(PSGP,PSGORD) Q
"RTN","PSGOEE",102,0)
 S PSJORD=PSGORD,PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD)
"RTN","PSGOEE",103,0)
 Q
"RTN","PSGOEE",104,0)
UPD ;
"RTN","PSGOEE",105,0)
 K DA W !!,"...updating order..."
"RTN","PSGOEE",106,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEE",107,0)
 I $$DIFFSI^PSJBCMA5(DFN,PSGORD) D
"RTN","PSGOEE",108,0)
 .N SIARRAY M:PSGORD["P" SIARRAY=^PS(53.1,+PSGORD,15) M:PSGORD["U" SIARRAY=^PS(55,DFN,5,+PSGORD,15)
"RTN","PSGOEE",109,0)
 .Q:'$D(SIARRAY)
"RTN","PSGOEE",110,0)
 .I PSGORD["P" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",111,0)
 .I PSGORD["U" D NEWUDAL^PSGAL5(DFN,PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEE",112,0)
 ; Set trigger for FIELD (12) Dispense Drug to print a updated pick list.
"RTN","PSGOEE",113,0)
 I PSGORD["U",$D(^PS(53.45,PSJSYSP,2,1,0)),$D(^PS(55,PSGP,5,+PSGORD,1,1,0)) D
"RTN","PSGOEE",114,0)
 .N PSJX12,PSJF12 S PSJF12=0
"RTN","PSGOEE",115,0)
 .F PSJX12=0:1 S PSJX12=$O(^PS(53.45,PSJSYSP,2,PSJX12)) Q:+PSJX12=0  S:$G(^PS(53.45,PSJSYSP,2,PSJX12,0))'=$G(^PS(55,PSGP,5,+PSGORD,1,PSJX12,0)) PSJF12=1
"RTN","PSGOEE",116,0)
 .S:PSJF12 ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEE",117,0)
 N TMP,PSGSIF S TMP=PSGOEENO N PSGOEENO S PSGOEENO=TMP
"RTN","PSGOEE",118,0)
 N II F II=1:1:$L($G(DR),";") I $E($P($G(DR),";",II),1,7)="122////" S PSGSIF=$P(PSGSI,"^",2),PSGSI=$P(PSGSI,"^") Q
"RTN","PSGOEE",119,0)
 I $G(PSJCOM),$G(PSJCOMSI) K PSJCOMSI,^TMP("PSGSI",$J) M ^TMP("PSGSI",$J,5)=^PS(53.45,PSJSYSP,5) D
"RTN","PSGOEE",120,0)
 .D FILESI^PSJBCMA5(DFN,PSGORD)
"RTN","PSGOEE",121,0)
 .N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSGOEE",122,0)
 .. S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSGOEE",123,0)
 ... Q:PSJCHILD=PSGORD  N DR,DA,DIE,ORD S DR=$S(PSJCHILD["V":"31////"_$G(P("OPI")),1:"8////"_$G(PSGSI)) S DR=DR_";"_$S(PSJCHILD["V":146,1:122)_"////"_+$G(PSGSIF)
"RTN","PSGOEE",124,0)
 ... I '$D(^PS(53.45,+$G(PSJSYSP),5)) M ^PS(53.45,+$G(PSJSYSP),5)=^TMP("PSGSI",$J,5)
"RTN","PSGOEE",125,0)
 ... D FILESI^PSJBCMA5(DFN,PSJCHILD)
"RTN","PSGOEE",126,0)
 ... ;PSJ*5*179 Comment edits
"RTN","PSGOEE",127,0)
 ... S DR=$TR(DR,"*") I DR'="" S DA=+PSJCHILD,DIE=$S(PSJCHILD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "." D EN1^PSJHL2(PSGP,"XX",+PSJCHILD_"U")
"RTN","PSGOEE",128,0)
 . K ^TMP("PSGSI",$J)
"RTN","PSGOEE",129,0)
 S DR=$TR(DR,"*") I DR'="" S DA=+PSGORD,DIE=$S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "."
"RTN","PSGOEE",130,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."
"RTN","PSGOEE",131,0)
 S $P(@(PSGOEEWF_"1,0)"),"^",2)=$S(PSGORD["U":55.07,1:53.11)_"P"
"RTN","PSGOEE",132,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) D FILESI^PSJBCMA5(DFN,PSJORD)
"RTN","PSGOEE",133,0)
 ; Naked reference on the line below refers to full reference using indirection to either ^PS(55 or ^PS(53.1,
"RTN","PSGOEE",134,0)
 S ND=$G(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",0)")) I $P(ND,"^",21) S ORIFN=$P(ND,"^",21),ND1=$G(^(.2)),ND2=$G(^(2)) W !,"...updating OE/RR..." D EN1^PSJHL2(PSGP,"XX",PSGORD)
"RTN","PSGOEE",135,0)
 I $$ENACTION^PSGOE1(PSGP,PSGORD)["V" S VALMBCK="R"
"RTN","PSGOEE",136,0)
 I PSJSYSL,PSJSYSL<3 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",137,0)
 Q
"RTN","PSGOEE",138,0)
OUT ;
"RTN","PSGOEE",139,0)
 D ABORT K PSGNEWDT S PSGCANFL=1 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD)
"RTN","PSGOEE",140,0)
 Q
"RTN","PSGOEE",141,0)
DONE ;
"RTN","PSGOEE",142,0)
 I PSGORD["P",'$D(PSGOEF),PSGSCH]"",$O(^PS(53.1,+PSGORD,1,0)) D ENF^PSGOEE0
"RTN","PSGOEE",143,0)
DONE1 ;
"RTN","PSGOEE",144,0)
 I PSGORD["U" S X=+PSGORD L -^PS(55,PSGP,5,X)
"RTN","PSGOEE",145,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOEE",146,0)
 K ^PS(53.45,+PSJSYSP,1),^(2),^(5),^(6)
"RTN","PSGOEE",147,0)
 I '$D(PSGOEF) K PSGSD,PSGSCH,PSGST,PSGFD
"RTN","PSGOEE",148,0)
 K DA,DIE,DIR,DP,DR,DRG,ND,ND0,ND1,ND2,ORIFN,PSGAL,PSGALEF,PSGAT,PSGOEE,PSGOEEF,PSGOEEG,PSGOEEWF,PSGEFN,PSGTOL,PSGTOO,PSGUOW,XREF,PSGEFN,PSGMR,PSGMRN,PSGOROE1,PSGPD,PSGPDN,PSGSI,PSGPR,PSGSM,PSGHSM,PSGSTN,PSGSDN,PSGFDN,PSGPRN
"RTN","PSGOEE",149,0)
 K PSGDO,PSGOEENO,PSGPRIF Q
"RTN","PSGOEE",150,0)
K1 ;
"RTN","PSGOEE",151,0)
 K BACK,F1,F2,PSGF2,MSG,PSGEFN,PSGNEWDT,PSGOEEND,PSGOPD,PSGOPDN,PSGOMR,PSGOMRN,PSGOSCH,PSGOSI,PSGOPR,PSGOSM,PSGOHSM,PSGOSD,PSGOFD,PSGOST,PSGOPRN,PSGOSTN,PSGOSDN,PSGOFDN,PSGODO,PSGPDRG,PSGPDRGN,PSGOEER
"RTN","PSGOEE",152,0)
 Q
"RTN","PSGOEE",153,0)
 ;
"RTN","PSGOEE",154,0)
ABORT ; Display no change message and pause.
"RTN","PSGOEE",155,0)
 S (PSGDI,PSGDFLG)='$$DDOK^PSGOE2(PSGOEEWF_"1,",+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",156,0)
 S PSGPFLG='$$OIOK^PSGOE2(+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",157,0)
 W !!,$C(7),"No changes made to this order." D PAUSE^VALM1 K PSGOEEF S PSGOEEF=0
"RTN","PSGOEE",158,0)
 Q
"RTN","PSGOEE",159,0)
 ;
"RTN","PSGOEE",160,0)
GTSTATUS ; Determine status of new order and set LM title.
"RTN","PSGOEE",161,0)
 S PSGSTAT=$S($P($G(PSJSYSP0),U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEE",162,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S(PSGSTAT="PENDING":"("_PSGPRIO_")",1:"")
"RTN","PSGOEE",163,0)
 Q
"RTN","PSGOEE",164,0)
 ;
"RTN","PSGOEE",165,0)
ASKOVR(Y,PSJOVRON,PSJSTARI)  ; Check to see if any starred fields are being edited. If so, ask if they wish to view overrides/interventions if they exist
"RTN","PSGOEE",166,0)
 Q:'$D(Y)!$D(PSJSTARI)  N II,I3,YY S YY=$S(Y:Y,1:$TR($P(Y,"^",4),"="))
"RTN","PSGOEE",167,0)
 Q:'YY  S PSJOVRON=$S($G(PSJOVRON):PSJOVRON,1:$G(PSJORD)) Q:'$G(PSJOVRON)
"RTN","PSGOEE",168,0)
 N PSJORD S PSJORD=PSJOVRON
"RTN","PSGOEE",169,0)
 I '$G(PSJSTARI) F II=1:1:$L(YY,",") Q:$G(PSJSTARI)  S I3=$P(YY,",",II) I I3 S:$G(PSGEFN(I3))!($G(PSJSTAR)[("("_I3_")")) PSJSTARI=1
"RTN","PSGOEE",170,0)
 I $G(PSJSTARI) I ($G(PSJORD)&$G(PSGP)) I $$ASKDISP^PSGSICH1 D FULL^VALM1 D OVRDISP^PSGSICH2(PSGP,PSJORD,3)
"RTN","PSGOEE",171,0)
 Q
"RTN","PSGOEE",172,0)
 ;
"RTN","PSGOEE",173,0)
FIELDS ;
"RTN","PSGOEE",174,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",175,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",176,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEE",177,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",178,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEE",179,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEE",180,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",181,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",182,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEE",183,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",184,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",185,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEE",186,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEE",187,0)
51 ;;101^PSGOE9;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",188,0)
52 ;;109^PSGOE9;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",189,0)
53 ;;10^PSGOE91;PSGOSD;PSGSD;10;1
"RTN","PSGOEE",190,0)
54 ;;3^PSGOE9;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",191,0)
55 ;;34^PSGOE91;PSGOFD;PSGFD;34;1 
"RTN","PSGOEE",192,0)
56 ;;7^PSGOE9;PSGOST;PSGST;7;0
"RTN","PSGOEE",193,0)
57 ;;5^PSGOE92;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",194,0)
58 ;;26^PSGOE9;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",195,0)
59 ;;41^PSGOE91;PSGOAT;PSGAT;41;0
"RTN","PSGOEE",196,0)
510 ;;1^PSGOE92;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",197,0)
511 ;;8^PSGOE91;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",198,0)
512 ;;2^PSGOE92;;;2;0
"RTN","PSGOEE",199,0)
513 ;;15^PSGOE92;;;15;0
"RTN","PSGOEF1")
0^43^B28843982^B29780196
"RTN","PSGOEF1",1,0)
PSGOEF1 ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR (CONT) ;02 Feb 2001  12:20 PM
"RTN","PSGOEF1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**2,7,35,39,45,47,50,63,67,58,95,110,186,181,267**;16 DEC 97;Build 158
"RTN","PSGOEF1",3,0)
 ;
"RTN","PSGOEF1",4,0)
 ; Reference to ^VALM1 is supported by DBIA# 10116.
"RTN","PSGOEF1",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOEF1",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOEF1",7,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSGOEF1",8,0)
 ; Reference to ^%RCR is supported by DBIA 10022.
"RTN","PSGOEF1",9,0)
 ; Reference to ^DIE is supported by DBIA 10018.
"RTN","PSGOEF1",10,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSGOEF1",11,0)
 ;
"RTN","PSGOEF1",12,0)
UPD ;
"RTN","PSGOEF1",13,0)
 W !!,"...accepting order..."
"RTN","PSGOEF1",14,0)
 I PSGST="",(PSGSCH="NOW"!(PSGSCH="ONCE")) S PSGST="O"
"RTN","PSGOEF1",15,0)
 I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEF1",16,0)
 K DA,DR S DA=+PSGORD,DIE="^PS(53.1,",DR="28////N;4////U"_";7////"_PSGST_";10////"_PSGSD_";25////"_PSGFD
"RTN","PSGOEF1",17,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S ^PS(53.1,DA,6)=PSGSI
"RTN","PSGOEF1",18,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S $P(^PS(53.1,DA,6),U)=$P(PSGSI,U) I $P(^PS(53.1,DA,6),U)="" S $P(^PS(53.1,DA,6),U,2)=""
"RTN","PSGOEF1",19,0)
 S:PSGOEFF#2 DR=DR_";26////"_PSGSCH
"RTN","PSGOEF1",20,0)
 I PSGSM,PSGOHSM'=PSGHSM S DR=DR_";5////"_PSGSM_";6////"_PSGHSM
"RTN","PSGOEF1",21,0)
 D ^DIE W "."
"RTN","PSGOEF1",22,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."  ;MOU-0100-30945
"RTN","PSGOEF1",23,0)
 S PSGND=$G(^PS(53.1,+PSGORD,0)),X=$P(PSGND,U,24)
"RTN","PSGOEF1",24,0)
 I $S(X="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:X'="E") S X=$G(^PS(53.1,DA,2)) D ENWALL^PSGNE3(+$P(X,U,2),+$P(X,U,4),PSGP)
"RTN","PSGOEF1",25,0)
 I $P(PSGND,U,24)="R",$P(PSGND,U,25),PSGSD<$P($G(^PS(55,PSGP,5,+$P(PSGND,U,25),2)),U,4) D
"RTN","PSGOEF1",26,0)
 .K DA,DR S DA(1)=PSGP,DA=+$P(PSGND,U,25),DIE="^PS(55,"_PSGP_",5,",DR="34////"_PSGFD_";25////"_$P($G(^PS(55,PSGP,5,+$P(PSGND,U,25),2)),U,4)
"RTN","PSGOEF1",27,0)
 .D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(PSGND,U,25))
"RTN","PSGOEF1",28,0)
 S $P(^PS(53.1,+PSGORD,.2),U,2)=PSGDO,$P(^PS(53.1,+PSGORD,2),U,5)=PSGAT S:$G(PSGS0XT) $P(^(2),U,6)=PSGS0XT
"RTN","PSGOEF1",29,0)
 I 'PSGOEAV D NEWNVAL^PSGAL5(PSGORD,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSGOEF1",30,0)
 I $D(^PS(53.45,+$G(DUZ),5,1,0)) D FILESI^PSJBCMA5(PSGP,PSGORD) N SIARRAY S SIARRAY="" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOEF1",31,0)
 I $D(^PS(53.45,+$G(DUZ),6,1,0)) D FILEOPI^PSJBCMA5(PSGP,PSGORD) N SIARRAY S SIARRAY="" D NEWNVAL^PSGAL5(PSGORD,6000,"OTHER PRINT INFO",,.SIARRAY)
"RTN","PSGOEF1",32,0)
 I PSGOEAV,+$G(PSJSYSU)=3 D VFY^PSGOEV Q
"RTN","PSGOEF1",33,0)
 I PSGOEAV,$G(PSJRNF) D VFY^PSGOEV
"RTN","PSGOEF1",34,0)
 Q
"RTN","PSGOEF1",35,0)
 ;
"RTN","PSGOEF1",36,0)
ENDRG(PSGPDRG,DRGDA) ; enter dispense drug for order w/o one
"RTN","PSGOEF1",37,0)
 NEW PSJALLGY
"RTN","PSGOEF1",38,0)
 K PSGORQF
"RTN","PSGOEF1",39,0)
 D NOW^%DTC K DRG S (DRG,Q)=0 F  S Q=$O(^PSDRUG("ASP",+PSGPDRG,Q)) Q:'Q  I $D(^PSDRUG(Q,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>%) S DRG=DRG+1,DRG(DRG)=Q_"^"_^(0)
"RTN","PSGOEF1",40,0)
 I 'DRG W $C(7),!!,"No dispense drugs were found for this order's Orderable Item." K DIR S DIR(0)="E" D ^DIR K DIR S CHK=-1 Q
"RTN","PSGOEF1",41,0)
 S:DRG=1 Y(0)=1
"RTN","PSGOEF1",42,0)
 I DRG>1 D  I 'Y S DRG=0,CHK=-1 Q
"RTN","PSGOEF1",43,0)
 .W !!,"CHOOSE FROM:" F Q=1:1:DRG W !?3,$J(Q,3),". ",$P(DRG(Q),"^",2)
"RTN","PSGOEF1",44,0)
 .N DIR S DIR(0)="LAO^1:"_DRG_U_"I X#1!(X[""."") K X",DIR("A")="Select DISPENSE DRUG(S) for this order: " S:DRG=1 DIR("B")=1 S DIR("?")="^D DRGH^PSGOEF1" W ! D ^DIR
"RTN","PSGOEF1",45,0)
 ;
"RTN","PSGOEF1",46,0)
 S DRG=Y(0) F Q1=1:1 S Q2=$P(DRG,",",Q1) Q:'Q2  D
"RTN","PSGOEF1",47,0)
 . S PSJALLGY(+DRG(Q2))=""
"RTN","PSGOEF1",48,0)
 I 'DRGDA S ^PS(53.45,PSJSYSP,2,0)="^53.4502P"
"RTN","PSGOEF1",49,0)
 F Q1=1:1 S Q2=$P(DRG,",",Q1) Q:'Q2  D
"RTN","PSGOEF1",50,0)
 . S DRGDA=DRGDA+1,^PS(53.45,PSJSYSP,2,DRGDA,0)=+DRG(Q2),^PS(53.45,PSJSYSP,2,"B",+DRG(Q2),DRGDA)=""
"RTN","PSGOEF1",51,0)
 . S DA(1)=PSJSYSP,DA=DRGDA,DIE="^PS(53.45,"_PSJSYSP_",2,",DR=".02//1" W !!,$P(DRG(Q2),U,2) D ^DIE
"RTN","PSGOEF1",52,0)
 D ENCKDD(PSGP,+$O(PSJALLGY(0))) Q:$G(PSGORQF)
"RTN","PSGOEF1",53,0)
 S PSGDI=0
"RTN","PSGOEF1",54,0)
 S:DRGDA>0 $P(^PS(53.45,PSJSYSP,2,0),"^",3,4)=DRGDA_"^"_DRGDA,CHK=0 Q
"RTN","PSGOEF1",55,0)
 Q
"RTN","PSGOEF1",56,0)
 ;
"RTN","PSGOEF1",57,0)
DRGH ;
"RTN","PSGOEF1",58,0)
 W !!?2,"This order must have at least one dispense drug before it can be completed.",!,"Select one or more items listed.  For each item selected, you will be",!,"prompted for the UNITS PER DOSE for the item."
"RTN","PSGOEF1",59,0)
 Q
"RTN","PSGOEF1",60,0)
ENIVUD(PSJORD)     ;
"RTN","PSGOEF1",61,0)
 ;Determine if user should be prompted to transfer the order to IV.
"RTN","PSGOEF1",62,0)
 ;  INPUT: PSJORD - IEN in 53.1_order location code.
"RTN","PSGOEF1",63,0)
 ; OUTPUT: 1 - Order not transferred, process as always.
"RTN","PSGOEF1",64,0)
 ;         0 - User selected to transfer order and quit upon return.
"RTN","PSGOEF1",65,0)
 ;
"RTN","PSGOEF1",66,0)
 NEW DIR,DIRUT,PSJCOI,PSJND0,Y
"RTN","PSGOEF1",67,0)
 S PSJND0=$G(^PS(53.1,+PSJORD,0)),PSJCOI=+$G(^PS(53.1,+PSJORD,.2))
"RTN","PSGOEF1",68,0)
 I $P(PSJND0,U,4)="F" Q 1
"RTN","PSGOEF1",69,0)
 D FULL^VALM1
"RTN","PSGOEF1",70,0)
 I $S($P(PSJND0,U,24)="R":1,1:'$P(PSJND0,U,13)) Q 1
"RTN","PSGOEF1",71,0)
 S DIR(0)="SAB^I:IV;U:UNIT DOSE",DIR("A")="COMPLETE THIS ORDER AS IV OR UNIT DOSE? ",DIR("B")=$S($P(PSJND0,U,4)="I":"IV",1:"UNIT DOSE")
"RTN","PSGOEF1",72,0)
 S DIR("??")="^D THELP^PSGOEF1("""_$S(DIR("B")="IV":"UNIT DOSE",1:"IV")_""","_PSJCOI_")"
"RTN","PSGOEF1",73,0)
 D ^DIR K DIR
"RTN","PSGOEF1",74,0)
 I $D(DTOUT)!$D(DUOUT) Q 0
"RTN","PSGOEF1",75,0)
 I Y="I" D  Q 0
"RTN","PSGOEF1",76,0)
 . I +PSJSYSU=1,'$G(PSJIRNF) W !!!!,"You need the PSJI RNFINISH key to finish this order as IV!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",77,0)
 . D IV^PSJLIFNI(PSJORD,PSJCOI)
"RTN","PSGOEF1",78,0)
 I Y="U" D  Q 0
"RTN","PSGOEF1",79,0)
 . I +PSJSYSU=1,'$G(PSJRNF) W !!!!,"You need the PSJ RNFINISH key to finish this order as Unit Dose!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",80,0)
 . I $G(PSJITECH),($P(PSJSYSU,";",3)'=3) W !!!!,"You may not finish this order as Unit Dose!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",81,0)
 . D ENUD^PSGOEF1(PSJORD,PSJCOI)
"RTN","PSGOEF1",82,0)
 Q 1
"RTN","PSGOEF1",83,0)
 ;
"RTN","PSGOEF1",84,0)
ENUD(PSJORD,PSGPD)       ;
"RTN","PSGOEF1",85,0)
 N PSJTUD S PSJTUD=1,DFN=$P($G(^PS(53.1,+PSJORD,0)),U,15)
"RTN","PSGOEF1",86,0)
 K DRG,DRGOC,DRGT,DRGTMP,ERR,ON,ON55,P,PSJSTAR,PSJTIM,UL80
"RTN","PSGOEF1",87,0)
 D DISACTIO^PSJOE(DFN,PSJORD,$G(PSJPNV)) S VALMBCK="Q"
"RTN","PSGOEF1",88,0)
 I +$G(PSGORQF) S VALMBCK="R"
"RTN","PSGOEF1",89,0)
 Q
"RTN","PSGOEF1",90,0)
THELP(PKG,COI) ;
"RTN","PSGOEF1",91,0)
 W !,"Choose the package this order should be completed as a IV or Unit Dose order",!
"RTN","PSGOEF1",92,0)
 Q
"RTN","PSGOEF1",93,0)
 ;
"RTN","PSGOEF1",94,0)
ENCKDD(PSGP,PSJDRG) ;
"RTN","PSGOEF1",95,0)
 ;If the OI is edited, the OC is done in ^PSGOEE (PSGOE8 - Non-VFY; PSGOE9 - Active)
"RTN","PSGOEF1",96,0)
 Q:$G(PSGOEER)["101^PSGOE8"
"RTN","PSGOEF1",97,0)
 Q:$G(PSGOEER)["101^PSGOE9"
"RTN","PSGOEF1",98,0)
 N DRG
"RTN","PSGOEF1",99,0)
 S PSGORQF=0
"RTN","PSGOEF1",100,0)
 D ENDDC^PSGSICHK(PSGP,PSJDRG) Q:$G(PSGORQF)
"RTN","PSGOEF1",101,0)
 D IN^PSJOCDS($G(PSGORD),"UD",+PSJDRG)
"RTN","PSGOEF1",102,0)
 Q
"RTN","PSGOEL")
0^72^B13821654^B13337438
"RTN","PSGOEL",1,0)
PSGOEL ;BIR/CML3-DISPLAY LOGS ;27 JUN 95 / 6:14 PM
"RTN","PSGOEL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**267**;16 DEC 97;Build 158
"RTN","PSGOEL",3,0)
 ;
"RTN","PSGOEL",4,0)
ENLM(PSGP,PSGORD) ;
"RTN","PSGOEL",5,0)
 S DIR(0)="SAO^1:Short Activity Log;2:Long Activity Log;3:Dispense Log;4:History Log;5:Instructions History",DIR("A")="Select LOG to display: ",DIR("A",1)="   1 - Short Activity Log"
"RTN","PSGOEL",6,0)
 S DIR("A",2)="   2 - Long Activity Log",DIR("A",3)="   3 - Dispense Log"
"RTN","PSGOEL",7,0)
 S DIR("A",4)="   4 - History Log",DIR("A",5)="   5 - Instructions History",DIR("A",6)="",DIR("?")="^D ENH^PSGOEL" W ! D ^DIR K DIR G:'Y DONE I Y<3 S AT=$E("SL",Y) D ENA^PSGVW0 G DONE
"RTN","PSGOEL",8,0)
 I Y=4 D ENHIS^PSJHIS(PSGP,PSGORD,"U") Q
"RTN","PSGOEL",9,0)
 I Y=5 N PSJINHIS S PSJINHIS=1 D ENHIS^PSJINHIS(PSGP,PSGORD,"U") Q
"RTN","PSGOEL",10,0)
 I '$O(^PS(55,PSGP,5,+PSGORD,11,0)) W !!,"There is NO DISPENSE LOG for this order at this time."
"RTN","PSGOEL",11,0)
 E  S Q=0 F C=1:1 S Q=$O(^PS(55,PSGP,5,+PSGORD,11,Q)) Q:'Q  S ND=$G(^(Q,0)) D PDL Q:'Y
"RTN","PSGOEL",12,0)
 ;
"RTN","PSGOEL",13,0)
DONE ;
"RTN","PSGOEL",14,0)
 Q
"RTN","PSGOEL",15,0)
 ;
"RTN","PSGOEL",16,0)
PDL ; print dispense log
"RTN","PSGOEL",17,0)
 I '(C#5) K DIR S DIR(0)="E" W ! D ^DIR Q:'Y
"RTN","PSGOEL",18,0)
 S Y=1,PSGOD=$$ENDTC^PSGMI(+ND),DRG=$$ENDDN^PSGMI($P(ND,"^",2)),HOW=$P("UNKNOWN^THROUGH THE PICK LIST^AS PRE-EXCHANGE UNITS^AS EXTRA UNITS^AS RETURNS","^",$P(ND,"^",5)+1),WHO=$$ENNPN^PSGMI($P(ND,"^",6))
"RTN","PSGOEL",19,0)
 W !!?3,"Date: ",PSGOD,?33,"Drug: ",DRG,!,"Entered: ",HOW W:$P(ND,"^",5)'=1 ?35,"By: ",WHO W !?2,"Units: ",$P(ND,"^",3)
"RTN","PSGOEL",20,0)
 Q
"RTN","PSGOEL",21,0)
 ;
"RTN","PSGOEL",22,0)
ENH ;
"RTN","PSGOEL",23,0)
 W !!?2,"Select '1' to view a SHORT ACTIVITY LOG for this order.  A short activity log",!,"shows only the main activities associated with the order."
"RTN","PSGOEL",24,0)
 W !?2,"Select '2' to view a LONG ACTIVITY LOG for this order.  A long activity log",!,"shows all activities associated with the order."
"RTN","PSGOEL",25,0)
 W !?2,"Select '3' to view the DISPENSE LOG for this order.  The dispense log shows",!,"the information about the order pertaining to the medication(s) dispensed for",!,"it, such as how many, when, by whom, etc."
"RTN","PSGOEL",26,0)
 W !?2,"Select '4' to view the HISTORY LOG for this order.  The history log shows",!,"every order associated with this order.  Associated orders include orders",!,"created from renewing an order or editing certain fields of an order."
"RTN","PSGOEL",27,0)
 Q
"RTN","PSGOETO")
0^42^B36634660^B35267208
"RTN","PSGOETO",1,0)
PSGOETO ;BIR/CML3-TRANSCRIBE ORDERS ;25 Feb 99 / 1:17 PM
"RTN","PSGOETO",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**3,13,25,31,33,50,68,58,85,105,90,117,110,111,112,161,254,267**;16 DEC 97;Build 158
"RTN","PSGOETO",3,0)
 ;
"RTN","PSGOETO",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSGOETO",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOETO",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGOETO",7,0)
 ; Reference to ^PSUHL is supported by DBIA 4803.
"RTN","PSGOETO",8,0)
 ;
"RTN","PSGOETO",9,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSGOETO",10,0)
 I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",11,0)
 K ND4,DA D ENGNN:'PSGOEAV,ENGNA:PSGOEAV S PSGDT=$$DATE^PSJUTL2() I $S($D(ORACTION):0,$G(PSGOEE)="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:$G(PSGOEE)'="E") D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSGP)
"RTN","PSGOETO",12,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSGOETO",13,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",14,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGOORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSGOETO",15,0)
 ; naked reference below refers to ^PS(55,PSGP,0)
"RTN","PSGOETO",16,0)
 I PSGOEAV S F=^PS(55,PSGP,0) I $P(F,"^",7)="" S $P(F,"^",7)=$P($P(ND,"^",16),"."),$P(F,"^",8)="A",^(0)=F D LOGDFN^PSUHL(PSGP)
"RTN","PSGOETO",17,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSGOETO",18,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSGOETO",19,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSGOETO",20,0)
 .I '$P(ND4,U,9) S ^PS(55,"APV",PSGP,DA)=""
"RTN","PSGOETO",21,0)
 .I '$P(ND4,U,10) S ^PS(55,"NPV",PSGP,DA)=""
"RTN","PSGOETO",22,0)
 .I $P(ND4,U,9) K ^PS(55,"APV",PSGP,DA)
"RTN","PSGOETO",23,0)
 .I $P(ND4,U,10) K ^PS(55,"NPV",PSGP,DA)
"RTN","PSGOETO",24,0)
 S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND
"RTN","PSGOETO",25,0)
 ;naked reference below refers to full reference inside indirection @(F_".2)") for either file 53.1 or 55
"RTN","PSGOETO",26,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2)
"RTN","PSGOETO",27,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD),PSGPDRG=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSGOETO",28,0)
 ;naked reference below refers to full reference inside indirection @(F_"2)") for either file 53.1 or 55
"RTN","PSGOETO",29,0)
 S @(F_"2)")=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",30,0)
 S X=-1 S:'$D(^PS(53.45,+$G(DUZ),5,1,0)) X=$S($G(PSGORD):$$GETSIOPI^PSJBCMA5(DFN,PSGORD),1:"") I X D FILESI^PSJBCMA5(PSGP,DA_$S(F["PS(55":"U",1:"P"))
"RTN","PSGOETO",31,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSGOETO",32,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSGOETO",33,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSGOETO",34,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSGOETO",35,0)
 I $P(ND,U,24)="R" S %X="^PS(55,"_PSGP_",5,"_+PSGORD_",12,",%Y=F_"12," D %XY^%RCR
"RTN","PSGOETO",36,0)
 W "." D CRN:'PSGOEAV,CRA:PSGOEAV
"RTN","PSGOETO",37,0)
 ; don't send message to CPRS if from Order Set and autoverify turned off
"RTN","PSGOETO",38,0)
 S PSGORD=DA_$S(PSGOEAV:"U",1:"P")
"RTN","PSGOETO",39,0)
 I $G(PSGOORD),$D(PSGOEE) N CLINAPPT S CLINAPPT=$S(PSGOORD["U":$G(^PS(55,PSGP,5,+PSGOORD,8)),PSGOORD["P":$G(^PS(53.1,+PSGOORD,"DSS")),1:"") I CLINAPPT D
"RTN","PSGOETO",40,0)
 .N DIE,DA,DR
"RTN","PSGOETO",41,0)
 .I PSGORD["U" S DIE="^PS(55,"_PSGP_",5,",DA=+PSGORD,DA(1)=PSGP,DR="130////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"131////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOETO",42,0)
 .I PSGORD["P" S DIE="^PS(53.1,",DA=+PSGORD,DR="113////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"126////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOETO",43,0)
 .I $G(DR) D ^DIE
"RTN","PSGOETO",44,0)
 D:('$D(PSGOES))!(($D(PSGOES)&(PSGOEAV))) ORSET^PSGOETO1
"RTN","PSGOETO",45,0)
 I $D(PSGOES),'$D(PSGOESON) N PSGOESON S PSGOESON=PSGORD D DISACTIO^PSJOE(DFN,PSGORD,0) D:PSGORD["U"&(PSGOESON=PSGORD)&($P(@(PSGOEEWF_"0)"),"^",9)'="D") EN^PSGPEN(PSGORD) G OUT
"RTN","PSGOETO",46,0)
 D DONE S PSGCANFL="" I '$D(PSGOEE) S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",47,0)
 I $D(PSJSYSO) S PSGPOSA="W",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOETO",48,0)
 S DA=+PSGORD,X=$P(PSGORD,DA,2) I PSJSYSL,$S(PSGOEAV:1,1:PSJSYSL<3),$S("AOU"[X:'$D(^PS(55,PSGP,5,+PSGORD,7)),1:'$D(^PS(53.1,+PSGORD,7))) D
"RTN","PSGOETO",49,0)
 .; naked ref below is from line above, ^PS(53.1,+PSGORD,7)
"RTN","PSGOETO",50,0)
 .S $P(^(7),U,1,2)=PSGDT_"^N"_$G(PSGOEE),PSGUOW=DUZ,PSGTOL=2,PSGTOO=$S("AOU"[X:1,1:2) D ENL^PSGVDS
"RTN","PSGOETO",51,0)
 D STOREINT^PSGSICH1
"RTN","PSGOETO",52,0)
OUT ;
"RTN","PSGOETO",53,0)
 K PSGOETOF
"RTN","PSGOETO",54,0)
DONE ;
"RTN","PSGOETO",55,0)
 I PSGOEAV L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOETO",56,0)
 I 'PSGOEAV L -^PS(53.1,+PSGORD)
"RTN","PSGOETO",57,0)
 K C,D,ND,ND2,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE,ND0
"RTN","PSGOETO",58,0)
 K ^PS(53.45,+$G(DUZ),5)
"RTN","PSGOETO",59,0)
 Q
"RTN","PSGOETO",60,0)
CRA ;
"RTN","PSGOETO",61,0)
 S:PSGPDRG ^PS(55,PSGP,5,"C",PSGPDRG,DA)="" S (^PS(55,"AUE",PSGP,DA),^PS(55,PSGP,5,"AU",PSGST,+PSGNEFD,DA),^PS(55,PSGP,5,"AUS",+PSGNEFD,DA))="",^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)="",^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOETO",62,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+PSGNESD,X(2)=+PSGNEFD,DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOETO",63,0)
 S DA(1)=PSGP K DIK S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOETO",64,0)
 K PSGALO,PSGALR S DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+$S('$D(PSGOEE):22500,PSGOEE="E":22600,1:22700) D ^PSGAL5 Q
"RTN","PSGOETO",65,0)
CRN ;
"RTN","PSGOETO",66,0)
 S (^PS(53.1,"AC",PSGP,DA),^PS(53.1,"AS","N",PSGP,DA),^PS(53.1,"B",DA,DA),^PS(53.1,"C",PSGP,DA))="" S:PSGPDRG (^PS(53.1,"AOD",PSGP,PSGPDRG,DA),^PS(53.1,"D",PSGPDRG,DA))="" Q
"RTN","PSGOETO",67,0)
ENGNA ;
"RTN","PSGOETO",68,0)
 F  L +^PS(55,PSGP,5,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) S:'$D(^PS(55,PSGP,0)) ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="" S ND=$S($D(^PS(55,PSGP,5,0)):^(0),1:"^55.06IA") Q
"RTN","PSGOETO",69,0)
 N PSGLCK S PSGLCK=0
"RTN","PSGOETO",70,0)
 F DA=$P(ND,U,3)+1:1 W "." I '$D(^PS(55,PSGP,5,DA)),'$D(^PS(55,PSGP,5,"B",DA)) D  I PSGLCK S ^PS(55,PSGP,5,DA,0)=DA,^PS(55,PSGP,5,"B",DA,DA)="",$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^PS(55,PSGP,5,0)=ND Q
"RTN","PSGOETO",71,0)
 . L +^PS(55,PSGP,5,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S PSGLCK=1
"RTN","PSGOETO",72,0)
 L -^PS(55,PSGP,5,0) Q
"RTN","PSGOETO",73,0)
ENGNN ;
"RTN","PSGOETO",74,0)
 N ND F  L +^PS(59.7,1,25):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S DA=+$G(^PS(59.7,1,25)) Q
"RTN","PSGOETO",75,0)
 F DA=DA+1:1 I '$D(^PS(53.1,DA)),'$D(^PS(53.1,"B",DA)) L +^PS(53.1,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S ^PS(59.7,1,25)=DA,^PS(53.1,DA,0)=DA,^PS(53.1,"B",DA,DA)="" Q
"RTN","PSGOETO",76,0)
 F  L +^PS(53.1,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S ND=$G(^PS(53.1,0)),$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^(0)=ND Q
"RTN","PSGOETO",77,0)
 L -^PS(59.7,1,25),-^PS(53.1,0)
"RTN","PSGOETO",78,0)
 I $G(PSIVCHG) D
"RTN","PSGOETO",79,0)
 .N PSGORD,ON S ON=DA_"P" D SETIVINT^PSGSICH1
"RTN","PSGOETO",80,0)
 Q
"RTN","PSGOEV")
0^54^B68395983^B64524901
"RTN","PSGOEV",1,0)
PSGOEV ;BIR/CML3-VERIFY (MAKE ACTIVE) ORDERS ; 4/16/10 9:18am
"RTN","PSGOEV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**5,7,15,28,33,50,64,58,77,78,80,110,111,133,171,207,241,267**;16 DEC 97;Build 158
"RTN","PSGOEV",3,0)
 ;
"RTN","PSGOEV",4,0)
 ; Reference to ^ORD(101 supported by DBIA #872.
"RTN","PSGOEV",5,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180.
"RTN","PSGOEV",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGOEV",7,0)
 ; Reference to ^PSSLOCK supported by DBIA #2789.
"RTN","PSGOEV",8,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA #2410.
"RTN","PSGOEV",9,0)
 ;
"RTN","PSGOEV",10,0)
EN(PSGORD) ;
"RTN","PSGOEV",11,0)
ENSF ; This entry point is used by Speed finish only.
"RTN","PSGOEV",12,0)
 ; Send SN update to CPRS if auto-verify off and from Order Set entry
"RTN","PSGOEV",13,0)
 S:'$D(PSGOEAV) PSGOEAV=$P($G(PSJSYSP0),"^",9)&$G(PSJSYSU)
"RTN","PSGOEV",14,0)
 I $D(PSGOES),'PSGOEAV,PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSGOEV",15,0)
 D FULL^VALM1 I 'PSJSYSU W $C(7),$C(7),!!," THIS FUNCTION NOT AVAILABLE TO WARD STAFF." Q
"RTN","PSGOEV",16,0)
 S CHK=0 I PSGORD["P" S X=$P($G(^PS(53.1,+PSGORD,0)),"^",19) I X,$D(^PS(55,PSGP,5,$P(^(0),"^",19))) S CHK=+PSGORD,PSGORD=X_"U" L -^PS(53.1,CHK) L +^PS(55,PSGP,5,+PSGORD):1 E  W !!,"Another terminal is editing this order." G DONE
"RTN","PSGOEV",17,0)
 I +PSJSYSU=3 D DDCHK G:CHK DONE
"RTN","PSGOEV",18,0)
 I PSGORD["P" D CHK($G(^PS(53.1,+PSGORD,0)),$G(^(.2)),$G(^(2)))
"RTN","PSGOEV",19,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOEV",20,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=1 S X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",21,0)
 I $G(CHK) Q:$D(PSJSPEED)  D EN^VALM("PSJU LM ACCEPT") G:'$G(PSJACEPT) DONE ;G VFY
"RTN","PSGOEV",22,0)
 I PSGORD["U" G:'$D(^PS(55,PSGP,5,+PSGORD,4)) VFY I +PSJSYSU=3,$P(^(4),"^",3) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A PHARMACIST." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",23,0)
 I PSGORD["U" I +PSJSYSU=1,+^PS(55,PSGP,5,+PSGORD,4) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A NURSE." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",24,0)
 ;
"RTN","PSGOEV",25,0)
VFY ; change status, move to 55, and change label record
"RTN","PSGOEV",26,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D VFY^PSJCOM Q
"RTN","PSGOEV",27,0)
 NEW PSJDOSE,PSJDSFLG
"RTN","PSGOEV",28,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEV",29,0)
 D FULL^VALM1 ;PSJ*5*241
"RTN","PSGOEV",30,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSGOEV",31,0)
 . S PSGOEEF(109)=1
"RTN","PSGOEV",32,0)
 . S PSJACEPT=0
"RTN","PSGOEV",33,0)
 . ;D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEV",34,0)
 D DDCHK G:CHK DONE
"RTN","PSGOEV",35,0)
 I $G(PSGSCH)]"",((",P,R,")'[(","_PSGST_",")) D  I CHK G DONE
"RTN","PSGOEV",36,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOEV",37,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!,"This is a 'DAY OF WEEK' schedule and MUST have admin times.",! D PAUSE^VALM1
"RTN","PSGOEV",38,0)
 I $G(PSGSCH)]"" D  I CHK G DONE
"RTN","PSGOEV",39,0)
 .N X,Y,PSGS0XT,PSGS0Y,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",40,0)
 W !,"...a few moments, please..."
"RTN","PSGOEV",41,0)
 I PSGORD["P" D
"RTN","PSGOEV",42,0)
 . N PND0,PSGORDR,PSJPRIO,PSJSCHED S PND0=^PS(53.1,+PSGORD,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D  Q
"RTN","PSGOEV",43,0)
 .. N OEORD,OOEORD,FILE55,FILE55N0 S FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSGOEV",44,0)
 .. S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,PSGORD,+$$LASTREN^PSJLMPRI(DFN,PSGORD))
"RTN","PSGOEV",45,0)
 .. S PSGORDP=PSGORD,DIE="^PS(53.1,",DA=+PSGORD,DR="28////A;104////@" W "." D ^DIE
"RTN","PSGOEV",46,0)
 .. D START^PSGOTR(PSGORD,+PSGORDR) I OEORD D
"RTN","PSGOEV",47,0)
 ... K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSGOEV",48,0)
 ... D EN1^PSJHL2(DFN,"SC",PSGORDR),EN^PSGPEN(PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSGOEV",49,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in 55
"RTN","PSGOEV",50,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEV",51,0)
 . S DIE="^PS(53.1,",DA=+PSGORD,DR="28////A" W "." D ^DIE,^PSGOT
"RTN","PSGOEV",52,0)
 . S PSJPRIO=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,.2)),"^",4),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,.2)),"^",4),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,.2)),"^",4))
"RTN","PSGOEV",53,0)
 . S PSJSCHED=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,2)),"^"),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,2)),"^"),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,0)),"^",15))
"RTN","PSGOEV",54,0)
 . I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCHED)="NOW")!($G(PSJSCHED)["STAT") D NOTIFY^PSJHL4(PSGORD,DFN,$G(PSJPRIO),$G(PSJSCHED))
"RTN","PSGOEV",55,0)
 . I $G(PSGRDTX)="" S PSGRDTX=$G(^PS(53.1,+PSGORDP,2.5))
"RTN","PSGOEV",56,0)
 S DA=+PSGORD,DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+22000 D ^PSGAL5 W "." S VND4=$G(^PS(55,PSGP,5,DA,4))
"RTN","PSGOEV",57,0)
 I $G(PSGRDTX) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Start Date",+$G(PSGRDTX))
"RTN","PSGOEV",58,0)
 I $P($G(PSGRDTX),U,3) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Stop Date",+$P($G(PSGRDTX),U,3))
"RTN","PSGOEV",59,0)
 N DUR,DURON S DURON=$S($G(PSGORD):$G(PSGORD),1:"") I DURON D
"RTN","PSGOEV",60,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",1:5),1),1:"")
"RTN","PSGOEV",61,0)
 I $G(DUR)]"" S $P(^PS(55,PSGP,5,+PSGORD,2.5),"^",2)=DUR
"RTN","PSGOEV",62,0)
 D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSGOEV",63,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSGOEV",64,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSGOEV",65,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",9):1,1:$P(VND4,"^",15)) D EN^PSGPEN(+PSGORD)
"RTN","PSGOEV",66,0)
 S $P(VND4,"^",+PSJSYSU=1+9)=1 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSGOEV",67,0)
 I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEV",68,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSGOEV",69,0)
 I '$P(VND4,U,9) S ^PS(55,"APV",PSGP,+PSGORD)=""
"RTN","PSGOEV",70,0)
 I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSGOEV",71,0)
 I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSGOEV",72,0)
 I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSGOEV",73,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSGOEV",74,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOEV",75,0)
 S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)="" S PSGACT="C"_$S('$D(^PS(55,PSGP,5,+PSGORD,4)):"E",$P(^(4),"^",16):"",1:"E")_"RS",PSGCANFL=2
"RTN","PSGOEV",76,0)
 S VALMBCK="Q" D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSGOEV",77,0)
 D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U")
"RTN","PSGOEV",78,0)
DONE ;
"RTN","PSGOEV",79,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSGOEV",80,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSGOEV",81,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSGOEV",82,0)
 .Q:Y="N"
"RTN","PSGOEV",83,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSGOEV",84,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X Q
"RTN","PSGOEV",85,0)
 ;
"RTN","PSGOEV",86,0)
LBL ;
"RTN","PSGOEV",87,0)
 Q
"RTN","PSGOEV",88,0)
 ;
"RTN","PSGOEV",89,0)
CHK(ND,DRG,ND2) ; checks for data in required fields
"RTN","PSGOEV",90,0)
 ; Input: ND  - ^(PS(53.1,PSGORD,0)
"RTN","PSGOEV",91,0)
 ;        DRG - ^(.2)
"RTN","PSGOEV",92,0)
 ;        ND2 - ^(2)
"RTN","PSGOEV",93,0)
 S Y=$G(Y)
"RTN","PSGOEV",94,0)
 S CHK="" I DRG,$D(^PS(50.7,+DRG,0))
"RTN","PSGOEV",95,0)
 E  S CHK=1
"RTN","PSGOEV",96,0)
 I ND="" S CHK=CHK_23
"RTN","PSGOEV",97,0)
 E  S CHK=CHK_$S($P(ND,"^",3):"",1:2)_$S($P(ND,"^",7)]"":"",1:3)
"RTN","PSGOEV",98,0)
 ;The naked reference on the line below refers to the variable ND which is ^PS(53.1,PSGORD,0).
"RTN","PSGOEV",99,0)
 I ND2="" S CHK=CHK_$S('$D(^(0)):4,$P(^(0),"^",7)="OC":"",1:4)_56
"RTN","PSGOEV",100,0)
 E  S CHK=CHK_$S($P(ND2,"^")]"":"",ND="":4,$P(ND,"^",7)="OC":"",1:4)_$S($P(ND2,"^",2):"",1:5)_$S($P(ND2,"^",4):"",1:6)
"RTN","PSGOEV",101,0)
 I $$CHECK^PSGOE8(PSJSYSP),$P(DRG,U,2)="" S CHK=CHK_8
"RTN","PSGOEV",102,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSGOEV",103,0)
 S:'$$DDOK^PSGOE2("^PS(53.45,"_PSJSYSP_",2,",+DRG) CHK=CHK_7,(PSGDFLG,PSGDI)=1
"RTN","PSGOEV",104,0)
 S:'$$OIOK^PSGOE2(+DRG) PSGPFLG=1
"RTN","PSGOEV",105,0)
 I 'CHK,$G(PSGSCH)]"" D
"RTN","PSGOEV",106,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",107,0)
 Q:'CHK
"RTN","PSGOEV",108,0)
 W $C(7)
"RTN","PSGOEV",109,0)
 ;
"RTN","PSGOEV",110,0)
CHKM ;
"RTN","PSGOEV",111,0)
 D FULL^VALM1 K:CHK Y
"RTN","PSGOEV",112,0)
 ; changed to remove ^DD ref
"RTN","PSGOEV",113,0)
 ; PSJ*5*267 VMP Add the 8th condition
"RTN","PSGOEV",114,0)
 W !!,"THE FOLLOWING ",$S($L(CHK)>1:"ARE",1:"IS")," EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:8 W:CHK[X !?5,$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG^DOSAGE ORDERED","^",X)
"RTN","PSGOEV",115,0)
 I CHK=7 W !,"Orders with no dispense drugs or multiple dispense drugs",!,"require dosage ordered"
"RTN","PSGOEV",116,0)
 W:CHK]"" !!,$S($L(CHK)>1:"THESE FIELDS ARE",1:"THIS FIELD IS")," NECESSARY FOR VERIFICATION."
"RTN","PSGOEV",117,0)
 N DIR S DIR(0)="E" D ^DIR I $D(DUOUT)!$D(DTOUT) S CHK=1 Q
"RTN","PSGOEV",118,0)
 Q
"RTN","PSGOEV",119,0)
 ;
"RTN","PSGOEV",120,0)
CONT() ;
"RTN","PSGOEV",121,0)
 NEW DIR,DIRUT,Y
"RTN","PSGOEV",122,0)
 W ! K DIR,DIRUT
"RTN","PSGOEV",123,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="No"
"RTN","PSGOEV",124,0)
 D ^DIR
"RTN","PSGOEV",125,0)
 Q Y
"RTN","PSGOEV",126,0)
 ;
"RTN","PSGOEV",127,0)
DDCHK ; dispense drug check
"RTN","PSGOEV",128,0)
 S DRGF="^PS("_$S(PSGORD["P":"53.1,"_+PSGORD,1:"55,"_PSGP_",5,"_+PSGORD)_",",CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSGOEV",129,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSGOEV",130,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSGOEV",131,0)
 Q:CHK=0
"RTN","PSGOEV",132,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSGOEV",133,0)
 ;
"RTN","PSGOEV",134,0)
DDEDIT ;
"RTN","PSGOEV",135,0)
 ;*** Remove all dispense drug for this order
"RTN","PSGOEV",136,0)
 K @(DRGF_"1)")
"RTN","PSGOEV",137,0)
 ; The naked reference below refers to the indirect full reference in DRGF_"1,"_Q_")", which is either ^PS(53.1,+PSGORD,Q) or ^PS(55,DFN,5,+PSGORD,Q)
"RTN","PSGOEV",138,0)
 K ^PS(53.45,PSJSYSP,2) S (X,Q)=0 F  S Q=$O(@(DRGF_"1,"_Q_")")) Q:'Q  S Y=$G(^(Q,0)),X=Q S ^PS(53.45,PSJSYSP,2,Q,0)=Y I Y S ^PS(53.45,PSJSYSP,2,"B",+Y,Q)=""
"RTN","PSGOEV",139,0)
 I X S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_X_"^"_X
"RTN","PSGOEV",140,0)
 D ENDRG^PSGOEF1(PSGPD,X)
"RTN","PSGOEV",141,0)
 I 'CHK S %X="^PS(53.45,"_PSJSYSP_",2,",%Y=DRGF_"1," D %XY^%RCR S $P(@(DRGF_"1,0)"),"^",2)=$S(DRGF[53.1:"53.11P",1:"55.07P")
"RTN","PSGOEV",142,0)
 K DRG,DRGF Q
"RTN","PSGOEV",143,0)
 ;
"RTN","PSGOEV",144,0)
AESCREEN() ;
"RTN","PSGOEV",145,0)
 ; Output: 0 - Required fields missing and DON'T allow accept
"RTN","PSGOEV",146,0)
 ;         1 - Required fields found.
"RTN","PSGOEV",147,0)
 Q:'$G(CHK) 1
"RTN","PSGOEV",148,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSGOEV",149,0)
 I Y="PSJU LM ACCEPT EDIT" Q 1
"RTN","PSGOEV",150,0)
 Q 0
"RTN","PSGOEV",151,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSGOEV",152,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSGOEV",153,0)
 ;PSGORD : IEN from 55
"RTN","PSGOEV",154,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSGOEV",155,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSGOEV",156,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSGOEV",157,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55.09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSGOEV",158,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSGOEV",159,0)
 . N TXTLN S TXTLN="" F  S TXTLN=$O(^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN)) Q:TXTLN=""  D
"RTN","PSGOEV",160,0)
 .. I TXTLN=0 S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,1,TXTLN)=^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN) Q
"RTN","PSGOEV",161,0)
 .. S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,1,TXTLN,0)=^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN,0)
"RTN","PSGOEV",162,0)
 Q
"RTN","PSGOT")
0^41^B22872398^B15567753
"RTN","PSGOT",1,0)
PSGOT ;BIR/CML3-TRANSFERS DATA FROM 53.1 TO 55 ;24 SEP 97 / 7:54 AM
"RTN","PSGOT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**13,68,90,110,173,134,161,254,267**;16 DEC 97;Build 158
"RTN","PSGOT",3,0)
 ;
"RTN","PSGOT",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOT",5,0)
 ; Reference to ^PSUHL supported by DBIA 4803.
"RTN","PSGOT",6,0)
 ;
"RTN","PSGOT",7,0)
START ; get internal record number, lock record, and write
"RTN","PSGOT",8,0)
 S ODA=+PSGORD S:$D(^PS(55,PSGP,0))[0 ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="",$P(^PS(55,0),U,3,4)=PSGP_U_($P($G(^PS(55,0)),U,4)+1) F  L +^PS(55,PSGP,5,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSGOT",9,0)
 S ZND=$G(^PS(55,PSGP,5,0)) S:ZND="" ZND="^55.06IA" F DA=$P(ZND,"^",3)+1:1 I '$D(^PS(55,PSGP,5,DA)),'$D(^("B",DA)) L +^PS(55,PSGP,5,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S $P(ZND,"^",3)=DA,$P(ZND,"^",4)=$P(ZND,"^",4)+1,^PS(55,PSGP,5,0)=ZND Q
"RTN","PSGOT",10,0)
 L -^PS(55,PSGP,5,0) S ND0=^PS(53.1,ODA,0),$P(ND0,"^",23)=PSJPWD,^PS(55,PSGP,5,DA,0)=ND0
"RTN","PSGOT",11,0)
 S (ND1,^PS(55,PSGP,5,DA,.2))=$G(^PS(53.1,ODA,.2)),^PS(55,PSGP,5,DA,.3)=$G(^PS(53.1,ODA,.3)),(ND2,^PS(55,PSGP,5,DA,2))=^PS(53.1,ODA,2),^PS(55,PSGP,5,DA,4)=$G(^PS(53.1,ODA,4)),^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOT",12,0)
 S X=^PS(55,PSGP,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(ND0,"^",16),"."),$P(X,"^",8)="A",^(0)=X D LOGDFN^PSUHL(PSGP)
"RTN","PSGOT",13,0)
 I $P($G(^PS(55,PSGP,5,DA,2)),"^",6)="" S $P(^PS(55,PSGP,5,DA,2),"^",6)=$S($G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),$P(^PS(53.1,ODA,2),"^",6)=$P(^PS(55,PSGP,5,DA,2),"^",6)
"RTN","PSGOT",14,0)
 F X=6,7,13 I $D(^PS(53.1,ODA,X)) S ^PS(55,PSGP,5,DA,X)=^(X)
"RTN","PSGOT",15,0)
 I $D(^PS(53.1,ODA,"DSS")) S ^PS(55,PSGP,5,DA,8)=^("DSS")
"RTN","PSGOT",16,0)
 I $O(^PS(53.1,ODA,1,0)) S (C,X)=0 F  S X=$O(^PS(53.1,ODA,1,X)) Q:'X  S:$D(^(X,0)) C=C+1,^PS(55,PSGP,5,DA,1,C,0)=^(0),^PS(55,PSGP,5,DA,1,"B",+$P($G(^(0)),U),C)=""
"RTN","PSGOT",17,0)
 I $O(^PS(53.1,ODA,1,0)) S ^PS(55,PSGP,5,DA,1,0)="^55.07P^"_C_"^"_C
"RTN","PSGOT",18,0)
 F X=3,12 D  S ^PS(55,PSGP,5,DA,X,0)="^55.0"_$S(X=3:8,1:612)_U_CNT_U_CNT
"RTN","PSGOT",19,0)
 .S CNT=0 F C=0:0 S C=$O(^PS(53.1,ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0),CNT=CNT+1
"RTN","PSGOT",20,0)
 S $P(^PS(53.1,ODA,0),"^",19)=DA
"RTN","PSGOT",21,0)
 D SETUDINT^PSGSICH1(ODA_"P",DA_"U")
"RTN","PSGOT",22,0)
CR ; set x-refs
"RTN","PSGOT",23,0)
 N A
"RTN","PSGOT",24,0)
 I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",6) S X=$P(^(5.1),"^",6) I $P(ND2,"^",3),$P(ND2,"^",6)'>X S $P(^(5.1),"^",6)=$P(ND2,"^",3)
"RTN","PSGOT",25,0)
 S ^PS(55,PSGP,5,"B",+ODA,DA)="",^PS(55,PSGP,5,"AU",$P(ND0,"^",7),+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",26,0)
 S ^PS(55,PSGP,5,"AUS",+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",27,0)
 S ^PS(55,PSGP,5,"C",+ND1,DA)="",^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOT",28,0)
 S ^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOT",29,0)
 I $D(^PS(55,PSGP,5,DA,8)) S A=^(8),^PS(55,"AUDC",+$P(ND2,"^",4),+A,PSGP,DA)=""
"RTN","PSGOT",30,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+$P(ND2,"^",2),X(2)=+$P(ND2,"^",4),DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOT",31,0)
 K DIK S DA(1)=PSGP S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOT",32,0)
 S PSGTOL=2,PSGTOO=1 F PSGUOW=0:0 S PSGUOW=$O(^PS(53.41,2,1,PSGUOW)) Q:'PSGUOW  I $D(^(PSGUOW,1,PSGP,1,2,1,+ODA)) K ^(+ODA) D ENL^PSGVDS
"RTN","PSGOT",33,0)
DONE I $D(PSGOE2),PSGOE2]"",$D(^TMP("PSJON",$J,PSGOE2)) S ^(PSGOE2)=DA_"U"
"RTN","PSGOT",34,0)
 N PSJTMPTX,PSJOVRMX,PSJTMPLIN
"RTN","PSGOT",35,0)
 S PSGODA=ODA,PSGORD=DA_"U"
"RTN","PSGOT",36,0)
 S PSGNODE=$G(^PS(55,PSGP,5,DA,0)),PSG25=$P(PSGNODE,"^",25),PSG26=$P(PSGNODE,"^",26)
"RTN","PSGOT",37,0)
 I PSG25 S X=$S(PSG25["V":"^PS(55,"_PSGP_",""IV"",",PSG25["U"!(PSG25["A"):"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSG25_","_$E("02",PSG25["V"+1)_")" I $D(@X) S $P(@X,"^",$S(PSG25["V":6,1:26))=DA_"U"
"RTN","PSGOT",38,0)
 I $P(PSGNODE,"^",26),$P(PSGNODE,"^",26)'["V",$D(^PS(55,PSGP,5,+$P(PSGNODE,"^",26),0)) S $P(^(0),"^",25)=DA_"U"
"RTN","PSGOT",39,0)
 F Q=0:0 S Q=$O(^PS(53.44,Q)) Q:'Q  I $D(^(Q,1,PSGP,+ODA,0)) S $P(^(0),"^",2)=DA
"RTN","PSGOT",40,0)
 I $D(^PS(53.1,+ODA,15,0)) S ^PS(55,PSGP,5,DA,15,0)="^55.6135^"_$P($G(^PS(53.1,+ODA,15,0)),"^",3)_"^"_$P($G(^PS(53.1,+ODA,15,0)),"^",4) D
"RTN","PSGOT",41,0)
 .N LN,LNCNT,SIMSG S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSGOT",42,0)
 .S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.1,+ODA,15,LN),-1) Q:'LN  D
"RTN","PSGOT",43,0)
 ..I 'LNCNT,($G(^PS(53.1,+ODA,15,LN,0))="") Q
"RTN","PSGOT",44,0)
 ..S ^PS(55,PSGP,5,DA,15,LN,0)=^PS(53.1,+ODA,15,LN,0) S LNCNT=LNCNT+1
"RTN","PSGOT",45,0)
 .I LNCNT S $P(^PS(55,PSGP,5,DA,15,0),"^",3,4)=LNCNT_"^"_LNCNT
"RTN","PSGOT",46,0)
 .S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(55,+DFN,5,DA,15,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSGOT",47,0)
 ..S:($L(PSJTMPTX)+$L($G(^PS(55,+DFN,5,DA,15,TMPLIN,0))))>180 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(55,+DFN,5,DA,15,TMPLIN,0))
"RTN","PSGOT",48,0)
 .S TXT=$S(PSJOVRMX:SIMSG,1:PSJTMPTX)
"RTN","PSGOT",49,0)
 .S:($TR(TXT,"^ ")="")!'($D(^PS(55,PSGP,5,DA,15,1))) TXT="" S ^PS(55,PSGP,5,DA,6)=TXT S $P(^PS(55,PSGP,5,DA,6),"^",2)=$P(^PS(53.1,+ODA,6),"^",2)
"RTN","PSGOT",50,0)
 .N LSTLNUM,LSTLNTXT S LSTLNUM=$O(^PS(55,+PSGP,5,+DA,15,""),-1) I LSTLNUM>1 S LSTLNTXT=$G(^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)) I $TR(LSTLNTXT," ")="" D
"RTN","PSGOT",51,0)
 ..K ^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)
"RTN","PSGOT",52,0)
 L -^PS(53.1,+ODA) L -^PS(55,PSGP,5,+DA) K CNT,ND,ODA,XX,ZND Q
"RTN","PSGOTR")
0^75^B19415814^B10174903
"RTN","PSGOTR",1,0)
PSGOTR ;BIR/CML3-TRANSFERS RENEW DATA FROM 53.1 TO 55 ;23 SEP 03 / 7:54 AM
"RTN","PSGOTR",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,127,133,129,267**;16 DEC 97;Build 158
"RTN","PSGOTR",3,0)
 ;
"RTN","PSGOTR",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOTR",5,0)
 ;
"RTN","PSGOTR",6,0)
START(ODA,DA) ; lock record, and write
"RTN","PSGOTR",7,0)
 N OFD,PVND4 S OFD=""
"RTN","PSGOTR",8,0)
 S OFD=$P($G(^PS(55,PSGP,5,DA,2)),"^",4) K:OFD ^PS(55,"AUD",+OFD,PSGP,+DA)
"RTN","PSGOTR",9,0)
 S ND2=^PS(53.1,+ODA,2) S ^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOTR",10,0)
 F X=6,7 I $D(^PS(53.1,+ODA,X)) S ^PS(55,PSGP,5,DA,X)=^(X)
"RTN","PSGOTR",11,0)
 I $O(^PS(53.1,+ODA,1,0)) D
"RTN","PSGOTR",12,0)
 .K ^PS(55,PSGP,5,DA,1)
"RTN","PSGOTR",13,0)
 .S (C,X)=0 F  S X=$O(^PS(53.1,+ODA,1,X)) Q:'X  S:$D(^(X,0)) C=C+1,^PS(55,PSGP,5,DA,1,C,0)=^(0),^PS(55,PSGP,5,DA,1,"B",+$P($G(^(0)),U),C)=""
"RTN","PSGOTR",14,0)
 .S ^PS(55,PSGP,5,DA,1,0)="^55.07P^"_C_"^"_C
"RTN","PSGOTR",15,0)
 F X=3,12 D  S ^PS(55,PSGP,5,DA,X,0)="^55.0"_$S(X=3:8,1:612)_U_CNT_U_CNT
"RTN","PSGOTR",16,0)
 .S CNT=0 F C=0:0 S C=$O(^PS(53.1,+ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0),CNT=CNT+1
"RTN","PSGOTR",17,0)
 S $P(^PS(53.1,+ODA,0),"^",19)=DA
"RTN","PSGOTR",18,0)
 S $P(^PS(55,PSGP,5,DA,0),"^",7)=$P(^PS(53.1,+ODA,0),"^",7)
"RTN","PSGOTR",19,0)
 N PSGPND0,PSGPND2,RDUZ,OND14 S PSGPND0=^PS(53.1,+ODA,0),PSGPND2=^(2) S RNWDT=$P(PSGPND0,"^",16),PSGOEPR=$P(PSGPND0,"^",2)
"RTN","PSGOTR",20,0)
 S PSGFD=$P(PSGPND2,"^",4),PSJNOO=$P(^PS(53.1,+ODA,.2),"^",3) S OND14=$$LASTREN^PSJLMPRI(PSGP,+ODA_"P") S RDUZ=$P(OND14,"^",2) S:$P(OND14,"^",3) PSGOEPR=$P(OND14,"^",3)
"RTN","PSGOTR",21,0)
 I '$G(DUOUT) D
"RTN","PSGOTR",22,0)
 .I $G(PSJORD)["P" N PSGFDO S PSGFDO=$$LASTREN^PSJLMPRI(PSGP,PSJORD),PSGFDO=$P(PSGFDO,"^",4)
"RTN","PSGOTR",23,0)
 .D UPDREN^PSGOER(DA_"U",RNWDT,PSGOEPR,$S($G(PSGFDO):PSGFDO,1:PSGFD),PSJNOO,RDUZ)
"RTN","PSGOTR",24,0)
 S PVND4=$G(^PS(53.1,+ODA,4)) I $P(PVND4,"^"),$P(PVND4,"^",2) D
"RTN","PSGOTR",25,0)
 .N RNDT S RNDT=$$LASTREN^PSJLMPRI(DFN,+ODA_"P") Q:RNDT>$P(PVND4,"^",2)
"RTN","PSGOTR",26,0)
 .S $P(^PS(55,DFN,5,DA,4),"^")=$P(PVND4,"^"),$P(^PS(55,DFN,5,DA,4),"^",2)=$P(PVND4,"^",2)
"RTN","PSGOTR",27,0)
CR ; set x-refs
"RTN","PSGOTR",28,0)
 I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",6) S X=$P(^(5.1),"^",6) I $P(ND2,"^",3),$P(ND2,"^",6)'>X S $P(^(5.1),"^",6)=$P(ND2,"^",3)
"RTN","PSGOTR",29,0)
 S ^PS(55,PSGP,5,"B",+ODA,DA)="",^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOTR",30,0)
 F S="C","O","P","R","OC" K ^PS(55,PSGP,5,"AU",S,+$P(PSGPND2,"^",4),DA)
"RTN","PSGOTR",31,0)
 S ^PS(55,PSGP,5,"AU",$P(PSGPND0,"^",7),+$P(PSGPND2,"^",4),DA)=""
"RTN","PSGOTR",32,0)
 S ^PS(55,PSGP,5,"AUS",+$P(ND2,"^",4),DA)="" I OFD,OFD'=$P(ND2,"^",4) K ^PS(55,PSGP,5,"AUS",+OFD,DA)
"RTN","PSGOTR",33,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+$P(ND2,"^",2),X(2)=+$P(ND2,"^",4),DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOTR",34,0)
 K DIK S DA(1)=PSGP S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOTR",35,0)
 S PSGTOL=2,PSGTOO=1 F PSGUOW=0:0 S PSGUOW=$O(^PS(53.41,2,1,PSGUOW)) Q:'PSGUOW  I $D(^(PSGUOW,1,PSGP,1,2,1,+ODA)) K ^(+ODA) D ENL^PSGVDS
"RTN","PSGOTR",36,0)
DONE I $D(PSGOE2),PSGOE2]"",$D(^TMP("PSJON",$J,PSGOE2)) S ^(PSGOE2)=DA_"U"
"RTN","PSGOTR",37,0)
 S PSGODA=ODA,PSGORD=DA_"U"
"RTN","PSGOTR",38,0)
 F Q=0:0 S Q=$O(^PS(53.44,Q)) Q:'Q  I $D(^(Q,1,PSGP,+ODA,0)) S $P(^(0),"^",2)=DA
"RTN","PSGOTR",39,0)
 I $D(^PS(53.1,+ODA,15,0)) N SIARRAY D
"RTN","PSGOTR",40,0)
 .M SIARRAY=^PS(55,PSGP,5,+DA,15) I $$DIFFSI^PSJBCMA5(PSGP,+DA_"U") D NEWUDAL^PSGAL5(PSGP,+DA_"U",6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSGOTR",41,0)
 .K ^PS(55,PSGP,5,DA,15) S ^PS(55,PSGP,5,DA,6)=$G(^PS(53.1,+ODA,6)) S ^PS(55,PSGP,5,DA,15,0)="^55.6135^"_$P($G(^PS(53.1,+ODA,15,0)),"^",3)_"^"_$P($G(^PS(53.1,+ODA,15,0)),"^",4)
"RTN","PSGOTR",42,0)
 .N LN,LNCNT S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.1,+ODA,15,LN),-1) Q:'LN  D
"RTN","PSGOTR",43,0)
 ..I 'LNCNT,($G(^PS(53.1,+ODA,15,LN,0))="") Q
"RTN","PSGOTR",44,0)
 ..S ^PS(55,PSGP,5,DA,15,LN,0)=^PS(53.1,+ODA,15,LN,0) S LNCNT=LNCNT+1
"RTN","PSGOTR",45,0)
 .I LNCNT S $P(^PS(55,PSGP,5,DA,15,0),"^",3,4)=LNCNT_"^"_LNCNT
"RTN","PSGOTR",46,0)
 .N TXT,LNCNT,SIMSG S LNCNT=$O(^PS(53.1,+ODA,15,""),-1) S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSGOTR",47,0)
 .S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(55,+DFN,5,DA,15,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSGOTR",48,0)
 ..S:($L(PSJTMPTX)+$L($G(^PS(55,+DFN,5,DA,15,TMPLIN,0))))>180 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(55,+DFN,5,DA,15,TMPLIN,0))
"RTN","PSGOTR",49,0)
 .S TXT=$S(PSJOVRMX:SIMSG,1:PSJTMPTX)
"RTN","PSGOTR",50,0)
 .S:($TR(TXT,"^ ")="")!'($D(^PS(55,PSGP,5,DA,15,1))) TXT="" S ^PS(55,PSGP,5,DA,6)=TXT S $P(^PS(55,PSGP,5,DA,6),"^",2)=$P(^PS(53.1,+ODA,6),"^",2)
"RTN","PSGOTR",51,0)
 .N LSTLNUM,LSTLNTXT S LSTLNUM=$O(^PS(55,+PSGP,5,+DA,15,""),-1) I LSTLNUM>1 S LSTLNTXT=$G(^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)) I $TR(LSTLNTXT," ")="" D
"RTN","PSGOTR",52,0)
 ..K ^PS(55,+PSGP,5,+DA,15,LSTLNUM,0)
"RTN","PSGOTR",53,0)
 L -^PS(53.1,+ODA) L -^PS(55,PSGP,5,+DA) K CNT,ND,ODA,XX,ZND Q
"RTN","PSGP")
0^26^B12038299^B11885377
"RTN","PSGP",1,0)
PSGP ;BIR/CML3-PATIENT LOOK-UP ;15 Apr 98 / 9:05 AM
"RTN","PSGP",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**10,53,111,181,267**;16 DEC 97;Build 158
"RTN","PSGP",3,0)
 ;
"RTN","PSGP",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGP",5,0)
 ; Reference to ^SDAMA203 is supported by DBIA 4133.
"RTN","PSGP",6,0)
 ;
"RTN","PSGP",7,0)
ENDPT ; get any patient
"RTN","PSGP",8,0)
 N HIT
"RTN","PSGP",9,0)
 K DIC,PSGP,Y W !!,"Select "_$S($D(PSGDICA):PSGDICA_" ",1:"")_"PATIENT: " R X:DTIME S:X["^" PSJSTOP=1 I "^"[X S (Y,PSGP)=-1 G DONE
"RTN","PSGP",10,0)
 D EN^PSJDPT
"RTN","PSGP",11,0)
 I Y'>0 G ENDPT
"RTN","PSGP",12,0)
 K DIC
"RTN","PSGP",13,0)
 ;
"RTN","PSGP",14,0)
CHK ;
"RTN","PSGP",15,0)
 ;Clean up arrays use in order checks
"RTN","PSGP",16,0)
 K PSJEXCPT,PSJOCER
"RTN","PSGP",17,0)
 S (DFN,PSGP)=+Y,VA200=1 D INP^VADPT
"RTN","PSGP",18,0)
 I VAIN(4) S PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$P($G(^PS(55,PSGP,5.1)),"^",4),PSJPDD="" G CNV
"RTN","PSGP",19,0)
 S PSJPCAF="",VAIP("D")="L" D IN5^VADPT I 'VAIP(13,1) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." D COP I 'HIT G ENDPT
"RTN","PSGP",20,0)
 S PSJPAD=VAIP(13,1),PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38),PSGOD=$$ENDTC^PSGMI(PSGID) W $C(7),!!?3,"PATIENT IS FOUND TO BE D",$P("ISCHARG^ECEAS","^",X+1),"ED AS OF ",PSGOD,"." D COP I 'HIT G:'$D(PSGRETF) ENDPT
"RTN","PSGP",21,0)
 S PSJPAD=VAIP(13,1),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD="",PSJPDD=PSGID_"^"_PSGOD S:X PSJPDD=PSJPDD_"^1"
"RTN","PSGP",22,0)
 ;
"RTN","PSGP",23,0)
CNV ;
"RTN","PSGP",24,0)
 I $G(DFN) I '$$AA^PSJDPT(DFN) S Y=-1 G ENDPT
"RTN","PSGP",25,0)
 D DEM^VADPT,PID^VADPT,HTWT^PSJAC(DFN)
"RTN","PSGP",26,0)
 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSGP",27,0)
 F X="PSJPAD","PSJPDOB","PSJPTD" I +@X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSGP",28,0)
 ;
"RTN","PSGP",29,0)
WP ; ward parameters
"RTN","PSGP",30,0)
 S PSJSYSW0="",PSJSYSW=0 I PSJPWD S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSGP",31,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16))
"RTN","PSGP",32,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSGP",33,0)
 I PSJSYSL D
"RTN","PSGP",34,0)
 .S:X X='$P(PSJSYSP0,"^",10) S IOP=$S($P(PSJSYSP0,"^",13)]"":$P(PSJSYSP0,"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSGP",35,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D ^%ZISC
"RTN","PSGP",36,0)
 ;
"RTN","PSGP",37,0)
DONE ;
"RTN","PSGP",38,0)
 K DA,DIC,NB,ND,NS,PSGID,PSGOD,VA200,VADM,VAIN,VAIP,VAMT,X,Y(0),Y(0,0) Q
"RTN","PSGP",39,0)
 ;
"RTN","PSGP",40,0)
COP ;check for appointments in clinics that allowed inpatient orders
"RTN","PSGP",41,0)
 S HIT=0 Q:'$$PATCH^XPDUTL("SD*5.3*285")
"RTN","PSGP",42,0)
 N SQ,A,VAIP,X,PSJF
"RTN","PSGP",43,0)
 D IN5^VADPT
"RTN","PSGP",44,0)
 D NOW^%DTC S (PSJF,VASD("F"))=$P(%,".")-1
"RTN","PSGP",45,0)
 D SDA^VADPT
"RTN","PSGP",46,0)
 S SQ=0 F  S SQ=$O(^UTILITY("VASD",$J,SQ)) Q:'SQ  S A=^(SQ,"I") I $$SDIMO^SDAMA203($P(A,"^",2),DFN)>0 S HIT=1 Q
"RTN","PSGP",47,0)
 I $O(^PS(55,DFN,5,"AUN",PSJF))!($O(^PS(55,DFN,"IV","AIN",PSJF))) S HIT=1
"RTN","PSGP",48,0)
 Q 
"RTN","PSGVW")
0^67^B31699559^B29380284
"RTN","PSGVW",1,0)
PSGVW ;BIR/CML3-EXPANDED VIEW OF AN ORDER ;17 SEP 97 /  1:41 PM
"RTN","PSGVW",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,58,85,80,104,110,267**;16 DEC 97;Build 158
"RTN","PSGVW",3,0)
 ;
"RTN","PSGVW",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSGVW",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSGVW",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGVW",7,0)
 ; Reference to ES^ORX8 is supported by DBIA# 3632.
"RTN","PSGVW",8,0)
 ;
"RTN","PSGVW",9,0)
EN1 ;
"RTN","PSGVW",10,0)
 S PSGORD=^TMP("PSJON",$J,PSGOE2)
"RTN","PSGVW",11,0)
 ;
"RTN","PSGVW",12,0)
EN2 ;
"RTN","PSGVW",13,0)
 I PSGORD=+PSGORD N PSGO,PSGO1 S PSGO=PSGORD,PSGO1=0 F  S PSGO1=$O(^PS(53.1,"ACX",PSGO,PSGO1)) Q:'PSGO1  Q:$G(PSGOEA)["^"  S PSGORD=PSGO1_"P" D  S PSGORD=""
"RTN","PSGVW",14,0)
 . D EN21 K CONT D  Q:$G(PSGOEA)["^"
"RTN","PSGVW",15,0)
 .. W !!,"Press RETURN to continue or '^' to exit: " R CONT:DTIME W @IOF S:CONT["^" PSGOEA="^",PSGPR=1,PSJPR=1
"RTN","PSGVW",16,0)
 I PSGORD="" S PSGOEA="^" Q
"RTN","PSGVW",17,0)
EN21 ;
"RTN","PSGVW",18,0)
 K ^PS(53.45,PSJSYSP,2),^TMP("PSJBCMA5",$J)
"RTN","PSGVW",19,0)
 N ESIG,PSJ21
"RTN","PSGVW",20,0)
 S NF=$S(PSGORD["P":1,PSGORD["N":1,1:0)
"RTN","PSGVW",21,0)
 S (FL,Y)="",$P(FL,"-",71)="",F="^PS("_$S(NF:"53.1,",1:"55,"_PSGP_",5,")_+PSGORD_","
"RTN","PSGVW",22,0)
 S PN=$G(PSGP(0)) S:PN="" PN=$P($G(^DPT(PSGP,0)),"^")
"RTN","PSGVW",23,0)
 ; the naked reference on the line below refers to the full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSGVW",24,0)
 S OD=$G(@(F_"0)")),STAT=$P(OD,U,9),PSJ21=$P(OD,U,21),PDRG=$G(^(.2)),INS=$G(^(.3)),AT=$G(^(2)),ND4=$G(^(4)),EB=$P(ND4,"^",7) S:'NF XU=$G(^(5)) S X=$P($G(^(6)),"^"),SIG=$G(^(6.5)),DO=$G(^(1,1,0))
"RTN","PSGVW",25,0)
 S PR=$P(OD,"^",2),MR=$P(OD,"^",3),SM=$P(OD,"^",5),HSM=$P(OD,"^",6),SCT=$S(PSGORD'["P":$P(OD,"^",7),1:""),ST=$P(OD,"^",9),(PSGLI,LID)=$P(OD,"^",16),OD=$P(OD,"^",14),DO=$P(PDRG,"^",2),ESIG=$P(PDRG,"^",3),PDRG=+PDRG
"RTN","PSGVW",26,0)
L S SCH=$P(AT,"^"),STD=$S(STAT'["P":$P(AT,"^",2),1:""),FD=$S(STAT'["P":$P(AT,"^",4),1:""),FQC=$P(AT,"^",6),AT=$P(AT,"^",5) I FQC="D",AT="" S AT=$E($P(STD,".",2)_"0000",1,4)
"RTN","PSGVW",27,0)
 S PRI=$S('PR:0,1:$P($G(^VA(200,PR,"PS")),"^",4)),DRGI=$S('PDRG:0,1:$P($G(^PS(50.7,PDRG,0)),"^",4)),PR=$$ENNPN^PSGMI(PR) S:PRI PRI=PRI'>DT S:DRGI DRGI=DRGI'>DT
"RTN","PSGVW",28,0)
 I PSJ21]"",$L($T(ES^ORX8)) N ESIG1 S ESIG1=$$ES^ORX8(+PSJ21_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSGVW",29,0)
 S PR=PR_$S(ESIG]"":" ["_$$LOW^XLFSTR(ESIG)_"]",1:"")
"RTN","PSGVW",30,0)
 S DRG=$$OIDF^PSJLMUT1(+PDRG) S SI=$S(X]"":$$ENSET^PSGSICHK(X),1:"")
"RTN","PSGVW",31,0)
 F Q="FD","LID","OD","STD" S @Q=$$ENDTC^PSGMI(@Q)
"RTN","PSGVW",32,0)
 Q:$D(PSJLM)
"RTN","PSGVW",33,0)
 ;
"RTN","PSGVW",34,0)
WRT ;
"RTN","PSGVW",35,0)
 Q:($G(@(F_"0)"))="")
"RTN","PSGVW",36,0)
 W !! W:'$D(PSGVWA) ?5,FL,! W "Patient: ",PN
"RTN","PSGVW",37,0)
 W ?47,"Status: " I ST["D" W "DISCONTINUED",$S(ST["E":" (EDIT)",ST["R":" (RENEWAL)",1:"")
"RTN","PSGVW",38,0)
 E  W $S(ST="E":"EXPIRED",$P($G(@(F_"0)")),U,27)="R":"RENEWED",ST="":"NOT FOUND",ST="RE":"REINSTATED",1:$P(ST_"^ACTIVE^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^UNRELEASED","^",$F("AHINPU",ST)))
"RTN","PSGVW",39,0)
 W !,"Orderable Item: ",DRG
"RTN","PSGVW",40,0)
 W !?2,"Instructions: ",INS
"RTN","PSGVW",41,0)
 W !,"Dosage Ordered: ",DO
"RTN","PSGVW",42,0)
 S PSJDUR="" I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSGVW",43,0)
 I $G(PSGORD),($G(PSJDUR)="") S P=$S(PSGORD["U":5,1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,P)
"RTN","PSGVW",44,0)
 W !?6,"Duration: ",PSJDUR
"RTN","PSGVW",45,0)
 W ?48,"Start: ",STD
"RTN","PSGVW",46,0)
 W !?5,"Med Route: ",$S(MR:$S($D(^PS(51.2,+MR,0)):$P(^(0),"^")_$S($P(^(0),"^",3)]"":" ("_$P(^(0),"^",3)_")",1:""),1:MR),1:"NOT FOUND")
"RTN","PSGVW",47,0)
 N RNDT,PSGLRN S PSGLRN=$$LASTREN^PSJLMPRI(PSGP,PSGORD) I PSGLRN S RNDT=$$ENDTC^PSGMI(+PSGLRN) W ?46,"Renewed: ",RNDT
"RTN","PSGVW",48,0)
 W !,$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSGVW",49,0)
 W ?49,"Stop: ",FD
"RTN","PSGVW",50,0)
 I $G(PSGORD),($G(PSJDUR)="") S P=$S(PSGORD["U":5,1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,P)
"RTN","PSGVW",51,0)
 W !?1,"Schedule Type: ",$$ENSTN^PSGMI(SCT)
"RTN","PSGVW",52,0)
 W !?6,"Schedule: ",$S(SCH="":"NOT FOUND",$L(SCH)>27:$E(SCH,1,24)_"...",1:SCH)
"RTN","PSGVW",53,0)
 W !?3,$S(AT&("P"'[SCT):"Admin Times: "_AT,1:"(No Admin Times)"),!?6,"Provider: ",PR
"RTN","PSGVW",54,0)
 N SIL S SIL=$$GETSIOPI^PSJBCMA5(PSGP,PSGORD,1) I SIL!(SI]"") D
"RTN","PSGVW",55,0)
 .I SI]"",'SIL W !,"Special Instructions: (see below) " D  Q
"RTN","PSGVW",56,0)
 ..F Q=1:1:$L(SI," ") S QQ=$P(SI," ",Q) W !?2,QQ," "
"RTN","PSGVW",57,0)
 .Q:'$G(PSJSYSP)  N LNTXT S LNTXT=0 F  S LNTXT=$O(^TMP("PSJBCMA5",$J,PSGP,PSGORD,LNTXT)) Q:'LNTXT  D
"RTN","PSGVW",58,0)
 ..I LNTXT=1 W !,"Special Instructions: (see below)"
"RTN","PSGVW",59,0)
 ..W !,$G(^TMP("PSJBCMA5",$J,PSGP,PSGORD,LNTXT))
"RTN","PSGVW",60,0)
 W !?48,"Units",?56,"Units",?64,"Inactive",!," Dispense Drugs",?43,"U/D",?48,"Disp'd",?56,"Ret'd",?64,"Date",!,FL,$E(FL,1,10)
"RTN","PSGVW",61,0)
 ; the naked reference on the line below refers to the full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSGVW",62,0)
 F X=0:0 S X=$O(@(F_"1,"_X_")")) Q:'X  S DRG=$G(^(X,0)) I DRG]"" D  ;
"RTN","PSGVW",63,0)
 .S UD=$P(DRG,"^",2),D=$P(DRG,"^",6)+$P(DRG,"^",10)+$P(DRG,"^",12),R=+$P(DRG,"^",7),Y=$P(DRG,"^",3),DRG=$P(DRG,"^") I Y S Y=$E($$ENDTC^PSGMI(Y),1,8)
"RTN","PSGVW",64,0)
 .W !?1,$$ENDDN^PSGMI(DRG),?43,$S(UD:UD,1:1),?48,D,?56,R W:Y ?64,Y Q
"RTN","PSGVW",65,0)
 ; the naked reference on the two lines below refers to the full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSGVW",66,0)
 I $O(@(F_"12,0)")) W !!,"Provider Comments:" F Q=0:0 S Q=$O(@(F_"12,"_Q_")")) Q:'Q  N Y S Y=^(Q,0) W !,Y
"RTN","PSGVW",67,0)
 I $O(@(F_"3,0)")) W !!,"Comments:" F Q=0:0 S Q=$O(@(F_"3,"_Q_")")) Q:'Q  W !,^(Q,0)
"RTN","PSGVW",68,0)
ACTFLG W ! S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSGVW",69,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSGVW",70,0)
 W:AT]"" !,"ORDER ",$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSGVW",71,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" W "  (",$P(AT,"^",10),")"
"RTN","PSGVW",72,0)
 W !,"Self Med: " I SM W "SELF MED" W:HSM "  (HOSPITAL SUPPLIED)"
"RTN","PSGVW",73,0)
 I 'SM&('HSM) W "NO"
"RTN","PSGVW",74,0)
 W !!,"Entry By: ",$$ENNPN^PSGMI(EB),?52,"Entry Date: ",LID
"RTN","PSGVW",75,0)
 I $G(PSGLRN) W !,"Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2))
"RTN","PSGVW",76,0)
 W:DRGI !!?3,"(THE ORDERABLE ITEM IS CURRENTLY LISTED AS INACTIVE.)" I PRI W:'DRGI ! W !?3,"(PROVIDER IS CURRENTLY LISTED AS INACTIVE.)"
"RTN","PSGVW",77,0)
 ;
"RTN","PSGVW",78,0)
DONE ;
"RTN","PSGVW",79,0)
 K ^TMP("PSJBCMA5",$J)
"RTN","PSGVW",80,0)
 K AND,D,DRG1,DRG2,AT,DO,DRG,EB,F,FD,FL,HSM,INS,LID,MR,ND4,OD,PN,PR,PSGID,PSGOD,R,SCH,SCT,SI,SIG,SM,ST,STD,UD,X,XU,Y Q
"RTN","PSGVW",81,0)
 Q
"RTN","PSGVW0")
0^68^B10085740^B7338389
"RTN","PSGVW0",1,0)
PSGVW0 ;BIR/CML3-SHOWS ACTIVITY LOG ;16 DEC 97 / 1:38 PM 
"RTN","PSGVW0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**49,54,85,267**;16 DEC 97;Build 158
"RTN","PSGVW0",3,0)
 ;
"RTN","PSGVW0",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGVW0",5,0)
 ;
"RTN","PSGVW0",6,0)
 F  R !!,"Show LONG, SHORT, or NO activity log?  N// ",AT:DTIME D ALC Q:Q
"RTN","PSGVW0",7,0)
 Q:"^N"[AT  S PN=1,PX="" F Q=0:0 S Q=$O(@(F_"9,"_Q_")")) Q:'Q  I $D(^(Q,0)) S AND=^(0) D:'(PN#6) NPAGE Q:PX["^"  D AL1
"RTN","PSGVW0",8,0)
 Q
"RTN","PSGVW0",9,0)
AL1 S PN=PN+1,UD=$P(AND,"^",3) I AT="S",UD?4N,$E(UD)=6,UD#6000 Q
"RTN","PSGVW0",10,0)
 W !!?4,"Date: ",$$ENDTC^PSGMI(+AND) W:$S(UD'?4N:1,1:$E(UD,1,2)'=10) ?30,"User: ",$$ENNPN^PSGMI($P(AND,"^",2))
"RTN","PSGVW0",11,0)
 W !,"Activity: ORDER ",$S(UD="":"****",'$D(^PS(53.3,UD,0)):UD,$P(^(0),"^")]"":$P(^(0),"^"),1:UD)
"RTN","PSGVW0",12,0)
AL2 I UD?4N,$E(UD)=6 W !?3,"Field: ",$P(AND,"^",4) S OD=$P(AND,"^",5) I OD>2000000,$P(OD,".",2) S OD=$$ENDTC^PSGMI(OD)
"RTN","PSGVW0",13,0)
 I AND'["SPECIAL INSTRUCTIONS"&(AND'["OTHER PRINT INFO") I UD?4N,$E(UD)=6 W !,"Old Data: ",OD
"RTN","PSGVW0",14,0)
 I AND["SPECIAL INSTRUCTIONS" W !,"Old Data: " D
"RTN","PSGVW0",15,0)
 .I ($G(PSJORD)["U") D
"RTN","PSGVW0",16,0)
 ..N Q2 S Q2=0 F  S Q2=$O(^PS(55,DFN,5,+PSJORD,9,Q,1,Q2)) Q:'Q2  W !?3,^(Q2,0)
"RTN","PSGVW0",17,0)
 ..S Q2=0 F  S Q2=$O(^PS(55,DFN,5,+PSJORD,9,Q,2,Q2)) Q:'Q2  W:(Q2=1) !,"New Data: " W !?3,^(Q2,0)
"RTN","PSGVW0",18,0)
 .I ($G(PSJORD)["P") N Q2 S Q2=0 F  S Q2=$O(^PS(53.1,+PSJORD,"A",Q,1,Q2)) Q:'Q2  W !?3,^(Q2,0)
"RTN","PSGVW0",19,0)
 I AND["OTHER PRINT INFO" W !,"Old Data: " D
"RTN","PSGVW0",20,0)
 .I ($G(PSJORD)["U") N Q2 S Q2=0 F  S Q2=$O(^PS(55,DFN,"IV",+PSJORD,"A",Q,1,1,Q2)) Q:'Q2  W !?3,^(Q2,0)
"RTN","PSGVW0",21,0)
 .I ($G(PSJORD)["P") N Q2 S Q2=0 F  S Q2=$O(^PS(53.1,+PSJORD,"A",Q,1,Q2)) Q:'Q2  W !?3,^(Q2,0)
"RTN","PSGVW0",22,0)
 I UD?4N,$E(UD)=7,$P(AND,"^",4)]"" W !?3,"Field: ",$P(AND,"^",4)
"RTN","PSGVW0",23,0)
 Q
"RTN","PSGVW0",24,0)
NPAGE I $E(IOST)="C" R !!,"Enter '^' to stop, or press RETURN to continue.",PX:DTIME
"RTN","PSGVW0",25,0)
 Q
"RTN","PSGVW0",26,0)
ALC ;
"RTN","PSGVW0",27,0)
 S Q=1 W:'$T $C(7) I AT["^"!'$T S AT="^" Q
"RTN","PSGVW0",28,0)
 I AT="" W "  (NO)" S AT="N" Q
"RTN","PSGVW0",29,0)
 F PX="SHORT","LONG","NO" I $P(PX,AT)="" W $P(PX,AT,2) S AT=$E(AT) Q
"RTN","PSGVW0",30,0)
 Q:$T  S Q=0 I AT'["?" W $C(7),"  ??" Q
"RTN","PSGVW0",31,0)
 W !!,"Enter 'LONG' (or 'L') to see ALL of the entries of this activity log.  Enter    'SHORT' (or 'S') to NOT see the fields edited because of the order being",!,"renewed, discontinued, etc.  Simply press the RETURN key "
"RTN","PSGVW0",32,0)
 W "(or enter 'NO', 'N',",!,"or '^') to NOT see the activity log." Q
"RTN","PSGVW0",33,0)
 ;
"RTN","PSGVW0",34,0)
ENA ;
"RTN","PSGVW0",35,0)
 I PSGORD["U" S PN=1,PX="" F Q=0:0 S Q=$O(^PS(55,PSGP,5,+PSGORD,9,Q)) Q:'Q  I $D(^(Q,0)) S AND=^(0) D:'(PN#6) NPAGE Q:PX["^"  D AL1
"RTN","PSGVW0",36,0)
 I PSGORD["P" S PN=1,PX="" F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,"A",Q)) Q:'Q  I $D(^(Q,0)) S AND=^(0) D:'(PN#6) NPAGE Q:PX["^"  D AL1
"RTN","PSGVW0",37,0)
 Q
"RTN","PSIV")
0^28^B24205537^B24224990
"RTN","PSIV",1,0)
PSIV ;BIR/PR,MLM-MISC UTILITIES ;19 Mar 99 / 9:45 AM
"RTN","PSIV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,16,29,38,53,56,72,58,110,181,267**;16 DEC 97;Build 158
"RTN","PSIV",3,0)
 ;
"RTN","PSIV",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIV",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789
"RTN","PSIV",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000
"RTN","PSIV",7,0)
 ; Reference to ^DIC is supported by DBIA 10006
"RTN","PSIV",8,0)
 ; Reference to ^DIE is supported by DBIA 10018
"RTN","PSIV",9,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSIV",10,0)
 ; Reference to ^VALM is supported by DBIA 10118
"RTN","PSIV",11,0)
 ; Reference to ^VALM1 is supported by DBIA 10116
"RTN","PSIV",12,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSIV",13,0)
 ;
"RTN","PSIV",14,0)
ENGETP ;Enter here to select patient.
"RTN","PSIV",15,0)
 K DIC S DIC("W")="W ""  "",$P(^(0),""^"",9) W:$D(^(.1)) ""  "",^(.1)",DIC="^DPT(",DIC(0)="QEM"
"RTN","PSIV",16,0)
 D FULL^VALM1
"RTN","PSIV",17,0)
GETP1 ;
"RTN","PSIV",18,0)
 ;NEW arrays use in order checks
"RTN","PSIV",19,0)
 NEW PSJEXCPT,PSJOCER
"RTN","PSIV",20,0)
 S PSGPTMP=0,PPAGE=1,DFN=-1,X="Select PATIENT:^^^^1" D ENQ Q:"^"[X
"RTN","PSIV",21,0)
 D EN^PSJDPT
"RTN","PSIV",22,0)
 I Y<0 G ENGETP
"RTN","PSIV",23,0)
 N PSGP,PSJACNWP S (PSGP,DFN)=+Y D ENBOTH^PSJAC S PSJORL=$$ENORL^PSJUTL($G(VAIN(4)))
"RTN","PSIV",24,0)
 Q
"RTN","PSIV",25,0)
 ;
"RTN","PSIV",26,0)
ENYN ;Enter here for yes/no responses. This is a general reader that I have
"RTN","PSIV",27,0)
 ;been phasing out with ^DICN
"RTN","PSIV",28,0)
 S X=X_"^Y:YES;N:NO^YES,NO"
"RTN","PSIV",29,0)
 ;
"RTN","PSIV",30,0)
ENQ ;Enter here to read X. This is the general reader that I have
"RTN","PSIV",31,0)
 ;been slowly phasing out
"RTN","PSIV",32,0)
 S QUD=$P(X,"^",2) W !!,$P(X,"^")," " W:QUD]"" QUD,"// " R QUX:DTIME W:'$T $C(7) S:'$T QUX="^" S:QUX="" QUX=QUD I QUX["^"!(QUX["?") G KILL
"RTN","PSIV",33,0)
 I $L(QUX)>500 W "    ??" G ENQ
"RTN","PSIV",34,0)
 S:QUX?1L QUX=$C($A(QUX)-32)
"RTN","PSIV",35,0)
 S QUD=";"_$P(X,"^",3)_";" G:QUD'[(";"_QUX_":") VAR S QUX1=$E(QUD,$F(QUD,QUX_":"),($F(QUD,";",$F(QUD,QUX_":"))-2)) G:QUX1[":" VAR W "    ",QUX1 G KILL
"RTN","PSIV",36,0)
VAR F QUX1=1:1 S QUD=$P($P(X,"^",4),",",QUX1) Q:QUD=""  I $P(QUD,QUX)="" W $S($P(X,"^",2)=QUX:"    "_QUX,1:"")_$P(QUD,QUX,2,99) S QUX=QUD G KILL
"RTN","PSIV",37,0)
PAT I $P(X,"^",5)]"",@$P(X,"^",5,999) G KILL
"RTN","PSIV",38,0)
 W $C(7)," ???" G ENQ
"RTN","PSIV",39,0)
KILL S X=QUX K QUX,QUX1,QUD,PSJDCEXP Q
"RTN","PSIV",40,0)
 ;
"RTN","PSIV",41,0)
ENADM ;Edit administration schedules.
"RTN","PSIV",42,0)
 S DIC="^PS(51.1,",DIC(0)="QEAML",DLAYGO=51.1 D ^DIC K:+Y<0 %,DA,D0,DIC,DIE,DLAYGO,DR,Z,Y Q:'$D(Y)  S DIE=DIC,DR=".01;1",DA=+Y K DIC D ^DIE G ENADM
"RTN","PSIV",43,0)
 ;
"RTN","PSIV",44,0)
ENOW D NOW^%DTC S Y=% K %,%H,%I
"RTN","PSIV",45,0)
 Q
"RTN","PSIV",46,0)
 ;
"RTN","PSIV",47,0)
ENC ;Get unit of measure for drug selected.
"RTN","PSIV",48,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSIV",49,0)
 Q
"RTN","PSIV",50,0)
 ;
"RTN","PSIV",51,0)
ENCHS ;Needs PSIVBR (Branch point)
"RTN","PSIV",52,0)
 D ENGETP G:DFN<0 Q
"RTN","PSIV",53,0)
 ;* Lock patient if calling FROM PSJI DELETE ORDER.
"RTN","PSIV",54,0)
 I PSIVBR="D ENT^PSIVPGE",('$$L^PSSLOCK(DFN,1)) Q
"RTN","PSIV",55,0)
OE N CONT S CONT=0
"RTN","PSIV",56,0)
 F  Q:CONT  D ENCHS1
"RTN","PSIV",57,0)
 Q:$D(ORVP)
"RTN","PSIV",58,0)
 G ENCHS
"RTN","PSIV",59,0)
ENCHS1 ;
"RTN","PSIV",60,0)
 I '($$AA^PSJDPT(DFN)>0) S CONT=1 Q
"RTN","PSIV",61,0)
 S PSJORQF=0,CONT=0
"RTN","PSIV",62,0)
 S PSJPROT=2,PSJOL="",(PSGOP,PSGP)=DFN
"RTN","PSIV",63,0)
 K PSJLMPRO D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSIV",64,0)
 S VALMCNT=30
"RTN","PSIV",65,0)
 I PSIVBR="D PROCESS^PSIVRD",(PSJOL="N") D ORDNO^PSIVRD Q
"RTN","PSIV",66,0)
 I $G(PSJNEWOE) S PSJOL="S"
"RTN","PSIV",67,0)
 I PSJOL="S"!(PSJOL="L") F  Q:CONT  S P("PT")=PSJOL D
"RTN","PSIV",68,0)
 . S PSJORQF=0,PSJNEWOE=0
"RTN","PSIV",69,0)
 . D ENNB^PSIVACT
"RTN","PSIV",70,0)
 . I '$D(^TMP("PSIV",$J)) D FULL^VALM1 W !!,?30,"NO ORDERS FOUND",! K DIR S DIR(0)="E" D ^DIR W @IOF S CONT=0
"RTN","PSIV",71,0)
 . NEW PSJIVPRF S PSJIVPRF=1
"RTN","PSIV",72,0)
 . S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSIV",73,0)
 . D EN^VALM("PSJ LM IV OE")
"RTN","PSIV",74,0)
 . I $G(VALMBCK)="Q" Q
"RTN","PSIV",75,0)
 . S CONT=1
"RTN","PSIV",76,0)
 ;* Unlock patient if come from PSJI DELETE ORDER
"RTN","PSIV",77,0)
 I '$G(PSJORQF) S CONT=1
"RTN","PSIV",78,0)
 I PSIVBR="D ENT^PSIVPGE" D UL^PSSLOCK(DFN)
"RTN","PSIV",79,0)
 K PSJLMPRO
"RTN","PSIV",80,0)
 Q
"RTN","PSIV",81,0)
SELSO ;SELECT ORDER USING "SO" OPTION
"RTN","PSIV",82,0)
 S PSGLMT=^TMP("PSJPRO",$J,0) D ENASR^PSGON,OV
"RTN","PSIV",83,0)
 Q
"RTN","PSIV",84,0)
SELNUM ;SELECT ORDERS WITH NUMBERS
"RTN","PSIV",85,0)
 S PSGLMT=^TMP("PSJPRO",$J,0),X=$P(XQORNOD(0),"=",2) D ENCHK^PSGON,OV
"RTN","PSIV",86,0)
 Q
"RTN","PSIV",87,0)
OV ;
"RTN","PSIV",88,0)
 I '$D(PSGODDD) S VALMBCK="R" Q
"RTN","PSIV",89,0)
 N DONE
"RTN","PSIV",90,0)
 F PSIVOV1=1:1:PSGODDD F PSIVOV2=1:1:$L(PSGODDD(PSIVOV1),",")-1 D
"RTN","PSIV",91,0)
 .S ON=+$P(PSGODDD(PSIVOV1),",",PSIVOV2)
"RTN","PSIV",92,0)
 .S ON=$$GTON(ON)
"RTN","PSIV",93,0)
 .Q:'ON!$G(DONE)
"RTN","PSIV",94,0)
 .D OV1
"RTN","PSIV",95,0)
 S VALMBCK="Q"
"RTN","PSIV",96,0)
 Q
"RTN","PSIV",97,0)
GTON(X) ;
"RTN","PSIV",98,0)
 ;Return the ON node from ^Tmp
"RTN","PSIV",99,0)
 I $G(X)="" Q ""
"RTN","PSIV",100,0)
 I $D(^TMP("PSIV",$J,"AB",X)) Q ^(X)
"RTN","PSIV",101,0)
 I $D(^TMP("PSIV",$J,"NB",X)) Q ^(X)
"RTN","PSIV",102,0)
 I $D(^TMP("PSIV",$J,"PB",X)) Q ^(X)
"RTN","PSIV",103,0)
 I $D(^TMP("PSIV",$J,"XB",X)) Q ^(X)
"RTN","PSIV",104,0)
 I $D(^TMP("PSIV",$J,"NDB",X)) Q ^(X)
"RTN","PSIV",105,0)
 I $D(^TMP("PSIV",$J,"PDB",X)) Q ^(X)
"RTN","PSIV",106,0)
 I $D(^TMP("PSIV",$J,"RDB",X)) Q ^(X)
"RTN","PSIV",107,0)
 Q ""
"RTN","PSIV",108,0)
OV1 ;
"RTN","PSIV",109,0)
 S (ON,ON55,P("PON"))=9999999999-ON_$S(ON["V":"V",1:"P")
"RTN","PSIV",110,0)
 I PSIVBR["D ^PSIVVW1" D
"RTN","PSIV",111,0)
 . S VALMSG="Select either ""AL"" , ""LL"" or ""AL,LL"" for both"
"RTN","PSIV",112,0)
 . S PSJORD=ON D EN^PSJLIPRF
"RTN","PSIV",113,0)
 E  D
"RTN","PSIV",114,0)
 . I PSIVBR="D ^PSIVOPT",'($$LS^PSSLOCK(PSGP,ON)) Q
"RTN","PSIV",115,0)
 . X PSIVBR
"RTN","PSIV",116,0)
 . D:PSIVBR="D ^PSIVOPT" UNL^PSSLOCK(PSGP,ON)
"RTN","PSIV",117,0)
 K:'$D(DUOUT)&($G(Y)'=-1) DONE
"RTN","PSIV",118,0)
 Q
"RTN","PSIV",119,0)
 ;
"RTN","PSIV",120,0)
 ;
"RTN","PSIV",121,0)
ENU ;Get IV additive strength. Called from templates.
"RTN","PSIV",122,0)
 N Y S Y=+^PS(55,DA(2),"IV",DA(1),"AD",DA,0),PSIVSTR=$$ENU^PSIVUTL(Y)
"RTN","PSIV",123,0)
 Q
"RTN","PSIV",124,0)
Q ;
"RTN","PSIV",125,0)
 K ^TMP($J,"PSJPRE")
"RTN","PSIV",126,0)
 K ^TMP("PSIV",$J),^TMP("PSJ",$J),^TMP("PSJPRO",$J),^TMP("PSJALL",$J),^TMP("PSJI",$J),^TMP("PSJON",$J)
"RTN","PSIV",127,0)
 K DRG,DRGI,DRGN,DRGT,ERR,I,JJ,MI,N,N2,ON,ON55,P,P1,P3,P16,P17,PNOW,PS,PSGODD,PSGODDD,PSIV,PSIVAAT,PSIVACT,PSIVADM,PSIVAT
"RTN","PSIV",128,0)
 K PSIVC,PSIVDT,PSIVFLAG,PSIVLN,PSIVNOW,PSIVNU,PSIVON,PSIVOV1,PSIVOV2,PSIVREA,PSIVSTR,PSIVSTRT,PSIVNOL,PSIVTYPE,PSJNKF
"RTN","PSIV",129,0)
 K PSJORF,PSJORIFN,RDWARD,START,STOP,SCHED,USER,V,XT
"RTN","PSIV",130,0)
 K %,%I,DIC,PSIVC,PSIVNU,PSIVON,PSIVREA,PSIVOV1,PSIVOV2,RDWARD,V,VAERR,VW,X,X2,Y,Y1,Z,Z1,Z2
"RTN","PSIV",131,0)
 Q
"RTN","PSIVEDT1")
0^39^B63913566^B59446179
"RTN","PSIVEDT1",1,0)
PSIVEDT1 ;BIR/MLM-EDIT IV ORDER (CONT) ; 2/14/12 7:20am
"RTN","PSIVEDT1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**3,7,41,47,50,64,58,116,110,111,113,267**;16 DEC 97;Build 158
"RTN","PSIVEDT1",3,0)
 ;
"RTN","PSIVEDT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVEDT1",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSIVEDT1",6,0)
 ;
"RTN","PSIVEDT1",7,0)
10 ; Start Date
"RTN","PSIVEDT1",8,0)
 D:'P(2)&P("IVRM")!($G(PSJREN)) ENT^PSIVCAL
"RTN","PSIVEDT1",9,0)
A10 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",10,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Start Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",11,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",12,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Start Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",13,0)
 S Y=P(2) X ^DD("DD") W !,"START DATE/TIME: "_$S(Y]"":Y_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(P(2)&X="") Q
"RTN","PSIVEDT1",14,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 10
"RTN","PSIVEDT1",15,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S F1=53.1,F2=10 S:X="@" X="?" D ENHLP^PSIVORC1 G A10
"RTN","PSIVEDT1",16,0)
 K %DT S:X="" X=P(2) S %DT="ERTX" D ^%DT K %DT G:Y'>0 A10
"RTN","PSIVEDT1",17,0)
 I $G(P("RES"))="R",(+Y<+$P($G(^PS(55,DFN,"IV",+$G(P("OLDON")),0)),U,2)) D  G 10
"RTN","PSIVEDT1",18,0)
 .; naked ref below refers to line above
"RTN","PSIVEDT1",19,0)
 .S Y=$P(^(0),U,2) X ^DD("DD") W $C(7),!!,"Start date of order being renewed is ",Y,".",!,"Start date of renewal order must be AFTER start date of order being renewed.",!
"RTN","PSIVEDT1",20,0)
 S X1=$G(P("LOG")),X2=-7 D C^%DTC I +Y<X W !!,"Start date/time may not be entered prior to 7 days from the order's LOGIN DATE.",! D A10
"RTN","PSIVEDT1",21,0)
 S P(2)=+Y,PSGSDX=1
"RTN","PSIVEDT1",22,0)
 Q
"RTN","PSIVEDT1",23,0)
 ;
"RTN","PSIVEDT1",24,0)
25 ; Stop Date
"RTN","PSIVEDT1",25,0)
 G:$D(PSGFDX) A25
"RTN","PSIVEDT1",26,0)
 I P("IVRM")]"",$S(P(3)<P(2):1,$G(PSIVAC)["E":0,1:1) S PSIVSITE=$G(^PS(59.5,+P("IVRM"),1)),$P(PSIVSITE,"^",20,21)=$G(^PS(59.5,+P("IVRM"),5)) D ENSTOP^PSIVCAL
"RTN","PSIVEDT1",27,0)
A25 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",28,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Stop Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",29,0)
 S Y=P(3) X ^DD("DD") W !,"STOP DATE/TIME: "_$S(Y]"":Y_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 Q:X=""&P(2)  I $E(X)=U!(X=""&P(2)) Q
"RTN","PSIVEDT1",30,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 25
"RTN","PSIVEDT1",31,0)
 I X="@"!(X["?") W $C(7),"  (Required)" S F1=53.1,F2=25,X="?" D ENHLP^PSIVORC1 G A25
"RTN","PSIVEDT1",32,0)
 K %DT S:X="" X=$G(Y) S:X="" X=P(3) S %DT="ERTX" D:X'=+X ^%DT
"RTN","PSIVEDT1",33,0)
 I X=+X,X>0,X'>2000000 G A25:'$$ENDL^PSGDL(P(9),X) D ENDL^PSIVSP
"RTN","PSIVEDT1",34,0)
 D DOSE
"RTN","PSIVEDT1",35,0)
 I $G(X)="" S X=Y
"RTN","PSIVEDT1",36,0)
 I $G(X)="" S X=P(3)
"RTN","PSIVEDT1",37,0)
 I $G(Z)]"",Z>X D  G A25
"RTN","PSIVEDT1",38,0)
 . W !,"There is no administration time that falls between the Start Date/Time"
"RTN","PSIVEDT1",39,0)
 . W !,"and Stop Date/Time.",!
"RTN","PSIVEDT1",40,0)
 S X=Y S:Y<1!Y'["." X="" G:Y'>0 A25 S P(3)=+Y,PSGFDX=1
"RTN","PSIVEDT1",41,0)
 Q
"RTN","PSIVEDT1",42,0)
 ;
"RTN","PSIVEDT1",43,0)
26 ; Schedule
"RTN","PSIVEDT1",44,0)
 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",45,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",46,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",47,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",48,0)
 W !,"SCHEDULE: ",$S(P(9)]"":P(9)_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X="") Q
"RTN","PSIVEDT1",49,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(9)="" G 26
"RTN","PSIVEDT1",50,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 26
"RTN","PSIVEDT1",51,0)
 I X?1."?"!($L(X)>22)!($L(X," ")>3) S F1=55.01,F2=.09 D ENHLP^PSIVORC1 G 26
"RTN","PSIVEDT1",52,0)
 S CHG=0 I P(9)]"",X'=P(9) S CHG=1
"RTN","PSIVEDT1",53,0)
 S P(7)="" K PSGOES D EN^PSIVSP S:XT<0 X="" I $G(X)="" W $C(7),"??" G 26
"RTN","PSIVEDT1",54,0)
 I CHG D
"RTN","PSIVEDT1",55,0)
 . S P(9)=X,P(11)=Y,P(15)=XT
"RTN","PSIVEDT1",56,0)
 . I $$ODD^PSGS0(P(15)) S P(11)=""
"RTN","PSIVEDT1",57,0)
 . W !!?5,"This change in schedule also changes the Administration Times and Schedule Type of this order."
"RTN","PSIVEDT1",58,0)
 . S DIR("A")="Enter RETURN to continue or '^' to exit:"
"RTN","PSIVEDT1",59,0)
 . D PAUSE^VALM1
"RTN","PSIVEDT1",60,0)
 K CHG
"RTN","PSIVEDT1",61,0)
 Q
"RTN","PSIVEDT1",62,0)
 ;
"RTN","PSIVEDT1",63,0)
39 ; Admin Times
"RTN","PSIVEDT1",64,0)
 S ORIG=$G(P(11))
"RTN","PSIVEDT1",65,0)
A39 I $G(P("RES"))="R" I $G(ON)["P",($P($G(^PS(53.1,+ON,0)),"^",24)="R") D  Q
"RTN","PSIVEDT1",66,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Administration times may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",67,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSIVEDT1",68,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Admin Times may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",69,0)
 I $G(P(9))=""!($G(P(9))[" PRN")!($G(P(9))="PRN") Q  ;No schedule or PRN schedule
"RTN","PSIVEDT1",70,0)
 I $$ODD^PSGS0(P(15)) S P(11)="" Q
"RTN","PSIVEDT1",71,0)
 W !,"ADMINISTRATION TIMES: ",$S(P(11)]"":P(11)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I '($G(P(15))="D"&'DONE) I $E(X)=U S (X,P(11))=ORIG Q
"RTN","PSIVEDT1",72,0)
 I X="",P(11)]"" S X=P(11)
"RTN","PSIVEDT1",73,0)
 I ($G(P(15))="D"!($G(P(9))["@"))&('$G(X)!(X["@")) W $C(7),"  ??" S X="?" W:(P(15)="D"!(X["@")) !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." G A39
"RTN","PSIVEDT1",74,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(11)="" G A39
"RTN","PSIVEDT1",75,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSIVEDT1",76,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G A39
"RTN","PSIVEDT1",77,0)
 I $G(P(15))'="D",$G(P(15))'="P",'$$ONCALL(P(9)) D TIMES I '$D(X) G A39
"RTN","PSIVEDT1",78,0)
 K:X[""""!($A(X)=45) X W:$G(X)="^"!('$D(X)) $C(7),"  ??" G:$G(X)="^"!('$D(X)) A39 S P(11)=X D:$G(PSIVCAL) ENT^PSIVCAL,ENSTOP^PSIVCAL K PSIVCAL
"RTN","PSIVEDT1",79,0)
 Q
"RTN","PSIVEDT1",80,0)
 ;
"RTN","PSIVEDT1",81,0)
59 ; Infusion Rate
"RTN","PSIVEDT1",82,0)
 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",83,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Infusion Rate may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",84,0)
 W !,"INFUSION RATE: ",$S(P(8)]"":P(8)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $S($E(X)=U:1,X]"":0,1:P(8)]"") Q
"RTN","PSIVEDT1",85,0)
 I X=""&(("C^P"[P(4))!(("C^S"[P(4))&(P(5)=1))) Q
"RTN","PSIVEDT1",86,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(8)="" G 59
"RTN","PSIVEDT1",87,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 59
"RTN","PSIVEDT1",88,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVEDT1",89,0)
 I X]"" D ENI^PSIVSP W:'$D(X) $C(7)," ??" G:'$D(X) 59 S P(8)=X
"RTN","PSIVEDT1",90,0)
 I P(8)="" W $C(7),!!,"An infusion rate must be entered!" G 59
"RTN","PSIVEDT1",91,0)
 Q
"RTN","PSIVEDT1",92,0)
 ;
"RTN","PSIVEDT1",93,0)
63 ; Remarks
"RTN","PSIVEDT1",94,0)
 N DIR S X="",DIR(0)="53.1,63" S:P("REM")]"" DIR("B")=P("REM") D ^DIR I X="^"!$D(DTOUT) S DONE=1 Q
"RTN","PSIVEDT1",95,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P("REM")="" G 63
"RTN","PSIVEDT1",96,0)
 I X]"",$E(X)'="^" S P("REM")=X
"RTN","PSIVEDT1",97,0)
 Q
"RTN","PSIVEDT1",98,0)
 ;
"RTN","PSIVEDT1",99,0)
64 ; Other Print Info
"RTN","PSIVEDT1",100,0)
 N OPIMSG,PSJOPILN,PSJOPIT,PSJTMPTX,TMPLIN,PSJOVRMX
"RTN","PSIVEDT1",101,0)
 S PSJOPILN=$$EDITOPI^PSJBCMA5(DFN) S OPIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSIVEDT1",102,0)
 S PSJTMPTX="",PSJOVRMX=0
"RTN","PSIVEDT1",103,0)
 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.45,$G(PSJSYSP),6,TMPLIN)) Q:'TMPLIN!PSJOVRMX  D
"RTN","PSIVEDT1",104,0)
 .S:($L(PSJTMPTX)+$L($G(^PS(53.45,$G(DUZ),6,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  D
"RTN","PSIVEDT1",105,0)
 ..S PSJTMPTX=$G(PSJTMPTX)_$S($L($G(PSJTMPTX)):" ",1:"")_$G(^PS(53.45,$G(DUZ),6,TMPLIN,0))
"RTN","PSIVEDT1",106,0)
 S PSJTMPTX=$S($G(PSJOVRMX):OPIMSG,1:$G(PSJTMPTX))
"RTN","PSIVEDT1",107,0)
 S P("OPI")=PSJTMPTX I (PSJOPILN>0) S P("OPI")=$$ENBCMA^PSJUTL("V")
"RTN","PSIVEDT1",108,0)
 Q
"RTN","PSIVEDT1",109,0)
 ;
"RTN","PSIVEDT1",110,0)
ORFLDS ; Display OE/RR fields during edit.
"RTN","PSIVEDT1",111,0)
 D FULL^VALM1
"RTN","PSIVEDT1",112,0)
 W !!,"Orderable Item: ",$P(P("PD"),U,2),!,"Give: ",$P(P("MR"),U,2)," ",P(9),!!
"RTN","PSIVEDT1",113,0)
 Q
"RTN","PSIVEDT1",114,0)
 ;
"RTN","PSIVEDT1",115,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSIVEDT1",116,0)
 I $G(P(15)) Q:$$ODD^PSGS0(P(15))
"RTN","PSIVEDT1",117,0)
 I $G(P(15))="C"!$$CONTIN($G(P(9))) I '$$ONCALL($G(P(9))),X="" W !,"This order requires at least one administration time." K X Q  ;No times
"RTN","PSIVEDT1",118,0)
 N H,I,MAX
"RTN","PSIVEDT1",119,0)
 I $G(P(15))="O"!$$ONETIME($G(P(9))) I $L(X,"-")>1 W !," This is a One Time Order - only one administration time is permitted." K X Q
"RTN","PSIVEDT1",120,0)
 I $G(P(15))="O"!$$ONETIME($G(P(9))) Q  ;Done validating One Time
"RTN","PSIVEDT1",121,0)
 I $G(P(9))]"" S H=+$O(^PS(51.1,"B",P(9),0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSIVEDT1",122,0)
 I +I=0 Q  ;No frequency - can not check frequency related items
"RTN","PSIVEDT1",123,0)
 S MAX=1440/I
"RTN","PSIVEDT1",124,0)
 I MAX<1,$L(X,"-")>1 W !,"This order requires one administration time." K X Q
"RTN","PSIVEDT1",125,0)
 I MAX'<1,$L(X,"-")>MAX W !,"The number of admin times entered is greater than indicated by the schedule." K X Q  ;Too many times
"RTN","PSIVEDT1",126,0)
 I MAX'<1,$L(X,"-")<MAX D  ;Too few times
"RTN","PSIVEDT1",127,0)
 . W !,"The number of admin times entered is fewer than indicated by the schedule."
"RTN","PSIVEDT1",128,0)
 . N X,DIR
"RTN","PSIVEDT1",129,0)
 . D PAUSE^VALM1
"RTN","PSIVEDT1",130,0)
 Q
"RTN","PSIVEDT1",131,0)
 ;
"RTN","PSIVEDT1",132,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSIVEDT1",133,0)
 N INFO,Y,PNINE
"RTN","PSIVEDT1",134,0)
 S PNINE=P(9)
"RTN","PSIVEDT1",135,0)
 S INFO=$G(P(2))_U_$G(P(3))_U_$G(P(9))_U_$P($G(PSGZZND),"^",5)_U_$P($G(P("PD")),"^")_U_$G(P(11))
"RTN","PSIVEDT1",136,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSIVEDT1",137,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSIVEDT1",138,0)
 S P(9)=PNINE
"RTN","PSIVEDT1",139,0)
 Q
"RTN","PSIVEDT1",140,0)
 ;
"RTN","PSIVEDT1",141,0)
ONCALL(SCHD) ; Check if a schedule is type On Call (all schedules with a given name must have the same schedule type)
"RTN","PSIVEDT1",142,0)
 N NXT,SCHARR
"RTN","PSIVEDT1",143,0)
 S OCCHK=0
"RTN","PSIVEDT1",144,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSIVEDT1",145,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSIVEDT1",146,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSIVEDT1",147,0)
 I '$D(SCHARR("OC")) S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",148,0)
 I $O(SCHARR("OC"))]""!($O(SCHARR("OC"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",149,0)
 I $D(SCHARR("OC")) S OCCHK=1
"RTN","PSIVEDT1",150,0)
 Q OCCHK
"RTN","PSIVEDT1",151,0)
 ;
"RTN","PSIVEDT1",152,0)
ONETIME(SCHD) ; Check if a schedule is type On Call (all schedules with a given name must have the same schedule type)
"RTN","PSIVEDT1",153,0)
 N NXT,SCHARR
"RTN","PSIVEDT1",154,0)
 S OCCHK=0
"RTN","PSIVEDT1",155,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSIVEDT1",156,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSIVEDT1",157,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSIVEDT1",158,0)
 I '$D(SCHARR("O")) S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",159,0)
 I $O(SCHARR("O"))]""!($O(SCHARR("O"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",160,0)
 I $D(SCHARR("O")) S OCCHK=1
"RTN","PSIVEDT1",161,0)
 Q OCCHK
"RTN","PSIVEDT1",162,0)
 ;
"RTN","PSIVEDT1",163,0)
CONTIN(SCHD) ; Check if a schedule is type On Call (all schedules with a given name must have the same schedule type)
"RTN","PSIVEDT1",164,0)
 N NXT,SCHARR
"RTN","PSIVEDT1",165,0)
 S OCCHK=0
"RTN","PSIVEDT1",166,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSIVEDT1",167,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSIVEDT1",168,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSIVEDT1",169,0)
 I '$D(SCHARR("C")) S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",170,0)
 I $O(SCHARR("C"))]""!($O(SCHARR("C"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSIVEDT1",171,0)
 I $D(SCHARR("C")) S OCCHK=1
"RTN","PSIVEDT1",172,0)
 Q OCCHK
"RTN","PSIVORAL")
0^52^B19351743^B14231518
"RTN","PSIVORAL",1,0)
PSIVORAL ;BIR/MLM-ACTIVITY LOGGER FOR PHARMACY EDITS ;16 DEC 97 / 1:40 PM 
"RTN","PSIVORAL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,135,267**;16 DEC 97;Build 158
"RTN","PSIVORAL",3,0)
 ;
"RTN","PSIVORAL",4,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVORAL",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVORAL",6,0)
 ;
"RTN","PSIVORAL",7,0)
EN ; Entry point for updating activity log from Pharmacy.
"RTN","PSIVORAL",8,0)
 ;
"RTN","PSIVORAL",9,0)
 D OPI
"RTN","PSIVORAL",10,0)
 ;
"RTN","PSIVORAL",11,0)
REMARKS ; Record changes to remarks.
"RTN","PSIVORAL",12,0)
 I $G(^PS(55,DFN,"IV",+ON55,1))'=P("REM") S P("FC")="REMARKS^"_$G(^(1))_U_P("REM") D GTFC
"RTN","PSIVORAL",13,0)
 ;
"RTN","PSIVORAL",14,0)
ADMIN ; Record changes to admin. times.
"RTN","PSIVORAL",15,0)
 I $P($G(^PS(55,DFN,"IV",+ON55,0)),U,11)'=P(11) S P("FC")="ADMINISTRATION TIMES^"_$P($G(^(0)),U,11)_U_P(11) D GTFC
"RTN","PSIVORAL",16,0)
 ;
"RTN","PSIVORAL",17,0)
INFUS ; Record changes to infusion rate.
"RTN","PSIVORAL",18,0)
 I $P($G(^PS(55,DFN,"IV",+ON55,0)),U,8)'=P(8) S P("FC")="INFUSION RATE^"_$P($G(^(0)),U,8)_U_P(8) D GTFC
"RTN","PSIVORAL",19,0)
 D:P("DTYP")=1 SOL
"RTN","PSIVORAL",20,0)
 ;
"RTN","PSIVORAL",21,0)
STOP ; Record changes to stop date.
"RTN","PSIVORAL",22,0)
 I $P(^PS(55,DFN,"IV",+ON55,0),U,3)'=P(3) S P("FC")="STOP DATE/TIME^",Y=$P(^(0),U,3) X ^DD("DD") S $P(P("FC"),U,3)=$P(Y,"@")_" "_$P(Y,"@",2),Y=P(3) X ^DD("DD") S $P(P("FC"),U,2)=$P(Y,"@")_" "_$P(Y,"@",2) D GTFC
"RTN","PSIVORAL",23,0)
 K DRGI,DRGN,TDRG,P("AGE"),P("FC")
"RTN","PSIVORAL",24,0)
 Q
"RTN","PSIVORAL",25,0)
 ;
"RTN","PSIVORAL",26,0)
SOL ; Record changes to Solutions.
"RTN","PSIVORAL",27,0)
 K TDRG F DRGI=0:0 S DRGI=$O(DRG("SOL",DRGI)) Q:'DRGI  S TDRG("NEW",$P(DRG("SOL",DRGI),U))=$P(DRG("SOL",DRGI),U,2,3)
"RTN","PSIVORAL",28,0)
 S P("AGE")="NEW"
"RTN","PSIVORAL",29,0)
 F DRGI=0:0 S DRGI=$O(^PS(55,DFN,"IV",+ON55,"SOL",DRGI)) Q:'DRGI  S X=$G(^PS(55,DFN,"IV",+ON55,"SOL",DRGI,0)),DRG=+$P(X,U),TDRG("OLD",+DRG)=$P($G(^PS(52.7,DRG,0)),U)_U_$P(X,U,2) D:$G(TDRG("NEW",DRG))'=$G(TDRG("OLD",DRG)) SOL1
"RTN","PSIVORAL",30,0)
 S P("AGE")="OLD" F DRGI=0:0 S DRG=$O(TDRG("NEW",DRG)) Q:'DRG  D:$G(TDRG("NEW",DRG))'=$G(TDRG("OLD",DRG)) SOL1
"RTN","PSIVORAL",31,0)
 Q
"RTN","PSIVORAL",32,0)
 ;
"RTN","PSIVORAL",33,0)
SOL1 ;
"RTN","PSIVORAL",34,0)
 I '$D(TDRG(P("AGE"),DRG)) S P("FC")="SOLUTION^"_$P($G(TDRG("OLD",DRG)),U)_U_$P($G(TDRG("NEW",DRG)),U) D GTFC
"RTN","PSIVORAL",35,0)
 Q:$G(TDRG("NEW",DRG))=$G(TDRG("OLD",DRG))
"RTN","PSIVORAL",36,0)
 S P("FC")="VOLUME^"_$P($G(TDRG("OLD",DRG)),U,2)_$S($G(TDRG("OLD",DRG))]"":" ("_$P($G(^PS(52.7,DRG,0)),U)_")",1:"")_U_$P($G(TDRG("NEW",DRG)),U,2)_$S($G(TDRG("NEW",DRG))]"":" ("_$P($G(^PS(52.7,DRG,0)),U)_")",1:"") D GTFC
"RTN","PSIVORAL",37,0)
 Q
"RTN","PSIVORAL",38,0)
 ;
"RTN","PSIVORAL",39,0)
GTFC ; Create field change entry in activity log.
"RTN","PSIVORAL",40,0)
 N TXTCNT,TXTLN
"RTN","PSIVORAL",41,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,"A",PSIVLN,1,0)) S:ND="" ND="^55.151^^" S $P(ND,U,3)=$P(ND,U,3)+1,$P(ND,U,4)=$P(ND,U,4)+1,^PS(55,DFN,"IV",+ON55,"A",PSIVLN,1,0)=ND,^PS(55,DFN,"IV",+ON55,"A",PSIVLN,1,$P(ND,U,3),0)=P("FC") K ND
"RTN","PSIVORAL",42,0)
 I $P(P("FC"),U)="OTHER PRINT INFO" D
"RTN","PSIVORAL",43,0)
 .S TXTLN=0 F TXTCNT=0:1 S TXTLN=$O(^PS(55,DFN,"IV",+ON55,10,TXTLN)) Q:'TXTLN  S ^PS(55,DFN,"IV",+ON55,"A",PSIVLN,2,TXTLN,0)=$G(^PS(55,DFN,"IV",+ON55,10,TXTLN,0))
"RTN","PSIVORAL",44,0)
 .I TXTCNT S ^PS(55,DFN,"IV",+ON55,"A",PSIVLN,2,0)="^"_+TXTCNT_"^"_+TXTCNT
"RTN","PSIVORAL",45,0)
 .S TXTLN=0 F TXTCNT=0:1 S TXTLN=$O(^PS(53.45,+$G(PSJSYSP),6,TXTLN)) Q:'TXTLN  S ^PS(55,DFN,"IV",+ON55,"A",PSIVLN,3,TXTLN,0)=$G(^PS(53.45,+$G(PSJSYSP),6,TXTLN,0))
"RTN","PSIVORAL",46,0)
 .I TXTCNT S ^PS(55,DFN,"IV",+ON55,"A",PSIVLN,3,0)="^"_+TXTCNT_"^"_+TXTCNT S ^PS(53.45,+$G(PSJSYSP),6)=PSIVLN
"RTN","PSIVORAL",47,0)
 .N ACNT,AND S ACNT=+$O(^PS(55,DFN,"IV",+ON55,"A",""),-1) I ACNT S AND="^55.04^"_+ACNT_"^"_+ACNT,^PS(55,DFN,"IV",+ON55,"A",0)=AND
"RTN","PSIVORAL",48,0)
 K ND
"RTN","PSIVORAL",49,0)
 Q
"RTN","PSIVORAL",50,0)
LOG ; Update activity log (ask for comment.)
"RTN","PSIVORAL",51,0)
 I $G(P("FC"))["OTHER PRINT INFO" Q:$G(^PS(53.45,+$G(PSJSYSP),6))
"RTN","PSIVORAL",52,0)
 N ON S ON=ON55
"RTN","PSIVORAL",53,0)
 ;PSJPINIT is defined in PSJUTL3.
"RTN","PSIVORAL",54,0)
 S:+$G(PSJPINIT)'>0 PSJPINIT=DUZ
"RTN","PSIVORAL",55,0)
 I $G(PSIVALT)=1,'$G(PSJUNDC) K DA,DIR S DIR(0)="55.04,.04" D ^DIR K DA,DIR S PSIVAL=$S($D(DIRUT):"",1:Y)
"RTN","PSIVORAL",56,0)
 S:$G(PSIVALT)=2 PSIVAL="Action taken using OE/RR options." D ENTACT^PSIVAL
"RTN","PSIVORAL",57,0)
 K TMP
"RTN","PSIVORAL",58,0)
 S TMP(55.04,""_PSIVLN_","_+ON55_","_DFN_","_"",.02)=PSIVREA
"RTN","PSIVORAL",59,0)
 S TMP(55.04,""_PSIVLN_","_+ON55_","_DFN_","_"",.03)=$P(^VA(200,PSJPINIT,0),U)
"RTN","PSIVORAL",60,0)
 S TMP(55.04,""_PSIVLN_","_+ON55_","_DFN_","_"",.04)=$G(PSIVAL)
"RTN","PSIVORAL",61,0)
 S TMP(55.04,""_PSIVLN_","_+ON55_","_DFN_","_"",.06)=PSJPINIT
"RTN","PSIVORAL",62,0)
 D FILE^DIE("","TMP")
"RTN","PSIVORAL",63,0)
 K TMP
"RTN","PSIVORAL",64,0)
 D:$D(PSIVALCK) @PSIVALCK K PSIVALT,PSIVALCK,PSIVAL
"RTN","PSIVORAL",65,0)
 Q
"RTN","PSIVORAL",66,0)
 ;
"RTN","PSIVORAL",67,0)
OPI ; Record changes to Other print info.
"RTN","PSIVORAL",68,0)
 I $$DIFFOPI^PSJBCMA5(DFN,ON55) S P("FC")="OTHER PRINT INFO^^" D GTFC
"RTN","PSIVORAL",69,0)
 Q
"RTN","PSIVORC2")
0^65^B59003278^B56200056
"RTN","PSIVORC2",1,0)
PSIVORC2 ;BIR/MLM-PROCESS INCOMPLETE IV ORDER - CONT ;22 OCT 97 / 3:16 PM
"RTN","PSIVORC2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**29,49,50,65,58,85,101,110,127,151,181,267**;16 DEC 97;Build 158
"RTN","PSIVORC2",3,0)
 ;
"RTN","PSIVORC2",4,0)
 ; Reference to ^ORD(101 is supported by DBIA #872
"RTN","PSIVORC2",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178
"RTN","PSIVORC2",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSIVORC2",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVORC2",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173.
"RTN","PSIVORC2",9,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSIVORC2",10,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVORC2",11,0)
 ;
"RTN","PSIVORC2",12,0)
EDCHK ;Update or create new order in 55.
"RTN","PSIVORC2",13,0)
 D CKORD D:'$G(PSJIVORF) ORPARM^PSIVOREN I 'PSJIVORF W !,"Either the Inpatient Medications or the IV Medications package is not on, please check the Order Parameters file" Q
"RTN","PSIVORC2",14,0)
 I PSIVCHG,PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) W $C(7),"Order unchanged" Q
"RTN","PSIVORC2",15,0)
 S:PSIVCHG P("21FLG")=""
"RTN","PSIVORC2",16,0)
 I $G(PSJCOM) D IV^PSJCOMV Q
"RTN","PSIVORC2",17,0)
 Q:$$NONVF()
"RTN","PSIVORC2",18,0)
ACTIVE ;
"RTN","PSIVORC2",19,0)
 S PSJCOM=P("PRNTON")
"RTN","PSIVORC2",20,0)
 I PSJCOM D VFYIV^PSJCOMV Q
"RTN","PSIVORC2",21,0)
 S P("RES")=$P($G(^PS(53.1,+ON,0)),U,24)
"RTN","PSIVORC2",22,0)
 I P("RES")="R" S P("NEWON")=P("OLDON") S PSJOSTOP="" D
"RTN","PSIVORC2",23,0)
 .N PSJTROPI,PSJNVO S PSJNVO=$G(P("NEWON")) I (PSJNVO["P") D FILEOPI^PSJBCMA5(DFN,PSJNVO) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,PSJNVO) Q
"RTN","PSIVORC2",24,0)
 .I ($G(P("PON"))["P"),($G(ON55)=P("PON")) S PSJNVO=P("PON") D FILEOPI^PSJBCMA5(DFN,PSJNVO) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,PSJNVO)
"RTN","PSIVORC2",25,0)
 .D FILEOPI^PSJBCMA5(DFN,P("NEWON")) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,ON55)
"RTN","PSIVORC2",26,0)
 .D RUPDATE^PSIVOREN(DFN,ON,P(2)) I $P($G(^PS(53.45,+$G(PSJSYSP),6,0)),"^",3)
"RTN","PSIVORC2",27,0)
 I P("RES")'="R" S PSJORD=ON,P(17)="A",ORSTS=6,PSJORNP=P(6) D SETNEW^PSIVORFB S P("NEWON")=ON55 D @$S(PSIVCHG:"NEWORD",1:"OLDORD")
"RTN","PSIVORC2",28,0)
 I $G(PSJIOPIV) D MVOPI^PSJBCMA5($G(DFN),$G(PSJORD),$G(ON55)),MVOPIAL^PSJBCMA5($G(DFN),$G(PSJORD),$G(ON55))
"RTN","PSIVORC2",29,0)
 S (ON55,ON)=P("NEWON"),OD=P(2) D EN^PSIVORE
"RTN","PSIVORC2",30,0)
 D VF1^PSJLIACT("F","ORDER VERIFIED BY ",1)
"RTN","PSIVORC2",31,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"N")
"RTN","PSIVORC2",32,0)
 I $G(^PS(55,DFN,"IV",+ON55,4)) D EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSIVORC2",33,0)
 L -^PS(53.1,+$G(PSJORD)) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVORC2",34,0)
 Q
"RTN","PSIVORC2",35,0)
 ;
"RTN","PSIVORC2",36,0)
CKORD ;Check if new order is to be created.
"RTN","PSIVORC2",37,0)
 I $G(PSIVCOPY) S PSIVCHG=0 Q
"RTN","PSIVORC2",38,0)
 N ND,PSJCHG S PSIVCHG=0,ND(0)=$G(^PS(53.1,+ON,0)),ND("PD")=$G(^PS(53.1,+ON,.2))_U_$P(ND(0),U,3)
"RTN","PSIVORC2",39,0)
 N X S X=$P($G(^PS(53.1,+ON,8)),U,5),X=$S(P(8)["@":$P(X,"@"),1:X)
"RTN","PSIVORC2",40,0)
 S ND=$S($E(P("OT"))="I":P(8)_U_$P(ND(0),U,3)_U_+$P(ND("PD"),U),1:X_U_+P("MR")_U_+P("PD"))
"RTN","PSIVORC2",41,0)
 S ND=ND_U_$S($P(ND(0),U,2)=+P("CLRK"):+$P(ND(0),U,2),1:+P(6))
"RTN","PSIVORC2",42,0)
 I ND'=($S($E(P("OT"))="I":P(8),P(8)["@":$P(P(8),"@"),1:P(8))_U_+P("MR")_U_+P("PD")_U_+P(6)) S PSIVCHG=1
"RTN","PSIVORC2",43,0)
 I 'PSIVCHG I $P($G(^PS(53.1,+ON,2)),U)'=P(9) S:($G(P("DTYP"))'=1) PSIVDSFG=1 S PSIVCHG=1
"RTN","PSIVORC2",44,0)
 N ND,TDRG,TMPDRG
"RTN","PSIVORC2",45,0)
 Q:PSIVCHG
"RTN","PSIVORC2",46,0)
 D TMPDRG1^PSJMISC(DFN,$G(ON),.TMPDRG)
"RTN","PSIVORC2",47,0)
 I $$COMPARE^PSJMISC(.DRG,.TMPDRG,$S(P("DTYP")=1:0,1:1)) S PSIVCHG=1
"RTN","PSIVORC2",48,0)
 K TMPDRG
"RTN","PSIVORC2",49,0)
 Q:PSIVCHG
"RTN","PSIVORC2",50,0)
 Q
"RTN","PSIVORC2",51,0)
CKPC ;
"RTN","PSIVORC2",52,0)
 ;PSJ*5*181 Note - No longer use by *181
"RTN","PSIVORC2",53,0)
 ;
"RTN","PSIVORC2",54,0)
 Q:PSIVCHG  I $E(P("OT"))'="I" D
"RTN","PSIVORC2",55,0)
 .;
"RTN","PSIVORC2",56,0)
 .; Check IV drugs for changes.
"RTN","PSIVORC2",57,0)
 .S DNE=0 F DRGT="AD","SOL" I $D(DRG(DRGT)) S FIL="52."_$S(DRGT="AD":6,1:7) D
"RTN","PSIVORC2",58,0)
 ..N ND,TDRG F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI!DNE  S TDRG(+$P(DRG(DRGT,DRGI),U),DRGI)=DRGI,TDRG("CNT")=+$G(TDRG("CNT"))+1
"RTN","PSIVORC2",59,0)
 ..F ON1=0:0 S ON1=$O(^PS(53.1,+ON,DRGT,ON1)) Q:'+ON1!DNE  S ND=$G(^PS(53.1,+ON,DRGT,ON1,0)),ND("CNT")=$G(ND("CNT"))+1 D
"RTN","PSIVORC2",60,0)
 ...S DRG=+$P(ND,U) S:'$D(TDRG(+DRG)) (DNE,PSIVCHG)=1 F DRGI=0:0 S DRGI=$O(TDRG(+DRG,DRGI)) Q:'DRGI!DNE  I $P($G(DRG(DRGT,DRGI)),U)_U_$P($G(DRG(DRGT,DRGI)),U,3)'=$P(ND,U,1,2) S (DNE,PSIVCHG)=1
"RTN","PSIVORC2",61,0)
 ..S:$G(ND("CNT"))'=$G(TDRG("CNT")) (DNE,PSIVCHG)=1 K ND,TDRG
"RTN","PSIVORC2",62,0)
 Q
"RTN","PSIVORC2",63,0)
 ;
"RTN","PSIVORC2",64,0)
OLDORD ; Update old order, update order links.
"RTN","PSIVORC2",65,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",66,0)
 S P("OLDON")=$P($G(^PS(53.1,+ON,0)),U,25) I P("OLDON")'=ON55 S $P(^PS(55,DFN,"IV",+ON55,2),U,8)=P("RES"),$P(^(2),U,5)=P("OLDON") I P("OLDON") D
"RTN","PSIVORC2",67,0)
 .I P("OLDON")["V",$D(^PS(55,DFN,"IV",+P("OLDON"),0)) S $P(^(2),U,6)=ON55,$P(^(2),U,9)=P("RES")
"RTN","PSIVORC2",68,0)
 .I P("OLDON")["A",$D(^PS(55,DFN,5,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",69,0)
 .I $S(P("OLDON")["P":1,P("OLDON")["N":1,1:0),$D(^PS(53.1,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",70,0)
 D PUT531^PSIVORFA S $P(^PS(53.1,+ON,0),U,25,26)="^",ON=ON55 D UPD100^PSIVORFA
"RTN","PSIVORC2",71,0)
 Q
"RTN","PSIVORC2",72,0)
 ;
"RTN","PSIVORC2",73,0)
NEWORD ; Create new order, update order links.
"RTN","PSIVORC2",74,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",75,0)
 S $P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",76,0)
 S P("NEWON")=$P($G(^PS(53.1,+PSJORD,0)),U,26),$P(^PS(55,DFN,"IV",+P("NEWON"),2),U,5)=PSJORD,$P(^(2),U,8)="E",ON=ON55
"RTN","PSIVORC2",77,0)
 I PSJIVORF D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORC2",78,0)
 Q
"RTN","PSIVORC2",79,0)
 ;
"RTN","PSIVORC2",80,0)
GTIVDRG ; Try to find an IV drug from the Orderable Item.
"RTN","PSIVORC2",81,0)
 ; If there is only 1 match to OI then stuff in DRG otherwise prompt user to select which
"RTN","PSIVORC2",82,0)
 ; ad/sol matched to OI
"RTN","PSIVORC2",83,0)
 K PSIVOI NEW FIL,ND,SCR,PSJNOW
"RTN","PSIVORC2",84,0)
 D NOW^%DTC S PSJNOW=%
"RTN","PSIVORC2",85,0)
 S SCR("S")="S ND=$P($G(^(""I"")),U) I ND=""""!(ND>PSJNOW)"
"RTN","PSIVORC2",86,0)
 F FIL=52.6,52.7 D FIND^DIC(FIL,,"@;.01;2","QXP",+P("PD"),,"AOI",SCR("S"),,"PSIVOI") I +PSIVOI("DILIST",0)>0 D  Q
"RTN","PSIVORC2",87,0)
 . S DRGT=$S(FIL=52.6:"AD",1:"SOL"),PSIVOI=DRGT
"RTN","PSIVORC2",88,0)
 . I PSIVOI="AD" D
"RTN","PSIVORC2",89,0)
 .. N XX,XXX,QC S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S XXX=+PSIVOI("DILIST",XX,0) D LIST^DIC(52.61,","_XXX_",","@;.01","PQ",,,,,,,"PSIVQC") D
"RTN","PSIVORC2",90,0)
 ... I +$G(PSIVQC("DILIST",0))>0 S QC=0 F  S QC=$O(PSIVQC("DILIST",QC)) Q:QC=""  S PSIVOI("DILIST",XX,QC,0)=PSIVQC("DILIST",QC,0)
"RTN","PSIVORC2",91,0)
 ... K PSIVQC("DILIST",0),PSIVQC("DILIST",0,"MAP")
"RTN","PSIVORC2",92,0)
 .. D RESET
"RTN","PSIVORC2",93,0)
 . I +PSIVOI("DILIST",0)=1 D
"RTN","PSIVORC2",94,0)
 .. S DRG=+PSIVOI("DILIST",1,0)
"RTN","PSIVORC2",95,0)
 .. S DNE=1,DRG(DRGT,0)=1,ND=$G(^PS(FIL,+DRG,0)),DRG(DRGT,1)=+DRG_U_$P(ND,U)_U_$S(FIL=52.7:$P(ND,U,3),1:"")_U_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORC2",96,0)
 K:+PSIVOI("DILIST",0)<2 PSIVOI
"RTN","PSIVORC2",97,0)
 Q
"RTN","PSIVORC2",98,0)
 ;
"RTN","PSIVORC2",99,0)
EDIT ; Edit incomplete order
"RTN","PSIVORC2",100,0)
 K PSIVENO
"RTN","PSIVORC2",101,0)
 S PSIVAC="CE"
"RTN","PSIVORC2",102,0)
 I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) D GTIVDRG
"RTN","PSIVORC2",103,0)
 I P(4)="" D 53^PSIVORC1 Q:P(4)=""  D ^PSIVORV2
"RTN","PSIVORC2",104,0)
 D GSTRING^PSIVORE1,GTFLDS^PSIVORFE ;S (PSIVOK,EDIT)="57^58^59^3"_$S(P("DTYP")=1:"^26^39",1:"")_"^63^64^"_$S($E(P("OT"))="I":"101^109^",1:"")_"10^25"_$S(+P(6)'=+P("CLRK"):"^1",1:"") D GTFLDS^PSIVORFE
"RTN","PSIVORC2",105,0)
 Q:$G(DONE)
"RTN","PSIVORC2",106,0)
 I '$G(PSIVENO) S PSIVENO=1 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q"
"RTN","PSIVORC2",107,0)
 Q
"RTN","PSIVORC2",108,0)
 ;
"RTN","PSIVORC2",109,0)
FINISH ; Ask only for missing data in incomplete IV order.
"RTN","PSIVORC2",110,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI")) I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG
"RTN","PSIVORC2",111,0)
 D:P(4)="" 53^PSIVORC1 Q:P(4)=""  S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORC2",112,0)
 I 'P(2) D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y
"RTN","PSIVORC2",113,0)
 I 'P(3) D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSIVORC2",114,0)
 I 'P("MR") S P("MR")=$O(^PS(51.2,"B","INTRAVENOUS",0))_"^IV"
"RTN","PSIVORC2",115,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 D:EDIT]"" EDIT^PSIVEDT G COMPLTE^PSIVORC1
"RTN","PSIVORC2",116,0)
 Q
"RTN","PSIVORC2",117,0)
NONVF() ; Updated 53.1 status to non-verified after finish.
"RTN","PSIVORC2",118,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVORC2",119,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVORC2",120,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVORC2",121,0)
 I PSIVCHG D NWNONVF Q 1
"RTN","PSIVORC2",122,0)
 S P(17)="N",P("REN")=0
"RTN","PSIVORC2",123,0)
 D GTPD^PSIVORE2
"RTN","PSIVORC2",124,0)
 W !,"...transcribing this non-verified order...."
"RTN","PSIVORC2",125,0)
 S $P(^PS(53.1,+ON,.2),U)=""
"RTN","PSIVORC2",126,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",127,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",128,0)
 I ($G(PSJINFIN)=2) D NEWNVAL^PSGAL5(ON,6000,"OTHER PRINT INFO")
"RTN","PSIVORC2",129,0)
 NEW PSIVORFA S PSIVORFA=1 D:ON["V" DEL55^PSIVORE2
"RTN","PSIVORC2",130,0)
 D EN1^PSJHL2(DFN,"XX",ON,"UPDATED ORDER")
"RTN","PSIVORC2",131,0)
 D VF
"RTN","PSIVORC2",132,0)
 Q 1
"RTN","PSIVORC2",133,0)
NWNONVF ;Create non-verified due to edit
"RTN","PSIVORC2",134,0)
 K DA D ENGNN^PSGOETO S P("NEWON")=DA_"P",P(17)="N",P("REN")=0
"RTN","PSIVORC2",135,0)
 I $D(^PS(53.45,PSJSYSP,6,1)) D FILEOPI^PSJBCMA5(DFN,P("NEWON"))
"RTN","PSIVORC2",136,0)
 S PSJORD=ON,$P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",137,0)
 S P("OLDON")=ON,ON=P("NEWON")
"RTN","PSIVORC2",138,0)
 I $D(^PS(53.1,+P("OLDON"),12)) M ^PS(53.1,+P("NEWON"),12)=^PS(53.1,+P("OLDON"),12)
"RTN","PSIVORC2",139,0)
 S P("RES")="E"
"RTN","PSIVORC2",140,0)
 S P("DO")="" D GTPD^PSIVORE2 ;Get dosage order if not defined for IPM IV
"RTN","PSIVORC2",141,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",142,0)
 S $P(^PS(53.1,+ON,0),U,25,26)=P("OLDON")_U_""
"RTN","PSIVORC2",143,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",144,0)
 D EN1^PSJHL2(DFN,"SN",ON,"SEND ORDER NUMBER")
"RTN","PSIVORC2",145,0)
 S:$D(PSGP)#10 PSJNOL=$$LS^PSSLOCK(PSGP,ON)
"RTN","PSIVORC2",146,0)
 D VF
"RTN","PSIVORC2",147,0)
 Q
"RTN","PSIVORC2",148,0)
VF ; Display Verify screen
"RTN","PSIVORC2",149,0)
 Q:ON'["P"
"RTN","PSIVORC2",150,0)
 K PSJIVBD
"RTN","PSIVORC2",151,0)
 D GT531^PSIVORFA(DFN,ON)
"RTN","PSIVORC2",152,0)
 S PSGACT="EL"
"RTN","PSIVORC2",153,0)
 I P(17)="N",(P("OLDON")=""),(+P("CLRK")=DUZ) S PSGACT="ELD"
"RTN","PSIVORC2",154,0)
 I +PSJSYSU=3!(+PSJSYSU=1) S PSGACT="DELV"
"RTN","PSIVORC2",155,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSIVORC2",156,0)
 I P("OT")="I" S PSJSTAR="(1)^(5)^(7)^(9)^(10)"
"RTN","PSIVORC2",157,0)
 I P("OT")'="I" S PSJSTAR="(1)^(2)^(3)^(5)^(7)^(9)"
"RTN","PSIVORC2",158,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSIVORC2",159,0)
 Q
"RTN","PSIVORC2",160,0)
 ;
"RTN","PSIVORC2",161,0)
RESET ;Reset PSIVOI("DILIST") for additives with quick codes
"RTN","PSIVORC2",162,0)
 N XX,XXX,CNT S CNT=0
"RTN","PSIVORC2",163,0)
 S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S CNT=CNT+1,LYN(CNT)=PSIVOI("DILIST",XX,0) D
"RTN","PSIVORC2",164,0)
 . S XXX=0 F  S XXX=$O(PSIVOI("DILIST",XX,XXX)) Q:XXX=""  S CNT=CNT+1,LYN(CNT)=$P(PSIVOI("DILIST",XX,0),"^")_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^",2)_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^")_"^"_"QC"
"RTN","PSIVORC2",165,0)
 K PSIVOI("DILIST")
"RTN","PSIVORC2",166,0)
 S PSIVOI("DILIST",0)=CNT_"^*^0^"
"RTN","PSIVORC2",167,0)
 S XX=0 F  S XX=$O(LYN(XX)) Q:'XX  S PSIVOI("DILIST",XX,0)=LYN(XX)
"RTN","PSIVORC2",168,0)
 K LYN
"RTN","PSIVORC2",169,0)
 Q
"RTN","PSIVORFA")
0^56^B27786981^B24982662
"RTN","PSIVORFA",1,0)
PSIVORFA ;BIR/MLM-FILE/RETRIEVE ORDERS IN 53.1 ; 8/17/09 9:23am
"RTN","PSIVORFA",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,7,18,28,50,71,58,91,80,110,111,134,225,267**;16 DEC 97;Build 158
"RTN","PSIVORFA",3,0)
 ;
"RTN","PSIVORFA",4,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSIVORFA",5,0)
 ; Reference to ^PS(51.2 supported by DBIA 2178.
"RTN","PSIVORFA",6,0)
 ; Reference to ^PS(52.7 supported by DBIA 2173.
"RTN","PSIVORFA",7,0)
 ; Reference to ^PS(52.6 supported by DBIA 1231.
"RTN","PSIVORFA",8,0)
 ;
"RTN","PSIVORFA",9,0)
GT531(DFN,ON) ; Retrieve order data from 53.1 and place into local array
"RTN","PSIVORFA",10,0)
 ;
"RTN","PSIVORFA",11,0)
 NEW PSGOES S PSGOES=1
"RTN","PSIVORFA",12,0)
 F X="CUM","LF","LFA","LF","PRNTON" S P(X)=""
"RTN","PSIVORFA",13,0)
 S Y=$G(^PS(53.1,+ON,0)),P(17)=$P(Y,U,9),P("LOG")=$P(Y,U,16),(P(21),P("21FLG"),PSJORIFN)=$P(Y,U,21)
"RTN","PSIVORFA",14,0)
 S P("RES")=$P(Y,U,24),P("OLDON")=$P(Y,U,25),P("NEWON")=$P(Y,U,26),P("FRES")=$P(Y,U,27)
"RTN","PSIVORFA",15,0)
 S P("MR")=$P(Y,U,3),P(6)=+$P(Y,U,2),Y=$G(^VA(200,+P(6),0)),$P(P(6),U,2)=$P(Y,U),Y=$G(^PS(51.2,+P("MR"),0)),$P(P("MR"),U,2)=$S($P(Y,U,3)]"":$P(Y,U,3),1:$P(Y,U))
"RTN","PSIVORFA",16,0)
 S Y=$G(^PS(53.1,+ON,.2)),P("PD")=$S(+Y:$P(Y,U)_U_$$OIDF^PSJLMUT1(+Y),1:""),P("DO")=$P(Y,U,2),P("NAT")=$P(Y,U,3),P("PRY")=$P(Y,U,4),(PSJCOM,P("PRNTON"))=$P(Y,U,8)
"RTN","PSIVORFA",17,0)
 S P("INS")=$G(^PS(53.1,+ON,.3))
"RTN","PSIVORFA",18,0)
 I $G(^PS(53.1,+ON,4))]"" S P("NINIT")=$P(^(4),U),P("NINITDT")=$P(^(4),U,2)
"RTN","PSIVORFA",19,0)
 NEW NAME S NAME=""
"RTN","PSIVORFA",20,0)
 I $D(^PS(53.1,+ON,1,1)) D DD^PSJLMUT1("^PS(53.1,+ON,",.NAME)
"RTN","PSIVORFA",21,0)
 S P("INS")=P("INS")_$S(P("INS")]"":" of ",1:"")_NAME
"RTN","PSIVORFA",22,0)
 S P("APPT")=$G(^PS(53.1,+ON,"DSS")),P("CLIN")=$P(P("APPT"),"^"),P("APPT")=$P(P("APPT"),"^",2)
"RTN","PSIVORFA",23,0)
 S Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(11)=$P(Y,U,5),P(15)=$S($P(Y,U,6)'="":$P(Y,U,6),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4)
"RTN","PSIVORFA",24,0)
 S Y=$G(^PS(53.1,+ON,4)),P("CLRK")=$P(Y,U,7)_U_$P($G(^VA(200,+$P(Y,U,7),0)),U),P("REN")=$P(Y,U,9),X=P(9)
"RTN","PSIVORFA",25,0)
 I $P($G(^PS(53.1,+ON,0)),U,7)="P",(P(9)'["PRN") S P(9)=P(9)_" PRN"
"RTN","PSIVORFA",26,0)
 K PSGST,XT
"RTN","PSIVORFA",27,0)
 ;PSJ*5*225 remove 1440 default
"RTN","PSIVORFA",28,0)
 I P(9)]"",P(9)'["PRN",(P(11)="") D  S P(15)=$S($G(XT)]""&'+$G(XT):XT,+$G(XT)>0:XT,$G(PSGS0XT):PSGS0XT,1:1440),P(11)=Y
"RTN","PSIVORFA",29,0)
 . I $O(^PS(51.1,"APPSJ",P(9),0)) D DIC^PSGORS0 Q
"RTN","PSIVORFA",30,0)
 . I '$O(^PS(51.1,"APPSJ",P(9),0)) N NOECH,PSGSCH S NOECH=1 D EN^PSIVSP
"RTN","PSIVORFA",31,0)
 S Y=$G(^PS(53.1,+ON,8)),P(4)=$P(Y,U),P(23)=$P(Y,U,2),P("SYRS")=$P(Y,U,3),P(5)=$P(Y,U,4),P(8)=$P(Y,U,5),P(7)=$P(Y,U,7),P("IVRM")=$P(Y,U,8)
"RTN","PSIVORFA",32,0)
 S P(4)=$S(P(4)'="":P(4),$G(PSIVTYPE):PSIVTYPE,1:"")
"RTN","PSIVORFA",33,0)
 S:'P("IVRM")&($D(PSIVSN)) P("IVRM")=+PSIVSN S Y=$G(^PS(59.5,+P("IVRM"),0)),$P(P("IVRM"),U,2)=$P(Y,U),Y=$G(^PS(53.1,+ON,9)),P("REM")=$P(Y,U),P("OPI")=$P(Y,U,2,3)
"RTN","PSIVORFA",34,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFA",35,0)
 S P("PACT")=$G(^PS(53.1,+ON,"A",1,0))
"RTN","PSIVORFA",36,0)
 D GTDRG,GTOT^PSIVUTL(P(4)) D:'$D(PSJLABEL) GTPC(ON)
"RTN","PSIVORFA",37,0)
 N ND2P5 S ND2P5=$G(^PS(53.1,+ON,2.5)) D
"RTN","PSIVORFA",38,0)
 .S P("DUR")=$P(ND2P5,"^",2)
"RTN","PSIVORFA",39,0)
 .S P("LIMIT")=$P(ND2P5,"^",4)
"RTN","PSIVORFA",40,0)
 .S P("IVCAT")=$P(ND2P5,"^",5)
"RTN","PSIVORFA",41,0)
 N LONGOPI S LONGOPI=$$GETOPI^PSJBCMA5(DFN,ON)
"RTN","PSIVORFA",42,0)
 Q
"RTN","PSIVORFA",43,0)
GTDRG ;
"RTN","PSIVORFA",44,0)
 K DRG F X="AD","SOL" S FIL=$S(X="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(53.1,+ON,X,Y)) Q:'Y  D
"RTN","PSIVORFA",45,0)
 .S (DRGI,DRG(X,0))=$G(DRG(X,0))+1,DRG=$G(^PS(53.1,+ON,X,Y,0)),ND=$G(^PS(FIL,+DRG,0)),DRGN=$P(ND,U),DRG(X,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFA",46,0)
 Q
"RTN","PSIVORFA",47,0)
 ;
"RTN","PSIVORFA",48,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFA",49,0)
 Q
"RTN","PSIVORFA",50,0)
 ;
"RTN","PSIVORFA",51,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSIVORFA",52,0)
 S:'$D(P(9)) P(9)=$G(PSGSCH)
"RTN","PSIVORFA",53,0)
 S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSIVORFA",54,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON"))
"RTN","PSIVORFA",55,0)
 S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_$S($G(P(15))'="":P(15),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSIVORFA",56,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7)_"^"_+P("IVRM"),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"") S $P(ND(4),U,1,2)=$G(P("NINIT"))_U_$G(P("NINITDT"))
"RTN","PSIVORFA",57,0)
 S:+$G(P("CLIN")) $P(^PS(53.1,+ON,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFA",58,0)
 S:+$G(P("APPT")) $P(^PS(53.1,+ON,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFA",59,0)
 S:$G(P("LIMIT"))]"" $P(^PS(53.1,+ON,2.5),"^",4)=P("LIMIT")
"RTN","PSIVORFA",60,0)
 I $G(PSJORD)["V"!($G(PSJORD)["P") I $G(^PS(53.1,+ON,2.5))="" N DUR S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S((PSJORD["P"):"P",1:"IV"),1) I DUR]"" D
"RTN","PSIVORFA",61,0)
 .I $G(IVLIMIT) S $P(^PS(53.1,+ON,2.5),"^",4)=DUR K IVLIMIT Q
"RTN","PSIVORFA",62,0)
 .S $P(^PS(53.1,+ON,2.5),"^",2)=DUR
"RTN","PSIVORFA",63,0)
 F X=0,2,4,8,9 S ^PS(53.1,+ON,X)=ND(X)
"RTN","PSIVORFA",64,0)
 S PSIVCAT=$$IVCAT^PSJHLU(DFN,ON,.P) S:PSIVCAT]"" $P(^PS(53.1,+ON,2.5),"^",5)=PSIVCAT K PSIVCAT
"RTN","PSIVORFA",65,0)
 S:'+$G(^PS(53.1,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSIVORFA",66,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSIVORFA",67,0)
 K DA,DIK S PSGS0Y=P(11),PSGS0XT=P(15),DA=+ON,DIK="^PS(53.1," D IX^DIK K DA,DIK,PSGS0Y,PSGS0XT,ND,^PS(53.1,"AS","P",DFN,+ON)
"RTN","PSIVORFA",68,0)
 K:P(17)="A" ^PS(53.1,"AS","N",DFN,+ON)
"RTN","PSIVORFA",69,0)
 S:P(15)="D" $P(^PS(53.1,+ON,2),U,6)="D"
"RTN","PSIVORFA",70,0)
 I $G(PSJINFIN) K PSJINFIN I $D(^PS(53.45,+$G(PSJSYSP),6)),'$D(^PS(53.1,+ON,"A")),'$D(^PS(53.1,+ON,16)) S PSJINFIN=2
"RTN","PSIVORFA",71,0)
 I $G(PSJSYSP) D
"RTN","PSIVORFA",72,0)
 .I '$D(^PS(53.45,+PSJSYSP,6)) I $G(PSJORD)["V"!($G(PSJORD)["P") I '$D(^PS(53.1,+ON,16)) N I S I=$$GETOPI^PSJBCMA5(DFN,PSJORD)
"RTN","PSIVORFA",73,0)
 .I $D(^PS(53.45,+PSJSYSP,6)) D FILEOPI^PSJBCMA5(DFN,ON)
"RTN","PSIVORFA",74,0)
 Q
"RTN","PSIVORFA",75,0)
 ;
"RTN","PSIVORFA",76,0)
UPD100 ; Update order data in file 100
"RTN","PSIVORFA",77,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF
"RTN","PSIVORFA",78,0)
 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) D SET^PSIVORFE
"RTN","PSIVORFA",79,0)
 Q
"RTN","PSIVORFA",80,0)
 ;
"RTN","PSIVORFA",81,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSIVORFA",82,0)
 K ^PS(53.1,+ON,DRGT) S ^PS(53.1,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSIVORFA",83,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFA",84,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFA",85,0)
 .S ^PS(53.1,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+ON,DRGT,+DRG,0)=Y
"RTN","PSIVORFA",86,0)
 Q
"RTN","PSIVORFB")
0^38^B83047869^B62956553
"RTN","PSIVORFB",1,0)
PSIVORFB ;BIR/MLM-FILE/RETRIEVE ORDERS IN ^PS(55 ;25 Sep 98 / 2:24 PM
"RTN","PSIVORFB",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**3,18,28,68,58,85,110,111,120,134,213,161,181,273,267**;16 DEC 97;Build 158
"RTN","PSIVORFB",3,0)
 ;
"RTN","PSIVORFB",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSIVORFB",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSIVORFB",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVORFB",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173.
"RTN","PSIVORFB",8,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSIVORFB",9,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177.
"RTN","PSIVORFB",10,0)
 ; Reference to ^PSUHL is supported by DBIA #4803.
"RTN","PSIVORFB",11,0)
 ; 
"RTN","PSIVORFB",12,0)
NEW55 ; Get new order number in 55.
"RTN","PSIVORFB",13,0)
 N DA,DD,DO,DIC,DLAYGO,X,Y,PSIVLIM,MINS,PSJDSTP1,PSJDSTP2,A,PSJCLIN,PSJDNM,PSJPROV,PSJWARD,PSJPAO,PSJALRT
"RTN","PSIVORFB",14,0)
 I ($G(PSIVAC)="PN"),$G(PSJSYSP) D KILL^PSJBCMA5(+$G(PSJSYSP))
"RTN","PSIVORFB",15,0)
 I $D(^PS(55,+DFN)),'$D(^PS(55,+DFN,0)) D ENSET0^PSGNE3(+DFN)
"RTN","PSIVORFB",16,0)
 ;*273 - Set PSIVSITE if not set.
"RTN","PSIVORFB",17,0)
 I $G(PSJORD)["V"!($G(PSJORD)["P"),$G(P(2))]"" D
"RTN","PSIVORFB",18,0)
 . I '$G(PSIVSITE) S PSIVSN=$P(P("IVRM"),"^") D ENCHK^PSIVSET
"RTN","PSIVORFB",19,0)
 . D LIMSTOP(.PSJDSTP1,.PSJDSTP2)
"RTN","PSIVORFB",20,0)
 I ($G(PSJORD)["P"!($G(PSJORD)["V"))&$G(PSIVLIM) I $$CMPLIM(PSJORD,PSJDSTP1,PSJDSTP2) D
"RTN","PSIVORFB",21,0)
 . D
"RTN","PSIVORFB",22,0)
 .. S PSJPROV=DUZ I PSJORD["P" S PSJPROV=$P($G(^PS(53.1,+PSJORD,0)),"^",2)
"RTN","PSIVORFB",23,0)
 .. I PSJORD["V" S PSJPROV=$P($G(^PS(55,DFN,"IV",+PSJORD,0)),"^",6)
"RTN","PSIVORFB",24,0)
 .. D NOW^%DTC S XQA(PSJPROV)="",XQAID="PSJ,"_DFN_";"_PSJPROV_";"_%,XQADATA=""
"RTN","PSIVORFB",25,0)
 .. D
"RTN","PSIVORFB",26,0)
 ... I PSJORD["P" S A=$G(^PS(53.1,+PSJORD,"DSS"))
"RTN","PSIVORFB",27,0)
 ... I PSJORD["V" S A=$G(^PS(55,PSGP,"IV",+PSJORD,"DSS"))
"RTN","PSIVORFB",28,0)
 ... S PSJCLIN=$P(A,"^") I PSJCLIN]"" S PSJCLIN=$P(^SC(PSJCLIN,0),"^")
"RTN","PSIVORFB",29,0)
 .. S A=$G(^DPT(DFN,0)),PSJWARD=$G(^(.1))
"RTN","PSIVORFB",30,0)
 .. S XQAMSG=$P(A,"^")_" ("_$E($P(A,"^"))_$E($P(A,"^",9),6,9)_"): ["_$S(PSJWARD]"":$E(PSJWARD,1,10),$G(PSJCLIN)]"":$E(PSJCLIN,1,10),1:"UNKNOWN")_"] "
"RTN","PSIVORFB",31,0)
 .. S A=$O(DRG("AD",0)) I A]"" S A=DRG("AD",A)
"RTN","PSIVORFB",32,0)
 .. I A="" S A=$O(DRG("SOL",0)) I A]"" S A=DRG("SOL",A)
"RTN","PSIVORFB",33,0)
 .. S PSJDNM=$P(^PS(50.7,+$P(A,"^",6),0),"^")
"RTN","PSIVORFB",34,0)
 .. S XQAMSG=XQAMSG_PSJDNM_" your DURATION not used for stop date/time"
"RTN","PSIVORFB",35,0)
 .. D SETUP^XQALERT
"RTN","PSIVORFB",36,0)
 .. S PSJALRT=$$FMTDUR^PSJLIVMD($S(PSJORD["P":$P($G(^PS(53.1,+PSJORD,2.5)),"^",4),PSJORD["IV":$P($G(^PS(55,DFN,"IV",+PSJORD,2.5)),"^",4),1:"UNK"))
"RTN","PSIVORFB",37,0)
 S DIC="^PS(55,",DIC(0)="LN",DLAYGO=55,(DINUM,X)=+DFN D ^DIC Q:Y<0
"RTN","PSIVORFB",38,0)
LOCK0 F  L +^PS(55,DFN,"IV",0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSIVORFB",39,0)
 S ND=$S($D(^PS(55,DFN,"IV",0)):^(0),1:"^55.01") F DA=$P(ND,"^",3)+1:1 W "." I '$D(^PS(55,DFN,"IV",DA)) S $P(ND,"^",3)=DA,$P(ND,"^",4)=$P(ND,"^",4)+1,^PS(55,DFN,"IV",0)=ND Q
"RTN","PSIVORFB",40,0)
 L +^PS(55,DFN,"IV",+DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) E  G LOCK0
"RTN","PSIVORFB",41,0)
 S ^PS(55,DFN,"IV",+DA,0)=+DA,^PS(55,DFN,"IV","B",+DA,+DA)=""
"RTN","PSIVORFB",42,0)
 L -^PS(55,DFN,"IV",0) S ON55=+DA_"V"
"RTN","PSIVORFB",43,0)
 I $G(PSJALRT)]"" S PSIVAL="IV LIMIT OVERRIDDEN ("_$G(PSJALRT)_"): ALERT SENT",PSIVALT="",PSIVREA="E" D
"RTN","PSIVORFB",44,0)
 .D LOG^PSIVORAL S P("LIMIT")="",P("OVRIDE")=1 K IVLIM,IVLIMIT
"RTN","PSIVORFB",45,0)
 .S $P(^PS(55,DFN,"IV",+ON55,2.5),"^",4)="" S:$G(PSJORD)["P" $P(^PS(53.1,+PSJORD,2.5),"^",4)=""
"RTN","PSIVORFB",46,0)
 .K PSIVAL,PSIVREA,PSIVALT
"RTN","PSIVORFB",47,0)
 I $G(PSIVCOPY)=1,$G(OLDON) I (OLDON["V")&(OLDON'=(+DA_"V")) D GETOPI^PSJBCMA5(DFN,OLDON)
"RTN","PSIVORFB",48,0)
 I $P($G(^PS(53.45,+$G(DUZ),6,0)),"^",3) D
"RTN","PSIVORFB",49,0)
 .N PSJTROPI,PSJNVO S PSJNVO=$G(P("NEWON")) I (PSJNVO["P") D FILEOPI^PSJBCMA5(DFN,PSJNVO) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,PSJNVO) Q
"RTN","PSIVORFB",50,0)
 .I ($G(P("PON"))["P"),($G(ON55)["V") S PSJNVO=P("PON") D FILEOPI^PSJBCMA5(DFN,PSJNVO) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,PSJNVO) Q
"RTN","PSIVORFB",51,0)
 .D FILEOPI^PSJBCMA5(DFN,ON55) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,ON55)
"RTN","PSIVORFB",52,0)
 Q
"RTN","PSIVORFB",53,0)
SET55 ; Move data from local variables to 55.
"RTN","PSIVORFB",54,0)
 I '$D(ON55) W !,"*** Can't create this order at this time ***" Q
"RTN","PSIVORFB",55,0)
 N DA,DIK,ND,PSIVACT,PSIVDUR,PSJTROPI,PSJTROPL
"RTN","PSIVORFB",56,0)
 S:'$D(P(21)) (P(21),P("21FLG"))="" S ND(0)=+ON55,P(22)=$S(VAIN(4):+VAIN(4),1:.5) F X=2:1:23 I $D(P(X)) S $P(ND(0),U,X)=P(X)
"RTN","PSIVORFB",57,0)
 S ND(.3)=$G(P("INS")),ND(2.5)="" N X S X=$S($G(PSGORD):PSGORD,1:$G(ON)) I X D
"RTN","PSIVORFB",58,0)
 .N PKG S PKG=$E(X,$L(X)) S PKG=$S(PKG="V":"""IV""",PKG="U":5,PKG="P":"P",1:"") Q:PKG=""
"RTN","PSIVORFB",59,0)
 .S PSIVDUR=$$GETDUR^PSJLIVMD(DFN,+X,$E(X,$L(X)),1) Q:PSIVDUR=""
"RTN","PSIVORFB",60,0)
 .I $G(IVLIMIT) S ND(2.5)="^^^"_PSIVDUR K IVLIMIT Q
"RTN","PSIVORFB",61,0)
 S $P(ND(0),U,17)="A",ND(1)=P("REM"),ND(3)=P("OPI"),ND(.2)=$P($G(P("PD")),U)_U_$G(P("DO"))_U_+P("MR")_U_$G(P("PRY"))_U_$G(P("NAT"))_U_U_U_$G(P("PRNTON"))
"RTN","PSIVORFB",62,0)
 F X=0,1,2.5,3,.2,.3 S ^PS(55,DFN,"IV",+ON55,X)=ND(X)
"RTN","PSIVORFB",63,0)
 ; PSJ*5*213 - if Piggyback, intermittent syringe, or
"RTN","PSIVORFB",64,0)
 ; intermittent chemotherapy, and frequency is null, attempt to
"RTN","PSIVORFB",65,0)
 ; set frequency again based on P(15),PSGS0XT, and piece 3 of ZZND if they exist.
"RTN","PSIVORFB",66,0)
 ; If this still is null, attempt to re-set based upon the schedule name.
"RTN","PSIVORFB",67,0)
 I $G(P("IVCAT"))="I"!($P($G(ND(0)),U,4)?1(1"P",1"S",1"C"))&($P($G(ND(0)),U,15)="") D
"RTN","PSIVORFB",68,0)
 . I $P($G(ND(0)),U,4)="S",$P($G(ND(0)),U,5)'=1 Q  ;Not intermittent syringe
"RTN","PSIVORFB",69,0)
 . I $P($G(ND(0)),U,4)="C",$P($G(ND(0)),U,23)?1(1"A",1"H") Q  ;Not chemo piggyback or syringe
"RTN","PSIVORFB",70,0)
 . I $P($G(ND(0)),U,4)="C",$P($G(ND(0)),U,23)="S",$P($G(ND(0)),U,5)'=1 Q  ;Not intermitent chemo syringe
"RTN","PSIVORFB",71,0)
 . S $P(^PS(55,DFN,"IV",+ON55,0),U,15)=$S($G(P(15))'="":P(15),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:$$GETFRQ($P($G(ND(0)),U,9))) K PSJFRQ,PSJSKED
"RTN","PSIVORFB",72,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,1,4)=P("LOG")_U_+P("IVRM")_U_U_P("SYRS"),$P(^(2),U,8,10)=P("RES")_U_$G(P("FRES"))_U_$S($G(VAIN(4)):+VAIN(4),1:"")
"RTN","PSIVORFB",73,0)
 S X=^PS(55,DFN,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(P("LOG"),"^"),"."),$P(X,"^",8)="A",^(0)=X D LOGDFN^PSUHL(DFN)
"RTN","PSIVORFB",74,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,11)=+P("CLRK")
"RTN","PSIVORFB",75,0)
 S:+$G(P("CLIN")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFB",76,0)
 S:+$G(P("APPT")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFB",77,0)
 S:+$G(P("NINIT")) ^PS(55,DFN,"IV",+ON55,4)=P("NINIT")_U_P("NINITDT")
"RTN","PSIVORFB",78,0)
 I '$D(^PS(53.45,PSJSYSP,6)),($G(P("NEWON"))["P") S PSJTROPI=P("NEWON") S PSJTROPL=$$GETOPI^PSJBCMA5(DFN,PSJTROPI)
"RTN","PSIVORFB",79,0)
 I $G(^PS(53.45,PSJSYSP,6))!$P($G(^PS(53.45,PSJSYSP,6,0)),"^",3) D
"RTN","PSIVORFB",80,0)
 . I $G(PSJCOM),$G(PSJCOMSI),$G(PSJORD)["V" M ^TMP("PSJOPI",$J,6)=^PS(53.45,PSJSYSP,6)
"RTN","PSIVORFB",81,0)
 . D FILEOPI^PSJBCMA5(DFN,ON55) K ^TMP("PSJOPI",$J,6)
"RTN","PSIVORFB",82,0)
 I '$G(PSIVCHG)!($G(PSJREN)&($G(PSIVCHG)=2)) I $G(P("PON")),P("PON")'=ON55 D
"RTN","PSIVORFB",83,0)
 . N X S X=$S(P("PON")["P":"^PS(53.1,+P(""PON""),12,0)",P("PON")["V"&$G(PSJREN):"^PS(55,DFN,""IV"",+P(""PON""),5,0)",1:"") Q:X=""
"RTN","PSIVORFB",84,0)
 . I $O(@X) S %X=X,%Y="^PS(55,"_DFN_",""IV"","_+ON55_",5," D %XY^%RCR
"RTN","PSIVORFB",85,0)
 F DRGT="AD","SOL" D PUTD55
"RTN","PSIVORFB",86,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK
"RTN","PSIVORFB",87,0)
 I $G(PSJCOM),$G(PSJCOMSI),$G(PSJORD)["V" K PSJCOMSI N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSIVORFB",88,0)
 . N PSJCHILD S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  S PSJCHILD(+PSJCHILD)=PSJCOM
"RTN","PSIVORFB",89,0)
 . S PSJCHILD=0 F  S PSJCHILD=$O(PSJCHILD(PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSIVORFB",90,0)
 .. Q:PSJCHILD=PSJORD  K DR,DA,DIE,ORD S DR="31////"_$P($G(P("OPI")),"^",1,2),DA(1)=DFN
"RTN","PSIVORFB",91,0)
 .. N ON,ON55 S (ON,ON55)=+PSJCHILD_"V" S:+$G(PSJPINIT)'>0 PSJPINIT=DUZ S PSIVALT=1,PSIVAL="COMPLEX ORDER" D ENTACT^PSIVAL D
"RTN","PSIVORFB",92,0)
 ... I $P($G(^PS(55,DFN,"IV",+ON55,3)),"^")'=$P(P("OPI"),"^") S P("FC")="OTHER PRINT INFO^"_$P($G(^(3)),"^")_U_$P(P("OPI"),"^") D GTFC^PSIVORAL
"RTN","PSIVORFB",93,0)
 ... I $D(^PS(55,DFN,"IV",+ON55,0)) S ^PS(55,DFN,"IV",+ON55,3)=P("OPI") D EN1^PSJHL2(DFN,"XX",ON55)
"RTN","PSIVORFB",94,0)
 ... M ^PS(55,DFN,"IV",+ON55,10)=^TMP("PSJOPI",$J,6)
"RTN","PSIVORFB",95,0)
 K ^TMP("PSJOPI",$J)
"RTN","PSIVORFB",96,0)
 Q
"RTN","PSIVORFB",97,0)
 ;
"RTN","PSIVORFB",98,0)
PUTD55 ; Move drug data from local array into 55
"RTN","PSIVORFB",99,0)
 K ^PS(55,DFN,"IV",+ON55,DRGT) S ^PS(55,DFN,"IV",+ON55,DRGT,0)=$S(DRGT="AD":"^55.02PA",1:"^55.11IPA")
"RTN","PSIVORFB",100,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFB",101,0)
 .S Y=^PS(55,DFN,"IV",+ON55,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFB",102,0)
 .S ^PS(55,DFN,"IV",+ON55,DRGT,0)=Y,Y=$P(DRG(DRGT,X),U)_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(55,DFN,"IV",+ON55,DRGT,+DRG,0)=Y
"RTN","PSIVORFB",103,0)
 Q
"RTN","PSIVORFB",104,0)
GT55 ; Retrieve data from 55 into local array
"RTN","PSIVORFB",105,0)
 K DRG,DRGN,P S:'$D(ON55) ON55=ON S P("REN")="",Y=$G(^PS(55,DFN,"IV",+ON55,0)) F X=1:1:25 S P(X)=$P(Y,U,X)
"RTN","PSIVORFB",106,0)
 S P("21FLG")=P(21)
"RTN","PSIVORFB",107,0)
 S P("PON")=ON55,PSJORIFN=P(21),P(6)=P(6)_U_$P($G(^VA(200,+P(6),0)),U),(DRG,DRGN)="",P("REM")=$G(^PS(55,DFN,"IV",+ON55,1))
"RTN","PSIVORFB",108,0)
 S Y=$G(^PS(55,DFN,"IV",+ON55,2)),P("LOG")=$P(Y,U),P("IVRM")=$P(Y,U,2)_U_$P($G(^PS(59.5,+$P(Y,U,2),0)),U)
"RTN","PSIVORFB",109,0)
 S P("CLRK")=$P(Y,U,11)_U_$P($G(^VA(200,+$P(Y,U,11),0)),U),P("RES")=$P(Y,U,8),P("FRES")=$P(Y,U,9),P("SYRS")=$P(Y,U,4),P("OPI")=$G(^PS(55,DFN,"IV",+ON55,3))
"RTN","PSIVORFB",110,0)
 S P("INS")=$G(^PS(55,DFN,"IV",+ON55,.3))
"RTN","PSIVORFB",111,0)
 S P("CLIN")=$P($G(^PS(55,DFN,"IV",+ON55,"DSS")),"^"),P("APPT")=$P($G(^PS(55,DFN,"IV",+ON55,"DSS")),"^",2)
"RTN","PSIVORFB",112,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFB",113,0)
 D:'$D(PSJLABEL) GTPC(ON55) S ND=$G(^PS(55,DFN,"IV",+ON55,.2)),P("PD")=$S($P(ND,U):$P(ND,U)_U_$$OIDF^PSJLMUT1(+ND)_U_$P($G(^PS(50.7,+ND,0)),U),1:""),P("DO")=$P(ND,U,2),P("PRY")=$P(ND,U,4),P("NAT")=$P(ND,U,5),(PSJCOM,P("PRNTON"))=$P(ND,U,8)
"RTN","PSIVORFB",114,0)
 I P("PRY")="D",'+P("IVRM") S P("IVRM")=+$G(PSIVSN)_U_$P($G(^PS(59.5,+$G(PSIVSN),0)),U)
"RTN","PSIVORFB",115,0)
 S P("MR")=$P(ND,U,3),ND=$G(^PS(51.2,+P("MR"),0)),P("MR")=P("MR")_U_$S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U)) D GTCUM
"RTN","PSIVORFB",116,0)
 D GTDRG,GTOT^PSIVUTL(P(4))
"RTN","PSIVORFB",117,0)
 N ND2P5 S ND2P5=$G(^PS(55,DFN,"IV",+ON55,2.5)) D
"RTN","PSIVORFB",118,0)
 .S P("DUR")=$P(ND2P5,"^",2)
"RTN","PSIVORFB",119,0)
 .S P("LIMIT")=$P(ND2P5,"^",4)
"RTN","PSIVORFB",120,0)
 .S P("IVCAT")=$P(ND2P5,"^",5)
"RTN","PSIVORFB",121,0)
K ; Kill and exit.
"RTN","PSIVORFB",122,0)
 K FIL,ND
"RTN","PSIVORFB",123,0)
 Q
"RTN","PSIVORFB",124,0)
GTDRG ; Get drug info and place in DRG(.
"RTN","PSIVORFB",125,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,DFN,"IV",+ON55,DRGT,Y)) Q:'Y  D
"RTN","PSIVORFB",126,0)
 .; naked ref below refers to line above
"RTN","PSIVORFB",127,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,DRG(DRGT,0))=$G(DRG(DRGT,0))+1
"RTN","PSIVORFB",128,0)
 .S DRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFB",129,0)
 Q
"RTN","PSIVORFB",130,0)
 ;
"RTN","PSIVORFB",131,0)
GTCUM ; Retrieve dispensing info.
"RTN","PSIVORFB",132,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,9)),P("LF")=$P(ND,U),P("LFA")=$P(ND,U,2),P("CUM")=$P(ND,U,3)
"RTN","PSIVORFB",133,0)
 Q
"RTN","PSIVORFB",134,0)
 ;
"RTN","PSIVORFB",135,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFB",136,0)
 Q
"RTN","PSIVORFB",137,0)
 ;
"RTN","PSIVORFB",138,0)
SETNEW ; Create new order and set
"RTN","PSIVORFB",139,0)
 D NEW55,SET55
"RTN","PSIVORFB",140,0)
 Q
"RTN","PSIVORFB",141,0)
 ;
"RTN","PSIVORFB",142,0)
CMPLIM(PSJORD,PSJDSTP1,PSJDSTP2) ; Compare stop date of order against IV Limit
"RTN","PSIVORFB",143,0)
 I $P($G(^PS(53.1,+PSJORD,0)),"^",25)]"" D CHKD Q:PSJPAO 0
"RTN","PSIVORFB",144,0)
 I $G(PSJDSTP1),$E(+PSJDSTP1,1,11)'=$E(+P(3),1,11),+PSJDSTP2'=+P(3) Q 1
"RTN","PSIVORFB",145,0)
 Q 0
"RTN","PSIVORFB",146,0)
 ;
"RTN","PSIVORFB",147,0)
LIMSTOP(PSJDSTP1,PSJDSTP2) ; Calculate default stop date using IV Limit
"RTN","PSIVORFB",148,0)
 ;      Output: PSJDSTP1 - Default stop using duration only
"RTN","PSIVORFB",149,0)
 ;              PSJDSTP2 - Default stop using duration and IV parameters for time
"RTN","PSIVORFB",150,0)
 S PSIVLIM=$$GETLIM^PSIVCAL(DFN,PSJORD)
"RTN","PSIVORFB",151,0)
 I 'PSIVLIM,PSIVLIM]"" S PSIVLIM=$$GETMIN^PSIVCAL(PSIVLIM,DFN,PSJORD)
"RTN","PSIVORFB",152,0)
 I PSIVLIM]"" D
"RTN","PSIVORFB",153,0)
 . S MINS=$$GETMIN^PSIVCAL(PSIVLIM,DFN,PSJORD),PSJDSTP1=$$FMADD^XLFDT(P(2),,,MINS)
"RTN","PSIVORFB",154,0)
 . S X=$P(PSJDSTP1,"."),PSJDSTP2=X_$S($P($G(PSIVSITE),"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14))
"RTN","PSIVORFB",155,0)
 Q
"RTN","PSIVORFB",156,0)
 ;
"RTN","PSIVORFB",157,0)
GETFRQ(PSJSKED) ;Get frequency using name of schedule
"RTN","PSIVORFB",158,0)
 I PSJSKED="" K PSJSKED Q ""
"RTN","PSIVORFB",159,0)
 S (PSJCNTX,PSJFRQ)=""
"RTN","PSIVORFB",160,0)
 I $D(^PS(51.1,"APPSJ",PSJSKED)) F  S PSJCNTX=$O(^PS(51.1,"APPSJ",PSJSKED,PSJCNTX)) Q:PSJCNTX=""  D  Q:$G(PSJFRQ)'=""
"RTN","PSIVORFB",161,0)
 . I $P($G(^PS(51.1,PSJCNTX,0)),U,3)'="" S PSJFRQ=$P(^PS(51.1,PSJCNTX,0),U,3)
"RTN","PSIVORFB",162,0)
 K PSJCNTX
"RTN","PSIVORFB",163,0)
 Q PSJFRQ
"RTN","PSIVORFB",164,0)
 ;
"RTN","PSIVORFB",165,0)
CHKD ;Check for a previous active order and compare the duration
"RTN","PSIVORFB",166,0)
 N PSJPO,A,PSJDUR
"RTN","PSIVORFB",167,0)
 S PSJDUR=$$GETLIM^PSIVCAL(DFN,PSJORD)
"RTN","PSIVORFB",168,0)
 S PSJPAO=0,PSJPO=PSJORD
"RTN","PSIVORFB",169,0)
CHKDR S PSJPO=$P($G(^PS(53.1,+PSJPO,0)),"^",25) Q:PSJPO=""
"RTN","PSIVORFB",170,0)
 I PSJPO["P" G CHKDR
"RTN","PSIVORFB",171,0)
 I PSJPO["V" S PSIVLIM=$$GETLIM^PSIVCAL(DFN,PSJPO) I PSJDUR'=PSIVLIM S PSJPAO=1 Q
"RTN","PSIVORFB",172,0)
 G CHKDR
"RTN","PSIVORFB",173,0)
 ;
"RTN","PSIVORFB",174,0)
LOGOPI(DFN,ON55) ; Log OPI activity into activity log
"RTN","PSIVORFB",175,0)
 N PSJPICHK
"RTN","PSIVORFB",176,0)
 I ON55["V" D
"RTN","PSIVORFB",177,0)
 .I ($G(P("PON"))["V"),($G(ON55)["V"),(ON55'=P("PON")) D
"RTN","PSIVORFB",178,0)
 ..K PSJARRY1,PSJARRY2 M PSJARRY1=^PS(53.45,+$G(PSJSYSP),6),PSJARRY2=^PS(55,DFN,"IV",+P("PON"),10) S PSJPICHK='$$DIFFAR^PSJBCMA5(.PSJARRY1,.PSJARRY2)
"RTN","PSIVORFB",179,0)
 .Q:$G(PSJPICHK)
"RTN","PSIVORFB",180,0)
 .N PSIVALCK,PSIVRA,PSIVLN,PSIVLSTA S PSIVLN=$O(^PS(55,DFN,"IV",+ON55,"A",""),-1)+1
"RTN","PSIVORFB",181,0)
 .K PSJARRY1,PSJARRY2 S PSJARRY1="",PSJARRY2="" M PSJARRY1=^PS(53.45,+$G(PSJSYSP),6),PSJARRY2=^PS(55,DFN,"IV",+ON55,10) Q:'$$DIFFAR^PSJBCMA5(.PSJARRY1,.PSJARRY2)
"RTN","PSIVORFB",182,0)
 .S P("FC")="OTHER PRINT INFO^"_$P($G(^PS(55,DFN,"IV",+ON55,3)),"^")_U_$P($G(P("OPI")),"^"),PSIVALCK="OPI",PSIVREA="E" D LOG^PSIVORAL
"RTN","PSIVORFB",183,0)
 K PSJARRY1,PSJARRY2
"RTN","PSIVORFB",184,0)
 Q
"RTN","PSIVORV2")
0^55^B15709057^B15186195
"RTN","PSIVORV2",1,0)
PSIVORV2 ;BIR/MLM-VIEW AN ORDER (PHARMACY) ;20 Jul 98 / 2:22 PM
"RTN","PSIVORV2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**15,81,267**;16 DEC 97;Build 158
"RTN","PSIVORV2",3,0)
 ;
"RTN","PSIVORV2",4,0)
 Q
"RTN","PSIVORV2",5,0)
 ;***
"RTN","PSIVORV2",6,0)
 ;V5.0 will be using ^PSJLIFN instead. Other sub-modules in this routine
"RTN","PSIVORV2",7,0)
 ;are being used by IPF...
"RTN","PSIVORV2",8,0)
 ;***
"RTN","PSIVORV2",9,0)
EN ; Display order with numbers.
"RTN","PSIVORV2",10,0)
 D EN^PSJLIORD(DFN,ON) Q
"RTN","PSIVORV2",11,0)
 N PSIVNUM S PSIVNUM=1
"RTN","PSIVORV2",12,0)
 ;
"RTN","PSIVORV2",13,0)
ENNONUM(DFN,PSJORD) ; Display order with no numbers.
"RTN","PSIVORV2",14,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSIVORV2",15,0)
 W:'$G(PSJPRF)&($Y) @IOF W !!,"Patient: ",VADM(1)," (",$P(VADM(2),U,2),")",?52,"Wt (kg): ",PSJPWT," ",PSJPWTD
"RTN","PSIVORV2",16,0)
 W !?3,"Ward: ",$S(VAIN(4):$P(VAIN(4),U,2),1:"OUTPATIENT"),?52,"Ht (cm): ",PSJPHT," ",PSJPWTD
"RTN","PSIVORV2",17,0)
 W !,?1,"Status: ",$$CODES^PSIVUTL(P(17),$S(P("PON")'["V":53.1,1:55.01),$S(P("PON")'["V":28,1:100)) W:P("PON")["V" ?47,"Order number: ",+P("PON") W !,UL80,!
"RTN","PSIVORV2",18,0)
 ;
"RTN","PSIVORV2",19,0)
ENPRO ; Profile view.
"RTN","PSIVORV2",20,0)
 N PSIVAC,Y,PSGEBN,PSGLI,PSJSTAR,PSIV531
"RTN","PSIVORV2",21,0)
 S (PSGEBN,PSGLI)=""
"RTN","PSIVORV2",22,0)
 S PSIVAC="C",P("PON")=ON
"RTN","PSIVORV2",23,0)
 S PSIVUP=+$$GTPCI^PSIVUTL
"RTN","PSIVORV2",24,0)
 S P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I")
"RTN","PSIVORV2",25,0)
 NEW PSJL
"RTN","PSIVORV2",26,0)
 N PSIVNUM S PSIVNUM=1
"RTN","PSIVORV2",27,0)
 I P("OT")="I" D
"RTN","PSIVORV2",28,0)
 . K ^PS(53.45,PSJSYSP,6)
"RTN","PSIVORV2",29,0)
 . S PSJSTAR="(1)^(4)^(5)^(6)^(7)^(9)^(10)"
"RTN","PSIVORV2",30,0)
 . D ^PSJLIVMD K ^PS(53.45,PSJSYSP,6)
"RTN","PSIVORV2",31,0)
 I P("OT")'="I" D
"RTN","PSIVORV2",32,0)
 . K ^PS(53.45,PSJSYSP,6)
"RTN","PSIVORV2",33,0)
 . S PSJSTAR="(1)^(2)^(3)^(4)^(5)^(6)^(7)^(9)"
"RTN","PSIVORV2",34,0)
 . D ^PSJLIVFD K ^PS(53.45,PSJSYSP,6)
"RTN","PSIVORV2",35,0)
 NEW PSIVX
"RTN","PSIVORV2",36,0)
 F PSIVX=0:0 S PSIVX=$O(^TMP("PSJI",$J,PSIVX)) Q:'PSIVX  W !,^(PSIVX,0)
"RTN","PSIVORV2",37,0)
 K ^TMP("PSJI",$J)
"RTN","PSIVORV2",38,0)
 Q
"RTN","PSIVORV2",39,0)
LONG(Y) ; Display long fields.
"RTN","PSIVORV2",40,0)
 F X=1:1:$L(Y," ") D:$X+$L($P(Y," ",X))>$S(LN<11:42,1:80) RC W ?5,$P(Y," ",X)," "
"RTN","PSIVORV2",41,0)
 Q ""
"RTN","PSIVORV2",42,0)
WTPC ; Write provider comments.
"RTN","PSIVORV2",43,0)
 W ?3,Y,!
"RTN","PSIVORV2",44,0)
 ;
"RTN","PSIVORV2",45,0)
PAUSE ;Hold display if end screen, do FF if eop.
"RTN","PSIVORV2",46,0)
 I $E(IOST)="C",($Y#IOSL)>20 N DIR,X,Y S DIR(0)="E" D ^DIR Q:$D(DUOUT)!$D(DTOUT)  W !
"RTN","PSIVORV2",47,0)
 Q
"RTN","PSIVORV2",48,0)
 ;
"RTN","PSIVORV2",49,0)
RC ; Print field by line number
"RTN","PSIVORV2",50,0)
 N X,Y S LN=LN+1 D:LN<11 @LN W !
"RTN","PSIVORV2",51,0)
 Q
"RTN","PSIVORV2",52,0)
 ;
"RTN","PSIVORV2",53,0)
1 ; Type
"RTN","PSIVORV2",54,0)
 W ?56,"Type: " S X=$$CODES^PSIVUTL(P(4),53.1,53) W $S($E(X)="C":"CHEMO",1:X),$S(P(23)'="":" ("_P(23)_")",1:""),$S(P(5)=1:" (I)",P(5)=0:"(C)",1:"")
"RTN","PSIVORV2",55,0)
 Q
"RTN","PSIVORV2",56,0)
 ;
"RTN","PSIVORV2",57,0)
2 ;Syringe Size
"RTN","PSIVORV2",58,0)
 W:P("SYRS")]"" ?51,"Syr. Size: ",$E(P("SYRS"),1,13) W:$L(P("SYRS"))>13 "..."
"RTN","PSIVORV2",59,0)
 Q
"RTN","PSIVORV2",60,0)
 ;
"RTN","PSIVORV2",61,0)
3 ; IV Room
"RTN","PSIVORV2",62,0)
 W ?53,"IV Room: ",$P(P("IVRM"),U,2)
"RTN","PSIVORV2",63,0)
 Q
"RTN","PSIVORV2",64,0)
 ;
"RTN","PSIVORV2",65,0)
4 ; Start Date
"RTN","PSIVORV2",66,0)
 S X="" I $D(PSIVNUM) S:P("DTYP") X=$S(P(17)="P"!(PSIVAC="PN"):" ",1:"*")_$S(P("DTYP")=1:"(12)",$E(P("OT"))="I":"(10)",1:"(8)")
"RTN","PSIVORV2",67,0)
 W ?48-$L(X),X,?50,"Start Date: ",$$WDTE^PSIVUTL(P(2))
"RTN","PSIVORV2",68,0)
 Q
"RTN","PSIVORV2",69,0)
 ;
"RTN","PSIVORV2",70,0)
5 ; Stop Date
"RTN","PSIVORV2",71,0)
 S X="" I $D(PSIVNUM) S:P("DTYP") X=$S(P(17)="P"!(PSIVAC="PN"):" ",1:"*")_$S(P("DTYP")=1:"(13)",$E(P("OT"))="I":"(11)",1:"(9)")
"RTN","PSIVORV2",72,0)
 W ?48-$L(X),X,?51,"Stop Date: ",$$WDTE^PSIVUTL(P(3))
"RTN","PSIVORV2",73,0)
 Q
"RTN","PSIVORV2",74,0)
 ;
"RTN","PSIVORV2",75,0)
6 ; Log-in Date
"RTN","PSIVORV2",76,0)
 W ?50,"Login Date: ",$$WDTE^PSIVUTL(P("LOG"))
"RTN","PSIVORV2",77,0)
 Q
"RTN","PSIVORV2",78,0)
 ;
"RTN","PSIVORV2",79,0)
7 ; Last fill date.
"RTN","PSIVORV2",80,0)
 S Y=$$WDTE^PSIVUTL(P("LF")) W ?51,"Last Fill: ",$S(Y="******":"** Not printed **",1:Y)
"RTN","PSIVORV2",81,0)
 Q
"RTN","PSIVORV2",82,0)
 ;
"RTN","PSIVORV2",83,0)
8 ;Last fill qty.
"RTN","PSIVORV2",84,0)
 W ?52,"Quantity: ",+P("LFA")
"RTN","PSIVORV2",85,0)
 Q
"RTN","PSIVORV2",86,0)
 ;
"RTN","PSIVORV2",87,0)
9 ; Entry Code
"RTN","PSIVORV2",88,0)
 W ?50,"Entry Code: ",$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,18),1:"*** Undefined")
"RTN","PSIVORV2",89,0)
 Q
"RTN","PSIVORV2",90,0)
 ;
"RTN","PSIVORV2",91,0)
10 ; Provider
"RTN","PSIVORV2",92,0)
 S X="" I $D(PSIVNUM),P("DTYP") S X=$S(PSIVAC="PN":" ",1:"*")_$S(P("DTYP")=1:"(14)",$E(P("OT"))="I":"(12)",1:"(10)") ;I P(17)="P",(+P("CLRK")=+P(6)) S X=""
"RTN","PSIVORV2",93,0)
 W ?48-$L(X),X,?52,"Provider: ",$S($P(P(6),U,2)]"":$E($P(P(6),U,2),1,18),1:"*** Undefined")
"RTN","PSIVORV2",94,0)
 Q
"RTN","PSIVORV2",95,0)
ENNH(ON) ;
"RTN","PSIVORV2",96,0)
 I ON'["V" D GT531^PSIVORFA(DFN,ON) S:P(4)="" P(4)="P",(P(2),P(3))="" N PSIV531 S PSIV531=1
"RTN","PSIVORV2",97,0)
 I ON["V" D GT55^PSIVORFB
"RTN","PSIVORV2",98,0)
 N UL S UL="",$P(UL,"-",70)="" W !!,?5,UL,!,?5,"Patient: ",PSGP(0),?54,"Status: ",$S(P(17)="DE":"DC (EDIT)",1:$$CODES^PSIVUTL(P(17),$S(ON'["V":53.1,1:55.01),$S(ON'["V":28,1:100))),!
"RTN","PSIVORV2",99,0)
 D ENPRO
"RTN","PSIVORV2",100,0)
 Q
"RTN","PSIVVW1")
0^51^B23979189^B14739849
"RTN","PSIVVW1",1,0)
PSIVVW1 ;BIR/PR-PRINT ACTIVITY LOG ;06 APR 97 / 5:47 PM
"RTN","PSIVVW1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,81,267**;16 DEC 97;Build 158
"RTN","PSIVVW1",3,0)
 ;
"RTN","PSIVVW1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSIVVW1",5,0)
 ;
"RTN","PSIVVW1",6,0)
 ;Called at top from Patient Profile option
"RTN","PSIVVW1",7,0)
BEG ;Ask to view activity log
"RTN","PSIVVW1",8,0)
 K PSIVLOG,PSIVLAB F Q=0:0 W !,"View activity log" S %=1 D YN^DICN Q:%  S HELP="ACTLOG" D ^PSIVHLP
"RTN","PSIVVW1",9,0)
 G:%<1 Q S:%=1 PSIVLOG=1
"RTN","PSIVVW1",10,0)
 ;
"RTN","PSIVVW1",11,0)
BEG1 ;Ask to view label log
"RTN","PSIVVW1",12,0)
 F Q=0:0 W !!,"View label log" S %=1 D YN^DICN Q:%  S HELP="LABLOG" D ^PSIVHLP2
"RTN","PSIVVW1",13,0)
 G:%<1 Q S:%=1 PSIVLAB=1 G ENPR
"RTN","PSIVVW1",14,0)
 ;
"RTN","PSIVVW1",15,0)
EN ; Show activity, label, or history log.
"RTN","PSIVVW1",16,0)
 D FULL^VALM1
"RTN","PSIVVW1",17,0)
 S:'$D(ON55) ON55=ON
"RTN","PSIVVW1",18,0)
 K DIR S DIR(0)="SOA^A:Activity Log;L:Label Log;H:History Log;I:Instructions History",DIR("A")="(A)ctivity (L)abel (H)istory (I)nstructions History: "
"RTN","PSIVVW1",19,0)
 D ^DIR K DIR G:$D(DIRUT) Q N PSJHISEL S PSJHISEL=Y D:Y="H" ENHIS^PSJHIS(DFN,ON55,"V") I PSJHISEL="I" D ENHIS^PSJINHIS(DFN,ON55,"V") G EN
"RTN","PSIVVW1",20,0)
 K PSJHIS
"RTN","PSIVVW1",21,0)
 D:PSJHISEL="A" EN1 D:PSJHISEL="L" DATA^PSIVLTR1(DFN,+ON55) I $D(PSIVSCR),'$G(PSJDNE) D PAUSE
"RTN","PSIVVW1",22,0)
 G EN
"RTN","PSIVVW1",23,0)
 ;
"RTN","PSIVVW1",24,0)
ENPR ;Entry from profile.
"RTN","PSIVVW1",25,0)
 D HOLDHDR^PSJOE
"RTN","PSIVVW1",26,0)
 K PSJDNE I $D(PSIVLOG) D EN1 I $D(PSIVSCR),'$D(PSJDNE) D PAUSE
"RTN","PSIVVW1",27,0)
 I '$D(PSJDNE),$D(PSIVLAB) D DATA^PSIVLTR1(DFN,+ON55) I $D(PSIVSCR),'$G(PSJDNE) D PAUSE
"RTN","PSIVVW1",28,0)
 I $D(PSIVSCR) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSIVVW1",29,0)
 ;
"RTN","PSIVVW1",30,0)
Q K %,COU,I,L,N,OG,P1,P17,PSIVX,USER
"RTN","PSIVVW1",31,0)
 Q
"RTN","PSIVVW1",32,0)
 ;
"RTN","PSIVVW1",33,0)
EN1 ;Entry for Inmed functionality and viewing the log from IV order entry
"RTN","PSIVVW1",34,0)
 K PSJDNE S PSIVSCR=$E(IOST)="C"
"RTN","PSIVVW1",35,0)
 I ON["P" D  Q
"RTN","PSIVVW1",36,0)
 . NEW AT,PN,PX,UD,OD
"RTN","PSIVVW1",37,0)
 . S AT="S",PN=1,PX="" F Q=0:0 S Q=$O(^PS(53.1,+ON,"A",Q)) Q:'Q  I $D(^(Q,0)) S AND=^(0)  D:'(PN#6) NPAGE^PSGVW0 Q:PX["^"  D AL1^PSGVW0
"RTN","PSIVVW1",38,0)
 . W !
"RTN","PSIVVW1",39,0)
 I '$O(^PS(55,DFN,"IV",+ON55,"A",0)) W !!,"No activity LOG to report." G Q
"RTN","PSIVVW1",40,0)
 D HDR F JJ=0:0 S JJ=$O(^PS(55,DFN,"IV",+ON55,"A",JJ)) Q:'JJ!$G(PSJDNE)  S P1=$G(^(JJ,0)),Y=+$P(P1,"^",5) D ACT
"RTN","PSIVVW1",41,0)
 Q
"RTN","PSIVVW1",42,0)
 ;
"RTN","PSIVVW1",43,0)
ACT ;This module is used for the screen profile
"RTN","PSIVVW1",44,0)
 X ^DD("DD") W !,JJ,?3,$P(Y,"@")," ",$P(Y,"@",2),?24 S X=$$CODES^PSIVUTL($P(P1,"^",2),55.04,.02) W X
"RTN","PSIVVW1",45,0)
 D NAME^PSJBCMA1($P(P1,U,6),.X) W ?50,X
"RTN","PSIVVW1",46,0)
 W !?3,"Comment: ",$P(P1,"^",4) D PAUSE Q:$D(PSJDNE)
"RTN","PSIVVW1",47,0)
 F A1=0:0 S A1=$O(^PS(55,DFN,"IV",+ON55,"A",JJ,1,A1)) Q:'A1!$D(PSJDNE)  S P1=^(A1,0) D ACTW
"RTN","PSIVVW1",48,0)
 W !
"RTN","PSIVVW1",49,0)
 Q
"RTN","PSIVVW1",50,0)
 ;
"RTN","PSIVVW1",51,0)
ACTW ;
"RTN","PSIVVW1",52,0)
 N II,NXTOPI
"RTN","PSIVVW1",53,0)
 I $P(P1,"^")'="OTHER PRINT INFO"!($P(P1,"^",2)]"")!($P(P1,"^",3)]"") D  Q
"RTN","PSIVVW1",54,0)
 .I $P(P1,"^",2)=$P(P1,"^",3) Q
"RTN","PSIVVW1",55,0)
 .W ! D PAUSE W !?10,"Field: '",$P(P1,"^"),"'" D PAUSE W !?3,"Changed from: '",$P(P1,"^",2),"'" D PAUSE W !?13,"To: '",$P(P1,"^",3),"'" D PAUSE
"RTN","PSIVVW1",56,0)
 W ! D PAUSE W !?10,"Field: '",$P(P1,"^"),"'" D PAUSE W !?3,"Changed from: '"
"RTN","PSIVVW1",57,0)
 I $P(P1,"^")="OTHER PRINT INFO" D
"RTN","PSIVVW1",58,0)
 .N TXTLN S TXTLN=0 F  S TXTLN=$O(^PS(55,DFN,"IV",+ON55,"A",JJ,2,TXTLN)) Q:'TXTLN  D
"RTN","PSIVVW1",59,0)
 ..I TXTLN=1 W !?4,"'",^(TXTLN,0) Q
"RTN","PSIVVW1",60,0)
 ..W !?5,^(TXTLN,0) I '(TXTLN#12) D PAUSE
"RTN","PSIVVW1",61,0)
 .W "'",!
"RTN","PSIVVW1",62,0)
 D PAUSE
"RTN","PSIVVW1",63,0)
 I $P(P1,"^")="OTHER PRINT INFO" S NXTOPI=0 D
"RTN","PSIVVW1",64,0)
 .I '$D(^PS(55,DFN,"IV",+ON55,"A",JJ,3)) D  Q
"RTN","PSIVVW1",65,0)
 ..S II=JJ F  S II=$O(^PS(55,DFN,"IV",+ON55,"A",II)) Q:'II!$G(NXTOPI)  I ($G(^(II,1,1,0))["OTHER PRINT INFO") S NXTOPI=II
"RTN","PSIVVW1",66,0)
 ..I '$G(NXTOPI) D  Q
"RTN","PSIVVW1",67,0)
 ...S II=0 F  S II=$O(^PS(55,DFN,"IV",+ON55,10,II)) Q:'II  W:II=1 !?3,"To : ",!?4,"'",^(II,0) W:II>1 !?5,^(II,0)
"RTN","PSIVVW1",68,0)
 ..N TXTLN S TXTLN=0 F II=0:1 S TXTLN=$O(^PS(55,DFN,"IV",+ON55,"A",NXTOPI,2,TXTLN)) Q:'TXTLN  W:II=1 !?3,"To : ",!?4,"'",^(II,0) W:(II>1) !?5,^(II,0)
"RTN","PSIVVW1",69,0)
 .N TXTLN S TXTLN=0 F II=0:1 S TXTLN=$O(^PS(55,DFN,"IV",+ON55,"A",JJ,3,TXTLN)) Q:'TXTLN  W:TXTLN=1 !?3,"To : ",!?4,"'",^(TXTLN,0) W:TXTLN>1 !?5,^(TXTLN,0) I '(TXTLN#12) D PAUSE
"RTN","PSIVVW1",70,0)
 .I $G(II) W "'",!
"RTN","PSIVVW1",71,0)
 D PAUSE
"RTN","PSIVVW1",72,0)
 Q
"RTN","PSIVVW1",73,0)
PAUSE ;
"RTN","PSIVVW1",74,0)
 I ($Y#IOSL)>18,PSIVSCR K DIR S DIR(0)="E" D ^DIR K DIR W !!! I $D(DUOUT)!$D(DTOUT) S (PSJS1,PSJS2,PSJS3,PSJS4)="~",(PSJDNE,PSJPR)=1
"RTN","PSIVVW1",75,0)
 Q
"RTN","PSIVVW1",76,0)
 ;
"RTN","PSIVVW1",77,0)
HDR W !!,"ACTIVITY LOG:",!,"#",?3,"DATE",?14,"TIME",?24,"REASON",?50,"USER",! F I=1:1:79 W "="
"RTN","PSIVVW1",78,0)
 Q
"RTN","PSIVVW1",79,0)
 ;
"RTN","PSIVVW1",80,0)
LOG1 ;This module is used for profile report. (hard printer copy usually)
"RTN","PSIVVW1",81,0)
 Q
"RTN","PSIVVW1",82,0)
 X ^DD("DD") W !,JJ,?3,$P(Y,"@")," ",$P(Y,"@",2),?24 S X=$$CODES^PSIVUTL($P(P1,"^",2),55.04,.02) W X
"RTN","PSIVVW1",83,0)
 W ?50,$P(P1,"^",3),!?3,"Comment: ",$P(P1,"^",4) I ($Y#IOSL)>22,PSIVSCR D PAUSE
"RTN","PSIVVW1",84,0)
 F PSIVX=0:0 S PSIVX=$O(^PS(55,DFN,"IV",+ON,"A",JJ,1,PSIVX)) Q:'PSIVX  S P1=^(PSIVX,0) W !!?10,"Field: '",$P(P1,"^"),"'",!?3,"Changed from: '",$P(P1,"^",2),"'",!?13,"To: '",$P(P1,"^",3),"'" I ($Y#IOSL)>18,PSIVSCR D PAUSE
"RTN","PSIVVW1",85,0)
 Q
"RTN","PSIVVW1",86,0)
ENLOG ;Entry for patient profile report OR patient purge report
"RTN","PSIVVW1",87,0)
 ;Called from routine PSIVPR
"RTN","PSIVVW1",88,0)
 S (ON,ON55)=PSJORD D HDR W:'$O(^PS(55,DFN,"IV",+ON,"A",0)) !!,"No activity LOG to report."
"RTN","PSIVVW1",89,0)
 ;
"RTN","PSIVVW1",90,0)
 K PSJDNE S PSIVSCR=$E(IOST)="C" F JJ=0:0 S JJ=$O(^PS(55,DFN,"IV",+ON,"A",JJ)) Q:'JJ!$D(PSJDNE)  S P1=$S($D(^(JJ,0)):^(0),1:""),Y=+$P(P1,"^",5) D ACT
"RTN","PSIVVW1",91,0)
 G Q
"RTN","PSJBCMA")
0^74^B81219931^B78979447
"RTN","PSJBCMA",1,0)
PSJBCMA ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ;4/10/12 10:48am
"RTN","PSJBCMA",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**32,41,46,57,63,66,56,69,58,81,91,104,111,112,186,159,173,190,113,225,253,267**;16 DEC 97;Build 158
"RTN","PSJBCMA",3,0)
 ;
"RTN","PSJBCMA",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJBCMA",5,0)
 ; Reference to ^PS(51 is supported by DBIA 2176.
"RTN","PSJBCMA",6,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSJBCMA",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJBCMA",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJBCMA",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJBCMA",10,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBCMA",11,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJBCMA",12,0)
 ; Usage of this routine by BCMA is supported by DBIA 2828.
"RTN","PSJBCMA",13,0)
 ;
"RTN","PSJBCMA",14,0)
 ;*267 - add new piece of info to return TMP gloabl. Need the Med 
"RTN","PSJBCMA",15,0)
 ;       route IEN per each order.
"RTN","PSJBCMA",16,0)
 ;
"RTN","PSJBCMA",17,0)
EN(DFN,BDT,OTDATE)         ; return condensed list of inpatient meds
"RTN","PSJBCMA",18,0)
 NEW CNT,DN,F,FON,ON,PST,WBDT,X,X1,X2,Y,%
"RTN","PSJBCMA",19,0)
 D:+$G(DFN) ORDER
"RTN","PSJBCMA",20,0)
 I '$D(^TMP("PSJ",$J,1,0)) S ^(0)=-1
"RTN","PSJBCMA",21,0)
 K PSJINX
"RTN","PSJBCMA",22,0)
 Q
"RTN","PSJBCMA",23,0)
ORDER ;Loop thru orders.
"RTN","PSJBCMA",24,0)
 I '+$G(BDT) D NOW^%DTC S BDT=%
"RTN","PSJBCMA",25,0)
 I BDT'["." S BDT=BDT_".0001"
"RTN","PSJBCMA",26,0)
 S PSJINX=0
"RTN","PSJBCMA",27,0)
 ;U/D orders
"RTN","PSJBCMA",28,0)
 S F="^PS(55,DFN,5,",WBDT=BDT
"RTN","PSJBCMA",29,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",30,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S FON=ON_"U",PSJON(FON)="" D UDVAR
"RTN","PSJBCMA",31,0)
 ;IV orders
"RTN","PSJBCMA",32,0)
 S F="^PS(55,DFN,""IV"",",WBDT=BDT
"RTN","PSJBCMA",33,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",34,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S FON=ON_"V",PSJON(FON)="" D IVVAR
"RTN","PSJBCMA",35,0)
 ;Pending orders
"RTN","PSJBCMA",36,0)
 S F="^PS(53.1,"
"RTN","PSJBCMA",37,0)
 F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJBCMA",38,0)
 . S FON=ON_"P"
"RTN","PSJBCMA",39,0)
 . S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="F":"IVVAR",1:"UDVAR")
"RTN","PSJBCMA",40,0)
 ;When a one-time order is found, check against PSJON(FON) array to
"RTN","PSJBCMA",41,0)
 ;make sure no duplicates return on ^TMP.
"RTN","PSJBCMA",42,0)
 I '+$G(OTDATE) D NOW^%DTC S X1=$E(%,1,12),X2=-30 D C^%DTC S OTDATE=X
"RTN","PSJBCMA",43,0)
 I OTDATE'["." S OTDATE=OTDATE_".0001"
"RTN","PSJBCMA",44,0)
 Q:BDT'>OTDATE
"RTN","PSJBCMA",45,0)
 S F="^PS(55,DFN,5,",WBDT=OTDATE
"RTN","PSJBCMA",46,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AU","O",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",47,0)
 .  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AU","O",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",48,0)
 .. S FON=ON_"U" D:'$D(PSJON(FON)) UDVAR
"RTN","PSJBCMA",49,0)
 S F="^PS(55,DFN,""IV"",",WBDT=OTDATE
"RTN","PSJBCMA",50,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",51,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",52,0)
 .. S X=$P($G(^PS(55,DFN,"IV",ON,0)),U,9)
"RTN","PSJBCMA",53,0)
 .. I X]"",$$ONE(DFN,ON_"V",X,$P(X,"^",2),$P(X,"^",3))="O" D
"RTN","PSJBCMA",54,0)
 ... S FON=ON_"V" D:'$D(PSJON(FON)) IVVAR
"RTN","PSJBCMA",55,0)
 K PSJON,PSJBCID
"RTN","PSJBCMA",56,0)
 Q
"RTN","PSJBCMA",57,0)
UDVAR ;Set ^TMP for Unit dose & Pending orders
"RTN","PSJBCMA",58,0)
 N CLINIC
"RTN","PSJBCMA",59,0)
 D UDPEND Q:'$$CLINICS($G(CLINIC)) 
"RTN","PSJBCMA",60,0)
 D TMP
"RTN","PSJBCMA",61,0)
 ;Setup Dispense drug for ^TMP
"RTN","PSJBCMA",62,0)
 S CNT=0 D NOW^%DTC
"RTN","PSJBCMA",63,0)
 F X=0:0 S X=$O(@(F_ON_",1,"_X_")")) Q:'X  D
"RTN","PSJBCMA",64,0)
 . S PSJDD=@(F_ON_",1,"_X_",0)") I $P(PSJDD,"^",3)]"",$P(PSJDD,"^",3)'>% Q
"RTN","PSJBCMA",65,0)
 .;*225 Don't allow 0
"RTN","PSJBCMA",66,0)
 . I +$P(PSJDD,"^",2)=0 S $P(PSJDD,"^",2)=1
"RTN","PSJBCMA",67,0)
 . S CNT=CNT+1
"RTN","PSJBCMA",68,0)
 . S ^TMP("PSJ",$J,PSJINX,700,CNT,0)=+PSJDD_U_$P($G(^PSDRUG(+PSJDD,0)),U)_U_$S((FON["U")&($P(PSJDD,U,2)=""):1,(FON["U")&($E($P(PSJDD,U,2))="."):"0"_$P(PSJDD,U,2),1:$P(PSJDD,U,2))_U_$P(PSJDD,U,3)
"RTN","PSJBCMA",69,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,700,0)=CNT
"RTN","PSJBCMA",70,0)
 K PSJ,PSJDD
"RTN","PSJBCMA",71,0)
 Q
"RTN","PSJBCMA",72,0)
IVVAR ;Set variables for IV and pending orders
"RTN","PSJBCMA",73,0)
 NEW ND,X,Y,CLINIC
"RTN","PSJBCMA",74,0)
 I FON["P" D UDPEND Q:'$$CLINICS(CLINIC)  S PSJ("INFRATE")=$P($G(^PS(53.1,ON,8)),U,5)
"RTN","PSJBCMA",75,0)
 I FON["V" D  Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",76,0)
 . S X=$G(^PS(55,DFN,"IV",ON,0)),CLINIC=$G(^("DSS")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",77,0)
 . S PSJ("STARTDT")=$P(X,U,2),PSJ("STOPDT")=$P(X,U,3)
"RTN","PSJBCMA",78,0)
 . S PSJ("INFRATE")=$P(X,U,8),PSJ("SCHD")=$P(X,U,9)
"RTN","PSJBCMA",79,0)
 . S PSJ("ADM")=$P(X,U,11),PSJ("AUTO")=$P(X,U,12),PSJ("STATUS")=$P(X,U,17)
"RTN","PSJBCMA",80,0)
 . S PSJ("IVTYPE")=$P(X,U,4),PSJ("INSYR")=$P(X,U,5)
"RTN","PSJBCMA",81,0)
 . S PSJ("CPRS")=$P(X,U,21),PSJ("CHEMO")=$P(X,U,23)
"RTN","PSJBCMA",82,0)
 . S X=$G(^PS(55,DFN,"IV",ON,.2))
"RTN","PSJBCMA",83,0)
 . S PSJ("DO")="",PSJ("MR")=$P(X,U,3),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA",84,0)
 . I PSJ("FLG") D
"RTN","PSJBCMA",85,0)
 .. N S1,A,B,C
"RTN","PSJBCMA",86,0)
 .. S S1="" F  S S1=$O(^PS(55,DFN,"IV",ON,"A",S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,2),B=$P(C,U,4) Q:A="UG"  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA",87,0)
 ... Q:A'="G"
"RTN","PSJBCMA",88,0)
 ... S PSJ("SRC")=$S(B["FLAGGED BY PHARM":"PHARMACIST",B["FLAGGED BY CPRS":"CPRS",1:"")
"RTN","PSJBCMA",89,0)
 ... S PSJ("COM")=$P(B," ",4,99)
"RTN","PSJBCMA",90,0)
 . S PSJ("OI")=+X
"RTN","PSJBCMA",91,0)
 . S X=$G(^PS(55,DFN,"IV",ON,2))
"RTN","PSJBCMA",92,0)
 . S PSJ("PREV")=$P(X,U,5) I PSJ("PREV")["V",(+PSJ("PREV")=+ON) S PSJ("PREV")=""
"RTN","PSJBCMA",93,0)
 . S PSJ("FOLLOW")=$P(X,U,6),PSJ("RFO")=$P(X,U,9) I PSJ("FOLLOW")["V",(+PSJ("FOLLOW")=+ON) S (PSJ("FOLLOW"),PSJ("RFO"))=""
"RTN","PSJBCMA",94,0)
 . S PSJ("SIOPI")=$S($P($G(^PS(55,DFN,"IV",+ON,3)),"^",2)&($P($G(^PS(55,DFN,"IV",+ON,3)),"^")'=""):"!",1:"")_$P($G(^(3)),"^")
"RTN","PSJBCMA",95,0)
 . N SCHD S SCHD=PSJ("SCHD")
"RTN","PSJBCMA",96,0)
 . S PSJ("STC")=$$ONE(DFN,ON_"V",SCHD,PSJ("STARTDT"),PSJ("STOPDT"))
"RTN","PSJBCMA",97,0)
 . I PSJ("STC")=""!(PSJ("STC")="C") S PSJ("STC")=$S(SCHD["PRN":"P",1:"C")
"RTN","PSJBCMA",98,0)
 . I PSJ("STC")="C" S PSJ("STC")=$S($$ONCALL(SCHD):"OC",1:"C")
"RTN","PSJBCMA",99,0)
 D TMP
"RTN","PSJBCMA",100,0)
 S CNT=0
"RTN","PSJBCMA",101,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  D
"RTN","PSJBCMA",102,0)
 . S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$G(^PS(52.6,+ND,0))
"RTN","PSJBCMA",103,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,850,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(ND,U,3)
"RTN","PSJBCMA",104,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,850,0)=CNT,CNT=0
"RTN","PSJBCMA",105,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  D
"RTN","PSJBCMA",106,0)
 . S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0))
"RTN","PSJBCMA",107,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,950,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJBCMA",108,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,950,0)=CNT
"RTN","PSJBCMA",109,0)
 K PSJ
"RTN","PSJBCMA",110,0)
 S X1=0
"RTN","PSJBCMA",111,0)
 F  S X1=$O(^PS(55,DFN,"IVBCMA",X1)) Q:'X1  D
"RTN","PSJBCMA",112,0)
 . S XX=$G(^PS(55,DFN,"IVBCMA",X1,0)) Q:ON'=$P(XX,"^",2)  S PSJBCID=$P(XX,"^"),X2=0
"RTN","PSJBCMA",113,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"AD",X2)) Q:'X2  S X=^(X2,0),^TMP("PSJ",$J,PSJINX,800,PSJBCID,I)=+X_"^"_$S($D(^PS(52.6,+X,0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",114,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,800,PSJBCID,0)=I-1
"RTN","PSJBCMA",115,0)
 . S X2=0
"RTN","PSJBCMA",116,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"SOL",X2)) Q:'X2  S X=^(X2,0),^TMP("PSJ",$J,PSJINX,900,PSJBCID,I)=$P(X,"^")_"^"_$S($D(^PS(52.7,$P(X,"^"),0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",117,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,900,PSJBCID,0)=I-1
"RTN","PSJBCMA",118,0)
 Q
"RTN","PSJBCMA",119,0)
UDPEND ;
"RTN","PSJBCMA",120,0)
 S X=$G(@(F_ON_",0)")) I $P(F,",")[53.1 S CLINIC=$G(@(F_ON_",""DSS"")")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",121,0)
 I $P(F,",")[55 S CLINIC=$G(@(F_ON_",8)")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",122,0)
 S PSJ("MR")=$P(X,U,3),PSJ("SM")=$P(X,U,5),PSJ("HSM")=$P(X,U,6)
"RTN","PSJBCMA",123,0)
 S PSJ("ST")=$P(X,U,7),PSJ("STATUS")=$P(X,U,9)
"RTN","PSJBCMA",124,0)
 S PSJ("CPRS")=$P(X,U,21),PSJ("PREV")=$P(X,U,25),PSJ("FOLLOW")=$P(X,U,26),PSJ("RFO")=$P(X,U,27)
"RTN","PSJBCMA",125,0)
 S:FON["U" PSJ("NGIVEN")=$P(X,U,22)
"RTN","PSJBCMA",126,0)
 S X=$G(@(F_ON_",.2)"))
"RTN","PSJBCMA",127,0)
 S PSJ("DO")=$P(X,U,2),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA",128,0)
 I PSJ("FLG") D
"RTN","PSJBCMA",129,0)
 . N S1,A,B,C
"RTN","PSJBCMA",130,0)
 . S S1="" F  S S1=$O(^PS(55,DFN,5,ON,9,S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,3),B=$P(C,U,4) Q:A=7010!(A=7030)  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA",131,0)
 .. Q:A'=7000&(A'=7020)
"RTN","PSJBCMA",132,0)
 .. S PSJ("SRC")=$S(A=7000:"PHARMACIST",A=7020:"CPRS",1:"")
"RTN","PSJBCMA",133,0)
 .. S PSJ("COM")=$G(@(F_ON_",13)"))
"RTN","PSJBCMA",134,0)
 S PSJ("OI")=+X
"RTN","PSJBCMA",135,0)
 S X=$G(@(F_ON_",2)"))
"RTN","PSJBCMA",136,0)
 S PSJ("SCHD")=$P(X,U),PSJ("STARTDT")=$P(X,U,2)
"RTN","PSJBCMA",137,0)
 S PSJ("STOPDT")=$P(X,U,4),PSJ("ADM")=$P(X,U,5)
"RTN","PSJBCMA",138,0)
 S X=$G(@(F_ON_",4)"))
"RTN","PSJBCMA",139,0)
 S PSJ("AUTO")=$P(X,U,11)
"RTN","PSJBCMA",140,0)
 ;naked reference on line below refers to  full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJBCMA",141,0)
 S PSJ("SIOPI")=$S($P($G(@(F_ON_",6)")),"^",2)&($P($G(@(F_ON_",6)")),"^")'=""):"!",1:"")_$$ENSET($P($G(^(6)),"^"))
"RTN","PSJBCMA",142,0)
 D SIOPI
"RTN","PSJBCMA",143,0)
 S PSJ("STC")=PSJ("ST")
"RTN","PSJBCMA",144,0)
 I PSJ("ST")="R"!(PSJ("ST")="C") S PSJ("STC")=$S(PSJ("SCHD")["PRN":"P",$$ONCALL(PSJ("SCHD")):"OC",$$ONE(DFN,FON,PSJ("SCHD"))="O":"O",1:"C")
"RTN","PSJBCMA",145,0)
 Q
"RTN","PSJBCMA",146,0)
TMP ;Setup ^TMP that have common fields between IV and U/D
"RTN","PSJBCMA",147,0)
 N A
"RTN","PSJBCMA",148,0)
 S PSJINX=PSJINX+1
"RTN","PSJBCMA",149,0)
 S PSJ("OINAME")=$$OIDF^PSJLMUT1(+PSJ("OI")) I PSJ("OINAME")["NOT FOUND" S PSJ("OINAME")=""
"RTN","PSJBCMA",150,0)
 S PSJ("OIDF")=$$GET1^DIQ(50.7,+PSJ("OI"),.02)
"RTN","PSJBCMA",151,0)
 I PSJ("OINAME")="" S PSJ("OIDF")=""
"RTN","PSJBCMA",152,0)
 S A=$G(^PS(51.2,+PSJ("MR"),0)),PSJ("MRABB")=$P(A,U,3),PSJ("MRNM")=$P(A,U)
"RTN","PSJBCMA",153,0)
 S ^TMP("PSJ",$J,PSJINX,0)=DFN_U_+ON_U_FON_U_PSJ("PREV")_U_PSJ("FOLLOW")_U_$G(PSJ("IVTYPE"))_U_$G(PSJ("INSYR"))_U_$G(PSJ("CHEMO"))_U_PSJ("CPRS")_U_$G(PSJ("RFO"))
"RTN","PSJBCMA",154,0)
 S ^TMP("PSJ",$J,PSJINX,1)=PSJ("MRABB")_U_PSJ("STC")_U_$G(PSJ("SCHD"))_U_PSJ("STARTDT")_U_PSJ("STOPDT")_U_PSJ("ADM")_U_PSJ("STATUS")_U_$G(PSJ("NGIVEN"))_U_$G(PSJ("ST"))_U_$G(PSJ("AUTO"))
"RTN","PSJBCMA",155,0)
 S ^TMP("PSJ",$J,PSJINX,1,0)=$P(A,U,8)_U_PSJ("MRNM")_U_$P(A,U,9)_U_+PSJ("MR")   ;*267 append file 51.2 ien
"RTN","PSJBCMA",156,0)
 S ^TMP("PSJ",$J,PSJINX,2)=PSJ("DO")_U_$G(PSJ("INFRATE"))_U_$G(PSJ("SM"))_U_$G(PSJ("HSM"))
"RTN","PSJBCMA",157,0)
 S ^TMP("PSJ",$J,PSJINX,3)=PSJ("OI")_U_PSJ("OINAME")_U_PSJ("OIDF")
"RTN","PSJBCMA",158,0)
 S ^TMP("PSJ",$J,PSJINX,4)=PSJ("SIOPI")
"RTN","PSJBCMA",159,0)
 S A=$$SNDTSTA^PSJHL4A(PSJ("PRI"),PSJ("SCHD"))
"RTN","PSJBCMA",160,0)
 S ^TMP("PSJ",$J,PSJINX,5)=$S(A=1:0,1:1)_U_PSJ("FLG")_U_PSJ("SRC")_U_PSJ("COM")
"RTN","PSJBCMA",161,0)
 Q
"RTN","PSJBCMA",162,0)
SIOPI ; Use provider comments if order is pending and there is no SI
"RTN","PSJBCMA",163,0)
 NEW X,Y,Z
"RTN","PSJBCMA",164,0)
 I FON["P",(PSJ("SIOPI")=""),$O(^PS(53.1,+ON,12,0)) D
"RTN","PSJBCMA",165,0)
 . F X=0:0 S X=$O(^PS(53.1,+ON,12,X)) Q:'X  S Z=$G(^(X,0)) D
"RTN","PSJBCMA",166,0)
 .. S Y=$L(PSJ("SIOPI"))
"RTN","PSJBCMA",167,0)
 .. S:Y+$L(Z)'>179 PSJ("SIOPI")=PSJ("SIOPI")_Z_""
"RTN","PSJBCMA",168,0)
 . I Y+$L(Z)>179 S PSJ("SIOPI")="SEE PROVIDER COMMENTS"
"RTN","PSJBCMA",169,0)
 Q
"RTN","PSJBCMA",170,0)
ENSET(X) ; expands SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSJBCMA",171,0)
 N X1,X2,Y S Y=""
"RTN","PSJBCMA",172,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) I X2]"" S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSJBCMA",173,0)
 S Y=$E(Y,1,$L(Y)-1)
"RTN","PSJBCMA",174,0)
 Q Y
"RTN","PSJBCMA",175,0)
ONE(DFN,ORD,SCH,START,STOP) ;Determine if order is one-time, and return schedule type
"RTN","PSJBCMA",176,0)
 ; Input:  DFN - patient's IEN
"RTN","PSJBCMA",177,0)
 ;         ORD - order number
"RTN","PSJBCMA",178,0)
 ;         SCH - schedule text (required)
"RTN","PSJBCMA",179,0)
 ;         START - order start date (optional)
"RTN","PSJBCMA",180,0)
 ;         STOP - order stop date (optional)
"RTN","PSJBCMA",181,0)
 N X,ONEFRQ,TYP,T
"RTN","PSJBCMA",182,0)
 I $G(PSJ("PREV")),$G(PSJ("FOLLOW")) I +PSJ("PREV")=+PSJ("FOLLOW") S (PSJ("PREV"),PSJ("FOLLOW"))=""
"RTN","PSJBCMA",183,0)
 ; PSJ*5*190 One-Time PRN
"RTN","PSJBCMA",184,0)
 I $G(SCH)="",$G(DFN),$G(ORD) D
"RTN","PSJBCMA",185,0)
 .I ORD["U" S SCH=$P($G(^PS(55,DFN,5,+ORD,2)),"^")
"RTN","PSJBCMA",186,0)
 .I ORD["V" S SCH=$P($G(^PS(55,DFN,"IV",+ORD,0)),"^",9)
"RTN","PSJBCMA",187,0)
 I $G(SCH)]"",$$OTPRN^PSJBCMA3(SCH)="O" Q "O"
"RTN","PSJBCMA",188,0)
 I $G(DFN)]"",$G(ORD)]"",ORD["U",$P(^PS(55,DFN,5,+ORD,0),"^",7)'="R" Q $P(^PS(55,DFN,5,+ORD,0),"^",7)
"RTN","PSJBCMA",189,0)
 I $G(SCH)="" Q ""
"RTN","PSJBCMA",190,0)
 ; PSJ*5*113 Determine schedule type from ^PS(51.1, not from schedule name.
"RTN","PSJBCMA",191,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="D":"C",1:X)
"RTN","PSJBCMA",192,0)
 I $G(START)]"",$G(STOP)]"",START=STOP Q "O"
"RTN","PSJBCMA",193,0)
 I $$DAY(SCH) Q "C"
"RTN","PSJBCMA",194,0)
 Q ""
"RTN","PSJBCMA",195,0)
CLINIC(CL) ;
"RTN","PSJBCMA",196,0)
 I $P(CL,"^",2)?7N!($P(CL,"^",2)?7N1".".N) Q 1
"RTN","PSJBCMA",197,0)
 Q 0
"RTN","PSJBCMA",198,0)
CLINICS(CL) ;
"RTN","PSJBCMA",199,0)
 Q:'$$CLINIC(CL) 1
"RTN","PSJBCMA",200,0)
 Q:'$D(^PS(53.46,"B",+CL)) 1
"RTN","PSJBCMA",201,0)
 N A
"RTN","PSJBCMA",202,0)
 S A=$O(^PS(53.46,"B",+CL,"")) Q:'A 1
"RTN","PSJBCMA",203,0)
 Q $P(^PS(53.46,A,0),"^",4)
"RTN","PSJBCMA",204,0)
DAY(SCH) ;determine if this is a 'day of the week' schedule
"RTN","PSJBCMA",205,0)
 I $G(SCH)="" Q 0
"RTN","PSJBCMA",206,0)
 N D,DAY,DAYS,I,X
"RTN","PSJBCMA",207,0)
 S DAYS="SUNDAY,MONDAY,TUESDAY,WEDNESDAY,THURSDAY,FRIDAY,SATURDAY"
"RTN","PSJBCMA",208,0)
 F I=1:1 S D=$P(SCH,"-",I) Q:D=""  D  Q:X=0
"RTN","PSJBCMA",209,0)
 . S X=0 F J=1:1:7 S DAY=$P(DAYS,",",J) D  Q:X=1
"RTN","PSJBCMA",210,0)
 .. I D=$E(DAY,1,$L(D)) S X=1
"RTN","PSJBCMA",211,0)
 Q X
"RTN","PSJBCMA",212,0)
 ;
"RTN","PSJBCMA",213,0)
ONCALL(SCHD) ; Check if a schedule is type On Call (all "APPSJ" schedules with a given name must have the same schedule type)
"RTN","PSJBCMA",214,0)
 N NXT,SCHARR,OCCHK
"RTN","PSJBCMA",215,0)
 S OCCHK=0
"RTN","PSJBCMA",216,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSJBCMA",217,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSJBCMA",218,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSJBCMA",219,0)
 I '$D(SCHARR("OC")) S OCCHK=0 Q OCCHK
"RTN","PSJBCMA",220,0)
 I $O(SCHARR("OC"))]""!($O(SCHARR("OC"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSJBCMA",221,0)
 I $D(SCHARR("OC")) S OCCHK=1
"RTN","PSJBCMA",222,0)
 Q OCCHK
"RTN","PSJBCMA1")
0^66^B94159665^B68412667
"RTN","PSJBCMA1",1,0)
PSJBCMA1 ;BIR/MV-RETURN INFORMATION FOR AN ORDER ;2/27/12 4:51pm
"RTN","PSJBCMA1",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**32,41,46,57,63,66,56,58,81,91,104,186,159,173,253,267**;16 DEC 97;Build 158
"RTN","PSJBCMA1",3,0)
 ;
"RTN","PSJBCMA1",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJBCMA1",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJBCMA1",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJBCMA1",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJBCMA1",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBCMA1",9,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJBCMA1",10,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJBCMA1",11,0)
 ; Reference to ^DIQ is supported by DBIA 2056.
"RTN","PSJBCMA1",12,0)
 ; Usage of this routine by BCMA is supported by DBIA 2829.
"RTN","PSJBCMA1",13,0)
 ;
"RTN","PSJBCMA1",14,0)
 ;*267 add Standard Rtoue Name from file 51.2 field 10
"RTN","PSJBCMA1",15,0)
 ;
"RTN","PSJBCMA1",16,0)
EN(DFN,ON,PSJTMP)         ; return detail data for Inpatient Meds.
"RTN","PSJBCMA1",17,0)
 NEW F,A
"RTN","PSJBCMA1",18,0)
 S PSJTMP=$S($G(PSJTMP)=1:"PSJ1",1:"PSJ")
"RTN","PSJBCMA1",19,0)
 I $G(ON)["U" S F="^PS(55,+$G(DFN),5,+ON" D:$D(@(F_")")) UDVAR
"RTN","PSJBCMA1",20,0)
 I $G(ON)["V" S F="^PS(55,+$G(DFN),""IV"",+ON" D:$D(@(F_")")) IVVAR
"RTN","PSJBCMA1",21,0)
 I $G(ON)["P" S F="^PS(53.1,+ON",X=$P($G(^PS(53.1,+ON,0)),U,4) D:$D(@(F_")")) @$S(X="F":"IVVAR",1:"UDVAR")
"RTN","PSJBCMA1",22,0)
 I '$D(^TMP(PSJTMP,$J,0)) S ^(0)=-1
"RTN","PSJBCMA1",23,0)
 Q
"RTN","PSJBCMA1",24,0)
 ;
"RTN","PSJBCMA1",25,0)
UDVAR ;* Set ^TMP for Unit dose & Pending orders
"RTN","PSJBCMA1",26,0)
 NEW CNT,X
"RTN","PSJBCMA1",27,0)
 D UDPEND
"RTN","PSJBCMA1",28,0)
 D TMP
"RTN","PSJBCMA1",29,0)
 ;* Setup Dispense drug for ^TMP
"RTN","PSJBCMA1",30,0)
 S CNT=0 D NOW^%DTC
"RTN","PSJBCMA1",31,0)
 F X=0:0 S X=$O(@(F_",1,"_X_")")) Q:'X  D
"RTN","PSJBCMA1",32,0)
 . S PSJDD=@(F_",1,"_X_",0)") I $P(PSJDD,"^",3)]"",$P(PSJDD,"^",3)'>% Q
"RTN","PSJBCMA1",33,0)
 . S CNT=CNT+1
"RTN","PSJBCMA1",34,0)
 . S ^TMP(PSJTMP,$J,700,CNT,0)=+PSJDD_U_$P($G(^PSDRUG(+PSJDD,0)),U)_U_$S((ON["U")&($P(PSJDD,U,2)=""):1,(ON["U")&($E($P(PSJDD,U,2))="."):"0"_$P(PSJDD,U,2),1:$P(PSJDD,U,2))_U_$P(PSJDD,U,3)
"RTN","PSJBCMA1",35,0)
 S:CNT ^TMP(PSJTMP,$J,700,0)=CNT
"RTN","PSJBCMA1",36,0)
 K PSJ,PSJDD,PSJDN
"RTN","PSJBCMA1",37,0)
 Q
"RTN","PSJBCMA1",38,0)
IVVAR ;* Set variables for IV and pending orders
"RTN","PSJBCMA1",39,0)
 NEW CNT,DN,ND,X,Y
"RTN","PSJBCMA1",40,0)
 I ON["P" D UDPEND S PSJ("INFRATE")=$P($G(^PS(53.1,ON,8)),U,5)
"RTN","PSJBCMA1",41,0)
 I ON["V" D
"RTN","PSJBCMA1",42,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,0))
"RTN","PSJBCMA1",43,0)
 . S PSJ("STARTDT")=$P(X,U,2),PSJ("STOPDT")=$P(X,U,3)
"RTN","PSJBCMA1",44,0)
 . S PSJ("PROVIDER")=$P(X,U,6)
"RTN","PSJBCMA1",45,0)
 . S PSJ("INFRATE")=$P(X,U,8),PSJ("SCHD")=$P(X,U,9)
"RTN","PSJBCMA1",46,0)
 . S PSJ("ADM")=$P(X,U,11),PSJ("AUTO")=$P(X,U,12),PSJ("STATUS")=$P(X,U,17)
"RTN","PSJBCMA1",47,0)
 . S PSJ("FREQ")=$P(X,U,15),PSJ("IVTYPE")=$P(X,U,4)
"RTN","PSJBCMA1",48,0)
 . S PSJ("INSYR")=$P(X,U,5),PSJ("CPRS")=$P(X,U,21),PSJ("CHEMO")=$P(X,U,23)
"RTN","PSJBCMA1",49,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,.2))
"RTN","PSJBCMA1",50,0)
 . S PSJ("OI")=$P(X,U),PSJ("DO")="",PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA1",51,0)
 . I PSJ("FLG") D
"RTN","PSJBCMA1",52,0)
 .. N S1,A,B,C
"RTN","PSJBCMA1",53,0)
 .. S S1="" F  S S1=$O(^PS(55,DFN,"IV",+ON,"A",S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,2),B=$P(C,U,4) Q:A="UG"  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA1",54,0)
 ... Q:A'="G"
"RTN","PSJBCMA1",55,0)
 ... S PSJ("SRC")=$S(B["FLAGGED BY PHARM":"PHARMACIST",B["FLAGGED BY CPRS":"CPRS",1:"")
"RTN","PSJBCMA1",56,0)
 ... S PSJ("COM")=$P(B," ",4,99)
"RTN","PSJBCMA1",57,0)
 . S PSJ("MR")=$P(X,U,3)
"RTN","PSJBCMA1",58,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,4))
"RTN","PSJBCMA1",59,0)
 . S PSJ("NURSE")=$P(X,U)
"RTN","PSJBCMA1",60,0)
 . S PSJ("PHARM")=$P(X,U,4)
"RTN","PSJBCMA1",61,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,2))
"RTN","PSJBCMA1",62,0)
 . S PSJ("LDT")=$P(X,U)
"RTN","PSJBCMA1",63,0)
 . S PSJ("PREV")=$P(X,U,5),PSJ("FOLLOW")=$P(X,U,6)
"RTN","PSJBCMA1",64,0)
 . S PSJ("SIOPI")=$S($P($G(^PS(55,DFN,"IV",+ON,3)),"^",2)&($P($G(^PS(55,DFN,"IV",+ON,3)),"^")'=""):"!",1:"")_$P($G(^(3)),"^")
"RTN","PSJBCMA1",65,0)
 . N SCHD S SCHD=PSJ("SCHD")  ; SCHD var required to shorten $Select
"RTN","PSJBCMA1",66,0)
 . S PSJ("STC")=$$ONE^PSJBCMA(DFN,ON,SCHD,PSJ("STARTDT"),PSJ("STOPDT"))
"RTN","PSJBCMA1",67,0)
 . I PSJ("STC")=""!(PSJ("STC")="C") S PSJ("STC")=$S(SCHD["PRN":"P",1:"C")
"RTN","PSJBCMA1",68,0)
 . I PSJ("STC")="C" S PSJ("STC")=$S($$ONCALL^PSJBCMA(PSJ("SCHD")):"OC",1:"C")
"RTN","PSJBCMA1",69,0)
 . S PSJ("NURSE")=$P($G(^PS(55,DFN,"IV",+ON,4)),U)
"RTN","PSJBCMA1",70,0)
 D TMP
"RTN","PSJBCMA1",71,0)
 S X=$P($G(^PS(55,DFN,"IV",+ON,1)),U) S:X]"" ^TMP(PSJTMP,$J,6)=X
"RTN","PSJBCMA1",72,0)
 S CNT=0
"RTN","PSJBCMA1",73,0)
 F X=0:0 S X=$O(@(F_",""AD"","_X_")")) Q:'X  D
"RTN","PSJBCMA1",74,0)
 . S ND=$G(@(F_",""AD"","_X_",0)")),DN=$G(^PS(52.6,+ND,0)) ;,AOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I AOINAME["NOTFOUND" S AOINAME=""
"RTN","PSJBCMA1",75,0)
 . S CNT=CNT+1,^TMP(PSJTMP,$J,850,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(ND,U,3) ;_U_U_$P(DN,U,11)_U_AOINAME_U_AOIDF
"RTN","PSJBCMA1",76,0)
 S:CNT ^TMP(PSJTMP,$J,850,0)=CNT,CNT=0
"RTN","PSJBCMA1",77,0)
 F X=0:0 S X=$O(@(F_",""SOL"","_X_")")) Q:'X  D
"RTN","PSJBCMA1",78,0)
 . S ND=$G(@(F_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)) ;,SOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I SOINAME["NOTFOUND" S SOINAME=""
"RTN","PSJBCMA1",79,0)
 . S CNT=CNT+1,^TMP(PSJTMP,$J,950,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4) ;_U_U_$P(DN,U,11)_U_SOINAME_U_SOIDF
"RTN","PSJBCMA1",80,0)
 S:CNT ^TMP(PSJTMP,$J,950,0)=CNT
"RTN","PSJBCMA1",81,0)
 K PSJ
"RTN","PSJBCMA1",82,0)
 S X1=0
"RTN","PSJBCMA1",83,0)
 F  S X1=$O(^PS(55,DFN,"IVBCMA",X1)) Q:'X1  D
"RTN","PSJBCMA1",84,0)
 . S XX=$G(^PS(55,DFN,"IVBCMA",X1,0)) Q:$P(XX,"^",2)'=+ON  S PSJBCID=$P(XX,"^"),X2=0
"RTN","PSJBCMA1",85,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"AD",X2)) Q:'X2  S X=^(X2,0),^TMP(PSJTMP,$J,800,PSJBCID,I)=+X_"^"_$S($D(^PS(52.6,+X,0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA1",86,0)
 . I I>1 S ^TMP(PSJTMP,$J,800,PSJBCID,0)=I-1
"RTN","PSJBCMA1",87,0)
 . S X2=0
"RTN","PSJBCMA1",88,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"SOL",X2)) Q:'X2  S X=^(X2,0),^TMP(PSJTMP,$J,900,PSJBCID,I)=$P(X,"^")_"^"_$S($D(^PS(52.7,$P(X,"^"),0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA1",89,0)
 . I I>1 S ^TMP(PSJTMP,$J,900,PSJBCID,0)=I-1
"RTN","PSJBCMA1",90,0)
 . S ^TMP(PSJTMP,$J,1000,PSJBCID)=$P(XX,"^",6)_"^"_$P(XX,"^",8)_"^"_$P(XX,"^",7)
"RTN","PSJBCMA1",91,0)
 Q
"RTN","PSJBCMA1",92,0)
UDPEND ;
"RTN","PSJBCMA1",93,0)
 S X=$G(@(F_",0)"))
"RTN","PSJBCMA1",94,0)
 S PSJ("PROVIDER")=$P(X,U,2)
"RTN","PSJBCMA1",95,0)
 S PSJ("MR")=$P(X,U,3),PSJ("SM")=$P(X,U,5),PSJ("HSM")=$P(X,U,6)
"RTN","PSJBCMA1",96,0)
 S PSJ("ST")=$P(X,U,7),PSJ("STATUS")=$P(X,U,9)
"RTN","PSJBCMA1",97,0)
 S PSJ("LDT")=$P(X,U,16)
"RTN","PSJBCMA1",98,0)
 S:ON["U" PSJ("NGIVEN")=$P(X,U,22)
"RTN","PSJBCMA1",99,0)
 S PSJ("SMYN")=$S(+PSJ("SM"):"YES",1:"NO")
"RTN","PSJBCMA1",100,0)
 S PSJ("HSMYN")=$S(+PSJ("HSM"):"YES",1:"NO")
"RTN","PSJBCMA1",101,0)
 S PSJ("CPRS")=$P(X,U,21),PSJ("PREV")=$P(X,U,25),PSJ("FOLLOW")=$P(X,U,26)
"RTN","PSJBCMA1",102,0)
 S X=$G(@(F_",.2)"))
"RTN","PSJBCMA1",103,0)
 S PSJ("OI")=$P(X,U),PSJ("DO")=$P(X,U,2),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA1",104,0)
 I PSJ("FLG") D
"RTN","PSJBCMA1",105,0)
 . N S1,A,B,C
"RTN","PSJBCMA1",106,0)
 . S S1="" F  S S1=$O(^PS(55,DFN,5,+ON,9,S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,3),B=$P(C,U,4) Q:A=7010!(A=7030)  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA1",107,0)
 .. Q:A'=7000&(A'=7020)
"RTN","PSJBCMA1",108,0)
 .. S PSJ("SRC")=$S(A=7000:"PHARMACIST",A=7020:"CPRS",1:"")
"RTN","PSJBCMA1",109,0)
 .. S PSJ("COM")=$G(@(F_",13)"))
"RTN","PSJBCMA1",110,0)
 S X=$G(@(F_",2)"))
"RTN","PSJBCMA1",111,0)
 S PSJ("SCHD")=$P(X,U),PSJ("STARTDT")=$P(X,U,2)
"RTN","PSJBCMA1",112,0)
 S PSJ("STC")=PSJ("ST")
"RTN","PSJBCMA1",113,0)
 I PSJ("ST")="R"!(PSJ("ST")="C") S PSJ("STC")=$S(PSJ("SCHD")["PRN":"P",$$ONCALL^PSJBCMA(PSJ("SCHD")):"OC",$$ONE^PSJBCMA(DFN,ON,PSJ("SCHD"))="O":"O",1:"C")
"RTN","PSJBCMA1",114,0)
 I PSJ("STC")="O" S PSJ("ST")="O"
"RTN","PSJBCMA1",115,0)
 S PSJ("STOPDT")=$P(X,U,4),PSJ("ADM")=$P(X,U,5)
"RTN","PSJBCMA1",116,0)
 S PSJ("FREQ")=$P(X,U,6)
"RTN","PSJBCMA1",117,0)
 S X=$G(@(F_",4)"))
"RTN","PSJBCMA1",118,0)
 S PSJ("NURSE")=$P(X,U),PSJ("AUTO")=$P(X,U,11)
"RTN","PSJBCMA1",119,0)
 S:ON["U" PSJ("PHARM")=+$P(X,U,3)
"RTN","PSJBCMA1",120,0)
 ; the naked reference on the line below refers to the full reference created by indirect reference to F, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJBCMA1",121,0)
 S PSJ("SIOPI")=$S($P($G(@(F_",6)")),"^",2)&($P($G(@(F_",6)")),"^")'=""):"!",1:"")_$$ENSET^PSJBCMA($P($G(^(6)),"^"))
"RTN","PSJBCMA1",122,0)
 NEW FON S FON=ON D SIOPI^PSJBCMA
"RTN","PSJBCMA1",123,0)
 Q 
"RTN","PSJBCMA1",124,0)
 ;
"RTN","PSJBCMA1",125,0)
TMP ;* Setup ^TMP that have common fields between IV and U/D
"RTN","PSJBCMA1",126,0)
 D NAME(PSJ("PROVIDER"),.PSJNAME,"","")
"RTN","PSJBCMA1",127,0)
 S PSJ("PRONAME")=PSJNAME K PSJNAME
"RTN","PSJBCMA1",128,0)
 I $D(PSJ("PHARM")) D
"RTN","PSJBCMA1",129,0)
 . D NAME(PSJ("PHARM"),.PSJNAME,.PSJINIT,.PSJPIEN)
"RTN","PSJBCMA1",130,0)
 . S PSJ("PHARM")=PSJPIEN,PSJ("PNAME")=PSJNAME,PSJ("PINIT")=PSJINIT K PSJNAME,PSJINIT,PSJPIEN
"RTN","PSJBCMA1",131,0)
 I +PSJ("NURSE") D
"RTN","PSJBCMA1",132,0)
 . D NAME(PSJ("NURSE"),.PSJNAME,.PSJINIT,"")
"RTN","PSJBCMA1",133,0)
 . S PSJ("NNAME")=PSJNAME,PSJ("NINIT")=PSJINIT K PSJNAME,PSJINIT
"RTN","PSJBCMA1",134,0)
 S A=$G(^PS(51.2,+PSJ("MR"),0)),PSJ("MRNM")=$P(A,U),PSJ("MRABB")=$P(A,U,3),PSJ("MRPIJ")=$P(A,U,8),PSJ("MRIVP")=$P(A,U,9)
"RTN","PSJBCMA1",135,0)
 S PSJ("MRSTDRNM")=$$GET1^DIQ(51.2,+PSJ("MR"),10)  ;*267 Std Rte name
"RTN","PSJBCMA1",136,0)
 S PSJ("OINAME")=$$OIDF^PSJLMUT1(+PSJ("OI")) I PSJ("OINAME")["NOT FOUND" S PSJ("OINAME")=""
"RTN","PSJBCMA1",137,0)
 S PSJ("OIDF")=$$GET1^DIQ(50.7,+PSJ("OI"),.02)
"RTN","PSJBCMA1",138,0)
 I PSJ("OINAME")="" S PSJ("OIDF")=""
"RTN","PSJBCMA1",139,0)
 S PSJ("LDTN")=$$DATE(PSJ("LDT"))
"RTN","PSJBCMA1",140,0)
 S PSJ("STARTDTN")=$$DATE(PSJ("STARTDT"))
"RTN","PSJBCMA1",141,0)
 S PSJ("STOPDTN")=$$DATE(PSJ("STOPDT"))
"RTN","PSJBCMA1",142,0)
 S X=$S(ON["V":PSJ("STC"),1:PSJ("ST"))
"RTN","PSJBCMA1",143,0)
 S PSJ("STNAME")=$S(X="C":"CONTINUOUS",X="O":"ONE TIME",X="P":"PRN",X="R":"FILL ON REQUEST",X="OC":"ON CALL",1:"NOT FOUND")
"RTN","PSJBCMA1",144,0)
 ;
"RTN","PSJBCMA1",145,0)
 S ^TMP(PSJTMP,$J,0)=DFN_U_+ON_U_ON_U_PSJ("PREV")_U_PSJ("FOLLOW")_U_$G(PSJ("IVTYPE"))_U_$G(PSJ("INSYR"))_U_$G(PSJ("CHEMO"))_U_PSJ("CPRS")
"RTN","PSJBCMA1",146,0)
 S ^TMP(PSJTMP,$J,1)=PSJ("PROVIDER")_U_PSJ("PRONAME")_U_PSJ("MR")_U_PSJ("MRABB")_U_$G(PSJ("SM"))_U_$G(PSJ("SMYN"))_U_$G(PSJ("HSM"))_U_$G(PSJ("HSMYN"))_U_$G(PSJ("NGIVEN"))_U_PSJ("STATUS")
"RTN","PSJBCMA1",147,0)
 S ^TMP(PSJTMP,$J,1)=^TMP(PSJTMP,$J,1)_U_$$STATUS(ON,PSJ("STATUS"))_U_$G(PSJ("AUTO"))_U_$G(PSJ("MRNM"))_U_PSJ("MRSTDRNM") ;*267 Std Rte nam
"RTN","PSJBCMA1",148,0)
 S ^TMP(PSJTMP,$J,1,0)=PSJ("MRPIJ")_U_$G(PSJ("MRIVP"))
"RTN","PSJBCMA1",149,0)
 S ^TMP(PSJTMP,$J,2)=PSJ("OI")_U_PSJ("OINAME")_U_PSJ("DO")_U_$G(PSJ("INFRATE"))_U_$G(PSJ("SCHD"))_U_PSJ("OIDF")
"RTN","PSJBCMA1",150,0)
 S ^TMP(PSJTMP,$J,3)=PSJ("SIOPI")
"RTN","PSJBCMA1",151,0)
 S ^TMP(PSJTMP,$J,4)=PSJ("STC")_U_$G(PSJ("STNAME"))_U_PSJ("LDT")_U_PSJ("LDTN")_U_PSJ("STARTDT")_U_PSJ("STARTDTN")_U_PSJ("STOPDT")_U_PSJ("STOPDTN")_U_$$ADMIN(PSJ("ADM"))_U_$G(PSJ("ST"))_U_$G(PSJ("FREQ"))
"RTN","PSJBCMA1",152,0)
 S ^TMP(PSJTMP,$J,5)=$G(PSJ("NURSE"))_U_$G(PSJ("NNAME"))_U_$G(PSJ("NINIT"))_U_$G(PSJ("PHARM"))_U_$G(PSJ("PNAME"))_U_$G(PSJ("PINIT"))
"RTN","PSJBCMA1",153,0)
 S A=$$SNDTSTA^PSJHL4A(PSJ("PRI"),PSJ("SCHD"))
"RTN","PSJBCMA1",154,0)
 S ^TMP(PSJTMP,$J,7)=$S(A=1:0,1:1)_U_PSJ("FLG")_U_PSJ("SRC")_U_PSJ("COM")
"RTN","PSJBCMA1",155,0)
 Q
"RTN","PSJBCMA1",156,0)
 ;
"RTN","PSJBCMA1",157,0)
NAME(X,NAME,INIT,IEN)  ;Lookup in ^VA(200.
"RTN","PSJBCMA1",158,0)
 ;X = IEN or Name in ^VA(200
"RTN","PSJBCMA1",159,0)
 ;IEN = Return IEN in ^VA(200
"RTN","PSJBCMA1",160,0)
 ;NAME = Return the name in 200
"RTN","PSJBCMA1",161,0)
 ;INIT = Return the initial
"RTN","PSJBCMA1",162,0)
 NEW DIC,Y
"RTN","PSJBCMA1",163,0)
 S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSJBCMA1",164,0)
 S IEN=+Y
"RTN","PSJBCMA1",165,0)
 S NAME=$G(Y(0,0))
"RTN","PSJBCMA1",166,0)
 S INIT=$P($G(Y(0)),U,2)
"RTN","PSJBCMA1",167,0)
 Q
"RTN","PSJBCMA1",168,0)
 ;
"RTN","PSJBCMA1",169,0)
DATE(Y) ; FM internal date/time to user readable, 4 digit year
"RTN","PSJBCMA1",170,0)
 ; Y - date in FileMan internal format
"RTN","PSJBCMA1",171,0)
 I $G(Y) S Y=Y_$E(".",Y'[".")_"0000" Q $E(Y,4,5)_"/"_$E(Y,6,7)_"/"_($E(Y,1,3)+1700)_"  "_$E(Y,9,10)_":"_$E(Y,11,12)
"RTN","PSJBCMA1",172,0)
 Q "********"
"RTN","PSJBCMA1",173,0)
 ;
"RTN","PSJBCMA1",174,0)
STATUS(ON,X)          ;
"RTN","PSJBCMA1",175,0)
 ; ON = IEN_"I/U/P"
"RTN","PSJBCMA1",176,0)
 ; X  = STATUS
"RTN","PSJBCMA1",177,0)
 I X="P" Q $S(ON["P":"PENDING",ON["V":"PURGE",1:"NOT FOUND")
"RTN","PSJBCMA1",178,0)
 Q $S(X="A":"ACTIVE",X="D":"DISCONTINUED",X="E":"EXPIRED",X="H":"HOLD",X="R":"RENEWED",X="RE":"REINSTATED",X="N":"NON-VERFIED",X="DE":"DISCONTINUED (EDIT)",X="O":"ON CALL",1:"NOT FOUND")
"RTN","PSJBCMA1",179,0)
 ;
"RTN","PSJBCMA1",180,0)
ADMIN(X) ;
"RTN","PSJBCMA1",181,0)
 NEW Y,PSJADM,PSJX S PSJADM=""
"RTN","PSJBCMA1",182,0)
 I X="" Q ""
"RTN","PSJBCMA1",183,0)
 F Y=1:1:$L(X,"-") S PSJX=$E($P(X,"-",Y)_"0000",1,4) D
"RTN","PSJBCMA1",184,0)
 . S PSJADM=PSJADM_$S(PSJADM]"":"-",1:"")_PSJX
"RTN","PSJBCMA1",185,0)
 Q PSJADM
"RTN","PSJBCMA1",186,0)
 ;
"RTN","PSJBCMA1",187,0)
MVOPIAL(DFN,PSJI1,PSJI2) ; Move Other Print Info Activity log entries from NV order to Active order, during Verification
"RTN","PSJBCMA1",188,0)
 Q:'$G(DFN)!'$G(PSJI1)!'$G(PSJI2)  Q:'$D(^PS(55,DFN,"IV",+PSJI2,0))
"RTN","PSJBCMA1",189,0)
 I PSJI1["P",PSJI2["V" N AL,ALND,PNDND0,TXTLN,TXTCNT S AL=0,ALND=0 F  S AL=$O(^PS(53.1,+PSJI1,"A",AL)) Q:'AL  I ^(AL,0)["OTHER PRINT INFO" D
"RTN","PSJBCMA1",190,0)
 .Q:'$D(^PS(53.1,+PSJI1,"A",AL,1,0))  ; Don't retain activity log entry if no text
"RTN","PSJBCMA1",191,0)
 .S PNDND0=$G(^PS(53.1,+PSJI1,"A",AL,0)) N USER,NAME S USER=$P(PNDND0,"^",2) D NAME^PSGSICH(USER,.NAME)
"RTN","PSJBCMA1",192,0)
 .N AL2 S AL2=$O(^PS(55,DFN,"IV",+PSJI2,"A"," "),-1)+1 N OPILIN S OPILIN=+$O(^PS(53.1,+PSJI1,"A",AL,1,""),-1)
"RTN","PSJBCMA1",193,0)
 .S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,0)=AL_"^E^"_NAME_"^^"_$P(PNDND0,"^")_"^"_USER,^PS(55,DFN,"IV",+PSJI2,"A",AL2,1,0)="^55.151^1^1"
"RTN","PSJBCMA1",194,0)
 .S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,1,1,0)="OTHER PRINT INFO"
"RTN","PSJBCMA1",195,0)
 .S TXTLN=0 F TXTCNT=0:1 S TXTLN=$O(^PS(53.1,+PSJI1,"A",AL,1,TXTLN)) Q:'TXTLN  D
"RTN","PSJBCMA1",196,0)
 ..S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,2,TXTLN,0)=^PS(53.1,+PSJI1,"A",AL,1,TXTLN,0)
"RTN","PSJBCMA1",197,0)
 .I $G(TXTCNT) S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,2,0)="^^"_+$G(TXTCNT)_"^"_$G(TXTCNT)_"^"_+$G(^PS(53.1,+PSJI1,"A",AL,0)) D
"RTN","PSJBCMA1",198,0)
 ..S ^PS(55,DFN,"IV",+PSJI2,"A",AL2,1,1,0)="OTHER PRINT INFO"
"RTN","PSJBCMA1",199,0)
 Q
"RTN","PSJBCMA1",200,0)
 ;
"RTN","PSJBCMA1",201,0)
OPIWARN(AFTER) ; Warn user about OPI not printing on IV labels
"RTN","PSJBCMA1",202,0)
 N DIR S DIR=""
"RTN","PSJBCMA1",203,0)
 N PSJSTARZ S $P(PSJSTARZ,"*",69)="*" W !!?5,$E(PSJSTARZ,1,29)," WARNING ",$E(PSJSTARZ,1,31)
"RTN","PSJBCMA1",204,0)
 W !?5,"**",$S(AFTER:"       ",1:"      If "),"OTHER PRINT INFO exceeds one line of 60 characters"_$S(AFTER:"!       **",1:",     **")
"RTN","PSJBCMA1",205,0)
 W !?5,"**  'Instructions too long. See Order View or BCMA for full text.' **"
"RTN","PSJBCMA1",206,0)
 W !?5,"**      will print on the IV label instead of the full text.       **",!?5,PSJSTARZ
"RTN","PSJBCMA1",207,0)
 W !! D PAUSE^VALM1
"RTN","PSJBCMA1",208,0)
 Q
"RTN","PSJBCMA2")
0^77^B57484334^B5529154
"RTN","PSJBCMA2",1,0)
PSJBCMA2 ;BIR/MV-RETURN INPATIENT ACTIVITY LOG ;16 Mar 99 / 11:43 AM
"RTN","PSJBCMA2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**32,41,54,56,81,267**;16 DEC 97;Build 158
"RTN","PSJBCMA2",3,0)
 ;
"RTN","PSJBCMA2",4,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJBCMA2",5,0)
 ;
"RTN","PSJBCMA2",6,0)
EN(DFN,ON,PSJTMP)         ;
"RTN","PSJBCMA2",7,0)
 NEW X,Y
"RTN","PSJBCMA2",8,0)
 S PSJINX=0
"RTN","PSJBCMA2",9,0)
 S PSJTMP=$S($G(PSJTMP)=1:"PSJ2",1:"PSJ")
"RTN","PSJBCMA2",10,0)
 I $G(ON)["U",$D(^PS(55,+$G(DFN),5,+ON)) D UD
"RTN","PSJBCMA2",11,0)
 I $G(ON)["V",$D(^PS(55,+$G(DFN),"IV",+ON)) D IV
"RTN","PSJBCMA2",12,0)
 I '$D(^TMP(PSJTMP,$J,0)) S ^(0)=-1
"RTN","PSJBCMA2",13,0)
 K PSJINX
"RTN","PSJBCMA2",14,0)
 Q
"RTN","PSJBCMA2",15,0)
UD ;Get Activity Log for Unit Dose order.
"RTN","PSJBCMA2",16,0)
 N PSJVFDTM
"RTN","PSJBCMA2",17,0)
 F PSJAL=0:0 S PSJAL=$O(^PS(55,DFN,5,+ON,9,PSJAL)) Q:'PSJAL  D
"RTN","PSJBCMA2",18,0)
 . S X=$G(^PS(55,DFN,5,+ON,9,PSJAL,0))
"RTN","PSJBCMA2",19,0)
 . S PSJ("DATE")=$P(X,U)
"RTN","PSJBCMA2",20,0)
 . S (PSJ("USER"),PSJ("UIEN"))=$P(X,U,2),PSJ("FIELD")=$P(X,U,4)
"RTN","PSJBCMA2",21,0)
 . S PSJ("OLD DATA")=$P(X,U,5)
"RTN","PSJBCMA2",22,0)
 . S PSJ("ACTION")=$P($G(^PS(53.3,+$P(X,U,3),0)),U)
"RTN","PSJBCMA2",23,0)
 . I PSJ("ACTION")="VERIFIED BY PHARMACIST" S PSJVFDTM=PSJ("DATE")
"RTN","PSJBCMA2",24,0)
 . I PSJ("FIELD")="SPECIAL INSTRUCTIONS",PSJ("ACTION")="EDITED" Q:PSJ("DATE")=$G(PSJVFDTM)
"RTN","PSJBCMA2",25,0)
 . D TMP K PSJ
"RTN","PSJBCMA2",26,0)
 K PSJAL
"RTN","PSJBCMA2",27,0)
 Q
"RTN","PSJBCMA2",28,0)
IV ;Get Activity Log for IV order.
"RTN","PSJBCMA2",29,0)
 F PSJAL=0:0 S PSJAL=$O(^PS(55,DFN,"IV",+ON,"A",PSJAL)) Q:'PSJAL  D
"RTN","PSJBCMA2",30,0)
 . K PSJ,PSJDD
"RTN","PSJBCMA2",31,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,"A",PSJAL,0))
"RTN","PSJBCMA2",32,0)
 . S PSJ("DATE")=$P(X,U,5)
"RTN","PSJBCMA2",33,0)
 . S PSJ("ACTION")=$P(X,U,2) Q:PSJ("ACTION")="F"
"RTN","PSJBCMA2",34,0)
 . S PSJ("USER")=$P(X,U,3)
"RTN","PSJBCMA2",35,0)
 . S PSJ("REASON")=$P(X,U,4)
"RTN","PSJBCMA2",36,0)
 . S PSJ("ACTION")=$$CODES^PSIVUTL(PSJ("ACTION"),55.04,.02)
"RTN","PSJBCMA2",37,0)
 . S PSJ("UIEN")=$P(X,U,6)
"RTN","PSJBCMA2",38,0)
 . I PSJAL=1,($G(^PS(55,DFN,"IV",+ON,"A",PSJAL,1,1,0))["OTHER PRINT INFO") Q
"RTN","PSJBCMA2",39,0)
 . I $O(^PS(55,DFN,"IV",+ON,"A",PSJAL,1,0))="" D TMP
"RTN","PSJBCMA2",40,0)
 . F PSJFC=0:0 S PSJFC=$O(^PS(55,DFN,"IV",+ON,"A",PSJAL,1,PSJFC)) Q:'PSJFC  D
"RTN","PSJBCMA2",41,0)
 .. S X=$G(^PS(55,DFN,"IV",+ON,"A",PSJAL,1,PSJFC,0))
"RTN","PSJBCMA2",42,0)
 .. K PSJ("FIELD"),PSJ("OLD DATA")
"RTN","PSJBCMA2",43,0)
 .. S PSJ("FIELD")=$P(X,U)
"RTN","PSJBCMA2",44,0)
 .. S PSJ("OLD DATA")=$P(X,U,2)
"RTN","PSJBCMA2",45,0)
 .. D TMP
"RTN","PSJBCMA2",46,0)
 K PSJ,PSJAL,PSJFC
"RTN","PSJBCMA2",47,0)
 Q
"RTN","PSJBCMA2",48,0)
TMP ;Setup ^TMP
"RTN","PSJBCMA2",49,0)
 S PSJINX=PSJINX+1
"RTN","PSJBCMA2",50,0)
 I +PSJ("USER") D NAME^PSJBCMA1(+PSJ("USER"),.X,"") S PSJ("USER")=X
"RTN","PSJBCMA2",51,0)
 S ^TMP(PSJTMP,$J,0)=DFN_U_+ON_U_ON_U_PSJINX
"RTN","PSJBCMA2",52,0)
 S ^TMP(PSJTMP,$J,PSJINX,1)=PSJ("DATE")_U_PSJ("USER")_U_$G(PSJ("FIELD"))_U_PSJ("ACTION")_U_$G(PSJ("UIEN"))
"RTN","PSJBCMA2",53,0)
 S:$G(PSJ("OLD DATA"))]"" ^TMP(PSJTMP,$J,PSJINX,2)=PSJ("OLD DATA")
"RTN","PSJBCMA2",54,0)
 S:$G(PSJ("REASON"))]"" ^TMP(PSJTMP,$J,PSJINX,3)=PSJ("REASON")
"RTN","PSJBCMA2",55,0)
 Q
"RTN","PSJBCMA2",56,0)
GETFLD  ;
"RTN","PSJBCMA2",57,0)
 N X D FIELD^DID(55.04,.02,"","POINTER","PSJDD") Q
"RTN","PSJBCMA2",58,0)
 Q
"RTN","PSJBCMA2",59,0)
 ;
"RTN","PSJBCMA2",60,0)
FILESI(DFN,PSJORD) ; File special instructions
"RTN","PSJBCMA2",61,0)
 I PSJORD["U" S LN=0 D
"RTN","PSJBCMA2",62,0)
 .K ^PS(55,DFN,5,+PSJORD,15) I ($G(^PS(53.45,+$G(PSJSYSP),5,0))<0) S ^PS(55,DFN,5,+PSJORD,6)="" Q
"RTN","PSJBCMA2",63,0)
 .I '$D(^PS(55,DFN,5,+PSJORD,15,1,0)),($O(^PS(53.45,+$G(PSJSYSP),5," "),-1)=1) Q:($TR(^PS(53.45,PSJSYSP,5,1,0)," ")="")
"RTN","PSJBCMA2",64,0)
 .S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.45,+$G(PSJSYSP),5,LN),-1) Q:'LN  D
"RTN","PSJBCMA2",65,0)
 ..I 'LNCNT,($G(^PS(53.45,+$G(PSJSYSP),5,LN,0))="") Q
"RTN","PSJBCMA2",66,0)
 ..I $D(^PS(53.45,+$G(PSJSYSP),5,LN,0)) S ^PS(55,+DFN,5,+PSJORD,15,LN,0)=^PS(53.45,+$G(PSJSYSP),5,LN,0) S LNCNT=LNCNT+1
"RTN","PSJBCMA2",67,0)
 .I $G(LNCNT) S ^PS(55,+DFN,5,+PSJORD,15,0)="^55.6135^"_+LNCNT_"^"_+LNCNT D
"RTN","PSJBCMA2",68,0)
 ..N TXT,SIMSG S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA2",69,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(55,+DFN,5,+PSJORD,15,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA2",70,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(55,+DFN,5,+PSJORD,15,TMPLIN,0))))>180 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(55,+DFN,5,+PSJORD,15,TMPLIN,0))
"RTN","PSJBCMA2",71,0)
 ..S TXT=$S($G(PSJOVRMX):SIMSG,1:PSJTMPTX)
"RTN","PSJBCMA2",72,0)
 ..I $G(DFN) I $D(^PS(55,DFN,5,+PSJORD,0)) S ^PS(55,DFN,5,+PSJORD,6)=TXT_"^"_$S($G(PSGSIF):1,1:"")
"RTN","PSJBCMA2",73,0)
 .N LSTLNUM,LSTLNTXT S LSTLNUM=$O(^PS(55,+DFN,5,+PSJORD,15,""),-1) I LSTLNUM>1 S LSTLNTXT=$G(^PS(55,+DFN,5,+PSJORD,15,LSTLNUM,0)) I $TR(LSTLNTXT," ")="" D
"RTN","PSJBCMA2",74,0)
 ..K ^PS(55,+DFN,5,+PSJORD,15,LSTLNUM,0)
"RTN","PSJBCMA2",75,0)
 I PSJORD["P" S LN=0 D
"RTN","PSJBCMA2",76,0)
 .N PSGSIF S PSGSIF=+$P($G(^PS(53.1,+PSJORD,6)),"^",2)
"RTN","PSJBCMA2",77,0)
 .K ^PS(53.1,+PSJORD,15) I ($G(^PS(53.45,+$G(PSJSYSP),5,0))<0) S ^PS(53.1,+PSJORD,6)="",^PS(53.1,+PSJORD,15,0)="^53.1135^0^0" Q
"RTN","PSJBCMA2",78,0)
 .I '$D(^PS(53.1,+PSJORD,15,1,0)),($O(^PS(53.45,+$G(PSJSYSP),5," "),-1)=1) Q:($TR(^PS(53.45,PSJSYSP,5,1,0)," ")="")
"RTN","PSJBCMA2",79,0)
 .S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.45,+$G(PSJSYSP),5,LN),-1) Q:'LN  D
"RTN","PSJBCMA2",80,0)
 ..I 'LNCNT,($G(^PS(53.45,+$G(PSJSYSP),5,LN,0))="") Q
"RTN","PSJBCMA2",81,0)
 ..I $D(^PS(53.45,+$G(PSJSYSP),5,LN,0)) S ^PS(53.1,+PSJORD,15,LN,0)=^PS(53.45,+$G(PSJSYSP),5,LN,0) S LNCNT=LNCNT+1
"RTN","PSJBCMA2",82,0)
 .I $G(LNCNT) S ^PS(53.1,+PSJORD,15,0)="^53.1135^"_+LNCNT_"^"_+LNCNT D
"RTN","PSJBCMA2",83,0)
 ..N TXT,SIMSG S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA2",84,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.1,+PSJORD,15,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA2",85,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(53.1,+PSJORD,15,TMPLIN,0))))>180 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.1,+PSJORD,15,TMPLIN,0))
"RTN","PSJBCMA2",86,0)
 ..S TXT=$S($G(PSJOVRMX):SIMSG,1:PSJTMPTX)
"RTN","PSJBCMA2",87,0)
 ..I $D(^PS(53.1,+$G(PSJORD),0)) S ^PS(53.1,+PSJORD,6)=TXT_"^"_$S($G(PSGSIF):1,1:"")
"RTN","PSJBCMA2",88,0)
 .N LSTLNUM,LSTLNTXT S LSTLNUM=$O(^PS(53.1,+PSJORD,""),-1) I LSTLNUM>1 S LSTLNTXT=$G(^PS(53.1,+PSJORD,15,LSTLNUM,0)) I $TR(LSTLNTXT," ")="" D
"RTN","PSJBCMA2",89,0)
 ..K ^PS(53.1,+PSJORD,15,LSTLNUM,0)
"RTN","PSJBCMA2",90,0)
 Q
"RTN","PSJBCMA2",91,0)
FILEOPI(DFN,ORDER) ; File other print info
"RTN","PSJBCMA2",92,0)
 I PSJORD["V" S LN=0 D
"RTN","PSJBCMA2",93,0)
 .D LOGOPI^PSIVORFB(DFN,ORDER)
"RTN","PSJBCMA2",94,0)
 .K ^PS(55,+DFN,"IV",+PSJORD,10) S ^PS(55,+DFN,"IV",+PSJORD,3)="" I '$D(^PS(53.45,+$G(PSJSYSP),6,2,0))&(($G(^PS(53.45,+$G(PSJSYSP),6,1,0))=-1)!($G(^PS(53.45,+$G(PSJSYSP),6,0))=-1)) D  Q
"RTN","PSJBCMA2",95,0)
 ..S ^PS(55,+DFN,"IV",+PSJORD,10,0)="^55.1154^1^1",^PS(55,+DFN,"IV",PSJORD,10,1,0)=""
"RTN","PSJBCMA2",96,0)
 .I '$D(^PS(55,DFN,"IV",+PSJORD,10,1,0)),($O(^PS(53.45,+$G(PSJSYSP),6," "),-1)=1) I ($TR(^PS(53.45,PSJSYSP,6,1,0)," ")="") D  Q
"RTN","PSJBCMA2",97,0)
 ..S ^PS(55,+DFN,"IV",+PSJORD,10,0)="^55.1154^1^1",^PS(55,+DFN,"IV",+PSJORD,10,1,0)=""
"RTN","PSJBCMA2",98,0)
 .S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.45,+$G(PSJSYSP),6,LN),-1) Q:'LN  D
"RTN","PSJBCMA2",99,0)
 ..I 'LNCNT,($G(^PS(53.45,+$G(PSJSYSP),6,LN,0))="") Q
"RTN","PSJBCMA2",100,0)
 ..I $D(^PS(53.45,+$G(PSJSYSP),6,LN,0)) S ^PS(55,+DFN,"IV",+PSJORD,10,LN,0)=^PS(53.45,+$G(PSJSYSP),6,LN,0) S LNCNT=LNCNT+1
"RTN","PSJBCMA2",101,0)
 .I LNCNT S ^PS(55,+DFN,"IV",+PSJORD,10,0)="^55.1154^"_+LNCNT_"^"_+LNCNT D
"RTN","PSJBCMA2",102,0)
 ..N TXT,DIE,DA,OPIMSG S OPIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA2",103,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(55,+DFN,"IV",+PSJORD,10,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA2",104,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(55,DFN,"IV",+PSJORD,10,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(55,DFN,"IV",+PSJORD,10,TMPLIN,0))
"RTN","PSJBCMA2",105,0)
 ..S TXT=$S($G(PSJOVRMX):OPIMSG,1:$G(PSJTMPTX))
"RTN","PSJBCMA2",106,0)
 ..I $TR(TXT,"^ ")="" S ^PS(55,DFN,"IV",+PSJORD,3)="" Q
"RTN","PSJBCMA2",107,0)
 ..S ^PS(55,DFN,"IV",+PSJORD,3)=TXT_"^"_$P($G(P("OPI")),"^",2)
"RTN","PSJBCMA2",108,0)
 I PSJORD["P" D
"RTN","PSJBCMA2",109,0)
 .I $D(^PS(53.1,+PSJORD,16)),$$DIFFOPI^PSJBCMA5(DFN,PSJORD) D
"RTN","PSJBCMA2",110,0)
 ..N SIARRAY,PSJALORD M SIARRAY=^PS(53.1,+PSJORD,16),PSJALORD=PSJORD I '$D(SIARRAY) S SIARRAY(0)="^^1^1",SIARRAY(1,0)=" "
"RTN","PSJBCMA2",111,0)
 ..D NEWNVAL^PSGAL5(PSJORD,6000,"OTHER PRINT INFO",,.SIARRAY)
"RTN","PSJBCMA2",112,0)
 .K ^PS(53.1,+PSJORD,16) I ('$D(^PS(53.45,+$G(PSJSYSP),6,2,0))&($TR($G(^PS(53.45,+$G(PSJSYSP),6,1,0)),"^ ")=""))!+($G(^PS(53.45,+$G(PSJSYSP),6,0))=-1) D  Q
"RTN","PSJBCMA2",113,0)
 ..S ^PS(53.1,+PSJORD,9)="",^PS(53.1,+PSJORD,16,0)="^53.1136^1^1",^PS(53.1,+PSJORD,16,1,0)=""
"RTN","PSJBCMA2",114,0)
 .I '$D(^PS(53.1,+PSJORD,16,1,0)),($O(^PS(53.45,+$G(PSJSYSP),6," "),-1)=1) I ($TR(^PS(53.45,PSJSYSP,6,1,0)," ")="") D  Q
"RTN","PSJBCMA2",115,0)
 ..S ^PS(53.1,+PSJORD,9)="",^PS(53.1,+PSJORD,16,0)="^53.1136^1^1",^PS(53.1,+PSJORD,16,1,0)=""
"RTN","PSJBCMA2",116,0)
 .S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.45,+PSJSYSP,6,LN),-1) Q:'LN  D
"RTN","PSJBCMA2",117,0)
 ..I 'LNCNT,($G(^PS(53.45,+PSJSYSP,6,LN,0))="") Q
"RTN","PSJBCMA2",118,0)
 ..I $D(^PS(53.45,+PSJSYSP,6,LN,0)) S ^PS(53.1,+PSJORD,16,LN,0)=^PS(53.45,+PSJSYSP,6,LN,0) S LNCNT=LNCNT+1
"RTN","PSJBCMA2",119,0)
 .I $G(LNCNT) S ^PS(53.1,+PSJORD,16,0)="^53.1136^"_+LNCNT_"^"_+LNCNT D
"RTN","PSJBCMA2",120,0)
 ..N TXT,DIE,DA,OPIMSG S OPIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA2",121,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.1,+PSJORD,16,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA2",122,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(53.1,+PSJORD,16,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.1,+PSJORD,16,TMPLIN,0))
"RTN","PSJBCMA2",123,0)
 ..S TXT=$S($G(PSJOVRMX):OPIMSG,1:$G(PSJTMPTX))
"RTN","PSJBCMA2",124,0)
 ..S $P(^PS(53.1,+PSJORD,9),"^",2)=TXT,$P(^PS(53.1,+PSJORD,9),"^",3)=$P($G(P("OPI")),"^",2)
"RTN","PSJBCMA2",125,0)
 Q
"RTN","PSJBCMA5")
0^32^B78422093^n/a
"RTN","PSJBCMA5",1,0)
PSJBCMA5 ;BIR/JCH-RETRIEVE SPECIAL INSTRUCTIONS/OTHER PRINT INFO ; 1/9/12 11:12am
"RTN","PSJBCMA5",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**267**;16 DEC 97;Build 158
"RTN","PSJBCMA5",3,0)
 ;
"RTN","PSJBCMA5",4,0)
 ;Reference to ^DPT is supported by DBIA 10035
"RTN","PSJBCMA5",5,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJBCMA5",6,0)
 ;Reference to ^%DTC is supported by DBIA 10000
"RTN","PSJBCMA5",7,0)
 ;Reference to ^DIE is supported by DBIA 10018
"RTN","PSJBCMA5",8,0)
 ;Reference to ^DIQ is supported by DBIA 2056
"RTN","PSJBCMA5",9,0)
 ;
"RTN","PSJBCMA5",10,0)
GETSIOPI(DFN,ON,BCMA) ; Get appropriate field depending on order type
"RTN","PSJBCMA5",11,0)
 ; DFN - Patient IEN
"RTN","PSJBCMA5",12,0)
 ; ON - Inpatient Order number
"RTN","PSJBCMA5",13,0)
 ; BCMA - Flag indicating called from BCMA - return data in ^TMP("PSJBCMA",$J
"RTN","PSJBCMA5",14,0)
 ;
"RTN","PSJBCMA5",15,0)
 I 'ON!'DFN Q 0
"RTN","PSJBCMA5",16,0)
 K ^TMP("PSJBCMA5",$J,DFN,ON)
"RTN","PSJBCMA5",17,0)
 I $G(BCMA) D  Q +$G(^TMP("PSJBCMA5",$J,DFN,ON))
"RTN","PSJBCMA5",18,0)
 .N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",19,0)
 .I ON["V"!((ON["P")&($D(^PS(53.1,+ON,"AD"))!$D(^PS(53.1,+ON,"SOL")))) D  Q
"RTN","PSJBCMA5",20,0)
 ..I $$GETOPI(DFN,ON,1) D MOVETMP(DFN,ON,"IV")
"RTN","PSJBCMA5",21,0)
 .I $$GETSI(DFN,ON,1) D MOVETMP(DFN,ON,"UD")
"RTN","PSJBCMA5",22,0)
 I ON["V"!((ON["P")&($D(^PS(53.1,+ON,"AD"))!$D(^PS(53.1,+ON,"SOL")))) Q $$GETOPI(DFN,ON)
"RTN","PSJBCMA5",23,0)
 Q $$GETSI(DFN,ON)
"RTN","PSJBCMA5",24,0)
 ;
"RTN","PSJBCMA5",25,0)
MOVETMP(DFN,ON,OTYP) ; Move text from PS(53.45 to ^TMP for BCMA
"RTN","PSJBCMA5",26,0)
 N LN,ND S ND=$S(OTYP="IV":6,1:5)
"RTN","PSJBCMA5",27,0)
 I $O(^PS(53.45,PSJSYSP,ND," "),-1)=1,$TR(^PS(53.45,PSJSYSP,ND,1,0)," ")="" K ^TMP("PSJBCMA5",$J) Q
"RTN","PSJBCMA5",28,0)
 S ^TMP("PSJBCMA5",$J,DFN,ON)=+$P(^PS(53.45,PSJSYSP,ND,0),"^",3) S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,ND,LN)) Q:'LN  D
"RTN","PSJBCMA5",29,0)
 .S ^TMP("PSJBCMA5",$J,DFN,ON,LN)=^PS(53.45,PSJSYSP,ND,LN,0)
"RTN","PSJBCMA5",30,0)
 K ^PS(53.45,PSJSYSP,ND)
"RTN","PSJBCMA5",31,0)
 Q
"RTN","PSJBCMA5",32,0)
 ;
"RTN","PSJBCMA5",33,0)
GETSI(DFN,ON,BC) ; Get Special Instructions for Unit Dose orders
"RTN","PSJBCMA5",34,0)
 N PSJTXT,TXTLN
"RTN","PSJBCMA5",35,0)
 I $G(DFN)=""!($G(ON)="") Q 0
"RTN","PSJBCMA5",36,0)
 I ON["P" D  Q +$P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",37,0)
 .Q:($G(^PS(53.45,+PSJSYSP,5,0))="^^0^0")
"RTN","PSJBCMA5",38,0)
 .I $P($G(^PS(53.1,+ON,15,0)),"^",3) D  Q
"RTN","PSJBCMA5",39,0)
 ..S ^PS(53.45,+PSJSYSP,5,0)=^PS(53.1,+ON,15,0)
"RTN","PSJBCMA5",40,0)
 ..S LN=0 F  S LN=$O(^PS(53.1,+ON,15,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,5,LN,0)=^PS(53.1,+ON,15,LN,0)
"RTN","PSJBCMA5",41,0)
 .N OLDSI,MARX,TXTCNT S OLDSI=$P($G(^PS(53.1,+ON,6)),"^") I $L(OLDSI)>0 D  Q
"RTN","PSJBCMA5",42,0)
 ..I $G(BC),$L(OLDSI)>74 D TXT^PSGMUTL(OLDSI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,5,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",43,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,5,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",44,0)
 ..S ^PS(53.45,+PSJSYSP,5,1,0)=$P(^PS(53.1,+ON,6),"^"),^PS(53.45,+PSJSYSP,5,0)="^^1^1"
"RTN","PSJBCMA5",45,0)
 I ON["U" D  Q $P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",46,0)
 .Q:($G(^PS(53.45,+PSJSYSP,5,0))="^^0^0")
"RTN","PSJBCMA5",47,0)
 .I $P($G(^PS(55,+DFN,5,+ON,15,0)),"^",3) D  Q
"RTN","PSJBCMA5",48,0)
 ..S ^PS(53.45,+PSJSYSP,5,0)=$G(^PS(55,DFN,5,+ON,15,0))
"RTN","PSJBCMA5",49,0)
 ..S LN=0 F  S LN=$O(^PS(55,DFN,5,+ON,15,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,5,LN,0)=^PS(55,DFN,5,+ON,15,LN,0)
"RTN","PSJBCMA5",50,0)
 .N OLDSI,MARX,TXTCNT S OLDSI=$P($G(^PS(55,DFN,5,+ON,6)),"^") I $L(OLDSI)>0 D  Q
"RTN","PSJBCMA5",51,0)
 ..I $G(BC),$L(OLDSI)>74 D TXT^PSGMUTL(OLDSI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,5,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",52,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,5,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",53,0)
 ..S ^PS(53.45,+PSJSYSP,5,1,0)=$P(^PS(55,DFN,5,+ON,6),"^"),^PS(53.45,+PSJSYSP,5,0)="^^1^1"
"RTN","PSJBCMA5",54,0)
 Q 0
"RTN","PSJBCMA5",55,0)
 ;
"RTN","PSJBCMA5",56,0)
GETOPI(DFN,ON,BC) ; Get Other Print Info for IV orders
"RTN","PSJBCMA5",57,0)
 N PSJTXT,LN
"RTN","PSJBCMA5",58,0)
 I $G(DFN)=""!($G(ON)="") Q 0
"RTN","PSJBCMA5",59,0)
 I ON["P" D  Q +$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",60,0)
 .Q:$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",61,0)
 .I $P($G(^PS(53.1,+ON,16,0)),"^",3) D  Q
"RTN","PSJBCMA5",62,0)
 ..S ^PS(53.45,+PSJSYSP,6,0)=^PS(53.1,+ON,16,0)
"RTN","PSJBCMA5",63,0)
 ..S LN=0 F  S LN=$O(^PS(53.1,+ON,16,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,6,LN,0)=^PS(53.1,+ON,16,LN,0)
"RTN","PSJBCMA5",64,0)
 .N OLDOPI,MARX,TXTCNT S OLDOPI=$P($G(^PS(53.1,+ON,9)),"^",2) I $L(OLDOPI)>0 D  Q
"RTN","PSJBCMA5",65,0)
 ..I $G(BC),$L(OLDOPI)>74 D TXT^PSGMUTL(OLDOPI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,6,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",66,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,6,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",67,0)
 ..S ^PS(53.45,+PSJSYSP,6,1,0)=$P(^PS(53.1,+ON,9),"^",2),^PS(53.45,+PSJSYSP,6,0)="^^1^1"
"RTN","PSJBCMA5",68,0)
 I ON["V" D
"RTN","PSJBCMA5",69,0)
 .Q:$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",70,0)
 .I $P($G(^PS(55,+DFN,"IV",+ON,10,0)),"^",3) D  Q
"RTN","PSJBCMA5",71,0)
 ..S ^PS(53.45,+PSJSYSP,6,0)=$G(^PS(55,DFN,"IV",+ON,10,0))
"RTN","PSJBCMA5",72,0)
 ..S LN=0 F  S LN=$O(^PS(55,DFN,"IV",+ON,10,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,6,LN,0)=^PS(55,DFN,"IV",+ON,10,LN,0)
"RTN","PSJBCMA5",73,0)
 .N OLDOPI,MARX,TXTCNT S OLDOPI=$P($G(^PS(55,DFN,"IV",+ON,3)),"^") I $L(OLDOPI)>0 D  Q
"RTN","PSJBCMA5",74,0)
 ..I $G(BC),$L(OLDOPI)>74 D TXT^PSGMUTL(OLDOPI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,6,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",75,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,6,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",76,0)
 ..S ^PS(53.45,+PSJSYSP,6,1,0)=$P(^PS(55,DFN,"IV",+ON,3),"^"),^PS(53.45,+PSJSYSP,6,0)="^^1^1"
"RTN","PSJBCMA5",77,0)
 I $O(^PS(53.45,+PSJSYSP,6," "),-1)=1,($TR(^PS(53.45,+PSJSYSP,6,1,0)," ")="") K ^PS(53.45,+PSJSYSP,6)
"RTN","PSJBCMA5",78,0)
 Q +$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",79,0)
 ;
"RTN","PSJBCMA5",80,0)
EDITSI(DFN,PSJORD) ; Edit Special Instructions in ^PS(53.45 via Word Processing
"RTN","PSJBCMA5",81,0)
 N PSJII,DIC,I,PSJVALID,DIWESUB,PSJTXTLN S PSJVALID=0,DIC="^PS(53.45,"_+$G(PSJSYSP)_",5,",DIWESUB="SPECIAL INSTRUCTIONS"
"RTN","PSJBCMA5",82,0)
 I $G(PSJORD) I '$P($G(^PS(53.45,+$G(PSJSYSP),5,0)),"^",5) S L=$$GETSI(DFN,PSJORD)
"RTN","PSJBCMA5",83,0)
 K ^TMP("PSJTMPSI",$J) M ^TMP("PSJTMPSI",$J)=^PS(53.45,+$G(PSJSYSP),5)
"RTN","PSJBCMA5",84,0)
 F PSJII=1:1 Q:$G(PSJVALID)  D
"RTN","PSJBCMA5",85,0)
 .N II,L,DIR,DIE,DA,TMPLN,DR S PSJTXTLN="",PSJVALID=1,DIWESUB="SPECIAL INSTRUCTIONS"
"RTN","PSJBCMA5",86,0)
 .I PSJII=1 S DA=PSJSYSP,DR=5,DIE="^PS(53.45," D ^DIE
"RTN","PSJBCMA5",87,0)
 .I PSJII>1 S DA=PSJSYSP,DR=5,DIC="^PS(53.45,"_+$G(PSJSYSP)_",5," D EN^DIWE
"RTN","PSJBCMA5",88,0)
 .S PSJTXTLN=+$P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",89,0)
 .S II=0 F  S II=$O(^PS(53.45,+PSJSYSP,5,II)) Q:'II!'$G(PSJVALID)  S TMPLN=$G(^(II,0)) I (TMPLN["^") S PSJVALID=0
"RTN","PSJBCMA5",90,0)
 .I 'PSJVALID W !!!,$C(7),"SPECIAL INSTRUCTIONS must not contain embedded uparrow ""^"". " I PSJII=1 D PAUSE("SPECIAL INSTRUCTIONS")
"RTN","PSJBCMA5",91,0)
 .I 'PSJVALID I PSJII>1 W ! I $$DONE("SPECIAL INSTRUCTIONS") K ^PS(53.45,+PSJSYSP,5) M ^PS(53.45,+$G(PSJSYSP),5)=^TMP("PSJTMPSI",$J) S PSJVALID=1 Q
"RTN","PSJBCMA5",92,0)
 .I PSJVALID I 'PSJTXTLN K ^PS(53.45,+PSJSYSP,5,0) S ^PS(53.45,+PSJSYSP,5,0)="-1^^0^0",^PS(53.45,+PSJSYSP,5,1,0)=""
"RTN","PSJBCMA5",93,0)
 I $P($G(^PS(53.45,+$G(PSJSYSP),5,0)),"^",3) D ENSI^PSJUTL("^PS(53.45,+$G(PSJSYSP),5,") S PSJTXTLN=$O(^PS(53.45,+$G(PSJSYSP),5,""),-1)
"RTN","PSJBCMA5",94,0)
 K ^TMP("PSJTMPSI",$J)
"RTN","PSJBCMA5",95,0)
 Q PSJTXTLN
"RTN","PSJBCMA5",96,0)
 ;
"RTN","PSJBCMA5",97,0)
EDITOPI(PSJDPT,PSJORD) ; Edit Other Print Info in ^PS(53.45 via Word Processing
"RTN","PSJBCMA5",98,0)
 N DIC,I,PSJVALID,DIWESUB,PSJTXTLN S PSJVALID=0,DIC="^PS(53.45,"_+$G(PSJSYSP)_",6,",DIWESUB="OTHER PRINT INFO"
"RTN","PSJBCMA5",99,0)
 K ^TMP("PSJTMPSI",$J) M ^TMP("PSJTMPSI",$J)=^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSJBCMA5",100,0)
 F PSJII=1:1 Q:$G(PSJVALID)  D
"RTN","PSJBCMA5",101,0)
 .N II,L,DIR,DA,DIE,TMPLN S DIR="",PSJTXTLN="",PSJVALID=1,DIWESUB="OTHER PRINT INFO"
"RTN","PSJBCMA5",102,0)
 .I PSJII=1 D OPIWARN(0)
"RTN","PSJBCMA5",103,0)
 .S PSJTXTLN=""
"RTN","PSJBCMA5",104,0)
 .I PSJII=1 S DA=PSJSYSP,DR=6,DIE="^PS(53.45," D ^DIE
"RTN","PSJBCMA5",105,0)
 .I PSJII>1 S DA=PSJSYSP,DR=6,DIC="^PS(53.45,"_+$G(PSJSYSP)_",6," D EN^DIWE
"RTN","PSJBCMA5",106,0)
 .S PSJTXTLN=$O(^PS(53.45,+PSJSYSP,6,""),-1)
"RTN","PSJBCMA5",107,0)
 .I PSJTXTLN="" K ^PS(53.45,+PSJSYSP,6) S ^PS(53.45,+PSJSYSP,6,0)="-1^^1^1",^PS(53.45,+PSJSYSP,6,1,0)=""
"RTN","PSJBCMA5",108,0)
 .S II=0 F  S II=$O(^PS(53.45,+PSJSYSP,6,II)) Q:'II!'$G(PSJVALID)  S TMPLN=$G(^(II,0)) I (TMPLN["^") S PSJVALID=0
"RTN","PSJBCMA5",109,0)
 .I 'PSJVALID W !!!,$C(7),"OTHER PRINT INFO must not contain embedded uparrow ""^""." I PSJII=1 D PAUSE("OTHER PRINT INFO")
"RTN","PSJBCMA5",110,0)
 .I 'PSJVALID I PSJII>1 W ! I $$DONE("OTHER PRINT INFO") K ^PS(53.45,+PSJSYSP,6) M ^PS(53.45,+$G(PSJSYSP),6)=^TMP("PSJTMPSI",$J) S PSJVALID=1 Q
"RTN","PSJBCMA5",111,0)
 .I PSJVALID D
"RTN","PSJBCMA5",112,0)
 ..I ($L($G(^PS(53.45,+PSJSYSP,6,1,0)))>60) D OPIWARN(1) S P("OPI")="Instructions too long. See Order View or BCMA for full text^"_$P(P("OPI"),"^",2) Q
"RTN","PSJBCMA5",113,0)
 ..I PSJTXTLN=1,($L($G(^PS(53.45,+PSJSYSP,6,1,0)))<61) S P("OPI")=^PS(53.45,+PSJSYSP,6,1,0)_"^"_$P(P("OPI"),"^",2) Q
"RTN","PSJBCMA5",114,0)
 ..N TXT,OPIMSG,PSJTMPTX,PSJOVRMX S OPIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA5",115,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.45,+PSJSYSP,6,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA5",116,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(53.45,+PSJSYSP,6,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.45,+PSJSYSP,6,TMPLIN,0))
"RTN","PSJBCMA5",117,0)
 ..I '$G(PSJOVRMX),(PSJTMPTX]"") S P("OPI")=PSJTMPTX_"^"_$P(P("OPI"),"^",2)
"RTN","PSJBCMA5",118,0)
 K ^TMP("PSJTMPSI",$J)
"RTN","PSJBCMA5",119,0)
 Q PSJTXTLN
"RTN","PSJBCMA5",120,0)
 ;
"RTN","PSJBCMA5",121,0)
OPIWARN(AFTER) ; Warn user about OPI not printing on IV labels
"RTN","PSJBCMA5",122,0)
 D OPIWARN^PSJBCMA1(AFTER)
"RTN","PSJBCMA5",123,0)
 Q
"RTN","PSJBCMA5",124,0)
 ;
"RTN","PSJBCMA5",125,0)
FILESI(DFN,PSJORD) ; File Special instrctions from ^PS(53.45 to UD order
"RTN","PSJBCMA5",126,0)
 N LN,LNCNT,DA,DIE,X,Y,PSJTMPTX,TMPLIN,PSJOVRMX
"RTN","PSJBCMA5",127,0)
 D FILESI^PSJBCMA2(DFN,PSJORD)
"RTN","PSJBCMA5",128,0)
 K ^PS(53.45,+$G(PSJSYSP),5)
"RTN","PSJBCMA5",129,0)
 Q
"RTN","PSJBCMA5",130,0)
 ;
"RTN","PSJBCMA5",131,0)
FILEOPI(DFN,ORDER) ; File Other Print Info from ^PS(53.45 to IV order
"RTN","PSJBCMA5",132,0)
 N LN,LNCNT,PSJORD S PSJORD=ORDER
"RTN","PSJBCMA5",133,0)
 D FILEOPI^PSJBCMA2(DFN,ORDER)
"RTN","PSJBCMA5",134,0)
 K ^PS(53.45,+PSJSYSP,6)
"RTN","PSJBCMA5",135,0)
 Q
"RTN","PSJBCMA5",136,0)
 ;
"RTN","PSJBCMA5",137,0)
DIFFSI(DFN,PSJORD) ; Compare Special Instructions, pre and post edit
"RTN","PSJBCMA5",138,0)
 N LN,DIFF S DIFF=0
"RTN","PSJBCMA5",139,0)
 S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,5,LN)) Q:'LN!DIFF  D
"RTN","PSJBCMA5",140,0)
 .I PSJORD["U" D
"RTN","PSJBCMA5",141,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(55,DFN,5,+PSJORD,15,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,5,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",142,0)
 ..I $G(^PS(53.45,PSJSYSP,5,LN,0))'=$G(^PS(55,DFN,5,+PSJORD,15,LN,0)) S DIFF=1
"RTN","PSJBCMA5",143,0)
 .I PSJORD["P" D
"RTN","PSJBCMA5",144,0)
 ..I LN=1 N OTOT,NTNT S OTOT=+$O(^PS(53.1,+PSJORD,15,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,5,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",145,0)
 ..I $G(^PS(53.45,PSJSYSP,5,LN,0))'=$G(^PS(53.1,+PSJORD,15,LN,0)) S DIFF=1
"RTN","PSJBCMA5",146,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",147,0)
 ;
"RTN","PSJBCMA5",148,0)
DIFFOPI(DFN,PSJORD) ; Compare Other Print Info, pre and post edit
"RTN","PSJBCMA5",149,0)
 N LN,DIFF S DIFF=0
"RTN","PSJBCMA5",150,0)
 S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,6,LN)) Q:'LN!DIFF  D
"RTN","PSJBCMA5",151,0)
 .I PSJORD["V" D
"RTN","PSJBCMA5",152,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(55,DFN,"IV",+PSJORD,10,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,6,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",153,0)
 ..I $G(^PS(53.45,PSJSYSP,6,LN,0))'=$G(^PS(55,DFN,"IV",+PSJORD,10,LN,0)) S DIFF=1
"RTN","PSJBCMA5",154,0)
 .I PSJORD["P" D
"RTN","PSJBCMA5",155,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(53.1,+PSJORD,16,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,6,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",156,0)
 ..I $G(^PS(53.45,PSJSYSP,6,LN,0))'=$G(^PS(53.1,+PSJORD,16,LN,0)) S DIFF=1
"RTN","PSJBCMA5",157,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",158,0)
 ;
"RTN","PSJBCMA5",159,0)
DIFFAR(ARRAY1,ARRAY2) ; Compare two text arrays
"RTN","PSJBCMA5",160,0)
 N LN,DIFF,OTOT,NTOT S DIFF=0,OTOT=0,NTOT=0
"RTN","PSJBCMA5",161,0)
 S LN=0 F  S LN=$O(ARRAY1(LN)) Q:'LN!DIFF  I ARRAY1(LN,0)'=$G(ARRAY2(LN,0)) S DIFF=1
"RTN","PSJBCMA5",162,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",163,0)
 ;
"RTN","PSJBCMA5",164,0)
MVOPI(DFN,PSJI1,PSJI2) ; Move OPI from Non-Verified order to Active order during Verify
"RTN","PSJBCMA5",165,0)
 Q:'$G(DFN)!'$G(PSJI1)!'$G(PSJI2)
"RTN","PSJBCMA5",166,0)
 I PSJI1["P",PSJI2["V" D GETOPI(DFN,PSJI1),FILEOPI(DFN,PSJI2)
"RTN","PSJBCMA5",167,0)
 Q
"RTN","PSJBCMA5",168,0)
 ;
"RTN","PSJBCMA5",169,0)
MVOPIAL(DFN,PSJI1,PSJI2) ; Move Other Print Info Activity log entries from NV order to Active order, during Verification
"RTN","PSJBCMA5",170,0)
 D MVOPIAL^PSJBCMA1(DFN,PSJI1,PSJI2)
"RTN","PSJBCMA5",171,0)
 Q
"RTN","PSJBCMA5",172,0)
 ;
"RTN","PSJBCMA5",173,0)
KILL(USR) ; Clean up ^PS(53.45
"RTN","PSJBCMA5",174,0)
 K ^PS(53.45,+$G(USR),5),^PS(53.45,+$G(USR),6)
"RTN","PSJBCMA5",175,0)
 Q
"RTN","PSJBCMA5",176,0)
 ;
"RTN","PSJBCMA5",177,0)
PAUSE(DEF) ;
"RTN","PSJBCMA5",178,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue editing "_$G(DEF)_"...",DIR("?")="Press Return to continue..." D ^DIR W !
"RTN","PSJBCMA5",179,0)
 Q
"RTN","PSJBCMA5",180,0)
 ;
"RTN","PSJBCMA5",181,0)
DONE(DEF) ; -- Done editing?
"RTN","PSJBCMA5",182,0)
 N DIR,X,Y
"RTN","PSJBCMA5",183,0)
 S DIR(0)="YA",DIR("A")="Do you want to quit and discard changes"_$S(($G(DEF)]""):" to "_DEF,1:"")_"? ",DIR("B")="NO"
"RTN","PSJBCMA5",184,0)
 S DIR("?",1)="    Enter YES to exit without saving changes, or ",DIR("?")="    enter NO to continue editing "_$S(($G(DEF)]""):DEF,1:"")_"."
"RTN","PSJBCMA5",185,0)
 D ^DIR
"RTN","PSJBCMA5",186,0)
 Q $S($E(Y)="^":1,1:+Y)
"RTN","PSJCOM")
0^62^B39982545^B38929893
"RTN","PSJCOM",1,0)
PSJCOM ;BIR/CML3-FINISH COMPLEX UNIT DOSE ORDERS ENTERED THROUGH OE/RR ;02 Feb 2001  12:20 PM
"RTN","PSJCOM",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,186,267**;16 DEC 97;Build 158
"RTN","PSJCOM",3,0)
 ;
"RTN","PSJCOM",4,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJCOM",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCOM",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSJCOM",7,0)
 ; Reference to ^%RCR is supported by DBIA 10022.
"RTN","PSJCOM",8,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOM",9,0)
 ; Reference to ^TIUEDIT is supported by DBIA 2410.
"RTN","PSJCOM",10,0)
 ;
"RTN","PSJCOM",11,0)
UPD ;
"RTN","PSJCOM",12,0)
 Q:'PSJCOM
"RTN","PSJCOM",13,0)
 M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM",14,0)
 I PSGST="",(PSGSCH="NOW"!(PSGSCH="ONCE")) S PSGST="O"
"RTN","PSJCOM",15,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",9)="N",$P(^(0),"^",4)="U",$P(^(0),"^",7)=PSGST,$P(^TMP("PSJCOM",$J,+PSGORD,2),"^",2)=PSGSD,$P(^(2),"^",4)=PSGFD
"RTN","PSJCOM",16,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S ^TMP("PSJCOM",$J,+PSGORD,6)=PSGSI
"RTN","PSJCOM",17,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S $P(^TMP("PSJCOM",$J,+PSGORD,6),U)=$P(PSGSI,U) I $P(PSGSI,U)="" S $P(^TMP("PSJCOM",$J,+PSGORD,6),U,2)=""
"RTN","PSJCOM",18,0)
 S:$D(PSGSCH) $P(^TMP("PSJCOM",$J,+PSGORD,2),"^")=PSGSCH
"RTN","PSJCOM",19,0)
 I PSGSM,PSGOHSM'=PSGHSM S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",5)=PSGSM,$P(^TMP("PSJCOM",$J,+PSGORD,0),"^",6)=PSGHSM
"RTN","PSJCOM",20,0)
 W "."
"RTN","PSJCOM",21,0)
 S PSGOEEWF="^TMP(""PSJCOM"",$J,+PSGORD,"
"RTN","PSJCOM",22,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."  ;MOU-0100-30945
"RTN","PSJCOM",23,0)
 S PSGND=$G(^TMP("PSJCOM",$J,+PSGORD,0)),X=$P(PSGND,U,24)
"RTN","PSJCOM",24,0)
 S PSJOWALL=+$G(^PS(55,PSGP,5.1))
"RTN","PSJCOM",25,0)
 I $S(X="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:X'="E") S X=$G(^TMP("PSJCOM",$J,+PSGORD,2)) D ENWALL^PSGNE3(+$P(X,U,2),+$P(X,U,4),PSGP)
"RTN","PSJCOM",26,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,.2),U,2)=PSGDO,$P(^TMP("PSJCOM",$J,+PSGORD,2),U,5)=PSGAT S:$G(PSGS0XT) $P(^(2),U,6)=PSGS0XT
"RTN","PSJCOM",27,0)
 I 'PSGOEAV D NEWNVAL(PSGORD,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSJCOM",28,0)
 I $D(^PS(53.45,DUZ,5,1,0)) D FILESI^PSJBCMA5(PSGP,PSGORD) N SIARRAY S SIARRAY="" D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSJCOM",29,0)
 I PSGOEAV,+PSJSYSU=3 D VFY Q
"RTN","PSJCOM",30,0)
 I PSGOEAV,$G(PSJRNF) D VFY
"RTN","PSJCOM",31,0)
 Q
"RTN","PSJCOM",32,0)
VFY ; change status, move to 55, and change label record
"RTN","PSJCOM",33,0)
 Q:'PSJCOM
"RTN","PSJCOM",34,0)
 I '$D(^TMP("PSJCOM",$J,+PSGORD)) M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM",35,0)
 NEW PSJDOSE,PSJDSFLG
"RTN","PSJCOM",36,0)
 D DOSECHK^PSJDOSE
"RTN","PSJCOM",37,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSJCOM",38,0)
 . S PSGOEEF(109)=1
"RTN","PSJCOM",39,0)
 . S PSJACEPT=0
"RTN","PSJCOM",40,0)
 D DDCHK G:CHK DONE
"RTN","PSJCOM",41,0)
 W !,"...a few moments, please..."
"RTN","PSJCOM",42,0)
 I PSGORD["P" D
"RTN","PSJCOM",43,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in ^TMP
"RTN","PSJCOM",44,0)
 . I '$D(^TMP("PSJCOM2",$J,+PSGORD)) D  Q
"RTN","PSJCOM",45,0)
 .. NEW PSGX S PSGX=$G(^TMP("PSJCOM",$J,+PSGORD,2.5)),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOM",46,0)
 .. S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",9)="A" W "." ;D ^PSGOT
"RTN","PSJCOM",47,0)
 .  NEW PSGX S PSGX=$G(^TMP("PSJCOM2",$J,+PSGORD,2.5)),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOM",48,0)
 .  S $P(^TMP("PSJCOM2",$J,+PSGORD,0),"^",9)="A" W "." ;D ^PSGOT
"RTN","PSJCOM",49,0)
 D NEWNVAL(+PSGORD,(PSJSYSU*10+22000)) W "."
"RTN","PSJCOM",50,0)
 S VND4=$S('$D(^TMP("PSJCOM2",$J,+PSGORD)):$G(^TMP("PSJCOM",$J,+PSGORD,4)),1:$G(^TMP("PSJCOM2",$J,+PSGORD,4)))
"RTN","PSJCOM",51,0)
 I $G(PSGRSD) D
"RTN","PSJCOM",52,0)
 . S PSGRSD=$$ENDTC^PSGMI(PSGRSD) D NEWNVAL(PSGORD,6090,"Requested Start Date",PSGRSD)
"RTN","PSJCOM",53,0)
 . S PSGRFD=$$ENDTC^PSGMI(PSGRFD) D NEWNVAL(PSGORD,6090,"Requested Stop Date",PSGRFD)
"RTN","PSJCOM",54,0)
 N DUR,DURORD S DURON=$S($G(ON)&($G(PSGORD)["U"):ON,$G(PSGORD):PSGORD,1:"") Q:'DURON  D
"RTN","PSJCOM",55,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",$G(DURON)["V":"IV",1:5),1),1:"")
"RTN","PSJCOM",56,0)
 I DUR]"" S $P(^TMP("PSJCOM2",$J,+PSGORD,2.5),"^",2)=DUR
"RTN","PSJCOM",57,0)
 ;D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSJCOM",58,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSJCOM",59,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSJCOM",60,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",16):1,1:$P(VND4,"^",15)) ;D EN^PSGPEN(+PSGORD)
"RTN","PSJCOM",61,0)
 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSJCOM",62,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)=""
"RTN","PSJCOM",63,0)
 S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT
"RTN","PSJCOM",64,0)
 S:'$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM",$J,+PSGORD,4)=VND4 S:$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM2",$J,+PSGORD,4)=VND4
"RTN","PSJCOM",65,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSJCOM",66,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSJCOM",67,0)
 S VALMBCK="Q"
"RTN","PSJCOM",68,0)
 S ^TMP("PSJCOM",$J)="A" S:$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM2",$J)="A"
"RTN","PSJCOM",69,0)
 ;
"RTN","PSJCOM",70,0)
DONE ;
"RTN","PSJCOM",71,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSJCOM",72,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSJCOM",73,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJCOM",74,0)
 .Q:Y="N"
"RTN","PSJCOM",75,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSJCOM",76,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X Q
"RTN","PSJCOM",77,0)
 ;
"RTN","PSJCOM",78,0)
DDCHK ; dispense drug check
"RTN","PSJCOM",79,0)
 S DRGF=$S('$D(^TMP("PSJCOM2",$J,+PSGORD)):"^TMP(""PSJCOM"","_$J_","_+PSGORD_",",1:"^TMP(""PSJCOM2"","_$J_","_+PSGORD_","),CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSJCOM",80,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSJCOM",81,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSJCOM",82,0)
 Q:CHK=0
"RTN","PSJCOM",83,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSJCOM",84,0)
 ;
"RTN","PSJCOM",85,0)
CONT() ;
"RTN","PSJCOM",86,0)
 NEW DIR,DIRUT,Y
"RTN","PSJCOM",87,0)
 W ! K DIR,DIRUT
"RTN","PSJCOM",88,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="No"
"RTN","PSJCOM",89,0)
 D ^DIR
"RTN","PSJCOM",90,0)
 Q Y
"RTN","PSJCOM",91,0)
 ;
"RTN","PSJCOM",92,0)
NEWNVAL(PSGALORD,PSGALC,PSGFLD,PSGOLD)  ;
"RTN","PSJCOM",93,0)
 ;
"RTN","PSJCOM",94,0)
 ;Where  PSGALORD = PSGORD (Required)
"RTN","PSJCOM",95,0)
 ;       PSGALC   = ACTIVITY CODE FROM #53.3 (Required)
"RTN","PSJCOM",96,0)
 ;       PSGFLD   = FIELD THAT CHANGED (Free text, optional)
"RTN","PSJCOM",97,0)
 ;       PSGOLD   = THE FIELDS OLD DATA VALUE (Free text, optional)
"RTN","PSJCOM",98,0)
 ;
"RTN","PSJCOM",99,0)
 ;N PSGALORD,PSGALC,PSGFLD,PSGOLD
"RTN","PSJCOM",100,0)
 ;
"RTN","PSJCOM",101,0)
 ; Create 0 node activity log for order if none exists, and get next entry number
"RTN","PSJCOM",102,0)
 I '$D(^TMP("PSJCOM2",$J,+PSGALORD)) D  Q
"RTN","PSJCOM",103,0)
 . S QQ=$G(^TMP("PSJCOM",$J,+PSGALORD,"A",0)) S:QQ="" QQ="^53.1119D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSJCOM",104,0)
 . ;Set up data to be held in activity log record
"RTN","PSJCOM",105,0)
 . D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOM",106,0)
 . I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSJCOM",107,0)
 . S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSJCOM",108,0)
 . ; Create activity log entry
"RTN","PSJCOM",109,0)
 . S ^TMP("PSJCOM",$J,+PSGALORD,"A",PSGAL("N"),0)=Q
"RTN","PSJCOM",110,0)
 S QQ=$G(^TMP("PSJCOM2",$J,+PSGALORD,"A",0)) S:QQ="" QQ="^53.1119D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSJCOM",111,0)
 ;Set up data to be held in activity log record
"RTN","PSJCOM",112,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOM",113,0)
 I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSJCOM",114,0)
 S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSJCOM",115,0)
 ; Create activity log entry
"RTN","PSJCOM",116,0)
 S ^TMP("PSJCOM2",$J,+PSGALORD,"A",PSGAL("N"),0)=Q
"RTN","PSJCOM",117,0)
 Q
"RTN","PSJCOMV")
0^64^B40002868^B41315630
"RTN","PSJCOMV",1,0)
PSJCOMV ;BIR/CML3-FINISH COMPLEX IV ORDERS ENTERED THROUGH OE/RR ;02 Feb 2001  12:20 PM
"RTN","PSJCOMV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**110,127,267**;16 DEC 97;Build 158
"RTN","PSJCOMV",3,0)
 ;
"RTN","PSJCOMV",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCOMV",5,0)
 ; Reference to ^%DTC is supported by DBIA 10000..
"RTN","PSJCOMV",6,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOMV",7,0)
 ;
"RTN","PSJCOMV",8,0)
 ;
"RTN","PSJCOMV",9,0)
IV ; Move IV data in local variables to ^TMP
"RTN","PSJCOMV",10,0)
 Q:'PSJCOM  Q:ON'["P"
"RTN","PSJCOMV",11,0)
 M ^TMP("PSJCOM",$J,+ON)=^PS(53.1,+ON)
"RTN","PSJCOMV",12,0)
 S P(17)="N"
"RTN","PSJCOMV",13,0)
 K ND S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSJCOMV",14,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON")) S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSJCOMV",15,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSJCOMV",16,0)
 S:+$G(P("CLIN")) ^TMP("PSJCOM",$J,+ON,"DSS")=P("CLIN")
"RTN","PSJCOMV",17,0)
 F X=0,2,4,8,9 S ^TMP("PSJCOM",$J,+ON,X)=ND(X)
"RTN","PSJCOMV",18,0)
 S:'+$G(^TMP("PSJCOM",$J,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSJCOMV",19,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSJCOMV",20,0)
 I '+$P(PSJSYSP0,"^",9) D NEWNVAL^PSJCOM(ON,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSJCOMV",21,0)
 I +PSJSYSU=3,+$P(PSJSYSP0,U,9) D VFYIV Q
"RTN","PSJCOMV",22,0)
 I +PSJSYSU=1,+$P(PSJSYSP0,U,9),$G(PSJIRNF) D VFYIV
"RTN","PSJCOMV",23,0)
 I $G(PSIVENO),($P(^PS(53.1,+PSJORD,0),U,9)="N") D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSJCOMV",24,0)
 Q
"RTN","PSJCOMV",25,0)
 ;
"RTN","PSJCOMV",26,0)
VFYIV ;
"RTN","PSJCOMV",27,0)
 Q:'PSJCOM
"RTN","PSJCOMV",28,0)
 I '$D(^TMP("PSJCOM",$J,+ON)) M ^TMP("PSJCOM",$J,+ON)=^PS(53.1,+ON) D
"RTN","PSJCOMV",29,0)
 . N CHILD,ORDER S ORDER=0 F  S ORDER=$O(^PS(53.1,"ACX",PSJCOM,ORDER)) Q:'ORDER  D
"RTN","PSJCOMV",30,0)
 .. I '$D(^TMP("PSJCOM",$J,+ORDER)) M ^TMP("PSJCOM",$J,+ORDER)=^PS(53.1,+ORDER)
"RTN","PSJCOMV",31,0)
 I ON["P" D
"RTN","PSJCOMV",32,0)
 . S P(17)="A"
"RTN","PSJCOMV",33,0)
 . S PSGORDP=ON ;Used in ACTLOG to update activity log in ^TMP
"RTN","PSJCOMV",34,0)
 . NEW PSGX S PSGX=$S($D(^TMP("PSJCOM2",$J,+ON,2.5)):$G(^TMP("PSJCOM2",$J,+ON,2.5)),1:$G(^TMP("PSJCOM2",$J,+ON,2.5))),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOMV",35,0)
 . S:$D(^TMP("PSJCOM2",$J,+ON,0)) $P(^TMP("PSJCOM2",$J,+ON,0),"^",9)=P(17) S:'$D(^TMP("PSJCOM2",$J,+ON,0)) $P(^TMP("PSJCOM",$J,+ON,0),"^",9)=P(17) W "." ;D ^PSGOT
"RTN","PSJCOMV",36,0)
 D NEWNVAL^PSJCOM(ON,(PSJSYSU*10+22000)) W "."
"RTN","PSJCOMV",37,0)
 S VND4=$S('$D(^TMP("PSJCOM2",$J,+ON)):$G(^TMP("PSJCOM",$J,+ON,4)),1:$G(^TMP("PSJCOM2",$J,+ON,4)))
"RTN","PSJCOMV",38,0)
 S VND2P5=$$GETDUR^PSJLIVMD(DFN,ON,$E(ON,$L(ON)),1) I VND2P5]"" D
"RTN","PSJCOMV",39,0)
 . S:'$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM",$J,+ON,2.5)="^"_VND2P5 Q
"RTN","PSJCOMV",40,0)
 . S:$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM2",$J,+ON,2.5)="^"_VND2P5
"RTN","PSJCOMV",41,0)
 I $G(PSGRSD) D
"RTN","PSJCOMV",42,0)
 . S PSGRSD=$$ENDTC^PSGMI(PSGRSD) D NEWNVAL^PSJCOM(ON,6090,"Requested Start Date",PSGRSD)
"RTN","PSJCOMV",43,0)
 . S PSGRFD=$$ENDTC^PSGMI(PSGRFD) D NEWNVAL^PSJCOM(ON,6090,"Requested Stop Date",PSGRFD)
"RTN","PSJCOMV",44,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSJCOMV",45,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSJCOMV",46,0)
 I +PSJSYSU=3,ON'["O",$S(X:0,'$P(VND4,"^",16):1,1:$P(VND4,"^",15)) ; D EN^PSGPEN(+ON)
"RTN","PSJCOMV",47,0)
 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSJCOMV",48,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^TMP("PSJCOM",$J,+ON,4)=VND4
"RTN","PSJCOMV",49,0)
 S:'$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM",$J,+ON,4)=VND4 S:$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM2",$J,+ON,4)=VND4
"RTN","PSJCOMV",50,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSJCOMV",51,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSJCOMV",52,0)
 S VALMBCK="Q"
"RTN","PSJCOMV",53,0)
 S ^TMP("PSJCOM",$J)="A" S:$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM2",$J)="A" Q
"RTN","PSJCOMV",54,0)
 ;
"RTN","PSJCOMV",55,0)
PTD531 ; Move drug data from local array into ^TMP
"RTN","PSJCOMV",56,0)
 K ^TMP("PSJCOM",$J,DRGT) S ^TMP("PSJCOM",$J,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSJCOMV",57,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJCOMV",58,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^TMP("PSJCOM",$J,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJCOMV",59,0)
 .S ^TMP("PSJCOM",$J,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^TMP("PSJCOM",$J,+ON,DRGT,+DRG,0)=Y
"RTN","PSJCOMV",60,0)
 Q
"RTN","PSJCOMV",61,0)
 ;
"RTN","PSJCOMV",62,0)
NEWIV ;Create new IV order in appropriate file format
"RTN","PSJCOMV",63,0)
 M ^TMP("PSJCOM2",$J,+ON)=^PS(53.1,+ON)
"RTN","PSJCOMV",64,0)
 S $P(^TMP("PSJCOM",$J,+ON,0),"^",9)="DE",P("OLDON")=+ON_"P",P("RES")="E"
"RTN","PSJCOMV",65,0)
 I +$P(PSJSYSP0,U,9) D NEWAIV Q
"RTN","PSJCOMV",66,0)
 S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSJCOMV",67,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON")) S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSJCOMV",68,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSJCOMV",69,0)
 S:+$G(P("CLIN")) ^TMP("PSJCOM2",$J,+ON,"DSS")=P("CLIN")
"RTN","PSJCOMV",70,0)
 F X=0,2,4,8,9 S ^TMP("PSJCOM2",$J,+ON,X)=ND(X)
"RTN","PSJCOMV",71,0)
 S:'+$G(^TMP("PSJCOM2",$J,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSJCOMV",72,0)
 I $G(P("PRNTON"))]"" S $P(^TMP("PSJCOM2",$J,+ON,.2),"^",8)=$G(P("PRNTON"))
"RTN","PSJCOMV",73,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD5312
"RTN","PSJCOMV",74,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSJCOMV",75,0)
 Q
"RTN","PSJCOMV",76,0)
 ;
"RTN","PSJCOMV",77,0)
PTD5312 ; Move drug data from local array into ^TMP
"RTN","PSJCOMV",78,0)
 K ^TMP("PSJCOM2",$J,DRGT) S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSJCOMV",79,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJCOMV",80,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^TMP("PSJCOM2",$J,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJCOMV",81,0)
 .S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^TMP("PSJCOM2",$J,+ON,DRGT,+DRG,0)=Y
"RTN","PSJCOMV",82,0)
 Q
"RTN","PSJCOMV",83,0)
 ;
"RTN","PSJCOMV",84,0)
NEWAIV ;Creates new IV order in the file 55 format
"RTN","PSJCOMV",85,0)
 N DA,DIK,ND,PSIVACT
"RTN","PSJCOMV",86,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOMV",87,0)
 S:'$D(P(21)) (P(21),P("21FLG"))="" S ND(0)=+ON,P(22)=$S(VAIN(4):+VAIN(4),1:.5) F X=2:1:23 I $D(P(X)) S $P(ND(0),U,X)=P(X)
"RTN","PSJCOMV",88,0)
 S ND(.3)=$G(P("INS"))
"RTN","PSJCOMV",89,0)
 S $P(ND(0),U,17)="A",ND(1)=P("REM"),ND(3)=P("OPI"),ND(.2)=$P($G(P("PD")),U)_U_$G(P("DO"))_U_+P("MR")_U_$G(P("PRY"))_U_$G(P("NAT"))_U_U_U_$G(P("PRNTON"))
"RTN","PSJCOMV",90,0)
 F X=0,1,3,.2,.3 S ^TMP("PSJCOM2",$J,+ON,X)=ND(X)
"RTN","PSJCOMV",91,0)
 S $P(^TMP("PSJCOM2",$J,+ON,2),U,1,4)=P("LOG")_U_+P("IVRM")_U_U_P("SYRS"),$P(^(2),U,8,10)=P("RES")_U_$G(P("FRES"))_U_$S($G(VAIN(4)):+VAIN(4),1:"")
"RTN","PSJCOMV",92,0)
 S $P(^TMP("PSJCOM2",$J,+ON,2),U,11)=+P("CLRK")
"RTN","PSJCOMV",93,0)
 S:+$G(P("CLIN")) ^TMP("PSJCOM2",$J,+ON,"DSS")=P("CLIN")
"RTN","PSJCOMV",94,0)
 S:+$G(P("NINIT")) ^TMP("PSJCOM2",$J,+ON,4)=P("NINIT")_U_P("NINITDT")
"RTN","PSJCOMV",95,0)
 I +PSJSYSU=3 S $P(^TMP("PSJCOM2",$J,+ON,4),"^",4)=DUZ,$P(^TMP("PSJCOM2",$J,+ON,4),"^",5)=PSGDT,$P(^TMP("PSJCOM2",$J,+ON,4),"^",9)=1
"RTN","PSJCOMV",96,0)
 I +PSJSYSU=1 S $P(^TMP("PSJCOM2",$J,+ON,4),"^",10)=1
"RTN","PSJCOMV",97,0)
 F DRGT="AD","SOL" D PUTD55
"RTN","PSJCOMV",98,0)
 Q
"RTN","PSJCOMV",99,0)
 ;
"RTN","PSJCOMV",100,0)
PUTD55 ; Move drug data from local array into 55
"RTN","PSJCOMV",101,0)
 K ^TMP("PSJCOM2",$J,+ON,DRGT) S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=$S(DRGT="AD":"^55.02PA",1:"^55.11IPA")
"RTN","PSJCOMV",102,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJCOMV",103,0)
 .S Y=^TMP("PSJCOM2",$J,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJCOMV",104,0)
 .S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=Y,Y=$P(DRG(DRGT,X),U)_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^TMP("PSJCOM2",$J,+ON,DRGT,+DRG,0)=Y
"RTN","PSJCOMV",105,0)
 Q
"RTN","PSJDPT")
0^25^B13914109^B7019925
"RTN","PSJDPT",1,0)
PSJDPT ;BIR/JLC - CENTRALIZED PATIENT LOOKUP FOR IPM ; 7/2/08 3:47pm
"RTN","PSJDPT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**53,124,166,160,198,267**;16 DEC 97;Build 158
"RTN","PSJDPT",3,0)
 ;
"RTN","PSJDPT",4,0)
 ; Reference to ^DPT is supported by DBIA 10035
"RTN","PSJDPT",5,0)
 ; Reference to ^DGSEC4 is supported by DBIA 3027
"RTN","PSJDPT",6,0)
 ; Reference to ^DIC is supported by DBIA 10006
"RTN","PSJDPT",7,0)
 ; Reference to ^DICN is supported by DBIA 10009
"RTN","PSJDPT",8,0)
 ; Reference to ^DPTLK is supported by DBIA 3787
"RTN","PSJDPT",9,0)
 ; Reference to ^DPTLK1 is supported by DBIA 3266
"RTN","PSJDPT",10,0)
 ; Reference to DISPPRF^DGPFAPI is supported by DBIA 4563
"RTN","PSJDPT",11,0)
 ; Reference to GETACT^DGPFAPI is supported by DBIA 3860
"RTN","PSJDPT",12,0)
 ; Reference to ^ORRDI1 is supported by DBIA 4659.
"RTN","PSJDPT",13,0)
 ; Reference to ^XTMP("ORRDI" is supported by DBIA 4660.
"RTN","PSJDPT",14,0)
 ;
"RTN","PSJDPT",15,0)
EN ; MAIN ENTRY POINT FOR PATIENT LOOKUP
"RTN","PSJDPT",16,0)
 K DIC S DIC="^DPT(",DIC("W")="D DPT^PSJDPT",DIC(0)="QEMZ" D ^DPTLK K DIC
"RTN","PSJDPT",17,0)
 I $$BADADR^DGUTL3(+Y) H 2
"RTN","PSJDPT",18,0)
 N Y
"RTN","PSJDPT",19,0)
 D
"RTN","PSJDPT",20,0)
 . ;PSJ*5.0*198;GMZ;Don't print remote data msg on view profile only menu options
"RTN","PSJDPT",21,0)
 . I $T(HAVEHDR^ORRDI1)]"",$$HAVEHDR^ORRDI1,$D(^XTMP("ORRDI","OUTAGE INFO","DOWN")),'$G(PSJNODIS) W !,"Remote data not available - Only local order checks processed." D PAUSE^PSJLMUT1
"RTN","PSJDPT",22,0)
 Q
"RTN","PSJDPT",23,0)
CHK(Y,DISP,PAUSE) N RESULT,RES,CHKY,PSGTEMP
"RTN","PSJDPT",24,0)
 S DISP=$G(DISP),PAUSE=$G(PAUSE)
"RTN","PSJDPT",25,0)
 I $G(XQY0)["PSJI COMPLETE",$$GETACT^DGPFAPI(+Y,"PSGTEMP") K PSGTEMP W @IOF,"PATIENT: ",$P(Y,U,2)
"RTN","PSJDPT",26,0)
 S CHKY=Y D DISPPRF^DGPFAPI(Y) S Y=CHKY K CHKY
"RTN","PSJDPT",27,0)
 D PTSEC^DGSEC4(.RESULT,$P(Y,"^"),1)
"RTN","PSJDPT",28,0)
 I RESULT(1)'=0 D
"RTN","PSJDPT",29,0)
 . W !! I DISP W ?(80-$L($P(Y,"^",2)))\2,$P(Y,"^",2),!
"RTN","PSJDPT",30,0)
 . F I=2:1:9 I $D(RESULT(I)) W ?(80-$L(RESULT(I)))\2,RESULT(I),!
"RTN","PSJDPT",31,0)
 . I RESULT(1)'=0,RESULT(1)'=2,PAUSE H 2
"RTN","PSJDPT",32,0)
 . Q:RESULT(1)=1
"RTN","PSJDPT",33,0)
 . I RESULT(1)=-1!(RESULT(1)=3)!(RESULT(1)=4) S Y=-1 Q
"RTN","PSJDPT",34,0)
 . I RESULT(1)=2 D ENCONT I Y=-1 Q
"RTN","PSJDPT",35,0)
 . D NOTICE^DGSEC4(.RES,Y,XQY0,$S(RESULT(1)=1:1,1:3)) I RES=0 S Y=-1 Q
"RTN","PSJDPT",36,0)
 I '$$AA(+Y) S Y=-1 Q
"RTN","PSJDPT",37,0)
 Q
"RTN","PSJDPT",38,0)
ENCONT W !,"Do you want to continue processing this patient record"
"RTN","PSJDPT",39,0)
 S %=2 D YN^DICN I %<0!(%=2) S Y=-1
"RTN","PSJDPT",40,0)
 I '% W !!,"Enter 'YES' to continue processing, or 'NO' to quit processing this record." G ENCONT
"RTN","PSJDPT",41,0)
 Q
"RTN","PSJDPT",42,0)
DPT I $$DOB^DPTLK1(Y)["*SENSITIVE" G SENS
"RTN","PSJDPT",43,0)
 S ND=$S($D(^DPT(Y,0)):^(0),1:""),NB=$P(ND,"^",3),NS=$P(ND,"^",9)
"RTN","PSJDPT",44,0)
 I NS W ?42,$E(NS,1,3),"-",$E(NS,4,5),"-",$E(NS,6,10)," "
"RTN","PSJDPT",45,0)
 I NB W ?55,$E(NB,4,5),"/",$E(NB,6,7),"/",$E(NB,2,3)," "
"RTN","PSJDPT",46,0)
 I $D(^DPT(Y,.1)) W ?67,$P(^(.1),"^")
"RTN","PSJDPT",47,0)
 Q
"RTN","PSJDPT",48,0)
SENS W ?42,"*SENSITIVE* ",?55,"*SENSITIVE* ",?67,"*SENSITIVE*" Q
"RTN","PSJDPT",49,0)
 ;
"RTN","PSJDPT",50,0)
AA(DFN) ; Allergy Assessment
"RTN","PSJDPT",51,0)
 Q:$G(DFN)<1 0
"RTN","PSJDPT",52,0)
 N VAN,VAV,VADM,Y,X D DEM^VADPT
"RTN","PSJDPT",53,0)
 Q:+$G(VADM(6)) 1
"RTN","PSJDPT",54,0)
 N PSJENTRY S PSJENTRY=$P($G(XQY0),"^") I '(("^PSJU NE^PSJI ORDER^PSJ OE^PSJU VBW^PSJI PROFILE^")[("^"_PSJENTRY_"^")) Q 1
"RTN","PSJDPT",55,0)
 N PSGP,Y S (Y,PSGP)=+DFN N DFN S DFN=PSGP
"RTN","PSJDPT",56,0)
 I $G(DFN) N PSJAAOK,PSJAACHK,PSJAADPT,PSJRXREQ,GMRA,GMRAL S PSJAADPT=1,PSJAAOK="" D
"RTN","PSJDPT",57,0)
 .S GMRA="0^0^111",DFN=PSGP D ^GMRADPT I $G(GMRAL)="" S PSJAACHK=1 F  Q:$G(PSJAAOK)  D
"RTN","PSJDPT",58,0)
 ..D CLEAR^VALM1,FULL^VALM1
"RTN","PSJDPT",59,0)
 ..W !!,"NO ALLERGY ASSESSMENT exists for this patient!",!!,"Would you like to enter one now" S %=2 D YN^DICN
"RTN","PSJDPT",60,0)
 ..I $G(%)=2 S PSJAAOK=1 D  Q
"RTN","PSJDPT",61,0)
 ...W !!,"Now creating Pharmacy Intervention",!
"RTN","PSJDPT",62,0)
 ...S PSJRXREQ="NO ALLERGY ASSESSMENT",PSJDD="" D DIC^PSJRXI
"RTN","PSJDPT",63,0)
 ..I $G(%)=1 S VALMBCK="R" D INIT^PSJLMDA I $G(DFN) D NEWALL^PSJLMUTL(DFN) D  Q
"RTN","PSJDPT",64,0)
 ...S GMRA="0^0^111" D ^GMRADPT I $G(GMRAL)'="" S PSJAAOK=1
"RTN","PSJDPT",65,0)
 ..I $G(%)<0 S PSJAAOK=1 S Y="" Q
"RTN","PSJDPT",66,0)
 ..W !!?5,"Enter 'Y' to create an allergy assessment, or 'N'",!?5,"to continue without creating an allergy assessment"
"RTN","PSJDPT",67,0)
 Q $S($G(Y)>0:Y,1:0)
"RTN","PSJHL3")
0^30^B90089505^B66158358
"RTN","PSJHL3",1,0)
PSJHL3 ;BIR/RLW-PHARMACY ORDER SEGMENTS ;4/24/12 2:46pm
"RTN","PSJHL3",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**1,11,14,40,42,47,50,56,58,92,101,102,123,110,111,152,134,226,267**;16 DEC 97;Build 158
"RTN","PSJHL3",3,0)
 ;
"RTN","PSJHL3",4,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJHL3",5,0)
 ; Reference to ^PS(50.607 is supported by DBIA# 2221.        
"RTN","PSJHL3",6,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL3",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL3",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL3",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL3",10,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL3",11,0)
 ; Reference to ^PSDRUG( is supported by DBIA# 2192.
"RTN","PSJHL3",12,0)
 ; Reference to ^PSNDF( is supported by DBIA# 2195.
"RTN","PSJHL3",13,0)
 ; Reference to ^VA(200 is supported by DBIA# 10060.
"RTN","PSJHL3",14,0)
 ; Reference to ^PSNAPIS is supported by DBIA# 2531.
"RTN","PSJHL3",15,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJHL3",16,0)
 ; Reference to ^PSSUTIL1 is supported by DBIA# 3179.
"RTN","PSJHL3",17,0)
 ; Reference to ^ORHLESC is supported by DBIA# 4922.
"RTN","PSJHL3",18,0)
 ;
"RTN","PSJHL3",19,0)
 ;*267 Change NTE|21 so it can send over the Long Wp Special Inst/
"RTN","PSJHL3",20,0)
 ;     Other Prt Info fields if populated.
"RTN","PSJHL3",21,0)
 ;
"RTN","PSJHL3",22,0)
EN1(PSJHLDFN,PSOC,PSJORDER) ; start here
"RTN","PSJHL3",23,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL3",24,0)
 ;               PSJORDER (file root of order)
"RTN","PSJHL3",25,0)
 ;               OC (order control code - NW for new order, OK for finished order, OC for order canceled)
"RTN","PSJHL3",26,0)
 I $G(PSJHLDFN)']""!$G(PSOC)']""!$G(PSJORDER)']"" W !,"INSUFFICIENT DATA FOR ^PSJHL3" Q
"RTN","PSJHL3",27,0)
 N COMMENTS,DDIEA,DDNUM,DOSE,DOSEFORM,DOSEOR,NAME,DURATION,IVTYPE,NODE1,NODE2,NDNODE,OINODE,PSGPLS,PSGPLF,PRODNAME,SPDIEN,UNIT,UNITS,CNT,DDIEN,SCHEDULE,PSGST
"RTN","PSJHL3",28,0)
 D INIT
"RTN","PSJHL3",29,0)
 S IVTYPE=$S(RXORDER["U":"",1:$$IVTYPE^PSJHLU(PSJORDER))
"RTN","PSJHL3",30,0)
 D RXO,RXE,RXR D ZRX
"RTN","PSJHL3",31,0)
 D CALL^PSJHLU(PSJI)
"RTN","PSJHL3",32,0)
 Q
"RTN","PSJHL3",33,0)
INIT ; initialize HL7 variables
"RTN","PSJHL3",34,0)
 D INIT^PSJHLU
"RTN","PSJHL3",35,0)
 Q
"RTN","PSJHL3",36,0)
RXO ; pharmacy prescription order segment (used to send Orderable Item to OE/RR)
"RTN","PSJHL3",37,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL3",38,0)
 S FIELD(0)="RXO"
"RTN","PSJHL3",39,0)
 S OINODE=$G(@(PSJORDER_".2)"))
"RTN","PSJHL3",40,0)
 S SPDIEN=+$P(OINODE,"^"),DOSEOR=$$ESC^ORHLESC($P(OINODE,"^",2)),DOSE=$P(OINODE,"^",5),UNIT=$P(OINODE,"^",6) S:'$G(PSJBCBU) UNIT=$$ESC^ORHLESC(UNIT)
"RTN","PSJHL3",41,0)
 S FIELD(1)=$S(SPDIEN=0:"^^^^",1:"^^^"_SPDIEN_"^")
"RTN","PSJHL3",42,0)
 I SPDIEN S DOSEFORM=$P($G(^PS(50.7,SPDIEN,0)),"^",2),NAME=$P($G(^PS(50.606,+DOSEFORM,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME) S FIELD(1)=FIELD(1)_$$ESC^ORHLESC($P($G(^PS(50.7,SPDIEN,0)),"^"))_" "_NAME
"RTN","PSJHL3",43,0)
 S FIELD(1)=FIELD(1)_"^99PSP"
"RTN","PSJHL3",44,0)
 N IVLNOD S IVLNOD=$G(@(PSJORDER_"2.5)")) D
"RTN","PSJHL3",45,0)
 .S IVLIM=$P(IVLNOD,"^",4) I IVLIM?1"a".N S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJHL3",46,0)
 .S $P(FIELD(1),"^",3)=IVLIM
"RTN","PSJHL3",47,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",48,0)
 Q
"RTN","PSJHL3",49,0)
RXE ; pharmacy encoded order segment
"RTN","PSJHL3",50,0)
 S (UNITS,NDNODE,SPDIEN,PRODNAME,DDNUM,DDIEN,CNT)="",LIMIT=26 X PSJCLEAR
"RTN","PSJHL3",51,0)
 S FIELD(0)="RXE"
"RTN","PSJHL3",52,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)")),NODEPT2=$G(@(PSJORDER_".2)"))
"RTN","PSJHL3",53,0)
  I $G(PSGST)="" N PSGST D
"RTN","PSJHL3",54,0)
 .I $G(RXORDER)["V" N X,ZZND,LYN,PSGS0XT,PSGS0Y,PSGOES S PSGOES=1 S X=$G(P(9)) I X]"" D EN^PSGS0 S:$G(ZZND)'="" PSGST=$P(ZZND,"^",5) Q
"RTN","PSJHL3",55,0)
 .S PSGST=$P($G(NODE1),"^",7)
"RTN","PSJHL3",56,0)
 I RXORDER["V" D IVRXE Q
"RTN","PSJHL3",57,0)
 I RXORDER["P",IVTYPE="F" D IVRXE Q
"RTN","PSJHL3",58,0)
 I RXORDER["P",$P(NODE1,"^",4)="H" D IVRXE Q
"RTN","PSJHL3",59,0)
 N RENEW S RENEW=$$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL3",60,0)
 S PSGPLS=$S($G(PSJEXPOE):$P(NODE2,"^",2),RENEW>$P(NODE2,"^",2):RENEW,1:$P(NODE2,"^",2))
"RTN","PSJHL3",61,0)
 S PSGPLF=$S($G(PSJEXPOE):PSJEXPOE,1:$P(NODE2,"^",4))
"RTN","PSJHL3",62,0)
 S FIELD(1)="^"_$S($G(PSJBCBU):$P(NODE2,"^"),1:$$ESC^ORHLESC($P(NODE2,"^")))_"&"_$P(NODE2,"^",5)_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)_"^"_$P($G(NODEPT2),"^",4)_"^"_$G(PSGST)
"RTN","PSJHL3",63,0)
 S FIELD(21)="^"_$P(NODE2,"^",5)_"^99PSA^^^"
"RTN","PSJHL3",64,0)
 I ($G(DOSEOR)']"")!($O(@(PSJORDER_"1,"" "")"),-1)=1) D
"RTN","PSJHL3",65,0)
 .S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  Q:CNT=1  S DDIEN=+$G(@(PSJORDER_"1,"_DDNUM_",0)")) D
"RTN","PSJHL3",66,0)
 ..S FIELD(1)=$S($P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2)="":"1",1:$P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2))_"&"_FIELD(1)
"RTN","PSJHL3",67,0)
 ..S FIELD(1)=DOSE_"&"_UNIT_"&"_FIELD(1),$P(FIELD(1),"^",8)=$S($G(DOSEOR)]"":$G(DOSEOR),1:DOSE_UNIT)
"RTN","PSJHL3",68,0)
 ..S:$P(FIELD(1),"^",8)="" $P(FIELD(1),"^",8)=$$ESC^ORHLESC($G(@(PSJORDER_".3)")))
"RTN","PSJHL3",69,0)
 ..S NDNODE=$G(^PSDRUG(DDIEN,"ND"))
"RTN","PSJHL3",70,0)
 ..;  CHANGE FOR NEW NDF CALL
"RTN","PSJHL3",71,0)
 ..S PRODNAME=$S($T(^PSNAPIS)]"":$$PROD0^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),$G(^PSNDF(+NDNODE,5,+$P(NDNODE,"^",3),0))]"":^(0),1:"N/A")
"RTN","PSJHL3",72,0)
 ..S:PRODNAME="" PRODNAME="N/A"
"RTN","PSJHL3",73,0)
 ..S FIELD(2)=$S(PRODNAME="N/A":"^^",1:+NDNODE_"."_+$P(NDNODE,"^",3)_"^"_$P(NDNODE,"^",2)_"^"_"99NDF")_"^"_DDIEN_"^"_$S($G(PSJBCBU):$P($G(^PSDRUG(DDIEN,0)),"^"),1:$$ESC^ORHLESC($P($G(^PSDRUG(DDIEN,0)),"^")))_"^"_"99PSD"
"RTN","PSJHL3",74,0)
 ..S UNITS=$S(PRODNAME="N/A":"N/A",1:$S($T(^PSNAPIS)]"":$P($$DFSU^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),"^",5),1:$P($G(^PSNDF(+NDNODE,2,+$P(PRODNAME,"^",2),3,+$P(PRODNAME,"^",3),4,+$P(PRODNAME,"^",4),0)),"^")))
"RTN","PSJHL3",75,0)
 ..S FIELD(5)="^^^"_$$ESC^ORHLESC(UNITS)_"^"_$$ESC^ORHLESC($P($G(^PS(50.607,UNITS,0)),"^"))_"^99PSU"
"RTN","PSJHL3",76,0)
 ..S FIELD(6)="^^^"_$$ESC^ORHLESC($G(DOSEFORM))_"^"_$$ESC^ORHLESC($P($G(^PS(50.606,+$G(DOSEFORM),0)),"^"))_"^99PSF"
"RTN","PSJHL3",77,0)
 ..S FIELD(25)=$$EN^PSSUTIL1(DDIEN),FIELD(26)=$P(FIELD(25),"|",2),FIELD(25)=$P(FIELD(25),"|")
"RTN","PSJHL3",78,0)
 ..I $P(FIELD(25),"^",5)]"" S $P(FIELD(25),"^",5)=$$ESC^ORHLESC($P(FIELD(25),"^",5))
"RTN","PSJHL3",79,0)
 ..S CNT=CNT+1
"RTN","PSJHL3",80,0)
 E  S $P(FIELD(1),"^",8)=$$ESC^ORHLESC(DOSEOR)
"RTN","PSJHL3",81,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME) S FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",82,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",83,0)
 D SEGMENT2^PSJHLU
"RTN","PSJHL3",84,0)
 Q
"RTN","PSJHL3",85,0)
IVRXE ; RXE segment for IV orders
"RTN","PSJHL3",86,0)
 ; If an Inpatient Med IV order, send RXE w/dispense drug info.  
"RTN","PSJHL3",87,0)
 ; If an IV FLUID order, send start/stop date and duration in the RXE
"RTN","PSJHL3",88,0)
 ; and send an RXC for each additive and solution.
"RTN","PSJHL3",89,0)
 N ADSNODE,PSJRENEW S PSJRENEW=$$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL3",90,0)
 I RXORDER["V" S PSGPLS=$S($G(PSJEXPOE):$P(NODE1,"^",2),PSJRENEW>$P(NODE1,"^",2):PSJRENEW,1:$P(NODE1,"^",2)),PSGPLF=$S($G(PSJEXPOE):PSJEXPOE,1:$P(NODE1,"^",3))
"RTN","PSJHL3",91,0)
 E  S PSGPLS=$P(NODE2,"^",2),PSGPLF=$P(NODE2,"^",4)
"RTN","PSJHL3",92,0)
 S FIELD(1)="^"_$S(PSJORDER["IV":($P(NODE1,"^",9)_"&"_$P(NODE1,"^",11)),1:$P(NODE2,"^"))_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)_"^"_$G(P("PRY"))
"RTN","PSJHL3",93,0)
 S FIELD(21)="^"_$S(PSJORDER["IV":$P(NODE1,"^",11),1:$P(NODE2,"^",5))_"^99PSA^^^"
"RTN","PSJHL3",94,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME)
"RTN","PSJHL3",95,0)
 S FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",96,0)
 N X,Y
"RTN","PSJHL3",97,0)
 I RXORDER["V" S INFUSE=$P(NODE1,"^",8)
"RTN","PSJHL3",98,0)
 E  S INFUSE=$P($G(@(PSJORDER_"8)")),"^",5)
"RTN","PSJHL3",99,0)
 I INFUSE?1N.N1" ml/hr" S FIELD(23)=+INFUSE,Y=$P(INFUSE,+INFUSE,2),Y=$$TRIM^XLFSTR(Y,"LR"," "),FIELD(24)="^^^^"_Y_"^PSU"
"RTN","PSJHL3",100,0)
 I FIELD(23)="",FIELD(24)="" S FIELD(23)=INFUSE
"RTN","PSJHL3",101,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",102,0)
 K SEGMENT I RXORDER["V" S JJ=0 F  S JJ=$O(@(PSJORDER_"5,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$S($G(PSJBCBU):$G(@(PSJORDER_"5,"_JJ_",0)")),1:$$ESC^ORHLESC($G(@(PSJORDER_"5,"_JJ_",0)"))))
"RTN","PSJHL3",103,0)
 E  S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$S($G(PSJBCBU):$G(@(PSJORDER_"12,"_JJ_",0)")),1:$G(@(PSJORDER_"12,"_JJ_",0)")))
"RTN","PSJHL3",104,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_SEGMENT(0) D
"RTN","PSJHL3",105,0)
 .D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHL3",106,0)
 ;build NTE 21 with Special Inst/Other Prt Info Wp fields     *267
"RTN","PSJHL3",107,0)
 N QQ K ^TMP("PSJBCMA5",$J)
"RTN","PSJHL3",108,0)
 D GETSIOPI^PSJBCMA5(PSJHLDFN,RXORDER,1) I ($G(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,1))["Instructions too long. See Order View or BCMA for full text"),($G(PSJORD)["P"),($G(RXORDER)["V") D
"RTN","PSJHL3",109,0)
 .N OPIAL,OPIALFLG S OPIAL=0,OPIALFLG=0 F  S OPIAL=$O(^PS(55,PSJHLDFN,"IV",+RXORDER,"A",OPIAL)) Q:'OPIAL  I ($G(^PS(55,PSJHLDFN,"IV",+RXORDER,"A",OPIAL,1,1,0))["OTHER PRINT INFO") S OPIALFLG=1
"RTN","PSJHL3",110,0)
 .Q:$P($G(^PS(55,PSJHLDFN,"IV",+RXORDER,2)),"^",8)'="N"!$G(OPIALFLG)  D GETSIOPI^PSJBCMA5(PSJHLDFN,PSJORD,1)
"RTN","PSJHL3",111,0)
 .N LINES,TEXT1 S LINES=($G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD))),TEXT1=$G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD,1))
"RTN","PSJHL3",112,0)
 .Q:LINES<1!(LINES=1&(TEXT1'["Instructions too long. See Order View or BCMA for full text"))
"RTN","PSJHL3",113,0)
 .K ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER) M ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER)=^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD) K ^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD)
"RTN","PSJHL3",114,0)
 I RXORDER["V"!(RXORDER["U") I ($G(PSJORD)["P"),($P($G(^PS(53.1,+PSJORD,0)),"^",25)=RXORDER) D
"RTN","PSJHL3",115,0)
 .D GETSIOPI^PSJBCMA5(PSJHLDFN,PSJORD,1)
"RTN","PSJHL3",116,0)
 .N LINES,TEXT1 S LINES=($G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD))),TEXT1=$G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD,1))
"RTN","PSJHL3",117,0)
 .Q:LINES<1!(LINES=1&(TEXT1["Instructions too long. See Order View or BCMA for full text"))
"RTN","PSJHL3",118,0)
 .K ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER) M ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER)=^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD) K ^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD)
"RTN","PSJHL3",119,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ)) Q:'QQ  D
"RTN","PSJHL3",120,0)
 .I QQ=1 S SEGMENT(0)="NTE|21|L|"_$$ESC^ORHLESC(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ)) S:$G(PSJBCBU) SEGMENT(0)=SEGMENT(0)_"\.br\" Q
"RTN","PSJHL3",121,0)
 .S SEGMENT(QQ-1)=$$ESC^ORHLESC(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ))
"RTN","PSJHL3",122,0)
 .I $G(PSJBCBU) S SEGMENT(QQ-1)=SEGMENT(QQ-1)_"\.br\"
"RTN","PSJHL3",123,0)
 I RXORDER["V",'$D(SEGMENT(0)) N OPIHDR S OPIHDR=$D(^PS(55,PSJHLDFN,"IV",+RXORDER,10,0)) I $P(OPIHDR,"^",2),'$P(OPIHDR,"^",3) S SEGMENT(0)="NTE|21|L|"
"RTN","PSJHL3",124,0)
 I $D(SEGMENT(0)) D SET^PSJHLU K SEGMENT,^TMP("PSJBCMA5",$J)
"RTN","PSJHL3",125,0)
 ;end   *267
"RTN","PSJHL3",126,0)
RXC ;component segments
"RTN","PSJHL3",127,0)
 N ADDITIVE,SOLUTION,SUB,TYPE,AD,SOL,PTR,NUM,UTMP,XTMP
"RTN","PSJHL3",128,0)
 S LIMIT=24 X PSJCLEAR
"RTN","PSJHL3",129,0)
 S FIELD(0)="RXC"
"RTN","PSJHL3",130,0)
 ; In the line below, the naked reference refers to the full global reference represented in PSJORDER_TYPE...
"RTN","PSJHL3",131,0)
 ; This could be a reference to either ^PS(53.1 or ^PS(55
"RTN","PSJHL3",132,0)
 S AD="AD",SOL="SOL" F TYPE="AD","SOL" S SUB=0 F  S SUB=$O(@(PSJORDER_TYPE_","_SUB_")")) Q:SUB=""  S NODE1=$G(^(SUB,0)) Q:NODE1=""  D
"RTN","PSJHL3",133,0)
 .S FIELD(1)=$S(TYPE="AD":"A",1:"B")
"RTN","PSJHL3",134,0)
 .I FIELD(1)="A",($P(NODE1,U,3)="") S $P(NODE1,U,3)="A"
"RTN","PSJHL3",135,0)
 .S PTR=+$S(TYPE="AD":+$P($G(^PS(52.6,$P(NODE1,"^"),0)),"^",11),1:+$P($G(^PS(52.7,$P(NODE1,"^"),0)),"^",11))
"RTN","PSJHL3",136,0)
 .S FIELD(2)="^^^"_$S($G(PSJBCBU):+$P(NODE1,"^"),1:PTR)_"^"_$S($G(PSJBCBU):$S(TYPE="AD":$P($G(^PS(52.6,+$P(NODE1,"^"),0)),"^"),1:$P($G(^PS(52.7,+$P(NODE1,"^"),0)),"^")_" "_$P($G(^(0)),U,4)),1:$P($G(^PS(50.7,PTR,0)),"^"))
"RTN","PSJHL3",137,0)
 .S:(TYPE="AD"&$G(PSJBCBU)) FIELD(2)=FIELD(2)_$S($P(NODE1,"^",3)]"":" BOTTLE: "_$P(NODE1,"^",3),1:"")
"RTN","PSJHL3",138,0)
 .S FIELD(2)=FIELD(2)_"^99PSP"
"RTN","PSJHL3",139,0)
 .S FIELD(3)=$P($P(NODE1,"^",2)," ")
"RTN","PSJHL3",140,0)
 .S FIELD(4)=$P($P(NODE1,"^",2)," ",2)
"RTN","PSJHL3",141,0)
 .S FIELD(5)=$P(NODE1,"^",3)
"RTN","PSJHL3",142,0)
 .F XTMP=1:1:14 S UTMP($P("ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM^MMOL","^",XTMP))="PSIV-"_XTMP
"RTN","PSJHL3",143,0)
 .S NUM="" S:FIELD(4)'="" NUM=$G(UTMP(FIELD(4)))
"RTN","PSJHL3",144,0)
 .S FIELD(4)="^^^"_NUM_"^"_FIELD(4)_"^99OTH"
"RTN","PSJHL3",145,0)
 .D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",146,0)
 Q
"RTN","PSJHL3",147,0)
RXR ; med route segment
"RTN","PSJHL3",148,0)
 S LIMIT=4 X PSJCLEAR
"RTN","PSJHL3",149,0)
 S FIELD(0)="RXR"
"RTN","PSJHL3",150,0)
 I PSJORDER["IV" S FIELD(1)="^^^"_$P($G(@(PSJORDER_".2)")),"^",3) Q:$P(FIELD(1),U,4)=""  D
"RTN","PSJHL3",151,0)
 .N PSJUNITS S PSJUNITS=$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^")))
"RTN","PSJHL3",152,0)
 .S FIELD(1)=FIELD(1)_"^"_PSJUNITS_"^99PSR"
"RTN","PSJHL3",153,0)
 .S:$G(PSJBCBU) FIELD(4)="^^^"_$P($G(@(PSJORDER_"0)")),"^",4)_"^"_$$CODES^PSIVUTL($P($G(@(PSJORDER_"0)")),"^",4),55.01,.04)_"^99PSR"
"RTN","PSJHL3",154,0)
 I PSJORDER[53.1 S FIELD(1)="^^^"_$P($G(@(PSJORDER_"0)")),"^",3) Q:$P(FIELD(1),U,4)=""  D
"RTN","PSJHL3",155,0)
 .N PSJUNITS S PSJUNITS=$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^")))
"RTN","PSJHL3",156,0)
 .S FIELD(1)=FIELD(1)_"^"_PSJUNITS_"^99PSR"
"RTN","PSJHL3",157,0)
 .S:$G(PSJBCBU) FIELD(4)="^^^"_$P($G(@(PSJORDER_"0)")),"^",4)_"^"_$$CODES^PSIVUTL($P($G(@(PSJORDER_"0)")),"^",4),53.1,4)_"^99PSR"
"RTN","PSJHL3",158,0)
 S:FIELD(1)="" FIELD(1)="^^^"_$P(NODE1,"^",3)_"^"_$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(NODE1,"^",3),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(NODE1,"^",3),0)),"^")))_"^99PSR"
"RTN","PSJHL3",159,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",160,0)
 Q
"RTN","PSJHL3",161,0)
ZRX ; pharmacy Z-segment
"RTN","PSJHL3",162,0)
 D ZRX^PSJHLU
"RTN","PSJHL3",163,0)
 Q
"RTN","PSJHL3",164,0)
CNT ;Count dispense drugs for an order
"RTN","PSJHL3",165,0)
 S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  S CNT=CNT+1
"RTN","PSJHL3",166,0)
 Q
"RTN","PSJHL9")
0^71^B61245429^B61245429
"RTN","PSJHL9",1,0)
PSJHL9 ;BIR/LDT-VALIDATE INCOMING HL7 DATA/CREATE NEW ORDER ; 2/14/12 7:14am
"RTN","PSJHL9",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**1,18,31,42,47,50,63,72,75,58,80,110,111,134,267**;16 DEC 97;Build 158
"RTN","PSJHL9",3,0)
 ;
"RTN","PSJHL9",4,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJHL9",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL9",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL9",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL9",8,0)
 ; Reference to ^ORERR is supported by DBIA# 2187.
"RTN","PSJHL9",9,0)
 ; Reference to ^ORHLESC is supported by DBIA# 4922.
"RTN","PSJHL9",10,0)
 ;
"RTN","PSJHL9",11,0)
VALID ;
"RTN","PSJHL9",12,0)
 I APPL="",PSITEM="" S PSREASON="Missing or invalid Orderable Item" D ERROR Q
"RTN","PSJHL9",13,0)
 I PSITEM]"",'$D(^PS(50.7,+PSITEM,0)) S PSREASON="Missing or invalid Orderable Item" D ERROR Q
"RTN","PSJHL9",14,0)
 I $G(APPL)'["B",$G(APPL)'["A",+$G(ROUTE)'>0 S PSREASON="Missing or invalid Med Route" D ERROR Q
"RTN","PSJHL9",15,0)
 S APPL=$S($G(APPL)["B":"F",$G(APPL)["A":"F",$G(DISPENSE)]"":$$ORTYP(ROUTE,DISPENSE),1:$$TRYAGAIN(ROUTE,PSITEM))
"RTN","PSJHL9",16,0)
 S:APPL="" APPL="IP"
"RTN","PSJHL9",17,0)
 I APPL'="F" D
"RTN","PSJHL9",18,0)
 .I $G(SCHEDULE)]"" N X S X=SCHEDULE D  S SCHEDULE=X
"RTN","PSJHL9",19,0)
 ..I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L($P(X,"@"))>70)!($L($P(X,"@",2))>119)!($L(X)<1)!(X["P RN")!(X["PR N") S X="" Q
"RTN","PSJHL9",20,0)
 ..I X?.E1L.E S X=$$ENLU^PSGMI(X)
"RTN","PSJHL9",21,0)
 ..S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSJHL9",22,0)
 ..I X["Q0" S X="" Q
"RTN","PSJHL9",23,0)
 .I APPL["U",$G(SCHEDULE)="" S PSREASON="Missing or invalid schedule" D ERROR Q
"RTN","PSJHL9",24,0)
 .N DFN S DFN=PSJHLDFN D IN5^VADPT I 'VAIP(5) D:APPT=""  I APPL="UN",APPT="" S PSREASON="Cannot place Unit Dose orders for an Outpatient" D ERROR Q
"RTN","PSJHL9",25,0)
 .. I APPL="UP" S APPL="IN" Q
"RTN","PSJHL9",26,0)
 .. I APPL="IP" S APPL="IN" Q
"RTN","PSJHL9",27,0)
 .I $G(ROC)'="R",$G(ROUTE)'>0 S PSREASON="Missing or invalid Med Route" D ERROR Q
"RTN","PSJHL9",28,0)
 I APPL="F" D
"RTN","PSJHL9",29,0)
 .I '$O(^TMP("PSJNVO",$J,"SOL",0))&('$O(^TMP("PSJNVO",$J,"AD",0))) S PSREASON="IV Fluid orders must have at least one additive or solution" D ERROR Q
"RTN","PSJHL9",30,0)
 .I $G(IVCAT)="I",$G(INFRT)="" Q  ;Allow intermittent IV orders to have a null infusion rate.
"RTN","PSJHL9",31,0)
 .I $G(INFRT)="" S PSREASON="Invalid Infusion Rate" D ERROR Q
"RTN","PSJHL9",32,0)
 Q
"RTN","PSJHL9",33,0)
 ;
"RTN","PSJHL9",34,0)
ERROR ;Sends error msg to CPRS, logs error in OE/RR Errors file
"RTN","PSJHL9",35,0)
 S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON,.PSJMSG)
"RTN","PSJHL9",36,0)
 D EN1^PSJHLERR(PSJHLDFN,$S(PSOC="XO":"UX",1:"OC"),$P(ORDER,U),PSREASON) S QFLG=1 K ^TMP("PSJNVO",$J)
"RTN","PSJHL9",37,0)
 Q
"RTN","PSJHL9",38,0)
 ;
"RTN","PSJHL9",39,0)
NVO ; put new orders in non-verified orders file
"RTN","PSJHL9",40,0)
 I '$D(ROUTE) S ROUTE=""
"RTN","PSJHL9",41,0)
 I $G(ROUTE)="" S:APPL="F" ROUTE=$O(^PS(51.2,"B","INTRAVENOUS",0))
"RTN","PSJHL9",42,0)
 N DA,DR,DIE D ENGNN^PSGOETO S DIE="^PS(53.1,"
"RTN","PSJHL9",43,0)
 S DR="1////"_PROVIDER_";3////"_$$ESC^ORHLESC(ROUTE)_";4////"_$E(APPL)_";28////P"_";108////"_PSITEM_";27.1////"_LOGIN_";27////"_LOGIN_";.5////"_PSJHLDFN_";.24////"_PRIORITY_";125////"_$G(PRNTON)
"RTN","PSJHL9",44,0)
 I $G(LOC)]"" S:$P($G(^SC(+LOC,0)),U,3)="C" DR=DR_";113////"_LOC_";126////"_$G(APPT)
"RTN","PSJHL9",45,0)
 I $G(IVCAT)]"" S DR=DR_";128////"_IVCAT S ADMINS=""
"RTN","PSJHL9",46,0)
 S:$G(SCHTYP)]"" DR=DR_";7////"_SCHTYP
"RTN","PSJHL9",47,0)
 D ^DIE K PSJHLSKP S NEWORDER=DA,PSJORDER=DA_"P"
"RTN","PSJHL9",48,0)
 S $P(^PS(55,PSJHLDFN,5.1),"^",2)=PROVIDER
"RTN","PSJHL9",49,0)
 S:$G(ORDER)]"" $P(^PS(53.1,DA,0),"^",21)=$P(ORDER,"^")
"RTN","PSJHL9",50,0)
 S:$G(APPL)["P" $P(^PS(53.1,DA,0),"^",13)=1
"RTN","PSJHL9",51,0)
 S $P(^PS(53.1,DA,0),"^",18)=DA
"RTN","PSJHL9",52,0)
 S:$G(ROC)]"" $P(^PS(53.1,DA,0),"^",24)=ROC
"RTN","PSJHL9",53,0)
 S:$G(PREON)]"" $P(^PS(53.1,DA,0),"^",25)=PREON
"RTN","PSJHL9",54,0)
 S:$G(ADMINS) $P(^PS(53.1,DA,2),"^",5)=ADMINS
"RTN","PSJHL9",55,0)
 S:$G(REQST)]"" $P(^PS(53.1,DA,2.5),"^")=REQST
"RTN","PSJHL9",56,0)
 ; Transform duration units of doses to a for administrations
"RTN","PSJHL9",57,0)
 S:$E(DURATION,1,5)="doses" DURATION=$TR(DURATION,"doses","a")
"RTN","PSJHL9",58,0)
 S:$G(DURATION)]"" $P(^PS(53.1,DA,2.5),"^",2)=DURATION
"RTN","PSJHL9",59,0)
 S:$G(IVLIMIT)]"" $P(^PS(53.1,DA,2.5),"^",4)=IVLIMIT
"RTN","PSJHL9",60,0)
 I $G(REQST)]"",$G(DURATION)]"" S $P(^PS(53.1,DA,2.5),"^",3)=$$STOP(REQST,DURATION)
"RTN","PSJHL9",61,0)
 S:$G(INSTR)]"" $P(^PS(53.1,DA,.3),"^")=INSTR
"RTN","PSJHL9",62,0)
 I $G(INFRT)]"" D
"RTN","PSJHL9",63,0)
 .I INFRT S:(INFRT["Minutes"!(INFRT["Hours")) INFRT="INFUSE OVER "_INFRT
"RTN","PSJHL9",64,0)
 .S ^PS(53.1,DA,8)=IVTYP_"^^^^"_INFRT
"RTN","PSJHL9",65,0)
 S:$G(FREQ)]"" $P(^PS(53.1,DA,2),"^",6)=FREQ
"RTN","PSJHL9",66,0)
 S:$G(SCHTYP)]"" $P(^PS(53.1,DA,0),"^",7)=SCHTYP
"RTN","PSJHL9",67,0)
 I $G(APPL)'="I" I $G(INSTR)]"" N X S X=INSTR D STRIP I $S(X?.E1C.E:0,$L(X)>60:0,X="":0,X["^":0,X?1.P:1,1:1) S $P(^PS(53.1,DA,.2),"^",2)=X,$P(^PS(53.1,DA,.2),"^",5,6)=$G(DOSE)_"^"_$$UNESC^ORHLESC($G(UNIT))
"RTN","PSJHL9",68,0)
 S $P(^PS(53.1,DA,.2),"^",3)=ORDCON
"RTN","PSJHL9",69,0)
 I $G(SCHEDULE)]"" S $P(^PS(53.1,DA,2),"^")=$$UNESC^ORHLESC(SCHEDULE)
"RTN","PSJHL9",70,0)
 I $G(APPL)="I" I $G(UNITS)]"" S $P(^PS(53.1,DA,.3),"^")=$$UNESC^ORHLESC(UNITS)
"RTN","PSJHL9",71,0)
 S ^PS(53.1,DA,4)="^^^^^^"_CLERK
"RTN","PSJHL9",72,0)
 I $G(DISPENSE) S ^PS(53.1,DA,1,0)="^53.11P^1^1",^PS(53.1,DA,1,1,0)=DISPENSE_"^"_$$UNESC^ORHLESC(UNITS),^PS(53.1,DA,1,"B",$E(DISPENSE,1,30),1)=""
"RTN","PSJHL9",73,0)
 I $D(PROCOM) D
"RTN","PSJHL9",74,0)
 .I '$D(^PS(53.1,DA,12,0)) S ^(0)="^53.1012^0^0"
"RTN","PSJHL9",75,0)
 .S JJ=0 F  S JJ=$O(PROCOM(JJ)) Q:'JJ  S $P(^PS(53.1,DA,12,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,12,JJ,0)=$$UNESC^ORHLESC(PROCOM(JJ))
"RTN","PSJHL9",76,0)
 I $D(ADMINSTR) D
"RTN","PSJHL9",77,0)
 .I '$D(^PS(53.1,DA,3,0)) S ^(0)="^53.12^0^0"
"RTN","PSJHL9",78,0)
 .S JJ=0 F  S JJ=$O(ADMINSTR(JJ)) Q:'JJ  S $P(^PS(53.1,DA,3,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,3,JJ,0)=ADMINSTR(JJ)
"RTN","PSJHL9",79,0)
 I $D(^TMP("PSJNVO",$J,"AD")) D
"RTN","PSJHL9",80,0)
 .S ^PS(53.1,DA,"AD",0)="^53.157PA^0^0"
"RTN","PSJHL9",81,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,"AD",JJ)) Q:'JJ  S $P(^PS(53.1,DA,"AD",0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,"AD",JJ,0)=^TMP("PSJNVO",$J,"AD",JJ,0),^PS(53.1,DA,"AD","B",$$UNESC^ORHLESC($P(^TMP("PSJNVO",$J,"AD",JJ,0),"^")),JJ)=""
"RTN","PSJHL9",82,0)
 I $D(^TMP("PSJNVO",$J,"SOL")) D
"RTN","PSJHL9",83,0)
 .S ^PS(53.1,DA,"SOL",0)="^53.158PA^0^0"
"RTN","PSJHL9",84,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,"SOL",JJ)) Q:'JJ  S $P(^PS(53.1,DA,"SOL",0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,"SOL",JJ,0)=^TMP("PSJNVO",$J,"SOL",JJ,0),^PS(53.1,DA,"SOL","B",$P(^TMP("PSJNVO",$J,"SOL",JJ,0),"^"),JJ)=""
"RTN","PSJHL9",85,0)
 I $O(^TMP("PSJNVO",$J,10,0)) D
"RTN","PSJHL9",86,0)
 .S ^PS(53.1,DA,10,0)="^53.1112A^0^0"
"RTN","PSJHL9",87,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,10,JJ)) Q:'JJ  S $P(^PS(53.1,DA,10,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,10,JJ,0)=$$UNESC^ORHLESC(^TMP("PSJNVO",$J,10,JJ,0)),^PS(53.1,DA,10,"B",$$UNESC^ORHLESC($E(^TMP("PSJNVO",$J,10,JJ,0),1,30)),JJ)="" D
"RTN","PSJHL9",88,0)
 ..S ^PS(53.1,DA,10,JJ,1)=$P($G(^VA(200,+CLERK,0)),"^")
"RTN","PSJHL9",89,0)
 ..I $O(^TMP("PSJNVO",$J,10,JJ,2,0)) S ^PS(53.1,DA,10,JJ,2,0)="^53.11122^0^0" D
"RTN","PSJHL9",90,0)
 ...S QQ=0 F  S QQ=$O(^TMP("PSJNVO",$J,10,JJ,2,QQ)) Q:'QQ  S $P(^PS(53.1,DA,10,JJ,2,0),"^",3,4)=QQ_"^"_QQ,^PS(53.1,DA,10,JJ,2,QQ,0)=$$UNESC^ORHLESC(^TMP("PSJNVO",$J,10,JJ,2,QQ,0))
"RTN","PSJHL9",91,0)
 Q
"RTN","PSJHL9",92,0)
STRIP ;Strips spaces off the end of instructions.
"RTN","PSJHL9",93,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSJHL9",94,0)
 Q
"RTN","PSJHL9",95,0)
 ;
"RTN","PSJHL9",96,0)
ORTYP(MDRT,DDRG)        ;Entry point to determine order type for 53.1
"RTN","PSJHL9",97,0)
 ;MDRT=Med Route from 51.2, DDRG=Dispense Drug
"RTN","PSJHL9",98,0)
 I '$G(DDRG) S ORTYP="" Q ORTYP
"RTN","PSJHL9",99,0)
 I '$D(^PSDRUG(+DDRG,2)) S ORTYP="" Q ORTYP
"RTN","PSJHL9",100,0)
 I $P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PSDRUG(DDRG,2),"^",3)'["U" S ORTYP="" Q ORTYP
"RTN","PSJHL9",101,0)
 I '$G(MDRT) S ORTYP="" Q ORTYP
"RTN","PSJHL9",102,0)
 I '$D(^PS(51.2,+MDRT,0)) S ORTYP="" Q ORTYP
"RTN","PSJHL9",103,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PSDRUG(DDRG,2),"^",3)'["U",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="IN" Q ORTYP
"RTN","PSJHL9",104,0)
 I $P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="UP" Q ORTYP
"RTN","PSJHL9",105,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="IP" Q ORTYP
"RTN","PSJHL9",106,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PSDRUG(DDRG,2),"^",3)'["U",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="IP" Q ORTYP
"RTN","PSJHL9",107,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["U",$P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="UN" Q ORTYP
"RTN","PSJHL9",108,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["U",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="UP" Q ORTYP
"RTN","PSJHL9",109,0)
 S ORTYP="" Q ORTYP
"RTN","PSJHL9",110,0)
 ;
"RTN","PSJHL9",111,0)
TRYAGAIN(MDRT,OI)       ;
"RTN","PSJHL9",112,0)
 ;MDRT=Med Route from 51.2, OI=Orderable Item
"RTN","PSJHL9",113,0)
 N ORTYPI,ORTYPU,ORTYPP
"RTN","PSJHL9",114,0)
 S ORTYP="",ORTYPI=0,ORTYPU=0,ORTYPP=0
"RTN","PSJHL9",115,0)
 N DDRG S DDRG=0 F  S DDRG=$O(^PSDRUG("ASP",OI,DDRG)) Q:'DDRG  D 
"RTN","PSJHL9",116,0)
 .I $G(^PSDRUG(DDRG,"I"))]"" Q:^PSDRUG(DDRG,"I")'>DT
"RTN","PSJHL9",117,0)
 .S ORTYP=$$ORTYP(MDRT,DDRG)  D
"RTN","PSJHL9",118,0)
 ..I ORTYP["I" S ORTYPI=ORTYPI+1
"RTN","PSJHL9",119,0)
 ..I ORTYP["U" S ORTYPU=ORTYPU+1
"RTN","PSJHL9",120,0)
 ..I ORTYP["P" S ORTYPP=ORTYPP+1
"RTN","PSJHL9",121,0)
 S ORTYP=$S(ORTYPU>ORTYPI:"U",1:"I") S ORTYP=ORTYP_$S(ORTYPP>0:"P",1:"N")
"RTN","PSJHL9",122,0)
 Q ORTYP
"RTN","PSJHL9",123,0)
 ;
"RTN","PSJHL9",124,0)
STOP(REQST,DURA)   ;
"RTN","PSJHL9",125,0)
 ;REQST=Requested start date, DURA=Duration from CPRS
"RTN","PSJHL9",126,0)
 I DURA["L",DURA?1A1".".N S DAYS=$$DAY($E(REQST,1,5)),DURA="H"_((DAYS*$P(DURA,"L",2))*24)
"RTN","PSJHL9",127,0)
 I DURA["L",DURA?1A.1N.N1"."1N.N D  Q STOP
"RTN","PSJHL9",128,0)
 .S NUM=$E(REQST,4,5)+$P($P(DURA,"."),"L",2),NUM=$S(NUM<10:"0"_NUM,NUM<13:NUM,1:$S((NUM-12)<10:"0"_(NUM-12),1:(NUM-12))),DATE=$E(REQST,1,3)_NUM
"RTN","PSJHL9",129,0)
 .S DAYS=$$DAY(DATE),STOP=$$SCH^XLFDT($P($P(DURA,"."),"L",2)_"M",$P(REQST,"."))_"."_$P(REQST,".",2),DEL=$P($P(DURA,"L",2),"."),STOP=$$FMADD^XLFDT(STOP,"",((DAYS*$P(DURA,DEL,2))*24))
"RTN","PSJHL9",130,0)
 I DURA["L" S STOP=$P($$SCH^XLFDT($P(DURA,"L",2)_"M",$P(REQST,".")),".")_"."_$P(REQST,".",2) Q STOP
"RTN","PSJHL9",131,0)
 I DURA["W",DURA["." S DURA="H"_(($P(DURA,"W",2)*7)*24)
"RTN","PSJHL9",132,0)
 I DURA["D",DURA["." S DURA="H"_($P(DURA,"D",2)*24)
"RTN","PSJHL9",133,0)
 I +DURA=DURA,DURA["." S DURA="H"_(DURA*24)
"RTN","PSJHL9",134,0)
 S STOP=$$FMADD^XLFDT(REQST,$S(DURA["W":$P(DURA,"W",2)*7,DURA["D":$P(DURA,"D",2),+DURA=DURA:+DURA,1:""),$S(DURA["H":$P(DURA,"H",2),1:""),$S(DURA["M":$P(DURA,"M",2),1:""),$S(DURA["S":$P(DURA,"S",2),1:""))
"RTN","PSJHL9",135,0)
 Q STOP
"RTN","PSJHL9",136,0)
ZQDATE(DATE,MONTHS)  ;BUMP DATE BY A MONTH (OR SO)
"RTN","PSJHL9",137,0)
 ;;
"RTN","PSJHL9",138,0)
 S X=$E($P(DATE,"."),1,5)+($E($P(DATE,"."),4,5)>(12-MONTHS)*88+MONTHS)_$E($P(DATE,"."),6,7) F  D ^%DT Q:Y>0  S X=X-1
"RTN","PSJHL9",139,0)
 S NEWDATE=X_"."_$P(DATE,".",2)
"RTN","PSJHL9",140,0)
 Q NEWDATE
"RTN","PSJHL9",141,0)
DAY(DATE) ;DATE=FIRST FIVE DIGITS OF FM DATE
"RTN","PSJHL9",142,0)
 N X
"RTN","PSJHL9",143,0)
 I DATE'?5N Q -1
"RTN","PSJHL9",144,0)
 S X=$E(DATE,4,5) I X<1!(X>12) Q -1
"RTN","PSJHL9",145,0)
 S X=DATE+1+(X=12*88)_"01"
"RTN","PSJHL9",146,0)
 Q $E($$FMADD^XLFDT(X,-1),6,7)
"RTN","PSJHLU")
0^53^B45862286^B34870321
"RTN","PSJHLU",1,0)
PSJHLU ;BIR/RLW-UTILITIES USED IN BUILDING HL7 SEGMENTS ;4/24/12 2:52pm
"RTN","PSJHLU",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**1,56,72,102,134,181,267**;16 DEC 97;Build 158
"RTN","PSJHLU",3,0)
 ;
"RTN","PSJHLU",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHLU",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHLU",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJHLU",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHLU",8,0)
 ;
"RTN","PSJHLU",9,0)
 ;*267 Change NTE|21 so it can send over the Long Wp Special Inst/
"RTN","PSJHLU",10,0)
 ;     Other Prt Info fields if populated.
"RTN","PSJHLU",11,0)
 ;
"RTN","PSJHLU",12,0)
INIT ; set up HL7 application variables
"RTN","PSJHLU",13,0)
 S PSJHLSDT="PS",PSJHINST=$P($$SITE^VASITE(),"^")
"RTN","PSJHLU",14,0)
 S PSJCLEAR="K FIELD F J=0:1:LIMIT S FIELD(J)="""""
"RTN","PSJHLU",15,0)
 Q
"RTN","PSJHLU",16,0)
 ;
"RTN","PSJHLU",17,0)
SEGMENT(LIMIT) ;
"RTN","PSJHLU",18,0)
 K SEGMENT
"RTN","PSJHLU",19,0)
 N SUBSEG,SEGLENGT S SUBSEG=0,SEGMENT="" F J=0:1:LIMIT D
"RTN","PSJHLU",20,0)
 .I SEGMENT']"" S SEGMENT=FIELD(J) Q
"RTN","PSJHLU",21,0)
 .S SEGMENT=SEGMENT_"|"_FIELD(J)
"RTN","PSJHLU",22,0)
 F  S SEGLENGT=$L(SEGMENT) D  Q:$L(SEGMENT)'>246
"RTN","PSJHLU",23,0)
 .I SEGLENGT'>246 S SEGMENT(SUBSEG)=SEGMENT
"RTN","PSJHLU",24,0)
 .I SEGLENGT>245 S SEGMENT(SUBSEG)=$E(SEGMENT,1,245),SUBSEG=SUBSEG+1 D
"RTN","PSJHLU",25,0)
 ..S SEGMENT=$E(SEGMENT,246,SEGLENGT),SEGMENT(SUBSEG)=$E(SEGMENT,1,245)
"RTN","PSJHLU",26,0)
SET S PSJI=PSJI+1,^TMP("PSJHLS",$J,PSJHLSDT,PSJI)=SEGMENT(0)
"RTN","PSJHLU",27,0)
 F J=1:1 Q:'$D(SEGMENT(J))  S ^TMP("PSJHLS",$J,PSJHLSDT,PSJI,J)=SEGMENT(J)
"RTN","PSJHLU",28,0)
 Q
"RTN","PSJHLU",29,0)
 ;
"RTN","PSJHLU",30,0)
SEGMENT2 ; Retrieve text fields
"RTN","PSJHLU",31,0)
 K SEGMENT S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"12,"_JJ_",0)"))
"RTN","PSJHLU",32,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_$S($G(PSJBCBU):SEGMENT(0),1:$$ESC^ORHLESC(SEGMENT(0))) D
"RTN","PSJHLU",33,0)
 .D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHLU",34,0)
 ;build NTE 21 with Special Inst/Other Prt Info Wp fields  *267
"RTN","PSJHLU",35,0)
 N QQ K ^TMP("PSJBCMA5",$J)
"RTN","PSJHLU",36,0)
 D GETSIOPI^PSJBCMA5(PSJHLDFN,RXORDER,1)
"RTN","PSJHLU",37,0)
 I RXORDER["V"!(RXORDER["U") I ($G(PSJORD)["P"),($P($G(^PS(53.1,+PSJORD,0)),"^",25)=RXORDER) D
"RTN","PSJHLU",38,0)
 .D GETSIOPI^PSJBCMA5(PSJHLDFN,PSJORD,1)
"RTN","PSJHLU",39,0)
 .N LINES,TEXT1 S LINES=($G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD))),TEXT1=$G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD,1))
"RTN","PSJHLU",40,0)
 .I LINES<1!(LINES=1&(TEXT1["Instructions too long. See Order View or BCMA for full text")) Q
"RTN","PSJHLU",41,0)
 .K ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER) M ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER)=^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD) K ^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD)
"RTN","PSJHLU",42,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ)) Q:'QQ  D
"RTN","PSJHLU",43,0)
 .I QQ=1 D  Q
"RTN","PSJHLU",44,0)
 ..S SEGMENT(0)="NTE|21|L|"_$$ESC^ORHLESC(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ))
"RTN","PSJHLU",45,0)
 ..S:$G(PSJBCBU) SEGMENT(0)=SEGMENT(0)_"\.br\"
"RTN","PSJHLU",46,0)
 .S SEGMENT(QQ-1)=$$ESC^ORHLESC(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ))
"RTN","PSJHLU",47,0)
 .S:$G(PSJBCBU) SEGMENT(QQ-1)=SEGMENT(QQ-1)_"\.br\"
"RTN","PSJHLU",48,0)
 I $D(SEGMENT(0)) D SET^PSJHLU K SEGMENT,^TMP("PSJBCMA5",$J)
"RTN","PSJHLU",49,0)
 ;*267 end
"RTN","PSJHLU",50,0)
 Q
"RTN","PSJHLU",51,0)
 ;
"RTN","PSJHLU",52,0)
CALL(HLEVN) ; call DHCP HL7 package -or- protocol, to pass Orders
"RTN","PSJHLU",53,0)
 ; HLEVN = number of segments in message
"RTN","PSJHLU",54,0)
 K CLERK,DDIEN,DDNUM,DOSEFORM,DOSEOR,FIELD,IVTYPE,LIMIT,NAME,NDNODE,NODE1,NODE2,PRODNAME,PROVIDER,PSGS0Y,PSJHINST,PSJHLSDT,PSJI,PSJORDER,PSOC,PSREASON,ROOMBED,SPDIEN,SEGMENT,%
"RTN","PSJHLU",55,0)
 I $G(PSJBCBU)=1 M PSJNAME=^TMP("PSJHLS",$J,"PS") Q
"RTN","PSJHLU",56,0)
 S PSJMSG="^TMP(""PSJHLS"",$J,""PS"")"
"RTN","PSJHLU",57,0)
 D MSG^XQOR("PS EVSEND OR",.PSJMSG)
"RTN","PSJHLU",58,0)
 I $G(RXORDER),$G(PSJHLDFN) N PSJSTOP S PSJSTOP=$S(RXORDER["U":$P(^PS(55,PSJHLDFN,5,+RXORDER,2),"^",4),RXORDER["V":$P(^PS(55,PSJHLDFN,"IV",+RXORDER,0),"^",3),1:"") I PSJSTOP D
"RTN","PSJHLU",59,0)
 .N PSJSTATU S PSJSTATU=$S(RXORDER["U":$P(^PS(55,PSJHLDFN,5,+RXORDER,0),"^",9),RXORDER["V":$P(^PS(55,PSJHLDFN,"IV",+RXORDER,0),"^",17),1:"")
"RTN","PSJHLU",60,0)
 .I ",A,H,"[(","_PSJSTATU_",") D NOW^%DTC I PSJSTOP<% N RXON S RXON=RXORDER D EXPIR^PSJHL6
"RTN","PSJHLU",61,0)
 Q
"RTN","PSJHLU",62,0)
 ;
"RTN","PSJHLU",63,0)
IVTYPE(PSJORDER) ; check whether a back-door order is Inpatient IV or IV fluid
"RTN","PSJHLU",64,0)
 I RXORDER["V",$P($G(@(PSJORDER_"0)")),"^",4)'="A" Q "I"
"RTN","PSJHLU",65,0)
 I RXORDER["P" I $P($G(@(PSJORDER_"0)")),"^",4)'="F" S IVTYPE="" Q IVTYPE
"RTN","PSJHLU",66,0)
 N SUB,AD,SOL,IVTYPE,NODE1 S SUB=0,IVTYPE="F"
"RTN","PSJHLU",67,0)
 ;naked reference on line below refers to the full indirect reference of PSJORDER_ which is from ^PS(55,DFN,"IV",PSJORD
"RTN","PSJHLU",68,0)
 F TYPE="AD","SOL" S SUB=0 F  S SUB=$O(@(PSJORDER_""""_TYPE_""""_","_SUB_")")) Q:(SUB="")!(IVTYPE="I")  S NODE1=$G(^(SUB,0)) Q:NODE1=""  D  Q:IVTYPE="I"
"RTN","PSJHLU",69,0)
 .I TYPE="AD" D
"RTN","PSJHLU",70,0)
 ..I '$P($G(^PS(52.6,$P(NODE1,"^"),0)),"^",13) S IVTYPE="I"
"RTN","PSJHLU",71,0)
 .D:TYPE="SOL"
"RTN","PSJHLU",72,0)
 ..S:'$P($G(^PS(52.7,$P(NODE1,"^"),0)),"^",13) IVTYPE="I"
"RTN","PSJHLU",73,0)
 Q IVTYPE
"RTN","PSJHLU",74,0)
ENI ;Calculate Frequency for IV orders
"RTN","PSJHLU",75,0)
 N INFUSE
"RTN","PSJHLU",76,0)
 I X?.E1L.E S INFUSE=$$ENLU^PSGMI(X) Q:(INFUSE="TITRATE")!(INFUSE="BOLUS")!($P(INFUSE," ")="INFUSE")!($P(INFUSE," ")="Infuse")
"RTN","PSJHLU",77,0)
 Q:(X="TITRATE")!(X="BOLUS")!($P(X," ")="INFUSE")!($P(X," ")="Infuse")
"RTN","PSJHLU",78,0)
 Q:$$INTRMT(X)
"RTN","PSJHLU",79,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","PSJHLU",80,0)
 I X["=" D  Q   ; NOIS LOU-0501-42191
"RTN","PSJHLU",81,0)
 .N X2,X1 S X1=$P(X,"="),X2=$P(X,"=",2)
"RTN","PSJHLU",82,0)
 .I X1["ML/HR",(+X1=$P(X1,"ML/HR"))!(+X1=$P(X1," ML/HR")) D
"RTN","PSJHLU",83,0)
 ..S X1=$TR(X1,"ML/HR","ml/hr")
"RTN","PSJHLU",84,0)
 .I X2["ML/HR",(+X2=$P(X2,"ML/HR"))!(+X2=$P(X2," ML/HR")) D
"RTN","PSJHLU",85,0)
 ..S X2=$TR(X2,"ML/HR","ml/hr")
"RTN","PSJHLU",86,0)
 .I X1[" ml/hr",(+X1=$P(X1," ml/hr")) D
"RTN","PSJHLU",87,0)
 ..S X1=$P(X1," ml/hr")_$P(X1," ml/hr",2,9999)
"RTN","PSJHLU",88,0)
 .I X2[" ml/hr",(+X2=$P(X2," ml/hr")) D
"RTN","PSJHLU",89,0)
 ..S X2=$P(X2," ml/hr")_$P(X2," ml/hr",2,9999)
"RTN","PSJHLU",90,0)
 .I X1["ml/hr",(+X1=$P(X1,"ml/hr")) D
"RTN","PSJHLU",91,0)
 ..S X1=$P(X1,"ml/hr")_$P(X1,"ml/hr",2,9999)
"RTN","PSJHLU",92,0)
 .I X2["ml/hr",(+X2=$P(X2,"ml/hr")) D
"RTN","PSJHLU",93,0)
 ..S X2=$P(X2,"ml/hr")_$P(X2,"ml/hr",2,9999)
"RTN","PSJHLU",94,0)
 .I X2'=+X2 D
"RTN","PSJHLU",95,0)
 ..I ($P(X2,"@",2,999)'=+$P(X2,"@",2,999)!(+$P(X2,"@",2,999)<0)) K X Q
"RTN","PSJHLU",96,0)
 .I X1=+X1 S X1=X1_" ml/hr"
"RTN","PSJHLU",97,0)
 .I X2=+X2 S X2=X2_" ml/hr"
"RTN","PSJHLU",98,0)
 .S:$P(X2,"@")=+X2 $P(X2,"@")=$P(X2,"@")_" ml/hr"
"RTN","PSJHLU",99,0)
 .S X=X1_"="_X2
"RTN","PSJHLU",100,0)
 I X'=+X,($P($TR(X," ml/hr",""),"@",2,999)'=+$P($TR(X," ml/hr",""),"@",2,999)!(+$P(X,"@",2,999)<0)),($P(X," ml/hr")'=+$P(X," ml/hr")!(+$P(X," ml/hr")<0)) Q:(X>0&($E(X)=0))  K X Q
"RTN","PSJHLU",101,0)
 I X=+X!(X>0&($E(X)=0)) S:$S(X'["ml/hr":0,X["@":0,1:1) X=X_" ml/hr" D SPSOL S FREQ=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSJHLU",102,0)
 I X[" ml/hr" D SPSOL S FREQ=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSJHLU",103,0)
 S SPSOL=$P(X,"@",2) S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr" S FREQ=$S('SPSOL:0,1:1440/SPSOL\1) K SPSOL
"RTN","PSJHLU",104,0)
 Q
"RTN","PSJHLU",105,0)
SPSOL S SPSOL=+TVOLUME Q
"RTN","PSJHLU",106,0)
INTRMT(X) ;
"RTN","PSJHLU",107,0)
 Q:'$P(X," ") 0
"RTN","PSJHLU",108,0)
 Q:$P(X," ",2)="Minutes" 1
"RTN","PSJHLU",109,0)
 Q:$P(X," ",2)="Hours" 1
"RTN","PSJHLU",110,0)
 Q 0
"RTN","PSJHLU",111,0)
IVCAT(DFN,PSJORD,PARRAY) ; This returns the IV CATEGORY based on the IV TYPE and CHEMO TYPE (not what is already in the IV CATEGORY field)
"RTN","PSJHLU",112,0)
 ;  Passed in:  PSJORDER (file root of order)
"RTN","PSJHLU",113,0)
 N NODE,TYP,CHEMTYP,INTSYR,ND2P5
"RTN","PSJHLU",114,0)
 S (CHEMTYP,INTSYR)=""
"RTN","PSJHLU",115,0)
 S TYP=$G(P(4)),INTSYR=$G(P(5)),CHEMTYP=$G(P(23))
"RTN","PSJHLU",116,0)
 I TYP="",$G(PSJORD)["V" S NODE=$G(^PS(55,DFN,"IV",+PSJORD,0)) S TYP=$P(NODE,"^",4),INTSYR=$P(NODE,"^",5),CHEMTYP=$P(NODE,"^",23)
"RTN","PSJHLU",117,0)
 I TYP="",$G(PSJORD)["P" S NODE=$G(^PS(53.1,+PSJORD,8)) S TYP=$P(NODE,"^"),INTSYR=$P(NODE,"^",4),CHEMTYP=$P(NODE,"^",2)
"RTN","PSJHLU",118,0)
 I TYP="" S TYP=$G(PARRAY(4)),INTSYR=$G(PARRAY(5)),CHEMTYP=$G(PARRAY(23))
"RTN","PSJHLU",119,0)
 Q:$G(TYP)="" ""
"RTN","PSJHLU",120,0)
 S CAT=$S(",A,H,"[(","_TYP_","):"C",TYP="C"&(",A,H,S,"[(","_CHEMTYP_",")&'INTSYR):"C",TYP="C"&(CHEMTYP="P"):"I",TYP="S"&'INTSYR:"C",TYP="P":"I",$G(INTSYR):"I",1:"")
"RTN","PSJHLU",121,0)
 Q CAT
"RTN","PSJHLU",122,0)
ZRX ; Perform outbound processing
"RTN","PSJHLU",123,0)
 N NODE1
"RTN","PSJHLU",124,0)
 S NODE1=$G(@(PSJORDER_"0)"))
"RTN","PSJHLU",125,0)
 S LIMIT=6 X PSJCLEAR
"RTN","PSJHLU",126,0)
 S FIELD(0)="ZRX"
"RTN","PSJHLU",127,0)
 I '$G(PSJREN) N PREON,PSJREN I $G(PSJORD)["U"&($P(NODE1,"^",24)="R") S PSJREN=1
"RTN","PSJHLU",128,0)
 I $G(PSJORD)["V"&($P(NODE2,"^",8)="R") S PSJREN=1
"RTN","PSJHLU",129,0)
 S PREON=$S($G(PSJREN):$G(PSJORD),PSJORDER["IV":$P(NODE2,"^",5),1:$P(NODE1,"^",25))
"RTN","PSJHLU",130,0)
 S FIELD(1)=$S(PREON["P":$P($G(^PS(53.1,+PREON,0)),"^",21),PREON["V":$P($G(^PS(55,PSJHLDFN,"IV",+PREON,0)),"^",21),1:$P($G(^PS(55,PSJHLDFN,5,+PREON,0)),"^",21))
"RTN","PSJHLU",131,0)
 S FIELD(2)=$S(PSJORDER["IV":$G(P("NAT")),1:$G(PSJNOO))
"RTN","PSJHLU",132,0)
 S FIELD(3)=$S($G(PSJREN):"R",PSJORDER["IV":$P(NODE2,"^",8),1:$P(NODE1,"^",24))
"RTN","PSJHLU",133,0)
 I FIELD(3)="" I PSOC="SN" S FIELD(3)="N"
"RTN","PSJHLU",134,0)
 I $D(P)>1 S FIELD(6)=$$IVCAT^PSJHLU(PSJHLDFN,RXORDER,.P)
"RTN","PSJHLU",135,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSJHLU",136,0)
 S FIELD(5)=DUZ_"^"_$S($G(PSJBCBU):NAME,1:$$ESC^ORHLESC(NAME))_"^"_"99NP"
"RTN","PSJHLU",137,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHLU",138,0)
 Q
"RTN","PSJINHIS")
0^70^B7395737^n/a
"RTN","PSJINHIS",1,0)
PSJINHIS ;BIR/MLM-PRINT HISTORY LOG ;23 SEP 97 / 1:10 PM 
"RTN","PSJINHIS",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**267**;16 DEC 97;Build 158
"RTN","PSJINHIS",3,0)
 ;
"RTN","PSJINHIS",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJINHIS",5,0)
 ; Reference to ^%ZTLOAD is supported by DBIA 10063.
"RTN","PSJINHIS",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSJINHIS",7,0)
 ; Reference to ^%ZIS is supported by DBIA 10086.
"RTN","PSJINHIS",8,0)
 ; Reference to ^%ZISC is supported by DBIA 10089.
"RTN","PSJINHIS",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJINHIS",10,0)
 ;
"RTN","PSJINHIS",11,0)
ENHIS(DFN,PSJHON,PSJHT) ; History log from beginning.
"RTN","PSJINHIS",12,0)
 N POP,X,ZTIO,ZTRTN
"RTN","PSJINHIS",13,0)
 W ! K IO("Q"),%ZIS,IOP S %ZIS="QM" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED" G K
"RTN","PSJINHIS",14,0)
 G:'$D(IO("Q")) DEQ K IO("Q"),ZTDTH,ZTSAVE,ZTSK S ZTIO=ION,ZTRTN="DEQ^PSJINHIS" F X="DFN","PSJHON","PSJHT","PSJORD","PSJSYSU","PSJSYSP" S ZTSAVE(X)="",ZTDESC="INPATIENT HISTORY LOG"
"RTN","PSJINHIS",15,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"Queued."
"RTN","PSJINHIS",16,0)
 D HOME^%ZIS
"RTN","PSJINHIS",17,0)
 Q
"RTN","PSJINHIS",18,0)
 ;
"RTN","PSJINHIS",19,0)
DEQ ; Entry from queue.
"RTN","PSJINHIS",20,0)
 N DIR,DONE,DTOUT,DUOUT,HDT,ON,ON55,P,PG,PPAGE,PSGORD,PSIVAC,PSJACNWP,PSJNEW,PSJPTR,UL80,PSJCHTO,PSJPR,PSJPRCOM,TMPTO,PN,PSJHDRF,%,ZTREQ,ZTQUEUED S PN=0
"RTN","PSJINHIS",21,0)
 S PSJCHTO="" S PSGP=DFN,PSJACNWP=1 D ENBOTH^PSJAC,NOW^%DTC S UL80="",$P(UL80,"-",80)="",HDT=$$ENDTC^PSGMI(%),PSJPTR=$E(IOST)'="C",PG=0,ON=PSJHON,PSIVAC="PH" U IO
"RTN","PSJINHIS",22,0)
 D RELATE,ENHEAD:PSJPTR W:'PSJPTR&($Y) @IOF I '$L(PSJOLD_PSJNEW) I $G(PSJORD) N PSGORD S PSGORD=PSJORD D EN0^PSJINVW(1,.PSJCHTO) G K
"RTN","PSJINHIS",23,0)
 S:'PSJOLD PSJOLD=PSJHON F  S ON=PSJOLD D RELATE Q:PSJOLD=""
"RTN","PSJINHIS",24,0)
 F  D DISPLAY,RELATE S ON=PSJNEW Q:PSJNEW=""!$D(DONE)
"RTN","PSJINHIS",25,0)
 ;
"RTN","PSJINHIS",26,0)
K ; Kill and exit.
"RTN","PSJINHIS",27,0)
 K DFN,PSJHON,PSJHT,TMPTO
"RTN","PSJINHIS",28,0)
 W:$G(PSJPTR)&($Y) @IOF S:$D(ZTQUEUED) ZTREQ="@" D ^%ZISC
"RTN","PSJINHIS",29,0)
 W !!
"RTN","PSJINHIS",30,0)
 Q
"RTN","PSJINHIS",31,0)
 ;
"RTN","PSJINHIS",32,0)
DISPLAY ; Display order.
"RTN","PSJINHIS",33,0)
 S PSGORD=ON N PSJLM D EN0^PSJINVW(1,.PSJCHTO)
"RTN","PSJINHIS",34,0)
 Q
"RTN","PSJINHIS",35,0)
 ;
"RTN","PSJINHIS",36,0)
PAUSE ; Hold screen.
"RTN","PSJINHIS",37,0)
 K DIR S DIR(0)="E" D ^DIR S:$D(DTOUT)!($D(DUOUT)) DONE=1
"RTN","PSJINHIS",38,0)
 Q
"RTN","PSJINHIS",39,0)
RELATE ; Get related order.
"RTN","PSJINHIS",40,0)
 I ON["U"!(ON["A")!(ON["O") S PSJOLD=$P($G(^PS(55,DFN,5,+ON,0)),U,25),PSJNEW=$P($G(^(0)),U,26) Q
"RTN","PSJINHIS",41,0)
 I ON["V" S PSJOLD=$P($G(^PS(55,DFN,"IV",+ON,2)),U,5),PSJNEW=$P($G(^(2)),U,6) Q
"RTN","PSJINHIS",42,0)
 S PSJOLD=$P($G(^PS(53.1,+ON,0)),U,25),PSJNEW=$P($G(^(0)),U,26) I PSJNEW=ON S PSJNEW=""
"RTN","PSJINHIS",43,0)
 Q
"RTN","PSJINHIS",44,0)
 ;
"RTN","PSJINHIS",45,0)
ENHEAD ; Header for Inpatient History log.
"RTN","PSJINHIS",46,0)
 S PPAGE=0 NEW PSJNEW D ENTRY^PSJHEAD(PSGP,0,0,0,0)
"RTN","PSJINHIS",47,0)
 Q
"RTN","PSJINVW")
0^69^B101370185^n/a
"RTN","PSJINVW",1,0)
PSJINVW ;BIR/CML3-INSTRUCTION HISTORY ;17 SEP 97 /  1:41 PM
"RTN","PSJINVW",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**267**;16 DEC 97;Build 158
"RTN","PSJINVW",3,0)
 ;
"RTN","PSJINVW",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJINVW",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJINVW",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJINVW",7,0)
 ;
"RTN","PSJINVW",8,0)
EN0(PSJINHIS,PSJCHTO) ;
"RTN","PSJINVW",9,0)
 N PNM,PSJFULL S PSJFULL=20
"RTN","PSJINVW",10,0)
 D EN2 Q
"RTN","PSJINVW",11,0)
 Q
"RTN","PSJINVW",12,0)
EN2 ;
"RTN","PSJINVW",13,0)
 I PSGORD=+PSGORD N PSGO,PSGO1 S PSGO=PSGORD,PSGO1=0 F  S PSGO1=$O(^PS(53.1,"ACX",PSGO,PSGO1)) Q:'PSGO1  Q:$G(PSGOEA)["^"  S PSGORD=PSGO1_"P" D  S PSGORD=""
"RTN","PSJINVW",14,0)
 . D EN21 K CONT D  Q:$G(PSGOEA)["^"
"RTN","PSJINVW",15,0)
 .. W !!,"Press RETURN to continue or '^' to exit: " S PN=$G(PN)+2 R CONT:DTIME W @IOF S:CONT["^" PSGOEA="^",PSGPR=1,PSJPR=1
"RTN","PSJINVW",16,0)
 I PSGORD="" S PSGOEA="^" Q
"RTN","PSJINVW",17,0)
EN21 ;
"RTN","PSJINVW",18,0)
 N PSIVFLG S PSIVFLG=0 I PSGORD["P" S PSIVFLG=$P(^PS(53.1,+PSGORD,0),"^",4) S PSIVFLG=$S(PSIVFLG="F":1,PSIVFLG="I":1,1:0)
"RTN","PSJINVW",19,0)
 S NF=$S(PSGORD["P":1,PSGORD["N":1,1:0)
"RTN","PSJINVW",20,0)
 S (FL,Y)="",$P(FL,"-",71)="",F="^PS("_$S(NF:"53.1,",(PSGORD["V"):"55,"_PSGP_",""IV"",",1:"55,"_PSGP_",5,")_+PSGORD_","
"RTN","PSJINVW",21,0)
 S PNM=$G(PSGP(0)) S:PNM="" PNM=$P($G(^DPT(PSGP,0)),"^")
"RTN","PSJINVW",22,0)
 Q:($G(@(F_"0)"))="")
"RTN","PSJINVW",23,0)
 I $G(PSJINHIS) D PSJINHIS(1,.PSJCHTO) Q
"RTN","PSJINVW",24,0)
DONE ;
"RTN","PSJINVW",25,0)
 K AND,D,DRG1,DRG2,AT,DO,DRG,EB,F,FD,FL,HSM,INS,LID,MR,ND4,OD,PN,PR,PSGID,PSGOD,R,SCH,SCT,SI,SIG,SM,ST,STD,UD,X,XU,Y,DONE,NF, Q
"RTN","PSJINVW",26,0)
 Q
"RTN","PSJINVW",27,0)
 ;
"RTN","PSJINVW",28,0)
PSJINHIS(PSJINHIS,PSJCHTO) ;
"RTN","PSJINVW",29,0)
 I '$G(PSJHDRF) S PSJHDRF=1 N DASH S $P(DASH,"-",75)="-" D
"RTN","PSJINVW",30,0)
 .I $E(IOST)="C" D FULL^VALM1 W @IOF
"RTN","PSJINVW",31,0)
 .W !?25,"Instructions History",!,DASH S PN=$G(PN)+2
"RTN","PSJINVW",32,0)
 N AND,AND2,PX S PX=""
"RTN","PSJINVW",33,0)
 N INDENT1,INDENT2 S INDENT1=2,INDENT2=5
"RTN","PSJINVW",34,0)
 I '$G(PSJPRCOM) D GETPRCOM Q:($G(PX)["^")
"RTN","PSJINVW",35,0)
 D ENA Q:($G(PX)["^")
"RTN","PSJINVW",36,0)
 Q:$G(PSJCHTO)=2
"RTN","PSJINVW",37,0)
 I $G(PSGORD)["V"!$G(PSIVFLG) D PSGOPI Q
"RTN","PSJINVW",38,0)
 D PSGSI
"RTN","PSJINVW",39,0)
 Q
"RTN","PSJINVW",40,0)
 ;
"RTN","PSJINVW",41,0)
PSGSI ;
"RTN","PSJINVW",42,0)
 N SI,Q,QQ,QQQ S SI=$S(($G(PSGORD)["P"):$P($G(^PS(53.1,+PSGORD,6)),"^"),($G(PSGORD)["U"):$P($G(^PS(55,PSGP,5,+PSGORD,6)),"^"),1:"")
"RTN","PSJINVW",43,0)
 N SIL S SIL=$$GETSIOPI^PSJBCMA5(PSGP,PSGORD,1) I SIL!(SI]"") D
"RTN","PSJINVW",44,0)
 .Q:($G(PX)["^")
"RTN","PSJINVW",45,0)
 .I '$G(PSJCHTO) N PSJUDGL,PSJUDPH S PSJUDGL=$S($G(PSGORD)["P":"^PS(53.1,+PSGORD,",$G(PSGORD)["U":"^PS(55,PSGP,5,+PSGORD,",1:"") D
"RTN","PSJINVW",46,0)
 ..I '$G(AND) N AND S AND=$P(@(PSJUDGL_"0)"),"^",16) S PSJUDPH=@(PSJUDGL_"4)") S $P(AND,"^",2)=$S($P(PSJUDPH,"^",3):$P(PSJUDPH,"^",3),$P(PSJUDPH,"^",7):$P(PSJUDPH,"^",7),1:"")
"RTN","PSJINVW",47,0)
 ..D:$G(PN)>PSJFULL NPAGE W !!,"Date: ",$$ENDTC^PSGMI(+AND) S PN=$G(PN)+3 W ?28,"User: ",$$ENNPN^PSGMI($P(AND,"^",2)),!?INDENT1,"SPECIAL INSTRUCTIONS changed" D
"RTN","PSJINVW",48,0)
 ...W !?INDENT1,"From: ''",! S PSJCHTO=1 S PN=$G(PN)+2
"RTN","PSJINVW",49,0)
 .I SI]"",'SIL W !?INDENT1,"To:",!?INDENT2 S PSJCHTO=2,PN=$G(PN)+2 D  Q
"RTN","PSJINVW",50,0)
 ..S QQQ="" F Q=1:1:$L(SI," ") S QQ=$P(SI," ",Q) W:($L(QQQ_" "_QQ)>72) ! W QQ," " S:($L(QQQ_" "_QQ)>72) QQQ="" S QQQ=QQQ_" "_QQ
"RTN","PSJINVW",51,0)
 .I $G(PSJCHTO)=2,$D(TMPTO(DFN,1)) W !?INDENT1,"From: " S PSJCHTO=1,PN=$G(PN)+1 N TMPTOLN S TMPTOLN=0 F  S TMPTOLN=$O(TMPTO(DFN,TMPTOLN)) Q:'TMPTOLN!(PX["^")  W !?INDENT2,TMPTO(DFN,TMPTOLN) S PN=PN+1 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",52,0)
 .Q:'$G(PSJSYSP)  N LNTXT S LNTXT=0 F  S LNTXT=$O(^TMP("PSJBCMA5",$J,PSGP,PSGORD,LNTXT)) Q:'LNTXT  D
"RTN","PSJINVW",53,0)
 ..I LNTXT=1 W !?INDENT1,"To:" S PSJCHTO=2 S PN=$G(PN)+1
"RTN","PSJINVW",54,0)
 ..W !?INDENT2,$G(^TMP("PSJBCMA5",$J,PSGP,PSGORD,LNTXT)) S PN=$G(PN)+1 K:LNTXT=1 TMPTO S TMPTO(DFN,LNTXT)=^(LNTXT)
"RTN","PSJINVW",55,0)
 Q
"RTN","PSJINVW",56,0)
 ;
"RTN","PSJINVW",57,0)
PSGOPI ;
"RTN","PSJINVW",58,0)
 N DT,USR,TXTLN,POPIL,POPI S POPI=$S($G(PSGORD)["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,3)),"^"),$G(PSGORD)["P":$P($G(^PS(53.1,+PSGORD,9)),"^",2),1:"")
"RTN","PSJINVW",59,0)
 S POPIL=$$GETSIOPI^PSJBCMA5(PSGP,PSGORD,1) I POPIL!(POPI]"") D
"RTN","PSJINVW",60,0)
 .Q:($G(PX)["^")
"RTN","PSJINVW",61,0)
 .I '$G(PSJCHTO) S $P(AND,"^")=$S(PSGORD["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,2,1)),"^"),PSGORD["P":$P($G(^PS(53.1,+PSGORD,0)),"^",16),1:"") D
"RTN","PSJINVW",62,0)
 ..S $P(AND,"^",2)=$S(PSGORD["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,4)),"^",4),PSGORD["P":$P($G(^PS(53.1,+PSGORD,4)),"^",7),1:"")
"RTN","PSJINVW",63,0)
 ..D:($G(PN)>PSJFULL) NPAGE W !!,"Date: ",$$ENDTC^PSGMI(+AND) S PN=$G(PN)+2 W ?28,"User: ",$$ENNPN^PSGMI($P(AND,"^",2)),!,"OTHER PRINT INFO changed" D
"RTN","PSJINVW",64,0)
 ...W !?INDENT1,"From: ",!?INDENT2,"""""",! S PSJCHTO=1 S PN=$G(PN)+4
"RTN","PSJINVW",65,0)
 .I $G(PSJCHTO)=2,$D(TMPTO(DFN,1)) W !?INDENT1,"From: " S PSJCHTO=1,PN=$G(PN)+1 N TMPTOLN S TMPTOLN=0 F  S TMPTOLN=$O(TMPTO(DFN,TMPTOLN)) Q:'TMPTOLN!(PX["^")  W !?INDENT2,TMPTO(DFN,TMPTOLN) S PN=PN+1 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",66,0)
 .S TXTLN=0 F  S TXTLN=$O(^TMP("PSJBCMA5",$J,PSGP,PSGORD,TXTLN)) Q:'TXTLN!($G(PX)["^")  D
"RTN","PSJINVW",67,0)
 ..I (TXTLN=1) W !?INDENT1,"To:" S PN=$G(PN)+1
"RTN","PSJINVW",68,0)
 ..W !?INDENT2,^TMP("PSJBCMA5",$J,PSGP,PSGORD,TXTLN) S PN=$G(PN)+1,PSJCHTO=2 K:TXTLN=1 TMPTO S TMPTO(DFN,TXTLN)=^(TXTLN) D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",69,0)
 Q
"RTN","PSJINVW",70,0)
ENA ;
"RTN","PSJINVW",71,0)
 I PSGORD["U" F Q=0:0 S Q=$O(^PS(55,PSGP,5,+PSGORD,9,Q)) Q:'Q!(PX["^")  I $D(^(Q,0)) S AND=^(0) D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D AL1
"RTN","PSJINVW",72,0)
 I PSGORD["P" F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,"A",Q)) Q:'Q!(PX["^")  I $D(^(Q,0)) S AND=^(0) D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D AL1
"RTN","PSJINVW",73,0)
 I PSGORD["V" S Q=0 F  S Q=$O(^PS(55,PSGP,"IV",+PSGORD,"A",Q)) Q:'Q!(PX["^")  D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  S AND2=$G(^(Q,1,1,0)) I ($G(AND2)["OTHER PRINT INFO") D
"RTN","PSJINVW",74,0)
 .S AND=$G(^PS(55,PSGP,"IV",+PSGORD,"A",Q,0)) D:($G(PN)>PSJFULL) NPAGE D AL1
"RTN","PSJINVW",75,0)
 I ($G(PX)["^") S DONE=1
"RTN","PSJINVW",76,0)
 Q
"RTN","PSJINVW",77,0)
AL1 ; Activity Logs
"RTN","PSJINVW",78,0)
 S UD=$P(AND,"^",3)
"RTN","PSJINVW",79,0)
 I AND["SPECIAL INSTRUCTIONS" D  Q
"RTN","PSJINVW",80,0)
 .I ($G(PSGORD)["U") D
"RTN","PSJINVW",81,0)
 ..N Q2 S Q2=0 F  S Q2=$O(^PS(55,DFN,5,+PSGORD,9,Q,Q2)) Q:'Q2!(PX["^")  N Q3 S Q3=0 F  S Q3=$O(^PS(55,DFN,5,+PSGORD,9,Q,Q2,Q3)) Q:'Q3!(PX["^")  D
"RTN","PSJINVW",82,0)
 ...I ($G(PSJCHTO)<2),(Q3=1),(Q2=1) D
"RTN","PSJINVW",83,0)
 ....I '$G(PSJCHTO) D:($G(PN)>PSJFULL) NPAGE Q:($G(PX)["^")  D DATUSR(+AND,$P(AND,"^",2),"SPECIAL INSTRUCTIONS changed")
"RTN","PSJINVW",84,0)
 ....W !?INDENT1,"To:" S PN=$G(PN)+1 N TMPQ3 S TMPQ3=0 F  S TMPQ3=$O(^PS(55,DFN,5,+PSGORD,9,Q,Q2,TMPQ3)) Q:'TMPQ3!(PX["^")  W !?INDENT2,^PS(55,DFN,5,+PSGORD,9,Q,Q2,TMPQ3,0) S PN=$G(PN)+1 S PSJCHTO=2 K:TMPQ3=1 TMPTO S TMPTO(DFN,TMPQ3)=^(0)
"RTN","PSJINVW",85,0)
 ...Q:PX["^"  D:($G(PN)>PSJFULL) NPAGE Q:PX["^"
"RTN","PSJINVW",86,0)
 ...I (Q3=1),(Q2=1) D:($G(PN)>PSJFULL) NPAGE Q:($G(PX)["^")  D DATUSR(+AND,$P(AND,"^",2),"SPECIAL INSTRUCTIONS changed")
"RTN","PSJINVW",87,0)
 ...Q:($G(PX)["^")  I (Q3=1) W !?INDENT1,$S(PSJCHTO=2:"From: ",PSJCHTO=1:"To:",1:"") S PSJCHTO=$S(PSJCHTO=2:1,1:2) S PN=$G(PN)+1 D:($G(PN)>PSJFULL)
"RTN","PSJINVW",88,0)
 ...W !?INDENT2,^PS(55,DFN,5,+PSGORD,9,Q,Q2,Q3,0) S PN=$G(PN)+1 K:Q3=1 TMPTO S:PSJCHTO=2 TMPTO(DFN,Q3)=^(0)
"RTN","PSJINVW",89,0)
 .I ($G(PSGORD)["P") D
"RTN","PSJINVW",90,0)
 ..I '$O(^PS(53.1,+PSGORD,"A",Q,0)) D
"RTN","PSJINVW",91,0)
 ...D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D DATUSR(+AND,$P(AND,"^",2),"SPECIAL INSTRUCTIONS changed")
"RTN","PSJINVW",92,0)
 ...N FROM S FROM=$P(AND,"^",5) W !?INDENT1,"From: " S PN=$G(PN)+1 S PSJCHTO=1 D
"RTN","PSJINVW",93,0)
 ....I FROM]"" W !?INDENT2,FROM S PN=$G(PN)+1 Q
"RTN","PSJINVW",94,0)
 ....I $D(TMPTO(DFN,1)) N TMPTOLN S TMPTOLN=0 F  S TMPTOLN=$O(TMPTO(DFN,TMPTOLN)) Q:'TMPTOLN!(PX["^")  W !?INDENT2,TMPTO(DFN,TMPTOLN) S PN=PN+1 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",95,0)
 ..N QB S QB=0 F  S QB=$O(^PS(53.1,+PSGORD,"A",Q,QB)) Q:'QB!(PX["^")  N Q2 S Q2=0 F  S Q2=$O(^PS(53.1,+PSGORD,"A",Q,QB,Q2)) Q:'Q2!(PX["^")  D
"RTN","PSJINVW",96,0)
 ...I ($G(PSJCHTO)<2),(Q2=1),(QB=1) W !?INDENT1,"To:" S PN=$G(PN)+1,PSJCHTO=2 D
"RTN","PSJINVW",97,0)
 ....N TMPQ2 S TMPQ2=0 F  S TMPQ2=$O(^PS(53.1,+PSGORD,"A",Q,QB,TMPQ2)) Q:'TMPQ2!(PX["^")  W !?INDENT2,^PS(53.1,+PSGORD,"A",Q,QB,TMPQ2,0) S PN=$G(PN)+1 K:TMPQ2=1 TMPTO S TMPTO(DFN,TMPQ2)=^(0)
"RTN","PSJINVW",98,0)
 ...Q:PX["^"
"RTN","PSJINVW",99,0)
 ...I (Q2=1),(QB=1) D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D DATUSR(+AND,$P(AND,"^",2),"SPECIAL INSTRUCTIONS changed")
"RTN","PSJINVW",100,0)
 ...I (Q2=1) W !?INDENT1,$S(PSJCHTO=2:"From: ",PSJCHTO=2:"To:",1:"") S PSJCHTO=$S(PSJCHTO=2:1,1:2) S PN=$G(PN)+1
"RTN","PSJINVW",101,0)
 ...Q:PX["^"  W !?INDENT2,^PS(53.1,+PSGORD,"A",Q,QB,Q2,0) S PN=$G(PN)+1 D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  K:Q2=1 TMPTO S:PSJCHTO=2 TMPTO(DFN,Q2)=^(0)
"RTN","PSJINVW",102,0)
 I $G(AND2)["OTHER PRINT INFO"!($G(AND)["OTHER PRINT INFO") S PSJIVFLG=1 D
"RTN","PSJINVW",103,0)
 .I ($G(PSGORD)["V") N Q2 F Q2=2,3 Q:(PX["^")  N Q3 S Q3=0 F  S Q3=$O(^PS(55,DFN,"IV",+PSGORD,"A",Q,Q2,Q3)) Q:'Q3!(PX["^")  D
"RTN","PSJINVW",104,0)
 ..I ($G(PSJCHTO)=1),Q2=2,Q3=1 D
"RTN","PSJINVW",105,0)
 ...N TMPQ3 S TMPQ3=0 F  S TMPQ3=$O(^PS(55,DFN,"IV",+PSGORD,"A",Q,Q2,TMPQ3)) Q:'TMPQ3!(PX["^")  D
"RTN","PSJINVW",106,0)
 ....D:($G(PN)>PSJFULL) NPAGE W:TMPQ3=1 !?INDENT1,"To: " W !?INDENT2,^PS(55,DFN,"IV",+PSGORD,"A",Q,Q2,TMPQ3,0) K:TMPQ3=1 TMPTO S TMPTO(DFN,TMPQ3)=^(0)
"RTN","PSJINVW",107,0)
 ....S PN=PN+2,PSJCHTO=2 D:($G(PN)>PSJFULL) NPAGE Q:PX["^"
"RTN","PSJINVW",108,0)
 ..Q:PX["^"
"RTN","PSJINVW",109,0)
 ..I Q3=1,($G(PSJCHTO)'=1) D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D  Q:($G(PX)["^")
"RTN","PSJINVW",110,0)
 ...D DATUSR($P(AND,"^",5),$P(AND,"^",3),"OTHER PRINT INFO changed")
"RTN","PSJINVW",111,0)
 ...;W !!,"Date: ",$$ENDTC^PSGMI($P(AND,"^",5)) W ?28,"User: ",$$ENNPN^PSGMI($P(AND,"^",3)),!,"OTHER PRINT INFO changed" S PN=$G(PN)+3
"RTN","PSJINVW",112,0)
 ..I Q3=1,Q2=3,'$G(PSJCHTO) W !?INDENT1,"From: """"" S PSJCHTO=1,PN=$G(PN)+1
"RTN","PSJINVW",113,0)
 ..I Q3=1,Q2=3,PSJCHTO=2,$D(TMPTO(DFN,1)) W !?INDENT1,"From: " S PSJCHTO=1,PN=$G(PN)+1 N TMPTOLN S TMPTOLN=0 F  S TMPTOLN=$O(TMPTO(DFN,TMPTOLN)) Q:'TMPTOLN!(PX["^")  W !?INDENT2,TMPTO(DFN,TMPTOLN) S PN=PN+1 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",114,0)
 ..Q:(PX["^")  I Q3=1 W !?INDENT1,$S(PSJCHTO'=1:"From: ",PSJCHTO=1:"To: ",1:"") S PSJCHTO=$S(PSJCHTO=1:2,1:1) S PN=PN+1 Q:PX["^"
"RTN","PSJINVW",115,0)
 ..Q:PX["^"  W !?INDENT2,^PS(55,DFN,"IV",+PSGORD,"A",Q,Q2,Q3,0) K:Q3=1 TMPTO S:PSJCHTO=2 TMPTO(DFN,Q3)=^(0) S PN=PN+1 D:($G(PN)>PSJFULL) NPAGE Q:PX["^"
"RTN","PSJINVW",116,0)
 .I $G(PN)>PSJFULL D NPAGE Q:(PX["^")
"RTN","PSJINVW",117,0)
 .I ($G(PSGORD)["P") D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D
"RTN","PSJINVW",118,0)
 ..I ($G(PSJCHTO)'=1) W !,"Date: ",$$ENDTC^PSGMI(+AND) W ?28,"User: ",$$ENNPN^PSGMI($P(AND,"^",2)),!,"OTHER PRINT INFO changed" S PN=$G(PN)+2
"RTN","PSJINVW",119,0)
 ..I '$G(PSJCHTO) N FROM S FROM=$P(AND,"^",5),FROM=$S(FROM]"":FROM,1:"""""") W !?INDENT1,"From: ",!?INDENT2,FROM  S PSJCHTO=1,PN=$G(PN)+1
"RTN","PSJINVW",120,0)
 ..N QB S QB=0 F  S QB=$O(^PS(53.1,+PSGORD,"A",Q,QB)) Q:'QB!($G(PX)["^")  N Q2 S Q2=0 F  S Q2=$O(^PS(53.1,+PSGORD,"A",Q,QB,Q2)) Q:'Q2!($G(PX)["^")  D
"RTN","PSJINVW",121,0)
 ...I ($G(PSJCHTO)<2),(Q2=1),(QB=1) D:($G(PN)>PSJFULL) NPAGE W !?INDENT1,"To: " S PN=$G(PN)+2,PSJCHTO=2 D  W !
"RTN","PSJINVW",122,0)
 ....N TMPQ2 S TMPQ2=0 F  S TMPQ2=$O(^PS(53.1,+PSGORD,"A",Q,QB,TMPQ2)) Q:'TMPQ2!(PX["^")  W !?INDENT2,^PS(53.1,+PSGORD,"A",Q,QB,TMPQ2,0) S PN=$G(PN)+1 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",123,0)
 ...I (Q2=1),(QB=1) D DATUSR($P(AND,"^",5),$P(AND,"^",3),"OTHER PRINT INFO changed") ; W !,"Date: ",$$ENDTC^PSGMI(+AND) W:$S(UD'?4N:1,1:$E(UD,1,2)'=10) ?28,"User: ",$$ENNPN^PSGMI($P(AND,"^",2)),!,"OTHER PRINT INFO changed" S PN=$G(PN)+2
"RTN","PSJINVW",124,0)
 ...I (Q2=1) D:($G(PN)>PSJFULL) NPAGE W !?INDENT1,$S(QB=1:"From: ",QB=2:"To: ",1:"") S PSJCHTO=$S(QB=2:2,1:1) S PN=$G(PN)+1
"RTN","PSJINVW",125,0)
 ...Q:($G(PX)["^")  W !?INDENT2,^PS(53.1,+PSGORD,"A",Q,QB,Q2,0) S PN=$G(PN)+1 D:($G(PN)>PSJFULL) NPAGE Q:PX["^"
"RTN","PSJINVW",126,0)
 ..I ($G(PN)>PSJFULL) D NPAGE
"RTN","PSJINVW",127,0)
 Q
"RTN","PSJINVW",128,0)
 ;
"RTN","PSJINVW",129,0)
GETPRCOM ; Get provider comments
"RTN","PSJINVW",130,0)
 N PROVLN
"RTN","PSJINVW",131,0)
 I $G(PSGORD)["V" S PROVLN=0 F  S PROVLN=$O(^PS(55,DFN,"IV",+PSGORD,5,PROVLN)) Q:'PROVLN!($G(PX)["^")  D
"RTN","PSJINVW",132,0)
 .I (PROVLN=1) S DT=$P($G(^PS(55,DFN,"IV",+PSGORD,2)),"^"),USR=$P($G(^PS(55,DFN,"IV",+PSGORD,0)),"^",6) D DATUSR(DT,USR,"PROVIDER COMMENTS:") S PSJPRCOM=1
"RTN","PSJINVW",133,0)
 .W !?INDENT2,^PS(55,DFN,"IV",+PSGORD,5,PROVLN,0) S PN=$G(PN)+1 I ($G(PN)>PSJFULL) D NPAGE
"RTN","PSJINVW",134,0)
 I $G(PSGORD)["U" S PROVLN=0 F  S PROVLN=$O(^PS(55,DFN,5,+PSGORD,12,PROVLN)) Q:'PROVLN!($G(PX)["^")  D
"RTN","PSJINVW",135,0)
 .I (PROVLN=1) S DT=$P($G(^PS(55,DFN,5,+PSGORD,0)),"^",16),USR=$P($G(^PS(55,DFN,5,+PSGORD,0)),"^",2) D DATUSR(DT,USR,"PROVIDER COMMENTS:") S PSJPRCOM=1
"RTN","PSJINVW",136,0)
 .W !?INDENT2,^PS(55,DFN,5,+PSGORD,12,PROVLN,0) S PN=$G(PN)+1 I ($G(PN)>PSJFULL) D NPAGE
"RTN","PSJINVW",137,0)
 I $G(PSGORD)["P" S PROVLN=0 F  S PROVLN=$O(^PS(53.1,+PSGORD,12,PROVLN)) Q:'PROVLN!($G(PX)["^")  D
"RTN","PSJINVW",138,0)
 .I (PROVLN=1) S DT=$P($G(^PS(53.1,+PSGORD,0)),"^",16),USR=$P($G(^PS(53.1,+PSGORD,0)),"^",2) D DATUSR(DT,USR,"PROVIDER COMMENTS:") S PSJPRCOM=1
"RTN","PSJINVW",139,0)
 .W !?INDENT2,^PS(53.1,+PSGORD,12,PROVLN,0) S PN=$G(PN)+1 I ($G(PN)>PSJFULL) D NPAGE
"RTN","PSJINVW",140,0)
 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",141,0)
 Q
"RTN","PSJINVW",142,0)
NPAGE ; Pause
"RTN","PSJINVW",143,0)
 Q:$G(PSJPTR)
"RTN","PSJINVW",144,0)
 I PN<PSJFULL F PN=PN:1:PSJFULL-1 W !
"RTN","PSJINVW",145,0)
 I $E(IOST)="C" R !!,"Enter '^' to stop, or press RETURN to continue.",PX:DTIME D
"RTN","PSJINVW",146,0)
 .I $G(PX)["^" S DONE=1
"RTN","PSJINVW",147,0)
 .D FULL^VALM1 W @IOF
"RTN","PSJINVW",148,0)
 W !?25,"Instructions History" S PN=1
"RTN","PSJINVW",149,0)
 N DASH S $P(DASH,"-",75)="-" W !,DASH S PN=$G(PN)+1
"RTN","PSJINVW",150,0)
 Q
"RTN","PSJINVW",151,0)
 ;
"RTN","PSJINVW",152,0)
DATUSR(DT,USR,TXT) ;
"RTN","PSJINVW",153,0)
 I $G(PN)>(PSJFULL-5) D NPAGE Q:(PX["^")
"RTN","PSJINVW",154,0)
 N DAT,USER
"RTN","PSJINVW",155,0)
 S DAT=$$ENDTC^PSSGMI(DT),USER=$$ENNPN^PSGMI(USR)
"RTN","PSJINVW",156,0)
 W !!,"Date: ",DAT,?28,"User: ",USER,!,TXT S PN=$G(PN)+3
"RTN","PSJINVW",157,0)
 Q
"RTN","PSJLIORD")
0^78^B9927943^B9649309
"RTN","PSJLIORD",1,0)
PSJLIORD ;BIR/MV-INPATIENT ORDER ENTRY FOR IV ;10 Mar 98 / 4:19 PM
"RTN","PSJLIORD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**1,16,29,58,85,110,149,267**;16 DEC 97;Build 158
"RTN","PSJLIORD",3,0)
 ;
"RTN","PSJLIORD",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLIORD",5,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSJLIORD",6,0)
 ; Reference to AND^ORX8 is supported by DBIA #3632.
"RTN","PSJLIORD",7,0)
 ;
"RTN","PSJLIORD",8,0)
EN(DFN,PSJORD) ; Display order with numbers.
"RTN","PSJLIORD",9,0)
 ;N ON,ON55,P,PSIVAC,PSGEBN,PSGLI,PSJSTAR
"RTN","PSJLIORD",10,0)
 N ON55,P,PSIVAC,PSGEBN,PSGLI,PSJSTAR K ^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSJLIORD",11,0)
 D UDVARS
"RTN","PSJLIORD",12,0)
 S (PSGEBN,PSGLI)=""
"RTN","PSJLIORD",13,0)
 ;* S PSIVAC="C" S (P("PON"),ON,ON55)=+PSJORD_"V"
"RTN","PSJLIORD",14,0)
 S PSIVAC="E" S (P("PON"),ON,ON55)=+PSJORD_"V"
"RTN","PSJLIORD",15,0)
 S PSIVUP=+$$GTPCI^PSIVUTL D GT55^PSIVORFB
"RTN","PSJLIORD",16,0)
 D:'$D(P("OT")) GTOT^PSIVUTL(P(4))
"RTN","PSJLIORD",17,0)
 NEW PSJL
"RTN","PSJLIORD",18,0)
 N PSIVNUM S PSIVNUM=1
"RTN","PSJLIORD",19,0)
 ;;I $E(P("OT"))'="F" S PSJSTAR="(1)^(4)^(5)^(6)^(7)^(9)^(10)"
"RTN","PSJLIORD",20,0)
 I $E(P("OT"))="I" S PSJSTAR="(1)^(4)^(5)^(6)^(7)^(9)^(10)"
"RTN","PSJLIORD",21,0)
 E  S PSJSTAR="(1)^(2)^(3)^(4)^(5)^(6)^(7)^(9)" D GTDATA^PSJLIFN
"RTN","PSJLIORD",22,0)
 NEW PSGACT D PSGACT
"RTN","PSJLIORD",23,0)
 ;* Only allow activity logs for non pharmacist/RN personel if coming
"RTN","PSJLIORD",24,0)
 ;* from the Non-verify/pending option.
"RTN","PSJLIORD",25,0)
 I '+$P(PSJSYSU,";"),$G(PSJPNV) S PSGACT="L"
"RTN","PSJLIORD",26,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE") ; Call to EN^PSJLIVMD
"RTN","PSJLIORD",27,0)
 S VALMBCK="Q"
"RTN","PSJLIORD",28,0)
 K ^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSJLIORD",29,0)
 Q
"RTN","PSJLIORD",30,0)
 ;
"RTN","PSJLIORD",31,0)
PSGACT ;Setup selectable actions based on order's status
"RTN","PSJLIORD",32,0)
 S (X,XKEYS)=$$CHKKEYS()
"RTN","PSJLIORD",33,0)
 N PSGR S PSGACT=""
"RTN","PSJLIORD",34,0)
 S PSJCOM=$P($G(^PS(55,DFN,"IV",+ON55,.2)),U,8)
"RTN","PSJLIORD",35,0)
 I PSJCOM S PSGR=0
"RTN","PSJLIORD",36,0)
 I PSJCOM S PSGR=$$AND^ORX8(PSJCOM) S:PSGR=1 PSGR=$$RNEWOK^PSJUTL2(PSJCOM,DFN)
"RTN","PSJLIORD",37,0)
 I 'PSJCOM S PSGR='$$EXPIRED^PSGOER(DFN,ON55)
"RTN","PSJLIORD",38,0)
 S X=XKEYS
"RTN","PSJLIORD",39,0)
 ;I P(17)="A" S PSGACT=$S(PSJCOM:"L",1:"EL") S:+X PSGACT=PSGACT_"DO"_$S(P(10):"",1:"H")_$S(PSGR:"R",1:"")
"RTN","PSJLIORD",40,0)
 ;I P(17)="A" S PSGACT="L" S:+X PSGACT=$S(P(10):"DROL",1:"DHROL")
"RTN","PSJLIORD",41,0)
 I P(17)="A" S PSGACT="EL" S:+X PSGACT=PSGACT_"DO"_$S(P(10):"",1:"H")_$S(PSGR:"R",1:"")
"RTN","PSJLIORD",42,0)
 I P(17)="H" S PSGACT="L" S:+X PSGACT=$S(P(10):"DL",1:"DHL")
"RTN","PSJLIORD",43,0)
 I P(17)="R" S PSGACT="L" ;S:+X PSGACT="DL"  PSJ*5*149
"RTN","PSJLIORD",44,0)
 I P(17)="D" S PSGACT="L"
"RTN","PSJLIORD",45,0)
 I P(17)="D"&P(12) S PSGACT="L" S:+X PSGACT="L"_$S(PSGR:"R",1:"")
"RTN","PSJLIORD",46,0)
 I P(17)="E" S PSGACT="L" D:+X
"RTN","PSJLIORD",47,0)
 . I $P($G(^PS(55,DFN,"IV",+ON55,.2)),U,4)="D" Q
"RTN","PSJLIORD",48,0)
 . S PSGACT="L"_$S($P($G(^PS(55,DFN,"IV",+ON55,2)),U,6):"",PSGR:"R",1:"")
"RTN","PSJLIORD",49,0)
 I P(17)="O" S PSGACT="L" S:+X PSGACT="DOL"
"RTN","PSJLIORD",50,0)
 I P(17)="N" S PSGACT="EL" S:+X PSGACT="DELV"
"RTN","PSJLIORD",51,0)
 S PSGACT=PSGACT_$P(X,U,2)
"RTN","PSJLIORD",52,0)
 Q
"RTN","PSJLIORD",53,0)
UDVARS ;* Remove un-use variables.
"RTN","PSJLIORD",54,0)
 K PSGCANFL,PSGDI,PSGDO,PSGEB,PSGEBN,PSGFD,PSGFDN,PSHSM,PSGLI
"RTN","PSJLIORD",55,0)
 K PSGLIN,PSGLMT,PSGMR,PSGMRN,PSGNEF,PSGOAT
"RTN","PSJLIORD",56,0)
 K PSGODO,PSGODT,PSGOEA,PSGOEAV,PSGOEEWF,PSGOENG,PSGOFD,PSGOFDN
"RTN","PSJLIORD",57,0)
 K PSGOHSM,PSGOINST,PSGOMR,PSGOMRN,PSGONC,PSGOPD,PSGOPDN,PSGOPR
"RTN","PSJLIORD",58,0)
 K PSGOPRN,PSGOSCH,PSGOSD,PSGOSDN,PSGOSI,PSGOSM,PSGOST,PSGOSTN
"RTN","PSJLIORD",59,0)
 K PSGPD,PSGPDN,PSGPI,PSGPR,PSGPRIO,PSGPRN,PSGPTMP,PSGRRF,PSGS0XT
"RTN","PSJLIORD",60,0)
 K PSGS0Y,PSGSCH,PSGSD,PSGSDN,PSGSI,PSGSM,PSGST,PSGSTAT,PSGSTN
"RTN","PSJLIORD",61,0)
 K PSGEFN,PSGOEFN,PSGOEEF,PSGOEEG,PSGOEEND,PSGPDRG,PSGPDRGN
"RTN","PSJLIORD",62,0)
 K PSGNESDO,PSGNODE,PSGOEDMR,PSGOEPR,PSGPEN,PSGPENWS
"RTN","PSJLIORD",63,0)
 Q
"RTN","PSJLIORD",64,0)
CHKKEYS()  ;* Check for users' key to set up appropriate actions
"RTN","PSJLIORD",65,0)
 ;Output:
"RTN","PSJLIORD",66,0)
 ;  X=a^b
"RTN","PSJLIORD",67,0)
 ;  a=1 for either RN or Pharmacist; 0 for other
"RTN","PSJLIORD",68,0)
 ;  b="V" if not verified by key owner
"RTN","PSJLIORD",69,0)
 S XX=$G(^PS(55,DFN,"IV",+ON,4)),X=0
"RTN","PSJLIORD",70,0)
 I +PSJSYSU=3 S X=1 D
"RTN","PSJLIORD",71,0)
 . I '+$P(XX,U,4) S $P(X,U,2)="V"
"RTN","PSJLIORD",72,0)
 . I $L($T(EN1^ORCFLAG)) S $P(X,U,2)=$P(X,U,2)_"G"
"RTN","PSJLIORD",73,0)
 I +PSJSYSU=1 S X=1 D
"RTN","PSJLIORD",74,0)
 . I '+XX S $P(X,U,2)="V"
"RTN","PSJLIORD",75,0)
 Q X
"RTN","PSJLIUTL")
0^73^B52930175^B53236065
"RTN","PSJLIUTL",1,0)
PSJLIUTL ;BIR/MV-IV LM utilities modules ;25 APR 00 / 4:28 PM
"RTN","PSJLIUTL",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**39,50,58,81,85,110,180,263,267**;16 DEC 97;Build 158
"RTN","PSJLIUTL",3,0)
 ;
"RTN","PSJLIUTL",4,0)
 ; Reference to ^ORD(101 is supported by DBIA #872.
"RTN","PSJLIUTL",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLIUTL",6,0)
 ; Reference to ES^ORX8 is supported by DBIA #3632.
"RTN","PSJLIUTL",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJLIUTL",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJLIUTL",9,0)
 ;
"RTN","PSJLIUTL",10,0)
 ; NFI changes for FR#2@wrtdrg(drgt)
"RTN","PSJLIUTL",11,0)
FLDNO(X,COL)    ; Display the number next to the field name.
"RTN","PSJLIUTL",12,0)
 ;
"RTN","PSJLIUTL",13,0)
 ; X=Text; COL=Column to start from
"RTN","PSJLIUTL",14,0)
 ;
"RTN","PSJLIUTL",15,0)
 S:'$D(PSJSTAR) PSJSTAR=""
"RTN","PSJLIUTL",16,0)
 NEW PSJOLDOT S PSJOLDOT=P("OT") D GTOT^PSIVUTL(P(4))
"RTN","PSJLIUTL",17,0)
 S X=$S((X="(3)"&(P("OT")="I")):" ",PSJSTAR[X:"*",1:" ")_X
"RTN","PSJLIUTL",18,0)
 S PSJL=$$SETSTR^VALM1($S(($G(PSJHIS)&(ON'=PSJORD)):"",1:X),PSJL,COL,5)
"RTN","PSJLIUTL",19,0)
 Q
"RTN","PSJLIUTL",20,0)
 ;
"RTN","PSJLIUTL",21,0)
LONG(Y,COL,LEN) ; Display long fields.
"RTN","PSJLIUTL",22,0)
 ;
"RTN","PSJLIUTL",23,0)
 ; Y=Text string; COL=Start prt at this col; LEN=Total lenght per line.
"RTN","PSJLIUTL",24,0)
 ;
"RTN","PSJLIUTL",25,0)
 N STRLEN,STR S STR="",STRLEN=1
"RTN","PSJLIUTL",26,0)
 ; If string has no blank space.
"RTN","PSJLIUTL",27,0)
 I $L(Y," ")=1,$L(Y)>LEN D  Q
"RTN","PSJLIUTL",28,0)
 . S LINE=$L(Y)\LEN+$S($L(Y)#LEN:1,1:0)
"RTN","PSJLIUTL",29,0)
 . F X=1:1:LINE-1 D
"RTN","PSJLIUTL",30,0)
 . . S PSJL=$$SETSTR^VALM1($E(Y,STRLEN,LEN*X),PSJL,COL,LEN)
"RTN","PSJLIUTL",31,0)
 . . D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL="",STRLEN=LEN*X+1
"RTN","PSJLIUTL",32,0)
 . S PSJL=$$SETSTR^VALM1($E(Y,STRLEN,LEN*LINE),PSJL,COL,LEN)
"RTN","PSJLIUTL",33,0)
 ;
"RTN","PSJLIUTL",34,0)
 F X=1:1:$L(Y," ") D
"RTN","PSJLIUTL",35,0)
 . I $L(STR)+$L($P(Y," ",X))>LEN D
"RTN","PSJLIUTL",36,0)
 . . S PSJL=$$SETSTR^VALM1(STR,PSJL,COL,LEN)
"RTN","PSJLIUTL",37,0)
 . . D SETTMP^PSJLMPRU("PSJI",PSJL) S (STR,PSJL)=""
"RTN","PSJLIUTL",38,0)
 . S STR=STR_$P(Y," ",X)_" "
"RTN","PSJLIUTL",39,0)
 S PSJL=$$SETSTR^VALM1(STR,PSJL,COL,LEN)
"RTN","PSJLIUTL",40,0)
 Q
"RTN","PSJLIUTL",41,0)
 ;
"RTN","PSJLIUTL",42,0)
WRTDRG(DRGT) ; Print AD/SOL drugs for "backdoor" view.
"RTN","PSJLIUTL",43,0)
 NEW DRGX,PSJIVIEN,PSJX,PSJX1
"RTN","PSJLIUTL",44,0)
 F DRGX=0:0 S DRGX=$O(DRG(DRGT,DRGX)) Q:'DRGX  D
"RTN","PSJLIUTL",45,0)
 . S (PSJIVIEN,X)=$G(DRG(DRGT,DRGX)) I DRGT="SOL",$P($G(^PS(52.7,+X,0)),U,4)]"" S $P(X,U,2)=$P(X,U,2)_" "_$P(^(0),U,4)
"RTN","PSJLIUTL",46,0)
 . S PSJX1=$S($P(X,U,4)]"":"("_$P(X,U,4)_")",1:$P(X,U,4))
"RTN","PSJLIUTL",47,0)
 . S PSJL="",PSJX=$S($P(X,U,2)]"":$P(X,U,2)_" "_$P(X,U,3)_" "_PSJX1,1:"*** Undefined ***")
"RTN","PSJLIUTL",48,0)
 . ;S PSJL="",PSJX=$S($P(X,U,2)]"":$P(X,U,2)_" "_$P(X,U,3)_" "_$P(X,U,4),1:"*** Undefined ***")
"RTN","PSJLIUTL",49,0)
 . NEW PSJNF D NFIV^PSJDIN($S(DRGT="AD":52.6,1:52.7),+PSJIVIEN,.PSJNF)
"RTN","PSJLIUTL",50,0)
 . S PSJX=PSJX_PSJNF("NF")
"RTN","PSJLIUTL",51,0)
 . S PSJL=$$SETSTR^VALM1(PSJX,PSJL,8,72)
"RTN","PSJLIUTL",52,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIUTL",53,0)
 . ;PSJLMX is newed in AD^PSJLIVMD & AD^PSJLIVFD.  This var count # of ad/sol so we knows
"RTN","PSJLIUTL",54,0)
 . ;which line to blink the Requested start/stop dates.
"RTN","PSJLIUTL",55,0)
 . S PSJLMX=$G(PSJLMX)+1
"RTN","PSJLIUTL",56,0)
 Q
"RTN","PSJLIUTL",57,0)
 ;
"RTN","PSJLIUTL",58,0)
WTPC ; Write provider comments.
"RTN","PSJLIUTL",59,0)
 I $G(PSJORD),PSJORD["P" F PSIVX=0:0 S PSIVX=$O(^PS(53.1,+PSJORD,12,PSIVX)) Q:'PSIVX!$D(DUOUT)!$D(DTOUT)  S Y=$G(^PS(53.1,+PSJORD,12,PSIVX,0)) D LONG(Y,22,58) D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIUTL",60,0)
 Q:$G(PSIVCHG)=1
"RTN","PSJLIUTL",61,0)
 I $G(PSJORD),PSJORD'["P" F PSIVX=0:0 S PSIVX=$O(^PS(55,DFN,"IV",+PSJORD,5,PSIVX)) Q:'PSIVX!$D(DUOUT)!$D(DTOUT)  S Y=$G(^PS(55,DFN,"IV",+PSJORD,5,PSIVX,0)) D LONG(Y,22,58) D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIUTL",62,0)
 Q
"RTN","PSJLIUTL",63,0)
 ;
"RTN","PSJLIUTL",64,0)
TYPE() ; IV Type
"RTN","PSJLIUTL",65,0)
 S X=$$CODES^PSIVUTL(P(4),53.1,53) S X=$S($E(X)="C":"CHEMO",1:X)_$S(P(23)'="":" ("_P(23)_")",1:"")_$S(P(5)=1:" (I)",P(5)=0:"(C)",1:"")
"RTN","PSJLIUTL",66,0)
 Q X
"RTN","PSJLIUTL",67,0)
 ;
"RTN","PSJLIUTL",68,0)
STARTDT() ; Start Date
"RTN","PSJLIUTL",69,0)
 S X="" I $D(PSIVNUM) S:P("DTYP") X=$S(P(17)="P"!(PSIVAC="PN"):" ",1:"*")_$S(P("DTYP")=1:"(12)",$E(P("OT"))="I":"(10)",1:"(8)")
"RTN","PSJLIUTL",70,0)
 Q $$ENDTC^PSGMI(P(2))
"RTN","PSJLIUTL",71,0)
 ;
"RTN","PSJLIUTL",72,0)
STOPDT() ; Stop Date
"RTN","PSJLIUTL",73,0)
 S X="" I $D(PSIVNUM) S:P("DTYP") X=$S(P(17)="P"!(PSIVAC="PN"):" ",1:"*")_$S(P("DTYP")=1:"(13)",$E(P("OT"))="I":"(11)",1:"(9)")
"RTN","PSJLIUTL",74,0)
 Q $$ENDTC^PSGMI(P(3))
"RTN","PSJLIUTL",75,0)
 ;
"RTN","PSJLIUTL",76,0)
PROVIDER() ; Provider
"RTN","PSJLIUTL",77,0)
 S X="" I $D(PSIVNUM),P("DTYP") S X=$S(PSIVAC="PN":" ",1:"*")_$S(P("DTYP")=1:"(14)",$E(P("OT"))="I":"(12)",1:"(10)") ;I P(17)="P",(+P("CLRK")=+P(6)) S X=""
"RTN","PSJLIUTL",78,0)
 I $G(P(21))]"",$L($T(ES^ORX8)) N ESIG,ESIG1 S ESIG=P("NAT"),ESIG1=$$ES^ORX8(+P(21)_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSJLIUTL",79,0)
 S X=$S($P(P(6),U,2)]"":$E($P(P(6),U,2),1,23),1:"*** Undefined") S:$G(ESIG)]"" X=X_" ["_$$LOW^XLFSTR(ESIG)_"]"
"RTN","PSJLIUTL",80,0)
 Q X
"RTN","PSJLIUTL",81,0)
WDTE(Y) ; Format and print date.
"RTN","PSJLIUTL",82,0)
 I 'Y S Y=""
"RTN","PSJLIUTL",83,0)
 E  X ^DD("DD") S Y=$P(Y,"@")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSJLIUTL",84,0)
 Q Y
"RTN","PSJLIUTL",85,0)
 ;
"RTN","PSJLIUTL",86,0)
ACTIONS()          ;
"RTN","PSJLIUTL",87,0)
 N DIC,X,Y
"RTN","PSJLIUTL",88,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLIUTL",89,0)
 I Y="PSJI LM DISCONTINUE" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLIUTL",90,0)
 I Y="PSJI LM EDIT" Q $S(PSGACT["E":1,1:0)
"RTN","PSJLIUTL",91,0)
 I Y="PSJI PC RENEWAL" Q $S(PSGACT["R":1,1:0)
"RTN","PSJLIUTL",92,0)
 I Y="PSJI PC HOLD" Q $S(PSGACT["H":1,1:0)
"RTN","PSJLIUTL",93,0)
 I Y="PSJI PC ONCALL" Q $S(PSGACT["O":1,1:0)
"RTN","PSJLIUTL",94,0)
 I Y="PSJI LM VERIFY" Q $S(PSGACT["V":1,1:0)
"RTN","PSJLIUTL",95,0)
 I Y="PSJ LM FLAG" Q $S(PSGACT["G":1,1:0)
"RTN","PSJLIUTL",96,0)
 ;PSJ*5*180
"RTN","PSJLIUTL",97,0)
 I $G(PSJBADD)=1,PSGACT["F" S PSGACT=$TR(PSGACT,"F")
"RTN","PSJLIUTL",98,0)
 I Y="PSJI LM FINISH" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLIUTL",99,0)
 I Y="PSJ LM IV PENDING" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLIUTL",100,0)
 Q 1
"RTN","PSJLIUTL",101,0)
 ;
"RTN","PSJLIUTL",102,0)
ACT() ;
"RTN","PSJLIUTL",103,0)
 NEW Y
"RTN","PSJLIUTL",104,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLIUTL",105,0)
 I $G(PSJHIDFG),(Y="PSJ LM NEW ORDER") Q 0
"RTN","PSJLIUTL",106,0)
 I Y="PSJ LM NEW ORDER FROM PROFILE" Q $S($G(PSIVBR)="D ^PSIVOPT":1,1:0)
"RTN","PSJLIUTL",107,0)
 Q 1
"RTN","PSJLIUTL",108,0)
 ;
"RTN","PSJLIUTL",109,0)
REQDT(ORDER) ;
"RTN","PSJLIUTL",110,0)
 Q:$G(ORDER)'["P"  N ND0,PARENT I '$D(PSGRDTX(+ORDER)) K PSGRDTX
"RTN","PSJLIUTL",111,0)
 S PSGRDTX=$G(^PS(53.1,+ORDER,2.5)),ND0=$G(^PS(53.1,+ORDER,0)),PARENT=$P($G(^PS(53.1,+ORDER,.2)),"^",8),(PSGRSD,PSGRSDN,PSGRFD,PSGRFDN)=""
"RTN","PSJLIUTL",112,0)
 Q:'$G(PSGRDTX)  I '$P(PSGRDTX,"^",3)&'PARENT Q  ; Complex orders (duration OR parent) only?
"RTN","PSJLIUTL",113,0)
 I $P(ND0,U,9)'["P"!($P(ND0,U,24)="R") K PSGRDTX,PSGRFD,PSGRFDN Q
"RTN","PSJLIUTL",114,0)
 S $P(PSGRDTX,U,4)=ORDER
"RTN","PSJLIUTL",115,0)
 S PSGSD=$S($G(P(2)):P(2),1:$G(PSGSD)) I $L(PSGSD)>6 S PSGSD=$$DATE2^PSJUTL2(PSGSD)
"RTN","PSJLIUTL",116,0)
 S PSGFD=$S($G(P(3)):P(3),1:$G(PSGFD)) I $L(PSGFD)>6 S PSGFD=$$DATE2^PSJUTL2(PSGFD)
"RTN","PSJLIUTL",117,0)
 I $G(PSGSD),$G(PSGRDTX(+ORDER,"PSGSD")) I (","_PSGRDTX(+ORDER,"PSGSD")_","_PSGRDTX(+ORDER,"PSGRSD")_",")'[(","_PSGSD_",") D
"RTN","PSJLIUTL",118,0)
 . S PSGRDTX(+ORDER,"PSGSD")=PSGSD
"RTN","PSJLIUTL",119,0)
 I $G(PSGFD),$G(PSGRDTX(+ORDER,"PSGFD")) I (","_PSGRDTX(+ORDER,"PSGFD")_","_PSGRDTX(+ORDER,"PSGRFD")_",")'[(","_PSGFD_",") D
"RTN","PSJLIUTL",120,0)
 . S PSGRDTX(+ORDER,"PSGFD")=PSGFD
"RTN","PSJLIUTL",121,0)
 I $G(PSGSD),'$G(PSGRDTX(+ORDER,"PSGSD")) D
"RTN","PSJLIUTL",122,0)
 . S PSGRSD=$S($G(PSGRDTX(+ORDER,"PSGRSD")):PSGRDTX(+ORDER,"PSGRSD"),1:$P(PSGRDTX,U)) Q:'PSGRSD
"RTN","PSJLIUTL",123,0)
 . S A=PSGRSD,PSGRSD=PSGSD,PSGSD=A
"RTN","PSJLIUTL",124,0)
 . S PSGRDTX(+ORDER,"PSGRSD")=PSGRSD,PSGRDTX(+ORDER,"PSGSD")=PSGSD I $G(P(4))]"",PSGSD]"" S P(2)=PSGSD
"RTN","PSJLIUTL",125,0)
 . I PARENT,($P($G(PSGSRDTX),"^",3)="") S PSGNESD=PSGSD
"RTN","PSJLIUTL",126,0)
 I $G(PSGFD),'$G(PSGRDTX(+ORDER,"PSGFD")) D
"RTN","PSJLIUTL",127,0)
 . S PSGRFD=$S($D(PSGRDTX(+ORDER,"PSGRFD")):PSGRDTX(+ORDER,"PSGRFD"),1:$P(PSGRDTX,U,3)) Q:'PSGRFD
"RTN","PSJLIUTL",128,0)
 . S A=PSGRFD,PSGRFD=$S($G(PSGFD):PSGFD,1:$G(PSGNEFD)),PSGFD=A
"RTN","PSJLIUTL",129,0)
 . S PSGRDTX(+ORDER,"PSGRFD")=PSGRFD,(PSGNEFD,PSGRDTX(+ORDER,"PSGFD"))=PSGFD I $G(P(4))]"",PSGFD]"" S P(3)=PSGFD
"RTN","PSJLIUTL",130,0)
 S PSGSD=$S($G(PSGRDTX(+ORDER,"PSGSD")):PSGRDTX(+ORDER,"PSGSD"),1:$G(PSGSD)) I $G(P(4))]"",$L(PSGSD)>6 S P(2)=$$DATE2^PSJUTL2(PSGSD)
"RTN","PSJLIUTL",131,0)
 I $G(PSGSD) S PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD)
"RTN","PSJLIUTL",132,0)
 S PSGRSD=$S($G(PSGRDTX(+ORDER,"PSGRSD")):PSGRDTX(+ORDER,"PSGRSD"),1:$G(PSGRSD))
"RTN","PSJLIUTL",133,0)
 I $G(PSGRSD) S PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIUTL",134,0)
 I $G(PSGRDTX(+ORDER,"PSGFD")),$G(PSGSD) I PSGSD>PSGRDTX(+ORDER,"PSGFD") N DUR S DUR=$P($G(PSGRDTX),U,2) D
"RTN","PSJLIUTL",135,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) S (PSGFD,PSGRDTX(+ORDER,"PSGFD"))=$$FMADD^XLFDT(PSGSD,,,$S(DURMIN:DURMIN,1:1440))
"RTN","PSJLIUTL",136,0)
 S PSGFD=$S($G(PSGRDTX(+ORDER,"PSGFD")):PSGRDTX(+ORDER,"PSGFD"),1:$G(PSGFD)) D
"RTN","PSJLIUTL",137,0)
 . I PSGFD<PSGSD,$G(PSGFD),ORDER'["V" N PSGST I $G(DFN) S PSGST=$S(PSGORD["P":$P(^PS(53.1,+PSGORD,0),"^",7),1:$P(^PS(55,DFN,5,+PSGORD,0),"^",7)) D
"RTN","PSJLIUTL",138,0)
 .. D ENFD^PSGNE3(PSGSD) I PSGNEFD>PSGSD S PSGFD=PSGNEFD
"RTN","PSJLIUTL",139,0)
 . I PSGFD<PSGSD,$G(PSGFD),ORDER["V" D ENSTOP^PSIVCAL I P(3)>P(2) S PSGFD=P(3)
"RTN","PSJLIUTL",140,0)
 . I $G(P(4))]"",$L(PSGFD)>6 S P(3)=$$DATE2^PSJUTL2(PSGFD)
"RTN","PSJLIUTL",141,0)
 I $G(PSGFD) S PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)
"RTN","PSJLIUTL",142,0)
 S PSGRFD=$S($G(PSGRDTX(+ORDER,"PSGRFD")):PSGRDTX(+ORDER,"PSGRFD"),1:$G(PSGRFD))
"RTN","PSJLIUTL",143,0)
 I $G(PSGRFD) S PSGRFDN=$$ENDTC^PSGMI(PSGRFD)
"RTN","PSJLIUTL",144,0)
 Q
"RTN","PSJLIVFD")
0^50^B54237436^B40536268
"RTN","PSJLIVFD",1,0)
PSJLIVFD ;BIR/MV-SETUP LM TEMPLATE FOR IV FLUID ;4 Aug 00 / 2:37 PM
"RTN","PSJLIVFD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,50,63,64,58,81,91,80,116,110,111,180,134,181,254,267**;16 DEC 97;Build 158
"RTN","PSJLIVFD",3,0)
 ;
"RTN","PSJLIVFD",4,0)
 ; Reference to ^VALM0 is supported by DBIA # 2615.
"RTN","PSJLIVFD",5,0)
 ;
"RTN","PSJLIVFD",6,0)
 ;NFI changes for FR# 3@AD+4
"RTN","PSJLIVFD",7,0)
 ;
"RTN","PSJLIVFD",8,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVFD",9,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVFD",10,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVFD",11,0)
 S PSJLN=1
"RTN","PSJLIVFD",12,0)
AD ;
"RTN","PSJLIVFD",13,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVFD",14,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVFD",15,0)
 S PSJL=PSJL_"Additives:"
"RTN","PSJLIVFD",16,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,30,14)_+P("PON")
"RTN","PSJLIVFD",17,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,54,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVFD",18,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG) S PSJVD=$TR(PSJVD," ")
"RTN","PSJLIVFD",19,0)
 I $D(^TMP("PSJINTER",$J))!$$OVRCHK^PSGSICH1(PSGP,$G(PSJORD)) S PSJVD=$S($G(PSJVD)["DIN":"<OCI><DIN>",1:"<OCI>")
"RTN","PSJLIVFD",20,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,(80-$L(PSJVD)),$L(PSJVD))
"RTN","PSJLIVFD",21,0)
 I $D(IORVON),($G(PSJVD)]"") D CNTRL^VALM10(1,(80-$L(PSJVD)),$L(PSJVD),IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVFD",22,0)
 I '$D(IORVON),$D(IOST(0)) D ENS^%ZISS,TERM^VALM0
"RTN","PSJLIVFD",23,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",24,0)
 D:+$G(PSJLMX) CLRDSPL^PSJLIVMD
"RTN","PSJLIVFD",25,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVFD",26,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVFD",27,0)
SOL ;
"RTN","PSJLIVFD",28,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVFD",29,0)
 S PSJL=PSJL_"Solutions:"
"RTN","PSJLIVFD",30,0)
 I P("SYRS")]"" D
"RTN","PSJLIVFD",31,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,10)_$E(P("SYRS"),1,13)
"RTN","PSJLIVFD",32,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVFD",33,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",34,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVFD",35,0)
DUR ;
"RTN","PSJLIVFD",36,0)
 S PSJL=""
"RTN","PSJLIVFD",37,0)
 N DUROUT,IVLIMIT S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVFD",38,0)
 I $G(PSJORD)["P" N ND25 S ND25=$G(^PS(53.1,+PSJORD,2.5)),IVLIMIT=$P(ND25,"^",4) D
"RTN","PSJLIVFD",39,0)
 .S IVLIMIT=$S(IVLIMIT]"":$$FMTDUR^PSJLIVMD(IVLIMIT),1:"") S:IVLIMIT]"" DUROUT=IVLIMIT
"RTN","PSJLIVFD",40,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVFD",41,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVFD",42,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVFD",43,0)
START ;
"RTN","PSJLIVFD",44,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVFD",45,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVFD",46,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",47,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVFD",48,0)
 S PSJL="" I $G(PSJORD)["P",$G(PSGRDTX) D
"RTN","PSJLIVFD",49,0)
 . N RSDLABL,PSJRQB,PSJRQL,PSGRSD,PSGSRSDN
"RTN","PSJLIVFD",50,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVFD",51,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVFD",52,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVFD",53,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVFD",54,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT^PSJLIVMD(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL),SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",55,0)
INFRATE ;
"RTN","PSJLIVFD",56,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVFD",57,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVFD",58,0)
 D LONG^PSJLIUTL(P(8),22,24)
"RTN","PSJLIVFD",59,0)
LASTREN ;
"RTN","PSJLIVFD",60,0)
 N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGRNDT D
"RTN","PSJLIVFD",61,0)
 . S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVFD",62,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",63,0)
MR ;
"RTN","PSJLIVFD",64,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVFD",65,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVFD",66,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVFD",67,0)
STOP ;
"RTN","PSJLIVFD",68,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVFD",69,0)
 ;PSJ*5*180 - If Invalid Duration/Limit - Cannot Calculate Stop Date
"RTN","PSJLIVFD",70,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$S($G(PSJBADD)=1:"CANNOT CALCULATE",1:$$STOPDT^PSJLIUTL)
"RTN","PSJLIVFD",71,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",72,0)
 S PSJL=""
"RTN","PSJLIVFD",73,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(DFN,PSJORD)
"RTN","PSJLIVFD",74,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVFD",75,0)
 I $G(PSGRDTX(+PSJORD,"PSGRFD")) S PSGRFD=PSGRDTX(+PSJORD,"PSGRFD"),PSGRFDN=$$ENDTC^PSGMI(PSGRFD) D
"RTN","PSJLIVFD",76,0)
 . D DSPLYDT^PSJLIVMD(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",0,51,29)
"RTN","PSJLIVFD",77,0)
 D:($G(PSJBCMA)]"")!($G(PSGRFD)]"") SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",78,0)
SCH ;
"RTN","PSJLIVFD",79,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVFD",80,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVFD",81,0)
 D LONG^PSJLIUTL(P(9),22,35) S PSJL=PSJL_$S(P(7):"@0 labels a day",1:"")
"RTN","PSJLIVFD",82,0)
LASTFL ;
"RTN","PSJLIVFD",83,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVFD",84,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVFD",85,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",86,0)
ADM ;
"RTN","PSJLIVFD",87,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVFD",88,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVFD",89,0)
 D LONG^PSJLIUTL(P(11),22,30)
"RTN","PSJLIVFD",90,0)
QTY ;
"RTN","PSJLIVFD",91,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVFD",92,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",93,0)
PROVIDER ;
"RTN","PSJLIVFD",94,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVFD",95,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVFD",96,0)
CUMDOSES ;
"RTN","PSJLIVFD",97,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVFD",98,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",99,0)
OPI ;
"RTN","PSJLIVFD",100,0)
 N PSJOPILN,PSJOPCNT
"RTN","PSJLIVFD",101,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVFD",102,0)
 I $G(PSIVBR)["PSIVVW" D
"RTN","PSJLIVFD",103,0)
 .S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,PSJORD,1)
"RTN","PSJLIVFD",104,0)
 .I PSJOPILN=1,($TR($G(^TMP("PSJBCMA5",$J,DFN,PSJORD,1))," ")="") K ^TMP("PSJBCMA5",$J,DFN,PSJORD) S PSJOPILN=""
"RTN","PSJLIVFD",105,0)
 .S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)
"RTN","PSJLIVFD",106,0)
 .S PSJL=PSJL_" "_$S(($G(PSJOPILN)>0):"(see below)",1:"")
"RTN","PSJLIVFD",107,0)
 .D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",108,0)
 .I (PSJOPILN>0) N PSJOPCNT S PSJOPCNT=0 F PSJOPCNT=1:1:PSJOPILN S PSJL="     "_$G(^TMP("PSJBCMA5",$J,DFN,PSJORD,PSJOPCNT)) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",109,0)
 I $G(PSIVBR)'["PSIVVW" D
"RTN","PSJLIVFD",110,0)
 .I $G(ON55)["P",$G(PSJORD)["V",$P($G(^PS(53.1,+ON55,0)),"^",25)=PSJORD S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,ON55)
"RTN","PSJLIVFD",111,0)
 .S PSJOPILN=$P($G(^PS(53.45,PSJSYSP,6,0)),"^",3) I 'PSJOPILN S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,PSJORD)
"RTN","PSJLIVFD",112,0)
 .I PSJOPILN=1,($TR($G(^PS(53.45,PSJSYSP,6,1,0))," ")="") I '($G(^PS(53.45,PSJSYSP,6,0))<0) K ^PS(53.45,PSJSYSP,6) S PSJOPILN=""
"RTN","PSJLIVFD",113,0)
 .S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)
"RTN","PSJLIVFD",114,0)
 .S PSJL=PSJL_$S((PSJOPILN>0)&'($G(^PS(53.45,PSJSYSP,6,0))<0):"(see below)",1:"")
"RTN","PSJLIVFD",115,0)
 .D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",116,0)
 .I PSJOPILN>0 N PSJOPCNT S PSJOPCNT=0 F PSJOPCNT=1:1:PSJOPILN S PSJL="     "_$G(^PS(53.45,PSJSYSP,6,PSJOPCNT,0)) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",117,0)
 K PSJOPILN,PSJOPCNT K PSJOPILN,PSJOPCNT
"RTN","PSJLIVFD",118,0)
PC ;
"RTN","PSJLIVFD",119,0)
 S PSJL=""
"RTN","PSJLIVFD",120,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVFD",121,0)
REMARK ;
"RTN","PSJLIVFD",122,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",123,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVFD",124,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVFD",125,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVFD",126,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",127,0)
IVROOM ;
"RTN","PSJLIVFD",128,0)
 S PSJL=""
"RTN","PSJLIVFD",129,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVFD",130,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",131,0)
ENTRY ;
"RTN","PSJLIVFD",132,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVFD",133,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,18),1:"*** Undefined")
"RTN","PSJLIVFD",134,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVFD",135,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",136,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVFD",137,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVFD",138,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S(ON["P":28,1:100))_" IV "
"RTN","PSJLIVFD",139,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVFD",140,0)
 I $G(P("PON"))["P" D ORDCHK
"RTN","PSJLIVFD",141,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVFD",142,0)
 Q
"RTN","PSJLIVFD",143,0)
 ;
"RTN","PSJLIVFD",144,0)
ORDCHK ;Display order check for pending order
"RTN","PSJLIVFD",145,0)
 Q:'$O(^PS(53.1,+ON,10,0))
"RTN","PSJLIVFD",146,0)
 NEW PSJIVX,PSJIVXX
"RTN","PSJLIVFD",147,0)
 F PSJIVX=0:0 S PSJIVX=$O(^PS(53.1,+ON,10,PSJIVX)) Q:'PSJIVX  D
"RTN","PSJLIVFD",148,0)
 . D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",149,0)
 . S PSJL="CPRS Order Checks  :" D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,0)),22,60)
"RTN","PSJLIVFD",150,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",151,0)
 . S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+ON,10,PSJIVX,1)),U)
"RTN","PSJLIVFD",152,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",153,0)
 . S PSJL="Overriding Reason  : "
"RTN","PSJLIVFD",154,0)
 . F PSJIVXX=0:0 S PSJIVXX=$O(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX)) Q:'PSJIVXX  D
"RTN","PSJLIVFD",155,0)
 .. D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX,0)),22,60)
"RTN","PSJLIVFD",156,0)
 .. D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIVFD",157,0)
 Q
"RTN","PSJLIVFD",158,0)
 ;
"RTN","PSJLIVFD",159,0)
SCHREQ(IVAR) ;
"RTN","PSJLIVFD",160,0)
 I $G(IVAR(4))="P"!($G(IVAR(23))="P")!($G(IVAR(5))) Q 1
"RTN","PSJLIVFD",161,0)
 Q 0
"RTN","PSJLIVMD")
0^37^B95539776^B76799837
"RTN","PSJLIVMD",1,0)
PSJLIVMD ;BIR/MV-SETUP LM TEMPLATE FOR INPT MED. IV ; 4/28/08 3:11pm
"RTN","PSJLIVMD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**37,50,63,58,81,91,80,116,110,111,180,134,209,254,267**;16 DEC 97;Build 158
"RTN","PSJLIVMD",3,0)
 ;
"RTN","PSJLIVMD",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLIVMD",5,0)
 ;
"RTN","PSJLIVMD",6,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVMD",7,0)
 I $G(ON55),($G(P(1))=+$G(ON55)) S PSJORD=ON55
"RTN","PSJLIVMD",8,0)
 D GTOT^PSIVUTL(P(4))
"RTN","PSJLIVMD",9,0)
 S:'$D(PSJSTAR) PSJSTAR="" S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",10,0)
 I $E(P("OT"))'="I" D EN^PSJLIVFD Q
"RTN","PSJLIVMD",11,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVMD",12,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVMD",13,0)
 S PSJLN=1
"RTN","PSJLIVMD",14,0)
 I $G(PSIV531),P("PON")["P" S (P(2),P(3),P(4))=""
"RTN","PSJLIVMD",15,0)
AD ;
"RTN","PSJLIVMD",16,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVMD",17,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVMD",18,0)
 S PSJL=PSJL_" Additives:"
"RTN","PSJLIVMD",19,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,28,14)_+P("PON")
"RTN","PSJLIVMD",20,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,54,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVMD",21,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG) S PSJVD=$TR(PSJVD," ")
"RTN","PSJLIVMD",22,0)
 I $D(^TMP("PSJINTER",$J))!$$OVRCHK^PSGSICH1(PSGP,$G(PSJORD)) S PSJVD=$S($G(PSJVD)["DIN":"<OCI><DIN>",1:"<OCI>")
"RTN","PSJLIVMD",23,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,(80-$L(PSJVD)),$L(PSJVD))
"RTN","PSJLIVMD",24,0)
 I $D(IORVON),($G(PSJVD)]"") D CNTRL^VALM10(1,(80-$L(PSJVD)),$L(PSJVD),IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVMD",25,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",26,0)
 D:+$G(PSJLMX) CLRDSPL
"RTN","PSJLIVMD",27,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVMD",28,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVMD",29,0)
SOL ;
"RTN","PSJLIVMD",30,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVMD",31,0)
 S PSJL=PSJL_" Solutions:"
"RTN","PSJLIVMD",32,0)
 I P("SYRS")]"" D
"RTN","PSJLIVMD",33,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,11)_$E(P("SYRS"),1,13)
"RTN","PSJLIVMD",34,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVMD",35,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",36,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVMD",37,0)
 D DUR
"RTN","PSJLIVMD",38,0)
START ;
"RTN","PSJLIVMD",39,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVMD",40,0)
 I $G(P("OT"))="I",$G(P(4))]"" D
"RTN","PSJLIVMD",41,0)
 .Q:$G(ON)["V"  I $G(PSIVAC)="" N PSIVAC S PSIVAC="CF"
"RTN","PSJLIVMD",42,0)
 .Q:$G(P(3))
"RTN","PSJLIVMD",43,0)
 .D ENT^PSIVCAL,ENSTOP^PSIVCAL
"RTN","PSJLIVMD",44,0)
 D REQDT(ON)
"RTN","PSJLIVMD",45,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVMD",46,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVMD",47,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",48,0)
INFRATE ;
"RTN","PSJLIVMD",49,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVMD",50,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVMD",51,0)
 D LONG^PSJLIUTL(P(8),22,23)
"RTN","PSJLIVMD",52,0)
RSTART ;
"RTN","PSJLIVMD",53,0)
 I $G(ON)["P" N PSGNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) D
"RTN","PSJLIVMD",54,0)
 . I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32) Q
"RTN","PSJLIVMD",55,0)
 . Q:'$G(PSGRDTX)  N PSJRQB,PSJRQL,RSDLABL,PSGRSD,PSGRSDN
"RTN","PSJLIVMD",56,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVMD",57,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVMD",58,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVMD",59,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVMD",60,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL)  ;,SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",61,0)
 I $G(ON)["V" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVMD",62,0)
 I PSJL]"" D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",63,0)
 ;
"RTN","PSJLIVMD",64,0)
MR ;
"RTN","PSJLIVMD",65,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVMD",66,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVMD",67,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVMD",68,0)
STOP ;
"RTN","PSJLIVMD",69,0)
 S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",70,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVMD",71,0)
 ;PSJ*5*180 - If CPRS sends invalid duration/limit - Cannot Calculate Stop Date.
"RTN","PSJLIVMD",72,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$S($G(PSJBADD)=1:"CANNOT CALCULATE",1:$$STOPDT^PSJLIUTL)
"RTN","PSJLIVMD",73,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",74,0)
 S PSJL=""
"RTN","PSJLIVMD",75,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSJORD)
"RTN","PSJLIVMD",76,0)
 I $G(PSJBCMA)]"",$G(DFN) S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVMD",77,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$G(P(3)) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")) D
"RTN","PSJLIVMD",78,0)
 . D DSPLYDT(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",1,51,29)
"RTN","PSJLIVMD",79,0)
 I ($G(PSJBCMA)]"")!($G(PSGRDTX(+$G(PSJORD),"PSGRFD"))&$G(P(3))) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",80,0)
SCH ;
"RTN","PSJLIVMD",81,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVMD",82,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVMD",83,0)
 D LONG^PSJLIUTL(P(9)_$S(P(7):"@0 labels a day",1:"")_$G(SCHMSG),22,31)
"RTN","PSJLIVMD",84,0)
LASTFL ;
"RTN","PSJLIVMD",85,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVMD",86,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVMD",87,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",88,0)
ADM ;
"RTN","PSJLIVMD",89,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVMD",90,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVMD",91,0)
 NEW NOECH
"RTN","PSJLIVMD",92,0)
 D LONG^PSJLIUTL(P(11),22,29)
"RTN","PSJLIVMD",93,0)
QTY ;
"RTN","PSJLIVMD",94,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVMD",95,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",96,0)
PROVIDER ;
"RTN","PSJLIVMD",97,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVMD",98,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVMD",99,0)
CUMDOSES ;
"RTN","PSJLIVMD",100,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVMD",101,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",102,0)
OI ;
"RTN","PSJLIVMD",103,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVMD",104,0)
 S PSJL=$$SETSTR^VALM1("Orderable Item:",PSJL,6,16)_$P(P("PD"),U,2)_$$OINF^PSJDIN(+P("PD"))
"RTN","PSJLIVMD",105,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",106,0)
INS ;
"RTN","PSJLIVMD",107,0)
 S PSJL=""
"RTN","PSJLIVMD",108,0)
 S PSJL=$$SETSTR^VALM1("Instructions:",PSJL,8,14)
"RTN","PSJLIVMD",109,0)
 D LONG^PSJLIUTL(P("INS"),22,58)
"RTN","PSJLIVMD",110,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",111,0)
OPI ;
"RTN","PSJLIVMD",112,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVMD",113,0)
 I $G(PSIVBR)["PSIVVW" D
"RTN","PSJLIVMD",114,0)
 .S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,PSJORD,1)
"RTN","PSJLIVMD",115,0)
 .I PSJOPILN=1,($TR($G(^TMP("PSJBCMA5",$J,DFN,PSJORD,1))," ")="") K ^TMP("PSJBCMA5",$J,DFN,PSJORD) S PSJOPILN="" Q
"RTN","PSJLIVMD",116,0)
 .S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)
"RTN","PSJLIVMD",117,0)
 .S PSJL=PSJL_" "_$S(($G(PSJOPILN)>0):"(see below)",1:"")
"RTN","PSJLIVMD",118,0)
 .D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",119,0)
 .I (PSJOPILN>0) N PSJOPCNT S PSJOPCNT=0 F PSJOPCNT=1:1:PSJOPILN S PSJL="     "_$G(^TMP("PSJBCMA5",$J,DFN,PSJORD,PSJOPCNT)) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",120,0)
 I $G(PSIVBR)'["PSIVVW" D
"RTN","PSJLIVMD",121,0)
 .I $G(ON55)["P",$G(PSJORD)["V",$P($G(^PS(53.1,+ON55,0)),"^",25)=PSJORD S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,ON55)
"RTN","PSJLIVMD",122,0)
 .S PSJOPILN=$O(^PS(53.45,DUZ,6,""),-1) I 'PSJOPILN S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,PSJORD)
"RTN","PSJLIVMD",123,0)
 .I PSJOPILN=1,($TR($G(^PS(53.45,PSJSYSP,6,1,0))," ")="") I '($G(^PS(53.45,PSJSYSP,6,0))<0)  K ^PS(53.45,PSJSYSP,6) S PSJOPILN="" Q
"RTN","PSJLIVMD",124,0)
 .I PSJOPILN=1,$G(^PS(53.45,PSJSYSP,6,1,0))["Instructions too long. See Order View or BCMA for full text." K ^PS(53.45,PSJSYSP,6) S PSJOPILN="" Q
"RTN","PSJLIVMD",125,0)
 .S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)
"RTN","PSJLIVMD",126,0)
 .S PSJL=PSJL_" "_$S(($G(PSJOPILN)>0)&'($G(^PS(53.45,PSJSYSP,6,0))<0):"(see below)",1:"")
"RTN","PSJLIVMD",127,0)
 .D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",128,0)
 .I (PSJOPILN>0) N PSJOPCNT S PSJOPCNT=0 F PSJOPCNT=1:1:PSJOPILN S PSJL="     "_$G(^PS(53.45,DUZ,6,PSJOPCNT,0)) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",129,0)
 K PSJOPILN,PSJOPCNT
"RTN","PSJLIVMD",130,0)
PC ;
"RTN","PSJLIVMD",131,0)
 S PSJL=""
"RTN","PSJLIVMD",132,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVMD",133,0)
REMARK ;
"RTN","PSJLIVMD",134,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVMD",135,0)
 S PSJL="" D FLDNO^PSJLIUTL("(12)",1)
"RTN","PSJLIVMD",136,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVMD",137,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVMD",138,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",139,0)
IVROOM ;
"RTN","PSJLIVMD",140,0)
 S PSJL=""
"RTN","PSJLIVMD",141,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVMD",142,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",143,0)
ENTRY ;
"RTN","PSJLIVMD",144,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVMD",145,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,24),1:"*** Undefined")
"RTN","PSJLIVMD",146,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVMD",147,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",148,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVMD",149,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVMD",150,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S($G(ON)["P":28,1:100))_" IV "
"RTN","PSJLIVMD",151,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVMD",152,0)
 I $G(P("PON"))["P" D ORDCHK^PSJLIVFD
"RTN","PSJLIVMD",153,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVMD",154,0)
 Q
"RTN","PSJLIVMD",155,0)
DSPLYDT(PSJLN,PSGRDT,PSGRDTN,TXT,PSJFSH,PSJRDBEG,PSJRDLEN)  ;
"RTN","PSJLIVMD",156,0)
 ;LINE   : Line number the Requested Start and Stop dates are display in
"RTN","PSJLIVMD",157,0)
 ;PSGRDT : Either it is the requested start or stop date in FM format
"RTN","PSJLIVMD",158,0)
 ;PSGRDTN: Either it is the requested start or stop date in IPM format
"RTN","PSJLIVMD",159,0)
 ;TXT    : The display text
"RTN","PSJLIVMD",160,0)
 ;PSJFSH     : if it is 1 then flash
"RTN","PSJLIVMD",161,0)
 ;
"RTN","PSJLIVMD",162,0)
 S:'$G(PSJRDBEG) PSJRDBEG=41,PSJRDLEN=39
"RTN","PSJLIVMD",163,0)
 S PSJL=$$SETSTR^VALM1(TXT_PSGRDTN,PSJL,PSJRDBEG,PSJRDLEN)
"RTN","PSJLIVMD",164,0)
 Q
"RTN","PSJLIVMD",165,0)
CLRDSPL ;
"RTN","PSJLIVMD",166,0)
 ;Clear the blinking after edit the pending order.
"RTN","PSJLIVMD",167,0)
 ;Without it more than the requested start and stop dates are blinking at the ac/edit screen
"RTN","PSJLIVMD",168,0)
 ;PSJLMX: # ad/sol counted in WRTDRG^PSJLIUTL
"RTN","PSJLIVMD",169,0)
 Q:'$D(IOBOFF)
"RTN","PSJLIVMD",170,0)
 NEW PSJX
"RTN","PSJLIVMD",171,0)
 F PSJX=5:1:PSJLMX+7 D CNTRL^VALM10(PSJX,36,80,IOBOFF,IOINORM)
"RTN","PSJLIVMD",172,0)
 Q
"RTN","PSJLIVMD",173,0)
REQDT(ORDER)       ;Get requested date if it is a pending order
"RTN","PSJLIVMD",174,0)
 ;ORDER  : Pending Order Number (PSJORD or PSGORD)
"RTN","PSJLIVMD",175,0)
 Q:ORDER'["P"  D REQDT^PSJLIUTL(ORDER)
"RTN","PSJLIVMD",176,0)
 Q
"RTN","PSJLIVMD",177,0)
 ;
"RTN","PSJLIVMD",178,0)
GETDUR(PAT,ORD,PKG,RAW) ;
"RTN","PSJLIVMD",179,0)
 ; PAT= Patient DFN
"RTN","PSJLIVMD",180,0)
 ; ORD= Order #
"RTN","PSJLIVMD",181,0)
 ; PKG= 5(UD), "IV"(IV), "P"(Pending)
"RTN","PSJLIVMD",182,0)
 N ACT,DUR,ND,ND25,F25,ND0,ND2,OLDORD S DUR="",ORD=+ORD K IVLIMIT
"RTN","PSJLIVMD",183,0)
 S:PKG="V" PKG="IV"
"RTN","PSJLIVMD",184,0)
 I PKG="P" S ND=$G(^PS(53.1,+ORD,0)) D  I '$G(OLDORD) Q DUR
"RTN","PSJLIVMD",185,0)
 . I $G(P("OVRIDE")) S DUR="" Q
"RTN","PSJLIVMD",186,0)
 . D PENDING(ORD) Q:DUR]""
"RTN","PSJLIVMD",187,0)
 . S ND0=$G(^PS(53.1,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) I OLDORD S PKG=$S(OLDORD["V":"IV",OLDORD["U":5,OLDORD["P":"P",1:"")
"RTN","PSJLIVMD",188,0)
 . Q:($G(OLDORD)'["P")
"RTN","PSJLIVMD",189,0)
 . D PENDING(OLDORD) S OLDORD=""
"RTN","PSJLIVMD",190,0)
 I PKG="IV" S ND2=$G(^PS(55,PAT,PKG,ORD,2)) I $P(ND2,U,8)="E" S OLDORD=$P(ND2,U,5) S:OLDORD'["V" OLDORD="" I OLDORD D
"RTN","PSJLIVMD",191,0)
 .N ACTND S ACTND=0 F  S ACTND=$O(^PS(55,PAT,"IV",ORD,"A",ACTND)) Q:'ACTND  D
"RTN","PSJLIVMD",192,0)
 ..I $G(^PS(55,PAT,"IV",ORD,"A",ACTND,0))["IV LIMIT OVERRIDDEN" S OLDORD=""
"RTN","PSJLIVMD",193,0)
 I $G(P("LIMIT"))]"" S DUR=P("LIMIT"),IVLIMIT=1 I '$G(RAW) S DUR=$$FMTDUR(DUR) Q DUR
"RTN","PSJLIVMD",194,0)
 I PKG=5 S ND0=$G(^PS(55,PAT,PKG,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) S:OLDORD'["U" OLDORD=""
"RTN","PSJLIVMD",195,0)
 S F25="^PS(55,PAT,PKG,ORD,2.5)" I '$G(OLDORD) Q:'$D(@(F25)) DUR
"RTN","PSJLIVMD",196,0)
 S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",197,0)
 ;PSJ*5*209 stop forcing null duration to previous.
"RTN","PSJLIVMD",198,0)
 ;I DUR="",$G(OLDORD) S ORD=+OLDORD Q:'$D(@(F25)) DUR  D
"RTN","PSJLIVMD",199,0)
 ;. S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",200,0)
 I '$G(RAW),DUR]"" S DUR=$$FMTDUR(DUR)
"RTN","PSJLIVMD",201,0)
 Q DUR
"RTN","PSJLIVMD",202,0)
 ;
"RTN","PSJLIVMD",203,0)
PENDING(PNDON) ;
"RTN","PSJLIVMD",204,0)
 S ND=$G(^PS(53.1,+ORD,0))
"RTN","PSJLIVMD",205,0)
 I ND S ND25=$S(($P(ND,U,15)=PAT):$G(^PS(53.1,+ORD,2.5)),1:"")
"RTN","PSJLIVMD",206,0)
 S DUR=$P(ND25,U,4) I DUR]"" D  Q
"RTN","PSJLIVMD",207,0)
 .S:($E(DUR)="s")!($E(DUR)="m")!($E(DUR)="l")!($E(DUR)="d")!($E(DUR)="h")!($E(DUR)="a") IVLIMIT=1 S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR))
"RTN","PSJLIVMD",208,0)
 S DUR=$P(ND25,U,2) I DUR]"" S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR))
"RTN","PSJLIVMD",209,0)
 Q
"RTN","PSJLIVMD",210,0)
 ;
"RTN","PSJLIVMD",211,0)
FMTDUR(DURCODE) ;
"RTN","PSJLIVMD",212,0)
 N DUNIT,DNUM,BAD S BAD=0
"RTN","PSJLIVMD",213,0)
 ;PSJ*5*180 - Add PSJBADD variable
"RTN","PSJLIVMD",214,0)
 K PSJBADD S PSJBADD=0
"RTN","PSJLIVMD",215,0)
 S DUNIT=$E(DURCODE),DNUM=$P(DURCODE,DUNIT,2) I 'DNUM S BAD=1
"RTN","PSJLIVMD",216,0)
 I DUNIT'="",DUNIT'?1(1U,1L) S PSJBADD=1
"RTN","PSJLIVMD",217,0)
 S DUNIT=$S(DUNIT="D"!(DUNIT="d"):" day",DUNIT="H"!(DUNIT="h"):" hour",DUNIT="W":" week",DUNIT="L":" month",DUNIT="M":" minute",DUNIT="S":" second",DUNIT="m":" ml",DUNIT="l":" liter",DUNIT="a":" dose",1:"")
"RTN","PSJLIVMD",218,0)
 S:DUNIT="" BAD=1 I (DNUM'=1),(DUNIT'["ml") S DUNIT=DUNIT_"s"
"RTN","PSJLIVMD",219,0)
 I PSJBADD=1 S PSGACT=$TR($G(PSGACT),"F")
"RTN","PSJLIVMD",220,0)
 Q $S(PSJBADD=1:"*INVALID DURATION/LIMIT*",BAD:"",1:DNUM_DUNIT)
"RTN","PSJLIVMD",221,0)
 ;
"RTN","PSJLIVMD",222,0)
DURMIN(DCOD) ;
"RTN","PSJLIVMD",223,0)
 N DUR,DMIN,CHR S DUR="" F I=1:1:$L(DCOD) S CHR=$E(DCOD,I) I CHR?1N S DUR=DUR_CHR
"RTN","PSJLIVMD",224,0)
 S DMIN=DUR*$S(DCOD["L":43200,DCOD["W":10080,DCOD["M":1,DCOD["S":(1/60),DCOD["D":1440,1:0) S DMIN=+$FN(DMIN,"",1)
"RTN","PSJLIVMD",225,0)
 Q DMIN
"RTN","PSJLIVMD",226,0)
 ;
"RTN","PSJLIVMD",227,0)
DUR ;
"RTN","PSJLIVMD",228,0)
 N DUROUT,LABEL,IVLIMIT
"RTN","PSJLIVMD",229,0)
 Q:'$G(PSJORD)  S PSJL=""
"RTN","PSJLIVMD",230,0)
 S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVMD",231,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVMD",232,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVMD",233,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVMD",234,0)
 Q
"RTN","PSJLMGUD")
0^36^B30433867^B30595874
"RTN","PSJLMGUD",1,0)
PSJLMGUD ;BIR/MLM-INITIALIZE UNIT DOSE ORDER FIELDS FOR DISPLAY ;05 Feb 99 / 9:46 AM
"RTN","PSJLMGUD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**25,58,85,116,110,111,267**;16 DEC 97;Build 158
"RTN","PSJLMGUD",3,0)
 ;
"RTN","PSJLMGUD",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178
"RTN","PSJLMGUD",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192 
"RTN","PSJLMGUD",6,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSJLMGUD",7,0)
 ; Reference to ES^ORX8 is supported by DBIA 3632
"RTN","PSJLMGUD",8,0)
 ;
"RTN","PSJLMGUD",9,0)
GETUD(DFN,PSGORD) ;
"RTN","PSJLMGUD",10,0)
 ;
"RTN","PSJLMGUD",11,0)
EN2 ;
"RTN","PSJLMGUD",12,0)
 N %X,%Y,ND2,DO,DRGI,FD,FL,FQC,NF,ND,PRI,SD,SIG,ST,STD,X,Y,ESIG
"RTN","PSJLMGUD",13,0)
 K GMRAL,P
"RTN","PSJLMGUD",14,0)
 S NF=$S(PSGORD["U":0,PSGORD["A":0,PSGORD["O":0,1:1) I NF,$D(^PS(53.1,+PSGORD,0)),$P(^(0),"^",19),$D(^PS(55,DFN,5,$P(^(0),"^",19))),(+$P(^(0),"^",19)'=+$P(^(0),"^",25)) S PSGORD=+$P(^PS(53.1,+PSGORD,0),"^",19)_"U",NF=0
"RTN","PSJLMGUD",15,0)
 S (FL,Y)="",$P(FL,"-",71)="",PSGOEEWF="^PS("_$S(NF:"53.1,",1:"55,"_DFN_",5,")_+PSGORD_","
"RTN","PSJLMGUD",16,0)
 ; The naked reference on the line below refers to the full reference created by indirect reference to F, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJLMGUD",17,0)
 S ND=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2)),PSGEB=$P($G(^(4)),"^",7),PSGOSI=$G(^(6)),SIG=$G(^(6.5)),DO=$G(^(.2)),PSGOINST=$G(^(.3)),ESIG=$P(DO,U,3),PSG14=$P($G(^(14,0)),"^",3)
"RTN","PSJLMGUD",18,0)
 I PSG14 S PSGLRN=$G(@(PSGOEEWF_"14,"_PSG14_",0)"))
"RTN","PSJLMGUD",19,0)
 S PSGOPD=+DO,PSGODO=$P(DO,U,2),PSGOPDN=$$OINAME^PSJLMUTL(+DO),X=$P(DO,U,4),PSGPRIO=$P("STAT^ASAP^ROUTINE^PREOP^TIME CRITICAL^DONE",U,$F("SARPTD",X)-1),PSJPRI=X
"RTN","PSJLMGUD",20,0)
 S PSGOPR=$P(ND,"^",2),PSGOMR=$P(ND,"^",3),PSGOSM=$P(ND,"^",5),PSGOHSM=$P(ND,"^",6),(PSGOST,ST)=$P(ND,"^",7),STT=$P(ND,"^",9),PSGOMRN=$S('PSGOMR:"",1:$P($G(^PS(51.2,PSGOMR,0)),"^")) S:PSGOMRN="" PSGOMRN=PSGOMR
"RTN","PSJLMGUD",21,0)
 S PSGLI=$P(ND,U,16),PSGOSCH=$P(ND2,"^"),(PSGOSD,SD)=$P(ND2,"^",2),(FD,PSGOFD)=$P(ND2,"^",4),(FQC,PSGS0XT)=$P(ND2,"^",6),(PSGOAT,PSGS0Y)=$P(ND2,"^",5)
"RTN","PSJLMGUD",22,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSJLMGUD",23,0)
 S PRI=$S('PSGOPR:0,1:$P($G(^VA(200,PSGOPR,"PS")),"^",4)),DRGI=$S(PSGOPD'=+PSGOPD:0,1:+$G(^PSDRUG(+PSGOPD,"I"))) S:PRI PRI=DT'<PRI S:DRGI DRGI=DT'<DRGI
"RTN","PSJLMGUD",24,0)
 S PSGOPRN=$S('PSGOPR:"",1:$P($G(^VA(200,PSGOPR,0)),"^")) S:PSGOPRN="" PSGOPRN=PSGOPR I PSGOSI]"" S PSGOSI=$$ENSET^PSGSICHK(PSGOSI)
"RTN","PSJLMGUD",25,0)
 I $L($T(ES^ORX8)) N ESIG1 S ESIG1=$$ES^ORX8(+$P(ND,U,21)_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSJLMGUD",26,0)
 S PSGOPRN=PSGOPRN_$S(ESIG]"":" ["_$$LOW^XLFSTR(ESIG)_"]",1:"")
"RTN","PSJLMGUD",27,0)
 S PSGEBN=$$ENNPN^PSGMI(PSGEB) S:$P(ND,U,27)="R" STT="R"
"RTN","PSJLMGUD",28,0)
 S X=STT,PSGSTAT=$S(X="":"NOT FOUND",X="DE":"DISCONTINUED (EDIT)",X="DR":"DISCONTINUED (RENEWAL)",X="RE":"REINSTATED",1:$P(X_"^ACTIVE^DISCONTINUED^EXPIRED^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^RENEWED^UNRELEASED","^",$F("ADEHINPRU",X)))
"RTN","PSJLMGUD",29,0)
 ;
"RTN","PSJLMGUD",30,0)
SET ;
"RTN","PSJLMGUD",31,0)
 I STT="P" S (FD,SD,ST)=""
"RTN","PSJLMGUD",32,0)
 S PSGOSTN=$$ENSTN^PSGMI(ST),(PSGOFDN,PSGOSDN)="" I SD S PSGOSDN=$$ENDD^PSGMI(SD)_"^"_$$ENDTC^PSGMI(SD)
"RTN","PSJLMGUD",33,0)
 I FD S PSGOFDN=$$ENDD^PSGMI(FD)_"^"_$$ENDTC^PSGMI(FD)
"RTN","PSJLMGUD",34,0)
 F X="PD","PDN","MR","MRN","ST","STN","SCH","SI","SD","SDN","FD","FDN","SM","HSM","PR","PRN","DO","AT" S @("PSG"_X)=@("PSGO"_X)
"RTN","PSJLMGUD",35,0)
 K ^PS(53.45,PSJSYSP,1),^(2),^(5) S %X=PSGOEEWF_"3,",%Y="^PS(53.45,"_PSJSYSP_",1," D %XY^%RCR S %X=PSGOEEWF_"1,",%Y="^PS(53.45,"_PSJSYSP_",2," D %XY^%RCR
"RTN","PSJLMGUD",36,0)
 S $P(^PS(53.45,PSJSYSP,2,0),"^",2)="53.4502P"
"RTN","PSJLMGUD",37,0)
 K PSJNSS I $G(PSGSCH)'="" D  K PSJNSS
"RTN","PSJLMGUD",38,0)
 . ;N PSGS0XT,PSGOES,Y S X=PSGSCH N PSGSCH S PSGSCH="" S:($G(VALMBCK)]"")!'$G(NSFF)!$G(PSJTUD) PSGOES=1 D ENOS^PSGS0
"RTN","PSJLMGUD",39,0)
 . N PSGS0XTO,Y,PSGOES S X=PSGSCH S PSGS0XTO=PSGS0XT N PSGOSCH S PSGOSCH=PSGSCH S PSGSCH="",PSGOES=1
"RTN","PSJLMGUD",40,0)
 . D ENOS^PSGS0 S:$G(X)="" PSGS0XT=PSGS0XTO S PSGSCH=$S($G(X)]""&($G(PSGS0XT)="D"):X,1:PSGOSCH)
"RTN","PSJLMGUD",41,0)
 Q
"RTN","PSJLMGUD",42,0)
 ;
"RTN","PSJLMGUD",43,0)
FINISH ;
"RTN","PSJLMGUD",44,0)
 I '$G(PSGS0XT),PSGOSCH]"" D  S $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSJLMGUD",45,0)
 .N PSGOES,PSGS0Y S X=PSGOSCH,PSGOES=1 D ENOS^PSGS0
"RTN","PSJLMGUD",46,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10) I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")_" before it can be finished."
"RTN","PSJLMGUD",47,0)
 I PSGOEFF W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSJLMGUD",48,0)
 I PSGOEFF#2 S F1=53.1,MSG=0,Y=$T(35),@("PSGFN(35)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(35),";",3) G:'PSGOEE DONE
"RTN","PSJLMGUD",49,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(PSGOPD,0) G:CHK DONE
"RTN","PSJLMGUD",50,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSJLMGUD",51,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD) N XQORM D EN^VALM("PSJ LM OE DISPLAY") G DONE ;D ENW^PSGOEEW
"RTN","PSJLMGUD",52,0)
 ;
"RTN","PSJLMGUD",53,0)
ACCEPT ;
"RTN","PSJLMGUD",54,0)
 D UPD^PSGOEF1 G DONE
"RTN","PSJLMGUD",55,0)
BYPASS ;
"RTN","PSJLMGUD",56,0)
 S PSGCANFL=1 G DONE
"RTN","PSJLMGUD",57,0)
 ;
"RTN","PSJLMGUD",58,0)
EDIT ;    
"RTN","PSJLMGUD",59,0)
 S PSGPDRG=PSGOPD,PSGPDRGN=PSGOPDN K PSGOEEND D ENF^PSGOEE I PSGCANFL=-1 D UPD^PSGOEF1
"RTN","PSJLMGUD",60,0)
 ;
"RTN","PSJLMGUD",61,0)
DONE ;
"RTN","PSJLMGUD",62,0)
 K CHK,DA,DIE,DR,DRG,MSG,ORETURN,ORIFN,PSGEB,PSGEFN,PSGND,PSGOEE,PSGOEEF,PSGOEEND,PSGOEEG,PSGOEF,PSGOEFF,PSGOES,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGPDRG,PSGDRGN,PSG0XT,PSGS0Y,OSGSD,Q1,Q2
"RTN","PSJLMGUD",63,0)
 Q
"RTN","PSJLMGUD",64,0)
 ;
"RTN","PSJLMGUD",65,0)
 ;
"RTN","PSJLMGUD",66,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSJLMGUD",67,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;102;PSGODO]""
"RTN","PSJLMGUD",68,0)
33 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSJLMGUD",69,0)
34 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSJLMGUD",70,0)
35 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSJLMGUD",71,0)
36 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSJLMGUD",72,0)
37 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSJLMGUD",73,0)
38 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSJLMGUD",74,0)
39 ;;2^PSGOE82;;;2;0
"RTN","PSJLMGUD",75,0)
310 ;;40^PSGOE82;;;40;0
"RTN","PSJLMGUD",76,0)
311 ;;66^PSGOE82;;;66;1
"RTN","PSJLMGUD",77,0)
312 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSJLMGUD",78,0)
313 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSJLMGUD",79,0)
314 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSJLMGUD",80,0)
 ;
"RTN","PSJLMGUD",81,0)
AH ;
"RTN","PSJLMGUD",82,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSJLMGUD",83,0)
 Q
"RTN","PSJLMPRU")
0^29^B14898207^B14487092
"RTN","PSJLMPRU",1,0)
PSJLMPRU ;BIR/MLM-INPATIENT LISTMAN UD PROFILE UTILITIES ;27 Aug 98 / 8:45 AM
"RTN","PSJLMPRU",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**16,58,85,110,185,181,267**;16 DEC 97;Build 158
"RTN","PSJLMPRU",3,0)
 ;
"RTN","PSJLMPRU",4,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJLMPRU",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMPRU",6,0)
 ;
"RTN","PSJLMPRU",7,0)
PUD(DFN,ON,PSJF,DN) ; Setup LM profile view for UD
"RTN","PSJLMPRU",8,0)
 N PSJFLAG,PSJV
"RTN","PSJLMPRU",9,0)
 ; Naked references on the two lines below refer to full reference ^PS(55,DFN,5,+ON in PSJF using indirection.
"RTN","PSJLMPRU",10,0)
 S ND=$G(@(PSJF_+ON_",0)")),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$G(^(6)),NDP2=$G(^(.2)),PSJFLAG=$P(NDP2,U,7),X=$P(DN,U,2),DO=$S('X:"",1:$G(^(+X))) S:X=.2 DO=$P(DO,U,2)
"RTN","PSJLMPRU",11,0)
 S ND14=$G(@(PSJF_+ON_",14,0)")),RNDT="" I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^")
"RTN","PSJLMPRU",12,0)
 I ("AO"[PSJC)!(PSJC="DF") D
"RTN","PSJLMPRU",13,0)
 .S V='$P(ND4,"^",UDU),PSJL=$$SETSTR^VALM1($S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",19)&$P(ND4,"^",18):"H",$P(ND4,"^",23)&$P(ND4,"^",22):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" "),PSJL,5,1)
"RTN","PSJLMPRU",14,0)
 .;S X=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSJLMPRU",15,0)
 .S PSJV=$S($P(NDP2,U,4)="D":"d",1:" ")_$S(+PSJSYSU=1&V:"->",+PSJSYSU=3&V:"->",1:"   ") I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",16,0)
 .S PSJL=$$SETSTR^VALM1(PSJV,PSJL,6,3)
"RTN","PSJLMPRU",17,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),STAT=$S($P(ND,U,28)]"":$P(ND,U,28),$P(ND,"^",9)]"":$P(ND,"^",9),1:"NF"),PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJLMPRU",18,0)
 I STAT="A",$P(ND,U,27)="R" S STAT="R"
"RTN","PSJLMPRU",19,0)
 S NF="",WS=$S(PSJPWD:$$WS^PSJO(PSJPWD,PSGP,PSJF,+ON),1:0)
"RTN","PSJLMPRU",20,0)
 N PSJDISP F PSJDISP=0:0 S PSJDISP=$O(@(PSJF_+ON_",1,"_PSJDISP_")")) Q:'PSJDISP  D
"RTN","PSJLMPRU",21,0)
 .I $P($G(^PSDRUG(+$P($G(@(PSJF_+ON_",1,"_PSJDISP_",0)")),"^"),0)),"^",9)=1 S NF=1
"RTN","PSJLMPRU",22,0)
 NEW DRUGNAME,PSGID1,SD1,LEN,PSGID1,SD1 S LEN=$S($D(PSJEXPT):8,1:5)
"RTN","PSJLMPRU",23,0)
 F X="PSGID","SD" S @(X_1)=$S(PSJC["C":"*****",1:$E($$ENDTC^PSGMI(@X),1,LEN))
"RTN","PSJLMPRU",24,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJLMPRU",25,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJLMPRU",26,0)
 .I PSJX=1 D
"RTN","PSJLMPRU",27,0)
 ..I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",28,0)
 ..S PSJL=$$SETSTR^VALM1($S($E(PSJS)="*":$P(PSJS,"^"),1:DRUGNAME(PSJX)),PSJL,9,39)
"RTN","PSJLMPRU",29,0)
 ..S PSJL=$$SETSTR^VALM1($S(PSJC["C":"?",PSJSCHT'="z":PSJSCHT,1:"?"),PSJL,50,3)
"RTN","PSJLMPRU",30,0)
 ..S PSJL=PSJL_PSGID1_"  "_SD1_" "_$E(STAT,1,2)_$S($L(STAT)=1:"     ",1:"    ")_$S($G(RNDT):$E($$ENDTC^PSGMI(RNDT),1,LEN),1:"")
"RTN","PSJLMPRU",31,0)
 ..I NF!WS!SM!PF S PSJL=$$SETSTR^VALM1($S(NF:"NF ",WS:"WS ",SM:$E("HSM",SM,3),1:""),PSJL,69,3) S:PF PSJL=$$SETSTR^VALM1("*",PSJL,79,1)
"RTN","PSJLMPRU",32,0)
 . I PSJX>1 S PSJL="",PSJL=$$SETSTR^VALM1(DRUGNAME(PSJX),PSJL,11,66)
"RTN","PSJLMPRU",33,0)
 . D SETTMP("PSJPRO",PSJL) I ($P(NDP2,U,4)="S"),STAT="P" D CNTRL^VALM10((PSJLN-1),9,9+$L(PSJL),IOINHI_IOBON,IOINORM,0)
"RTN","PSJLMPRU",34,0)
 I ND6'="" N X,PSJTXT3 S X=$$GETSIOPI^PSJBCMA5(DFN,ON) N TXTLN S TXTLN=0 F  S TXTLN=$O(^PS(53.45,DUZ,5,TXTLN)) Q:'TXTLN!$G(PSJTXT3)  D
"RTN","PSJLMPRU",35,0)
 .I ($O(^PS(53.45,DUZ,5," "),-1)>3) S PSJTXT3=1 S PSJL="Instructions too long. See Order View for full text." D PTXT(PSJL,"PSJPRO",10,66) Q
"RTN","PSJLMPRU",36,0)
 .S PSJL=^PS(53.45,DUZ,5,TXTLN,0) D PTXT(PSJL,"PSJPRO",10,66)
"RTN","PSJLMPRU",37,0)
 K ^PS(53.45,DUZ,5)
"RTN","PSJLMPRU",38,0)
 Q
"RTN","PSJLMPRU",39,0)
 ;
"RTN","PSJLMPRU",40,0)
PTXT(TXT,SUB,LM,RM) ; Display Instructions/dosage ordered.
"RTN","PSJLMPRU",41,0)
 ;* Input:       TXT = Text to display.
"RTN","PSJLMPRU",42,0)
 ;                       SUB = First subscript for ^TMP node, ** MUST be PSJ namespace **
"RTN","PSJLMPRU",43,0)
 ;                       LM  = Begin display of text after LM spaces.
"RTN","PSJLMPRU",44,0)
 ;                       RM  = Length of display text.
"RTN","PSJLMPRU",45,0)
 ;                       
"RTN","PSJLMPRU",46,0)
 ;BHW;PSJ*5*185;Extra spaces causes display to "skip" part of the field. 
"RTN","PSJLMPRU",47,0)
 ;S PSJL="",$P(PSJL," ",LM)="" F X=1:1 S WRD=$P(TXT," ",X) Q:WRD=""  D
"RTN","PSJLMPRU",48,0)
 S PSJL="",$P(PSJL," ",LM)=""
"RTN","PSJLMPRU",49,0)
 F X=1:1:$L(TXT," ") S WRD=$P(TXT," ",X) D
"RTN","PSJLMPRU",50,0)
 .;BHW;PSJ*5*185;check if end of string or just extra space
"RTN","PSJLMPRU",51,0)
 .I WRD="" S PSJL=PSJL_" " Q 
"RTN","PSJLMPRU",52,0)
 .I $L(PSJL_" "_WRD)'<RM D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)=""
"RTN","PSJLMPRU",53,0)
 .I $L(PSJL_" "_WRD)'<RM S PSJL=PSJL_" "_$E(WRD,1,(RM-10)) D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)="",WRD=$E(WRD,(RM-9),$L(WRD))
"RTN","PSJLMPRU",54,0)
 .S PSJL=PSJL_" "_WRD
"RTN","PSJLMPRU",55,0)
 D SETTMP(SUB,PSJL)
"RTN","PSJLMPRU",56,0)
 Q
"RTN","PSJLMPRU",57,0)
SETTMP(SUB,PSJL) ;
"RTN","PSJLMPRU",58,0)
 S ^TMP(SUB,$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1
"RTN","PSJLMPRU",59,0)
 Q
"RTN","PSJLMUDE")
0^35^B65175235^B63620133
"RTN","PSJLMUDE",1,0)
PSJLMUDE ;BIR/MLM-SHOW FIELDS FOR EDIT (LISTMAN STYLE) ;01 JUNE 00 / 2:40 PM
"RTN","PSJLMUDE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,47,50,63,64,58,80,116,110,111,164,175,201,181,254,267**;16 DEC 97;Build 158
"RTN","PSJLMUDE",3,0)
 ;
"RTN","PSJLMUDE",4,0)
 ;NFI-UD Fr#:2 chgs@init+4 to display non-formulary (N/F)
"RTN","PSJLMUDE",5,0)
 ;also chgs @init+23
"RTN","PSJLMUDE",6,0)
 ;
"RTN","PSJLMUDE",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJLMUDE",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192
"RTN","PSJLMUDE",9,0)
 ;
"RTN","PSJLMUDE",10,0)
INIT(PSGP,PSGORD) ;
"RTN","PSJLMUDE",11,0)
 N D,ND,PSJBCMA,PSJL,PSJLM,PSJLN,Q,QQ,PSJDUR,J K ^TMP("PSJUDE",$J),^TMP($J,"GMRAING")
"RTN","PSJLMUDE",12,0)
 K:$G(PSJNORD) PSGOEEF S PSJLN=1
"RTN","PSJLMUDE",13,0)
 D CLEAN^VALM10
"RTN","PSJLMUDE",14,0)
 S PSJL=$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"   "),PSJL=$$SETSTR^VALM1("Orderable Item: "_PSGPDN_$$OINF^PSJDIN(PSGPD),PSJL,5,74) D  D SETTMP D:$G(PSGOEEF(108))!($G(PSGOEEF(101))) HILITE(1)
"RTN","PSJLMUDE",15,0)
 . NEW Q,PSJDDA,PSJVD F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S PSJDDA(+$G(^(Q,0)))=""
"RTN","PSJLMUDE",16,0)
 . S PSJVD=$$DINFLUD^PSJDIN(PSGPD,.PSJDDA)
"RTN","PSJLMUDE",17,0)
 . I $$OVRCHK^PSGSICH1(PSGP,PSGORD) S PSJVD="<OCI>"_PSJVD
"RTN","PSJLMUDE",18,0)
 . S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,(80-$L(PSJVD)),80)
"RTN","PSJLMUDE",19,0)
 . D:PSJVD]"" CNTRL^VALM10(1,80-$L(PSJVD),$L(PSJVD),IORVON,IORVOFF,0)
"RTN","PSJLMUDE",20,0)
 I $G(PSJORD)["P" D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJLMUDE",21,0)
 S PSJL="Instructions: "_PSGOINST D PTXT^PSJLMPRU(PSJL,"PSJUDE",6,80)
"RTN","PSJLMUDE",22,0)
 S PSJL=$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),PSJL=$$SETSTR^VALM1("Dosage Ordered: "_PSGDO,PSJL,5,76) D SETTMP D:$G(PSGOEEF(109)) HILITE(2)
"RTN","PSJLMUDE",23,0)
 I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSJLMUDE",24,0)
 I $G(PSJORD),($G(PSJDUR)="") S P=$S(PSJORD["U":5,PSJORD["V":"IV",PSJORD["P":"P",1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,P)
"RTN","PSJLMUDE",25,0)
 S PSJL=$$SETSTR^VALM1("Duration: "_$G(PSJDUR),PSJL,11,25)
"RTN","PSJLMUDE",26,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_$P(PSGSDN,U,2),PSJL,54,26) D:$G(PSGOEEF(10)) HILITE(3)
"RTN","PSJLMUDE",27,0)
 I $G(PSGORD)["P" N ND0,OLDO S ND0=@(PSGOEEWF_"0)") I $P(ND0,"^",24)="R" S OLDO=$P(ND0,"^",25) I OLDO,(OLDO["U") D
"RTN","PSJLMUDE",28,0)
 . N OSTRT,OSTRTN S OSTRT=$G(@("^PS(55,"_PSGP_",5,"_+OLDO_",2)")),OSTRT=$P(OSTRT,"^",2) Q:'OSTRT  S OSTRTN=$$ENDTC^PSGMI(+OSTRT)
"RTN","PSJLMUDE",29,0)
 . S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_OSTRTN,PSJL,54,26)
"RTN","PSJLMUDE",30,0)
 D SETTMP
"RTN","PSJLMUDE",31,0)
 S PSJL=$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),PSJL=$$SETSTR^VALM1("Med Route: "_PSGMRN,PSJL,10,35) D:$G(PSGOEEF(3)) HILITE(4)
"RTN","PSJLMUDE",32,0)
 I $G(PSJORD)["P" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,PSGORD) S:PSGRNDT PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",33,0)
 I '$G(PSGRNDT),$G(PSGRDTX) D
"RTN","PSJLMUDE",34,0)
 . I $D(PSGRDTX)<10 S PSGRSDN=$$ENDTC^PSGMI(+PSGRDTX),PSJL=$$SETSTR^VALM1("REQUESTED START: "_PSGRSDN,PSJL,48,32) Q
"RTN","PSJLMUDE",35,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$P($G(PSGSDN),U,2) S PSGRSDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRSD")),PSJL=$$SETSTR^VALM1("Calc Start: "_PSGRSDN,PSJL,53,32) D
"RTN","PSJLMUDE",36,0)
 .. I PSGSD'=PSGRDTX(+PSJORD,"PSGRSD") D CNTRL^VALM10(5,53,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",37,0)
 ; Indirect reference in PSGOEEWF below refers to either ^PS(53.1 or ^PS(55,DFN,5,. Naked reference refers to full indirect reference
"RTN","PSJLMUDE",38,0)
 I $G(PSJORD)["U" N ND14 S ND14=$G(@(PSGOEEWF_"14,0)")) I ND14]"" S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^") I RNDT D
"RTN","PSJLMUDE",39,0)
 . N PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+RNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",40,0)
 D SETTMP
"RTN","PSJLMUDE",41,0)
 I PSGORD]"" S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSJLMUDE",42,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLMUDE",43,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"     ")_" Stop: "_$P(PSGFDN,U,2),PSJL,54,26) D SETTMP D:$G(PSGOEEF(25))!($G(PSGOEEF(34))) HILITE(5)
"RTN","PSJLMUDE",44,0)
 S PSJL=$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule Type: "_PSGSTN,PSJL,6,45) D:$G(PSGOEEF(7)) HILITE(6)
"RTN","PSJLMUDE",45,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$P($G(PSGFDN),U,2) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")),PSJL=$$SETSTR^VALM1("Calc Stop: "_PSGRFDN,PSJL,54,26) D
"RTN","PSJLMUDE",46,0)
 . I PSGFD'=PSGRDTX(+PSJORD,"PSGRFD") D CNTRL^VALM10(7,54,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",47,0)
 D SETTMP
"RTN","PSJLMUDE",48,0)
 S PSGSMN=$P("NO^YES",U,PSGSM+1)
"RTN","PSJLMUDE",49,0)
 S PSJL=$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule: "_PSGSCH_$G(SCHMSG),PSJL,11,68) D SETTMP D:$G(PSGOEEF(26)) HILITE(8)
"RTN","PSJLMUDE",50,0)
 S PSJL=$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"   "),PSJL=$$SETSTR^VALM1("Admin Times: "_PSGAT,PSJL,8,71) D SETTMP D:$G(PSGOEEF(39))!($G(PSGOEEF(41))) HILITE(9)
"RTN","PSJLMUDE",51,0)
 S PSJL=$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"   "),PSJL=$$SETSTR^VALM1("Provider: "_PSGPRN,PSJL,11,68) D:$G(PSGOEEF(1)) HILITE(10) D SETTMP
"RTN","PSJLMUDE",52,0)
 S PSJL=$S($D(PSGEFN(11)):$E(" *",PSGEFN(11))_" (11)",1:"   ")_" Special Instructions"_$S($P(PSGSI,"^",2)=1:"!: ",1:": ") D
"RTN","PSJLMUDE",53,0)
 .I '$D(^PS(53.45,DUZ,5,1)),$G(PSGORD) D GETSI^PSJBCMA5(PSGP,PSGORD)
"RTN","PSJLMUDE",54,0)
 .I '$P($G(^PS(53.45,DUZ,5,0)),"^",3) S PSJL=PSJL_$P($G(PSGSI),"^") D PTXT^PSJLMPRU(PSJL,"PSJUDE",1,80) Q
"RTN","PSJLMUDE",55,0)
 .S PSJL=PSJL_" (see below)" D SETTMP N I S I=0 F J=1:1 S I=$O(^PS(53.45,DUZ,5,I)) Q:'I  S PSJL="      "_^PS(53.45,DUZ,5,I,0) D SETTMP
"RTN","PSJLMUDE",56,0)
 S PSJL="" D SETTMP D:$G(PSGOEEF(8)) HILITE(11)
"RTN","PSJLMUDE",57,0)
 ; E3R 16130
"RTN","PSJLMUDE",58,0)
 I $O(^PS(53.45,PSJSYSP,2,1)) F  S PSJL="" D SETTMP Q:PSJLN>15
"RTN","PSJLMUDE",59,0)
 S PSJL=$S($D(PSGEFN(12)):$E(" *",PSGEFN(12))_" (12)",1:"   ")_" Dispense Drug",PSJL=$$SETSTR^VALM1("U/D",PSJL,54,60),PSJL=$$SETSTR^VALM1("Inactive Date",PSJL,65,16) D SETTMP,CNTRL^VALM10(PSJLN-1,1,80,IOUON,IOUOFF,0)
"RTN","PSJLMUDE",60,0)
 NEW PSJX
"RTN","PSJLMUDE",61,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSJLMUDE",62,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSJLMUDE",63,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(")
"RTN","PSJLMUDE",64,0)
 .S PSJL="      "_D_$$DDNF^PSJDIN(+ND),PSJL=$$SETSTR^VALM1($S($P(ND,"^",2):$S($P(ND,"^",2)=.5:"1/2",$P(ND,"^",2)=.25:"1/4",1:$P(ND,"^",2)),$P(ND,"^",2)=0:0,1:1),PSJL,54,63) S:PSGID PSJL=$$SETSTR^VALM1(PSGID,PSJL,65,16) D  D SETTMP
"RTN","PSJLMUDE",65,0)
 ..S PSJX=$G(PSJX)+1
"RTN","PSJLMUDE",66,0)
 ..I $G(PSGOEEF(109)) D CNTRL^VALM10(13+PSJX,7,73,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",67,0)
 I $S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,0)),1:$O(^PS(55,PSGP,5,+PSGORD,12,0))) S PSJL="Provider Comments:" D SETTMP S PSJL="" D
"RTN","PSJLMUDE",68,0)
 .F Q=0:0 S Q=$S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,Q)),1:$O(^PS(55,PSGP,5,+PSGORD,12,Q))) Q:'Q  S PSJL=$G(^(Q,0)) D SETTMP
"RTN","PSJLMUDE",69,0)
 D SETTMP S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,1,24)
"RTN","PSJLMUDE",70,0)
 S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,16,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",71,0)
 D SETTMP S PSJL="Entry By: "_PSGEBN,PSJL=$$SETSTR^VALM1("Entry Date: "_$P(PSGLIN,U,2),PSJL,51,39) D SETTMP
"RTN","PSJLMUDE",72,0)
 I $G(PSGLRN) D SETTMP S PSJL="Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2)) D SETTMP
"RTN","PSJLMUDE",73,0)
 D SETTMP S PSJL="(13)"_" Comments:"
"RTN","PSJLMUDE",74,0)
 D:'$O(^PS(53.45,PSJSYSP,1,0)) SETTMP
"RTN","PSJLMUDE",75,0)
 D SETTMP F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S PSJWPL=PSJL_$S($E(PSJL)=" ":"",1:" ")_$G(^(Q,0)),PSJL="" D DISPLAY
"RTN","PSJLMUDE",76,0)
 D SETTMP
"RTN","PSJLMUDE",77,0)
 I PSGORD["P",($P($G(^PS(53.1,+PSGORD,0)),U,9)="P"),$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSJLMUDE",78,0)
 .D SETTMP S PSJL="CPRS Order Checks:" D SETTMP
"RTN","PSJLMUDE",79,0)
 .F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,10,Q)) Q:'Q  D
"RTN","PSJLMUDE",80,0)
 ..;S PSJL="" D SETTMP S PSJL=$G(^PS(53.1,+PSGORD,10,Q,0)) D SETTMP
"RTN","PSJLMUDE",81,0)
 ..S PSJL="" D SETTMP
"RTN","PSJLMUDE",82,0)
 ..D FORMATTX($G(^PS(53.1,+PSGORD,10,Q,0)))
"RTN","PSJLMUDE",83,0)
 ..S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+PSGORD,10,Q,1)),U) D SETTMP
"RTN","PSJLMUDE",84,0)
 ..S PSJL="Overriding Reason: " F X=0:0 S X=$O(^PS(53.1,+PSGORD,10,Q,2,X)) Q:'X   D
"RTN","PSJLMUDE",85,0)
 ...S PSJL=PSJL_$G(^PS(53.1,+PSGORD,10,Q,2,X,0)) D SETTMP S PSJL="                   "
"RTN","PSJLMUDE",86,0)
ACTFLG ;
"RTN","PSJLMUDE",87,0)
 S ND4=$S(PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:$G(^PS(55,PSGP,5,+PSGORD,4)))
"RTN","PSJLMUDE",88,0)
 S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSJLMUDE",89,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSJLMUDE",90,0)
 I AT]"" D
"RTN","PSJLMUDE",91,0)
 .S PSJL="" D SETTMP
"RTN","PSJLMUDE",92,0)
 .S PSJL="ORDER "_$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSJLMUDE",93,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" S PSJL=PSJL_"  ("_$P(AT,"^",10)_")"
"RTN","PSJLMUDE",94,0)
 D SETTMP
"RTN","PSJLMUDE",95,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMUDE",96,0)
 K PSGSMN,Q,Y,Y1,Y2,PSGLRN
"RTN","PSJLMUDE",97,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S((PSGSTAT="PENDING")&($G(PSGPRIO)]""):"("_PSGPRIO_")",$G(PSGPRIO)="DONE":"("_PSGPRIO_")",1:"") I $D(PSJLMP2) S VALMBG=16 K PSJLMP2
"RTN","PSJLMUDE",98,0)
TEST ;
"RTN","PSJLMUDE",99,0)
 I $G(PSGPFLG) S VALMSG="INVALID ORDERABLE ITEM"
"RTN","PSJLMUDE",100,0)
 I $G(PSGDI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" DISPENSE DRUG"
"RTN","PSJLMUDE",101,0)
 I $G(PSGPI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" PROVIDER"
"RTN","PSJLMUDE",102,0)
 Q
"RTN","PSJLMUDE",103,0)
DISPLAY ;
"RTN","PSJLMUDE",104,0)
 S PSJL=PSJWPL D SETTMP
"RTN","PSJLMUDE",105,0)
 Q
"RTN","PSJLMUDE",106,0)
 ;
"RTN","PSJLMUDE",107,0)
SETTMP ;
"RTN","PSJLMUDE",108,0)
 S ^TMP("PSJUDE",$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1,PSJL=""
"RTN","PSJLMUDE",109,0)
 Q
"RTN","PSJLMUDE",110,0)
 ;
"RTN","PSJLMUDE",111,0)
HILITE(FLD) ; 
"RTN","PSJLMUDE",112,0)
 N COL,LIN,WID,X
"RTN","PSJLMUDE",113,0)
 S X="$T("_FLD_"^PSJLMUDE)",@("X="_X),X=$P(X,";;",2),LIN=+X,COL=$P(X,",",2),LAB=$P(X,",",3),X=$P(X,",",4),WID=(LAB+$L(@X))
"RTN","PSJLMUDE",114,0)
 I FLD=7 S LIN=+$G(PSJLN)-1 Q:LIN<13
"RTN","PSJLMUDE",115,0)
 D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",116,0)
 Q
"RTN","PSJLMUDE",117,0)
 ;
"RTN","PSJLMUDE",118,0)
FORMATTX(PSJX) ;
"RTN","PSJLMUDE",119,0)
 NEW PSJX1,Y,Y1
"RTN","PSJLMUDE",120,0)
 S PSJX1=""
"RTN","PSJLMUDE",121,0)
 F Y=1:1:$L(PSJX," ") S Y1=$P(PSJX," ",Y) D
"RTN","PSJLMUDE",122,0)
 . I ($L(PSJX1)+$L(Y1)+1)>79 S:$E(PSJX1,1,1)=" " PSJX1=$E(PSJX1,2,$L(PSJX1)) S PSJL=PSJX1,PSJX1="" D SETTMP
"RTN","PSJLMUDE",123,0)
 . S PSJX1=PSJX1_Y1_" "
"RTN","PSJLMUDE",124,0)
 I PSJX1]"" S PSJL=PSJX1 D SETTMP
"RTN","PSJLMUDE",125,0)
 K PSJX1
"RTN","PSJLMUDE",126,0)
 Q
"RTN","PSJLMUDE",127,0)
 ;
"RTN","PSJLMUDE",128,0)
1 ;;1,5,16,PSGPDN
"RTN","PSJLMUDE",129,0)
2 ;;3,5,16,PSGDO
"RTN","PSJLMUDE",130,0)
3 ;;4,58,7,PSGSDN
"RTN","PSJLMUDE",131,0)
4 ;;5,10,11,PSGMRN
"RTN","PSJLMUDE",132,0)
5 ;;6,59,6,PSGFDN
"RTN","PSJLMUDE",133,0)
6 ;;7,6,15,PSGSTN
"RTN","PSJLMUDE",134,0)
7 ;;18,5,14,PSGSMN
"RTN","PSJLMUDE",135,0)
8 ;;8,11,12,PSGSCH
"RTN","PSJLMUDE",136,0)
9 ;;9,8,13,PSGAT
"RTN","PSJLMUDE",137,0)
10 ;;10,11,10,PSGPRN
"RTN","PSJLMUDE",138,0)
11 ;;11,7,22,PSGSI
"RTN","PSJLMUDE",139,0)
ENKILL ;
"RTN","PSJLMUDE",140,0)
 K PSGAT,PSGEB,PSGEFN,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM Q
"RTN","PSJO")
0^34^B23946604^B23069149
"RTN","PSJO",1,0)
PSJO ;BIR/CML3,PR-GET AND PRINT INPATIENT ORDERS ;28 Jun 99 / 10:20 AM
"RTN","PSJO",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**31,58,110,181,267**;16 DEC 97;Build 158
"RTN","PSJO",3,0)
 ;
"RTN","PSJO",4,0)
 ; Reference to ^PSD(58.8 supported by DBIA #2283.
"RTN","PSJO",5,0)
 ; Reference to ^PSI(58.1 supported by DBIA #2284.
"RTN","PSJO",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJO",7,0)
 ;
"RTN","PSJO",8,0)
 K ^TMP("PSJON",$J),^TMP("PSJ",$J) D @$S($D(PSJEXTP):"EN^PSJH1",1:"EN^PSJO1(3)")
"RTN","PSJO",9,0)
 S PSJDEV=IO'=IO(0)!($E(IOST,1,2)'="C-"),(NP,PSGON,PSJON)=""
"RTN","PSJO",10,0)
 U IO D ENGET^PSJO3 I '$D(^TMP("PSJ",$J)) W !,SLS,SLS,$E(SLS,1,25),!!?22,"NO ORDERS FOUND FOR ",$S(PSJOL="S":"SHORT",1:"LONG")," PROFILE."
"RTN","PSJO",11,0)
 E  S (PSJC,PSJS,PSJO,PSJST)="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""  D  G:NP["^" DONE
"RTN","PSJO",12,0)
 .D:$S((PSJC["B"&'TF):0,PSJC'["A":1,1:1) TF
"RTN","PSJO",13,0)
 .F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""!(NP[U)  D ON
"RTN","PSJO",14,0)
 G:NP[U DONE I PSJDEV,$S('$D(PSJPRP):1,1:PSJPRP="P") D BOT
"RTN","PSJO",15,0)
 ;
"RTN","PSJO",16,0)
DONE ;
"RTN","PSJO",17,0)
 I $S('$D(PSJPRP):1,1:PSJPRP="P") K ^TMP("PSJ",$J)
"RTN","PSJO",18,0)
 S PSGON=PSJON K:'$D(PSGVBW) PSGODT K %,%H,%I,C,DN,DO,DRG,FQ,GIVE,HDT,I,JJ,LN2,N,ND,ND4,ND6,NF,NP,O,ON,ORIFN,ORTX,P,PF,PG,PS,PSGID,PSGOD,PSIVSC,PSIVST,PSIVTY,PSJC,PSJDEV,PSJF,PSJO,PSJOS,PSJS,PSJSCHT,PSJST,QQ,RB,RTE,SCH,SD,SLS,SM
"RTN","PSJO",19,0)
 K ST,START,STAT,SUB,TF,TYP,UDU,UPD,V,WS,X,X1,X2,Y Q
"RTN","PSJO",20,0)
 ;
"RTN","PSJO",21,0)
ON ;
"RTN","PSJO",22,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJO",23,0)
 F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO) D:$Y+6>IOSL ENNP^PSJO3 Q:NP["^"  D  ;
"RTN","PSJO",24,0)
 .S PSJON=PSJON+1 S:'PSJDEV ^TMP("PSJON",$J,PSJON)=PSJO W !,$J(PSJON,4),?5 D @$S(PSJO["V":"PIV^PSIVUTL(PSJO)",PSJO["U":"PUD",1:"PIV^PSIVUTL(PSJO)")
"RTN","PSJO",25,0)
 Q
"RTN","PSJO",26,0)
 ;
"RTN","PSJO",27,0)
PUD ; print unit dose
"RTN","PSJO",28,0)
 ; Naked reference below refers to full reference ^PS(53.1,+PSJO,0) or ^PS(55,DFN,5,+PSJO,0) using indirection.
"RTN","PSJO",29,0)
 S ND=$S($D(@(PSJF_+PSJO_",0)")):^(0),1:""),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$P($G(^(6)),"^"),DO=$S($P(DN,"^",2)=.2:$P($G(@(PSJF_+PSJO_",.2)")),"^",2),1:$G(@(PSJF_+PSJO_",.3)")))
"RTN","PSJO",30,0)
 I ("AO"[PSJC)!(PSJC="DF") D
"RTN","PSJO",31,0)
 .S V='$P(ND4,"^",UDU),V=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSJO",32,0)
 .W $S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",18)&($P(ND4,"^",19)!V):"H",$P(ND4,"^",22)&($P(ND4,"^",23)!V):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" ")
"RTN","PSJO",33,0)
 .W $S($P($G(@(PSJF_+PSJO_",.2)")),"^",4)="D":"d",1:" ")_$S(V:"->",1:"  ")
"RTN","PSJO",34,0)
 I $S(PSJC["NZ":0,1:PSJC["N") W $S($P(ND4,"^",12):"D",1:" ")
"RTN","PSJO",35,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),STAT=$S($P(ND,"^",28)]"":$P(ND,"^",28),$P(ND,"^",9)]"":$P(ND,"^",9),1:"NF")
"RTN","PSJO",36,0)
 S PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJO",37,0)
 I STAT="A",$P(ND,U,27)="R" S STAT="R"
"RTN","PSJO",38,0)
 S NF=$P(DN,"^",2),WS=$S(PSJPWD:$$WS(PSJPWD,PSGP,PSJF,PSJO),1:0)
"RTN","PSJO",39,0)
 NEW MARX,PSJRNDT
"RTN","PSJO",40,0)
 S PSJRNDT=$$LASTREN^PSJLMPRI(DFN,PSJO) S:PSJRNDT PSJRNDT=$E($$ENDTC^PSGMI(+PSJRNDT),1,5)
"RTN","PSJO",41,0)
 D DRGDISP^PSJLMUT1(PSGP,+PSJO_$S(PSJC["A":"U",PSJC["O":"U",PSJC="DF":"U",1:"P"),40,54,.MARX,0)
"RTN","PSJO",42,0)
 F X=0:0 S X=$O(MARX(X)) Q:'X  W @($S(X=1:"?9",1:"!?11")),$S($E(PSJS)="*":$P(PSJS,"^"),1:MARX(X)) D:X=1
"RTN","PSJO",43,0)
 . W ?50,$S(PSJC["NZ":"?",PSJSCHT'="z":PSJSCHT,1:"?")
"RTN","PSJO",44,0)
 . W:'$D(PSJEXTP) ?53,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(PSGID),1,5)),?60,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(SD),1,5)),?67,STAT
"RTN","PSJO",45,0)
 . W:$D(PSJEXTP) ?53,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(PSGID),1,8)),?63,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(SD),1,8)),?73,STAT
"RTN","PSJO",46,0)
 . I NF!WS!SM!PF!(PSJRNDT]"") W ?71 W:NF "NF " W:WS "WS " W:SM $E("HSM",SM,3) W:$G(PSJRNDT) PSJRNDT W:PF ?79,"*"
"RTN","PSJO",47,0)
 I ND6]"" S Y=$$ENSET^PSGSICHK(ND6) D  K ^PS(53.45,DUZ,5)
"RTN","PSJO",48,0)
 .D GETSI^PSJBCMA5(DFN,PSJO) I $G(^PS(53.45,DUZ,5)) N TXTLN S TXTLN=0 F  S TXTLN=$O(^PS(53.45,DUZ,5,TXTLN)) Q:'TXTLN  D
"RTN","PSJO",49,0)
 ..W !?11,$G(^PS(53.45,DUZ,5,TXTLN,0))
"RTN","PSJO",50,0)
 .W !?11 F X=1:1:$L(Y," ") S V=$P(Y," ",X) W:$L(V)+$X>66 !?11 W V_" "
"RTN","PSJO",51,0)
 Q
"RTN","PSJO",52,0)
 ;
"RTN","PSJO",53,0)
TF ;
"RTN","PSJO",54,0)
 NEW SLS,C S SLS="",C=PSJC,$P(SLS," -",40)=""
"RTN","PSJO",55,0)
 S LN2=$S(C="A":$$TXT(C),C["CC":$$TXT("PR"),C["CD":$$TXT("PC"),C["BD":$$TXT("NC"),C["C":$$TXT("P"),C["B":$$TXT("N"),C["NX":$$TXT("N"),C["DF":$$TXT("DF"),C["NZ":$$TXT("P"),1:$$TXT("NA"))
"RTN","PSJO",56,0)
 W:$D(^TMP("PSJ",$J,PSJC)) !,$E($E(SLS,1,(80-$L(LN2))/2)_" "_LN2_$E(SLS,1,(80-$L(LN2))/2),1,80)
"RTN","PSJO",57,0)
 S PSJF="^PS("_$S(PSJC'["C":"55,"_PSGP_",5,",1:"53.1,") S TF=$S(PSJC["C":0,1:TF)
"RTN","PSJO",58,0)
 Q
"RTN","PSJO",59,0)
 ;
"RTN","PSJO",60,0)
 ;
"RTN","PSJO",61,0)
TXT(X) ;
"RTN","PSJO",62,0)
 I $G(X)="" Q ""
"RTN","PSJO",63,0)
 I X="A" Q "A C T I V E"
"RTN","PSJO",64,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJO",65,0)
 I X="DF" Q "RECENTLY DISCONTINUED/EXPIRED (LAST "_+$G(PSJDCEXP)_" HOURS)"
"RTN","PSJO",66,0)
 I X="N" Q "N O N - V E R I F I E D"
"RTN","PSJO",67,0)
 I X="NA" Q "N O N - A C T I V E"
"RTN","PSJO",68,0)
 I X="NC" Q "N O N - V E R I F I E D  C O M P L E X"
"RTN","PSJO",69,0)
 I X="P" Q "P E N D I N G"
"RTN","PSJO",70,0)
 I X="PC" Q "P E N D I N G  C O M P L E X"
"RTN","PSJO",71,0)
 I X="PR" Q "P E N D I N G   R E N E W A L S"
"RTN","PSJO",72,0)
 Q ""
"RTN","PSJO",73,0)
 ;
"RTN","PSJO",74,0)
BOT ; print name, ssn, and dob on bottom of page
"RTN","PSJO",75,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSJO",76,0)
 W !,?2,$P(PSGP(0),"^"),?40,PSJPPID,?70,$E($P(PSJPDOB,"^",2),1,8)
"RTN","PSJO",77,0)
 Q
"RTN","PSJO",78,0)
WS(PSJPWD,PSGP,PSJF,PSJO) ; - WARD STOCK flag, input=(ward,dfn,file root,order)
"RTN","PSJO",79,0)
 ; Naked reference below refers to full reference ^PS(55,DFN,5,+PSJO,1,"B",PSWS) using indirection.
"RTN","PSJO",80,0)
 S WS=0,PSJF=PSJF_+PSJO_",1,""B"")" I $D(@PSJF) N PSWS S PSWS=0 F  S PSWS=$O(^("B",PSWS)) Q:'PSWS  S WS=$$WSCHK(PSJPWD,PSWS) Q:WS
"RTN","PSJO",81,0)
 Q WS
"RTN","PSJO",82,0)
 ;
"RTN","PSJO",83,0)
WSCHK(PSJPWD,PSWS) ; Determine if drug is ward stock item.
"RTN","PSJO",84,0)
 Q $S(PSJPWD:$S($D(^PSI(58.1,"D",PSWS,PSJPWD)):1,$D(^PSD(58.8,"D",PSWS,PSJPWD)):1,1:0),1:0)
"RTN","PSJOE0")
0^60^B25370612^B25720453
"RTN","PSJOE0",1,0)
PSJOE0 ;BIR/CML3-INPATIENT PROFILE AND ORDER ENTRY ; 4/15/10 2:45pm
"RTN","PSJOE0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**47,56,110,133,162,241,267**;16 DEC 97;Build 158
"RTN","PSJOE0",3,0)
 ;
"RTN","PSJOE0",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJOE0",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJOE0",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJOE0",7,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJOE0",8,0)
 ;
"RTN","PSJOE0",9,0)
START ; print orders
"RTN","PSJOE0",10,0)
 W:X]"" $P("^PROFILE",X,2) D ENL^PSJO3 G:PSJOL="^" DONE Q:PSJOL="N"  K PSJPR S PSGOEAV=0,PSJNARC=1 D ^PSJO I 'PSJON Q
"RTN","PSJOE0",11,0)
 ;
"RTN","PSJOE0",12,0)
ENVW ; ask user to select or view any of the orders shown
"RTN","PSJOE0",13,0)
 S (PSGONC,PSGONR,PSGONV)=0,PSGLMT=PSJON S:$D(PSJPRF) PSGPRF=1 D ENASR^PSGON K PSGPRF
"RTN","PSJOE0",14,0)
 G:X["^" DONE I X]"" S PSGOEA=""
"RTN","PSJOE0",15,0)
 K PSJDLW
"RTN","PSJOE0",16,0)
 I  F PSJOE=1:1:PSGODDD S PSGOE=PSJOE F PSJOE1=1:1:$L(PSGODDD(PSJOE),",")-1 S PSJOE2=$P(PSGODDD(PSJOE),",",PSJOE1),(PSGORD,PSJORD)=^TMP("PSJON",$J,PSJOE2) G:$D(PSJDLW) DONE D 
"RTN","PSJOE0",17,0)
 .I PSJORD=+PSJORD N PSJO,PSJO1 S PSJO=PSJORD,PSJO1=0 F  S PSJO1=$O(^PS(53.1,"ACX",PSJO,PSJO1)) Q:'PSJO1  Q:PSGOEA["^"  Q:$D(PSJDLW)  S PSJORD=PSJO1_"P" D GODO S PSJORD=""
"RTN","PSJOE0",18,0)
 .Q:PSJORD=""  Q:PSGOEA["^"
"RTN","PSJOE0",19,0)
 .D GODO Q:PSGOEA["^"
"RTN","PSJOE0",20,0)
 Q
"RTN","PSJOE0",21,0)
 ;
"RTN","PSJOE0",22,0)
LMNEW(PSGP,PSJPROT) ;Entry point for new order entry from listman.
"RTN","PSJOE0",23,0)
 ; PSGP = DFN
"RTN","PSJOE0",24,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJOE0",25,0)
 ;
"RTN","PSJOE0",26,0)
 D CKNEW N PSJUDPRF S PSJNEWOE=1
"RTN","PSJOE0",27,0)
 S PSGPTS=PSJPTS,PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU,PSGOEDMR=$O(^PS(51.2,"B","ORAL",0)),PSGOEPR=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",2),1:0),PSJORQF=0,PSJOEPF=""
"RTN","PSJOE0",28,0)
 I PSGOEPR>0,$D(^VA(200,+PSGOEPR,"PS")) S PSGOEPR=$S('$P(^("PS"),"^",4):PSGOEPR,($P(^("PS"),"^",4)<DT):0,1:PSGOEPR)
"RTN","PSJOE0",29,0)
 S:'PSGOEPR PSGOEPR=PSJPTSP
"RTN","PSJOE0",30,0)
 ; line below fixes bug in line above - infinite loop when selecting New Order in Unit Dose OE for Outpatient.
"RTN","PSJOE0",31,0)
 F PSJOE=0:0 Q:PSJORQF!('(PSJPCAF&(PSJPROT'=2))&(PSJPROT'>1))  D KILL^PSJBCMA5(+$G(PSJSYSP)) D:PSJPCAF&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1 D ENIN^PSIVORE
"RTN","PSJOE0",32,0)
 Q
"RTN","PSJOE0",33,0)
 ;
"RTN","PSJOE0",34,0)
DONE ;
"RTN","PSJOE0",35,0)
 K PSG,PSGDL,PSGDLS,PSGDO,PSGDRG,PSGDRGN,PSGFD,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGOES,PSGOPR,PSGORD,PSGOROE1,PSGPR,PSGPRN,PSGS0XT,PSGS0Y,PSGSCH,PSGSD,PSGSI,PSGSM,PSGST,PSGSTN,PSGUD,PSGX,PSJDLW,PSJLM,PSJNARC,PSIVAC
"RTN","PSJOE0",36,0)
 K P,PSGEFN,PSGOEEF
"RTN","PSJOE0",37,0)
 Q
"RTN","PSJOE0",38,0)
 ;
"RTN","PSJOE0",39,0)
CKNEW ;
"RTN","PSJOE0",40,0)
 K CF,CHK,OD,PSGLMT,PSGODDD,PSGOEA,PSGON,PSGONC,PSGONR,PSGONV,PSGORD,PSJCOM,PSJOE1,PSJOE2 Q:$D(PSJPRF)
"RTN","PSJOE0",41,0)
 I $P(PSJPDD,"^",3) W !!?2,"Patient is shown as deceased.  You may not enter orders for this patient." D CONT Q
"RTN","PSJOE0",42,0)
 I 'PSJPCAF W !!,"(NOTE: You cannot enter Unit Dose orders for this patient.)" D CONT
"RTN","PSJOE0",43,0)
 Q
"RTN","PSJOE0",44,0)
 ;
"RTN","PSJOE0",45,0)
CONT ;
"RTN","PSJOE0",46,0)
 K DIR S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSJOE0",47,0)
 Q
"RTN","PSJOE0",48,0)
 ;
"RTN","PSJOE0",49,0)
GODO ;Display selected order.
"RTN","PSJOE0",50,0)
 S PSIVAC="C" I $S(PSJORD["V":1,PSJORD["P":$P($G(^PS(53.1,+PSJORD,0)),"^",4)="F",1:0) D @$S($D(PSJPRP):"ENINP^PSIVOPT(DFN,PSJORD)",1:"ENIN^PSIVOPT") G GODO1
"RTN","PSJOE0",51,0)
 I '$D(PSJPRP),(PSJORD["P"),($P($G(^PS(53.1,+PSJORD,0)),U,4)="I") D ASKTYP Q:$D(DIRUT)  I Y="I" D ENIN^PSIVOPT G GODO1
"RTN","PSJOE0",52,0)
 S PSGORD=PSJORD D EN2^PSGVW,^PSGOE1:'$D(PSJPRF)
"RTN","PSJOE0",53,0)
GODO1 ;
"RTN","PSJOE0",54,0)
 I $D(PSJPRP),'PSJPR K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT)!$D(DTOUT) PSJDLW=1 Q:$D(PSJDLW)  W:$Y @IOF
"RTN","PSJOE0",55,0)
 Q
"RTN","PSJOE0",56,0)
 ;
"RTN","PSJOE0",57,0)
ASKTYP ; Ask if completing as IV or UD.
"RTN","PSJOE0",58,0)
 Q
"RTN","PSJOE0",59,0)
 W !! D PIV^PSIVUTL(+PSJORD_"P")
"RTN","PSJOE0",60,0)
 I $G(PSJPDD) S DIR(0)="E" D ^DIR S Y="I" Q
"RTN","PSJOE0",61,0)
 W ! K DIR S DIR(0)="SOA^U:Unit Dose;I:IV Medication",DIR("A")="Do you wish to complete this as an IV or Unit Dose order (I/U)? ",DIR("?")="^D PENDIU^PSJO3" D ^DIR
"RTN","PSJOE0",62,0)
 Q
"RTN","PSJOE0",63,0)
 ;
"RTN","PSJOE0",64,0)
OLDCOM(DFN,PSJORD) ;
"RTN","PSJOE0",65,0)
 Q:$$COMPLEX^PSJOE(DFN,PSJORD)
"RTN","PSJOE0",66,0)
 N DURFLG S DURFLG=$S($G(PSJORD)["P":$G(^PS(53.1,+PSJORD,2.5)),$G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,2.5)),1:$G(^PS(55,DFN,5,+PSJORD,2.5))) I $P(DURFLG,"^",2)]"" D
"RTN","PSJOE0",67,0)
 . D CLEAR^VALM1 W !!!!!?21," * WARNING * "
"RTN","PSJOE0",68,0)
 . W !!!?5,"The following order contains a Requested Duration"
"RTN","PSJOE0",69,0)
 . W !?12,"and may be part of a complex dose!"
"RTN","PSJOE0",70,0)
 . W !!," Review the entire profile to determine appropriate action(s).",!!!!!!! D PAUSE^VALM1
"RTN","PSJOE0",71,0)
 Q
"RTN","PSJOE0",72,0)
AM ;
"RTN","PSJOE0",73,0)
 W !!?2,"Enter a 'Y' (or press the RETURN key) to enter new INPATIENT orders for this",!,"patient.  Enter an 'N' (or an '^') if there are no new orders for this patient."
"RTN","PSJOE0",74,0)
 W:'PSJPCAF !!?2,"PLEASE NOTE: The patient selected is NOT shown as currently admitted.",!,"Therefore, you cannot enter Unit Dose orders for this patient.  (You can enter",!,"IV orders.)" Q
"RTN","PSJOEA2")
0^63^B28764670^B28381449
"RTN","PSJOEA2",1,0)
PSJOEA2 ;BIR/MLM-INPATIENT ORDER ENTRY ; 5/11/09 7:50am
"RTN","PSJOEA2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**127,133,200,267**;16 DEC 97;Build 158
"RTN","PSJOEA2",3,0)
 ;
"RTN","PSJOEA2",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA2",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789.
"RTN","PSJOEA2",6,0)
 ;
"RTN","PSJOEA2",7,0)
CHK ;Check to be sure all the orders in the complex order series are completed, continued.
"RTN","PSJOEA2",8,0)
 I 'PSJCOMV,'$G(COMQUIT) N PSJO S PSJO=0 F  S PSJO=$O(^TMP("PSJCOM",$J,PSJO)) Q:'PSJO  S PSGORD=+PSJO_"P",PSGND=$G(^PS(53.1,+PSJO,0)) D
"RTN","PSJOEA2",9,0)
 .S PSGP=$P(PSGND,"^",15)
"RTN","PSJOEA2",10,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="A",($P(PSGND,U,24)'="R") D ^PSGOT D  Q
"RTN","PSJOEA2",11,0)
 ..M ^PS(55,PSGP,5,+PSGORD,4)=^PS(53.1,PSJO,4)
"RTN","PSJOEA2",12,0)
 ..M ^PS(55,PSGP,5,+PSGORD,15)=^PS(53.1,PSJO,15)
"RTN","PSJOEA2",13,0)
 ..N PSGND2P5 S PSGND2P5=$G(^PS(53.1,+PSJO,2.5)),DUR=$P(PSGND2P5,"^",2) I $G(DUR)]"" N DA,DR,DIE S DIE="^PS(55,"_PSGP_",5,",DA(1)=PSGP,DA=+PSGORD,DR="126////"_$G(DUR) D ^DIE
"RTN","PSJOEA2",14,0)
 ..D ACTLOG^PSJOEA(PSJO,PSGP,PSGORD)
"RTN","PSJOEA2",15,0)
 ..S VND4=$G(^PS(55,PSGP,5,+PSGORD,4))
"RTN","PSJOEA2",16,0)
 ..I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSJOEA2",17,0)
 ..S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT
"RTN","PSJOEA2",18,0)
 ..; Set PV and NV flag according to PSJSYSU  (PSJ*5*200)
"RTN","PSJOEA2",19,0)
 ..S $P(VND4,"^",+PSJSYSU=1+9)=1 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9) S ^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSJOEA2",20,0)
 ..I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSJOEA2",21,0)
 ..I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSJOEA2",22,0)
 ..I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSJOEA2",23,0)
 ..S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSJOEA2",24,0)
 ..S PSJCOM=$P($G(^PS(55,PSGP,5,+PSGORD,.2)),"^",8) I PSJCOM]"" K ^PS(53.1,"ACX",PSJCOM,PSJO) ;S $P(^PS(55,PSGP,5,+PSGORD,4),"^",9)=1
"RTN","PSJOEA2",25,0)
 ..D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSJOEA2",26,0)
 ..D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U") L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSJOEA2",27,0)
 ..S PSJPREX=1 D CMPLX2^PSJCOM1(PSGP,PSJORD,PSGORD) K PSJPREX
"RTN","PSJOEA2",28,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="A" D GT531^PSIVORFA(PSGP,PSJO_"P") D  Q
"RTN","PSJOEA2",29,0)
 ..S ON55="" I $P(PSGND,"^",24)="R" S ON55=$P(PSGND,"^",25) D
"RTN","PSJOEA2",30,0)
 ...N PND0,PSGORDR S PND0=^PS(53.1,+PSJO,0),PSGORDR=$P(PND0,U,25)
"RTN","PSJOEA2",31,0)
 ...Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA2",32,0)
 ...N OEORD,OOEORD,FILE55,FILE55N0,PNDP2 S PNDP2=^PS(53.1,+PSJO,.2),FILE55="^PS(55,"_DFN_",""IV"",",FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSJOEA2",33,0)
 ...S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,+PSJO_"P",+$$LASTREN^PSJLMPRI(DFN,+PSJO_"P"))
"RTN","PSJOEA2",34,0)
 ...S PSGORDP=PSJO,DIE="^PS(53.1,",DA=+PSJO,DR="28////A;104////@" W "." D ^DIE
"RTN","PSJOEA2",35,0)
 ...Q:'$G(OEORD)  K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=110_"////"_+OEORD
"RTN","PSJOEA2",36,0)
 ...S:$P(PNDP2,U,8) DR=DR_";150////"_$P(PNDP2,U,8) D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSJOEA2",37,0)
 ...D EN1^PSJHL2(DFN,"SC",PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA2",38,0)
 ..I 'ON55 D SETNEW^PSIVORFB
"RTN","PSJOEA2",39,0)
 ..S (P("NEWON"),ON)=ON55,PSGP=$P(PSGND,U,15)
"RTN","PSJOEA2",40,0)
 ..S VND4=$G(^TMP("PSJCOM",$J,+PSJO,4)) D
"RTN","PSJOEA2",41,0)
 ...N PSJRN,PSJRNDT,PSJRPH,PSJRPHD,PSJPVFL,PSJNVFL,DR,DIE,DA
"RTN","PSJOEA2",42,0)
 ...S (PSJPVFL,PSJNVFL)=""
"RTN","PSJOEA2",43,0)
 ...S PSJRN=$P(VND4,U,1),PSJRNDT=$P(VND4,U,2),PSJRPH=$P(VND4,U,3),PSJRPHD=$P(VND4,U,4),PSJPVFL=$P(VND4,U,16) S:PSJRN]"" PSJNVFL=1
"RTN","PSJOEA2",44,0)
 ...S DR="16////"_PSJRN_";17////"_PSJRNDT_";140////"_PSJRPH_";141////"_PSJRPHD_";142////"_PSJPVFL_";143////"_PSJNVFL
"RTN","PSJOEA2",45,0)
 ...S DA(1)=PSGP,DA=+ON55,DIE="^PS(55,"_PSGP_",""IV""," D ^DIE
"RTN","PSJOEA2",46,0)
 ..D:P("RES")="R" RUPDATE^PSIVOREN(PSGP,ON,P(2))
"RTN","PSJOEA2",47,0)
 ..I +PSJSYSU=3 K OD D ^PSIVORE1 ;LABEL STUFF
"RTN","PSJOEA2",48,0)
 ..I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D  Q
"RTN","PSJOEA2",49,0)
 ...NEW DIC,DA,X,Y,XX D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJOEA2",50,0)
 ...S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJOEA2",51,0)
 ...S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJOEA2",52,0)
 ...S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJOEA2",53,0)
 ...K DO D FILE^DICN K DO
"RTN","PSJOEA2",54,0)
 ...N DIK,DA,PSIVACT S DIK="^PS(55,"_DFN_",""IV"",",DA=+ON,PSIVACT="" S:$G(DFN) DA(1)=DFN D IX^DIK K DIK,DA
"RTN","PSJOEA2",55,0)
 ...S PSJCOM=$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",8) I PSJCOM]"" K ^PS(53.1,"ACX",PSJCOM,PSJO)
"RTN","PSJOEA2",56,0)
 ...D EN1^PSJHL2(DFN,"SC",ON)
"RTN","PSJOEA2",57,0)
 ...D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON) L -^PS(55,DFN,"IV",+ON) I $G(ON55) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSJOEA2",58,0)
 ..L -^PS(55,DFN,"IV",+ON) I $G(ON55) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSJOEA2",59,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)="U" S PSGP=$P(PSGND,U,15) D UD^PSJOEA
"RTN","PSJOEA2",60,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)="U" S PSGP=$P(PSGND,U,15) D UD^PSJOEA
"RTN","PSJOEA2",61,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)'="U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",17)="A" S DFN=$S($G(PSGP)]"":PSGP,1:$P(PSGND,U,15)) D IV^PSJOEA
"RTN","PSJOEA2",62,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)'="U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",17)="A" S DFN=$S($G(PSGP)]"":PSGP,1:$P(PSGND,U,15)) D IV^PSJOEA
"RTN","PSJOEA2",63,0)
 K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J),PSJOWALL
"RTN","PSJOEA2",64,0)
 Q
"RTN","PSJP")
0^27^B21519406^B21335743
"RTN","PSJP",1,0)
PSJP ;BIR/CML3-INPATIENT LOOK-UP ; 15 Apr 98 / 9:05 AM
"RTN","PSJP",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**10,53,60,181,273,267**;16 DEC 97;Build 158
"RTN","PSJP",3,0)
 ;
"RTN","PSJP",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJP",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSJP",6,0)
 ; Reference to ^%ZIS is supported by DBIA 10086
"RTN","PSJP",7,0)
 ; Reference to ^DICN is supported by DBIA 10009
"RTN","PSJP",8,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSJP",9,0)
 ; Reference to ^VADPT is supported by DBIA 10061
"RTN","PSJP",10,0)
 ;
"RTN","PSJP",11,0)
ENDPT ; get any patient
"RTN","PSJP",12,0)
 K DIC,PSGP,Y W !!,"Select "_$S($D(PSGDICA):PSGDICA_" ",1:"")_"PATIENT: " R X:DTIME S:'$T X="^" W:'$T $C(7) I "^"[X S (Y,PSGP)=-1 S QFLG=1 G DONE
"RTN","PSJP",13,0)
 D EN^PSJDPT
"RTN","PSJP",14,0)
 I Y'>0 G ENDPT
"RTN","PSJP",15,0)
 K DIC
"RTN","PSJP",16,0)
 ;
"RTN","PSJP",17,0)
CHK ;
"RTN","PSJP",18,0)
 ;Clean out arrays use in order checks
"RTN","PSJP",19,0)
 K PSJEXCPT,PSJOCER
"RTN","PSJP",20,0)
 S (DFN,PSGP)=+Y,VA200=1 D INP^VADPT
"RTN","PSJP",21,0)
 I VAIN(4) S PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",4),1:""),PSJPDD="" G CNV
"RTN","PSJP",22,0)
 S PSJPCAF="",VAIP("D")="L" D IN5^VADPT I 'VAIP(13,1) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." D ENCONT G:%'=1 ENDPT S PSJPDD=""
"RTN","PSJP",23,0)
 ;*273 - Recognize patient death not from discharge
"RTN","PSJP",24,0)
 D DEM^VADPT
"RTN","PSJP",25,0)
 S PSGID=$S($G(VADM(6))]"":+VADM(6),1:+VAIP(3)),X=+VAIP(4)=12!(+VAIP(4)=38)!($G(VADM(6))),PSGOD=$$ENDTC^PSGMI(PSGID)
"RTN","PSJP",26,0)
 I $S(X:1,1:VAIP(13,1)) W $C(7),!!?3,"PATIENT IS FOUND TO BE ",$P("DISCHARGED^DECEASED","^",X+1)," AS OF ",PSGOD,"." S PSJH=$S(X:2,1:3),PSJPDD=PSGID_"^"_PSGOD S:X PSJPDD=PSJPDD_"^1" D ENCONT G:%'=1 ENDPT
"RTN","PSJP",27,0)
 S PSJPAD=VAIP(13,1),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD=""
"RTN","PSJP",28,0)
 ;
"RTN","PSJP",29,0)
CNV ;
"RTN","PSJP",30,0)
 I $G(DFN) I '$$AA^PSJDPT(DFN) S Y=-1 G ENDPT
"RTN","PSJP",31,0)
 I $D(PSJEXTP) W ! K DIR S DIR(0)="DO",DIR("A")="Date to start searching from (optional)",DIR("?")="Enter a date to start searching from, or <RETURN> for all orders" D ^DIR S PSJHDATE=Y K DIR
"RTN","PSJP",32,0)
 D DEM^VADPT,PID^VADPT,HTWT^PSJAC(DFN)
"RTN","PSJP",33,0)
 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSJP",34,0)
 F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSJP",35,0)
 ;
"RTN","PSJP",36,0)
WP ; ward parameters
"RTN","PSJP",37,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD) S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJP",38,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16))
"RTN","PSJP",39,0)
 S PSJDCEXP=$$RECDCEXP()
"RTN","PSJP",40,0)
 I PSJSYSL D
"RTN","PSJP",41,0)
 .S:X X='$P(PSJSYSP0,"^",10) S IOP=$S($P(PSJSYSP0,"^",13)]"":$P(PSJSYSP0,"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSJP",42,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D HOME^%ZIS
"RTN","PSJP",43,0)
 ;
"RTN","PSJP",44,0)
DONE ;
"RTN","PSJP",45,0)
 K DA,DIC,NB,ND,NS,PSGID,PSGOD,VA200,VAIP,VAMT,X,Y(0),Y(0,0),QFLG Q
"RTN","PSJP",46,0)
 ;
"RTN","PSJP",47,0)
ENCONT ;
"RTN","PSJP",48,0)
 I $D(PSGH) S %=1 Q
"RTN","PSJP",49,0)
 F FQ=0:0 W !!,"Do you wish to continue with this patient" S %=0 D YN^DICN Q:%  W:%Y'?1."?" $C(7) W "  (A 'YES' or 'NO' response is required.)" D:%Y?1."?" @("CH"_PSJH)
"RTN","PSJP",50,0)
 S:%'=1 Y=-1 Q
"RTN","PSJP",51,0)
 ;
"RTN","PSJP",52,0)
CH1 ;
"RTN","PSJP",53,0)
 W !!?2,"The patient selected has never been admitted to this medical facility.  You",!,"will be able to enter IV orders for this patient but NOT Unit Dose orders." Q
"RTN","PSJP",54,0)
CH2 ;
"RTN","PSJP",55,0)
 W !!?2,"This patient is shown as deceased.  You will not be able to enter orders for",!,"this patient." Q
"RTN","PSJP",56,0)
CH3 ;
"RTN","PSJP",57,0)
 W !!?2,"This patient is shown to be currently discharged.  You will be able to enter",!,"IV orders for this patient but NOT Unit Dose orders." Q
"RTN","PSJP",58,0)
 Q
"RTN","PSJP",59,0)
RECDCEXP() ;
"RTN","PSJP",60,0)
 ;Determent the Hours to display Recently DC/Expired orders on the short profile
"RTN","PSJP",61,0)
 ;Returning P1^P2
"RTN","PSJP",62,0)
 ;P1 = Number of hours defined in 59.6 or 59.7.  Set to 24 if no value set in either file.
"RTN","PSJP",63,0)
 ;P2 = Date.time from Now - P1 hours
"RTN","PSJP",64,0)
 ;
"RTN","PSJP",65,0)
 NEW PSJDCEXP,PSJWD,PSJWD1,PSJSYS,X,%
"RTN","PSJP",66,0)
 S PSJWD1=$S(+$G(PSJPWD):PSJPWD,+$G(VAIN(4)):+VAIN(4),1:0)
"RTN","PSJP",67,0)
 S:PSJWD1 X=$O(^PS(59.6,"B",PSJWD1,0))
"RTN","PSJP",68,0)
 S:+$G(X) PSJWD=$P($G(^PS(59.6,X,0)),U,33)
"RTN","PSJP",69,0)
 S PSJSYS=+$P($G(^PS(59.7,1,26)),U,8)
"RTN","PSJP",70,0)
 S PSJDCEXP=$S($G(PSJWD):PSJWD,PSJSYS:PSJSYS,1:24)
"RTN","PSJP",71,0)
 D NOW^%DTC
"RTN","PSJP",72,0)
 S X=$$FMADD^XLFDT(%,0,-PSJDCEXP,0,0)
"RTN","PSJP",73,0)
 Q PSJDCEXP_U_X
"RTN","PSJPDV1")
0^76^B16075972^B15709363
"RTN","PSJPDV1",1,0)
PSJPDV1 ;BIR/KKA-LIST PATIENTS ON SPECIFIC DRUGS (CONT.) ;15 May 98 / 9:28 AM
"RTN","PSJPDV1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**3,33,58,267**;16 DEC 97;Build 158
"RTN","PSJPDV1",3,0)
 ;
"RTN","PSJPDV1",4,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJPDV1",5,0)
 ;
"RTN","PSJPDV1",6,0)
 S PG=1,(PREVNM,TMPNM)="",(PREVWD,TMPWD)="",WFLG=0
"RTN","PSJPDV1",7,0)
REC ;write patient and order information
"RTN","PSJPDV1",8,0)
 D HEADING G:$D(QFLG) DONE
"RTN","PSJPDV1",9,0)
 I '$D(^TMP("PSJ",$J)) W !!,"NO DATA FOUND" G DONE
"RTN","PSJPDV1",10,0)
 S FST="" F  S FST=$O(^TMP("PSJ",$J,FST)) Q:FST=""!($D(QFLG))  S SND="" F  S SND=$O(^TMP("PSJ",$J,FST,SND)) Q:SND=""!($D(QFLG))  S ORD="" F  S ORD=$O(^TMP("PSJ",$J,FST,SND,ORD)) Q:'ORD!($D(QFLG))  D
"RTN","PSJPDV1",11,0)
 .; naked ref below refers to line above
"RTN","PSJPDV1",12,0)
 .S ND=^(ORD),PER=$S(PSJSRT="P":FST,1:SND),STD=$S(PSJSRT="P":SND,1:FST)
"RTN","PSJPDV1",13,0)
 .S WFLG=0,(NM,TMPNM)=$P(PER,";"),(WARD,TMPWD)=$P(ND,"^",2) I PSJSRT="P" S:(TMPNM=PREVNM)&(TMPWD=PREVWD) NM="",WFLG=1 I TMPNM'=PREVNM S PREVNM=NM W !
"RTN","PSJPDV1",14,0)
 .S:TMPWD'=PREVWD PREVWD=WARD S (PSGP,IEN)=$P(PER,";",2),PSJJORD=+ORD D:ORD["V" IVREC Q:$D(QFLG)  D:ORD'["V" UDREC Q:$D(QFLG)
"RTN","PSJPDV1",15,0)
 ;
"RTN","PSJPDV1",16,0)
DONE K ADCNT,CONT,FST,JJ,LCNT,LN,ND3,ND3FLG,ND4,ON,OPI,ORD,P,PER,PG,PREVNM,PEVWD,PRIMD,PSJAD,PSJSOL,RSTFLG,SI,SND,SOLCNT,SSN,TMPNM,TMPWD,WCNT,WFLG,WRD,WARD,RMBD,PSJ,DRGI,DRGN,DRGT
"RTN","PSJPDV1",17,0)
 Q
"RTN","PSJPDV1",18,0)
 ;
"RTN","PSJPDV1",19,0)
UDREC ;write Unit Dose record
"RTN","PSJPDV1",20,0)
 N X,PSJ K ND3FLG
"RTN","PSJPDV1",21,0)
 D DRGDISP^PSJLMUT1(PSGP,PSJJORD_"U",30,30,.PSJ,0)
"RTN","PSJPDV1",22,0)
 S RSTFLG=2,SSN=$P(ND,U),WARD=$P(ND,U,2),RMBD=$P(ND,U,3)
"RTN","PSJPDV1",23,0)
 D:$Y+5>IOSL HEADING Q:$D(QFLG)
"RTN","PSJPDV1",24,0)
 W !!,NM,?32,PSJ(1),?68,$E($$ENDTC^PSGMI(STD),1,5),?75,$E($$ENDTC^PSGMI($P(ND,U,6)),1,5),! W:'WFLG SSN
"RTN","PSJPDV1",25,0)
 N X F X=1:0 S X=$O(PSJ(X)) Q:'X  W ?32,PSJ(X) D THEREST I RSTFLG>3&($X>32) W !
"RTN","PSJPDV1",26,0)
 N I S WCNT=1,SI=$P($G(^PS(55,PSGP,5,PSJJORD,6)),"^") I $TR(SI," ")]"" W:$X>31 ! F I=1:1:$L(SI," ") S WRD=$P(SI," ",I) Q:(I>1)&$P(SI," ",I-1,180)=""  S WCNT=WCNT+1 D
"RTN","PSJPDV1",27,0)
 .I $X+$L(WRD)>79 W ! I 'WFLG&('$D(ND3FLG)) W $P(ND,"^",3) S ND3FLG=1
"RTN","PSJPDV1",28,0)
 .W ?31," ",WRD
"RTN","PSJPDV1",29,0)
 I 'WFLG&('$D(ND3FLG)) W !,$P(ND,"^",3)
"RTN","PSJPDV1",30,0)
 K ND3FLG
"RTN","PSJPDV1",31,0)
 Q
"RTN","PSJPDV1",32,0)
IVREC ;write IV record
"RTN","PSJPDV1",33,0)
 D:$Y+5>IOSL HEADING Q:$D(QFLG)
"RTN","PSJPDV1",34,0)
 N DRG,P,PSG,ON55,PSJ
"RTN","PSJPDV1",35,0)
 S RSTFLG=1,SSN=$P(ND,U),WARD=$P(ND,U,2),RMBD=$P(ND,U,3)
"RTN","PSJPDV1",36,0)
 S DFN=PSGP,ON=PSJJORD D GT55^PSIVORFB
"RTN","PSJPDV1",37,0)
 W !!,NM
"RTN","PSJPDV1",38,0)
 N X F X=0:0 S X=$O(DRG("AD",X)) Q:'X  D NAME^PSIVUTL(DRG("AD",X),30,.PSJ,1) F JJ=0:0 S JJ=$O(PSJ(JJ)) Q:'JJ  W ?32,PSJ(JJ) D THEREST I RSTFLG>3&($X>32) W !
"RTN","PSJPDV1",39,0)
 N X,PSJ F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D NAME^PSIVUTL(DRG("SOL",X),30,.PSJ,0) N JJ F JJ=0:0 S JJ=$O(PSJ(JJ)) Q:'JJ  W:JJ=1 ?33,"in " W ?36,PSJ(JJ) D THEREST I RSTFLG>3&($X>31) W !
"RTN","PSJPDV1",40,0)
 W ?32,$P(P("MR"),U,2)_" "_P(9)_" "_P(8) D THEREST
"RTN","PSJPDV1",41,0)
 S OPI=$P(P("OPI"),"^") I OPI]"" W:$X>31 ! F X=1:1:$L(OPI," ") S Y=$P(OPI," ",X) D THEREST W:$X+$L(Y)>80 ! W ?32,Y," "
"RTN","PSJPDV1",42,0)
 F  Q:RSTFLG>3  D THEREST
"RTN","PSJPDV1",43,0)
 Q
"RTN","PSJPDV1",44,0)
THEREST ;
"RTN","PSJPDV1",45,0)
 I RSTFLG=1 W ?68,$E($$ENDTC^PSGMI(STD),1,5),?75,$E($$ENDTC^PSGMI(P(3)),1,5),! W:'WFLG SSN
"RTN","PSJPDV1",46,0)
 I RSTFLG=2 W ! W:'WFLG WARD
"RTN","PSJPDV1",47,0)
 I RSTFLG=3 S ND3FLG=1 W ! W:'WFLG RMBD
"RTN","PSJPDV1",48,0)
 S RSTFLG=RSTFLG+1
"RTN","PSJPDV1",49,0)
 Q
"RTN","PSJPDV1",50,0)
HEADING I $E(IOST)'="P" W !,"Press RETURN to continue ""^"" to exit: " R CONT:DTIME S:CONT["^" QFLG=1 Q:$D(QFLG)
"RTN","PSJPDV1",51,0)
 W:$Y @IOF
"RTN","PSJPDV1",52,0)
 S NM=TMPNM,WFLG=0
"RTN","PSJPDV1",53,0)
 W !,$E($$ENDTC^PSGMI(DT),1,8),?70,"PAGE: ",PG S PG=PG+1
"RTN","PSJPDV1",54,0)
 S LN="LISTING OF PATIENTS WITH ORDERS CONTAINING "_$S(PSJSL="V":"VA CLASS(ES) OF DRUGS",PSJSL="O":"ORDERABLE ITEM(S)",PSJSL="D":"DISPENSE DRUG(S)")_":"
"RTN","PSJPDV1",55,0)
 W !! D LINE W !
"RTN","PSJPDV1",56,0)
 S LN="" F  S LN=$O(PSJSNM(LN)) Q:LN=""  W ! D LINE
"RTN","PSJPDV1",57,0)
 S LN="FROM "_$$ENDTC^PSGMI(PSJREPS)_" TO "_$$ENDTC^PSGMI(PSJREPF) W !! D LINE W !!
"RTN","PSJPDV1",58,0)
 F X=1:1:80 W "-"
"RTN","PSJPDV1",59,0)
 W !?68,"Start",?75,"Stop",!,"Patient",?32,"Order",?68,"Date",?75,"Date",!
"RTN","PSJPDV1",60,0)
 F X=1:1:80 W "-"
"RTN","PSJPDV1",61,0)
 Q
"RTN","PSJPDV1",62,0)
LINE ;    
"RTN","PSJPDV1",63,0)
 W ?(80-$L(LN))/2,LN Q
"RTN","PSJRXI")
0^24^B20674326^B15938376
"RTN","PSJRXI",1,0)
PSJRXI ;IHS/DSD/JCM/RLW-LOGS PHARMACY INTERVENTIONS ; 15 May 98 / 9:28 AM
"RTN","PSJRXI",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**3,181,254,267**;16 DEC 97;Build 158
"RTN","PSJRXI",3,0)
 ;
"RTN","PSJRXI",4,0)
 ; Reference to ^APSPQA(32.4 is supported by DBIA #2179
"RTN","PSJRXI",5,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192
"RTN","PSJRXI",6,0)
 ;
"RTN","PSJRXI",7,0)
 ; This routine is used to create entries in the APSP INTERVENTION file.
"RTN","PSJRXI",8,0)
 ;---------------------------------------------------------------
"RTN","PSJRXI",9,0)
START ;   
"RTN","PSJRXI",10,0)
 N SAVEX,SAVEY S SAVEX=X,SAVEY=Y
"RTN","PSJRXI",11,0)
 D INIT
"RTN","PSJRXI",12,0)
 D DIC G:PSJRXI("QFLG") END
"RTN","PSJRXI",13,0)
 D EDIT
"RTN","PSJRXI",14,0)
 S:'$D(PSJNEW("PROVIDER")) PSJNEW("PROVIDER")=$P(^APSPQA(32.4,PSJRXI("DA"),0),"^",3)
"RTN","PSJRXI",15,0)
END D EOJ
"RTN","PSJRXI",16,0)
 Q
"RTN","PSJRXI",17,0)
 ;---------------------------------------------------------------
"RTN","PSJRXI",18,0)
INIT ;
"RTN","PSJRXI",19,0)
 W !!,"Now creating Pharmacy Intervention",!
"RTN","PSJRXI",20,0)
 I $G(PSJDD) W "For ",$P($G(^PSDRUG(PSJDD,0)),"^"),!
"RTN","PSJRXI",21,0)
 K PSJRXI
"RTN","PSJRXI",22,0)
 S PSJRXI("QFLG")=0
"RTN","PSJRXI",23,0)
 Q
"RTN","PSJRXI",24,0)
 ;
"RTN","PSJRXI",25,0)
DIC ;
"RTN","PSJRXI",26,0)
 N DIC,DR,DA,X,DD,DO,Y,PSJY,PSJRXIEN
"RTN","PSJRXI",27,0)
 I $G(PSJRXREQ)="" S PSJRXREQ="ALLERGY"
"RTN","PSJRXI",28,0)
 D FIND^DIC(9009032.3,"","@;.01","",PSJRXREQ,1,"B","","","PSJRXIEN")
"RTN","PSJRXI",29,0)
 S PSJRXIEN=$G(PSJRXIEN("DILIST",2,1))
"RTN","PSJRXI",30,0)
 I 'PSJRXIEN S PSJY=-1 G DICX
"RTN","PSJRXI",31,0)
 S DIC="^APSPQA(32.4,",DLAYGO=9009032.4,DIC(0)="L",X=DT
"RTN","PSJRXI",32,0)
 S DIC("DR")=".02////"_PSGP_";.04////"_DUZ_";.05////"_PSJDD_";.06///PHARMACY"
"RTN","PSJRXI",33,0)
 S DIC("DR")=DIC("DR")_";.07////"_$G(PSJRXIEN)_";.14////1"_";.16////"_$S($G(PSJSITE)]"":PSJSITE,1:"")
"RTN","PSJRXI",34,0)
 D FILE^DICN K DIC,DR,DA
"RTN","PSJRXI",35,0)
 S PSJY=Y
"RTN","PSJRXI",36,0)
 I Y>0 S PSJRXI("DA")=+Y
"RTN","PSJRXI",37,0)
 E  S PSJRXI("QFLG")=1 G DICX
"RTN","PSJRXI",38,0)
 D DIE
"RTN","PSJRXI",39,0)
DICX ;
"RTN","PSJRXI",40,0)
 I $G(PSJY)=-1 D
"RTN","PSJRXI",41,0)
 . W !!,"Unable to log an intervention for ",$G(PSJRXREQ)
"RTN","PSJRXI",42,0)
 . D PAUSE^PSJLMUT1
"RTN","PSJRXI",43,0)
 K X,Y
"RTN","PSJRXI",44,0)
 Q
"RTN","PSJRXI",45,0)
DIE ;
"RTN","PSJRXI",46,0)
 K DIE,DIC,DR,DA N PSJRECOM,PSJOVRS,PSJINTOI,PSJTMPDT
"RTN","PSJRXI",47,0)
 S DIE="^APSPQA(32.4,",DA=PSJRXI("DA"),DR=$S($G(PSJRXI("EDIT"))]"":".03:1600",$G(PSJAADPT):".03;",1:".03;.08")
"RTN","PSJRXI",48,0)
 L +^APSPQA(32.4,PSJRXI("DA")):$S($G(^DD("DILOCKTM")):+$G(^DD("DILOCKTM")),1:3) E  W !,"Sorry, someone else is editing this intervention!" Q
"RTN","PSJRXI",49,0)
 D ^DIE K DIE,DIC,DR,X,Y,DA
"RTN","PSJRXI",50,0)
 I $G(PSJAADPT) N PSJQREC S PSJQREC=0 F  Q:$G(PSJQREC)  D
"RTN","PSJRXI",51,0)
 .N DIR S DIR(0)="S^1:UNABLE TO ASSESS;2:OTHER",DIR("A")="RECOMMENDATION",DIR("?",1)="  Enter a recommendation for NO ALLERGY ASSESSMENT.",DIR("?")="    Enter 'OTHER' to add free text."
"RTN","PSJRXI",52,0)
 .D ^DIR S PSJQREC=$S($G(Y)=1:10,$G(Y)=2:9,1:0) I PSJQREC D
"RTN","PSJRXI",53,0)
 ..S DIE="^APSPQA(32.4,",DA=PSJRXI("DA"),DR=".08////"_PSJQREC D ^DIE
"RTN","PSJRXI",54,0)
 .I $G(Y)="^" S PSJQREC=-1
"RTN","PSJRXI",55,0)
 .K DIE,DIC,DR,X,Y,DA
"RTN","PSJRXI",56,0)
 I $G(PSJDD) S PSJINTOI=+$G(^PSDRUG(+PSJDD,2))
"RTN","PSJRXI",57,0)
 S PSJTMPDT=+$G(^TMP("PSJINTER",$J,+$G(PSJRXI("DA"))-1))
"RTN","PSJRXI",58,0)
 I $G(PSGDT) I $G(PSJRXREQ)="ALLERGY"!($G(PSJRXREQ)["CRITICAL DRUG") S ^TMP("PSJINTER",$J,PSJRXI("DA"))=$S($G(PSJTMPDT):PSJTMPDT,1:$G(PSGDT))_"^"_$S($G(PSJINTOI):PSJINTOI,1:"")_"^"_$$DATE2^PSJUTL2($$DATE^PSJUTL2())
"RTN","PSJRXI",59,0)
 S PSJRECOM=$P($G(^APSPQA(32.4,PSJRXI("DA"),0)),"^",8) D
"RTN","PSJRXI",60,0)
 .S PSJOVRS="",X=PSJRECOM,Y="",DIC="^APSPQA(32.5,",DIC(0)="BSX" D ^DIC I $P(Y,"^",2)]"" S PSJOVRS=$P(Y,"^",2)
"RTN","PSJRXI",61,0)
 .I PSJRECOM=9 D
"RTN","PSJRXI",62,0)
 ..S DIE="^APSPQA(32.4,",DA=PSJRXI("DA"),DR="1200;" D ^DIE K DIE,DIC,DR,X,Y,DA
"RTN","PSJRXI",63,0)
 L -^APSPQA(32.4,PSJRXI("DA"))
"RTN","PSJRXI",64,0)
 W $C(7),!!,"See 'Pharmacy Intervention Menu' if you want to delete this",!,"intervention or for more options.",! D PAUSE^PSJLMUT1
"RTN","PSJRXI",65,0)
 Q
"RTN","PSJRXI",66,0)
EDIT ;
"RTN","PSJRXI",67,0)
 K DIR W ! S DIR(0)="Y",DIR("A")="Would you like to edit this intervention",DIR("B")="N" D ^DIR K DIR I $D(DIRUT)!'Y G EDITX
"RTN","PSJRXI",68,0)
 S PSJRXI("EDIT")=1 D DIE
"RTN","PSJRXI",69,0)
 G EDIT
"RTN","PSJRXI",70,0)
EDITX K X,Y
"RTN","PSJRXI",71,0)
 Q
"RTN","PSJRXI",72,0)
 ;
"RTN","PSJRXI",73,0)
EOJ ;
"RTN","PSJRXI",74,0)
 K PSJRXI S X=SAVEX,Y=SAVEY
"RTN","PSJRXI",75,0)
 Q
"RTN","PSJRXI",76,0)
 ;
"RTN","PSJRXI",77,0)
EN1(PSJORDER) ; Entry Point if have internal rx #
"RTN","PSJRXI",78,0)
 I PSJX']"" W !,$C(7),"No prescription data" Q
"RTN","PSJRXI",79,0)
 S PSJORDER=$S((PSJORDER["N")!(PSJORDER["P"):"^PS(53.1,"_+PSJORDER,PSJORDER["V":"^PS(55,"_DFN_",""IV"","_+PSJORDER,1:"^PS(55,"_DFN_",5,"_+PSJORDER)_","
"RTN","PSJRXI",80,0)
 N PSJDFN,PSJNEW,PSJDRUG,PSJY
"RTN","PSJRXI",81,0)
 I $G(^PS(53.1,PSJX,0))']"" W !,$C(7),"No prescription data" G EN1X
"RTN","PSJRXI",82,0)
 S PSJRXI("IRXN")=PSJORDER
"RTN","PSJRXI",83,0)
 K PSJY S PSJY=@(PSJORDER_",0)")
"RTN","PSJRXI",84,0)
 S PSJDFN=$P(PSJY,"^",15),PSJNEW("PROVIDER")=$P(PSJY,"^",2)
"RTN","PSJRXI",85,0)
 S PSJDRUG=0,PSJDRUG=$O(^PS(53.1,PSJRXI("IRXN"),1,PSJDRUG)) Q:'PSJDRUG  S PSJDRUG("IEN")=$G(@(PSJORDER_","_PSJDRUG),"^")
"RTN","PSJRXI",86,0)
 D START
"RTN","PSJRXI",87,0)
EN1X Q
"RTN","PSJUTL")
0^33^B135053726^B65890056
"RTN","PSJUTL",1,0)
PSJUTL ;BIR/MLM-MISC. INPATIENT UTILITIES ; 10/7/08 1:22pm
"RTN","PSJUTL",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**9,47,58,80,110,136,157,177,134,179,267**;16 DEC 97;Build 158
"RTN","PSJUTL",3,0)
 ;
"RTN","PSJUTL",4,0)
 ; Reference to ^DIC(42 is supported by DBIA 10039.
"RTN","PSJUTL",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJUTL",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJUTL",7,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJUTL",8,0)
 ; Reference to ^DIC1 is supported by DBIA 10007.
"RTN","PSJUTL",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJUTL",10,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJUTL",11,0)
 ;
"RTN","PSJUTL",12,0)
ENDL ; device look-up
"RTN","PSJUTL",13,0)
 N DA,DIC,DIE,DIX,DO,DR
"RTN","PSJUTL",14,0)
 S DIC="^%ZIS(1,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",15,0)
 S X=Y(0,0)
"RTN","PSJUTL",16,0)
 Q
"RTN","PSJUTL",17,0)
 ;
"RTN","PSJUTL",18,0)
ENDH(X) ; device help
"RTN","PSJUTL",19,0)
 N D,XQH,DA,DIC,DIE,DO,DR,DZ
"RTN","PSJUTL",20,0)
 S DIC="^%ZIS(1,",DIC(0)="EIM" D DO^DIC1,^DIC
"RTN","PSJUTL",21,0)
 Q
"RTN","PSJUTL",22,0)
 ;
"RTN","PSJUTL",23,0)
READ ; hold screen
"RTN","PSJUTL",24,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSJUTL",25,0)
 W ! I $D(IOSL),$Y<(IOSL-4) G READ
"RTN","PSJUTL",26,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSJUTL",27,0)
 Q
"RTN","PSJUTL",28,0)
 ;
"RTN","PSJUTL",29,0)
ENOISC(PSJOI,USAGE)          ;Set DIC("S") so that only Orderable Items with at 
"RTN","PSJUTL",30,0)
 ;least 1 active dispense drug for the specified usage.
"RTN","PSJUTL",31,0)
 ;Input:  PSJOI IEN of Orderable Item selected
"RTN","PSJUTL",32,0)
 ;        USAGE - Type of drugs (UD,IV,etc) to be selected
"RTN","PSJUTL",33,0)
 ;Output: 1-At least one dispense drug found
"RTN","PSJUTL",34,0)
 ;        0-None found
"RTN","PSJUTL",35,0)
 N FOUND,PSJ
"RTN","PSJUTL",36,0)
 S PSJ=$P($G(^PS(50.7,+PSJOI,0)),U,4),FOUND=$S('PSJ:1,PSJ>DT:1,1:0)
"RTN","PSJUTL",37,0)
 I FOUND S FOUND=0 F PSJ=0:0 S PSJ=$O(^PSDRUG("ASP",PSJOI,PSJ)) Q:FOUND!'PSJ  I $P($G(^PSDRUG(PSJ,2)),U,3)[USAGE,'$G(^("I"))!($G(^("I"))'<DT) S FOUND=1
"RTN","PSJUTL",38,0)
 Q FOUND
"RTN","PSJUTL",39,0)
 ;
"RTN","PSJUTL",40,0)
AADR ; display allergies and adverse reactions
"RTN","PSJUTL",41,0)
 D ATS^PSJMUTL(60,50,1) N A,B
"RTN","PSJUTL",42,0)
 I (PSGALG=0)&(PSGADR=0) W !!,"No allergies or ADRs on file."
"RTN","PSJUTL",43,0)
 I PSGALG'=0 W !!,"Allergies: " S B="PSGALG" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",44,0)
 I PSGADR'=0 W !,"      ADR: " S B="PSGADR" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",45,0)
 D READ K PSGALG,PSGADR Q
"RTN","PSJUTL",46,0)
 ;
"RTN","PSJUTL",47,0)
ENALU ; application look-up
"RTN","PSJUTL",48,0)
 N PSJ S PSJ=DA(1) N DA,DIC,DIE,DIX,DO,DR S DIC="^PS(50.35,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",49,0)
 S X=$P(Y(0),"^",2) K:$S(X="":1,1:$D(^PS(50.3,PSJ,1,"B",X))) X
"RTN","PSJUTL",50,0)
 Q
"RTN","PSJUTL",51,0)
 ;
"RTN","PSJUTL",52,0)
ENAQ ; application query
"RTN","PSJUTL",53,0)
 S X=DZ N D,DA,DIC,DIE,DO,DR,DZ,XQH S DIC="^PS(50.35,",DIC(0)="EIMQ" D DO^DIC1,^DIC
"RTN","PSJUTL",54,0)
 Q
"RTN","PSJUTL",55,0)
 ;
"RTN","PSJUTL",56,0)
ENPCL(PSJTYP,PSGP,PSJORD) ; Copy Provider Comments -> Special Instructions.
"RTN","PSJUTL",57,0)
 Q:'$G(PSJORD) ""
"RTN","PSJUTL",58,0)
 Q:'$D(^PS(53.1,+$G(PSJORD),12,1,0)) ""
"RTN","PSJUTL",59,0)
 ; Count number of lines minus blank trailing lines
"RTN","PSJUTL",60,0)
 N LN,LNCNT S LNCNT=0,LN=9999 F  S LN=$O(^PS(53.1,+$G(PSJORD),12,LN),-1) Q:'LN  D
"RTN","PSJUTL",61,0)
 .I 'LNCNT,($G(^PS(53.1,+$G(PSJORD),12,LN,0))="") Q
"RTN","PSJUTL",62,0)
 .S LNCNT=LNCNT+1
"RTN","PSJUTL",63,0)
 I 'LNCNT Q ""
"RTN","PSJUTL",64,0)
 K ^PS(53.45,+$G(PSJSYSP),5),^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSJUTL",65,0)
 N DIR,X,Y,PSJSAVY S (X,Y)="" F  S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  S Y=$G(^PS(53.1,+$G(PSJORD),12,X)) S:($G(PSJTYP)'="V") Y=$$ENSET^PSGSICHK(Y) S ^PS(53.45,+$G(PSJSYSP),5,X,0)=Y
"RTN","PSJUTL",66,0)
 W !,"PROVIDER COMMENTS: "
"RTN","PSJUTL",67,0)
 ;Display Provider Comments Prior to Asking the Copy Provider Comments Question;BHW;PSJ*5*136
"RTN","PSJUTL",68,0)
 N PSJTMP S PSJTMP=0
"RTN","PSJUTL",69,0)
 F  S PSJTMP=$O(^PS(53.1,+$G(PSJORD),12,PSJTMP)) Q:'PSJTMP  W !,^PS(53.1,+$G(PSJORD),12,PSJTMP,0)
"RTN","PSJUTL",70,0)
 S PSGSI=Y W ! S DIR(0)="S^Y:Yes (copy);N:No (don't copy);!:Copy and flag for display in a BCMA Message Box;E:Copy and Edit;"
"RTN","PSJUTL",71,0)
 S DIR("A")="Copy the Provider Comments into "_$$ENFIELD(PSJTYP)_" (Yes/No/!/E)",DIR("??")="^D ENPCHLP1^PSJUTL(PSJTYP)" D ^DIR S PSJSAVY=Y
"RTN","PSJUTL",72,0)
 S PSGSI=$S(PSJSAVY="Y":$P(PSGSI,"^"),PSJSAVY="!":$P(PSGSI,"^")_"^1",PSJSAVY="E":$P(PSGSI,"^"),1:"")
"RTN","PSJUTL",73,0)
 I PSJSAVY="Y"!(PSJSAVY="E")!(PSJSAVY="!") D
"RTN","PSJUTL",74,0)
 .I ($G(PSJTYP)="V") N OPILN S OPILN=$O(^PS(53.1,+$G(PSJORD),12," "),-1) N TXT,OPIMSG,PSJTMPTX,PSJOVRMX S OPIMSG="Instructions too long. See Order View or BCMA for full text." D
"RTN","PSJUTL",75,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.1,+PSJORD,12,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJUTL",76,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(53.1,+PSJORD,12,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.1,+PSJORD,12,TMPLIN,0))
"RTN","PSJUTL",77,0)
 ..S PSGSI=$S(PSJTMPTX]"":PSJTMPTX,1:OPIMSG) I $G(PSJOVRMX),(PSJSAVY'="E") D OPIWARN^PSJBCMA5(1)
"RTN","PSJUTL",78,0)
 .S PSGSI=$S(PSJSAVY="!":$P($$PUT5345(PSGORD),"^")_"^1",1:$P($$PUT5345(PSGORD),"^"))
"RTN","PSJUTL",79,0)
 I PSJSAVY="E"  K ^PS(53.45,+$G(PSJSYSP),5),^PS(53.45,+$G(PSJSYSP),6) D
"RTN","PSJUTL",80,0)
 .N PRVCLN,X S PRVCLN=$O(^PS(53.1,+$G(PSJORD),12,""),-1)
"RTN","PSJUTL",81,0)
 .S:($G(PSJTYP)["V") ^PS(53.45,+$G(PSJSYSP),6,0)="^53.1136^"_+$G(PRVCLN)_"^"_+$G(PRVCLN)_"^"_1
"RTN","PSJUTL",82,0)
 .S:($G(PSJTYP)'["V") ^PS(53.45,+$G(PSJSYSP),5,0)="^53.1135^"_+$G(PRVCLN)_"^"_+$G(PRVCLN)_"^"_1
"RTN","PSJUTL",83,0)
 .S X=0 F  S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  S Y=$G(^PS(53.1,+$G(PSJORD),12,X,0)) S:($G(PSJTYP)'="V") Y=$$ENSET^PSGSICHK(Y) S ^PS(53.45,+$G(PSJSYSP),$S($G(PSJTYP)="V":6,1:5),X,0)=Y
"RTN","PSJUTL",84,0)
 .D:PSJTYP="V" EDITOPI^PSJBCMA5(PSGP,PSJORD) D:PSJTYP'="V" EDITSI^PSJBCMA5(PSGP,PSJORD)
"RTN","PSJUTL",85,0)
 I PSJSAVY="E" S PSGSI=$$ENBCMA(PSJTYP)
"RTN","PSJUTL",86,0)
 Q PSGSI
"RTN","PSJUTL",87,0)
 ;
"RTN","PSJUTL",88,0)
ENPC(PSJTYP,PSJSYSP,LEN,TEXT) ; Copy Provider Comments -> Special Instructions.
"RTN","PSJUTL",89,0)
 S PSGSI=$$ENPCL(PSJTYP,$G(PSGP),$G(PSGORD))
"RTN","PSJUTL",90,0)
 Q PSGSI
"RTN","PSJUTL",91,0)
 ;
"RTN","PSJUTL",92,0)
REDISP ; Redisplay Provider Comments and allow entry of Spec. Instructions.
"RTN","PSJUTL",93,0)
 D CLEAR^VALM1 F X=0:0 S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  W ^(X,0),!
"RTN","PSJUTL",94,0)
 W !! S PSGSI=""
"RTN","PSJUTL",95,0)
 D:PSJTYP'="V" 8^PSGOE81
"RTN","PSJUTL",96,0)
 I PSJTYP="V" D 64^PSIVEDT1 S PSGSI=P("OPI")
"RTN","PSJUTL",97,0)
 Q
"RTN","PSJUTL",98,0)
 ;
"RTN","PSJUTL",99,0)
ENPCHLP1(Y) ; Display help messages for Provider Comment copy.
"RTN","PSJUTL",100,0)
 W !,"Enter ""YES"" to copy Provider Comments into the ",$$ENFIELD(Y)," field",!,"or ""NO"" to bypass",!,"or ""!"" to copy the Provider Comments into the ",$$ENFIELD(PSJTYP)," field",!,"and flag them for display in a BCMA Message Box"
"RTN","PSJUTL",101,0)
 W !,"or type ""E"" to copy the Provider Comments into the ",$$ENFIELD(PSJTYP)," field and open a word processing window for editing."
"RTN","PSJUTL",102,0)
 Q
"RTN","PSJUTL",103,0)
ENPCHLP2(Y,X) ;
"RTN","PSJUTL",104,0)
 W !,"The Provider Comments entered for this order are longer than the space available",!,"in the ",$$ENFIELD(Y)," field.",!!,"Enter ""YES"" to copy the first ",X-3," characters into the ",$$ENFIELD(Y),!,"field, or ""NO"" to continue.",!!
"RTN","PSJUTL",105,0)
 Q
"RTN","PSJUTL",106,0)
ENBCMA(PSJTYP)  ;
"RTN","PSJUTL",107,0)
 N DIR,X,Y
"RTN","PSJUTL",108,0)
 I $G(PSJTYP)="V" Q:'$L($G(^PS(53.45,+$G(PSJSYSP),6,0))) ""
"RTN","PSJUTL",109,0)
 I $G(PSJTYP)="V" Q:($G(^PS(53.45,+$G(PSJSYSP),6,0))<0) ""
"RTN","PSJUTL",110,0)
 I $G(PSJTYP)="U" Q:'$L($G(^PS(53.45,+$G(PSJSYSP),5,0))) ""
"RTN","PSJUTL",111,0)
 W !!,"Would you like to flag the ",$$ENFIELD(PSJTYP)," field for display in a BCMA",!,"Message box?"
"RTN","PSJUTL",112,0)
 W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Flag the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",113,0)
 K PSJCOMSI I $G(PSJCOM),$G(PSJORD)'["P" N TEXT S TEXT=$S(PSJTYP="U":$G(PSGSI),1:$G(P("OPI"))) S PSJCOMSI=$$COMSI(PSJCOM,TEXT)
"RTN","PSJUTL",114,0)
 Q:Y="Y" $S($G(PSJTYP)="U":$P(PSGSI,"^")_"^1",1:$P(P("OPI"),"^")_"^1")
"RTN","PSJUTL",115,0)
 Q $S(PSJTYP="U":PSGSI,1:P("OPI"))
"RTN","PSJUTL",116,0)
ENFIELD(Y) ;
"RTN","PSJUTL",117,0)
 Q $S(Y="V":"Other Print Info",1:"Special Instructions")
"RTN","PSJUTL",118,0)
 ;
"RTN","PSJUTL",119,0)
COMSI(PARENT,INSTR) ;
"RTN","PSJUTL",120,0)
 N DIR,X,Y
"RTN","PSJUTL",121,0)
 W !!!!?15,"** WARNING **",!?5,"This order is part of a complex order."
"RTN","PSJUTL",122,0)
 W !!,"Would you like to copy the ",$$ENFIELD(PSJTYP)
"RTN","PSJUTL",123,0)
 W !,"to the other orders in the complex order?"
"RTN","PSJUTL",124,0)
 S DIR(0)="S^Y:Yes;N:No",DIR("A")="     Copy the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",125,0)
 Q:Y="Y" 1
"RTN","PSJUTL",126,0)
 Q 0
"RTN","PSJUTL",127,0)
 ;
"RTN","PSJUTL",128,0)
ENORL(X) ; Return patient's location as variable ptr.
"RTN","PSJUTL",129,0)
 Q $S(+$G(^DIC(42,+X,44)):+$G(^(44))_";SC(",$D(^DIC(42,+X,0)):+X_";DIC(42,",1:"")
"RTN","PSJUTL",130,0)
 ;
"RTN","PSJUTL",131,0)
ENMARD() ; validate MAR SELECTION DEFAULT string in WARD PARMS file.
"RTN","PSJUTL",132,0)
 N PSJANS,PSJX1,PSJX2,RANGE,Q
"RTN","PSJUTL",133,0)
 S RANGE="1:6" F PSJX1=1:1:6 S RANGE(PSJX1)=""
"RTN","PSJUTL",134,0)
 S:$E(X)="-" X=+RANGE_X S:$E($L(X))="-" X=X_$P(RANGE,":",2)
"RTN","PSJUTL",135,0)
 S PSJANS="" F Q=1:1:$L(X,",") S PSJX1=$P(X,",",Q) D FS Q:'$D(PSJANS)
"RTN","PSJUTL",136,0)
 Q:'$G(PSJANS) 0
"RTN","PSJUTL",137,0)
 S PSJANS=$E(PSJANS,1,$L(PSJANS)-1) F Q=1:1:$L(PSJANS,",") D  Q:'$D(PSJANS)
"RTN","PSJUTL",138,0)
 .I $P(PSJANS,",",Q)=1,$L(PSJANS,",")>1 W !!,"All Medications (1) may not be selected in combination with other types." K PSJANS Q
"RTN","PSJUTL",139,0)
 .W ?47,$P(PSJANS,",",Q)," - ",$P($T(@$P(PSJANS,",",Q)),";;",2),!
"RTN","PSJUTL",140,0)
 S:$G(PSJANS) X=PSJANS Q $G(PSJANS)
"RTN","PSJUTL",141,0)
 ;
"RTN","PSJUTL",142,0)
FS ;
"RTN","PSJUTL",143,0)
 I $S(PSJX1?1.N1"-"1.N:0,PSJX1'?1.N:1,'$D(RANGE(PSJX1)):1,1:","_PSJANS[PSJX1) K PSJANS Q
"RTN","PSJUTL",144,0)
 I PSJX1'["-" S PSJANS=PSJANS_PSJX1_"," Q
"RTN","PSJUTL",145,0)
 S PSJX2=+PSJX1,PSJANS=PSJANS_PSJX2_","
"RTN","PSJUTL",146,0)
 F  S PSJX2=$O(RANGE(PSJX2)) K:$S(X="":1,","_PSJANS[PSJX2:1,1:PSJX2>$P(PSJX1,"-",2)) PSJANS Q:'$D(PSJANS)  S PSJANS=PSJANS_PSJX2_"," Q:PSJX2=$P(PSJX1,"-",2)
"RTN","PSJUTL",147,0)
 Q
"RTN","PSJUTL",148,0)
 ;
"RTN","PSJUTL",149,0)
ENMARDH ;Help text for MAR default answer.
"RTN","PSJUTL",150,0)
 W !!?2,"Enter the number corresponding to the type of orders to be included on MARs",!,"printed for this ward. Multiple types (except 1) may be selected using ""-""",!,"or "","" as delimiters.",!!,"Choose from: ",!
"RTN","PSJUTL",151,0)
 N X F X=1:1:6 W !?13,X," - ",$P($T(@X),";;",2)
"RTN","PSJUTL",152,0)
 W !
"RTN","PSJUTL",153,0)
 Q
"RTN","PSJUTL",154,0)
1 ;;All Medications
"RTN","PSJUTL",155,0)
2 ;;Non-IV Medications only
"RTN","PSJUTL",156,0)
3 ;;IV Piggybacks
"RTN","PSJUTL",157,0)
4 ;;LVPs
"RTN","PSJUTL",158,0)
5 ;;TPNs
"RTN","PSJUTL",159,0)
6 ;;Chemotherapy Medications (IV)
"RTN","PSJUTL",160,0)
 ;
"RTN","PSJUTL",161,0)
EFD ;The following EFD Tags are used to Calculate the Expected First Dose for backdoor
"RTN","PSJUTL",162,0)
 ;orders.  The call to $$ENQ^PSJORP2 is used to actually perform the calculation.
"RTN","PSJUTL",163,0)
 ;The program $$ENQ^PSJORP2 requires the variable INFO to equal the following:
"RTN","PSJUTL",164,0)
 ;BHW;PSJ*5*136
"RTN","PSJUTL",165,0)
 ; INFO (piece 1) = START DATE/TIME      ;PSGNESD (NEW ORDER)
"RTN","PSJUTL",166,0)
 ; INFO (piece 2) = STOP DATE/TIME       ;PSGNEFD (NEW ORDER)
"RTN","PSJUTL",167,0)
 ; INFO (piece 3) = SCHEDULE             ;PSGSCH  (NEW ORDER)
"RTN","PSJUTL",168,0)
 ; INFO (piece 4) = SCHEDULE TYPE        ;PSGST   (NEW ORDER)
"RTN","PSJUTL",169,0)
 ; INFO (piece 5) = ORDERABLE ITEM       ;PSGDRG  (NEW ORDER)
"RTN","PSJUTL",170,0)
 ; INFO (piece 6) = ADMIN TIMES          ;PSGS0Y  (NEW ORDER)
"RTN","PSJUTL",171,0)
 ; 
"RTN","PSJUTL",172,0)
EFDNEW ;Call Here if NEW or RENEWED Order
"RTN","PSJUTL",173,0)
 N INFO
"RTN","PSJUTL",174,0)
 S INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",175,0)
 D EFDDISP
"RTN","PSJUTL",176,0)
 QUIT
"RTN","PSJUTL",177,0)
EFDACT ;Call here if Editing Fields for an ACTIVE order
"RTN","PSJUTL",178,0)
 ; Field 10 = Start Date
"RTN","PSJUTL",179,0)
 ; Field 34 = Stop Date
"RTN","PSJUTL",180,0)
 ; Field 41 = Admin Times
"RTN","PSJUTL",181,0)
 N INFO,KEY,ORDER,LAST
"RTN","PSJUTL",182,0)
 ;Loop Fields to be edited, in order, and determine when to Display expected first dose message
"RTN","PSJUTL",183,0)
 F KEY=1:1 S ORDER=$P(PSGOEER,";",KEY) Q:'$L(ORDER)  I "10^34^41"[$P(ORDER,U,1) S ORDER(KEY)=$P(ORDER,U,1)
"RTN","PSJUTL",184,0)
 ;If there are no entries in ORDER, then were Not Editing Start/Stop or Admin Times
"RTN","PSJUTL",185,0)
 S LAST=$O(ORDER(99),-1) Q:'LAST
"RTN","PSJUTL",186,0)
 ;BHW;PSJ*5*179;Remove "Display Once" logic.
"RTN","PSJUTL",187,0)
 ;S LAST=ORDER(LAST)
"RTN","PSJUTL",188,0)
 ;I LAST'=PSGF2 Q
"RTN","PSJUTL",189,0)
 S INFO=($G(PSGSD))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",190,0)
 S PSGEFDMG="Next Dose Due"
"RTN","PSJUTL",191,0)
 D EFDDISP
"RTN","PSJUTL",192,0)
 QUIT
"RTN","PSJUTL",193,0)
EFDNV ;Call here if Editing Fields for a NON-VERIFIED order
"RTN","PSJUTL",194,0)
 ; Field 10 = Start Date
"RTN","PSJUTL",195,0)
 ; Field 25 = Stop Date
"RTN","PSJUTL",196,0)
 ; Field 39 = Admin Times
"RTN","PSJUTL",197,0)
 N INFO,KEY,ORDER,LAST
"RTN","PSJUTL",198,0)
 ;Check if called during finish process
"RTN","PSJUTL",199,0)
 I '$D(PSGOEER) D  D EFDDISP Q
"RTN","PSJUTL",200,0)
 . S INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",201,0)
 . Q
"RTN","PSJUTL",202,0)
 ;Loop Fields to be edited, in order, and determine when to Display expected first dose message
"RTN","PSJUTL",203,0)
 F KEY=1:1 S ORDER=$P(PSGOEER,";",KEY) Q:'$L(ORDER)  I "10^25^39"[$P(ORDER,U,1) S ORDER(KEY)=$P(ORDER,U,1)
"RTN","PSJUTL",204,0)
 ;If there are no entries in ORDER, then were Not Editing Start/Stop or Admin Times
"RTN","PSJUTL",205,0)
 S LAST=$O(ORDER(99),-1) Q:'LAST
"RTN","PSJUTL",206,0)
 ;Only display EFD once, so Quit if this call is not for the Last field in the Edit
"RTN","PSJUTL",207,0)
 S LAST=ORDER(LAST)
"RTN","PSJUTL",208,0)
 I LAST'=PSGF2 Q
"RTN","PSJUTL",209,0)
 S INFO=($G(PSGSD))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",210,0)
 D EFDDISP
"RTN","PSJUTL",211,0)
 QUIT
"RTN","PSJUTL",212,0)
EFDIV(PSGZZND) ;Set variables for EFD on IV orders.
"RTN","PSJUTL",213,0)
 I $G(PSGZZND)="" D
"RTN","PSJUTL",214,0)
 .N X,ZZND,LYN,PSGS0XT,PSGS0Y,PSGOES S PSGOES=1 S X=P(9) D EN^PSGS0 S:$G(ZZND)'="" PSGZZND=ZZND
"RTN","PSJUTL",215,0)
 S PSGNESD=P(2),PSGNEFD=P(3),PSGSCH=P(9),PSGST=$P($G(PSGZZND),"^",5),PSGDRG=$P($G(P("PD")),"^"),PSGS0Y=P(11)
"RTN","PSJUTL",216,0)
 ;BHW - PSJ*5*177 Add call to check stop date.  If it's in the past, Display Message
"RTN","PSJUTL",217,0)
 D CHKSTOP
"RTN","PSJUTL",218,0)
 D EFDNEW
"RTN","PSJUTL",219,0)
 W !
"RTN","PSJUTL",220,0)
 Q
"RTN","PSJUTL",221,0)
EFDDISP ;Display Expected First Dose
"RTN","PSJUTL",222,0)
 N Y,Z
"RTN","PSJUTL",223,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")!($G(PSGST)="O")
"RTN","PSJUTL",224,0)
 Q:$G(PSGSCH)["ON CALL"!($G(PSGSCH)["ON-CALL")!($G(PSGSCH)["ONCALL")
"RTN","PSJUTL",225,0)
 Q:$G(PSGSCH)["PRN"
"RTN","PSJUTL",226,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSJUTL",227,0)
 S Y=$$ENQ^PSJORP2(PSGP,INFO)
"RTN","PSJUTL",228,0)
 I 'Y S Y="Unable to Calculate"
"RTN","PSJUTL",229,0)
 X ^DD("DD")
"RTN","PSJUTL",230,0)
 ;BHW;PSJ*5*179;Add Variable Message. "Next Dose Due".  Default to "Expected First Dose"
"RTN","PSJUTL",231,0)
 I '$D(PSGEFDMG) S PSGEFDMG="Expected First Dose"
"RTN","PSJUTL",232,0)
 W !,PSGEFDMG,": ",Y H 3
"RTN","PSJUTL",233,0)
 K PSGEFDMG
"RTN","PSJUTL",234,0)
 Q
"RTN","PSJUTL",235,0)
CHKSTOP ;BHW - PSJ*5*177 Warn user if the Stop Date is < now.
"RTN","PSJUTL",236,0)
 I '+$G(P(3)) Q
"RTN","PSJUTL",237,0)
 N PSNOW,%,%H,%I,X D NOW^%DTC S PSNOW=%
"RTN","PSJUTL",238,0)
 I +P(3)<PSNOW D  Q
"RTN","PSJUTL",239,0)
 . W !,$C(7),"The Stop Date/Time is in the Past!!!  This order will",!,"automatically EXPIRE upon Verification!!",!
"RTN","PSJUTL",240,0)
 . Q
"RTN","PSJUTL",241,0)
 Q
"RTN","PSJUTL",242,0)
 ;
"RTN","PSJUTL",243,0)
PUT5345(PSGORD) ; Get text from provider comments, place into temp storage
"RTN","PSJUTL",244,0)
 Q:'$D(^PS(53.1,+PSGORD,12)) ""
"RTN","PSJUTL",245,0)
 N PSJTMPTX,PSJOVRMX,TMPLIN,SIMSG
"RTN","PSJUTL",246,0)
 N LN,TXT,LNCNT S TXT="",LN=0 F LNCNT=0:1 S LN=$O(^PS(53.1,+PSGORD,12,LN)) Q:'LN  D
"RTN","PSJUTL",247,0)
 .S TXT=$G(^PS(53.1,+PSGORD,12,LN,0)) S ^PS(53.45,+PSJSYSP,$S($G(PSJTYP)="U":5,$G(PSJTYP)="V":6,1:5),LN,0)=TXT
"RTN","PSJUTL",248,0)
 I $G(LNCNT) N PSJFIREF S PSJFIREF="^PS(53.45,"_+PSJSYSP_","_$S($G(PSJTYP)="U":5,$G(PSJTYP)="V":6,1:5)_"," D ENSI(PSJFIREF)
"RTN","PSJUTL",249,0)
 I $G(LNCNT) S ^PS(53.45,+PSJSYSP,$S(($G(PSJTYP)="V"):6,1:5),0)="^^"_LNCNT_"^"_LNCNT
"RTN","PSJUTL",250,0)
 N DIE,DA
"RTN","PSJUTL",251,0)
 S SIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJUTL",252,0)
 S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.45,+PSJSYSP,$S($G(PSJTYP)="V":6,1:5),TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJUTL",253,0)
 .S:($L(PSJTMPTX)+$L($G(^PS(53.45,+PSJSYSP,$S($G(PSJTYP)="V":6,1:5),TMPLIN,0))))>$S($G(PSJTYP)["V":60,1:180) PSJOVRMX=1
"RTN","PSJUTL",254,0)
 .Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.45,+PSJSYSP,$S($G(PSJTYP)="V":6,1:5),TMPLIN,0))
"RTN","PSJUTL",255,0)
 S TXT=$S(PSJOVRMX:SIMSG,1:PSJTMPTX)
"RTN","PSJUTL",256,0)
 Q TXT
"RTN","PSJUTL",257,0)
 ;
"RTN","PSJUTL",258,0)
ENSI(PSJSIFIL) ; Expand comments using MEDICATIONS INSTRUCTIONS file (#51)
"RTN","PSJUTL",259,0)
 N X,PSJTMPFI,PSJTMPLI,DONE,PSJNWTXT,TOLIN,II,PSJSITXT,FULL,OLD,I S PSJTMPFI=PSJSIFIL_"1)" Q:'$D(@PSJTMPFI)
"RTN","PSJUTL",260,0)
 K ^TMP("PSGSIL",$J)
"RTN","PSJUTL",261,0)
 F I=1:1 Q:$G(DONE)  S PSJTMPFI=PSJSIFIL_I_",0)" S DONE=$D(@PSJTMPFI) S DONE=$S(DONE:0,1:1) D
"RTN","PSJUTL",262,0)
 .S PSJTMPLI=$G(@PSJTMPFI) I ($TR(PSJTMPLI," ")'="") D TXT^PSGMUTL($$ENSISET(PSJTMPLI),74)
"RTN","PSJUTL",263,0)
 .I ($TR(PSJTMPLI," ")="") S MARX(1)=PSJTMPLI
"RTN","PSJUTL",264,0)
 .S II="" F  S II=$O(MARX(II)) Q:'II  S TOLIN=+$O(^TMP("PSGSIL",$J,+$G(PSJSYSP),""),-1) D
"RTN","PSJUTL",265,0)
 ..S ^TMP("PSGSIL",$J,+$G(PSJSYSP),TOLIN+1)=MARX(II) Q
"RTN","PSJUTL",266,0)
 S I="" I $O(^TMP("PSGSIL",$J,+$G(PSJSYSP),0)) K ^PS(53.45,+$G(PSJSYSP),5) S TOLIN="" F I=0:1 S TOLIN=$O(^TMP("PSGSIL",$J,+$G(PSJSYSP),TOLIN)) Q:TOLIN=""  D
"RTN","PSJUTL",267,0)
 .S ^PS(53.45,+$G(PSJSYSP),5,TOLIN,0)=^TMP("PSGSIL",$J,+$G(PSJSYSP),TOLIN)
"RTN","PSJUTL",268,0)
 S I=$O(^PS(53.45,+$G(PSJSYSP),5,""),-1),^PS(53.45,+$G(PSJSYSP),5,0)="^55.6135^"_I_"^"_I_"^"_$P($G(PSGDT),".")
"RTN","PSJUTL",269,0)
 K ^TMP("PSGSIL",$J)
"RTN","PSJUTL",270,0)
 Q
"RTN","PSJUTL",271,0)
 ;
"RTN","PSJUTL",272,0)
ENSISET(X) ; expands the SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSJUTL",273,0)
 N X1,X2,Y S Y=""
"RTN","PSJUTL",274,0)
 ;BHW;PSJ*5*185;Modified Logic below to NOT strip spaces and allow existing logic to flow.
"RTN","PSJUTL",275,0)
 ;             ;Removed code I X2]"" Before Set of Y and created argumentless DO structure.
"RTN","PSJUTL",276,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) D
"RTN","PSJUTL",277,0)
 . I X2']"" S Y=Y_" " Q  ;if multiple spaces in text and were $P'ing through text, X2 will="" so just add space and continue
"RTN","PSJUTL",278,0)
 . S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSJUTL",279,0)
 . Q
"RTN","PSJUTL",280,0)
 ;BHW;Modified stripping of spaces at end of string
"RTN","PSJUTL",281,0)
 F X1=$L(Y):-1:0 Q:$E(Y,X1,X1)'=" "  S Y=$E(Y,1,X1-1)
"RTN","PSJUTL",282,0)
 Q Y
"UP",53.1,53.1135,-1)
53.1^15
"UP",53.1,53.1135,0)
53.1135
"UP",53.1,53.1136,-1)
53.1^16
"UP",53.1,53.1136,0)
53.1136
"UP",53.45,53.455,-1)
53.45^5
"UP",53.45,53.455,0)
53.455
"UP",53.45,53.456,-1)
53.45^6
"UP",53.45,53.456,0)
53.456
"VER")
8.0^22.0
"^DD",53.1,53.1,135,0)
SPECIAL INSTRUCTIONS (LONG)^53.1135^^15;0
"^DD",53.1,53.1,135,21,0)
^^2^2^3120111^
"^DD",53.1,53.1,135,21,1,0)
This is any special instructions needed for this order.  This would
"^DD",53.1,53.1,135,21,2,0)
include the physician's reason for ordering a PRN.  
"^DD",53.1,53.1,135,23,0)
^.001^2^2^3120111^^^^
"^DD",53.1,53.1,135,23,1,0)
This word processing field may contain an unlimited number of lines of
"^DD",53.1,53.1,135,23,2,0)
text.
"^DD",53.1,53.1,136,0)
OTHER PRINT INFO (LONG)^53.1136^^16;0
"^DD",53.1,53.1,136,21,0)
^^4^4^3120111^
"^DD",53.1,53.1,136,21,1,0)
For use by Pharmacy to print additional information on IV labels and 
"^DD",53.1,53.1,136,21,2,0)
reports. This is very similar to the REMARKS (#.1) field in the IV (#100)
"^DD",53.1,53.1,136,21,3,0)
multiple of the PHARMACY PATIENT (#55) file, except OTHER PRINT INFO is
"^DD",53.1,53.1,136,21,4,0)
shown on the label and the IV REPORTS.
"^DD",53.1,53.1,136,23,0)
^.001^2^2^3120111^^^^
"^DD",53.1,53.1,136,23,1,0)
This field is a word processing field and may contain an unlimited number
"^DD",53.1,53.1,136,23,2,0)
of lines of text.
"^DD",53.1,53.1135,0)
SPECIAL INSTRUCTIONS (LONG) SUB-FIELD^^.01^1
"^DD",53.1,53.1135,0,"DT")
3110912
"^DD",53.1,53.1135,0,"NM","SPECIAL INSTRUCTIONS (LONG)")

"^DD",53.1,53.1135,0,"UP")
53.1
"^DD",53.1,53.1135,.01,0)
SPECIAL INSTRUCTIONS (LONG)^WLx^^0;1^Q
"^DD",53.1,53.1135,.01,3)
Enter clinical instructions related to the dispensing or administering of this order.
"^DD",53.1,53.1135,.01,21,0)
^.001^4^4^3120110^^
"^DD",53.1,53.1135,.01,21,1,0)
This is any special instructions (using abbreviations whenever possible) 
"^DD",53.1,53.1135,.01,21,2,0)
needed for this order.  This would include the physician's reason for 
"^DD",53.1,53.1135,.01,21,3,0)
ordering a PRN.  The abbreviations and expansions from the MEDICATION 
"^DD",53.1,53.1135,.01,21,4,0)
INSTRUCTIONS file are utilized.
"^DD",53.1,53.1135,.01,"DT")
3110912
"^DD",53.1,53.1136,0)
OTHER PRINT INFO (LONG) SUB-FIELD^^.01^1
"^DD",53.1,53.1136,0,"DT")
3111104
"^DD",53.1,53.1136,0,"NM","OTHER PRINT INFO (LONG)")

"^DD",53.1,53.1136,0,"UP")
53.1
"^DD",53.1,53.1136,.01,0)
OTHER PRINT INFO (LONG)^WLx^^0;1^Q
"^DD",53.1,53.1136,.01,3)
Enter clinical instructions related to the dispensing or administering of this order.
"^DD",53.1,53.1136,.01,21,0)
^.001^3^3^3120111^^^^
"^DD",53.1,53.1136,.01,21,1,0)
For use by Pharmacy to print additional information on IV labels and
"^DD",53.1,53.1136,.01,21,2,0)
reports. This field is very similar to the REMARKS field except that OTHER
"^DD",53.1,53.1136,.01,21,3,0)
INFO is shown on the label and the IV REPORTS.
"^DD",53.1,53.1136,.01,"DT")
3111104
"^DD",53.45,53.45,5,0)
SPECIAL INSTRUCTIONS^53.455^^5;0
"^DD",53.45,53.45,5,21,0)
^^4^4^3120509^
"^DD",53.45,53.45,5,21,1,0)
This is any special instructions (using abbreviations whenever possible) 
"^DD",53.45,53.45,5,21,2,0)
needed for this order.  This would include the physician's reason for 
"^DD",53.45,53.45,5,21,3,0)
ordering a PRN.  This field utilizes the abbreviations and expansions 
"^DD",53.45,53.45,5,21,4,0)
from the MEDICATION INSTRUCTION (#51) file.  
"^DD",53.45,53.45,5,23,0)
^.001^4^4^3120509^^^
"^DD",53.45,53.45,5,23,1,0)
This is used by the Inpatient Medications package as temporary storage 
"^DD",53.45,53.45,5,23,2,0)
when processing orders to provide rudimentary transactional processing. 
"^DD",53.45,53.45,5,23,3,0)
Any data found here is deleted prior to each time this is used. This 
"^DD",53.45,53.45,5,23,4,0)
should not be directly edited.  
"^DD",53.45,53.45,6,0)
OTHER PRINT INFO^53.456^^6;0
"^DD",53.45,53.45,6,21,0)
^^4^4^3120509^
"^DD",53.45,53.45,6,21,1,0)
For use by Pharmacy to print additional information on IV labels and 
"^DD",53.45,53.45,6,21,2,0)
reports. This is very similar to the REMARKS (#.1) field in the IV (#100) 
"^DD",53.45,53.45,6,21,3,0)
multiple of the PHARMACY PATIENT(#55) file, except OTHER PRINT INFO is 
"^DD",53.45,53.45,6,21,4,0)
shown on the label and the IV REPORTS.
"^DD",53.45,53.45,6,23,0)
^^4^4^3120509^
"^DD",53.45,53.45,6,23,1,0)
This is used by the Inpatient Medications package as temporary storage 
"^DD",53.45,53.45,6,23,2,0)
when processing orders to provide rudimentary transactional processing. 
"^DD",53.45,53.45,6,23,3,0)
Any data found here is deleted prior to each time this is used. This 
"^DD",53.45,53.45,6,23,4,0)
should not be directly edited.  
"^DD",53.45,53.45,6,"DT")
3120111
"^DD",53.45,53.455,0)
SPECIAL INSTRUCTIONS SUB-FIELD^^.01^1
"^DD",53.45,53.455,0,"DT")
3111102
"^DD",53.45,53.455,0,"NM","SPECIAL INSTRUCTIONS")

"^DD",53.45,53.455,0,"UP")
53.45
"^DD",53.45,53.455,.01,0)
SPECIAL INSTRUCTIONS^WLx^^0;1^Q
"^DD",53.45,53.455,.01,21,0)
^^2^2^3120509^
"^DD",53.45,53.455,.01,21,1,0)
This is any special instructions needed for this order. This would include
"^DD",53.45,53.455,.01,21,2,0)
the reason for ordering a PRN.
"^DD",53.45,53.455,.01,23,0)
^^4^4^3120509^
"^DD",53.45,53.455,.01,23,1,0)
This is used by the Inpatient Medications package as temporary storage
"^DD",53.45,53.455,.01,23,2,0)
when processing orders to provide rudimentary transactional processing.
"^DD",53.45,53.455,.01,23,3,0)
Any data found here is deleted prior to each time this is used. This
"^DD",53.45,53.455,.01,23,4,0)
should not be directly edited.  
"^DD",53.45,53.455,.01,"DT")
3111102
"^DD",53.45,53.456,0)
OTHER PRINT INFO SUB-FIELD^^.01^1
"^DD",53.45,53.456,0,"DT")
3111104
"^DD",53.45,53.456,0,"NM","OTHER PRINT INFO")

"^DD",53.45,53.456,0,"UP")
53.45
"^DD",53.45,53.456,.01,0)
OTHER PRINT INFO (LONG)^WLx^^0;1^Q
"^DD",53.45,53.456,.01,"DT")
3111104
"BLD",8210,6)
^232
**END**
**END**
