Released PSJ*5*275 SEQ #246
Extracted from mail message
**KIDS**:PSJ*5.0*275^

**INSTALL NAME**
PSJ*5.0*275
"BLD",8335,0)
PSJ*5.0*275^INPATIENT MEDICATIONS^0^3130221^y
"BLD",8335,1,0)
^^196^196^3130211^
"BLD",8335,1,1,0)
 
"BLD",8335,1,2,0)
Edit Clinic Med Orders Start Date/Time
"BLD",8335,1,3,0)
======================================
"BLD",8335,1,4,0)
This patch implements a new Vista option that allows users to
"BLD",8335,1,5,0)
quickly find clinic orders that are associated with a specific
"BLD",8335,1,6,0)
clinic location (or specific patient), and date range, and quickly 
"BLD",8335,1,7,0)
change the Start Date/Time of one or more selected clinic orders.
"BLD",8335,1,8,0)
 
"BLD",8335,1,9,0)
The new option EDIT CLINIC MED ORDERS START DATE/TIME [PSJ ECO] allows
"BLD",8335,1,10,0)
the user to search for clinic orders by clinic group, clinic, or by
"BLD",8335,1,11,0)
patient. After entering a clinic group, clinic, or patient, a beginning
"BLD",8335,1,12,0)
and ending date range must be entered to find orders with a start
"BLD",8335,1,13,0)
date/time within the specified range.
"BLD",8335,1,14,0)
 
"BLD",8335,1,15,0)
When searching by clinic, all patients with at least one clinic order
"BLD",8335,1,16,0)
for the specified clinic and date range are displayed in a list, and
"BLD",8335,1,17,0)
one or more patients may be selected from the list. After a patient is
"BLD",8335,1,18,0)
selected, only clinic orders matching the specified clinic and date range 
"BLD",8335,1,19,0)
are displayed.
"BLD",8335,1,20,0)
 
"BLD",8335,1,21,0)
When searching by clinic group, all patients with at least one clinic 
"BLD",8335,1,22,0)
order in the specified clinic group are displayed in a list, and one or
"BLD",8335,1,23,0)
more patients may be selected from the list. After a patient is selected,
"BLD",8335,1,24,0)
only the clinic orders matching the specified clinic group and date range 
"BLD",8335,1,25,0)
are displayed.
"BLD",8335,1,26,0)
 
"BLD",8335,1,27,0)
When searching by patient, clinic location is not specified, therefore, 
"BLD",8335,1,28,0)
all clinic orders within the selected date range are displayed, for 
"BLD",8335,1,29,0)
all clinic locations.
"BLD",8335,1,30,0)
 
"BLD",8335,1,31,0)
For searches by clinic and by patient, from the clinic profile view, 
"BLD",8335,1,32,0)
one or more clinic orders may be selected for start date/time editing.
"BLD",8335,1,33,0)
The new start date/time is entered once, and applied to all selected
"BLD",8335,1,34,0)
clinic orders. 
"BLD",8335,1,35,0)
 
"BLD",8335,1,36,0)
Two new actions are available from the clinic profile view: VP (View
"BLD",8335,1,37,0)
Profile), and VD (View Details). The VP (View Profile) action displays 
"BLD",8335,1,38,0)
the full Inpatient medication profile, and the VD (View Details) action
"BLD",8335,1,39,0)
prompts for a specific clinic order from the numbered list, and
"BLD",8335,1,40,0)
displays the detailed view of the order.
"BLD",8335,1,41,0)
 
"BLD",8335,1,42,0)
 
"BLD",8335,1,43,0)
Patient Profile Clinic Orders
"BLD",8335,1,44,0)
=============================
"BLD",8335,1,45,0)
Clinic Orders will display in the patient profile grouped by Clinic, 
"BLD",8335,1,46,0)
separate from non-Clinic Orders. Clinic Orders will display after all 
"BLD",8335,1,47,0)
active, pending, and non-verified non-Clinic Orders. Non-Active 
"BLD",8335,1,48,0)
non-Clinic orders will display after Clinic Orders.
"BLD",8335,1,49,0)
 
"BLD",8335,1,50,0)
The following menu options, and any actions that execute these options,
"BLD",8335,1,51,0)
will be enhanced to separate clinic orders from non-clinic orders:
"BLD",8335,1,52,0)
 
"BLD",8335,1,53,0)
      Inpatient Order Entry [PSJ OE] 
"BLD",8335,1,54,0)
      Order Entry [PSJU NE] 
"BLD",8335,1,55,0)
      Non-Verified/Pending Orders [PSJU VBW] 
"BLD",8335,1,56,0)
      Order Entry (IV) [PSJI ORDER] 
"BLD",8335,1,57,0)
      Patient Profile (IV) [PSJI PROFILE]
"BLD",8335,1,58,0)
      Action Profile  #1 [PSJU AP-1] 
"BLD",8335,1,59,0)
      Action Profile #2  [PSJU AP-2]
"BLD",8335,1,60,0)
      Patient Profile (Unit Dose) [PSJU PR]
"BLD",8335,1,61,0)
 
"BLD",8335,1,62,0)
 
"BLD",8335,1,63,0)
Patch Components
"BLD",8335,1,64,0)
================
"BLD",8335,1,65,0)
 
"BLD",8335,1,66,0)
Files & Fields Associated:
"BLD",8335,1,67,0)
None.
"BLD",8335,1,68,0)
 
"BLD",8335,1,69,0)
Forms Associated:
"BLD",8335,1,70,0)
None. 
"BLD",8335,1,71,0)
 
"BLD",8335,1,72,0)
Mail Groups Associated:
"BLD",8335,1,73,0)
None. 
"BLD",8335,1,74,0)
 
"BLD",8335,1,75,0)
Options Associated:
"BLD",8335,1,76,0)
-------------------
"BLD",8335,1,77,0)
Clinic Orders Menu                      [PSJ CLINIC ORDERS MENU]
"BLD",8335,1,78,0)
Edit Clinic Med Orders Start Date/Time  [PSJ ECO]
"BLD",8335,1,79,0)
Pharmacy Master Menu                    [PHARMACY MASTER MENU]
"BLD",8335,1,80,0)
Unit Dose Medications                   [PSJU MGR]
"BLD",8335,1,81,0)
IV Menu                                 [PSJI MGR]
"BLD",8335,1,82,0)
 
"BLD",8335,1,83,0)
 
"BLD",8335,1,84,0)
Protocols Associated:
"BLD",8335,1,85,0)
---------------------
"BLD",8335,1,86,0)
PSJ LM ECO HIDDEN ACTIONS
"BLD",8335,1,87,0)
PSJ LM ECO IM PR
"BLD",8335,1,88,0)
PSJ LM ECO MENU
"BLD",8335,1,89,0)
PSJ LM ECO RANGE
"BLD",8335,1,90,0)
PSJ LM ECO SELECT
"BLD",8335,1,91,0)
PSJ LM ECO START
"BLD",8335,1,92,0)
PSJ LM VIEW ORDER DETAIL
"BLD",8335,1,93,0)
 
"BLD",8335,1,94,0)
 
"BLD",8335,1,95,0)
Security Keys Associated:
"BLD",8335,1,96,0)
None. 
"BLD",8335,1,97,0)
 
"BLD",8335,1,98,0)
Templates Associated:
"BLD",8335,1,99,0)
 
"BLD",8335,1,100,0)
List Templates
"BLD",8335,1,101,0)
--------------
"BLD",8335,1,102,0)
PSJ LM CLINIC ORDER 
"BLD",8335,1,103,0)
 
"BLD",8335,1,104,0)
 
"BLD",8335,1,105,0)
Additional Information:
"BLD",8335,1,106,0)
  
"BLD",8335,1,107,0)
 Patient Safety Issues (PSIs)
"BLD",8335,1,108,0)
 -----------------------------
"BLD",8335,1,109,0)
  2359 - Provider comments intended for a specific order are copied on
"BLD",8335,1,110,0)
         another order upon renewal.
"BLD",8335,1,111,0)
  
"BLD",8335,1,112,0)
  
"BLD",8335,1,113,0)
 Remedy Ticket(s) & Overview
"BLD",8335,1,114,0)
 ---------------------------
"BLD",8335,1,115,0)
  HD 764596/781899 - Other Print Info display incorrectly.
"BLD",8335,1,116,0)
  
"BLD",8335,1,117,0)
   Problem
"BLD",8335,1,118,0)
   --------
"BLD",8335,1,119,0)
   When two or more Pending IV renews or Non-Verified edited IV orders
"BLD",8335,1,120,0)
   containing Other Print Info are selected in Inpatient Order Entry using
"BLD",8335,1,121,0)
   a dash, 1-3 to view orders 1, 2, and 3, the orders following the first
"BLD",8335,1,122,0)
   order mistakenly display the first order's Other Print Info. 
"BLD",8335,1,123,0)
  
"BLD",8335,1,124,0)
   Solution
"BLD",8335,1,125,0)
   --------
"BLD",8335,1,126,0)
   When selecting multiple Pending Renewed IV orders or multiple
"BLD",8335,1,127,0)
   Non-Verified edited IV orders by using a dash in Inpatient Order Entry,
"BLD",8335,1,128,0)
   initialize contents of Other Print Info between orders so the Other
"BLD",8335,1,129,0)
   Print Info is displayed with the proper order.
"BLD",8335,1,130,0)
 
"BLD",8335,1,131,0)
 
"BLD",8335,1,132,0)
  HD 760186 - Other Print Info from IV Quick Code not used.
"BLD",8335,1,133,0)
  
"BLD",8335,1,134,0)
   Problem
"BLD",8335,1,135,0)
   --------
"BLD",8335,1,136,0)
   Other Print Info copied in from Provider Comments not being overwritten
"BLD",8335,1,137,0)
   by Other Print info in a selected IV Quick Code.
"BLD",8335,1,138,0)
 
"BLD",8335,1,139,0)
   Solution
"BLD",8335,1,140,0)
   --------
"BLD",8335,1,141,0)
   Restore previous functionality. When an order that can be finished as 
"BLD",8335,1,142,0)
   Unit Dose or IV is finished as an IV, and the user is prompted for  
"BLD",8335,1,143,0)
   Additive, if the finishing pharmacist enters an IV Quick Code that 
"BLD",8335,1,144,0)
   contains Other Print Info text, that text should overwrite the contents
"BLD",8335,1,145,0)
   of the order's Other Print Info.
"BLD",8335,1,146,0)
 
"BLD",8335,1,147,0)
  
"BLD",8335,1,148,0)
  HD 763244 - Undefined error in 7 Day Mar.
"BLD",8335,1,149,0)
  
"BLD",8335,1,150,0)
   Problem
"BLD",8335,1,151,0)
   --------
"BLD",8335,1,152,0)
   Undefined error occurs when printing a PRN IV order in the 7Day MAR
"BLD",8335,1,153,0)
   [PSJU 7D MAR] option.
"BLD",8335,1,154,0)
  
"BLD",8335,1,155,0)
   Solution
"BLD",8335,1,156,0)
   ---------
"BLD",8335,1,157,0)
   Prevent undefined error from occurring.
"BLD",8335,1,158,0)
  
"BLD",8335,1,159,0)
  
"BLD",8335,1,160,0)
  HD 756354 - Undefined error in CPRS IV label print.
"BLD",8335,1,161,0)
  
"BLD",8335,1,162,0)
   Problem
"BLD",8335,1,163,0)
   --------
"BLD",8335,1,164,0)
   Undefined error occurs when printing an IV Label from the Chart Copy
"BLD",8335,1,165,0)
   dialog after signing an order in CPRS.
"BLD",8335,1,166,0)
          
"BLD",8335,1,167,0)
   Solution: Prevent undefined error from occurring.
"BLD",8335,1,168,0)
  
"BLD",8335,1,169,0)
  
"BLD",8335,1,170,0)
  HD 763555 - Wrong intervention recommendation is filed.
"BLD",8335,1,171,0)
  
"BLD",8335,1,172,0)
   Problem
"BLD",8335,1,173,0)
   --------
"BLD",8335,1,174,0)
   NO ALLERGY ASSESSMENT type of intervention does not file correct
"BLD",8335,1,175,0)
   recommendation when custom entries are present in the APSP INTERVENTION
"BLD",8335,1,176,0)
   RECOMMENDATION (#9009032.5) file.
"BLD",8335,1,177,0)
  
"BLD",8335,1,178,0)
   Solution
"BLD",8335,1,179,0)
   ---------
"BLD",8335,1,180,0)
   Enable the NO ALLERGY ASSESSMENT type of interventions to handle custom
"BLD",8335,1,181,0)
   entries in the APSP INTERVENTION RECOMMENDATION (#9009032.5) file.
"BLD",8335,1,182,0)
          
"BLD",8335,1,183,0)
  
"BLD",8335,1,184,0)
  HD 770025 - Long Special Instructions not retained after CPRS Renew
"BLD",8335,1,185,0)
  
"BLD",8335,1,186,0)
   Problem
"BLD",8335,1,187,0)
   --------
"BLD",8335,1,188,0)
   Long Special Instructions (greater than 180 characters) and Other Print
"BLD",8335,1,189,0)
   Info (greater than 60 characters) are not carried over to the Pending 
"BLD",8335,1,190,0)
   renewal order after the order is renewed in CPRS.
"BLD",8335,1,191,0)
  
"BLD",8335,1,192,0)
   Solution
"BLD",8335,1,193,0)
   --------
"BLD",8335,1,194,0)
   Retain long Special Instructions (greater than 180 characters) and
"BLD",8335,1,195,0)
   Other Print Info (greater than 60 characters) in the Pending renewal
"BLD",8335,1,196,0)
   order when the order is renewed from CPRS.
"BLD",8335,4,0)
^9.64PA^^0
"BLD",8335,6)
11^
"BLD",8335,6.3)
157
"BLD",8335,"ABPKG")
n
"BLD",8335,"INIT")

"BLD",8335,"KRN",0)
^9.67PA^779.2^20
"BLD",8335,"KRN",.4,0)
.4
"BLD",8335,"KRN",.401,0)
.401
"BLD",8335,"KRN",.402,0)
.402
"BLD",8335,"KRN",.403,0)
.403
"BLD",8335,"KRN",.5,0)
.5
"BLD",8335,"KRN",.84,0)
.84
"BLD",8335,"KRN",3.6,0)
3.6
"BLD",8335,"KRN",3.8,0)
3.8
"BLD",8335,"KRN",9.2,0)
9.2
"BLD",8335,"KRN",9.8,0)
9.8
"BLD",8335,"KRN",9.8,"NM",0)
^9.68A^57^47
"BLD",8335,"KRN",9.8,"NM",1,0)
PSJCLOR^^0^B135035264
"BLD",8335,"KRN",9.8,"NM",2,0)
PSJCLOR1^^0^B61599186
"BLD",8335,"KRN",9.8,"NM",3,0)
PSJCLOR2^^0^B116137522
"BLD",8335,"KRN",9.8,"NM",4,0)
PSJCLOR3^^0^B146984380
"BLD",8335,"KRN",9.8,"NM",5,0)
PSJLMPRI^^0^B22340639
"BLD",8335,"KRN",9.8,"NM",6,0)
PSJP^^0^B26835871
"BLD",8335,"KRN",9.8,"NM",8,0)
PSJCLOR4^^0^B76629306
"BLD",8335,"KRN",9.8,"NM",9,0)
PSJORRE^^0^B35461891
"BLD",8335,"KRN",9.8,"NM",10,0)
PSJORRE1^^0^B41040676
"BLD",8335,"KRN",9.8,"NM",11,0)
PSJORRN^^0^B66656039
"BLD",8335,"KRN",9.8,"NM",12,0)
PSJORRN1^^0^B61358484
"BLD",8335,"KRN",9.8,"NM",13,0)
PSJORRO^^0^B67615979
"BLD",8335,"KRN",9.8,"NM",17,0)
PSGVBW^^0^B97529412
"BLD",8335,"KRN",9.8,"NM",18,0)
PSJLMHED^^0^B56770438
"BLD",8335,"KRN",9.8,"NM",20,0)
PSJO^^0^B28881243
"BLD",8335,"KRN",9.8,"NM",22,0)
PSGAP0^^0^B32794641
"BLD",8335,"KRN",9.8,"NM",24,0)
PSGAPIV^^0^B7424595
"BLD",8335,"KRN",9.8,"NM",25,0)
PSGAPP^^0^B31906580
"BLD",8335,"KRN",9.8,"NM",26,0)
PSJO1^^0^B46168222
"BLD",8335,"KRN",9.8,"NM",27,0)
PSIV^^0^B30428060
"BLD",8335,"KRN",9.8,"NM",28,0)
PSIVACT^^0^B30113388
"BLD",8335,"KRN",9.8,"NM",29,0)
PSIVPRO^^0^B46921517
"BLD",8335,"KRN",9.8,"NM",30,0)
PSIVUTL^^0^B30828184
"BLD",8335,"KRN",9.8,"NM",31,0)
PSJOE0^^0^B26253829
"BLD",8335,"KRN",9.8,"NM",32,0)
PSGCAP0^^0^B23579520
"BLD",8335,"KRN",9.8,"NM",33,0)
PSGCAPP^^0^B20267187
"BLD",8335,"KRN",9.8,"NM",34,0)
PSGO^^0^B35277270
"BLD",8335,"KRN",9.8,"NM",36,0)
PSGOU^^0^B34119458
"BLD",8335,"KRN",9.8,"NM",39,0)
PSGNE3^^0^B86381204
"BLD",8335,"KRN",9.8,"NM",40,0)
PSGP^^0^B11695903
"BLD",8335,"KRN",9.8,"NM",41,0)
PSJCLOR5^^0^B68088373
"BLD",8335,"KRN",9.8,"NM",42,0)
PSJINVW^^0^B123707309
"BLD",8335,"KRN",9.8,"NM",43,0)
PSJDPT^^0^B14025206
"BLD",8335,"KRN",9.8,"NM",44,0)
PSJAC^^0^B14549203
"BLD",8335,"KRN",9.8,"NM",45,0)
PSJORMA2^^0^B20205584
"BLD",8335,"KRN",9.8,"NM",46,0)
PSIVORFA^^0^B28198833
"BLD",8335,"KRN",9.8,"NM",47,0)
PSGMMIV^^0^B48999295
"BLD",8335,"KRN",9.8,"NM",48,0)
PSJRXI^^0^B22320376
"BLD",8335,"KRN",9.8,"NM",49,0)
PSIVORC2^^0^B59162972
"BLD",8335,"KRN",9.8,"NM",50,0)
PSGMIV^^0^B42880298
"BLD",8335,"KRN",9.8,"NM",51,0)
PSIVQUI^^0^B19673705
"BLD",8335,"KRN",9.8,"NM",52,0)
PSJLIVMD^^0^B96668523
"BLD",8335,"KRN",9.8,"NM",53,0)
PSJLMGUD^^0^B30490889
"BLD",8335,"KRN",9.8,"NM",54,0)
PSJLIACT^^0^B49618322
"BLD",8335,"KRN",9.8,"NM",55,0)
PSJBCMA5^^0^B80438277
"BLD",8335,"KRN",9.8,"NM",56,0)
PSJHL7^^0^B54233730
"BLD",8335,"KRN",9.8,"NM",57,0)
PSGOE^^0^B26201410
"BLD",8335,"KRN",9.8,"NM","B","PSGAP0",22)

"BLD",8335,"KRN",9.8,"NM","B","PSGAPIV",24)

"BLD",8335,"KRN",9.8,"NM","B","PSGAPP",25)

"BLD",8335,"KRN",9.8,"NM","B","PSGCAP0",32)

"BLD",8335,"KRN",9.8,"NM","B","PSGCAPP",33)

"BLD",8335,"KRN",9.8,"NM","B","PSGMIV",50)

"BLD",8335,"KRN",9.8,"NM","B","PSGMMIV",47)

"BLD",8335,"KRN",9.8,"NM","B","PSGNE3",39)

"BLD",8335,"KRN",9.8,"NM","B","PSGO",34)

"BLD",8335,"KRN",9.8,"NM","B","PSGOE",57)

"BLD",8335,"KRN",9.8,"NM","B","PSGOU",36)

"BLD",8335,"KRN",9.8,"NM","B","PSGP",40)

"BLD",8335,"KRN",9.8,"NM","B","PSGVBW",17)

"BLD",8335,"KRN",9.8,"NM","B","PSIV",27)

"BLD",8335,"KRN",9.8,"NM","B","PSIVACT",28)

"BLD",8335,"KRN",9.8,"NM","B","PSIVORC2",49)

"BLD",8335,"KRN",9.8,"NM","B","PSIVORFA",46)

"BLD",8335,"KRN",9.8,"NM","B","PSIVPRO",29)

"BLD",8335,"KRN",9.8,"NM","B","PSIVQUI",51)

"BLD",8335,"KRN",9.8,"NM","B","PSIVUTL",30)

"BLD",8335,"KRN",9.8,"NM","B","PSJAC",44)

"BLD",8335,"KRN",9.8,"NM","B","PSJBCMA5",55)

"BLD",8335,"KRN",9.8,"NM","B","PSJCLOR",1)

"BLD",8335,"KRN",9.8,"NM","B","PSJCLOR1",2)

"BLD",8335,"KRN",9.8,"NM","B","PSJCLOR2",3)

"BLD",8335,"KRN",9.8,"NM","B","PSJCLOR3",4)

"BLD",8335,"KRN",9.8,"NM","B","PSJCLOR4",8)

"BLD",8335,"KRN",9.8,"NM","B","PSJCLOR5",41)

"BLD",8335,"KRN",9.8,"NM","B","PSJDPT",43)

"BLD",8335,"KRN",9.8,"NM","B","PSJHL7",56)

"BLD",8335,"KRN",9.8,"NM","B","PSJINVW",42)

"BLD",8335,"KRN",9.8,"NM","B","PSJLIACT",54)

"BLD",8335,"KRN",9.8,"NM","B","PSJLIVMD",52)

"BLD",8335,"KRN",9.8,"NM","B","PSJLMGUD",53)

"BLD",8335,"KRN",9.8,"NM","B","PSJLMHED",18)

"BLD",8335,"KRN",9.8,"NM","B","PSJLMPRI",5)

"BLD",8335,"KRN",9.8,"NM","B","PSJO",20)

"BLD",8335,"KRN",9.8,"NM","B","PSJO1",26)

"BLD",8335,"KRN",9.8,"NM","B","PSJOE0",31)

"BLD",8335,"KRN",9.8,"NM","B","PSJORMA2",45)

"BLD",8335,"KRN",9.8,"NM","B","PSJORRE",9)

"BLD",8335,"KRN",9.8,"NM","B","PSJORRE1",10)

"BLD",8335,"KRN",9.8,"NM","B","PSJORRN",11)

"BLD",8335,"KRN",9.8,"NM","B","PSJORRN1",12)

"BLD",8335,"KRN",9.8,"NM","B","PSJORRO",13)

"BLD",8335,"KRN",9.8,"NM","B","PSJP",6)

"BLD",8335,"KRN",9.8,"NM","B","PSJRXI",48)

"BLD",8335,"KRN",19,0)
19
"BLD",8335,"KRN",19,"NM",0)
^9.68A^47^5
"BLD",8335,"KRN",19,"NM",1,0)
PSJ ECO^^0^
"BLD",8335,"KRN",19,"NM",12,0)
PHARMACY MASTER MENU^^3
"BLD",8335,"KRN",19,"NM",45,0)
PSJ CLINIC ORDERS MENU^^0
"BLD",8335,"KRN",19,"NM",46,0)
PSJU MGR^^3
"BLD",8335,"KRN",19,"NM",47,0)
PSJI MGR^^3
"BLD",8335,"KRN",19,"NM","B","PHARMACY MASTER MENU",12)

"BLD",8335,"KRN",19,"NM","B","PSJ CLINIC ORDERS MENU",45)

"BLD",8335,"KRN",19,"NM","B","PSJ ECO",1)

"BLD",8335,"KRN",19,"NM","B","PSJI MGR",47)

"BLD",8335,"KRN",19,"NM","B","PSJU MGR",46)

"BLD",8335,"KRN",19.1,0)
19.1
"BLD",8335,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",8335,"KRN",101,0)
101
"BLD",8335,"KRN",101,"NM",0)
^9.68A^20^17
"BLD",8335,"KRN",101,"NM",1,0)
PSJ LM ECO MENU^^0
"BLD",8335,"KRN",101,"NM",2,0)
PSJ LM ECO START^^0
"BLD",8335,"KRN",101,"NM",5,0)
PSJ LM VIEW ORDER DETAIL^^0
"BLD",8335,"KRN",101,"NM",6,0)
PSJ LM ECO HIDDEN ACTIONS^^0
"BLD",8335,"KRN",101,"NM",8,0)
VALM NEXT SCREEN^^4^
"BLD",8335,"KRN",101,"NM",9,0)
VALM PREVIOUS SCREEN^^4^
"BLD",8335,"KRN",101,"NM",10,0)
VALM UP ONE LINE^^4^
"BLD",8335,"KRN",101,"NM",11,0)
VALM RIGHT^^4^
"BLD",8335,"KRN",101,"NM",12,0)
VALM LEFT^^4^
"BLD",8335,"KRN",101,"NM",13,0)
VALM FIRST SCREEN^^4^
"BLD",8335,"KRN",101,"NM",14,0)
VALM LAST SCREEN^^4^
"BLD",8335,"KRN",101,"NM",15,0)
VALM GOTO PAGE^^4^
"BLD",8335,"KRN",101,"NM",16,0)
VALM REFRESH^^4^
"BLD",8335,"KRN",101,"NM",17,0)
PSJ LM ECO SELECT^^0
"BLD",8335,"KRN",101,"NM",18,0)
PSJ LM ECO RANGE^^0
"BLD",8335,"KRN",101,"NM",19,0)
PSJ LM ECO IM PR^^0
"BLD",8335,"KRN",101,"NM",20,0)
VALM DOWN A LINE^^4^
"BLD",8335,"KRN",101,"NM","B","PSJ LM ECO HIDDEN ACTIONS",6)

"BLD",8335,"KRN",101,"NM","B","PSJ LM ECO IM PR",19)

"BLD",8335,"KRN",101,"NM","B","PSJ LM ECO MENU",1)

"BLD",8335,"KRN",101,"NM","B","PSJ LM ECO RANGE",18)

"BLD",8335,"KRN",101,"NM","B","PSJ LM ECO SELECT",17)

"BLD",8335,"KRN",101,"NM","B","PSJ LM ECO START",2)

"BLD",8335,"KRN",101,"NM","B","PSJ LM VIEW ORDER DETAIL",5)

"BLD",8335,"KRN",101,"NM","B","VALM DOWN A LINE",20)

"BLD",8335,"KRN",101,"NM","B","VALM FIRST SCREEN",13)

"BLD",8335,"KRN",101,"NM","B","VALM GOTO PAGE",15)

"BLD",8335,"KRN",101,"NM","B","VALM LAST SCREEN",14)

"BLD",8335,"KRN",101,"NM","B","VALM LEFT",12)

"BLD",8335,"KRN",101,"NM","B","VALM NEXT SCREEN",8)

"BLD",8335,"KRN",101,"NM","B","VALM PREVIOUS SCREEN",9)

"BLD",8335,"KRN",101,"NM","B","VALM REFRESH",16)

"BLD",8335,"KRN",101,"NM","B","VALM RIGHT",11)

"BLD",8335,"KRN",101,"NM","B","VALM UP ONE LINE",10)

"BLD",8335,"KRN",409.61,0)
409.61
"BLD",8335,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",8335,"KRN",409.61,"NM",1,0)
PSJ LM CLINIC ORDERS^^0
"BLD",8335,"KRN",409.61,"NM","B","PSJ LM CLINIC ORDERS",1)

"BLD",8335,"KRN",771,0)
771
"BLD",8335,"KRN",779.2,0)
779.2
"BLD",8335,"KRN",870,0)
870
"BLD",8335,"KRN",8989.51,0)
8989.51
"BLD",8335,"KRN",8989.52,0)
8989.52
"BLD",8335,"KRN",8994,0)
8994
"BLD",8335,"KRN","B",.4,.4)

"BLD",8335,"KRN","B",.401,.401)

"BLD",8335,"KRN","B",.402,.402)

"BLD",8335,"KRN","B",.403,.403)

"BLD",8335,"KRN","B",.5,.5)

"BLD",8335,"KRN","B",.84,.84)

"BLD",8335,"KRN","B",3.6,3.6)

"BLD",8335,"KRN","B",3.8,3.8)

"BLD",8335,"KRN","B",9.2,9.2)

"BLD",8335,"KRN","B",9.8,9.8)

"BLD",8335,"KRN","B",19,19)

"BLD",8335,"KRN","B",19.1,19.1)

"BLD",8335,"KRN","B",101,101)

"BLD",8335,"KRN","B",409.61,409.61)

"BLD",8335,"KRN","B",771,771)

"BLD",8335,"KRN","B",779.2,779.2)

"BLD",8335,"KRN","B",870,870)

"BLD",8335,"KRN","B",8989.51,8989.51)

"BLD",8335,"KRN","B",8989.52,8989.52)

"BLD",8335,"KRN","B",8994,8994)

"BLD",8335,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",8335,"QUES",0)
^9.62^^
"BLD",8335,"REQB",0)
^9.611^4^3
"BLD",8335,"REQB",2,0)
PSJ*5.0*278^2
"BLD",8335,"REQB",3,0)
PSJ*5.0*276^2
"BLD",8335,"REQB",4,0)
PSJ*5.0*260^2
"BLD",8335,"REQB","B","PSJ*5.0*260",4)

"BLD",8335,"REQB","B","PSJ*5.0*276",3)

"BLD",8335,"REQB","B","PSJ*5.0*278",2)

"KRN",19,588,-1)
3^47
"KRN",19,588,0)
PSJI MGR^IV Menu^^M^^^^^^^^IV MEDICATIONS^^1^1
"KRN",19,588,1,0)
^19.06^1^1^3121004^^^^
"KRN",19,588,1,1,0)
This menu is the main starting point for the IV system.
"KRN",19,588,10,0)
^19.01IP^28^28
"KRN",19,588,10,28,0)
14099^ECO^4.5
"KRN",19,588,10,28,"^")
PSJ ECO
"KRN",19,588,15)
K PSIVSN,PSIVPR,PSIV,P,PS
"KRN",19,588,20)
D ^PSIVXU Q:$D(XQUIT)  D ENIVKV^PSGSETU
"KRN",19,588,99)
62864,51939
"KRN",19,588,99.1)
62874,3609
"KRN",19,588,"U")
IV MENU
"KRN",19,687,-1)
3^46
"KRN",19,687,0)
PSJU MGR^Unit Dose Medications^^M^^^^^^^^UNIT DOSE MEDICATIONS^^1^1
"KRN",19,687,1,0)
^19.06^2^2^3120622^^^^
"KRN",19,687,1,1,0)
  This is the main menu for the Unit Dose Medications software.  This menu
"KRN",19,687,1,2,0)
must be given to all Unit Dose Medications users.
"KRN",19,687,10,0)
^19.01IP^40^40
"KRN",19,687,10,40,0)
14099^ECO^2.99
"KRN",19,687,10,40,"^")
PSJ ECO
"KRN",19,687,15)
D ENKV^PSGSETU
"KRN",19,687,20)
D ^PSGSET
"KRN",19,687,99)
62864,51939
"KRN",19,687,99.1)
62874,3609
"KRN",19,687,"U")
UNIT DOSE MEDICATIONS
"KRN",19,5204,-1)
3^12
"KRN",19,5204,0)
PHARMACY MASTER MENU^PHARMACY MASTER MENU^^M^^^^^^^^^^^^
"KRN",19,5204,3)

"KRN",19,5204,10,0)
^19.01IP^9^9
"KRN",19,5204,10,2,0)
687^PSG
"KRN",19,5204,10,2,"^")
PSJU MGR
"KRN",19,5204,10,4,0)
588^PSIV
"KRN",19,5204,10,4,"^")
PSJI MGR
"KRN",19,5204,10,9,0)
14098^PSC^5
"KRN",19,5204,10,9,"^")
PSJ CLINIC ORDERS MENU
"KRN",19,5204,99)
62864,51939
"KRN",19,5204,99.1)
62874,3609
"KRN",19,5204,"U")
PHARMACY MASTER MENU
"KRN",19,14098,-1)
0^45
"KRN",19,14098,0)
PSJ CLINIC ORDERS MENU^Clinic Orders Menu^^M^^^^^^^^
"KRN",19,14098,10,0)
^19.01IP^1^1
"KRN",19,14098,10,1,0)
14099^ECO^1
"KRN",19,14098,10,1,"^")
PSJ ECO
"KRN",19,14098,99)
62864,51939
"KRN",19,14098,"U")
CLINIC ORDERS MENU
"KRN",19,14099,-1)
0^1
"KRN",19,14099,0)
PSJ ECO^Edit Clinic Med Orders Start Date/Time^^R^^^^^^^^INPATIENT MEDICATIONS^^
"KRN",19,14099,1,0)
^19.06^4^4^3120315^^
"KRN",19,14099,1,1,0)
Allows the simultaneous edit of multiple Clinic Orders start date/times 
"KRN",19,14099,1,2,0)
to the same date. Also allows the user to find and view a patient's 
"KRN",19,14099,1,3,0)
Clinic Orders associated with a specific clinic during a specific date 
"KRN",19,14099,1,4,0)
range.
"KRN",19,14099,20)

"KRN",19,14099,25)
START^PSJCLOR
"KRN",19,14099,"U")
EDIT CLINIC MED ORDERS START D
"KRN",101,1803,-1)
4^8
"KRN",101,1803,0)
VALM NEXT SCREEN
"KRN",101,1804,-1)
4^9
"KRN",101,1804,0)
VALM PREVIOUS SCREEN
"KRN",101,1805,-1)
4^16
"KRN",101,1805,0)
VALM REFRESH
"KRN",101,1806,-1)
4^14
"KRN",101,1806,0)
VALM LAST SCREEN
"KRN",101,1807,-1)
4^13
"KRN",101,1807,0)
VALM FIRST SCREEN
"KRN",101,1808,-1)
4^10
"KRN",101,1808,0)
VALM UP ONE LINE
"KRN",101,1809,-1)
4^20
"KRN",101,1809,0)
VALM DOWN A LINE
"KRN",101,1824,-1)
4^11
"KRN",101,1824,0)
VALM RIGHT
"KRN",101,1825,-1)
4^12
"KRN",101,1825,0)
VALM LEFT
"KRN",101,1827,-1)
4^15
"KRN",101,1827,0)
VALM GOTO PAGE
"KRN",101,6003,-1)
0^1
"KRN",101,6003,0)
PSJ LM ECO MENU^Clinic Order Edit Start Date/Time^^M^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,6003,4)
25
"KRN",101,6003,10,0)
^101.01PA^7^7
"KRN",101,6003,10,3,0)
6005^ES^31^
"KRN",101,6003,10,3,"^")
PSJ LM ECO SELECT
"KRN",101,6003,10,5,0)
6006^VD^32^
"KRN",101,6003,10,5,"^")
PSJ LM VIEW ORDER DETAIL
"KRN",101,6003,10,6,0)
6008^VP^41^^^View Profile
"KRN",101,6003,10,6,"^")
PSJ LM ECO IM PR
"KRN",101,6003,10,7,0)
6009^CD^^^^Change Date Range
"KRN",101,6003,10,7,"^")
PSJ LM ECO RANGE
"KRN",101,6003,15)

"KRN",101,6003,20)
S XQORM("?")="D HELP^PSJCLOR1" K PSGEFN,^PS(53.45,+$G(DUZ),5),^PS(53.45,+$G(DUZ),6)
"KRN",101,6003,26)
D HDR^PSJCLOR1
"KRN",101,6003,27)
D HELP^PSJCLOR1
"KRN",101,6003,28)
Select Action:
"KRN",101,6003,99)
62864,51939
"KRN",101,6004,-1)
0^2
"KRN",101,6004,0)
PSJ LM ECO START^Edit Start Date^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,6004,20)
D PRMPTSD^PSJCLOR3
"KRN",101,6004,99)
62864,51939
"KRN",101,6005,-1)
0^17
"KRN",101,6005,0)
PSJ LM ECO SELECT^Edit Start Date^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,6005,20)
D PRMPTOR^PSJCLOR3
"KRN",101,6005,99)
62864,51939
"KRN",101,6006,-1)
0^5
"KRN",101,6006,0)
PSJ LM VIEW ORDER DETAIL^View Order Detail^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,6006,15)
S VALMBCK="R",VALM("TITLE")="Clinic Order Entry"
"KRN",101,6006,20)
D VWDETAIL^PSJCLOR2($G(PSGP))
"KRN",101,6006,21,0)
^101.021A
"KRN",101,6006,99)
62864,51939
"KRN",101,6007,-1)
0^6
"KRN",101,6007,0)
PSJ LM ECO HIDDEN ACTIONS^Clinic Order Hidden Actions Menu^^M^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,6007,4)
26
"KRN",101,6007,10,0)
^101.01PA^12^12
"KRN",101,6007,10,1,0)
1803^+^11^
"KRN",101,6007,10,1,"^")
VALM NEXT SCREEN
"KRN",101,6007,10,2,0)
1804^-^12^
"KRN",101,6007,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,6007,10,3,0)
1808^UP^13^
"KRN",101,6007,10,3,"^")
VALM UP ONE LINE
"KRN",101,6007,10,6,0)
1807^FS^17^
"KRN",101,6007,10,6,"^")
VALM FIRST SCREEN
"KRN",101,6007,10,7,0)
1806^LS^21^
"KRN",101,6007,10,7,"^")
VALM LAST SCREEN
"KRN",101,6007,10,8,0)
1827^GO^22^
"KRN",101,6007,10,8,"^")
VALM GOTO PAGE
"KRN",101,6007,10,9,0)
1805^RD^23^
"KRN",101,6007,10,9,"^")
VALM REFRESH
"KRN",101,6007,10,10,0)
1809^DN^15^
"KRN",101,6007,10,10,"^")
VALM DOWN A LINE
"KRN",101,6007,10,11,0)
1825^<^^
"KRN",101,6007,10,11,"^")
VALM LEFT
"KRN",101,6007,10,12,0)
1824^>^^
"KRN",101,6007,10,12,"^")
VALM RIGHT
"KRN",101,6007,15)
S VALMBCK="R"
"KRN",101,6007,27)
D HELP^PSJCLOR1
"KRN",101,6007,99)
62864,51939
"KRN",101,6008,-1)
0^19
"KRN",101,6008,0)
PSJ LM ECO IM PR^Inpatient Medications Profile^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,6008,15)
S VALMBCK="R"
"KRN",101,6008,20)
D IMPATPR^PSJCLOR1
"KRN",101,6008,99)
62864,51939
"KRN",101,6009,-1)
0^18
"KRN",101,6009,0)
PSJ LM ECO RANGE^Date Range^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,6009,15)
S VALMBCK="R"
"KRN",101,6009,20)
D CHGDT^PSJCLOR2
"KRN",101,6009,99)
62864,51939
"KRN",409.61,796,-1)
0^1
"KRN",409.61,796,0)
PSJ LM CLINIC ORDERS^1^^80^9^20^1^1^Protocol^PSJ LM ECO MENU^Clinic Order Entry^3^^1
"KRN",409.61,796,1)
^PSJ LM ECO HIDDEN ACTIONS
"KRN",409.61,796,"ARRAY")
 ^TMP("PSJPRO",$J)
"KRN",409.61,796,"FNL")
S PSJVALQ=1
"KRN",409.61,796,"HDR")
D HDR^PSJLMHED($S($G(DFN):DFN,1:$G(PSGP))) D HDRDT^PSJCLOR2
"KRN",409.61,796,"HLP")
D HELP^PSJCLOR1
"KRN",409.61,796,"INIT")
D INIT^PSJCLOR2(3)
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;LME1^XPDIA1;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
275^3130221^10000000009
"PKG",197,22,1,"PAH",1,1,0)
^^196^196^3130221
"PKG",197,22,1,"PAH",1,1,1,0)
 
"PKG",197,22,1,"PAH",1,1,2,0)
Edit Clinic Med Orders Start Date/Time
"PKG",197,22,1,"PAH",1,1,3,0)
======================================
"PKG",197,22,1,"PAH",1,1,4,0)
This patch implements a new Vista option that allows users to
"PKG",197,22,1,"PAH",1,1,5,0)
quickly find clinic orders that are associated with a specific
"PKG",197,22,1,"PAH",1,1,6,0)
clinic location (or specific patient), and date range, and quickly 
"PKG",197,22,1,"PAH",1,1,7,0)
change the Start Date/Time of one or more selected clinic orders.
"PKG",197,22,1,"PAH",1,1,8,0)
 
"PKG",197,22,1,"PAH",1,1,9,0)
The new option EDIT CLINIC MED ORDERS START DATE/TIME [PSJ ECO] allows
"PKG",197,22,1,"PAH",1,1,10,0)
the user to search for clinic orders by clinic group, clinic, or by
"PKG",197,22,1,"PAH",1,1,11,0)
patient. After entering a clinic group, clinic, or patient, a beginning
"PKG",197,22,1,"PAH",1,1,12,0)
and ending date range must be entered to find orders with a start
"PKG",197,22,1,"PAH",1,1,13,0)
date/time within the specified range.
"PKG",197,22,1,"PAH",1,1,14,0)
 
"PKG",197,22,1,"PAH",1,1,15,0)
When searching by clinic, all patients with at least one clinic order
"PKG",197,22,1,"PAH",1,1,16,0)
for the specified clinic and date range are displayed in a list, and
"PKG",197,22,1,"PAH",1,1,17,0)
one or more patients may be selected from the list. After a patient is
"PKG",197,22,1,"PAH",1,1,18,0)
selected, only clinic orders matching the specified clinic and date range 
"PKG",197,22,1,"PAH",1,1,19,0)
are displayed.
"PKG",197,22,1,"PAH",1,1,20,0)
 
"PKG",197,22,1,"PAH",1,1,21,0)
When searching by clinic group, all patients with at least one clinic 
"PKG",197,22,1,"PAH",1,1,22,0)
order in the specified clinic group are displayed in a list, and one or
"PKG",197,22,1,"PAH",1,1,23,0)
more patients may be selected from the list. After a patient is selected,
"PKG",197,22,1,"PAH",1,1,24,0)
only the clinic orders matching the specified clinic group and date range 
"PKG",197,22,1,"PAH",1,1,25,0)
are displayed.
"PKG",197,22,1,"PAH",1,1,26,0)
 
"PKG",197,22,1,"PAH",1,1,27,0)
When searching by patient, clinic location is not specified, therefore, 
"PKG",197,22,1,"PAH",1,1,28,0)
all clinic orders within the selected date range are displayed, for 
"PKG",197,22,1,"PAH",1,1,29,0)
all clinic locations.
"PKG",197,22,1,"PAH",1,1,30,0)
 
"PKG",197,22,1,"PAH",1,1,31,0)
For searches by clinic and by patient, from the clinic profile view, 
"PKG",197,22,1,"PAH",1,1,32,0)
one or more clinic orders may be selected for start date/time editing.
"PKG",197,22,1,"PAH",1,1,33,0)
The new start date/time is entered once, and applied to all selected
"PKG",197,22,1,"PAH",1,1,34,0)
clinic orders. 
"PKG",197,22,1,"PAH",1,1,35,0)
 
"PKG",197,22,1,"PAH",1,1,36,0)
Two new actions are available from the clinic profile view: VP (View
"PKG",197,22,1,"PAH",1,1,37,0)
Profile), and VD (View Details). The VP (View Profile) action displays 
"PKG",197,22,1,"PAH",1,1,38,0)
the full Inpatient medication profile, and the VD (View Details) action
"PKG",197,22,1,"PAH",1,1,39,0)
prompts for a specific clinic order from the numbered list, and
"PKG",197,22,1,"PAH",1,1,40,0)
displays the detailed view of the order.
"PKG",197,22,1,"PAH",1,1,41,0)
 
"PKG",197,22,1,"PAH",1,1,42,0)
 
"PKG",197,22,1,"PAH",1,1,43,0)
Patient Profile Clinic Orders
"PKG",197,22,1,"PAH",1,1,44,0)
=============================
"PKG",197,22,1,"PAH",1,1,45,0)
Clinic Orders will display in the patient profile grouped by Clinic, 
"PKG",197,22,1,"PAH",1,1,46,0)
separate from non-Clinic Orders. Clinic Orders will display after all 
"PKG",197,22,1,"PAH",1,1,47,0)
active, pending, and non-verified non-Clinic Orders. Non-Active 
"PKG",197,22,1,"PAH",1,1,48,0)
non-Clinic orders will display after Clinic Orders.
"PKG",197,22,1,"PAH",1,1,49,0)
 
"PKG",197,22,1,"PAH",1,1,50,0)
The following menu options, and any actions that execute these options,
"PKG",197,22,1,"PAH",1,1,51,0)
will be enhanced to separate clinic orders from non-clinic orders:
"PKG",197,22,1,"PAH",1,1,52,0)
 
"PKG",197,22,1,"PAH",1,1,53,0)
      Inpatient Order Entry [PSJ OE] 
"PKG",197,22,1,"PAH",1,1,54,0)
      Order Entry [PSJU NE] 
"PKG",197,22,1,"PAH",1,1,55,0)
      Non-Verified/Pending Orders [PSJU VBW] 
"PKG",197,22,1,"PAH",1,1,56,0)
      Order Entry (IV) [PSJI ORDER] 
"PKG",197,22,1,"PAH",1,1,57,0)
      Patient Profile (IV) [PSJI PROFILE]
"PKG",197,22,1,"PAH",1,1,58,0)
      Action Profile  #1 [PSJU AP-1] 
"PKG",197,22,1,"PAH",1,1,59,0)
      Action Profile #2  [PSJU AP-2]
"PKG",197,22,1,"PAH",1,1,60,0)
      Patient Profile (Unit Dose) [PSJU PR]
"PKG",197,22,1,"PAH",1,1,61,0)
 
"PKG",197,22,1,"PAH",1,1,62,0)
 
"PKG",197,22,1,"PAH",1,1,63,0)
Patch Components
"PKG",197,22,1,"PAH",1,1,64,0)
================
"PKG",197,22,1,"PAH",1,1,65,0)
 
"PKG",197,22,1,"PAH",1,1,66,0)
Files & Fields Associated:
"PKG",197,22,1,"PAH",1,1,67,0)
None.
"PKG",197,22,1,"PAH",1,1,68,0)
 
"PKG",197,22,1,"PAH",1,1,69,0)
Forms Associated:
"PKG",197,22,1,"PAH",1,1,70,0)
None. 
"PKG",197,22,1,"PAH",1,1,71,0)
 
"PKG",197,22,1,"PAH",1,1,72,0)
Mail Groups Associated:
"PKG",197,22,1,"PAH",1,1,73,0)
None. 
"PKG",197,22,1,"PAH",1,1,74,0)
 
"PKG",197,22,1,"PAH",1,1,75,0)
Options Associated:
"PKG",197,22,1,"PAH",1,1,76,0)
-------------------
"PKG",197,22,1,"PAH",1,1,77,0)
Clinic Orders Menu                      [PSJ CLINIC ORDERS MENU]
"PKG",197,22,1,"PAH",1,1,78,0)
Edit Clinic Med Orders Start Date/Time  [PSJ ECO]
"PKG",197,22,1,"PAH",1,1,79,0)
Pharmacy Master Menu                    [PHARMACY MASTER MENU]
"PKG",197,22,1,"PAH",1,1,80,0)
Unit Dose Medications                   [PSJU MGR]
"PKG",197,22,1,"PAH",1,1,81,0)
IV Menu                                 [PSJI MGR]
"PKG",197,22,1,"PAH",1,1,82,0)
 
"PKG",197,22,1,"PAH",1,1,83,0)
 
"PKG",197,22,1,"PAH",1,1,84,0)
Protocols Associated:
"PKG",197,22,1,"PAH",1,1,85,0)
---------------------
"PKG",197,22,1,"PAH",1,1,86,0)
PSJ LM ECO HIDDEN ACTIONS
"PKG",197,22,1,"PAH",1,1,87,0)
PSJ LM ECO IM PR
"PKG",197,22,1,"PAH",1,1,88,0)
PSJ LM ECO MENU
"PKG",197,22,1,"PAH",1,1,89,0)
PSJ LM ECO RANGE
"PKG",197,22,1,"PAH",1,1,90,0)
PSJ LM ECO SELECT
"PKG",197,22,1,"PAH",1,1,91,0)
PSJ LM ECO START
"PKG",197,22,1,"PAH",1,1,92,0)
PSJ LM VIEW ORDER DETAIL
"PKG",197,22,1,"PAH",1,1,93,0)
 
"PKG",197,22,1,"PAH",1,1,94,0)
 
"PKG",197,22,1,"PAH",1,1,95,0)
Security Keys Associated:
"PKG",197,22,1,"PAH",1,1,96,0)
None. 
"PKG",197,22,1,"PAH",1,1,97,0)
 
"PKG",197,22,1,"PAH",1,1,98,0)
Templates Associated:
"PKG",197,22,1,"PAH",1,1,99,0)
 
"PKG",197,22,1,"PAH",1,1,100,0)
List Templates
"PKG",197,22,1,"PAH",1,1,101,0)
--------------
"PKG",197,22,1,"PAH",1,1,102,0)
PSJ LM CLINIC ORDER 
"PKG",197,22,1,"PAH",1,1,103,0)
 
"PKG",197,22,1,"PAH",1,1,104,0)
 
"PKG",197,22,1,"PAH",1,1,105,0)
Additional Information:
"PKG",197,22,1,"PAH",1,1,106,0)
  
"PKG",197,22,1,"PAH",1,1,107,0)
 Patient Safety Issues (PSIs)
"PKG",197,22,1,"PAH",1,1,108,0)
 -----------------------------
"PKG",197,22,1,"PAH",1,1,109,0)
  2359 - Provider comments intended for a specific order are copied on
"PKG",197,22,1,"PAH",1,1,110,0)
         another order upon renewal.
"PKG",197,22,1,"PAH",1,1,111,0)
  
"PKG",197,22,1,"PAH",1,1,112,0)
  
"PKG",197,22,1,"PAH",1,1,113,0)
 Remedy Ticket(s) & Overview
"PKG",197,22,1,"PAH",1,1,114,0)
 ---------------------------
"PKG",197,22,1,"PAH",1,1,115,0)
  HD 764596/781899 - Other Print Info display incorrectly.
"PKG",197,22,1,"PAH",1,1,116,0)
  
"PKG",197,22,1,"PAH",1,1,117,0)
   Problem
"PKG",197,22,1,"PAH",1,1,118,0)
   --------
"PKG",197,22,1,"PAH",1,1,119,0)
   When two or more Pending IV renews or Non-Verified edited IV orders
"PKG",197,22,1,"PAH",1,1,120,0)
   containing Other Print Info are selected in Inpatient Order Entry using
"PKG",197,22,1,"PAH",1,1,121,0)
   a dash, 1-3 to view orders 1, 2, and 3, the orders following the first
"PKG",197,22,1,"PAH",1,1,122,0)
   order mistakenly display the first order's Other Print Info. 
"PKG",197,22,1,"PAH",1,1,123,0)
  
"PKG",197,22,1,"PAH",1,1,124,0)
   Solution
"PKG",197,22,1,"PAH",1,1,125,0)
   --------
"PKG",197,22,1,"PAH",1,1,126,0)
   When selecting multiple Pending Renewed IV orders or multiple
"PKG",197,22,1,"PAH",1,1,127,0)
   Non-Verified edited IV orders by using a dash in Inpatient Order Entry,
"PKG",197,22,1,"PAH",1,1,128,0)
   initialize contents of Other Print Info between orders so the Other
"PKG",197,22,1,"PAH",1,1,129,0)
   Print Info is displayed with the proper order.
"PKG",197,22,1,"PAH",1,1,130,0)
 
"PKG",197,22,1,"PAH",1,1,131,0)
 
"PKG",197,22,1,"PAH",1,1,132,0)
  HD 760186 - Other Print Info from IV Quick Code not used.
"PKG",197,22,1,"PAH",1,1,133,0)
  
"PKG",197,22,1,"PAH",1,1,134,0)
   Problem
"PKG",197,22,1,"PAH",1,1,135,0)
   --------
"PKG",197,22,1,"PAH",1,1,136,0)
   Other Print Info copied in from Provider Comments not being overwritten
"PKG",197,22,1,"PAH",1,1,137,0)
   by Other Print info in a selected IV Quick Code.
"PKG",197,22,1,"PAH",1,1,138,0)
 
"PKG",197,22,1,"PAH",1,1,139,0)
   Solution
"PKG",197,22,1,"PAH",1,1,140,0)
   --------
"PKG",197,22,1,"PAH",1,1,141,0)
   Restore previous functionality. When an order that can be finished as 
"PKG",197,22,1,"PAH",1,1,142,0)
   Unit Dose or IV is finished as an IV, and the user is prompted for  
"PKG",197,22,1,"PAH",1,1,143,0)
   Additive, if the finishing pharmacist enters an IV Quick Code that 
"PKG",197,22,1,"PAH",1,1,144,0)
   contains Other Print Info text, that text should overwrite the contents
"PKG",197,22,1,"PAH",1,1,145,0)
   of the order's Other Print Info.
"PKG",197,22,1,"PAH",1,1,146,0)
 
"PKG",197,22,1,"PAH",1,1,147,0)
  
"PKG",197,22,1,"PAH",1,1,148,0)
  HD 763244 - Undefined error in 7 Day Mar.
"PKG",197,22,1,"PAH",1,1,149,0)
  
"PKG",197,22,1,"PAH",1,1,150,0)
   Problem
"PKG",197,22,1,"PAH",1,1,151,0)
   --------
"PKG",197,22,1,"PAH",1,1,152,0)
   Undefined error occurs when printing a PRN IV order in the 7Day MAR
"PKG",197,22,1,"PAH",1,1,153,0)
   [PSJU 7D MAR] option.
"PKG",197,22,1,"PAH",1,1,154,0)
  
"PKG",197,22,1,"PAH",1,1,155,0)
   Solution
"PKG",197,22,1,"PAH",1,1,156,0)
   ---------
"PKG",197,22,1,"PAH",1,1,157,0)
   Prevent undefined error from occurring.
"PKG",197,22,1,"PAH",1,1,158,0)
  
"PKG",197,22,1,"PAH",1,1,159,0)
  
"PKG",197,22,1,"PAH",1,1,160,0)
  HD 756354 - Undefined error in CPRS IV label print.
"PKG",197,22,1,"PAH",1,1,161,0)
  
"PKG",197,22,1,"PAH",1,1,162,0)
   Problem
"PKG",197,22,1,"PAH",1,1,163,0)
   --------
"PKG",197,22,1,"PAH",1,1,164,0)
   Undefined error occurs when printing an IV Label from the Chart Copy
"PKG",197,22,1,"PAH",1,1,165,0)
   dialog after signing an order in CPRS.
"PKG",197,22,1,"PAH",1,1,166,0)
          
"PKG",197,22,1,"PAH",1,1,167,0)
   Solution: Prevent undefined error from occurring.
"PKG",197,22,1,"PAH",1,1,168,0)
  
"PKG",197,22,1,"PAH",1,1,169,0)
  
"PKG",197,22,1,"PAH",1,1,170,0)
  HD 763555 - Wrong intervention recommendation is filed.
"PKG",197,22,1,"PAH",1,1,171,0)
  
"PKG",197,22,1,"PAH",1,1,172,0)
   Problem
"PKG",197,22,1,"PAH",1,1,173,0)
   --------
"PKG",197,22,1,"PAH",1,1,174,0)
   NO ALLERGY ASSESSMENT type of intervention does not file correct
"PKG",197,22,1,"PAH",1,1,175,0)
   recommendation when custom entries are present in the APSP INTERVENTION
"PKG",197,22,1,"PAH",1,1,176,0)
   RECOMMENDATION (#9009032.5) file.
"PKG",197,22,1,"PAH",1,1,177,0)
  
"PKG",197,22,1,"PAH",1,1,178,0)
   Solution
"PKG",197,22,1,"PAH",1,1,179,0)
   ---------
"PKG",197,22,1,"PAH",1,1,180,0)
   Enable the NO ALLERGY ASSESSMENT type of interventions to handle custom
"PKG",197,22,1,"PAH",1,1,181,0)
   entries in the APSP INTERVENTION RECOMMENDATION (#9009032.5) file.
"PKG",197,22,1,"PAH",1,1,182,0)
          
"PKG",197,22,1,"PAH",1,1,183,0)
  
"PKG",197,22,1,"PAH",1,1,184,0)
  HD 770025 - Long Special Instructions not retained after CPRS Renew
"PKG",197,22,1,"PAH",1,1,185,0)
  
"PKG",197,22,1,"PAH",1,1,186,0)
   Problem
"PKG",197,22,1,"PAH",1,1,187,0)
   --------
"PKG",197,22,1,"PAH",1,1,188,0)
   Long Special Instructions (greater than 180 characters) and Other Print
"PKG",197,22,1,"PAH",1,1,189,0)
   Info (greater than 60 characters) are not carried over to the Pending 
"PKG",197,22,1,"PAH",1,1,190,0)
   renewal order after the order is renewed in CPRS.
"PKG",197,22,1,"PAH",1,1,191,0)
  
"PKG",197,22,1,"PAH",1,1,192,0)
   Solution
"PKG",197,22,1,"PAH",1,1,193,0)
   --------
"PKG",197,22,1,"PAH",1,1,194,0)
   Retain long Special Instructions (greater than 180 characters) and
"PKG",197,22,1,"PAH",1,1,195,0)
   Other Print Info (greater than 60 characters) in the Pending renewal
"PKG",197,22,1,"PAH",1,1,196,0)
   order when the order is renewed from CPRS.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
47
"RTN","PSGAP0")
0^22^B32794641^B31836925
"RTN","PSGAP0",1,0)
PSGAP0 ;BIR/CML3-ACTION PROFILE ;20 May 98 / 12:36 PM
"RTN","PSGAP0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**8,58,111,278,275**;16 DEC 97;Build 157
"RTN","PSGAP0",3,0)
 ;
"RTN","PSGAP0",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGAP0",5,0)
 ;
"RTN","PSGAP0",6,0)
GOD ; gather order data
"RTN","PSGAP0",7,0)
 N PSJCLN,CLINSORT
"RTN","PSGAP0",8,0)
 S ND=$G(^PS(55,PSGP,5,PSJJORD,0)),ND2=$G(^(2)),SI=$P($G(^(6)),"^"),DRG=$G(^(.2)) ;WS=$S(DRG&PSGAPWD:$D(^PSI(58.1,"D",+DRG,PSGAPWD)),1:0),DRG=$G(^PS(50.7,+DRG,0))
"RTN","PSGAP0",9,0)
 ;S NF=$P(DRG,"^",9)
"RTN","PSGAP0",10,0)
 S X=$$NFWS^PSJUTL1(PSGP,PSJJORD_"U",PSGAPWD) S NF=$P(X,U),WS=$P(X,U,2),SM=$S('$P(X,U,3):0,$P(X,U,4):1,1:2)
"RTN","PSGAP0",11,0)
 N X,PSG
"RTN","PSGAP0",12,0)
 D DRGDISP^PSJLMUT1(PSGP,PSJJORD_"U",40,0,.PSG,1)
"RTN","PSGAP0",13,0)
 S DRG=PSG(1),DRG=$S(DRG["NOT FOUND":"z",1:DRG)
"RTN","PSGAP0",14,0)
 S ST=$P(ND,"^",9),ND=$P(ND,"^",7),SD=$P(ND2,"^",2),FD=$P(ND2,"^",4)
"RTN","PSGAP0",15,0)
 I STP'=9999999\1,(SD>STP) Q
"RTN","PSGAP0",16,0)
 F X="SD","FD" S @X=$E($$ENDTC^PSGMI(@X),1,5)
"RTN","PSGAP0",17,0)
 ;
"RTN","PSGAP0",18,0)
 S Y=SI S:Y]"" Y=$$ENSET^PSGSICHK(Y)
"RTN","PSGAP0",19,0)
 ; PSJ*5*275 get clinic
"RTN","PSGAP0",20,0)
 S PSJCLN=$$CLINIC^PSJO1(PSGP,+PSJJORD_"U") I (PSJCLN]"") S PSGAWPDN="zz" S CLINSORT=$$CLINSORT^PSJO1($P(ND,"^",9))
"RTN","PSGAP0",21,0)
 S X=$S(($G(PSJCLN)]""):"zz"_U_PSJCLN_U_CLINSORT_U_$E(DRG,1,20),1:ND_U_$E(DRG,1,20))
"RTN","PSGAP0",22,0)
 ;
"RTN","PSGAP0",23,0)
 S ^TMP($J,$E(PSGAPWDN,1,20),TM,PN,X,+PSJJORD)=ST_U_SD_U_FD_U_WS_U_SM_U_NF S:Y]"" ^(PSJJORD,1)=Y
"RTN","PSGAP0",24,0)
 Q
"RTN","PSGAP0",25,0)
 ;
"RTN","PSGAP0",26,0)
PAT ;
"RTN","PSGAP0",27,0)
 S RB=$G(^DPT(PSGP,.101)) S:RB]"" TM=$S('$D(PSGAPTM):"zz",1:$O(^PS(57.7,"AWRT",PSGAPWD,RB,0))) S:$G(TM)="" TM="zz" I PSGAPWDN="" S PSGAPWDN="* NF *"
"RTN","PSGAP0",28,0)
 I $D(PSGAPTM) S ATM="",ATM=$O(PSGAPTM(ATM)) I ATM'="ALL" Q:'$D(PSGAPTM(+TM))
"RTN","PSGAP0",29,0)
 S:TM'="zz" TM=^PS(57.7,PSGAPWD,1,TM,0)
"RTN","PSGAP0",30,0)
 S PSJACNWP=1 D PSJAC2^PSJAC(1),NOW^%DTC S PSGDT=%,PND=PSGP(0),PN=$S($G(PSJSEL("RBP"))="R":RB,1:"")_"^"_$E($P(PND,"^"),1,20)_"^"_PSGP
"RTN","PSGAP0",31,0)
 I '$G(STT) S STT=PSGDT,STP=9999999
"RTN","PSGAP0",32,0)
 S:PSGMTYPE[1 PSGMTYPE="2,3,4,5,6"
"RTN","PSGAP0",33,0)
 I PSGMTYPE[2 D
"RTN","PSGAP0",34,0)
 . F STRT=STT:0 S STRT=$O(^PS(55,PSGP,5,"AUS",STRT)) Q:'STRT  F PSJJORD=0:0 S PSJJORD=$O(^PS(55,PSGP,5,"AUS",STRT,PSJJORD)) Q:'PSJJORD  D GOD
"RTN","PSGAP0",35,0)
 . S XTYPE=2,PST="S" D ^PSGAPIV
"RTN","PSGAP0",36,0)
 N XTYPE F XTYPE=3:1:6 I PSGMTYPE[XTYPE S PST=$S(XTYPE=3:"P",XTYPE=4:"A",XTYPE=5:"H",1:"C") D ^PSGAPIV
"RTN","PSGAP0",37,0)
 I PSGMTYPE[3 S XTYPE=3,PST="S" D ^PSGAPIV ;* Find syringe type iv
"RTN","PSGAP0",38,0)
 I $D(^TMP($J,$E(PSGAPWDN,1,20),TM,PN)) D
"RTN","PSGAP0",39,0)
 . S ^TMP($J,$E(PSGAPWDN,1,20),TM,PN)=$P(PSJPSEX,"^",2)_"^"_$E($P(PSJPDOB,"^",2),1,10)_";"_PSJPAGE_"^"_VA("PID")_"^"_PSJPDX_"^"_$S(PSJPRB]"":PSJPRB,1:"*NF*")_"^"_$E($P(PSJPAD,"^",2),1,10)_"^"_$E($P(PSJPTD,"^",2),1,10)_"^"_+PSJPWT
"RTN","PSGAP0",40,0)
 . S:($G(PSJSEL("WG"))="^OTHER") ^TMP("PSGAP0",$J,"OUTPT",PSGP)=""
"RTN","PSGAP0",41,0)
 Q
"RTN","PSGAP0",42,0)
 ;
"RTN","PSGAP0",43,0)
GDT ;
"RTN","PSGAP0",44,0)
 K %DT S %DT="EFTX",Y=-1,%DT(0)=$S(N["R":PSGDT,1:STT) F  W !!,"Enter ",N," date/time: " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D DTM:X?1."?",^%DT Q:Y>0
"RTN","PSGAP0",45,0)
 I X'="^" S:N["R" STT=$S(Y'>0:PSGDT,Y#1:+$E(Y,1,12),1:Y+.0002)-.0001 S:N["O" STP=$S(Y'>0:9999999,Y#1:+$E(Y,1,12),1:Y+.24)
"RTN","PSGAP0",46,0)
 K %DT Q
"RTN","PSGAP0",47,0)
 ;
"RTN","PSGAP0",48,0)
EN ; entry point
"RTN","PSGAP0",49,0)
 K ^TMP($J)  ;PSJ*5*278
"RTN","PSGAP0",50,0)
 N CLIN,INDEX
"RTN","PSGAP0",51,0)
 I PSGSS'="P" D NOW^%DTC S PSGDT=%,DT=$$DT^XLFDT F N="START","STOP" D GDT I X="^" S PSJSTOP=1 Q
"RTN","PSGAP0",52,0)
 I PSGSS'="P" Q:X="^"  S:'$P(STP,".",2) $P(STP,".",2)=24 S:'$P(STT,".",2) $P(STT,".",2)="0001"
"RTN","PSGAP0",53,0)
 S PSJSTOP=$$MEDTYPE^PSJMDIR($G(PSGWD)) Q:PSJSTOP  S PSGMTYPE=Y
"RTN","PSGAP0",54,0)
 K ZTSAVE S:PSGSS'="P" (ZTSAVE("STT"),ZTSAVE("STP"))="" F X="PSGP","PSGSS","PSGAPWD","PSGAPWG","PSGAPWDN","PSGAPWGN","PSGPAT(","PSGAPTM(","PSGMTYPE","PSGPTMP","PSJSEL(","PSJOS","PPAGE" S ZTSAVE(X)=""
"RTN","PSGAP0",55,0)
 W !,"...this may take a few minutes...(you should QUEUE this report)..."
"RTN","PSGAP0",56,0)
 S PSGTIR="ENQ^PSGAP0",ZTDESC="ACTION PROFILE" D ENDEV^PSGTI S:POP PSJSTOP=1 Q:POP!$D(IO("Q"))
"RTN","PSGAP0",57,0)
 ;
"RTN","PSGAP0",58,0)
ENQ ; queued entry point
"RTN","PSGAP0",59,0)
 K ^TMP("PSGAP0",$J) N RB,ATM,TM,DRGI,DRGN,DRGT,ON,PST,PSIVUP,PSJORIFN,QST,SLS,XTYPE
"RTN","PSGAP0",60,0)
 D @("P"_PSGSS),^PSGAPP D ^%ZISC K ^TMP("PSGAP0",$J)
"RTN","PSGAP0",61,0)
 Q
"RTN","PSGAP0",62,0)
 ;
"RTN","PSGAP0",63,0)
PG ;
"RTN","PSGAP0",64,0)
 I $G(PSJSEL("WG"))="^OTHER" D CLIN Q
"RTN","PSGAP0",65,0)
 F PSGAPWD=0:0 S PSGAPWD=$O(^PS(57.5,"AC",PSGAPWG,PSGAPWD)) Q:'PSGAPWD  I $D(^DIC(42,PSGAPWD,0)),$P(^(0),"^")]"" S PSGAPWDN=$P(^(0),"^") D PW
"RTN","PSGAP0",66,0)
 Q
"RTN","PSGAP0",67,0)
 ;
"RTN","PSGAP0",68,0)
CLIN ;
"RTN","PSGAP0",69,0)
 F INDEX="AIVC","AUDC" S STOP=0 F  S STOP=$O(^PS(55,INDEX,STOP)) Q:'STOP  S CLIN=0 F  S CLIN=$O(^PS(55,INDEX,STOP,CLIN)) Q:'CLIN  D
"RTN","PSGAP0",70,0)
 . S DFN=0 F  S DFN=$O(^PS(55,INDEX,STOP,CLIN,DFN)) Q:'DFN  I '$D(^TMP("PSGAP0",$J,"OUTPT",DFN)) D
"RTN","PSGAP0",71,0)
 .. S PSGP=DFN,Q=STOP N STOP D PAT
"RTN","PSGAP0",72,0)
 Q
"RTN","PSGAP0",73,0)
 ;
"RTN","PSGAP0",74,0)
PW ;
"RTN","PSGAP0",75,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGAPWDN,PSGP)) Q:'PSGP  D
"RTN","PSGAP0",76,0)
 .S Q=$O(^PS(55,PSGP,5,"AUS",STT)) I Q D PAT Q
"RTN","PSGAP0",77,0)
 .S Q=$O(^PS(55,PSGP,"IV","AIS",STT)) I Q D PAT
"RTN","PSGAP0",78,0)
 Q
"RTN","PSGAP0",79,0)
 ;
"RTN","PSGAP0",80,0)
PP ;
"RTN","PSGAP0",81,0)
 F PSGP=0:0 S PSGP=$O(PSGPAT(PSGP)) Q:'PSGP  S PSGAPWDN=$P($G(^DPT(PSGP,.1)),"^") S:PSGAPWDN]"" PSGAPWD=+$O(^DIC(42,"B",PSGAPWDN,0)) D PAT
"RTN","PSGAP0",82,0)
 Q
"RTN","PSGAP0",83,0)
 ;
"RTN","PSGAP0",84,0)
DTM ;
"RTN","PSGAP0",85,0)
 N T
"RTN","PSGAP0",86,0)
 S Y=%DT(0) D D^DIQ S T=$P(Y,"@",2),Y=$P(Y,",")
"RTN","PSGAP0",87,0)
 W !!?2,"If a ",N," date is entered, an action profile will print for only those",!,"patients that have at least one active order with a ",$S(N["A":"STOP",1:"START")," DATE on or ",$S(N["A":"after",1:"before"),!,"the ",N," date entered."
"RTN","PSGAP0",88,0)
 W !?2,"Entry is not required.  If neither date is entered, all patients with active",!,"orders will print (for the ward(s) chosen).  Enter an up-arrow (^) to exit."
"RTN","PSGAP0",89,0)
 W !?2,"If you wish to enter a ",$S(N["R":"start",1:"stop")," date of ",Y,", you must enter a TIME of day",!,"of ",T," or greater.  Any date after ",Y," does not need time entered.",! S Y=-1 Q
"RTN","PSGAPIV")
0^24^B7424595^B6284918
"RTN","PSGAPIV",1,0)
PSGAPIV ;BIR/MV-ACTION PROFILE #1 IV ORDERS ;07 Apr 98 / 1:10 PM
"RTN","PSGAPIV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**9,58,169,275**;16 DEC 97;Build 157
"RTN","PSGAPIV",3,0)
 ;
"RTN","PSGAPIV",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGAPIV",5,0)
 ;
"RTN","PSGAPIV",6,0)
START ;
"RTN","PSGAPIV",7,0)
 NEW P,ON,DRG S ON=""
"RTN","PSGAPIV",8,0)
 F PSGEXPDT=PSGDT:0 S PSGEXPDT=$O(^PS(55,PSGP,"IV","AIT",PST,PSGEXPDT)) Q:'PSGEXPDT  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGEXPDT,ON)) Q:ON=""  D IV
"RTN","PSGAPIV",9,0)
 Q
"RTN","PSGAPIV",10,0)
IV ;
"RTN","PSGAPIV",11,0)
 N X,ON55,PSJCLN,CLINSORT S DFN=PSGP D GT55^PSIVORFB
"RTN","PSGAPIV",12,0)
 I STP'=9999999\1,(P(2)>STP) Q
"RTN","PSGAPIV",13,0)
 Q:"DE"[P(17)
"RTN","PSGAPIV",14,0)
 ; PSJ*5*275 get clinic
"RTN","PSGAPIV",15,0)
 S PSJCLN=$$CLINIC^PSJO1(PSGP,ON) I (PSJCLN]"") S PSGAPWDN="zz"
"RTN","PSGAPIV",16,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGAPIV",17,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGAPIV",18,0)
 I QST'="O" S QST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGAPIV",19,0)
 I DRG S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),DRG=$S(P(4)="H":"* TPN *",1:$E($$ENPDN^PSGMI($P(X,U,6)),1,20))
"RTN","PSGAPIV",20,0)
 I PSJCLN]"" S CLINSORT=$$CLINSORT^PSJO1(QST) S QST="zz"_U_PSJCLN_U_CLINSORT_U_$S(($P(QST,"^")="z"):$P(QST,"^",4),1:QST)
"RTN","PSGAPIV",21,0)
 S ^TMP($J,$E(PSGAPWDN,1,20),TM,PN,QST_U_DRG,ON_"V")=""
"RTN","PSGAPIV",22,0)
 Q
"RTN","PSGAPIV",23,0)
PRT(ON) ;*** Print IV on Action Profile #1.
"RTN","PSGAPIV",24,0)
 NEW TYPE,Y1 S TYPE=$P(DRG,U),ON=+ON
"RTN","PSGAPIV",25,0)
 N ON55,DRG,P,PRTST S DFN=PSGP,PRTST=1 D GT55^PSIVORFB
"RTN","PSGAPIV",26,0)
 F X=2,3 S:P(X) P(X)=$E($$ENDTC^PSGMI(P(X)),1,5)
"RTN","PSGAPIV",27,0)
 S PSJSI=$$ENSET^PSGSICHK($P(P("OPI"),"^"))
"RTN","PSGAPIV",28,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGAPIV",29,0)
 I QST'="O" S QST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGAPIV",30,0)
 W !,$J(N,3),$S(QST="O":"   ",1:"  R")_" D N "  ;PSJ*5*169 Don't allow RENEW on one-time orders.
"RTN","PSGAPIV",31,0)
 I '$D(DRG("AD",0)) D PRTST W !
"RTN","PSGAPIV",32,0)
 I $O(DRG("AD",0)) F X=0:0 S X=$O(DRG("AD",X)) Q:'X  W ?11,$$WRTDRG^PSIVUTL(DRG("AD",X),41) D:X=1 PRTST D NP("AD") G:$G(PSJDLW) EXIT W !
"RTN","PSGAPIV",33,0)
 W ?11,"in "
"RTN","PSGAPIV",34,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D:X>1 NP("SOL") W:X>1 ! W ?14,$$WRTDRG^PSIVUTL(DRG("SOL",X),41) G:$G(PSJDLW) EXIT
"RTN","PSGAPIV",35,0)
 W:P(9)]"" " " W P(9)," ",P(8) D:'$G(DRG("AD",1))&PRTST PRTST
"RTN","PSGAPIV",36,0)
 I PSJSI]"" W !?11,"Special Instructions: " F Y=1:1:$L(PSJSI," ") S Y1=$P(PSJSI," ",Y) W:($L(Y1)+$X)>79 !?33 W Y1_" "
"RTN","PSGAPIV",37,0)
 W !
"RTN","PSGAPIV",38,0)
 Q
"RTN","PSGAPIV",39,0)
PRTST ;*** Print the rest of the 1st line.
"RTN","PSGAPIV",40,0)
 W:PRTST ?52,TYPE,?55,P(2),?61,P(3),?67,P(17)
"RTN","PSGAPIV",41,0)
 S PRTST=0
"RTN","PSGAPIV",42,0)
 Q
"RTN","PSGAPIV",43,0)
NP(TYPE) ;
"RTN","PSGAPIV",44,0)
 NEW X
"RTN","PSGAPIV",45,0)
 D:DRG(TYPE,0)>1&($Y+11>IOSL) NP^PSGAPP
"RTN","PSGAPIV",46,0)
 Q
"RTN","PSGAPIV",47,0)
EXIT ;
"RTN","PSGAPIV",48,0)
 Q
"RTN","PSGAPP")
0^25^B31906580^B27978328
"RTN","PSGAPP",1,0)
PSGAPP ;BIR/CML3-PRINT DATA FOR ACTION PROFILE ;05 Oct 98 / 10:36 AM
"RTN","PSGAPP",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**8,20,60,50,111,169,275**;16 DEC 97;Build 157
"RTN","PSGAPP",3,0)
 ;
"RTN","PSGAPP",4,0)
LOOP ;
"RTN","PSGAPP",5,0)
 N PSJCLNM,PSJCLNM1,PSJCLN S (PSJCLN,PSJCLNM)=""
"RTN","PSGAPP",6,0)
 D NOW^%DTC S PSGDT=%,DT=$$DT^XLFDT,PSGPDT=$$ENDTC2^PSGMI(PSGDT),CML=IO'=IO(0)!($E(IOST,1,2)'="C-")
"RTN","PSGAPP",7,0)
 U IO I '$D(^TMP($J)) W:$Y @IOF W !?28,"UNIT DOSE ACTION PROFILE",?62,PSGPDT,!?10,"NO ACTIVE ORDERS FOUND FOR ",$S(PSGSS="G":"WARD GROUP: "_PSGAPWGN,PSGSS="W":"WARD: "_PSGAPWDN,1:"PATIENT(S) SELECTED"),"." G DONE
"RTN","PSGAPP",8,0)
 S PSGVAMC=$$SITE^PSGMMAR2(80)
"RTN","PSGAPP",9,0)
 S (LN,LINE,ALN)="",$P(LN,"_",19)="",$P(LINE,"-",81)="",$P(ALN," -",18)="",ALN=ALN_" A C T I V E"_ALN
"RTN","PSGAPP",10,0)
 S (PN,WD,TM)="" F  S WD=$O(^TMP($J,WD)) Q:WD=""!$D(PSJDLW)  F  S TM=$O(^TMP($J,WD,TM)) Q:TM=""!$D(PSJDLW)  F  S PN=$O(^TMP($J,WD,TM,PN)) Q:PN=""!$D(PSJDLW)  D
"RTN","PSGAPP",11,0)
 . ;naked reference on line below refers to the full reference on the line above
"RTN","PSGAPP",12,0)
 . S PI=$G(^(PN)),AMO=0 S:PI="" PI=$G(^TMP($J,WD,"zz",PN)) D H1
"RTN","PSGAPP",13,0)
 ;
"RTN","PSGAPP",14,0)
DONE ;
"RTN","PSGAPP",15,0)
 W:CML&($Y) @IOF K AD,ALN,AMO,CML,DF,LINE,LN,MF,N,PG,PI,PPN,PSGPDT,RCT,RF,PID,TD,TM,WD,PSJDLW,PSJTEAM,PSGVAMC,PSJCNTR,PSJAMO Q
"RTN","PSGAPP",16,0)
 ;
"RTN","PSGAPP",17,0)
H1 ;
"RTN","PSGAPP",18,0)
 Q:$D(PSJDLW)
"RTN","PSGAPP",19,0)
 I ($P($G(WD),"^")="z") S PSJCLNM=$P(WD,"^",2) S ALN="" S $P(ALN," -",(80-$L(PSJCLNM))\4)="",ALN=ALN_" "_PSJCLNM_" "_ALN
"RTN","PSGAPP",20,0)
 I $E(IOST,1)="C" K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DTOUT)!$D(DUOUT) PSJDLW=1 I $D(DTOUT)!$D(DUOUT) Q
"RTN","PSGAPP",21,0)
 S (N,DF)=0,PSEX=$P(PI,"^"),PDOB=$P(PI,"^",2),PID=$P(PI,"^",3),RB=$P(PI,"^",5),AD=$P(PI,"^",6),TD=$P(PI,"^",7),WT=$P(PI,"^",8),PI=$P(PI,"^",4),PPN=$P(PN,"^",2),(DFN,PSGP)=$P(PN,"^",3) S:('DFN&($O(PSGPAT("")))) (DFN,PSGP)=$O(PSGPAT(""))
"RTN","PSGAPP",22,0)
 S PAGE=$P(PDOB,";",2),PDOB=$P(PDOB,";"),PG=1 W:$Y @IOF W !?26,"UNIT DOSE ACTION PROFILE #1",?62,PSGPDT
"RTN","PSGAPP",23,0)
 W !?+PSGVAMC,$P(PSGVAMC,U,2)
"RTN","PSGAPP",24,0)
 W !?23,"(Continuation of VA FORM 10-1158)",?72,"Page: 1",!,LINE
"RTN","PSGAPP",25,0)
 W !,"   This form is to be used to REVIEW/RENEW/CANCEL existing active medication",!," orders for inpatients.  Review the active orders listed and beside"
"RTN","PSGAPP",26,0)
 W " each order",!," circle one of the following:",!?30,"R - to RENEW the order",!?30,"D - to DISCONTINUE the order",!?30,"N - to take NO ACTION (the order will remain",!?34,"active until the stop date indicated)"
"RTN","PSGAPP",27,0)
 W !!,"   A new order must be written for any new medication or to make any changes",!," in dosage or directions on an existing order.",!,LINE,!
"RTN","PSGAPP",28,0)
 S PSJOPC="" D ENTRY^PSJHEAD(DFN,PSJOPC,PG,$G(PSJNARC),$G(PSJTEAM,1),1)
"RTN","PSGAPP",29,0)
 W !,LINE,!," No. Action",?16,"Drug",?52,"ST Start Stop  Status/Info",!,ALN
"RTN","PSGAPP",30,0)
END ;
"RTN","PSGAPP",31,0)
 N ON S (ON,DRG)="" F  S DRG=$O(^TMP($J,WD,TM,PN,DRG)) Q:DRG=""  F  S ON=$O(^TMP($J,WD,TM,PN,DRG,ON)) Q:ON=""  D
"RTN","PSGAPP",32,0)
 .I ($P(DRG,"^")="zz") S PSJCLNM1=$G(PSJCLNM) S PSJCLN=+$G(^PS(55,PSGP,5,+ON,8)) I PSJCLN S PSJCLNM=$P($G(^SC(+PSJCLN,0)),"^") I PSJCLNM'=PSJCLNM1 D
"RTN","PSGAPP",33,0)
 ..S ALN="" S $P(ALN," -",(80-$L(PSJCLNM))\4)="",ALN=ALN_" "_PSJCLNM_" "_ALN W !,ALN
"RTN","PSGAPP",34,0)
 .S ND=^TMP($J,WD,TM,PN,DRG,ON),SI=$G(^(ON,1)) D NP:$Y+11>IOSL Q:$D(PSJDLW)  D ORDP
"RTN","PSGAPP",35,0)
 Q:$D(PSJDLW)
"RTN","PSGAPP",36,0)
 I $D(^PS(53.1,"AC",PSGP)) W !!?13,"******** THIS PATIENT HAS NON-VERIFIED ORDERS. ********"
"RTN","PSGAPP",37,0)
 S DF=1 W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGAPP",38,0)
 D:$Y+11>IOSL NP1 W:'$D(PSJDLW) !!!?10,"MULTIDISCIPLINARY REVIEW",!?16,"(WHEN APPROPRIATE)",?40,LN_LN,!?40,"PHARMACIST'S SIGNATURE"
"RTN","PSGAPP",39,0)
 D:$Y+7>IOSL NP1 W:'$D(PSJDLW) !!?40,LN_LN,!?40,"NURSE'S SIGNATURE"
"RTN","PSGAPP",40,0)
 ; PSJ*5*169 Standardize AMO section to 10 lines.
"RTN","PSGAPP",41,0)
 N PSJCNTR,PSJAMO
"RTN","PSGAPP",42,0)
 I IOSL-$Y>11 D
"RTN","PSGAPP",43,0)
 . W !!?3,"ADDITIONAL MEDICATION ORDERS:"
"RTN","PSGAPP",44,0)
 . F PSJCNTR=1:1:10 W !!,LINE S PSJAMO=0 I $Y+9>IOSL S PSJAMO=1 D NP1
"RTN","PSGAPP",45,0)
 . S AMO=1
"RTN","PSGAPP",46,0)
 I  W !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE",!
"RTN","PSGAPP",47,0)
 E  I $Y+6<IOSL F Q=$Y+5:1:IOSL-1 W !
"RTN","PSGAPP",48,0)
 W:'$D(PSJDLW) !?2,PPN,?40,PID,?78-$L(PDOB),PDOB
"RTN","PSGAPP",49,0)
 ; PSJ*5*169 Standardize AMO section to 10 lines.
"RTN","PSGAPP",50,0)
 I 'AMO D
"RTN","PSGAPP",51,0)
 .S AMO=1 D NP1 Q:$D(PSJDLW)  D
"RTN","PSGAPP",52,0)
 . . W !!?3,"ADDITIONAL MEDICATION ORDERS:"
"RTN","PSGAPP",53,0)
 . . F PSJCNTR=1:1:10 W !!,LINE S PSJAMO=0 I $Y+9>IOSL S PSJAMO=1 D NP1
"RTN","PSGAPP",54,0)
 .W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE",!
"RTN","PSGAPP",55,0)
 .W:'$D(PSJDLW) !?2,PPN,?40,PID,?78-$L(PDOB),PDOB
"RTN","PSGAPP",56,0)
 Q
"RTN","PSGAPP",57,0)
 ;
"RTN","PSGAPP",58,0)
ORDP ;
"RTN","PSGAPP",59,0)
 N DRG2 I ($P(DRG,"^")="zz") S DRG2=DRG N DRG S DRG=$P(DRG2,"^",3)
"RTN","PSGAPP",60,0)
 S N=N+1 I ND="" D PRT^PSGAPIV(ON) Q
"RTN","PSGAPP",61,0)
 N X,PSG S PSGP=$P(PN,U,3)
"RTN","PSGAPP",62,0)
 D DRGDISP^PSJLMUT1(+PSGP,+ON_"U",39,65,.PSG,0)
"RTN","PSGAPP",63,0)
 S SM=$P(ND,"^",5),NF=$P(ND,"^",6) W !,$J(N,3) W $S($P(DRG,"^")="O":"   ",1:"  R")_" D N "  ;PSJ*5*169 Don't allow RENEW for one-time orders.
"RTN","PSGAPP",64,0)
 W PSG(1),?52,$P(DRG,U),?55,$P(ND,U,2),?61,$P(ND,U,3),?67,$P(ND,U) I NF!SM!$P(ND,U,4) W ?71 W:NF "NF " W:$P(ND,U,4) "WS " W:SM $E("HSM",SM,3)
"RTN","PSGAPP",65,0)
 N X F X=1:0 S X=$O(PSG(X)) Q:'X  W !?11,PSG(X)
"RTN","PSGAPP",66,0)
 I SI]"" W !?11,"Special Instructions: " D
"RTN","PSGAPP",67,0)
 .N Y F X=1:1:$L(SI," ") S Y=$P(SI," ",X) W:$X+$L(Y)>78 !?35 W Y," "
"RTN","PSGAPP",68,0)
 W ! Q
"RTN","PSGAPP",69,0)
 ;
"RTN","PSGAPP",70,0)
NP ;
"RTN","PSGAPP",71,0)
 Q:$G(PSJDLW)
"RTN","PSGAPP",72,0)
 W !!?16,LN,?40,LN_LN,!?16,"Date and Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGAPP",73,0)
 ;
"RTN","PSGAPP",74,0)
NP1 ;
"RTN","PSGAPP",75,0)
 Q:$D(PSJDLW)
"RTN","PSGAPP",76,0)
 I $E(IOST,1)="C" K DIR S DIR(0)="E" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S PSJDLW=1 Q
"RTN","PSGAPP",77,0)
 I $Y+5<IOSL F Q=$Y:1:IOSL-4 W !
"RTN","PSGAPP",78,0)
 S PG=PG+1 W:'AMO !?2,PPN,?40,PID,?78-$L(PDOB),PDOB W:$Y @IOF W !?26,"UNIT DOSE ACTION PROFILE #1",?73-$L(PG),"Page: "_PG
"RTN","PSGAPP",79,0)
 W !?+PSGVAMC,$P(PSGVAMC,U,2)
"RTN","PSGAPP",80,0)
 W !?1,PPN,?40,PID,?60,PDOB
"RTN","PSGAPP",81,0)
 ; PSJ*5*169 Standardize AMO section to 10 lines.
"RTN","PSGAPP",82,0)
 I DF D  Q
"RTN","PSGAPP",83,0)
 . I $G(PSJAMO)=1 W !!,"ADDITIONAL MEDICATION ORDERS (CONTINUED):",! Q
"RTN","PSGAPP",84,0)
 . W !!,LINE
"RTN","PSGAPP",85,0)
 W:'AMO !!," No. Action",?16,"Drug",?52,"ST Start Stop  Status/Info",!,ALN Q
"RTN","PSGAPP",86,0)
 ;
"RTN","PSGAPP",87,0)
ENRCT ;
"RTN","PSGAPP",88,0)
 N DFN,GMRA,GMRAL,RCT,X S DFN=PSGP,GMRA="0^0^111" D EN1^GMRADPT
"RTN","PSGAPP",89,0)
 S X=0 F  S X=$O(GMRAL(X)) Q:'X  I $P(GMRAL(X),"^",2)]"" S RCT($P(GMRAL(X),"^",2))=""
"RTN","PSGAPP",90,0)
 I '$D(RCT) W " ____________________" Q
"RTN","PSGAPP",91,0)
 S RCT="" F X=0:1 S RCT=$O(RCT(RCT)) Q:RCT=""  W:X "," W:$X+$L(RCT)>77 ! W " ",$S(RCT="NKA":"No Known Allergies",1:RCT)
"RTN","PSGAPP",92,0)
 Q
"RTN","PSGCAP0")
0^32^B23579520^B21979348
"RTN","PSGCAP0",1,0)
PSGCAP0 ;BIR/CML3-ACTION PROFILE ;12 Mar 98 / 9:30 AM
"RTN","PSGCAP0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**8,58,111,149,275**;16 DEC 97;Build 157
"RTN","PSGCAP0",3,0)
 ;
"RTN","PSGCAP0",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGCAP0",5,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGCAP0",6,0)
 ;
"RTN","PSGCAP0",7,0)
GOD ; gather order data
"RTN","PSGCAP0",8,0)
 S ND=$G(^PS(55,PSGP,5,PSJJORD,0)),ND2=$G(^(2)),SI=$P($G(^(6)),"^"),DRG=$G(^(.2)) ;WS=$S(DRG&PSGAPWD:$D(^PSI(58.1,"D",+DRG,PSGAPWD)),1:0)
"RTN","PSGCAP0",9,0)
 S X=$$NFWS^PSJUTL1(PSGP,PSJJORD_"U",PSGAPWD) S NF=$P(X,U),WS=$P(X,U,2),SM=$S('$P(X,U,3):0,$P(X,U,4):1,1:2)
"RTN","PSGCAP0",10,0)
 N X,PSG
"RTN","PSGCAP0",11,0)
 D DRGDISP^PSJLMUT1(PSGP,PSJJORD_"U",20,0,.PSG,1)
"RTN","PSGCAP0",12,0)
 S DRG=PSG(1),DRG=$S(DRG["NOT FOUND":"z",1:DRG) ;SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2)
"RTN","PSGCAP0",13,0)
 S ST=$S($P(ND,U,27)="R"&($P(ND,U,9)="A"):"R",1:$P(ND,U,9)),ND=$P(ND,"^",7)
"RTN","PSGCAP0",14,0)
 N DDRG S (X,DCU)=0 F  S X=$O(^PS(55,PSGP,5,PSJJORD,1,X)) Q:'X  S DDRG=^(X,0),DCU=DCU+($P($G(^PSDRUG(+DDRG,660)),"^",6)*($S($P(DDRG,"^",2):$P(DDRG,"^",2),1:1)))
"RTN","PSGCAP0",15,0)
 ;
"RTN","PSGCAP0",16,0)
 ; PSJ*5*275 get clinic
"RTN","PSGCAP0",17,0)
 S PSGAPWDN="zz"
"RTN","PSGCAP0",18,0)
 N PSJCLN,CLINSORT S PSJCLN=$$CLINIC^PSJO1(PSGP,PSJJORD_"U") I (PSJCLN]"") S CLINSORT=$$CLINSORT^PSJO1($G(ST)) I CLINSORT S PSGAPWDN="zz"_U_PSJCLN_U_CLINSORT_U_ST
"RTN","PSGCAP0",19,0)
 ;
"RTN","PSGCAP0",20,0)
 S SD=$P(ND2,"^",2),FD=$P(ND2,"^",4) F X="SD","FD" S @X=$E($$ENDTC^PSGMI(@X),1,5)
"RTN","PSGCAP0",21,0)
 ;
"RTN","PSGCAP0",22,0)
 S Y=SI S:Y]"" Y=$$ENSET^PSGSICHK(Y)
"RTN","PSGCAP0",23,0)
 S PSGAPWDN=$S($P($G(PSGAPWDN),"^")="zz":PSGAPWDN,$G(PSGAPWDN):PSGAPWDN,'$G(PSGAPWDN):PSJPWDN,1:"zz"),^TMP($J,S1,PSGAPWDN,PN,ND_"^"_DRG,PSJJORD)=ST_"^"_SD_"^"_FD_"^"_WS_"^"_SM_"^"_NF_"^"_DCU_"^"_DRG S:Y]"" ^(PSJJORD,1)=Y Q
"RTN","PSGCAP0",24,0)
 ;
"RTN","PSGCAP0",25,0)
PAT ;
"RTN","PSGCAP0",26,0)
 D PSJAC2^PSJAC(1),NOW^%DTC S PSGDT=%,PN=$E($P(PSGP(0),"^"),1,20)_"^"_PSGP
"RTN","PSGCAP0",27,0)
 S S1="zz" I PSGAPS="T",PSJPWD,PSJPRB]"",$D(^PS(57.7,PSJPWD,1,+$O(^PS(57.7,"AWRT",PSJPWD,PSJPRB,0)),0)),$P(^(0),"^")]"" S S1=$P(^(0),"^")
"RTN","PSGCAP0",28,0)
 I PSGAPS="P",PSJPTSP,$D(^VA(200,PSJPTSP,0)),$P(^(0),"^")]"" S S1=$P(^(0),"^")
"RTN","PSGCAP0",29,0)
 S:PSGMTYPE[1 PSGMTYPE="2,3,4,5,6"
"RTN","PSGCAP0",30,0)
 I PSGMTYPE[2 D
"RTN","PSGCAP0",31,0)
 . F STRT=PSGAPSD-.0001:0 S STRT=$O(^PS(55,PSGP,5,"AUS",STRT)) Q:$S('STRT:1,PSGAPO="E":STRT>PSGAPFD,1:0)  I STRT'=PSGAPSD F PSJJORD=0:0 S PSJJORD=$O(^PS(55,PSGP,5,"AUS",STRT,PSJJORD)) Q:'PSJJORD  D GOD
"RTN","PSGCAP0",32,0)
 . S XTYPE=2,PST="S" D ^PSGCAPIV
"RTN","PSGCAP0",33,0)
 N XTYPE F XTYPE=3:1:6 I PSGMTYPE[XTYPE S PST=$S(XTYPE=3:"P",XTYPE=4:"A",XTYPE=5:"H",1:"C") D ^PSGCAPIV
"RTN","PSGCAP0",34,0)
 I PSGMTYPE[3 S XTYPE=3,PST="S" D ^PSGCAPIV ;* Find syringe type iv
"RTN","PSGCAP0",35,0)
 I $D(^TMP($J,S1,PSGAPWDN,PN)) S ^(PN)=$P(PSJPSEX,"^",2)_"^"_$E($P(PSJPDOB,"^",2),1,10)_";"_PSJPAGE_"^"_VA("PID")_"^"_PSJPDX_"^"_$S(PSJPRB]"":PSJPRB,1:"*NF*")_"^"_$E($P(PSJPAD,"^",2),1,10)_"^"_$E($P(PSJPTD,"^",2),1,10)
"RTN","PSGCAP0",36,0)
 I  S ^TMP($J,S1,PSGAPWDN,PN)=^(PN)_"^"_PSJPWT_"^"_PSJPWTD_"^"_PSJPHT_"^"_PSJPHTD_"^"_$P(PSGP(0),"^")
"RTN","PSGCAP0",37,0)
 Q
"RTN","PSGCAP0",38,0)
 ;
"RTN","PSGCAP0",39,0)
ENQ ; queued entry point
"RTN","PSGCAP0",40,0)
 N ALFLG,DCU,DRGI,DRGN,DRGT,KKA,HT,HTD,ON,PST,PSIVUP,PSJORIFN,QST,WTD,XTYPE
"RTN","PSGCAP0",41,0)
 K ^TMP($J) S STT=PSGAPSD-.0001,PSJACNWP=1 D @("P"_PSGSS),^PSGCAPP D ^%ZISC
"RTN","PSGCAP0",42,0)
 Q
"RTN","PSGCAP0",43,0)
 ;
"RTN","PSGCAP0",44,0)
PG ;
"RTN","PSGCAP0",45,0)
 I PSGAPWD="zz" D CLIN Q
"RTN","PSGCAP0",46,0)
 F PSGAPWD=0:0 S PSGAPWD=$O(^PS(57.5,"AC",PSGAPWG,PSGAPWD)) Q:'PSGAPWD  I $D(^DIC(42,PSGAPWD,0)),$P(^(0),"^")]"" S PSGAPWDN=$P(^(0),"^") D PW
"RTN","PSGCAP0",47,0)
 Q
"RTN","PSGCAP0",48,0)
 ;
"RTN","PSGCAP0",49,0)
PW ;
"RTN","PSGCAP0",50,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGAPWDN,PSGP)) Q:'PSGP  D PAT
"RTN","PSGCAP0",51,0)
 Q
"RTN","PSGCAP0",52,0)
 ;
"RTN","PSGCAP0",53,0)
PP ;
"RTN","PSGCAP0",54,0)
 F PSGP=0:0 S PSGP=$O(PSGPAT(PSGP)) Q:'PSGP  S PSGAPWDN=$P($G(^DPT(PSGP,.1)),"^") S:PSGAPWDN]"" PSGAPWD=+$O(^DIC(42,"B",PSGAPWDN,0)) S:PSGAPWDN="" PSGAPWDN="zz" D PAT
"RTN","PSGCAP0",55,0)
 Q
"RTN","PSGCAP0",56,0)
 ;
"RTN","PSGCAP0",57,0)
PL S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D PC
"RTN","PSGCAP0",58,0)
 Q
"RTN","PSGCAP0",59,0)
PC S PSGAPWDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGCAP0",60,0)
 S PSGP="" F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:PSGP=""  D PAT
"RTN","PSGCAP0",61,0)
 N INDEX,APSTOP
"RTN","PSGCAP0",62,0)
 F INDEX="AIVC","AUDC" S APSTOP=0 F  S APSTOP=$O(^PS(55,INDEX,APSTOP)) Q:'APSTOP  D
"RTN","PSGCAP0",63,0)
 . S DFN=0 F  S DFN=$O(^PS(55,INDEX,APSTOP,CL,DFN)) Q:'DFN  I '$D(^TMP("PSGAP0",$J,"OUTPT",DFN)) S PSGP=DFN,Q=APSTOP,PSGAPWD="zz" D PAT
"RTN","PSGCAP0",64,0)
 Q
"RTN","PSGCAP0",65,0)
CLIN ;
"RTN","PSGCAP0",66,0)
 N INDEX,APSTOP,CLIN
"RTN","PSGCAP0",67,0)
 F INDEX="AIVC","AUDC" S APSTOP=0 F  S APSTOP=$O(^PS(55,INDEX,APSTOP)) Q:'APSTOP  S CLIN=0 F  S CLIN=$O(^PS(55,INDEX,APSTOP,CLIN)) Q:'CLIN  D
"RTN","PSGCAP0",68,0)
 . S DFN=0 F  S DFN=$O(^PS(55,INDEX,APSTOP,CLIN,DFN)) Q:'DFN  I '$D(^TMP("PSGAP0",$J,"OUTPT",DFN)) S PSGP=DFN,Q=APSTOP,PSGAPWD="zz" D PAT
"RTN","PSGCAP0",69,0)
 Q
"RTN","PSGCAP0",70,0)
 ;
"RTN","PSGCAP0",71,0)
ENOR ;
"RTN","PSGCAP0",72,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGCAP0",73,0)
 S (DFN,PSGP)=+ORVP D ^PSJAC S PSGPAT=PSGP,PSGPAT(DFN)="",(PSGAP,PSGAPWD,PSGAPWG)=0,(PSGAPWDN,PSGAPWGN)="",PSGSS="P" D ORS^PSGCAP S PSJNKF=1 D DONE^PSGCAP Q
"RTN","PSGCAPP")
0^33^B20267187^B15658306
"RTN","PSGCAPP",1,0)
PSGCAPP ;BIR/CML3-PRINT DATA FOR ACTION PROFILE ;05 Oct 98 / 10:21 AM
"RTN","PSGCAPP",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**8,20,60,111,149,169,275**;16 DEC 97;Build 157
"RTN","PSGCAPP",3,0)
LOOP ;
"RTN","PSGCAPP",4,0)
 N PSJCLIN1
"RTN","PSGCAPP",5,0)
 D NOW^%DTC S PSGDT=%,PSGPDT=$$ENDTC2^PSGMI(PSGDT),CML=IO'=IO(0)!($E(IOST,1,2)'="C-")
"RTN","PSGCAPP",6,0)
 U IO I '$D(^TMP($J)) D  G DONE
"RTN","PSGCAPP",7,0)
 .W:$Y @IOF W !?26,"UNIT DOSE ACTION PROFILE #2",?62,PSGPDT,!?10,"NO ",$S(PSGAPO="E":"EXPIRING",1:"ACTIVE")," ORDERS FOUND FOR ",$S(PSGSS="G":"WARD GROUP: "_PSGAPWGN,PSGSS="W":"WARD: "_PSGAPWDN,1:"PATIENT(S) SELECTED"),"."
"RTN","PSGCAPP",8,0)
 S (LN,LINE,ALN,S1,WD,PN)="",$P(LN,"_",19)="",$P(LINE,"-",81)="",$P(ALN," -",18)="",ALN=ALN_" A C T I V E"_ALN
"RTN","PSGCAPP",9,0)
 S PSGVAMC=$$SITE^PSGMMAR2(80)
"RTN","PSGCAPP",10,0)
 F  S (PS1,S1,PSJTEAM)=$O(^TMP($J,S1)) Q:S1=""!$D(PSJDLW)  S:S1="zz" (PS1,PSJTEAM)="NOT FOUND" F  S WD=$O(^TMP($J,S1,WD)) Q:WD=""!$D(PSJDLW)  D
"RTN","PSGCAPP",11,0)
 . F  S PN=$O(^TMP($J,S1,WD,PN)) Q:PN=""!$D(PSJDLW)  S PI=$G(^(PN)) S:PI="" PI=$G(^TMP($J,S1,"zz",PN)) D H1
"RTN","PSGCAPP",12,0)
 ;
"RTN","PSGCAPP",13,0)
DONE ;PSJ*5*149 Add WD1 to killed variables.
"RTN","PSGCAPP",14,0)
 W:CML&($Y) @IOF K AD,ALN,CML,DF,LINE,LN,MF,N,PG,PI,PPN,PS1,PSGPDT,RCT,RF,PID,TD,WD,PSJDLW,PSGVAMC,WD1,PSJCNTR,PSJAMO Q
"RTN","PSGCAPP",15,0)
 ;
"RTN","PSGCAPP",16,0)
H1 ; first header for patient
"RTN","PSGCAPP",17,0)
 ; PSJ*5*149 Use WD1 to preserve value of WD
"RTN","PSGCAPP",18,0)
 N WD1
"RTN","PSGCAPP",19,0)
 I $P(WD,"^")="zz",($P(WD,"^",2)]"") I ($P(WD,"^",2)'=$P($G(PSJCLIN1),"^",2)) S PSJCLIN1=WD D
"RTN","PSGCAPP",20,0)
 .N MIDLEN,SIDLEN S MIDLEN=$L($P(PSJCLIN1,"^",2)) S SIDLEN=((81-MIDLEN)\2)
"RTN","PSGCAPP",21,0)
 .S (LN,LINE,ALN)="",$P(LN,"_",(SIDLEN\2))="",$P(LINE,"-",81)="",$P(ALN," -",(SIDLEN\2))="",ALN=ALN_$P(PSJCLIN1,"^",2)_ALN
"RTN","PSGCAPP",22,0)
 I $G(WD)="zz" S WD1=WD N WD S WD="*NF*"
"RTN","PSGCAPP",23,0)
 D ^PSGCAPP0
"RTN","PSGCAPP",24,0)
 S WD=$G(WD1,WD)
"RTN","PSGCAPP",25,0)
END ;
"RTN","PSGCAPP",26,0)
 S (ON,DRG)="" F  S DRG=$O(^TMP($J,S1,WD,PN,DRG)) Q:DRG=""  F  S ON=$O(^TMP($J,S1,WD,PN,DRG,ON)) Q:ON=""  S ND=^(ON),SI=$G(^(ON,1)) D NP:$Y+12>IOSL Q:$D(PSJDLW)  D ORDP
"RTN","PSGCAPP",27,0)
 Q:$D(PSJDLW)
"RTN","PSGCAPP",28,0)
 I $D(^PS(53.1,"AC",PSGP)) W !!?13,"******** THIS PATIENT HAS NON-VERIFIED ORDERS. ********"
"RTN","PSGCAPP",29,0)
 S DF=1 W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGCAPP",30,0)
 D:$Y+10>IOSL NP1 W:'$D(PSJDLW) !!!?10,"MULTIDISCIPLINARY REVIEW",!?16,"(WHEN APPROPRIATE)",?40,LN_LN,!?40,"PHARMACIST'S SIGNATURE"
"RTN","PSGCAPP",31,0)
 D:$Y+6>IOSL NP1 W:'$D(PSJDLW) !!?40,LN_LN,!?40,"NURSE'S SIGNATURE"
"RTN","PSGCAPP",32,0)
 ; PSJ*5*169 Standardize AMO section to 10 lines.
"RTN","PSGCAPP",33,0)
 N PSJCNTR,PSJAMO
"RTN","PSGCAPP",34,0)
 I IOSL-$Y>10 D
"RTN","PSGCAPP",35,0)
 . W !!?3,"ADDITIONAL MEDICATION ORDERS:"
"RTN","PSGCAPP",36,0)
 . F PSJCNTR=1:1:10 W !!,LINE S PSJAMO=0 I $Y+9>IOSL S PSJAMO=1 D NP1
"RTN","PSGCAPP",37,0)
 I  W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE",!
"RTN","PSGCAPP",38,0)
 E  F Q=$Y+5:1:IOSL-1 W !
"RTN","PSGCAPP",39,0)
 W:'$D(PSJDLW) !?2,PPN,?40,PID,?78-$L(PDOB),PDOB Q
"RTN","PSGCAPP",40,0)
 ;
"RTN","PSGCAPP",41,0)
ORDP ;
"RTN","PSGCAPP",42,0)
 S N=N+1 I ON["V" D PRT^PSGCAPIV(ON) Q
"RTN","PSGCAPP",43,0)
 N X,PSG S PSGP=$P(PN,U,2)
"RTN","PSGCAPP",44,0)
 D DRGDISP^PSJLMUT1(+PSGP,+ON_"U",39,69,.PSG,0)
"RTN","PSGCAPP",45,0)
 S SM=$P(ND,"^",5),NF=$P(ND,"^",6),DCU=$P(ND,"^",7),DCU=$S($E(DCU)=".":"0"_DCU,'DCU:"0.00",1:DCU) W !,$J(N,3)
"RTN","PSGCAPP",46,0)
 W ?5,PSG(1),?46,$P(DRG,"^"),?49,$P(ND,"^",2),?55,$P(ND,"^",3),?61,$P(ND,"^") I NF!SM!$P(ND,"^",4) W ?65 W:NF "NF " W:$P(ND,"^",4) "WS " W:SM $E("HSM",SM,3)
"RTN","PSGCAPP",47,0)
 N X F X=1:0 S X=$O(PSG(X)) Q:'X  W !?5,PSG(X)
"RTN","PSGCAPP",48,0)
 I SI]"" W !?8,"Special Instructions: " F X=1:1:$L(SI," ") S Y=$P(SI," ",X) W:$X+$L(Y)>78 !?31 W Y," "
"RTN","PSGCAPP",49,0)
ORDP1 ;*** Also being called from ^PSGCAPIV.   PSJ*5*169 Don't allow RENEW on one-time orders.
"RTN","PSGCAPP",50,0)
 W !!?5,"__TAKE NO ACTION     __DISCONTINUE     "_$S($P(DRG,"^")="O"!($G(QST)="O"):"       ",1:"__RENEW")_"   COST/DOSE: ",DCU,!?2,"------------------------------------------------------------------------",! Q
"RTN","PSGCAPP",51,0)
 ;
"RTN","PSGCAPP",52,0)
NP ;
"RTN","PSGCAPP",53,0)
 W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGCAPP",54,0)
 ;
"RTN","PSGCAPP",55,0)
NP1 ;
"RTN","PSGCAPP",56,0)
 Q:$D(PSJDLW)
"RTN","PSGCAPP",57,0)
 I $E(IOST,1)="C" K DIR S DIR(0)="E" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S PSJDLW=1 Q
"RTN","PSGCAPP",58,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSGCAPP",59,0)
 I '$G(PG),$P($G(PI),"^",3) S (N,DF)=0,PSEX=$P(PI,"^"),PDOB=$P(PI,"^",2),PID=$P(PI,"^",3),RB=$P(PI,"^",5),AD=$P(PI,"^",6),TD=$P(PI,"^",7),WT=$P(PI,"^",8),WTD=$P(PI,"^",9),HT=$P(PI,"^",10),HTD=$P(PI,"^",11),PPN=$P(PI,"^",12),PSGP=$P(PN,"^",2) D
"RTN","PSGCAPP",60,0)
 .S PAGE=$P(PDOB,";",2),PDOB=$P(PDOB,";"),PG=1
"RTN","PSGCAPP",61,0)
 ;* S PG=PG+1 W !?2,PPN,?40,PID,?78-$L(PDOB),PDOB W:$Y @IOF W !?28,"UNIT DOSE ACTION PROFILE #2",?73-$L(PG),"Page: "_PG,!?1,PPN,?40,PID,?60,PDOB I DF W !!,LINE Q
"RTN","PSGCAPP",62,0)
 S PG=$G(PG)+1 W !?2,PPN,?40,PID,?78-$L(PDOB),PDOB W:$Y @IOF
"RTN","PSGCAPP",63,0)
 W !?26,"UNIT DOSE ACTION PROFILE #2",?73-$L(PG),"Page: "_PG
"RTN","PSGCAPP",64,0)
 W !?+PSGVAMC,$P(PSGVAMC,U,2)
"RTN","PSGCAPP",65,0)
 W !?1,PPN,?40,PID,?60,PDOB
"RTN","PSGCAPP",66,0)
 I DF D  Q
"RTN","PSGCAPP",67,0)
 . I $G(PSJAMO)=1 W !!,"ADDITIONAL MEDICATION ORDERS (CONTINUED):",! Q
"RTN","PSGCAPP",68,0)
 . W !!,LINE
"RTN","PSGCAPP",69,0)
 W !!," No. Action",?16,"Drug",?46,"ST Start Stop  Status/Info",!,ALN
"RTN","PSGCAPP",70,0)
 Q
"RTN","PSGMIV")
0^50^B42880298^B42223209
"RTN","PSGMIV",1,0)
PSGMIV ;BIR/MV-IV ORDER FOR THE 24 HOUR MAR. ;25 Nov 98 / 9:07 AM
"RTN","PSGMIV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,20,21,28,58,111,131,145,267,275**;16 DEC 97;Build 157
"RTN","PSGMIV",3,0)
 ;
"RTN","PSGMIV",4,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMIV",5,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMIV",6,0)
 ;
"RTN","PSGMIV",7,0)
START ;*** Read IV orders
"RTN","PSGMIV",8,0)
 S ON=""
"RTN","PSGMIV",9,0)
 F PSGMARED=PSGPLS-.0001:0 S PSGMARED=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED)) Q:'PSGMARED  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED,ON)) Q:ON=""  D IV
"RTN","PSGMIV",10,0)
 Q
"RTN","PSGMIV",11,0)
IV ;*** Sort IV orders for 24 Hrs MAR.
"RTN","PSGMIV",12,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT55^PSIVORFB
"RTN","PSGMIV",13,0)
 Q:P(2)>PSGPLF
"RTN","PSGMIV",14,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGMIV",15,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGMIV",16,0)
 S QST=$S(P(9)["PRN":"OVP",QST="O":"OVO",1:"CV")_XTYPE
"RTN","PSGMIV",17,0)
 N PSGMARWC  ;DEM (05/30/2006) - PSGMARWC is used to preserve original value of PSGMARWN (patient location) in case location is changed by an order with a clinic location.
"RTN","PSGMIV",18,0)
 S PSGMARWC=PSGMARWN
"RTN","PSGMIV",19,0)
 I $G(DRG) S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_ON_"V" D
"RTN","PSGMIV",20,0)
 . N A
"RTN","PSGMIV",21,0)
 . S A=$G(^PS(55,PSGP,"IV",+ON,"DSS")) I $P(A,"^")]"" S PSGMARWN="C!"_$P(A,"^") I $G(SUB1)]"",$G(SUB2)]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D
"RTN","PSGMIV",22,0)
 . . N X,X1,Y
"RTN","PSGMIV",23,0)
 . . D SPN^PSGMAR0
"RTN","PSGMIV",24,0)
 . . Q
"RTN","PSGMIV",25,0)
 . I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q
"RTN","PSGMIV",26,0)
 . S:PSGRBPPN="P" ^TMP($J,TM,PSGMARWN,PPN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMIV",27,0)
 . S:PSGRBPPN="R" ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMIV",28,0)
 S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC
"RTN","PSGMIV",29,0)
 Q
"RTN","PSGMIV",30,0)
PRT ;*** Print IV orders.
"RTN","PSGMIV",31,0)
 K TS,P,DRG NEW ON55,LN,PSJLABEL S PSJLABEL=1
"RTN","PSGMIV",32,0)
 S ON=$P(DAO,U,2),DFN=$P(PN,U,2) D:ON["V" GT55^PSIVORFB
"RTN","PSGMIV",33,0)
 D:ON["P" GT531^PSIVORFA(DFN,ON)
"RTN","PSGMIV",34,0)
 S TS=1,TMSTR="" I P(9)]"" D ORSET,TS^PSGMAR3(P(11))
"RTN","PSGMIV",35,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC1^PSGMI(P(X))
"RTN","PSGMIV",36,0)
 S PSGST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I PSGST'="O" S PSGST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGMIV",37,0)
 S PSGLFFD=PSGPLF
"RTN","PSGMIV",38,0)
 D INITOPI^PSGMMIVC
"RTN","PSGMIV",39,0)
 NEW NAMENEED,NEED,X S NAMENEED=0
"RTN","PSGMIV",40,0)
 D LNNEED,PRTIV
"RTN","PSGMIV",41,0)
 Q
"RTN","PSGMIV",42,0)
LNNEED ;*** Find lines needed per label.
"RTN","PSGMIV",43,0)
 ;*** If OPI<29 char, it is ok to put INITs in the same line.
"RTN","PSGMIV",44,0)
 ;*** Add number of lines needed for additives and solutions and 1 line
"RTN","PSGMIV",45,0)
 ;*** for infusion rate and x line for OPI. Divide by 5 to determine
"RTN","PSGMIV",46,0)
 ;*** of label(s) needed for this order.
"RTN","PSGMIV",47,0)
 F X="AD","SOL" D NAMENEED^PSJMUTL(X,47,.NEED) S NAMENEED=NAMENEED+NEED
"RTN","PSGMIV",48,0)
 N OPILEN,OPILAST S OPILAST=$S(($G(ON55)["V"):$O(^PS(55,DFN,"IV",ON55,10," "),-1),1:"") S OPILEN=$S(OPILAST:(74*OPILAST),1:$L(P("OPI")))
"RTN","PSGMIV",49,0)
 S X=(OPILEN\47)+((OPILEN#47)>28)+1+($P(P("OPI"),"^")]""&(P(4)="C"))
"RTN","PSGMIV",50,0)
 S X=(NAMENEED+X+2) S X=$S(X<6:1,1:((X-6)\5)+2)
"RTN","PSGMIV",51,0)
 S LN=$S(TS/6>X:TS/6,1:X)
"RTN","PSGMIV",52,0)
 Q
"RTN","PSGMIV",53,0)
 ;
"RTN","PSGMIV",54,0)
OS ; order record set
"RTN","PSGMIV",55,0)
 Q
"RTN","PSGMIV",56,0)
 ;
"RTN","PSGMIV",57,0)
PRTIV ;*** Print IV order on MAR
"RTN","PSGMIV",58,0)
 D ONHOLD^PSGMMAR2
"RTN","PSGMIV",59,0)
 I PSGMAROC,(PSGMAROC+LN)>6 D BOT^PSGMAR3,HEADER^PSGMAR3
"RTN","PSGMIV",60,0)
 NEW PSGL S PSGL="|"
"RTN","PSGMIV",61,0)
 S PSGMAROC=PSGMAROC+1 W !?6,"|",?19,"|",?48,PSGL,$G(TS(1)),?55,"|"
"RTN","PSGMIV",62,0)
 W !,$E(P("LOG"),1,5)," |"
"RTN","PSGMIV",63,0)
 I ON["V" D
"RTN","PSGMIV",64,0)
 . I $G(ONHOLD) W "O N  H O L D" Q
"RTN","PSGMIV",65,0)
 . W $E(P(2),1,5)_$E(P(2),9,14)," |",P(3)
"RTN","PSGMIV",66,0)
 . Q
"RTN","PSGMIV",67,0)
 W:ON["P" "P E N D I N G"
"RTN","PSGMIV",68,0)
 W ?39,"(",$E(PSGP(0))_$E(PSSN,8,12)_")"
"RTN","PSGMIV",69,0)
 W ?48,PSGL,$G(TS(2)),?55,"|" S L=3
"RTN","PSGMIV",70,0)
 NEW NAME,PSIVX
"RTN","PSGMIV",71,0)
 F PSIVX=0:0 S PSIVX=$O(DRG("AD",PSIVX)) Q:'PSIVX  D NAME^PSIVUTL(DRG("AD",PSIVX),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  W !,NAME(Y) W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:(PSIVX=1&((PSGST="O")!(PSGST="C"))) TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",72,0)
 W:$G(DRG("SOL",0)) !,"in "
"RTN","PSGMIV",73,0)
 NEW PSJPRT2
"RTN","PSGMIV",74,0)
 F PSIVX=0:0 S PSIVX=$O(DRG("SOL",PSIVX)) Q:'PSIVX  D NAME^PSIVUTL(DRG("SOL",PSIVX),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  D
"RTN","PSGMIV",75,0)
 . W:(Y>1!(PSIVX>1)) ! W ?4,NAME(Y) W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:L=3 TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",76,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",PSIVX),0),U,4) I PSJPRT2]"" W !?7,PSJPRT2 W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:L=3 TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",77,0)
 W !,$P(P("MR"),U,2)," ",P(9)," ",P(8) W ?48,PSGL,$G(TS(L)),?55,"|" I L>5,(L#5) W !
"RTN","PSGMIV",78,0)
 I '$O(DRG("AD",0))!('$O(DRG("SOL",0))) W !?48,PSGL,$G(TS(L)),?55,"|" S L=5
"RTN","PSGMIV",79,0)
 I P(4)="C",'(L#5),P("OPI")="" W !,"*CAUTION-CHEMOTHERAPY*" S L=L+1 Q
"RTN","PSGMIV",80,0)
 I P(4)="C" D L(1) W !,"*CAUTION-CHEMOTHERAPY*",?48,PSGL,$G(TS(L)),?55,"|"
"RTN","PSGMIV",81,0)
 I (L#5)=0,($L($P(P("OPI"),"^"))<29),(TS<7) S L=L+1
"RTN","PSGMIV",82,0)
 E  D L(1)
"RTN","PSGMIV",83,0)
 W:P("OPI")=""&(TS>6) !
"RTN","PSGMIV",84,0)
 I P("OPI")'="" I '$$OPI(PSGP,ON55) D
"RTN","PSGMIV",85,0)
 . W:(L#6)=1 !
"RTN","PSGMIV",86,0)
 . F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=$P($P(P("OPI"),"^")," ",Y) D  W Y1," "
"RTN","PSGMIV",87,0)
 . I ($X+$L(Y1))>47 W ?48,PSGL,$G(TS(L)),?55,"|" D L(1) W !
"RTN","PSGMIV",88,0)
 I L>TS,(L#6) W ?48,PSGL,$G(TS(L)),?55,"|" S L=L+1 W:L#6=0 !
"RTN","PSGMIV",89,0)
 I (TS-1)>L W ?48,PSGL,$G(TS(L)),?55,"|" D
"RTN","PSGMIV",90,0)
 . F L=L+1:1:TS-1 D L(0) W !?48,PSGL,$G(TS(L)),?55,"|"
"RTN","PSGMIV",91,0)
 . S L=L+1
"RTN","PSGMIV",92,0)
 F  Q:'(L#6)  W !?48,PSGL,$G(TS(L)),?55,"|" S L=L+1
"RTN","PSGMIV",93,0)
 I '(L#6),(P("OPI")="") W !
"RTN","PSGMIV",94,0)
 I P("OPI")]"",(L>6) W !
"RTN","PSGMIV",95,0)
 W ?29,"RPH: ",PSGLRPH,?38,"RN: ",PSGLRN,?48,PSGL,$G(TS(L)),?55,"|" W:PSGMAROC<6 !?7,LN2
"RTN","PSGMIV",96,0)
 Q
"RTN","PSGMIV",97,0)
 ;
"RTN","PSGMIV",98,0)
OPI(DFN,ORDER,OPITEXT,OPIPRINT) ; Retrieve, format, and print Other Print Info
"RTN","PSGMIV",99,0)
 N TXTLN S TXTLN=$$GETSIOPI^PSJBCMA5($G(DFN),$G(ORDER),1) I 'TXTLN Q 0
"RTN","PSGMIV",100,0)
 N TXTLN,TXT,I,TMPMARX,MARXTXT,LAST,II,Y K MARX S LAST=0,TMPMARX="" S PSGL=$S(($G(PSGL)]""):PSGL,1:"|")
"RTN","PSGMIV",101,0)
 I ORDER["V" S TXTLN=0 F I=1:1 S TXTLN=$O(^PS(55,DFN,"IV",+ORDER,10,TXTLN)) Q:'TXTLN  D
"RTN","PSGMIV",102,0)
 .S MARXTXT=^PS(55,DFN,"IV",+ORDER,10,TXTLN,0) D TXT^PSGMUTL(MARXTXT,47) S LAST=$O(TMPMARX(" "),-1) S II=0 F  S II=$O(MARX(II)) Q:'II  S TMPMARX(LAST+II)=MARX(II)
"RTN","PSGMIV",103,0)
 I ORDER["P" S TXTLN=0 F I=1:1 S TXTLN=$O(^PS(53.1,+ORDER,16,TXTLN)) Q:'TXTLN  D
"RTN","PSGMIV",104,0)
 .S MARXTXT=^PS(53.1,+ORDER,16,TXTLN,0) D TXT^PSGMUTL(MARXTXT,47) S LAST=$O(TMPMARX(" "),-1) S II=0 F  S II=$O(MARX(II)) Q:'II  S TMPMARX(LAST+II)=MARX(II)
"RTN","PSGMIV",105,0)
 I $G(OPIPRINT) K MARX M MARX=TMPMARX S I=0 F  S I=$O(MARX(I)) Q:'I  D
"RTN","PSGMIV",106,0)
 . W:(L#6)=0 !
"RTN","PSGMIV",107,0)
 . S Y1=MARX(I) W Y1," ",?48,PSGL,$G(TS(L)),?55,"|" D L(1) W !
"RTN","PSGMIV",108,0)
 I $G(OPITEXT) M OPITEXT=TMPMARX
"RTN","PSGMIV",109,0)
 Q 1
"RTN","PSGMIV",110,0)
L(X) ;***Check to see if a new block is needed.
"RTN","PSGMIV",111,0)
 S L=L+X
"RTN","PSGMIV",112,0)
 I L#6=0,PSGMAROC<6 W !,"See next label for continuation",?48,PSGL,$G(TS(L)),?55,"|" W:PSGMAROC<6 !?7,LN2 S PSGMAROC=PSGMAROC+1,L=L+1 D
"RTN","PSGMIV",113,0)
 .I LN>6,(PSGMAROC>5) S MSG1="*** CONTINUE ON NEXT PAGE ***" D BOT^PSGMAR3,HEADER^PSGMAR3 S PSGMAROC=1
"RTN","PSGMIV",114,0)
 Q
"RTN","PSGMIV",115,0)
ORSET ; order record set
"RTN","PSGMIV",116,0)
 Q:PST["P"!P(9)=""
"RTN","PSGMIV",117,0)
 S PSGMFOR="",(SD,X)=$P(P(2),".") Q:X>PSGPLF  S FD=$P(P(3),"."),PSGOES="",X=P(9) D EN^PSGS0 S T=PSGS0XT
"RTN","PSGMIV",118,0)
 S X="" I "OB"]PST,$P(P(9),"^")'["@",P(2)'>PSGPLS,P(3)'<PSGPLF,P(11),T<1441,T'="D" S X=P(11),PSGPLC=1
"RTN","PSGMIV",119,0)
 E  I "OB"]PST!(PST["OV") K PSGMAR D SETL0 S (Q,X)="" F QX=0:0 S Q=$O(PSGMAR(Q)) Q:Q=""  S X=X_$E("0",2-$L(Q))_Q_"-"
"RTN","PSGMIV",120,0)
 S TMSTR=X
"RTN","PSGMIV",121,0)
 K HCD,HM,I,J,PSGD,PLSD,CD,M,MID,MN,ND,ND1,OD,ST,QD1,QD2,QQ,TS,UD,WDT,WS,WS1,X,X1,X2 Q
"RTN","PSGMIV",122,0)
 Q
"RTN","PSGMIV",123,0)
SETL0 ;*** Set variable to use in ^PSGPL0 to calculate admin time.
"RTN","PSGMIV",124,0)
 K PSGMAR S PSGPLC=0
"RTN","PSGMIV",125,0)
 S ND1=P(4),ST=P(2),PLSD=P(3),TS=P(11),MN=T,ND=P(9) I $S(ST'?7N1"."1N.E:1,1:PLSD'?7N1"."1N.E) S PSGPLC="OI" Q
"RTN","PSGMIV",126,0)
 D ENIV^PSGPL0
"RTN","PSGMIV",127,0)
 Q
"RTN","PSGMIV",128,0)
 ;
"RTN","PSGMIV",129,0)
RPHINIT(RPH) ; Find initial for the person who completed the IV order.
"RTN","PSGMIV",130,0)
 S RPH=$P($G(^PS(55,PSGP,"IV",+ON,4)),U,4)
"RTN","PSGMIV",131,0)
 S:+RPH RPH=$$DEFINIT(+RPH)
"RTN","PSGMIV",132,0)
 I RPH="" S RPH="_____"
"RTN","PSGMIV",133,0)
 Q
"RTN","PSGMIV",134,0)
DEFINIT(X)         ;
"RTN","PSGMIV",135,0)
 S X=$G(^VA(200,X,0)),RPH=$P(X,U,2) Q:RPH]"" RPH
"RTN","PSGMIV",136,0)
 S X=$P(X,U),RPH=$E(X,$F(X,","))_$E(X) Q RPH
"RTN","PSGMMIV")
0^47^B48999295^B42167886
"RTN","PSGMMIV",1,0)
PSGMMIV ;BIR/MV-IV ORDER FOR THE 7/14 DAY MAR. ;25 Nov 98 / 9:24 AM
"RTN","PSGMMIV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**20,21,58,111,131,145,267,275**;16 DEC 97;Build 157
"RTN","PSGMMIV",3,0)
 ;
"RTN","PSGMMIV",4,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMMIV",5,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMMIV",6,0)
 ;
"RTN","PSGMMIV",7,0)
START ;*** Read IV orders
"RTN","PSGMMIV",8,0)
 NEW MULTIPG
"RTN","PSGMMIV",9,0)
 S ON=""
"RTN","PSGMMIV",10,0)
 F PSGMARED=PSGMARSD-.0001:0 S PSGMARED=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED)) Q:'PSGMARED  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED,ON)) Q:ON=""  D IV
"RTN","PSGMMIV",11,0)
 Q
"RTN","PSGMMIV",12,0)
IV ;*** Sort IV orders for 24 Hrs, 7/14 Day MAR.
"RTN","PSGMMIV",13,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT55^PSIVORFB
"RTN","PSGMMIV",14,0)
 Q:P(2)>PSGMARFD
"RTN","PSGMMIV",15,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGMMIV",16,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGMMIV",17,0)
 S QST=$S(P(9)["PRN":"OVP",QST="O":"OVO",1:"CV")_XTYPE
"RTN","PSGMMIV",18,0)
 Q:(PSGMARS=2&(QST["C"))
"RTN","PSGMMIV",19,0)
 Q:(PSGMARS=1&(QST["O"))
"RTN","PSGMMIV",20,0)
 N PSGMARWC  ;DEM (05/30/2006) - PSGMARWC is used to preserve original value of PSGMARWN (patient location) in case location is changed by an order with a clinic location.
"RTN","PSGMMIV",21,0)
 S PSGMARWC=PSGMARWN
"RTN","PSGMMIV",22,0)
 I $G(DRG) S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_+ON_"V" D
"RTN","PSGMMIV",23,0)
 . N A
"RTN","PSGMMIV",24,0)
 . S A=$G(^PS(55,PSGP,"IV",+ON,"DSS")) I $P(A,"^")]"" S PSGMARWN="C!"_$P(A,"^") I $G(SUB1)]"",$G(SUB2)]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D
"RTN","PSGMMIV",25,0)
 . . N X,Y
"RTN","PSGMMIV",26,0)
 . . D SPN^PSGMMAR0
"RTN","PSGMMIV",27,0)
 . . Q
"RTN","PSGMMIV",28,0)
 . . ;
"RTN","PSGMMIV",29,0)
 . I PSGSS="P" S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q                         ;DAM  5-01-07 Print by PATIENT
"RTN","PSGMMIV",30,0)
 . I PSGSS="L" Q:((PSGINWDG="")&(PSGMARWN'["C!"))  S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q     ;DAM  5-01-07 Print by clinic group
"RTN","PSGMMIV",31,0)
 . I PSGSS="C" Q:((PSGINWD="")&(PSGMARWN'["C!"))  I ((PSGMARWN[PSGCLNC)!(PSGMARWN'["C!")) S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""  Q    ;DAM 5-01-07 Print by Clinic
"RTN","PSGMMIV",32,0)
 . ;
"RTN","PSGMMIV",33,0)
 . ;DAM 5-01-07 Set up XTMP global where location and patient names are switched for printing by WARD/PATIENT or WARD GROUP/PATIENT
"RTN","PSGMMIV",34,0)
 . I '$G(PSGREP) N PSGDEM1 S PSGDEM1=X D    ;transfer contents of patient drug information contained in "X" above to  a new variable temporarily
"RTN","PSGMMIV",35,0)
 . . S PSGREP="PSGM_"_$J
"RTN","PSGMMIV",36,0)
 . . S X1=DT,X2=1 D C^%DTC K %,%H,%T
"RTN","PSGMMIV",37,0)
 . . S ^XTMP(PSGREP,0)=X_U_DT
"RTN","PSGMMIV",38,0)
 . I PSGRBPPN="P",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D         ;Construct XTMP global for printing by WARD and sort by PATIENT
"RTN","PSGMMIV",39,0)
 . . S ^XTMP(PSGREP,TM,PPN,PSGMARWN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),PSGDEM1)=""
"RTN","PSGMMIV",40,0)
 . . D SPN^PSGMMAR0
"RTN","PSGMMIV",41,0)
 . I PSGRBPPN="P",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D       ;Construct XTMP global for printing by WARD GROUP and sort by PATIENT
"RTN","PSGMMIV",42,0)
 . . S ^XTMP(PSGREP,TM,PPN,PSGMARWN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),PSGDEM1)=""
"RTN","PSGMMIV",43,0)
 . . D SPN^PSGMMAR0
"RTN","PSGMMIV",44,0)
 . S X=$G(PSGDEM1)      ;Return value of X from PSGDEM1 back to X
"RTN","PSGMMIV",45,0)
 . ;
"RTN","PSGMMIV",46,0)
 . I PSGRBPPN="R",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D        ;Construct TMP global for printing by WARD and sort by ROOM/BED
"RTN","PSGMMIV",47,0)
 . . S ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMIV",48,0)
 . I PSGRBPPN="R",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D      ;Construct TMP global for printing by WARD GROUP and sort by ROOM/BED
"RTN","PSGMMIV",49,0)
 . . S ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMIV",50,0)
  . ;End DAM modifications 5-01-07
"RTN","PSGMMIV",51,0)
  . ;
"RTN","PSGMMIV",52,0)
 S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC
"RTN","PSGMMIV",53,0)
 Q
"RTN","PSGMMIV",54,0)
IVPRN ;*** Set ^tmp to store IV orders that have schedule of PRN.
"RTN","PSGMMIV",55,0)
 K P,DRG NEW ON55,CHEMO,TXT,PSJLABEL,PSIVOPFL,PSIVOPIA
"RTN","PSGMMIV",56,0)
 S ON=$P(DAOO,U,2),DFN=$P(PN,U,2),PSJLABEL=1
"RTN","PSGMMIV",57,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSGMMIV",58,0)
 D:ON["P" GT531^PSIVORFA(DFN,ON)
"RTN","PSGMMIV",59,0)
 D SETVAR,SETLTRT
"RTN","PSGMMIV",60,0)
 ;the two naked references below refer to the full reference to the right of the = sign
"RTN","PSGMMIV",61,0)
 S ^(1)=$G(^TMP($J,"1PRN",PG,LAB,1))_UP_"      |            |"
"RTN","PSGMMIV",62,0)
 S ^(2)=$G(^TMP($J,"1PRN",PG,LAB,2))_UP_$E(P("LOG"),1,5)_" |",LN=3
"RTN","PSGMMIV",63,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",64,0)
 S:ON["P" ^(2)=^(2)_"P E N D I N G"
"RTN","PSGMMIV",65,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",66,0)
 S:ON["V" ^(2)=^(2)_$E(P(2),1,5)_$E(P(2),9,14)_" |"_P(3)
"RTN","PSGMMIV",67,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",68,0)
 S ^(2)=$$SETSTR^VALM1("("_$E(PSGP(0))_$E(PSSN,8,12)_")",^(2),40,7)
"RTN","PSGMMIV",69,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  S TXT=$$WRTDRG^PSIVUTL(DRG("AD",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT)
"RTN","PSGMMIV",70,0)
 S TXT="in "
"RTN","PSGMMIV",71,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D
"RTN","PSGMMIV",72,0)
 . S TXT=TXT_$$WRTDRG^PSIVUTL(DRG("SOL",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",73,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",X),0),U,4) I PSJPRT2]"" S TXT=TXT_"   "_PSJPRT2 S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",74,0)
 S TXT=$P(P("MR"),U,2)_" "_P(9)_" "_P(8) D CHK(.TXT)
"RTN","PSGMMIV",75,0)
 I P(4)="C" S CHEMO="*CAUTION-CHEMOTHERAPY*" D:P("OPI")]"" CHK(CHEMO)
"RTN","PSGMMIV",76,0)
 S PSIVLOPI="",PSIVOPIA=1 S PSIVOPFL=$$OPI^PSGMIV(PSGP,ON55,.PSIVOPIA)
"RTN","PSGMMIV",77,0)
 S Y1="" I '$G(PSIVOPFL) D
"RTN","PSGMMIV",78,0)
 .F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=Y1_$P($P(P("OPI"),"^")," ",Y)_" " I $L(Y1)>47 D CHK(Y1) S Y1=""
"RTN","PSGMMIV",79,0)
 .I $L(Y1)>28 D CHK(Y1) S Y1=""
"RTN","PSGMMIV",80,0)
 .I $L(Y1)<29,'(LN#6) S TXT=$S((P("OPI")=""&$D(CHEMO)):CHEMO,1:Y1),X=29-$L(TXT),TXT=TXT_$$SP(X)_INIT
"RTN","PSGMMIV",81,0)
 .E  D  S TXT=$$SP(29)_INIT,LN=LN+1
"RTN","PSGMMIV",82,0)
 ..;the following three naked references below refer to the full references to the right of the = sign
"RTN","PSGMMIV",83,0)
 ..I LN=5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_Y1
"RTN","PSGMMIV",84,0)
 ..E  D:$L(Y1) CHK(Y1) F LN=LN:1:5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_""
"RTN","PSGMMIV",85,0)
 .S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_TXT
"RTN","PSGMMIV",86,0)
 N POPI,YL S (POPI,YL,Y1,Y)="" I $G(PSIVOPFL) D
"RTN","PSGMMIV",87,0)
 .F YL=1:1:+$O(PSIVOPIA(""),-1) S POPI=PSIVOPIA(YL) D
"RTN","PSGMMIV",88,0)
 ..I $O(PSIVOPIA(YL)) D CHK(POPI) S POPI="" Q
"RTN","PSGMMIV",89,0)
 ..I $L(POPI)>28 D CHK(POPI) S POPI=""
"RTN","PSGMMIV",90,0)
 ..I $L(POPI)<29,'(LN#6) S TXT=$S((POPI=""&$D(CHEMO)):CHEMO,1:POPI),X=29-$L(TXT),TXT=TXT_$$SP(X)_INIT
"RTN","PSGMMIV",91,0)
 ..E  D  S TXT=$$SP(29)_INIT,LN=LN+1
"RTN","PSGMMIV",92,0)
 ...;the following three naked references below refer to the full references to the right of the = sign
"RTN","PSGMMIV",93,0)
 ...I LN=5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_POPI
"RTN","PSGMMIV",94,0)
 ...E  D:$L(POPI) CHK(POPI) F LN=LN:1:5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_""
"RTN","PSGMMIV",95,0)
 ..S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_TXT
"RTN","PSGMMIV",96,0)
 Q
"RTN","PSGMMIV",97,0)
SETVAR ;***Initialize variables.
"RTN","PSGMMIV",98,0)
 NEW TMSTR
"RTN","PSGMMIV",99,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC^PSGMI(P(X))
"RTN","PSGMMIV",100,0)
 S PSGST=$S(P(9)["PRN":"P",P(2)=P(3):"O",1:"C"),TMSTR=P(11),PSGLFFD=PSGMARFD
"RTN","PSGMMIV",101,0)
 D INITOPI^PSGMMIVC
"RTN","PSGMMIV",102,0)
 S INIT="RPH: "_PSGLRPH,INIT=INIT_$$SP(38-($L(INIT)+29))_"RN: "_PSGLRN
"RTN","PSGMMIV",103,0)
 ;*** If OPI<29 char, it is ok to put INITs in the same line.
"RTN","PSGMMIV",104,0)
 ;*** If OPI=""&it's a Chemo order, warning & Inits prt on same line.
"RTN","PSGMMIV",105,0)
 ;*** Add number lines needed for additives and solutions and 1 line
"RTN","PSGMMIV",106,0)
 ;*** for infusion rate and 1 line for start/stop date.
"RTN","PSGMMIV",107,0)
 ;*** Multiple labels can have up to 5 lines per label and the last
"RTN","PSGMMIV",108,0)
 ;*** label can have up to 6 lines..
"RTN","PSGMMIV",109,0)
 ;
"RTN","PSGMMIV",110,0)
 NEW X S NAMENEED=0
"RTN","PSGMMIV",111,0)
 F X="AD","SOL" D NAMENEED^PSJMUTL(X,47,.NEED) S NAMENEED=NAMENEED+NEED
"RTN","PSGMMIV",112,0)
 S MULTIPG=0,NEED=1
"RTN","PSGMMIV",113,0)
 ;* Find # of lines needed for OPI -- (($L(P("OPI"))\47)
"RTN","PSGMMIV",114,0)
 ;* If the last line in OPI < 29 --(($L(P("OPI")#47)>28) include init.
"RTN","PSGMMIV",115,0)
 S X=($L($P(P("OPI"),"^"))\47)+(($L($P(P("OPI"),"^"))#47)>28)+1+($P(P("OPI"),"^")]""&(P(4)="C"))
"RTN","PSGMMIV",116,0)
 S X=(NAMENEED+X+2) S:X>5 NEED=((X-6)\5)+2
"RTN","PSGMMIV",117,0)
 S:NEED>BL MULTIPG=1
"RTN","PSGMMIV",118,0)
 Q
"RTN","PSGMMIV",119,0)
CHK(TXT) ;
"RTN","PSGMMIV",120,0)
 ;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",121,0)
 I '(LN#6) S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_"See next label for continuation",LN=1 D
"RTN","PSGMMIV",122,0)
 . I PSGMAROC+1>(BL/2) D
"RTN","PSGMMIV",123,0)
 . . I PSGMAROC=BL-1,MULTIPG D
"RTN","PSGMMIV",124,0)
 . . .;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",125,0)
 . . .F LN=LN:1:6 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_"" S:LN=3 ^(LN)=UP_"*** CONTINUE ON NEXT PAGE ***"
"RTN","PSGMMIV",126,0)
 . . .S PG=PG+1,(LN,LT,RT)=1,(PSGMAROC,MULTIPG)=0 D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",127,0)
 . . E  D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",128,0)
 . E  D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",129,0)
 ;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",130,0)
 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_TXT,LN=LN+1,TXT=""
"RTN","PSGMMIV",131,0)
 Q
"RTN","PSGMMIV",132,0)
SETLTRT ;*** Increment line number for left or right label on PRN sheet.
"RTN","PSGMMIV",133,0)
 I (NEED+PSGMAROC)>BL S:PSGMAROC PG=PG+1,(LT,RT)=1,PSGMAROC=0
"RTN","PSGMMIV",134,0)
 I NEED+PSGMAROC=BL D  Q
"RTN","PSGMMIV",135,0)
 . I PSGMAROC<(BL/2) D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",136,0)
 . E  D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",137,0)
 I PSGMAROC,((NEED+PSGMAROC)>(BL/2)) S PSGMAROC=$S(PSGMAROC>(BL/2):PSGMAROC,1:(BL/2)) D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",138,0)
 E  D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",139,0)
 Q
"RTN","PSGMMIV",140,0)
SP(X) ;***Set up spaces need between info on TXT for the label.
"RTN","PSGMMIV",141,0)
 N Y S $P(Y," ",X)=" "
"RTN","PSGMMIV",142,0)
 Q $G(Y)
"RTN","PSGNE3")
0^39^B86381204^B84337387
"RTN","PSGNE3",1,0)
PSGNE3 ;BIR/CML3,MLM-DETERMINE DEFAULT FOR START & STOP TIMES ; 12/13/10 2:46pm
"RTN","PSGNE3",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**4,26,47,50,63,69,105,80,111,183,193,179,275**;16 DEC 97;Build 157
"RTN","PSGNE3",3,0)
 ;
"RTN","PSGNE3",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGNE3",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGNE3",6,0)
 ; Reference to PSBAPIPM is supported by DBIA 3564
"RTN","PSGNE3",7,0)
 ;
"RTN","PSGNE3",8,0)
 N X1,X2,Y
"RTN","PSGNE3",9,0)
NOW ;
"RTN","PSGNE3",10,0)
 S:'$D(PSGST) PSGST=""
"RTN","PSGNE3",11,0)
 S PSGDT=$$DATE^PSJUTL2(),PSGNESD=$$ENSD($S(PSGST["P":"PRN",1:PSGSCH),PSGS0Y,PSGDT,PSGDT)
"RTN","PSGNE3",12,0)
 ;
"RTN","PSGNE3",13,0)
STOP ; exit when start date found
"RTN","PSGNE3",14,0)
 K ET,F,FT,LT,NT,PSGNE3,TT G:$D(PSGOES)!$D(PSGODF) SF S PSGNESDO=$$ENDD^PSGMI(PSGNESD)
"RTN","PSGNE3",15,0)
 Q
"RTN","PSGNE3",16,0)
 ;
"RTN","PSGNE3",17,0)
ENFD(PSGDT) ; find default stop date
"RTN","PSGNE3",18,0)
 N X1,X2,X3DMIN,Y
"RTN","PSGNE3",19,0)
SF I '$O(^PS(55,PSGP,5,"AUS",PSGDT)),'$D(^PS(53.1,"AC",PSGP)),+$G(^PS(55,PSGP,5.1)) S $P(^PS(55,PSGP,5.1),U)=""
"RTN","PSGNE3",20,0)
 S PSJSYSW0=$G(PSJSYSW0) ; Initialize/restore PSJSYSW0 ward parameters; clinic orders may not have them. Killed at exit in ENKV^PSGSETU
"RTN","PSGNE3",21,0)
 I $G(PSGOEA)="R",$P(PSJSYSW0,"^",4) D ENWALL(%,0,PSGP)
"RTN","PSGNE3",22,0)
 S PSGNEFD="",PSGNEW=$S('$P(PSJSYSW0,U,4):0,+$G(^PS(55,PSGP,5.1))'>PSGDT:0,1:+$G(^PS(55,PSGP,5.1))) S:PSGNEW<PSGNESD PSGNEW=0
"RTN","PSGNE3",23,0)
 I PSGNEW,($G(PSGOEA)="R") S X1=$P(%,"."),X2=3 D C^%DTC S PSGNEW=$S($P(X,".")_(PSGNESD#1)'>PSGNEW:PSGNEW,1:0)
"RTN","PSGNE3",24,0)
 I PSGST="O" S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" G OUT
"RTN","PSGNE3",25,0)
 ;PSJ*179;x-ref to "APPSJ"
"RTN","PSGNE3",26,0)
 I PSGST'="O",PSGSCH]"",$S(PSGSCH="ONCE":1,PSGSCH="STAT":1,PSGSCH="ONE TIME":1,1:0)!($P($G(^PS(51.1,+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)),0)),"^",5)="O") S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" G OUT
"RTN","PSGNE3",27,0)
 S X1=$P(PSGNESD,"."),X2=$S($P(PSJSYSW0,"^",3):+$P(PSJSYSW0,"^",3),1:14)
"RTN","PSGNE3",28,0)
 D
"RTN","PSGNE3",29,0)
 . ; *** psi 06 082 - RDC 08/2006;ADDED VAR AA TO CHK FOR APPT and CLINIC ***
"RTN","PSGNE3",30,0)
 . N A,AA,B
"RTN","PSGNE3",31,0)
 . Q:'$D(PSGORD)  S A=""
"RTN","PSGNE3",32,0)
 . I PSGORD["P" S A=$G(^PS(53.1,+PSGORD,"DSS"))
"RTN","PSGNE3",33,0)
 . I PSGORD["U" S A=$G(^PS(55,PSGP,5,+PSGORD,8))
"RTN","PSGNE3",34,0)
 . I PSGORD["I" S A=$G(^PS(55,PSGP,"IV",+PSGORD,"DSS"))
"RTN","PSGNE3",35,0)
 . ;PSJ*5*179;Clin Def Stop
"RTN","PSGNE3",36,0)
 . S AA=$P(A,"^",2),A=$P(A,"^") I A,AA S X2=14 I $D(^PS(53.46,"B",A)) S B=$O(^PS(53.46,"B",A,"")),X2=$P(^PS(53.46,B,0),"^",2) I X2="" S X2=14
"RTN","PSGNE3",37,0)
 D C^%DTC
"RTN","PSGNE3",38,0)
 I $G(PSGNEDFD) I $S($P(PSGNEDFD,"^")["L":PSGS0XT!PSGS0Y,1:1) D DFD
"RTN","PSGNE3",39,0)
 I $G(PSGORD),$G(PSGFD) S X3DMIN=$$GETDUR^PSJLIVMD(PSGP,+$G(PSGORD),$S($G(PSGORD)["P":"P",$G(PSGORD)["V":"IV",1:5),1) I X3DMIN]"" D  I PSGNEFD]"" G OUT
"RTN","PSGNE3",40,0)
 . S X3DMIN=$$DURMIN^PSJLIVMD(X3DMIN) I $G(X3DMIN) S PSGNEFD=$$FMADD^XLFDT(PSGNESD,,,X3DMIN)
"RTN","PSGNE3",41,0)
 S X=+(X_$S($P(PSJSYSW0,"^",7):"."_$P(PSJSYSW0,"^",7),1:(PSGNESD#1)))
"RTN","PSGNE3",42,0)
 S PSGNEFD=$S('PSGNEFD:X,X<PSGNEFD:X,1:PSGNEFD) I PSGNEW,(PSGNEW<PSGNEFD),$P(PSJSYSW0,U,4) D
"RTN","PSGNE3",43,0)
 . I $G(PSGORD),$G(PSGRDTX) I PSGORD=$P(PSGRDTX,U,4),PSGNEW<PSGRDTX Q   ; Requested Start is after Stop
"RTN","PSGNE3",44,0)
 . S PSGNEFD=PSGNEW
"RTN","PSGNE3",45,0)
 ;
"RTN","PSGNE3",46,0)
OUT ;
"RTN","PSGNE3",47,0)
 ;*179 Account for drug changing
"RTN","PSGNE3",48,0)
 I $G(PSGPDNX)&('$G(PSBSTR)) S:$G(PSGSDX) PSGNESD=PSGSDX S:$G(PSGFDX) PSGNEFD=PSGFDX
"RTN","PSGNE3",49,0)
 I '$D(PSGODF),'$D(PSGOES) S PSGNEFDO=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGNE3",50,0)
 K PSGDL,PSGNEW Q
"RTN","PSGNE3",51,0)
 ;
"RTN","PSGNE3",52,0)
DFD ;
"RTN","PSGNE3",53,0)
 I $P(PSGNEDFD,"^")["D" S X1=$P(PSGNESD,"."),X2=+PSGNEDFD D C^%DTC S X=+(X_"."_$S($P(PSJSYSW0,"^",7):$P(PSJSYSW0,"^",7),1:$P(PSGNESD,".",2)))
"RTN","PSGNE3",54,0)
 I $P(PSGNEDFD,"^")["L" S PSGDL=+PSGNEDFD D EN1^PSGDL
"RTN","PSGNE3",55,0)
 S PSGNEFD=$S(PSGNEW<X&PSGNEW:PSGNEW,1:X) Q:$P(PSGNEDFD,"^")'["D"!'$P(PSJSYSW0,"^",4)!PSGNEW
"RTN","PSGNE3",56,0)
 Q
"RTN","PSGNE3",57,0)
 ;
"RTN","PSGNE3",58,0)
ENOR ;
"RTN","PSGNE3",59,0)
 K PSGOES,PSGODF S X=$P($G(^PS(53.1,DA,2)),"^")
"RTN","PSGNE3",60,0)
 S $P(^PS(53.1,DA,0),"^",7)=$S(X="PRN":"P",X="ONCE":"O",X="STAT":"O",X="ONE TIME":"O",X="ON CALL":"OC",$P(PSGNEDFD,"^",3)]"":$P(PSGNEDFD,"^",3),1:"C") D PSGNE3 S X=PSGNESD
"RTN","PSGNE3",61,0)
 Q
"RTN","PSGNE3",62,0)
 ;
"RTN","PSGNE3",63,0)
ENSET0(DFN) ; Set "0" node and build xrefs for entries found without one.
"RTN","PSGNE3",64,0)
 N DA,DIK S ^PS(55,DFN,0)=DFN,DIK="^PS(55,",DIK(1)=.01,DA=DFN D EN^DIK
"RTN","PSGNE3",65,0)
 S $P(^PS(55,DFN,5.1),"^",11)=2 ; Mark as converted for POE
"RTN","PSGNE3",66,0)
 Q
"RTN","PSGNE3",67,0)
 ;
"RTN","PSGNE3",68,0)
ENWALL(SD,FD,DFN) ; Update default stop date if appropriate.
"RTN","PSGNE3",69,0)
 N WALL,NWALL,X1,X2,X3
"RTN","PSGNE3",70,0)
 D NOW^%DTC S X3=%
"RTN","PSGNE3",71,0)
 S WALL=+$G(^PS(55,DFN,5.1)),X1=$P(SD,"."),X2=3 D C^%DTC I +(X_"."_$P(SD,".",2))'>+WALL Q
"RTN","PSGNE3",72,0)
 S X1=$P(X3,"."),X2=$S($P(PSJSYSW0,U,3):+$P(PSJSYSW0,U,3),1:14) D C^%DTC
"RTN","PSGNE3",73,0)
 S NWALL=X_$S($P(PSJSYSW0,U,7):"."_$P(PSJSYSW0,U,7),1:SD#1)
"RTN","PSGNE3",74,0)
 S $P(^PS(55,DFN,5.1),U)=+$S(FD>NWALL:FD,1:NWALL)
"RTN","PSGNE3",75,0)
 Q
"RTN","PSGNE3",76,0)
 ;
"RTN","PSGNE3",77,0)
ENSD(SCH,AT,LI,OSD) ;Find start dt/tm
"RTN","PSGNE3",78,0)
 ;SCH=schedule,AT=admin times,LI=login date/time,OSD=Renewed orders start
"RTN","PSGNE3",79,0)
 I $G(APPT),$G(PSGORD)["P" S XD=$$DATE2^PSJUTL2($S(($$FMDIFF^XLFDT(APPT,PSGDT,2)<0):PSGDT,1:APPT)) Q XD
"RTN","PSGNE3",80,0)
 N X,OSDLI D
"RTN","PSGNE3",81,0)
 .I $L(LI)<13 S X=LI Q
"RTN","PSGNE3",82,0)
 .I $L(LI)=14 S X=$E(LI,13,14) S:X>29 X=$E(LI,1,12)_5 S:X'>29 X=$E(LI,1,12)_1 Q
"RTN","PSGNE3",83,0)
 .I $L(LI)=13 S X=$E(LI,13)_0 S:X>29 X=$E(LI,1,12)_5 S:X'>29 X=$E(LI,1,12)_1 Q
"RTN","PSGNE3",84,0)
 I $G(LI) S:(LI=$G(OSD)) OSDLI=1
"RTN","PSGNE3",85,0)
 S LI=+$FN(X,"",4) I '$P(LI,".",2) S LI=$$FMADD^XLFDT(LI,-1,0,0,0)_.24
"RTN","PSGNE3",86,0)
 I $G(OSDLI) S OSD=LI K OSDLI
"RTN","PSGNE3",87,0)
 ;BHW;PSJ*5*179;Re-calc Start date
"RTN","PSGNE3",88,0)
 N PSGBCADM,PSGBCLDT,PSGBCLA,PSGBCFR,PSGBTT,PSGBST,PSGBCSHH,PSGBCLHH,PSGBSAT,PSGBSATN,PSGBNAT,PSGBCLIT,PSGBCTDY
"RTN","PSGNE3",89,0)
 N PSGBCTDD,PSGBCTDA,PSGDAYC,PSGBDNXT,PSGBCSCD,PSGBCLID
"RTN","PSGNE3",90,0)
 S (PSGBST,PSGBCFR,PSGBCADM)=""
"RTN","PSGNE3",91,0)
 S PSGBCORD=$S($G(PSGORD):PSGORD,$G(PSJORD):PSJORD,1:$G(PSGORD))
"RTN","PSGNE3",92,0)
 I PSGBCORD S:'$P($G(^PS(55,DFN,$S($G(PSGBCORD)["V":"IV",1:5),+PSGBCORD,0)),"^",2) PSGBCORD=""
"RTN","PSGNE3",93,0)
 I PSGBCORD["U" S PSGBCOT=5,PSGBCND=0,PSGBCPO=25
"RTN","PSGNE3",94,0)
 I PSGBCORD["V" S PSGBCOT="IV",PSGBCND=2,PSGBCPO=5
"RTN","PSGNE3",95,0)
 I (PSGBCORD'["U")&(PSGBCORD'["V") S PSGBCORD=""
"RTN","PSGNE3",96,0)
 I +$G(DFN)&(+PSGBCORD) S PSGBCPRV=PSGBCORD D
"RTN","PSGNE3",97,0)
 .F  S PSGBCADM=$$EN^PSBAPIPM(DFN,PSGBCPRV) Q:PSGBCADM'=""  S PSGBCPRV=$P(^PS(55,DFN,PSGBCOT,+PSGBCPRV,PSGBCND),U,PSGBCPO) Q:(PSGBCPRV="")!(PSGBCPRV["P")
"RTN","PSGNE3",98,0)
 .Q
"RTN","PSGNE3",99,0)
 I $L(PSGBCADM) D  I PSGBST Q +PSGBST
"RTN","PSGNE3",100,0)
 .S PSGBCLID=$P(LI,".",1),PSGBCLIT=$E($P(LI,".",2),1,2) I $L(PSGBCLIT)=1 S PSGBCLIT=PSGBCLIT*10
"RTN","PSGNE3",101,0)
 .S PSGBCSCH=$P(PSGBCADM,U,1),PSGBCSCD=$P(PSGBCSCH,".",1),PSGBCLDT=$P(PSGBCADM,U,2),PSGBCLA=$P(PSGBCADM,U,3)
"RTN","PSGNE3",102,0)
 .I "GR"'[PSGBCLA Q
"RTN","PSGNE3",103,0)
 .S PSGBCFR=""
"RTN","PSGNE3",104,0)
 .I PSGBCORD["U" S PSGBCFR=$P(^PS(55,DFN,5,+PSGBCORD,2),U,6)
"RTN","PSGNE3",105,0)
 .I PSGBCORD["V" S PSGBCFR=$P(^PS(55,DFN,"IV",+PSGBCORD,0),U,15)
"RTN","PSGNE3",106,0)
 .;Convert
"RTN","PSGNE3",107,0)
 .S PSGBCFR=$S(PSGBCFR="D":1440,PSGBCFR="O":0,1:PSGBCFR)*60
"RTN","PSGNE3",108,0)
 .I 'PSGBCFR,'AT Q
"RTN","PSGNE3",109,0)
 .S X=PSGBCSCH D H^%DTC S PSGBCSCH=%H*86400+%T,PSGBCSHH=%H_","_%T
"RTN","PSGNE3",110,0)
 .S X=PSGBCLDT D H^%DTC S PSGBCLDT=%H*86400+%T,PSGBCLHH=%H_","_%T
"RTN","PSGNE3",111,0)
 .;Sched Admin Time
"RTN","PSGNE3",112,0)
 .I PSGBCSCH D
"RTN","PSGNE3",113,0)
 ..;Check admin times/freq
"RTN","PSGNE3",114,0)
 ..I AT D  Q:PSGBST
"RTN","PSGNE3",115,0)
 ...S PSGBSAT=$P($P(PSGBCADM,"^",1),".",2) Q:'PSGBSAT
"RTN","PSGNE3",116,0)
 ...I $L(PSGBSAT)=1 S PSGBSAT=PSGBSAT*10
"RTN","PSGNE3",117,0)
 ...I ((PSGBSAT<PSGBCLIT)!(PSGBCSCD<PSGBCLID))&(PSGBCSCD'>PSGBCLID) S PSGBSAT=PSGBCLIT  ;&(PSGBCFR<86400)
"RTN","PSGNE3",118,0)
 ...S PSGBNAT=""
"RTN","PSGNE3",119,0)
 ...I ($L($P(AT,"-",1))=4)&($L(PSGBSAT)'=4) S PSGBSAT=PSGBSAT_$E("00",1,4-$L(PSGBSAT))
"RTN","PSGNE3",120,0)
 ...F PSGBSATN=1:1 S PSGBNAT=$P(AT,"-",PSGBSATN) Q:PSGBNAT=""  I PSGBNAT>PSGBSAT Q
"RTN","PSGNE3",121,0)
 ...;If DOW
"RTN","PSGNE3",122,0)
 ...I ("SU-MO-TU-WE-TH-FR-SA"[$P(SCH,"-",1)) D  Q:PSGBST
"RTN","PSGNE3",123,0)
 ....;Get TODAY
"RTN","PSGNE3",124,0)
 ....D NOW^%DTC I '$L(PSGBNAT),PSGBCSCD'<X S X1=X,X2=1 D C^%DTC
"RTN","PSGNE3",125,0)
 ....S PSGBCTDD=X D DW^%DTC S PSGBCTDY=$E(X,1,2)
"RTN","PSGNE3",126,0)
 ....K PSGBCTMP F PSGBCTMP="SU:1","MO:2","TU:3","WE:4","TH:5","FR:6","SA:7" S PSGBCTMP($P(PSGBCTMP,":",1))=$P(PSGBCTMP,":",2),PSGBCTMP($P(PSGBCTMP,":",2))=$P(PSGBCTMP,":",1)
"RTN","PSGNE3",127,0)
 ....;DAY of Last Admin
"RTN","PSGNE3",128,0)
 ....S X=PSGBCSCD D DW^%DTC S PSGBCTDA=$E(X,1,2) I PSGBCSCD<PSGBCTDD S PSGBCTDA=PSGBCTDY
"RTN","PSGNE3",129,0)
 ....;Get Next Day in Sched
"RTN","PSGNE3",130,0)
 ....S PSGDAYC=PSGBCTMP(PSGBCTDA),(PSGBDNXT,X)=""
"RTN","PSGNE3",131,0)
 ....F X=PSGDAYC:1:7 I SCH[$G(PSGBCTMP(X)) S PSGBDNXT=PSGBCTMP(X) Q
"RTN","PSGNE3",132,0)
 ....I '$L(PSGBDNXT) S PSGBDNXT=$P(SCH,"-",1)
"RTN","PSGNE3",133,0)
 ....;Set new Start Day
"RTN","PSGNE3",134,0)
 ....S PSGBCTDY=PSGBCTMP(PSGBCTDY)
"RTN","PSGNE3",135,0)
 ....S PSGBDNXT=PSGBCTMP(PSGBDNXT)
"RTN","PSGNE3",136,0)
 ....S X2=PSGBDNXT-PSGBCTDY I X2<0 S X2=(7-PSGBCTDY)+PSGBDNXT
"RTN","PSGNE3",137,0)
 ....S X1=PSGBCTDD D C^%DTC  ;Add # of days
"RTN","PSGNE3",138,0)
 ....I +X S PSGBST=X_"."_($S('$L(PSGBNAT)!(PSGBCLID'=X):$P(AT,"-",1),1:PSGBNAT))
"RTN","PSGNE3",139,0)
 ....Q
"RTN","PSGNE3",140,0)
 ...;IF no Next Admin
"RTN","PSGNE3",141,0)
 ...I (('PSGBNAT)&(PSGBCFR))!((PSGBCFR>86399)&(PSGBCSCD<PSGBCLID)) S X1=$S(PSGBCFR<86400:PSGBCLID,1:PSGBCSCD),X2=$S(PSGBCFR<86400:1,1:PSGBCFR/60/60/24) D C^%DTC S PSGBST=+X_"."_($S(PSGBNAT:PSGBNAT,1:$P(AT,"-",1))) Q
"RTN","PSGNE3",142,0)
 ...S PSGBST=PSGBCSCD_"."_PSGBNAT
"RTN","PSGNE3",143,0)
 ...Q
"RTN","PSGNE3",144,0)
 ..I 'PSGBCFR Q
"RTN","PSGNE3",145,0)
 ..;Add Freq
"RTN","PSGNE3",146,0)
 ..S PSGBST=PSGBCSCH+PSGBCFR,PSGBST=(PSGBST\86400)_","_(PSGBST#86400)
"RTN","PSGNE3",147,0)
 ..I $P(PSGBST,",",2)<3600 S $P(PSGBST,",",2)=3600
"RTN","PSGNE3",148,0)
 ..;If next day
"RTN","PSGNE3",149,0)
 ..I $P(PSGBST,",",2)<3600 S %H=$S(+PSGBST=+PSGBCSHH:+PSGBST,1:PSGBST-1)_",86400"
"RTN","PSGNE3",150,0)
 ..S %H=PSGBST D YMD^%DTC S PSGBST=X_(+$E(%,1,5))
"RTN","PSGNE3",151,0)
 ..I PSGBST<LI S PSGBST="" Q
"RTN","PSGNE3",152,0)
 ..;If the date/time is > than the First admin
"RTN","PSGNE3",153,0)
 ..I AT,($P(PSGBST,".",1)>PSGBCLID) D
"RTN","PSGNE3",154,0)
 ...S PSGBSAT=$P(PSGBST,".",2) I $L(PSGBSAT)=1 S PSGBSAT=PSGBSAT*10
"RTN","PSGNE3",155,0)
 ...S PSGBSATN=$P(AT,"-",1)  ;First admin TIME
"RTN","PSGNE3",156,0)
 ...I PSGBSAT>PSGBSATN S PSGBST=$P(PSGBST,".",1)_"."_PSGBSATN
"RTN","PSGNE3",157,0)
 ...Q
"RTN","PSGNE3",158,0)
 ..Q
"RTN","PSGNE3",159,0)
 .;Future Date?
"RTN","PSGNE3",160,0)
 .I (PSGBST)&((PSGBST<LI)!(($P(PSGBCADM,"^",1)+.0001)>PSGBST)) D
"RTN","PSGNE3",161,0)
 ..S INFO=($S(($P(PSGBCADM,"^",1)+.0001>PSGBST):$P(PSGBCADM,"^",1)+.0001,1:$G(LI)))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSGNE3",162,0)
 ..S PSGBST=$$ENQ^PSJORP2(PSGP,INFO)
"RTN","PSGNE3",163,0)
 ..I PSGBST<LI S PSGBST="" Q
"RTN","PSGNE3",164,0)
 ..Q
"RTN","PSGNE3",165,0)
 .;No Sched time
"RTN","PSGNE3",166,0)
 .I PSGBCLDT,PSGBCFR,'PSGBCSCH D  Q
"RTN","PSGNE3",167,0)
 ..;Add Freq
"RTN","PSGNE3",168,0)
 ..S PSGBST=PSGBCLDT+PSGBCFR,PSGBST=(PSGBST\86400)_","_(PSGBST#86400)
"RTN","PSGNE3",169,0)
 ..I $P(PSGBST,",",2)<3600 S $P(PSGBST,",",2)=3600
"RTN","PSGNE3",170,0)
 ..I $P(PSGBST,",",2)#3600 S PSGBTT=$P(($P(PSGBST,",",2)/3600)+1,".",1)*3600,$P(PSGBST,",",2)=PSGBTT
"RTN","PSGNE3",171,0)
 ..;If next day
"RTN","PSGNE3",172,0)
 ..I $P(PSGBST,",",2)<3600 S %H=$S(+PSGBST=+PSGBCLHH:+PSGBST,1:PSGBST-1)_",86400"
"RTN","PSGNE3",173,0)
 ..S %H=PSGBST D YMD^%DTC S PSGBST=X_(+$E(%,1,3))
"RTN","PSGNE3",174,0)
 ..I PSGBST<LI S PSGBST="" Q
"RTN","PSGNE3",175,0)
 ..Q
"RTN","PSGNE3",176,0)
 ;BHW;PSJ*5*179;END
"RTN","PSGNE3",177,0)
 I $G(PSJSYSW0)=""!($P(PSJSYSW0,U,5)=2) Q LI
"RTN","PSGNE3",178,0)
 S:SCH["PRN" AT=""
"RTN","PSGNE3",179,0)
 N INT,PSG S:(SCH'["PRN"&(SCH'?1"Q".N1"H")&(LI'=OSD)&('AT)&($G(PSGST)'="O")) AT=$E(OSD,9,10) S OSD=$E(OSD,1,10)
"RTN","PSGNE3",180,0)
 S INT=$S(SCH="QD":24,SCH="QOD":48,SCH="QH":1,SCH?1"Q".N1"D":(+$P(SCH,"Q",2)*24),SCH?1"Q".N1"H":+$P(SCH,"Q",2),LI=OSD:24,1:24)
"RTN","PSGNE3",181,0)
 S:INT=24 OSD=$$FMADD^XLFDT(LI,0,-INT,0,0)
"RTN","PSGNE3",182,0)
 I 'AT,INT>23 S:$P(PSJSYSW0,U,5)!($E(LI,11,12)>30) AT=$E($$FMADD^XLFDT(LI,0,1,0,0),9,10) S:AT="00" AT=24 S:'AT AT=$E(LI,9,10)
"RTN","PSGNE3",183,0)
 I SCH?1"Q".N1"H",'AT S ND=OSD,PSG(+ND)="" S:(INT>24)&('$G(PSJREN)) INT=24 S DAYS=INT\24,HRS=(-INT\24*24+INT) F  S ND=$$FMADD^XLFDT(ND,DAYS,HRS),PSG(+ND)="" Q:ND>LI
"RTN","PSGNE3",184,0)
 Q:INT=24&'$L(AT,"-") $E(LI,1,8)_AT
"RTN","PSGNE3",185,0)
 I '$O(PSG(LI)) S X=$S(OSD>1:OSD,LI>1:LI,1:$$DATE^PSJUTL2) D
"RTN","PSGNE3",186,0)
 .F  S ND=X D  Q:ND>LI  S:(INT>24)&('$G(PSJREN)) INT=24 S DAYS=INT\24,HRS=(-INT\24*24+INT) S X=$$FMADD^XLFDT($S($P(ND,".",2)=24:$P(ND,".")_".23",1:ND),DAYS,HRS) S:$P(X,".")'>$P(ND,".") X=$$FMADD^XLFDT(X,1,0,0,0)
"RTN","PSGNE3",187,0)
 ..F Y=1:1 S AT1=$P(AT,"-",Y) Q:'AT1  S ND=ND\1_"."_AT1,PSG(+ND)=""
"RTN","PSGNE3",188,0)
 Q:$P(PSJSYSW0,U,5) $O(PSG(LI))
"RTN","PSGNE3",189,0)
 S INT="" F ND=0:0 S ND=$O(PSG(ND)) S X=$$FMDIFF^XLFDT(LI,ND,2) S:X<0 X=-X Q:INT&(X'<INT)  S INT=+X,OND=ND Q:INT=0
"RTN","PSGNE3",190,0)
 Q $S($G(OND):OND,1:LI)  ;Use login time if OND is null PSJ*5*193
"RTN","PSGO")
0^34^B35277270^B25195352
"RTN","PSGO",1,0)
PSGO ;BIR/CML3,MV-PRINTS PATIENT'S ORDERS ;10 Feb 98 / 1:32 PM
"RTN","PSGO",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,58,110,181,275**;16 DEC 97;Build 157
"RTN","PSGO",3,0)
 ;
"RTN","PSGO",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGO",5,0)
 ;
"RTN","PSGO",6,0)
 K ^TMP("PSJON",$J),PSGONF S PSGOH="U N I T   D O S E   P R O F I L E" D ENGORD^PSGOU
"RTN","PSGO",7,0)
 ;
"RTN","PSGO",8,0)
EN ;
"RTN","PSGO",9,0)
 N TF2 S TF2=""
"RTN","PSGO",10,0)
 S CML=IO'=IO(0)!($E(IOST,1,2)'="C-"),NP="" N RB
"RTN","PSGO",11,0)
 U IO D GET I '$D(^TMP("PSG",$J)) W !,SLS,SLS,$E(SLS,1,24),!?22,"NO ORDERS FOUND" W:"SL"[PSGOL " FOR A ",$S(PSGOL="S":"SHORT",1:"LONG")," PROFILE."
"RTN","PSGO",12,0)
 G:NP["^" DONE
"RTN","PSGO",13,0)
 E  S (C,DRG)="",LD=0
"RTN","PSGO",14,0)
 E  D DRG G:NP["^" DONE
"RTN","PSGO",15,0)
 I CML,$S('$D(PSGPRP):1,1:PSGPRP="P") D BOT
"RTN","PSGO",16,0)
 ;
"RTN","PSGO",17,0)
DONE ;
"RTN","PSGO",18,0)
 I $S('$D(PSGPRP):1,1:PSGPRP="P") K ^TMP("PSG",$J)
"RTN","PSGO",19,0)
 S PSGON=$S('CML:ON,1:0) K:'$D(PSGVBW) PSGODT
"RTN","PSGO",20,0)
 ;
"RTN","PSGO",21,0)
D1 ;
"RTN","PSGO",22,0)
 K C,CML,DN,DO,DRG,F,GIVE,HDT,LN2,NF,ND,ND4,ND6,NP,O,ON,PF,PG,PSGHD,PSGOH,PSJTEAM,RCT,RF,RTE,S,SCH,SD,SLS,SM,ST,STS,TF,UDU,V,WD,WS,WT Q
"RTN","PSGO",23,0)
 ;
"RTN","PSGO",24,0)
DRG ;
"RTN","PSGO",25,0)
 I PSGOL'="N" F  S C=$O(^TMP("PSG",$J,C)) Q:C=""!(NP["^")  D:$S(($P(C,"^")="Cz")&(TF2'=$P(C,"^",2)):1,C="BA":1,C="CC":1,C="CD":1,C["C":TF,1:1) TF F ST="C","O","OC","P","R","z" D
"RTN","PSGO",26,0)
 .F  S DRG=$O(^TMP("PSG",$J,C,ST,DRG)) Q:DRG=""!(NP["^")  S NF=^(DRG),O=$P(DRG,"^",2),DN=$P(DRG,"^") D:$Y+4>IOSL NP Q:NP["^"  D P
"RTN","PSGO",27,0)
 I PSGOL="N" F  S LD=$O(^TMP("PSG",$J,LD)) Q:'LD  S X=^(LD),NF=$P(X,U),C=$P(X,U,2),ST=$P(X,U,3),DN=$P(X,U,4),O=$P(LD,U,2) D P
"RTN","PSGO",28,0)
 Q
"RTN","PSGO",29,0)
 ;
"RTN","PSGO",30,0)
P ;Display drug data stored in ^TMP("PSG",$J
"RTN","PSGO",31,0)
 I $G(O)["U"&($P(C,"^",4)="A") N F S F="^PS(55,PSGP,5,"
"RTN","PSGO",32,0)
 S ON=ON+1 I 'CML D
"RTN","PSGO",33,0)
 .N PSJOSUFX I ($P(C,"^")="Cz") S PSJOSUFX=$S(($P(C,"^",4))["CD":"",($P(C,"^",4)["C"):"P",($P(C,"^",4)["BD"):"",($P(C,"^",4)["B"):"P",1:"U")
"RTN","PSGO",34,0)
 .I ($P(C,"^")'="Cz") S PSJOSUFX=$S(C["CD":"",C["C":"P",C["BD":"",C["B":"P",1:"U")
"RTN","PSGO",35,0)
 .S ^TMP("PSJON",$J,ON)=+O_PSJOSUFX
"RTN","PSGO",36,0)
 .S:(C'["O"&($P(C,"^")'="Cz")) PSGONC=ON S:($P(C,"^")="Cz"&($P(C,"^",4)'["O")) PSGONC=ON
"RTN","PSGO",37,0)
 Q:PSGOL="N"
"RTN","PSGO",38,0)
 W !,$J(ON,4),?5
"RTN","PSGO",39,0)
 I (C["CD"&($P(C,"^")'="Cz"))!($P(C,"^",4)["CD") N PSJO,OO S PSJO=O,OO=0 F  S OO=$O(^PS(53.1,"ACX",PSJO,OO)) Q:'OO  S O=OO D P2 W !
"RTN","PSGO",40,0)
 I (C["BD"&($P(C,"^")'="Cz"))!($P(C,"^",4)["BD") N PSJO,OO S PSJO=O,OO=0 F  S OO=$O(^PS(53.1,"ACX",PSJO,OO)) Q:'OO  S O=OO D P2 W !
"RTN","PSGO",41,0)
 Q:(C["BD"&($P(C,"^")'="Cz"))  Q:(C["CD"&($P(C,"^")'="Cz"))  Q:($P(C,"^",4)["BD")  Q:($P(C,"^",4)["CD")
"RTN","PSGO",42,0)
 ; naked references below refer to full reference inside indirection @(F_+O_".0)" for either file 53.1 or 55
"RTN","PSGO",43,0)
P2 S ND=$G(@(F_+O_",0)")),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$G(^(6)),DO=$G(^(.2))
"RTN","PSGO",44,0)
 I (C="A"!($P(C,"^",4)="A")),PSJSYSU,'$P(ND4,"^",+PSJSYSU),$P(ND4,"^",+PSJSYSU=1+9) S PSGONV=ON
"RTN","PSGO",45,0)
 I (C="A"!(C="O"))!(($P(C,"^",4)="A")!($P(C,"^",4)="O")) S:$P(ND,"^",9)'="H"&'CML PSGONR=ON D
"RTN","PSGO",46,0)
 .S V='$P(ND4,"^",UDU),V=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSGO",47,0)
 .W $S(ND4="":" ",$P(ND4,"^",12):"D",V!$P(ND4,"^",19)&$P(ND4,"^",18):"H",V!$P(ND4,"^",23)&$P(ND4,"^",22):"H",V!$P(ND4,"^",16)&$P(ND4,"^",15):"R",1:" ")
"RTN","PSGO",48,0)
 .W $S($P(DO,U,4)="D":"d",1:" ")_$S(V:"->",1:"  ")
"RTN","PSGO",49,0)
 I ($P(C,"^")="Cz")&(($P(C,"^",4)="CA")!($P(C,"^",4)["B")) W $S($P(ND4,"^",12):"D",1:" ") I ($P(C,"^",4)["B") S PSGONF=$S('$G(PSGONF):ON_U_ON,1:+PSGONF_U_ON)
"RTN","PSGO",50,0)
 I ($P(C,"^")'="Cz") I C="CA"!(C["B") W $S($P(ND4,"^",12):"D",1:" ") I C["B" S PSGONF=$S('$G(PSGONF):ON_U_ON,1:+PSGONF_U_ON)
"RTN","PSGO",51,0)
 S SM=2-$S('$P(ND,"^",5):2,1:$P(ND,"^",6)),STS=$S($P(ND,U,28)]"":$P(ND,U,28),$P(ND,"^",9)]"":$P(ND,"^",9),1:"NF"),PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4) D
"RTN","PSGO",52,0)
 .I ($P(C,"^")["C"&($P(C,"^")'["z"))!($P(C,"^",4)["C") S (PSGID,SD)="",PSGOD="********"
"RTN","PSGO",53,0)
 I STS="A",($P(ND,U,27)="R") S STS="R"
"RTN","PSGO",54,0)
 S WS=0,PSGOD=$$ENDTC^PSGMI(PSGID)
"RTN","PSGO",55,0)
 S:PSJPWD WS=$$WS^PSJO(PSJPWD,PSGP,F,+O)
"RTN","PSGO",56,0)
 NEW MARX
"RTN","PSGO",57,0)
 S PSJORFLG=""
"RTN","PSGO",58,0)
 S:($P(C,"^")'="Cz") PSJORFLG=+O_$S(C["B":"P",C["C":"P",1:"U") S:($P(C,"^")="Cz") PSJORFLG=+O_$S($P(C,"^",4)["B":"P",$P(C,"^",4)["C":"P",1:"U")
"RTN","PSGO",59,0)
 D DRGDISP^PSJLMUT1(PSGP,PSJORFLG,40,54,.MARX,0)
"RTN","PSGO",60,0)
 NEW X F X=0:0 S X=$O(MARX(X)) Q:'X  W @($S(X=1:"?9",1:"!?11")) W MARX(X) D:X=1
"RTN","PSGO",61,0)
 . N RNDT,O2 S O2=O S:+O2=O O2=O2_"P" S RNDT=$$LASTREN^PSJLMPRI(PSGP,O2) I RNDT]"" S RNDT=$E($$ENDTC^PSGMI(RNDT),1,5)
"RTN","PSGO",62,0)
 . I ($P(C,"^")'="Cz") W ?50,$S(C["C":"?",ST'="z":ST,1:"?"),?53,$E(PSGOD,1,5)
"RTN","PSGO",63,0)
 . I ($P(C,"^")="Cz") W ?50,$S($P(C,"^",4)["C":"?",ST'="z":ST,1:"?"),?53,$E(PSGOD,1,5)
"RTN","PSGO",64,0)
 . S SD=$$ENDTC^PSGMI(SD) W ?60,$E(SD,1,5),?67,STS
"RTN","PSGO",65,0)
 . I NF!WS!SM!PF!RNDT W ?71 W:NF "NF " W:WS "WS " W:RNDT RNDT_" " W:SM $E("HSM",SM,3) W:PF ?79,"*"
"RTN","PSGO",66,0)
 I ND6]"" S Y=$$ENSET^PSGSICHK($P(ND6,"^")) W !?11 F X=1:1:$L(Y," ") S V=$P(Y," ",X) W:$L(V)+$X>66 !?11 W V_" "
"RTN","PSGO",67,0)
 K PSJORFLG
"RTN","PSGO",68,0)
 Q
"RTN","PSGO",69,0)
 ;
"RTN","PSGO",70,0)
TF ;
"RTN","PSGO",71,0)
 NEW SLS S SLS="",$P(SLS," -",40)=""
"RTN","PSGO",72,0)
 I $P(C,"^")="Cz" Q:(TF2=$P(C,"^",2))  S TF2=$P(C,"^",2)
"RTN","PSGO",73,0)
 S LN2=$S(($P(C,"^")="Cz"):$$TXT^PSJO(C),C="A":$$TXT^PSJO("A"),C["CC":$$TXT^PSJO("PR"),C["CD":$$TXT^PSJO("PC"),C["C":$$TXT^PSJO("P"),C["BD":$$TXT^PSJO("NC"),C["B":$$TXT^PSJO("N"),C="DF":$$TXT^PSJO("DF"),1:$$TXT^PSJO("NA"))
"RTN","PSGO",74,0)
 W:$D(^TMP("PSG",$J,C)) !,$E($E(SLS,1,(80-$L(LN2))/2)_" "_LN2_$E(SLS,1,(80-$L(LN2))/2),1,80)
"RTN","PSGO",75,0)
 I $P(C,"^")'="Cz" S F="^PS("_$S(C["C":"53.1,",C["B":"53.1,",1:"55,"_PSGP_",5,",1:"53.1,") S TF=$S(C["C":0,1:TF)
"RTN","PSGO",76,0)
 I $P(C,"^")="Cz" N CCL S CCL=$P(C,"^",4) S F="^PS("_$S(CCL["C":"53.1,",CCL["B":"53.1,",1:"55,"_PSGP_",5,",1:"53.1,") S TF=$S(CCL["C":0,1:TF)
"RTN","PSGO",77,0)
 Q
"RTN","PSGO",78,0)
 ;
"RTN","PSGO",79,0)
GET ;
"RTN","PSGO",80,0)
 S $P(LN2,"-",81)="",PG=$D(PSGVWA),(ON,PSGONC,PSGONR,PSGONV,SLS)="",$P(SLS," -",15)="",TF=1,RB=$S(PSJPRB]"":PSJPRB,1:"*NF*"),WD=$S(PSJPWDN]"":PSJPWDN,PSJPWD:PSJPWD_";DIC(42,",1:"*NF*")
"RTN","PSGO",81,0)
 ;
"RTN","PSGO",82,0)
NP I ON,'CML W $C(7) R !," '^' TO QUIT ",NP:DTIME W:'$T $C(7) S:'$T NP="^" W:NP'["^" $C(13),"                     ",$C(13),# Q
"RTN","PSGO",83,0)
 I ON,CML D BOT
"RTN","PSGO",84,0)
 Q:$G(PSGOL)="N"
"RTN","PSGO",85,0)
 ;
"RTN","PSGO",86,0)
HEADER ;
"RTN","PSGO",87,0)
 S PG=PG+1
"RTN","PSGO",88,0)
 S:'$D(PSJOPC) PSJOPC=1 S PSJTEAM=$S($D(PSJSEL("TM")):1,1:0)
"RTN","PSGO",89,0)
 D ENTRY^PSJHEAD(PSGP,PSJOPC,PG,$G(PSJNARC),PSJTEAM)
"RTN","PSGO",90,0)
 W:PG>1 !,$E(LN2,1,80) Q
"RTN","PSGO",91,0)
 ;
"RTN","PSGO",92,0)
BOT ;
"RTN","PSGO",93,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSGO",94,0)
 W !,?2,$P(PSGP(0),"^"),?40,PSJPPID,?70,$E($P(PSJPDOB,"^",2),1,8) Q
"RTN","PSGO",95,0)
 ;
"RTN","PSGO",96,0)
ENHEAD ;
"RTN","PSGO",97,0)
 K LN2,PSGPR,PSGPRP D NOW^%DTC S HDT=$$ENDTC^PSGMI(+$E(%,1,12)),PSGVWA=1,PSGOH="U N I T   D O S E   P R O F I L E" D GET
"RTN","PSGO",98,0)
 D D1 K PSGONC,PSGONR,PSGONV,PSGVWA Q
"RTN","PSGO",99,0)
 ;
"RTN","PSGO",100,0)
ENVBW ;
"RTN","PSGO",101,0)
 S PSGOH=$S(PSGVBWTO=1:"N O N - V E R I F I E D   O R D E R S",PSGVBWTO=2:"P E N D I N G   O R D E R S",1:"N O N - V E R I F I E D / P E N D I N G   O R D E R S")
"RTN","PSGO",102,0)
 D EN Q
"RTN","PSGO",103,0)
ENPR ;
"RTN","PSGO",104,0)
 S PSGOH="U N I T  D O S E  P R O F I L E" G GET
"RTN","PSGO",105,0)
 Q
"RTN","PSGOE")
0^57^B26201410^B26201410
"RTN","PSGOE",1,0)
PSGOE ;BIR/CML3-PROFILE AND ORDER ENTRY (MAIN DRIVER) ;24 Feb 99 / 10:40 AM
"RTN","PSGOE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**22,29,56,72,95,80,133,181,275**;16 DEC 97;Build 157
"RTN","PSGOE",3,0)
 ;
"RTN","PSGOE",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOE",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSGOE",6,0)
 ;
"RTN","PSGOE",7,0)
 ;N PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSGOE",8,0)
 ;
"RTN","PSGOE",9,0)
EN ;
"RTN","PSGOE",10,0)
 N PSJLK,PSJPROT,XQORS,VALMEVL,PSJSYSO D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGOE",11,0)
 S (PSGOL,PSGOP,PSGNEF,PSGOEAV,PSGPXN)="" I $P(PSJSYSU,";",2)&($P(PSJSYSU,";")'=3) S PSGION=ION D DDEV D ^%ZISC I DDEV="^" G DONE
"RTN","PSGOE",12,0)
 K PSGVBY L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE
"RTN","PSGOE",13,0)
 F  S (PSJLMCON,PSGPTMP)=0 D ENDPT^PSGP,HK Q:PSGP'>0  D   I PSJLK D UL^PSSLOCK(PSGP)
"RTN","PSGOE",14,0)
 .K ^TMP("PSJ",$J)
"RTN","PSGOE",15,0)
 .S PSJLK=$$L^PSSLOCK(PSGP,1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) Q
"RTN","PSGOE",16,0)
 .N NXTPT S NXTPT=0  ;NXTPT=1 indicates OE is complete for this patient
"RTN","PSGOE",17,0)
 .K PSJLMPRO S PSJLMCON=0
"RTN","PSGOE",18,0)
 .S PSJPROT=1,DFN=PSGP D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSGOE",19,0)
 .F  Q:$G(NXTPT)  D
"RTN","PSGOE",20,0)
 ..K PSGRDTX
"RTN","PSGOE",21,0)
 ..I $G(PSJLMCON)!$G(PSJNEWOE) D
"RTN","PSGOE",22,0)
 ...S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSGOE",23,0)
 ...S PSJLMPRO=1,PSJLMCON=1,PSJNEWOE=0 D EN^VALM("PSJU LM OE")
"RTN","PSGOE",24,0)
 ..I $G(PSJNEWOE)!($G(VALMBCK)="Q") S PSJNEWOE=0 Q
"RTN","PSGOE",25,0)
 ..I $G(PSJLMCON)&$G(PSJLMPRO)&'$D(^TMP("PSJ",$J)) D  Q
"RTN","PSGOE",26,0)
 ...S PSJLMCON=0,PSJLMPRO=0 D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSGOE",27,0)
 ...I $G(PSJNEWOE) S NXTPT=0 Q
"RTN","PSGOE",28,0)
 ...S NXTPT=1
"RTN","PSGOE",29,0)
 ..S NXTPT=1,PSJNEWOE=0 ; Go on to next patient
"RTN","PSGOE",30,0)
 .I $G(PSGPXN),$P(PSJSYSW0,U,29)]"" S PSGPXPT=PSGP D  K PSGPXPT S PSGPXN=0
"RTN","PSGOE",31,0)
 ..N DFN,PSGP S (PSGP,DFN)=PSGPXPT D ^PSGPER
"RTN","PSGOE",32,0)
 .D ENCV^PSGSETU
"RTN","PSGOE",33,0)
 K PSJLMPRO,^TMP("PSJPRO",$J),^TMP("PSJ",$J),^TMP("PSJON",$J)
"RTN","PSGOE",34,0)
 ;
"RTN","PSGOE",35,0)
DONE ;
"RTN","PSGOE",36,0)
 I PSGOP,$P(PSJSYSL,"^",2)]"" D ENQL^PSGLW
"RTN","PSGOE",37,0)
 I $D(PSJSYSO),PSGOP,$O(^PS(53.44,DUZ,1,PSGOP,1,0)) S PSGOEPOF="" D ^PSGOEPO
"RTN","PSGOE",38,0)
 K PSJEXCPT,PSJOCER,^TMP($J,"PSJPRE")
"RTN","PSGOE",39,0)
 K D0,DDEV,FQC,J,MRN,ND,ND2,PSGNEF,PSGNEFDO,PSGNESDO,PSGOE,PSGOEA,PSGOEAV,PSGOEDMR,PSGOENOF,PSGOEPOF,PSGOL,PSGOP,PSGPX,PSGTOL,PSGTOO,PSGUOW,PSJOPC,PSJORTOU,PSJORVP,PRI,PX,XX L -^PS(53.45,PSJSYSP)
"RTN","PSGOE",40,0)
 K PSGOEORF,ORIFN,ORETURN,PSJORL,PSJORPCL,PSJORPV,PSJNOO,DDH,DDN,DRGI,FQ,HF,I1,ND1,NF,PDRG,PSGACTO,PSGAL,PSGCANFL,PSGDA,PSGPEN,PSGPENWS,PSGY
"RTN","PSGOE",41,0)
 G:$G(PSGPXN) ^PSGPER1 D ENKV^PSGSETU K ND1,PSG25,PSG26,PSGEB,PSBEBN,PSGNODE,PSGOAT,PSGSTAT,DDN,I2 Q
"RTN","PSGOE",42,0)
 Q
"RTN","PSGOE",43,0)
 ;
"RTN","PSGOE",44,0)
HK ; Housekeeping (a nice COBOL term)
"RTN","PSGOE",45,0)
 S PSGOENOF=0 I +PSJSYSU=1 D NOW^%DTC F Q=%:0 Q:PSGOENOF  S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q  F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,4)),$P(^(4),"^",10) S PSGOENOF=1 Q
"RTN","PSGOE",46,0)
 I PSGOP,PSGOP'=PSGP D
"RTN","PSGOE",47,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSGOE",48,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,"^",2)]"" ENQL^PSGLW
"RTN","PSGOE",49,0)
 I $D(PSJSYSO),PSGOP,PSGOP'=PSGP S PSGOEPOF="" D ^PSGOEPO
"RTN","PSGOE",50,0)
 S:PSGP>0 PSJORVP=PSGP_";DPT(",PSJORL=$$ENORL^PSJUTL(PSJPWD),PSGOP=PSGP,X=""
"RTN","PSGOE",51,0)
 Q
"RTN","PSGOE",52,0)
 ;
"RTN","PSGOE",53,0)
ORSU ; Oe/Rr Set-Up ;Not used anymore
"RTN","PSGOE",54,0)
 ;K %ZIS,IO("Q") S IOP="HOME" D ^%ZIS
"RTN","PSGOE",55,0)
 ;S PSGOEORF=$O(^DIC(9.4,"B","INPATIENT MEDICATIONS",0)) I PSGOEORF S PSGOEORF=$S($D(^ORD(100.99,1,20,PSGOEORF,0)):$P(^(0),"^",2),1:0)
"RTN","PSGOE",56,0)
 ;I PSGOEORF S PSJORTOU=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",0)),PSJORPCL=$O(^ORD(101,"B","PSJ OR PAT OE",0)),PSJORPCL=PSJORPCL_";ORD(101,"
"RTN","PSGOE",57,0)
 Q
"RTN","PSGOE",58,0)
 ;
"RTN","PSGOE",59,0)
DDEV ;
"RTN","PSGOE",60,0)
 F  S POP=1 R !!,"Select Device to print ORDERS (10-1158): ",DDEV:DTIME W:'$T $C(7) S:'$T DDEV="^" Q:DDEV="^"!(DDEV=".")  D:DDEV?1."?" DDH K %ZIS,IO("Q") S %ZIS="NQ",IOP=DDEV D ^%ZIS Q:'POP
"RTN","PSGOE",61,0)
 S:DDEV="^" %=-1 Q:POP  I $E(IOST)'="P"!(PSGION=ION) W $C(7),!!?2,"The device you have selected is not a printer.  You must select a printer." W:PSGION=ION !,"You cannot print the orders to your terminal." G DDEV
"RTN","PSGOE",62,0)
 S PSJSYSO=ION_"^"_IO W:$S(DDEV=" ":1,$L(DDEV)'<$L(ION):0,1:DDEV=$E(ION,1,$L(DDEV))) $S(DDEV=" ":"  "_ION,1:$E(ION,$L(DDEV)+1,$L(ION)))
"RTN","PSGOE",63,0)
 F Q=0:0 S Q=$O(^PS(53.44,DUZ,1,Q)) Q:'Q  I $O(^(Q,1,0)) Q
"RTN","PSGOE",64,0)
 Q:'Q  W !!?2,"You have unprinted orders.  If you do not print them now, you will not be",!,"able to print them from here later."
"RTN","PSGOE",65,0)
 F  W !!,"Do you want to print them now" S %=1 D YN^DICN Q:%  W !!?2,"Enter 'YES' to print the orders now.  If you enter 'NO', you will not be",!,"able to print them from here later.  (Enter '^' to exit this option.)"
"RTN","PSGOE",66,0)
 Q:%<0  I %=1 S PSGOEPOF="A" D ^PSGOEPO S %=0 Q
"RTN","PSGOE",67,0)
 S DA=DUZ,DIK="^PS(53.44," D ^DIK S %=0 Q
"RTN","PSGOE",68,0)
 ;
"RTN","PSGOE",69,0)
DDH ;
"RTN","PSGOE",70,0)
 W !!?2,"Select a device to print each patient's orders (VA Form 10-1158) after you",!,"have entered them.  If you do not select a device, no orders will print." Q
"RTN","PSGOE",71,0)
 ;
"RTN","PSGOE",72,0)
CHUCK ;
"RTN","PSGOE",73,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  R !!,"PSJSYSU: ",PSJSYSU:DTIME S:'$T PSJSYSU="^" I "^"'[PSJSYSU G EN
"RTN","PSGOE",74,0)
 Q
"RTN","PSGOU")
0^36^B34119458^B31799973
"RTN","PSGOU",1,0)
PSGOU ;BIR/CML3,MV-PROFILE UTILITIES ;19 SEP 96 / 3:59 PM
"RTN","PSGOU",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**34,110,181,275**;16 DEC 97;Build 157
"RTN","PSGOU",3,0)
 ;
"RTN","PSGOU",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177
"RTN","PSGOU",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOU",6,0)
 ;
"RTN","PSGOU",7,0)
ECHK ;
"RTN","PSGOU",8,0)
 D NOW^%DTC N PSGDT S PSGDT=% ;***Store PSGDT with seconds.
"RTN","PSGOU",9,0)
 S C="A",ON=O_"U" G:SD>PSGDT DS S ND=$G(^PS(55,PSGP,5,O,0)) G:$S($P(ND,"^",9)="":1,1:"DE"'[$P(ND,"^",9)) DS S ND4=$G(^(4))
"RTN","PSGOU",10,0)
 I ST'="O",SD'<PSGODT,$P(ND,"^",9)="E",$P(ND4,"^",16) G DS
"RTN","PSGOU",11,0)
 I ST="O",$P(ND,"^",9)'["D",$S('$P(ND4,"^",UDU):1,SD<PSGODT:0,1:$P(ND4,"^",16)) G DS
"RTN","PSGOU",12,0)
 I PSGOL="S",(SD>$P($G(PSJDCEXP),U,2)) S C="DF" G DS
"RTN","PSGOU",13,0)
 Q:PSGOL="S"  S C="O"
"RTN","PSGOU",14,0)
 ;
"RTN","PSGOU",15,0)
DS ; Get drug name
"RTN","PSGOU",16,0)
 NEW DRUGNAME D DRGDISP^PSJLMUT1(PSGP,+O_"U",80,0,.DRUGNAME,1) S DRG=DRUGNAME(1)
"RTN","PSGOU",17,0)
 ;
"RTN","PSGOU",18,0)
SET ; Set orders into TMP
"RTN","PSGOU",19,0)
 N PSJCLN,CLINSORT
"RTN","PSGOU",20,0)
 S PSJCLN=$$CLINIC^PSJO1(PSGP,ON) I (PSJCLN]""),($P(C,"^")'="Cz") S CLINSORT=$$CLINSORT^PSJO1(C) S C="Cz^"_PSJCLN_"^"_CLINSORT_"^"_C
"RTN","PSGOU",21,0)
 I ON["P",$G(P("PRNTON"))]"",$G(PRNTON)=+P("PRNTON") Q
"RTN","PSGOU",22,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSGOU",23,0)
 S ^TMP("PSG",$J,C,ST,DRG_"^"_ON)=$G(NF)
"RTN","PSGOU",24,0)
 Q
"RTN","PSGOU",25,0)
 ;
"RTN","PSGOU",26,0)
ENS F S=0:0 R !!,"Sort by DATE or MEDICATION:  M// ",PSGOS:DTIME D SCHK Q:CHK
"RTN","PSGOU",27,0)
 Q
"RTN","PSGOU",28,0)
 ;
"RTN","PSGOU",29,0)
ENL ; Ask profile type
"RTN","PSGOU",30,0)
 N PSJCLCHK
"RTN","PSGOU",31,0)
 I $G(DFN),$$CLORCHK^PSJP(DFN) S PSJCLCHK=1
"RTN","PSGOU",32,0)
 F  W !!,"SHORT, LONG, or NO Profile?  ",$S('$D(PSJPDD)!$G(PSJCLCHK):"SHORT",'PSJPDD:"SHORT",1:"LONG"),"// " R PSGOL:DTIME W:'$T $C(7) S:'$T PSGOL="^" Q:PSGOL="^"  D LCHK Q:"^SLN"[PSGOL&($L(PSGOL)=1)
"RTN","PSGOU",33,0)
 Q
"RTN","PSGOU",34,0)
 ;
"RTN","PSGOU",35,0)
SCHK ; Sort type
"RTN","PSGOU",36,0)
 I '$T!(PSGOS["^") S PSGOS="^",CHK=1 Q
"RTN","PSGOU",37,0)
 S CHK=0 D:PSGOS["?" SM Q:PSGOS["?"  I PSGOS="" S PSGOS="M",CHK=1 W "MEDICATION" Q
"RTN","PSGOU",38,0)
 F X="DATE","MEDICATION" I $P(X,PSGOS)="" W $P(X,PSGOS,2) S PSGOS=$E(PSGOS),CHK=1 Q
"RTN","PSGOU",39,0)
 W:'CHK $C(7),"  ??" Q
"RTN","PSGOU",40,0)
 ;
"RTN","PSGOU",41,0)
SM W !!?3,"Enter 'MEDICATION' (or 'M', or press the RETURN key to have this patient's   orders shown alphabetically by drug name.  Enter 'DATE' (or 'D') to have this   patient's orders shown by start date (the newest orders showing first)."
"RTN","PSGOU",42,0)
 W "  Enter  a '^' to not show this patient's orders." Q
"RTN","PSGOU",43,0)
 ;
"RTN","PSGOU",44,0)
LCHK ; Long or short profile
"RTN","PSGOU",45,0)
 I PSGOL?1."?" D LM Q
"RTN","PSGOU",46,0)
 I PSGOL="" S PSGOL=$S('$D(PSJPDD)!$G(PSJCLCHK):"S",'PSJPDD:"S",1:"L") W $S('$D(PSJPDD):"  SHORT",'PSJPDD:"  SHORT",1:"  LONG") Q
"RTN","PSGOU",47,0)
 I PSGOL?.E1L.E F Q=1:1:$L(PSGOL) I $E(PSGOL,Q)?1L S PSGOL=$E(PSGOL,1,Q-1)_$C($A(PSGOL,Q)-32)_$E(PSGOL,Q+1,$L(PSGOL))
"RTN","PSGOU",48,0)
 F X="NO PROFILE","LONG","SHORT" I $P(X,PSGOL)="" W $P(X,PSGOL,2) S PSGOL=$E(PSGOL) Q
"RTN","PSGOU",49,0)
 W:'$T $C(7),"  ??" Q
"RTN","PSGOU",50,0)
 ;
"RTN","PSGOU",51,0)
LM W !!?3,"Enter 'SHORT' (or 'S', or press the RETURN key) to exclude this patient's",!,"discontinued and expired orders in the following profile.  Enter 'LONG' (or 'L') to include those orders."
"RTN","PSGOU",52,0)
 W "  Enter 'NO' (or 'N') to bypass the profile com-",!,"pletely.  Enter '^' if you wish to go no further with this patient." Q
"RTN","PSGOU",53,0)
 ;
"RTN","PSGOU",54,0)
ENU ; update status field to reflect expired orders, if necessary
"RTN","PSGOU",55,0)
 W !!,"...a few moments, I have some updating to do..."
"RTN","PSGOU",56,0)
ENUNM ;
"RTN","PSGOU",57,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSGOU",58,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSGOU",59,0)
 F PSGO2=+PSJPAD:0 S PSGO2=$O(^PS(55,PSGP,5,"AUS",PSGO2)) Q:'PSGO2  Q:PSGO2>PSGDT  F PSGO3=0:0 S PSGO3=$O(^PS(55,PSGP,5,"AUS",PSGO2,PSGO3)) Q:'PSGO3  S PSGO4=$G(^PS(55,PSGP,5,PSGO3,0)) D
"RTN","PSGOU",60,0)
 .I PSGO4]"",$S($E($G(PSGALO),1,2)="10":"AHR"[$E($P(PSGO4,"^",9)),1:"AR"[$E($P(PSGO4,"^",9))) D ENUH
"RTN","PSGOU",61,0)
 K PSGO1,PSGO2,PSGO3,PSGO4,UD Q
"RTN","PSGOU",62,0)
 ;
"RTN","PSGOU",63,0)
ENGORD ; get and sort orders
"RTN","PSGOU",64,0)
 D NOW^%DTC S PSGDT=%,X1=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT),UDU=$S($P(PSJSYSU,";",3)>1:3,1:1) K ^TMP("PSG",$J)
"RTN","PSGOU",65,0)
 W:'$D(PSGPR) !!,"...a few moments, please..." D ENUNM
"RTN","PSGOU",66,0)
 F ST="C","O","OC","P","R" F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  D ECHK
"RTN","PSGOU",67,0)
 Q:$D(PSGONNV)
"RTN","PSGOU",68,0)
 NEW DRUGNAME
"RTN","PSGOU",69,0)
 N PRNTON F SD="I","N" S (PRNTON,O)=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",ND=$G(^PS(53.1,O,0)) I $P(ND,"^",4)="U" D
"RTN","PSGOU",70,0)
 . S ST=$P(ND,"^",7),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSGOU",71,0)
 . D DRGDISP^PSJLMUT1(PSGP,+O_"P",80,0,.DRUGNAME,1) S DRG=DRUGNAME(1)
"RTN","PSGOU",72,0)
 . S C=$S(P("PRNTON")]"":"BD",1:"BA") D SET
"RTN","PSGOU",73,0)
 Q:+PSJSYSU'=3  S SD="P",O=0
"RTN","PSGOU",74,0)
 N PRNTON F  S (PRNTON,O)=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",ND=$G(^PS(53.1,O,0)) I $P(ND,"^",4)="U" D
"RTN","PSGOU",75,0)
 . S ST=$P(ND,"^",7),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSGOU",76,0)
 . D DRGDISP^PSJLMUT1(PSGP,+O_"P",80,0,.DRUGNAME,1) S DRG=DRUGNAME(1)
"RTN","PSGOU",77,0)
 . S C=$$CKPC^PSGOU(PSGP,$P(ND,U,25),O)
"RTN","PSGOU",78,0)
 . I C="CB",$P($G(^PS(53.1,O,.2)),U,4)="S" S C="CA"
"RTN","PSGOU",79,0)
 . I P("PRNTON")]"" S C="CD"
"RTN","PSGOU",80,0)
 . D SET
"RTN","PSGOU",81,0)
 Q
"RTN","PSGOU",82,0)
 ;
"RTN","PSGOU",83,0)
MAE ; change status to expired
"RTN","PSGOU",84,0)
ENUH ;
"RTN","PSGOU",85,0)
 S $P(^PS(55,PSGP,5,PSGO3,0),"^",9)="E",ORIFN=$P(PSGO4,"^",21) I ORIFN D EN1^PSJHL2(PSGP,"SC",PSGO3_"U")
"RTN","PSGOU",86,0)
 Q
"RTN","PSGOU",87,0)
 ;
"RTN","PSGOU",88,0)
CKPC(DFN,OLDON,NEWON) ; Compare old provider comments to new for speed finish.
"RTN","PSGOU",89,0)
 N X,Y,Q,QQ,PSGOEEWF,PSJFLAG
"RTN","PSGOU",90,0)
 I $P($G(^PS(53.1,+NEWON,0)),U,24)'="R" Q "CB"
"RTN","PSGOU",91,0)
 S PSJFLAG=0,PSGOEEWF="^PS(55,"_DFN_","_$S(OLDON["V":"""IV""",1:5)_","_+OLDON_","
"RTN","PSGOU",92,0)
 S (Q,QQ)=0 F  S Q=$O(^PS(53.1,NEWON,12,Q)) Q:'Q  S QQ=Q,X=$G(^(Q,0)),Y=$G(@(PSGOEEWF_"12,"_Q_",0)")) I X'=Y S PSJFLAG=1 Q
"RTN","PSGOU",93,0)
 I PSJFLAG!$O(@(PSGOEEWF_"12,"_QQ_")")) Q "CB"
"RTN","PSGOU",94,0)
 S (Q,QQ)=0 F  S Q=$O(@(PSGOEEWF_"12,"_Q_")")) Q:'Q  S QQ=Q,X=$G(^(Q,0)),Y=$G(^PS(53.1,NEWON,12,Q,0)) I X'=Y S PSJFLAG=1 Q
"RTN","PSGOU",95,0)
 I PSJFLAG!$O(^PS(53.1,+NEWON,12,QQ)) Q "CB"
"RTN","PSGOU",96,0)
 Q "CC"
"RTN","PSGOU",97,0)
 ;
"RTN","PSGOU",98,0)
ENRNAT(OWD,NWD,SC,OAT) ; Determine admin times for renewal orders.
"RTN","PSGOU",99,0)
 ;OWD=ORIGINAL W, NWD=NEW WD LOCATION, SC=SCHEDULE, OAT=ORDER ADMIN TIMES
"RTN","PSGOU",100,0)
 N OWAT,SCP,X,Y
"RTN","PSGOU",101,0)
 S OOAT=OAT,SCP=+$O(^PS(51.1,"APPSJ",+SC,0)),WAT=$P($G(^PS(51.1,SCP,1,+$G(OWD),0)),U,2)
"RTN","PSGOU",102,0)
 F X="WAT","OAT" F Y=1:1 Q:$L(@X)>240!($P(@X,"-",Y)="")  S $P(@X,"-",Y)=$P(@X,"-",Y)_$E("0000",1,4-$L($P(@X,"-",Y)))
"RTN","PSGOU",103,0)
 I OAT'=WAT Q OOAT
"RTN","PSGOU",104,0)
 S X=$P($G(^PS(51.1,+SCP,1,NWD,0)),U,2) I X Q X
"RTN","PSGOU",105,0)
 Q OOAT
"RTN","PSGP")
0^40^B11695903^B12038299
"RTN","PSGP",1,0)
PSGP ;BIR/CML3-PATIENT LOOK-UP ;15 Apr 98 / 9:05 AM
"RTN","PSGP",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**10,53,111,181,267,275**;16 DEC 97;Build 157
"RTN","PSGP",3,0)
 ;
"RTN","PSGP",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGP",5,0)
 ; Reference to ^SDAMA203 is supported by DBIA 4133.
"RTN","PSGP",6,0)
 ;
"RTN","PSGP",7,0)
ENDPT ; get any patient
"RTN","PSGP",8,0)
 N HIT
"RTN","PSGP",9,0)
 K DIC,PSGP,Y W !!,"Select "_$S($D(PSGDICA):PSGDICA_" ",1:"")_"PATIENT: " R X:DTIME S:X["^" PSJSTOP=1 I "^"[X S (Y,PSGP)=-1 G DONE
"RTN","PSGP",10,0)
 D EN^PSJDPT
"RTN","PSGP",11,0)
 I Y'>0 G ENDPT
"RTN","PSGP",12,0)
 K DIC
"RTN","PSGP",13,0)
 ;
"RTN","PSGP",14,0)
CHK ;
"RTN","PSGP",15,0)
 ;Clean up arrays use in order checks
"RTN","PSGP",16,0)
 K PSJEXCPT,PSJOCER
"RTN","PSGP",17,0)
 S (DFN,PSGP)=+Y,VA200=1 D INP^VADPT
"RTN","PSGP",18,0)
 I VAIN(4) S PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$P($G(^PS(55,PSGP,5.1)),"^",4),PSJPDD="" G CNV
"RTN","PSGP",19,0)
 S PSJPCAF="",VAIP("D")="L" D IN5^VADPT I 'VAIP(13,1) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." D ENCONT^PSJP G:'(%=1) ENDPT
"RTN","PSGP",20,0)
 S PSJPAD=VAIP(13,1),PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38),PSGOD=$$ENDTC^PSGMI(PSGID)
"RTN","PSGP",21,0)
 I $G(PSGOD) W $C(7),!!?3,"PATIENT IS FOUND TO BE D",$P("ISCHARG^ECEAS","^",X+1),"ED AS OF ",PSGOD,"." D ENCONT^PSJP G:'(%=1) ENDPT
"RTN","PSGP",22,0)
 S PSJPAD=VAIP(13,1),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD="",PSJPDD=PSGID_"^"_PSGOD S:X PSJPDD=PSJPDD_"^1"
"RTN","PSGP",23,0)
 ;
"RTN","PSGP",24,0)
CNV ;
"RTN","PSGP",25,0)
 I $G(DFN) I '$$AA^PSJDPT(DFN) S Y=-1 G ENDPT
"RTN","PSGP",26,0)
 D DEM^VADPT,PID^VADPT,HTWT^PSJAC(DFN)
"RTN","PSGP",27,0)
 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSGP",28,0)
 F X="PSJPAD","PSJPDOB","PSJPTD" I +@X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSGP",29,0)
 ;
"RTN","PSGP",30,0)
WP ; ward parameters
"RTN","PSGP",31,0)
 S PSJSYSW0="",PSJSYSW=0 I PSJPWD S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSGP",32,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16))
"RTN","PSGP",33,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSGP",34,0)
 I PSJSYSL D
"RTN","PSGP",35,0)
 .S:X X='$P(PSJSYSP0,"^",10) S IOP=$S($P(PSJSYSP0,"^",13)]"":$P(PSJSYSP0,"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSGP",36,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D ^%ZISC
"RTN","PSGP",37,0)
 ;
"RTN","PSGP",38,0)
DONE ;
"RTN","PSGP",39,0)
 K DA,DIC,NB,ND,NS,PSGID,PSGOD,VA200,VADM,VAIN,VAIP,VAMT,X,Y(0),Y(0,0) Q
"RTN","PSGP",40,0)
 ;
"RTN","PSGP",41,0)
COP ;check for appointments in clinics that allowed inpatient orders
"RTN","PSGP",42,0)
 S HIT=0 Q:'$$PATCH^XPDUTL("SD*5.3*285")
"RTN","PSGP",43,0)
 N SQ,A,VAIP,X,PSJF
"RTN","PSGP",44,0)
 D IN5^VADPT
"RTN","PSGP",45,0)
 D NOW^%DTC S (PSJF,VASD("F"))=$P(%,".")-1
"RTN","PSGP",46,0)
 D SDA^VADPT
"RTN","PSGP",47,0)
 S SQ=0 F  S SQ=$O(^UTILITY("VASD",$J,SQ)) Q:'SQ  S A=^(SQ,"I") I $$SDIMO^SDAMA203($P(A,"^",2),DFN)>0 S HIT=1 Q
"RTN","PSGP",48,0)
 I $O(^PS(55,DFN,5,"AUN",PSJF))!($O(^PS(55,DFN,"IV","AIN",PSJF))) S HIT=1
"RTN","PSGP",49,0)
 I HIT D ENCONT^PSJP
"RTN","PSGP",50,0)
 Q
"RTN","PSGVBW")
0^17^B97529412^B96887631
"RTN","PSGVBW",1,0)
PSGVBW ;BIR/CML3,MV - VERIFY ORDERS BY WARD, WARD GROUP, PATIENT, OR PRIORITY ;10/22/98 3:14 PM
"RTN","PSGVBW",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**5,16,39,59,62,67,58,81,80,110,111,133,139,155,241,243,265,275**;DEC 16, 1997;Build 157
"RTN","PSGVBW",3,0)
 ;
"RTN","PSGVBW",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGVBW",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177
"RTN","PSGVBW",6,0)
 ; Reference to ^DPT is supported by DBIA #10035
"RTN","PSGVBW",7,0)
 ;
"RTN","PSGVBW",8,0)
 N PSJNEW,PSGPTMP,PPAGE,CL,CG S PSJNEW=1
"RTN","PSGVBW",9,0)
START ; Lookup patient by ward group, ward, priority, or patient; depending on value of PSGSS
"RTN","PSGVBW",10,0)
 ; 
"RTN","PSGVBW",11,0)
 D ENCV^PSGSETU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",12,0)
 D ^PSIVXU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",13,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSGVBW",14,0)
 I '$D(^XTMP("PSJPVNV")) D
"RTN","PSGVBW",15,0)
 .K DIR S DIR(0)="Y",DIR("A")="Display an Order Summary",DIR("B")="NO"
"RTN","PSGVBW",16,0)
 .S DIR("?",1)="Enter 'YES' to see a summary of orders by type and ward group",DIR("?")="or 'NO' to go directly to patient selection."
"RTN","PSGVBW",17,0)
 .D ^DIR K DIR Q:$D(DIRUT)!$D(DUOUT)  I Y D CNTORDRS^PSGVBWU
"RTN","PSGVBW",18,0)
 K ^TMP("PSJ",$J) S PSGPXN=0 D GTOOP G:$D(DIRUT) DONE L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE
"RTN","PSGVBW",19,0)
 S PSGSSH="VBW",PSGPXN=0,PSJPROT=$S($P(PSJSYSU,";",3)=3:3,$G(PSJRNF):3,$G(PSJIRNF):3,1:1)
"RTN","PSGVBW",20,0)
 S PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING")
"RTN","PSGVBW",21,0)
 F  K ^TMP("PSJSELECT",$J) D PRI^PSGSEL Q:"^"[PSGSS  F  S (PSGP,WD,WG)=0 S PSGPTMP=0,PPAGE=1 K PSGPRIF D @PSGSS Q:+Y'>0  D GO
"RTN","PSGVBW",22,0)
 ;
"RTN","PSGVBW",23,0)
DONE ; Cleanup
"RTN","PSGVBW",24,0)
 D DONE2
"RTN","PSGVBW",25,0)
 K SETWDN,PTPRI,SETTM,SETPN,SUBS,TMPWD,STATUS
"RTN","PSGVBW",26,0)
 K CHK,D0,DRGI,FQC,J,ND,ON,PN,PSGODT,PSGOEA,PSGOP,PSGSS,PSGSSH,RB,SD,ST,TM,WD,WDN,WG,PRI,PSJPNV,PSJCT,PSGCLF,PSGPRIF,LIDT,WDNAME,IFPRI
"RTN","PSGVBW",27,0)
 K PSGODDD,PSGOEORF,PSJORL,PSJORPCL,PSJORTOU,PSJORVP,PSGTOL,PSJTOO,PSGUOW,PSGONV,PX,PSGOEAV,PSGPX,PSGVBWTO,PSGVBWW,PSJOPC,PSGOENOF,PSJPROT,PSJLM,PSJASK
"RTN","PSGVBW",28,0)
 K PSJPAC,PSJINDEX,PSJCNT,PSIVSN,PSGWORP1,PSGWORP2,PSGVBY,PSGVBWN,PSGVBTM,PSGVBPN,PSGPXN,PSGPRIN,PSGPRD,PSGINWD,PSGINCL,PRDON,PRDNS,PRD,PPN,ORDT
"RTN","PSGVBW",29,0)
 L -^PS(53.45,PSJSYSP) G:$G(PSGPXN) ^PSGPER1 D ENKV^PSGSETU K ND Q
"RTN","PSGVBW",30,0)
 ;
"RTN","PSGVBW",31,0)
DONE2 ; Partial Cleanup
"RTN","PSGVBW",32,0)
 K ^TMP("PSGVBW",$J),^TMP("PSGVBW2",$J),^TMP("PSGVBW3",$J),^TMP("PSJSELECT",$J),^TMP("PSJLIST",$J),^TMP("PSJON",$J)
"RTN","PSGVBW",33,0)
 K PRD
"RTN","PSGVBW",34,0)
 Q
"RTN","PSGVBW",35,0)
 ;
"RTN","PSGVBW",36,0)
GO ; Find and display matching patients
"RTN","PSGVBW",37,0)
 I PSGSS'="P" W !,"...a few moments, please..." K ^TMP("PSGVBW",$J),^TMP("PSGVBW2",$J) D ARRAY K CHK,ON,PN,RB,SD,TM,WD,WDN,WG,X,Y
"RTN","PSGVBW",38,0)
 I PSGSS'="P",'$D(^TMP("PSGVBW",$J)) W !,$C(7),"NO ",PSGVBWW," ORDERS FOR ",$S(PSGSS="P":"PATIENT",PSGSS="L":"CLINIC GROUP",PSGSS="C":"CLINIC",PSGSS="PR":"PRIORITY",1:"WARD"),$S(PSGSS="G":" GROUP",1:"")," SELECTED." Q
"RTN","PSGVBW",39,0)
 D ^PSGVBW0,DONE2 Q
"RTN","PSGVBW",40,0)
 ;
"RTN","PSGVBW",41,0)
G ; Select a Ward Group
"RTN","PSGVBW",42,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD GROUP: "
"RTN","PSGVBW",43,0)
 S DIR("?")="^D GDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",44,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",45,0)
GDIC ; Ward Group lookup
"RTN","PSGVBW",46,0)
 K DIC S DIC="^PS(57.5,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 WG=+Y
"RTN","PSGVBW",47,0)
 W:X["?" !!,"Enter ""^OTHER"" to include all orders from the wards that do not",!,"belong to a ward group, or orders that have neither a ward nor a clinic.",! ;PSJ*5*241: Updated help text
"RTN","PSGVBW",48,0)
 Q
"RTN","PSGVBW",49,0)
C ; Select a Clinic
"RTN","PSGVBW",50,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGVBW",51,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",52,0)
CDIC ; Clinic lookup
"RTN","PSGVBW",53,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y
"RTN","PSGVBW",54,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGVBW",55,0)
 Q
"RTN","PSGVBW",56,0)
L ; Select a Clinic Group
"RTN","PSGVBW",57,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGVBW",58,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",59,0)
LDIC ; Clinic Group lookup
"RTN","PSGVBW",60,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y
"RTN","PSGVBW",61,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGVBW",62,0)
 Q
"RTN","PSGVBW",63,0)
W ; Select a Ward
"RTN","PSGVBW",64,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD: "
"RTN","PSGVBW",65,0)
 S DIR("?")="^D WDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",66,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",67,0)
WDIC ; Ward lookup
"RTN","PSGVBW",68,0)
 K DIC S DIC="^DIC(42,",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 WD=+Y
"RTN","PSGVBW",69,0)
 W:X["?" !!,"Enter ""^OTHER"" for Outpatient IV orders",!
"RTN","PSGVBW",70,0)
 Q
"RTN","PSGVBW",71,0)
PR ; Select order priority
"RTN","PSGVBW",72,0)
 K DIR S DIR(0)="SO^1:STAT;2:ASAP;3:ROUTINE"
"RTN","PSGVBW",73,0)
 S DIR("A")="Select 1-3 ",DIR("?")="        Choose a Priority."
"RTN","PSGVBW",74,0)
 S DIR("?",1)="Enter a PRIORITY to include all patients with orders containing that PRIORITY"
"RTN","PSGVBW",75,0)
 D ^DIR S:Y>0 PRD=+Y S:+Y>0 WDN=$S(PRD=1:"STAT",PRD=2:"ASAP",3:"ROUTINE")
"RTN","PSGVBW",76,0)
 Q
"RTN","PSGVBW",77,0)
P ; Select patient
"RTN","PSGVBW",78,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1 F  D ^PSJP Q:PSGP<0  D
"RTN","PSGVBW",79,0)
 .S PSJNV=0
"RTN","PSGVBW",80,0)
 .NEW ON,XX F ON=0:0 S ON=$O(^PS(53.1,"AS","N",PSGP,ON)) Q:'ON  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) I XX S PSJNV=1 Q
"RTN","PSGVBW",81,0)
 .;S PSJNV=$O(^PS(53.1,"AS","N",+PSGP,0)),PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",82,0)
 .S PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",83,0)
 .I 'PSJNV D ^PSJAC D
"RTN","PSGVBW",84,0)
 ..I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",85,0)
 ..S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",86,0)
 ..I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD!PSJNV  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  S PSJNV=1 Q
"RTN","PSGVBW",87,0)
 ..I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D" D IFT2 I  S PSJNV=1 Q
"RTN","PSGVBW",88,0)
 .S X=$S(PSJTOO=1:PSJNV,PSJTOO=2:PSJPEN,1:(PSJNV+PSJPEN))
"RTN","PSGVBW",89,0)
 .I X D SETPN S ^TMP("PSJSELECT",$J,PSJCNT)=PN,^TMP("PSJSELECT",$J,"B",$P(PN,U),PSJCNT)="",PSJCNT=PSJCNT+1 Q
"RTN","PSGVBW",90,0)
 .W !,"No ",PSGVBWW," orders found for this patient."
"RTN","PSGVBW",91,0)
 S:$D(^TMP("PSJSELECT",$J)) Y=1
"RTN","PSGVBW",92,0)
 Q
"RTN","PSGVBW",93,0)
ARRAY ; put patient(s) with non-verified orders into array
"RTN","PSGVBW",94,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",95,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING") I PSGSS="P" D IF S:$T ^TMP("PSGVBW",$J)=$P(PSGP(0),"^")_"^"_PSGP Q
"RTN","PSGVBW",96,0)
 G CG:PSGSS="L",CL:PSGSS="C",WD:PSGSS="W",PRI:PSGSS="PR" S WD=0 F  S WD=$O(^PS(57.5,"AC",WG,WD)) Q:'WD  D WD
"RTN","PSGVBW",97,0)
 Q
"RTN","PSGVBW",98,0)
 ;
"RTN","PSGVBW",99,0)
CG ; Find all clinics in selected clinic group
"RTN","PSGVBW",100,0)
 S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D CL
"RTN","PSGVBW",101,0)
 Q
"RTN","PSGVBW",102,0)
CL ; Find all patients in selected clinic
"RTN","PSGVBW",103,0)
 S WDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGVBW",104,0)
 S PSGP="",PSGCLF=1 F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:PSGP=""  D ^PSJAC,IF
"RTN","PSGVBW",105,0)
 K PSGCLF
"RTN","PSGVBW",106,0)
 Q
"RTN","PSGVBW",107,0)
WD ; Find all patients in selected ward
"RTN","PSGVBW",108,0)
 S WDN=$S($D(^DIC(42,WD,0)):$P(^(0),"^"),1:"")
"RTN","PSGVBW",109,0)
 I WDN]"" S PSGP=0 F  S PSGP=$O(^DPT("CN",WDN,PSGP)) Q:'PSGP  D
"RTN","PSGVBW",110,0)
 .I $S($D(^PS(55,"APV",PSGP)):1,$D(^PS(55,"APIV",PSGP)):1,$O(^PS(55,PSGP,5,"AUS",PSGDT)):1,1:$D(^PS(53.1,"AC",PSGP))) D ^PSJAC,IF
"RTN","PSGVBW",111,0)
 Q
"RTN","PSGVBW",112,0)
PRI ; Find orders with selected Priority
"RTN","PSGVBW",113,0)
 ; Once a patient is identified in any status index ("I", "N", or "P"), all orders for that patient are checked in the 
"RTN","PSGVBW",114,0)
 ; IF subroutine. To prevent unnecessary duplication of processing, "PSGVBW3" node of ^TMP, sorted by patient, will be 
"RTN","PSGVBW",115,0)
 ; set when a patient's orders are processed, and checked for each status index. If patient exists in the "PSGVBW3" node,
"RTN","PSGVBW",116,0)
 ; patient has already been processed, so quit.
"RTN","PSGVBW",117,0)
 N NDP2,PSGALL,ND0,PSGPRIFZ K ^TMP("PSGVBW3",$J)
"RTN","PSGVBW",118,0)
 S PSGPRIF=1 F STATUS="I","N","P" S PSGP=0 F  S PSGP=$O(^PS(53.1,"AS",STATUS,PSGP)) Q:'PSGP  Q:($D(^TMP("PSGVBW3",$J,PSGP)))  D ^PSJAC,IF
"RTN","PSGVBW",119,0)
 K ^TMP("PSGVBW3",$J)
"RTN","PSGVBW",120,0)
 Q
"RTN","PSGVBW",121,0)
IF ;BHW;PSJ*5*155;Added PSGCLF and PS(53.1,"AD" Check below.  If called from CL subroutine and the order Doesn't exist for that Clinic, then QUIT.;PSJ*5*241:Changed quit conditions
"RTN","PSGVBW",122,0)
 W "." I PSJTOO'=1 S ON=0 F  S ON=$O(^PS(53.1,"AS","P",PSGP,ON)) Q:'ON!(($G(WDN)="ZZ")&(+$P($G(^PS(53.1,+$G(ON),"DSS")),U,1)'=0))  D
"RTN","PSGVBW",123,0)
 .Q:(($G(PSGCLF))&('$D(^PS(53.1,"AD",+$G(CL),PSGP,+$G(ON)))))  ;PSJ*5*265 - move quit condition inside loop
"RTN","PSGVBW",124,0)
 .S X=$P($G(^PS(53.1,ON,0)),U,4),IFPRI=0,Y=0 I "FIU"[X D  D:Y SET
"RTN","PSGVBW",125,0)
 ..I $G(PSGPRIF) D  Q:'IFPRI
"RTN","PSGVBW",126,0)
 ...N PRIO S PRIO=$P($G(^PS(53.1,+ON,.2)),"^",4),PRIO=$S(PRIO="S":1,PRIO="A":2,1:3) S IFPRI=$S(PRD=PRIO:1,1:"")
"RTN","PSGVBW",127,0)
 ..I PSJPAC=3 S Y=1 Q
"RTN","PSGVBW",128,0)
 ..I PSJPAC=2 S Y=X'="U" Q
"RTN","PSGVBW",129,0)
 ..I PSJPAC=1 S Y=X="U"
"RTN","PSGVBW",130,0)
 I PSJTOO=2 D  Q
"RTN","PSGVBW",131,0)
 .I '$G(PSGPRIF),$D(^TMP("PSGVBW2",$J)) D SET2
"RTN","PSGVBW",132,0)
 F X="N","I" I $D(^PS(53.1,"AS",X,PSGP)) NEW XX S XX=0 D  I XX D SET K ON
"RTN","PSGVBW",133,0)
 . NEW PRIOAR F ON=0:0 S ON=$O(^PS(53.1,"AS",X,PSGP,ON)) Q:'ON!(($G(WDN)="ZZ")&(+$P($G(^PS(53.1,+$G(ON),"DSS")),U,1)'=0))  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) I XX D  Q:($G(PRD)&$G(XX))
"RTN","PSGVBW",134,0)
 .. S PRIOAR=$P($G(^PS(53.1,+$G(ON),.2)),U,4) S PRIOAR=$S(PRIOAR="S":"S",PRIOAR="A":"A",1:"R")
"RTN","PSGVBW",135,0)
 .. I $G(PRD) S XX=$S(PRD=1&(PRIOAR="S"):1,PRD=2&(PRIOAR="A"):1,PRD=3&(PRIOAR="R"):1,1:0) Q
"RTN","PSGVBW",136,0)
 .. S PRIOAR(PRIOAR)=ON
"RTN","PSGVBW",137,0)
 . Q:$G(PRD)  S ON=$S($G(PRIOAR("S")):PRIOAR("S"),$G(PRIOAR("A")):PRIOAR("A"),1:$G(PRIOAR("R")))
"RTN","PSGVBW",138,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",139,0)
 I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  D SET
"RTN","PSGVBW",140,0)
 ;*PSJ*5*241:Expired IV orders must be one-time
"RTN","PSGVBW",141,0)
 I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  D
"RTN","PSGVBW",142,0)
 .N SCH,STYPE S STYPE=0,SCH=$P($G(^PS(55,PSGP,"IV",ON,0)),U,9)
"RTN","PSGVBW",143,0)
 .S:SCH]"" SCH=$O(^PS(51.1,"APPSJ",SCH,STYPE)) S:SCH]"" STYPE=$P($G(^PS(51.1,SCH,0)),U,5)
"RTN","PSGVBW",144,0)
 .I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D",'(($P(^(0),"^",17)="E")&($G(STYPE)'="O")) D IFT2 I  D SET
"RTN","PSGVBW",145,0)
 I '$G(PSGPRIF),$D(^TMP("PSGVBW2",$J)) D SET2
"RTN","PSGVBW",146,0)
 Q
"RTN","PSGVBW",147,0)
 ;
"RTN","PSGVBW",148,0)
IFT ; Loop through active UD orders in ^PS(55 that have not been verified by pharmacist.
"RTN","PSGVBW",149,0)
 S ND=$G(^PS(55,PSGP,5,ON,4)) I $S(SD>PSGDT:$S(ND="":1,'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1)):1,$P(ND,"^",13):1,$P(ND,"^",19):1,$P(ND,"^",23):1,1:$P(ND,"^",16)),ST="O":$S(ND="":1,1:'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1))),1:$P(ND,"^",16))
"RTN","PSGVBW",150,0)
 Q
"RTN","PSGVBW",151,0)
 ;
"RTN","PSGVBW",152,0)
IFT2 ; Loop through active IV orders in ^PS(55 that have not been verified by pharmacist.
"RTN","PSGVBW",153,0)
 ;S ND=$G(^PS(55,PSGP,"IV",ON,4)) I $S((SD>PSGDT)&(ND=""):1,'$P(ND,"^",$S(+PSJSYSU=1:1,1:4)):1,1:0)
"RTN","PSGVBW",154,0)
 S ND=$G(^PS(55,PSGP,"IV",ON,4))
"RTN","PSGVBW",155,0)
 I ($P($G(^PS(55,PSGP,"IV",ON,.2)),"^",4)="D")&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4)))  Q
"RTN","PSGVBW",156,0)
 I $S((SD>PSGDT)&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4))):1,1:0)
"RTN","PSGVBW",157,0)
 Q
"RTN","PSGVBW",158,0)
SET ; Set patient specific variables for ^TMP subscripts
"RTN","PSGVBW",159,0)
 S PRDON=""
"RTN","PSGVBW",160,0)
 I $G(ON) S PRDON=$P($G(^PS(53.1,+ON,.2)),"^",4),PRDON=$S(PRDON="A":"ASAP",PRDON="S":"STAT",PRDON="R":"ROUTINE",1:"zz")
"RTN","PSGVBW",161,0)
 S PTPRI=$S(PRDON="STAT":1,PRDON="ASAP":2,PRDON="ROUTINE":3,1:3)
"RTN","PSGVBW",162,0)
 I $G(PSGPRIF) Q:(PRD'=PTPRI)
"RTN","PSGVBW",163,0)
 K DIC,X,Y,WDNAME,TMPWD S WDNAME=$G(^DPT(+PSGP,.1)) S X=WDNAME,DIC="^DIC(42,",DIC(0)="BOXZ" D ^DIC S TMPWD=+Y
"RTN","PSGVBW",164,0)
 S TM=$S(PSJPRB="":"",1:$P($G(^PS(57.7,TMPWD,1,+$O(^PS(57.7,"AWRT",TMPWD,PSJPRB,0)),0)),"^")) S:TM="" TM="zz"
"RTN","PSGVBW",165,0)
 ;
"RTN","PSGVBW",166,0)
SETPN ; If searching for specific priority:
"RTN","PSGVBW",167,0)
 ;            -  set patient into ^TMP("PSGBW" sorted by Priority Name, Priority #, Team, Patient Name^IEN^SSN
"RTN","PSGVBW",168,0)
 ; If not searching for specific priority:
"RTN","PSGVBW",169,0)
 ;            - set patient into ^TMP("PSGVBW2" sorted by 'Patient Name^IEN^SSN', then Priority
"RTN","PSGVBW",170,0)
 ;            - set patient into ^TMP("PSGVBW3" sorted by Patient IEN
"RTN","PSGVBW",171,0)
 I $G(PSGP(0))="" D DEM^VADPT S PSGP(0)=VADM(1)
"RTN","PSGVBW",172,0)
 S PN=$P(PSGP(0),"^")_U_PSGP_U_PSJPBID
"RTN","PSGVBW",173,0)
 Q:PSGSS="P"
"RTN","PSGVBW",174,0)
 I $G(PSGPRIF) S ^TMP("PSGVBW",$J,WDN,PTPRI,TM,PN)="" Q
"RTN","PSGVBW",175,0)
 S ^TMP("PSGVBW2",$J,PN,+$G(PTPRI))=WDN_"^"_TM,^TMP("PSGVBW3",$J,+PSGP)=""
"RTN","PSGVBW",176,0)
 Q
"RTN","PSGVBW",177,0)
 ;
"RTN","PSGVBW",178,0)
SET2 ; If not searching for a specific priority,find the highest priority order associated with patient. 
"RTN","PSGVBW",179,0)
 ; Set the patient into ^TMP("PSGVBW" sorted by highest Priority Name, Priority #, Team, Patient Name^IEN^SSN
"RTN","PSGVBW",180,0)
 S SETPN="" F  S SETPN=$O(^TMP("PSGVBW2",$J,SETPN)) Q:SETPN=""  D
"RTN","PSGVBW",181,0)
 .S PTPRI=$O(^TMP("PSGVBW2",$J,SETPN,0)) Q:'$G(PTPRI)
"RTN","PSGVBW",182,0)
 .S SUBS=$G(^TMP("PSGVBW2",$J,SETPN,PTPRI)),SETWDN=$P(SUBS,"^"),SETTM=$P(SUBS,"^",2) Q:SETWDN=""!(SETTM="")
"RTN","PSGVBW",183,0)
 .S ^TMP("PSGVBW",$J,SETWDN,PTPRI,SETTM,SETPN)=""
"RTN","PSGVBW",184,0)
 K ^TMP("PSGVBW2",$J)
"RTN","PSGVBW",185,0)
 Q
"RTN","PSGVBW",186,0)
GTOOP ; Get 'Type Of Order' and Package
"RTN","PSGVBW",187,0)
 I $P(PSJSYSU,";",3)<2,'$G(PSJRNF),'$G(PSJIRNF) S PSJPAC=0,PSJTOO=1 D GTPAC Q
"RTN","PSGVBW",188,0)
 S (PSJPAC,PSJTOO)=0 W !!,"1) Non-Verified Orders",!,"2) Pending Orders",!!
"RTN","PSGVBW",189,0)
 N DIR S DIR(0)="LAO^1:2",DIR("A")="Select Order Type(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" D ^DIR
"RTN","PSGVBW",190,0)
 I 'Y D EXIT("TYPE OF ORDER") Q
"RTN","PSGVBW",191,0)
 S PSJTOO=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",192,0)
 D GTPAC
"RTN","PSGVBW",193,0)
 I 'PSJPAC D EXIT("PACKAGE") Q
"RTN","PSGVBW",194,0)
 Q
"RTN","PSGVBW",195,0)
 ;
"RTN","PSGVBW",196,0)
GTPAC ; Prompt user for Package
"RTN","PSGVBW",197,0)
 I ($G(PSJRNF))&('$G(PSJIRNF))&(PSJTOO=2) S PSJPAC=1 Q
"RTN","PSGVBW",198,0)
 I ($G(PSJIRNF))&('$G(PSJRNF))&(PSJTOO=2) S PSJPAC=2 Q
"RTN","PSGVBW",199,0)
 W !!,"1) Unit Dose Orders",!,"2) IV Orders",!
"RTN","PSGVBW",200,0)
 K DIR S DIR(0)="LAO^1:2",DIR("A")="Select Package(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",201,0)
 S PSJPAC=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",202,0)
 Q
"RTN","PSGVBW",203,0)
EXIT(X) ; Generic user error message
"RTN","PSGVBW",204,0)
 W !!,X," not selected, option terminated."
"RTN","PSGVBW",205,0)
 Q
"RTN","PSGVBW",206,0)
 ;
"RTN","PSGVBW",207,0)
TOH ; Help text
"RTN","PSGVBW",208,0)
 W !!,"SELECT FROM:",!?5,"1 - NON-VERIFIED ORDERS",!?5,"2 - PENDING ORDERS"
"RTN","PSGVBW",209,0)
 W !!?2,"Enter '1' if you want to verify non-verified orders.  Enter '2' if you",!,"want to complete pending orders.  Enter '1,2' or '1-2' if you want to do both." Q
"RTN","PSIV")
0^27^B30428060^B24205537
"RTN","PSIV",1,0)
PSIV ;BIR/PR,MLM-MISC UTILITIES ;19 Mar 99 / 9:45 AM
"RTN","PSIV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,16,29,38,53,56,72,58,110,181,267,275**;16 DEC 97;Build 157
"RTN","PSIV",3,0)
 ;
"RTN","PSIV",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIV",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789
"RTN","PSIV",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000
"RTN","PSIV",7,0)
 ; Reference to ^DIC is supported by DBIA 10006
"RTN","PSIV",8,0)
 ; Reference to ^DIE is supported by DBIA 10018
"RTN","PSIV",9,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSIV",10,0)
 ; Reference to ^VALM is supported by DBIA 10118
"RTN","PSIV",11,0)
 ; Reference to ^VALM1 is supported by DBIA 10116
"RTN","PSIV",12,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSIV",13,0)
 ;
"RTN","PSIV",14,0)
ENGETP ;Enter here to select patient.
"RTN","PSIV",15,0)
 K DIC S DIC("W")="W ""  "",$P(^(0),""^"",9) W:$D(^(.1)) ""  "",^(.1)",DIC="^DPT(",DIC(0)="QEM"
"RTN","PSIV",16,0)
 D FULL^VALM1
"RTN","PSIV",17,0)
GETP1 ;
"RTN","PSIV",18,0)
 ;NEW arrays use in order checks
"RTN","PSIV",19,0)
 NEW PSJEXCPT,PSJOCER
"RTN","PSIV",20,0)
 S PSGPTMP=0,PPAGE=1,DFN=-1,X="Select PATIENT:^^^^1" D ENQ Q:"^"[X
"RTN","PSIV",21,0)
 D EN^PSJDPT
"RTN","PSIV",22,0)
 I Y<0 G ENGETP
"RTN","PSIV",23,0)
 N PSGP,PSJACNWP S (PSGP,DFN)=+Y D ENBOTH^PSJAC S PSJORL=$$ENORL^PSJUTL($G(VAIN(4)))
"RTN","PSIV",24,0)
 Q
"RTN","PSIV",25,0)
 ;
"RTN","PSIV",26,0)
ENYN ;Enter here for yes/no responses. This is a general reader that I have
"RTN","PSIV",27,0)
 ;been phasing out with ^DICN
"RTN","PSIV",28,0)
 S X=X_"^Y:YES;N:NO^YES,NO"
"RTN","PSIV",29,0)
 ;
"RTN","PSIV",30,0)
ENQ ;Enter here to read X. This is the general reader that I have
"RTN","PSIV",31,0)
 ;been slowly phasing out
"RTN","PSIV",32,0)
 S QUD=$P(X,"^",2) W !!,$P(X,"^")," " W:QUD]"" QUD,"// " R QUX:DTIME W:'$T $C(7) S:'$T QUX="^" S:QUX="" QUX=QUD I QUX["^"!(QUX["?") G KILL
"RTN","PSIV",33,0)
 I $L(QUX)>500 W "    ??" G ENQ
"RTN","PSIV",34,0)
 S:QUX?1L QUX=$C($A(QUX)-32)
"RTN","PSIV",35,0)
 S QUD=";"_$P(X,"^",3)_";" G:QUD'[(";"_QUX_":") VAR S QUX1=$E(QUD,$F(QUD,QUX_":"),($F(QUD,";",$F(QUD,QUX_":"))-2)) G:QUX1[":" VAR W "    ",QUX1 G KILL
"RTN","PSIV",36,0)
VAR F QUX1=1:1 S QUD=$P($P(X,"^",4),",",QUX1) Q:QUD=""  I $P(QUD,QUX)="" W $S($P(X,"^",2)=QUX:"    "_QUX,1:"")_$P(QUD,QUX,2,99) S QUX=QUD G KILL
"RTN","PSIV",37,0)
PAT I $P(X,"^",5)]"",@$P(X,"^",5,999) G KILL
"RTN","PSIV",38,0)
 W $C(7)," ???" G ENQ
"RTN","PSIV",39,0)
KILL S X=QUX K QUX,QUX1,QUD,PSJDCEXP Q
"RTN","PSIV",40,0)
 ;
"RTN","PSIV",41,0)
ENADM ;Edit administration schedules.
"RTN","PSIV",42,0)
 S DIC="^PS(51.1,",DIC(0)="QEAML",DLAYGO=51.1 D ^DIC K:+Y<0 %,DA,D0,DIC,DIE,DLAYGO,DR,Z,Y Q:'$D(Y)  S DIE=DIC,DR=".01;1",DA=+Y K DIC D ^DIE G ENADM
"RTN","PSIV",43,0)
 ;
"RTN","PSIV",44,0)
ENOW D NOW^%DTC S Y=% K %,%H,%I
"RTN","PSIV",45,0)
 Q
"RTN","PSIV",46,0)
 ;
"RTN","PSIV",47,0)
ENC ;Get unit of measure for drug selected.
"RTN","PSIV",48,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSIV",49,0)
 Q
"RTN","PSIV",50,0)
 ;
"RTN","PSIV",51,0)
ENCHS ;Needs PSIVBR (Branch point)
"RTN","PSIV",52,0)
 D ENGETP G:DFN<0 Q
"RTN","PSIV",53,0)
 ;* Lock patient if calling FROM PSJI DELETE ORDER.
"RTN","PSIV",54,0)
 I PSIVBR="D ENT^PSIVPGE",('$$L^PSSLOCK(DFN,1)) Q
"RTN","PSIV",55,0)
OE N CONT S CONT=0
"RTN","PSIV",56,0)
 F  Q:CONT  D ENCHS1
"RTN","PSIV",57,0)
 Q:$D(ORVP)
"RTN","PSIV",58,0)
 G ENCHS
"RTN","PSIV",59,0)
ENCHS1 ;
"RTN","PSIV",60,0)
 I '($$AA^PSJDPT(DFN)>0) S CONT=1 Q
"RTN","PSIV",61,0)
 S PSJORQF=0,CONT=0
"RTN","PSIV",62,0)
 S PSJPROT=2,PSJOL="",(PSGOP,PSGP)=DFN
"RTN","PSIV",63,0)
 K PSJLMPRO D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSIV",64,0)
 S VALMCNT=30
"RTN","PSIV",65,0)
 I PSIVBR="D PROCESS^PSIVRD",(PSJOL="N") D ORDNO^PSIVRD Q
"RTN","PSIV",66,0)
 I $G(PSJNEWOE) S PSJOL="S"
"RTN","PSIV",67,0)
 I PSJOL="S"!(PSJOL="L") F  Q:CONT  S P("PT")=PSJOL D
"RTN","PSIV",68,0)
 . S PSJORQF=0,PSJNEWOE=0
"RTN","PSIV",69,0)
 . D ENNB^PSIVACT
"RTN","PSIV",70,0)
 . I '$D(^TMP("PSIV",$J)) D FULL^VALM1 W !!,?30,"NO ORDERS FOUND",! K DIR S DIR(0)="E" D ^DIR W @IOF S CONT=0
"RTN","PSIV",71,0)
 . NEW PSJIVPRF S PSJIVPRF=1
"RTN","PSIV",72,0)
 . S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSIV",73,0)
 . D EN^VALM("PSJ LM IV OE")
"RTN","PSIV",74,0)
 . I $G(VALMBCK)="Q" Q
"RTN","PSIV",75,0)
 . S CONT=1
"RTN","PSIV",76,0)
 ;* Unlock patient if come from PSJI DELETE ORDER
"RTN","PSIV",77,0)
 I '$G(PSJORQF) S CONT=1
"RTN","PSIV",78,0)
 I PSIVBR="D ENT^PSIVPGE" D UL^PSSLOCK(DFN)
"RTN","PSIV",79,0)
 K PSJLMPRO
"RTN","PSIV",80,0)
 Q
"RTN","PSIV",81,0)
SELSO ;SELECT ORDER USING "SO" OPTION
"RTN","PSIV",82,0)
 S PSGLMT=^TMP("PSJPRO",$J,0) D ENASR^PSGON,OV
"RTN","PSIV",83,0)
 Q
"RTN","PSIV",84,0)
SELNUM ;SELECT ORDERS WITH NUMBERS
"RTN","PSIV",85,0)
 S PSGLMT=^TMP("PSJPRO",$J,0),X=$P(XQORNOD(0),"=",2) D ENCHK^PSGON,OV
"RTN","PSIV",86,0)
 Q
"RTN","PSIV",87,0)
OV ;
"RTN","PSIV",88,0)
 I '$D(PSGODDD) S VALMBCK="R" Q
"RTN","PSIV",89,0)
 N DONE
"RTN","PSIV",90,0)
 F PSIVOV1=1:1:PSGODDD F PSIVOV2=1:1:$L(PSGODDD(PSIVOV1),",")-1 D
"RTN","PSIV",91,0)
 .S ON=+$P(PSGODDD(PSIVOV1),",",PSIVOV2)
"RTN","PSIV",92,0)
 .S ON=$$GTON(ON)
"RTN","PSIV",93,0)
 .Q:'ON!$G(DONE)
"RTN","PSIV",94,0)
 .D OV1
"RTN","PSIV",95,0)
 S VALMBCK="Q"
"RTN","PSIV",96,0)
 Q
"RTN","PSIV",97,0)
GTON(X) ;
"RTN","PSIV",98,0)
 ;Return the ON node from ^Tmp
"RTN","PSIV",99,0)
 I $G(X)="" Q ""
"RTN","PSIV",100,0)
 I $D(^TMP("PSIV",$J,"AB",X)) Q ^(X)
"RTN","PSIV",101,0)
 I $D(^TMP("PSIV",$J,"NB",X)) Q ^(X)
"RTN","PSIV",102,0)
 I $D(^TMP("PSIV",$J,"PB",X)) Q ^(X)
"RTN","PSIV",103,0)
 I $D(^TMP("PSIV",$J,"XB",X)) Q ^(X)
"RTN","PSIV",104,0)
 I $D(^TMP("PSIV",$J,"NDB",X)) Q ^(X)
"RTN","PSIV",105,0)
 I $D(^TMP("PSIV",$J,"PDB",X)) Q ^(X)
"RTN","PSIV",106,0)
 I $D(^TMP("PSIV",$J,"RDB",X)) Q ^(X)
"RTN","PSIV",107,0)
 ; clinic orders
"RTN","PSIV",108,0)
 N REF,REF2,PSJCLND S (REF,REF2,PSJCLND)="" F  S PSJCLND=$O(^TMP("PSIV",$J,PSJCLND)) Q:($G(REF)]"")  D
"RTN","PSIV",109,0)
 .I $P(PSJCLND,"^",4)="AB" I $D(^TMP("PSIV",$J,PSJCLND,X)) S REF=^(X) Q
"RTN","PSIV",110,0)
 .I $P(PSJCLND,"^",4)="NB" I $D(^TMP("PSIV",$J,PSJCLND,X)) S REF=^(X) Q
"RTN","PSIV",111,0)
 .I $P(PSJCLND,"^",4)="PB" I $D(^TMP("PSIV",$J,PSJCLND,X)) S REF=^(X) Q
"RTN","PSIV",112,0)
 .I $P(PSJCLND,"^",4)="XB" I $D(^TMP("PSIV",$J,PSJCLND,X)) S REF=^(X) Q
"RTN","PSIV",113,0)
 .I $P(PSJCLND,"^",4)="NDB" I $D(^TMP("PSIV",$J,PSJCLND,X)) S REF=^(X) Q
"RTN","PSIV",114,0)
 .I $P(PSJCLND,"^",4)="PDB" I $D(^TMP("PSIV",$J,PSJCLND,X)) S REF=^(X) Q
"RTN","PSIV",115,0)
 .I $P(PSJCLND,"^",4)="RDB" I $D(^TMP("PSIV",$J,PSJCLND,X)) S REF=^(X) Q
"RTN","PSIV",116,0)
 I ($G(REF)]"") Q REF
"RTN","PSIV",117,0)
 Q ""
"RTN","PSIV",118,0)
OV1 ;
"RTN","PSIV",119,0)
 S (ON,ON55,P("PON"))=9999999999-ON_$S(ON["V":"V",1:"P")
"RTN","PSIV",120,0)
 I PSIVBR["D ^PSIVVW1" D
"RTN","PSIV",121,0)
 . S VALMSG="Select either ""AL"" , ""LL"" or ""AL,LL"" for both"
"RTN","PSIV",122,0)
 . S PSJORD=ON D EN^PSJLIPRF
"RTN","PSIV",123,0)
 E  D
"RTN","PSIV",124,0)
 . I PSIVBR="D ^PSIVOPT",'($$LS^PSSLOCK(PSGP,ON)) Q
"RTN","PSIV",125,0)
 . X PSIVBR
"RTN","PSIV",126,0)
 . D:PSIVBR="D ^PSIVOPT" UNL^PSSLOCK(PSGP,ON)
"RTN","PSIV",127,0)
 K:'$D(DUOUT)&($G(Y)'=-1) DONE
"RTN","PSIV",128,0)
 Q
"RTN","PSIV",129,0)
 ;
"RTN","PSIV",130,0)
 ;
"RTN","PSIV",131,0)
ENU ;Get IV additive strength. Called from templates.
"RTN","PSIV",132,0)
 N Y S Y=+^PS(55,DA(2),"IV",DA(1),"AD",DA,0),PSIVSTR=$$ENU^PSIVUTL(Y)
"RTN","PSIV",133,0)
 Q
"RTN","PSIV",134,0)
Q ;
"RTN","PSIV",135,0)
 K ^TMP($J,"PSJPRE")
"RTN","PSIV",136,0)
 K ^TMP("PSIV",$J),^TMP("PSJ",$J),^TMP("PSJPRO",$J),^TMP("PSJALL",$J),^TMP("PSJI",$J),^TMP("PSJON",$J)
"RTN","PSIV",137,0)
 K DRG,DRGI,DRGN,DRGT,ERR,I,JJ,MI,N,N2,ON,ON55,P,P1,P3,P16,P17,PNOW,PS,PSGODD,PSGODDD,PSIV,PSIVAAT,PSIVACT,PSIVADM,PSIVAT
"RTN","PSIV",138,0)
 K PSIVC,PSIVDT,PSIVFLAG,PSIVLN,PSIVNOW,PSIVNU,PSIVON,PSIVOV1,PSIVOV2,PSIVREA,PSIVSTR,PSIVSTRT,PSIVNOL,PSIVTYPE,PSJNKF
"RTN","PSIV",139,0)
 K PSJORF,PSJORIFN,RDWARD,START,STOP,SCHED,USER,V,XT
"RTN","PSIV",140,0)
 K %,%I,DIC,PSIVC,PSIVNU,PSIVON,PSIVREA,PSIVOV1,PSIVOV2,RDWARD,V,VAERR,VW,X,X2,Y,Y1,Z,Z1,Z2
"RTN","PSIV",141,0)
 Q
"RTN","PSIVACT")
0^28^B30113388^B16650605
"RTN","PSIVACT",1,0)
PSIVACT ;BIR/PR,MLM-UPDATE ORDER STATUS AFTER PATIENT SELECTION ;16 Jul 98 / 12:51 PM
"RTN","PSIVACT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**15,38,58,110,181,275**;16 DEC 97;Build 157
"RTN","PSIVACT",3,0)
 ;
"RTN","PSIVACT",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVACT",5,0)
 ;
"RTN","PSIVACT",6,0)
ENNA ; Inpatient entry point.
"RTN","PSIVACT",7,0)
 D:$D(XRTL) T0^%ZOSV
"RTN","PSIVACT",8,0)
 D NOW^%DTC S PSFDT=%,PS=0 D L D:'$G(PSIVRD) PEND
"RTN","PSIVACT",9,0)
 I $D(XRT0) S XRTN="PSIVACT" D T1^%ZOSV
"RTN","PSIVACT",10,0)
 Q
"RTN","PSIVACT",11,0)
 ;
"RTN","PSIVACT",12,0)
ENNB ; Ask profile type, gather orders.
"RTN","PSIVACT",13,0)
 D NOW^%DTC S PSFDT=%,PS=0 K ^TMP("PSIV",$J),^TMP("PSJPRO",$J)
"RTN","PSIVACT",14,0)
 S PSIVNV=$S(+PSJSYSU=1:"ANIV",+PSJSYSU=3:"APIV",1:"")
"RTN","PSIVACT",15,0)
 D @P("PT") D:'$G(PSIVRD) PEND
"RTN","PSIVACT",16,0)
 I P("PT")="L",$D(XRT0) S XRTN="PSIVACT" D T1^%ZOSV
"RTN","PSIVACT",17,0)
 Q
"RTN","PSIVACT",18,0)
 ;
"RTN","PSIVACT",19,0)
L ; Long profile
"RTN","PSIVACT",20,0)
 S:'$D(PSJSYSU) PSJSYSU=""
"RTN","PSIVACT",21,0)
 F ON=0:0 K Y S ON=$O(^PS(55,DFN,"IV",+ON)) Q:'ON  D SETP
"RTN","PSIVACT",22,0)
 Q
"RTN","PSIVACT",23,0)
 ;
"RTN","PSIVACT",24,0)
S ; Short profile.
"RTN","PSIVACT",25,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSIVACT",26,0)
 I '+$P(PSJDCEXP,U,2) S $P(PSJDCEXP,U,2)=PSFDT
"RTN","PSIVACT",27,0)
 F PSIVDT=$P($G(PSJDCEXP),U,2):0 S PSIVDT=$O(^PS(55,DFN,"IV","AIS",PSIVDT)) Q:'PSIVDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",PSIVDT,+ON)) Q:'ON  S ON=ON_"V",P(17)=$P($G(^PS(55,DFN,"IV",+ON,0)),U,17) D ACTO
"RTN","PSIVACT",28,0)
 I +PSJSYSU=3 S PSIVNV="APIV" D NVACT K PSIVNV
"RTN","PSIVACT",29,0)
 Q
"RTN","PSIVACT",30,0)
 ;
"RTN","PSIVACT",31,0)
NVACT ; Non-verified but have active status
"RTN","PSIVACT",32,0)
 NEW ON
"RTN","PSIVACT",33,0)
 F ON=0:0 S ON=$O(^PS(55,PSIVNV,DFN,ON)) Q:'ON  D
"RTN","PSIVACT",34,0)
 . N CLIN,CLINSORT,SORT,PSIVSTAT,CLINSORT S PSIVSTAT="A"
"RTN","PSIVACT",35,0)
 . S CLIN=$$CLINIC^PSJO1(PSGP,ON) I $L(CLIN)>1 S CLINSORT=$$CLINSORT^PSJO1("A") S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^A"
"RTN","PSIVACT",36,0)
 . I $P($G(^PS(55,DFN,"IV",ON,0)),U,17)="E",($P($G(^(.2)),U,4)="D") S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)=""
"RTN","PSIVACT",37,0)
 Q
"RTN","PSIVACT",38,0)
 ;
"RTN","PSIVACT",39,0)
PEND ; Get pending and non-verified orders from 53.1
"RTN","PSIVACT",40,0)
 N PSJCOM,PSJCOM1 S (PSJCOM,PSJCOM1)=0
"RTN","PSIVACT",41,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","P",DFN,ON)) Q:'ON  D  S PSJCOM1=PSJCOM
"RTN","PSIVACT",42,0)
 . NEW X S X=$P($G(^PS(53.1,ON,.2)),U,4),X=$S(X="S":1,X="A":2,X="R":3,X="P":4,1:5)
"RTN","PSIVACT",43,0)
 . S PSJCOM=$P($G(^PS(53.1,ON,.2)),U,8) I PSJCOM Q:'$$COMCHK^PSJO1(PSJCOM,2)  Q:PSJCOM=PSJCOM1
"RTN","PSIVACT",44,0)
 . N CLIN,CLINSORT,SORT,PSIVSTAT,CLINSORT S PSIVSTAT=$S('PSJCOM:"P",1:"PD")
"RTN","PSIVACT",45,0)
 . S CLIN=$$CLINIC^PSJO1(PSGP,ON_"P") I $L(CLIN)>1 S CLINSORT=$$CLINSORT^PSJO1("P") S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^"_PSIVSTAT
"RTN","PSIVACT",46,0)
 . I $G(^PS(53.1,ON,0)),$P(^PS(53.1,ON,0),U,4)'="U" S ^TMP("PSIV",$J,PSIVSTAT,X_9999999999-ON)=""
"RTN","PSIVACT",47,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","N",DFN,ON)) Q:'ON  D  S PSJCOM1=PSJCOM
"RTN","PSIVACT",48,0)
 . NEW X S X=$P($G(^PS(53.1,ON,.2)),U,4),X=$S(X="S":1,X="A":2,X="R":3,X="P":4,1:5)
"RTN","PSIVACT",49,0)
 . S PSJCOM=$P($G(^PS(53.1,ON,.2)),U,8) I PSJCOM Q:'$$COMCHK^PSJO1(PSJCOM,2)  Q:PSJCOM=PSJCOM1
"RTN","PSIVACT",50,0)
 . N CLIN,PSIVSTAT,CLINSORT,SORT S PSIVSTAT=$S('PSJCOM:"N",1:"ND")
"RTN","PSIVACT",51,0)
 . S CLIN=$$CLINIC^PSJO1(PSGP,ON_"P") I (CLIN]"") S CLINSORT=$$CLINSORT^PSJO1("P") S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^"_$S('PSJCOM:"N",1:"ND")
"RTN","PSIVACT",52,0)
 . I $G(^PS(53.1,ON,0)),$P(^PS(53.1,ON,0),U,4)'="U" S ^TMP("PSIV",$J,PSIVSTAT,X_9999999999-ON)=""
"RTN","PSIVACT",53,0)
 .; S:$P(^PS(53.1,ON,0),U,4)'="U" ^TMP("PSIV",$J,"P",X_9999999999-ON)=""
"RTN","PSIVACT",54,0)
 ;
"RTN","PSIVACT",55,0)
QUIT ; Kill and exit.
"RTN","PSIVACT",56,0)
 K PSIVCWD,PSIVFLAG,PSIVWD,PSDFN,PSON1,PSFDT,YHOLD,JJ,XHOLD
"RTN","PSIVACT",57,0)
 Q
"RTN","PSIVACT",58,0)
 ;
"RTN","PSIVACT",59,0)
SETP ; Get partial P array,
"RTN","PSIVACT",60,0)
 S ON=ON_"V",Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,17,21 S P(X)=$P(Y,U,X)
"RTN","PSIVACT",61,0)
 S P(2)=+P(2),P(3)=+P(3) S Y(P(2))="",Y(P(3))=""
"RTN","PSIVACT",62,0)
 I P(2),P(3),P(17)'="P" D CHK
"RTN","PSIVACT",63,0)
 Q
"RTN","PSIVACT",64,0)
 ;
"RTN","PSIVACT",65,0)
CHK ; Check if order is active or expired and save accordingly.
"RTN","PSIVACT",66,0)
 N CLIN,PSIVSTAT,CLINSORT,SORT S PSIVSTAT="A"
"RTN","PSIVACT",67,0)
 S CLIN=$$CLINIC^PSJO1(PSGP,ON) I CLIN]"" S CLINSORT=$$CLINSORT^PSJO1(PSIVSTAT) S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^A"
"RTN","PSIVACT",68,0)
 S PS=PS+1 I P(17)="H" S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)="" Q
"RTN","PSIVACT",69,0)
 I $O(Y(PSFDT))=P(3) D ACTO Q
"RTN","PSIVACT",70,0)
 I $O(Y(PSFDT))="" D NACTO Q
"RTN","PSIVACT",71,0)
 S:"ARO"[P(17) ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)="" S:"ED"[P(17) ^TMP("PSIV",$J,"X",9999999999-ON)="" S:"E"[P(17) PSIVREA="A",$P(^PS(55,DFN,"IV",+ON,0),U,17)="A",PS("A",9999999999-ON)=""
"RTN","PSIVACT",72,0)
 Q
"RTN","PSIVACT",73,0)
 ;
"RTN","PSIVACT",74,0)
ACTO ; Active orders
"RTN","PSIVACT",75,0)
 ;I "AE"[P(17) S ^TMP("PSIV",$J,"A",9999999999-ON)="" S:P(17)="E" $P(^PS(55,DFN,"IV",+ON,0),U,17)="A" Q ;;mv-not sure why setting status back to "A"???
"RTN","PSIVACT",76,0)
 N CLINSORT,SORT,CLIN,PSIVSTAT S PSIVSTAT="A"
"RTN","PSIVACT",77,0)
 S CLIN=$$CLINIC^PSJO1(PSGP,ON) I (CLIN]"") S CLINSORT=$$CLINSORT^PSJO1(PSIVSTAT) S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^A"
"RTN","PSIVACT",78,0)
 I ($P(PSIVSTAT,"^")="Cz") S:("DE"[P(17)) PSIVSTAT="RD" S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)="" Q
"RTN","PSIVACT",79,0)
 I "A"[P(17) S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)="" Q
"RTN","PSIVACT",80,0)
 I "HOR"[P(17) S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)="" Q
"RTN","PSIVACT",81,0)
 I "DE"[P(17) S ^TMP("PSIV",$J,"RD",9999999999-ON)=""
"RTN","PSIVACT",82,0)
 Q
"RTN","PSIVACT",83,0)
 ;
"RTN","PSIVACT",84,0)
NACTO ; Inactive orders
"RTN","PSIVACT",85,0)
 ;I "AER"[P(17) S ^TMP("PSIV",$J,"X",9999999999-ON)="" I "AR"[P(17) S $P(^PS(55,DFN,"IV",+ON,0),U,17)="E" D EXPIR^PSIVOE Q
"RTN","PSIVACT",86,0)
 N CLIN,PSIVSTAT,SORT,CLINSORT S PSIVSTAT=""
"RTN","PSIVACT",87,0)
 S CLIN=$$CLINIC^PSJO1(PSGP,ON)
"RTN","PSIVACT",88,0)
 I "AER"[P(17) D
"RTN","PSIVACT",89,0)
 . Q:$P(^PS(55,DFN,"IV",+ON,0),U,3)=""  S PSIVSTAT="A"
"RTN","PSIVACT",90,0)
 . I +PSJSYSU=3,($P($G(^PS(55,DFN,"IV",+ON,.2)),U,4)="D"),'+$P($G(^(4)),U,4) D  Q
"RTN","PSIVACT",91,0)
 .. I (CLIN]"") S CLINSORT=$$CLINSORT^PSJO1(PSIVSTAT) S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^"_PSIVSTAT
"RTN","PSIVACT",92,0)
 .. S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)=""
"RTN","PSIVACT",93,0)
 . S PSIVSTAT="X" S:(CLIN]"") CLINSORT=$$CLINSORT^PSJO1(PSIVSTAT) S:($G(CLINSORT)]"") PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^"_PSIVSTAT D
"RTN","PSIVACT",94,0)
 .. S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)=""
"RTN","PSIVACT",95,0)
 I "AR"[P(17) S $P(^PS(55,DFN,"IV",+ON,0),U,17)="E" D EXPIR^PSIVOE
"RTN","PSIVACT",96,0)
 I "OD"[P(17) S PSIVSTAT="X" S:(CLIN]"") CLINSORT=$$CLINSORT^PSJO1(PSIVSTAT) S:($G(CLINSORT)]"") PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^"_PSIVSTAT D
"RTN","PSIVACT",97,0)
 .S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)=""
"RTN","PSIVACT",98,0)
 Q
"RTN","PSIVACT",99,0)
 ;
"RTN","PSIVACT",100,0)
DCOR ; Auto-cancel IV orders
"RTN","PSIVACT",101,0)
 ;NEED TO NEW VARIABLES LATER.
"RTN","PSIVACT",102,0)
 NEW DA,DIR,DG,ON,ON55,P,PSIVAC,PSIVACT,PSIVLN,PSIVREA,PSIVRES,PSGALO,PSGP,PSJDCDT,PSJIVDCF,PSJIVON,PSJIVORF,PSJORF,VA,VADM,VAERR
"RTN","PSIVACT",103,0)
 S PSGP=DFN,PSIVRES="Auto DC due to Surgery Package"
"RTN","PSIVACT",104,0)
 D NOW^%DTC S PSJDCDT=+%
"RTN","PSIVACT",105,0)
 D ENIV^PSJADT0
"RTN","PSIVACT",106,0)
 Q
"RTN","PSIVORC2")
0^49^B59162972^B59003278
"RTN","PSIVORC2",1,0)
PSIVORC2 ;BIR/MLM-PROCESS INCOMPLETE IV ORDER - CONT ;22 OCT 97 / 3:16 PM
"RTN","PSIVORC2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**29,49,50,65,58,85,101,110,127,151,181,267,275**;16 DEC 97;Build 157
"RTN","PSIVORC2",3,0)
 ;
"RTN","PSIVORC2",4,0)
 ; Reference to ^ORD(101 is supported by DBIA #872
"RTN","PSIVORC2",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178
"RTN","PSIVORC2",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSIVORC2",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVORC2",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173.
"RTN","PSIVORC2",9,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSIVORC2",10,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVORC2",11,0)
 ;
"RTN","PSIVORC2",12,0)
EDCHK ;Update or create new order in 55.
"RTN","PSIVORC2",13,0)
 D CKORD D:'$G(PSJIVORF) ORPARM^PSIVOREN I 'PSJIVORF W !,"Either the Inpatient Medications or the IV Medications package is not on, please check the Order Parameters file" Q
"RTN","PSIVORC2",14,0)
 I PSIVCHG,PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) W $C(7),"Order unchanged" Q
"RTN","PSIVORC2",15,0)
 S:PSIVCHG P("21FLG")=""
"RTN","PSIVORC2",16,0)
 I $G(PSJCOM) D IV^PSJCOMV Q
"RTN","PSIVORC2",17,0)
 Q:$$NONVF()
"RTN","PSIVORC2",18,0)
ACTIVE ;
"RTN","PSIVORC2",19,0)
 S PSJCOM=P("PRNTON")
"RTN","PSIVORC2",20,0)
 I PSJCOM D VFYIV^PSJCOMV Q
"RTN","PSIVORC2",21,0)
 S P("RES")=$P($G(^PS(53.1,+ON,0)),U,24)
"RTN","PSIVORC2",22,0)
 I P("RES")="R" S P("NEWON")=P("OLDON") S PSJOSTOP="" D
"RTN","PSIVORC2",23,0)
 .N PSJTROPI,PSJNVO S PSJNVO=$G(P("NEWON")) I (PSJNVO["P") D FILEOPI^PSJBCMA5(DFN,PSJNVO) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,PSJNVO) Q
"RTN","PSIVORC2",24,0)
 .I ($G(P("PON"))["P"),($G(ON55)=P("PON")) S PSJNVO=P("PON") D FILEOPI^PSJBCMA5(DFN,PSJNVO) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,PSJNVO)
"RTN","PSIVORC2",25,0)
 .I $G(P("NEWON")) D FILEOPI^PSJBCMA5(DFN,P("NEWON")) S PSJTROPI=$$GETOPI^PSJBCMA5(DFN,P("NEWON"))
"RTN","PSIVORC2",26,0)
 .D RUPDATE^PSIVOREN(DFN,ON,P(2)) I $P($G(^PS(53.45,+$G(PSJSYSP),6,0)),"^",3)
"RTN","PSIVORC2",27,0)
 I P("RES")'="R" S PSJORD=ON,P(17)="A",ORSTS=6,PSJORNP=P(6) D SETNEW^PSIVORFB S P("NEWON")=ON55 D @$S(PSIVCHG:"NEWORD",1:"OLDORD")
"RTN","PSIVORC2",28,0)
 I $G(PSJIOPIV) D MVOPI^PSJBCMA5($G(DFN),$G(PSJORD),$G(ON55)),MVOPIAL^PSJBCMA5($G(DFN),$G(PSJORD),$G(ON55))
"RTN","PSIVORC2",29,0)
 S (ON55,ON)=P("NEWON"),OD=P(2) D EN^PSIVORE
"RTN","PSIVORC2",30,0)
 D VF1^PSJLIACT("F","ORDER VERIFIED BY ",1)
"RTN","PSIVORC2",31,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"N")
"RTN","PSIVORC2",32,0)
 I $G(^PS(55,DFN,"IV",+ON55,4)) D EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSIVORC2",33,0)
 L -^PS(53.1,+$G(PSJORD)) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVORC2",34,0)
 Q
"RTN","PSIVORC2",35,0)
 ;
"RTN","PSIVORC2",36,0)
CKORD ;Check if new order is to be created.
"RTN","PSIVORC2",37,0)
 I $G(PSIVCOPY) S PSIVCHG=0 Q
"RTN","PSIVORC2",38,0)
 N ND,PSJCHG S PSIVCHG=0,ND(0)=$G(^PS(53.1,+ON,0)),ND("PD")=$G(^PS(53.1,+ON,.2))_U_$P(ND(0),U,3)
"RTN","PSIVORC2",39,0)
 N X S X=$P($G(^PS(53.1,+ON,8)),U,5),X=$S(P(8)["@":$P(X,"@"),1:X)
"RTN","PSIVORC2",40,0)
 S ND=$S($E(P("OT"))="I":P(8)_U_$P(ND(0),U,3)_U_+$P(ND("PD"),U),1:X_U_+P("MR")_U_+P("PD"))
"RTN","PSIVORC2",41,0)
 S ND=ND_U_$S($P(ND(0),U,2)=+P("CLRK"):+$P(ND(0),U,2),1:+P(6))
"RTN","PSIVORC2",42,0)
 I ND'=($S($E(P("OT"))="I":P(8),P(8)["@":$P(P(8),"@"),1:P(8))_U_+P("MR")_U_+P("PD")_U_+P(6)) S PSIVCHG=1
"RTN","PSIVORC2",43,0)
 I 'PSIVCHG I $P($G(^PS(53.1,+ON,2)),U)'=P(9) S:($G(P("DTYP"))'=1) PSIVDSFG=1 S PSIVCHG=1
"RTN","PSIVORC2",44,0)
 N ND,TDRG,TMPDRG
"RTN","PSIVORC2",45,0)
 Q:PSIVCHG
"RTN","PSIVORC2",46,0)
 D TMPDRG1^PSJMISC(DFN,$G(ON),.TMPDRG)
"RTN","PSIVORC2",47,0)
 I $$COMPARE^PSJMISC(.DRG,.TMPDRG,$S(P("DTYP")=1:0,1:1)) S PSIVCHG=1
"RTN","PSIVORC2",48,0)
 K TMPDRG
"RTN","PSIVORC2",49,0)
 Q:PSIVCHG
"RTN","PSIVORC2",50,0)
 Q
"RTN","PSIVORC2",51,0)
CKPC ;
"RTN","PSIVORC2",52,0)
 ;PSJ*5*181 Note - No longer use by *181
"RTN","PSIVORC2",53,0)
 ;
"RTN","PSIVORC2",54,0)
 Q:PSIVCHG  I $E(P("OT"))'="I" D
"RTN","PSIVORC2",55,0)
 .;
"RTN","PSIVORC2",56,0)
 .; Check IV drugs for changes.
"RTN","PSIVORC2",57,0)
 .S DNE=0 F DRGT="AD","SOL" I $D(DRG(DRGT)) S FIL="52."_$S(DRGT="AD":6,1:7) D
"RTN","PSIVORC2",58,0)
 ..N ND,TDRG F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI!DNE  S TDRG(+$P(DRG(DRGT,DRGI),U),DRGI)=DRGI,TDRG("CNT")=+$G(TDRG("CNT"))+1
"RTN","PSIVORC2",59,0)
 ..F ON1=0:0 S ON1=$O(^PS(53.1,+ON,DRGT,ON1)) Q:'+ON1!DNE  S ND=$G(^PS(53.1,+ON,DRGT,ON1,0)),ND("CNT")=$G(ND("CNT"))+1 D
"RTN","PSIVORC2",60,0)
 ...S DRG=+$P(ND,U) S:'$D(TDRG(+DRG)) (DNE,PSIVCHG)=1 F DRGI=0:0 S DRGI=$O(TDRG(+DRG,DRGI)) Q:'DRGI!DNE  I $P($G(DRG(DRGT,DRGI)),U)_U_$P($G(DRG(DRGT,DRGI)),U,3)'=$P(ND,U,1,2) S (DNE,PSIVCHG)=1
"RTN","PSIVORC2",61,0)
 ..S:$G(ND("CNT"))'=$G(TDRG("CNT")) (DNE,PSIVCHG)=1 K ND,TDRG
"RTN","PSIVORC2",62,0)
 Q
"RTN","PSIVORC2",63,0)
 ;
"RTN","PSIVORC2",64,0)
OLDORD ; Update old order, update order links.
"RTN","PSIVORC2",65,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",66,0)
 S P("OLDON")=$P($G(^PS(53.1,+ON,0)),U,25) I P("OLDON")'=ON55 S $P(^PS(55,DFN,"IV",+ON55,2),U,8)=P("RES"),$P(^(2),U,5)=P("OLDON") I P("OLDON") D
"RTN","PSIVORC2",67,0)
 .I P("OLDON")["V",$D(^PS(55,DFN,"IV",+P("OLDON"),0)) S $P(^(2),U,6)=ON55,$P(^(2),U,9)=P("RES")
"RTN","PSIVORC2",68,0)
 .I P("OLDON")["A",$D(^PS(55,DFN,5,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",69,0)
 .I $S(P("OLDON")["P":1,P("OLDON")["N":1,1:0),$D(^PS(53.1,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",70,0)
 D PUT531^PSIVORFA S $P(^PS(53.1,+ON,0),U,25,26)="^",ON=ON55 D UPD100^PSIVORFA
"RTN","PSIVORC2",71,0)
 Q
"RTN","PSIVORC2",72,0)
 ;
"RTN","PSIVORC2",73,0)
NEWORD ; Create new order, update order links.
"RTN","PSIVORC2",74,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",75,0)
 S $P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",76,0)
 S P("NEWON")=$P($G(^PS(53.1,+PSJORD,0)),U,26),$P(^PS(55,DFN,"IV",+P("NEWON"),2),U,5)=PSJORD,$P(^(2),U,8)="E",ON=ON55
"RTN","PSIVORC2",77,0)
 I PSJIVORF D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORC2",78,0)
 Q
"RTN","PSIVORC2",79,0)
 ;
"RTN","PSIVORC2",80,0)
GTIVDRG ; Try to find an IV drug from the Orderable Item.
"RTN","PSIVORC2",81,0)
 ; If there is only 1 match to OI then stuff in DRG otherwise prompt user to select which
"RTN","PSIVORC2",82,0)
 ; ad/sol matched to OI
"RTN","PSIVORC2",83,0)
 K PSIVOI NEW FIL,ND,SCR,PSJNOW
"RTN","PSIVORC2",84,0)
 D NOW^%DTC S PSJNOW=%
"RTN","PSIVORC2",85,0)
 S SCR("S")="S ND=$P($G(^(""I"")),U) I ND=""""!(ND>PSJNOW)"
"RTN","PSIVORC2",86,0)
 F FIL=52.6,52.7 D FIND^DIC(FIL,,"@;.01;2","QXP",+P("PD"),,"AOI",SCR("S"),,"PSIVOI") I +PSIVOI("DILIST",0)>0 D  Q
"RTN","PSIVORC2",87,0)
 . S DRGT=$S(FIL=52.6:"AD",1:"SOL"),PSIVOI=DRGT
"RTN","PSIVORC2",88,0)
 . I PSIVOI="AD" D
"RTN","PSIVORC2",89,0)
 .. N XX,XXX,QC S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S XXX=+PSIVOI("DILIST",XX,0) D LIST^DIC(52.61,","_XXX_",","@;.01","PQ",,,,,,,"PSIVQC") D
"RTN","PSIVORC2",90,0)
 ... I +$G(PSIVQC("DILIST",0))>0 S QC=0 F  S QC=$O(PSIVQC("DILIST",QC)) Q:QC=""  S PSIVOI("DILIST",XX,QC,0)=PSIVQC("DILIST",QC,0)
"RTN","PSIVORC2",91,0)
 ... K PSIVQC("DILIST",0),PSIVQC("DILIST",0,"MAP")
"RTN","PSIVORC2",92,0)
 .. D RESET
"RTN","PSIVORC2",93,0)
 . I +PSIVOI("DILIST",0)=1 D
"RTN","PSIVORC2",94,0)
 .. S DRG=+PSIVOI("DILIST",1,0)
"RTN","PSIVORC2",95,0)
 .. S DNE=1,DRG(DRGT,0)=1,ND=$G(^PS(FIL,+DRG,0)),DRG(DRGT,1)=+DRG_U_$P(ND,U)_U_$S(FIL=52.7:$P(ND,U,3),1:"")_U_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORC2",96,0)
 K:+PSIVOI("DILIST",0)<2 PSIVOI
"RTN","PSIVORC2",97,0)
 Q
"RTN","PSIVORC2",98,0)
 ;
"RTN","PSIVORC2",99,0)
EDIT ; Edit incomplete order
"RTN","PSIVORC2",100,0)
 K PSIVENO
"RTN","PSIVORC2",101,0)
 S PSIVAC="CE"
"RTN","PSIVORC2",102,0)
 I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) D GTIVDRG
"RTN","PSIVORC2",103,0)
 I P(4)="" D 53^PSIVORC1 Q:P(4)=""  D ^PSIVORV2
"RTN","PSIVORC2",104,0)
 D GSTRING^PSIVORE1,GTFLDS^PSIVORFE ;S (PSIVOK,EDIT)="57^58^59^3"_$S(P("DTYP")=1:"^26^39",1:"")_"^63^64^"_$S($E(P("OT"))="I":"101^109^",1:"")_"10^25"_$S(+P(6)'=+P("CLRK"):"^1",1:"") D GTFLDS^PSIVORFE
"RTN","PSIVORC2",105,0)
 Q:$G(DONE)
"RTN","PSIVORC2",106,0)
 I '$G(PSIVENO) S PSIVENO=1 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q"
"RTN","PSIVORC2",107,0)
 Q
"RTN","PSIVORC2",108,0)
 ;
"RTN","PSIVORC2",109,0)
FINISH ; Ask only for missing data in incomplete IV order.
"RTN","PSIVORC2",110,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI")) I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG
"RTN","PSIVORC2",111,0)
 D:P(4)="" 53^PSIVORC1 Q:P(4)=""  S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORC2",112,0)
 I 'P(2) D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y
"RTN","PSIVORC2",113,0)
 I 'P(3) D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSIVORC2",114,0)
 I 'P("MR") S P("MR")=$O(^PS(51.2,"B","INTRAVENOUS",0))_"^IV"
"RTN","PSIVORC2",115,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 D:EDIT]"" EDIT^PSIVEDT G COMPLTE^PSIVORC1
"RTN","PSIVORC2",116,0)
 Q
"RTN","PSIVORC2",117,0)
NONVF() ; Updated 53.1 status to non-verified after finish.
"RTN","PSIVORC2",118,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVORC2",119,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVORC2",120,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVORC2",121,0)
 I PSIVCHG D NWNONVF Q 1
"RTN","PSIVORC2",122,0)
 S P(17)="N",P("REN")=0
"RTN","PSIVORC2",123,0)
 D GTPD^PSIVORE2
"RTN","PSIVORC2",124,0)
 W !,"...transcribing this non-verified order...."
"RTN","PSIVORC2",125,0)
 S $P(^PS(53.1,+ON,.2),U)=""
"RTN","PSIVORC2",126,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",127,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",128,0)
 I ($G(PSJINFIN)=2) D NEWNVAL^PSGAL5(ON,6000,"OTHER PRINT INFO")
"RTN","PSIVORC2",129,0)
 NEW PSIVORFA S PSIVORFA=1 D:ON["V" DEL55^PSIVORE2
"RTN","PSIVORC2",130,0)
 D EN1^PSJHL2(DFN,"XX",ON,"UPDATED ORDER")
"RTN","PSIVORC2",131,0)
 D VF
"RTN","PSIVORC2",132,0)
 Q 1
"RTN","PSIVORC2",133,0)
NWNONVF ;Create non-verified due to edit
"RTN","PSIVORC2",134,0)
 K DA D ENGNN^PSGOETO S P("NEWON")=DA_"P",P(17)="N",P("REN")=0
"RTN","PSIVORC2",135,0)
 I $D(^PS(53.45,PSJSYSP,6,1)) D FILEOPI^PSJBCMA5(DFN,P("NEWON"))
"RTN","PSIVORC2",136,0)
 S PSJORD=ON,$P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",137,0)
 S P("OLDON")=ON,ON=P("NEWON")
"RTN","PSIVORC2",138,0)
 I $D(^PS(53.1,+P("OLDON"),12)) M ^PS(53.1,+P("NEWON"),12)=^PS(53.1,+P("OLDON"),12)
"RTN","PSIVORC2",139,0)
 S P("RES")="E"
"RTN","PSIVORC2",140,0)
 S P("DO")="" D GTPD^PSIVORE2 ;Get dosage order if not defined for IPM IV
"RTN","PSIVORC2",141,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",142,0)
 S $P(^PS(53.1,+ON,0),U,25,26)=P("OLDON")_U_""
"RTN","PSIVORC2",143,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",144,0)
 D EN1^PSJHL2(DFN,"SN",ON,"SEND ORDER NUMBER")
"RTN","PSIVORC2",145,0)
 S:$D(PSGP)#10 PSJNOL=$$LS^PSSLOCK(PSGP,ON)
"RTN","PSIVORC2",146,0)
 D VF
"RTN","PSIVORC2",147,0)
 Q
"RTN","PSIVORC2",148,0)
VF ; Display Verify screen
"RTN","PSIVORC2",149,0)
 Q:ON'["P"
"RTN","PSIVORC2",150,0)
 K PSJIVBD
"RTN","PSIVORC2",151,0)
 D GT531^PSIVORFA(DFN,ON)
"RTN","PSIVORC2",152,0)
 S PSGACT="EL"
"RTN","PSIVORC2",153,0)
 I P(17)="N",(P("OLDON")=""),(+P("CLRK")=DUZ) S PSGACT="ELD"
"RTN","PSIVORC2",154,0)
 I +PSJSYSU=3!(+PSJSYSU=1) S PSGACT="DELV"
"RTN","PSIVORC2",155,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSIVORC2",156,0)
 I P("OT")="I" S PSJSTAR="(1)^(5)^(7)^(9)^(10)"
"RTN","PSIVORC2",157,0)
 I P("OT")'="I" S PSJSTAR="(1)^(2)^(3)^(5)^(7)^(9)"
"RTN","PSIVORC2",158,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSIVORC2",159,0)
 Q
"RTN","PSIVORC2",160,0)
 ;
"RTN","PSIVORC2",161,0)
RESET ;Reset PSIVOI("DILIST") for additives with quick codes
"RTN","PSIVORC2",162,0)
 N XX,XXX,CNT S CNT=0
"RTN","PSIVORC2",163,0)
 S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S CNT=CNT+1,LYN(CNT)=PSIVOI("DILIST",XX,0) D
"RTN","PSIVORC2",164,0)
 . S XXX=0 F  S XXX=$O(PSIVOI("DILIST",XX,XXX)) Q:XXX=""  S CNT=CNT+1,LYN(CNT)=$P(PSIVOI("DILIST",XX,0),"^")_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^",2)_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^")_"^"_"QC"
"RTN","PSIVORC2",165,0)
 K PSIVOI("DILIST")
"RTN","PSIVORC2",166,0)
 S PSIVOI("DILIST",0)=CNT_"^*^0^"
"RTN","PSIVORC2",167,0)
 S XX=0 F  S XX=$O(LYN(XX)) Q:'XX  S PSIVOI("DILIST",XX,0)=LYN(XX)
"RTN","PSIVORC2",168,0)
 K LYN
"RTN","PSIVORC2",169,0)
 Q
"RTN","PSIVORFA")
0^46^B28198833^B27786981
"RTN","PSIVORFA",1,0)
PSIVORFA ;BIR/MLM-FILE/RETRIEVE ORDERS IN 53.1 ; 8/17/09 9:23am
"RTN","PSIVORFA",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,7,18,28,50,71,58,91,80,110,111,134,225,267,275**;16 DEC 97;Build 157
"RTN","PSIVORFA",3,0)
 ;
"RTN","PSIVORFA",4,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSIVORFA",5,0)
 ; Reference to ^PS(51.2 supported by DBIA 2178.
"RTN","PSIVORFA",6,0)
 ; Reference to ^PS(52.7 supported by DBIA 2173.
"RTN","PSIVORFA",7,0)
 ; Reference to ^PS(52.6 supported by DBIA 1231.
"RTN","PSIVORFA",8,0)
 ;
"RTN","PSIVORFA",9,0)
GT531(DFN,ON,PSJAPI) ; Retrieve order data from 53.1 and place into local array
"RTN","PSIVORFA",10,0)
 ;
"RTN","PSIVORFA",11,0)
 ; PSJAPI - If being called from background job, PSJAPI=1.
"RTN","PSIVORFA",12,0)
 NEW PSGOES S PSGOES=1
"RTN","PSIVORFA",13,0)
 F X="CUM","LF","LFA","LF","PRNTON" S P(X)=""
"RTN","PSIVORFA",14,0)
 S Y=$G(^PS(53.1,+ON,0)),P(17)=$P(Y,U,9),P("LOG")=$P(Y,U,16),(P(21),P("21FLG"),PSJORIFN)=$P(Y,U,21)
"RTN","PSIVORFA",15,0)
 S P("RES")=$P(Y,U,24),P("OLDON")=$P(Y,U,25),P("NEWON")=$P(Y,U,26),P("FRES")=$P(Y,U,27)
"RTN","PSIVORFA",16,0)
 S P("MR")=$P(Y,U,3),P(6)=+$P(Y,U,2),Y=$G(^VA(200,+P(6),0)),$P(P(6),U,2)=$P(Y,U),Y=$G(^PS(51.2,+P("MR"),0)),$P(P("MR"),U,2)=$S($P(Y,U,3)]"":$P(Y,U,3),1:$P(Y,U))
"RTN","PSIVORFA",17,0)
 S Y=$G(^PS(53.1,+ON,.2)),P("PD")=$S(+Y:$P(Y,U)_U_$$OIDF^PSJLMUT1(+Y),1:""),P("DO")=$P(Y,U,2),P("NAT")=$P(Y,U,3),P("PRY")=$P(Y,U,4),(PSJCOM,P("PRNTON"))=$P(Y,U,8)
"RTN","PSIVORFA",18,0)
 S P("INS")=$G(^PS(53.1,+ON,.3))
"RTN","PSIVORFA",19,0)
 I $G(^PS(53.1,+ON,4))]"" S P("NINIT")=$P(^(4),U),P("NINITDT")=$P(^(4),U,2)
"RTN","PSIVORFA",20,0)
 NEW NAME S NAME=""
"RTN","PSIVORFA",21,0)
 I $D(^PS(53.1,+ON,1,1)) D DD^PSJLMUT1("^PS(53.1,+ON,",.NAME)
"RTN","PSIVORFA",22,0)
 S P("INS")=P("INS")_$S(P("INS")]"":" of ",1:"")_NAME
"RTN","PSIVORFA",23,0)
 S P("APPT")=$G(^PS(53.1,+ON,"DSS")),P("CLIN")=$P(P("APPT"),"^"),P("APPT")=$P(P("APPT"),"^",2)
"RTN","PSIVORFA",24,0)
 S Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(11)=$P(Y,U,5),P(15)=$S($P(Y,U,6)'="":$P(Y,U,6),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4)
"RTN","PSIVORFA",25,0)
 S Y=$G(^PS(53.1,+ON,4)),P("CLRK")=$P(Y,U,7)_U_$P($G(^VA(200,+$P(Y,U,7),0)),U),P("REN")=$P(Y,U,9),X=P(9)
"RTN","PSIVORFA",26,0)
 I $P($G(^PS(53.1,+ON,0)),U,7)="P",(P(9)'["PRN") S P(9)=P(9)_" PRN"
"RTN","PSIVORFA",27,0)
 K PSGST,XT
"RTN","PSIVORFA",28,0)
 ;PSJ*5*225 remove 1440 default
"RTN","PSIVORFA",29,0)
 I P(9)]"",P(9)'["PRN",(P(11)="") D  S P(15)=$S($G(XT)]""&'+$G(XT):XT,+$G(XT)>0:XT,$G(PSGS0XT):PSGS0XT,1:1440),P(11)=Y
"RTN","PSIVORFA",30,0)
 . I $O(^PS(51.1,"APPSJ",P(9),0)) D DIC^PSGORS0 Q
"RTN","PSIVORFA",31,0)
 . I '$O(^PS(51.1,"APPSJ",P(9),0)) N NOECH,PSGSCH S NOECH=1 D EN^PSIVSP
"RTN","PSIVORFA",32,0)
 S Y=$G(^PS(53.1,+ON,8)),P(4)=$P(Y,U),P(23)=$P(Y,U,2),P("SYRS")=$P(Y,U,3),P(5)=$P(Y,U,4),P(8)=$P(Y,U,5),P(7)=$P(Y,U,7),P("IVRM")=$P(Y,U,8)
"RTN","PSIVORFA",33,0)
 S P(4)=$S(P(4)'="":P(4),$G(PSIVTYPE):PSIVTYPE,1:"")
"RTN","PSIVORFA",34,0)
 S:'P("IVRM")&($D(PSIVSN)) P("IVRM")=+PSIVSN S Y=$G(^PS(59.5,+P("IVRM"),0)),$P(P("IVRM"),U,2)=$P(Y,U),Y=$G(^PS(53.1,+ON,9)),P("REM")=$P(Y,U),P("OPI")=$P(Y,U,2,3)
"RTN","PSIVORFA",35,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFA",36,0)
 S P("PACT")=$G(^PS(53.1,+ON,"A",1,0))
"RTN","PSIVORFA",37,0)
 D GTDRG,GTOT^PSIVUTL(P(4)) D:'$D(PSJLABEL) GTPC(ON)
"RTN","PSIVORFA",38,0)
 N ND2P5 S ND2P5=$G(^PS(53.1,+ON,2.5)) D
"RTN","PSIVORFA",39,0)
 .S P("DUR")=$P(ND2P5,"^",2)
"RTN","PSIVORFA",40,0)
 .S P("LIMIT")=$P(ND2P5,"^",4)
"RTN","PSIVORFA",41,0)
 .S P("IVCAT")=$P(ND2P5,"^",5)
"RTN","PSIVORFA",42,0)
 N LONGOPI S LONGOPI=$$GETOPI^PSJBCMA5(DFN,ON,$S($G(PSJAPI):1,1:""))
"RTN","PSIVORFA",43,0)
 Q
"RTN","PSIVORFA",44,0)
GTDRG ;
"RTN","PSIVORFA",45,0)
 K DRG F X="AD","SOL" S FIL=$S(X="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(53.1,+ON,X,Y)) Q:'Y  D
"RTN","PSIVORFA",46,0)
 .S (DRGI,DRG(X,0))=$G(DRG(X,0))+1,DRG=$G(^PS(53.1,+ON,X,Y,0)),ND=$G(^PS(FIL,+DRG,0)),DRGN=$P(ND,U),DRG(X,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFA",47,0)
 Q
"RTN","PSIVORFA",48,0)
 ;
"RTN","PSIVORFA",49,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFA",50,0)
 Q
"RTN","PSIVORFA",51,0)
 ;
"RTN","PSIVORFA",52,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSIVORFA",53,0)
 S:'$D(P(9)) P(9)=$G(PSGSCH)
"RTN","PSIVORFA",54,0)
 S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSIVORFA",55,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON"))
"RTN","PSIVORFA",56,0)
 S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_$S($G(P(15))'="":P(15),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSIVORFA",57,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7)_"^"_+P("IVRM"),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"") S $P(ND(4),U,1,2)=$G(P("NINIT"))_U_$G(P("NINITDT"))
"RTN","PSIVORFA",58,0)
 S:+$G(P("CLIN")) $P(^PS(53.1,+ON,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFA",59,0)
 S:+$G(P("APPT")) $P(^PS(53.1,+ON,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFA",60,0)
 S:$G(P("LIMIT"))]"" $P(^PS(53.1,+ON,2.5),"^",4)=P("LIMIT")
"RTN","PSIVORFA",61,0)
 I $G(PSJORD)["V"!($G(PSJORD)["P") I $G(^PS(53.1,+ON,2.5))="" N DUR S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S((PSJORD["P"):"P",1:"IV"),1) I DUR]"" D
"RTN","PSIVORFA",62,0)
 .I $G(IVLIMIT) S $P(^PS(53.1,+ON,2.5),"^",4)=DUR K IVLIMIT Q
"RTN","PSIVORFA",63,0)
 .S $P(^PS(53.1,+ON,2.5),"^",2)=DUR
"RTN","PSIVORFA",64,0)
 F X=0,2,4,8,9 S ^PS(53.1,+ON,X)=ND(X)
"RTN","PSIVORFA",65,0)
 S PSIVCAT=$$IVCAT^PSJHLU(DFN,ON,.P) S:PSIVCAT]"" $P(^PS(53.1,+ON,2.5),"^",5)=PSIVCAT K PSIVCAT
"RTN","PSIVORFA",66,0)
 S:'+$G(^PS(53.1,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSIVORFA",67,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSIVORFA",68,0)
 K DA,DIK S PSGS0Y=P(11),PSGS0XT=P(15),DA=+ON,DIK="^PS(53.1," D IX^DIK K DA,DIK,PSGS0Y,PSGS0XT,ND,^PS(53.1,"AS","P",DFN,+ON)
"RTN","PSIVORFA",69,0)
 K:P(17)="A" ^PS(53.1,"AS","N",DFN,+ON)
"RTN","PSIVORFA",70,0)
 S:P(15)="D" $P(^PS(53.1,+ON,2),U,6)="D"
"RTN","PSIVORFA",71,0)
 I $G(PSJINFIN) K PSJINFIN I $D(^PS(53.45,+$G(PSJSYSP),6)),'$D(^PS(53.1,+ON,"A")),'$D(^PS(53.1,+ON,16)) S PSJINFIN=2
"RTN","PSIVORFA",72,0)
 I $G(PSJSYSP) D
"RTN","PSIVORFA",73,0)
 .I '$D(^PS(53.45,+PSJSYSP,6)) I $G(PSJORD)["V"!($G(PSJORD)["P") I '$D(^PS(53.1,+ON,16)) N I S I=$$GETOPI^PSJBCMA5(DFN,PSJORD)
"RTN","PSIVORFA",74,0)
 .I $D(^PS(53.45,+PSJSYSP,6)) D FILEOPI^PSJBCMA5(DFN,ON)
"RTN","PSIVORFA",75,0)
 Q
"RTN","PSIVORFA",76,0)
 ;
"RTN","PSIVORFA",77,0)
UPD100 ; Update order data in file 100
"RTN","PSIVORFA",78,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF
"RTN","PSIVORFA",79,0)
 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) D SET^PSIVORFE
"RTN","PSIVORFA",80,0)
 Q
"RTN","PSIVORFA",81,0)
 ;
"RTN","PSIVORFA",82,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSIVORFA",83,0)
 K ^PS(53.1,+ON,DRGT) S ^PS(53.1,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSIVORFA",84,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFA",85,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFA",86,0)
 .S ^PS(53.1,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+ON,DRGT,+DRG,0)=Y
"RTN","PSIVORFA",87,0)
 Q
"RTN","PSIVPRO")
0^29^B46921517^B37380332
"RTN","PSIVPRO",1,0)
PSIVPRO ;BIR/PR,MLM-PROFILE AN ORDER ;01 OCT 96 / 9:48 AM
"RTN","PSIVPRO",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**38,58,85,110,181,263,275**;16 DEC 97;Build 157
"RTN","PSIVPRO",3,0)
 ;
"RTN","PSIVPRO",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVPRO",5,0)
 ;        
"RTN","PSIVPRO",6,0)
 ;Needs DFN and ^TMP("PSIV",$J) array
"RTN","PSIVPRO",7,0)
 N PSJCLNSV
"RTN","PSIVPRO",8,0)
 S PSJLN=1,PSIVX2=0
"RTN","PSIVPRO",9,0)
 S PSIVST=$O(^TMP("PSIV",$J,0)),X="",(PSIVON,PS)=0 D REACT I PSIVST]"" F PSIVX1=1:1 D PSIVST Q:'PSIVON  D PR
"RTN","PSIVPRO",10,0)
 S ^TMP("PSJPRO",$J,0)=PSIVX2,VALMCNT=PSJLN-1
"RTN","PSIVPRO",11,0)
 I $G(PSIVBR)="D ^PSIVOPT" S VALM("TITLE")="IV Order Entry"
"RTN","PSIVPRO",12,0)
 E  S VALM("TITLE")="IV Profile"
"RTN","PSIVPRO",13,0)
QUIT ; Kill and exit.
"RTN","PSIVPRO",14,0)
 S ON=X K ADM,AL,DRG,GMRA,GMRAL,PSIVST,PSIVX1,PSIVX2,Y,NAD,N0,X3,X4,X5
"RTN","PSIVPRO",15,0)
 Q
"RTN","PSIVPRO",16,0)
 ;
"RTN","PSIVPRO",17,0)
PSIVST ;
"RTN","PSIVPRO",18,0)
 S PSIVON=$O(^TMP("PSIV",$J,PSIVST,PSIVON)) I 'PSIVON S PSIVST=$O(^TMP("PSIV",$J,PSIVST_"Z")) I PSIVST]"" S PSIVON=$O(^TMP("PSIV",$J,PSIVST,0)) D HDL
"RTN","PSIVPRO",19,0)
 Q
"RTN","PSIVPRO",20,0)
REACT ;
"RTN","PSIVPRO",21,0)
 S PSJL="#   Additive",PSJL=$$SETSTR^VALM1("Last fill",PSJL,32,9)
"RTN","PSIVPRO",22,0)
 S PSJL=$$SETSTR^VALM1("Type",PSJL,49,4),PSJL=$$SETSTR^VALM1(" Start   Stop  Stat",PSJL,54,19)
"RTN","PSIVPRO",23,0)
 S PSJL=$$SETSTR^VALM1("Renew",PSJL,74,5)
"RTN","PSIVPRO",24,0)
 D SETTMP^PSJLMPRI
"RTN","PSIVPRO",25,0)
HDL ; Display type heading.
"RTN","PSIVPRO",26,0)
 S PSJL=""
"RTN","PSIVPRO",27,0)
 D ACL:($P(PSIVST,"^")'="Cz")&(PSIVST="A"),DPL:($P(PSIVST,"^")'="Cz")&(PSIVST="RD"),POL:($P(PSIVST,"^")'="Cz")&(PSIVST="P"),POCL:($P(PSIVST,"^")'="Cz")&(PSIVST="PD")
"RTN","PSIVPRO",28,0)
 D NVL:($P(PSIVST,"^")'="Cz")&(PSIVST="N"),NVCL:($P(PSIVST,"^")'="Cz")&(PSIVST="ND"),NOL:($P(PSIVST,"^")'="Cz")&(PSIVST="X")
"RTN","PSIVPRO",29,0)
 D NOC:($P(PSIVST,"^")'="Cz")&(PSIVST=""),CLIN($P(PSIVST,"^",2)):($P(PSIVST,"^")="Cz"&($P(PSIVST,"^",2)'=$G(PSJCLNSV))) S X=""
"RTN","PSIVPRO",30,0)
 I ($P(PSIVST,"^")="Cz") S PSJCLNSV=$P(PSIVST,"^",2)
"RTN","PSIVPRO",31,0)
 S PSJL=$E(PSJL,1,79) D SETTMP^PSJLMPRI
"RTN","PSIVPRO",32,0)
 Q
"RTN","PSIVPRO",33,0)
 ;
"RTN","PSIVPRO",34,0)
PR ; Get & display order.
"RTN","PSIVPRO",35,0)
 I ($P(PSIVST,"^")'="Cz") S (ON,ON55)=9999999999-($S(PSIVST["P":$E(PSIVON,2,11),PSIVST["N":$E(PSIVON,2,11),1:PSIVON))_$S(PSIVST["P":"P",PSIVST["N":"P",1:"V") D
"RTN","PSIVPRO",36,0)
 .D @$S(PSIVST["P":"GT531^PSIVORFA(DFN,ON)",PSIVST["N":"GT531^PSIVORFA(DFN,ON)",1:"GT55^PSIVORFB")
"RTN","PSIVPRO",37,0)
 I ($P(PSIVST,"^")="Cz") S (ON,ON55)=9999999999-($S($P(PSIVST,"^",4)["P":$E(PSIVON,2,11),$P(PSIVST,"^",4)["N":$E(PSIVON,2,11),1:PSIVON))_$S($P(PSIVST,"^",4)["P":"P",$P(PSIVST,"^",4)["N":"P",1:"V") D
"RTN","PSIVPRO",38,0)
 .D @$S($P(PSIVST,"^",4)["P":"GT531^PSIVORFA(DFN,ON)",$P(PSIVST,"^",4)["N":"GT531^PSIVORFA(DFN,ON)",1:"GT55^PSIVORFB")
"RTN","PSIVPRO",39,0)
 S X="",PS=PSIVX1 K ^TMP("PSIV",$J,PSIVST,PSIVON) D
"RTN","PSIVPRO",40,0)
 .I ($P(PSIVST,"^")'="Cz") S ^TMP("PSIV",$J,PSIVST_"B",PSIVX1)=$S(PSIVST["P":$E(PSIVON,2,11),PSIVST["N":$E(PSIVON,2,11),1:PSIVON)_$S(PSIVST["P":"P",PSIVST["N":"P",1:"V")
"RTN","PSIVPRO",41,0)
 .I ($P(PSIVST,"^")="Cz") S ^TMP("PSIV",$J,PSIVST_"B",PSIVX1)=$S($P(PSIVST,"^",4)["P":$E(PSIVON,2,11),$P(PSIVST,"^",4)["N":$E(PSIVON,2,11),1:PSIVON)_$S($P(PSIVST,"^",4)["P":"P",$P(PSIVST,"^",4)["N":"P",1:"V")
"RTN","PSIVPRO",42,0)
 .I PSIVST="RD"!($P(PSIVST,"^",4)="RD") D ENPL Q
"RTN","PSIVPRO",43,0)
 I ($P(PSIVST,"^")'="Cz"),(PSIVST["D") N PSJO,PSIVX3 S PSIVX3=PSIVX1,PSJO=0 I $G(PSJCOM) D
"RTN","PSIVPRO",44,0)
 .F  S PSJO=$O(^PS(53.1,"ACX",PSJCOM,PSJO)) Q:'PSJO  S ON=PSJO_"P" D GT531^PSIVORFA(DFN,ON),ENPL S PSIVX1=""
"RTN","PSIVPRO",45,0)
 I ($P(PSIVST,"^")'="Cz"),(PSIVST["D") S PSIVX1=PSIVX3 Q
"RTN","PSIVPRO",46,0)
 ;
"RTN","PSIVPRO",47,0)
ENPL ;
"RTN","PSIVPRO",48,0)
 NEW MARX,DRUGNAME,X,XX
"RTN","PSIVPRO",49,0)
 S PSJL=$J(PSIVX1,4) I ON["P",(P("OT")'="F"),P(4)'="H" D  Q
"RTN","PSIVPRO",50,0)
 . I $D(VALMEVL) D
"RTN","PSIVPRO",51,0)
 .. N PSJFLAG
"RTN","PSIVPRO",52,0)
 .. S PSJFLAG=$P($S(ON["V":$G(^PS(55,DFN,"IV",+ON,.2)),1:$G(^PS(53.1,+ON,.2))),U,7)
"RTN","PSIVPRO",53,0)
 .. I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSIVPRO",54,0)
 . D DRGDISP^PSJLMUT1(DFN,ON,34,59,.DRUGNAME,0)
"RTN","PSIVPRO",55,0)
 . NEW X F X=0:0 S X=$O(DRUGNAME(X)) Q:'X  S:X>1 PSJL="" S PSJL=$$SETSTR^VALM1(DRUGNAME(X),PSJL,$S(X=1:6,1:7),$S(X=1:34,1:65)) D:X=1 V D SETTMP^PSJLMPRI
"RTN","PSIVPRO",56,0)
 S X=$J(PSIVX1,4)_$S(P("PRY")="D":" d",1:"  ")
"RTN","PSIVPRO",57,0)
 I ON["V" S XX=$G(^PS(55,DFN,"IV",+ON,4)) D
"RTN","PSIVPRO",58,0)
 . I +PSJSYSU=1,'+XX S X=X_"->"
"RTN","PSIVPRO",59,0)
 . I +PSJSYSU=3,'+$P(XX,U,4) S X=X_"->"
"RTN","PSIVPRO",60,0)
 S PSJL=X
"RTN","PSIVPRO",61,0)
 I $D(VALMEVL) D
"RTN","PSIVPRO",62,0)
 . N PSJFLAG
"RTN","PSIVPRO",63,0)
 . S PSJFLAG=$P($S(ON["V":$G(^PS(55,DFN,"IV",+ON,.2)),1:$G(^PS(53.1,+ON,.2))),U,7)
"RTN","PSIVPRO",64,0)
 . I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSIVPRO",65,0)
 D AD,SOL
"RTN","PSIVPRO",66,0)
 Q
"RTN","PSIVPRO",67,0)
SOL ;
"RTN","PSIVPRO",68,0)
 NEW NAME,PSJNOAD,L ;S PSJNOAD=0,L=34
"RTN","PSIVPRO",69,0)
 S NAD=0 F  S NAD=$O(DRG("SOL",NAD)) Q:'NAD  D
"RTN","PSIVPRO",70,0)
 . K NAME S L=34,PSJNOAD=0
"RTN","PSIVPRO",71,0)
 . I '$D(DRG("AD",1)),NAD=1 S PSJNOAD=1,L=27
"RTN","PSIVPRO",72,0)
 . S:NAD=1 PSJL=$$SETSTR^VALM1("in",PSJL,6,11)
"RTN","PSIVPRO",73,0)
 . D NAME^PSIVUTL(DRG("SOL",NAD),L,.NAME,0)
"RTN","PSIVPRO",74,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  S:(NAD>1!(X>1)) PSJL="" S PSJL=$$SETSTR^VALM1(NAME(X),PSJL,9,34) D:X=1&PSJNOAD V D SETTMP^PSJLMPRI
"RTN","PSIVPRO",75,0)
 . S PSJL=""
"RTN","PSIVPRO",76,0)
 Q
"RTN","PSIVPRO",77,0)
AD ;
"RTN","PSIVPRO",78,0)
 NEW NAME
"RTN","PSIVPRO",79,0)
 S NAD=0 F  S NAD=$O(DRG("AD",NAD)) Q:'NAD  D
"RTN","PSIVPRO",80,0)
 . K NAME
"RTN","PSIVPRO",81,0)
 . ;D NAME^PSIVUTL(DRG("AD",NAD),30,.NAME,1)
"RTN","PSIVPRO",82,0)
 . D NAME^PSIVUTL(DRG("AD",NAD),27,.NAME,1)
"RTN","PSIVPRO",83,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  S:(NAD>1!(X>1)) PSJL="" S PSJL=$$SETSTR^VALM1(NAME(X),PSJL,6,34) D:(NAD=1&(X=1)) V D SETTMP^PSJLMPRI
"RTN","PSIVPRO",84,0)
 . S PSJL=""
"RTN","PSIVPRO",85,0)
 Q
"RTN","PSIVPRO",86,0)
 ;
"RTN","PSIVPRO",87,0)
V S Y=$S(ON["V":$P($G(^PS(55,DFN,"IV",+ON,9)),U),1:"")
"RTN","PSIVPRO",88,0)
 I +Y>0 X ^DD("DD") S Y=$P(Y,",")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSIVPRO",89,0)
 E  S Y="**   N/P  **"
"RTN","PSIVPRO",90,0)
 S PSJL=$$SETSTR^VALM1(Y,PSJL,33,12)
"RTN","PSIVPRO",91,0)
 S PSJL=$$SETSTR^VALM1(" #"_$S(ON["V":+$P($G(^PS(55,DFN,"IV",+ON,9)),U,2),1:0),PSJL,46,3)
"RTN","PSIVPRO",92,0)
 S:PSIVX1]"" PSIVX2=PSIVX2+1
"RTN","PSIVPRO",93,0)
 D REST
"RTN","PSIVPRO",94,0)
 Q
"RTN","PSIVPRO",95,0)
ACL ;
"RTN","PSIVPRO",96,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" A c t i v e "
"RTN","PSIVPRO",97,0)
 Q
"RTN","PSIVPRO",98,0)
NVL ;
"RTN","PSIVPRO",99,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" N o n - V e r i f i e d "
"RTN","PSIVPRO",100,0)
 Q
"RTN","PSIVPRO",101,0)
NVCL ;
"RTN","PSIVPRO",102,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" N o n - V e r i f i e d  C o m p l e x "
"RTN","PSIVPRO",103,0)
 Q
"RTN","PSIVPRO",104,0)
POL ;
"RTN","PSIVPRO",105,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" P e n d i n g "
"RTN","PSIVPRO",106,0)
 Q
"RTN","PSIVPRO",107,0)
POCL ;
"RTN","PSIVPRO",108,0)
 F X3=1:1:66 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" P e n d i n g  C o m p l e x "
"RTN","PSIVPRO",109,0)
 Q
"RTN","PSIVPRO",110,0)
NOL ;
"RTN","PSIVPRO",111,0)
 F X3=1:1:66 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" N o t   A c t i v e "
"RTN","PSIVPRO",112,0)
 Q
"RTN","PSIVPRO",113,0)
CLIN(CLINIC) ; Print Clinic Name section header
"RTN","PSIVPRO",114,0)
 N LEFTALIN S LEFTALIN=(80-$L(CLINIC))\2
"RTN","PSIVPRO",115,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:(X3=(LEFTALIN)) PSJL=PSJL_CLINIC
"RTN","PSIVPRO",116,0)
 Q
"RTN","PSIVPRO",117,0)
DPL ;Recently dc/expired header
"RTN","PSIVPRO",118,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSIVPRO",119,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=15 PSJL=PSJL_"Recently Discontinued/Expired (Last "_+$G(PSJDCEXP)_" hours)"
"RTN","PSIVPRO",120,0)
 Q
"RTN","PSIVPRO",121,0)
NOC ;
"RTN","PSIVPRO",122,0)
 F X3=1:1:66 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" No current IV information "
"RTN","PSIVPRO",123,0)
 ;
"RTN","PSIVPRO",124,0)
 S PSJL=""
"RTN","PSIVPRO",125,0)
 Q
"RTN","PSIVPRO",126,0)
REST ;
"RTN","PSIVPRO",127,0)
 S PSJL=$$SETSTR^VALM1(P(4),PSJL,52,1)
"RTN","PSIVPRO",128,0)
 S PSJL=$$SETSTR^VALM1($E($$ENDTC^PSGMI(P(2)),1,5),PSJL,55,5)
"RTN","PSIVPRO",129,0)
 S PSJL=$$SETSTR^VALM1($E($$ENDTC^PSGMI(P(3)),1,5),PSJL,62,5)
"RTN","PSIVPRO",130,0)
 S PSJL=$$SETSTR^VALM1($S(P(17)="R"&(ON'["V"):"R/I",$G(P(25))]"":P(25),1:P(17)),PSJL,69,2)
"RTN","PSIVPRO",131,0)
 S PSJL=$$SETSTR^VALM1($S(ON["P":P("PRY"),1:""),PSJL,71,1)
"RTN","PSIVPRO",132,0)
 N PSJLRN S PSJLRN=$$LASTREN^PSJLMPRI(DFN,ON55) I PSJLRN S PSJLRN=$E($$ENDTC^PSGMI(PSJLRN),1,5) S PSJL=$$SETSTR^VALM1(PSJLRN,PSJL,74,5)
"RTN","PSIVPRO",133,0)
 Q
"RTN","PSIVPRO",134,0)
XCHK ;
"RTN","PSIVPRO",135,0)
 I $E(X)="?" W !!?2,"Select order",$E("s",PS'=1)," (1" W:PS>1 "-",PS W ")."
"RTN","PSIVPRO",136,0)
 I $E(X)="?" W:$S($O(^TMP("PSIV",$J,PSIVST,ON)):1,1:$O(^TMP("PSIV",$J,PSIVST))]"") "  Press RETURN to view more orders, or enter '^' to abort",!,"the profile, or 'A' to view Allergies." D:$E(X,1,2)="??" H2^PSGON K X Q
"RTN","PSIVPRO",137,0)
 S PSGLMT=PS D ^PSGON Q
"RTN","PSIVPRO",138,0)
 ;
"RTN","PSIVPRO",139,0)
PSPD S Y=$S(PSIVST'="P":$P($G(^PS(55,DFN,"IV",+ON,9)),U),1:"")
"RTN","PSIVPRO",140,0)
 X ^DD("DD") S:Y="" PSJL=$$SETSTR^VALM1("**   N/P  **",PSJL,36,12)
"RTN","PSIVPRO",141,0)
 S:Y'="" PSJL=$$SETSTR^VALM1($P(Y,","),PSJL,36,7),PSJL=$$SETSTR^VALM1($P($P(Y,"@",2),":",1,2),PSJL,43,45)
"RTN","PSIVPRO",142,0)
 S PSJL=PSJL_" #"_$S(Y="":0,1:$P(^PS(55,DFN,"IV",+ON,9),U,2))
"RTN","PSIVPRO",143,0)
 D REST
"RTN","PSIVPRO",144,0)
 Q
"RTN","PSIVQUI")
0^51^B19673705^B19161013
"RTN","PSIVQUI",1,0)
PSIVQUI ;BIR/RGY,MLM-HANDLE QUICK CODE ENTRIES ;15 Dec 98 / 8:29 AM
"RTN","PSIVQUI",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**21,50,65,73,76,93,104,110,275**;16 DEC 97;Build 157
"RTN","PSIVQUI",3,0)
 ;
"RTN","PSIVQUI",4,0)
 ;Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSIVQUI",5,0)
 ;Reference to ^PS(51.2 is supported by DBIA 2178
"RTN","PSIVQUI",6,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231
"RTN","PSIVQUI",7,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173
"RTN","PSIVQUI",8,0)
 ;
"RTN","PSIVQUI",9,0)
 N X,PSIVSC1 S (PSIVAT,PSIVAAT,PSIVWAT)="",PSIVQUIY=Y,(X,PSIVQUIX)=PSIVX
"RTN","PSIVQUI",10,0)
 Q:'Y!(PSIVQUIX="")  S PSIVX0=$O(^PS(52.6,"C",X,+Y,0)),PSIVX0=$G(^PS(52.6,+Y,1,PSIVX0,0))
"RTN","PSIVQUI",11,0)
 I $P(PSIVX0,"^",5)]""!$P(PSIVX0,"^",6)!(P(5)) S PSIVAAT=$P(PSIVX0,"^",6)
"RTN","PSIVQUI",12,0)
 K PSIVX0 S Y=PSIVQUIY,Y(0)=$G(^PS(52.6,+Y,0)),X=PSIVQUIX
"RTN","PSIVQUI",13,0)
 Q:$S('$D(X):1,'$D(^PS(52.6,"C",X)):1,1:0)!'$D(P(4))
"RTN","PSIVQUI",14,0)
SET K DRG S PSIVX0=$S($D(^PS(52.6,+Y,1,+$O(^PS(52.6,"C",X,+Y,0)),0)):^(0),1:""),(DRGI,DRG("AD",0))=1,TDRG("AD",+Y,DRGI)="",DRG("AD",DRGI)=+Y_U_$P(Y(0),U)_U_$P(PSIVX0,"^",2)_U_U_$P(Y(0),U,13)_U_$P(Y(0),U,11)
"RTN","PSIVQUI",15,0)
 N PSIVQZ,PSIVADD0,PSIVSZ,PSIVAZ,PSIVXAT,PSIVSIEN,PSIVXW S PSIVSIEN=0
"RTN","PSIVQUI",16,0)
 I $P(PSIVX0,U,4)]"" S P("OPI")=$P(PSIVX0,U,4) K ^PS(53.45,+$G(PSJSYSP),6) S ^PS(53.45,+$G(PSJSYSP),6,0)="^^1^1^",^(1,0)=P("OPI")
"RTN","PSIVQUI",17,0)
 I $P(PSIVX0,U,7)?1N.N D  Q:$G(PSGORQF)
"RTN","PSIVQUI",18,0)
 . S ND=$G(^PS(52.7,$P(PSIVX0,U,7),0))
"RTN","PSIVQUI",19,0)
 . W !!,"SOLUTION: ",$P(ND,U),!
"RTN","PSIVQUI",20,0)
 . N FIL S FIL="52.7",DRGTMP=$P(PSIVX0,U,7) D ORDERCHK^PSIVEDRG(DFN,ON55,1)
"RTN","PSIVQUI",21,0)
 . I $G(PSGORQF) S X="^",DONE=1 Q
"RTN","PSIVQUI",22,0)
 . S DRG("SOL",0)=1,DRG("SOL",1)=$P(PSIVX0,U,7)_U_$P(ND,U)_U_$P(ND,U,3)_U_U_$P(ND,U,13)_U_$P(ND,U,11),TDRG("SOL",$P(PSIVX0,U,7),1)=""
"RTN","PSIVQUI",23,0)
 I $P(PSIVX0,U,5)]""!P(5) S X=$P(PSIVX0,U,5)
"RTN","PSIVQUI",24,0)
 S PSIVQZ=$P(PSIVX0,U,5),PSIVQAZ=$P(PSIVX0,U,6),PSIVADD0=$G(^PS(52.6,+PSIVQUIY,0)),X=PSIVQZ
"RTN","PSIVQUI",25,0)
 S PSIVSZ=$P(PSIVADD0,"^",5),PSIVAZ=$P(PSIVADD0,"^",6)
"RTN","PSIVQUI",26,0)
 S PSIVAAT=$S(PSIVQZ]""&(PSIVQAZ]""):PSIVQAZ,PSIVQZ=""&(PSIVSZ]""):PSIVAZ,PSIVQZ=PSIVSZ:PSIVAZ,1:"")
"RTN","PSIVQUI",27,0)
 I $P(PSIVX0,U,5)']""!P(5) S X=$S(X]"":X,1:$P($G(^PS(52.6,+PSIVQUIY,0)),"^",5))
"RTN","PSIVQUI",28,0)
 ;
"RTN","PSIVQUI",29,0)
 ; If a sched was found, check all matching schedules 
"RTN","PSIVQUI",30,0)
 ; in 51.1 against $P(PSIVX0,"^",5), PSIVAAT, PSIVWAT
"RTN","PSIVQUI",31,0)
 I PSIVQZ]"",$G(X)'="" S ZZ=0 D
"RTN","PSIVQUI",32,0)
 .;if ZZ sched/times matches quick code sched/times, use the schedule
"RTN","PSIVQUI",33,0)
 .F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",34,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",35,0)
 ..I PSIVXAT=$P(PSIVX0,"^",6) S PSIVAT=$P(PSIVX0,"^",6),PSIVSIEN=ZZ
"RTN","PSIVQUI",36,0)
 ;
"RTN","PSIVQUI",37,0)
 ; If quick code has no schedule, check IV additive
"RTN","PSIVQUI",38,0)
 I PSIVAT="",$P(PSIVX0,"^",5)="",$G(X)'="" S ZZ=0 D 
"RTN","PSIVQUI",39,0)
 .F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",40,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",41,0)
 ..I PSIVAAT=PSIVXAT,(X=PSIVSZ) S PSIVAT=PSIVAAT,PSIVSIEN=ZZ
"RTN","PSIVQUI",42,0)
 .I PSIVAT="",PSIVAAT]"" S PSIVAT=PSIVAAT,$P(PSIVX0,"^",6)=PSIVAAT,$P(PSIVX0,"^",5)=PSIVSZ,PSIVSIEN=-1
"RTN","PSIVQUI",43,0)
 ;
"RTN","PSIVQUI",44,0)
 ; If quick code has schedule, no admin times, use ward times
"RTN","PSIVQUI",45,0)
 I PSIVAT="",PSIVQZ]"",$G(X)'="" D
"RTN","PSIVQUI",46,0)
 .S PSIVXW=$S($G(WSCHADM):WSCHADM,$G(VAIN(4)):+VAIN(4),1:"") Q:'PSIVXW
"RTN","PSIVQUI",47,0)
 .S ZZ=0 F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",48,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",49,0)
 ..S PSIVWAT=$P($G(^PS(51.1,ZZ,1,+PSIVXW,0)),"^",2)
"RTN","PSIVQUI",50,0)
 ..I PSIVWAT]"" S PSIVAT=PSIVWAT,PSIVSIEN=ZZ
"RTN","PSIVQUI",51,0)
 ;
"RTN","PSIVQUI",52,0)
 ; No ward times; go back to IV additive. If quick code has schedule,
"RTN","PSIVQUI",53,0)
 ; make sure it matches IV additive
"RTN","PSIVQUI",54,0)
 I PSIVAT="",PSIVAAT]"",PSIVWAT="",$G(X) D
"RTN","PSIVQUI",55,0)
 .S ZZ=0 F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",56,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",57,0)
 ..I (PSIVQZ=X&(PSIVQZ=PSIVSZ))!(PSIVQZ=""&(PSIVSZ]"")) I PSIVXAT=PSIVAAT D  Q
"RTN","PSIVQUI",58,0)
 ...S PSIVAT=PSIVAAT,PSIVSIEN=ZZ
"RTN","PSIVQUI",59,0)
 .I PSIVAT="" S PSIVAT=PSIVAAT,$P(PSIVX0,"^",6)=PSIVAAT,$P(PSIVX0,"^",5)=X,PSIVSIEN=-1
"RTN","PSIVQUI",60,0)
 I $G(PSIVSIEN) S Y=$S(PSIVSIEN>0:PSIVSIEN,1:"") N PSGOES S PSGOES=1
"RTN","PSIVQUI",61,0)
 I X="" S (Y,PSIVQUIY)=""
"RTN","PSIVQUI",62,0)
 S PSIVSPQF=1 D EN^PSIVSP K PSIVSPQF
"RTN","PSIVQUI",63,0)
 S P(11)=$S($P(PSIVX0,"^",6)]"":$P(PSIVX0,"^",6),(PSIVQZ]""&(PSIVWAT]"")):PSIVWAT,PSIVAAT]"":PSIVAAT,$G(P(11))]"":$G(P(11)),1:PSIVAT)
"RTN","PSIVQUI",64,0)
 S X=$P(PSIVX0,"^",3)
"RTN","PSIVQUI",65,0)
 I $P(PSIVX0,U,8) D
"RTN","PSIVQUI",66,0)
 .S P("MR")=+$P(PSIVX0,U,8)_U_$S($P($G(^PS(51.2,+$P(PSIVX0,U,8),0)),U,3):$P($G(^PS(51.2,+$P(PSIVX0,U,8),0)),U,3),1:$E($P($G(^PS(51.2,+$P(PSIVX0,U,8),0)),U),1,5))
"RTN","PSIVQUI",67,0)
 W " ",X D ENI^PSIVSP I '$D(X) W $C(7),"  --> Invalid infusion rate !!" I '$$SCHREQ^PSJLIVFD(.P) S P(15)=0
"RTN","PSIVQUI",68,0)
 I $$SCHREQ^PSJLIVFD(.P),'$$DOW^PSIVUTL($G(P(9))),'(P(15)>0) S P(15)=$$INTERVAL^PSIVUTL(.P)
"RTN","PSIVQUI",69,0)
 S PSIVOK="57^58^59^3^26^39^63^64^"_$S($E(P("OT"))="I":"101^109^",1:"")_"10^25^1"
"RTN","PSIVQUI",70,0)
 S P(17)="A",P(8)=$S($D(X):X,1:""),PSIVE=0,PSIVSTR="QUICK CODE",(DRG(2),Y)="",EDIT=$S(+P("MR"):"",1:"3^")_$P(EDIT,"64^",2) K ND,PSIVX0,PSIVSC,PSIVX
"RTN","PSIVQUI",71,0)
 Q
"RTN","PSIVUTL")
0^30^B30828184^B28212020
"RTN","PSIVUTL",1,0)
PSIVUTL ;BIR/MLM-IV UTILITIES ;07 SEP 97 / 2:17 PM 
"RTN","PSIVUTL",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**69,58,81,85,110,133,181,263,275**;16 DEC 97;Build 157
"RTN","PSIVUTL",3,0)
 ;
"RTN","PSIVUTL",4,0)
 ; Reference to ^DD("DD" is supported by DBIA 10017.
"RTN","PSIVUTL",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSIVUTL",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVUTL",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVUTL",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVUTL",9,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSIVUTL",10,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSIVUTL",11,0)
 ;
"RTN","PSIVUTL",12,0)
DRGSC(Y,PSJSCT) ; Called to set DIC("S") when selecting  Orderable Items.
"RTN","PSIVUTL",13,0)
 N OK,ND,NDU,NDI S OK=0
"RTN","PSIVUTL",14,0)
 S ND=$G(^PS(50.7,+Y,0))
"RTN","PSIVUTL",15,0)
 ;I $P(ND,U,3) S OK=$S('$P(ND,U,4):1,$P(ND,U,4)>DT:1,1:0)
"RTN","PSIVUTL",16,0)
 S OK=$S('$P(ND,U,4):1,$P(ND,U,4)>DT:1,1:0)
"RTN","PSIVUTL",17,0)
 Q OK
"RTN","PSIVUTL",18,0)
 ;
"RTN","PSIVUTL",19,0)
IVDRGSC(Y) ; Set DIC("S") for IV additive/solution selection.
"RTN","PSIVUTL",20,0)
 ; Naked reference below refers to full reference in Y, which is either ^PS(52.6, or ^PS(52.7
"RTN","PSIVUTL",21,0)
 N Y S Y="S X(1)=$G(^(0)),X(2)=$G(^(""I"")) I $S('X(2):1,X(2)>DT:1,1:0),$D(^PSDRUG(+$P(X(1),U,2),0)) S X(2)=$G(^(""I"")) I $S('+$P(X(1),U,11):0,'X(2):1,X(2)>DT:1,1:0)"
"RTN","PSIVUTL",22,0)
 Q Y
"RTN","PSIVUTL",23,0)
 ;
"RTN","PSIVUTL",24,0)
ENU(Y) ;Get IV additive strength.
"RTN","PSIVUTL",25,0)
 N X S X=$P(^PS(52.6,+Y,0),U,3),Y=$$CODES^PSIVUTL(X,52.6,2)
"RTN","PSIVUTL",26,0)
 Q Y
"RTN","PSIVUTL",27,0)
 ;
"RTN","PSIVUTL",28,0)
CODES(PSJCD,PSJF,PSJFLD) ; Get name from code. 
"RTN","PSIVUTL",29,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",30,0)
 D FIELD^DID(PSJF,PSJFLD,"","POINTER","PSJDD")
"RTN","PSIVUTL",31,0)
 S Y=$G(PSJDD("POINTER")) K PSJDD
"RTN","PSIVUTL",32,0)
 S Y=$P($P(";"_Y,";"_PSJCD_":",2),";")
"RTN","PSIVUTL",33,0)
 Q Y
"RTN","PSIVUTL",34,0)
 ;
"RTN","PSIVUTL",35,0)
CODES1(PSJCD,PSJF,PSJFLD)       ;Check to see if code is valid.
"RTN","PSIVUTL",36,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",37,0)
 D FIELD^DID(PSJF,PSJFLD,"","POINTER","PSJDD")
"RTN","PSIVUTL",38,0)
 I PSJDD("POINTER")'[PSJCD_":"  K PSJDD Q 0
"RTN","PSIVUTL",39,0)
 K PSJDD Q 1
"RTN","PSIVUTL",40,0)
 ;
"RTN","PSIVUTL",41,0)
CODES2(PSJF,PSJFLD)     ;Get field name
"RTN","PSIVUTL",42,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",43,0)
 D FIELD^DID(PSJF,PSJFLD,"","LABEL","PSJDD")
"RTN","PSIVUTL",44,0)
 Q PSJDD("LABEL")
"RTN","PSIVUTL",45,0)
 ;
"RTN","PSIVUTL",46,0)
GTPCI(Y) ; Set up "work" area for provider comments.
"RTN","PSIVUTL",47,0)
 N DIC,DINUM,DLAYGO,X S DIC="^PS(53.45,",DIC(0)="LNZ",DLAYGO=53.45,(DINUM,X)=+DUZ D ^DIC
"RTN","PSIVUTL",48,0)
 Q Y
"RTN","PSIVUTL",49,0)
 ;
"RTN","PSIVUTL",50,0)
WDTE(Y) ; Format and print date.
"RTN","PSIVUTL",51,0)
 I 'Y S Y="******"
"RTN","PSIVUTL",52,0)
 E  X ^DD("DD") S Y=$P(Y,"@")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSIVUTL",53,0)
 Q Y
"RTN","PSIVUTL",54,0)
GTOT(Y) ; Get order type & protocol
"RTN","PSIVUTL",55,0)
 N DRGI,DRGT
"RTN","PSIVUTL",56,0)
 S P("OT")=$S(Y="A":"F",Y="H":"H",1:"I")
"RTN","PSIVUTL",57,0)
 I P("OT")="F" F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I '$P(DRG(DRGT,DRGI),U,5) S P("OT")="I" Q
"RTN","PSIVUTL",58,0)
 Q
"RTN","PSIVUTL",59,0)
 ;
"RTN","PSIVUTL",60,0)
PIV(ON) ; Display IV orders.
"RTN","PSIVUTL",61,0)
 N DRG,ON55,P,PSJORIFN,TYP,X,Y S TYP="?" I ON["V" D
"RTN","PSIVUTL",62,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23,25 S P(X)=$P(Y,U,X)
"RTN","PSIVUTL",63,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSIVUTL",64,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSIVUTL",65,0)
 .W $S($P($G(^PS(55,DFN,"IV",+ON,.2)),U,4)="D":" d",1:"  ")
"RTN","PSIVUTL",66,0)
 .S X=$G(^PS(55,DFN,"IV",+ON,4)) I +PSJSYSU,'+$P(X,U,$S(+PSJSYSU=3:4,1:++PSJSYSU)) W "->"
"RTN","PSIVUTL",67,0)
 I ON=+ON N O S O="" F  S O=$O(^PS(53.1,"ACX",ON,O)) Q:O=""  D
"RTN","PSIVUTL",68,0)
 . S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+O,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) D PIV(O_"P") W !
"RTN","PSIVUTL",69,0)
 I ON["P" D GETP(ON) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) I $E(P("OT"))="I" D  Q
"RTN","PSIVUTL",70,0)
 . I $G(PSJCLOR) N ND2 S ND2=$G(^PS(53.1,+ON,2)) S P(2)=$P(ND2,"^",2),P(3)=$P(ND2,"^",4)
"RTN","PSIVUTL",71,0)
 . NEW MARX,PSIVX D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,54,.MARX,0)
"RTN","PSIVUTL",72,0)
 . F PSIVX=0:0 S PSIVX=$O(MARX(PSIVX)) Q:'PSIVX  W @($S(PSIVX=1:"?9",1:"!?11")),MARX(PSIVX) D:PSIVX=1 PIV1
"RTN","PSIVUTL",73,0)
 NEW DRGX S DRGX=0 F  S DRGX=$O(DRG("AD",DRGX)) Q:'DRGX  D PIVAD
"RTN","PSIVUTL",74,0)
SOL ;
"RTN","PSIVUTL",75,0)
 NEW NAME
"RTN","PSIVUTL",76,0)
 S DRGX=0 F  S DRGX=$O(DRG("SOL",DRGX)) Q:'DRGX  D
"RTN","PSIVUTL",77,0)
 . D NAME(DRG("SOL",DRGX),39,.NAME,0)
"RTN","PSIVUTL",78,0)
 . W:($D(DRG("AD",1))!(DRGX>1)) ! W:DRGX=1 ?9,"in "
"RTN","PSIVUTL",79,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  W ?12 W NAME(X) I X=1,DRGX=1,'$D(DRG("AD",1)) D PIV1
"RTN","PSIVUTL",80,0)
 Q
"RTN","PSIVUTL",81,0)
PIVAD ; Print IV Additives.
"RTN","PSIVUTL",82,0)
 NEW NAME,PSGX
"RTN","PSIVUTL",83,0)
 D NAME(DRG("AD",DRGX),39,.NAME,1)
"RTN","PSIVUTL",84,0)
 F PSGX=0:0 S PSGX=$O(NAME(PSGX)) Q:'PSGX  W:(DRGX'=1!(PSGX'=1)) ! W ?9,NAME(PSGX) I PSGX=1,DRGX=1 D PIV1
"RTN","PSIVUTL",85,0)
 Q
"RTN","PSIVUTL",86,0)
 ;
"RTN","PSIVUTL",87,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSIVUTL",88,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSIVUTL",89,0)
 I '$D(PSJEXTP) W ?50,TYP,?53,P(2),?60,P(3),?67,$S($G(P(25))]"":P(25),1:P(17)) Q
"RTN","PSIVUTL",90,0)
 W ?50,TYP,?53,P(2),?63,P(3),?73,$S($G(P(25))]"":P(25),1:P(17))
"RTN","PSIVUTL",91,0)
 Q
"RTN","PSIVUTL",92,0)
59 ; Validate the Infusion rate entered using IV Quick order code.
"RTN","PSIVUTL",93,0)
 N I F I=2,3,5,7,8,9,11,15,23 S P(I)=""
"RTN","PSIVUTL",94,0)
 S P(4)="A",P(8)=$P($G(^PS(57.1,PSJQO,1)),U,5)
"RTN","PSIVUTL",95,0)
 I $G(^PS(57.1,PSJQO,4,1,0)) S DRG("SOL",1)=^(0),DRG("SOL",0)=1
"RTN","PSIVUTL",96,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVUTL",97,0)
 I X]"" D ENI^PSIVSP S:$D(X) P(8)=X
"RTN","PSIVUTL",98,0)
 K F1,F2
"RTN","PSIVUTL",99,0)
 Q
"RTN","PSIVUTL",100,0)
WRTDRG(X,L)       ; Format and print drug name, strength and bottle no.
"RTN","PSIVUTL",101,0)
 N Y S Y=" "_$P(X,U,3) S:$P(X,U,4) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL",102,0)
 Q $E($P(X,U,2),1,(L-$L(Y)))_Y
"RTN","PSIVUTL",103,0)
 ;
"RTN","PSIVUTL",104,0)
NAME(X,L,MARX,AD)        ; Format Additive display.
"RTN","PSIVUTL",105,0)
 ;INPUT : X=DRG("AD",DRG)  L=Display length   AD=for Additive(1/0)
"RTN","PSIVUTL",106,0)
 ;OUTPUT: AD(X)  if X=2 that means there is a second line to display
"RTN","PSIVUTL",107,0)
 N Y K MARX S Y=$P(X,U,3) S:(AD&($P(X,U,4)]"")) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL",108,0)
 ;* S:'AD Y=Y_" "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@"))
"RTN","PSIVUTL",109,0)
 I 'AD!('$O(DRG("SOL",0))) D
"RTN","PSIVUTL",110,0)
 .I $G(PSJL)["  in" S Y=Y_" "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@")) Q
"RTN","PSIVUTL",111,0)
 .I $G(DRGX)]"",DRGX'>1 S Y=Y_"  "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@")) Q
"RTN","PSIVUTL",112,0)
 ;I ($L($P(X,U,2))+$L(Y)+1)>L S NAME(1)=$P(X,U,2),NAME(2)="   "_Y Q
"RTN","PSIVUTL",113,0)
 I ($L($P(X,U,2))+$L(Y)+1)>L D TXT^PSGMUTL($P(X,U,2)_" "_Y,L) S:AD MARX(2)="   "_MARX(2) Q
"RTN","PSIVUTL",114,0)
 S MARX(1)=$P(X,U,2)_" "_Y
"RTN","PSIVUTL",115,0)
 Q
"RTN","PSIVUTL",116,0)
 ;
"RTN","PSIVUTL",117,0)
INTERVAL(IVAR) ;
"RTN","PSIVUTL",118,0)
 N P,X,PSGOES M P=IVAR S X=$G(P(9)),PSGOES=1
"RTN","PSIVUTL",119,0)
 D EN^PSIVSP S IVAR(15)=$S($G(P(15)):P(15),1:1440)
"RTN","PSIVUTL",120,0)
 Q IVAR(15)
"RTN","PSIVUTL",121,0)
 ;
"RTN","PSIVUTL",122,0)
DOW(SCHED) ;
"RTN","PSIVUTL",123,0)
 Q:SCHED="" 0
"RTN","PSIVUTL",124,0)
 N P9,PSIVX,X S PSIVX=0 S P9=SCHED
"RTN","PSIVUTL",125,0)
 ; Use schedule validator
"RTN","PSIVUTL",126,0)
 S X=SCHED D DW^PSGS0 I $G(X)="" Q 0
"RTN","PSIVUTL",127,0)
 I +$O(^PS(51.1,"APPSJ",SCHED,0)) S PSIVX=1 S P9=$P(SCHED,"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVUTL",128,0)
 . I '("MON,TUE,WED,THU,FRI,SAT,SUN"[$P(P9,"-",X)) S PSIVX=0 Q
"RTN","PSIVUTL",129,0)
 Q:PSIVX +PSIVX
"RTN","PSIVUTL",130,0)
 I '$D(^PS(51.1,"APPSJ",SCHED)) S PSIVX=1,P9=$P(SCHED,"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVUTL",131,0)
 . I '(",MO,TU,WE,TH,FR,SA,SU,"[(","_$P(P9,"-",X)_",")) S PSIVX=0 Q
"RTN","PSIVUTL",132,0)
 Q +PSIVX
"RTN","PSIVUTL",133,0)
 ;
"RTN","PSIVUTL",134,0)
GETP(ON) ; Populate P array with data from order ON
"RTN","PSIVUTL",135,0)
 I ON["P" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D
"RTN","PSIVUTL",136,0)
 .I $G(PSJCLOR) N ND2 S ND2=$G(^PS(53.1,+ON,2)) S P(2)=$P(ND2,"^",2),P(3)=$P(ND2,"^",4) S TYP=$P(^PS(53.1,+ON,0),"^",7)
"RTN","PSIVUTL",137,0)
 Q
"RTN","PSJAC")
0^44^B14549203^B14319225
"RTN","PSJAC",1,0)
PSJAC ;BIR/CML3-INPATIENT INFORMATION ;28 Apr 98 / 9:02 AM
"RTN","PSJAC",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**8,10,50,127,181,275**;16 DEC 97;Build 157
"RTN","PSJAC",3,0)
 ;
"RTN","PSJAC",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJAC",5,0)
 ;
"RTN","PSJAC",6,0)
 S DFN=PSGP,PSJACPF=1 G CHK
"RTN","PSJAC",7,0)
 ;
"RTN","PSJAC",8,0)
ENBOTH ;
"RTN","PSJAC",9,0)
 S PSJACPF=11 G CHK
"RTN","PSJAC",10,0)
 ;
"RTN","PSJAC",11,0)
ENIV ;
"RTN","PSJAC",12,0)
 N I,J,JJ,ON,PSJRBXX,X,X1,X2,X,Y S PSJACPF=10,PSGP=DFN
"RTN","PSJAC",13,0)
 ;
"RTN","PSJAC",14,0)
CHK ;
"RTN","PSJAC",15,0)
 ;Check if 5.0 order conversion should be run for the selected patient.
"RTN","PSJAC",16,0)
 ;I '$P($G(^PS(55,DFN,5.1)),U,11) D CONVERT^PSJUTL1(DFN,$S($E(IOST,1)="C":1,1:0))
"RTN","PSJAC",17,0)
 ;/Commented out in PSJ*5*50.  No longer needed
"RTN","PSJAC",18,0)
 ;/F  S PSJRBXX=$$OTF^OR3CONV(DFN,$S($E(IOST,1)="C":0,1:1)) Q:+PSJRBXX'<0  D
"RTN","PSJAC",19,0)
 ;/.I +PSJRBXX=-1 W:$E(IOST,1)="C" !,$P(PSJRBXX,"^",2) H 4
"RTN","PSJAC",20,0)
 ;Converting IV order to new OI with POE if not done so when installed PSJ*5*50
"RTN","PSJAC",21,0)
 D CNIV^PSJUTL1(DFN)
"RTN","PSJAC",22,0)
 ;I $D(^PS(55,DFN,0)),'$P($G(^PS(55,DFN,0)),U,6) D EN^PSOHLUP(DFN)
"RTN","PSJAC",23,0)
 S VA200=1 D INP^VADPT
"RTN","PSJAC",24,0)
 I VAIN(4) S:PSJACPF#2 PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",4),1:""),PSJPDD="" G CNV
"RTN","PSJAC",25,0)
 S VAIP("D")="L" D IN5^VADPT G:PSJACPF[0 CNV
"RTN","PSJAC",26,0)
 S PSJPCAF="",PSJPAD=+VAIP(13,1)
"RTN","PSJAC",27,0)
 S PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38)!($G(VADM(6))),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD="",PSJPDD=PSGID_"^"_$$ENDTC^PSGMI(PSGID) S:X PSJPDD=PSJPDD_"^1"
"RTN","PSJAC",28,0)
 ;
"RTN","PSJAC",29,0)
CNV ;
"RTN","PSJAC",30,0)
 D DEM^VADPT,HTWT(PSGP)
"RTN","PSJAC",31,0)
 I PSJACPF#2 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSJAC",32,0)
 I PSJACPF#2 D
"RTN","PSJAC",33,0)
 .I $D(PSJY2K) D  Q
"RTN","PSJAC",34,0)
 ..F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC2^PSGMI(+@X)
"RTN","PSJAC",35,0)
 .F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSJAC",36,0)
 ;
"RTN","PSJAC",37,0)
WP ; ward parameters
"RTN","PSJAC",38,0)
 G:$D(PSJACNWP) DONE S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD) S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJAC",39,0)
 ;S PSJSYSL="",X=$P(PSJSYSU,";",3)>1 S PSJSYSL=$P(PSJSYSW0,"^",X*4+12) G:$D(PSJACND) DONE
"RTN","PSJAC",40,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1 S PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16)) G:$D(PSJACND) DONE
"RTN","PSJAC",41,0)
 ;S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJAC",42,0)
 I PSJSYSL D
"RTN","PSJAC",43,0)
 .S:X X='$P($G(PSJSYSP0),"^",10) S IOP=$S($P($G(PSJSYSP0),"^",13)]"":$P($G(PSJSYSP0),"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSJAC",44,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D HOME^%ZIS
"RTN","PSJAC",45,0)
 ;
"RTN","PSJAC",46,0)
DONE ;
"RTN","PSJAC",47,0)
 I PSJACPF<10 K VADM,VAIN,VAIP
"RTN","PSJAC",48,0)
 K PSJACPF,PSGID,PSGOD,VA200,X
"RTN","PSJAC",49,0)
 Q
"RTN","PSJAC",50,0)
HTWT(DFN) ; Get patient's height and weight from Vitals.
"RTN","PSJAC",51,0)
 S (PSJPWTD,PSJPHTD)=""
"RTN","PSJAC",52,0)
 S X="GMRVUTL" X ^%ZOSF("TEST") I  S GMRVSTR="HT" D
"RTN","PSJAC",53,0)
 . D EN6^GMRVUTL S PSJPHT=$P(X,U,8) S:PSJPHT PSJPHT=$J(2.54*PSJPHT,0,2),PSJPHTD="("_$S($D(PSJY2K):$E($$ENDTC2^PSGMI($P(X,U)),1,10),1:$E($$ENDTC^PSGMI($P(X,U)),1,8))_")"
"RTN","PSJAC",54,0)
 . S GMRVSTR="WT" D EN6^GMRVUTL S PSJPWT=$P(X,U,8) S:PSJPWT PSJPWT=$J(PSJPWT/2.2,0,2),PSJPWTD="("_$S($D(PSJY2K):$E($$ENDTC2^PSGMI($P(X,U)),1,10),1:$E($$ENDTC^PSGMI($P(X,U)),1,8))_")"
"RTN","PSJAC",55,0)
 F X="PSJPWT","PSJPHT" S:'$G(@X) @X="______"
"RTN","PSJAC",56,0)
 F X="PSJPWTD","PSJPHTD" S:$G(@X)="" @X="(________)"
"RTN","PSJAC",57,0)
 Q
"RTN","PSJAC",58,0)
PSJAC2(PSJY2K)     ;
"RTN","PSJAC",59,0)
 D PSJAC Q
"RTN","PSJBCMA5")
0^55^B80438277^B78422093
"RTN","PSJBCMA5",1,0)
PSJBCMA5 ;BIR/JCH-RETRIEVE SPECIAL INSTRUCTIONS/OTHER PRINT INFO ; 1/9/12 11:12am
"RTN","PSJBCMA5",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**267,275**;16 DEC 97;Build 157
"RTN","PSJBCMA5",3,0)
 ;
"RTN","PSJBCMA5",4,0)
 ;Reference to ^DPT is supported by DBIA 10035
"RTN","PSJBCMA5",5,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJBCMA5",6,0)
 ;Reference to ^%DTC is supported by DBIA 10000
"RTN","PSJBCMA5",7,0)
 ;Reference to ^DIE is supported by DBIA 10018
"RTN","PSJBCMA5",8,0)
 ;Reference to ^DIQ is supported by DBIA 2056
"RTN","PSJBCMA5",9,0)
 ;
"RTN","PSJBCMA5",10,0)
GETSIOPI(DFN,ON,BCMA) ; Get appropriate field depending on order type
"RTN","PSJBCMA5",11,0)
 ; DFN - Patient IEN
"RTN","PSJBCMA5",12,0)
 ; ON - Inpatient Order number
"RTN","PSJBCMA5",13,0)
 ; BCMA - Flag indicating called from BCMA - return data in ^TMP("PSJBCMA",$J
"RTN","PSJBCMA5",14,0)
 ;
"RTN","PSJBCMA5",15,0)
 I 'ON!'DFN Q 0
"RTN","PSJBCMA5",16,0)
 K ^TMP("PSJBCMA5",$J,DFN,ON)
"RTN","PSJBCMA5",17,0)
 I '$G(PSJSYSP),'$G(BCMA) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",18,0)
 I $G(BCMA) D  Q +$G(^TMP("PSJBCMA5",$J,DFN,ON))
"RTN","PSJBCMA5",19,0)
 .N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",20,0)
 .I ON["V"!((ON["P")&($D(^PS(53.1,+ON,"AD"))!$D(^PS(53.1,+ON,"SOL")))) D  Q
"RTN","PSJBCMA5",21,0)
 ..I $$GETOPI(DFN,ON,1) D MOVETMP(DFN,ON,"IV")
"RTN","PSJBCMA5",22,0)
 .I $$GETSI(DFN,ON,1) D MOVETMP(DFN,ON,"UD")
"RTN","PSJBCMA5",23,0)
 I ON["V"!((ON["P")&($D(^PS(53.1,+ON,"AD"))!$D(^PS(53.1,+ON,"SOL")))) Q $$GETOPI(DFN,ON)
"RTN","PSJBCMA5",24,0)
 Q $$GETSI(DFN,ON)
"RTN","PSJBCMA5",25,0)
 ;
"RTN","PSJBCMA5",26,0)
MOVETMP(DFN,ON,OTYP) ; Move text from PS(53.45 to ^TMP for BCMA
"RTN","PSJBCMA5",27,0)
 N LN,ND S ND=$S(OTYP="IV":6,1:5)
"RTN","PSJBCMA5",28,0)
 I $O(^PS(53.45,PSJSYSP,ND," "),-1)=1,$TR(^PS(53.45,PSJSYSP,ND,1,0)," ")="" K ^TMP("PSJBCMA5",$J) Q
"RTN","PSJBCMA5",29,0)
 S ^TMP("PSJBCMA5",$J,DFN,ON)=+$P(^PS(53.45,PSJSYSP,ND,0),"^",3) S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,ND,LN)) Q:'LN  D
"RTN","PSJBCMA5",30,0)
 .S ^TMP("PSJBCMA5",$J,DFN,ON,LN)=^PS(53.45,PSJSYSP,ND,LN,0)
"RTN","PSJBCMA5",31,0)
 K ^PS(53.45,PSJSYSP,ND)
"RTN","PSJBCMA5",32,0)
 Q
"RTN","PSJBCMA5",33,0)
 ;
"RTN","PSJBCMA5",34,0)
GETSI(DFN,ON,BC) ; Get Special Instructions for Unit Dose orders
"RTN","PSJBCMA5",35,0)
 N PSJTXT,TXTLN
"RTN","PSJBCMA5",36,0)
 I $G(DFN)=""!($G(ON)="") Q 0
"RTN","PSJBCMA5",37,0)
 I '$G(PSJSYSP) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",38,0)
 I ON["P" D  Q +$P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",39,0)
 .Q:($G(^PS(53.45,+PSJSYSP,5,0))="^^0^0")
"RTN","PSJBCMA5",40,0)
 .I $P($G(^PS(53.1,+ON,15,0)),"^",3) D  Q
"RTN","PSJBCMA5",41,0)
 ..S ^PS(53.45,+PSJSYSP,5,0)=^PS(53.1,+ON,15,0)
"RTN","PSJBCMA5",42,0)
 ..S LN=0 F  S LN=$O(^PS(53.1,+ON,15,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,5,LN,0)=^PS(53.1,+ON,15,LN,0)
"RTN","PSJBCMA5",43,0)
 .N OLDSI,MARX,TXTCNT S OLDSI=$P($G(^PS(53.1,+ON,6)),"^") I $L(OLDSI)>0 D  Q
"RTN","PSJBCMA5",44,0)
 ..I $G(BC),$L(OLDSI)>74 D TXT^PSGMUTL(OLDSI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,5,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",45,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,5,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",46,0)
 ..S ^PS(53.45,+PSJSYSP,5,1,0)=$P(^PS(53.1,+ON,6),"^"),^PS(53.45,+PSJSYSP,5,0)="^^1^1"
"RTN","PSJBCMA5",47,0)
 I ON["U" D  Q $P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",48,0)
 .Q:($G(^PS(53.45,+PSJSYSP,5,0))="^^0^0")
"RTN","PSJBCMA5",49,0)
 .I $P($G(^PS(55,+DFN,5,+ON,15,0)),"^",3) D  Q
"RTN","PSJBCMA5",50,0)
 ..S ^PS(53.45,+PSJSYSP,5,0)=$G(^PS(55,DFN,5,+ON,15,0))
"RTN","PSJBCMA5",51,0)
 ..S LN=0 F  S LN=$O(^PS(55,DFN,5,+ON,15,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,5,LN,0)=^PS(55,DFN,5,+ON,15,LN,0)
"RTN","PSJBCMA5",52,0)
 .N OLDSI,MARX,TXTCNT S OLDSI=$P($G(^PS(55,DFN,5,+ON,6)),"^") I $L(OLDSI)>0 D  Q
"RTN","PSJBCMA5",53,0)
 ..I $G(BC),$L(OLDSI)>74 D TXT^PSGMUTL(OLDSI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,5,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",54,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,5,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",55,0)
 ..S ^PS(53.45,+PSJSYSP,5,1,0)=$P(^PS(55,DFN,5,+ON,6),"^"),^PS(53.45,+PSJSYSP,5,0)="^^1^1"
"RTN","PSJBCMA5",56,0)
 Q 0
"RTN","PSJBCMA5",57,0)
 ;
"RTN","PSJBCMA5",58,0)
GETOPI(DFN,ON,BC) ; Get Other Print Info for IV orders
"RTN","PSJBCMA5",59,0)
 N PSJTXT,LN
"RTN","PSJBCMA5",60,0)
 I $G(DFN)=""!($G(ON)="") Q 0
"RTN","PSJBCMA5",61,0)
 I '$G(PSJSYSP) N PSJSYSP S PSJSYSP=$J
"RTN","PSJBCMA5",62,0)
 I ON["P" D  Q +$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",63,0)
 .Q:$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",64,0)
 .I $P($G(^PS(53.1,+ON,16,0)),"^",3) D  Q
"RTN","PSJBCMA5",65,0)
 ..S ^PS(53.45,+PSJSYSP,6,0)=^PS(53.1,+ON,16,0)
"RTN","PSJBCMA5",66,0)
 ..S LN=0 F  S LN=$O(^PS(53.1,+ON,16,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,6,LN,0)=^PS(53.1,+ON,16,LN,0)
"RTN","PSJBCMA5",67,0)
 .N OLDOPI,MARX,TXTCNT S OLDOPI=$P($G(^PS(53.1,+ON,9)),"^",2) I $L(OLDOPI)>0 D  Q
"RTN","PSJBCMA5",68,0)
 ..I $G(BC),$L(OLDOPI)>74 D TXT^PSGMUTL(OLDOPI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,6,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",69,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,6,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",70,0)
 ..S ^PS(53.45,+PSJSYSP,6,1,0)=$P(^PS(53.1,+ON,9),"^",2),^PS(53.45,+PSJSYSP,6,0)="^^1^1"
"RTN","PSJBCMA5",71,0)
 I ON["V" D
"RTN","PSJBCMA5",72,0)
 .Q:$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",73,0)
 .I $P($G(^PS(55,+DFN,"IV",+ON,10,0)),"^",3) D  Q
"RTN","PSJBCMA5",74,0)
 ..S ^PS(53.45,+PSJSYSP,6,0)=$G(^PS(55,DFN,"IV",+ON,10,0))
"RTN","PSJBCMA5",75,0)
 ..S LN=0 F  S LN=$O(^PS(55,DFN,"IV",+ON,10,LN)) Q:'LN  S ^PS(53.45,+PSJSYSP,6,LN,0)=^PS(55,DFN,"IV",+ON,10,LN,0)
"RTN","PSJBCMA5",76,0)
 .N OLDOPI,MARX,TXTCNT S OLDOPI=$P($G(^PS(55,DFN,"IV",+ON,3)),"^") I $L(OLDOPI)>0 D  Q
"RTN","PSJBCMA5",77,0)
 ..I $G(BC),$L(OLDOPI)>74 D TXT^PSGMUTL(OLDOPI,74) S TXTCNT=$O(MARX(" "),-1) S ^PS(53.45,+PSJSYSP,6,0)="^^"_TXTCNT_"^"_TXTCNT D  Q
"RTN","PSJBCMA5",78,0)
 ...S TXTLN=0 F  S TXTLN=$O(MARX(TXTLN)) Q:'TXTLN  S ^PS(53.45,+PSJSYSP,6,TXTLN,0)=MARX(TXTLN)
"RTN","PSJBCMA5",79,0)
 ..S ^PS(53.45,+PSJSYSP,6,1,0)=$P(^PS(55,DFN,"IV",+ON,3),"^"),^PS(53.45,+PSJSYSP,6,0)="^^1^1"
"RTN","PSJBCMA5",80,0)
 I $O(^PS(53.45,+PSJSYSP,6," "),-1)=1,($TR($G(^PS(53.45,+PSJSYSP,6,1,0))," ")="") K ^PS(53.45,+PSJSYSP,6)
"RTN","PSJBCMA5",81,0)
 Q +$P($G(^PS(53.45,+PSJSYSP,6,0)),"^",3)
"RTN","PSJBCMA5",82,0)
 ;
"RTN","PSJBCMA5",83,0)
EDITSI(DFN,PSJORD) ; Edit Special Instructions in ^PS(53.45 via Word Processing
"RTN","PSJBCMA5",84,0)
 N PSJII,DIC,I,PSJVALID,DIWESUB,PSJTXTLN S PSJVALID=0,DIC="^PS(53.45,"_+$G(PSJSYSP)_",5,",DIWESUB="SPECIAL INSTRUCTIONS"
"RTN","PSJBCMA5",85,0)
 I $G(PSJORD) I '$P($G(^PS(53.45,+$G(PSJSYSP),5,0)),"^",5) S L=$$GETSI(DFN,PSJORD)
"RTN","PSJBCMA5",86,0)
 K ^TMP("PSJTMPSI",$J) M ^TMP("PSJTMPSI",$J)=^PS(53.45,+$G(PSJSYSP),5)
"RTN","PSJBCMA5",87,0)
 F PSJII=1:1 Q:$G(PSJVALID)  D
"RTN","PSJBCMA5",88,0)
 .N II,L,DIR,DIE,DA,TMPLN,DR S PSJTXTLN="",PSJVALID=1,DIWESUB="SPECIAL INSTRUCTIONS"
"RTN","PSJBCMA5",89,0)
 .I PSJII=1 S DA=PSJSYSP,DR=5,DIE="^PS(53.45," D ^DIE
"RTN","PSJBCMA5",90,0)
 .I PSJII>1 S DA=PSJSYSP,DR=5,DIC="^PS(53.45,"_+$G(PSJSYSP)_",5," D EN^DIWE
"RTN","PSJBCMA5",91,0)
 .S PSJTXTLN=+$P($G(^PS(53.45,+PSJSYSP,5,0)),"^",3)
"RTN","PSJBCMA5",92,0)
 .S II=0 F  S II=$O(^PS(53.45,+PSJSYSP,5,II)) Q:'II!'$G(PSJVALID)  S TMPLN=$G(^(II,0)) I (TMPLN["^") S PSJVALID=0
"RTN","PSJBCMA5",93,0)
 .I 'PSJVALID W !!!,$C(7),"SPECIAL INSTRUCTIONS must not contain embedded uparrow ""^"". " I PSJII=1 D PAUSE("SPECIAL INSTRUCTIONS")
"RTN","PSJBCMA5",94,0)
 .I 'PSJVALID I PSJII>1 W ! I $$DONE("SPECIAL INSTRUCTIONS") K ^PS(53.45,+PSJSYSP,5) M ^PS(53.45,+$G(PSJSYSP),5)=^TMP("PSJTMPSI",$J) S PSJVALID=1 Q
"RTN","PSJBCMA5",95,0)
 .I PSJVALID I 'PSJTXTLN K ^PS(53.45,+PSJSYSP,5,0) S ^PS(53.45,+PSJSYSP,5,0)="-1^^0^0",^PS(53.45,+PSJSYSP,5,1,0)=""
"RTN","PSJBCMA5",96,0)
 I $P($G(^PS(53.45,+$G(PSJSYSP),5,0)),"^",3) D ENSI^PSJUTL("^PS(53.45,+$G(PSJSYSP),5,") S PSJTXTLN=$O(^PS(53.45,+$G(PSJSYSP),5,""),-1)
"RTN","PSJBCMA5",97,0)
 K ^TMP("PSJTMPSI",$J)
"RTN","PSJBCMA5",98,0)
 Q PSJTXTLN
"RTN","PSJBCMA5",99,0)
 ;
"RTN","PSJBCMA5",100,0)
EDITOPI(PSJDPT,PSJORD) ; Edit Other Print Info in ^PS(53.45 via Word Processing
"RTN","PSJBCMA5",101,0)
 N DIC,I,PSJVALID,DIWESUB,PSJTXTLN S PSJVALID=0,DIC="^PS(53.45,"_+$G(PSJSYSP)_",6,",DIWESUB="OTHER PRINT INFO"
"RTN","PSJBCMA5",102,0)
 K ^TMP("PSJTMPSI",$J) M ^TMP("PSJTMPSI",$J)=^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSJBCMA5",103,0)
 F PSJII=1:1 Q:$G(PSJVALID)  D
"RTN","PSJBCMA5",104,0)
 .N II,L,DIR,DA,DIE,TMPLN S DIR="",PSJTXTLN="",PSJVALID=1,DIWESUB="OTHER PRINT INFO"
"RTN","PSJBCMA5",105,0)
 .I PSJII=1 D OPIWARN(0)
"RTN","PSJBCMA5",106,0)
 .S PSJTXTLN=""
"RTN","PSJBCMA5",107,0)
 .I PSJII=1 S DA=PSJSYSP,DR=6,DIE="^PS(53.45," D ^DIE
"RTN","PSJBCMA5",108,0)
 .I PSJII>1 S DA=PSJSYSP,DR=6,DIC="^PS(53.45,"_+$G(PSJSYSP)_",6," D EN^DIWE
"RTN","PSJBCMA5",109,0)
 .S PSJTXTLN=$O(^PS(53.45,+PSJSYSP,6,""),-1)
"RTN","PSJBCMA5",110,0)
 .I PSJTXTLN="" K ^PS(53.45,+PSJSYSP,6) S ^PS(53.45,+PSJSYSP,6,0)="-1^^1^1",^PS(53.45,+PSJSYSP,6,1,0)=""
"RTN","PSJBCMA5",111,0)
 .S II=0 F  S II=$O(^PS(53.45,+PSJSYSP,6,II)) Q:'II!'$G(PSJVALID)  S TMPLN=$G(^(II,0)) I (TMPLN["^") S PSJVALID=0
"RTN","PSJBCMA5",112,0)
 .I 'PSJVALID W !!!,$C(7),"OTHER PRINT INFO must not contain embedded uparrow ""^""." I PSJII=1 D PAUSE("OTHER PRINT INFO")
"RTN","PSJBCMA5",113,0)
 .I 'PSJVALID I PSJII>1 W ! I $$DONE("OTHER PRINT INFO") K ^PS(53.45,+PSJSYSP,6) M ^PS(53.45,+$G(PSJSYSP),6)=^TMP("PSJTMPSI",$J) S PSJVALID=1 Q
"RTN","PSJBCMA5",114,0)
 .I PSJVALID D
"RTN","PSJBCMA5",115,0)
 ..I ($L($G(^PS(53.45,+PSJSYSP,6,1,0)))>60) D OPIWARN(1) S P("OPI")="Instructions too long. See Order View or BCMA for full text^"_$P(P("OPI"),"^",2) Q
"RTN","PSJBCMA5",116,0)
 ..I PSJTXTLN=1,($L($G(^PS(53.45,+PSJSYSP,6,1,0)))<61) S P("OPI")=^PS(53.45,+PSJSYSP,6,1,0)_"^"_$P(P("OPI"),"^",2) Q
"RTN","PSJBCMA5",117,0)
 ..N TXT,OPIMSG,PSJTMPTX,PSJOVRMX S OPIMSG="Instructions too long. See Order View or BCMA for full text."
"RTN","PSJBCMA5",118,0)
 ..S PSJTMPTX="",PSJOVRMX=0 S TMPLIN=0 F  S TMPLIN=$O(^PS(53.45,+PSJSYSP,6,TMPLIN)) Q:'TMPLIN!(PSJOVRMX)  D
"RTN","PSJBCMA5",119,0)
 ...S:($L(PSJTMPTX)+$L($G(^PS(53.45,+PSJSYSP,6,TMPLIN,0))))>60 PSJOVRMX=1 Q:$G(PSJOVRMX)  S PSJTMPTX=$G(PSJTMPTX)_$S($G(PSJTMPTX)]"":" ",1:"")_$G(^PS(53.45,+PSJSYSP,6,TMPLIN,0))
"RTN","PSJBCMA5",120,0)
 ..I '$G(PSJOVRMX),(PSJTMPTX]"") S P("OPI")=PSJTMPTX_"^"_$P(P("OPI"),"^",2)
"RTN","PSJBCMA5",121,0)
 K ^TMP("PSJTMPSI",$J)
"RTN","PSJBCMA5",122,0)
 Q PSJTXTLN
"RTN","PSJBCMA5",123,0)
 ;
"RTN","PSJBCMA5",124,0)
OPIWARN(AFTER) ; Warn user about OPI not printing on IV labels
"RTN","PSJBCMA5",125,0)
 D OPIWARN^PSJBCMA1(AFTER)
"RTN","PSJBCMA5",126,0)
 Q
"RTN","PSJBCMA5",127,0)
 ;
"RTN","PSJBCMA5",128,0)
FILESI(DFN,PSJORD) ; File Special instrctions from ^PS(53.45 to UD order
"RTN","PSJBCMA5",129,0)
 N LN,LNCNT,DA,DIE,X,Y,PSJTMPTX,TMPLIN,PSJOVRMX
"RTN","PSJBCMA5",130,0)
 D FILESI^PSJBCMA2(DFN,PSJORD)
"RTN","PSJBCMA5",131,0)
 K ^PS(53.45,+$G(PSJSYSP),5)
"RTN","PSJBCMA5",132,0)
 Q
"RTN","PSJBCMA5",133,0)
 ;
"RTN","PSJBCMA5",134,0)
FILEOPI(DFN,ORDER) ; File Other Print Info from ^PS(53.45 to IV order
"RTN","PSJBCMA5",135,0)
 N LN,LNCNT,PSJORD S PSJORD=ORDER
"RTN","PSJBCMA5",136,0)
 D FILEOPI^PSJBCMA2(DFN,ORDER)
"RTN","PSJBCMA5",137,0)
 K ^PS(53.45,+PSJSYSP,6)
"RTN","PSJBCMA5",138,0)
 Q
"RTN","PSJBCMA5",139,0)
 ;
"RTN","PSJBCMA5",140,0)
DIFFSI(DFN,PSJORD) ; Compare Special Instructions, pre and post edit
"RTN","PSJBCMA5",141,0)
 N LN,DIFF S DIFF=0
"RTN","PSJBCMA5",142,0)
 S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,5,LN)) Q:'LN!DIFF  D
"RTN","PSJBCMA5",143,0)
 .I PSJORD["U" D
"RTN","PSJBCMA5",144,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(55,DFN,5,+PSJORD,15,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,5,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",145,0)
 ..I $G(^PS(53.45,PSJSYSP,5,LN,0))'=$G(^PS(55,DFN,5,+PSJORD,15,LN,0)) S DIFF=1
"RTN","PSJBCMA5",146,0)
 .I PSJORD["P" D
"RTN","PSJBCMA5",147,0)
 ..I LN=1 N OTOT,NTNT S OTOT=+$O(^PS(53.1,+PSJORD,15,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,5,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",148,0)
 ..I $G(^PS(53.45,PSJSYSP,5,LN,0))'=$G(^PS(53.1,+PSJORD,15,LN,0)) S DIFF=1
"RTN","PSJBCMA5",149,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",150,0)
 ;
"RTN","PSJBCMA5",151,0)
DIFFOPI(DFN,PSJORD) ; Compare Other Print Info, pre and post edit
"RTN","PSJBCMA5",152,0)
 N LN,DIFF S DIFF=0
"RTN","PSJBCMA5",153,0)
 S LN=0 F  S LN=$O(^PS(53.45,PSJSYSP,6,LN)) Q:'LN!DIFF  D
"RTN","PSJBCMA5",154,0)
 .I PSJORD["V" D
"RTN","PSJBCMA5",155,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(55,DFN,"IV",+PSJORD,10,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,6,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",156,0)
 ..I $G(^PS(53.45,PSJSYSP,6,LN,0))'=$G(^PS(55,DFN,"IV",+PSJORD,10,LN,0)) S DIFF=1
"RTN","PSJBCMA5",157,0)
 .I PSJORD["P" D
"RTN","PSJBCMA5",158,0)
 ..I LN=1 N OTOT,NTOT S OTOT=+$O(^PS(53.1,+PSJORD,16,""),-1),NTOT=+$O(^PS(53.45,PSJSYSP,6,""),-1) I NTOT'=OTOT S DIFF=1 Q
"RTN","PSJBCMA5",159,0)
 ..I $G(^PS(53.45,PSJSYSP,6,LN,0))'=$G(^PS(53.1,+PSJORD,16,LN,0)) S DIFF=1
"RTN","PSJBCMA5",160,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",161,0)
 ;
"RTN","PSJBCMA5",162,0)
DIFFAR(ARRAY1,ARRAY2) ; Compare two text arrays
"RTN","PSJBCMA5",163,0)
 N LN,DIFF,OTOT,NTOT S DIFF=0,OTOT=0,NTOT=0
"RTN","PSJBCMA5",164,0)
 S LN=0 F  S LN=$O(ARRAY1(LN)) Q:'LN!DIFF  I ARRAY1(LN,0)'=$G(ARRAY2(LN,0)) S DIFF=1
"RTN","PSJBCMA5",165,0)
 Q $S(DIFF:1,1:0)
"RTN","PSJBCMA5",166,0)
 ;
"RTN","PSJBCMA5",167,0)
MVOPI(DFN,PSJI1,PSJI2) ; Move OPI from Non-Verified order to Active order during Verify
"RTN","PSJBCMA5",168,0)
 Q:'$G(DFN)!'$G(PSJI1)!'$G(PSJI2)
"RTN","PSJBCMA5",169,0)
 I PSJI1["P",PSJI2["V" D GETOPI(DFN,PSJI1),FILEOPI(DFN,PSJI2)
"RTN","PSJBCMA5",170,0)
 Q
"RTN","PSJBCMA5",171,0)
 ;
"RTN","PSJBCMA5",172,0)
MVOPIAL(DFN,PSJI1,PSJI2) ; Move Other Print Info Activity log entries from NV order to Active order, during Verification
"RTN","PSJBCMA5",173,0)
 D MVOPIAL^PSJBCMA1(DFN,PSJI1,PSJI2)
"RTN","PSJBCMA5",174,0)
 Q
"RTN","PSJBCMA5",175,0)
 ;
"RTN","PSJBCMA5",176,0)
KILL(USR) ; Clean up ^PS(53.45
"RTN","PSJBCMA5",177,0)
 K ^PS(53.45,+$G(USR),5),^PS(53.45,+$G(USR),6)
"RTN","PSJBCMA5",178,0)
 Q
"RTN","PSJBCMA5",179,0)
 ;
"RTN","PSJBCMA5",180,0)
PAUSE(DEF) ;
"RTN","PSJBCMA5",181,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue editing "_$G(DEF)_"...",DIR("?")="Press Return to continue..." D ^DIR W !
"RTN","PSJBCMA5",182,0)
 Q
"RTN","PSJBCMA5",183,0)
 ;
"RTN","PSJBCMA5",184,0)
DONE(DEF) ; -- Done editing?
"RTN","PSJBCMA5",185,0)
 N DIR,X,Y
"RTN","PSJBCMA5",186,0)
 S DIR(0)="YA",DIR("A")="Do you want to quit and discard changes"_$S(($G(DEF)]""):" to "_DEF,1:"")_"? ",DIR("B")="NO"
"RTN","PSJBCMA5",187,0)
 S DIR("?",1)="    Enter YES to exit without saving changes, or ",DIR("?")="    enter NO to continue editing "_$S(($G(DEF)]""):DEF,1:"")_"."
"RTN","PSJBCMA5",188,0)
 D ^DIR
"RTN","PSJBCMA5",189,0)
 Q $S($E(Y)="^":1,1:+Y)
"RTN","PSJCLOR")
0^1^B135035264^n/a
"RTN","PSJCLOR",1,0)
PSJCLOR ;BIR/JCH - FIND ORDERS BY CLINIC, CLINIC GROUP, OR PATIENT ; 2/28/12 9:11am
"RTN","PSJCLOR",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**275**;DEC 16, 1997;Build 157
"RTN","PSJCLOR",3,0)
 ;
"RTN","PSJCLOR",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSJCLOR",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177
"RTN","PSJCLOR",6,0)
 ; Reference to ^DPT is supported by DBIA #10035
"RTN","PSJCLOR",7,0)
 ;
"RTN","PSJCLOR",8,0)
 N PSJNEW,PSGPTMP,PPAGE,CL,CG S PSJNEW=1
"RTN","PSJCLOR",9,0)
START ; Lookup patient by clinic or patient, depending on value of PSGSS
"RTN","PSJCLOR",10,0)
 ; 
"RTN","PSJCLOR",11,0)
 N PSJTOO,PSJPAC,PSJBEG,PSJEND,PSGOEAV,PSJTMPED,PSJTMPBG,PSJCLOR,PSGSS S PSJTOO=3,PSJPAC=3,PSJCLOR=1,PSGSS=""
"RTN","PSJCLOR",12,0)
 D ENCV^PSGSETU I $D(XQUIT) K XQUIT Q
"RTN","PSJCLOR",13,0)
 D ^PSIVXU I $D(XQUIT) K XQUIT Q
"RTN","PSJCLOR",14,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSJCLOR",15,0)
 K ^TMP("PSJ",$J) S PSGPXN=0 L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE
"RTN","PSJCLOR",16,0)
 S PSGSSH="VBW",PSGPXN=0,PSJPROT=$S($P(PSJSYSU,";",3)=3:3,1:1)
"RTN","PSJCLOR",17,0)
 S PSGVBWW="ACTIVE AND/OR NON-VERIFIED"
"RTN","PSJCLOR",18,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJCLOR",19,0)
 F  Q:(PSGSS="^")  S PSJVALQ=0 Q:'$$DTRANGE  F  K ^TMP("PSJSELECT",$J) D SELECT Q:(PSGSS["^")!(PSGSS="")  F  S (PSGP,WD,WG)=0 S PSGPTMP=0,PPAGE=1 K PSGPRIF D @PSGSS Q:+Y'>0  D GO
"RTN","PSJCLOR",20,0)
 ;
"RTN","PSJCLOR",21,0)
DONE ; Cleanup
"RTN","PSJCLOR",22,0)
 D DONE2
"RTN","PSJCLOR",23,0)
 K SETWDN,PTPRI,SETTM,SETPN,SUBS,TMPWD,STATUS,X1,X2,PSJBEG,PSJEND
"RTN","PSJCLOR",24,0)
 K CHK,D0,DRGI,FQC,J,ND,ON,PN,PSGODT,PSGOEA,PSGOP,PSGSS,PSGSSH,RB,SD,ST,TM,WD,WDN,WG,PRI,PSJPNV,PSJCT,PSGCLF,PSGPRIF,LIDT,WDNAME,IFPRI
"RTN","PSJCLOR",25,0)
 K PSGODDD,PSGOEORF,PSJORL,PSJORPCL,PSJORTOU,PSJORVP,PSGTOL,PSJTOO,PSGUOW,PSGONV,PX,PSGOEAV,PSGPX,PSGVBWTO,PSGVBWW,PSJOPC,PSGOENOF,PSJPROT,PSJLM,PSJASK
"RTN","PSJCLOR",26,0)
 K PSJPAC,PSJINDEX,PSJCNT,PSIVSN,PSGWORP1,PSGWORP2,PSGVBY,PSGVBWN,PSGVBTM,PSGVBPN,PSGPRIN,PSGPRD,PSGINWD,PSGINCL,PRDON,PRDNS,PRD,PPN,ORDT
"RTN","PSJCLOR",27,0)
 K %,DTOUT,DUOUT,ND0,PSGSS2,PSGDT,PSJNV,PSJPBID,PSJPAD,%Y,IOP,POP,PSGDICA,PSGH,PSJEXTP,PSJH,PSJHDATE,PSJPAD
"RTN","PSJCLOR",28,0)
 K PSJPAGE,PSJPBID,PSJPCAF,PSJPDD,PSJPDOB,PSJPDX,PSJPPID,PSJPRB,PSJPSEX,PSJPSSN,PSJPTD,PSJPTS,PSJPTSP,PSJPWD,PSJPWDN
"RTN","PSJCLOR",29,0)
 K XQORNOD,XRT0,XRTL,XRTN,ZTSAVE,WRD,WS,TYPE,TMPSEL,TMPNEWSD,TMPDT,TMPCNT,TMPAT,SWD,STOP,STAST,SORT,SM,SEQ,SDW,SCH,RTE,RSLT,RNDT,QX,PSOC,PSJX,PSJVALQ
"RTN","PSJCLOR",30,0)
 K PSJTEAM,PSJPSTO,PSJPINIT,PSJORIFN,PSJORF,PSJORD,PSJONTMP,PSJOL,PSJOCL,PSJO,PSJNOO,PSJMSG,PSJLOOP,PSJLMX,PSJLACT,PSJIVORF,PSJHLMTN,PSJDB,PSJDAY,PSJCOUNT
"RTN","PSJCLOR",31,0)
 K PSJCLIN,PSJBLOOP,PSJBLN,PSJBCID,PSJACNWP,PSJ,PSIVUP,PSIVTYPE,PSIVSTRT,PSIVITE,PSIVRT,PSIVRP,PSIVREA,PSIVPR,PSIVPL,PSIVNOW,PSIVLN,PSIVLIM,PSIVC,PSIVACT
"RTN","PSJCLOR",32,0)
 K PSIVAC,PSGVALG,PSGVADR,PSGSTAT,PSGST,PSGSM,PSGSDN,PSGSCH,PSGS0XT,PSGPRN,PSGPR,PSGPENWS,PSGPEN,PSGPDN,PSGPD,PSGOSTN,PSGOST,PSGOSM,PSGOSI,PSGOSDN,PSGOSCH
"RTN","PSJCLOR",33,0)
 K PSGORD,PSGOPRN,PSGPR,PSGOPDN,PSGOPD,PSGOORD,PSGOMRN,PSGOMR,PSGOL,PSGOINST,PSGOHSM,PSGOFDN,PSGOEPR,PSGOEEWF,PSGOEENO,PSGOEE,PSGODO,PSGOC,PSGOAT,PSGNEFDO
"RTN","PSJCLOR",34,0)
 K PSGLRN,PSGLI,PSGFDX,PSGDFN,PSGF2,PSGEBN,PSGEB,PSGDW,PSGCANFL,PSGAL,PSBSTR,PSBFLAG,PSBCNT,P,PDRG,ORO,OD,OCXSEG,NF,NDP2,ND6,ND4,ND14
"RTN","PSJCLOR",35,0)
 L -^PS(53.45,PSJSYSP) G:$G(PSGPXN) ^PSGPER1 D ENKV^PSGSETU K ND,PSGPXN Q
"RTN","PSJCLOR",36,0)
 ;
"RTN","PSJCLOR",37,0)
DONE2 ; Partial Cleanup
"RTN","PSJCLOR",38,0)
 K ^TMP("PSGVBW",$J),^TMP("PSGVBW2",$J),^TMP("PSGVBW3",$J),^TMP("PSJSELECT",$J),^TMP("PSJLIST",$J),^TMP("PSJON",$J)
"RTN","PSJCLOR",39,0)
 K PRD,PSJL,DFN,PSGP
"RTN","PSJCLOR",40,0)
 Q
"RTN","PSJCLOR",41,0)
 ;
"RTN","PSJCLOR",42,0)
GO ; Find and display matching patients
"RTN","PSJCLOR",43,0)
 I PSGSS'="P" W !,"...a few moments, please..." K ^TMP("PSGVBW",$J),^TMP("PSGVBW2",$J) D ARRAY K CHK,ON,PN,RB,SD,TM,WD,WDN,WG,X,Y
"RTN","PSJCLOR",44,0)
 I PSGSS'="P",'$D(^TMP("PSGVBW",$J)) W !,$C(7),"NO ",PSGVBWW," ORDERS FOR SELECTED ",$S(PSGSS="P":"PATIENT",PSGSS="L":"CLINIC GROUP",PSGSS="C":"CLINIC",PSGSS="PR":"PRIORITY",1:"WARD"),$S(PSGSS="G":" GROUP",1:"") Q
"RTN","PSJCLOR",45,0)
 D ^PSJCLOR1,DONE2 Q
"RTN","PSJCLOR",46,0)
 ;
"RTN","PSJCLOR",47,0)
C ; Select a Clinic
"RTN","PSJCLOR",48,0)
 K CL,DIC,PSJCLNAR,PSJCDONE
"RTN","PSJCLOR",49,0)
 F  Q:$G(PSJCDONE)  K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: ",DIR("?")="^D ENCD^PSJCLOR" W ! D ^DIR S:$G(DUOUT) PSJCDONE=2 S:(Y="") PSJCDONE=1 D CDIC
"RTN","PSJCLOR",50,0)
 Q
"RTN","PSJCLOR",51,0)
CDIC ; Clinic lookup
"RTN","PSJCLOR",52,0)
 I $G(PSJCDONE) S:($O(PSJCLNAR(0))&'$G(DUOUT)) Y=+$O(PSJCLNAR(0)) Q
"RTN","PSJCLOR",53,0)
 S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC I Y>0 S CL=+Y,PSJCLNAR(+Y)=""
"RTN","PSJCLOR",54,0)
 I Y="" S PSJCDONE=1 Q
"RTN","PSJCLOR",55,0)
 I $G(DTOUT)!$G(DUTOUT) S PSJCDONE=1 Q
"RTN","PSJCLOR",56,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSJCLOR",57,0)
 I '$G(DUOUT),($G(Y)<0),($G(X)'="") S X="?"
"RTN","PSJCLOR",58,0)
 I X["?" W !!,"Enter the name of the clinic to use to select patients for processing." G C
"RTN","PSJCLOR",59,0)
 Q:'$G(CL)
"RTN","PSJCLOR",60,0)
DTRANGE() ; Enter Date Range
"RTN","PSJCLOR",61,0)
 K PSJBEG,PSJEND
"RTN","PSJCLOR",62,0)
 D BEGDT I ($G(PSJBEG)<1) S Y=0 Q 0
"RTN","PSJCLOR",63,0)
 D ENDDT(PSJBEG) I ($G(PSJEND)<1) S Y=0 Q 0
"RTN","PSJCLOR",64,0)
 Q Y
"RTN","PSJCLOR",65,0)
BEGDT ; begin date
"RTN","PSJCLOR",66,0)
 W !!?5,"Search for Active and Non-Verified CLINIC Medication Orders"
"RTN","PSJCLOR",67,0)
 W !?5,"that fall within the date range selected below: "
"RTN","PSJCLOR",68,0)
 W ! K %DT S %DT("A")="Begin Search Date: ",%DT="TAE",%DT("B")="TODAY"
"RTN","PSJCLOR",69,0)
 D ^%DT Q:Y<0!($D(DTOUT))  S (%DT(0),PSJBEG,PSJTMPBG)=Y
"RTN","PSJCLOR",70,0)
 N YRONLY,FMTX S YRONLY=+$G(PSJBEG) I $L(YRONLY)=7 S:'$E(YRONLY,4,5) $E(YRONLY,4,5)="01" S:'$E(YRONLY,6,7) $E(YRONLY,6,7)="01" S PSJBEG=YRONLY S FMTX=$$FMTE^XLFDT(PSJBEG,1) W " ",FMTX
"RTN","PSJCLOR",71,0)
 Q
"RTN","PSJCLOR",72,0)
ENDDT(BEG) ; end date
"RTN","PSJCLOR",73,0)
 N YRONLY,FMTX
"RTN","PSJCLOR",74,0)
 W ! K DIR S DIR(0)="DA^"_BEG_"::TAE",DIR("A")="End Search Date: ",DIR("B")=$P($$FMTE^XLFDT(BEG,1),"@") D ^DIR
"RTN","PSJCLOR",75,0)
 S PSJEND=$S($G(Y):Y,1:BEG) I '$P(PSJEND,".",2) S PSJEND=Y_".24",PSJTMPED=PSJEND
"RTN","PSJCLOR",76,0)
 I '$E(PSJEND,4,7) S YRONLY=+$G(PSJEND) S:'$E(YRONLY,4,5) $E(YRONLY,4,5)="01" S:'$E(YRONLY,6,7) $E(YRONLY,6,7)="01" D
"RTN","PSJCLOR",77,0)
 .S PSJEND=YRONLY S FMTX=$$FMTE^XLFDT(PSJEND,1) W " ",FMTX
"RTN","PSJCLOR",78,0)
 Q
"RTN","PSJCLOR",79,0)
L ; Select a Clinic Group
"RTN","PSJCLOR",80,0)
 K DIR,PSJCLNAR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSJCLOR",81,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSJCLOR",82,0)
LDIC ; Clinic Group lookup
"RTN","PSJCLOR",83,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y
"RTN","PSJCLOR",84,0)
 I $G(CG) N TMPCNT,TMPCL S TMPCNT=0 F  S TMPCNT=$O(^PS(57.8,+CG,1,TMPCNT)) Q:'TMPCNT  S TMPCL=$G(^(TMPCNT,0)) I TMPCL S PSJCLNAR(TMPCL)=""
"RTN","PSJCLOR",85,0)
 I '$G(DUOUT),($G(Y)<0),($G(X)'="") S X="?"
"RTN","PSJCLOR",86,0)
 I X["?" W !!,"Enter the name of the clinic group to use to select patients for processing." G L
"RTN","PSJCLOR",87,0)
 Q
"RTN","PSJCLOR",88,0)
P ; Select patient
"RTN","PSJCLOR",89,0)
 N PSJCLNAR,STOPD,TMPSTRT,ON2,BEGDTR,ENDTR,PSJSTAT S (PSJBEG,BEGDTR)=$S($G(PSJBEG):PSJBEG,1:$$FMADD^XLFDT(PSGDT,-365)),(PSJEND,ENDTR)=$S($G(PSJEND):PSJEND,1:$$FMADD^XLFDT(PSGDT,365)) S PSJCLNAR=""
"RTN","PSJCLOR",90,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1 F  D ^PSJP Q:PSGP<0  D
"RTN","PSJCLOR",91,0)
 .I $G(PSJTMPBG)&$G(PSJTMPED) S PSJBEG=+PSJTMPBG,PSJEND=+PSJTMPED K PSJTMPBG,PSJTMPED
"RTN","PSJCLOR",92,0)
 .S PSJNV=0 Q:$D(^TMP("PSJSELECT",$J,"C",PSGP))
"RTN","PSJCLOR",93,0)
 .NEW ON,XX S ON=0 F  S ON=$O(^PS(53.1,"AS","N",PSGP,ON)) Q:'ON!$G(PSJNV)  D
"RTN","PSJCLOR",94,0)
 ..N TMPSTRT,TMPSTP S TMPSTRT=$P($G(^PS(53.1,+ON,2)),"^",2) Q:(TMPSTRT>PSJEND)  S TMPSTP=$P($G(^PS(53.1,+ON,2)),"^",4) Q:(TMPSTP<PSJBEG)
"RTN","PSJCLOR",95,0)
 ..N ND S ND=$G(^PS(53.1,+ON,0)) Q:((",D,E,")[(","_($E($P(ND,"^",9)))_","))  S PSJNV=+$G(^PS(53.1,ON,"DSS"))
"RTN","PSJCLOR",96,0)
 .I 'PSJNV D ^PSJAC D
"RTN","PSJCLOR",97,0)
 ..I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSJCLOR",98,0)
 ..S STOPD=PSGDT F  S STOPD=$O(^PS(55,"AUDC",STOPD)) Q:'STOPD!$G(PSJNV)  S CL=0 F  S CL=$O(^PS(55,"AUDC",STOPD,CL)) Q:'CL!$G(PSJNV)  S ON2=0 F  S ON2=$O(^PS(55,"AUDC",STOPD,CL,PSGP,ON2)) Q:'ON2!$G(PSJNV)  D
"RTN","PSJCLOR",99,0)
 ...N ND S ND=$G(^PS(55,PSGP,5,+ON2,0)) S TMPSTRT=$P($G(^PS(55,PSGP,5,+ON2,2)),"^",2) Q:(TMPSTRT>ENDTR)!'$P(^PS(55,PSGP,5,+ON2,8),"^",2)
"RTN","PSJCLOR",100,0)
 ...Q:((",D,E,")[(","_($E($P(ND,"^",9)))_","))  S ON=+$G(ON2)_"U" S PSJNV=CL
"RTN","PSJCLOR",101,0)
 ..S SD=$$FMADD^XLFDT(PSJBEG,,,-1) F  S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  D
"RTN","PSJCLOR",102,0)
 ...F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  S PSJSTAT=$P($G(^PS(55,PSGP,"IV",ON,0)),"^",17) I (",E,D,")'[(","_$E(PSJSTAT)_",") D IFT2 Q
"RTN","PSJCLOR",103,0)
 .I PSJNV D ^PSJAC,SET S PN=$G(PSGP(0))_U_PSGP_U_PSJPBID S ^TMP("PSJSELECT",$J,PSJCNT)=PN,^TMP("PSJSELECT",$J,"B",$P(PN,U),PSJCNT)="",PSJCNT=PSJCNT+1,^TMP("PSJSELECT",$J,"C",+PSGP)="" Q
"RTN","PSJCLOR",104,0)
 .W !!?3,"No ",PSGVBWW," Clinic Orders found for this patient."
"RTN","PSJCLOR",105,0)
 S:$D(^TMP("PSJSELECT",$J)) Y=1
"RTN","PSJCLOR",106,0)
 I $G(PSJTMPBG)&$G(PSJTMPED) S PSJBEG=+PSJTMPBG,PSJEND=+PSJTMPED K PSJTMPBG,PSJTMPED
"RTN","PSJCLOR",107,0)
 Q
"RTN","PSJCLOR",108,0)
ARRAY ; put patient(s) with non-verified orders into array
"RTN","PSJCLOR",109,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSJCLOR",110,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),PSGVBWW="ACTIVE AND/OR NON-VERIFIED" I PSGSS="P" D IF S:$T ^TMP("PSGVBW",$J)=$P(PSGP(0),"^")_"^"_PSGP Q
"RTN","PSJCLOR",111,0)
 G CL:PSGSS="C"
"RTN","PSJCLOR",112,0)
 G CG:PSGSS="L"
"RTN","PSJCLOR",113,0)
 Q
"RTN","PSJCLOR",114,0)
CG ; Find all clinics in selected clinic group
"RTN","PSJCLOR",115,0)
 S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D CL
"RTN","PSJCLOR",116,0)
 Q
"RTN","PSJCLOR",117,0)
CL ; Find all patients in selected clinic
"RTN","PSJCLOR",118,0)
 N BEGDTR,ENDTR,STOPD,ON2,TMPSTRT,TMPSTOP S BEGDTR=$$FMADD^XLFDT(PSJBEG,,-1),ENDTR=$$FMADD^XLFDT(PSJEND,,1)
"RTN","PSJCLOR",119,0)
 I PSGSS="C" D  Q
"RTN","PSJCLOR",120,0)
 .S CL="" F  S CL=$O(PSJCLNAR(CL)) Q:CL=""  D CL1 I $G(CL) N CLINAME S CLINAME=$P($G(^SC(+$G(CL),0)),"^") Q:CLINAME=""  D
"RTN","PSJCLOR",121,0)
 ..N I,J S (I,J)="" F  S I=$O(PSJCLNAR(I)) Q:'I  S J=J+1
"RTN","PSJCLOR",122,0)
 ..I (J>1),'$D(^TMP("PSGVBW",$J,CLINAME)) W !!,$C(7),"NO ",PSGVBWW," ORDERS FOR ",CLINAME,! D CONT^PSJOE0
"RTN","PSJCLOR",123,0)
 I PSGSS="L" D CL1
"RTN","PSJCLOR",124,0)
 Q
"RTN","PSJCLOR",125,0)
CL1 ; Check each clinic for valid clinic orders
"RTN","PSJCLOR",126,0)
 S WDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSJCLOR",127,0)
 S PSGP="",PSGCLF=1 F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:PSGP=""  D ^PSJAC,IF
"RTN","PSJCLOR",128,0)
 S STOPD=PSGDT F  S STOPD=$O(^PS(55,"AUDC",STOPD)) Q:'STOPD  S PSGP=0 F  S PSGP=$O(^PS(55,"AUDC",STOPD,CL,PSGP)) Q:'PSGP  S ON2=0 F  S ON2=$O(^PS(55,"AUDC",STOPD,CL,PSGP,ON2)) Q:'ON2  D
"RTN","PSJCLOR",129,0)
 .S TMPSTRT=$P($G(^PS(55,PSGP,5,+ON2,2)),"^",2),TMPSTOP=$P($G(^PS(55,PSGP,5,+ON2,2)),"^",4)
"RTN","PSJCLOR",130,0)
 .I TMPSTRT<ENDTR,(TMPSTOP>BEGDTR) Q:$E($P($G(^PS(55,PSGP,5,+ON2,0)),"^",9))="D"  S ON=+$G(ON2)_"U" D ^PSJAC,SET
"RTN","PSJCLOR",131,0)
 S STOPD=PSGDT F  S STOPD=$O(^PS(55,"AIVC",STOPD)) Q:'STOPD  S PSGP=0 F  S PSGP=$O(^PS(55,"AIVC",STOPD,CL,PSGP)) Q:'PSGP  S ON2=0 F  S ON2=$O(^PS(55,"AIVC",STOPD,CL,PSGP,ON2)) Q:'ON2  D
"RTN","PSJCLOR",132,0)
 .S TMPSTRT=$P($G(^PS(55,PSGP,"IV",+ON2,0)),"^",2),TMPSTOP=$P($G(^PS(55,PSGP,"IV",+ON2,0)),"^",3)
"RTN","PSJCLOR",133,0)
 .I TMPSTRT<ENDTR,(TMPSTOP>BEGDTR) Q:$E($P($G(^PS(55,PSGP,"IV",+ON2,0)),"^",17))="D"  S ON=+$G(ON2)_"V" D ^PSJAC,SET
"RTN","PSJCLOR",134,0)
 K PSGCLF,TMPSTRT
"RTN","PSJCLOR",135,0)
 Q
"RTN","PSJCLOR",136,0)
IF ; If called from CL subroutine and the order Doesn't exist for that Clinic, then QUIT.
"RTN","PSJCLOR",137,0)
 N PSJSTAT,ON2
"RTN","PSJCLOR",138,0)
 I $D(^PS(53.1,"AS","N",PSGP)) NEW XX S XX=0 S ON2=0 F  S ON2=$O(^PS(53.1,"AS","N",PSGP,ON2)) Q:'ON2  N CLIN S CLIN=+$G(^PS(53.1,+$G(ON2),"DSS")) Q:'CLIN   D
"RTN","PSJCLOR",139,0)
 .S XX=$S(PSGSS'="P"&$D(PSJCLNAR(+CLIN)):CLIN,1:CLIN) S ND=$P($G(^PS(53.1,ON2,0)),U,4),TMPSTRT=$P($G(^PS(53.1,ON2,2)),U,2),TMPSTP=$P($G(^PS(53.1,ON2,2)),U,4) I $G(XX) D
"RTN","PSJCLOR",140,0)
 ..Q:TMPSTRT>$S($G(ENDTR):ENDTR,1:$G(PSJEND))  Q:TMPSTP<$S($G(BEGDTR):BEGDTR,1:$G(PSJBEG))
"RTN","PSJCLOR",141,0)
 ..S PSJSTAT=$P($G(^PS(53.1,ON2,0)),"^",9) Q:PSJSTAT'="N"
"RTN","PSJCLOR",142,0)
 ..N ON S ON=ON2_"P" D ^PSJAC,SET
"RTN","PSJCLOR",143,0)
 S PSGODT=$P(PSJBEG,".")
"RTN","PSJCLOR",144,0)
 I PSJPAC'=2 F ST="C","O","OC","P","R" S SD=PSGODT F  S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  S ON2=0 F  S ON2=$O(^PS(55,PSGP,5,"AU",ST,SD,ON2)) Q:'ON2  S PSJSTAT=$P($G(^PS(55,PSGP,5,ON2,0)),"^",9) D
"RTN","PSJCLOR",145,0)
 .I (PSJSTAT]"")&((",D,E,"'[(","_$E(PSJSTAT)_","))) S ON=ON2_"U" D SET
"RTN","PSJCLOR",146,0)
 ;*PSJ*5*241:Expired IV orders must be one-time
"RTN","PSJCLOR",147,0)
 I PSJPAC'=1 S SD=$$FMADD^XLFDT(PSJBEG,,,-1) F  S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  S ON2=0 F  S ON2=$O(^PS(55,PSGP,"IV","AIS",SD,ON2)) Q:'ON2  D
"RTN","PSJCLOR",148,0)
 .N SCH,STYPE S STYPE=0,SCH=$P($G(^PS(55,PSGP,"IV",ON2,0)),U,9)
"RTN","PSJCLOR",149,0)
 .S:SCH]"" SCH=$O(^PS(51.1,"APPSJ",SCH,STYPE)) S:SCH]"" STYPE=$P($G(^PS(51.1,SCH,0)),U,5)
"RTN","PSJCLOR",150,0)
 .S PSJSTAT=$P($G(^PS(55,PSGP,"IV",+ON2,0)),"^",17)
"RTN","PSJCLOR",151,0)
 .I ",D,E,"'[(","_$E(PSJSTAT)_",") I ($G(STYPE)'="O") S ON=ON2_"V" D IFT2,SET
"RTN","PSJCLOR",152,0)
 K TMPSTRT
"RTN","PSJCLOR",153,0)
 Q
"RTN","PSJCLOR",154,0)
IFT2 ; Loop through active IV orders in ^PS(55
"RTN","PSJCLOR",155,0)
 N CL,TMPSTRT,TMPSTP S CL=+$G(^PS(55,+$G(PSGP),"IV",+$G(ON),"DSS"))
"RTN","PSJCLOR",156,0)
 S ND0=$G(^PS(55,PSGP,"IV",+ON,0)) S TMPSTRT=$P(ND0,"^",2),TMPSTP=$P(ND0,"^",3) Q:((TMPSTRT>PSJEND)!(TMPSTP<PSJBEG))
"RTN","PSJCLOR",157,0)
 Q:((",D,E,")[(","_($E($P(ND0,"^",17)))_","))
"RTN","PSJCLOR",158,0)
 S PSJNV=CL
"RTN","PSJCLOR",159,0)
 Q
"RTN","PSJCLOR",160,0)
SET ; Set patient specific variables for ^TMP subscripts
"RTN","PSJCLOR",161,0)
 K DIC,X,Y,WDNAME,TMPWD
"RTN","PSJCLOR",162,0)
 N PSJSTAT,TMPSTRT,TMPSTP S TMPSTRT=$S($G(ON)["P":$P($G(^PS(53.1,ON,2)),U,2),$G(ON)["U":$P($G(^PS(55,PSGP,5,+ON,2)),"^",2),$G(ON)["V":$P($G(^PS(55,PSGP,"IV",+ON,0)),"^",2),1:"")
"RTN","PSJCLOR",163,0)
 S TMPSTP=$S($G(ON)["P":$P($G(^PS(53.1,+ON,2)),U,4),$G(ON)["U":$P($G(^PS(55,PSGP,5,+ON,2)),"^",4),$G(ON)["V":$P($G(^PS(55,PSGP,"IV",+ON,0)),"^",3),1:"")
"RTN","PSJCLOR",164,0)
 Q:TMPSTRT>$S($G(ENDTR):ENDTR,1:$G(PSJEND))  Q:TMPSTP<$S($G(BEGDTR):BEGDTR,1:$G(PSJBEG))
"RTN","PSJCLOR",165,0)
 S PSJSTAT=$S($G(ON)["P":$P($G(^PS(53.1,+ON,0)),"^",9),$G(ON)["U":$P($G(^PS(55,PSGP,5,+ON,0)),"^",9),$G(ON)["V":$P($G(^PS(55,PSGP,"IV",+ON,0)),"^",17),1:"")
"RTN","PSJCLOR",166,0)
 Q:PSJSTAT=""  Q:(",D,E,")[(","_$E(PSJSTAT)_",")
"RTN","PSJCLOR",167,0)
 S X=$S($G(ON)["P":$G(^PS(53.1,+ON,"DSS")),$G(ON)["U":$G(^PS(55,PSGP,5,+ON,8)),$G(ON)["V":$G(^PS(55,PSGP,"IV",+ON,"DSS")),1:"")
"RTN","PSJCLOR",168,0)
 Q:'X  Q:'$P(X,"^",2)  S X=+X
"RTN","PSJCLOR",169,0)
 S X="`"_+X,DIC="^SC(",DIC(0)="BOXZ" D ^DIC S TMPWD=+Y,(WDN,WDNAME)=$P(Y,"^",2)
"RTN","PSJCLOR",170,0)
 I $G(PSGSS)'="P",$G(TMPWD),'$D(PSJCLNAR(+TMPWD)) Q
"RTN","PSJCLOR",171,0)
 S TM=$S(PSJPRB="":"",1:$P($G(^PS(57.7,TMPWD,1,+$O(^PS(57.7,"AWRT",TMPWD,PSJPRB,0)),0)),"^")) S:TM="" TM="zz"
"RTN","PSJCLOR",172,0)
SETPN ; If searching for specific priority:
"RTN","PSJCLOR",173,0)
 ;            -  set patient into ^TMP("PSGBW" sorted by Clnic, Patient Name^IEN^SSN
"RTN","PSJCLOR",174,0)
 ; If not searching for specific priority:
"RTN","PSJCLOR",175,0)
 ;            - set patient into ^TMP("PSGVBW2" sorted by 'Patient Name^IEN^SSN',
"RTN","PSJCLOR",176,0)
 ;            - set patient into ^TMP("PSGVBW3" sorted by Patient IEN
"RTN","PSJCLOR",177,0)
 S PN=$P(PSGP(0),"^")_U_PSGP_U_PSJPBID
"RTN","PSJCLOR",178,0)
 S ^TMP("PSGVBW",$J,WDN,1,TM,PN)=$S($G(TMPWD):TMPWD,1:"")
"RTN","PSJCLOR",179,0)
 S ^TMP("PSGVBW2",$J,PN,1)=WDN_"^"_TM,^TMP("PSGVBW3",$J,WDN,+PSGP)=TMPWD
"RTN","PSJCLOR",180,0)
 Q
"RTN","PSJCLOR",181,0)
SET2 ; If not searching for a specific priority,find the highest priority order associated with patient. 
"RTN","PSJCLOR",182,0)
 ; Set the patient into ^TMP("PSGVBW" sorted by highest Priority Name, Priority #, Team, Patient Name^IEN^SSN
"RTN","PSJCLOR",183,0)
 S SETPN="" F  S SETPN=$O(^TMP("PSGVBW2",$J,SETPN)) Q:SETPN=""  D
"RTN","PSJCLOR",184,0)
 .S PTPRI=$O(^TMP("PSGVBW2",$J,SETPN,0)) Q:'$G(PTPRI)
"RTN","PSJCLOR",185,0)
 .S SUBS=$G(^TMP("PSGVBW2",$J,SETPN,PTPRI)),SETWDN=$P(SUBS,"^"),SETTM=$P(SUBS,"^",2) Q:SETWDN=""!(SETTM="")
"RTN","PSJCLOR",186,0)
 .S ^TMP("PSGVBW",$J,SETWDN,1,SETTM,SETPN)=""
"RTN","PSJCLOR",187,0)
 K ^TMP("PSGVBW2",$J)
"RTN","PSJCLOR",188,0)
 Q
"RTN","PSJCLOR",189,0)
 ;
"RTN","PSJCLOR",190,0)
EXIT(X) ; Generic user error message
"RTN","PSJCLOR",191,0)
 W !!,X," not selected, option terminated."
"RTN","PSJCLOR",192,0)
 Q
"RTN","PSJCLOR",193,0)
 ;
"RTN","PSJCLOR",194,0)
SELECT ; give user choice to select search method
"RTN","PSJCLOR",195,0)
 S PSJVALQ=0
"RTN","PSJCLOR",196,0)
 S:'$D(PSGSSH) PSGSSH="GENERIC"
"RTN","PSJCLOR",197,0)
 ;
"RTN","PSJCLOR",198,0)
 N PSJCLNAR
"RTN","PSJCLOR",199,0)
 F  W !!,"Search by CLINIC (C), CLINIC GROUP (G), or PATIENT (P) : " R PSGSS:DTIME W:'$T $C(7) S:'$T!(PSGSS="") PSGSS="^" Q:"^"[PSGSS  D CHK I ",C,P,L,"[(","_PSGSS_",") Q
"RTN","PSJCLOR",200,0)
 ;
"RTN","PSJCLOR",201,0)
 K PSGSSA Q
"RTN","PSJCLOR",202,0)
 ;
"RTN","PSJCLOR",203,0)
CHK ;
"RTN","PSJCLOR",204,0)
 N Q
"RTN","PSJCLOR",205,0)
 S PSGSSA="" F Q=1:1:$L(PSGSS) S PSGSSA=PSGSSA_$S($E(PSGSS,Q)'?1L:$E(PSGSS,Q),1:$C($A(PSGSS,Q)-32))
"RTN","PSJCLOR",206,0)
 F X="CLINIC","PATIENT","GROUP" I $P(X,PSGSSA)="" W $P(X,PSGSSA,2,99) S PSGSS=$S(($E(PSGSSA)="G"):"L",1:$E(PSGSSA)) Q
"RTN","PSJCLOR",207,0)
 Q:$T  I PSGSS'?1."?" W $C(7),"  ??" S PSGSS="Z" Q
"RTN","PSJCLOR",208,0)
 W ! D @PSGSSH W !!?2,"To leave this option, press the RETURN key or enter '^'." Q
"RTN","PSJCLOR",209,0)
 ;
"RTN","PSJCLOR",210,0)
CHK2 ;
"RTN","PSJCLOR",211,0)
 N Q
"RTN","PSJCLOR",212,0)
 S PSGSSA="" F Q=1:1:$L(PSGSS2) S PSGSSA=PSGSSA_$S($E(PSGSS2,Q)'?1L:$E(PSGSS2,Q),1:$C($A(PSGSS2,Q)-32))
"RTN","PSJCLOR",213,0)
 F X="WARD","CLINIC","GROUP" I $P(X,PSGSSA)="" W $P(X,PSGSSA,2,99) S PSGSS2=$S(($E(PSGSSA)="G"):"L",1:$E(PSGSSA)) Q
"RTN","PSJCLOR",214,0)
 Q:$T  I PSGSS2'?1."?" W $C(7),"  ??" S PSGSS2="Z" Q
"RTN","PSJCLOR",215,0)
 W ! D @PSGSSH W !!?2,"To leave this option, press the RETURN key or enter  '^'." Q
"RTN","PSJCLOR",216,0)
 ;
"RTN","PSJCLOR",217,0)
HELP ; the following are the help text messages for the various options
"RTN","PSJCLOR",218,0)
 ;
"RTN","PSJCLOR",219,0)
GENERIC W !!,?2,"To run this option for an entire CLINIC, enter 'C'.  To run this option for a single PATIENT, enter 'P'." Q
"RTN","PSJCLOR",220,0)
 ;
"RTN","PSJCLOR",221,0)
VBW W !!?2,"To process orders in a single CLINIC, enter 'C'."
"RTN","PSJCLOR",222,0)
 W !,"To process orders for a single PATIENT, enter 'P'."
"RTN","PSJCLOR",223,0)
 Q
"RTN","PSJCLOR",224,0)
 ;
"RTN","PSJCLOR",225,0)
ENCD ;edit Clinic Definitions file
"RTN","PSJCLOR",226,0)
 I X["?" W !,"Enter a clinic from the CLINIC DEFINITION file."
"RTN","PSJCLOR",227,0)
 K DIC S DIC="^PS(53.46,",DIC(0)="QEMIZ" D ^DIC K DIC ; S:(Y>0) Y=+$G(^PS(53.46,+Y,0))
"RTN","PSJCLOR",228,0)
 W !,"You may also select a clinic from the HOSPITAL LOCATION file."
"RTN","PSJCLOR",229,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC
"RTN","PSJCLOR",230,0)
 Q
"RTN","PSJCLOR1")
0^2^B61599186^n/a
"RTN","PSJCLOR1",1,0)
PSJCLOR1 ;BIR/JCH - SHOW NON-VERFIED CLINIC ORDERS GATHERED IN PSJCLOR1 ; 2/28/12 9:11am
"RTN","PSJCLOR1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**275**;DEC 16, 1997;Build 157
"RTN","PSJCLOR1",3,0)
 ;
"RTN","PSJCLOR1",4,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSJCLOR1",5,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSJCLOR1",6,0)
 ; Reference to ^VALM is supported by DBIA 10118
"RTN","PSJCLOR1",7,0)
 ;
"RTN","PSJCLOR1",8,0)
START ;
"RTN","PSJCLOR1",9,0)
 N PSJHLIN S PSGOEA=$G(PSGOEA),$P(PSJHLIN,"-",81)="" S PSGPXN=$G(PSGPXN)
"RTN","PSJCLOR1",10,0)
 K ^TMP("PSJLIST",$J) D:PSGSS'="P" DISPLAYW Q:'$O(^TMP("PSJSELECT",$J,0))
"RTN","PSJCLOR1",11,0)
PROCESS ; Loop through selected patients and display profile/orders.
"RTN","PSJCLOR1",12,0)
 N PSJCNT K DIR,PSJPNV S PSJPNV=1
"RTN","PSJCLOR1",13,0)
 F PSJCNT=0:0 S PSJCNT=$O(^TMP("PSJSELECT",$J,PSJCNT)) Q:'PSJCNT  D PROCESS1 S PSGOP=PSGP D ENQL^PSGLW:$P(PSJSYSL,"^",2)]"" Q:$G(PSJGOTO)="E"  I $D(^TMP("PSJSELECT",$J,+$G(PSJGOTO))) S PSJCNT=PSJGOTO-1
"RTN","PSJCLOR1",14,0)
 D DONE
"RTN","PSJCLOR1",15,0)
 Q
"RTN","PSJCLOR1",16,0)
PROCESS1 ; Process patient
"RTN","PSJCLOR1",17,0)
 N PSJTMPN,PSJCURCL,PSJCLN,PSJPAD,PSJPAGE,PSJPDD,PSJPDOB,PSJPDX,PSJPHT,PSJPHTD,PSJPRB,PSJPSEX,PSJPSSN,PSJPTD,PSJPWDN,PSJPWT,PSJPWTD,RMORDAT
"RTN","PSJCLOR1",18,0)
 S PSJCURCL=$G(^TMP("PSJSELECT",$J,"C",$G(PSJCNT)))
"RTN","PSJCLOR1",19,0)
 S PSJPN=$G(^TMP("PSJSELECT",$J,PSJCNT)),PSJTMPN=PSJPN K PSJGOTO
"RTN","PSJCLOR1",20,0)
 S PSJLK=$$L^PSSLOCK($P(PSJPN,U,2),1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) D CONT^PSJOE0 Q
"RTN","PSJCLOR1",21,0)
 I $G(PSJTMPED),$P(PSJTMPED,"^",2) S PSJEND=$S($P(PSJTMPED,"^",2)'=$P(PSJPN,"^",2):+PSJTMPED,1:+PSJEND)
"RTN","PSJCLOR1",22,0)
 I $G(PSJTMPBG),$P(PSJTMPBG,"^",2) S PSJBEG=$S($P(PSJTMPBG,"^",2)'=$P(PSJPN,"^",2):+PSJTMPBG,1:+PSJBEG)
"RTN","PSJCLOR1",23,0)
 K PSJGOTO D:PSJPN]"" GTORDERS
"RTN","PSJCLOR1",24,0)
 I PSJLK D UL^PSSLOCK($P(PSJTMPN,U,2))
"RTN","PSJCLOR1",25,0)
 S PSGPXN=$G(PSGPXN)
"RTN","PSJCLOR1",26,0)
 Q
"RTN","PSJCLOR1",27,0)
DISPLAYW ; Allow selection of patients on each ward selected.
"RTN","PSJCLOR1",28,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1,PSGWORP1="" F  S PSGWORP1=$O(^TMP("PSGVBW",$J,PSGWORP1)) Q:PSGWORP1=""  D DISPLAYP
"RTN","PSJCLOR1",29,0)
 K PSJASK
"RTN","PSJCLOR1",30,0)
 Q
"RTN","PSJCLOR1",31,0)
DISPLAYP ; Display WORP1 (Ward or Priority)
"RTN","PSJCLOR1",32,0)
 N PSGPICK
"RTN","PSJCLOR1",33,0)
 S PSGVBWN=PSGWORP1
"RTN","PSJCLOR1",34,0)
 D HEADER
"RTN","PSJCLOR1",35,0)
 S PSGWORP2="" F  S PSGWORP2=$O(^TMP("PSGVBW",$J,PSGWORP1,PSGWORP2)) Q:PSGWORP2=""  S PSGPRIN=PSGWORP2 D DISPLAYT
"RTN","PSJCLOR1",36,0)
 I $G(PSJASK),(PSGVBY>0) D ASK
"RTN","PSJCLOR1",37,0)
 Q
"RTN","PSJCLOR1",38,0)
DISPLAYT ;
"RTN","PSJCLOR1",39,0)
 ;NEW PSGPICK  ;PSGPICK=1-->user selected order, stop display the profile
"RTN","PSJCLOR1",40,0)
 S PSGPRIN=PSGWORP2
"RTN","PSJCLOR1",41,0)
 S:$G(PSGPRIF) PSGVBWN=PSGWORP2,PSGPRIN=PSGWORP1
"RTN","PSJCLOR1",42,0)
 S PSGVBTM="" F  S PSGVBTM=$O(^TMP("PSGVBW",$J,PSGWORP1,PSGWORP2,PSGVBTM))  Q:(PSGVBTM=""!$G(PSGPICK))  D V2
"RTN","PSJCLOR1",43,0)
 I $G(PSJPRIF),$G(PSJASK),(PSGVBY>0) D ASK
"RTN","PSJCLOR1",44,0)
 Q
"RTN","PSJCLOR1",45,0)
GTORDERS ;
"RTN","PSJCLOR1",46,0)
 S (PSGP,DFN)=$P(PSJPN,U,2),PSGOL="S" K PSJACNWP D ^PSJAC
"RTN","PSJCLOR1",47,0)
 S:$G(PSJTMPBG) PSJBEG=PSJTMPBG S:$G(PSJTMPED) PSJEND=PSJTMPED K PSJTMPBG,PSJTMPED
"RTN","PSJCLOR1",48,0)
 D PROFILE Q
"RTN","PSJCLOR1",49,0)
 Q
"RTN","PSJCLOR1",50,0)
PROFILE ; Display the patient's profile and allow order selection.
"RTN","PSJCLOR1",51,0)
 S PSGP=DFN,PSJOL=PSGOL F  Q:$G(PSJVALQ)  D EN^VALM("PSJ LM CLINIC ORDERS") Q:'$G(PSJORD)&'$G(PSJNEWOE)!$G(PSJVALQ)  S PSJNEWOE=0
"RTN","PSJCLOR1",52,0)
 S PSJVALQ=0
"RTN","PSJCLOR1",53,0)
 Q
"RTN","PSJCLOR1",54,0)
DONE ; Clean up
"RTN","PSJCLOR1",55,0)
 K PSGOP,PSJLK,PSJNEWOE,PSJPN,VALMBCK,PSGP
"RTN","PSJCLOR1",56,0)
 Q
"RTN","PSJCLOR1",57,0)
V2 ;
"RTN","PSJCLOR1",58,0)
 S PSGVBPN="" F  S PSGVBPN=$O(^TMP("PSGVBW",$J,PSGWORP1,PSGWORP2,PSGVBTM,PSGVBPN)) Q:(PSGVBPN=""!$G(PSGPICK))  S PSGP=$P(PSGVBPN,"^",2),PPN=$P(PSGVBPN,"^") S:PPN="" PPN=PSGP_";DPT(" D WRT
"RTN","PSJCLOR1",59,0)
 Q
"RTN","PSJCLOR1",60,0)
WRT ;
"RTN","PSJCLOR1",61,0)
 S PSGVBY=PSGVBY+1,PSJASK=1
"RTN","PSJCLOR1",62,0)
 S PSGVBWN=PSGWORP1,PSGPRD=PSGWORP2
"RTN","PSJCLOR1",63,0)
 W !,$J(PSGVBY,4),?8,PPN," (",$P(PSGVBPN,U,3),")" S ^TMP("PSJLIST",$J,PSGVBY)=PSGVBWN_U_PSGVBTM_U_PPN_U_PSGP
"RTN","PSJCLOR1",64,0)
 I $Y+1>IOSL,(PSGVBY>0) NEW DIR S DIR(0)="EA",DIR("A")=" '^' TO QUIT " D ^DIR D
"RTN","PSJCLOR1",65,0)
 . I X="^" S PSGPICK=1  Q
"RTN","PSJCLOR1",66,0)
 . S PSJASK=0 W @IOF
"RTN","PSJCLOR1",67,0)
 Q
"RTN","PSJCLOR1",68,0)
ASK ;
"RTN","PSJCLOR1",69,0)
 N DIR,PSGDFN,PSGASKX S DIR(0)="LOA^1:"_PSGVBY,DIR("A")="Select 1 - "_PSGVBY_": " D ^DIR I $D(DUOUT)!$D(DTOUT) K ^TMP("PSGVBW",$J) Q
"RTN","PSJCLOR1",70,0)
 S:Y]"" PSGPICK=1
"RTN","PSJCLOR1",71,0)
 F PSJINDEX=1:1:$L(Y,",")-1 D
"RTN","PSJCLOR1",72,0)
 . S PSGASKX=$G(^TMP("PSJLIST",$J,$P(Y,",",PSJINDEX))),PSGDFN=$P(PSGASKX,"^",4)_"^"_$P(PSGASKX,"^",3)
"RTN","PSJCLOR1",73,0)
 . D CHK^PSJDPT(.PSGDFN,1) I PSGDFN=-1 Q
"RTN","PSJCLOR1",74,0)
 . S:PSGASKX]"" ^TMP("PSJSELECT",$J,PSJCNT)=$P(PSGASKX,U,3,4),^TMP("PSJSELECT",$J,"B",$P(PSGASKX,U,3),PSJCNT)="",^TMP("PSJSELECT",$J,"C",PSJCNT)=$G(^TMP("PSGVBW3",$J,$P(PSGASKX,U),PSGP)),PSJCNT=PSJCNT+1
"RTN","PSJCLOR1",75,0)
 K PSJINDEX,Y
"RTN","PSJCLOR1",76,0)
 Q
"RTN","PSJCLOR1",77,0)
H2 ;
"RTN","PSJCLOR1",78,0)
 W !!?2,"Select patients either singularly separated by commas (1,2,3), by a range of",!,"patients separated by a dash (1-3), or a combination (1,2,4-6).  To select all",!,"patients, enter 'ALL' or a dash ('-').  You can also enter '-n' to"
"RTN","PSJCLOR1",79,0)
 W " select the",!,"first patient through the 'nth' patient or enter 'n-' to select the 'nth'",!,"patient through the last patient.  If a patient is selected more than once,"
"RTN","PSJCLOR1",80,0)
 W !,"only the first selection is used.  (Entering '1,2,1' would return '1,2'.)" Q
"RTN","PSJCLOR1",81,0)
 ;
"RTN","PSJCLOR1",82,0)
HEADER ;
"RTN","PSJCLOR1",83,0)
 W:$Y @IOF W !,"CLINIC ORDERS - "
"RTN","PSJCLOR1",84,0)
 I $G(PSGPRIF) W $S($G(PRD)=1:"STAT",$G(PRD)=2:"ASAP",1:"ROUTINE")
"RTN","PSJCLOR1",85,0)
 I '$G(PSGPRIF) W $S(PSGVBWN="ZZ":"^OTHER",1:PSGVBWN)
"RTN","PSJCLOR1",86,0)
 W !!," No.",?8,"PATIENT",!,PSJHLIN K PSGVBY S PSGVBY=0 Q
"RTN","PSJCLOR1",87,0)
 Q
"RTN","PSJCLOR1",88,0)
NP ;
"RTN","PSJCLOR1",89,0)
 W $C(7) R !!,"ENTER AN '^' TO SELECT ORDERS NOW, OR PRESS THE RETURN KEY TO CONTINUE. ",NP:DTIME E  S NP="^"
"RTN","PSJCLOR1",90,0)
 Q
"RTN","PSJCLOR1",91,0)
DISPORD(DFN,ON)     ;Display the order that being lock by another user
"RTN","PSJCLOR1",92,0)
 NEW PSJLINE,PSJOC,X
"RTN","PSJCLOR1",93,0)
 S PSJLINE=1
"RTN","PSJCLOR1",94,0)
 D DSPLORDU^PSJLMUT1(DFN,ON)
"RTN","PSJCLOR1",95,0)
 W ! F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  W !,PSJOC(ON,X)
"RTN","PSJCLOR1",96,0)
 Q
"RTN","PSJCLOR1",97,0)
HELP ;
"RTN","PSJCLOR1",98,0)
 D FULL^VALM1
"RTN","PSJCLOR1",99,0)
 W !!,"ES  Edit Start Date"
"RTN","PSJCLOR1",100,0)
 W !,"     Select the medication orders you wish to edit. "
"RTN","PSJCLOR1",101,0)
 W !,"     After selecting orders, a new Start Date/Time may be entered."
"RTN","PSJCLOR1",102,0)
 W !
"RTN","PSJCLOR1",103,0)
 W !,"VD  View Order Detail"
"RTN","PSJCLOR1",104,0)
 W !,"    Select the medication orders you wish to view. "
"RTN","PSJCLOR1",105,0)
 W !,"    Details for selected orders will be displayed."
"RTN","PSJCLOR1",106,0)
 W !
"RTN","PSJCLOR1",107,0)
 W !,"VP  View Profile"
"RTN","PSJCLOR1",108,0)
 W !,"    View order profile that shows all medication orders."
"RTN","PSJCLOR1",109,0)
 W !,"    No edits allowed at this view. "
"RTN","PSJCLOR1",110,0)
 W !
"RTN","PSJCLOR1",111,0)
 W !,"CD  Change Date Range"
"RTN","PSJCLOR1",112,0)
 W !,"    Change the search date range for the current patient's"
"RTN","PSJCLOR1",113,0)
 W !,"    Clinic Orders. The search date range will revert to the"
"RTN","PSJCLOR1",114,0)
 W !,"    initial search date range for subsequent patients. ",!
"RTN","PSJCLOR1",115,0)
 D CONT^PSJOE0 S VALMBCK="R"
"RTN","PSJCLOR1",116,0)
 Q
"RTN","PSJCLOR1",117,0)
IMPATPR ; View Profile Entry
"RTN","PSJCLOR1",118,0)
 D ^PSJHVARS N VAIN,VADM,PSJLM D FULL^VALM1,ENOR^PSJCLOR4(PSGP) D RESTORE^PSJHVARS S VALMBCK="R"
"RTN","PSJCLOR1",119,0)
 Q
"RTN","PSJCLOR1",120,0)
PSJREVFY() ; Ask if Active orders should be re-verified
"RTN","PSJCLOR1",121,0)
 D FULL^VALM1 W !
"RTN","PSJCLOR1",122,0)
 K Y,DIR S Y=0 S DIR("A",1)=""
"RTN","PSJCLOR1",123,0)
 S DIR("A",2)="     ATTENTION: One or more selected orders have an ACTIVE status.  "
"RTN","PSJCLOR1",124,0)
 S DIR("A",3)=" You may choose to have ACTIVE orders remain ACTIVE after editing, or "
"RTN","PSJCLOR1",125,0)
 S DIR("A",4)=" you may choose to have the status of ACTIVE orders changed to NON-VERIFIED."
"RTN","PSJCLOR1",126,0)
 S DIR("A",5)=" "
"RTN","PSJCLOR1",127,0)
 S DIR("?")="^D VFYHELP^PSJCLOR1",DIR(0)="Y",DIR("A")="Should ACTIVE orders remain ACTIVE after editing" D ^DIR W !!
"RTN","PSJCLOR1",128,0)
 I 'Y,'$G(DUOUT) W !,"  All selected orders will have a status of NON-VERIFIED after editing",!
"RTN","PSJCLOR1",129,0)
 Q +Y
"RTN","PSJCLOR1",130,0)
VFYHELP ; Help text for auto-reverify
"RTN","PSJCLOR1",131,0)
 W !?5,"Yes  - ACTIVE orders will remain ACTIVE after they are modified.",!
"RTN","PSJCLOR1",132,0)
 W !?5,"No - The status of ACTIVE orders will be changed to NON-VERIFIED"
"RTN","PSJCLOR1",133,0)
 W !?5,"after they are modified. The orders must be re-verified, via"
"RTN","PSJCLOR1",134,0)
 W !?5,"Inpatient Order Entry or other order entry options, in order"
"RTN","PSJCLOR1",135,0)
 W !?5,"to change the status back to ACTIVE."
"RTN","PSJCLOR1",136,0)
 Q
"RTN","PSJCLOR1",137,0)
SURE() ; Non-Pharmacist can't auto-reverify
"RTN","PSJCLOR1",138,0)
 D FULL^VALM1 W !
"RTN","PSJCLOR1",139,0)
 K Y,DIR S Y=0
"RTN","PSJCLOR1",140,0)
 S DIR("A",1)="     ATTENTION: One or more selected orders have an ACTIVE status.  "
"RTN","PSJCLOR1",141,0)
 S DIR("A",2)=" If you continue, the status of ACTIVE orders will be changed to NON-VERIFIED."
"RTN","PSJCLOR1",142,0)
 S DIR("A",3)=" "
"RTN","PSJCLOR1",143,0)
 S DIR("?")="^D SUREHELP^PSJCLOR1",DIR(0)="Y",DIR("A")="Continue editing selected orders" D ^DIR W !
"RTN","PSJCLOR1",144,0)
 I Y>0,'$G(DUOUT) W !,"  All selected orders will have a status of NON-VERIFIED after editing",!
"RTN","PSJCLOR1",145,0)
 Q $S(Y>0:0,1:-1)
"RTN","PSJCLOR1",146,0)
SUREHELP ; Help text for non-pharmacists
"RTN","PSJCLOR1",147,0)
 W !?5,"The status of ACTIVE orders will be changed to NON-VERIFIED"
"RTN","PSJCLOR1",148,0)
 W !?5,"after they are modified. The orders must be re-verified, via"
"RTN","PSJCLOR1",149,0)
 W !?5,"Inpatient Order Entry or other order entry options, in order"
"RTN","PSJCLOR1",150,0)
 W !?5,"to change the status back to ACTIVE."
"RTN","PSJCLOR1",151,0)
 Q
"RTN","PSJCLOR1",152,0)
HDR ; HEADER code for PSJ LM ECO protocol
"RTN","PSJCLOR1",153,0)
 D A^PSJ200(21,19),SHOW^VALM
"RTN","PSJCLOR1",154,0)
 S XQORM("#")=+$O(^ORD(101,"B","PSJ LM VIEW ORDER DETAIL",0))_"^1:"_+$G(^TMP("PSJPRO",$J,0))
"RTN","PSJCLOR1",155,0)
 Q
"RTN","PSJCLOR2")
0^3^B116137522^n/a
"RTN","PSJCLOR2",1,0)
PSJCLOR2 ;BIR/JCH - BUILD CLINIC ORDER LM HEADERS ; 2/28/12 9:11am
"RTN","PSJCLOR2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**275**;16 DEC 97;Build 157
"RTN","PSJCLOR2",3,0)
 ;
"RTN","PSJCLOR2",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCLOR2",5,0)
 ; Reference to CWAD^ORQPT2 is supported by DBIA 2831.
"RTN","PSJCLOR2",6,0)
 ; Reference to ^SC is supported by DBIA 10040.
"RTN","PSJCLOR2",7,0)
 ;
"RTN","PSJCLOR2",8,0)
HDR(DFN) ; -- list screen header
"RTN","PSJCLOR2",9,0)
 ;   input:       DFN := ifn of pat
"RTN","PSJCLOR2",10,0)
 ;  output:  VALMHDR() := hdr array
"RTN","PSJCLOR2",11,0)
 ;
"RTN","PSJCLOR2",12,0)
 K VAIN,VADM,GMRA,PSJACNWP,PSJ,VAERR,VA,X
"RTN","PSJCLOR2",13,0)
 S PSJACNWP=1 D ENBOTH^PSJAC
"RTN","PSJCLOR2",14,0)
 D HDRO(DFN)
"RTN","PSJCLOR2",15,0)
 S PSJ="   Sex: "_$P(PSJPSEX,U,2),VALMHDR(4)=$$SETSTR^VALM1($S(PSJPDD:"Last ",1:"     ")_"Admitted: "_$P($G(PSJPAD),U,2),PSJ,45,23)
"RTN","PSJCLOR2",16,0)
 S PSJ="    Dx: "_$G(PSJPDX)
"RTN","PSJCLOR2",17,0)
 S:PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Discharged: "_$E($P(PSJPDD,U,2),1,8),PSJ,48,26)
"RTN","PSJCLOR2",18,0)
 S:'PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Last transferred: "_$$ENDTC^PSGMI(PSJPTD),PSJ,42,26)
"RTN","PSJCLOR2",19,0)
 Q
"RTN","PSJCLOR2",20,0)
 ;
"RTN","PSJCLOR2",21,0)
HDRO(DFN) ; Standardized part of profile header.
"RTN","PSJCLOR2",22,0)
 N PSJCLIN,PSJAPPT,PSJCLINN,RMORDT S (PSJCLIN,PSJAPPT)=0,(RMORDT,PSJCLINN)="" I $G(PSJORD) D
"RTN","PSJCLOR2",23,0)
 . S PSJCLIN=$S($G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,"DSS")),$G(PSJORD)["U":$G(^PS(55,DFN,5,+PSJORD,8)),$G(PSJORD)["P":$G(^PS(53.1,+PSJORD,"DSS")),1:"")
"RTN","PSJCLOR2",24,0)
 . S:PSJCLIN PSJAPPT=$P($G(PSJCLIN),U,2) I PSJCLIN,PSJAPPT S PSJCLINN=$P($G(^SC(+PSJCLIN,0)),U)
"RTN","PSJCLOR2",25,0)
 K VALMHDR I PSJCLINN]"" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1("   Clinic: "_PSJCLINN,PSJ,28,26)
"RTN","PSJCLOR2",26,0)
 I PSJCLINN="" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1($S('PSJPDD:"     ",1:"Last ")_"Ward: "_PSJPWDN,PSJ,30,18)
"RTN","PSJCLOR2",27,0)
 S X=$$CWAD^ORQPT2(DFN)
"RTN","PSJCLOR2",28,0)
 S:X]"" X=IORVON_X_IORVOFF,PSJ=$$SETSTR^VALM1(X,PSJ,80-$L(X),80) S VALMHDR(1)=PSJ
"RTN","PSJCLOR2",29,0)
 S PSJ="   PID: "_$P(PSJPSSN,U,2)
"RTN","PSJCLOR2",30,0)
 S RMORDT=$S($G(PSJPDD):"Last ",1:"     ")_"Room-Bed: "_$G(PSJPRB)
"RTN","PSJCLOR2",31,0)
 I PSJCLINN]"",PSJAPPT S RMORDT="Clinic Date: "_$$ENDTC^PSGMI(PSJAPPT),RMORDT=$P(RMORDT,"  ")_" "_$P(RMORDT,"  ",2)
"RTN","PSJCLOR2",32,0)
 S PSJ=$$SETSTR^VALM1(RMORDT,PSJ,26,28),VALMHDR(2)=$$SETSTR^VALM1("Ht(cm): "_PSJPHT_" "_PSJPHTD,PSJ,55,25)
"RTN","PSJCLOR2",33,0)
 S PSJ="   DOB: "_$P($P(PSJPDOB,U,2)," ")_" ("_PSJPAGE_")",VALMHDR(3)=$$SETSTR^VALM1("Wt(kg): "_PSJPWT_" "_PSJPWTD,PSJ,55,25)
"RTN","PSJCLOR2",34,0)
 Q
"RTN","PSJCLOR2",35,0)
 ;
"RTN","PSJCLOR2",36,0)
INIT(PSJPROT) ; -- init bld vars
"RTN","PSJCLOR2",37,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJCLOR2",38,0)
 K PSJUDPRF,^TMP("PSJ",$J),^TMP("PSJON",$J),^TMP("PSJPRO",$J),^TMP("PSJCLOR",$J) D FULL^VALM1
"RTN","PSJCLOR2",39,0)
 N TMPCLIN,DFN,UDU S PSJVALQ=0,TMPCLIN="",DFN=PSGP,PSGSSAV=PSGSS,UDU=$S($P(PSJSYSU,";",3)>1:3,1:1)
"RTN","PSJCLOR2",40,0)
 S:PSJPROT=1 PSJUDPRF=1
"RTN","PSJCLOR2",41,0)
 D KILL^VALM10(),EN^PSJCLOR3(PSJPROT)
"RTN","PSJCLOR2",42,0)
 I '$D(^TMP("PSJ",$J)) W !!,?22,"NO CLINIC ORDERS FOUND." S VALMQUIT=1,PSJVALQ=1 D PAUSE^PSJLMUTL Q
"RTN","PSJCLOR2",43,0)
 S PSJLN=1,PSJEN=1 S PSJCLIN="" F  S PSJCLIN=$O(^TMP("PSJ",$J,PSJCLIN)) Q:PSJCLIN=""  S PSJTF=0,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJCLIN,PSJC)) Q:PSJC=""  D
"RTN","PSJCLOR2",44,0)
 .N PSJF S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJCLOR2",45,0)
 .I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN    ;DAM 8-29-07 Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJCLOR2",46,0)
 .S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",47,0)
 ..S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""  Q:PSJC="CB"  Q:PSJC="O"  Q:PSJC="DF"  D ON      ;DAM 8-29-07  Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJCLOR2",48,0)
 .;
"RTN","PSJCLOR2",49,0)
 .;DAM 8-29-07   New code to place Pending Orders after Pending Renewal Orders on the roll and scroll display.  Non-Active Orders appear last.
"RTN","PSJCLOR2",50,0)
 S PSJCLIN="" F  S PSJCLIN=$O(^TMP("PSJ",$J,PSJCLIN)) Q:PSJCLIN=""  S PSJTF=0,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJCLIN,PSJC)) Q:PSJC=""  D
"RTN","PSJCLOR2",51,0)
 . N PSJF S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJCLOR2",52,0)
 . I PSJC="CB" I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN                            ;These are Pending Orders
"RTN","PSJCLOR2",53,0)
 . I PSJC="CB" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",54,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJCLOR2",55,0)
 . I PSJC="DF" I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN                              ;These are recently DC Orders (mv)
"RTN","PSJCLOR2",56,0)
 . I PSJC="DF" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",57,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJCLOR2",58,0)
 . I PSJC="O" I TMPCLIN'=PSJCLIN D TF S PSJTF=$E(PSJC,1),TMPCLIN=PSJCLIN                              ;These are Non-Active Orders
"RTN","PSJCLOR2",59,0)
 . I PSJC="O" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJCLOR2",60,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJCLOR2",61,0)
 .; END DAM changes
"RTN","PSJCLOR2",62,0)
 .;
"RTN","PSJCLOR2",63,0)
 S VALMCNT=PSJLN-1
"RTN","PSJCLOR2",64,0)
DONE ;
"RTN","PSJCLOR2",65,0)
 K ^TMP("PSJCLOR",$J) M ^TMP("PSJCLOR",$J)=^TMP("PSJON",$J)
"RTN","PSJCLOR2",66,0)
 K PSJC,PSJEN,PSJLN,PSJST,PSJS,CNT,PSJPRI,^TMP("PSJ",$J),PSGSSAV,PSJDCEXP,PSJL,PSJON,PSJOS,PSJTF
"RTN","PSJCLOR2",67,0)
 Q
"RTN","PSJCLOR2",68,0)
ON ; Set order number into ^TMP
"RTN","PSJCLOR2",69,0)
 N PSJCLORD S PSJCLORD=1
"RTN","PSJCLOR2",70,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJCLOR2",71,0)
 S PSJO="" F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJCLIN,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO) D
"RTN","PSJCLOR2",72,0)
 .N PRJPRI S PSJPRI=$S(PSJO["V":$P($G(^PS(55,PSGP,"IV",+PSJO,.2)),"^",4),PSJO["U":$P($G(^PS(55,PSGP,5,+PSJO,.2)),"^",4),1:$P($G(^PS(53.1,+PSJO,.2)),"^",4))
"RTN","PSJCLOR2",73,0)
 .S ^TMP("PSJON",$J,PSJEN)=PSJO,PSJL=$J(PSJEN,4) D @$S(PSJO["V":"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)",PSJO["U":"PUD^PSJLMPRU(PSGP,PSJO,PSJF,DN)",1:"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)") S ^TMP("PSJPRO",$J,0)=PSJEN,PSJEN=PSJEN+1
"RTN","PSJCLOR2",74,0)
 .S ^TMP("PSJON",$J)=+$O(^TMP("PSJON",$J,""),-1)
"RTN","PSJCLOR2",75,0)
 K DN,FQ,PSJSCHT
"RTN","PSJCLOR2",76,0)
 Q
"RTN","PSJCLOR2",77,0)
TF ; Set up order type header
"RTN","PSJCLOR2",78,0)
 NEW PSJDFHDR
"RTN","PSJCLOR2",79,0)
 I $D(^TMP("PSJ",$J,PSJCLIN)) D
"RTN","PSJCLOR2",80,0)
 .S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJCLOR2",81,0)
 .S PSJDFHDR="RECENTLY DISCONTINUED/EXPIRED (LAST "_+$G(PSJDCEXP)_" HOURS)"
"RTN","PSJCLOR2",82,0)
 .N C,X,Y S C=PSJC,Y="",$P(Y," -",40)=""
"RTN","PSJCLOR2",83,0)
 .S X=PSJCLIN
"RTN","PSJCLOR2",84,0)
 .I $G(PSJCLIN)]"" S X=PSJCLIN
"RTN","PSJCLOR2",85,0)
 .S ^TMP("PSJPRO",$J,PSJLN,0)=$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80),PSJLN=PSJLN+1
"RTN","PSJCLOR2",86,0)
 Q
"RTN","PSJCLOR2",87,0)
TEST ; Headers
"RTN","PSJCLOR2",88,0)
 N X,Y S Y="",$P(Y," -",40)=""
"RTN","PSJCLOR2",89,0)
 F X="A C T I V E","P E N D I N G   R E N E W A L S","P E N D I N G ","N O N - V E R I F I E D","N O N - A C T I V E" W !,$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80)
"RTN","PSJCLOR2",90,0)
 Q
"RTN","PSJCLOR2",91,0)
VWDETAIL(PSGP) ;
"RTN","PSJCLOR2",92,0)
 N VAIN,VADM,PSJLM,PSGPRF,PSJPRP,PSJSYSL,DFN D ENCV^PSGSETU
"RTN","PSJCLOR2",93,0)
 S DFN=PSGP D ^PSJAC D INIT^PSJCLOR2(3)
"RTN","PSJCLOR2",94,0)
 S PSGPRF="",PSJPRP="P",PSJPR=0,PSJON=+$G(^TMP("PSJON",$J)) D FULL^VALM1,ENVW
"RTN","PSJCLOR2",95,0)
 D DONEVD
"RTN","PSJCLOR2",96,0)
 Q
"RTN","PSJCLOR2",97,0)
ENVW ; ask user to select or view any of the orders shown
"RTN","PSJCLOR2",98,0)
 S (PSGONC,PSGONR,PSGONV)=0,PSGLMT=PSJON S:$D(PSJPRF) PSGPRF=1
"RTN","PSJCLOR2",99,0)
 N PSJXDIR S PSJXDIR=$P($G(XQORNOD(0)),"=",2) I PSJXDIR S X=$E(PSJXDIR,1,$L(PSJXDIR)-1) D ENCHK^PSGON
"RTN","PSJCLOR2",100,0)
 I '$G(PSJXDIR) D ENASR^PSGON
"RTN","PSJCLOR2",101,0)
 K PSGPRF
"RTN","PSJCLOR2",102,0)
 G:X["^" DONEVD I X]"" S PSGOEA=""
"RTN","PSJCLOR2",103,0)
 K PSJDLW
"RTN","PSJCLOR2",104,0)
 I  F PSJOE=1:1:PSGODDD S PSGOE=PSJOE F PSJOE1=1:1:$L(PSGODDD(PSJOE),",")-1 S PSJOE2=$P(PSGODDD(PSJOE),",",PSJOE1),(PSGORD,PSJORD)=^TMP("PSJON",$J,PSJOE2) G:$D(PSJDLW) DONEVD D
"RTN","PSJCLOR2",105,0)
 .I PSJORD=+PSJORD N PSJO,PSJO1 S PSJO=PSJORD,PSJO1=0 F  S PSJO1=$O(^PS(53.1,"ACX",PSJO,PSJO1)) Q:'PSJO1  Q:$D(PSJDLW)  S PSJORD=PSJO1_"P",PSGOEA="" D GODO(PSJORD) S PSJORD=""
"RTN","PSJCLOR2",106,0)
 .Q:PSJORD=""  S PSGOEA="" D GODO(PSJORD)
"RTN","PSJCLOR2",107,0)
 Q
"RTN","PSJCLOR2",108,0)
 ;
"RTN","PSJCLOR2",109,0)
GODO(PSJORD) ; 
"RTN","PSJCLOR2",110,0)
 D GODO^PSJOE0
"RTN","PSJCLOR2",111,0)
 Q
"RTN","PSJCLOR2",112,0)
DONEVD ; Kill variables
"RTN","PSJCLOR2",113,0)
 K DTOUT,PSGONC,PSGONR,PSGONV,PSGODDD,PSGOE,PSGOEA,PSJL,PSJOE,PSJOE1,PSJOE2,PSJON,PSJPR,PSJPRF
"RTN","PSJCLOR2",114,0)
 Q
"RTN","PSJCLOR2",115,0)
 ;
"RTN","PSJCLOR2",116,0)
NEWORDER(PSGP,PSGORD,PSGNWSD,PSGOEAV) ;
"RTN","PSJCLOR2",117,0)
 N PSGSD,PSGOEEF,PSGOFD,PSGNEFD,PSGOSD,PSGFD,PSGAT S PSGOEEF(10)=1,PSJNOLOK=0
"RTN","PSJCLOR2",118,0)
 K DIR I '$$LS^PSSLOCK(DFN,PSGORD) W !,"NO ACTION TAKEN ON ORDER",! D CONT^PSJOE0 S PSJNOLOK=1 Q
"RTN","PSJCLOR2",119,0)
 I $D(^PS(53.45,+$G(PSJSYSP),5)) N PSJFSI S PSJFSI=1 D FILESI^PSJBCMA5(DFN,PSGORD) N SIARRAY S SIARRAY="" D
"RTN","PSJCLOR2",120,0)
 .I PSGORD["P" M SIARRAY=^PS(53.1,+PSGORD,15) D NEWNVAL^PSGAL5(PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSJCLOR2",121,0)
 .I PSGORD["U" M SIARRAY=^PS(55,DFN,5,+PSGORD,15) D NEWUDAL^PSGAL5(DFN,PSGORD,6000,"SPECIAL INSTRUCTIONS",,.SIARRAY)
"RTN","PSJCLOR2",122,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSJCLOR2",123,0)
 ;
"RTN","PSJCLOR2",124,0)
 I PSGORD["P"!(PSGORD["U") D
"RTN","PSJCLOR2",125,0)
 .N PSGST,PSGSCH,PSGNESD,ND,ND2,PSJEDFLD,I
"RTN","PSJCLOR2",126,0)
 .F I=0,2 S ND(I)=$S($G(PSGORD)["P":$G(^PS(53.1,+PSGORD,I)),$G(PSGORD)["U":$G(^PS(55,+$G(PSGP),5,+PSGORD,I)),$G(PSJTMPON)["V":$G(^PS(55,+$G(PSGP),"IV",+PSGORD,I)),1:"")
"RTN","PSJCLOR2",127,0)
 .S PSGNESD=PSGNWSD,PSGSCH=$S(PSGORD["P"!(PSGORD["U"):$P(ND(2),"^"),PSGORD["V":$P(ND(0),"^",9),1:"")
"RTN","PSJCLOR2",128,0)
 .S PSGST=$S(PSGORD["P"!(PSGORD["U"):$P(ND(0),"^",7),1:""),(PSGFD,PSGOFD)=$S(PSGORD["V":$P(ND(0),"^",3),1:$P(ND(2),"^",4)),(PSGSD,PSGOSD)=$S(PSGORD["V":$P(ND(0),"^",2),1:$P(ND(2),"^",2))
"RTN","PSJCLOR2",129,0)
 .S PSGNEFD="" D ENFD^PSGNE3(PSGNWSD) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSJCLOR2",130,0)
 .I $G(PSGNEFD),(PSGNEFD<PSGNWSD) W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***" S PSJQMSG=1 Q
"RTN","PSJCLOR2",131,0)
 .S PSJEDFLD=$S(PSGORD["P":25,1:34) S PSGOEEF(PSJEDFLD)=1
"RTN","PSJCLOR2",132,0)
 ;
"RTN","PSJCLOR2",133,0)
 I PSGORD["U" D  Q
"RTN","PSJCLOR2",134,0)
 .N TMPNEFD S TMPNEFD=$G(PSGNEFD) S PSGOEEWF="^PS(55,"_PSGP_",5,"_+PSGORD_"," S (ND,ND0)=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2))
"RTN","PSJCLOR2",135,0)
 .D EN2^PSGOEEW
"RTN","PSJCLOR2",136,0)
 .S PSGOORD=PSGORD S (PSGNESD,SD,PSGSD)=PSGNWSD I ($G(TMPNEFD)'="") S (PSGNEFD,PSGFD)=TMPNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSJCLOR2",137,0)
 .S PSGOFD=$P(^PS(55,PSGP,5,+PSGORD,2),"^",4),PSGOEENO=1,PSJOCL=+$G(^PS(55,PSGP,5,+PSGORD,8))
"RTN","PSJCLOR2",138,0)
 .W !,"START DATE/TIME: ",$$ENDD^PSGMI(PSGSD) D A34^PSJCLOR4
"RTN","PSJCLOR2",139,0)
 .S PSJNOO=$$ENNOO^PSJUTL5("E") I PSJNOO<0 W "    No changes made to this order!" D CONT^PSJOE0 Q
"RTN","PSJCLOR2",140,0)
 .N PSJOCL,PSGOEENO S PSGOEENO=1,PSJOCL=+$G(^PS(55,PSGP,5,+PSGORD,8))
"RTN","PSJCLOR2",141,0)
 .D NEW^PSGOEE
"RTN","PSJCLOR2",142,0)
 .Q
"RTN","PSJCLOR2",143,0)
 ;
"RTN","PSJCLOR2",144,0)
 I PSGORD["P"  D
"RTN","PSJCLOR2",145,0)
 .N DR,PSJTMPFD,P S DR="10////^S X=PSGSD;" S:$G(PSGOEEF(25)) DR=DR_"25////^S X=PSGFD;" S DR=DR_"W ""."";"
"RTN","PSJCLOR2",146,0)
 .S PSJTMPFD=PSGFD
"RTN","PSJCLOR2",147,0)
 .D GETUD^PSJLMGUD(PSGP,PSGORD) N PSGNESD,PSGPDRG,PSJOCL S PSGPDRG=PSGPD,PSJOCL=+$G(^PS(53.1,+PSGORD,"DSS")) S:$G(PSGOEEF(25)) (PSGNEFD,PSGFD)=PSJTMPFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD)
"RTN","PSJCLOR2",148,0)
 .Q:'$G(PSJOCL)  S PSGS0Y=PSGAT,(PSGNESD,PSGSD)=PSGNWSD,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSJCLOR2",149,0)
 .W !,"START DATE/TIME: ",$$ENDD^PSGMI(PSGSD) D A25NV^PSJCLOR4
"RTN","PSJCLOR2",150,0)
 .N PSGOEENO S PSGOEENO=0 D UPD^PSGOEE
"RTN","PSJCLOR2",151,0)
 .D EN1^PSJHL2(PSGP,"XX",PSGORD)
"RTN","PSJCLOR2",152,0)
 ;
"RTN","PSJCLOR2",153,0)
 I PSGORD["V" D
"RTN","PSJCLOR2",154,0)
 .N ON55,ND,ND2,ND0,PSIVCHG,PSIVSYSP,P,PSJSTRDF,PSJSTPDF,PSJINIV S PSGOEEWF="^PS(55,"_PSGP_",""IV"","_+PSGORD_",",PSIVCHG=1
"RTN","PSJCLOR2",155,0)
 .I '$G(XQORNOD),$G(PSJTMPXQ) N XQORNOD S XQORNOD=PSJTMPXQ
"RTN","PSJCLOR2",156,0)
 .S XQORNOD(0)="^^E"
"RTN","PSJCLOR2",157,0)
 .S PSJSYSW0=$G(PSJSYSW0) ; Initialize/restore PSJSYSW0 ward parameters. Killed at exit in ENKV^PSGSETU.
"RTN","PSJCLOR2",158,0)
 .I $G(PSGOEAV),'$P(PSJSYSP0,U,9) S PSIVSYSP=PSJSYSP0 N PSJSYSP0 S PSJSYSP0=PSIVSYSP,$P(PSJSYSP0,"^",9)=1
"RTN","PSJCLOR2",159,0)
 .S (ND,ND0)=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2)),ON55=PSGORD
"RTN","PSJCLOR2",160,0)
 .D GT55^PSIVORFB S P(2)=PSGNWSD D ENSTOP^PSIVCAL
"RTN","PSJCLOR2",161,0)
 .W !,"START DATE/TIME: ",$$ENDD^PSGMI(P(2))
"RTN","PSJCLOR2",162,0)
 .D A25V^PSJCLOR4(PSGP,PSGORD)
"RTN","PSJCLOR2",163,0)
 .D NEWORD^PSIVOPT1
"RTN","PSJCLOR2",164,0)
 .S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) S ON=ON55,OD=P(2) D:ON["V" EN^PSIVORE D EN1^PSJHL2(DFN,"SN",ON55,"NEW ORDER")
"RTN","PSJCLOR2",165,0)
 .N TMPOLD S TMPOLD=$S(ON55["P":$P($G(^PS(53.1,+ON55,0)),"^",25),ON55["V":$P($G(^PS(55,PSGP,"IV",+ON55,2)),"^",5),1:"") I TMPOLD D
"RTN","PSJCLOR2",166,0)
 ..I TMPOLD["V",$D(^PS(55,PSGP,"IV",+TMPOLD,10,1)) N LN S LN=+$O(^PS(55,PSGP,"IV",+TMPOLD,10,""),-1) D
"RTN","PSJCLOR2",167,0)
 ...S:ON55["P" ^PS(53.1,+ON55,16,0)="^53.1136^"_LN_"^"_LN S:ON55["V" ^PS(55,PSGP,"IV",+ON55,10,0)="^55.1154^"_LN_"^"_LN
"RTN","PSJCLOR2",168,0)
 ...S LN=0 F  S LN=$O(^PS(55,PSGP,"IV",+TMPOLD,10,LN)) Q:'LN  S:ON55["P" ^PS(53.1,+ON55,16,LN,0)=^PS(55,PSGP,"IV",+TMPOLD,10,LN,0) S:ON55["V" ^PS(55,PSGP,"IV",+ON55,10,LN,0)=^PS(55,PSGP,"IV",+TMPOLD,10,LN,0)
"RTN","PSJCLOR2",169,0)
 .;
"RTN","PSJCLOR2",170,0)
 I $G(PSJFSI)=1 I $$GETSI^PSJBCMA5(DFN,PSGORD) D FILESI^PSJBCMA5(DFN,$S($G(PSGOORD):PSGOORD,1:PSGORD))
"RTN","PSJCLOR2",171,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSJCLOR2",172,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSJCLOR2",173,0)
 D NEWCLN^PSJCLOR5
"RTN","PSJCLOR2",174,0)
 D UNL^PSSLOCK(PSGP,PSGORD) I $G(PSGOORD) D UNL^PSSLOCK(PSGP,PSGOORD)
"RTN","PSJCLOR2",175,0)
 Q
"RTN","PSJCLOR2",176,0)
 ;
"RTN","PSJCLOR2",177,0)
DSPORD(PSGP,TMPORDER,PSJORDAR) ; Display order summary
"RTN","PSJCLOR2",178,0)
 D DSPORD^PSJCLOR5(PSGP,TMPORDER,.PSJORDAR)
"RTN","PSJCLOR2",179,0)
 Q
"RTN","PSJCLOR2",180,0)
 ;
"RTN","PSJCLOR2",181,0)
HDRDT ; Header Date Range
"RTN","PSJCLOR2",182,0)
 Q:'$G(PSJBEG)!'($G(PSJEND))  I $G(PSJTMPED),$P(PSJTMPED,"^",2) S PSJEND=$S($P(PSJTMPED,"^",2)'=$G(PSGP):+PSJTMPED,1:+PSJEND)
"RTN","PSJCLOR2",183,0)
 S VALMHDR(6)="          CLINIC ORDERS: "_$$FMTE^XLFDT(+$G(PSJBEG))_" to "_$$FMTE^XLFDT(+$G(PSJEND))
"RTN","PSJCLOR2",184,0)
 Q
"RTN","PSJCLOR2",185,0)
 ;
"RTN","PSJCLOR2",186,0)
CHGDT ; Change date range
"RTN","PSJCLOR2",187,0)
 N TMPBEG,TMPEND S TMPBEG=+PSJBEG,TMPEND=+PSJEND
"RTN","PSJCLOR2",188,0)
 D BEGDT I '$G(PSJBEG) S PSJBEG=+TMPBEG
"RTN","PSJCLOR2",189,0)
 D ENDDT(PSJBEG) I '$G(PSJEND) S PSJEND=+TMPEND
"RTN","PSJCLOR2",190,0)
 D INIT^PSJCLOR2(3) S VALMBCK="R" D HDR^PSJLMHED($S($G(DFN):DFN,1:$G(PSGP))) D HDRDT^PSJCLOR2
"RTN","PSJCLOR2",191,0)
 Q
"RTN","PSJCLOR2",192,0)
BEGDT ; begin date
"RTN","PSJCLOR2",193,0)
 I '$G(PSJTMPBG) S PSJTMPBG=+PSJBEG_"^"_PSGP
"RTN","PSJCLOR2",194,0)
 W !!?5,"Search for CLINIC Medication Orders with a Start Date/Time"
"RTN","PSJCLOR2",195,0)
 W !?5,"within the date range selected below: "
"RTN","PSJCLOR2",196,0)
 W ! K %DT S %DT("A")="Begin Search Date: ",%DT="TAE",%DT("B")=$P($$FMTE^XLFDT(PSJBEG,1),"@")
"RTN","PSJCLOR2",197,0)
 D ^%DT Q:Y<0!($D(DTOUT))  S (%DT(0),PSJBEG)=Y
"RTN","PSJCLOR2",198,0)
 Q
"RTN","PSJCLOR2",199,0)
ENDDT(BEG) ; end date
"RTN","PSJCLOR2",200,0)
 I $G(BEG) S $P(BEG,".",2)=24
"RTN","PSJCLOR2",201,0)
 I '$G(PSJTMPED) S PSJTMPED=+PSJEND_"^"_PSGP
"RTN","PSJCLOR2",202,0)
 W ! K DIR S DIR(0)="DA^"_BEG_"::TAE",DIR("A")="End Search Date: ",DIR("B")=$$FMTE^XLFDT(BEG) D ^DIR
"RTN","PSJCLOR2",203,0)
 S PSJEND=$S($G(Y):Y,1:BEG) I '$P(PSJEND,".",2) S PSJEND=Y_".24"
"RTN","PSJCLOR2",204,0)
 Q
"RTN","PSJCLOR3")
0^4^B146984380^n/a
"RTN","PSJCLOR3",1,0)
PSJCLOR3 ;BIR/JCH - GET UNIT DOSE/IV CLINIC ORDERS ; 2/28/12 9:11am
"RTN","PSJCLOR3",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**275**;16 DEC 97;Build 157
"RTN","PSJCLOR3",3,0)
 ;
"RTN","PSJCLOR3",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJCLOR3",5,0)
 ; Reference to ^%DTC is supported by DBIA# 10000.
"RTN","PSJCLOR3",6,0)
 ; Reference to ^%ZOSV is supported by DBIA# 10097.
"RTN","PSJCLOR3",7,0)
 ; Reference to XLFDT is supported by DBIA# 10103.
"RTN","PSJCLOR3",8,0)
 ;
"RTN","PSJCLOR3",9,0)
ECHK ;
"RTN","PSJCLOR3",10,0)
 N TMPCLIN S TMPCLIN=+$G(^PS(55,PSGP,5,+O,8)) Q:'$G(TMPCLIN)  Q:($O(PSJCLNAR(""))&'$D(PSJCLNAR(TMPCLIN)))  Q:(PSGSS'="P")&($G(TMPCLIN)'=$G(PSJCURCL))
"RTN","PSJCLOR3",11,0)
 S C="A",ON=+O_"U",START=$G(^PS(55,PSGP,5,+O,2)),STOP=$P(START,U,4),START=$P(START,U,2) S:PSJOS START=-START
"RTN","PSJCLOR3",12,0)
 Q:(STOP<PSGODT)
"RTN","PSJCLOR3",13,0)
 Q:(START>ENDDT)!(STOP<BEGDT)
"RTN","PSJCLOR3",14,0)
 Q:((",D,E,")[(","_$E($P($G(^PS(55,PSGP,5,+O,0)),"^",9))_","))
"RTN","PSJCLOR3",15,0)
 S ND=$G(^PS(55,PSGP,5,+O,0)) G:$S($P(ND,"^",9)="":1,1:",D,DE,DA,"'[(","_$P(ND,"^",9)_",")) SET S ND4=$G(^PS(55,PSGP,5,+O,4)) I ST'="O",$S($P(ND,"^",9)="E":$P(ND4,"^",16),1:0)
"RTN","PSJCLOR3",16,0)
 E  I ST="O",$P(ND,"^",9)="E",$S('$P(ND4,"^",UDU):1,SD<PSGODT:0,1:$P(ND4,"^",16))
"RTN","PSJCLOR3",17,0)
 E  I PSJOL="S",(STOP>$P($G(PSJDCEXP),U,2)) S C="DF" G SET
"RTN","PSJCLOR3",18,0)
 E  Q:PSJOL="S"  S C="O"
"RTN","PSJCLOR3",19,0)
SET ;
"RTN","PSJCLOR3",20,0)
 N PSJCLNM,PSJORANG,DN
"RTN","PSJCLOR3",21,0)
 I ON["P" Q:'$G(^PS(53.1,+ON,"DSS"))  S PSJCLNM=(^("DSS")) Q:(($G(PSGSS)'="P")&'$D(PSJCLNAR(+PSJCLNM)))  Q:((PSGSS'="P")&(+$G(PSJCLNM)'=$G(PSJCURCL)))  D  Q:PSJCLNM=""!$G(PSJORANG)
"RTN","PSJCLOR3",22,0)
 .S PSJCLNM=$P($G(^SC(+PSJCLNM,0)),"^") Q:PSJCLNM=""
"RTN","PSJCLOR3",23,0)
 .N TMPSTRT,TMPSTP S TMPSTRT=$P($G(^PS(53.1,+ON,2)),"^",2),TMPSTP=$P($G(^PS(53.1,+ON,2)),"^",4)
"RTN","PSJCLOR3",24,0)
 .S PSJORANG=((TMPSTRT>PSJEND)!(TMPSTP<PSJBEG))
"RTN","PSJCLOR3",25,0)
 I ON["P",($D(PRNTON)!($D(P("PRNTON")))) N PSJOK S PSJOK=$$COMCHK($S($G(P("PRNTON"))]"":P("PRNTON"),$G(PRNTON)]"":PRNTON,1:""),PSJPTYP) Q:'PSJOK
"RTN","PSJCLOR3",26,0)
 NEW DRUGNAME D DRGDISP^PSJLMUT1(PSGP,ON,40,0,.DRUGNAME,1)
"RTN","PSJCLOR3",27,0)
 S DN=DRUGNAME(1),SUB=$S(PSJOS:START,1:$E(DN,1,40))
"RTN","PSJCLOR3",28,0)
 I ON["P",$G(P("PRNTON"))]"",$G(PRNTON)=+P("PRNTON") Q
"RTN","PSJCLOR3",29,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSJCLOR3",30,0)
 I ON["U" Q:'$G(^PS(55,PSGP,5,+ON,8))  S PSJCLNM=^(8) Q:(PSGSS'="P")&('$D(PSJCLNAR(+PSJCLNM)))  S PSJCLNM=$P($G(^SC(+PSJCLNM,0)),"^") Q:PSJCLNM=""
"RTN","PSJCLOR3",31,0)
 S ^TMP("PSJ",$J,PSJCLNM,C,$S(PSJOS:SUB,1:ST),$S(PSJOS:ST,1:SUB),ON)=DN_"^"_$G(NF),PSJOCNT=PSJOCNT+1 Q
"RTN","PSJCLOR3",32,0)
IVSET ;Set IV data in ^TMP("PSJ",$J,.
"RTN","PSJCLOR3",33,0)
 N DRG,DRGT,ON55,ORTX,P,STAT,TYP,X,Y,NAME,ND,PSJCLNM
"RTN","PSJCLOR3",34,0)
 I ON["V" S ON55=ON,Y=$G(^PS(55,DFN,"IV",+ON,0)),PSJCLNM=$P(^PS(55,DFN,"IV",+ON,"DSS"),"^") F X=2,3,4,9,17 S P(X)=$P(Y,U,X)
"RTN","PSJCLOR3",35,0)
 I ON["V",(P(2)=""),(P(3)="") Q
"RTN","PSJCLOR3",36,0)
 I ON'["V" S ND=$G(^PS(53.1,+ON,0)) I 'ND K ^PS(53.1,"AS",SD,PSGP,+ON) Q
"RTN","PSJCLOR3",37,0)
 I ON'["V",ND S P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4),P(4)=$P($G(^PS(53.1,+ON,8)),U),P("PRNTON")=$P($G(^PS(53.1,+ON,.2)),U,8)
"RTN","PSJCLOR3",38,0)
 I ON'["V",P("PRNTON")]"" N PSJOK S PSJOK=$$COMCHK(P("PRNTON"),PSJPTYP) Q:'PSJOK
"RTN","PSJCLOR3",39,0)
 D @$S(ON["V":"GTDRG^PSIVORFB",1:"GTDRG^PSIVORFA"),GTOT^PSIVUTL(P(4))
"RTN","PSJCLOR3",40,0)
 I $G(DRG) S DRGT=$S($G(DRG("AD",1))]"":$P($G(DRG("AD",1)),U,2),1:$P($G(DRG("SOL",1)),U,2)),ORTX=DRGT
"RTN","PSJCLOR3",41,0)
 I $G(ORTX)="",(ON'["V") D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,"",.NAME,1) S ORTX=NAME(1)
"RTN","PSJCLOR3",42,0)
 S:$G(ORTX)="" ORTX="NOT FOUND"
"RTN","PSJCLOR3",43,0)
IVSET1 ;
"RTN","PSJCLOR3",44,0)
 S TYP=$$ONE^PSJBCMA(PSGP,ON,P(9),P(2),P(3)) I TYP'="O" S TYP=$S(ON["P":"z",1:"C")
"RTN","PSJCLOR3",45,0)
 S STAT=$S($G(PSJPRI)="D":"A","ED"[P(17):"O",P(17)="P":"P",1:"A")
"RTN","PSJCLOR3",46,0)
 I P(17)="P"!(P(17)["D")!(P(17)="E") Q
"RTN","PSJCLOR3",47,0)
 I PSJOL="S",(STAT="O"),(P(3)>$P($G(PSJDCEXP),U,2)) S STAT="DF"
"RTN","PSJCLOR3",48,0)
 I ON["P",$G(P("PRNTON"))]"" Q:(PRNTON=+P("PRNTON"))  S PRNTON=+P("PRNTON"),ON=+P("PRNTON"),PSJCLNM=$P($G(^PS(53.1,+ON,"DSS")),"^")
"RTN","PSJCLOR3",49,0)
 Q:'$G(PSJCLNM)  Q:(PSGSS'="P")&('$D(PSJCLNAR(+PSJCLNM)))  Q:((PSGSS'="P")&($G(PSJCURCL)'=(PSJCLNM)))  S PSJCLNM=$P($G(^SC(+PSJCLNM,0)),"^") Q:PSJCLNM=""
"RTN","PSJCLOR3",50,0)
 S ^TMP("PSJ",$J,PSJCLNM,STAT,$S(PSJOS:-P(2),1:TYP),$S(PSJOS:TYP,1:ORTX),ON)="^F",PSJOCNT=PSJOCNT+1
"RTN","PSJCLOR3",51,0)
 Q
"RTN","PSJCLOR3",52,0)
ENU ; update status field to reflect expired orders, if necessary
"RTN","PSJCLOR3",53,0)
 W !!,"...a few moments, I have some updating to do..."
"RTN","PSJCLOR3",54,0)
ENUNM ;
"RTN","PSJCLOR3",55,0)
 F Q=+PSJPAD:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q!(Q>PSGDT)  S UPD=Q F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,0)),"DEH"'[$E($P(^(0),"^",9)) D
"RTN","PSJCLOR3",56,0)
 .; naked ref below refers to line above
"RTN","PSJCLOR3",57,0)
 .S $P(^(0),"^",9)="E",ORIFN=$P(^(0),"^",21) D EN1^PSJHL2(PSGP,"SC",QQ_"U")
"RTN","PSJCLOR3",58,0)
 K UPD Q
"RTN","PSJCLOR3",59,0)
EN(PSJPTYP) ; enter here to find clinic orders meeting search criteria, store in ^TMP
"RTN","PSJCLOR3",60,0)
 ; PSJPTYP=1:UD ONLY, 2:IV ONLY, 3:BOTH
"RTN","PSJCLOR3",61,0)
 N PSJX,PSJY,BEGDT,ENDDT,ON,P,PSJORD,PSJIVOF,PSJOCNT,QQ,SD,START,STOP,SUB,UDU,PSIVCLND
"RTN","PSJCLOR3",62,0)
 S BEGDT=$S($G(PSJBEG):PSJBEG,1:1500101) S ENDDT=$S($G(PSJEND):PSJEND,1:$$FMADD^XLFDT(PSGDT,3650)) S BEGDT=$$FMADD^XLFDT(BEGDT,,,-1),ENDDT=$$FMADD^XLFDT(ENDDT,,,1)
"RTN","PSJCLOR3",63,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJCLOR3",64,0)
 S PSJOL=$G(PSJOL)  ; Initialize if no 'View Profile' option selected
"RTN","PSJCLOR3",65,0)
 I PSJOL="L",$D(XRTL) D T0^%ZOSV
"RTN","PSJCLOR3",66,0)
 K ^TMP("PSJ",$J) D NOW^%DTC S PSGDT=+$E(%,1,12),DT=$$DT^XLFDT,PSJOS=$P(PSJSYSP0,"^",11),UDU=$S($P(PSJSYSU,";",3)>1:3,1:1)
"RTN","PSJCLOR3",67,0)
 S PSJOCNT=0 I PSJPTYP>1 S PSJORD=0 F  S PSJORD=$O(^PS(55,DFN,"IV",PSJORD)) Q:'PSJORD  D
"RTN","PSJCLOR3",68,0)
 .S PSIVCLND=$G(^PS(55,DFN,"IV",PSJORD,"DSS")) Q:'$P(PSIVCLND,"^")!'$P(PSIVCLND,"^",2)
"RTN","PSJCLOR3",69,0)
 .S PSJX=$G(^PS(55,DFN,"IV",+PSJORD,0)) Q:($P(PSJX,"^",2)>$G(PSJEND))!($P(PSJX,"^",3)<$G(PSJBEG))
"RTN","PSJCLOR3",70,0)
 .S PSJY=$P(PSJX,U,17)
"RTN","PSJCLOR3",71,0)
 .I $P(PSJX,U,3)<PSGDT,"AR"[PSJY S $P(^PS(55,DFN,"IV",+PSJORD,0),U,17)="E",PSJY="E",ON=+PSJORD D EXPIR^PSIVOE
"RTN","PSJCLOR3",72,0)
 .I +PSJSYSU=3,('+$P($G(^PS(55,DFN,"IV",+PSJORD,4)),U,4)),($P($G(^(.2)),U,4)="D") S PSJPRI="D"
"RTN","PSJCLOR3",73,0)
 .I $S($G(PSJPRI)="D":0,PSJY="P":0,$P(PSJX,U,3)>$P($G(PSJDCEXP),U,2):1,1:("DPE"'[$E(PSJY))) S ON=+PSJORD_"V" D IVSET K PSJPRI,ON
"RTN","PSJCLOR3",74,0)
 D NOW^%DTC S PSJIVOF=PSJOCNT,PSGDT=%,(X1,DT)=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT)
"RTN","PSJCLOR3",75,0)
 D ENUNM
"RTN","PSJCLOR3",76,0)
 F ST="C","O","OC","P","R" S SD=0 F  S SD=$O(^PS(55,DFN,5,"AU",ST,SD)) Q:'SD  S O=0 F  S O=$O(^PS(55,DFN,5,"AU",ST,SD,O)) Q:'O  D ECHK
"RTN","PSJCLOR3",77,0)
 N PRNTON F SD="I","N" S (PRNTON,O)=0 F  S O=$O(^PS(53.1,"AS",SD,DFN,O)) Q:'O  S ON=+O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D NVSET
"RTN","PSJCLOR3",78,0)
 I PSJOL="L",$D(XRT0) S XRTN="PSJO1" D T1^%ZOSV
"RTN","PSJCLOR3",79,0)
 D KILL
"RTN","PSJCLOR3",80,0)
 Q
"RTN","PSJCLOR3",81,0)
NVSET ; Set up orders from 53.1.
"RTN","PSJCLOR3",82,0)
 N ND S ND=$G(^PS(53.1,O,0)) I 'ND D  Q
"RTN","PSJCLOR3",83,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJCLOR3",84,0)
 I $P(ND,U,15),$G(PSGP) I PSGP'=$P(ND,U,15) D  Q
"RTN","PSJCLOR3",85,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJCLOR3",86,0)
 I $P(ND,U,9)["D" D  Q
"RTN","PSJCLOR3",87,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJCLOR3",88,0)
 .N ND2 S ND2=$G(^PS(53.1,O,.2)) I $P(ND2,U,8) K ^PS(53.1,"ACX",$P(ND2,U,8))
"RTN","PSJCLOR3",89,0)
 Q:$P(ND,U,9)="E"
"RTN","PSJCLOR3",90,0)
 S ST=$P($G(^PS(53.1,O,0)),U,7),START=-$P($G(^(2)),U,2),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSJCLOR3",91,0)
 S C=$S(((SD="N")&($P($G(^PS(53.1,O,.2)),U,8)]"")):"BD",SD="N":"BA",SD="I":"BB",$P($G(^PS(53.1,O,.2)),U,8)]"":"CD",$P($G(^PS(53.1,O,.2)),U,4)="S":"CA",$P($G(^(0)),U,24)="R":"CC",1:"CB")
"RTN","PSJCLOR3",92,0)
 D SET
"RTN","PSJCLOR3",93,0)
 Q
"RTN","PSJCLOR3",94,0)
KILL ;
"RTN","PSJCLOR3",95,0)
 K P,STAT,TYP,ORTX,N,JJ,DTOUT,%,C,HDT,I,LINE,ND4,NF,O,OK,ORIFN,PSGODT,PSJOCNT,Q,QQ,SD,ST,START,STOP,SUB,UDU,VAIP,VALMBCK,X1,X2
"RTN","PSJCLOR3",96,0)
 Q
"RTN","PSJCLOR3",97,0)
COMCHK(PSJCOM,PSJPTYP) ;Check complex orders for order type
"RTN","PSJCLOR3",98,0)
 N OK S OK=0
"RTN","PSJCLOR3",99,0)
 I PSJCOM=0 S OK=1 Q OK
"RTN","PSJCLOR3",100,0)
 I PSJCOM=""  Q OK
"RTN","PSJCLOR3",101,0)
 I PSJPTYP="" Q OK
"RTN","PSJCLOR3",102,0)
 I '$D(^PS(53.1,"ACX",PSJCOM)) Q OK
"RTN","PSJCLOR3",103,0)
 S OK=1 I PSJPTYP=3 Q OK
"RTN","PSJCLOR3",104,0)
 N PSJON S PSJON=""
"RTN","PSJCLOR3",105,0)
 F  S PSJON=$O(^PS(53.1,"ACX",PSJCOM,PSJON)) Q:'PSJON  D  Q:OK=0
"RTN","PSJCLOR3",106,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",9)["D" K ^PS(53.1,"ACX",PSJCOM)
"RTN","PSJCLOR3",107,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)'="U",PSJPTYP=1 S OK=0 Q
"RTN","PSJCLOR3",108,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)="U",PSJPTYP=2 S OK=0 Q
"RTN","PSJCLOR3",109,0)
 Q OK
"RTN","PSJCLOR3",110,0)
PRMPTOR ; Prompt for order numbers
"RTN","PSJCLOR3",111,0)
 K DIR N PSJSELOR,PSJOTOT S PSJOTOT=+$G(^TMP("PSJPRO",$J,0))
"RTN","PSJCLOR3",112,0)
 S PSJSELOR=$P(XQORNOD(0),"=",2)
"RTN","PSJCLOR3",113,0)
 S DIR(0)="LO^"_$S(+PSJOTOT:"1:"_+PSJOTOT,1:"") S DIR("A")=$S($G(PSJOTOT):"Select Orders",1:"Quit") D ^DIR
"RTN","PSJCLOR3",114,0)
 I ($G(Y)<1) S VALMBCK="R" Q
"RTN","PSJCLOR3",115,0)
 S PSJSELOR=$P(Y(0),",",1,$L(Y(0),",")-1)
"RTN","PSJCLOR3",116,0)
 D PRMPTSD
"RTN","PSJCLOR3",117,0)
 Q
"RTN","PSJCLOR3",118,0)
PRMPTSD ; Prompt for start date/time
"RTN","PSJCLOR3",119,0)
 N PSJQMSG,PSJNEWSD,TMPSELOR,TMPORDER,PSJABORT,PSJSYSW,PSJSYSW0,PSJCLSEL,PSJASTRK,PSJNWDTE,TMPSTR,TMPSTP,PSJREVFY,PSJMATCH,DFN,PSJTMPXQ,PSJNOLOK
"RTN","PSJCLOR3",120,0)
 N CHKSEL,CHKSEL2,STAT,TMPO,TMPC,I K DIR
"RTN","PSJCLOR3",121,0)
 S:$G(XQORNOD) PSJTMPXQ=XQORNOD S PSJNOLOK=0
"RTN","PSJCLOR3",122,0)
 S PSJSYSW0="",PSJSYSW=0,PSJPWD="",DFN=$G(PSGP),PSJREVFY=0 S:'$D(PSGSS) PSGSS=PSGSSAV
"RTN","PSJCLOR3",123,0)
 I '$G(PSJPAD) N PSJPAD D IN5^VADPT S PSJPAD=+VAIP(13,1)
"RTN","PSJCLOR3",124,0)
 S:'$G(PSJSELOR) PSJSELOR=$P(XQORNOD(0),"=",2) I $D(^TMP("PSJCLOR",$J)) K ^TMP("PSJON",$J) M ^TMP("PSJON",$J)=^TMP("PSJCLOR",$J)
"RTN","PSJCLOR3",125,0)
 D ENCV^PSGSETU S $P(PSJASTRK,"*",52)="*"
"RTN","PSJCLOR3",126,0)
 S TMPSELOR=PSJSELOR
"RTN","PSJCLOR3",127,0)
 D ORDCHK^PSJCLOR5 I ($G(PSJABORT)>1) S VALMBCK="R" Q
"RTN","PSJCLOR3",128,0)
 I ($G(TMPSELOR)'=$G(PSJSELOR)) S (Y,PSJSELOR)=TMPSELOR
"RTN","PSJCLOR3",129,0)
 I '$TR(PSJSELOR,",") D  S VALMBCK="R" Q
"RTN","PSJCLOR3",130,0)
 .W !,"  No editable orders have been selected - please re-select",! D CONT^PSJOE0
"RTN","PSJCLOR3",131,0)
 D FULL^VALM1 F  D PRMPTSD2 Q:'$G(PSJQMSG)
"RTN","PSJCLOR3",132,0)
 I '$G(PSJNEWSD)!'$G(PSJSELOR) K PSJSELOR,VALMHDR S VALMBCK="R" Q
"RTN","PSJCLOR3",133,0)
 N PSJDTTMP S PSJDTTMP=$P(PSJNEWSD,".") F  S PSJDTTMP=$O(^PS(55,PSGP,5,"AUS",PSJDTTMP)) Q:'PSJDTTMP  S PSJONTMP=0 F  S PSJONTMP=$O(^PS(55,PSGP,5,"AUS",PSJDTTMP,PSJONTMP)) Q:'PSJONTMP  D
"RTN","PSJCLOR3",134,0)
 .S TMPC="" F  S TMPC=$O(^TMP("PSJON",$J,TMPC)) Q:'TMPC  S TMPO=^(TMPC) I TMPO["P"!(TMPO["U"&(+TMPO=+PSJONTMP)) I ((","_PSJSELOR)[(","_TMPC_",")) S PSJMATCH=-1
"RTN","PSJCLOR3",135,0)
 .F CHKSEL=1:1:$L(PSJSELOR,",") Q:($G(PSJMATCH)<0)!(CHKSEL="")!'$D(^TMP("PSJON",$J,CHKSEL))  S CHKSEL2=$G(^TMP("PSJON",$J,CHKSEL)) I CHKSEL2=+PSJONTMP_"U" S PSJMATCH=-1
"RTN","PSJCLOR3",136,0)
 .I ($G(PSJMATCH)<0) S PSJMATCH=0 Q
"RTN","PSJCLOR3",137,0)
 .S STAT=$P($G(^PS(55,PSGP,5,+PSJONTMP,0)),"^",9) Q:STAT'="A"
"RTN","PSJCLOR3",138,0)
 .I ($P($G(^PS(55,PSGP,5,+PSJONTMP,2)),"^",2)<PSJNEWSD)&($P($G(^PS(55,PSGP,5,+PSJONTMP,2)),"^",4)>PSJNEWSD) S PSJMATCH=1,PSJMATCH(+PSJONTMP_"U")="" Q
"RTN","PSJCLOR3",139,0)
 .I $P($P($G(^PS(55,PSGP,5,+PSJONTMP,2)),"^",2),".")=$P(PSJNEWSD,"^") S PSJMATCH=1,PSJMATCH(+PSJONTMP_"U")=""
"RTN","PSJCLOR3",140,0)
 N PSJDTTMP S PSJDTTMP=$P(PSJNEWSD,".") F  S PSJDTTMP=$O(^PS(55,PSGP,"IV","AIS",PSJDTTMP)) Q:'PSJDTTMP  S PSJONTMP=0 F  S PSJONTMP=$O(^PS(55,PSGP,"IV","AIS",PSJDTTMP,PSJONTMP)) Q:'PSJONTMP  D
"RTN","PSJCLOR3",141,0)
 .S TMPC="" F  S TMPC=$O(^TMP("PSJON",$J,TMPC)) Q:'TMPC  S TMPO=$G(^(TMPC)) I TMPO["P"!(TMPO["V"&(+TMPO=+PSJONTMP)) I ((","_PSJSELOR)[(","_TMPC_",")) S PSJMATCH=-1
"RTN","PSJCLOR3",142,0)
 .F CHKSEL=1:1:$L(PSJSELOR,",") Q:($G(PSJMATCH)<0)!(CHKSEL="")  S CHKSEL2=$G(^TMP("PSJON",$J,CHKSEL)) I CHKSEL2=+PSJONTMP_"V" S PSJMATCH=-1
"RTN","PSJCLOR3",143,0)
 .I ($G(PSJMATCH)<0) S PSJMATCH=0 Q
"RTN","PSJCLOR3",144,0)
 .S STAT=$P($G(^PS(55,PSGP,"IV",+PSJONTMP,0)),"^",17) Q:STAT'="A"
"RTN","PSJCLOR3",145,0)
 .I $P($G(^PS(55,PSGP,"IV",+PSJONTMP,0)),"^",2)<PSJNEWSD&($P($G(^PS(55,PSGP,"IV",+PSJONTMP,0)),"^",3)>PSJNEWSD) S PSJMATCH=1,PSJMATCH(+PSJONTMP_"V")="" Q
"RTN","PSJCLOR3",146,0)
 .I $P($P($G(^PS(55,PSGP,"IV",+PSJONTMP,0)),"^",2),".")=$P(PSJNEWSD,".") S PSJMATCH=1,PSJMATCH(+PSJONTMP_"V")=""
"RTN","PSJCLOR3",147,0)
 ;
"RTN","PSJCLOR3",148,0)
 K TMPSTP,TMPSTR N ND0,ND2,NDP1
"RTN","PSJCLOR3",149,0)
 I $G(PSJNEWSD) F PSJCLSEL=1:1:$L(PSJSELOR) S TMPSELOR=$P(PSJSELOR,",",PSJCLSEL) Q:'TMPSELOR  S TMPORDER=$G(^TMP("PSJON",$J,TMPSELOR)) Q:TMPORDER=""  D
"RTN","PSJCLOR3",150,0)
 .S ND0=$S(TMPORDER["U":$G(^PS(55,PSGP,5,+TMPORDER,0)),TMPORDER["P":$G(^PS(53.1,+TMPORDER,0)),TMPORDER["V":$G(^PS(55,PSGP,"IV",+TMPORDER,0)),1:"")
"RTN","PSJCLOR3",151,0)
 .S ND2=$S(TMPORDER["U":$G(^PS(55,PSGP,5,+TMPORDER,2)),TMPORDER["P":$G(^PS(53.1,+TMPORDER,2)),TMPORDER["V":$G(^PS(55,PSGP,"IV",+TMPORDER,2)),1:"")
"RTN","PSJCLOR3",152,0)
 .S TMPSTP=$S(TMPORDER["U"!(TMPORDER["P"):$P(ND2,"^",4),TMPORDER["V":$P(ND0,"^",3),1:"") I TMPSTP<PSJNEWSD S TMPSTP($P(TMPSTP,"."))=""
"RTN","PSJCLOR3",153,0)
 ;
"RTN","PSJCLOR3",154,0)
 I $G(PSJMATCH)!($O(TMPSTP("")))!($D(PSJMATCH)>1) D  Q:($G(PSJABORT)=2)
"RTN","PSJCLOR3",155,0)
 .K DIR N TMPCNT,PSJBLANK,PSJDASH S TMPCNT=1 D FULL^VALM1 K DIR N X,Y S DIR("A")="Do you want to view the profile",DIR("A",TMPCNT)=" ",TMPCNT=$G(TMPCNT)+1
"RTN","PSJCLOR3",156,0)
 .S $P(PSJBLANK," ",75)="",$P(PSJDASH,"-",75)="-"
"RTN","PSJCLOR3",157,0)
 .I $O(TMPSTP("")) W !!,"        * The new start date is after one or more stop date(s). * ",!,"  The stop date(s) will be automatically changed to reflect the new start date.",! D
"RTN","PSJCLOR3",158,0)
 ..N DIR D CONT^PSJOE0
"RTN","PSJCLOR3",159,0)
 .I ($D(PSJMATCH)>1) W !!,"      * This patient has active order(s) on "_$$FMTE^XLFDT($P(PSJNEWSD,"."))_". *" D
"RTN","PSJCLOR3",160,0)
 ..W !,"Active Order(s)"_$E(PSJBLANK,1,30)_"Current Start / Stop Dates",!,PSJDASH
"RTN","PSJCLOR3",161,0)
 .I $G(PSJMATCH)!($D(PSJMATCH)>1) N TMPONST,TMPOINF,PSIVCNT S TMPONST=0 F PSIVCNT=1:1 S TMPONST=$O(PSJMATCH(TMPONST)) Q:'TMPONST  D
"RTN","PSJCLOR3",162,0)
 ..N DSPLN,PSIVLCNT K TMPOINF S TMPOINF=1 D DSPORD^PSJCLOR2(PSGP,TMPONST,.TMPOINF) S DSPLN=0 F PSIVLCNT=1:1 S DSPLN=$O(TMPOINF(DSPLN)) Q:'DSPLN  D
"RTN","PSJCLOR3",163,0)
 ...I '(PSIVCNT#8)&(PSIVLCNT=1) W ! N DIR D CONT^PSJOE0,CLEAR^VALM1,FULL^VALM1 W !,"Active Order(s) on "_$$FMTE^XLFDT($P(PSJNEWSD,"."))_" (CONTINUED)",!!,"Active Order(s) (CONTINUED)"_$E(PSJBLANK,1,20)_"Current Start / Stop Dates",!,PSJDASH
"RTN","PSJCLOR3",164,0)
 ...W !,TMPOINF(DSPLN)
"RTN","PSJCLOR3",165,0)
 .S DIR("A",TMPCNT+1)="" S DIR(0)="Y" D ^DIR S PSJABORT=$S(Y>0:0,(Y="^"):2,1:1)
"RTN","PSJCLOR3",166,0)
 .I $G(PSJABORT) S VALMBCK="R"
"RTN","PSJCLOR3",167,0)
 I $G(PSJMATCH)!$O(TMPSTP(""))!($D(PSJMATCH)>1) I '$G(PSJABORT) D ^PSJHVARS N VAIN,VADM,PSJLM D FULL^VALM1,ENOR^PSJCLOR4(PSGP) D RESTORE^PSJHVARS S VALMBCK="R"
"RTN","PSJCLOR3",168,0)
 D FULL^VALM1 W !
"RTN","PSJCLOR3",169,0)
 I $G(PSJNEWSD) F PSJCLSEL=1:1:$L(PSJSELOR) S TMPSELOR=$P(PSJSELOR,",",PSJCLSEL) Q:'TMPSELOR  S TMPORDER=$G(^TMP("PSJON",$J,TMPSELOR)) Q:TMPORDER=""  D
"RTN","PSJCLOR3",170,0)
 .I PSJCLSEL=1 W !,"Selected Orders:",?45,"Current Start / Stop Dates",!,$G(PSJHLIN)
"RTN","PSJCLOR3",171,0)
 .D DSPORD^PSJCLOR2(PSGP,TMPORDER) I '(PSJCLSEL#7) N DIR W ! D CONT^PSJOE0,CLEAR^VALM1,FULL^VALM1 W !,"Selected Orders (CONTINUED):",?45,"Current Start / Stop Dates",!,$G(PSJHLIN)
"RTN","PSJCLOR3",172,0)
 I $G(PSJCLSEL)>1 W !,$G(PSJHLIN)
"RTN","PSJCLOR3",173,0)
 ;
"RTN","PSJCLOR3",174,0)
 S PSJNWDTE=$P($$FMTE^XLFDT(PSJNEWSD,2),":",1,2),PSJNWDTE=$P(PSJNWDTE,"@")_"  "_$P(PSJNWDTE,"@",2)
"RTN","PSJCLOR3",175,0)
 K DIR,X,Y S DIR(0)="Y",DIR("A",1)="  ",DIR("A",2)="      The Start Date/Time for the selected order"_$S(($L(PSJSELOR,",")-2):"s",1:"")_" will"
"RTN","PSJCLOR3",176,0)
 S DIR("A",3)="        now be changed to "_PSJNWDTE,DIR("A",4)="    "
"RTN","PSJCLOR3",177,0)
 S DIR("A")=" ",DIR("A")="Are you sure " D ^DIR I '$G(Y) K PSJNEWSD W "     ** NOTHING CHANGED **" H 1
"RTN","PSJCLOR3",178,0)
 K TMPARRAY I $G(PSJNEWSD) F PSJCLSEL=1:1:$L(PSJSELOR) S TMPSELOR=$P(PSJSELOR,",",PSJCLSEL) Q:'TMPSELOR  S TMPORDER=$G(^TMP("PSJON",$J,TMPSELOR)) Q:TMPORDER=""  S TMPARRAY($J,TMPSELOR)=TMPORDER
"RTN","PSJCLOR3",179,0)
 I $D(TMPARRAY),$G(PSJNEWSD) F PSJCLSEL=1:1:$L(PSJSELOR) S TMPSELOR=$P(PSJSELOR,",",PSJCLSEL) Q:'TMPSELOR  S TMPORDER=$G(TMPARRAY($J,TMPSELOR)) Q:TMPORDER=""  D
"RTN","PSJCLOR3",180,0)
 .N PSJDASH1,PSJDASH2 S $P(PSJDASH1,"-",70)="-" S PSJDASH2=PSJDASH1 F I=2:2:70 S $E(PSJDASH2,I)=" "
"RTN","PSJCLOR3",181,0)
 .W !!,PSJDASH1,!,PSJDASH1,!,"Now working on order: " D DSPORD^PSJCLOR2(PSGP,TMPORDER)
"RTN","PSJCLOR3",182,0)
 .I TMPORDER["U"!(TMPORDER["P")!(TMPORDER["V") D NEWORDER^PSJCLOR2(PSGP,TMPORDER,PSJNEWSD,$S($G(PSJREVFY):PSJREVFY,1:$G(PSGOEAV))) I $G(PSJNOLOK) S PSJNOLOK=0 Q
"RTN","PSJCLOR3",183,0)
 .I PSJNEWSD>PSJEND S PSJEND=$P(PSJNEWSD,".")_".24",$P(PSJTMPED,"^",2)=PSGP
"RTN","PSJCLOR3",184,0)
 .D INIT^PSJCLOR2(3) S VALMBCK="R"
"RTN","PSJCLOR3",185,0)
 K PSJSELOR,VALMHDR,TMPARRAY S VALMBCK="R"
"RTN","PSJCLOR3",186,0)
 Q
"RTN","PSJCLOR3",187,0)
PRMPTSD2 ;
"RTN","PSJCLOR3",188,0)
 K DIR,X,Y N TMPY S PSJQMSG=0
"RTN","PSJCLOR3",189,0)
 K %DT S %DT("A")="Enter new Start Date/Time: ",%DT="TAE"
"RTN","PSJCLOR3",190,0)
 D ^%DT Q:Y<0!($D(DTOUT))
"RTN","PSJCLOR3",191,0)
 S TMPY=Y I TMPY["^" S PSJQMSG=0 Q
"RTN","PSJCLOR3",192,0)
 I $E(TMPY)="?" K DIR,X,Y D ENHLP^PSGOEM(55.06,10) S PSJQMSG=1 Q
"RTN","PSJCLOR3",193,0)
 I TMPY'["." W $C(7),!?5," Time is REQUIRED. Re-enter Start Date. " S PSJQMSG=1 Q
"RTN","PSJCLOR3",194,0)
 I TMPY<($$FMADD^XLFDT(PSGDT,,,-1)) W $C(7),!?3,"Start Date/Time earlier than NOW is not allowed. Re-enter Start Date. " S PSJQMSG=1 Q
"RTN","PSJCLOR3",195,0)
 I TMPY>($$FMADD^XLFDT(PSGDT,365)) W $C(7),!?3,"Start Date cannot be more than 365 days from today. Re-enter Start Date." S PSJQMSG=1 Q
"RTN","PSJCLOR3",196,0)
 S TMPNEWSD=TMPY
"RTN","PSJCLOR3",197,0)
 Q:$G(PSJQMSG)
"RTN","PSJCLOR3",198,0)
 S PSJNEWSD=TMPNEWSD
"RTN","PSJCLOR3",199,0)
 Q
"RTN","PSJCLOR4")
0^8^B76629306^n/a
"RTN","PSJCLOR4",1,0)
PSJCLOR4 ;BIR/JCH - INPATIENT MEDICATIONS PROFILE FOR CLINIC ORDERS ;25 SEP 97 / 7:43 AM
"RTN","PSJCLOR4",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**275**;16 DEC 97;Build 157
"RTN","PSJCLOR4",3,0)
 ;
"RTN","PSJCLOR4",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJCLOR4",5,0)
 ;
"RTN","PSJCLOR4",6,0)
 N PFLG,PSJNEW,PSGPTMP,PPAGE,QFLG S PSJNEW=1
"RTN","PSJCLOR4",7,0)
 N PSGLI,PSGWD,PSJAT,PSJPNRB,PSJPWDO,PSJSTOP,PSJTEAM
"RTN","PSJCLOR4",8,0)
 ;
"RTN","PSJCLOR4",9,0)
EN ;
"RTN","PSJCLOR4",10,0)
 G:$D(XQUIT) DONE
"RTN","PSJCLOR4",11,0)
 D @$S('$D(PSJEXTP):"^PSIVXU",1:"ENCV^PSGSETU")
"RTN","PSJCLOR4",12,0)
 G:$D(XQUIT) DONE S PSGPTMP=0,PPAGE=1 K PSJSEL D @$S($D(PSJEXTP):"P^PSJPDIR",1:"GWP^PSJPDIR") G:$G(PSJSTOP)=1 DONE S:$D(PSJEXTP) PSJSEL("SELECT")="P"
"RTN","PSJCLOR4",13,0)
 I $G(PSJSEL("WG"))="^OTHER",PSJSEL("SELECT")="G",PSJSTOP=2 S PSJSEL("SELECT")="C",PSJSEL("RBP")="P"
"RTN","PSJCLOR4",14,0)
 D ENL^PSJO3 G:"^N"[PSJOL EN D GO
"RTN","PSJCLOR4",15,0)
 ;
"RTN","PSJCLOR4",16,0)
DONE ;
"RTN","PSJCLOR4",17,0)
 K ^TMP("PSJON",$J),^TMP("PSJ",$J)
"RTN","PSJCLOR4",18,0)
 D ENIVKV^PSGSETU K AND,AT,C,CA,DDH,DFN,DN,DOB,DRGI,DRGN,DRGT,FIL,FQC,HDR,I1,J,JJ,MF,NF,O,OD,ON,ON55,P,P1,PDRG,PG,PPN,PRI,PRIV,PSGLMT,PSGOE,PSGONC,PSGONR,PSGONV,PSGORD,PSGSS,PSGSSH,PSGON,PSGPR,PSGPRP
"RTN","PSJCLOR4",19,0)
 K PSIVAC,PSIVCT,PSIVREA,PSIVSCR,PSIVUP,PSIVX,CLINIC,JDFN,POP,PSGTIR,PSJEXTP,PSJNKF,DTOUT,DUOUT,Q,STDTE,X,Y,ZTDESC
"RTN","PSJCLOR4",20,0)
 K PSJACNWP,PSJACOK,PSJDEV,PSJDBL,PSJION,PSJON,PSJOS,PSJP,PSJSEL,PSJSS,PSJSSH,PSJPRW,PSJPRWN,PSJPRWG,PSJPRWGN
"RTN","PSJCLOR4",21,0)
 K PSJOPC,PSJORD,PSJQ,PSJIVOF,PSJOCNT,PSJPR,PSJPRA,PSJPRF,PSJPRP,PSJON,PSJS1,PSJS2,PSJS3,PSJS4,PSJPR,PX,HDT,PSGODT,RF,SD,SLS,SSN,TF,UD,WD,WDP,WT,PSJORIFN,RB,RCT,SUB,XQUIT,ZTOUT
"RTN","PSJCLOR4",22,0)
 Q
"RTN","PSJCLOR4",23,0)
 ;
"RTN","PSJCLOR4",24,0)
GO ;
"RTN","PSJCLOR4",25,0)
 S PSJPRP="P",PSJPRA="" G:PSJSEL("SELECT")'="P" DEV
"RTN","PSJCLOR4",26,0)
 N DIR S DIR(0)="SAO^P:PROFILE;E:EXPANDED VIEWS;B:BOTH",DIR("A")="Show PROFILE only, EXPANDED VIEWS only, or BOTH: ",DIR("B")="PROFILE",DIR("?")="^D PH^PSJPR" W ! D ^DIR G:"^"[Y EN S PSJPRP=Y
"RTN","PSJCLOR4",27,0)
 I "EB"[PSJPRP F  R !!,"Show SHORT, LONG, or NO activity log?  NO// ",AT:DTIME D ALC^PSGVW0 I Q S PSJPRA=AT Q
"RTN","PSJCLOR4",28,0)
 G:PSJPRA="^" EN
"RTN","PSJCLOR4",29,0)
DEV ;
"RTN","PSJCLOR4",30,0)
 S PSJOS=$P(PSJSYSP0,"^",11)
"RTN","PSJCLOR4",31,0)
 K ZTSAVE S PSGTIR="ENQ^PSJCLOR4",ZTDESC="INPATIENT PATIENT PROFILE" F X="DFN","PSJSEL(","PSJOL","PSJOS","PSJPRA","PSJPRP","PSGPTMP","PPAGE","PSJEXTP","PSJHDATE" S ZTSAVE(X)=""
"RTN","PSJCLOR4",32,0)
 D ENQ
"RTN","PSJCLOR4",33,0)
 K DIR S DIR(0)="YO",DIR("A")="Print this profile to a printer",DIR("B")="N" D ^DIR I $G(Y) D ENDEV^PSGTI Q:POP  D:'$D(IO("Q")) ENQ
"RTN","PSJCLOR4",34,0)
 Q
"RTN","PSJCLOR4",35,0)
 ;
"RTN","PSJCLOR4",36,0)
ENQ ;
"RTN","PSJCLOR4",37,0)
 S Y="PSJPR" F X="W","WG" S:$D(PSJSEL(X)) @(Y_X)=+PSJSEL(X),@(Y_X_"N")=$P(PSJSEL(X),U,2)
"RTN","PSJCLOR4",38,0)
 S PSJACNWP=1 K ^TMP("PSJAT",$J) S PSJPR=IO'=IO(0)!($E(IOST)'="C"),PSGPRP=PSJPRP
"RTN","PSJCLOR4",39,0)
 I PSJSEL("SELECT")="P" S PPN="" F  S PPN=$O(PSJSEL("P",PPN)) Q:PPN=""  D  Q:$G(X)?1"^"."^"
"RTN","PSJCLOR4",40,0)
 .F DFN=0:0 S (PSGP,DFN)=$O(PSJSEL("P",PPN,DFN)) Q:'DFN  D ENBOTH^PSJAC,PP Q:$G(X)?1"^"."^"
"RTN","PSJCLOR4",41,0)
 D:PSJSEL("SELECT")'="P" @("P"_PSJSEL("SELECT")) I PSJPR W:$Y @IOF D ^%ZISC,DONE
"RTN","PSJCLOR4",42,0)
 Q
"RTN","PSJCLOR4",43,0)
PC ;
"RTN","PSJCLOR4",44,0)
 K ^TMP("PSJPR",$J,"OUTPAT")
"RTN","PSJCLOR4",45,0)
 S (STDTE,CLINIC,JDFN)=0
"RTN","PSJCLOR4",46,0)
 F  S STDTE=$O(^PS(55,"AIVC",STDTE)) Q:STDTE=""  F  S CLINIC=$O(^PS(55,"AIVC",STDTE,CLINIC)) Q:CLINIC=""  D
"RTN","PSJCLOR4",47,0)
 . F  S JDFN=$O(^PS(55,"AIVC",STDTE,CLINIC,JDFN)) Q:JDFN=""  I '$D(^TMP("PSJPR",$J,"OUTPAT",JDFN)) S DFN=JDFN K ^TMP("PSJAT",$J) D PAT,PAT1,PJ
"RTN","PSJCLOR4",48,0)
 S (STDTE,CLINIC,JDFN)=0
"RTN","PSJCLOR4",49,0)
 F  S STDTE=$O(^PS(55,"AUDC",STDTE)) Q:STDTE=""  F  S CLINIC=$O(^PS(55,"AIVC",STDTE,CLINIC)) Q:CLINIC=""  D
"RTN","PSJCLOR4",50,0)
 . F  S JDFN=$O(^PS(55,"AUDC",STDTE,CLINIC,JDFN)) Q:JDFN=""  I '$D(^TMP("PSJPR",$J,"OUTPAT",JDFN)) S DFN=JDFN K ^TMP("PSJAT",$J) D PAT,PAT1,PJ
"RTN","PSJCLOR4",51,0)
 Q
"RTN","PSJCLOR4",52,0)
PJ ;
"RTN","PSJCLOR4",53,0)
 S ^TMP("PSJPR",$J,"OUTPAT",JDFN)=""
"RTN","PSJCLOR4",54,0)
PG ;
"RTN","PSJCLOR4",55,0)
 F PSJPRW=0:0 S PSJPRW=$O(^PS(57.5,"AC",PSJPRWG,PSJPRW)) Q:'PSJPRW  S PSJPRWN=$P($G(^DIC(42,+PSJPRW,0)),"^") I PSJPRWN]"" D PW Q:$G(X)="^"
"RTN","PSJCLOR4",56,0)
 Q
"RTN","PSJCLOR4",57,0)
PW ;
"RTN","PSJCLOR4",58,0)
 K ^TMP("PSJAT",$J) F DFN=0:0 S (DFN,PSGP)=$O(^DPT("CN",PSJPRWN,DFN)) Q:'DFN  D PAT
"RTN","PSJCLOR4",59,0)
 D PAT1
"RTN","PSJCLOR4",60,0)
 Q
"RTN","PSJCLOR4",61,0)
PAT ;
"RTN","PSJCLOR4",62,0)
 S RB=$P($G(^DPT(DFN,.101)),U),PPN=$P($G(^(0)),U),X=$S(PSJSEL("RBP")="R":RB,1:PPN),AT=""
"RTN","PSJCLOR4",63,0)
 I $D(PSJSEL("TM")) S:RB]"" AT=$O(^PS(57.7,"AWRT",PSJPRW,RB,0)) Q:$S($D(PSJSEL("TM","ALL")):0,AT="":1,1:'$D(PSJSEL("TM",AT)))
"RTN","PSJCLOR4",64,0)
 F Y="AT","RB","X" S:@Y="" @Y="ZZ"
"RTN","PSJCLOR4",65,0)
 S ^TMP("PSJAT",$J,AT,X,DFN)=""
"RTN","PSJCLOR4",66,0)
 Q
"RTN","PSJCLOR4",67,0)
PAT1 ;
"RTN","PSJCLOR4",68,0)
 K PSJDBL S PSJAT="" F  S PSJAT=$O(^TMP("PSJAT",$J,PSJAT)) Q:PSJAT=""!$G(PSJDBL)  D
"RTN","PSJCLOR4",69,0)
 .S PSJPNRB="" F  S PSJPNRB=$O(^TMP("PSJAT",$J,PSJAT,PSJPNRB)) Q:PSJPNRB=""  S (DFN,PSGP)=+$O(^TMP("PSJAT",$J,PSJAT,PSJPNRB,0)) D ENBOTH^PSJAC,PP I $G(X)["^" S:X="^^" PSJDBL=1 Q
"RTN","PSJCLOR4",70,0)
 Q
"RTN","PSJCLOR4",71,0)
PP ;
"RTN","PSJCLOR4",72,0)
 I PSJPRP'="E" D ^PSJO I PSJPRP="P",'PSJPR D:'PSJON READ^PSJUTL Q:$G(X)?1"^"."^"  I PSJON S PSJPRF=1 D ENVW^PSJOE0 K PSGPRF Q
"RTN","PSJCLOR4",73,0)
 Q:PSJPRP="P"  I PSJPRP="E" U IO S PSJON=0,PSJDEV=PSJPR D @$S($D(PSJEXTP):"EN^PSJH1,ENGET^PSJO3",1:"EN^PSJO1(3),ENGET^PSJO3")
"RTN","PSJCLOR4",74,0)
 I 'PSJPR,PSJSEL("SELECT")'="P",'$D(^TMP("PSG",$J)) D READ^PSJUTL Q
"RTN","PSJCLOR4",75,0)
 I PSJPRP'="E",'PSJPR D PP3 Q:$D(DUOUT)!$D(DTOUT)
"RTN","PSJCLOR4",76,0)
 S (PSJS1,PSJS2,PSJS3,PSJS4,X)=""
"RTN","PSJCLOR4",77,0)
 F PSJQ=0:0 S PSJS1=$O(^TMP("PSJ",$J,PSJS1)) Q:PSJS1=""  F PSJQ=0:0 S PSJS2=$O(^TMP("PSJ",$J,PSJS1,PSJS2)) Q:PSJS2=""  F PSJQ=0:0 S PSJS3=$O(^TMP("PSJ",$J,PSJS1,PSJS2,PSJS3)) Q:PSJS3=""  D PP1
"RTN","PSJCLOR4",78,0)
 D:X'["^"&PSJPR BOT^PSJO3 K ^TMP("PSJ",$J) Q
"RTN","PSJCLOR4",79,0)
PP1 ;
"RTN","PSJCLOR4",80,0)
 F PSJQ=0:0 S PSJS4=$O(^TMP("PSJ",$J,PSJS1,PSJS2,PSJS3,PSJS4)) Q:PSJS4=""  D PP2
"RTN","PSJCLOR4",81,0)
 Q
"RTN","PSJCLOR4",82,0)
 ;
"RTN","PSJCLOR4",83,0)
PP2 ; Display selected order.
"RTN","PSJCLOR4",84,0)
 N PSJPRF,PSJLM S PSJORD=PSJS4 I $S(PSJORD["V":1,PSJORD["P":$P($G(^PS(53.1,+PSJORD,0)),U,4)="F",1:0) D  Q
"RTN","PSJCLOR4",85,0)
 .S PSJPRF=1 D ENINP^PSIVOPT(PSGP,PSJORD),PP3 Q:$D(DUOUT)!$D(DTOUT)  I PSJPRA'="N" I PSJORD'["P" D ENLOG^PSIVVW1,PP3 Q
"RTN","PSJCLOR4",86,0)
 S PSGORD=PSJORD D EN2^PSGVW,PP3 Q:$D(DUOUT)!$D(DTOUT)  I PSJPRA'="N",((PSJS1["A")!(PSJS1["O")) S AT=PSJPRA D ENA^PSGVW0 D PP3
"RTN","PSJCLOR4",87,0)
 Q
"RTN","PSJCLOR4",88,0)
PP3 S X="" I 'PSJPR K DIR S DIR(0)="E" D ^DIR S:$D(DUOUT)!$D(DTOUT) X="^" I X["^" S (PSJS1,PSJS2,PSJS3,PSJS4)="~"
"RTN","PSJCLOR4",89,0)
 Q
"RTN","PSJCLOR4",90,0)
 ;
"RTN","PSJCLOR4",91,0)
PH ;
"RTN","PSJCLOR4",92,0)
 W !!?2,"Enter a 'P' to print ONLY the PROFILE of orders for this patient.  Enter an",!,"'E' to print ONLY the EXPANDED VIEW of the orders for this patient.  Enter a",!,"'B' to have BOTH the profile (first) and the expanded views print."
"RTN","PSJCLOR4",93,0)
 W "  Enter an '^'to exit." Q
"RTN","PSJCLOR4",94,0)
 ;
"RTN","PSJCLOR4",95,0)
ENOR(PSGP) ;S (PSGP,DFN)=+ORVP,PSGP(0)=^DPT(PSGP,0)
"RTN","PSJCLOR4",96,0)
 S DFN=+PSGP,PSGP(0)=^DPT(PSGP,0)
"RTN","PSJCLOR4",97,0)
ENLM N PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSJCLOR4",98,0)
 S PSGPTMP=0,PPAGE=1
"RTN","PSJCLOR4",99,0)
 D ENCV^PSGSETU
"RTN","PSJCLOR4",100,0)
 D ENBOTH^PSJAC D:$D(PSJEXTP) CNV^PSJP D ENL^PSJO3 I "^N"'[PSJOL S PSJSEL("SELECT")="P",PSJSEL("P",PSGP(0),PSGP)="",(PSJPRW,PSJPRWG)=0,(PSJPRWN,PSJPRWGN)="",XQUIT="YES" D GO
"RTN","PSJCLOR4",101,0)
 ;* S PSJNKF=1 D READ^PSJUTL G DONE
"RTN","PSJCLOR4",102,0)
 S PSJNKF=1 G DONE
"RTN","PSJCLOR4",103,0)
 Q
"RTN","PSJCLOR4",104,0)
 ;
"RTN","PSJCLOR4",105,0)
A34 ; Stop date Active Unit Dose
"RTN","PSJCLOR4",106,0)
 S MSG=0,PSGF2=34
"RTN","PSJCLOR4",107,0)
 K PSGFDX
"RTN","PSJCLOR4",108,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  Q
"RTN","PSJCLOR4",109,0)
 . W !!?5,"Stop Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSJCLOR4",110,0)
 . D A34DONE
"RTN","PSJCLOR4",111,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 D A34DONE Q
"RTN","PSJCLOR4",112,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W34
"RTN","PSJCLOR4",113,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A34
"RTN","PSJCLOR4",114,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,34)
"RTN","PSJCLOR4",115,0)
 I X=+X,(X>0),(X'>2000000) G A34:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSJCLOR4",116,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A34 S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSJCLOR4",117,0)
W34 ;Compare to Start Date
"RTN","PSJCLOR4",118,0)
 N Z,MSG
"RTN","PSJCLOR4",119,0)
 D DOSE^PSGOE91 I $G(Z)]"",Z>$S($G(PSGFD):PSGFD,1:$G(PSGNEFD)) D  G A34
"RTN","PSJCLOR4",120,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSJCLOR4",121,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSJCLOR4",122,0)
 . D EN^DDIOL(.MSG)
"RTN","PSJCLOR4",123,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSJCLOR4",124,0)
 Q
"RTN","PSJCLOR4",125,0)
A34DONE ; clean up Active UD Stop Date vars
"RTN","PSJCLOR4",126,0)
 K MSG
"RTN","PSJCLOR4",127,0)
 Q
"RTN","PSJCLOR4",128,0)
A25NV ; Stop Date Non-Verified
"RTN","PSJCLOR4",129,0)
 K PSGFDX
"RTN","PSJCLOR4",130,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G A25DONE
"RTN","PSJCLOR4",131,0)
 I X="",PSGFD S X=$P(PSGFDN,"^") ;W "   "_$P(PSGFDN,"^")
"RTN","PSJCLOR4",132,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A25NV
"RTN","PSJCLOR4",133,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSJCLOR4",134,0)
 I X=+X,(X>0),(X'>2000000) G A25NV:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSJCLOR4",135,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A25NV S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSJCLOR4",136,0)
W25 ; Loop Stop Date NV
"RTN","PSJCLOR4",137,0)
 N Z,MSG
"RTN","PSJCLOR4",138,0)
 D DOSE^PSGOE81 I $G(Z)]"",Z>PSGNEFD D  G A25NV
"RTN","PSJCLOR4",139,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSJCLOR4",140,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSJCLOR4",141,0)
 . D EN^DDIOL(.MSG)
"RTN","PSJCLOR4",142,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! G A25NV
"RTN","PSJCLOR4",143,0)
 Q
"RTN","PSJCLOR4",144,0)
A25DONE ; NV Stop Date Done
"RTN","PSJCLOR4",145,0)
 D EFDNV^PSJUTL
"RTN","PSJCLOR4",146,0)
 K MSG
"RTN","PSJCLOR4",147,0)
 Q
"RTN","PSJCLOR4",148,0)
A25V(DFN,ON) ; Stop Date Active IV
"RTN","PSJCLOR4",149,0)
 N X,TMPY,DIR
"RTN","PSJCLOR4",150,0)
A25V2 ; IV Stop Date Continued
"RTN","PSJCLOR4",151,0)
 I P("IVRM")]"",$S(P(3)<P(2):1,$G(PSIVAC)["E":0,1:1) S PSIVSITE=$G(^PS(59.5,+P("IVRM"),1)),$P(PSIVSITE,"^",20,21)=$G(^PS(59.5,+P("IVRM"),5)) D ENSTOP^PSIVCAL
"RTN","PSJCLOR4",152,0)
 I $G(ON)["V"!($G(ON)["U") I $$COMPLEX^PSJOE(DFN,ON) D  Q
"RTN","PSJCLOR4",153,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Stop Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSJCLOR4",154,0)
 S Y=P(3) X ^DD("DD") W !,"STOP DATE/TIME: "_$S(Y]"":Y_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 Q:X=""&P(2)  I $E(X)=U!(X=""&P(2)) Q
"RTN","PSJCLOR4",155,0)
 I X="@"!(X["?") W $C(7),"  (Required)" S F1=53.1,F2=25,X="?" D ENHLP^PSIVORC1 G A25V2
"RTN","PSJCLOR4",156,0)
 K %DT S:X="" X=$G(Y) S:X="" X=P(3) S %DT="TE" D:X'=+X ^%DT
"RTN","PSJCLOR4",157,0)
 I X=+X,X>0,X'>2000000 G A25V2:'$$ENDL^PSGDL(P(9),X) D ENDL^PSIVSP
"RTN","PSJCLOR4",158,0)
 S TMPY=Y I TMPY["^" S PSJQMSG=0 Q
"RTN","PSJCLOR4",159,0)
 I $E(TMPY)="?" K DIR,X,Y D ENHLP^PSGOEM(55.06,10) S PSJQMSG=1 G A25V2
"RTN","PSJCLOR4",160,0)
 I TMPY'["." W $C(7),!?5," Time is REQUIRED. Re-enter Start Date. " S PSJQMSG=1 G A25V2
"RTN","PSJCLOR4",161,0)
 D DOSE^PSIVEDT1
"RTN","PSJCLOR4",162,0)
 I $G(X)="" S X=Y
"RTN","PSJCLOR4",163,0)
 I $G(X)="" S X=P(3)
"RTN","PSJCLOR4",164,0)
 I $G(Z)]"",Z>X D  G A25V2
"RTN","PSJCLOR4",165,0)
 . W !,"There is no administration time that falls between the Start Date/Time"
"RTN","PSJCLOR4",166,0)
 . W !,"and Stop Date/Time.",!
"RTN","PSJCLOR4",167,0)
 S X=Y S:Y<1!Y'["." X="" G:Y'>0 A25V2 S P(3)=+Y,PSGFDX=1
"RTN","PSJCLOR4",168,0)
 Q
"RTN","PSJCLOR5")
0^41^B68088373^n/a
"RTN","PSJCLOR5",1,0)
PSJCLOR5 ;BIR/JCH - INPATIENT MEDICATIONS UTILITIES FOR CLINIC ORDERS ;25 SEP 97 / 7:43 AM
"RTN","PSJCLOR5",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**275**;16 DEC 97;Build 157
"RTN","PSJCLOR5",3,0)
 ;
"RTN","PSJCLOR5",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJCLOR5",5,0)
 ;
"RTN","PSJCLOR5",6,0)
DSPORD(PSGP,TMPORDER,PSJORDAR) ; Display order summary
"RTN","PSJCLOR5",7,0)
 N NDP2,PSJOINM,TMPSTOP,ND0,ND2,NDP1,TMPSTARE,TMPSOL1,PSJBLANK S ND0=$S(TMPORDER["U":$G(^PS(55,PSGP,5,+TMPORDER,0)),TMPORDER["P":$G(^PS(53.1,+TMPORDER,0)),TMPORDER["V":$G(^PS(55,PSGP,"IV",+TMPORDER,0)),1:"")
"RTN","PSJCLOR5",8,0)
 S ND2=$S(TMPORDER["U":$G(^PS(55,PSGP,5,+TMPORDER,2)),TMPORDER["P":$G(^PS(53.1,+TMPORDER,2)),TMPORDER["V":$G(^PS(55,PSGP,"IV",+TMPORDER,2)),1:""),TMPSTOP=$P(ND2,"^",4)
"RTN","PSJCLOR5",9,0)
 S NDP2=$S(TMPORDER["U":$G(^PS(55,PSGP,5,+TMPORDER,.2)),TMPORDER["P":$G(^PS(53.1,+TMPORDER,.2)),TMPORDER["V":$G(^PS(55,PSGP,"IV",+TMPORDER,.2)),1:"")
"RTN","PSJCLOR5",10,0)
 I TMPORDER["V" S TMPSOL1=$G(^PS(55,PSGP,"IV",+TMPORDER,"SOL",1,0)),TMPSTOP=$P(ND0,"^",3)
"RTN","PSJCLOR5",11,0)
 S TMPSTARE=$S(TMPORDER["P"!(TMPORDER["U"):$$FMTE^XLFDT($P(ND2,"^",2),2),TMPORDER["V":$$FMTE^XLFDT($P(ND0,"^",2),2),1:"") I TMPSTARE D
"RTN","PSJCLOR5",12,0)
 .S TMPSTARE=$P(TMPSTARE,"@"),TMPSTOP=$P($$FMTE^XLFDT(TMPSTOP,2),"@") F TMPDT="TMPSTARE","TMPSTOP" N PSJPCNT,PSJPCV S PSJPCNT=0 F PSJPCNT=1:1 S PSJPCV=$P(@(TMPDT),"/",PSJPCNT) Q:(PSJPCV="")  I PSJPCV,(PSJPCV<10) D
"RTN","PSJCLOR5",13,0)
 ..S $P(@(TMPDT),"/",PSJPCNT)=0_+PSJPCV
"RTN","PSJCLOR5",14,0)
 .S TMPSTARE=TMPSTARE_"    "_TMPSTOP
"RTN","PSJCLOR5",15,0)
 I '$G(PSJORDAR) D
"RTN","PSJCLOR5",16,0)
 .I TMPORDER'["V" S PSJOINM=$P($G(^PS(50.7,+$P(NDP2,"^"),0)),"^") W !?5,$S(PSJOINM]"":PSJOINM,1:"DRUG NAME NOT FOUND") W ?50,TMPSTARE D
"RTN","PSJCLOR5",17,0)
 ..W !?8," Give: ",$P(NDP2,"^",2)," ",$P($G(^PS(51.2,+$P(ND0,"^",3),0)),"^",3)," ",$P(ND2,"^")
"RTN","PSJCLOR5",18,0)
 .I TMPORDER["V" D
"RTN","PSJCLOR5",19,0)
 ..N PSIVACNT,PSJINDNT,AD,ADINT,ADEXT S AD=0 F PSIVACNT=1:1  S AD=$O(^PS(55,PSGP,"IV",+TMPORDER,"AD",AD)) Q:AD=""  S ADINT=$G(^(AD,0)),AD(0)=$G(AD(0))+1 I ADINT W !?5,$P($G(^PS(52.6,+ADINT,0)),"^") I (PSIVACNT=1) W ?50,TMPSTARE
"RTN","PSJCLOR5",20,0)
 ..S PSJINDNT=$S($G(ADINT):8,1:4)
"RTN","PSJCLOR5",21,0)
 ..W !?PSJINDNT W " in ",$P($G(^PS(52.7,+$G(TMPSOL1),0)),"^")," ",$P(TMPSOL1,"^",2)," ",$P(ND0,"^",8),?50,$S('$G(ADINT):TMPSTARE,1:"")
"RTN","PSJCLOR5",22,0)
 I $G(PSJORDAR) S $P(PSJBLANK," ",75)=" " D
"RTN","PSJCLOR5",23,0)
 .I TMPORDER'["V" S PSJORDAR(1)="     "_$P($G(^PS(50.7,+$P(NDP2,"^"),0)),"^") D
"RTN","PSJCLOR5",24,0)
 ..S PSJORDAR(1)=PSJORDAR(1)_$E(PSJBLANK,1,49-$L(PSJORDAR(1)))_TMPSTARE
"RTN","PSJCLOR5",25,0)
 ..S PSJORDAR(2)=$E(PSJBLANK,1,8)_"Give: "_$P(NDP2,"^",2)_" "_$P($G(^PS(51.2,+$P(ND0,"^",3),0)),"^",3)_" "_$P(ND2,"^")
"RTN","PSJCLOR5",26,0)
 .I TMPORDER["V" N AD,ADINT,ADEXT,PSJINDNT,PAD1,PAD2 S $P(PAD1," ",75)=" " D
"RTN","PSJCLOR5",27,0)
 ..N II S II=1,AD=0 F  S AD=$O(^PS(55,PSGP,"IV",+TMPORDER,"AD",AD)) Q:AD=""  D
"RTN","PSJCLOR5",28,0)
 ...S ADINT=$G(^(AD,0)) I ADINT S ADEXT=$P($G(^PS(52.6,+ADINT,0)),"^") S AD(0)=$G(AD(0))+1,PSJORDAR(AD(0))="     "_ADEXT S PSJORDAR(AD(0))=PSJORDAR(AD(0))_$E(PSJBLANK,1,49-$L(PSJORDAR(AD(0))))_$S(II=1:TMPSTARE,1:""),II=II+1
"RTN","PSJCLOR5",29,0)
 ..S PSJINDNT=$S($G(ADINT):8,1:4)
"RTN","PSJCLOR5",30,0)
 ..S AD(0)=$G(AD(0))+1 S PSJORDAR(AD(0))=$E(PSJBLANK,1,PSJINDNT)_" in "_$P($G(^PS(52.7,+$G(TMPSOL1),0)),"^")_" "_$P(TMPSOL1,"^",2)_" "_$P(ND0,"^",8) D
"RTN","PSJCLOR5",31,0)
 ...S PSJORDAR(AD(0))=$E(PSJORDAR(AD(0)),1,49) S PAD2=49-$L(PSJORDAR(AD(0))),PAD2=$E(PAD1,1,PAD2) S PSJORDAR(AD(0))=PSJORDAR(AD(0))_$S('$G(ADINT):PAD2_TMPSTARE,1:"")
"RTN","PSJCLOR5",32,0)
 Q
"RTN","PSJCLOR5",33,0)
ORDCHK ; Check for conflicts among selected orders
"RTN","PSJCLOR5",34,0)
 N PSJHOLD,PSJSELOR,PSJREVDN,PSJOROR,PSJOROR2,PSJCOMFL,TMPSELX,TMPSELX2,TMPSELCO,TMPSELCO1,TMPSELCO2,PSJONCAL
"RTN","PSJCLOR5",35,0)
 S PSJSELOR=$S($G(TMPSELOR):TMPSELOR,1:$P($G(Y(1)),"=",2)) Q:'PSJSELOR  I $E(PSJSELOR,$L(PSJSELOR))'="," S PSJSELOR=PSJSELOR_","
"RTN","PSJCLOR5",36,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),PSJCOMFL="",PSJONCAL=""
"RTN","PSJCLOR5",37,0)
 S TMPCNT=0,TMPSEL=0,PSJTMPON="" F TMPCNT=1:1:($L(PSJSELOR,",")) Q:'TMPCNT  D
"RTN","PSJCLOR5",38,0)
 .S TMPSEL=$P(PSJSELOR,",",TMPCNT) Q:'TMPSEL  S PSJTMPON=$G(^TMP("PSJON",$J,TMPSEL)) Q:'PSJTMPON
"RTN","PSJCLOR5",39,0)
 .N STAT S STAT=$S(PSJTMPON["U":$P($G(^PS(55,PSGP,5,+PSJTMPON,0)),"^",9),PSJTMPON["V":$P($G(^PS(55,PSGP,"IV",+PSJTMPON,0)),"^",17),1:"")
"RTN","PSJCLOR5",40,0)
 .I STAT="H" S PSJHOLD(PSJTMPON)=TMPSEL
"RTN","PSJCLOR5",41,0)
 S TMPSELCO=PSJSELOR
"RTN","PSJCLOR5",42,0)
 I $D(PSJHOLD)>1 D FULL^VALM1 D
"RTN","PSJCLOR5",43,0)
 .N PSJDASH1 S $P(PSJDASH1,"-",75)="-"
"RTN","PSJCLOR5",44,0)
 .W !!,"  ON HOLD orders cannot be edited - no changes will be applied",!,"  to any of the following ON HOLD orders:"
"RTN","PSJCLOR5",45,0)
 .W !,"ON HOLD orders:",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",46,0)
 .N PSJOHCT S PSJOROR2="" F PSJOHCT=1:1 S PSJOROR2=$O(PSJHOLD(PSJOROR2)) Q:'PSJOROR2  D
"RTN","PSJCLOR5",47,0)
 ..I '(PSJOHCT#8) N DIR W ! D CONT^PSJOE0,CLEAR^VALM1,FULL^VALM1 W !!,"ON HOLD orders (CONTINUED):",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",48,0)
 ..D DSPORD^PSJCLOR2(PSGP,PSJOROR2)
"RTN","PSJCLOR5",49,0)
 ..I PSJHOLD(PSJOROR2)=$P(TMPSELCO,",") S TMPSELCO=$P(TMPSELCO,PSJHOLD(PSJOROR2)_",",2) Q
"RTN","PSJCLOR5",50,0)
 ..S TMPSELCO1=$P(TMPSELCO,","_PSJHOLD(PSJOROR2)_","),TMPSELCO2=$P(TMPSELCO,","_PSJHOLD(PSJOROR2)_",",2) S TMPSELCO=TMPSELCO1_$S(TMPSELCO2]"":","_TMPSELCO2,1:"")
"RTN","PSJCLOR5",51,0)
 .N DIR W ! D CONT^PSJOE0 W !
"RTN","PSJCLOR5",52,0)
 S (PSJSELOR,TMPSELOR)=TMPSELCO
"RTN","PSJCLOR5",53,0)
 S TMPCNT=0,TMPSEL=0,PSJTMPON="" F TMPCNT=1:1:($L(PSJSELOR,",")) Q:'TMPCNT  D
"RTN","PSJCLOR5",54,0)
 .S TMPSEL=$P(PSJSELOR,",",TMPCNT) Q:'TMPSEL  S PSJTMPON=$G(^TMP("PSJON",$J,TMPSEL)) Q:'PSJTMPON
"RTN","PSJCLOR5",55,0)
 .N STAT S STAT=$S(PSJTMPON["U":$P($G(^PS(55,PSGP,5,+PSJTMPON,0)),"^",9),PSJTMPON["V":$P($G(^PS(55,PSGP,"IV",+PSJTMPON,0)),"^",17),1:"")
"RTN","PSJCLOR5",56,0)
 .I STAT="O" S PSJONCAL(PSJTMPON)=TMPSEL
"RTN","PSJCLOR5",57,0)
 S TMPSELCO=PSJSELOR
"RTN","PSJCLOR5",58,0)
 I $D(PSJONCAL)>1 D FULL^VALM1 D
"RTN","PSJCLOR5",59,0)
 .N PSJOCCNT,PSJDASH1 S $P(PSJDASH1,"-",75)="-"
"RTN","PSJCLOR5",60,0)
 .W !!,"  Orders with ON CALL Status cannot be edited - no changes will be applied",!,"  to any of the following orders with ON CALL status:"
"RTN","PSJCLOR5",61,0)
 .W !,"ON CALL Status orders:",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",62,0)
 .S PSJOROR2="" F PSJOCCNT=1:1 S PSJOROR2=$O(PSJONCAL(PSJOROR2)) Q:'PSJOROR2  D
"RTN","PSJCLOR5",63,0)
 ..I '(PSJOCCNT#8) N DIR W ! D CONT^PSJOE0,CLEAR^VALM1,FULL^VALM1 W !!,"ON CALL Status orders (CONTINUED):",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",64,0)
 ..D DSPORD^PSJCLOR2(PSGP,PSJOROR2)
"RTN","PSJCLOR5",65,0)
 ..I PSJONCAL(PSJOROR2)=$P(TMPSELCO,",") S TMPSELCO=$P(TMPSELCO,PSJONCAL(PSJOROR2)_",",2) Q
"RTN","PSJCLOR5",66,0)
 ..S TMPSELCO1=$P(TMPSELCO,","_PSJONCAL(PSJOROR2)_","),TMPSELCO2=$P(TMPSELCO,","_PSJONCAL(PSJOROR2)_",",2) S TMPSELCO=TMPSELCO1_$S(TMPSELCO2]"":","_TMPSELCO2,1:"")
"RTN","PSJCLOR5",67,0)
 .N DIR W ! D CONT^PSJOE0 W !
"RTN","PSJCLOR5",68,0)
 S (PSJSELOR,TMPSELOR)=TMPSELCO
"RTN","PSJCLOR5",69,0)
 S TMPCNT=0,TMPSEL=0,PSJTMPON="" F TMPCNT=1:1:($L(PSJSELOR,",")) Q:'TMPCNT  D
"RTN","PSJCLOR5",70,0)
 .S TMPSEL=$P(PSJSELOR,",",TMPCNT) Q:'TMPSEL  S PSJTMPON=$G(^TMP("PSJON",$J,TMPSEL)) Q:'PSJTMPON
"RTN","PSJCLOR5",71,0)
 .I (PSJTMPON=+PSJTMPON),$D(^PS(53.1,"ACX",PSJTMPON)) S PSJCOMFL="P",PSJOROR="" F  S PSJOROR=$O(^PS(53.1,"ACX",PSJTMPON,PSJOROR)) Q:'PSJOROR  S PSJCOMFL(PSJOROR_"P")=TMPSEL
"RTN","PSJCLOR5",72,0)
 .I PSJCOMFL="" S PSJOROR=$S(PSJTMPON["U":$P($G(^PS(55,PSGP,5,+PSJTMPON,.2)),"^",8),PSJTMPON["V":$P($G(^PS(55,PSGP,"IV",+PSJTMPON,.2)),"^",8),1:"") Q:'PSJOROR  D
"RTN","PSJCLOR5",73,0)
 ..S PSJCOMFL(PSJTMPON)=TMPSEL
"RTN","PSJCLOR5",74,0)
 S TMPSELCO=PSJSELOR
"RTN","PSJCLOR5",75,0)
 I $D(PSJCOMFL)>1 D FULL^VALM1 D
"RTN","PSJCLOR5",76,0)
 .N PSJDASH1 S $P(PSJDASH1,"-",75)="-"
"RTN","PSJCLOR5",77,0)
 .W !!,"  Complex Orders cannot be edited - no changes will be applied",!,"   to any of the following Complex order components:"
"RTN","PSJCLOR5",78,0)
 .W !,"Complex Component (Child) Orders:",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",79,0)
 .N PSJCOMCT S PSJOROR2="" F PSJCOMCT=1:1 S PSJOROR2=$O(PSJCOMFL(PSJOROR2)) Q:'PSJOROR2  D
"RTN","PSJCLOR5",80,0)
 ..I '(PSJCOMCT#8) N DIR W ! D CONT^PSJOE0,CLEAR^VALM1,FULL^VALM1 W !!,"Complex orders (CONTINUED):",?45,"Current Start / Stop Dates",!,PSJDASH1
"RTN","PSJCLOR5",81,0)
 ..D DSPORD^PSJCLOR2(PSGP,PSJOROR2)
"RTN","PSJCLOR5",82,0)
 ..I PSJCOMFL(PSJOROR2)=$P(TMPSELCO,",") S TMPSELCO=$P(TMPSELCO,PSJCOMFL(PSJOROR2)_",",2) Q
"RTN","PSJCLOR5",83,0)
 ..S TMPSELCO1=$P(TMPSELCO,","_PSJCOMFL(PSJOROR2)_","),TMPSELCO2=$P(TMPSELCO,","_PSJCOMFL(PSJOROR2)_",",2) S TMPSELCO=TMPSELCO1_$S(TMPSELCO2]"":","_TMPSELCO2,1:"")
"RTN","PSJCLOR5",84,0)
 .W ! N DIR D CONT^PSJOE0 W !
"RTN","PSJCLOR5",85,0)
 S (PSJSELOR,TMPSELOR)=TMPSELCO
"RTN","PSJCLOR5",86,0)
 N TMPNEWSD,TMPSEL,TMPCLN,TMPCLNAR,PSJSTPDT,PSJTMPON,TMPCNT S PSJSTPDT="" S PSJQMSG=0,PSJABORT=0
"RTN","PSJCLOR5",87,0)
 I ('$G(PSGOEAV)&(+$G(PSJSYSU)=3))!(+$G(PSJSYSU)'=3) S TMPCNT=0,TMPSEL=0,PSJTMPON="" F TMPCNT=1:1:($L(PSJSELOR,",")) Q:'TMPCNT!$G(PSJREVFY)!$G(PSJREVDN)  D
"RTN","PSJCLOR5",88,0)
 .S TMPSEL=$P(PSJSELOR,",",TMPCNT) Q:'TMPSEL  S PSJTMPON=$G(^TMP("PSJON",$J,TMPSEL)) Q:'PSJTMPON
"RTN","PSJCLOR5",89,0)
 .I PSJTMPON["V"!(PSJTMPON["U") S PSJREVFY=$S(+PSJSYSU=3:$$PSJREVFY^PSJCLOR1(),1:$$SURE^PSJCLOR1()),PSJREVDN=1
"RTN","PSJCLOR5",90,0)
 I $G(DUOUT)!($G(PSJREVFY)<0) S PSJABORT=2 Q
"RTN","PSJCLOR5",91,0)
 ;
"RTN","PSJCLOR5",92,0)
 S TMPCNT=0,TMPSEL=0,PSJTMPON="" F TMPCNT=1:1:($L(PSJSELOR,",")) Q:'TMPCNT  S TMPSEL=$P(PSJSELOR,",",TMPCNT) Q:'TMPSEL  S PSJTMPON=$G(^TMP("PSJON",$J,TMPSEL)) Q:'PSJTMPON  D
"RTN","PSJCLOR5",93,0)
 .N ND0,ND2,NDP1 S ND0=$S(PSJTMPON["U":$G(^PS(55,PSGP,5,+PSJTMPON,0)),PSJTMPON["P":$G(^PS(53.1,+PSJTMPON,0)),PSJTMPON["V":$G(^PS(55,PSGP,"IV",+PSJTMPON,0)),1:"")
"RTN","PSJCLOR5",94,0)
 .S ND2=$S(PSJTMPON["U":$G(^PS(55,PSGP,5,+PSJTMPON,2)),PSJTMPON["P":$G(^PS(53.1,+PSJTMPON,2)),PSJTMPON["V":$G(^PS(55,PSGP,"IV",+PSJTMPON,2)),1:"")
"RTN","PSJCLOR5",95,0)
 .S TMPSTR=$S(PSJTMPON["P"!(PSJTMPON["U"):$P(ND2,"^",2),PSJTMPON["V":$P(ND0,"^",2),1:"") S TMPSTR($P(TMPSTR,"."))=""
"RTN","PSJCLOR5",96,0)
 .S TMPCLN=$S(PSJTMPON["P":+$G(^PS(53.1,+PSJTMPON,"DSS")),PSJTMPON["U":+$G(^PS(55,+$G(PSGP),5,+PSJTMPON,8)),PSJTMPON["V":+$G(^PS(55,$G(PSGP),"IV",+PSJTMPON,"DSS")),1:"")
"RTN","PSJCLOR5",97,0)
 .Q:'TMPCLN  I $O(TMPCLNAR("")),$O(TMPCLNAR(""))'=TMPCLN S PSJABORT=1
"RTN","PSJCLOR5",98,0)
 .S TMPCLNAR(+TMPCLN)=""
"RTN","PSJCLOR5",99,0)
 S TMPSTR="" F  S TMPSTR=$O(TMPSTR(TMPSTR)) Q:'TMPSTR  S TMPSTR(0)=$G(TMPSTR(0))+1
"RTN","PSJCLOR5",100,0)
 I $G(PSJABORT)!($G(TMPSTR(0))>1) D
"RTN","PSJCLOR5",101,0)
 .K DIR S DIR("A",1)="     You have selected orders"_$S($G(PSJABORT):" from different clinics",1:" with different Start Date/Times")_"  "
"RTN","PSJCLOR5",102,0)
 .I $G(PSJABORT)&($G(TMPSTR(0))>1) S DIR("A",2)="          and with different Start Date/Times."
"RTN","PSJCLOR5",103,0)
 .S DIR("A",3)="",DIR("A",4)=""
"RTN","PSJCLOR5",104,0)
 .W ! N X,Y S DIR("A")="Do you want to continue",DIR(0)="Y" D ^DIR S PSJABORT=$S(Y>0:1,1:2)
"RTN","PSJCLOR5",105,0)
 Q
"RTN","PSJCLOR5",106,0)
 ; 
"RTN","PSJCLOR5",107,0)
NEWCLN ; Clean up Order variables
"RTN","PSJCLOR5",108,0)
 K PSGNEDFD,PSGOEE,PSGOEEWF,PSGOORD,PSGPD,PSGPDN,PSGPDRGN,PSGRDTX,PSGS0Y,PSJCOM,PSJL,PSJNOO,PSJQMSG
"RTN","PSJCLOR5",109,0)
 K PSJTMPON,VALMBCK,VALMCNT,VALMQUIT
"RTN","PSJCLOR5",110,0)
 Q
"RTN","PSJDPT")
0^43^B14025206^B13914109
"RTN","PSJDPT",1,0)
PSJDPT ;BIR/JLC - CENTRALIZED PATIENT LOOKUP FOR IPM ; 7/2/08 3:47pm
"RTN","PSJDPT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**53,124,166,160,198,267,275**;16 DEC 97;Build 157
"RTN","PSJDPT",3,0)
 ;
"RTN","PSJDPT",4,0)
 ; Reference to ^DPT is supported by DBIA 10035
"RTN","PSJDPT",5,0)
 ; Reference to ^DGSEC4 is supported by DBIA 3027
"RTN","PSJDPT",6,0)
 ; Reference to ^DIC is supported by DBIA 10006
"RTN","PSJDPT",7,0)
 ; Reference to ^DICN is supported by DBIA 10009
"RTN","PSJDPT",8,0)
 ; Reference to ^DPTLK is supported by DBIA 3787
"RTN","PSJDPT",9,0)
 ; Reference to ^DPTLK1 is supported by DBIA 3266
"RTN","PSJDPT",10,0)
 ; Reference to DISPPRF^DGPFAPI is supported by DBIA 4563
"RTN","PSJDPT",11,0)
 ; Reference to GETACT^DGPFAPI is supported by DBIA 3860
"RTN","PSJDPT",12,0)
 ; Reference to ^ORRDI1 is supported by DBIA 4659.
"RTN","PSJDPT",13,0)
 ; Reference to ^XTMP("ORRDI" is supported by DBIA 4660.
"RTN","PSJDPT",14,0)
 ;
"RTN","PSJDPT",15,0)
EN ; MAIN ENTRY POINT FOR PATIENT LOOKUP
"RTN","PSJDPT",16,0)
 K DIC S DIC="^DPT(",DIC("W")="D DPT^PSJDPT",DIC(0)="QEMZ" D ^DPTLK K DIC
"RTN","PSJDPT",17,0)
 I $$BADADR^DGUTL3(+Y) H 2
"RTN","PSJDPT",18,0)
 N Y
"RTN","PSJDPT",19,0)
 D
"RTN","PSJDPT",20,0)
 . ;PSJ*5.0*198;GMZ;Don't print remote data msg on view profile only menu options
"RTN","PSJDPT",21,0)
 . I $T(HAVEHDR^ORRDI1)]"",$$HAVEHDR^ORRDI1,$D(^XTMP("ORRDI","OUTAGE INFO","DOWN")),'$G(PSJNODIS) W !,"Remote data not available - Only local order checks processed." D PAUSE^PSJLMUT1
"RTN","PSJDPT",22,0)
 Q
"RTN","PSJDPT",23,0)
CHK(Y,DISP,PAUSE) N RESULT,RES,CHKY,PSGTEMP
"RTN","PSJDPT",24,0)
 S DISP=$G(DISP),PAUSE=$G(PAUSE)
"RTN","PSJDPT",25,0)
 I $G(XQY0)["PSJI COMPLETE",$$GETACT^DGPFAPI(+Y,"PSGTEMP") K PSGTEMP W @IOF,"PATIENT: ",$P(Y,U,2)
"RTN","PSJDPT",26,0)
 S CHKY=Y D DISPPRF^DGPFAPI(Y) S Y=CHKY K CHKY
"RTN","PSJDPT",27,0)
 D PTSEC^DGSEC4(.RESULT,$P(Y,"^"),1)
"RTN","PSJDPT",28,0)
 I RESULT(1)'=0 D
"RTN","PSJDPT",29,0)
 . W !! I DISP W ?(80-$L($P(Y,"^",2)))\2,$P(Y,"^",2),!
"RTN","PSJDPT",30,0)
 . F I=2:1:9 I $D(RESULT(I)) W ?(80-$L(RESULT(I)))\2,RESULT(I),!
"RTN","PSJDPT",31,0)
 . I RESULT(1)'=0,RESULT(1)'=2,PAUSE H 2
"RTN","PSJDPT",32,0)
 . Q:RESULT(1)=1
"RTN","PSJDPT",33,0)
 . I RESULT(1)=-1!(RESULT(1)=3)!(RESULT(1)=4) S Y=-1 Q
"RTN","PSJDPT",34,0)
 . I RESULT(1)=2 D ENCONT I Y=-1 Q
"RTN","PSJDPT",35,0)
 . D NOTICE^DGSEC4(.RES,Y,XQY0,$S(RESULT(1)=1:1,1:3)) I RES=0 S Y=-1 Q
"RTN","PSJDPT",36,0)
 I '$$AA(+Y) S Y=-1 Q
"RTN","PSJDPT",37,0)
 Q
"RTN","PSJDPT",38,0)
ENCONT W !,"Do you want to continue processing this patient record"
"RTN","PSJDPT",39,0)
 S %=2 D YN^DICN I %<0!(%=2) S Y=-1
"RTN","PSJDPT",40,0)
 I '% W !!,"Enter 'YES' to continue processing, or 'NO' to quit processing this record." G ENCONT
"RTN","PSJDPT",41,0)
 Q
"RTN","PSJDPT",42,0)
DPT I $$DOB^DPTLK1(Y)["*SENSITIVE" G SENS
"RTN","PSJDPT",43,0)
 S ND=$S($D(^DPT(Y,0)):^(0),1:""),NB=$P(ND,"^",3),NS=$P(ND,"^",9)
"RTN","PSJDPT",44,0)
 I NS W ?42,$E(NS,1,3),"-",$E(NS,4,5),"-",$E(NS,6,10)," "
"RTN","PSJDPT",45,0)
 I NB W ?55,$E(NB,4,5),"/",$E(NB,6,7),"/",$E(NB,2,3)," "
"RTN","PSJDPT",46,0)
 I $D(^DPT(Y,.1)) W ?67,$P(^(.1),"^")
"RTN","PSJDPT",47,0)
 Q
"RTN","PSJDPT",48,0)
SENS W ?42,"*SENSITIVE* ",?55,"*SENSITIVE* ",?67,"*SENSITIVE*" Q
"RTN","PSJDPT",49,0)
 ;
"RTN","PSJDPT",50,0)
AA(DFN) ; Allergy Assessment
"RTN","PSJDPT",51,0)
 Q:$G(DFN)<1 0
"RTN","PSJDPT",52,0)
 N VAN,VAV,VADM,Y,X D DEM^VADPT
"RTN","PSJDPT",53,0)
 Q:+$G(VADM(6)) 1
"RTN","PSJDPT",54,0)
 N PSJENTRY S PSJENTRY=$P($G(XQY0),"^") I '(("^PSJU NE^PSJI ORDER^PSJ OE^PSJU VBW^PSJI PROFILE^")[("^"_PSJENTRY_"^")) Q 1
"RTN","PSJDPT",55,0)
 N PSGP,Y S (Y,PSGP)=+DFN N DFN S DFN=PSGP
"RTN","PSJDPT",56,0)
 I $G(DFN) N PSJAAOK,PSJAACHK,PSJAADPT,PSJRXREQ,GMRA,GMRAL S PSJAADPT=1,PSJAAOK="" D
"RTN","PSJDPT",57,0)
 .S GMRA="0^0^111",DFN=PSGP D ^GMRADPT I $G(GMRAL)="" S PSJAACHK=1 F  Q:$G(PSJAAOK)  D
"RTN","PSJDPT",58,0)
 ..D CLEAR^VALM1,FULL^VALM1
"RTN","PSJDPT",59,0)
 ..W !!,"NO ALLERGY ASSESSMENT exists for " W $P($G(^DPT(+PSGP,0)),"^"),!!,"Would you like to enter one now" S %=2 D YN^DICN
"RTN","PSJDPT",60,0)
 ..I $G(%)=2 S PSJAAOK=1 D  Q
"RTN","PSJDPT",61,0)
 ...W !!,"Now creating Pharmacy Intervention",!
"RTN","PSJDPT",62,0)
 ...S PSJRXREQ="NO ALLERGY ASSESSMENT",PSJDD="" D DIC^PSJRXI
"RTN","PSJDPT",63,0)
 ..I $G(%)=1 S VALMBCK="R" D INIT^PSJLMDA I $G(DFN) D NEWALL^PSJLMUTL(DFN) D  Q
"RTN","PSJDPT",64,0)
 ...S GMRA="0^0^111" D ^GMRADPT I $G(GMRAL)'="" S PSJAAOK=1
"RTN","PSJDPT",65,0)
 ..I $G(%)<0 S PSJAAOK=1 S Y="" Q
"RTN","PSJDPT",66,0)
 ..W !!?5,"Enter 'Y' to create an allergy assessment, or 'N'",!?5,"to continue without creating an allergy assessment"
"RTN","PSJDPT",67,0)
 Q $S($G(Y)>0:Y,1:0)
"RTN","PSJHL7")
0^56^B54233730^B50036131
"RTN","PSJHL7",1,0)
PSJHL7 ;BIR/LDT-ACTIONS ON HL7 MESSAGES FROM OE/RR (CONT) ;29 AUG 96 / 11:18 AM
"RTN","PSJHL7",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**42,47,50,70,82,110,127,133,275**;16 DEC 97;Build 157
"RTN","PSJHL7",3,0)
 ;
"RTN","PSJHL7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL7",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJHL7",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL7",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL7",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL7",9,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL7",10,0)
 ; Reference to ^SC( is supported by DBIA# 10040.
"RTN","PSJHL7",11,0)
 ; Reference to ^TMP("PSB" is supported by DBIA# 3564.
"RTN","PSJHL7",12,0)
 ; 
"RTN","PSJHL7",13,0)
RENEW ;Renew orders from OE/RR
"RTN","PSJHL7",14,0)
 N PSJSYSW0,PSJSYSW,WRDPTR,PSJOSTOP,Q1,Q2
"RTN","PSJHL7",15,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(LOC) S WRDPTR=$G(^SC(+LOC,42)) S:WRDPTR]"" PSJSYSW=+$O(^PS(59.6,"B",WRDPTR,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJHL7",16,0)
 I PREON["V" D IVSET G DONE
"RTN","PSJHL7",17,0)
 N ND,ND1,ND2,PSGSI,PSGMR,PSGSM,PSGHSM,PSGST,OIDRG,PSGDO,PSGSCH,PSGSOY,PSGOXT,PSGNEDFD,DRUGS,WAT
"RTN","PSJHL7",18,0)
 S ND=$G(^PS(55,PSJHLDFN,5,+PREON,0)),ND1=$G(^(.2)),ND2=$G(^(2)),PSGSI=$G(^(6)),PSGWLL=$S($P(PSJSYSW0,"^",4):+$G(^PS(55,PSJHLDFN,5.1)),1:0)
"RTN","PSJHL7",19,0)
 I +PSITEM>0,PSITEM'=+$P(ND1,"^") S $P(ND1,"^")=PSITEM
"RTN","PSJHL7",20,0)
 S PSGMR=$P(ND,"^",3),PSGSM=$P(ND,"^",5),PSGHSM=$P(ND,"^",6),PSGST=$P(ND,"^",7),OIDRG=$P(ND1,"^"),PSGDO=$P(ND1,"^",2),DOSE=$P(ND1,"^",5),UNIT=$P(ND1,"^",6),PSGSCH=$P(ND2,"^")
"RTN","PSJHL7",21,0)
 S PSGSOY=$P(ND2,"^",5),PSGOXT=$P(ND2,"^",6),PSGNEDFD=$P($$GTNEDFD^PSGOE7("UI",OIDRG),"^")
"RTN","PSJHL7",22,0)
 S:$P(LOC,"^")'=$P(ND2,"^",10) PSGSOY=$$ENRNAT^PSJHL7($P(ND2,"^",10),+LOC,PSGSCH,PSGSOY)
"RTN","PSJHL7",23,0)
 S X=$O(^PS(55,PSJHLDFN,5,+PREON,1,0)) I X S (Q,Q1)=0 F  S Q=$O(^PS(55,PSJHLDFN,5,+PREON,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$S('$P(ND,"^",3):1,1:$P(ND,"^",3)>DT) S Q1=Q1+1,DRUGS(Q1)=$P(ND,"^",1,3)
"RTN","PSJHL7",24,0)
 S (PSGNESD,PSGNEFD)="" D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSJHLDFN)
"RTN","PSJHL7",25,0)
 I PSGOXT="D",'PSGSOY S PSGSOY=+$E(PSGNESD_"00011",9,12)
"RTN","PSJHL7",26,0)
 S ND=NEWORDER_U_PROVIDER_U_PSGMR_U_"U"_U_PSGSM_U_PSGHSM_U_PSGST_"^^P^^^^^"_LOGIN_U_PSJHLDFN_U_LOGIN S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSJHL7",27,0)
 S $P(ND,U,21)=$P(ORDER,U),$P(ND,U,24,25)=ROC_U_PREON
"RTN","PSJHL7",28,0)
 F X="PSGNESD","PSGNEFD" S:@X]"" @X=+@X
"RTN","PSJHL7",29,0)
 S ND2=PSGSCH_U_PSGNESD_"^^"_PSGNEFD_U_PSGSOY_U_PSGOXT
"RTN","PSJHL7",30,0)
 S F="^PS(53.1,"_NEWORDER_",",@(F_"0)")=ND,^(.2)=OIDRG_U_PSGDO_U_ORDCON_U_PRIORITY_U_DOSE_U_UNIT_U_U_$G(PRNTON),^(2)=ND2 S:$G(PSGSI)]"" ^(6)=PSGSI
"RTN","PSJHL7",31,0)
 I $D(DRUGS) D
"RTN","PSJHL7",32,0)
 .I $D(@(F_"1,0)")) K @(F_"1)")
"RTN","PSJHL7",33,0)
 .; Naked reference below refers to full reference to ^PS(53.1,+NEWORDER in variable F created using indirection.
"RTN","PSJHL7",34,0)
 .I '$D(@(F_"1,0)")) S ^(0)="^53.11P^0^0"
"RTN","PSJHL7",35,0)
 .S JJ=0 F  S JJ=$O(DRUGS(JJ)) Q:'JJ  I $S('$P(DRUGS(JJ),U,3):1,1:$P(DRUGS(JJ),U,3)>DT) S $P(@(F_"1,0)"),"^",3,4)=JJ_"^"_JJ,@(F_"1,"_JJ_",0)")=$P(DRUGS(JJ),U,1,2),@(F_"1,""B"","_+DRUGS(JJ)_","_JJ_")")=""
"RTN","PSJHL7",36,0)
 S PSJOSTOP=$G(@("^PS(55,"_PSJHLDFN_",5,"_+$G(PREON)_",2)")),PSJOSTOP=$P(PSJOSTOP,"^",4)
"RTN","PSJHL7",37,0)
 D REN531(NEWORDER,$P(ND,"^",14),$S($G(PREON)["U":$P(ND,"^",2),1:$P(ND,"^",6)),PSJOSTOP,PSJHLDFN)
"RTN","PSJHL7",38,0)
 ;
"RTN","PSJHL7",39,0)
DONE ;
"RTN","PSJHL7",40,0)
 N DA,DR,DIE,PSIVACT,PSIVALT,ON55,PSIVREA
"RTN","PSJHL7",41,0)
 S DIE=$S(PREON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+PREON,DA(1)=PSJHLDFN,DR=$S(PREON["V":"100////R;123////R;114////"_PSJORDER,1:"28////R;107////R;105////"_PSJORDER)
"RTN","PSJHL7",42,0)
 I PREON["A"!(PREON["U") S PSGAL("C")=18000 D ^PSGAL5
"RTN","PSJHL7",43,0)
 I PREON["V" S PSIVACT=1,PSIVALT=2,ON55=PREON,PSIVREA="R"
"RTN","PSJHL7",44,0)
 D ^DIE
"RTN","PSJHL7",45,0)
 I PREON["V" N DFN S DFN=PSJHLDFN D LOG^PSIVORAL
"RTN","PSJHL7",46,0)
 S PSJHLMTN="ORM" D EN1^PSJHL2(PSJHLDFN,"SC",PREON) S PSJHLMTN="ORR",PSOC="NW"
"RTN","PSJHL7",47,0)
 Q
"RTN","PSJHL7",48,0)
IVSET ;
"RTN","PSJHL7",49,0)
 N DRG,DRGN,P
"RTN","PSJHL7",50,0)
 S P("RES")="R",P("REN")="",Y=$G(^PS(55,PSJHLDFN,"IV",+PREON,0)) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSJHL7",51,0)
 S P("PON")=PREON,P(21)=$P(ORDER,U),P(6)=PROVIDER_U_$P($G(^VA(200,+PROVIDER,0)),U),(DRG,DRGN)="",P("REM")=$G(^PS(55,PSJHLDFN,"IV",+PREON,1))
"RTN","PSJHL7",52,0)
 S Y=$G(^PS(55,PSJHLDFN,"IV",+PREON,2)),P("LOG")=LOGIN
"RTN","PSJHL7",53,0)
 S P("CLRK")=CLERK_U_$P($G(^VA(200,+CLERK,0)),U),P("RES")=ROC,P("FRES")=$P(Y,U,9),P("SYRS")=$P(Y,U,4),P("OPI")=$G(^PS(55,PSJHLDFN,"IV",+PREON,3))
"RTN","PSJHL7",54,0)
 S ND=$G(^PS(55,PSJHLDFN,"IV",+PREON,.2)),P("PD")=$S($P(ND,U):$P(ND,U)_U_$P($G(^PS(50.7,+ND,0)),U),1:""),P("DO")=$P(ND,U,2)
"RTN","PSJHL7",55,0)
 S P("MR")=$P(ND,U,3),ND=$G(^PS(51.2,+P("MR"),0)),P("MR")=P("MR")_U_$S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U))
"RTN","PSJHL7",56,0)
 D GTDRG
"RTN","PSJHL7",57,0)
 S P("OT")=$S(P(4)="A":"F",P(4)="H":"I",1:"I")
"RTN","PSJHL7",58,0)
 I P("OT")="F" F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I '$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSJHL7",59,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSJHL7",60,0)
 N IVLIM,IVLIMIT S IVLIM=$$GETDUR^PSJLIVMD(PSJHLDFN,+PREON,$E(PREON,$L(PREON)),1) I IVLIM]"",$G(IVLIMIT) S $P(^PS(53.1,+NEWORDER,2.5),U,4)=IVLIM
"RTN","PSJHL7",61,0)
 S ND(0)=+NEWORDER_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_P("OT")_U_U_U_"C",$P(ND(0),U,9)="P"
"RTN","PSJHL7",62,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_PSJHLDFN_U_P("LOG"),$P(ND(0),U,21)=P(21),$P(ND(0),U,24,26)=$G(P("RES"))_U_P("PON")
"RTN","PSJHL7",63,0)
 S ND(2)=P(9)_U_U_U_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSJHL7",64,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSJHL7",65,0)
 F X=0,2,4,8,9 S ^PS(53.1,+NEWORDER,X)=ND(X)
"RTN","PSJHL7",66,0)
 S:+P("PD") ^PS(53.1,+NEWORDER,.2)=+P("PD")_U_P("DO")
"RTN","PSJHL7",67,0)
 S $P(^PS(53.1,+NEWORDER,.2),"^",3,4)=ORDCON_U_PRIORITY
"RTN","PSJHL7",68,0)
 ;I $G(PRNTON) I $$UP^XLFSTR($G(PSGSCH))="NOW" S PRNTON=""
"RTN","PSJHL7",69,0)
 I $G(PRNTON) S $P(^PS(53.1,+NEWORDER,.2),"^",8)=PRNTON
"RTN","PSJHL7",70,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSJHL7",71,0)
 S PSJOSTOP=$G(@("^PS(55,"_PSJHLDFN_",""IV"","_+PREON_",0)")),PSJOSTOP=$P(PSJOSTOP,"^",3) D
"RTN","PSJHL7",72,0)
 .N IVND S IVND=$G(^PS(53.1,+NEWORDER,0)) D REN531(NEWORDER,$P(IVND,"^",14),$P(ND,"^",2),PSJOSTOP,PSJHLDFN)
"RTN","PSJHL7",73,0)
 Q
"RTN","PSJHL7",74,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSJHL7",75,0)
 K ^PS(53.1,+NEWORDER,DRGT) S ^PS(53.1,+NEWORDER,DRGT,0)=$S(DRGT="AD":"^53.157PA^0^0",1:"^53.158PA^0^0")
"RTN","PSJHL7",76,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJHL7",77,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+NEWORDER,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJHL7",78,0)
 .S ^PS(53.1,+NEWORDER,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+NEWORDER,DRGT,+DRG,0)=Y,^PS(53.1,+NEWORDER,DRGT,"B",+X1,+DRG)=""
"RTN","PSJHL7",79,0)
 I $G(P("RES"))="R",($G(ND(0))]"") D REN531(+NEWORDER,$P(ND(0),"^",14),$P(ND(0),"^",2),$G(P(3)),$G(DFN))
"RTN","PSJHL7",80,0)
 Q
"RTN","PSJHL7",81,0)
 ;
"RTN","PSJHL7",82,0)
ENRNAT(OWD,NWD,SC,OAT) ;Determine admin times for renewal orders.
"RTN","PSJHL7",83,0)
 ;OWD=ORIGINAL W,NWD=NEW WD LOCATION, SC=SCHEDULE, OAT=ORDER ADMIN TIMES
"RTN","PSJHL7",84,0)
 N OWAT,SCP,X,Y,OOAT
"RTN","PSJHL7",85,0)
 S OOAT=OAT,SCP=+$O(^PS(51.1,"APPSJ",+SC,0)),WAT=$P($G(^PS(51.1,SCP,1,+$G(OWD),0)),U,2)
"RTN","PSJHL7",86,0)
 F X="WAT","OAT" F Y=1:1 Q:$L(@X)>240!($P(@X,"-",Y)="")  S $P(@X,"-",Y)=$P(@X,"-",Y)_$E("0000",1,4-$L($P(@X,"-",Y)))
"RTN","PSJHL7",87,0)
 I OAT'=WAT Q OOAT
"RTN","PSJHL7",88,0)
 S X=$P($G(^PS(51.1,+SCP,1,NWD,0)),U,2) I X Q X
"RTN","PSJHL7",89,0)
 Q OOAT
"RTN","PSJHL7",90,0)
 ;
"RTN","PSJHL7",91,0)
GTDRG ; Get drug info and place in DRG(. 
"RTN","PSJHL7",92,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,PSJHLDFN,"IV",+PREON,DRGT,Y)) Q:'Y  D
"RTN","PSJHL7",93,0)
 .;Naked reference ^(Y,0) below refers to full global reference ^PS(55,PSJHLDFN,"IV",+PREON,DRGT,Y)) above at GTDRG+1
"RTN","PSJHL7",94,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,DRG(DRGT,0))=$G(DRG(DRGT,0))+1,DRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSJHL7",95,0)
 Q
"RTN","PSJHL7",96,0)
 ;
"RTN","PSJHL7",97,0)
REN531(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSGP) ;
"RTN","PSJHL7",98,0)
 Q:'PSGORD!'PSGDT!'PSGOEPR!'PSGOFD!'PSGP
"RTN","PSJHL7",99,0)
 N DUP,PSGOLDPR I $G(PREON) D  Q:$G(DUP)
"RTN","PSJHL7",100,0)
 .S:$D(^PS(53.1,+PSGORD,14,"B",+PSGDT)) DUP=1 Q
"RTN","PSJHL7",101,0)
 S:$G(PREON)["U" PSGOLDPR=$P($G(^PS(55,PSGP,5,+PREON,0)),"^",2)
"RTN","PSJHL7",102,0)
 S:$G(PREON)["V" PSGOLDPR=$P($G(^PS(55,PSGP,"IV",+PREON,0)),"^",6)
"RTN","PSJHL7",103,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(53.1,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="53.1114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSJHL7",104,0)
 . S DIC("DR")=".01////"_$G(PSGDT)_";1////"_$G(DUZ)_";2////"_$S($G(PSGOLDPR):$G(PSGOLDPR),1:$G(PSGOEPR))_";3////"_$G(PSGOFD),X=$G(PSGDT) D FILE^DICN
"RTN","PSJHL7",105,0)
 K DO,DINUM
"RTN","PSJHL7",106,0)
 I $G(PREON)["U",$D(^PS(55,PSGP,5,+PREON,15,1)) D
"RTN","PSJHL7",107,0)
 .N PSJSYSP S PSJSYSP=$J D GETSI^PSJBCMA5(PSGP,PREON) I $D(^PS(53.45,$J,5)) D FILESI^PSJBCMA5(PSGP,$S(PSGORD=+PSGORD:+PSGORD_"P",1:PSGORD))
"RTN","PSJHL7",108,0)
 I $G(PREON)["V",$D(^PS(55,PSGP,"IV",+PREON,10,1)) D
"RTN","PSJHL7",109,0)
 .N PSJSYSP S PSJSYSP=$J D GETOPI^PSJBCMA5(PSGP,PREON) I $D(^PS(53.45,$J,6)) D FILEOPI^PSJBCMA5(PSGP,$S(PSGORD=+PSGORD:+PSGORD_"P",1:PSGORD))
"RTN","PSJHL7",110,0)
 Q
"RTN","PSJHL7",111,0)
 ;
"RTN","PSJHL7",112,0)
CHK(X,Y,Z) ;Check for required fields
"RTN","PSJHL7",113,0)
 ; Input: X="^^"_MED ROUTE_"^^^^"_SCH TYPE
"RTN","PSJHL7",114,0)
 ;        Y=ORDERABLE ITEM_"^"_DOSAGE ORDERED
"RTN","PSJHL7",115,0)
 ;        Z=SCHEDULE_"^"_START DATE/TIME_"^^"_STOP DATE/TIME
"RTN","PSJHL7",116,0)
 S:'$D(^PS(50.7,+Y,0)) CHK=1
"RTN","PSJHL7",117,0)
 I ND="" S CHK=CHK_23
"RTN","PSJHL7",118,0)
 E  S CHK=CHK_$S($P(X,"^",3):"",1:2)_$S($P(X,"^",7)]"":"",1:3)
"RTN","PSJHL7",119,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSJHL7",120,0)
 S:'$$DDOK^PSJHL10("^TMP(""PSB"","_$J_",700,",+Y) CHK=CHK_7
"RTN","PSJHL7",121,0)
 ;
"RTN","PSJHL7",122,0)
CHKM ;
"RTN","PSJHL7",123,0)
 Q:'CHK
"RTN","PSJHL7",124,0)
 N MSG2
"RTN","PSJHL7",125,0)
 S MSG="THE FOLLOWING "_$S($L(CHK)>1:"ARE",1:"IS")_" EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:7 S:CHK[X MSG2=$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG","^",X)
"RTN","PSJHL7",126,0)
 S PSREASON=MSG_MSG2
"RTN","PSJHL7",127,0)
 Q
"RTN","PSJINVW")
0^42^B123707309^B101370185
"RTN","PSJINVW",1,0)
PSJINVW ;BIR/CML3-INSTRUCTION HISTORY ;17 SEP 97 /  1:41 PM
"RTN","PSJINVW",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**267,275**;16 DEC 97;Build 157
"RTN","PSJINVW",3,0)
 ;
"RTN","PSJINVW",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJINVW",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJINVW",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJINVW",7,0)
 ;
"RTN","PSJINVW",8,0)
EN0(PSJINHIS,PSJCHTO) ;
"RTN","PSJINVW",9,0)
 N PNM,PSJFULL S PSJFULL=20
"RTN","PSJINVW",10,0)
 D EN2 Q
"RTN","PSJINVW",11,0)
 Q
"RTN","PSJINVW",12,0)
EN2 ;
"RTN","PSJINVW",13,0)
 I PSGORD=+PSGORD N PSGO,PSGO1 S PSGO=PSGORD,PSGO1=0 F  S PSGO1=$O(^PS(53.1,"ACX",PSGO,PSGO1)) Q:'PSGO1  Q:$G(PSGOEA)["^"  S PSGORD=PSGO1_"P" D  S PSGORD=""
"RTN","PSJINVW",14,0)
 . D EN21 K CONT D  Q:$G(PSGOEA)["^"
"RTN","PSJINVW",15,0)
 .. W !!,"Press RETURN to continue or '^' to exit: " S PN=$G(PN)+2 R CONT:DTIME W @IOF S:CONT["^" PSGOEA="^",PSGPR=1,PSJPR=1
"RTN","PSJINVW",16,0)
 I PSGORD="" S PSGOEA="^" Q
"RTN","PSJINVW",17,0)
EN21 ;
"RTN","PSJINVW",18,0)
 N PSIVFLG S PSIVFLG=0 I PSGORD["P" S PSIVFLG=$P(^PS(53.1,+PSGORD,0),"^",4) S PSIVFLG=$S(PSIVFLG="F":1,PSIVFLG="I":1,1:0)
"RTN","PSJINVW",19,0)
 S NF=$S(PSGORD["P":1,PSGORD["N":1,1:0)
"RTN","PSJINVW",20,0)
 S (FL,Y)="",$P(FL,"-",71)="",F="^PS("_$S(NF:"53.1,",(PSGORD["V"):"55,"_PSGP_",""IV"",",1:"55,"_PSGP_",5,")_+PSGORD_","
"RTN","PSJINVW",21,0)
 S PNM=$G(PSGP(0)) S:PNM="" PNM=$P($G(^DPT(PSGP,0)),"^")
"RTN","PSJINVW",22,0)
 Q:($G(@(F_"0)"))="")
"RTN","PSJINVW",23,0)
 I $G(PSJINHIS) D PSJINHIS(1,.PSJCHTO) Q
"RTN","PSJINVW",24,0)
DONE ;
"RTN","PSJINVW",25,0)
 K AND,D,DRG1,DRG2,AT,DO,DRG,EB,F,FD,FL,HSM,INS,LID,MR,ND4,OD,PN,PR,PSGID,PSGOD,R,SCH,SCT,SI,SIG,SM,ST,STD,UD,X,XU,Y,DONE,NF, Q
"RTN","PSJINVW",26,0)
 Q
"RTN","PSJINVW",27,0)
 ;
"RTN","PSJINVW",28,0)
PSJINHIS(PSJINHIS,PSJCHTO) ;
"RTN","PSJINVW",29,0)
 I '$G(PSJHDRF) S PSJHDRF=1 N DASH S $P(DASH,"-",75)="-" D
"RTN","PSJINVW",30,0)
 .I $E(IOST)="C" D FULL^VALM1 W @IOF
"RTN","PSJINVW",31,0)
 .W !?25,"Instructions History",!,DASH S PN=$G(PN)+2
"RTN","PSJINVW",32,0)
 N AND,AND2,PX S PX=""
"RTN","PSJINVW",33,0)
 N INDENT1,INDENT2 S INDENT1=2,INDENT2=5
"RTN","PSJINVW",34,0)
 I '$G(PSJPRCOM) D GETPRCOM Q:($G(PX)["^")
"RTN","PSJINVW",35,0)
 D ENA Q:($G(PX)["^")
"RTN","PSJINVW",36,0)
 Q:$G(PSJCHTO)=2
"RTN","PSJINVW",37,0)
 I $G(PSGORD)["V"!$G(PSIVFLG) D PSGOPI Q
"RTN","PSJINVW",38,0)
 D PSGSI
"RTN","PSJINVW",39,0)
 Q
"RTN","PSJINVW",40,0)
 ;
"RTN","PSJINVW",41,0)
PSGSI ;
"RTN","PSJINVW",42,0)
 N SI,Q,QQ,QQQ S SI=$S(($G(PSGORD)["P"):$P($G(^PS(53.1,+PSGORD,6)),"^"),($G(PSGORD)["U"):$P($G(^PS(55,PSGP,5,+PSGORD,6)),"^"),1:"")
"RTN","PSJINVW",43,0)
 N SIL S SIL=$$GETSIOPI^PSJBCMA5(PSGP,PSGORD,1) I SIL!(SI]"") D
"RTN","PSJINVW",44,0)
 .Q:($G(PX)["^")
"RTN","PSJINVW",45,0)
 .I '$G(PSJCHTO) N PSJUDGL,PSJUDPH S PSJUDGL=$S($G(PSGORD)["P":"^PS(53.1,+PSGORD,",$G(PSGORD)["U":"^PS(55,PSGP,5,+PSGORD,",1:"") D
"RTN","PSJINVW",46,0)
 ..I '$G(AND) N AND S AND=$P(@(PSJUDGL_"0)"),"^",16) S PSJUDPH=@(PSJUDGL_"4)") S $P(AND,"^",2)=$S($P(PSJUDPH,"^",3):$P(PSJUDPH,"^",3),$P(PSJUDPH,"^",7):$P(PSJUDPH,"^",7),1:"")
"RTN","PSJINVW",47,0)
 ..D:$G(PN)>PSJFULL NPAGE W !!,"Date: ",$$ENDTC^PSGMI(+AND) S PN=$G(PN)+3 W ?28,"User: ",$$ENNPN^PSGMI($P(AND,"^",2)),!?INDENT1,"SPECIAL INSTRUCTIONS changed" D
"RTN","PSJINVW",48,0)
 ...W !?INDENT1,"From: ''",! S PSJCHTO=1 S PN=$G(PN)+2
"RTN","PSJINVW",49,0)
 .I SI]"",'SIL W !?INDENT1,"To:",!?INDENT2 S PSJCHTO=2,PN=$G(PN)+2 D  Q
"RTN","PSJINVW",50,0)
 ..S QQQ="" F Q=1:1:$L(SI," ") S QQ=$P(SI," ",Q) W:($L(QQQ_" "_QQ)>72) ! W QQ," " S:($L(QQQ_" "_QQ)>72) QQQ="" S QQQ=QQQ_" "_QQ
"RTN","PSJINVW",51,0)
 .I $G(PSJCHTO)=2,$D(TMPTO(DFN,1)) W !?INDENT1,"From: " S PSJCHTO=1,PN=$G(PN)+1 N TMPTOLN S TMPTOLN=0 F  S TMPTOLN=$O(TMPTO(DFN,TMPTOLN)) Q:'TMPTOLN!(PX["^")  W !?INDENT2,TMPTO(DFN,TMPTOLN) S PN=PN+1 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",52,0)
 .Q:'$G(PSJSYSP)  N LNTXT S LNTXT=0 F  S LNTXT=$O(^TMP("PSJBCMA5",$J,PSGP,PSGORD,LNTXT)) Q:'LNTXT  D
"RTN","PSJINVW",53,0)
 ..I LNTXT=1 W !?INDENT1,"To:" S PSJCHTO=2 S PN=$G(PN)+1
"RTN","PSJINVW",54,0)
 ..W !?INDENT2,$G(^TMP("PSJBCMA5",$J,PSGP,PSGORD,LNTXT)) S PN=$G(PN)+1 K:LNTXT=1 TMPTO S TMPTO(DFN,LNTXT)=^(LNTXT)
"RTN","PSJINVW",55,0)
 Q
"RTN","PSJINVW",56,0)
 ;
"RTN","PSJINVW",57,0)
PSGOPI ;
"RTN","PSJINVW",58,0)
 N DT,USR,TXTLN,POPIL,POPI S POPI=$S($G(PSGORD)["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,3)),"^"),$G(PSGORD)["P":$P($G(^PS(53.1,+PSGORD,9)),"^",2),1:"")
"RTN","PSJINVW",59,0)
 S POPIL=$$GETSIOPI^PSJBCMA5(PSGP,PSGORD,1) I POPIL!(POPI]"") D
"RTN","PSJINVW",60,0)
 .Q:($G(PX)["^")
"RTN","PSJINVW",61,0)
 .I '$G(PSJCHTO) S $P(AND,"^")=$S(PSGORD["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,2,1)),"^"),PSGORD["P":$P($G(^PS(53.1,+PSGORD,0)),"^",16),1:"") D
"RTN","PSJINVW",62,0)
 ..S $P(AND,"^",2)=$S(PSGORD["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,4)),"^",4),PSGORD["P":$P($G(^PS(53.1,+PSGORD,4)),"^",7),1:"")
"RTN","PSJINVW",63,0)
 ..D:($G(PN)>PSJFULL) NPAGE W !!,"Date: ",$$ENDTC^PSGMI(+AND) S PN=$G(PN)+2 W ?28,"User: ",$$ENNPN^PSGMI($P(AND,"^",2)),!,"OTHER PRINT INFO changed" D
"RTN","PSJINVW",64,0)
 ...W !?INDENT1,"From: ",!?INDENT2,"""""",! S PSJCHTO=1 S PN=$G(PN)+4
"RTN","PSJINVW",65,0)
 .I $G(PSJCHTO)=2,$D(TMPTO(DFN,1)) W !?INDENT1,"From: " S PSJCHTO=1,PN=$G(PN)+1 N TMPTOLN S TMPTOLN=0 F  S TMPTOLN=$O(TMPTO(DFN,TMPTOLN)) Q:'TMPTOLN!(PX["^")  W !?INDENT2,TMPTO(DFN,TMPTOLN) S PN=PN+1 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",66,0)
 .S TXTLN=0 F  S TXTLN=$O(^TMP("PSJBCMA5",$J,PSGP,PSGORD,TXTLN)) Q:'TXTLN!($G(PX)["^")  D
"RTN","PSJINVW",67,0)
 ..I (TXTLN=1) W !?INDENT1,"To:" S PN=$G(PN)+1
"RTN","PSJINVW",68,0)
 ..W !?INDENT2,^TMP("PSJBCMA5",$J,PSGP,PSGORD,TXTLN) S PN=$G(PN)+1,PSJCHTO=2 K:TXTLN=1 TMPTO S TMPTO(DFN,TXTLN)=^(TXTLN) D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",69,0)
 Q
"RTN","PSJINVW",70,0)
ENA ;
"RTN","PSJINVW",71,0)
 I PSGORD["U" F Q=0:0 S Q=$O(^PS(55,PSGP,5,+PSGORD,9,Q)) Q:'Q!(PX["^")  I $D(^(Q,0)) S AND=^(0) D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D AL1
"RTN","PSJINVW",72,0)
 I PSGORD["P" F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,"A",Q)) Q:'Q!(PX["^")  I $D(^(Q,0)) S AND=^(0) D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D AL1
"RTN","PSJINVW",73,0)
 I PSGORD["V" S Q=0 F  S Q=$O(^PS(55,PSGP,"IV",+PSGORD,"A",Q)) Q:'Q!(PX["^")  D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  S AND2=$G(^(Q,1,1,0)) I ($G(AND2)["OTHER PRINT INFO") D
"RTN","PSJINVW",74,0)
 .S AND=$G(^PS(55,PSGP,"IV",+PSGORD,"A",Q,0)) D:($G(PN)>PSJFULL) NPAGE D AL1
"RTN","PSJINVW",75,0)
 I ($G(PX)["^") S DONE=1
"RTN","PSJINVW",76,0)
 Q
"RTN","PSJINVW",77,0)
AL1 ; Activity Logs
"RTN","PSJINVW",78,0)
 S UD=$P(AND,"^",3)
"RTN","PSJINVW",79,0)
 I AND["SPECIAL INSTRUCTIONS" D  Q
"RTN","PSJINVW",80,0)
 .I ($G(PSGORD)["U") D
"RTN","PSJINVW",81,0)
 ..N LAST,Q2 S Q2=0 F  S Q2=$O(^PS(55,DFN,5,+PSGORD,9,Q,Q2)) Q:'Q2!(PX["^")  N Q3 S Q3=0 F  S Q3=$O(^PS(55,DFN,5,+PSGORD,9,Q,Q2,Q3)) Q:'Q3!(PX["^")  D
"RTN","PSJINVW",82,0)
 ...S LAST=$G(LAST)+1
"RTN","PSJINVW",83,0)
 ...I ($G(PSJCHTO)<2),(Q3=1),(Q2=1) D
"RTN","PSJINVW",84,0)
 ....I '$G(PSJCHTO) D:($G(PN)>PSJFULL) NPAGE Q:($G(PX)["^")  D DATUSR(+AND,$P(AND,"^",2),"SPECIAL INSTRUCTIONS changed")
"RTN","PSJINVW",85,0)
 ....W !?INDENT1,"To:" S PN=$G(PN)+1 N TMPQ3 S TMPQ3=0 F  S TMPQ3=$O(^PS(55,DFN,5,+PSGORD,9,Q,Q2,TMPQ3)) Q:'TMPQ3!(PX["^")  W !?INDENT2,^PS(55,DFN,5,+PSGORD,9,Q,Q2,TMPQ3,0) S PN=$G(PN)+1 S PSJCHTO=2 K:TMPQ3=1 TMPTO S TMPTO(DFN,TMPQ3)=^(0)
"RTN","PSJINVW",86,0)
 ...Q:PX["^"  D:($G(PN)>PSJFULL) NPAGE Q:PX["^"
"RTN","PSJINVW",87,0)
 ...I (Q3=1),(Q2=1) D:($G(PN)>PSJFULL) NPAGE Q:($G(PX)["^")  D DATUSR(+AND,$P(AND,"^",2),"SPECIAL INSTRUCTIONS changed")
"RTN","PSJINVW",88,0)
 ...Q:($G(PX)["^")  I (Q3=1) W !?INDENT1,$S(PSJCHTO=2:"From: ",PSJCHTO=1:"To:",1:"") S PSJCHTO=$S(PSJCHTO=2:1,1:2) S PN=$G(PN)+1 D:($G(PN)>PSJFULL)
"RTN","PSJINVW",89,0)
 ...W !?INDENT2,^PS(55,DFN,5,+PSGORD,9,Q,Q2,Q3,0) S PN=$G(PN)+1 K:Q3=1 TMPTO S:PSJCHTO=2 TMPTO(DFN,Q3)=^(0)
"RTN","PSJINVW",90,0)
 ..I '$G(LAST) N Q2TM,Q0TM S Q2TM=$P($G(^PS(55,DFN,5,+PSGORD,9,Q,0)),"^"),Q0TM=$P($G(^PS(55,DFN,5,+PSGORD,9,1,0)),"^") Q:($$FMDIFF^XLFDT(Q2TM,Q0TM,2)>0)  D
"RTN","PSJINVW",91,0)
 ...D CPYPC(DFN,PSGORD,Q)
"RTN","PSJINVW",92,0)
 .I ($G(PSGORD)["P") D
"RTN","PSJINVW",93,0)
 ..I '$O(^PS(53.1,+PSGORD,"A",Q,0)) D
"RTN","PSJINVW",94,0)
 ...D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D DATUSR(+AND,$P(AND,"^",2),"SPECIAL INSTRUCTIONS changed")
"RTN","PSJINVW",95,0)
 ...N FROM S FROM=$P(AND,"^",5) W !?INDENT1,"From: " S PN=$G(PN)+1 S PSJCHTO=1 D
"RTN","PSJINVW",96,0)
 ....I FROM]"" W !?INDENT2,FROM S PN=$G(PN)+1 Q
"RTN","PSJINVW",97,0)
 ....I $D(TMPTO(DFN,1)) N TMPTOLN S TMPTOLN=0 F  S TMPTOLN=$O(TMPTO(DFN,TMPTOLN)) Q:'TMPTOLN!(PX["^")  W !?INDENT2,TMPTO(DFN,TMPTOLN) S PN=PN+1 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",98,0)
 ..N QB S QB=0 F  S QB=$O(^PS(53.1,+PSGORD,"A",Q,QB)) Q:'QB!(PX["^")  N Q2 S Q2=0 F  S Q2=$O(^PS(53.1,+PSGORD,"A",Q,QB,Q2)) Q:'Q2!(PX["^")  D
"RTN","PSJINVW",99,0)
 ...I ($G(PSJCHTO)<2),(Q2=1),(QB=1) W !?INDENT1,"To:" S PN=$G(PN)+1,PSJCHTO=2 D
"RTN","PSJINVW",100,0)
 ....N TMPQ2 S TMPQ2=0 F  S TMPQ2=$O(^PS(53.1,+PSGORD,"A",Q,QB,TMPQ2)) Q:'TMPQ2!(PX["^")  W !?INDENT2,^PS(53.1,+PSGORD,"A",Q,QB,TMPQ2,0) S PN=$G(PN)+1 K:TMPQ2=1 TMPTO S TMPTO(DFN,TMPQ2)=^(0)
"RTN","PSJINVW",101,0)
 ...Q:PX["^"
"RTN","PSJINVW",102,0)
 ...I (Q2=1),(QB=1) D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D DATUSR(+AND,$P(AND,"^",2),"SPECIAL INSTRUCTIONS changed")
"RTN","PSJINVW",103,0)
 ...I (Q2=1) W !?INDENT1,$S(PSJCHTO=2:"From: ",PSJCHTO=2:"To:",1:"") S PSJCHTO=$S(PSJCHTO=2:1,1:2) S PN=$G(PN)+1
"RTN","PSJINVW",104,0)
 ...Q:PX["^"  W !?INDENT2,^PS(53.1,+PSGORD,"A",Q,QB,Q2,0) S PN=$G(PN)+1 D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  K:Q2=1 TMPTO S:PSJCHTO=2 TMPTO(DFN,Q2)=^(0)
"RTN","PSJINVW",105,0)
 I $G(AND2)["OTHER PRINT INFO"!($G(AND)["OTHER PRINT INFO") S PSJIVFLG=1 D
"RTN","PSJINVW",106,0)
 .I ($G(PSGORD)["V") N Q2 F Q2=2,3 Q:(PX["^")  N Q3 S Q3=0 F  S Q3=$O(^PS(55,DFN,"IV",+PSGORD,"A",Q,Q2,Q3)) Q:'Q3!(PX["^")  D
"RTN","PSJINVW",107,0)
 ..I ($G(PSJCHTO)=1),Q2=2,Q3=1 D
"RTN","PSJINVW",108,0)
 ...N TMPQ3 S TMPQ3=0 F  S TMPQ3=$O(^PS(55,DFN,"IV",+PSGORD,"A",Q,Q2,TMPQ3)) Q:'TMPQ3!(PX["^")  D
"RTN","PSJINVW",109,0)
 ....D:($G(PN)>PSJFULL) NPAGE W:TMPQ3=1 !?INDENT1,"To: " W !?INDENT2,^PS(55,DFN,"IV",+PSGORD,"A",Q,Q2,TMPQ3,0) K:TMPQ3=1 TMPTO S TMPTO(DFN,TMPQ3)=^(0)
"RTN","PSJINVW",110,0)
 ....S PN=PN+2,PSJCHTO=2 D:($G(PN)>PSJFULL) NPAGE Q:PX["^"
"RTN","PSJINVW",111,0)
 ..Q:PX["^"
"RTN","PSJINVW",112,0)
 ..I Q3=1,($G(PSJCHTO)'=1) D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D  Q:($G(PX)["^")
"RTN","PSJINVW",113,0)
 ...D DATUSR($P(AND,"^",5),$P(AND,"^",3),"OTHER PRINT INFO changed")
"RTN","PSJINVW",114,0)
 ...;W !!,"Date: ",$$ENDTC^PSGMI($P(AND,"^",5)) W ?28,"User: ",$$ENNPN^PSGMI($P(AND,"^",3)),!,"OTHER PRINT INFO changed" S PN=$G(PN)+3
"RTN","PSJINVW",115,0)
 ..I Q3=1,Q2=3,'$G(PSJCHTO) W !?INDENT1,"From: """"" S PSJCHTO=1,PN=$G(PN)+1
"RTN","PSJINVW",116,0)
 ..I Q3=1,Q2=3,PSJCHTO=2,$D(TMPTO(DFN,1)) W !?INDENT1,"From: " S PSJCHTO=1,PN=$G(PN)+1 N TMPTOLN S TMPTOLN=0 F  S TMPTOLN=$O(TMPTO(DFN,TMPTOLN)) Q:'TMPTOLN!(PX["^")  W !?INDENT2,TMPTO(DFN,TMPTOLN) S PN=PN+1 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",117,0)
 ..Q:(PX["^")  I Q3=1 W !?INDENT1,$S(PSJCHTO'=1:"From: ",PSJCHTO=1:"To: ",1:"") S PSJCHTO=$S(PSJCHTO=1:2,1:1) S PN=PN+1 Q:PX["^"
"RTN","PSJINVW",118,0)
 ..Q:PX["^"  W !?INDENT2,^PS(55,DFN,"IV",+PSGORD,"A",Q,Q2,Q3,0) K:Q3=1 TMPTO S:PSJCHTO=2 TMPTO(DFN,Q3)=^(0) S PN=PN+1 D:($G(PN)>PSJFULL) NPAGE Q:PX["^"
"RTN","PSJINVW",119,0)
 .I $G(PN)>PSJFULL D NPAGE Q:(PX["^")
"RTN","PSJINVW",120,0)
 .I ($G(PSGORD)["P") D:($G(PN)>PSJFULL) NPAGE Q:PX["^"  D
"RTN","PSJINVW",121,0)
 ..I ($G(PSJCHTO)'=1) W !,"Date: ",$$ENDTC^PSGMI(+AND) W ?28,"User: ",$$ENNPN^PSGMI($P(AND,"^",2)),!,"OTHER PRINT INFO changed" S PN=$G(PN)+2
"RTN","PSJINVW",122,0)
 ..I '$G(PSJCHTO) N FROM S FROM=$P(AND,"^",5),FROM=$S(FROM]"":FROM,1:"""""") W !?INDENT1,"From: ",!?INDENT2,FROM  S PSJCHTO=1,PN=$G(PN)+1
"RTN","PSJINVW",123,0)
 ..N QB S QB=0 F  S QB=$O(^PS(53.1,+PSGORD,"A",Q,QB)) Q:'QB!($G(PX)["^")  N Q2 S Q2=0 F  S Q2=$O(^PS(53.1,+PSGORD,"A",Q,QB,Q2)) Q:'Q2!($G(PX)["^")  D
"RTN","PSJINVW",124,0)
 ...I ($G(PSJCHTO)<2),(Q2=1),(QB=1) D:($G(PN)>PSJFULL) NPAGE W !?INDENT1,"To: " S PN=$G(PN)+2,PSJCHTO=2 D  W !
"RTN","PSJINVW",125,0)
 ....N TMPQ2 S TMPQ2=0 F  S TMPQ2=$O(^PS(53.1,+PSGORD,"A",Q,QB,TMPQ2)) Q:'TMPQ2!(PX["^")  W !?INDENT2,^PS(53.1,+PSGORD,"A",Q,QB,TMPQ2,0) S PN=$G(PN)+1 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",126,0)
 ...I (Q2=1),(QB=1) D DATUSR($P(AND,"^",5),$P(AND,"^",3),"OTHER PRINT INFO changed") ; W !,"Date: ",$$ENDTC^PSGMI(+AND) W:$S(UD'?4N:1,1:$E(UD,1,2)'=10) ?28,"User: ",$$ENNPN^PSGMI($P(AND,"^",2)),!,"OTHER PRINT INFO changed" S PN=$G(PN)+2
"RTN","PSJINVW",127,0)
 ...I (Q2=1) D:($G(PN)>PSJFULL) NPAGE W !?INDENT1,$S(QB=1:"From: ",QB=2:"To: ",1:"") S PSJCHTO=$S(QB=2:2,1:1) S PN=$G(PN)+1
"RTN","PSJINVW",128,0)
 ...Q:($G(PX)["^")  W !?INDENT2,^PS(53.1,+PSGORD,"A",Q,QB,Q2,0) S PN=$G(PN)+1 D:($G(PN)>PSJFULL) NPAGE Q:PX["^"
"RTN","PSJINVW",129,0)
 ..I ($G(PN)>PSJFULL) D NPAGE
"RTN","PSJINVW",130,0)
 Q
"RTN","PSJINVW",131,0)
 ;
"RTN","PSJINVW",132,0)
GETPRCOM ; Get provider comments
"RTN","PSJINVW",133,0)
 N PROVLN
"RTN","PSJINVW",134,0)
 I $G(PSGORD)["V" S PROVLN=0 F  S PROVLN=$O(^PS(55,DFN,"IV",+PSGORD,5,PROVLN)) Q:'PROVLN!($G(PX)["^")  D
"RTN","PSJINVW",135,0)
 .I (PROVLN=1) S DT=$P($G(^PS(55,DFN,"IV",+PSGORD,2)),"^"),USR=$P($G(^PS(55,DFN,"IV",+PSGORD,0)),"^",6) D DATUSR(DT,USR,"PROVIDER COMMENTS:") S PSJPRCOM=1
"RTN","PSJINVW",136,0)
 .W !?INDENT2,^PS(55,DFN,"IV",+PSGORD,5,PROVLN,0) S PN=$G(PN)+1 I ($G(PN)>PSJFULL) D NPAGE
"RTN","PSJINVW",137,0)
 I $G(PSGORD)["U" S PROVLN=0 F  S PROVLN=$O(^PS(55,DFN,5,+PSGORD,12,PROVLN)) Q:'PROVLN!($G(PX)["^")  D
"RTN","PSJINVW",138,0)
 .I (PROVLN=1) S DT=$P($G(^PS(55,DFN,5,+PSGORD,0)),"^",16),USR=$P($G(^PS(55,DFN,5,+PSGORD,0)),"^",2) D DATUSR(DT,USR,"PROVIDER COMMENTS:") S PSJPRCOM=1
"RTN","PSJINVW",139,0)
 .W !?INDENT2,^PS(55,DFN,5,+PSGORD,12,PROVLN,0) S PN=$G(PN)+1 I ($G(PN)>PSJFULL) D NPAGE
"RTN","PSJINVW",140,0)
 I $G(PSGORD)["P" S PROVLN=0 F  S PROVLN=$O(^PS(53.1,+PSGORD,12,PROVLN)) Q:'PROVLN!($G(PX)["^")  D
"RTN","PSJINVW",141,0)
 .I (PROVLN=1) S DT=$P($G(^PS(53.1,+PSGORD,0)),"^",16),USR=$P($G(^PS(53.1,+PSGORD,0)),"^",2) D DATUSR(DT,USR,"PROVIDER COMMENTS:") S PSJPRCOM=1
"RTN","PSJINVW",142,0)
 .W !?INDENT2,^PS(53.1,+PSGORD,12,PROVLN,0) S PN=$G(PN)+1 I ($G(PN)>PSJFULL) D NPAGE
"RTN","PSJINVW",143,0)
 D:($G(PN)>PSJFULL) NPAGE
"RTN","PSJINVW",144,0)
 Q
"RTN","PSJINVW",145,0)
NPAGE ; Pause
"RTN","PSJINVW",146,0)
 Q:$G(PSJPTR)
"RTN","PSJINVW",147,0)
 I PN<PSJFULL F PN=PN:1:PSJFULL-1 W !
"RTN","PSJINVW",148,0)
 I $E(IOST)="C" R !!,"Enter '^' to stop, or press RETURN to continue.",PX:DTIME D
"RTN","PSJINVW",149,0)
 .I $G(PX)["^" S DONE=1
"RTN","PSJINVW",150,0)
 .D FULL^VALM1 W @IOF
"RTN","PSJINVW",151,0)
 W !?25,"Instructions History" S PN=1
"RTN","PSJINVW",152,0)
 N DASH S $P(DASH,"-",75)="-" W !,DASH S PN=$G(PN)+1
"RTN","PSJINVW",153,0)
 Q
"RTN","PSJINVW",154,0)
 ;
"RTN","PSJINVW",155,0)
DATUSR(DT,USR,TXT) ;
"RTN","PSJINVW",156,0)
 I $G(PN)>(PSJFULL-5) D NPAGE Q:(PX["^")
"RTN","PSJINVW",157,0)
 N DAT,USER
"RTN","PSJINVW",158,0)
 S DAT=$$ENDTC^PSSGMI(DT),USER=$$ENNPN^PSGMI(USR)
"RTN","PSJINVW",159,0)
 W !!,"Date: ",DAT,?28,"User: ",USER,!,TXT S PN=$G(PN)+3
"RTN","PSJINVW",160,0)
 Q
"RTN","PSJINVW",161,0)
 ;
"RTN","PSJINVW",162,0)
CPYPC(DFN,PSGORD,Q) ; Handle Special Instructions copied in from Provider Comments during finishing
"RTN","PSJINVW",163,0)
 Q:$O(^PS(55,DFN,5,+PSGORD,9,Q,0))
"RTN","PSJINVW",164,0)
 N PS55ND0 S PS55ND0=$G(^PS(55,DFN,5,+PSGORD,0))
"RTN","PSJINVW",165,0)
 N PRVORD S PRVORD=$P(PS55ND0,"^",25) Q:'PRVORD
"RTN","PSJINVW",166,0)
 N PRVSI S PRVSI=$$GETSIOPI^PSJBCMA5(DFN,PRVORD,1) Q:'PRVSI
"RTN","PSJINVW",167,0)
 I ($G(PSJCHTO)=2) D
"RTN","PSJINVW",168,0)
 .D:($G(PN)>PSJFULL) NPAGE Q:($G(PX)["^")  D DATUSR(+AND,$P(AND,"^",2),"SPECIAL INSTRUCTIONS changed")
"RTN","PSJINVW",169,0)
 .W !?INDENT1,"From:" S PN=$G(PN)+1 N TMPQ3 S TMPQ3=0 F  S TMPQ3=$O(^TMP("PSJBCMA5",$J,DFN,PRVORD,TMPQ3)) Q:'TMPQ3!(PX["^")  D
"RTN","PSJINVW",170,0)
 ..W !?INDENT2,^TMP("PSJBCMA5",$J,DFN,PRVORD,TMPQ3) S PN=$G(PN)+1 S PSJCHTO=2 K:TMPQ3=1 TMPTO S TMPTO(DFN,TMPQ3)=^TMP("PSJBCMA5",$J,DFN,PRVORD,TMPQ3)
"RTN","PSJINVW",171,0)
 .S PSJCHTO=1
"RTN","PSJINVW",172,0)
 Q:PX["^"  D:($G(PN)>PSJFULL) NPAGE Q:PX["^"
"RTN","PSJINVW",173,0)
 D:($G(PN)>PSJFULL) NPAGE Q:($G(PX)["^")  D DATUSR(+AND,$P(AND,"^",2),"SPECIAL INSTRUCTIONS changed")
"RTN","PSJINVW",174,0)
 Q:($G(PX)["^")  W !?INDENT1,$S(PSJCHTO=2:"From: ",PSJCHTO=1:"To:",1:"") S PSJCHTO=$S(PSJCHTO=2:1,1:2) S PN=$G(PN)+1
"RTN","PSJINVW",175,0)
 N TOSI,FOUNDTO S TOSI=Q F  Q:$G(FOUNDTO)  S TOSI=$O(^PS(55,DFN,5,+PSGORD,9,TOSI)) Q:'TOSI  I $G(^PS(55,DFN,5,+PSGORD,9,TOSI,0))["SPECIAL INSTRUCTIONS" S FOUNDTO=TOSI
"RTN","PSJINVW",176,0)
 I $G(FOUNDTO) S TOSI=0 F  S TOSI=$O(^PS(55,DFN,5,+PSGORD,9,FOUNDTO,1,TOSI)) Q:'TOSI  D
"RTN","PSJINVW",177,0)
 .W !?INDENT2,^PS(55,DFN,5,+PSGORD,9,FOUNDTO,1,TOSI,0) S PN=$G(PN)+1 K:TOSI=1 TMPTO S:PSJCHTO=2 TMPTO(DFN,TOSI)=^(0)
"RTN","PSJINVW",178,0)
 Q:$G(FOUNDTO)
"RTN","PSJINVW",179,0)
 S TOSI=0 F  S TOSI=$O(^PS(55,DFN,5,+PSGORD,15,TOSI)) Q:'TOSI  W !?INDENT2,$G(^(TOSI,0))
"RTN","PSJINVW",180,0)
 Q
"RTN","PSJLIACT")
0^54^B49618322^B49301561
"RTN","PSJLIACT",1,0)
PSJLIACT ;BIR/MV-IV ACTION ;28 Jul 98 / 8:50 AM
"RTN","PSJLIACT",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**15,47,62,58,82,97,80,110,111,134,181,247,260,275**;16 DEC 97;Build 157
"RTN","PSJLIACT",3,0)
 ;
"RTN","PSJLIACT",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLIACT",5,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA 2410.
"RTN","PSJLIACT",6,0)
 ;
"RTN","PSJLIACT",7,0)
DC ; Discontinue order
"RTN","PSJLIACT",8,0)
 K PSGORQF
"RTN","PSJLIACT",9,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",10,0)
 S PSJCOM=+$S(PSJORD["V":$P($G(^PS(55,DFN,"IV",+PSJORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSJORD,.2)),"^",8))
"RTN","PSJLIACT",11,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSJORD)
"RTN","PSJLIACT",12,0)
 I PSJCOM F  W !!,"Do you want to discontinue this order" S %=1 D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSJLIACT",13,0)
 I PSJCOM,%'=1 S VALMBK="" Q
"RTN","PSJLIACT",14,0)
 I $G(ON55)["P",$G(PSIVOORD) S PSJORD=ON55 ;*247 - Correct DCing newly copied orders
"RTN","PSJLIACT",15,0)
 I PSJORD["V" D DC^PSIVORA D:'$G(PSJOCFLG) EN^PSJLIORD(DFN,ON) Q
"RTN","PSJLIACT",16,0)
 I PSJORD["P" N ON S ON=PSJORD D DISCONT^PSIVORC
"RTN","PSJLIACT",17,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",18,0)
 Q
"RTN","PSJLIACT",19,0)
ACEDIT ; Display LM screen and AC and EDit actions
"RTN","PSJLIACT",20,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",21,0)
 S VALMBCK=$S($G(PSIVACEP):"Q",1:"R")
"RTN","PSJLIACT",22,0)
 Q
"RTN","PSJLIACT",23,0)
AEEXIT ; Call for EXIT CODE in PSJ LM IV AC/EDIT
"RTN","PSJLIACT",24,0)
 K PSGORQF
"RTN","PSJLIACT",25,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSJLIACT",26,0)
 I ON["P" D GT531^PSIVORFA(DFN,ON) D:P("OT")'="I" GTDATA^PSJLIFN
"RTN","PSJLIACT",27,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",28,0)
 K PSIVENO
"RTN","PSJLIACT",29,0)
 Q
"RTN","PSJLIACT",30,0)
EDIT ; Edit order
"RTN","PSJLIACT",31,0)
 K PSIVFN1 NEW PSIVNBD
"RTN","PSJLIACT",32,0)
 I $D(PSGACT),PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJLIACT",33,0)
 D EDIT1
"RTN","PSJLIACT",34,0)
 Q:$D(PSIVNBD)!($G(PSIVCOPY)&'$G(PSIVENO))
"RTN","PSJLIACT",35,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",36,0)
 S VALMBCK=$S($G(PSIVFN1):"Q",1:"R")
"RTN","PSJLIACT",37,0)
 Q
"RTN","PSJLIACT",38,0)
EDIT1 ;
"RTN","PSJLIACT",39,0)
 K PSGORQF
"RTN","PSJLIACT",40,0)
 ;Ensure P() is defined
"RTN","PSJLIACT",41,0)
 I $D(P)<10 S XQORQUIT=1,P("PON")="",PSIVNBD=1 D  Q
"RTN","PSJLIACT",42,0)
 .W !,"WARNING: An error has occurred. Changes will not be saved"
"RTN","PSJLIACT",43,0)
 .D PAUSE^VALM1
"RTN","PSJLIACT",44,0)
 .S VALMBCK="Q"
"RTN","PSJLIACT",45,0)
 I "ANP"'[P(17) W !,"You cannot edit an inactive order" D PAUSE^VALM1 Q
"RTN","PSJLIACT",46,0)
 S:$G(ON55)="" ON55=$G(PSJORD)
"RTN","PSJLIACT",47,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",48,0)
 ;* Edit a new back door order
"RTN","PSJLIACT",49,0)
 I ($G(ON55)["V"&($G(P("21FLG"))="")) D  Q
"RTN","PSJLIACT",50,0)
 . D GSTRING^PSIVORE1,GTFLDS^PSIVORFE
"RTN","PSJLIACT",51,0)
 . I $G(ON55)["V",'$G(DONE) D OK^PSIVORE
"RTN","PSJLIACT",52,0)
 . S VALMBCK="Q",PSIVNBD=1
"RTN","PSJLIACT",53,0)
 ;* Edit an active order
"RTN","PSJLIACT",54,0)
 I $G(ON55)["V" NEW PSJEDIT1 D E^PSIVOPT1 D  Q
"RTN","PSJLIACT",55,0)
 . I $G(PSJIVBD) K PSJIVBD D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",56,0)
 I $G(ON55)["P" D EDIT^PSIVORC ;Edit incomplete order.
"RTN","PSJLIACT",57,0)
 K P("OVRIDE")
"RTN","PSJLIACT",58,0)
 Q
"RTN","PSJLIACT",59,0)
ACCEPT ; Accept order
"RTN","PSJLIACT",60,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",61,0)
 ;Accept IV from back door.
"RTN","PSJLIACT",62,0)
 I $G(PSJIVBD) K PSJIVBD D OK^PSIVORE S VALMBCK="Q" Q
"RTN","PSJLIACT",63,0)
 ;D:'$G(PSGORQF) IN^PSJOCDS($G(ON),"IV","") Q:$G(PSGORQF)
"RTN","PSJLIACT",64,0)
 I ON["V" D ACCEPT^PSIVOPT1 Q
"RTN","PSJLIACT",65,0)
 S PSIVFN1=1
"RTN","PSJLIACT",66,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIACT",67,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",68,0)
 Q
"RTN","PSJLIACT",69,0)
R ; Renewal
"RTN","PSJLIACT",70,0)
 K PSGORQF
"RTN","PSJLIACT",71,0)
 S PSJREN=1
"RTN","PSJLIACT",72,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",73,0)
 NEW PSIVAC S PSIVAC="PR" K PSGFDX
"RTN","PSJLIACT",74,0)
 D R^PSIVOPT
"RTN","PSJLIACT",75,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",76,0)
 K PSJREN
"RTN","PSJLIACT",77,0)
 Q
"RTN","PSJLIACT",78,0)
H ; Hold
"RTN","PSJLIACT",79,0)
 K PSGORQF
"RTN","PSJLIACT",80,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",81,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",82,0)
 D H^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",83,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",84,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",85,0)
 Q
"RTN","PSJLIACT",86,0)
L ; Activity Log
"RTN","PSJLIACT",87,0)
 NEW PSIVLAB,PSIVLOG,PSJHIS S (PSIVLAB,PSIVLOG)=1
"RTN","PSJLIACT",88,0)
 D EN^PSIVVW1
"RTN","PSJLIACT",89,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",90,0)
 S VALMBCK="R"
"RTN","PSJLIACT",91,0)
 Q
"RTN","PSJLIACT",92,0)
O ; On Call
"RTN","PSJLIACT",93,0)
 K PSGORQF
"RTN","PSJLIACT",94,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",95,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",96,0)
 D O^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",97,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",98,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",99,0)
 Q
"RTN","PSJLIACT",100,0)
VF ; Make the order active **ENHANCEMENTS MADE IN PSJ*5.0*260
"RTN","PSJLIACT",101,0)
 NEW PSIVCHG,PSGORQF,PSJVFF S PSIVCHG=0
"RTN","PSJLIACT",102,0)
 IF VALM("TITLE")="ACTIVE IV " W !!,">>>  Verify may not be selected at this point." D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSJLIACT",103,0)
 ELSE  IF $G(PSGSTAT)="NON-VERIFIED",$G(PSJNEWOE)=0 S PSJVFF=1 D EN^PSJGMRA($G(DFN),$G(PSGPD)),OC^PSIVOC D:'$G(PSGORQF) IN^PSJOCDS($G(PSGORD),"IV","") K PSJVFF Q:$G(PSGORQF)
"RTN","PSJLIACT",104,0)
 ELSE  IF '$G(PSGORQF),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",105,0)
 ELSE  IF $G(PSIVFN1),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",106,0)
 ELSE  IF $G(PSGDEF),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",107,0)
 ELSE  IF $G(PSIVCOPY),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",108,0)
 D ACTIVE^PSIVORC2
"RTN","PSJLIACT",109,0)
 Q
"RTN","PSJLIACT",110,0)
VF1(PSIVREA,PSIVAL,PSIVLOG) ;
"RTN","PSJLIACT",111,0)
 ;Update 4 node and set activity log.
"RTN","PSJLIACT",112,0)
 ;PSIVREA: the reason use by LOG^PSIVORAL
"RTN","PSJLIACT",113,0)
 ;PSIVAL : the description reason
"RTN","PSJLIACT",114,0)
 ;PSIVLOG: Log an activity if = 1
"RTN","PSJLIACT",115,0)
 K PSGORQF
"RTN","PSJLIACT",116,0)
 I '+$G(OD)!($L($G(OD))>16) K OD
"RTN","PSJLIACT",117,0)
 D:+PSJSYSU=3 ^PSIVORE1
"RTN","PSJLIACT",118,0)
 NEW DIE,DA,DR,PSJX,XX,PSIVACT,PSJRQND
"RTN","PSJLIACT",119,0)
 S PSIVACT=1
"RTN","PSJLIACT",120,0)
 S PSJX=$G(^PS(55,DFN,"IV",+ON55,4)),XX=""
"RTN","PSJLIACT",121,0)
 I $P(PSJX,U)="" S XX=";143////0"
"RTN","PSJLIACT",122,0)
 I $P(PSJX,U,4)="" S XX=XX_U_";142////0"
"RTN","PSJLIACT",123,0)
 D NOW^%DTC
"RTN","PSJLIACT",124,0)
 S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",125,0)
 I +PSJSYSU=3 S DR="140////"_DUZ_";141////"_$E(%,1,12)_";142////1"_$P(XX,U)
"RTN","PSJLIACT",126,0)
 I +PSJSYSU=1 S DR="16////"_DUZ_";17////"_$E(%,1,12)_";143////1"_$P(XX,U,2)
"RTN","PSJLIACT",127,0)
 I $G(P("PRY"))="D" S DR=DR_";.22////"_+P("IVRM")
"RTN","PSJLIACT",128,0)
 D ^DIE
"RTN","PSJLIACT",129,0)
 ; If pending IV renew is edited during finish, go back and DE the original active order left in RENEWED status
"RTN","PSJLIACT",130,0)
 S PREREN=$S(ON55["V":$G(@(DIE_"+ON55,2)")),1:""),PREREN=$P(PREREN,"^",5) I PREREN D  K PREREN
"RTN","PSJLIACT",131,0)
 . I PREREN["P" S PREREN=$G(@("^PS(53.1,+PREREN,0)")),PREREN=$P(PREREN,"^",25)
"RTN","PSJLIACT",132,0)
 . I PREREN["V" N PRERENOD S PRERENOD=$G(@("^PS(55,DFN,""IV"",+PREREN,0)")) I $P(PRERENOD,"^",17)="R",($G(P("RES"))="E") D
"RTN","PSJLIACT",133,0)
 ..  S DIE="^PS(55,"_DFN_",""IV"",",DA=+PREREN,DA(1)=DFN
"RTN","PSJLIACT",134,0)
 ..  S DR="100////D;.03////"_PSGDT S ORIGSTOP=$P($G(@("^PS(55,DFN,""IV"",+PREREN,2)")),"^",3) I ORIGSTOP S DR=DR_";116////"_ORIGSTOP
"RTN","PSJLIACT",135,0)
 ..  D ^DIE D EN1^PSJHL2(DFN,"SC",PREREN)
"RTN","PSJLIACT",136,0)
 K DR,DIE,DA
"RTN","PSJLIACT",137,0)
 I (+PSJSYSU=3)&($G(P("PRY"))="D") D
"RTN","PSJLIACT",138,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJLIACT",139,0)
 .Q:Y="N"
"RTN","PSJLIACT",140,0)
 .D MAIN^TIUEDIT(3,.TIUDA,DFN,"","","","",1)
"RTN","PSJLIACT",141,0)
 Q:'$G(PSIVLOG)
"RTN","PSJLIACT",142,0)
 I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D
"RTN","PSJLIACT",143,0)
 . NEW DIC,DA,X,Y,XX,DO D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJLIACT",144,0)
 . S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJLIACT",145,0)
 . S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJLIACT",146,0)
 . S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJLIACT",147,0)
 . D FILE^DICN
"RTN","PSJLIACT",148,0)
 NEW PSIVALCK
"RTN","PSJLIACT",149,0)
 S PSIVREA="V",PSIVALT=""
"RTN","PSJLIACT",150,0)
 S PSIVAL=PSIVAL_$S(+PSJSYSU=3:"PHARMACIST",1:"NURSE")
"RTN","PSJLIACT",151,0)
 D LOG^PSIVORAL K PSIVAL,PSIVREA,PSIVLN
"RTN","PSJLIACT",152,0)
 I $G(PSJORD)["P" S PSIVREA="V",PSIVALT="",PSGRDTX=$G(^PS(53.1,+PSJORD,2.5)) D
"RTN","PSJLIACT",153,0)
 . I $G(PSGRDTX) S PSIVAL="Requested Start Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U))) D LOG^PSIVORAL
"RTN","PSJLIACT",154,0)
 . I $P(PSGRDTX,U,3) S PSIVREA="V",PSIVALT="" S PSIVAL="Requested Stop Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U,3))) D LOG^PSIVORAL
"RTN","PSJLIACT",155,0)
 N DUR I $G(PSJORD) S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S(PSJORD["P":"P",1:"IV"),1) I DUR]""  D
"RTN","PSJLIACT",156,0)
 . K DR S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",157,0)
 . S DR=$S($G(IVLIMIT):"152////"_DUR,1:"151////"_DUR) K IVLIMIT
"RTN","PSJLIACT",158,0)
 . D ^DIE
"RTN","PSJLIACT",159,0)
 D EN1^PSJHL2(DFN,"SC",ON55)
"RTN","PSJLIACT",160,0)
 D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSJLIACT",161,0)
 D GT55^PSIVORFB S OLDON=$P($G(^PS(55,DFN,"IV",+ON55,2)),"^",5),P("OLDON")=OLDON
"RTN","PSJLIACT",162,0)
 N PSJPRIO,PSJSCH,NODE0,NODEP2 S NODE0=$G(^PS(55,DFN,"IV",+ON55,0)),NODEP2=$G(^PS(55,DFN,"IV",+ON55,.2))
"RTN","PSJLIACT",163,0)
 S PSJPRIO=$P(NODEP2,"^",4),PSJSCH=$P(NODE0,"^",9)
"RTN","PSJLIACT",164,0)
 I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCH)="NOW")!($G(PSJSCH)["STAT") D NOTIFY^PSJHL4(ON55,DFN,$G(PSJPRIO),$G(PSJSCH))
"RTN","PSJLIACT",165,0)
 Q
"RTN","PSJLIVMD")
0^52^B96668523^B95539776
"RTN","PSJLIVMD",1,0)
PSJLIVMD ;BIR/MV-SETUP LM TEMPLATE FOR INPT MED. IV ; 4/28/08 3:11pm
"RTN","PSJLIVMD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**37,50,63,58,81,91,80,116,110,111,180,134,209,254,267,275**;16 DEC 97;Build 157
"RTN","PSJLIVMD",3,0)
 ;
"RTN","PSJLIVMD",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLIVMD",5,0)
 ;
"RTN","PSJLIVMD",6,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVMD",7,0)
 I $G(ON55),($G(P(1))=+$G(ON55)) S PSJORD=ON55
"RTN","PSJLIVMD",8,0)
 D GTOT^PSIVUTL(P(4))
"RTN","PSJLIVMD",9,0)
 S:'$D(PSJSTAR) PSJSTAR="" S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",10,0)
 I $E(P("OT"))'="I" D EN^PSJLIVFD Q
"RTN","PSJLIVMD",11,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVMD",12,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVMD",13,0)
 S PSJLN=1
"RTN","PSJLIVMD",14,0)
 I $G(PSIV531),P("PON")["P" S (P(2),P(3),P(4))=""
"RTN","PSJLIVMD",15,0)
AD ;
"RTN","PSJLIVMD",16,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVMD",17,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVMD",18,0)
 S PSJL=PSJL_" Additives:"
"RTN","PSJLIVMD",19,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,28,14)_+P("PON")
"RTN","PSJLIVMD",20,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,54,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVMD",21,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG) S PSJVD=$TR(PSJVD," ")
"RTN","PSJLIVMD",22,0)
 I $D(^TMP("PSJINTER",$J))!$$OVRCHK^PSGSICH1(PSGP,$G(PSJORD)) S PSJVD=$S($G(PSJVD)["DIN":"<OCI><DIN>",1:"<OCI>")
"RTN","PSJLIVMD",23,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,(80-$L(PSJVD)),$L(PSJVD))
"RTN","PSJLIVMD",24,0)
 I $D(IORVON),($G(PSJVD)]"") D CNTRL^VALM10(1,(80-$L(PSJVD)),$L(PSJVD),IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVMD",25,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",26,0)
 D:+$G(PSJLMX) CLRDSPL
"RTN","PSJLIVMD",27,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVMD",28,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVMD",29,0)
SOL ;
"RTN","PSJLIVMD",30,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVMD",31,0)
 S PSJL=PSJL_" Solutions:"
"RTN","PSJLIVMD",32,0)
 I P("SYRS")]"" D
"RTN","PSJLIVMD",33,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,11)_$E(P("SYRS"),1,13)
"RTN","PSJLIVMD",34,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVMD",35,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",36,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVMD",37,0)
 D DUR
"RTN","PSJLIVMD",38,0)
START ;
"RTN","PSJLIVMD",39,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVMD",40,0)
 I $G(P("OT"))="I",$G(P(4))]"" D
"RTN","PSJLIVMD",41,0)
 .I '$D(PSJSYSW0)!($$CLINIC^PSJO1($G(DFN),$G(ON))]"") N PSJSYSW0 S PSJSYSW0=$G(PSJSYSW0)
"RTN","PSJLIVMD",42,0)
 .Q:$G(ON)["V"  I $G(PSIVAC)="" N PSIVAC S PSIVAC="CF"
"RTN","PSJLIVMD",43,0)
 .Q:$G(P(3))
"RTN","PSJLIVMD",44,0)
 .D ENT^PSIVCAL,ENSTOP^PSIVCAL
"RTN","PSJLIVMD",45,0)
 D REQDT(ON)
"RTN","PSJLIVMD",46,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVMD",47,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVMD",48,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",49,0)
INFRATE ;
"RTN","PSJLIVMD",50,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVMD",51,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVMD",52,0)
 D LONG^PSJLIUTL(P(8),22,23)
"RTN","PSJLIVMD",53,0)
RSTART ;
"RTN","PSJLIVMD",54,0)
 I $G(ON)["P" N PSGNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) D
"RTN","PSJLIVMD",55,0)
 . I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32) Q
"RTN","PSJLIVMD",56,0)
 . Q:'$G(PSGRDTX)  N PSJRQB,PSJRQL,RSDLABL,PSGRSD,PSGRSDN
"RTN","PSJLIVMD",57,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVMD",58,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVMD",59,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVMD",60,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVMD",61,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL)  ;,SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",62,0)
 I $G(ON)["V" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVMD",63,0)
 I PSJL]"" D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",64,0)
 ;
"RTN","PSJLIVMD",65,0)
MR ;
"RTN","PSJLIVMD",66,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVMD",67,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVMD",68,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVMD",69,0)
STOP ;
"RTN","PSJLIVMD",70,0)
 S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",71,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVMD",72,0)
 ;PSJ*5*180 - If CPRS sends invalid duration/limit - Cannot Calculate Stop Date.
"RTN","PSJLIVMD",73,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$S($G(PSJBADD)=1:"CANNOT CALCULATE",1:$$STOPDT^PSJLIUTL)
"RTN","PSJLIVMD",74,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",75,0)
 S PSJL=""
"RTN","PSJLIVMD",76,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSJORD)
"RTN","PSJLIVMD",77,0)
 I $G(PSJBCMA)]"",$G(DFN) S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVMD",78,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$G(P(3)) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")) D
"RTN","PSJLIVMD",79,0)
 . D DSPLYDT(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",1,51,29)
"RTN","PSJLIVMD",80,0)
 I ($G(PSJBCMA)]"")!($G(PSGRDTX(+$G(PSJORD),"PSGRFD"))&$G(P(3))) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",81,0)
SCH ;
"RTN","PSJLIVMD",82,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVMD",83,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVMD",84,0)
 D LONG^PSJLIUTL(P(9)_$S(P(7):"@0 labels a day",1:"")_$G(SCHMSG),22,31)
"RTN","PSJLIVMD",85,0)
LASTFL ;
"RTN","PSJLIVMD",86,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVMD",87,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVMD",88,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",89,0)
ADM ;
"RTN","PSJLIVMD",90,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVMD",91,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVMD",92,0)
 NEW NOECH
"RTN","PSJLIVMD",93,0)
 D LONG^PSJLIUTL(P(11),22,29)
"RTN","PSJLIVMD",94,0)
QTY ;
"RTN","PSJLIVMD",95,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVMD",96,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",97,0)
PROVIDER ;
"RTN","PSJLIVMD",98,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVMD",99,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVMD",100,0)
CUMDOSES ;
"RTN","PSJLIVMD",101,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVMD",102,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",103,0)
OI ;
"RTN","PSJLIVMD",104,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVMD",105,0)
 S PSJL=$$SETSTR^VALM1("Orderable Item:",PSJL,6,16)_$P(P("PD"),U,2)_$$OINF^PSJDIN(+P("PD"))
"RTN","PSJLIVMD",106,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",107,0)
INS ;
"RTN","PSJLIVMD",108,0)
 S PSJL=""
"RTN","PSJLIVMD",109,0)
 S PSJL=$$SETSTR^VALM1("Instructions:",PSJL,8,14)
"RTN","PSJLIVMD",110,0)
 D LONG^PSJLIUTL(P("INS"),22,58)
"RTN","PSJLIVMD",111,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",112,0)
OPI ;
"RTN","PSJLIVMD",113,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVMD",114,0)
 I $G(PSIVBR)["PSIVVW" D
"RTN","PSJLIVMD",115,0)
 .S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,PSJORD,1)
"RTN","PSJLIVMD",116,0)
 .I PSJOPILN=1,($TR($G(^TMP("PSJBCMA5",$J,DFN,PSJORD,1))," ")="") K ^TMP("PSJBCMA5",$J,DFN,PSJORD) S PSJOPILN="" Q
"RTN","PSJLIVMD",117,0)
 .S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)
"RTN","PSJLIVMD",118,0)
 .S PSJL=PSJL_" "_$S(($G(PSJOPILN)>0):"(see below)",1:"")
"RTN","PSJLIVMD",119,0)
 .D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",120,0)
 .I (PSJOPILN>0) N PSJOPCNT S PSJOPCNT=0 F PSJOPCNT=1:1:PSJOPILN S PSJL="     "_$G(^TMP("PSJBCMA5",$J,DFN,PSJORD,PSJOPCNT)) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",121,0)
 I $G(PSIVBR)'["PSIVVW" D
"RTN","PSJLIVMD",122,0)
 .I $G(ON55)["P",$G(PSJORD)["V",$P($G(^PS(53.1,+ON55,0)),"^",25)=PSJORD S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,ON55)
"RTN","PSJLIVMD",123,0)
 .S PSJOPILN=$O(^PS(53.45,$G(PSJSYSP),6,""),-1) I 'PSJOPILN S PSJOPILN=$$GETSIOPI^PSJBCMA5(DFN,PSJORD)
"RTN","PSJLIVMD",124,0)
 .I PSJOPILN=1,($TR($G(^PS(53.45,PSJSYSP,6,1,0))," ")="") I '($G(^PS(53.45,PSJSYSP,6,0))<0)  K ^PS(53.45,PSJSYSP,6) S PSJOPILN="" Q
"RTN","PSJLIVMD",125,0)
 .I PSJOPILN=1,$G(^PS(53.45,PSJSYSP,6,1,0))["Instructions too long. See Order View or BCMA for full text." K ^PS(53.45,PSJSYSP,6) S PSJOPILN="" Q
"RTN","PSJLIVMD",126,0)
 .S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)
"RTN","PSJLIVMD",127,0)
 .S PSJL=PSJL_" "_$S(($G(PSJOPILN)>0)&'($G(^PS(53.45,PSJSYSP,6,0))<0):"(see below)",1:"")
"RTN","PSJLIVMD",128,0)
 .D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",129,0)
 .I (PSJOPILN>0) N PSJOPCNT S PSJOPCNT=0 F PSJOPCNT=1:1:PSJOPILN S PSJL="     "_$G(^PS(53.45,DUZ,6,PSJOPCNT,0)) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",130,0)
 K PSJOPILN,PSJOPCNT
"RTN","PSJLIVMD",131,0)
PC ;
"RTN","PSJLIVMD",132,0)
 S PSJL=""
"RTN","PSJLIVMD",133,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVMD",134,0)
REMARK ;
"RTN","PSJLIVMD",135,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVMD",136,0)
 S PSJL="" D FLDNO^PSJLIUTL("(12)",1)
"RTN","PSJLIVMD",137,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVMD",138,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVMD",139,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",140,0)
IVROOM ;
"RTN","PSJLIVMD",141,0)
 S PSJL=""
"RTN","PSJLIVMD",142,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVMD",143,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",144,0)
ENTRY ;
"RTN","PSJLIVMD",145,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVMD",146,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,24),1:"*** Undefined")
"RTN","PSJLIVMD",147,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVMD",148,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",149,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVMD",150,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVMD",151,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S($G(ON)["P":28,1:100))_" IV "
"RTN","PSJLIVMD",152,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVMD",153,0)
 I $G(P("PON"))["P" D ORDCHK^PSJLIVFD
"RTN","PSJLIVMD",154,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVMD",155,0)
 Q
"RTN","PSJLIVMD",156,0)
DSPLYDT(PSJLN,PSGRDT,PSGRDTN,TXT,PSJFSH,PSJRDBEG,PSJRDLEN)  ;
"RTN","PSJLIVMD",157,0)
 ;LINE   : Line number the Requested Start and Stop dates are display in
"RTN","PSJLIVMD",158,0)
 ;PSGRDT : Either it is the requested start or stop date in FM format
"RTN","PSJLIVMD",159,0)
 ;PSGRDTN: Either it is the requested start or stop date in IPM format
"RTN","PSJLIVMD",160,0)
 ;TXT    : The display text
"RTN","PSJLIVMD",161,0)
 ;PSJFSH     : if it is 1 then flash
"RTN","PSJLIVMD",162,0)
 ;
"RTN","PSJLIVMD",163,0)
 S:'$G(PSJRDBEG) PSJRDBEG=41,PSJRDLEN=39
"RTN","PSJLIVMD",164,0)
 S PSJL=$$SETSTR^VALM1(TXT_PSGRDTN,PSJL,PSJRDBEG,PSJRDLEN)
"RTN","PSJLIVMD",165,0)
 Q
"RTN","PSJLIVMD",166,0)
CLRDSPL ;
"RTN","PSJLIVMD",167,0)
 ;Clear the blinking after edit the pending order.
"RTN","PSJLIVMD",168,0)
 ;Without it more than the requested start and stop dates are blinking at the ac/edit screen
"RTN","PSJLIVMD",169,0)
 ;PSJLMX: # ad/sol counted in WRTDRG^PSJLIUTL
"RTN","PSJLIVMD",170,0)
 Q:'$D(IOBOFF)
"RTN","PSJLIVMD",171,0)
 NEW PSJX
"RTN","PSJLIVMD",172,0)
 F PSJX=5:1:PSJLMX+7 D CNTRL^VALM10(PSJX,36,80,IOBOFF,IOINORM)
"RTN","PSJLIVMD",173,0)
 Q
"RTN","PSJLIVMD",174,0)
REQDT(ORDER)       ;Get requested date if it is a pending order
"RTN","PSJLIVMD",175,0)
 ;ORDER  : Pending Order Number (PSJORD or PSGORD)
"RTN","PSJLIVMD",176,0)
 Q:ORDER'["P"  D REQDT^PSJLIUTL(ORDER)
"RTN","PSJLIVMD",177,0)
 Q
"RTN","PSJLIVMD",178,0)
 ;
"RTN","PSJLIVMD",179,0)
GETDUR(PAT,ORD,PKG,RAW) ;
"RTN","PSJLIVMD",180,0)
 ; PAT= Patient DFN
"RTN","PSJLIVMD",181,0)
 ; ORD= Order #
"RTN","PSJLIVMD",182,0)
 ; PKG= 5(UD), "IV"(IV), "P"(Pending)
"RTN","PSJLIVMD",183,0)
 N ACT,DUR,ND,ND25,F25,ND0,ND2,OLDORD S DUR="",ORD=+ORD K IVLIMIT
"RTN","PSJLIVMD",184,0)
 S:PKG="V" PKG="IV"
"RTN","PSJLIVMD",185,0)
 I PKG="P" S ND=$G(^PS(53.1,+ORD,0)) D  I '$G(OLDORD) Q DUR
"RTN","PSJLIVMD",186,0)
 . I $G(P("OVRIDE")) S DUR="" Q
"RTN","PSJLIVMD",187,0)
 . D PENDING(ORD) Q:DUR]""
"RTN","PSJLIVMD",188,0)
 . S ND0=$G(^PS(53.1,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) I OLDORD S PKG=$S(OLDORD["V":"IV",OLDORD["U":5,OLDORD["P":"P",1:"")
"RTN","PSJLIVMD",189,0)
 . Q:($G(OLDORD)'["P")
"RTN","PSJLIVMD",190,0)
 . D PENDING(OLDORD) S OLDORD=""
"RTN","PSJLIVMD",191,0)
 I PKG="IV" S ND2=$G(^PS(55,PAT,PKG,ORD,2)) I $P(ND2,U,8)="E" S OLDORD=$P(ND2,U,5) S:OLDORD'["V" OLDORD="" I OLDORD D
"RTN","PSJLIVMD",192,0)
 .N ACTND S ACTND=0 F  S ACTND=$O(^PS(55,PAT,"IV",ORD,"A",ACTND)) Q:'ACTND  D
"RTN","PSJLIVMD",193,0)
 ..I $G(^PS(55,PAT,"IV",ORD,"A",ACTND,0))["IV LIMIT OVERRIDDEN" S OLDORD=""
"RTN","PSJLIVMD",194,0)
 I $G(P("LIMIT"))]"" S DUR=P("LIMIT"),IVLIMIT=1 I '$G(RAW) S DUR=$$FMTDUR(DUR) Q DUR
"RTN","PSJLIVMD",195,0)
 I PKG=5 S ND0=$G(^PS(55,PAT,PKG,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) S:OLDORD'["U" OLDORD=""
"RTN","PSJLIVMD",196,0)
 S F25="^PS(55,PAT,PKG,ORD,2.5)" I '$G(OLDORD) Q:'$D(@(F25)) DUR
"RTN","PSJLIVMD",197,0)
 S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",198,0)
 ;PSJ*5*209 stop forcing null duration to previous.
"RTN","PSJLIVMD",199,0)
 ;I DUR="",$G(OLDORD) S ORD=+OLDORD Q:'$D(@(F25)) DUR  D
"RTN","PSJLIVMD",200,0)
 ;. S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",201,0)
 I '$G(RAW),DUR]"" S DUR=$$FMTDUR(DUR)
"RTN","PSJLIVMD",202,0)
 Q DUR
"RTN","PSJLIVMD",203,0)
 ;
"RTN","PSJLIVMD",204,0)
PENDING(PNDON) ;
"RTN","PSJLIVMD",205,0)
 S ND=$G(^PS(53.1,+ORD,0))
"RTN","PSJLIVMD",206,0)
 I ND S ND25=$S(($P(ND,U,15)=PAT):$G(^PS(53.1,+ORD,2.5)),1:"")
"RTN","PSJLIVMD",207,0)
 S DUR=$P(ND25,U,4) I DUR]"" D  Q
"RTN","PSJLIVMD",208,0)
 .S:($E(DUR)="s")!($E(DUR)="m")!($E(DUR)="l")!($E(DUR)="d")!($E(DUR)="h")!($E(DUR)="a") IVLIMIT=1 S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR))
"RTN","PSJLIVMD",209,0)
 S DUR=$P(ND25,U,2) I DUR]"" S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR))
"RTN","PSJLIVMD",210,0)
 Q
"RTN","PSJLIVMD",211,0)
 ;
"RTN","PSJLIVMD",212,0)
FMTDUR(DURCODE) ;
"RTN","PSJLIVMD",213,0)
 N DUNIT,DNUM,BAD S BAD=0
"RTN","PSJLIVMD",214,0)
 ;PSJ*5*180 - Add PSJBADD variable
"RTN","PSJLIVMD",215,0)
 K PSJBADD S PSJBADD=0
"RTN","PSJLIVMD",216,0)
 S DUNIT=$E(DURCODE),DNUM=$P(DURCODE,DUNIT,2) I 'DNUM S BAD=1
"RTN","PSJLIVMD",217,0)
 I DUNIT'="",DUNIT'?1(1U,1L) S PSJBADD=1
"RTN","PSJLIVMD",218,0)
 S DUNIT=$S(DUNIT="D"!(DUNIT="d"):" day",DUNIT="H"!(DUNIT="h"):" hour",DUNIT="W":" week",DUNIT="L":" month",DUNIT="M":" minute",DUNIT="S":" second",DUNIT="m":" ml",DUNIT="l":" liter",DUNIT="a":" dose",1:"")
"RTN","PSJLIVMD",219,0)
 S:DUNIT="" BAD=1 I (DNUM'=1),(DUNIT'["ml") S DUNIT=DUNIT_"s"
"RTN","PSJLIVMD",220,0)
 I PSJBADD=1 S PSGACT=$TR($G(PSGACT),"F")
"RTN","PSJLIVMD",221,0)
 Q $S(PSJBADD=1:"*INVALID DURATION/LIMIT*",BAD:"",1:DNUM_DUNIT)
"RTN","PSJLIVMD",222,0)
 ;
"RTN","PSJLIVMD",223,0)
DURMIN(DCOD) ;
"RTN","PSJLIVMD",224,0)
 N DUR,DMIN,CHR S DUR="" F I=1:1:$L(DCOD) S CHR=$E(DCOD,I) I CHR?1N S DUR=DUR_CHR
"RTN","PSJLIVMD",225,0)
 S DMIN=DUR*$S(DCOD["L":43200,DCOD["W":10080,DCOD["M":1,DCOD["S":(1/60),DCOD["D":1440,1:0) S DMIN=+$FN(DMIN,"",1)
"RTN","PSJLIVMD",226,0)
 Q DMIN
"RTN","PSJLIVMD",227,0)
 ;
"RTN","PSJLIVMD",228,0)
DUR ;
"RTN","PSJLIVMD",229,0)
 N DUROUT,LABEL,IVLIMIT
"RTN","PSJLIVMD",230,0)
 Q:'$G(PSJORD)  S PSJL=""
"RTN","PSJLIVMD",231,0)
 S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVMD",232,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVMD",233,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVMD",234,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVMD",235,0)
 Q
"RTN","PSJLMGUD")
0^53^B30490889^B30433867
"RTN","PSJLMGUD",1,0)
PSJLMGUD ;BIR/MLM-INITIALIZE UNIT DOSE ORDER FIELDS FOR DISPLAY ;05 Feb 99 / 9:46 AM
"RTN","PSJLMGUD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**25,58,85,116,110,111,267,275**;16 DEC 97;Build 157
"RTN","PSJLMGUD",3,0)
 ;
"RTN","PSJLMGUD",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178
"RTN","PSJLMGUD",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192 
"RTN","PSJLMGUD",6,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSJLMGUD",7,0)
 ; Reference to ES^ORX8 is supported by DBIA 3632
"RTN","PSJLMGUD",8,0)
 ;
"RTN","PSJLMGUD",9,0)
GETUD(DFN,PSGORD) ;
"RTN","PSJLMGUD",10,0)
 ;
"RTN","PSJLMGUD",11,0)
EN2 ;
"RTN","PSJLMGUD",12,0)
 N %X,%Y,ND2,DO,DRGI,FD,FL,FQC,NF,ND,PRI,SD,SIG,ST,STD,X,Y,ESIG
"RTN","PSJLMGUD",13,0)
 K GMRAL,P
"RTN","PSJLMGUD",14,0)
 S NF=$S(PSGORD["U":0,PSGORD["A":0,PSGORD["O":0,1:1) I NF,$D(^PS(53.1,+PSGORD,0)),$P(^(0),"^",19),$D(^PS(55,DFN,5,$P(^(0),"^",19))),(+$P(^(0),"^",19)'=+$P(^(0),"^",25)) S PSGORD=+$P(^PS(53.1,+PSGORD,0),"^",19)_"U",NF=0
"RTN","PSJLMGUD",15,0)
 S (FL,Y)="",$P(FL,"-",71)="",PSGOEEWF="^PS("_$S(NF:"53.1,",1:"55,"_DFN_",5,")_+PSGORD_","
"RTN","PSJLMGUD",16,0)
 ; The naked reference on the line below refers to the full reference created by indirect reference to F, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJLMGUD",17,0)
 S ND=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2)),PSGEB=$P($G(^(4)),"^",7),PSGOSI=$G(^(6)),SIG=$G(^(6.5)),DO=$G(^(.2)),PSGOINST=$G(^(.3)),ESIG=$P(DO,U,3),PSG14=$P($G(^(14,0)),"^",3)
"RTN","PSJLMGUD",18,0)
 I PSG14 S PSGLRN=$G(@(PSGOEEWF_"14,"_PSG14_",0)"))
"RTN","PSJLMGUD",19,0)
 S PSGOPD=+DO,PSGODO=$P(DO,U,2),PSGOPDN=$$OINAME^PSJLMUTL(+DO),X=$P(DO,U,4),PSGPRIO=$P("STAT^ASAP^ROUTINE^PREOP^TIME CRITICAL^DONE",U,$F("SARPTD",X)-1),PSJPRI=X
"RTN","PSJLMGUD",20,0)
 S PSGOPR=$P(ND,"^",2),PSGOMR=$P(ND,"^",3),PSGOSM=$P(ND,"^",5),PSGOHSM=$P(ND,"^",6),(PSGOST,ST)=$P(ND,"^",7),STT=$P(ND,"^",9),PSGOMRN=$S('PSGOMR:"",1:$P($G(^PS(51.2,PSGOMR,0)),"^")) S:PSGOMRN="" PSGOMRN=PSGOMR
"RTN","PSJLMGUD",21,0)
 S PSGLI=$P(ND,U,16),PSGOSCH=$P(ND2,"^"),(PSGOSD,SD)=$P(ND2,"^",2),(FD,PSGOFD)=$P(ND2,"^",4),(FQC,PSGS0XT)=$P(ND2,"^",6),(PSGOAT,PSGS0Y)=$P(ND2,"^",5)
"RTN","PSJLMGUD",22,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSJLMGUD",23,0)
 S PRI=$S('PSGOPR:0,1:$P($G(^VA(200,PSGOPR,"PS")),"^",4)),DRGI=$S(PSGOPD'=+PSGOPD:0,1:+$G(^PSDRUG(+PSGOPD,"I"))) S:PRI PRI=DT'<PRI S:DRGI DRGI=DT'<DRGI
"RTN","PSJLMGUD",24,0)
 S PSGOPRN=$S('PSGOPR:"",1:$P($G(^VA(200,PSGOPR,0)),"^")) S:PSGOPRN="" PSGOPRN=PSGOPR I PSGOSI]"" S PSGOSI=$$ENSET^PSGSICHK(PSGOSI)
"RTN","PSJLMGUD",25,0)
 I $L($T(ES^ORX8)) N ESIG1 S ESIG1=$$ES^ORX8(+$P(ND,U,21)_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSJLMGUD",26,0)
 S PSGOPRN=PSGOPRN_$S(ESIG]"":" ["_$$LOW^XLFSTR(ESIG)_"]",1:"")
"RTN","PSJLMGUD",27,0)
 S PSGEBN=$$ENNPN^PSGMI(PSGEB) S:$P(ND,U,27)="R" STT="R"
"RTN","PSJLMGUD",28,0)
 S X=STT,PSGSTAT=$S(X="":"NOT FOUND",X="DE":"DISCONTINUED (EDIT)",X="DR":"DISCONTINUED (RENEWAL)",X="RE":"REINSTATED",1:$P(X_"^ACTIVE^DISCONTINUED^EXPIRED^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^RENEWED^UNRELEASED","^",$F("ADEHINPRU",X)))
"RTN","PSJLMGUD",29,0)
 ;
"RTN","PSJLMGUD",30,0)
SET ;
"RTN","PSJLMGUD",31,0)
 I STT="P" S (FD,SD,ST)=""
"RTN","PSJLMGUD",32,0)
 S PSGOSTN=$$ENSTN^PSGMI(ST),(PSGOFDN,PSGOSDN)="" I SD S PSGOSDN=$$ENDD^PSGMI(SD)_"^"_$$ENDTC^PSGMI(SD)
"RTN","PSJLMGUD",33,0)
 I FD S PSGOFDN=$$ENDD^PSGMI(FD)_"^"_$$ENDTC^PSGMI(FD)
"RTN","PSJLMGUD",34,0)
 F X="PD","PDN","MR","MRN","ST","STN","SCH","SI","SD","SDN","FD","FDN","SM","HSM","PR","PRN","DO","AT" S @("PSG"_X)=@("PSGO"_X)
"RTN","PSJLMGUD",35,0)
 K ^PS(53.45,PSJSYSP,1),^(2),^(5),^(6) S %X=PSGOEEWF_"3,",%Y="^PS(53.45,"_PSJSYSP_",1," D %XY^%RCR S %X=PSGOEEWF_"1,",%Y="^PS(53.45,"_PSJSYSP_",2," D %XY^%RCR
"RTN","PSJLMGUD",36,0)
 S $P(^PS(53.45,PSJSYSP,2,0),"^",2)="53.4502P"
"RTN","PSJLMGUD",37,0)
 K PSJNSS I $G(PSGSCH)'="" D  K PSJNSS
"RTN","PSJLMGUD",38,0)
 . ;N PSGS0XT,PSGOES,Y S X=PSGSCH N PSGSCH S PSGSCH="" S:($G(VALMBCK)]"")!'$G(NSFF)!$G(PSJTUD) PSGOES=1 D ENOS^PSGS0
"RTN","PSJLMGUD",39,0)
 . N PSGS0XTO,Y,PSGOES S X=PSGSCH S PSGS0XTO=PSGS0XT N PSGOSCH S PSGOSCH=PSGSCH S PSGSCH="",PSGOES=1
"RTN","PSJLMGUD",40,0)
 . D ENOS^PSGS0 S:$G(X)="" PSGS0XT=PSGS0XTO S PSGSCH=$S($G(X)]""&($G(PSGS0XT)="D"):X,1:PSGOSCH)
"RTN","PSJLMGUD",41,0)
 Q
"RTN","PSJLMGUD",42,0)
 ;
"RTN","PSJLMGUD",43,0)
FINISH ;
"RTN","PSJLMGUD",44,0)
 I '$G(PSGS0XT),PSGOSCH]"" D  S $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSJLMGUD",45,0)
 .N PSGOES,PSGS0Y S X=PSGOSCH,PSGOES=1 D ENOS^PSGS0
"RTN","PSJLMGUD",46,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10) I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")_" before it can be finished."
"RTN","PSJLMGUD",47,0)
 I PSGOEFF W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSJLMGUD",48,0)
 I PSGOEFF#2 S F1=53.1,MSG=0,Y=$T(35),@("PSGFN(35)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(35),";",3) G:'PSGOEE DONE
"RTN","PSJLMGUD",49,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(PSGOPD,0) G:CHK DONE
"RTN","PSJLMGUD",50,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSJLMGUD",51,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD) N XQORM D EN^VALM("PSJ LM OE DISPLAY") G DONE ;D ENW^PSGOEEW
"RTN","PSJLMGUD",52,0)
 ;
"RTN","PSJLMGUD",53,0)
ACCEPT ;
"RTN","PSJLMGUD",54,0)
 D UPD^PSGOEF1 G DONE
"RTN","PSJLMGUD",55,0)
BYPASS ;
"RTN","PSJLMGUD",56,0)
 S PSGCANFL=1 G DONE
"RTN","PSJLMGUD",57,0)
 ;
"RTN","PSJLMGUD",58,0)
EDIT ;    
"RTN","PSJLMGUD",59,0)
 S PSGPDRG=PSGOPD,PSGPDRGN=PSGOPDN K PSGOEEND D ENF^PSGOEE I PSGCANFL=-1 D UPD^PSGOEF1
"RTN","PSJLMGUD",60,0)
 ;
"RTN","PSJLMGUD",61,0)
DONE ;
"RTN","PSJLMGUD",62,0)
 K CHK,DA,DIE,DR,DRG,MSG,ORETURN,ORIFN,PSGEB,PSGEFN,PSGND,PSGOEE,PSGOEEF,PSGOEEND,PSGOEEG,PSGOEF,PSGOEFF,PSGOES,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGPDRG,PSGDRGN,PSG0XT,PSGS0Y,OSGSD,Q1,Q2
"RTN","PSJLMGUD",63,0)
 Q
"RTN","PSJLMGUD",64,0)
 ;
"RTN","PSJLMGUD",65,0)
 ;
"RTN","PSJLMGUD",66,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSJLMGUD",67,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;102;PSGODO]""
"RTN","PSJLMGUD",68,0)
33 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSJLMGUD",69,0)
34 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSJLMGUD",70,0)
35 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSJLMGUD",71,0)
36 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSJLMGUD",72,0)
37 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSJLMGUD",73,0)
38 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSJLMGUD",74,0)
39 ;;2^PSGOE82;;;2;0
"RTN","PSJLMGUD",75,0)
310 ;;40^PSGOE82;;;40;0
"RTN","PSJLMGUD",76,0)
311 ;;66^PSGOE82;;;66;1
"RTN","PSJLMGUD",77,0)
312 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSJLMGUD",78,0)
313 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSJLMGUD",79,0)
314 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSJLMGUD",80,0)
 ;
"RTN","PSJLMGUD",81,0)
AH ;
"RTN","PSJLMGUD",82,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSJLMGUD",83,0)
 Q
"RTN","PSJLMHED")
0^18^B56770438^B50472528
"RTN","PSJLMHED",1,0)
PSJLMHED ;BIR/MLM-BUILD LM HEADERS ;28 Jan 98 / 2:18 PM
"RTN","PSJLMHED",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,58,85,110,148,181,260,275**;16 DEC 97;Build 157
"RTN","PSJLMHED",3,0)
 ;
"RTN","PSJLMHED",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMHED",5,0)
 ; Reference to CWAD^ORQPT2 is supported by DBIA 2831.
"RTN","PSJLMHED",6,0)
 ; Reference to ^SC is supported by DBIA 10040.
"RTN","PSJLMHED",7,0)
 ; External reference to $$BSA^PSSDSAPI supported by DBIA 5425.
"RTN","PSJLMHED",8,0)
 ; External reference to ^ORQQVI supported by DBIA 5770.
"RTN","PSJLMHED",9,0)
 ; External reference to ^ORQPTQ4 supported by DBIA 5785.
"RTN","PSJLMHED",10,0)
 ; External reference to ^ORB31 supported by DBIA 5140.
"RTN","PSJLMHED",11,0)
 ; External reference to ^ORQQLR1 supported by DBIA 5787.
"RTN","PSJLMHED",12,0)
 ;
"RTN","PSJLMHED",13,0)
HDR(DFN) ; -- list screen header
"RTN","PSJLMHED",14,0)
 ;   input:       DFN := ifn of pat
"RTN","PSJLMHED",15,0)
 ;  output:  VALMHDR() := hdr array
"RTN","PSJLMHED",16,0)
 ;
"RTN","PSJLMHED",17,0)
 K VAIN,VADM,GMRA,PSJACNWP,PSJ,VAERR,VA,X
"RTN","PSJLMHED",18,0)
 S PSJACNWP=1 D ENBOTH^PSJAC
"RTN","PSJLMHED",19,0)
 D HDRO(DFN)
"RTN","PSJLMHED",20,0)
 S PSJ="   Sex: "_$P(PSJPSEX,U,2),VALMHDR(4)=$$SETSTR^VALM1($S(PSJPDD:"Last ",1:"     ")_"Admitted: "_$P(PSJPAD,U,2),PSJ,45,23)
"RTN","PSJLMHED",21,0)
 S PSJ="    Dx: "_PSJPDX
"RTN","PSJLMHED",22,0)
 S:PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Discharged: "_$E($P(PSJPDD,U,2),1,8),PSJ,48,26)
"RTN","PSJLMHED",23,0)
 S:'PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Last transferred: "_$$ENDTC^PSGMI(PSJPTD),PSJ,42,26)
"RTN","PSJLMHED",24,0)
 S PSJBSA=$$BSA^PSSDSAPI(DFN),PSJBSA=$P(PSJBSA,"^",3),PSJBSA=$S(PSJBSA'>0:"__________",1:$J(PSJBSA,4,2))
"RTN","PSJLMHED",25,0)
 S RSLT=$$CRCL(DFN)
"RTN","PSJLMHED",26,0)
 I $P(RSLT,"^",2)["Not Found" S ZDSPL="  CrCL: "_$P(RSLT,"^",2)
"RTN","PSJLMHED",27,0)
 E  S ZDSPL=" CrCL: "_$P($G(RSLT),"^",2)_"(est.) "_"(CREAT:"_$P($G(RSLT),"^",3)_"mg/dL "_$P($G(RSLT),"^")_")"
"RTN","PSJLMHED",28,0)
 S PSJDB=$G(ZDSPL),VALMHDR(6)=$$SETSTR^VALM1("BSA (m2): "_$G(PSJBSA),PSJDB,50,23) K PSJBSA
"RTN","PSJLMHED",29,0)
 Q
"RTN","PSJLMHED",30,0)
 ; 
"RTN","PSJLMHED",31,0)
HDRO(DFN) ; Standardized part of profile header.
"RTN","PSJLMHED",32,0)
 N PSJCLIN,PSJAPPT,PSJCLINN,RMORDT S (PSJCLIN,PSJAPPT)=0,(RMORDAT,PSJCLINN)="" I $G(PSJORD) D
"RTN","PSJLMHED",33,0)
 . S PSJCLIN=$S($G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,"DSS")),$G(PSJORD)["U":$G(^PS(55,DFN,5,+PSJORD,8)),$G(PSJORD)["P":$G(^PS(53.1,+PSJORD,"DSS")),1:"")
"RTN","PSJLMHED",34,0)
 . S:PSJCLIN PSJAPPT=$P($G(PSJCLIN),U,2) S:'PSJAPPT PSJCLIN="" I PSJCLIN,PSJAPPT S PSJCLINN=$P($G(^SC(+PSJCLIN,0)),U)
"RTN","PSJLMHED",35,0)
 K VALMHDR I PSJCLINN]"" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1("   Clinic: "_PSJCLINN,PSJ,28,26)
"RTN","PSJLMHED",36,0)
 I PSJCLINN="" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1($S('PSJPDD:"     ",1:"Last ")_"Ward: "_PSJPWDN,PSJ,30,18)
"RTN","PSJLMHED",37,0)
 S X=$$CWAD^ORQPT2(DFN)
"RTN","PSJLMHED",38,0)
 S:X]"" X=IORVON_X_IORVOFF,PSJ=$$SETSTR^VALM1(X,PSJ,80-$L(X),80) S VALMHDR(1)=PSJ
"RTN","PSJLMHED",39,0)
 S PSJ="   PID: "_$P(PSJPSSN,U,2)
"RTN","PSJLMHED",40,0)
 S RMORDT=$S($G(PSJPDD):"Last ",1:"     ")_"Room-Bed: "_$G(PSJPRB)
"RTN","PSJLMHED",41,0)
 I PSJCLINN]"",PSJAPPT S RMORDT="Clinic Date: "_$$ENDTC^PSGMI(PSJAPPT),RMORDT=$P(RMORDT,"  ")_" "_$P(RMORDT,"  ",2)
"RTN","PSJLMHED",42,0)
 S PSJ=$$SETSTR^VALM1(RMORDT,PSJ,26,28),VALMHDR(2)=$$SETSTR^VALM1("Ht(cm): "_PSJPHT_" "_PSJPHTD,PSJ,55,25)
"RTN","PSJLMHED",43,0)
 S PSJ="   DOB: "_$P($P(PSJPDOB,U,2)," ")_" ("_PSJPAGE_")",VALMHDR(3)=$$SETSTR^VALM1("Wt(kg): "_PSJPWT_" "_PSJPWTD,PSJ,55,25)
"RTN","PSJLMHED",44,0)
 Q
"RTN","PSJLMHED",45,0)
 ;
"RTN","PSJLMHED",46,0)
INIT(PSJPROT) ; -- init bld vars
"RTN","PSJLMHED",47,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJLMHED",48,0)
 K PSJUDPRF,^TMP("PSJ",$J),^TMP("PSJON",$J),^TMP("PSJPRO",$J)
"RTN","PSJLMHED",49,0)
 S:PSJPROT=1 PSJUDPRF=1
"RTN","PSJLMHED",50,0)
 D KILL^VALM10(),EN^PSJO1(PSJPROT)
"RTN","PSJLMHED",51,0)
 I '$D(^TMP("PSJ",$J)) W !!,?22,"NO ORDERS FOUND FOR "_$S(PSJOL="S":"SHORT",1:"LONG")_" PROFILE." S VALMQUIT=1 D PAUSE^PSJLMUTL Q
"RTN","PSJLMHED",52,0)
 S PSJTF=0,PSJLN=1,PSJEN=1,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""!(PSJC["^")  D
"RTN","PSJLMHED",53,0)
 .S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJLMHED",54,0)
 .I PSJTF'=$E(PSJC,1)!(PSJC="CC")!(PSJC="CD")!(PSJC="BD") Q:PSJC="CB"  Q:PSJC="O"  Q:PSJC="DF"  D TF S PSJTF=$E(PSJC,1)    ;DAM 8-29-07 Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJLMHED",55,0)
 .S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",56,0)
 ..S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""  Q:PSJC="CB"  Q:PSJC="O"  Q:PSJC="DF"  D ON      ;DAM 8-29-07  Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJLMHED",57,0)
 .;
"RTN","PSJLMHED",58,0)
 .;DAM 8-29-07   New code to place Pending Orders after Pending Renewal Orders on the roll and scroll display.  Non-Active Orders appear last.
"RTN","PSJLMHED",59,0)
 S PSJTF=0,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""  D
"RTN","PSJLMHED",60,0)
 . S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJLMHED",61,0)
 . I PSJC="CB" D TF S PSJTF=$E(PSJC,1)                            ;These are Pending Orders
"RTN","PSJLMHED",62,0)
 . I PSJC="CB" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",63,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJLMHED",64,0)
 . ;
"RTN","PSJLMHED",65,0)
 . I PSJC["Cz" D
"RTN","PSJLMHED",66,0)
 . . N PSJCLIN
"RTN","PSJLMHED",67,0)
 . . S PSJF="^PS("_$S("AO"[$P(PSJC,"^",4):"55,"_PSGP_",5,",$P(PSJC,"^",4)="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJLMHED",68,0)
 . . S PSJCLIN=$P(PSJC,"^",2) Q:PSJCLIN=""
"RTN","PSJLMHED",69,0)
 . . I ($P(PSJTF,"^",2)'=$P(PSJC,"^",2)) D TF S PSJTF=PSJC
"RTN","PSJLMHED",70,0)
 . . S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",71,0)
 . . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""  D ON      ;DAM 8-29-07  Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJLMHED",72,0)
 . ;
"RTN","PSJLMHED",73,0)
 . I PSJC="DF" D TF S PSJTF=$E(PSJC,1)                              ;These are recently DC Orders (mv)
"RTN","PSJLMHED",74,0)
 . I PSJC="DF" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",75,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJLMHED",76,0)
 . I PSJC="O" D TF S PSJTF=$E(PSJC,1)                              ;These are Non-Active Orders
"RTN","PSJLMHED",77,0)
 . I PSJC="O" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",78,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJLMHED",79,0)
 .; END DAM changes
"RTN","PSJLMHED",80,0)
 .;
"RTN","PSJLMHED",81,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMHED",82,0)
DONE ;
"RTN","PSJLMHED",83,0)
 K PSJC,PSJEN,PSJLN,PSJST,PSJS,CNT,PSJPRI,PSJORD
"RTN","PSJLMHED",84,0)
 Q
"RTN","PSJLMHED",85,0)
 ;
"RTN","PSJLMHED",86,0)
ON ;
"RTN","PSJLMHED",87,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJLMHED",88,0)
 S PSJO="" F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO)   D
"RTN","PSJLMHED",89,0)
 .N PRJPRI S PSJPRI=$S(PSJO["V":$P($G(^PS(55,PSGP,"IV",+PSJO,.2)),"^",4),PSJO["U":$P($G(^PS(55,PSGP,5,+PSJO,.2)),"^",4),1:$P($G(^PS(53.1,+PSJO,.2)),"^",4))
"RTN","PSJLMHED",90,0)
 .S ^TMP("PSJON",$J,PSJEN)=PSJO,PSJL=$J(PSJEN,4) I ($P(PSJC,"^")="Cz") N PSJTMPJC S PSJTMPJC=PSJC N PSJC S PSJC=$P(PSJTMPJC,"^",4)
"RTN","PSJLMHED",91,0)
 .D @$S(PSJO["V":"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)",PSJO["U":"PUD^PSJLMPRU(PSGP,PSJO,PSJF,DN)",1:"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)") S ^TMP("PSJPRO",$J,0)=PSJEN,PSJEN=PSJEN+1
"RTN","PSJLMHED",92,0)
 Q
"RTN","PSJLMHED",93,0)
 ;
"RTN","PSJLMHED",94,0)
TF ; Set up order type header
"RTN","PSJLMHED",95,0)
 NEW PSJDFHDR
"RTN","PSJLMHED",96,0)
 I $D(^TMP("PSJ",$J,PSJC)) D
"RTN","PSJLMHED",97,0)
 .S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJLMHED",98,0)
 .S PSJDFHDR="RECENTLY DISCONTINUED/EXPIRED (LAST "_+$G(PSJDCEXP)_" HOURS)"
"RTN","PSJLMHED",99,0)
 .N C,X,Y S C=PSJC,Y="",$P(Y," -",40)=""
"RTN","PSJLMHED",100,0)
 .S X=$S(($G(PSJCLIN)]""):$G(PSJCLIN),C="A":$$TXT^PSJO("A"),C["CC":$$TXT^PSJO("PR"),C["CD":$$TXT^PSJO("PC"),C["C":$$TXT^PSJO("P"),C["BD":$$TXT^PSJO("NC"),C["B":$$TXT^PSJO("N"),C["DF":PSJDFHDR,1:$$TXT^PSJO("NA"))
"RTN","PSJLMHED",101,0)
 .S ^TMP("PSJPRO",$J,PSJLN,0)=$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80),PSJLN=PSJLN+1
"RTN","PSJLMHED",102,0)
 Q
"RTN","PSJLMHED",103,0)
TEST ;
"RTN","PSJLMHED",104,0)
 N X,Y S Y="",$P(Y," -",40)=""
"RTN","PSJLMHED",105,0)
 F X="A C T I V E","P E N D I N G   R E N E W A L S","P E N D I N G ","N O N - V E R I F I E D","N O N - A C T I V E" W !,$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80)
"RTN","PSJLMHED",106,0)
 Q
"RTN","PSJLMHED",107,0)
CRCL(DFN) ;
"RTN","PSJLMHED",108,0)
 N HTGT60,ABW,IBW,BWRATIO,BWDIFF,LOWBW,ADJBW,X1,X2,RSLT,PSCR,PSRW,ABW,ZHT,PSRH,PSCXTL,PSCXTLS,SCR,OCXT,OCXTS,SCRV,ZAGE,SEX
"RTN","PSJLMHED",109,0)
 S RSLT="0^<Not Found>"
"RTN","PSJLMHED",110,0)
 S PSCR="^^^^^^0"
"RTN","PSJLMHED",111,0)
 D VITAL^ORQQVI("WEIGHT","WT",DFN,.PSRW,0,"",$$NOW^XLFDT)
"RTN","PSJLMHED",112,0)
 Q:'$D(PSRW) RSLT
"RTN","PSJLMHED",113,0)
 S ABW=$P(PSRW(1),U,3) Q:+$G(ABW)<1 RSLT
"RTN","PSJLMHED",114,0)
 S ABW=ABW/2.2  ;ABW (actual body weight) in kg
"RTN","PSJLMHED",115,0)
 D VITAL^ORQQVI("HEIGHT","HT",DFN,.PSRH,0,"",$$NOW^XLFDT)
"RTN","PSJLMHED",116,0)
 Q:'$D(PSRH) RSLT
"RTN","PSJLMHED",117,0)
 S ZHT=$P(PSRH(1),U,3) Q:+$G(ZHT)<1 RSLT
"RTN","PSJLMHED",118,0)
 S ZAGE=$$AGE^ORQPTQ4(DFN) Q:'ZAGE RSLT
"RTN","PSJLMHED",119,0)
 S SEX=$P($$SEX^ORQPTQ4(DFN),U,1) Q:'$L(SEX) RSLT
"RTN","PSJLMHED",120,0)
 S PSCXTL="" Q:'$$TERMLKUP^ORB31(.PSCXTL,"SERUM CREATININE") RSLT
"RTN","PSJLMHED",121,0)
 S PSCXTLS="" Q:'$$TERMLKUP^ORB31(.PSCXTLS,"SERUM SPECIMEN") RSLT
"RTN","PSJLMHED",122,0)
 S SCR="",OCXT=0 F  S OCXT=$O(PSCXTL(OCXT)) Q:'OCXT  D
"RTN","PSJLMHED",123,0)
 .S OCXTS=0 F  S OCXTS=$O(PSCXTLS(OCXTS)) Q:'OCXTS  D
"RTN","PSJLMHED",124,0)
 ..S SCR=$$LOCL^ORQQLR1(DFN,$P(PSCXTL(OCXT),U),$P(PSCXTLS(OCXTS),U))
"RTN","PSJLMHED",125,0)
 ..I $P(SCR,U,7)>$P(PSCR,U,7) S PSCR=SCR
"RTN","PSJLMHED",126,0)
 S SCR=PSCR,SCRV=$P(SCR,U,3) Q:+$G(SCRV)<.01 RSLT
"RTN","PSJLMHED",127,0)
 S SCRD=$P(SCR,U,7) Q:'$L(SCRD) RSLT
"RTN","PSJLMHED",128,0)
 ;
"RTN","PSJLMHED",129,0)
 S HTGT60=$S(ZHT>60:(ZHT-60)*2.3,1:0)  ;if ht > 60 inches
"RTN","PSJLMHED",130,0)
 I HTGT60>0 D
"RTN","PSJLMHED",131,0)
 .S IBW=$S(SEX="M":50+HTGT60,1:45.5+HTGT60)  ;Ideal Body Weight
"RTN","PSJLMHED",132,0)
 .S BWRATIO=(ABW/IBW)  ;body weight ratio
"RTN","PSJLMHED",133,0)
 .S BWDIFF=$S(ABW>IBW:ABW-IBW,1:0)
"RTN","PSJLMHED",134,0)
 .S LOWBW=$S(IBW<ABW:IBW,1:ABW)
"RTN","PSJLMHED",135,0)
 .I BWRATIO>1.3,(BWDIFF>0) S ADJBW=((0.3*BWDIFF)+IBW)
"RTN","PSJLMHED",136,0)
 .E  S ADJBW=LOWBW
"RTN","PSJLMHED",137,0)
 I +$G(ADJBW)<1 D
"RTN","PSJLMHED",138,0)
 .S ADJBW=ABW
"RTN","PSJLMHED",139,0)
 S CRCL=(((140-ZAGE)*ADJBW)/(SCRV*72))
"RTN","PSJLMHED",140,0)
 ;
"RTN","PSJLMHED",141,0)
 S:SEX="M" RSLT=SCRD_U_$J(CRCL,1,1)
"RTN","PSJLMHED",142,0)
 S:SEX="F" RSLT=SCRD_U_$J((CRCL*.85),1,1)
"RTN","PSJLMHED",143,0)
 S X1=$P(RSLT,"^"),X2=$$FMTE^XLFDT(X1,"2M"),$P(RSLT,"^")=$P(X2,"@") K X1,X2
"RTN","PSJLMHED",144,0)
 S $P(RSLT,"^",3)=$P($G(SCR),"^",3)
"RTN","PSJLMHED",145,0)
 K HTGT60,ABW,IBW,BWRATIO,BWDIFF,LOWBW,ADJBW,X1,X2,PSCR,PSRW,ABW,ZHT,PSRH,ZAGE,PSCXTL,PSCXTLS,SCR,OCXT,OCXTS,SCRV,CRCL
"RTN","PSJLMHED",146,0)
 Q RSLT
"RTN","PSJLMPRI")
0^5^B22340639^B19651424
"RTN","PSJLMPRI",1,0)
PSJLMPRI ;BIR/MLM-INPATIENT LISTMAN IV PROFILE UTILITIES ;01 JUL 96 / 2:24 PM
"RTN","PSJLMPRI",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**58,85,118,110,133,154,181,275**;16 DEC 97;Build 157
"RTN","PSJLMPRI",3,0)
 ;
"RTN","PSJLMPRI",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMPRI",5,0)
 ;
"RTN","PSJLMPRI",6,0)
PIV(DFN,ON,PSJF,DN)       ;Setup LM display for IV order. 
"RTN","PSJLMPRI",7,0)
 N ND14,DRG,ON55,P,PSJORIFN,TYP,V,X,Y,PSJFLAG,ND4 S TYP="?" I ON["V" D
"RTN","PSJLMPRI",8,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23,25 S P(X)=$P(Y,U,X)
"RTN","PSJLMPRI",9,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJLMPRI",10,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJLMPRI",11,0)
 .S P("PRY")=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,4),PSJFLAG=$P($G(^(.2)),U,7)
"RTN","PSJLMPRI",12,0)
 .S ND4=$G(^PS(55,DFN,"IV",+ON,4)),V=$S(P("PRY")="D":"d",1:" ")_$S((+PSJSYSU=1&'+$P(ND4,U)):"->",(+PSJSYSU=3&'+$P(ND4,U,4)):"->",1:"") I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRI",13,0)
 .S PSJL=$$SETSTR^VALM1(V,PSJL,6,3)
"RTN","PSJLMPRI",14,0)
 .S ND14=$G(^PS(55,DFN,"IV",+ON,14,0)),ND14=$P(ND14,U,3) S:ND14 ND14=+$G(^(ND14,0))
"RTN","PSJLMPRI",15,0)
 I ON=+ON N PSJEN2,O S PSJEN2=PSJEN,O="" F  S O=$O(^PS(53.1,"ACX",ON,O)) Q:O=""  D
"RTN","PSJLMPRI",16,0)
 .I PSJEN2'=PSJEN S PSJL=$J(PSJEN2,4)
"RTN","PSJLMPRI",17,0)
 .S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+O,O)),U,9),Y=+$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U),PSJFLAG=$P($G(^(.2)),U,7)
"RTN","PSJLMPRI",18,0)
 .D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) D @$S($E(P("OT"))'="F":"PUD^PSJLMPRU(DFN,O_""P"",PSJF,DN)",1:"PIV^PSJLMPRI(DFN,O_""P"",PSJF,DN)") S PSJEN2=""
"RTN","PSJLMPRI",19,0)
 I ON["P" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U),PSJFLAG=$P($G(^(.2)),U,7) D  I $E(P("OT"))'="F" D PUD^PSJLMPRU(DFN,ON,PSJF,DN) Q
"RTN","PSJLMPRI",20,0)
 . D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJLMPRI",21,0)
 . S ND14=$G(^PS(53.1,+ON,14,0)),ND14=$P(ND14,U,3) S:ND14 ND14=+$G(^(ND14,0))
"RTN","PSJLMPRI",22,0)
 I $G(PSJFLAG) D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRI",23,0)
 NEW PSJIVFLG S PSJIVFLG=1
"RTN","PSJLMPRI",24,0)
 S DRG=+$O(DRG("AD",0)) D:DRG PIVAD F  S DRG=$O(DRG("AD",DRG)) Q:'DRG  S PSJL="" D PIVAD
"RTN","PSJLMPRI",25,0)
SOL ;
"RTN","PSJLMPRI",26,0)
 S PSJL=$S($G(PSJIVFLG):PSJL_$S(ON["V":"in",1:"    in"),1:"        in")
"RTN","PSJLMPRI",27,0)
 NEW DRGX,NAME
"RTN","PSJLMPRI",28,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),37,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP,SETSTAT S PSJL="      "
"RTN","PSJLMPRI",29,0)
 ;S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:'$G(PSJIVFLG) SETTMP D:$G(PSJIVFLG) PIV1 S PSJL="      "
"RTN","PSJLMPRI",30,0)
 Q
"RTN","PSJLMPRI",31,0)
PIVAD ; Print IV Additives.
"RTN","PSJLMPRI",32,0)
 NEW NAME
"RTN","PSJLMPRI",33,0)
 D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1)
"RTN","PSJLMPRI",34,0)
 I $D(NAME(2)) S PSJL=$$SETSTR^VALM1(NAME(1),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP,SETSTAT S PSJL="",PSJL=$$SETSTR^VALM1(NAME(2),PSJL,9,60) D SETTMP,SETSTAT
"RTN","PSJLMPRI",35,0)
 I '$D(NAME(2)) S PSJL=$$SETSTR^VALM1(NAME(1),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP,SETSTAT
"RTN","PSJLMPRI",36,0)
 Q
"RTN","PSJLMPRI",37,0)
 ;
"RTN","PSJLMPRI",38,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJLMPRI",39,0)
 K PSJIVFLG,PSJCLP I $G(PSJCLORD),$G(ON)["P" N PSJCLP S PSJCLP(2)=$P(^PS(53.1,+ON,2),"^",2),PSJCLP(3)=$P(^PS(53.1,+ON,2),"^",4) F X=2,3 S PSJCLP(X)=$E($$ENDTC^PSGMI(PSJCLP(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJLMPRI",40,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJLMPRI",41,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1($S($G(PSJCLP(2)):PSJCLP(2),1:P(2)),PSJL,53,7) D
"RTN","PSJLMPRI",42,0)
 .S PSJL=$$SETSTR^VALM1($S($G(PSJCLP(3)):PSJCLP(3),1:P(3)),PSJL,60,7),PSJL=$$SETSTR^VALM1($S($G(P(25))]"":P(25),1:P(17)),PSJL,66,2)
"RTN","PSJLMPRI",43,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1($S($G(PSJCLP(2)):PSJCLP(2),1:P(2)),53,7),PSJL=$$SETSTR^VALM1($S($G(PSJCLP(3)):PSJCLP(3),1:P(3)),PSJL,63,7),PSJL=$$SETSTR^VALM1($S(PSJOL'="L"&($G(P(25))]""):P(25),1:P(17)),PSJL,73,2)
"RTN","PSJLMPRI",44,0)
 I $G(ND14) S ND14=$$ENDTC^PSGMI((ND14)) S PSJL=$$SETSTR^VALM1(ND14,PSJL,$S($D(PSJEXTP):75,1:72),5) K ND14
"RTN","PSJLMPRI",45,0)
 ;* D SETTMP
"RTN","PSJLMPRI",46,0)
 Q
"RTN","PSJLMPRI",47,0)
SETTMP ;
"RTN","PSJLMPRI",48,0)
 S ^TMP($S($G(PSIVLBNM)]"":PSIVLBNM,1:"PSJPRO"),$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1
"RTN","PSJLMPRI",49,0)
 Q
"RTN","PSJLMPRI",50,0)
 ;
"RTN","PSJLMPRI",51,0)
SETSTAT ;
"RTN","PSJLMPRI",52,0)
 I ON["P",$P($G(^PS(53.1,+ON,.2)),"^",4)="S" D CNTRL^VALM10((PSJLN-1),9,9+$L(PSJL),IOINHI_IOBON,IOINORM,0)
"RTN","PSJLMPRI",53,0)
 Q
"RTN","PSJLMPRI",54,0)
 ; 
"RTN","PSJLMPRI",55,0)
LASTREN(DFN,ON) ;
"RTN","PSJLMPRI",56,0)
 N FIL,RNDT,ND0,ND14 S ND14="" I '$G(ON)!'$G(DFN) Q 0
"RTN","PSJLMPRI",57,0)
 S FIL=$S(ON["P":"^PS(53.1,"_+ON_",14,0)",ON["V":"^PS(55,"_DFN_",""IV"","_+ON_",14,0)",ON["U":"^PS(55,"_DFN_",5,"_+ON_",14,0)",1:"")
"RTN","PSJLMPRI",58,0)
 ; Naked reference below refers to either ^PS(53.1,+ON,14,0), ^PS(55,+ON,5,14,0), or ^PS(55,+ON,5,14,0) created using indirection in variable FIL.
"RTN","PSJLMPRI",59,0)
 Q:FIL="" 0
"RTN","PSJLMPRI",60,0)
 S ND14=$G(@(FIL)) I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0))
"RTN","PSJLMPRI",61,0)
 Q ND14
"RTN","PSJLMPRI",62,0)
 ;
"RTN","PSJLMPRI",63,0)
LASTRNBY(DFN,ON) ;
"RTN","PSJLMPRI",64,0)
 N FIL,RNBY,ND0,ND14 S RNBY=""
"RTN","PSJLMPRI",65,0)
 S FIL=$S(ON["P":"^PS(53.1,"_+ON_",14,0)",ON["V":"^PS(55,"_DFN_",""IV"","_+ON_",14,0)",ON["U":"^PS(55,"_DFN_",5,"_+ON_",14,0)",1:"")
"RTN","PSJLMPRI",66,0)
 ; Naked reference below refers to either ^PS(53.1,+ON,14,0), ^PS(55,+ON,5,14,0), or ^PS(55,+ON,5,14,0) created using indirection in variable FIL.
"RTN","PSJLMPRI",67,0)
 Q:FIL="" 0
"RTN","PSJLMPRI",68,0)
 S ND14=$G(@(FIL)) I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0)),RNBY=$P(ND14,"^",2)
"RTN","PSJLMPRI",69,0)
 Q RNBY
"RTN","PSJO")
0^20^B28881243^B23946604
"RTN","PSJO",1,0)
PSJO ;BIR/CML3,PR-GET AND PRINT INPATIENT ORDERS ;28 Jun 99 / 10:20 AM
"RTN","PSJO",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**31,58,110,181,267,275**;16 DEC 97;Build 157
"RTN","PSJO",3,0)
 ;
"RTN","PSJO",4,0)
 ; Reference to ^PSD(58.8 supported by DBIA #2283.
"RTN","PSJO",5,0)
 ; Reference to ^PSI(58.1 supported by DBIA #2284.
"RTN","PSJO",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJO",7,0)
 ;
"RTN","PSJO",8,0)
 K ^TMP("PSJON",$J),^TMP("PSJ",$J) N TF2 D @$S($D(PSJEXTP):"EN^PSJH1",1:"EN^PSJO1(3)")
"RTN","PSJO",9,0)
 S PSJDEV=IO'=IO(0)!($E(IOST,1,2)'="C-"),(NP,TF2,PSGON,PSJON)=""
"RTN","PSJO",10,0)
 U IO D ENGET^PSJO3 I '$D(^TMP("PSJ",$J)) W !,SLS,SLS,$E(SLS,1,25),!!?22,"NO ORDERS FOUND FOR ",$S(PSJOL="S":"SHORT",1:"LONG")," PROFILE."
"RTN","PSJO",11,0)
 E  S (PSJC,PSJS,PSJO,PSJST)="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""  D  G:NP["^" DONE
"RTN","PSJO",12,0)
 .D:$S(($P(PSJC,"^")="Cz")&($P(PSJC,"^",2)'=TF2):1,(($P(PSJC,"^")'="Cz")&PSJC["B"&'TF):0,($P(PSJC,"^")'="Cz"&(PSJC'["A")):1,($P(PSJC,"^")="Cz"&(TF2=$P(PSJC,"^",2))):0,1:1) TF
"RTN","PSJO",13,0)
 .F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""!(NP[U)  D ON
"RTN","PSJO",14,0)
 G:NP[U DONE I PSJDEV,$S('$D(PSJPRP):1,1:PSJPRP="P") D BOT
"RTN","PSJO",15,0)
 ;
"RTN","PSJO",16,0)
DONE ;
"RTN","PSJO",17,0)
 I $S('$D(PSJPRP):1,1:PSJPRP="P") K ^TMP("PSJ",$J)
"RTN","PSJO",18,0)
 S PSGON=PSJON K:'$D(PSGVBW) PSGODT K %,%H,%I,C,DN,DO,DRG,FQ,GIVE,HDT,I,JJ,LN2,N,ND,ND4,ND6,NF,NP,O,ON,ORIFN,ORTX,P,PF,PG,PS,PSGID,PSGOD,PSIVSC,PSIVST,PSIVTY,PSJC,PSJDEV,PSJF,PSJO,PSJOS,PSJS,PSJSCHT,PSJST,QQ,RB,RTE,SCH,SD,SLS,SM
"RTN","PSJO",19,0)
 K ST,START,STAT,SUB,TF,TYP,UDU,UPD,V,WS,X,X1,X2,Y Q
"RTN","PSJO",20,0)
 ;
"RTN","PSJO",21,0)
ON ;
"RTN","PSJO",22,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJO",23,0)
 F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO) D:$Y+6>IOSL ENNP^PSJO3 Q:NP["^"  D  ;
"RTN","PSJO",24,0)
 .I $P(PSJC,"^")="Cz",($P(PSJC,"^",2)]"") S PSJF="^PS("_$S($P(PSJC,"^",4)'["C":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJO",25,0)
 .S PSJON=PSJON+1 S:'PSJDEV ^TMP("PSJON",$J,PSJON)=PSJO W !,$J(PSJON,4),?5 D @$S(PSJO["V":"PIV^PSIVUTL(PSJO)",PSJO["U":"PUD",1:"PIV^PSIVUTL(PSJO)")
"RTN","PSJO",26,0)
 Q
"RTN","PSJO",27,0)
 ;
"RTN","PSJO",28,0)
PUD ; print unit dose
"RTN","PSJO",29,0)
 ; Naked reference below refers to full reference ^PS(53.1,+PSJO,0) or ^PS(55,DFN,5,+PSJO,0) using indirection.
"RTN","PSJO",30,0)
 I PSJO["U" S:'$$CLINIC^PSJO1(PSGP,PSJO) C=$G(PSJC)
"RTN","PSJO",31,0)
 I PSJO["P" S:'$$CLINIC^PSJO1(PSGP,PSJO) C=$G(PSJC)
"RTN","PSJO",32,0)
 S ND=$S($D(@(PSJF_+PSJO_",0)")):^(0),1:""),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$P($G(^(6)),"^"),DO=$S($P(DN,"^",2)=.2:$P($G(@(PSJF_+PSJO_",.2)")),"^",2),1:$G(@(PSJF_+PSJO_",.3)")))
"RTN","PSJO",33,0)
 I ("AO"[PSJC)!(PSJC="DF") D
"RTN","PSJO",34,0)
 .S V='$P(ND4,"^",UDU),V=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSJO",35,0)
 .W $S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",18)&($P(ND4,"^",19)!V):"H",$P(ND4,"^",22)&($P(ND4,"^",23)!V):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" ")
"RTN","PSJO",36,0)
 .W $S($P($G(@(PSJF_+PSJO_",.2)")),"^",4)="D":"d",1:" ")_$S(V:"->",1:"  ")
"RTN","PSJO",37,0)
 I $S(PSJC["NZ":0,1:PSJC["N") W $S($P(ND4,"^",12):"D",1:" ")
"RTN","PSJO",38,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),STAT=$S($P(ND,"^",28)]"":$P(ND,"^",28),$P(ND,"^",9)]"":$P(ND,"^",9),1:"NF")
"RTN","PSJO",39,0)
 S PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJO",40,0)
 I STAT="A",$P(ND,U,27)="R" S STAT="R"
"RTN","PSJO",41,0)
 S NF=$P(DN,"^",2),WS=$S(PSJPWD:$$WS(PSJPWD,PSGP,PSJF,PSJO),1:0)
"RTN","PSJO",42,0)
 NEW MARX,PSJRNDT
"RTN","PSJO",43,0)
 S:($P(PSJC,"^")'="Cz") PSJORFLG=$S(PSJC["A":"U",PSJC["O":"U",PSJC="DF":"U",1:"P")
"RTN","PSJO",44,0)
 S:($P(PSJC,"^")="Cz") PSJORFLG=$S($P(PSJC,"^",4)["A":"U",($P(PSJC,"^",4)["O"):"U",($P(PSJC,"^",4)["DF"):"U",1:"P")
"RTN","PSJO",45,0)
 S PSJRNDT=$$LASTREN^PSJLMPRI(DFN,PSJO) S:PSJRNDT PSJRNDT=$E($$ENDTC^PSGMI(+PSJRNDT),1,5)
"RTN","PSJO",46,0)
 D DRGDISP^PSJLMUT1(PSGP,+PSJO_PSJORFLG,40,54,.MARX,0)
"RTN","PSJO",47,0)
 F X=0:0 S X=$O(MARX(X)) Q:'X  W @($S(X=1:"?9",1:"!?11")),$S($E(PSJS)="*":$P(PSJS,"^"),1:MARX(X)) D:X=1
"RTN","PSJO",48,0)
 . W ?50,$S(PSJC["NZ":"?",PSJSCHT'="z":PSJSCHT,1:"?")
"RTN","PSJO",49,0)
 . W:'$D(PSJEXTP) ?53,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(PSGID),1,5)),?60,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(SD),1,5)),?67,STAT
"RTN","PSJO",50,0)
 . W:$D(PSJEXTP) ?53,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(PSGID),1,8)),?63,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(SD),1,8)),?73,STAT
"RTN","PSJO",51,0)
 . I NF!WS!SM!PF!(PSJRNDT]"") W ?71 W:NF "NF " W:WS "WS " W:SM $E("HSM",SM,3) W:$G(PSJRNDT) PSJRNDT W:PF ?79,"*"
"RTN","PSJO",52,0)
 I ND6]"" S Y=$$ENSET^PSGSICHK(ND6) D  K ^PS(53.45,DUZ,5)
"RTN","PSJO",53,0)
 .D GETSI^PSJBCMA5(DFN,PSJO) I $G(^PS(53.45,DUZ,5)) N TXTLN S TXTLN=0 F  S TXTLN=$O(^PS(53.45,DUZ,5,TXTLN)) Q:'TXTLN  D
"RTN","PSJO",54,0)
 ..W !?11,$G(^PS(53.45,DUZ,5,TXTLN,0))
"RTN","PSJO",55,0)
 .W !?11 F X=1:1:$L(Y," ") S V=$P(Y," ",X) W:$L(V)+$X>66 !?11 W V_" "
"RTN","PSJO",56,0)
 K PSJORFLG
"RTN","PSJO",57,0)
 Q
"RTN","PSJO",58,0)
 ;
"RTN","PSJO",59,0)
TF ;
"RTN","PSJO",60,0)
 NEW SLS,C S SLS="",C=PSJC,$P(SLS," -",40)=""
"RTN","PSJO",61,0)
 S LN2=$S(($P(C,"^")="Cz"):$$TXT(C),C="A":$$TXT(C),C["CC":$$TXT("PR"),C["CD":$$TXT("PC"),C["BD":$$TXT("NC"),C["C":$$TXT("P"),C["B":$$TXT("N"),C["NX":$$TXT("N"),C["DF":$$TXT("DF"),C["NZ":$$TXT("P"),1:$$TXT("NA"))
"RTN","PSJO",62,0)
 W:$D(^TMP("PSJ",$J,PSJC)) !,$E($E(SLS,1,(80-$L(LN2))/2)_" "_LN2_$E(SLS,1,(80-$L(LN2))/2),1,80)
"RTN","PSJO",63,0)
 S PSJF="^PS("_$S(PSJC'["C":"55,"_PSGP_",5,",1:"53.1,") S TF=$S(PSJC["C":0,1:TF)
"RTN","PSJO",64,0)
 I $P(PSJC,"^")="Cz",($P(PSJC,"^",2)]"") S PSJF="^PS("_$S($P(PSJC,"^",4)'["C":"55,"_PSGP_",5,",1:"53.1,"),TF2=$P(PSJC,"^",2)
"RTN","PSJO",65,0)
 Q
"RTN","PSJO",66,0)
 ;
"RTN","PSJO",67,0)
TXT(X) ;
"RTN","PSJO",68,0)
 I $G(X)="" Q ""
"RTN","PSJO",69,0)
 I X="A" Q "A C T I V E"
"RTN","PSJO",70,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJO",71,0)
 I $P(X,"^")="Cz" Q $P(X,"^",2)
"RTN","PSJO",72,0)
 I X="DF" Q "RECENTLY DISCONTINUED/EXPIRED (LAST "_+$G(PSJDCEXP)_" HOURS)"
"RTN","PSJO",73,0)
 I X="N" Q "N O N - V E R I F I E D"
"RTN","PSJO",74,0)
 I X="NA" Q "N O N - A C T I V E"
"RTN","PSJO",75,0)
 I X="NC" Q "N O N - V E R I F I E D  C O M P L E X"
"RTN","PSJO",76,0)
 I X="P" Q "P E N D I N G"
"RTN","PSJO",77,0)
 I X="PC" Q "P E N D I N G  C O M P L E X"
"RTN","PSJO",78,0)
 I X="PR" Q "P E N D I N G   R E N E W A L S"
"RTN","PSJO",79,0)
 Q ""
"RTN","PSJO",80,0)
 ;
"RTN","PSJO",81,0)
BOT ; print name, ssn, and dob on bottom of page
"RTN","PSJO",82,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSJO",83,0)
 W !,?2,$P(PSGP(0),"^"),?40,PSJPPID,?70,$E($P(PSJPDOB,"^",2),1,8)
"RTN","PSJO",84,0)
 Q
"RTN","PSJO",85,0)
WS(PSJPWD,PSGP,PSJF,PSJO) ; - WARD STOCK flag, input=(ward,dfn,file root,order)
"RTN","PSJO",86,0)
 ; Naked reference below refers to full reference ^PS(55,DFN,5,+PSJO,1,"B",PSWS) using indirection.
"RTN","PSJO",87,0)
 S WS=0,PSJF=PSJF_+PSJO_",1,""B"")" I $D(@PSJF) N PSWS S PSWS=0 F  S PSWS=$O(^("B",PSWS)) Q:'PSWS  S WS=$$WSCHK(PSJPWD,PSWS) Q:WS
"RTN","PSJO",88,0)
 Q WS
"RTN","PSJO",89,0)
 ;
"RTN","PSJO",90,0)
WSCHK(PSJPWD,PSWS) ; Determine if drug is ward stock item.
"RTN","PSJO",91,0)
 Q $S(PSJPWD:$S($D(^PSI(58.1,"D",PSWS,PSJPWD)):1,$D(^PSD(58.8,"D",PSWS,PSJPWD)):1,1:0),1:0)
"RTN","PSJO1")
0^26^B46168222^B32562541
"RTN","PSJO1",1,0)
PSJO1 ;BIR/CML3,PR-GET UNIT DOSE/IV ORDERS FOR INPATIENT ;15 May 98 / 9:28 AM
"RTN","PSJO1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**3,47,56,58,109,110,127,162,181,275**;16 DEC 97;Build 157
"RTN","PSJO1",3,0)
 ;
"RTN","PSJO1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJO1",5,0)
 ; Reference to ^%DTC is supported by DBIA# 10000.
"RTN","PSJO1",6,0)
 ; Reference to ^%ZOSV is supported by DBIA# 10097.
"RTN","PSJO1",7,0)
 ; Reference to XLFDT is supported by DBIA# 10103.
"RTN","PSJO1",8,0)
 ;
"RTN","PSJO1",9,0)
ECHK ;
"RTN","PSJO1",10,0)
 S C="A",ON=+O_"U",START=$G(^PS(55,PSGP,5,+O,2)),STOP=$P(START,U,4),START=$P(START,U,2) S:PSJOS START=-START
"RTN","PSJO1",11,0)
 I +START>PSGDT,(STOP>PSGDT) G SET
"RTN","PSJO1",12,0)
 S ND=$G(^PS(55,PSGP,5,+O,0)) G:$S($P(ND,"^",9)="":1,1:"DE"'[$P(ND,"^",9)) SET S ND4=$G(^PS(55,PSGP,5,+O,4)) I ST'="O",SD'<PSGODT,$S($P(ND,"^",9)="E":$P(ND4,"^",16),1:0)
"RTN","PSJO1",13,0)
 E  I ST="O",$P(ND,"^",9)="E",$S('$P(ND4,"^",UDU):1,SD<PSGODT:0,1:$P(ND4,"^",16))
"RTN","PSJO1",14,0)
 E  I PSJOL="S",(STOP>$P($G(PSJDCEXP),U,2)) S C="DF" G SET
"RTN","PSJO1",15,0)
 E  Q:PSJOL="S"  S C="O"
"RTN","PSJO1",16,0)
 ;
"RTN","PSJO1",17,0)
SET ;
"RTN","PSJO1",18,0)
 I ON["P",($D(PRNTON)!($D(P("PRNTON")))) N PSJOK S PSJOK=$$COMCHK($S($G(P("PRNTON"))]"":P("PRNTON"),$G(PRNTON)]"":PRNTON,1:""),PSJPTYP) Q:'PSJOK
"RTN","PSJO1",19,0)
 NEW DRUGNAME,CLINFLAG D DRGDISP^PSJLMUT1(PSGP,ON,40,0,.DRUGNAME,1)
"RTN","PSJO1",20,0)
 S DN=DRUGNAME(1),SUB=$S(PSJOS:START,1:$E(DN,1,40))
"RTN","PSJO1",21,0)
 I ON["P",$G(P("PRNTON"))]"",$G(PRNTON)=+P("PRNTON") Q
"RTN","PSJO1",22,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSJO1",23,0)
 S CLINFLAG=$$CLINIC(PSGP,ON) I CLINFLAG]"" D
"RTN","PSJO1",24,0)
 .N CLINSORT,SORT S CLINSORT=$$CLINSORT(C)
"RTN","PSJO1",25,0)
 .S C="Cz^"_CLINFLAG_"^"_CLINSORT_"^"_C
"RTN","PSJO1",26,0)
 S ^TMP("PSJ",$J,C,$S(PSJOS:SUB,1:ST),$S(PSJOS:ST,1:SUB),ON)=DN_"^"_$G(NF),PSJOCNT=PSJOCNT+1 Q
"RTN","PSJO1",27,0)
 ;
"RTN","PSJO1",28,0)
IVSET ;Set IV data in ^TMP("PSJ",$J,.
"RTN","PSJO1",29,0)
 N DRG,DRGT,ON55,ORTX,P,STAT,TYP,X,Y,NAME,ND
"RTN","PSJO1",30,0)
 I ON["V" S ON55=ON,Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,9,17 S P(X)=$P(Y,U,X)
"RTN","PSJO1",31,0)
 I ON["V",(P(2)=""),(P(3)="") Q
"RTN","PSJO1",32,0)
 I ON'["V" S ND=$G(^PS(53.1,+ON,0)) I 'ND K ^PS(53.1,"AS",SD,PSGP,+ON) Q
"RTN","PSJO1",33,0)
 I ON'["V",ND S P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4),P(4)=$P($G(^PS(53.1,+ON,8)),U),P("PRNTON")=$P($G(^PS(53.1,+ON,.2)),U,8)
"RTN","PSJO1",34,0)
 I ON'["V",P("PRNTON")]"" N PSJOK S PSJOK=$$COMCHK(P("PRNTON"),PSJPTYP) Q:'PSJOK
"RTN","PSJO1",35,0)
 D @$S(ON["V":"GTDRG^PSIVORFB",1:"GTDRG^PSIVORFA"),GTOT^PSIVUTL(P(4))
"RTN","PSJO1",36,0)
 I $G(DRG) S DRGT=$S($G(DRG("AD",1))]"":$P($G(DRG("AD",1)),U,2),1:$P($G(DRG("SOL",1)),U,2)),ORTX=DRGT
"RTN","PSJO1",37,0)
 I $G(ORTX)="",(ON'["V") D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,"",.NAME,1) S ORTX=NAME(1)
"RTN","PSJO1",38,0)
 ;* I $G(ORTX)=""!(ON'["V") D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,"",.NAME,1) S ORTX=NAME(1)
"RTN","PSJO1",39,0)
 S:$G(ORTX)="" ORTX="NOT FOUND"
"RTN","PSJO1",40,0)
 ;
"RTN","PSJO1",41,0)
IVSET1 ;
"RTN","PSJO1",42,0)
 ;* S TYP=$S(P(2)=P(3):"O",1:"C"),STAT=$S("ED"[P(17):"O",P(17)="P":"P",1:"A")
"RTN","PSJO1",43,0)
 N PSJCLIN,CLINSORT
"RTN","PSJO1",44,0)
 S TYP=$$ONE^PSJBCMA(PSGP,ON,P(9),P(2),P(3)) I TYP'="O" S TYP=$S(ON["P":"z",1:"C")
"RTN","PSJO1",45,0)
 S STAT=$S($G(PSJPRI)="D":"A","ED"[P(17):"O",P(17)="P":"P",1:"A")
"RTN","PSJO1",46,0)
 I P(17)="P" S STAT="C"_$S($P($G(^PS(53.1,+ON,.2)),U,8)]"":"D",$P($G(^PS(53.1,+ON,.2)),U,4)="S":"A",$P($G(^(0)),U,24)="R":"C",1:"B")
"RTN","PSJO1",47,0)
 I PSJOL="S",(STAT="O"),(P(3)>$P($G(PSJDCEXP),U,2)) S STAT="DF"
"RTN","PSJO1",48,0)
 I ON["P",$G(P("PRNTON"))]"",PRNTON=+P("PRNTON") Q
"RTN","PSJO1",49,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSJO1",50,0)
 S PSJCLIN=$$CLINIC(PSGP,ON) I PSJCLIN]"" D
"RTN","PSJO1",51,0)
 .N STAT2 S STAT2=$S($P(STAT,"^",4)]"":$P(STAT,"^",4),1:STAT)
"RTN","PSJO1",52,0)
 .N CLINSORT S CLINSORT=$$CLINSORT(STAT) S STAT="Cz^"_PSJCLIN_"^"_CLINSORT_"^"_STAT2
"RTN","PSJO1",53,0)
 S ^TMP("PSJ",$J,STAT,$S(PSJOS:-P(2),1:TYP),$S(PSJOS:TYP,1:ORTX),ON)="^F",PSJOCNT=PSJOCNT+1
"RTN","PSJO1",54,0)
 Q
"RTN","PSJO1",55,0)
 ;
"RTN","PSJO1",56,0)
ENU ; update status field to reflect expired orders, if necessary
"RTN","PSJO1",57,0)
 W !!,"...a few moments, I have some updating to do..."
"RTN","PSJO1",58,0)
ENUNM ;
"RTN","PSJO1",59,0)
 F Q=+PSJPAD:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q!(Q>PSGDT)  S UPD=Q F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,0)),"DEH"'[$E($P(^(0),"^",9)) D
"RTN","PSJO1",60,0)
 .N DIE,DA,DR,X,Y,QQON S QQON=QQ,DIE="^PS(55,"_PSGP_",5,",DA(1)=PSGP,DA=+QQON,DR="28////E" D ^DIE
"RTN","PSJO1",61,0)
 .S ORIFN=$P(^PS(55,PSGP,5,+QQON,0),"^",21) D EN1^PSJHL2(PSGP,"SC",QQON_"U")
"RTN","PSJO1",62,0)
 K UPD Q
"RTN","PSJO1",63,0)
 ;
"RTN","PSJO1",64,0)
EN(PSJPTYP) ; enter here
"RTN","PSJO1",65,0)
 ; PSJPTYP=1:UD ONLY, 2:IV ONLY, 3:BOTH
"RTN","PSJO1",66,0)
 N PSJX,PSJY
"RTN","PSJO1",67,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJO1",68,0)
 S PSJOL=$G(PSJOL)  ; Initialize if no 'View Profile' option selected
"RTN","PSJO1",69,0)
 I PSJOL="L",$D(XRTL) D T0^%ZOSV
"RTN","PSJO1",70,0)
 K ^TMP("PSJ",$J) D NOW^%DTC S PSGDT=+$E(%,1,12),DT=$$DT^XLFDT,PSJOS=$P(PSJSYSP0,"^",11),UDU=$S($P(PSJSYSU,";",3)>1:3,1:1)
"RTN","PSJO1",71,0)
 S PSJOCNT=0 I PSJPTYP>1 F PSJORD=0:0 S PSJORD=$O(^PS(55,DFN,"IV",PSJORD)) Q:'PSJORD  D
"RTN","PSJO1",72,0)
 .S PSJX=$G(^PS(55,DFN,"IV",+PSJORD,0))
"RTN","PSJO1",73,0)
 .S PSJY=$P(PSJX,U,17)
"RTN","PSJO1",74,0)
 .I $P(PSJX,U,3)<PSGDT,"AR"[PSJY S $P(^PS(55,DFN,"IV",+PSJORD,0),U,17)="E",PSJY="E",ON=+PSJORD D EXPIR^PSIVOE
"RTN","PSJO1",75,0)
 .I +PSJSYSU=3,('+$P($G(^PS(55,DFN,"IV",+PSJORD,4)),U,4)),($P($G(^(.2)),U,4)="D") S PSJPRI="D"
"RTN","PSJO1",76,0)
 .I $S($G(PSJPRI)="D":1,PSJY="P":0,PSJOL="L":1,$P(PSJX,U,3)>$P($G(PSJDCEXP),U,2):1,1:"DPE"'[PSJY) S ON=+PSJORD_"V" D IVSET K PSJPRI,ON
"RTN","PSJO1",77,0)
 D NOW^%DTC S PSJIVOF=PSJOCNT,PSGDT=%,(X1,DT)=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT)
"RTN","PSJO1",78,0)
 D ENUNM
"RTN","PSJO1",79,0)
 I PSJPTYP'=2 F ST="C","O","OC","P","R" F SD=+PSJDCEXP:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  D ECHK
"RTN","PSJO1",80,0)
 Q:$D(PSGONNV)
"RTN","PSJO1",81,0)
 ;I PSJPTYP'=2 F SD="I","N" S O=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D NVSET
"RTN","PSJO1",82,0)
 N PRNTON F SD="I","N" S (PRNTON,O)=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D NVSET
"RTN","PSJO1",83,0)
 ;I $S(+PSJSYSU=3:1,1:$D(PSGLPF)) S O=0,SD="P" F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D @$S("FI"[X:"IVSET",1:"NVSET")
"RTN","PSJO1",84,0)
 N PRNTON S (PRNTON,O)=0,SD="P" F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D @$S("FI"[X:"IVSET",1:"NVSET")
"RTN","PSJO1",85,0)
 I PSJOL="L",$D(XRT0) S XRTN="PSJO1" D T1^%ZOSV
"RTN","PSJO1",86,0)
 Q
"RTN","PSJO1",87,0)
 ;
"RTN","PSJO1",88,0)
NVSET ; Set up orders from 53.1.
"RTN","PSJO1",89,0)
 N ND S ND=$G(^PS(53.1,O,0)) I 'ND D  Q
"RTN","PSJO1",90,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",91,0)
 I $P(ND,U,15),$G(PSGP) I PSGP'=$P(ND,U,15) D  Q
"RTN","PSJO1",92,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",93,0)
 I $P(ND,U,9)["D" D  Q
"RTN","PSJO1",94,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",95,0)
 .N ND2 S ND2=$G(^PS(53.1,O,.2)) I $P(ND2,U,8) K ^PS(53.1,"ACX",$P(ND2,U,8))
"RTN","PSJO1",96,0)
 S ST=$P($G(^PS(53.1,O,0)),U,7),START=-$P($G(^(2)),U,2),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSJO1",97,0)
 S C=$S(((SD="N")&($P($G(^PS(53.1,O,.2)),U,8)]"")):"BD",SD="N":"BA",SD="I":"BB",$P($G(^PS(53.1,O,.2)),U,8)]"":"CD",$P($G(^PS(53.1,O,.2)),U,4)="S":"CA",$P($G(^(0)),U,24)="R":"CC",1:"CB")
"RTN","PSJO1",98,0)
 ;I C="CC" S C=$$CKPC^PSGOU(PSGP,+$P($G(^PS(53.1,O,0)),U,25),O)
"RTN","PSJO1",99,0)
 D SET
"RTN","PSJO1",100,0)
 Q
"RTN","PSJO1",101,0)
 ;
"RTN","PSJO1",102,0)
KILL ;
"RTN","PSJO1",103,0)
 K P,STAT,TYP,ORTX,N,JJ
"RTN","PSJO1",104,0)
 Q
"RTN","PSJO1",105,0)
COMCHK(PSJCOM,PSJPTYP) ;Check complex orders for order type
"RTN","PSJO1",106,0)
 S OK=0
"RTN","PSJO1",107,0)
 I PSJCOM=0 S OK=1 Q OK
"RTN","PSJO1",108,0)
 I PSJCOM=""  Q OK
"RTN","PSJO1",109,0)
 I PSJPTYP="" Q OK
"RTN","PSJO1",110,0)
 I '$D(^PS(53.1,"ACX",PSJCOM)) Q OK
"RTN","PSJO1",111,0)
 S OK=1 I PSJPTYP=3 Q OK
"RTN","PSJO1",112,0)
 N PSJON S PSJON=""
"RTN","PSJO1",113,0)
 F  S PSJON=$O(^PS(53.1,"ACX",PSJCOM,PSJON)) Q:'PSJON  D  Q:OK=0
"RTN","PSJO1",114,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",9)["D" K ^PS(53.1,"ACX",PSJCOM)
"RTN","PSJO1",115,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)'="U",PSJPTYP=1 S OK=0 Q
"RTN","PSJO1",116,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)="U",PSJPTYP=2 S OK=0 Q
"RTN","PSJO1",117,0)
 Q OK
"RTN","PSJO1",118,0)
 ;
"RTN","PSJO1",119,0)
CLINIC(PSGP,ORDER) ; Return Clinic Name for a given patient/order combination
"RTN","PSJO1",120,0)
 I '$G(ORDER) Q ""
"RTN","PSJO1",121,0)
 N CLN S CLN=$S(ORDER["P":$G(^PS(53.1,+ORDER,"DSS")),ORDER["V":$G(^PS(55,PSGP,"IV",+ORDER,"DSS")),ORDER["U":$G(^PS(55,PSGP,5,+ORDER,8)),1:"")
"RTN","PSJO1",122,0)
 I 'CLN,(ORDER=+ORDER) D
"RTN","PSJO1",123,0)
 .I $D(^PS(53.1,"ACX",+ORDER)) N PSJORD S PSJORD=0 F  S PSJORD=$O(^PS(53.1,"ACX",+ORDER,PSJORD)) Q:'PSJORD!$G(CLN)  S CLN=$G(^PS(53.1,+PSJORD,"DSS"))
"RTN","PSJO1",124,0)
 .I $D(^PS(55,"ACX",+ORDER)) N ACX2,PSJORD S ACX2="" F  S ACX2=$O(^PS(55,"ACX",+ORDER,ACX2)) Q:'ACX2!$G(CLN)  S PSJORD=0 F  S PSJORD=$O(^PS(55,"ACX",+ORDER,ACX2,PSJORD)) Q:'PSJORD!$G(CLN)  D
"RTN","PSJO1",125,0)
 ..S CLN=$S(PSJORD["P":$G(^PS(53.1,+PSJORD,"DSS")),PSJORD["V":$G(^PS(55,PSGP,"IV",+PSJORD,"DSS")),ORDER["U":$G(^PS(55,PSGP,5,+PSJORD,8)),1:"")
"RTN","PSJO1",126,0)
 S CLN=$S($P(CLN,"^",2):$$GET1^DIQ(44,+CLN,.01),1:"")
"RTN","PSJO1",127,0)
 Q CLN
"RTN","PSJO1",128,0)
 ;
"RTN","PSJO1",129,0)
CLINSORT(C) ; Return integer sort value based on order status
"RTN","PSJO1",130,0)
 I $P(C,"^")="Cz" N CTMP S CTMP=C N C S C=$P(CTMP,"^",4)
"RTN","PSJO1",131,0)
 S SORT=$S($E(C)="A":3,$E(C)["C"!($E(C)["P"):1,($E(C)["B"):2,($E(C)["DF"):4,1:5)
"RTN","PSJO1",132,0)
 Q SORT
"RTN","PSJOE0")
0^31^B26253829^B25370612
"RTN","PSJOE0",1,0)
PSJOE0 ;BIR/CML3-INPATIENT PROFILE AND ORDER ENTRY ; 4/15/10 2:45pm
"RTN","PSJOE0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**47,56,110,133,162,241,267,275**;16 DEC 97;Build 157
"RTN","PSJOE0",3,0)
 ;
"RTN","PSJOE0",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJOE0",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJOE0",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJOE0",7,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJOE0",8,0)
 ;
"RTN","PSJOE0",9,0)
START ; print orders
"RTN","PSJOE0",10,0)
 W:X]"" $P("^PROFILE",X,2) D ENL^PSJO3 G:PSJOL="^" DONE Q:PSJOL="N"  K PSJPR S PSGOEAV=0,PSJNARC=1 D ^PSJO I 'PSJON Q
"RTN","PSJOE0",11,0)
 ;
"RTN","PSJOE0",12,0)
ENVW ; ask user to select or view any of the orders shown
"RTN","PSJOE0",13,0)
 S (PSGONC,PSGONR,PSGONV)=0,PSGLMT=PSJON S:$D(PSJPRF) PSGPRF=1 D ENASR^PSGON K PSGPRF
"RTN","PSJOE0",14,0)
 G:X["^" DONE I X]"" S PSGOEA=""
"RTN","PSJOE0",15,0)
 K PSJDLW
"RTN","PSJOE0",16,0)
 I  F PSJOE=1:1:PSGODDD S PSGOE=PSJOE F PSJOE1=1:1:$L(PSGODDD(PSJOE),",")-1 S PSJOE2=$P(PSGODDD(PSJOE),",",PSJOE1),(PSGORD,PSJORD)=^TMP("PSJON",$J,PSJOE2) G:$D(PSJDLW) DONE D 
"RTN","PSJOE0",17,0)
 .I PSJORD=+PSJORD N PSJO,PSJO1 S PSJO=PSJORD,PSJO1=0 F  S PSJO1=$O(^PS(53.1,"ACX",PSJO,PSJO1)) Q:'PSJO1  Q:PSGOEA["^"  Q:$D(PSJDLW)  S PSJORD=PSJO1_"P" D GODO S PSJORD=""
"RTN","PSJOE0",18,0)
 .Q:PSJORD=""  Q:PSGOEA["^"
"RTN","PSJOE0",19,0)
 .D GODO Q:PSGOEA["^"
"RTN","PSJOE0",20,0)
 Q
"RTN","PSJOE0",21,0)
 ;
"RTN","PSJOE0",22,0)
LMNEW(PSGP,PSJPROT) ;Entry point for new order entry from listman.
"RTN","PSJOE0",23,0)
 ; PSGP = DFN
"RTN","PSJOE0",24,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJOE0",25,0)
 ;
"RTN","PSJOE0",26,0)
 D CKNEW N PSJUDPRF S PSJNEWOE=1
"RTN","PSJOE0",27,0)
 S PSGPTS=PSJPTS,PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU,PSGOEDMR=$O(^PS(51.2,"B","ORAL",0)),PSGOEPR=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",2),1:0),PSJORQF=0,PSJOEPF=""
"RTN","PSJOE0",28,0)
 I PSGOEPR>0,$D(^VA(200,+PSGOEPR,"PS")) S PSGOEPR=$S('$P(^("PS"),"^",4):PSGOEPR,($P(^("PS"),"^",4)<DT):0,1:PSGOEPR)
"RTN","PSJOE0",29,0)
 S:'PSGOEPR PSGOEPR=PSJPTSP
"RTN","PSJOE0",30,0)
 S PSJPCAF=$S($G(PSJPCAF):PSJPCAF,1:"1")
"RTN","PSJOE0",31,0)
 F PSJOE=0:0 Q:PSJORQF!('$P(PSJPCAF,"^",2)&(PSJPROT'>1))!('(PSJPCAF&(PSJPROT'=2))&(PSJPROT'>1))  D KILL^PSJBCMA5(+$G(PSJSYSP)) D:PSJPCAF&($P(PSJPCAF,"^",2))&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1 D ENIN^PSIVORE
"RTN","PSJOE0",32,0)
 Q
"RTN","PSJOE0",33,0)
 ;
"RTN","PSJOE0",34,0)
DONE ;
"RTN","PSJOE0",35,0)
 K PSG,PSGDL,PSGDLS,PSGDO,PSGDRG,PSGDRGN,PSGFD,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGOES,PSGOPR,PSGORD,PSGOROE1,PSGPR,PSGPRN,PSGS0XT,PSGS0Y,PSGSCH,PSGSD,PSGSI,PSGSM,PSGST,PSGSTN,PSGUD,PSGX,PSJDLW,PSJLM,PSJNARC,PSIVAC
"RTN","PSJOE0",36,0)
 K P,PSGEFN,PSGOEEF
"RTN","PSJOE0",37,0)
 Q
"RTN","PSJOE0",38,0)
 ;
"RTN","PSJOE0",39,0)
CKNEW ;
"RTN","PSJOE0",40,0)
 K CF,CHK,OD,PSGLMT,PSGODDD,PSGOEA,PSGON,PSGONC,PSGONR,PSGONV,PSGORD,PSJCOM,PSJOE1,PSJOE2 Q:$D(PSJPRF)
"RTN","PSJOE0",41,0)
 I $P(PSJPDD,"^",3) W !!?2,"Patient is shown as deceased.  You may not enter orders for this patient." D CONT Q
"RTN","PSJOE0",42,0)
 I 'PSJPCAF W !!,"(NOTE: You cannot enter Unit Dose orders for this patient.)" D CONT
"RTN","PSJOE0",43,0)
 Q
"RTN","PSJOE0",44,0)
 ;
"RTN","PSJOE0",45,0)
CONT ;
"RTN","PSJOE0",46,0)
 K DIR S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSJOE0",47,0)
 Q
"RTN","PSJOE0",48,0)
 ;
"RTN","PSJOE0",49,0)
GODO ;Display selected order.
"RTN","PSJOE0",50,0)
 S PSIVAC="C" I $S(PSJORD["V":1,PSJORD["P":$P($G(^PS(53.1,+PSJORD,0)),"^",4)="F",1:0) D @$S($D(PSJPRP):"ENINP^PSIVOPT(DFN,PSJORD)",1:"ENIN^PSIVOPT") G GODO1
"RTN","PSJOE0",51,0)
 I '$D(PSJPRP),(PSJORD["P"),($P($G(^PS(53.1,+PSJORD,0)),U,4)="I") D ASKTYP Q:$D(DIRUT)  I Y="I" D ENIN^PSIVOPT G GODO1
"RTN","PSJOE0",52,0)
 S PSGORD=PSJORD D EN2^PSGVW,^PSGOE1:'$D(PSJPRF)
"RTN","PSJOE0",53,0)
GODO1 ;
"RTN","PSJOE0",54,0)
 I $D(PSJPRP),'PSJPR K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT)!$D(DTOUT) PSJDLW=1 Q:$D(PSJDLW)  W:$Y @IOF
"RTN","PSJOE0",55,0)
 Q
"RTN","PSJOE0",56,0)
 ;
"RTN","PSJOE0",57,0)
ASKTYP ; Ask if completing as IV or UD.
"RTN","PSJOE0",58,0)
 Q
"RTN","PSJOE0",59,0)
 W !! D PIV^PSIVUTL(+PSJORD_"P")
"RTN","PSJOE0",60,0)
 I $G(PSJPDD) S DIR(0)="E" D ^DIR S Y="I" Q
"RTN","PSJOE0",61,0)
 W ! K DIR S DIR(0)="SOA^U:Unit Dose;I:IV Medication",DIR("A")="Do you wish to complete this as an IV or Unit Dose order (I/U)? ",DIR("?")="^D PENDIU^PSJO3" D ^DIR
"RTN","PSJOE0",62,0)
 Q
"RTN","PSJOE0",63,0)
 ;
"RTN","PSJOE0",64,0)
OLDCOM(DFN,PSJORD) ;
"RTN","PSJOE0",65,0)
 Q:$$COMPLEX^PSJOE(DFN,PSJORD)
"RTN","PSJOE0",66,0)
 N DURFLG S DURFLG=$S($G(PSJORD)["P":$G(^PS(53.1,+PSJORD,2.5)),$G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,2.5)),1:$G(^PS(55,DFN,5,+PSJORD,2.5))) I $P(DURFLG,"^",2)]"" D
"RTN","PSJOE0",67,0)
 . D CLEAR^VALM1 W !!!!!?21," * WARNING * "
"RTN","PSJOE0",68,0)
 . W !!!?5,"The following order contains a Requested Duration"
"RTN","PSJOE0",69,0)
 . W !?12,"and may be part of a complex dose!"
"RTN","PSJOE0",70,0)
 . W !!," Review the entire profile to determine appropriate action(s).",!!!!!!! D PAUSE^VALM1
"RTN","PSJOE0",71,0)
 Q
"RTN","PSJOE0",72,0)
AM ;
"RTN","PSJOE0",73,0)
 W !!?2,"Enter a 'Y' (or press the RETURN key) to enter new INPATIENT orders for this",!,"patient.  Enter an 'N' (or an '^') if there are no new orders for this patient."
"RTN","PSJOE0",74,0)
 W:'PSJPCAF !!?2,"PLEASE NOTE: The patient selected is NOT shown as currently admitted.",!,"Therefore, you cannot enter Unit Dose orders for this patient.  (You can enter",!,"IV orders.)" Q
"RTN","PSJORMA2")
0^45^B20205584^B19470230
"RTN","PSJORMA2",1,0)
PSJORMA2 ;BIR/MV-COLLECT DATA FOR ACTIVE IV AND FLUID PENDINGS ; 3/23/10 2:42pm
"RTN","PSJORMA2",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**2,15,21,26,58,237,275**;16 DEC 97;Build 157
"RTN","PSJORMA2",3,0)
 ;
"RTN","PSJORMA2",4,0)
 ; References to ^PS(52.7 supported by DBIA #2173
"RTN","PSJORMA2",5,0)
 ; References to ^PS(55 supported by DBIA #2191
"RTN","PSJORMA2",6,0)
 ; Reference to SETSTR^VALM1 supported by DBIA #10116
"RTN","PSJORMA2",7,0)
 ;
"RTN","PSJORMA2",8,0)
PRT ;Get IV nodes.
"RTN","PSJORMA2",9,0)
 K P,DRG,PSGLRN,PSGMARTS,PSGMARGD,PSGLFFD,TS N ON55 S TS=1,PSGMARGD=""
"RTN","PSJORMA2",10,0)
 I ON["V" D
"RTN","PSJORMA2",11,0)
 .I '$G(DUZ) N DUZ S DUZ=$J
"RTN","PSJORMA2",12,0)
 .I '$G(PSJSYSP) N PSJSYSP S PSJSYSP=$J
"RTN","PSJORMA2",13,0)
 .D GT55^PSIVORFB
"RTN","PSJORMA2",14,0)
 I ON["P" D GT531^PSIVORFA(DFN,ON,1)
"RTN","PSJORMA2",15,0)
 I $G(ACT)="NW" D
"RTN","PSJORMA2",16,0)
 .S P("OLDON")=$S(ON["P":$P($G(^PS(53.1,+ON,0)),U,25),1:$P($G(^PS(55,DFN,"IV",+ON,2)),U,5))
"RTN","PSJORMA2",17,0)
 .I $G(P("OLDON"))]"" S PSJROC=$S(P("OLDON")["V":$P(^PS(55,DFN,"IV",+P("OLDON"),2),U,8),1:$P(^PS(53.1,+P("OLDON"),0),U,27)),PSJF=$S(P("OLDON")["V":"^PS(55,"_DFN_",""IV"","_+P("OLDON"),1:"^PS(53.1,"_+P("OLDON")) D
"RTN","PSJORMA2",18,0)
 ..S $P(@(PSJF_",7)"),U,1,2)=PSJLDT_"^"_$S(PSJROC="R":"R",1:"DE")
"RTN","PSJORMA2",19,0)
 S PSJF=$S(ON["V":"^PS(55,"_DFN_",""IV"","_+ON,1:"^PS(53.1,"_+ON)
"RTN","PSJORMA2",20,0)
 I $G(ACT)]""&($G(ACT)'="NW") S $P(@(PSJF_",7)"),U,1,2)=PSJLDT_"^"_$S(ACT="DC":"D",ACT="HD":"H1",1:"H0")
"RTN","PSJORMA2",21,0)
 S PSGLR=$S(ON["P":$P($G(^PS(53.1,+ON,7)),U,2),1:$P($G(^PS(55,DFN,"IV",+ON,7)),U,2))
"RTN","PSJORMA2",22,0)
 S (PST,PSGST)=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I PST="" S (PST,PSGST)=$S(P(9)["PRN":"P",P(2)=P(3):"O",1:"C")
"RTN","PSJORMA2",23,0)
 D:P(9)]"" OS S PSGLSD=P(2),PSGLFD=P(3)
"RTN","PSJORMA2",24,0)
 F X="LOG",2 S:P(X) P(X)=$$ENDTC1^PSGMI(P(X))
"RTN","PSJORMA2",25,0)
 D INITOPI
"RTN","PSJORMA2",26,0)
 I PSGST="O",(P(2)="") S PSGST=""
"RTN","PSJORMA2",27,0)
 NEW NAMENEED,NEED,X S NAMENEED=0
"RTN","PSJORMA2",28,0)
 ;D LNNEED^PSGMIV,PRTIV
"RTN","PSJORMA2",29,0)
 D PRTIV
"RTN","PSJORMA2",30,0)
 Q
"RTN","PSJORMA2",31,0)
 ;
"RTN","PSJORMA2",32,0)
OS ; Define admin times.
"RTN","PSJORMA2",33,0)
 ;* S FD=P(3),PSGOES="",X=P(9),SD=P(2) D EN^PSGS0 S T=PSGS0XT
"RTN","PSJORMA2",34,0)
 S (FD,PSGMARFD)=P(3),PSGOES="",X=P(9),(SD,PSGMARSD)=P(2) D EN^PSGS0 S T=PSGS0XT
"RTN","PSJORMA2",35,0)
 S QQ="" I PSGST["C" D DTS^PSGMMAR0(P(9)) S SD=$P(SD,"."),QQ="" F X=0:0 S X=$O(PSGD(X)) Q:'X  S QQ=QQ_$S(X<SD:"",X>FD:"",'S:$P(PSGD(X),U),$D(S(X)):$P(PSGD(X),U),1:"")
"RTN","PSJORMA2",36,0)
 K PSGMARFD,PSGMARSD
"RTN","PSJORMA2",37,0)
 I T="D",P(11)="" S P(11)=$E($P(P(2),".",2)_"0000",1,4)
"RTN","PSJORMA2",38,0)
 S PSGMARTS=P(11),PSGMARGD=QQ
"RTN","PSJORMA2",39,0)
 K TS D TS^PSGMAR3(P(11))
"RTN","PSJORMA2",40,0)
 Q
"RTN","PSJORMA2",41,0)
 ;
"RTN","PSJORMA2",42,0)
PRTIV ; Set up order info on IV label.
"RTN","PSJORMA2",43,0)
 S MARLB(1)=$E(P("LOG"),1,5)_" |"
"RTN","PSJORMA2",44,0)
 I ON["P",+$G(^PS(53.1,+ON,4)) S MARLB(1)=MARLB(1)_"P E N D I N G"
"RTN","PSJORMA2",45,0)
 E  S MARLB(1)=MARLB(1)_$E(P(2),1,5)_$E(P(2),9,14),X=$S(ON["P":"",P(3)=1:"********",1:$$ENDTC1^PSGMI(P(3))),MARLB(1)=$$SETSTR^VALM1(" |"_X,MARLB(1),19,16)
"RTN","PSJORMA2",46,0)
 S MARLB(1)=$$SETSTR^VALM1("("_PSGLBS5_")",MARLB(1),36,7)
"RTN","PSJORMA2",47,0)
 NEW NAME S L=2
"RTN","PSJORMA2",48,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  D NAME^PSIVUTL(DRG("AD",X),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  D
"RTN","PSJORMA2",49,0)
 . S MARLB(L)=NAME(Y) S:L=2 MARLB(L)=$$SETSTR^VALM1(PSGST,MARLB(L),42,1) D L(1)
"RTN","PSJORMA2",50,0)
 S:$G(DRG("SOL",0)) MARLB(L)="in " NEW PSJPRT2
"RTN","PSJORMA2",51,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D NAME^PSIVUTL(DRG("SOL",X),47,.NAME,1) D
"RTN","PSJORMA2",52,0)
 . F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  S:(Y>1) L=L+1 S MARLB(L)=$$SETSTR^VALM1(NAME(Y),$G(MARLB(L)),4,$L(NAME(Y))) D L(1)
"RTN","PSJORMA2",53,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",X),0),U,4) I PSJPRT2]"" S:(Y>1) L=L+1 S MARLB(L)="       "_PSJPRT2 D L(1)
"RTN","PSJORMA2",54,0)
 S MARLB(L)=$P(P("MR"),U,2)_" "_P(9)_" "_P(8)
"RTN","PSJORMA2",55,0)
 ;I P(4)="C",'(L#4),P("OPI")="" S L=L+1,MARLB(L)=$G(MARLB(L))_"*CAUTION-CHEMOTHERAPY*" S L=L+1 Q
"RTN","PSJORMA2",56,0)
 I P(4)="C",'(L#4),P("OPI")="" D L(1) S MARLB(L)=$G(MARLB(L))_"*CAUTION-CHEMOTHERAPY*" D L(1)
"RTN","PSJORMA2",57,0)
 I P(4)'="C",(P("OPI")="") S L=L+1
"RTN","PSJORMA2",58,0)
 I P("OPI")'="" D L(1) D
"RTN","PSJORMA2",59,0)
 . F Y=1:1:$L($P(P("OPI"),"^")," ") D:$L($P($P(P("OPI"),"^")," ",Y)_"  ")+$L($G(MARLB(L)))>42 L(1) S MARLB(L)=$G(MARLB(L))_$P($P(P("OPI"),"^")," ",Y)_" " ;**PSJ*5.0*237-Prevent sentence cutoff
"RTN","PSJORMA2",60,0)
 . S L=L+1
"RTN","PSJORMA2",61,0)
 I (L#5)>0 S X=0 F  Q:X  D
"RTN","PSJORMA2",62,0)
 . D L(0) S MARLB(L)="",L=L+1
"RTN","PSJORMA2",63,0)
 . I TS,(L>TS),'(L#5) S X=1 Q
"RTN","PSJORMA2",64,0)
 . I TS=0,'(L#5) S X=1 Q
"RTN","PSJORMA2",65,0)
 S MARLB(L)=$$SETSTR^VALM1("RPH: "_PSGLRPH,$G(MARLB(L)),23,10)
"RTN","PSJORMA2",66,0)
 S MARLB(L)=$$SETSTR^VALM1("RN: "_PSGLRN,$G(MARLB(L)),33,9)
"RTN","PSJORMA2",67,0)
 Q
"RTN","PSJORMA2",68,0)
 ;
"RTN","PSJORMA2",69,0)
L(X) ;***Check to see if a new block if needed.
"RTN","PSJORMA2",70,0)
 S L=L+X
"RTN","PSJORMA2",71,0)
 I L#5=0 S MARLB(L)="See next label for continuation",L=L+1
"RTN","PSJORMA2",72,0)
 Q
"RTN","PSJORMA2",73,0)
INITOPI ;* Set nurse's initial and the other print info.
"RTN","PSJORMA2",74,0)
 D RPHINIT^PSGMIV(.PSGLRPH)
"RTN","PSJORMA2",75,0)
 S PSGLRN="_____"
"RTN","PSJORMA2",76,0)
 S:ON["P" PSGLRN=+$G(^PS(53.1,+ON,4)) S:ON["V" PSGLRN=+$G(^PS(55,DFN,"IV",+ON,4))
"RTN","PSJORMA2",77,0)
 I PSGLRN,$D(^VA(200,+PSGLRN,0))#2 S X=^(0),X=$S($P(X,"^",2)]"":$P(X,"^",2),1:$P(X,"^")),PSGLRN=$S(X'[",":X,1:$E(X,$F(X,","))_$E(X))
"RTN","PSJORMA2",78,0)
 S:$G(PSGLRN)=0 PSGLRN="_____"
"RTN","PSJORMA2",79,0)
 I ON["P" D
"RTN","PSJORMA2",80,0)
 . I P("OPI")="",$O(^PS(53.1,+ON,12,0)) S X=0 F  S X=$O(^PS(53.1,+ON,12,X)) Q:'X  S Z=$G(^(X,0)),Y=$L(P("OPI")) S:Y+$L(Z)'>179 P("OPI")=P("OPI")_Z_" " I Y+$L(Z)>179 S P("OPI")="SEE PROVIDER COMMENTS"
"RTN","PSJORMA2",81,0)
 . S PSGST=""
"RTN","PSJORMA2",82,0)
 Q
"RTN","PSJORRE")
0^9^B35461891^B32342688
"RTN","PSJORRE",1,0)
PSJORRE ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ; 2/28/11 3:11pm
"RTN","PSJORRE",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**22,51,50,58,81,110,111,112,134,225,275**;16 DEC 97;Build 157
"RTN","PSJORRE",3,0)
 ;
"RTN","PSJORRE",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRE",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRE",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRE",7,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRE",8,0)
 ;
"RTN","PSJORRE",9,0)
OCL(DFN,BDT,EDT,TFN,MVIEW)         ; return condensed list of inpat meds
"RTN","PSJORRE",10,0)
 ; MVIEW=0   -  This returns the 'unsorted' list as it was returned prior to GUI 27 
"RTN","PSJORRE",11,0)
 ; MVIEW=1   -  This returns the old sort view of the list, pre-sorted for GUI 27
"RTN","PSJORRE",12,0)
 ; MVIEW=2   -  This returns new sort view #1 of the order profile for GUI 27 
"RTN","PSJORRE",13,0)
 ; MVIEW=3   -  This returns new sort view #2 of the order profile for GUI 27
"RTN","PSJORRE",14,0)
 D @$S($G(MVIEW)=3:"OCL^PSJORRN1(DFN,BDT,EDT,.TFN)",$G(MVIEW)=2:"OCL^PSJORRN(DFN,BDT,EDT,.TFN)",$G(MVIEW)=1:"OCL^PSJORRO(DFN,BDT,EDT,.TFN)",1:"OCL1(DFN,BDT,EDT,TFN)")
"RTN","PSJORRE",15,0)
 Q
"RTN","PSJORRE",16,0)
OCL1(DFN,BDT,EDT,TFN,MVIEW) ; Execute this section if MVIEW=0
"RTN","PSJORRE",17,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A
"RTN","PSJORRE",18,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRE",19,0)
 S:BDT="" BDT=DT S WBDT=BDT_".000001"
"RTN","PSJORRE",20,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRE",21,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRE",22,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UDTMP
"RTN","PSJORRE",23,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE",24,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IVTMP
"RTN","PSJORRE",25,0)
 Q
"RTN","PSJORRE",26,0)
 ;
"RTN","PSJORRE",27,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRE",28,0)
 N PROVIDER,RNWDT,EDTCMPLX,NDP2 S (MR,SCH,INST,PON)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRE",29,0)
 D TYPE
"RTN","PSJORRE",30,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",31,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",32,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRE",33,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRE",34,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRE",35,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",36,0)
 S:ND6["Instructions too long. See Order View or BCMA for full text" ND6="Instructions too long. See order details for full text."
"RTN","PSJORRE",37,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRE",38,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRE",39,0)
 ;*225 Don't allow 0 Units
"RTN","PSJORRE",40,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(+UNITS=0) UNITS=1
"RTN","PSJORRE",41,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRE",42,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRE",43,0)
 S TFN=TFN+1
"RTN","PSJORRE",44,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRE",45,0)
 K ^TMP("PS",$J,TFN,"CLINIC",0) I PSJCLIN]"" S ^TMP("PS",$J,TFN,"CLINIC",0)=PSJCLIN
"RTN","PSJORRE",46,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRE",47,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",48,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",49,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PS",$J,TFN,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRE",50,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",51,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PS",$J,TFN,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRE",52,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PS",$J,TFN,"SIO",1,0)=ND6
"RTN","PSJORRE",53,0)
 Q
"RTN","PSJORRE",54,0)
 ;
"RTN","PSJORRE",55,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRE",56,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM
"RTN","PSJORRE",57,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",58,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRE",59,0)
 D TYPE
"RTN","PSJORRE",60,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),TFN=TFN+1,CNT=0
"RTN","PSJORRE",61,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",62,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PS",$J,TFN,"A",CNT,0)=Y
"RTN","PSJORRE",63,0)
 S ^TMP("PS",$J,TFN,"A",0)=CNT,CNT=0
"RTN","PSJORRE",64,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PS",$J,TFN,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRE",65,0)
 S ^TMP("PS",$J,TFN,"B",0)=CNT
"RTN","PSJORRE",66,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRE",67,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE",68,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRE",69,0)
 S:($G(SIO)["Instructions too long. See Order View or BCMA for full text") SIO="Instructions too long. See order details for full text."
"RTN","PSJORRE",70,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRE",71,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRE",72,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",73,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRE",74,0)
 K ^TMP("PS",$J,TFN,"CLINIC",0) I PSJCLIN]"" S ^TMP("PS",$J,TFN,"CLINIC",0)=PSJCLIN
"RTN","PSJORRE",75,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRE",76,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",77,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRE",78,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE",79,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",80,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",81,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PS",$J,TFN,"SCH",1,0)=SCH
"RTN","PSJORRE",82,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PS",$J,TFN,"ADM",1,0)=ADM
"RTN","PSJORRE",83,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PS",$J,TFN,"SIO",1,0)=SIO
"RTN","PSJORRE",84,0)
 I $G(IVLIM)]"" S ^TMP("PS",$J,TFN,"IVLIM",0)=IVLIM
"RTN","PSJORRE",85,0)
 Q
"RTN","PSJORRE",86,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRE",87,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRE",88,0)
 Q X
"RTN","PSJORRE",89,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRE",90,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRE",91,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRE",92,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRE",93,0)
 Q
"RTN","PSJORRE1")
0^10^B41040676^B35616681
"RTN","PSJORRE1",1,0)
PSJORRE1 ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (EXPANDED) ; 2/28/11 3:11pm
"RTN","PSJORRE1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**22,51,50,58,81,91,110,111,134,225,275**;16 DEC 97;Build 157
"RTN","PSJORRE1",3,0)
 ;
"RTN","PSJORRE1",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJORRE1",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRE1",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRE1",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRE1",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJORRE1",9,0)
 ; Reference to ^TMP("PS" is documented in DBIA #2384.
"RTN","PSJORRE1",10,0)
 ;
"RTN","PSJORRE1",11,0)
OEL(DFN,ON)         ; return list of expanded inpat meds
"RTN","PSJORRE1",12,0)
 K ^TMP("PS",$J)
"RTN","PSJORRE1",13,0)
 N ADM,CNT,DN,DO,F,INFUS,INST,MR,ND,ND0,ND2,ND2P5,ND6,NDOI,SCH,SIO,START,STAT,STOP,TYP,UNITS,X,Y
"RTN","PSJORRE1",14,0)
 S F=$S(ON["P":"^PS(53.1,",ON["U":"^PS(55,DFN,5,",1:"^PS(55,"_DFN_",""IV"",")
"RTN","PSJORRE1",15,0)
 I ON'["P",'$D(@(F_+ON_")")) Q
"RTN","PSJORRE1",16,0)
 I ON["P" S X=$G(^PS(53.1,+ON,0)) Q:$P(X,U,15)'=DFN  S TYP=$P(X,U,4) D @$S(TYP="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE1",17,0)
 D:ON'["P" @$S(ON["U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE1",18,0)
 S Y=$S(ON["V":5,1:12),CNT=0
"RTN","PSJORRE1",19,0)
 I $O(@(F_+ON_","_Y_",0)")) D
"RTN","PSJORRE1",20,0)
 . F X=0:0 S X=$O(@(F_+ON_","_Y_","_X_")")) Q:'X  D
"RTN","PSJORRE1",21,0)
 ..S CNT=CNT+1,ND=$G(@(F_+ON_","_Y_","_X_",0)")),^TMP("PS",$J,"PC",CNT,0)=ND
"RTN","PSJORRE1",22,0)
 S ^TMP("PS",$J,"PC",0)=CNT
"RTN","PSJORRE1",23,0)
 Q
"RTN","PSJORRE1",24,0)
 ;
"RTN","PSJORRE1",25,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRE1",26,0)
 N DO,DN,INST,X,Y,PROVIDER,NOTGIVEN,RNWDT
"RTN","PSJORRE1",27,0)
 S (MR,SCH,INST)=""
"RTN","PSJORRE1",28,0)
 S ND2=$G(@(F_+ON_",2)")),ND0=$G(@(F_+ON_",0)"))
"RTN","PSJORRE1",29,0)
 S ND6=$P($G(@(F_+ON_",6)")),"^") S:ND6["Instructions too long. See Order View or BCMA for full text." ND6="Instructions too long. See order details for full text."
"RTN","PSJORRE1",30,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,ON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE1",31,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(ON["P":53.1,1:55.06),28)
"RTN","PSJORRE1",32,0)
 S NDOI=$G(@(F_+ON_",.2)")),DO=$P(NDOI,U,2)
"RTN","PSJORRE1",33,0)
 S DN(1)=$$OIDF^PSJLMUT1(NDOI) I DN(1)=""  K DN D DRGDISP^PSJLMUT1(DFN,ON,40,0,.DN,1)
"RTN","PSJORRE1",34,0)
 ;*225 Don't allow 0 units
"RTN","PSJORRE1",35,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(ON["U")&(+UNITS=0) UNITS=1
"RTN","PSJORRE1",36,0)
 S MR=$$MR(+$P(ND0,U,3)),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE1",37,0)
 S NOTGIVEN=$S(ON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRE1",38,0)
 S ^TMP("PS",$J,0)=DN(1)_"^^"_$P(ND2,U,4)_"^^"_$P(ND2,U,2)_U_STAT_"^^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_U_$G(RNWDT)
"RTN","PSJORRE1",39,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRE1",40,0)
 I PROVIDER S ^TMP("PS",$J,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE1",41,0)
 S ^TMP("PS",$J,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,"MDR",1,0)=MR
"RTN","PSJORRE1",42,0)
 S ^TMP("PS",$J,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PS",$J,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRE1",43,0)
 S:$P(ND0,U,7)]"" ^TMP("PS",$J,"SCH",0)=1,$P(^TMP("PS",$J,"SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJORRE1",44,0)
 S ^TMP("PS",$J,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,"SIG",1,0)=INST
"RTN","PSJORRE1",45,0)
 S ^TMP("PS",$J,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PS",$J,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRE1",46,0)
 S ^TMP("PS",$J,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PS",$J,"SIO",1,0)=ND6
"RTN","PSJORRE1",47,0)
 NEW VERPHARM S:ON["U" VERPHARM=$P($G(@(F_+ON_",4)")),U,3)
"RTN","PSJORRE1",48,0)
 S:+$G(VERPHARM) $P(^TMP("PS",$J,"RXN",0),U,5)=VERPHARM
"RTN","PSJORRE1",49,0)
 NEW PSJDD,INACTDT,NDDD,OUTOI,PSJOUT S CNT=0
"RTN","PSJORRE1",50,0)
 F PSJDD=0:0 S PSJDD=$O(@(F_+ON_",1,PSJDD)")) Q:'PSJDD  D
"RTN","PSJORRE1",51,0)
 . S NDDD=@(F_+ON_",1,PSJDD,0)")
"RTN","PSJORRE1",52,0)
 . I $P(NDDD,U,3)]"",($P(NDDD,U,3)'>DT) Q
"RTN","PSJORRE1",53,0)
 . S PSJOUT=$P($G(^PSDRUG(+NDDD,8)),U,5)
"RTN","PSJORRE1",54,0)
 . I +PSJOUT D
"RTN","PSJORRE1",55,0)
 .. S INACTDT=$G(^PSDRUG(+PSJOUT,"I")),OUTOI=+$G(^PSDRUG(+PSJOUT,2))
"RTN","PSJORRE1",56,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJORRE1",57,0)
 . I '+PSJOUT,($P($G(^PSDRUG(+NDDD,2)),U,3)["O") D
"RTN","PSJORRE1",58,0)
 .. S PSJOUT=+NDDD,OUTOI=+NDOI
"RTN","PSJORRE1",59,0)
 .. S INACTDT=$G(^PSDRUG(+NDDD,"I"))
"RTN","PSJORRE1",60,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJORRE1",61,0)
 . S UNITS=$P(NDDD,U,2) S:(ON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE1",62,0)
 . S CNT=CNT+1,^TMP("PS",$J,"DD",CNT,0)=+NDDD_U_UNITS_U_PSJOUT_U_$G(OUTOI)
"RTN","PSJORRE1",63,0)
 S ^TMP("PS",$J,"DD",0)=CNT
"RTN","PSJORRE1",64,0)
 Q
"RTN","PSJORRE1",65,0)
 ;
"RTN","PSJORRE1",66,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRE1",67,0)
 N PROVIDER,RNWDT,IVLIM S ND0=$G(@(F_+ON_",0)")),CNT=0
"RTN","PSJORRE1",68,0)
 F X=0:0 S X=$O(@(F_+ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PS",$J,"A",CNT,0)=Y
"RTN","PSJORRE1",69,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,ON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE1",70,0)
 S ^TMP("PS",$J,"A",0)=CNT,CNT=0
"RTN","PSJORRE1",71,0)
 F X=0:0 S X=$O(@(F_+ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PS",$J,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRE1",72,0)
 S ^TMP("PS",$J,"B",0)=CNT
"RTN","PSJORRE1",73,0)
 S INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE1",74,0)
 I ON["P" D
"RTN","PSJORRE1",75,0)
 . S SCH=$P($G(^PS(53.1,+ON,2)),U)
"RTN","PSJORRE1",76,0)
 . S PROVIDER=$P(ND0,U,2)
"RTN","PSJORRE1",77,0)
 . S MR=$$MR(+$P(ND0,U,3)),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28)
"RTN","PSJORRE1",78,0)
 . S INFUS=$P($G(^PS(53.1,+ON,8)),U,5)
"RTN","PSJORRE1",79,0)
 . S ND2=$G(@(F_+ON_",2)")),START=$P(ND2,U,2),STOP=$P(ND2,U,4)
"RTN","PSJORRE1",80,0)
 . S ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE1",81,0)
 . S:($G(SIO)["Instructions too long. See Order View or BCMA for full text") SIO="Instructions too long. See order details for full text."
"RTN","PSJORRE1",82,0)
 . S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRE1",83,0)
 . I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE1",84,0)
 I ON'["P"  D
"RTN","PSJORRE1",85,0)
 . S PROVIDER=$P(ND0,U,6)
"RTN","PSJORRE1",86,0)
 . S SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100)
"RTN","PSJORRE1",87,0)
 . S MR=$$MR(+$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3))
"RTN","PSJORRE1",88,0)
 . S START=$P(ND0,U,2),STOP=$P(ND0,U,3)
"RTN","PSJORRE1",89,0)
 . S ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRE1",90,0)
 . S:($G(SIO)["Instructions too long. See Order View or BCMA for full text") SIO="Instructions too long. See order details for full text."
"RTN","PSJORRE1",91,0)
 . NEW VERPHARM S VERPHARM=$P($G(^PS(55,DFN,"IV",+ON,4)),U,4)
"RTN","PSJORRE1",92,0)
 . S:+VERPHARM $P(^TMP("PS",$J,"RXN",0),U,5)=VERPHARM
"RTN","PSJORRE1",93,0)
 . S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRE1",94,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRE1",95,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRE1",96,0)
 S ^TMP("PS",$J,0)=DN_U_INFUS_U_STOP_"^^"_START_U_STAT_"^^^"_DO_"^^"_$P(ND0,U,21)_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_U_$G(RNWDT)
"RTN","PSJORRE1",97,0)
 I PROVIDER S ^TMP("PS",$J,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE1",98,0)
 S ^TMP("PS",$J,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,"MDR",1,0)=MR
"RTN","PSJORRE1",99,0)
 S ^TMP("PS",$J,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PS",$J,"SCH",1,0)=SCH
"RTN","PSJORRE1",100,0)
 I ON["P" S:$P(ND0,U,7)]"" ^TMP("PS",$J,"SCH",0)=1,$P(^TMP("PS",$J,"SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJORRE1",101,0)
 S ^TMP("PS",$J,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,"SIG",1,0)=INST
"RTN","PSJORRE1",102,0)
 S ^TMP("PS",$J,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PS",$J,"ADM",1,0)=ADM
"RTN","PSJORRE1",103,0)
 S ^TMP("PS",$J,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PS",$J,"SIO",1,0)=SIO
"RTN","PSJORRE1",104,0)
 I $G(IVLIM)]"" S ^TMP("PS",$J,"IVLIM",0)=$G(IVLIM)
"RTN","PSJORRE1",105,0)
 Q
"RTN","PSJORRE1",106,0)
 ;
"RTN","PSJORRE1",107,0)
MR(X) ;RETURN MED ROUTE ABBR. IF THE ABBR="" RETURN MED ROUTE'S NAME.
"RTN","PSJORRE1",108,0)
 S X=$G(^PS(51.2,X,0))
"RTN","PSJORRE1",109,0)
 Q $S($P(X,U,3)]"":$P(X,U,3),1:$P(X,U))
"RTN","PSJORRE1",110,0)
 ;
"RTN","PSJORRE1",111,0)
GTSTAT(X) ;
"RTN","PSJORRE1",112,0)
 Q $S(X="A":"ACTIVE",X="D":"DISCONTINUED",X="I":"INCOMPLETE",X="N":"NON-VERFIED",X="U":"UNRELEASED",X="P":"PENDING",X="DE":"DISCONTINUED (EDIT)",X="O":"ON CALL",1:"NOT FOUND")
"RTN","PSJORRE1",113,0)
 ;
"RTN","PSJORRE1",114,0)
VA200(X) ;Return the IEN for the user.
"RTN","PSJORRE1",115,0)
 ; X = User name
"RTN","PSJORRE1",116,0)
 NEW DIC,Y S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSJORRE1",117,0)
 I +Y=-1 Q ""
"RTN","PSJORRE1",118,0)
 Q $P(Y,U)
"RTN","PSJORRE1",119,0)
GTSCHT(X)       ;
"RTN","PSJORRE1",120,0)
 Q $S(X="C":"CONTINUOUS",X="O":"ONE TIME",X="P":"PRN",X="R":"FILL ON REQUEST",X="OC":"ON CALL",1:"NOT FOUND")
"RTN","PSJORRN")
0^11^B66656039^B62913592
"RTN","PSJORRN",1,0)
PSJORRN ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) NEW SORT ; 2/28/11 3:21pm
"RTN","PSJORRN",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**134,213,225,275**;16 DEC 97;Build 157
"RTN","PSJORRN",3,0)
 ;
"RTN","PSJORRN",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRN",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRN",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRN",7,0)
 ;Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJORRN",8,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRN",9,0)
 ;
"RTN","PSJORRN",10,0)
OCL(DFN,BDT,EDT,TFN) ; return condensed list of inpat meds
"RTN","PSJORRN",11,0)
 ; MVIEW=2   -  This is the new sort with GUI 27
"RTN","PSJORRN",12,0)
 ; Execute this section if MVIEW=2
"RTN","PSJORRN",13,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A,TFN2,%
"RTN","PSJORRN",14,0)
 S TFN2=0
"RTN","PSJORRN",15,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRN",16,0)
 ; *225 Add time or base on now
"RTN","PSJORRN",17,0)
 D NOW^%DTC S:BDT="" BDT=% S:BDT'["." BDT=BDT_".000001"
"RTN","PSJORRN",18,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRN",19,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRN",20,0)
 ;*225 Correct Display Calcualtion
"RTN","PSJORRN",21,0)
 S F="^PS(55,DFN,5,",WBDT=BDT F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UDTMP
"RTN","PSJORRN",22,0)
 S F="^PS(53.1," F PST="P","N" S ON=0 F  S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRN",23,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  S ON=0 F  S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IVTMP
"RTN","PSJORRN",24,0)
 S X1="" F  S X1=$O(^TMP("PSJTMP",$J,X1)) Q:X1=""  S X2="" F  S X2=$O(^TMP("PSJTMP",$J,X1,X2)) Q:X2=""  D
"RTN","PSJORRN",25,0)
 .S X3="" F  S X3=$O(^TMP("PSJTMP",$J,X1,X2,X3)) Q:X3=""  S X4="" F  S X4=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4)) Q:X4=""  D
"RTN","PSJORRN",26,0)
 ..S X5="" F  S X5=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4,X5)) Q:X5=""  S TFN=$G(TFN)+1 D
"RTN","PSJORRN",27,0)
 ...; The merge below sends the proper ^TMP("PS",$J structure back to the calling
"RTN","PSJORRN",28,0)
 ...; routine PSJORRE
"RTN","PSJORRN",29,0)
 ...M ^TMP("PS",$J,TFN)=^TMP("PSJTMP",$J,X1,X2,X3,X4,X5) S ^TMP("PS",$J,"PC",0)=TFN
"RTN","PSJORRN",30,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSJORRN",31,0)
 Q
"RTN","PSJORRN",32,0)
 ;
"RTN","PSJORRN",33,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRN",34,0)
 N PROVIDER,ND8,RNWDT,EDTCMPLX,NDP2,PSJOINM,PSJOI,PSJDDNM,LOC,PRIO,NDDSS
"RTN","PSJORRN",35,0)
 S (MR,SCH,INST,PON,NDDSS)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRN",36,0)
 D TYPE
"RTN","PSJORRN",37,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN",38,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8),PRIO=$P(NDP2,"^",4)
"RTN","PSJORRN",39,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRN",40,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRN",41,0)
 S ND8=$G(@(F_ON_",8)")),NDP2=$P($G(@(F_ON_",.2)")),"^")
"RTN","PSJORRN",42,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRN",43,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN",44,0)
 S:ND6["Instructions too long. See Order View or BCMA for full text" ND6="Instructions too long. See order details for full text."
"RTN","PSJORRN",45,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRN",46,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRN",47,0)
 ;*225 Don't allow 0 Units
"RTN","PSJORRN",48,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(+UNITS=0) UNITS=1
"RTN","PSJORRN",49,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRN",50,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRN",51,0)
 ;******** GUI 27 new sort for Meds Tab
"RTN","PSJORRN",52,0)
 I F[53.1 S NDDSS=$G(@(F_ON_",""DSS"")")),LOC=$P(NDDSS,"^")
"RTN","PSJORRN",53,0)
 S:F'[53.1 LOC=$P(ND8,"^") S LOC=$S($P($G(NDDSS),"^",2):LOC,1:"~") I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN",54,0)
 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRN",55,0)
 S GP=$S((",A,R,H,RE,")[(","_PSJST_","):1,(",P,N,")[(","_PSJST_","):2,PSJST="E":3,(",D,DE,DR,")[(","_PSJST_","):4,1:0)
"RTN","PSJORRN",56,0)
 S PSJST2=$S(PSJST="A":1,PSJST="R":2,PSJST="H":3,PSJST="S":4,PSJST="P":5,PSJST="O":6,PSJST="N":7,PSJST="I":8,PSJST="P":9,GP=4&($G(PRIO)="D"):10,PSJST="E":11,PSJST="D":12,PSJST="DE":13,PSJST="RE":14,PSJST="R":15,1:0)
"RTN","PSJORRN",57,0)
 S PSJOI=$P(NDP2,"^"),PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRN",58,0)
 ;*******
"RTN","PSJORRN",59,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRN",60,0)
 S CNT=0,PSJOINM=$S(PSJOINM]"":PSJOINM,1:"UNKNOWN")
"RTN","PSJORRN",61,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRN",62,0)
 K ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN",63,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRN",64,0)
 I PROVIDER S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN",65,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN",66,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRN",67,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN",68,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRN",69,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",1,0)=ND6
"RTN","PSJORRN",70,0)
 Q
"RTN","PSJORRN",71,0)
 ;
"RTN","PSJORRN",72,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRN",73,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PRIO,LOC,NDDSS
"RTN","PSJORRN",74,0)
 S (PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PRIO,LOC,NDDSS)=""
"RTN","PSJORRN",75,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8),PRIO=$P(NDP2,"^",4)
"RTN","PSJORRN",76,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRN",77,0)
 D TYPE
"RTN","PSJORRN",78,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),TFN2=TFN2+1,CNT=0
"RTN","PSJORRN",79,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN",80,0)
 ;******** GUI 27 new sort for Meds Tab
"RTN","PSJORRN",81,0)
 S NDDSS=$G(@(F_ON_",""DSS"")")),NDP2=$G(@(F_ON_",.2)"))
"RTN","PSJORRN",82,0)
 S PSJOI=$P(NDP2,"^")
"RTN","PSJORRN",83,0)
 I F[53.1 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRN",84,0)
 I F'[53.1 S PSJST=$P(ND0,"^",17)
"RTN","PSJORRN",85,0)
 S GP=$S((",A,R,H,RE,")[(","_PSJST_","):1,(",P,N,")[(","_PSJST_","):2,PSJST="E":3,(",D,DE,DR,")[(","_PSJST_","):4,1:0)
"RTN","PSJORRN",86,0)
 S PSJST2=$S(PSJST="A":1,PSJST="R":2,PSJST="H":3,PSJST="S":4,PSJST="P":5,PSJST="O":6,PSJST="N":7,PSJST="I":8,PSJST="P":9,GP=4&($G(PRIO)="D"):10,PSJST="E":11,PSJST="D":12,PSJST="DE":13,PSJST="RE":14,PSJST="R":15,1:0)
"RTN","PSJORRN",87,0)
 S LOC=$P(NDDSS,"^") S LOC=$S($P(NDDSS,"^",2):LOC,1:"~") I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN",88,0)
 I PSJOI'="" S PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRN",89,0)
 I PSJOI="" S PSJOINM="Orderable Item Not Found"
"RTN","PSJORRN",90,0)
 ;********
"RTN","PSJORRN",91,0)
 S CNT=0,PSJOINM=$S(PSJOINM]"":PSJOINM,1:"UNKNOWN")
"RTN","PSJORRN",92,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"A",CNT,0)=Y
"RTN","PSJORRN",93,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"A",0)=CNT,CNT=0
"RTN","PSJORRN",94,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRN",95,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"B",0)=CNT
"RTN","PSJORRN",96,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRN",97,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRN",98,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRN",99,0)
 S:($G(SIO)["Instructions too long. See Order View or BCMA for full text") SIO="Instructions too long. See order details for full text."
"RTN","PSJORRN",100,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRN",101,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRN",102,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN",103,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRN",104,0)
 K ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN",105,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRN",106,0)
 I PROVIDER S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN",107,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRN",108,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRN",109,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN",110,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN",111,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SCH",1,0)=SCH
"RTN","PSJORRN",112,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"ADM",1,0)=ADM
"RTN","PSJORRN",113,0)
 S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"SIO",1,0)=SIO
"RTN","PSJORRN",114,0)
 I $G(IVLIM)]"" S ^TMP("PSJTMP",$J,GP,PSJST,LOC,PSJOINM,TFN2,"IVLIM",0)=IVLIM
"RTN","PSJORRN",115,0)
 Q
"RTN","PSJORRN",116,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRN",117,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRN",118,0)
 Q X
"RTN","PSJORRN",119,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRN",120,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRN",121,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRN",122,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRN",123,0)
 Q
"RTN","PSJORRN1")
0^12^B61358484^B57655173
"RTN","PSJORRN1",1,0)
PSJORRN1 ;BIR/JCH-RETURN INPATIENT MEDS (CONDENSED) SECOND 'NEW' SORT ; 3/21/11 2:54pm
"RTN","PSJORRN1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**134,213,225,275**;16 DEC 97;Build 157
"RTN","PSJORRN1",3,0)
 ;
"RTN","PSJORRN1",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRN1",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRN1",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRN1",7,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRN1",8,0)
 ;Reference to ^SC is documented in DBIA #10040.
"RTN","PSJORRN1",9,0)
 ;Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJORRN1",10,0)
 ;
"RTN","PSJORRN1",11,0)
 ; return condensed list of inpat meds with Alpha Primary Sort
"RTN","PSJORRN1",12,0)
OCL(DFN,BDT,EDT,TFN) ; Execute this section if MVIEW=1
"RTN","PSJORRN1",13,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A,TFN2,PSJOTYP,PSJNOW,PSJ30DAY,%
"RTN","PSJORRN1",14,0)
 S TFN2=TFN,PSJNOW=$$DATE^PSJUTL2(),PSJ30DAY=$$FMADD^XLFDT(PSJNOW,-30) S $P(PSJ30DAY,".",2)="000001"
"RTN","PSJORRN1",15,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRN1",16,0)
 ; *225 Add time or base on now
"RTN","PSJORRN1",17,0)
 D NOW^%DTC S:BDT="" BDT=% S:BDT'["." BDT=BDT_".000001" S WBDT=BDT S:WBDT<PSJ30DAY WBDT=PSJ30DAY
"RTN","PSJORRN1",18,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRN1",19,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRN1",20,0)
 ;*225 Correct Display Calcualtion
"RTN","PSJORRN1",21,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S PSJOTYP="D" D UDTMP
"RTN","PSJORRN1",22,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) S PSJOTYP=$S(PST="P":"P1",1:"P2") D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRN1",23,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S PSJOTYP="V" D IVTMP
"RTN","PSJORRN1",24,0)
 S X1="" F  S X1=$O(^TMP("PSJTMP",$J,X1)) Q:X1=""  S X2="" F  S X2=$O(^TMP("PSJTMP",$J,X1,X2)) Q:X2=""  S X3="" F  S X3=$O(^TMP("PSJTMP",$J,X1,X2,X3)) Q:X3=""  D
"RTN","PSJORRN1",25,0)
 .S X4="" F  S X4=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4)) Q:X4=""  D
"RTN","PSJORRN1",26,0)
 ..; The merge below sends the proper ^TMP("PS",$J structure back to the calling routine PSJORRE
"RTN","PSJORRN1",27,0)
 ..S TFN=$G(TFN)+1 M ^TMP("PS",$J,TFN)=^TMP("PSJTMP",$J,X1,X2,X3,X4) S ^TMP("PS",$J,"PC",0)=TFN
"RTN","PSJORRN1",28,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSJORRN1",29,0)
 Q
"RTN","PSJORRN1",30,0)
 ;
"RTN","PSJORRN1",31,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRN1",32,0)
 N PROVIDER,RNWDT,EDTCMPLX,NDP2,PSJSTP,PSJLOC,PSJST2,NDDSS
"RTN","PSJORRN1",33,0)
 S (MR,SCH,INST,PON,NDDSS)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRN1",34,0)
 I $E($G(PSJOTYP))="P",'$G(WBDT) S WBDT=+ON
"RTN","PSJORRN1",35,0)
 D TYPE S PSJLOC=$S($G(PSJCLIN):$P($G(^SC(+PSJCLIN,0)),"^"),1:"zzz")
"RTN","PSJORRN1",36,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN1",37,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRN1",38,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRN1",39,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRN1",40,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRN1",41,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN1",42,0)
 S:ND6["Instructions too long. See Order View or BCMA for full text" ND6="Instructions too long. See order details for full text."
"RTN","PSJORRN1",43,0)
 S ND8=$P($G(@(F_ON_",8)")),"^")
"RTN","PSJORRN1",44,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRN1",45,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRN1",46,0)
 ;*225 Don't allow 0 Units
"RTN","PSJORRN1",47,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(+UNITS=0) UNITS=1
"RTN","PSJORRN1",48,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRN1",49,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRN1",50,0)
 ;******** GUI 27 New sort format #2 for Meds Tab
"RTN","PSJORRN1",51,0)
 I F[53.1 S NDDSS=$G(@(F_ON_",""DSS"")")),LOC=$P(NDDSS,"^")
"RTN","PSJORRN1",52,0)
 S:F'[53.1 LOC=$P(ND8,"^") S LOC=$S(LOC]"":LOC,1:"~") I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN1",53,0)
 ;PSJ*5*225 include HOLD orders
"RTN","PSJORRN1",54,0)
 S PSJST=$P(ND0,"^",9) S PSJST2=$S(PSJST="A":1,PSJST="E":2,PSJST="H":3,1:"") Q:'PSJST2
"RTN","PSJORRN1",55,0)
 S PSJOI=$P(NDP2,"^"),PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRN1",56,0)
 S PSJSTP=+$P(ND2,"^",4)
"RTN","PSJORRN1",57,0)
 ;********
"RTN","PSJORRN1",58,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRN1",59,0)
 S DN(1)=$S($G(DN(1))="":"UNKNOWN",1:DN(1))
"RTN","PSJORRN1",60,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRN1",61,0)
 K ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN1",62,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRN1",63,0)
 I PROVIDER S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN1",64,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN1",65,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRN1",66,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN1",67,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRN1",68,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",1,0)=ND6
"RTN","PSJORRN1",69,0)
 Q
"RTN","PSJORRN1",70,0)
 ;
"RTN","PSJORRN1",71,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRN1",72,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PSJLOC,NDDSS
"RTN","PSJORRN1",73,0)
 S (PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PSJLOC,NDDSS)=""
"RTN","PSJORRN1",74,0)
 I $E($G(PSJOTYP))="P",'$G(WBDT) S WBDT=+ON
"RTN","PSJORRN1",75,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRN1",76,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRN1",77,0)
 D TYPE S PSJLOC=$S($G(PSJCLIN):$P($G(^SC(+PSJCLIN,0)),"^"),1:"zzz")
"RTN","PSJORRN1",78,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),CNT=0
"RTN","PSJORRN1",79,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRN1",80,0)
 ;******** GUI 27 old sort, new format for Meds Tab
"RTN","PSJORRN1",81,0)
 S NDDSS=$G(@(F_ON_",""DSS"")")),NDP2=$G(@(F_ON_",.2)"))
"RTN","PSJORRN1",82,0)
 S PSJOI=$P(NDP2,"^"),PSJST=""
"RTN","PSJORRN1",83,0)
 I F[53.1 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRN1",84,0)
 I F'[53.1 S PSJST=$P(ND0,"^",17)
"RTN","PSJORRN1",85,0)
 ;PSJ*5*225 include HOLD orders
"RTN","PSJORRN1",86,0)
 S PSJST2=$S(PSJST="A":1,PSJST="E":2,PSJST="H":3,1:"") Q:'PSJST2
"RTN","PSJORRN1",87,0)
 S LOC=$P(NDDSS,"^") S LOC=$S(LOC]"":LOC,1:"~")  I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRN1",88,0)
 I PSJOI'="" S PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRN1",89,0)
 I PSJOI="" S PSJOINM="Orderable Item Not Found"
"RTN","PSJORRN1",90,0)
 S PSJSTP=$P(ND0,"^",3)
"RTN","PSJORRN1",91,0)
 ;********
"RTN","PSJORRN1",92,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRN1",93,0)
 S DN(1)=$S($G(DN(1))="":"UNKNOWN",1:DN(1)),CNT=0
"RTN","PSJORRN1",94,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,DN(CNT)=Y S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"A",CNT,0)=Y
"RTN","PSJORRN1",95,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"A",0)=CNT,CNT=0
"RTN","PSJORRN1",96,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRN1",97,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"B",0)=CNT
"RTN","PSJORRN1",98,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRN1",99,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRN1",100,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRN1",101,0)
 S:($G(SIO)["Instructions too long. See Order View or BCMA for full text") SIO="Instructions too long. See order details for full text."
"RTN","PSJORRN1",102,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRN1",103,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRN1",104,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRN1",105,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRN1",106,0)
 K ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRN1",107,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRN1",108,0)
 I PROVIDER S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRN1",109,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRN1",110,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRN1",111,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"MDR",1,0)=MR
"RTN","PSJORRN1",112,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIG",1,0)=INST
"RTN","PSJORRN1",113,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SCH",1,0)=SCH
"RTN","PSJORRN1",114,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"ADM",1,0)=ADM
"RTN","PSJORRN1",115,0)
 S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"SIO",1,0)=SIO
"RTN","PSJORRN1",116,0)
 I $G(IVLIM)]"" S ^TMP("PSJTMP",$J,DN(1),PSJST2,WBDT,TFN2,"IVLIM",0)=IVLIM
"RTN","PSJORRN1",117,0)
 Q
"RTN","PSJORRN1",118,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRN1",119,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRN1",120,0)
 Q X
"RTN","PSJORRN1",121,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRN1",122,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRN1",123,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRN1",124,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRN1",125,0)
 Q
"RTN","PSJORRO")
0^13^B67615979^B63875984
"RTN","PSJORRO",1,0)
PSJORRO ;BIR/MV-RETURN INPATIENT MEDS (CONDENSED) OLD SORT ; 2/28/11 3:27pm
"RTN","PSJORRO",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**134,213,225,275**;16 DEC 97;Build 157
"RTN","PSJORRO",3,0)
 ;
"RTN","PSJORRO",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRO",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRO",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRO",7,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRO",8,0)
 ;Reference to ^SC is documented in DBIA #10040.
"RTN","PSJORRO",9,0)
 ;Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSJORRO",10,0)
 ;
"RTN","PSJORRO",11,0)
 ; return condensed list of inpat meds
"RTN","PSJORRO",12,0)
OCL(DFN,BDT,EDT,TFN) ; Execute this section if MVIEW=1
"RTN","PSJORRO",13,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y,PSJCLIN,A,TFN2,PSJOTYP,%
"RTN","PSJORRO",14,0)
 S TFN2=TFN
"RTN","PSJORRO",15,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRO",16,0)
 ;*225 Add time or use now
"RTN","PSJORRO",17,0)
 D NOW^%DTC S:BDT="" BDT=% S:BDT'["." BDT=BDT_".000001"
"RTN","PSJORRO",18,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRO",19,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRO",20,0)
 ;*225 Use Correct Start
"RTN","PSJORRO",21,0)
 S F="^PS(55,DFN,5,",WBDT=BDT F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S PSJOTYP="D" D UDTMP
"RTN","PSJORRO",22,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) S PSJOTYP=$S(PST="P":"P1",1:"P2") D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRO",23,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S PSJOTYP="V" D IVTMP
"RTN","PSJORRO",24,0)
 S X1="" F  S X1=$O(^TMP("PSJTMP",$J,X1)) Q:X1=""  S X2="" F  S X2=$O(^TMP("PSJTMP",$J,X1,X2)) Q:X2=""  S X3="" F  S X3=$O(^TMP("PSJTMP",$J,X1,X2,X3)) Q:X3=""  D
"RTN","PSJORRO",25,0)
 .S X4="" F  S X4=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4)) Q:X4=""  S X5="" F  S X5=$O(^TMP("PSJTMP",$J,X1,X2,X3,X4,X5)) Q:X5=""  D
"RTN","PSJORRO",26,0)
 ..; The merge below sends the proper ^TMP("PS",$J structure back to the calling routine PSJORRE
"RTN","PSJORRO",27,0)
 ..S TFN=$G(TFN)+1 M ^TMP("PS",$J,TFN)=^TMP("PSJTMP",$J,X1,X2,X3,X4,X5) S ^TMP("PS",$J,"PC",0)=TFN
"RTN","PSJORRO",28,0)
 K ^TMP("PSJTMP",$J)
"RTN","PSJORRO",29,0)
 Q
"RTN","PSJORRO",30,0)
 ;
"RTN","PSJORRO",31,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRO",32,0)
 N PROVIDER,RNWDT,EDTCMPLX,NDP2,PSJSTP,PSJLOC,NDDSS
"RTN","PSJORRO",33,0)
 S (PROVIDER,RNWDT,EDTCMPLX,NDP2,PSJSTP,PSJLOC,NDDSS)=""
"RTN","PSJORRO",34,0)
 S (MR,SCH,INST,PON)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRO",35,0)
 I $E($G(PSJOTYP))="P",'$G(WBDT) S WBDT=+ON
"RTN","PSJORRO",36,0)
 D TYPE S PSJLOC=$S($G(PSJCLIN):$P($G(^SC(+PSJCLIN,0)),"^"),1:"zzz")
"RTN","PSJORRO",37,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRO",38,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRO",39,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRO",40,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRO",41,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRO",42,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRO",43,0)
 S:ND6["Instructions too long. See Order View or BCMA for full text" ND6="Instructions too long. See order details for full text."
"RTN","PSJORRO",44,0)
 S ND8=$P($G(@(F_ON_",8)")),"^")
"RTN","PSJORRO",45,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRO",46,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRO",47,0)
 ;*225 Don't allow 0 Units
"RTN","PSJORRO",48,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(+UNITS=0) UNITS=1
"RTN","PSJORRO",49,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRO",50,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRO",51,0)
 ;******** GUI 27 old sort, new format for Meds Tab
"RTN","PSJORRO",52,0)
 I F[53.1 S NDDSS=$G(@(F_ON_",""DSS"")")),LOC=$P(NDDSS,"^")
"RTN","PSJORRO",53,0)
 S:F'[53.1 LOC=$P(ND8,"^") S LOC=$S(LOC]"":LOC,1:"~") I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRO",54,0)
 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRO",55,0)
 S GP=$S((",A,H,")[(","_PSJST_","):2,(",P,N,")[(","_PSJST_","):1,PSJST="E":3,(",DE,DR,D,RE,R,")[(","_PSJST_","):4,1:0)
"RTN","PSJORRO",56,0)
 S PSJST2=$S(PSJST="A":1,PSJST="R":2,PSJST="H":3,PSJST="S":4,PSJST="P":5,PSJST="O":6,PSJST="N":7,PSJST="I":8,PSJST="P":9,GP=4&($G(PRIO)="D"):10,PSJST="E":11,PSJST="D":12,PSJST="DE":13,PSJST="RE":14,PSJST="R":15,1:0)
"RTN","PSJORRO",57,0)
 S PSJOI=$P(NDP2,"^"),PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRO",58,0)
 S PSJSTP=+$P(ND2,"^",4)
"RTN","PSJORRO",59,0)
 ;********
"RTN","PSJORRO",60,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRO",61,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRO",62,0)
 K ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRO",63,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRO",64,0)
 I PROVIDER S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRO",65,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"MDR",1,0)=MR
"RTN","PSJORRO",66,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRO",67,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIG",1,0)=INST
"RTN","PSJORRO",68,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRO",69,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIO",1,0)=ND6
"RTN","PSJORRO",70,0)
 Q
"RTN","PSJORRO",71,0)
 ;
"RTN","PSJORRO",72,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRO",73,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2,IVLIM,PSJLOC
"RTN","PSJORRO",74,0)
 I $E($G(PSJOTYP))="P",'$G(WBDT) S WBDT=+ON
"RTN","PSJORRO",75,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRO",76,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRO",77,0)
 D TYPE S PSJLOC=$S($G(PSJCLIN):$P($G(^SC(+PSJCLIN,0)),"^"),1:"zzz")
"RTN","PSJORRO",78,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),CNT=0
"RTN","PSJORRO",79,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRO",80,0)
 ;******** GUI 27 old sort, new format for Meds Tab
"RTN","PSJORRO",81,0)
 S NDDSS=$G(@(F_ON_",""DSS"")")),NDP2=$G(@(F_ON_",.2)"))
"RTN","PSJORRO",82,0)
 S PSJOI=$P(NDP2,"^")
"RTN","PSJORRO",83,0)
 I F[53.1 S PSJST=$P(ND0,"^",9)
"RTN","PSJORRO",84,0)
 I F'[53.1 S PSJST=$P(ND0,"^",17)
"RTN","PSJORRO",85,0)
 S GP=$S((",A,H,")[(","_PSJST_","):2,(",P,N,")[(","_PSJST_","):1,PSJST="E":3,(",DE,DR,D,RE,R,")[(","_PSJST_","):4,1:0)
"RTN","PSJORRO",86,0)
 S PSJST2=$S(PSJST="A":1,PSJST="R":2,PSJST="H":3,PSJST="S":4,PSJST="P":5,PSJST="O":6,PSJST="N":7,PSJST="I":8,PSJST="P":9,GP=4&($G(PRIO)="D"):10,PSJST="E":11,PSJST="D":12,PSJST="DE":13,PSJST="RE":14,PSJST="R":15,1:0)
"RTN","PSJORRO",87,0)
 S LOC=$P(NDDSS,"^") S LOC=$S(LOC]"":LOC,1:"~")  I LOC S LOC=$P($G(^SC(LOC,0)),"^")
"RTN","PSJORRO",88,0)
 I PSJOI="" S PSJOINM="Orderable Item Not Found"
"RTN","PSJORRO",89,0)
 I PSJOI'="" S PSJOINM=$P($G(^PS(50.7,+PSJOI,0)),"^")
"RTN","PSJORRO",90,0)
 S PSJSTP=$P(ND0,"^",3)
"RTN","PSJORRO",91,0)
 ;********
"RTN","PSJORRO",92,0)
 S TFN2=$G(TFN2)+1
"RTN","PSJORRO",93,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"A",CNT,0)=Y
"RTN","PSJORRO",94,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"A",0)=CNT,CNT=0
"RTN","PSJORRO",95,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRO",96,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"B",0)=CNT
"RTN","PSJORRO",97,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRO",98,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRO",99,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRO",100,0)
 S:($G(SIO)["Instructions too long. See Order View or BCMA for full text") SIO="Instructions too long. See order details for full text."
"RTN","PSJORRO",101,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRO",102,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRO",103,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRO",104,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRO",105,0)
 K ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"CLINIC",0) I PSJCLIN]"" S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"CLINIC",0)=PSJCLIN
"RTN","PSJORRO",106,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRO",107,0)
 I PROVIDER S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRO",108,0)
 S ND2P5=$G(@(F_+ON_",2.5)")) S IVLIM=$P(ND2P5,U,4) I $E(IVLIM)="a" S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJORRO",109,0)
 I IVLIM="" S IVLIM=$P(ND2P5,U,2) S:(IVLIM'["d")&(IVLIM'["h") IVLIM=""
"RTN","PSJORRO",110,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"MDR",0)=MR]"" S:MR]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"MDR",1,0)=MR
"RTN","PSJORRO",111,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIG",0)=INST]"" S:INST]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIG",1,0)=INST
"RTN","PSJORRO",112,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SCH",1,0)=SCH
"RTN","PSJORRO",113,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"ADM",1,0)=ADM
"RTN","PSJORRO",114,0)
 S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"SIO",1,0)=SIO
"RTN","PSJORRO",115,0)
 I $G(IVLIM)]"" S ^TMP("PSJTMP",$J,PSJLOC,GP,PSJST,WBDT,TFN2,"IVLIM",0)=IVLIM
"RTN","PSJORRO",116,0)
 Q
"RTN","PSJORRO",117,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRO",118,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRO",119,0)
 Q X
"RTN","PSJORRO",120,0)
TYPE ;determine if this is an IMO order or not
"RTN","PSJORRO",121,0)
 S (A,PSJCLIN)="" I F["PS(53.1" S A=$G(^PS(53.1,ON,"DSS"))
"RTN","PSJORRO",122,0)
 I F["PS(55" S A=$S(F["IV":$G(^PS(55,DFN,"IV",ON,"DSS")),1:$G(^PS(55,DFN,5,ON,8)))
"RTN","PSJORRO",123,0)
 I $P(A,"^",2)'="" S PSJCLIN=+A
"RTN","PSJORRO",124,0)
 Q
"RTN","PSJP")
0^6^B26835871^B21519406
"RTN","PSJP",1,0)
PSJP ;BIR/CML3-INPATIENT LOOK-UP ; 15 Apr 98 / 9:05 AM
"RTN","PSJP",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**10,53,60,181,273,267,275**;16 DEC 97;Build 157
"RTN","PSJP",3,0)
 ;
"RTN","PSJP",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJP",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSJP",6,0)
 ; Reference to ^%ZIS is supported by DBIA 10086
"RTN","PSJP",7,0)
 ; Reference to ^DICN is supported by DBIA 10009
"RTN","PSJP",8,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSJP",9,0)
 ; Reference to ^VADPT is supported by DBIA 10061
"RTN","PSJP",10,0)
 ;
"RTN","PSJP",11,0)
ENDPT ; get any patient
"RTN","PSJP",12,0)
 K DIC,PSGP,Y W !!,"Select "_$S($D(PSGDICA):PSGDICA_" ",1:"")_"PATIENT: " R X:DTIME S:'$T X="^" W:'$T $C(7) I "^"[X S (Y,PSGP)=-1 S QFLG=1 G DONE
"RTN","PSJP",13,0)
 D EN^PSJDPT
"RTN","PSJP",14,0)
 I Y'>0 G ENDPT
"RTN","PSJP",15,0)
 K DIC
"RTN","PSJP",16,0)
 ;
"RTN","PSJP",17,0)
CHK ;
"RTN","PSJP",18,0)
 ;Clean out arrays use in order checks
"RTN","PSJP",19,0)
 K PSJEXCPT,PSJOCER
"RTN","PSJP",20,0)
 S (DFN,PSGP)=+Y,VA200=1 D INP^VADPT
"RTN","PSJP",21,0)
 I 'VAIN(4) D DEM^VADPT S PSGP(0)=VADM(1),PSJPWD="",PSJPWDN=""
"RTN","PSJP",22,0)
 I VAIN(4),$G(PSJCLOR) W $C(7),!!?3,"PATIENT IS CURRENTLY ADMITTED TO ",$P(VAIN(4),"^",2) S PSJPDD=""
"RTN","PSJP",23,0)
 I VAIN(4) S PSJPCAF=1_"^"_VAIN(1),PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),PSJPTS=+VAIN(3),PSJPTSP=+VAIN(2),PSJPRB=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPTD=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",4),1:""),PSJPDD="" G CNV
"RTN","PSJP",24,0)
 S PSJPCAF="",VAIP("D")="L" D IN5^VADPT
"RTN","PSJP",25,0)
 I 'VAIP(13,1),'$G(PSJCLOR) W $C(7),!!?3,"PATIENT HAS NEVER BEEN ADMITTED." D ENCONT G:%'=1 ENDPT S PSJPDD=""
"RTN","PSJP",26,0)
 ;*273 - Recognize patient death not from discharge
"RTN","PSJP",27,0)
 D DEM^VADPT
"RTN","PSJP",28,0)
 S PSGID=$S($G(VADM(6))]"":+VADM(6),1:+VAIP(3)),X=+VAIP(4)=12!(+VAIP(4)=38)!($G(VADM(6))),PSGOD=$$ENDTC^PSGMI(PSGID)
"RTN","PSJP",29,0)
 I $S(X:1,1:VAIP(13,1))  Q:($G(PSJCLOR)&'(X))  W $C(7),!!?3,"PATIENT IS FOUND TO BE ",$P("DISCHARGED^DECEASED","^",X+1)," AS OF ",PSGOD,"." S PSJH=$S(X:2,1:3),PSJPDD=PSGID_"^"_PSGOD S:X PSJPDD=PSJPDD_"^1" D ENCONT G:%'=1 ENDPT
"RTN","PSJP",30,0)
 S PSJPAD=VAIP(13,1),PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),PSJPRB=$P(VAIP(6),"^",2),PSJPTSP=+VAIP(7),PSJPTS=+VAIP(8),PSJPDX=VAIP(9),PSJPTD=""
"RTN","PSJP",31,0)
 ;
"RTN","PSJP",32,0)
CNV ;
"RTN","PSJP",33,0)
 I $G(DFN) I '$$AA^PSJDPT(DFN) S Y=-1 G ENDPT
"RTN","PSJP",34,0)
 I $D(PSJEXTP) W ! K DIR S DIR(0)="DO",DIR("A")="Date to start searching from (optional)",DIR("?")="Enter a date to start searching from, or <RETURN> for all orders" D ^DIR S PSJHDATE=Y K DIR
"RTN","PSJP",35,0)
 D DEM^VADPT,PID^VADPT,HTWT^PSJAC(DFN)
"RTN","PSJP",36,0)
 S PSGP(0)=VADM(1),PSJPSSN=VADM(2),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID"),PSJPBID=VA("BID")
"RTN","PSJP",37,0)
 F X="PSJPAD","PSJPDOB","PSJPTD" I @X S $P(@X,"^",2)=$$ENDTC^PSGMI(+@X)
"RTN","PSJP",38,0)
 ;
"RTN","PSJP",39,0)
WP ; ward parameters
"RTN","PSJP",40,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD) S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJP",41,0)
 ; *OLD CODE* S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$P(PSJSYSW0,"^",X*4+12)
"RTN","PSJP",42,0)
 S PSJSYSL="",X=$P(PSJSYSU,";",3)>1,PSJSYSL=$S(X=0:$P(PSJSYSW0,"^",12),1:$P(PSJSYSW0,"^",16))
"RTN","PSJP",43,0)
 S PSJDCEXP=$$RECDCEXP()
"RTN","PSJP",44,0)
 I PSJSYSL D
"RTN","PSJP",45,0)
 .S:X X='$P(PSJSYSP0,"^",10) S IOP=$S($P(PSJSYSP0,"^",13)]"":$P(PSJSYSP0,"^",13),$P(PSJSYSW0,"^",19+X)]"":$P(PSJSYSW0,"^",19+X),1:"") I IOP]"" D
"RTN","PSJP",46,0)
 ..S IOP="`"_IOP K %ZIS S %ZIS="NQ" D ^%ZIS S:'POP $P(PSJSYSL,"^",2,3)=ION_"^"_IO D HOME^%ZIS
"RTN","PSJP",47,0)
 ;
"RTN","PSJP",48,0)
DONE ;
"RTN","PSJP",49,0)
 K DA,DIC,NB,ND,NS,PSGID,PSGOD,VA200,VAIP,VAMT,X,Y(0),Y(0,0),QFLG Q
"RTN","PSJP",50,0)
 ;
"RTN","PSJP",51,0)
ENCONT ;
"RTN","PSJP",52,0)
 I $D(PSGH) S %=1 Q
"RTN","PSJP",53,0)
 F FQ=0:0 W !!,"Do you wish to continue with this patient" S %=0 D YN^DICN Q:%  W:%Y'?1."?" $C(7) W "  (A 'YES' or 'NO' response is required.)" D:%Y?1."?" @("CH"_PSJH)
"RTN","PSJP",54,0)
 S:%'=1 Y=-1 Q
"RTN","PSJP",55,0)
 ;
"RTN","PSJP",56,0)
CH1 ;
"RTN","PSJP",57,0)
 W !!?2,"The patient selected has never been admitted to this medical facility.  You",!,"will be able to enter IV orders for this patient but NOT Unit Dose orders." Q
"RTN","PSJP",58,0)
CH2 ;
"RTN","PSJP",59,0)
 W !!?2,"This patient is shown as deceased.  You will not be able to enter orders for",!,"this patient." Q
"RTN","PSJP",60,0)
CH3 ;
"RTN","PSJP",61,0)
 W !!?2,"This patient is shown to be currently discharged.  You will be able to enter",!,"IV orders for this patient but NOT Unit Dose orders." Q
"RTN","PSJP",62,0)
 Q
"RTN","PSJP",63,0)
RECDCEXP() ;
"RTN","PSJP",64,0)
 ;Determent the Hours to display Recently DC/Expired orders on the short profile
"RTN","PSJP",65,0)
 ;Returning P1^P2
"RTN","PSJP",66,0)
 ;P1 = Number of hours defined in 59.6 or 59.7.  Set to 24 if no value set in either file.
"RTN","PSJP",67,0)
 ;P2 = Date.time from Now - P1 hours
"RTN","PSJP",68,0)
 ;
"RTN","PSJP",69,0)
 NEW PSJDCEXP,PSJWD,PSJWD1,PSJSYS,X,%
"RTN","PSJP",70,0)
 S PSJWD1=$S(+$G(PSJPWD):PSJPWD,+$G(VAIN(4)):+VAIN(4),1:0)
"RTN","PSJP",71,0)
 S:PSJWD1 X=$O(^PS(59.6,"B",PSJWD1,0))
"RTN","PSJP",72,0)
 S:+$G(X) PSJWD=$P($G(^PS(59.6,X,0)),U,33)
"RTN","PSJP",73,0)
 S PSJSYS=+$P($G(^PS(59.7,1,26)),U,8)
"RTN","PSJP",74,0)
 S PSJDCEXP=$S($G(PSJWD):PSJWD,PSJSYS:PSJSYS,1:24)
"RTN","PSJP",75,0)
 D NOW^%DTC
"RTN","PSJP",76,0)
 S X=$$FMADD^XLFDT(%,0,-PSJDCEXP,0,0)
"RTN","PSJP",77,0)
 Q PSJDCEXP_U_X
"RTN","PSJP",78,0)
 ;
"RTN","PSJP",79,0)
CLORCHK(PSJPTIEN) ; Return patient does (1) or does not (0) have any clinic orders.
"RTN","PSJP",80,0)
 N PSGP,ND,C,DN,PSGSS,Y,X,PSJPAD,TMPCLIN,DFN,PSJBEG,PSJEND,PSJDCEXP,PSJOL,PSJOS,VAIN,VADM,VAIP S TMPCLIN=""
"RTN","PSJP",81,0)
 S (DFN,PSGP,Y)=+PSJPTIEN,PSGSS="P",VA200=1 D INP^VADPT,IN5^VADPT
"RTN","PSJP",82,0)
 D NOW^%DTC S PSJBEG=$$FMADD^XLFDT(+$G(X),-3650),PSJEND=$$FMADD^XLFDT(+$G(X),3650)
"RTN","PSJP",83,0)
 D DEM^VADPT S PSJPAD=VAIP(13,1),PSJPBID=VA("BID"),PSGP(0)=VADM(1)
"RTN","PSJP",84,0)
 K ^TMP("PSJ",$J),^TMP("PSJON",$J),^TMP("PSJPRO",$J),^TMP("PSJCLOR",$J)
"RTN","PSJP",85,0)
 D EN^PSJCLOR3(3) I $D(^TMP("PSJ",$J)) K ^TMP("PSJ",$J) Q 1
"RTN","PSJP",86,0)
 I '$D(^TMP("PSJ",$J)) Q 0
"RTN","PSJP",87,0)
 Q 0
"RTN","PSJRXI")
0^48^B22320376^B20674326
"RTN","PSJRXI",1,0)
PSJRXI ;IHS/DSD/JCM/RLW-LOGS PHARMACY INTERVENTIONS ; 15 May 98 / 9:28 AM
"RTN","PSJRXI",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**3,181,254,267,275**;16 DEC 97;Build 157
"RTN","PSJRXI",3,0)
 ;
"RTN","PSJRXI",4,0)
 ; Reference to ^APSPQA(32.4 is supported by DBIA #2179
"RTN","PSJRXI",5,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192
"RTN","PSJRXI",6,0)
 ;
"RTN","PSJRXI",7,0)
 ; This routine is used to create entries in the APSP INTERVENTION file.
"RTN","PSJRXI",8,0)
 ;---------------------------------------------------------------
"RTN","PSJRXI",9,0)
START ;   
"RTN","PSJRXI",10,0)
 N SAVEX,SAVEY S SAVEX=X,SAVEY=Y
"RTN","PSJRXI",11,0)
 D INIT
"RTN","PSJRXI",12,0)
 D DIC G:PSJRXI("QFLG") END
"RTN","PSJRXI",13,0)
 D EDIT
"RTN","PSJRXI",14,0)
 S:'$D(PSJNEW("PROVIDER")) PSJNEW("PROVIDER")=$P(^APSPQA(32.4,PSJRXI("DA"),0),"^",3)
"RTN","PSJRXI",15,0)
END D EOJ
"RTN","PSJRXI",16,0)
 Q
"RTN","PSJRXI",17,0)
 ;---------------------------------------------------------------
"RTN","PSJRXI",18,0)
INIT ;
"RTN","PSJRXI",19,0)
 W !!,"Now creating Pharmacy Intervention",!
"RTN","PSJRXI",20,0)
 I $G(PSJDD) W "For ",$P($G(^PSDRUG(PSJDD,0)),"^"),!
"RTN","PSJRXI",21,0)
 K PSJRXI
"RTN","PSJRXI",22,0)
 S PSJRXI("QFLG")=0
"RTN","PSJRXI",23,0)
 Q
"RTN","PSJRXI",24,0)
 ;
"RTN","PSJRXI",25,0)
DIC ;
"RTN","PSJRXI",26,0)
 N DIC,DR,DA,X,DD,DO,Y,PSJY,PSJRXIEN
"RTN","PSJRXI",27,0)
 I $G(PSJRXREQ)="" S PSJRXREQ="ALLERGY"
"RTN","PSJRXI",28,0)
 D FIND^DIC(9009032.3,"","@;.01","",PSJRXREQ,1,"B","","","PSJRXIEN")
"RTN","PSJRXI",29,0)
 S PSJRXIEN=$G(PSJRXIEN("DILIST",2,1))
"RTN","PSJRXI",30,0)
 I 'PSJRXIEN S PSJY=-1 G DICX
"RTN","PSJRXI",31,0)
 S DIC="^APSPQA(32.4,",DLAYGO=9009032.4,DIC(0)="L",X=DT
"RTN","PSJRXI",32,0)
 S DIC("DR")=".02////"_PSGP_";.04////"_DUZ_";.05////"_PSJDD_";.06///PHARMACY"
"RTN","PSJRXI",33,0)
 S DIC("DR")=DIC("DR")_";.07////"_$G(PSJRXIEN)_";.14////1"_";.16////"_$S($G(PSJSITE)]"":PSJSITE,1:"")
"RTN","PSJRXI",34,0)
 D FILE^DICN K DIC,DR,DA
"RTN","PSJRXI",35,0)
 S PSJY=Y
"RTN","PSJRXI",36,0)
 I Y>0 S PSJRXI("DA")=+Y
"RTN","PSJRXI",37,0)
 E  S PSJRXI("QFLG")=1 G DICX
"RTN","PSJRXI",38,0)
 D DIE
"RTN","PSJRXI",39,0)
DICX ;
"RTN","PSJRXI",40,0)
 I $G(PSJY)=-1 D
"RTN","PSJRXI",41,0)
 . W !!,"Unable to log an intervention for ",$G(PSJRXREQ)
"RTN","PSJRXI",42,0)
 . D PAUSE^PSJLMUT1
"RTN","PSJRXI",43,0)
 K X,Y
"RTN","PSJRXI",44,0)
 Q
"RTN","PSJRXI",45,0)
DIE ;
"RTN","PSJRXI",46,0)
 K DIE,DIC,DR,DA N PSJRECOM,PSJOVRS,PSJINTOI,PSJTMPDT
"RTN","PSJRXI",47,0)
 S DIE="^APSPQA(32.4,",DA=PSJRXI("DA"),DR=$S($G(PSJRXI("EDIT"))]"":".03:1600",$G(PSJAADPT):".03;",1:".03;.08")
"RTN","PSJRXI",48,0)
 L +^APSPQA(32.4,PSJRXI("DA")):$S($G(^DD("DILOCKTM")):+$G(^DD("DILOCKTM")),1:3) E  W !,"Sorry, someone else is editing this intervention!" Q
"RTN","PSJRXI",49,0)
 D ^DIE K DIE,DIC,DR,X,Y,DA
"RTN","PSJRXI",50,0)
 I $G(PSJAADPT) N PSJQREC S PSJQREC=0 F  Q:$G(PSJQREC)  D
"RTN","PSJRXI",51,0)
 .K DIC S PSJQREC="" S DIC="9009032.5",DIC(0)="EZ",X="UNABLE TO ASSESS" D ^DIC S:$G(Y)>0 PSJQREC=+Y I '($G(Y)>0) S DIC="9009032.5",DIC(0)="EZ",X="OTHER" D ^DIC S:$G(Y)>0 PSJQREC=+Y
"RTN","PSJRXI",52,0)
 .N DIR S DIR(0)="S^1:UNABLE TO ASSESS;2:OTHER",DIR("A")="RECOMMENDATION",DIR("?",1)="  Enter a recommendation for NO ALLERGY ASSESSMENT.",DIR("?")="    Enter 'OTHER' to add free text."
"RTN","PSJRXI",53,0)
 .D ^DIR S PSJQREC=$S(PSJQREC>0:+PSJQREC,1:0) I PSJQREC D
"RTN","PSJRXI",54,0)
 ..S DIE="^APSPQA(32.4,",DA=PSJRXI("DA"),DR=".08////"_PSJQREC D ^DIE
"RTN","PSJRXI",55,0)
 .I $G(Y)="^" S PSJQREC=-1
"RTN","PSJRXI",56,0)
 .K DIE,DIC,DR,X,Y,DA
"RTN","PSJRXI",57,0)
 I $G(PSJDD) S PSJINTOI=+$G(^PSDRUG(+PSJDD,2))
"RTN","PSJRXI",58,0)
 S PSJTMPDT=+$G(^TMP("PSJINTER",$J,+$G(PSJRXI("DA"))-1))
"RTN","PSJRXI",59,0)
 I $G(PSGDT) I $G(PSJRXREQ)="ALLERGY"!($G(PSJRXREQ)["CRITICAL DRUG") S ^TMP("PSJINTER",$J,PSJRXI("DA"))=$S($G(PSJTMPDT):PSJTMPDT,1:$G(PSGDT))_"^"_$S($G(PSJINTOI):PSJINTOI,1:"")_"^"_$$DATE2^PSJUTL2($$DATE^PSJUTL2())
"RTN","PSJRXI",60,0)
 S PSJRECOM=$P($G(^APSPQA(32.4,PSJRXI("DA"),0)),"^",8) D
"RTN","PSJRXI",61,0)
 .S PSJOVRS="",X=PSJRECOM,Y="",DIC="^APSPQA(32.5,",DIC(0)="BSX" D ^DIC I $P(Y,"^",2)]"" S PSJOVRS=$P(Y,"^",2)
"RTN","PSJRXI",62,0)
 .I PSJRECOM=9 D
"RTN","PSJRXI",63,0)
 ..S DIE="^APSPQA(32.4,",DA=PSJRXI("DA"),DR="1200;" D ^DIE K DIE,DIC,DR,X,Y,DA
"RTN","PSJRXI",64,0)
 L -^APSPQA(32.4,PSJRXI("DA"))
"RTN","PSJRXI",65,0)
 W $C(7),!!,"See 'Pharmacy Intervention Menu' if you want to delete this",!,"intervention or for more options.",! D PAUSE^PSJLMUT1
"RTN","PSJRXI",66,0)
 Q
"RTN","PSJRXI",67,0)
EDIT ;
"RTN","PSJRXI",68,0)
 K DIR W ! S DIR(0)="Y",DIR("A")="Would you like to edit this intervention",DIR("B")="N" D ^DIR K DIR I $D(DIRUT)!'Y G EDITX
"RTN","PSJRXI",69,0)
 S PSJRXI("EDIT")=1 D DIE
"RTN","PSJRXI",70,0)
 G EDIT
"RTN","PSJRXI",71,0)
EDITX K X,Y
"RTN","PSJRXI",72,0)
 Q
"RTN","PSJRXI",73,0)
 ;
"RTN","PSJRXI",74,0)
EOJ ;
"RTN","PSJRXI",75,0)
 K PSJRXI S X=SAVEX,Y=SAVEY
"RTN","PSJRXI",76,0)
 Q
"RTN","PSJRXI",77,0)
 ;
"RTN","PSJRXI",78,0)
EN1(PSJORDER) ; Entry Point if have internal rx #
"RTN","PSJRXI",79,0)
 I PSJX']"" W !,$C(7),"No prescription data" Q
"RTN","PSJRXI",80,0)
 S PSJORDER=$S((PSJORDER["N")!(PSJORDER["P"):"^PS(53.1,"_+PSJORDER,PSJORDER["V":"^PS(55,"_DFN_",""IV"","_+PSJORDER,1:"^PS(55,"_DFN_",5,"_+PSJORDER)_","
"RTN","PSJRXI",81,0)
 N PSJDFN,PSJNEW,PSJDRUG,PSJY
"RTN","PSJRXI",82,0)
 I $G(^PS(53.1,PSJX,0))']"" W !,$C(7),"No prescription data" G EN1X
"RTN","PSJRXI",83,0)
 S PSJRXI("IRXN")=PSJORDER
"RTN","PSJRXI",84,0)
 K PSJY S PSJY=@(PSJORDER_",0)")
"RTN","PSJRXI",85,0)
 S PSJDFN=$P(PSJY,"^",15),PSJNEW("PROVIDER")=$P(PSJY,"^",2)
"RTN","PSJRXI",86,0)
 S PSJDRUG=0,PSJDRUG=$O(^PS(53.1,PSJRXI("IRXN"),1,PSJDRUG)) Q:'PSJDRUG  S PSJDRUG("IEN")=$G(@(PSJORDER_","_PSJDRUG),"^")
"RTN","PSJRXI",87,0)
 D START
"RTN","PSJRXI",88,0)
EN1X Q
"VER")
8.0^22.0
"BLD",8335,6)
^246
**END**
**END**
