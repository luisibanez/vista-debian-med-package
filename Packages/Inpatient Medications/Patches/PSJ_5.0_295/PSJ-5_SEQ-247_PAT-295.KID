EMERGENCY Released PSJ*5*295 SEQ #247
Extracted from mail message
**KIDS**:PSJ*5.0*295^

**INSTALL NAME**
PSJ*5.0*295
"BLD",8544,0)
PSJ*5.0*295^INPATIENT MEDICATIONS^0^3130314^y
"BLD",8544,4,0)
^9.64PA^^
"BLD",8544,6.3)
1
"BLD",8544,"KRN",0)
^9.67PA^779.2^20
"BLD",8544,"KRN",.4,0)
.4
"BLD",8544,"KRN",.401,0)
.401
"BLD",8544,"KRN",.402,0)
.402
"BLD",8544,"KRN",.403,0)
.403
"BLD",8544,"KRN",.5,0)
.5
"BLD",8544,"KRN",.84,0)
.84
"BLD",8544,"KRN",3.6,0)
3.6
"BLD",8544,"KRN",3.8,0)
3.8
"BLD",8544,"KRN",9.2,0)
9.2
"BLD",8544,"KRN",9.8,0)
9.8
"BLD",8544,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8544,"KRN",9.8,"NM",1,0)
PSJBLDOC^^0^B43936297
"BLD",8544,"KRN",9.8,"NM","B","PSJBLDOC",1)

"BLD",8544,"KRN",19,0)
19
"BLD",8544,"KRN",19.1,0)
19.1
"BLD",8544,"KRN",101,0)
101
"BLD",8544,"KRN",409.61,0)
409.61
"BLD",8544,"KRN",771,0)
771
"BLD",8544,"KRN",779.2,0)
779.2
"BLD",8544,"KRN",870,0)
870
"BLD",8544,"KRN",8989.51,0)
8989.51
"BLD",8544,"KRN",8989.52,0)
8989.52
"BLD",8544,"KRN",8994,0)
8994
"BLD",8544,"KRN","B",.4,.4)

"BLD",8544,"KRN","B",.401,.401)

"BLD",8544,"KRN","B",.402,.402)

"BLD",8544,"KRN","B",.403,.403)

"BLD",8544,"KRN","B",.5,.5)

"BLD",8544,"KRN","B",.84,.84)

"BLD",8544,"KRN","B",3.6,3.6)

"BLD",8544,"KRN","B",3.8,3.8)

"BLD",8544,"KRN","B",9.2,9.2)

"BLD",8544,"KRN","B",9.8,9.8)

"BLD",8544,"KRN","B",19,19)

"BLD",8544,"KRN","B",19.1,19.1)

"BLD",8544,"KRN","B",101,101)

"BLD",8544,"KRN","B",409.61,409.61)

"BLD",8544,"KRN","B",771,771)

"BLD",8544,"KRN","B",779.2,779.2)

"BLD",8544,"KRN","B",870,870)

"BLD",8544,"KRN","B",8989.51,8989.51)

"BLD",8544,"KRN","B",8989.52,8989.52)

"BLD",8544,"KRN","B",8994,8994)

"BLD",8544,"QUES",0)
^9.62^^
"BLD",8544,"REQB",0)
^9.611^1^1
"BLD",8544,"REQB",1,0)
PSJ*5.0*260^2
"BLD",8544,"REQB","B","PSJ*5.0*260",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
295^3130314
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJBLDOC")
0^1^B43936297^B43930447
"RTN","PSJBLDOC",1,0)
PSJBLDOC ;BIR/MV - API to build ^TMP for prospective and PSJ profile drugs ;03 Aug 98 / 8:42 AM
"RTN","PSJBLDOC",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**181,263,260,295**;16 DEC 97;Build 1
"RTN","PSJBLDOC",3,0)
 ;
"RTN","PSJBLDOC",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJBLDOC",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJBLDOC",6,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBLDOC",7,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJBLDOC",8,0)
 ; Reference to ^PSSDSAPM is supported by DBIA# 5570.
"RTN","PSJBLDOC",9,0)
 ;
"RTN","PSJBLDOC",10,0)
IN(DFN,LIST,PDRG,PTYP) ;
"RTN","PSJBLDOC",11,0)
 ;Build the IPM profiles and the prospective drugs list for both PSO & PSJ if PDRG is passed in.
"RTN","PSJBLDOC",12,0)
 ;DFN - PATIENT DFN
"RTN","PSJBLDOC",13,0)
 ;LIST - BASE
"RTN","PSJBLDOC",14,0)
 ;PDRG - Drug array in format of PDRG(n)=IEN (#50) ^ Drug name
"RTN","PSJBLDOC",15,0)
 ;       Where n is a sequential number.  Drug name can be OI, Generic name from #50 or Additive/sol name
"RTN","PSJBLDOC",16,0)
 ;PTYP - P1;P2 where P1="I" for Inpatient & "O" for Outpatient, P2= PSJ order#
"RTN","PSJBLDOC",17,0)
 NEW PSJONCNT,PSJDCNT,PSJDRGND,PSJWON
"RTN","PSJBLDOC",18,0)
 S PSJONCNT=0
"RTN","PSJBLDOC",19,0)
 S PSJWON=$P($G(PTYP),";",2)
"RTN","PSJBLDOC",20,0)
 D PROFILE(DFN,PSJWON,PTYP)
"RTN","PSJBLDOC",21,0)
 K ^TMP($J,"PSJPRE","CLINIC")
"RTN","PSJBLDOC",22,0)
 Q
"RTN","PSJBLDOC",23,0)
PROFILE(DFN,PSJWON,PTYP)     ;Setup ^TMP for the active meds to be on the OC profile list.
"RTN","PSJBLDOC",24,0)
 ;DFN:    Patient internal entry number
"RTN","PSJBLDOC",25,0)
 ;PSJWON: The current order number being working on.  It can be null.
"RTN","PSJBLDOC",26,0)
 ;        It is the order being work on (RN, FN..) and should be on the prospective list.
"RTN","PSJBLDOC",27,0)
 ;Output: ^TMP($J,"ORDERS",PSJINX)=DRUG CLASS^NATIONAL DRUG FILE ENTRY
"RTN","PSJBLDOC",28,0)
 ;        _"A"_PSNDFA PRODUCT NAME ENTRY_DISPENSE DRUG NAME^OE/RR #
"RTN","PSJBLDOC",29,0)
 ;        _ORDER NUMBER(P/I/V)_";I"
"RTN","PSJBLDOC",30,0)
 ;
"RTN","PSJBLDOC",31,0)
 NEW BDT,COD,DDRUG,DDRUGND,EDT,F,ON,ON1,PST,WBDT,X,PSJORIEN,%,PSJCLCOD,PSJCLINF,PSJCLIND
"RTN","PSJBLDOC",32,0)
 S PSJWON=$G(PSJWON),PSJCLCOD=""
"RTN","PSJBLDOC",33,0)
 D NOW^%DTC S (BDT,WBDT)=%,EDT=9999999  ; WBDT SET THIS WAY BEFORE CLINIC OC DISPLAY ADDED
"RTN","PSJBLDOC",34,0)
 ;
"RTN","PSJBLDOC",35,0)
 ;Must display any DC/Expired clinic orders withing the last 90 days.  Active, non-verified, pending, hold clinic orders must be displayed in the clinic display format.
"RTN","PSJBLDOC",36,0)
 D CLINICS^PSJCLNOC(DFN)  ;get clinic orders for last 90 days for this patient and set ^TMP($J,"PSJPRE","CLINIC",IEN,FILE_TYPE)=""
"RTN","PSJBLDOC",37,0)
 I $D(^TMP($J,"PSJPRE","CLINIC")) S X1=BDT,X2=-90 D C^%DTC S (BDT,WBDT)=X   ;WBDT TO GET CLINIC ORDERS FOR LAST 90 DAYS
"RTN","PSJBLDOC",38,0)
 ;
"RTN","PSJBLDOC",39,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S COD=ON_"U",PSJCLCOD=2 D:COD'=PSJWON UD
"RTN","PSJBLDOC",40,0)
 S WBDT=BDT,F="^PS(53.1,",PSJCLCOD="" F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJBLDOC",41,0)
 . S COD=ON_"P" Q:COD=PSJWON!($D(PSJVFF)&(COD=$G(PSJORD)))
"RTN","PSJBLDOC",42,0)
 . I $G(PSJCOM),($G(PSJWON)["P") Q:$D(^PS(53.1,"ACX",PSJCOM,+ON))
"RTN","PSJBLDOC",43,0)
 . I $O(^PS(53.1,+ON,"AD",0))!$O(^PS(53.1,+ON,"SOL",0)) S PSJCLCOD=3 D PIV Q
"RTN","PSJBLDOC",44,0)
 . S PSJCLCOD=4
"RTN","PSJBLDOC",45,0)
 . I $$GET1^DIQ(53.1,+ON,4,"I")="I" S PSJCLCOD=5
"RTN","PSJBLDOC",46,0)
 . D UD
"RTN","PSJBLDOC",47,0)
 S WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S COD=ON_"V" S PSJCLCOD=1 D:COD'=PSJWON IV
"RTN","PSJBLDOC",48,0)
 K PSJWON
"RTN","PSJBLDOC",49,0)
 Q
"RTN","PSJBLDOC",50,0)
UD ;Get the dispense drugs for the Unit Dose orders.
"RTN","PSJBLDOC",51,0)
 NEW X,PSJQUIT,PSJCNT,DDRUG,DDRUGN,PSJX,PSJOI,PSJEXPDD,PSJUTMP,PSJEDOVR,PSJCLNX
"RTN","PSJBLDOC",52,0)
 S X=@(F_ON_",0)")
"RTN","PSJBLDOC",53,0)
 Q:$P(X,U,9)="R"
"RTN","PSJBLDOC",54,0)
 S (PSJEDOVR,PSJCLINF,PSJCLNX)=0,PSJCLNX=$P(X,U,9)
"RTN","PSJBLDOC",55,0)
 S:$D(^TMP($J,"PSJPRE","CLINIC",+ON,$S(PSJCLCOD=5:"531I",PSJCLCOD=2:"55U",1:"531U"))) PSJCLINF=1
"RTN","PSJBLDOC",56,0)
 Q:$P($G(PTYP),";",1)="O"&('$G(PSJCLINF))
"RTN","PSJBLDOC",57,0)
 Q:$P(X,U,9)["D"&('PSJCLINF)
"RTN","PSJBLDOC",58,0)
 Q:$P(X,U,9)="E"&('PSJCLINF)
"RTN","PSJBLDOC",59,0)
 S PSJORIEN=$P(X,U,21),DDRUG=0
"RTN","PSJBLDOC",60,0)
 ;
"RTN","PSJBLDOC",61,0)
 ;Use the first active DD within the order. If >1 DD, use OI_Dosage form for display name
"RTN","PSJBLDOC",62,0)
 S ON1=0,PSJCNT=0 F  S ON1=$O(@(F_ON_",1,"_ON1_")")) Q:'ON1  S PSJCNT=PSJCNT+1
"RTN","PSJBLDOC",63,0)
 S PSJOI=+$G(@(F_ON_",.2)"))
"RTN","PSJBLDOC",64,0)
 S ON1=0,PSJQUIT=0 F  S ON1=$O(@(F_ON_",1,"_ON1_")")) Q:'+ON1!PSJQUIT  S DDRUG=@(F_ON_",1,"_ON1_",0)") D
"RTN","PSJBLDOC",65,0)
 . Q:'+DDRUG
"RTN","PSJBLDOC",66,0)
 . S PSJX=$P(DDRUG,U,3)
"RTN","PSJBLDOC",67,0)
 . I 'PSJCLINF,PSJX]"",(PSJX'>BDT) Q
"RTN","PSJBLDOC",68,0)
 . D SETIN("PROFILE",$S(PSJCNT>1:$$OIDF^PSJLMUT1(+$G(PSJOI)),1:$P($G(^PSDRUG(DDRUG,0)),U)),+DDRUG,COD,PTYP,PSJCLCOD,PSJCLINF) S PSJQUIT=1
"RTN","PSJBLDOC",69,0)
 ;Quit when an active DD within the order if found
"RTN","PSJBLDOC",70,0)
 Q:+$G(PSJQUIT)
"RTN","PSJBLDOC",71,0)
 ;
"RTN","PSJBLDOC",72,0)
 ;No DD found from the order. Get one from the OI
"RTN","PSJBLDOC",73,0)
 I '+PSJOI D SETIN("PROFILE","NOT FOUND: "_COD,"",COD,1,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",74,0)
 S DDRUG=$P($$DRG^PSSDSAPM(+PSJOI,"I"),U)
"RTN","PSJBLDOC",75,0)
 I +DDRUG D SETIN("PROFILE",$S(PSJCNT>1:$$OIDF^PSJLMUT1(+$G(PSJOI)),1:$P($G(^PSDRUG(DDRUG,0)),U)),+DDRUG,COD,PTYP,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",76,0)
 ;
"RTN","PSJBLDOC",77,0)
 ;Get the first DD from OI
"RTN","PSJBLDOC",78,0)
 I '+DDRUG S DDRUG=$O(^PSDRUG("ASP",PSJOI,0)) I +DDRUG D SETIN("PROFILE",$S(PSJCNT>1:$$OIDF^PSJLMUT1(+$G(PSJOI)),1:$P($G(^PSDRUG(DDRUG,0)),U)),+DDRUG,COD,PTYP,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",79,0)
 ;
"RTN","PSJBLDOC",80,0)
 ;Set exception when no DD found
"RTN","PSJBLDOC",81,0)
 I '+DDRUG D SETIN("PROFILE",$$OIDF^PSJLMUT1(+$G(PSJOI)),"",COD,1,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",82,0)
 Q
"RTN","PSJBLDOC",83,0)
PIV ;Get the dispense drugs for the Pending IV orders.
"RTN","PSJBLDOC",84,0)
 NEW PSJ0,PSJX,DDRUG,PSJNM,PSJCLNTY
"RTN","PSJBLDOC",85,0)
 S PSJX=^PS(53.1,+ON,0),PSJORIEN=$P(PSJX,U,21) Q:$P(PSJX,U,27)="R"
"RTN","PSJBLDOC",86,0)
 S (PSJEDOVR,PSJCLINF,PSJCLNTY)=0,PSJCLNTY=$$GET1^DIQ(53.1,+ON,4,"I")
"RTN","PSJBLDOC",87,0)
 S:$D(^TMP($J,"PSJPRE","CLINIC",+ON,531_PSJCLNTY)) PSJCLINF=1
"RTN","PSJBLDOC",88,0)
 Q:$P($G(PTYP),";",1)="O"&('$G(PSJCLINF))
"RTN","PSJBLDOC",89,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"AD",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",90,0)
 . S PSJX=^PS(53.1,+ON,"AD",ON1,0),PSJ0=$$IV0("AD",+PSJX)
"RTN","PSJBLDOC",91,0)
 . S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",92,0)
 . I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",93,0)
 . D SETIN("PROFILE",$P(PSJ0,U)_" "_$P(PSJX,U,2),$P(PSJ0,U,2),COD,PTYP,PSJCLCOD,PSJCLINF)
"RTN","PSJBLDOC",94,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"SOL",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",95,0)
 . S PSJX=^PS(53.1,+ON,"SOL",ON1,0) D
"RTN","PSJBLDOC",96,0)
 . I $$PREMIX^PSJMISC(+PSJX) D
"RTN","PSJBLDOC",97,0)
 .. S PSJ0=$$IV0("",+PSJX)
"RTN","PSJBLDOC",98,0)
 .. S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",99,0)
 .. I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",100,0)
 .. D SETIN("PROFILE",$P(PSJ0,U)_" "_$P(PSJX,U,2),$P(PSJ0,U,2),COD,PTYP,PSJCLCOD,PSJCLINF)
"RTN","PSJBLDOC",101,0)
 Q
"RTN","PSJBLDOC",102,0)
IV ;Get the dispense drugs for the IV orders.
"RTN","PSJBLDOC",103,0)
 NEW PSJ0,PSJX,DDRUG,PSJNM,PSJCLNX
"RTN","PSJBLDOC",104,0)
 S PSJX=^PS(55,DFN,"IV",ON,0),PSJORIEN=$P(PSJX,U,21),(PSJCLINF,PSJCLNX)=0,PSJCLNX=$P(PSJX,U,17)
"RTN","PSJBLDOC",105,0)
 Q:$P(PSJX,U,17)="R"
"RTN","PSJBLDOC",106,0)
 S:$D(^TMP($J,"PSJPRE","CLINIC",+ON,"55I")) PSJCLINF=1
"RTN","PSJBLDOC",107,0)
 Q:$P($G(PTYP),";",1)="O"&('$G(PSJCLINF))
"RTN","PSJBLDOC",108,0)
 Q:$P(PSJX,U,17)["D"&('PSJCLINF)
"RTN","PSJBLDOC",109,0)
 Q:$P(PSJX,U,17)="E"&('PSJCLINF)
"RTN","PSJBLDOC",110,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"AD",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",111,0)
 . S PSJX=^PS(55,DFN,"IV",ON,"AD",ON1,0),PSJ0=$$IV0("AD",+PSJX)
"RTN","PSJBLDOC",112,0)
 . S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",113,0)
 . I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",114,0)
 . D SETIN("PROFILE",PSJNM,DDRUG,COD,PTYP,PSJCLCOD,PSJCLINF)
"RTN","PSJBLDOC",115,0)
 ; Only include Pre-mix in the OC.
"RTN","PSJBLDOC",116,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"SOL",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",117,0)
 . S PSJX=^PS(55,DFN,"IV",ON,"SOL",ON1,0)
"RTN","PSJBLDOC",118,0)
 . I $$PREMIX^PSJMISC(+PSJX) D
"RTN","PSJBLDOC",119,0)
 .. S PSJ0=$$IV0("",+PSJX)
"RTN","PSJBLDOC",120,0)
 .. S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",121,0)
 .. I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",122,0)
 .. D SETIN("PROFILE",PSJNM,DDRUG,COD,PTYP,PSJCLCOD,PSJCLINF)
"RTN","PSJBLDOC",123,0)
 Q
"RTN","PSJBLDOC",124,0)
SETIN(PSJFLG,PSJNM,DDRUG,ON,PSJCODE,PSJCLCOD,PSJCLINF) ;Set ^TMP($J,"PSJPRE,"IN" arrays.
"RTN","PSJBLDOC",125,0)
 ;ON = ON with "U/V/P"
"RTN","PSJBLDOC",126,0)
 ;PSJFLG = "PROSPECTIVE" or "PROFILE"
"RTN","PSJBLDOC",127,0)
 ;PSJNM = This should be the AD/SOL print name or IV order.  Use Dispense drug name if U/D order
"RTN","PSJBLDOC",128,0)
 ;PSJPON = 4 piece pharmacy order #
"RTN","PSJBLDOC",129,0)
 NEW PSJPON
"RTN","PSJBLDOC",130,0)
 Q:$G(PSJFLG)=""
"RTN","PSJBLDOC",131,0)
 S PSJONCNT=$G(PSJONCNT)+1
"RTN","PSJBLDOC",132,0)
 S PSJPON=$S(PSJCLINF:"C"_PSJCLCOD_";",1:"I;")_ON_";"_PSJFLG_";"_PSJONCNT
"RTN","PSJBLDOC",133,0)
 I $P(PSJCODE,";")="O" S PSJPON="C"_PSJCLCOD_";"_+ON_";"_PSJFLG_";"_PSJONCNT
"RTN","PSJBLDOC",134,0)
 I '+$G(DDRUG) D  Q
"RTN","PSJBLDOC",135,0)
 . I +$G(PSJCODE) D NODD($G(PSJCODE),PSJNM,PSJPON,LIST)
"RTN","PSJBLDOC",136,0)
 Q:$$SUP^PSSDSAPI(+DDRUG)
"RTN","PSJBLDOC",137,0)
 I $G(PSJNM)="" S PSJNM=$P($G(^PSDRUG(+DDRUG,0)),U)
"RTN","PSJBLDOC",138,0)
 S PSJFLG=$S($G(PSJDGCK):"PROSPECTIVE",1:"PROFILE") ;when using DX hidden action
"RTN","PSJBLDOC",139,0)
 S ^TMP($J,LIST,"IN",PSJFLG,PSJPON)=+$$GCN^PSJMISC(+DDRUG)_U_$$GTVUID^PSJMISC(+DDRUG)_U_+DDRUG_U_PSJNM_U_$G(PSJORIEN)_U_"I"_U_PSJCLCOD_";"_PSJCLINF
"RTN","PSJBLDOC",140,0)
 Q
"RTN","PSJBLDOC",141,0)
IV0(PSJAD,PSIVIEN) ;Return ad/sol zero node
"RTN","PSJBLDOC",142,0)
 ;PSJAD = "AD" is passed in if it additive, otherwise it's null
"RTN","PSJBLDOC",143,0)
 I PSJAD="AD" Q $G(^PS(52.6,+$G(PSIVIEN),0))
"RTN","PSJBLDOC",144,0)
 I $G(PSJAD)="" Q $G(^PS(52.7,+$G(PSIVIEN),0))
"RTN","PSJBLDOC",145,0)
 Q ""
"RTN","PSJBLDOC",146,0)
NODD(PSJCODE,PSJOIDF,PSJPON,PSJBASE) ;Set ^TMP for OI without a dispense drug
"RTN","PSJBLDOC",147,0)
 ;PSJCODE - A numeric code to trigger the appropriate exception message 
"RTN","PSJBLDOC",148,0)
 ;PSJOIDF - Orderable Item name_Dose form (can be CPRS OI)
"RTN","PSJBLDOC",149,0)
 ;PSJPON - Pharmacy order #
"RTN","PSJBLDOC",150,0)
 ;PSJBASE - Base subscript
"RTN","PSJBLDOC",151,0)
 Q:$G(PSJOIDF)=""
"RTN","PSJBLDOC",152,0)
 Q:$G(PSJBASE)=""
"RTN","PSJBLDOC",153,0)
 Q:'+$G(PSJCODE)
"RTN","PSJBLDOC",154,0)
 ;S PSJIV("OI_ERROR",PSJOIDF)=$G(PSJCODE)_U_$G(PSJPON)
"RTN","PSJBLDOC",155,0)
 S ^TMP($J,PSJBASE,"IN","EXCEPTIONS","OI",PSJOIDF)=PSJCODE_U_$G(PSJPON)
"RTN","PSJBLDOC",156,0)
 Q
"VER")
8.0^22.0
"BLD",8544,6)
^247
**END**
**END**
