Released PSJ*5*244 SEQ #228
Extracted from mail message
**KIDS**:PSJ*5.0*244^

**INSTALL NAME**
PSJ*5.0*244
"BLD",8644,0)
PSJ*5.0*244^INPATIENT MEDICATIONS^0^3111006^y
"BLD",8644,1,0)
^^8^8^3100826^
"BLD",8644,1,1,0)
The purpose of this patch is to provide software bug fixes for Inpatient 
"BLD",8644,1,2,0)
Medications to correct several errors and to provide a method to clean 
"BLD",8644,1,3,0)
up discontinued non-verified orders in cross-references in order to 
"BLD",8644,1,4,0)
increase system speed.  This patch corrects the following issues:
"BLD",8644,1,5,0)
 
"BLD",8644,1,6,0)
-Slow response when searching for orders
"BLD",8644,1,7,0)
-Incorrect error message displaying
"BLD",8644,1,8,0)
-Undefined Error when verifying orders
"BLD",8644,4,0)
^9.64PA^^
"BLD",8644,6)
6^
"BLD",8644,6.3)
7
"BLD",8644,"ABPKG")
n
"BLD",8644,"KRN",0)
^9.67PA^779.2^20
"BLD",8644,"KRN",.4,0)
.4
"BLD",8644,"KRN",.401,0)
.401
"BLD",8644,"KRN",.402,0)
.402
"BLD",8644,"KRN",.403,0)
.403
"BLD",8644,"KRN",.5,0)
.5
"BLD",8644,"KRN",.84,0)
.84
"BLD",8644,"KRN",3.6,0)
3.6
"BLD",8644,"KRN",3.8,0)
3.8
"BLD",8644,"KRN",9.2,0)
9.2
"BLD",8644,"KRN",9.8,0)
9.8
"BLD",8644,"KRN",9.8,"NM",0)
^9.68A^3^2
"BLD",8644,"KRN",9.8,"NM",1,0)
PSGBRJ^^0^B19761653
"BLD",8644,"KRN",9.8,"NM",3,0)
PSIVORE2^^0^B13789762
"BLD",8644,"KRN",9.8,"NM","B","PSGBRJ",1)

"BLD",8644,"KRN",9.8,"NM","B","PSIVORE2",3)

"BLD",8644,"KRN",19,0)
19
"BLD",8644,"KRN",19,"NM",0)
^9.68A^^0
"BLD",8644,"KRN",19.1,0)
19.1
"BLD",8644,"KRN",101,0)
101
"BLD",8644,"KRN",409.61,0)
409.61
"BLD",8644,"KRN",771,0)
771
"BLD",8644,"KRN",779.2,0)
779.2
"BLD",8644,"KRN",870,0)
870
"BLD",8644,"KRN",8989.51,0)
8989.51
"BLD",8644,"KRN",8989.52,0)
8989.52
"BLD",8644,"KRN",8994,0)
8994
"BLD",8644,"KRN","B",.4,.4)

"BLD",8644,"KRN","B",.401,.401)

"BLD",8644,"KRN","B",.402,.402)

"BLD",8644,"KRN","B",.403,.403)

"BLD",8644,"KRN","B",.5,.5)

"BLD",8644,"KRN","B",.84,.84)

"BLD",8644,"KRN","B",3.6,3.6)

"BLD",8644,"KRN","B",3.8,3.8)

"BLD",8644,"KRN","B",9.2,9.2)

"BLD",8644,"KRN","B",9.8,9.8)

"BLD",8644,"KRN","B",19,19)

"BLD",8644,"KRN","B",19.1,19.1)

"BLD",8644,"KRN","B",101,101)

"BLD",8644,"KRN","B",409.61,409.61)

"BLD",8644,"KRN","B",771,771)

"BLD",8644,"KRN","B",779.2,779.2)

"BLD",8644,"KRN","B",870,870)

"BLD",8644,"KRN","B",8989.51,8989.51)

"BLD",8644,"KRN","B",8989.52,8989.52)

"BLD",8644,"KRN","B",8994,8994)

"BLD",8644,"QDEF")
^^^^^^^^^^YES
"BLD",8644,"QUES",0)
^9.62^^
"BLD",8644,"REQB",0)
^9.611^2^2
"BLD",8644,"REQB",1,0)
PSJ*5.0*50^2
"BLD",8644,"REQB",2,0)
PSJ*5.0*101^2
"BLD",8644,"REQB","B","PSJ*5.0*101",2)

"BLD",8644,"REQB","B","PSJ*5.0*50",1)

"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
244^3111006^520736413
"PKG",221,22,1,"PAH",1,1,0)
^^8^8^3111006
"PKG",221,22,1,"PAH",1,1,1,0)
The purpose of this patch is to provide software bug fixes for Inpatient 
"PKG",221,22,1,"PAH",1,1,2,0)
Medications to correct several errors and to provide a method to clean 
"PKG",221,22,1,"PAH",1,1,3,0)
up discontinued non-verified orders in cross-references in order to 
"PKG",221,22,1,"PAH",1,1,4,0)
increase system speed.  This patch corrects the following issues:
"PKG",221,22,1,"PAH",1,1,5,0)
 
"PKG",221,22,1,"PAH",1,1,6,0)
-Slow response when searching for orders
"PKG",221,22,1,"PAH",1,1,7,0)
-Incorrect error message displaying
"PKG",221,22,1,"PAH",1,1,8,0)
-Undefined Error when verifying orders
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSGBRJ")
0^1^B19761653^B17214121
"RTN","PSGBRJ",1,0)
PSGBRJ ;BIR/CML3-UD JANITOR (BACKGROUND TASKMAN JOB) ; 6/4/10 9:57am
"RTN","PSGBRJ",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**12,50,244**;16 DEC 97;Build 7
"RTN","PSGBRJ",3,0)
 ;
"RTN","PSGBRJ",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGBRJ",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSGBRJ",6,0)
 ;
"RTN","PSGBRJ",7,0)
LK ; kill off old labels
"RTN","PSGBRJ",8,0)
 D NOW^%DTC S (PSGBRJDT,PSGDT)=%,^PS(53.42,PSGBRJDT,0)=PSGBRJDT,PSJACIVF=1
"RTN","PSGBRJ",9,0)
 F PSGL1=1,2 D
"RTN","PSGBRJ",10,0)
 .F PSGL2=0:0 S PSGL2=$O(^PS(53.41,PSGL1,1,PSGL2)) Q:'PSGL2  D
"RTN","PSGBRJ",11,0)
 ..F PSGL3=0:0 S PSGL3=$O(^PS(53.41,PSGL1,1,PSGL2,1,PSGL3)) Q:'PSGL3  D
"RTN","PSGBRJ",12,0)
 ...S PSGKD=$$LABELDT(PSGL3,PSGDT)
"RTN","PSGBRJ",13,0)
 ...F PSGL4=1,2,3 F PSGL5=0:0 S PSGL5=$O(^PS(53.41,PSGL1,1,PSGL2,1,PSGL3,1,PSGL4,1,PSGL5)) Q:'PSGL5  D
"RTN","PSGBRJ",14,0)
 ....S X=$P($G(^PS(53.41,PSGL1,1,PSGL2,1,PSGL3,1,PSGL4,1,PSGL5,0)),"^",3)
"RTN","PSGBRJ",15,0)
 ....I X<PSGKD K DA S DIK="^PS(53.41,"_PSGL1_",1,"_PSGL2_",1,"_PSGL3_",1,"_PSGL4_",1,",DA(4)=PSGL1,DA(3)=PSGL2,DA(2)=PSGL3,DA(1)=PSGL4,DA=PSGL5 D ^DIK
"RTN","PSGBRJ",16,0)
 ;
"RTN","PSGBRJ",17,0)
AK ; kill off all orders in 53.1 that have gone active (into 55)
"RTN","PSGBRJ",18,0)
 N PSJNO,PSJNOACT,ON100 S PSJNOACT=1
"RTN","PSGBRJ",19,0)
 S DIK="^PS(53.1," F PSGP=0:0 S PSGP=$O(^PS(53.1,"AS","A",PSGP)) Q:'PSGP  F PSJNO=0:0 S PSJNO=$O(^PS(53.1,"AS","A",PSGP,PSJNO)) Q:'PSJNO  S DA=PSJNO D 
"RTN","PSGBRJ",20,0)
 . S ON100=+$P($G(^PS(53.1,DA,0)),U,21) I '$D(^XTMP("ORLK-"_$G(ON100))) D ^DIK ;*PSJ*5*244 - Check for lock
"RTN","PSGBRJ",21,0)
 ;
"RTN","PSGBRJ",22,0)
DE ; kill off de orders in 53.1 that no longer tie to order in 55
"RTN","PSGBRJ",23,0)
 S X="ORX" X ^%ZOSF("TEST") S PSGOERRF=$T
"RTN","PSGBRJ",24,0)
 NEW PSJDA,ON K ^TMP($J)
"RTN","PSGBRJ",25,0)
 F PSGP=0:0 S PSGP=$O(^PS(53.1,"AS","DE",PSGP)) Q:'PSGP  F PSJDA=0:0 S PSJDA=$O(^PS(53.1,"AS","DE",PSGP,PSJDA)) Q:'PSJDA  S ON=$P($G(^PS(53.1,PSJDA,0)),U,26) D
"RTN","PSGBRJ",26,0)
 . I ON["A"!(ON["O")!(ON["U") S:'$D(^PS(55,PSGP,5,+ON,0)) ^TMP($J,PSJDA)=PSGP Q
"RTN","PSGBRJ",27,0)
 . I ON["V" S:'$D(^PS(55,PSGP,"IV",+ON,0)) ^TMP($J,PSJDA)=PSGP Q
"RTN","PSGBRJ",28,0)
 . I '$D(^PS(53.1,+ON,0)) S ^TMP($J,PSJDA)=PSGP Q
"RTN","PSGBRJ",29,0)
 F PSJDA=0:0 S PSJDA=$O(^TMP($J,PSJDA)) Q:'PSJDA  D:$D(^PS(53.1,PSJDA,0)) PDE(PSJDA,^TMP($J,PSJDA))
"RTN","PSGBRJ",30,0)
 K ^TMP($J)
"RTN","PSGBRJ",31,0)
 ;
"RTN","PSGBRJ",32,0)
DK ; kill off dc'd orders in 53.1 around longer than life of labels
"RTN","PSGBRJ",33,0)
 N PSJNOACT S PSJNOACT=1
"RTN","PSGBRJ",34,0)
 S X="ORX" X ^%ZOSF("TEST") S PSGOERRF=$T
"RTN","PSGBRJ",35,0)
 F PSGP=0:0 S PSGP=$O(^PS(53.1,"AS","D",PSGP)) Q:'PSGP  D
"RTN","PSGBRJ",36,0)
 .S PSGKD=$$LABELDT(PSGP,PSGDT) F DA=0:0 S DA=$O(^PS(53.1,"AS","D",PSGP,DA)) Q:'DA  D
"RTN","PSGBRJ",37,0)
 ..S S=$P($G(^PS(53.1,DA,0)),"^",9),ST=$P($G(^(2)),"^",3) I $S(S="U":1,S="P":1,1:ST<PSGKD) D ORPRG:PSGOERRF S DIK="^PS(53.1," D ^DIK
"RTN","PSGBRJ",38,0)
 ;
"RTN","PSGBRJ",39,0)
PLP ; purge pick lists that are filed away and older than auto purge days
"RTN","PSGBRJ",40,0)
 I $D(^PS(59.7,1,63.5)),^(63.5) S X2=-^(63.5),X1=DT D C^%DTC S PSJX=X F Q=0:0 S Q=$O(^PS(53.5,"AO",Q)) Q:'Q  F QQ=0:0 S QQ=$O(^PS(53.5,"AO",Q,QQ)) Q:'QQ!(QQ>PSJX)  S Y=$O(^(QQ,0)) I Y D
"RTN","PSGBRJ",41,0)
 .K DA,DIK,^PS(53.5,"AU",Y) S DIK="^PS(53.5,",DA=Y D ^DIK
"RTN","PSGBRJ",42,0)
 F PSJX=0:0 S PSJX=$O(^PS(53.55,PSJX)) Q:'PSJX  I '$D(^PS(53.5,PSJX)) K DA,DIK S DA=PSJX,DIK="^PS(53.55," D ^DIK
"RTN","PSGBRJ",43,0)
 ;
"RTN","PSGBRJ",44,0)
GLK ; kill off entries in ^PS(53.42) 20 days or more old
"RTN","PSGBRJ",45,0)
 S X1=DT,X2=-20 D C^%DTC F D=0:0 S D=$O(^PS(53.42,D)) Q:'D!(D'<X)  K ^(D)
"RTN","PSGBRJ",46,0)
 ;
"RTN","PSGBRJ",47,0)
UPARAM ; kill off entries in ^PS(53.45) INPATIENT USER PARAMETERS file if there is no corresponding entry in the NEW PERSON file or they have a TERMINATION DATE before today.
"RTN","PSGBRJ",48,0)
 S DA=0 F  S DA=$O(^PS(53.45,DA)) Q:'DA  D
"RTN","PSGBRJ",49,0)
 .I '$D(^VA(200,DA)) S DIK="^PS(53.45," D ^DIK K DIK Q
"RTN","PSGBRJ",50,0)
 .S PSGX=$P(^VA(200,DA,0),"^",11),PSGX=$S(PSGX="":9999999,1:PSGX) I PSGX<DT S DIK="^PS(53.45," D ^DIK K DIK
"RTN","PSGBRJ",51,0)
 ;
"RTN","PSGBRJ",52,0)
NVK ; *PSJ*5*244 - kill discontinued orders from non-verified X-refs
"RTN","PSGBRJ",53,0)
 N DFN,ON,PSGREF,X
"RTN","PSGBRJ",54,0)
 S PSGREF(1)="ANV",PSGREF(2)="APV",PSGREF(3)="ANIV",PSGREF(4)="APIV"
"RTN","PSGBRJ",55,0)
 F X=1:1:4 D
"RTN","PSGBRJ",56,0)
 . F DFN=0:0 S DFN=$O(^PS(55,PSGREF(X),DFN)) Q:'DFN  D
"RTN","PSGBRJ",57,0)
 .. F ON=0:0 S ON=$O(^PS(55,PSGREF(X),DFN,ON)) Q:'ON  D
"RTN","PSGBRJ",58,0)
 ... I $P($G(^PS(55,DFN,5,ON,0)),U,9)["D" K ^PS(55,PSGREF(X),DFN,ON)
"RTN","PSGBRJ",59,0)
 Q
"RTN","PSGBRJ",60,0)
 ;
"RTN","PSGBRJ",61,0)
DONE ;
"RTN","PSGBRJ",62,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSGBRJ",63,0)
 D NOW^%DTC S $P(^PS(53.42,PSGBRJDT,0),"^",2)=%
"RTN","PSGBRJ",64,0)
 D ENKV^PSGSETU K CA,D,DA,DFN,DIK,DND,GOTO,PSGL1,PSGL2,PSGL3,PSGL4,PSGL4,PSGKD,PSGOERRF,PSGX,PSJACIVF,PSJX,PSGBRJDT,S,ST,X1,X2 Q
"RTN","PSGBRJ",65,0)
 ;
"RTN","PSGBRJ",66,0)
ORPRG ;
"RTN","PSGBRJ",67,0)
 ;*** COMMENT OUT FOR NOW.  NEED TO GET BACK WITH MELANIE TO SEE
"RTN","PSGBRJ",68,0)
 ;*** WHAT TO BE DONE WHEN WE PURGE INPATIENT MEDS ORDERS.  7/19/96.
"RTN","PSGBRJ",69,0)
 ; removed old call to ORX routine!
"RTN","PSGBRJ",70,0)
 Q
"RTN","PSGBRJ",71,0)
LABELDT(PSGP,X1) ; Find patient's ward and get days to keep new labels.
"RTN","PSGBRJ",72,0)
 S X=$G(^DPT(PSGP,.1)),X2=0 I X]"" S X=+$O(^DIC(42,"B",X,0)),X=+$O(^PS(59.6,"B",X,0)),X2=-$P($G(^PS(59.6,X,0)),U,11)
"RTN","PSGBRJ",73,0)
 D C^%DTC
"RTN","PSGBRJ",74,0)
 Q X
"RTN","PSGBRJ",75,0)
 ;
"RTN","PSGBRJ",76,0)
PDE(PSJDA1,PSGP) ;Remove all related pending orders with the "DE" status.
"RTN","PSGBRJ",77,0)
 N DA,DIK,PDE,PSJNUM,PDEFLG,PSJ55,PSJNOACT S (PDEFLG,PSJ55)=0,PSJNOACT=1
"RTN","PSGBRJ",78,0)
 F  S PSJNUM=$P($G(^PS(53.1,PSJDA1,0)),U,25) Q:'+PSJNUM  D  Q:PSJ55
"RTN","PSGBRJ",79,0)
 . I PSJNUM["A"!(PSJNUM["O")!(PSJNUM["U") S PSJ55=1 I $D(^PS(55,PSGP,5,+PSJNUM,0)) S PDEFLG=1 Q
"RTN","PSGBRJ",80,0)
 . I PSJNUM["V" S PSJ55=1 I $D(^PS(55,PSGP,"IV",+PSJNUM,0)) S PDEFLG=1 Q
"RTN","PSGBRJ",81,0)
 . S PDE(PSJDA1)="",PSJDA1=+PSJNUM
"RTN","PSGBRJ",82,0)
 S:'PSJ55 PDE(PSJDA1)=""
"RTN","PSGBRJ",83,0)
 I 'PDEFLG,$O(PDE(0)) F PSJDA1=0:0 S PSJDA1=$O(PDE(PSJDA1)) Q:'PSJDA1  I $D(^PS(53.1,PSJDA1,0)) S DA=PSJDA1 D ORPRG:PSGOERRF S DIK="^PS(53.1,",DA=+PSJDA1 D ^DIK K DA,DIK
"RTN","PSGBRJ",84,0)
 Q
"RTN","PSIVORE2")
0^3^B13789762^B13568787
"RTN","PSIVORE2",1,0)
PSIVORE2 ;BIR/RGY,PR,MLM-ACT, NEW ORDER (CONT. OF PSIVORE1) ; 8/8/08 10:57am
"RTN","PSIVORE2",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**21,58,101,244**;16 DEC 97;Build 7
"RTN","PSIVORE2",3,0)
 ;
"RTN","PSIVORE2",4,0)
 ; References to ^PS(55 supported by DBIA #2191.
"RTN","PSIVORE2",5,0)
 ;
"RTN","PSIVORE2",6,0)
DEQ ;
"RTN","PSIVORE2",7,0)
 S P(4)=$P(^PS(55,DFN,"IV",+ON,0),U,4),ACTION=1,TRACK=4 D ^PSIVLTR D ^PSIVHYPL:P(4)="H",^PSIVLABL:P(4)'="H"
"RTN","PSIVORE2",8,0)
K ;
"RTN","PSIVORE2",9,0)
 S:$D(ZTQUEUED) ZTREQ="@" K PSIVMI,PSI,OD,PSIVEC,PSIVSC,I,PSIVNOL,PSIV1,PSIVA,PSIVDOSE,PSGCNT,PSGSA,PSCT,PDOSE,PDATE,PSIVLABN,UP1,PLAST Q
"RTN","PSIVORE2",10,0)
TL ;
"RTN","PSIVORE2",11,0)
 W ! F X=3:3:24 W "       ",$S($L(X)=1:" ",1:""),X
"RTN","PSIVORE2",12,0)
 W ! F X=1:1:24 W "..:"
"RTN","PSIVORE2",13,0)
 K PSI F X=0:0 S X=$O(^PS(59.5,PSIVSN,2,"AC",P(4),X)) Q:'X  S PSI(+("."_$P(^PS(59.5,PSIVSN,2,X,0),U)))=$S($P($P(^(0),U,6),".")=DT:"*",1:"")
"RTN","PSIVORE2",14,0)
 S PSI=P(4) D TL1
"RTN","PSIVORE2",15,0)
 K PSI S:'$D(PSGSA) PSGSA="" F PSI=1:1 S X=$P(PSGSA," ",PSI) Q:X=""  I X S PSI(X#1)=""
"RTN","PSIVORE2",16,0)
 S PSI="^" D TL1
"RTN","PSIVORE2",17,0)
 D NOW^%DTC S Y=% S PSI(Y#1)="",PSI="N" D TL1 Q
"RTN","PSIVORE2",18,0)
TL1 ;
"RTN","PSIVORE2",19,0)
 W ! S Y="" F X=0:0 S Y=$O(PSI(Y)) Q:'Y  W ?3*$E(Y_"000",2,3)-1+$S($E(Y_"000",4,5)>40:2,$E(Y_"000",4,5)>20:1,1:0),PSI,PSI(Y)
"RTN","PSIVORE2",20,0)
 K PSI Q
"RTN","PSIVORE2",21,0)
C ;
"RTN","PSIVORE2",22,0)
 S SNM=0 F DAT=0:0 S DAT=$O(^PS(55,"PSIVSUS",PSIVSN,DFN,+ON,DAT)) Q:'DAT  S SNM=SNM+$P(^(DAT),U)
"RTN","PSIVORE2",23,0)
 Q
"RTN","PSIVORE2",24,0)
 ;
"RTN","PSIVORE2",25,0)
CONVER(X,Y) ;
"RTN","PSIVORE2",26,0)
 ;***$$FMADD^XLFDT(DT.HH,D,H,M,S) returns the DT.HH+(D,H,M,S)
"RTN","PSIVORE2",27,0)
 ;*I +P(15)>1440 S X=$$FMADD^XLFDT($P(PSGSA," "),"","",(P(15)*(Y-1))) Q X
"RTN","PSIVORE2",28,0)
 I +P(15)>1440 S X=$$CONVER1($P(PSGSA," "),P(15),(Y-1)) Q X
"RTN","PSIVORE2",29,0)
 S PDOSE=X S:Y=2 PDATE=$E($P(PSGSA," "),1,7)
"RTN","PSIVORE2",30,0)
 I $P(PSGSA," ",Y-1)#1'<PDOSE!(P(15)>1440) S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE Q X
"RTN","PSIVORE2",31,0)
 S X=PDATE_PDOSE
"RTN","PSIVORE2",32,0)
 Q X
"RTN","PSIVORE2",33,0)
 ;
"RTN","PSIVORE2",34,0)
CONVER1(ORDDT,X,Y)       ;
"RTN","PSIVORE2",35,0)
 ;* This sub-routine is necessary when a schedule such as q36h was
"RTN","PSIVORE2",36,0)
 ;* entered and the Start date is such as T-3@1200.  Without these codes
"RTN","PSIVORE2",37,0)
 ;* instead of schedule due for T@2400 it will display as T+1@0000.
"RTN","PSIVORE2",38,0)
 NEW DAYS,MINS S (DAYS,MINS)=0
"RTN","PSIVORE2",39,0)
 S DAYS=(X*Y)\1440,MINS=(X*Y)#1440
"RTN","PSIVORE2",40,0)
 S X=$$FMADD^XLFDT(ORDDT,DAYS,"",MINS)
"RTN","PSIVORE2",41,0)
 Q X
"RTN","PSIVORE2",42,0)
 ;
"RTN","PSIVORE2",43,0)
INCOMP ; Delete order missing critical information.
"RTN","PSIVORE2",44,0)
 N DIR,PSIVAC W !!,$C(7),"THIS ORDER IS NOT USABLE!",!,"Enter ""D"" to Delete, or ""B"" to Bypass",!
"RTN","PSIVORE2",45,0)
 S DIR(0)="SOA^D:DELETE;B:BYPASS",DIR("A")="ACTION (B/D): ",DIR("??")="^S HELP=""INCOMP"" D ^PSIVHLP2" D ^DIR K DIR Q:Y="B"!$D(DIRUT)  S PSIVAC="N"
"RTN","PSIVORE2",46,0)
 ;
"RTN","PSIVORE2",47,0)
DEL55 ; Delete order from 55.
"RTN","PSIVORE2",48,0)
 I ON55'["V"!($G(P(21))]"") Q
"RTN","PSIVORE2",49,0)
 S DIK="^PS(55,"_DFN_",""IV"",",DA(1)=DFN,DA=+ON55 D ^DIK W:'$G(PSIVORFA) $C(7),"...Order ",$S($E($G(PSIVAC),2)="N":"deleted.",1:"unchanged.")
"RTN","PSIVORE2",50,0)
 N DA,DIK,ORIFN S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) I ORIFN,$E($G(PSIVAC),2)="N" D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DELETED")
"RTN","PSIVORE2",51,0)
 L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVORE2",52,0)
 Q
"RTN","PSIVORE2",53,0)
 ;
"RTN","PSIVORE2",54,0)
NEW ; New order entry
"RTN","PSIVORE2",55,0)
 N ON D NEWENT^PSIVORFE S DRGN="",P("IVRM")=+PSIVSN_U_$P($G(^PS(59.5,+PSIVSN,0)),U) ;*PSJ*5*244 - NEW ON
"RTN","PSIVORE2",56,0)
 K DRG,PSGFDX F X="AD","DRG","LF","LFA","CUM","MR","SOL","OPI","OT","SYRS","REM","SI",2,3,4,5,7,8,9,11,12,15,17,23 S:'$D(P(X)) P(X)=""
"RTN","PSIVORE2",57,0)
 S P(17)="A",P(4)=$E($G(PSIVTYPE)) S:"CS"[P(4) P(23)=$P($G(PSIVTYPE),U,2)
"RTN","PSIVORE2",58,0)
 D:P(4)="" 53^PSIVORC1 Q:$G(P(4))=""  S Y=$P($G(^PS(55,DFN,5.1)),U,2),P(6)=Y_U_$P($G(^VA(200,+Y,0)),U)
"RTN","PSIVORE2",59,0)
 D OTYP^PSIVORC1 S PSIVOK="",EDIT="57^58^59^3"_$S(P("DTYP")=1:"^26^39",1:"")_"^63^64^10^25^1"
"RTN","PSIVORE2",60,0)
 D EDIT^PSIVEDT Q:'$G(P(2))  D GTOT^PSIVUTL(P(4)) D:$G(P("PD"))="" GTPD
"RTN","PSIVORE2",61,0)
 Q
"RTN","PSIVORE2",62,0)
 ;
"RTN","PSIVORE2",63,0)
GTPD ; Find Orderable Item/dosage ordered for IM.
"RTN","PSIVORE2",64,0)
 S P("PD")="" F DRGT="AD","SOL" Q:P("PD")  F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI!P("PD")  D
"RTN","PSIVORE2",65,0)
 . S X=DRG(DRGT,DRGI) S:$P(X,U,6) P("PD")=$P(X,U,6)_U_$$OIDF^PSJLMUT1(+$P(X,U,6))
"RTN","PSIVORE2",66,0)
 . S P("DO")=$P(X,U,3)
"RTN","PSIVORE2",67,0)
 . ;S:$G(P("DO"))="" P("DO")=$P(X,U,3)
"RTN","PSIVORE2",68,0)
 Q
"VER")
8.0^22.0
"BLD",8644,6)
^228
**END**
**END**
