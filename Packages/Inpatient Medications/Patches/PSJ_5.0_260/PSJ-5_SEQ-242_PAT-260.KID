Released PSJ*5*260 SEQ #242
Extracted from mail message
**KIDS**:PSJ*5.0*260^

**INSTALL NAME**
PSJ*5.0*260
"BLD",8512,0)
PSJ*5.0*260^INPATIENT MEDICATIONS^0^3121029^y
"BLD",8512,4,0)
^9.64PA^^
"BLD",8512,6)
11^
"BLD",8512,6.3)
94
"BLD",8512,"ABPKG")
n
"BLD",8512,"KRN",0)
^9.67PA^779.2^20
"BLD",8512,"KRN",.4,0)
.4
"BLD",8512,"KRN",.401,0)
.401
"BLD",8512,"KRN",.402,0)
.402
"BLD",8512,"KRN",.403,0)
.403
"BLD",8512,"KRN",.5,0)
.5
"BLD",8512,"KRN",.84,0)
.84
"BLD",8512,"KRN",3.6,0)
3.6
"BLD",8512,"KRN",3.8,0)
3.8
"BLD",8512,"KRN",9.2,0)
9.2
"BLD",8512,"KRN",9.8,0)
9.8
"BLD",8512,"KRN",9.8,"NM",0)
^9.68A^24^21
"BLD",8512,"KRN",9.8,"NM",3,0)
PSJUTL1^^0^B56131679
"BLD",8512,"KRN",9.8,"NM",4,0)
PSJDGCK^^0^B7861600
"BLD",8512,"KRN",9.8,"NM",5,0)
PSJOC^^0^B27066758
"BLD",8512,"KRN",9.8,"NM",6,0)
PSJOCDT^^0^B48494609
"BLD",8512,"KRN",9.8,"NM",7,0)
PSGOEF^^0^B99775279
"BLD",8512,"KRN",9.8,"NM",8,0)
PSJGMRA^^0^B26285552
"BLD",8512,"KRN",9.8,"NM",9,0)
PSJHL3^^0^B111350623
"BLD",8512,"KRN",9.8,"NM",10,0)
PSJDGAL2^^0^B21809934
"BLD",8512,"KRN",9.8,"NM",11,0)
PSJHEAD^^0^B30136774
"BLD",8512,"KRN",9.8,"NM",12,0)
PSJLMHED^^0^B50472528
"BLD",8512,"KRN",9.8,"NM",14,0)
PSJOCDI^^0^B91203881
"BLD",8512,"KRN",9.8,"NM",15,0)
PSJBLDOC^^0^B43930447
"BLD",8512,"KRN",9.8,"NM",16,0)
PSJOCDC^^0^B2536866
"BLD",8512,"KRN",9.8,"NM",17,0)
PSGOEC^^0^B74688532
"BLD",8512,"KRN",9.8,"NM",18,0)
PSJCLNOC^^0^B82441248
"BLD",8512,"KRN",9.8,"NM",19,0)
PSJLIACT^^0^B49301561
"BLD",8512,"KRN",9.8,"NM",20,0)
PSGOEV^^0^B73577896
"BLD",8512,"KRN",9.8,"NM",21,0)
PSGOEM^^0^B32911590
"BLD",8512,"KRN",9.8,"NM",22,0)
PSJ53P1^^0^B8746775
"BLD",8512,"KRN",9.8,"NM",23,0)
PSGOE7^^0^B28193796
"BLD",8512,"KRN",9.8,"NM",24,0)
PSJUTL5^^0^B22923563
"BLD",8512,"KRN",9.8,"NM","B","PSGOE7",23)

"BLD",8512,"KRN",9.8,"NM","B","PSGOEC",17)

"BLD",8512,"KRN",9.8,"NM","B","PSGOEF",7)

"BLD",8512,"KRN",9.8,"NM","B","PSGOEM",21)

"BLD",8512,"KRN",9.8,"NM","B","PSGOEV",20)

"BLD",8512,"KRN",9.8,"NM","B","PSJ53P1",22)

"BLD",8512,"KRN",9.8,"NM","B","PSJBLDOC",15)

"BLD",8512,"KRN",9.8,"NM","B","PSJCLNOC",18)

"BLD",8512,"KRN",9.8,"NM","B","PSJDGAL2",10)

"BLD",8512,"KRN",9.8,"NM","B","PSJDGCK",4)

"BLD",8512,"KRN",9.8,"NM","B","PSJGMRA",8)

"BLD",8512,"KRN",9.8,"NM","B","PSJHEAD",11)

"BLD",8512,"KRN",9.8,"NM","B","PSJHL3",9)

"BLD",8512,"KRN",9.8,"NM","B","PSJLIACT",19)

"BLD",8512,"KRN",9.8,"NM","B","PSJLMHED",12)

"BLD",8512,"KRN",9.8,"NM","B","PSJOC",5)

"BLD",8512,"KRN",9.8,"NM","B","PSJOCDC",16)

"BLD",8512,"KRN",9.8,"NM","B","PSJOCDI",14)

"BLD",8512,"KRN",9.8,"NM","B","PSJOCDT",6)

"BLD",8512,"KRN",9.8,"NM","B","PSJUTL1",3)

"BLD",8512,"KRN",9.8,"NM","B","PSJUTL5",24)

"BLD",8512,"KRN",19,0)
19
"BLD",8512,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",8512,"KRN",19,"NM",1,0)
PSJU MGR^^2
"BLD",8512,"KRN",19,"NM",2,0)
PSJI MGR^^2
"BLD",8512,"KRN",19,"NM",3,0)
PSJ CHECK DRUG INTERACTION^^0
"BLD",8512,"KRN",19,"NM","B","PSJ CHECK DRUG INTERACTION",3)

"BLD",8512,"KRN",19,"NM","B","PSJI MGR",2)

"BLD",8512,"KRN",19,"NM","B","PSJU MGR",1)

"BLD",8512,"KRN",19.1,0)
19.1
"BLD",8512,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",8512,"KRN",101,0)
101
"BLD",8512,"KRN",101,"NM",0)
^9.68A^71^69
"BLD",8512,"KRN",101,"NM",1,0)
PSJ DISPLAY DRUG ALLERGIES^^0
"BLD",8512,"KRN",101,"NM",2,0)
PSJ LM PROFILE HIDDEN ACTIONS^^2
"BLD",8512,"KRN",101,"NM",3,0)
PSJ LM DRUG CHECK^^0^
"BLD",8512,"KRN",101,"NM",5,0)
PSJ LM ORDER VIEW HIDDEN ACTIONS^^2
"BLD",8512,"KRN",101,"NM",6,0)
VALM NEXT SCREEN^^0
"BLD",8512,"KRN",101,"NM",7,0)
VALM PREVIOUS SCREEN^^0
"BLD",8512,"KRN",101,"NM",8,0)
VALM UP ONE LINE^^0
"BLD",8512,"KRN",101,"NM",9,0)
VALM TURN ON/OFF MENUS^^0
"BLD",8512,"KRN",101,"NM",10,0)
VALM FIRST SCREEN^^0
"BLD",8512,"KRN",101,"NM",11,0)
VALM LAST SCREEN^^0
"BLD",8512,"KRN",101,"NM",12,0)
VALM GOTO PAGE^^0
"BLD",8512,"KRN",101,"NM",13,0)
VALM REFRESH^^0
"BLD",8512,"KRN",101,"NM",14,0)
VALM PRINT SCREEN^^0
"BLD",8512,"KRN",101,"NM",15,0)
VALM PRINT LIST^^0
"BLD",8512,"KRN",101,"NM",16,0)
VALM SEARCH LIST^^0
"BLD",8512,"KRN",101,"NM",17,0)
VALM QUIT^^0
"BLD",8512,"KRN",101,"NM",18,0)
PSJ LM MAR MENU^^0
"BLD",8512,"KRN",101,"NM",19,0)
PSJ LM LABEL PRINT/REPRINT MENU^^0
"BLD",8512,"KRN",101,"NM",20,0)
PSJ LM PNV JUMP^^0
"BLD",8512,"KRN",101,"NM",21,0)
PSJ LM OTHER PHARMACY OPTIONS^^2
"BLD",8512,"KRN",101,"NM",22,0)
VALM DOWN A LINE^^0
"BLD",8512,"KRN",101,"NM",23,0)
PSJU LM SPEED DISCONTINUE^^0
"BLD",8512,"KRN",101,"NM",24,0)
PSJU LM SPEED RENEW^^0
"BLD",8512,"KRN",101,"NM",25,0)
PSJU LM SPEED FINISH^^0
"BLD",8512,"KRN",101,"NM",26,0)
PSJU LM SPEED VERIFY^^0
"BLD",8512,"KRN",101,"NM",27,0)
PSJ LM CWAD^^0
"BLD",8512,"KRN",101,"NM",28,0)
PSJ LM PHARMACY INTERVENTION MENU^^0
"BLD",8512,"KRN",101,"NM",29,0)
PSJ LM DETAILED ALLERGY^^0
"BLD",8512,"KRN",101,"NM",31,0)
PSJ LM RETURNS/DESTROYED MENU^^0
"BLD",8512,"KRN",101,"NM",32,0)
PSJ LM PROFILE MENU^^0
"BLD",8512,"KRN",101,"NM",33,0)
PSJ LM 14D MAR^^0
"BLD",8512,"KRN",101,"NM",34,0)
PSJ LM 24H MAR^^0
"BLD",8512,"KRN",101,"NM",35,0)
PSJ LM 7D MAR^^0
"BLD",8512,"KRN",101,"NM",36,0)
PSJ LM AP1^^0
"BLD",8512,"KRN",101,"NM",37,0)
PSJ LM AP2^^0
"BLD",8512,"KRN",101,"NM",38,0)
PSJ LM BRIEF PATIENT INFO MENU^^0
"BLD",8512,"KRN",101,"NM",39,0)
PSJ LM EXTP^^0
"BLD",8512,"KRN",101,"NM",40,0)
PSJ LM INTERVENTION DELETE^^0
"BLD",8512,"KRN",101,"NM",41,0)
PSJ LM INTERVENTION EDIT^^0
"BLD",8512,"KRN",101,"NM",42,0)
PSJ LM INTERVENTION NEW ENTRY^^0
"BLD",8512,"KRN",101,"NM",43,0)
PSJ LM INTERVENTION PRINTOUT^^0
"BLD",8512,"KRN",101,"NM",44,0)
PSJ LM INTERVENTION VIEW^^0
"BLD",8512,"KRN",101,"NM",45,0)
PSJ LM MDWS^^0
"BLD",8512,"KRN",101,"NM",46,0)
PSJ LM NEW ORDER^^0
"BLD",8512,"KRN",101,"NM",47,0)
PSJ LM NEW ORDER FROM PROFILE^^0
"BLD",8512,"KRN",101,"NM",48,0)
PSJ LM OE MENU^^2
"BLD",8512,"KRN",101,"NM",49,0)
PSJ LM PAT PR^^0
"BLD",8512,"KRN",101,"NM",50,0)
PSJ LM PATIENT DATA^^0
"BLD",8512,"KRN",101,"NM",51,0)
PSJ LM PATIENT INFO^^0
"BLD",8512,"KRN",101,"NM",52,0)
PSJ LM PRINT OUTPATIENT PROFILE^^0
"BLD",8512,"KRN",101,"NM",53,0)
PSJ LM SELECT ORDER^^0
"BLD",8512,"KRN",101,"NM",54,0)
PSJ LM SHOW PROFILE^^0
"BLD",8512,"KRN",101,"NM",55,0)
PSJI LM ALIGNMENT^^0
"BLD",8512,"KRN",101,"NM",56,0)
PSJI LM LBLI^^0
"BLD",8512,"KRN",101,"NM",57,0)
PSJI LM LBLR^^0
"BLD",8512,"KRN",101,"NM",58,0)
PSJI LM LBLS^^0
"BLD",8512,"KRN",101,"NM",59,0)
PSJI LM PAT PR^^0
"BLD",8512,"KRN",101,"NM",60,0)
PSJI LM RETURNS^^0
"BLD",8512,"KRN",101,"NM",61,0)
PSJU LM AL^^0
"BLD",8512,"KRN",101,"NM",62,0)
PSJU LM LABEL^^0
"BLD",8512,"KRN",101,"NM",63,0)
PSJU LM PAT PR^^0
"BLD",8512,"KRN",101,"NM",64,0)
PSJU LM PL^^0
"BLD",8512,"KRN",101,"NM",65,0)
PSJU LM PL MENU^^0
"BLD",8512,"KRN",101,"NM",66,0)
PSJU LM PLDP^^0
"BLD",8512,"KRN",101,"NM",67,0)
PSJU LM PLEUD^^0
"BLD",8512,"KRN",101,"NM",68,0)
PSJU LM PLRP^^0
"BLD",8512,"KRN",101,"NM",69,0)
PSJU LM PLUP^^0
"BLD",8512,"KRN",101,"NM",70,0)
PSJU LM RET^^0
"BLD",8512,"KRN",101,"NM",71,0)
PSJU PLATCS^^0
"BLD",8512,"KRN",101,"NM","B","PSJ DISPLAY DRUG ALLERGIES",1)

"BLD",8512,"KRN",101,"NM","B","PSJ LM 14D MAR",33)

"BLD",8512,"KRN",101,"NM","B","PSJ LM 24H MAR",34)

"BLD",8512,"KRN",101,"NM","B","PSJ LM 7D MAR",35)

"BLD",8512,"KRN",101,"NM","B","PSJ LM AP1",36)

"BLD",8512,"KRN",101,"NM","B","PSJ LM AP2",37)

"BLD",8512,"KRN",101,"NM","B","PSJ LM BRIEF PATIENT INFO MENU",38)

"BLD",8512,"KRN",101,"NM","B","PSJ LM CWAD",27)

"BLD",8512,"KRN",101,"NM","B","PSJ LM DETAILED ALLERGY",29)

"BLD",8512,"KRN",101,"NM","B","PSJ LM DRUG CHECK",3)

"BLD",8512,"KRN",101,"NM","B","PSJ LM EXTP",39)

"BLD",8512,"KRN",101,"NM","B","PSJ LM INTERVENTION DELETE",40)

"BLD",8512,"KRN",101,"NM","B","PSJ LM INTERVENTION EDIT",41)

"BLD",8512,"KRN",101,"NM","B","PSJ LM INTERVENTION NEW ENTRY",42)

"BLD",8512,"KRN",101,"NM","B","PSJ LM INTERVENTION PRINTOUT",43)

"BLD",8512,"KRN",101,"NM","B","PSJ LM INTERVENTION VIEW",44)

"BLD",8512,"KRN",101,"NM","B","PSJ LM LABEL PRINT/REPRINT MENU",19)

"BLD",8512,"KRN",101,"NM","B","PSJ LM MAR MENU",18)

"BLD",8512,"KRN",101,"NM","B","PSJ LM MDWS",45)

"BLD",8512,"KRN",101,"NM","B","PSJ LM NEW ORDER",46)

"BLD",8512,"KRN",101,"NM","B","PSJ LM NEW ORDER FROM PROFILE",47)

"BLD",8512,"KRN",101,"NM","B","PSJ LM OE MENU",48)

"BLD",8512,"KRN",101,"NM","B","PSJ LM ORDER VIEW HIDDEN ACTIONS",5)

"BLD",8512,"KRN",101,"NM","B","PSJ LM OTHER PHARMACY OPTIONS",21)

"BLD",8512,"KRN",101,"NM","B","PSJ LM PAT PR",49)

"BLD",8512,"KRN",101,"NM","B","PSJ LM PATIENT DATA",50)

"BLD",8512,"KRN",101,"NM","B","PSJ LM PATIENT INFO",51)

"BLD",8512,"KRN",101,"NM","B","PSJ LM PHARMACY INTERVENTION MENU",28)

"BLD",8512,"KRN",101,"NM","B","PSJ LM PNV JUMP",20)

"BLD",8512,"KRN",101,"NM","B","PSJ LM PRINT OUTPATIENT PROFILE",52)

"BLD",8512,"KRN",101,"NM","B","PSJ LM PROFILE HIDDEN ACTIONS",2)

"BLD",8512,"KRN",101,"NM","B","PSJ LM PROFILE MENU",32)

"BLD",8512,"KRN",101,"NM","B","PSJ LM RETURNS/DESTROYED MENU",31)

"BLD",8512,"KRN",101,"NM","B","PSJ LM SELECT ORDER",53)

"BLD",8512,"KRN",101,"NM","B","PSJ LM SHOW PROFILE",54)

"BLD",8512,"KRN",101,"NM","B","PSJI LM ALIGNMENT",55)

"BLD",8512,"KRN",101,"NM","B","PSJI LM LBLI",56)

"BLD",8512,"KRN",101,"NM","B","PSJI LM LBLR",57)

"BLD",8512,"KRN",101,"NM","B","PSJI LM LBLS",58)

"BLD",8512,"KRN",101,"NM","B","PSJI LM PAT PR",59)

"BLD",8512,"KRN",101,"NM","B","PSJI LM RETURNS",60)

"BLD",8512,"KRN",101,"NM","B","PSJU LM AL",61)

"BLD",8512,"KRN",101,"NM","B","PSJU LM LABEL",62)

"BLD",8512,"KRN",101,"NM","B","PSJU LM PAT PR",63)

"BLD",8512,"KRN",101,"NM","B","PSJU LM PL",64)

"BLD",8512,"KRN",101,"NM","B","PSJU LM PL MENU",65)

"BLD",8512,"KRN",101,"NM","B","PSJU LM PLDP",66)

"BLD",8512,"KRN",101,"NM","B","PSJU LM PLEUD",67)

"BLD",8512,"KRN",101,"NM","B","PSJU LM PLRP",68)

"BLD",8512,"KRN",101,"NM","B","PSJU LM PLUP",69)

"BLD",8512,"KRN",101,"NM","B","PSJU LM RET",70)

"BLD",8512,"KRN",101,"NM","B","PSJU LM SPEED DISCONTINUE",23)

"BLD",8512,"KRN",101,"NM","B","PSJU LM SPEED FINISH",25)

"BLD",8512,"KRN",101,"NM","B","PSJU LM SPEED RENEW",24)

"BLD",8512,"KRN",101,"NM","B","PSJU LM SPEED VERIFY",26)

"BLD",8512,"KRN",101,"NM","B","PSJU PLATCS",71)

"BLD",8512,"KRN",101,"NM","B","VALM DOWN A LINE",22)

"BLD",8512,"KRN",101,"NM","B","VALM FIRST SCREEN",10)

"BLD",8512,"KRN",101,"NM","B","VALM GOTO PAGE",12)

"BLD",8512,"KRN",101,"NM","B","VALM LAST SCREEN",11)

"BLD",8512,"KRN",101,"NM","B","VALM NEXT SCREEN",6)

"BLD",8512,"KRN",101,"NM","B","VALM PREVIOUS SCREEN",7)

"BLD",8512,"KRN",101,"NM","B","VALM PRINT LIST",15)

"BLD",8512,"KRN",101,"NM","B","VALM PRINT SCREEN",14)

"BLD",8512,"KRN",101,"NM","B","VALM QUIT",17)

"BLD",8512,"KRN",101,"NM","B","VALM REFRESH",13)

"BLD",8512,"KRN",101,"NM","B","VALM SEARCH LIST",16)

"BLD",8512,"KRN",101,"NM","B","VALM TURN ON/OFF MENUS",9)

"BLD",8512,"KRN",101,"NM","B","VALM UP ONE LINE",8)

"BLD",8512,"KRN",409.61,0)
409.61
"BLD",8512,"KRN",409.61,"NM",0)
^9.68A^8^7
"BLD",8512,"KRN",409.61,"NM",1,0)
PSJ LM OE^^0
"BLD",8512,"KRN",409.61,"NM",2,0)
PSJ LM IV OE^^0
"BLD",8512,"KRN",409.61,"NM",4,0)
PSJU LM OE^^0
"BLD",8512,"KRN",409.61,"NM",5,0)
PSJ LM PNV^^0
"BLD",8512,"KRN",409.61,"NM",6,0)
PSJ LM DETAILED ALLERGY^^0
"BLD",8512,"KRN",409.61,"NM",7,0)
PSJ LM OE DISPLAY^^0
"BLD",8512,"KRN",409.61,"NM",8,0)
PSJU LM ACCEPT^^0
"BLD",8512,"KRN",409.61,"NM","B","PSJ LM DETAILED ALLERGY",6)

"BLD",8512,"KRN",409.61,"NM","B","PSJ LM IV OE",2)

"BLD",8512,"KRN",409.61,"NM","B","PSJ LM OE",1)

"BLD",8512,"KRN",409.61,"NM","B","PSJ LM OE DISPLAY",7)

"BLD",8512,"KRN",409.61,"NM","B","PSJ LM PNV",5)

"BLD",8512,"KRN",409.61,"NM","B","PSJU LM ACCEPT",8)

"BLD",8512,"KRN",409.61,"NM","B","PSJU LM OE",4)

"BLD",8512,"KRN",771,0)
771
"BLD",8512,"KRN",771,"NM",0)
^9.68A^^
"BLD",8512,"KRN",779.2,0)
779.2
"BLD",8512,"KRN",870,0)
870
"BLD",8512,"KRN",8989.51,0)
8989.51
"BLD",8512,"KRN",8989.52,0)
8989.52
"BLD",8512,"KRN",8994,0)
8994
"BLD",8512,"KRN","B",.4,.4)

"BLD",8512,"KRN","B",.401,.401)

"BLD",8512,"KRN","B",.402,.402)

"BLD",8512,"KRN","B",.403,.403)

"BLD",8512,"KRN","B",.5,.5)

"BLD",8512,"KRN","B",.84,.84)

"BLD",8512,"KRN","B",3.6,3.6)

"BLD",8512,"KRN","B",3.8,3.8)

"BLD",8512,"KRN","B",9.2,9.2)

"BLD",8512,"KRN","B",9.8,9.8)

"BLD",8512,"KRN","B",19,19)

"BLD",8512,"KRN","B",19.1,19.1)

"BLD",8512,"KRN","B",101,101)

"BLD",8512,"KRN","B",409.61,409.61)

"BLD",8512,"KRN","B",771,771)

"BLD",8512,"KRN","B",779.2,779.2)

"BLD",8512,"KRN","B",870,870)

"BLD",8512,"KRN","B",8989.51,8989.51)

"BLD",8512,"KRN","B",8989.52,8989.52)

"BLD",8512,"KRN","B",8994,8994)

"BLD",8512,"QUES",0)
^9.62^^
"BLD",8512,"REQB",0)
^9.611^8^6
"BLD",8512,"REQB",1,0)
PSS*1.0*169^2
"BLD",8512,"REQB",3,0)
OR*3.0*352^2
"BLD",8512,"REQB",4,0)
PSO*7.0*390^2
"BLD",8512,"REQB",6,0)
PSJ*5.0*270^2
"BLD",8512,"REQB",7,0)
PSJ*5.0*268^2
"BLD",8512,"REQB",8,0)
PSJ*5.0*267^2
"BLD",8512,"REQB","B","OR*3.0*352",3)

"BLD",8512,"REQB","B","PSJ*5.0*267",8)

"BLD",8512,"REQB","B","PSJ*5.0*268",7)

"BLD",8512,"REQB","B","PSJ*5.0*270",6)

"BLD",8512,"REQB","B","PSO*7.0*390",4)

"BLD",8512,"REQB","B","PSS*1.0*169",1)

"KRN",19,588,-1)
2^2
"KRN",19,588,0)
PSJI MGR^IV Menu^^M^11856^^^^^^^115^^1^1
"KRN",19,588,10,0)
^19.01PI^26^26
"KRN",19,588,10,26,0)
14063
"KRN",19,588,10,26,"^")
PSJ CHECK DRUG INTERACTION
"KRN",19,588,"U")
IV MENU
"KRN",19,687,-1)
2^1
"KRN",19,687,0)
PSJU MGR^Unit Dose Medications^^M^11712^^^^^^^117^^1^1
"KRN",19,687,10,0)
^19.01PI^38^38
"KRN",19,687,10,38,0)
14063
"KRN",19,687,10,38,"^")
PSJ CHECK DRUG INTERACTION
"KRN",19,687,"U")
UNIT DOSE MEDICATIONS
"KRN",19,14063,-1)
0^3
"KRN",19,14063,0)
PSJ CHECK DRUG INTERACTION^Check Drug Interaction^^R^^^^^^^^INPATIENT MEDICATIONS
"KRN",19,14063,1,0)
^19.06^2^2^3120104^^^^
"KRN",19,14063,1,1,0)
The PSS CHECK DRUG INTERACTION option will allow a user to check drug 
"KRN",19,14063,1,2,0)
interactions and therapeutic duplications between two or more drugs.
"KRN",19,14063,25)
PSSDGCK^PSJUTL1
"KRN",19,14063,"U")
CHECK DRUG INTERACTION
"KRN",101,1803,-1)
0^6
"KRN",101,1803,0)
VALM NEXT SCREEN^Next Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1803,1,0)
^^2^2^2920519^^^
"KRN",101,1803,1,1,0)
This action will allow the user to view the next screen
"KRN",101,1803,1,2,0)
of entries, if any exist.
"KRN",101,1803,2,0)
^101.02A^1^1
"KRN",101,1803,2,1,0)
NX
"KRN",101,1803,2,"B","NX",1)

"KRN",101,1803,4)

"KRN",101,1803,15)

"KRN",101,1803,20)
D NEXT^VALM4
"KRN",101,1803,99)
62754,41556
"KRN",101,1804,-1)
0^7
"KRN",101,1804,0)
VALM PREVIOUS SCREEN^Previous Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1804,1,0)
^^2^2^2920113^^
"KRN",101,1804,1,1,0)
This action will allow the user to view the previous screen
"KRN",101,1804,1,2,0)
of entries, if any exist.
"KRN",101,1804,2,0)
^101.02A^3^2
"KRN",101,1804,2,1,0)
PR
"KRN",101,1804,2,2,0)
BK
"KRN",101,1804,2,3,0)
PR
"KRN",101,1804,2,"B","BK",2)

"KRN",101,1804,2,"B","PR",1)

"KRN",101,1804,2,"B","PR",3)

"KRN",101,1804,20)
D PREV^VALM4
"KRN",101,1804,99)
62754,41556
"KRN",101,1805,-1)
0^13
"KRN",101,1805,0)
VALM REFRESH^Re-Display Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1805,1,0)
^^1^1^2911024^
"KRN",101,1805,1,1,0)
This actions allows the user to re-display the current screen.
"KRN",101,1805,2,0)
^101.02A^1^1
"KRN",101,1805,2,1,0)
RE
"KRN",101,1805,2,"B","RE",1)

"KRN",101,1805,10,0)
^101.01PA^0^0
"KRN",101,1805,20)
D RE^VALM4
"KRN",101,1805,99)
62754,41556
"KRN",101,1806,-1)
0^11
"KRN",101,1806,0)
VALM LAST SCREEN^Last Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1806,1,0)
^^1^1^2911026^
"KRN",101,1806,1,1,0)
The action will display the last items.
"KRN",101,1806,20)
D LAST^VALM4
"KRN",101,1806,99)
62754,41556
"KRN",101,1807,-1)
0^10
"KRN",101,1807,0)
VALM FIRST SCREEN^First Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1807,1,0)
^^1^1^2960619^^
"KRN",101,1807,1,1,0)
This action will display the first screen.
"KRN",101,1807,15)

"KRN",101,1807,20)
D FIRST^VALM4
"KRN",101,1807,99)
62754,41556
"KRN",101,1808,-1)
0^8
"KRN",101,1808,0)
VALM UP ONE LINE^Up a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,1808,1,0)
^^1^1^2911027^
"KRN",101,1808,1,1,0)
Move up a line
"KRN",101,1808,20)
D UP^VALM40
"KRN",101,1808,99)
62754,41556
"KRN",101,1809,-1)
0^22
"KRN",101,1809,0)
VALM DOWN A LINE^Down a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,1809,1,0)
^^2^2^2950628^^
"KRN",101,1809,1,1,0)
Move down a line.
"KRN",101,1809,1,2,0)

"KRN",101,1809,3,0)
^101.03P^0^0
"KRN",101,1809,20)
D DOWN^VALM40
"KRN",101,1809,99)
62754,41556
"KRN",101,1811,-1)
0^17
"KRN",101,1811,0)
VALM QUIT^Quit^^A^^^^^^^^
"KRN",101,1811,.1)
 
"KRN",101,1811,1,0)
^^1^1^2911105^
"KRN",101,1811,1,1,0)
This protocol can be used as a generic 'quit' action.
"KRN",101,1811,2,0)
^101.02A^2^2
"KRN",101,1811,2,1,0)
EXIT
"KRN",101,1811,2,2,0)
QUIT
"KRN",101,1811,2,"B","EXIT",1)

"KRN",101,1811,2,"B","QUIT",2)

"KRN",101,1811,15)

"KRN",101,1811,20)
Q
"KRN",101,1811,99)
62754,41556
"KRN",101,1812,-1)
0^14
"KRN",101,1812,0)
VALM PRINT SCREEN^Print Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1812,1,0)
^^3^3^2920113^^
"KRN",101,1812,1,1,0)
This action allows the user to print the current List Manager
"KRN",101,1812,1,2,0)
display screen.  The header and the current portion of the
"KRN",101,1812,1,3,0)
list are printed.
"KRN",101,1812,20)
D PRT^VALM1
"KRN",101,1812,99)
62754,41556
"KRN",101,1813,-1)
0^15
"KRN",101,1813,0)
VALM PRINT LIST^Print List^^A^^^^^^^^LIST MANAGER
"KRN",101,1813,1,0)
^^2^2^2920113^
"KRN",101,1813,1,1,0)
This action allws the user to print the entire list of
"KRN",101,1813,1,2,0)
entries currently being displayed.
"KRN",101,1813,20)
D PRTL^VALM1
"KRN",101,1813,99)
62754,41556
"KRN",101,1815,-1)
0^9
"KRN",101,1815,0)
VALM TURN ON/OFF MENUS^Auto-Display(On/Off)^^A^^^^^^^^LIST MANAGER
"KRN",101,1815,20)
D MENU^VALM2
"KRN",101,1815,99)
62754,41556
"KRN",101,1817,-1)
0^16
"KRN",101,1817,0)
VALM SEARCH LIST^Search List^^A^^^^^^^^LIST MANAGER
"KRN",101,1817,1,0)
^^1^1^2920303^^
"KRN",101,1817,1,1,0)
Finds text in list of entries.
"KRN",101,1817,20)
D FIND^VALM40
"KRN",101,1817,99)
62754,41556
"KRN",101,1827,-1)
0^12
"KRN",101,1827,0)
VALM GOTO PAGE^Go to Page^^A^^^^^^^^LIST MANAGER
"KRN",101,1827,1,0)
^^1^1^2930113^
"KRN",101,1827,1,1,0)

"KRN",101,1827,20)
D GOTO^VALM40
"KRN",101,1827,99)
62754,41556
"KRN",101,3850,-1)
0^51
"KRN",101,3850,0)
PSJ LM PATIENT INFO^Patient Information^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3850,4)
^^^AL
"KRN",101,3850,15)
W ""
"KRN",101,3850,20)
D BRFALL^PSJLMUTL(DFN)
"KRN",101,3850,26)

"KRN",101,3850,99)
62754,41556
"KRN",101,3851,-1)
0^50
"KRN",101,3851,0)
PSJ LM PATIENT DATA^Patient Record Update^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3851,1,0)
^^2^2^2961230^^
"KRN",101,3851,1,1,0)
Allows the user to add/edit INPATIENT NARRATIVE and UD DEFAULT STOP
"KRN",101,3851,1,2,0)
DATE/TIME.
"KRN",101,3851,4)
36^4
"KRN",101,3851,15)
S VALMBCK="R"
"KRN",101,3851,20)
D UPR^PSJLMUTL(DFN)
"KRN",101,3851,26)
D HDR^PSJLMHED(DFN)
"KRN",101,3851,99)
62754,41556
"KRN",101,3852,-1)
0^53
"KRN",101,3852,0)
PSJ LM SELECT ORDER^Select Order^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3852,4)
26^4^^SO
"KRN",101,3852,10,0)
^101.01PA^0^0
"KRN",101,3852,15)
D KILL^PSJBCMA5(+$G(PSJSYSP))
"KRN",101,3852,20)
K ^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP)) D SELECT^PSJOE
"KRN",101,3852,99)
62754,41556
"KRN",101,3853,-1)
0^46
"KRN",101,3853,0)
PSJ LM NEW ORDER^New Order Entry^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3853,1,0)
^101.06^2^2^3120118^^^^
"KRN",101,3853,1,1,0)
Allows the user to enter a new order for the selected patient without
"KRN",101,3853,1,2,0)
seeing a medication profile.
"KRN",101,3853,4)
26^4
"KRN",101,3853,15)
D KILL^PSJBCMA5(+$G(PSJSYSP)) I PSJLK S X=DFN_";DPT(" D ULK^ORX2 S VALMBCK="Q"
"KRN",101,3853,20)
K PSJSTARI,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP)) D HOLDHDR^PSJOE K PSJLK S X=DFN_";DPT(" D LK^ORX2 S PSJLK=Y I Y D LMNEW^PSJOE0(DFN,PSJPROT)
"KRN",101,3853,99)
62754,41556
"KRN",101,3859,-1)
0^38
"KRN",101,3859,0)
PSJ LM BRIEF PATIENT INFO MENU^Brief Allergy Display^^M^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3859,1,0)
^^4^4^2961230^^
"KRN",101,3859,1,1,0)
Displays a brief version of the patient's allergy information and
"KRN",101,3859,1,2,0)
allows the user access to update patient information, enter new orders,
"KRN",101,3859,1,3,0)
enter a pharmacy intervention, show a profile or display a detailed
"KRN",101,3859,1,4,0)
view of allergy information.
"KRN",101,3859,4)
29^3
"KRN",101,3859,10,0)
^101.01PA^6^6
"KRN",101,3859,10,1,0)
3851^PU^11^
"KRN",101,3859,10,1,"^")
PSJ LM PATIENT DATA
"KRN",101,3859,10,3,0)
3853^NO^21^
"KRN",101,3859,10,3,"^")
PSJ LM NEW ORDER
"KRN",101,3859,10,4,0)
3918^IN^22^^^Intervention Menu
"KRN",101,3859,10,4,"^")
PSJ LM PHARMACY INTERVENTION MENU
"KRN",101,3859,10,5,0)
3861^VP^13^
"KRN",101,3859,10,5,"^")
PSJ LM SHOW PROFILE
"KRN",101,3859,10,6,0)
3860^DA^12^
"KRN",101,3859,10,6,"^")
PSJ LM DETAILED ALLERGY
"KRN",101,3859,15)

"KRN",101,3859,24)
I $S($G(PSJHIDFG):$$ACT^PSJLIUTL,1:$$PATINFO^PSJLMUTL)
"KRN",101,3859,26)
D A^PSJ200(21,18),SHOW^VALM S:'$D(PSJLMPRO) XQORM("B")="View Profile"
"KRN",101,3859,28)
Select Action: 
"KRN",101,3859,99)
62754,41556
"KRN",101,3860,-1)
0^29
"KRN",101,3860,0)
PSJ LM DETAILED ALLERGY^Detailed Allergy/ADR List^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3860,1,0)
^^2^2^2961230^
"KRN",101,3860,1,1,0)
Allows the user to view a detailed allergy display for the selected
"KRN",101,3860,1,2,0)
patient.
"KRN",101,3860,4)
36^4
"KRN",101,3860,10,0)
^101.01PA^0^0
"KRN",101,3860,15)
D EXIT^PSJLMDA S VALMBCK="R"
"KRN",101,3860,20)
D EN^PSJLMDA
"KRN",101,3860,26)

"KRN",101,3860,99)
62754,41556
"KRN",101,3861,-1)
0^54
"KRN",101,3861,0)
PSJ LM SHOW PROFILE^View Profile^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3861,1,0)
^101.06^2^2^3120105^^^^
"KRN",101,3861,1,1,0)
Allows the user to choose to display a short, long, or no medication
"KRN",101,3861,1,2,0)
profile for the selected patient.
"KRN",101,3861,4)

"KRN",101,3861,15)
S VALMBCK="Q" K ^PS(53.45,+$G(DUZ),5),^PS(53.45,+$G(DUZ),6)
"KRN",101,3861,20)
K ^PS(53.45,+$G(DUZ),5),^PS(53.45,+$G(DUZ),6) D ENL^PSJO3 I "LSN"[PSJOL S PSJLMCON=1
"KRN",101,3861,24)
B
"KRN",101,3861,30)
.
"KRN",101,3861,99)
62754,41556
"KRN",101,3885,-1)
0^18
"KRN",101,3885,0)
PSJ LM MAR MENU^MAR Menu^^M^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3885,1,0)
^^2^2^2961230^^
"KRN",101,3885,1,1,0)
This menu allows the user a choice of different Medication
"KRN",101,3885,1,2,0)
Administration Reports.
"KRN",101,3885,4)
80^^^MAR
"KRN",101,3885,10,0)
^101.01PA^13^13
"KRN",101,3885,10,10,0)
3901^24^11^
"KRN",101,3885,10,10,"^")
PSJ LM 24H MAR
"KRN",101,3885,10,11,0)
3902^7^12^
"KRN",101,3885,10,11,"^")
PSJ LM 7D MAR
"KRN",101,3885,10,12,0)
3903^14^13^
"KRN",101,3885,10,12,"^")
PSJ LM 14D MAR
"KRN",101,3885,10,13,0)
3930^MD^14^
"KRN",101,3885,10,13,"^")
PSJ LM MDWS
"KRN",101,3885,15)
D RESTORE^PSJHVARS S VALMBCK="R"
"KRN",101,3885,20)
D ^PSJHVARS
"KRN",101,3885,24)

"KRN",101,3885,99)
62754,41556
"KRN",101,3886,-1)
0^32
"KRN",101,3886,0)
PSJ LM PROFILE MENU^Patient Profiles^^M^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3886,1,0)
^^2^2^2960404^^^^
"KRN",101,3886,1,1,0)
This menu gives access to the Inpatient Medications Profile, the IV
"KRN",101,3886,1,2,0)
Medications Profile, and the Unit Dose Medications Profile.
"KRN",101,3886,4)
40
"KRN",101,3886,10,0)
^101.01PA^11^11
"KRN",101,3886,10,5,0)
3904^IP^11^
"KRN",101,3886,10,5,"^")
PSJ LM PAT PR
"KRN",101,3886,10,6,0)
3905^IV^12^
"KRN",101,3886,10,6,"^")
PSJI LM PAT PR
"KRN",101,3886,10,7,0)
3906^UD^13^
"KRN",101,3886,10,7,"^")
PSJU LM PAT PR
"KRN",101,3886,10,8,0)
3924^AP1^21^
"KRN",101,3886,10,8,"^")
PSJ LM AP1
"KRN",101,3886,10,9,0)
3925^AP2^22^
"KRN",101,3886,10,9,"^")
PSJ LM AP2
"KRN",101,3886,10,10,0)
3926^EX^23^
"KRN",101,3886,10,10,"^")
PSJ LM EXTP
"KRN",101,3886,10,11,0)
3941^OP^14^
"KRN",101,3886,10,11,"^")
PSJ LM PRINT OUTPATIENT PROFILE
"KRN",101,3886,15)
D RESTORE^PSJHVARS S VALMBCK="R"
"KRN",101,3886,20)
D ^PSJHVARS
"KRN",101,3886,99)
62754,41557
"KRN",101,3887,-1)
0^60
"KRN",101,3887,0)
PSJI LM RETURNS^Returns/Destroyed Entry (IV)^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3887,1,0)
^^2^2^2961230^^
"KRN",101,3887,1,1,0)
This option allows the entry of returned, recycled, canceled, or
"KRN",101,3887,1,2,0)
destroyed items per day in IV room or satellite.  
"KRN",101,3887,15)
S VALMBCK="R"
"KRN",101,3887,20)
N PSJLMPRO D FULL^VALM1,^PSIVRD
"KRN",101,3887,99)
62754,41556
"KRN",101,3888,-1)
0^70
"KRN",101,3888,0)
PSJU LM RET^Report Returns (UD)^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3888,1,0)
^^3^3^2961230^^
"KRN",101,3888,1,1,0)
This option allows a user to enter the units of returned medication
"KRN",101,3888,1,2,0)
(as when a patient is discharged) into the medication order record.
"KRN",101,3888,1,3,0)
Data entered is used in the cost reports.
"KRN",101,3888,15)
S VALMBCK="R"
"KRN",101,3888,20)
N VAIN,VADM K PSGEFN D FULL^VALM1,^PSGRET
"KRN",101,3888,99)
62754,41556
"KRN",101,3889,-1)
0^31
"KRN",101,3889,0)
PSJ LM RETURNS/DESTROYED MENU^Returns/Destroyed Menu^^M^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3889,1,0)
^^2^2^2961230^^
"KRN",101,3889,1,1,0)
This menu allows the user access to the Report Returns (UD) option
"KRN",101,3889,1,2,0)
and the Returns/Destroyed Entry (IV) option.
"KRN",101,3889,4)
40
"KRN",101,3889,10,0)
^101.01PA^2^2
"KRN",101,3889,10,1,0)
3887^RD^21^
"KRN",101,3889,10,1,"^")
PSJI LM RETURNS
"KRN",101,3889,10,2,0)
3888^RR^11^
"KRN",101,3889,10,2,"^")
PSJU LM RET
"KRN",101,3889,15)
S VALMBCK="R" K PSJHIDFG
"KRN",101,3889,20)
S PSJHIDFG=1
"KRN",101,3889,99)
62754,41556
"KRN",101,3890,-1)
0^66
"KRN",101,3890,0)
PSJU LM PLDP^Enter Units Dispensed^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3890,1,0)
^^5^5^2961230^^^
"KRN",101,3890,1,1,0)
Allows the user to enter the units actually dispensed into the cart for
"KRN",101,3890,1,2,0)
which the respective pick list was run.  This option allows the user
"KRN",101,3890,1,3,0)
to select only those pick lists which have not already been filed away.
"KRN",101,3890,1,4,0)
From here, the user may then file the pick list away, a process that makes
"KRN",101,3890,1,5,0)
the data usable for the cost reports.
"KRN",101,3890,15)
S VALMBCK="R"
"KRN",101,3890,20)
N VAIN,VADM D FULL^VALM1,^PSGPLDP
"KRN",101,3890,99)
62754,41556
"KRN",101,3891,-1)
0^67
"KRN",101,3891,0)
PSJU LM PLEUD^Extra Units Dispensed^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3891,1,0)
^^2^2^2960405^^
"KRN",101,3891,1,1,0)
Allows a pharmacist to enter the number of any extra units dispensed for
"KRN",101,3891,1,2,0)
a Unit Dose order.  Any data entered here is used by the cost reports.
"KRN",101,3891,15)
S VALMBCK="R"
"KRN",101,3891,20)
N VAIN,VADM K PSGEFN D FULL^VALM1,^PSGEUD
"KRN",101,3891,99)
62754,41556
"KRN",101,3892,-1)
0^64
"KRN",101,3892,0)
PSJU LM PL^Pick List^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3892,1,0)
^^6^6^2960405^
"KRN",101,3892,1,1,0)
The Pick List is used by pharmacy when filling medication carts.  The
"KRN",101,3892,1,2,0)
list is sorted by administering team, ward, room-bed, and then patient.
"KRN",101,3892,1,3,0)
The site may define ward groups and generate the pick list by these
"KRN",101,3892,1,4,0)
groups to match site-specific filling practices.  The pick list will
"KRN",101,3892,1,5,0)
calculate the units needed to be dispensed for selected patients' orders
"KRN",101,3892,1,6,0)
over a selected date range.
"KRN",101,3892,15)
S VALMBCK="R"
"KRN",101,3892,20)
N VAIN,VADM D FULL^VALM1,^PSGPL
"KRN",101,3892,99)
62754,41556
"KRN",101,3893,-1)
0^65
"KRN",101,3893,0)
PSJU LM PL MENU^Pick List Menu^^M^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3893,1,0)
^^2^2^2961230^^
"KRN",101,3893,1,1,0)
Contains various functions related to the Unit Dose pick list, mainly
"KRN",101,3893,1,2,0)
removing pick lists from the system.
"KRN",101,3893,4)
40
"KRN",101,3893,10,0)
^101.01PA^7^7
"KRN",101,3893,10,1,0)
3890^EN^11^
"KRN",101,3893,10,1,"^")
PSJU LM PLDP
"KRN",101,3893,10,2,0)
3891^EX^12^
"KRN",101,3893,10,2,"^")
PSJU LM PLEUD
"KRN",101,3893,10,3,0)
3892^PL^13^
"KRN",101,3893,10,3,"^")
PSJU LM PL
"KRN",101,3893,10,4,0)
3888^RRS^14^^^Report Returns
"KRN",101,3893,10,4,"^")
PSJU LM RET
"KRN",101,3893,10,5,0)
3927^RPL^21^
"KRN",101,3893,10,5,"^")
PSJU LM PLRP
"KRN",101,3893,10,6,0)
3928^SND^22^
"KRN",101,3893,10,6,"^")
PSJU PLATCS
"KRN",101,3893,10,7,0)
3929^UP^23^
"KRN",101,3893,10,7,"^")
PSJU LM PLUP
"KRN",101,3893,15)
D RESTORE^PSJHVARS S VALMBCK="R"
"KRN",101,3893,20)
D ^PSJHVARS
"KRN",101,3893,99)
62754,41556
"KRN",101,3894,-1)
0^62
"KRN",101,3894,0)
PSJU LM LABEL^Label Print/Reprint^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3894,1,0)
^^2^2^2961230^
"KRN",101,3894,1,1,0)
Allows the user to print new unprinted labels and/or reprint the
"KRN",101,3894,1,2,0)
latest label for any order containing a label record.
"KRN",101,3894,15)
S VALMBCK="R"
"KRN",101,3894,20)
N VAIN,VADM K PSGEFN D FULL^VALM1,^PSGL
"KRN",101,3894,99)
62754,41556
"KRN",101,3895,-1)
0^61
"KRN",101,3895,0)
PSJU LM AL^Align Labels (Unit Dose)^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3895,1,0)
^^2^2^2961230^
"KRN",101,3895,1,1,0)
Allows the user to align the label stock on a printer so that Unit Dose
"KRN",101,3895,1,2,0)
order information will print within the physical boundaries of the label.
"KRN",101,3895,15)
S VALMBCK="R"
"KRN",101,3895,20)
N VAIN,VADM D FULL^VALM1,ENAL^PSGLBA
"KRN",101,3895,99)
62754,41556
"KRN",101,3896,-1)
0^55
"KRN",101,3896,0)
PSJI LM ALIGNMENT^Align Labels (IV)^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3896,1,0)
^^2^2^2961230^
"KRN",101,3896,1,1,0)
This option allows the user to align the labels on whatever printer
"KRN",101,3896,1,2,0)
he/she is preparing to print.  Three test labels will always print.
"KRN",101,3896,15)
S VALMBCK="R"
"KRN",101,3896,20)
N VAIN,VADM D FULL^VALM1,^PSIVXU Q:$D(XQUIT)  D ^PSIVALN,ENIVKV^PSGSETU K I,Z,ZISI
"KRN",101,3896,99)
62754,41556
"KRN",101,3897,-1)
0^56
"KRN",101,3897,0)
PSJI LM LBLI^Individual Labels (IV)^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3897,1,0)
^^4^4^2961230^
"KRN",101,3897,1,1,0)
This option allows the printing of labels for a patient's order.
"KRN",101,3897,1,2,0)
The user may choose whether or not the labels are to be counted
"KRN",101,3897,1,3,0)
as daily usage.  This is often used for on-call orders or those
"KRN",101,3897,1,4,0)
not automatically delivered without a written request.
"KRN",101,3897,15)
S VALMBCK="R" K PSJHIDFG
"KRN",101,3897,20)
S PSJHIDFG=1 N PSJLMPRO D ^PSIVXU Q:$D(XQUIT)  S PSIVAC="PROL",PSIVBR="D ENLBLI^PSIVLBL1" D FULL^VALM1,ENCHS^PSIV,ENIVKV^PSGSETU K J,N,J2,P17,PS,PSIVAC,PSIVBR,PSIVCT,PSIVNOL,PSIVNOW,TN,ZQ7
"KRN",101,3897,24)

"KRN",101,3897,99)
62754,41556
"KRN",101,3898,-1)
0^58
"KRN",101,3898,0)
PSJI LM LBLS^Scheduled Labels (IV)^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3898,1,0)
^^6^6^2961230^
"KRN",101,3898,1,1,0)
This option prints labels for a particular scheduled manufacturing
"KRN",101,3898,1,2,0)
time.  Usually a manufacturing list has been run prior to the
"KRN",101,3898,1,3,0)
printing of the labels.  If this has been done, the labels will print
"KRN",101,3898,1,4,0)
immediately and in the same order as on the manufacturing list.
"KRN",101,3898,1,5,0)
The use of this option also causes workload counts in the IV
"KRN",101,3898,1,6,0)
STATS file.
"KRN",101,3898,15)
K I1 S VALMBCK="R"
"KRN",101,3898,20)
N VAIN,VADM D ^PSIVXU Q:$D(XQUIT)  D FULL^VALM1,^PSIVLBL1,ENIVKV^PSGSETU
"KRN",101,3898,99)
62754,41556
"KRN",101,3899,-1)
0^57
"KRN",101,3899,0)
PSJI LM LBLR^Reprint Scheduled Labels (IV)^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3899,1,0)
^^7^7^2961230^
"KRN",101,3899,1,1,0)
This option allows the user to reprint IV labels which failed to
"KRN",101,3899,1,2,0)
print during the running of the Scheduled Labels (IV) option
"KRN",101,3899,1,3,0)
(PSJI LBLS).  This option may not be used to reprint labels
"KRN",101,3899,1,4,0)
for dates and IV type which printing has not been attempted
"KRN",101,3899,1,5,0)
through the Scheduled Labels (IV) option. Labels prepared
"KRN",101,3899,1,6,0)
with this option will only be counted as usage if they were not
"KRN",101,3899,1,7,0)
added during the running of Scheduled Labels.
"KRN",101,3899,15)
K I1 S VALMBCK="R"
"KRN",101,3899,20)
N VAIN,VADM D FULL^VALM1,^PSIVRP
"KRN",101,3899,99)
62754,41556
"KRN",101,3900,-1)
0^19
"KRN",101,3900,0)
PSJ LM LABEL PRINT/REPRINT MENU^Label Print/Reprint^^M^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3900,1,0)
^^2^2^2961230^^^^
"KRN",101,3900,1,1,0)
Allows the user access to label options to print or reprint unit dose
"KRN",101,3900,1,2,0)
and IV labels, as well as the alignment options for each label type.
"KRN",101,3900,4)
40
"KRN",101,3900,10,0)
^101.01PA^18^18
"KRN",101,3900,10,13,0)
3895^ALUD^11^
"KRN",101,3900,10,13,"^")
PSJU LM AL
"KRN",101,3900,10,14,0)
3894^LPUD^12^
"KRN",101,3900,10,14,"^")
PSJU LM LABEL
"KRN",101,3900,10,15,0)
3896^ALIV^21^
"KRN",101,3900,10,15,"^")
PSJI LM ALIGNMENT
"KRN",101,3900,10,16,0)
3897^ILIV^22^
"KRN",101,3900,10,16,"^")
PSJI LM LBLI
"KRN",101,3900,10,17,0)
3898^SLIV^23^
"KRN",101,3900,10,17,"^")
PSJI LM LBLS
"KRN",101,3900,10,18,0)
3899^RSIV^24^
"KRN",101,3900,10,18,"^")
PSJI LM LBLR
"KRN",101,3900,15)
S VALMBCK="R" D RESTORE^PSJHVARS
"KRN",101,3900,20)
D ^PSJHVARS N DRG
"KRN",101,3900,24)

"KRN",101,3900,99)
62754,41556
"KRN",101,3901,-1)
0^34
"KRN",101,3901,0)
PSJ LM 24H MAR^24 Hour MAR^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3901,1,0)
^^5^5^2960404^^^^
"KRN",101,3901,1,1,0)
This allows the user to print a selected patient's medication orders
"KRN",101,3901,1,2,0)
on a Medication Administration Record (MAR) for the charting of the
"KRN",101,3901,1,3,0)
administration of the orders over a 24 hour period. It is designed to
"KRN",101,3901,1,4,0)
replace the manual Continuing Medication Record (CMR).
"KRN",101,3901,1,5,0)
This protocol assumes that a patient has already been selected.
"KRN",101,3901,15)
S VALMBCK="R"
"KRN",101,3901,20)
N VAIN,VADM D FULL^VALM1,ENLM^PSGMAR
"KRN",101,3901,99)
62754,41556
"KRN",101,3902,-1)
0^35
"KRN",101,3902,0)
PSJ LM 7D MAR^7 Day MAR^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3902,1,0)
^^5^5^2960404^^^
"KRN",101,3902,1,1,0)
This allows the user to print a selected patient's medication orders
"KRN",101,3902,1,2,0)
on a Medication Administration Record (MAR) for the charting of the
"KRN",101,3902,1,3,0)
administration of the orders over a 7 day period. It is designed to
"KRN",101,3902,1,4,0)
replace the manual Continuing Medication Record (CMR).
"KRN",101,3902,1,5,0)
This protocol assumes that a patient has already been selected.
"KRN",101,3902,15)
S VALMBCK="R"
"KRN",101,3902,20)
N VAIN,VADM S PSGMARDF=7 D FULL^VALM1,ENLM^PSGMMAR
"KRN",101,3902,99)
62754,41556
"KRN",101,3903,-1)
0^33
"KRN",101,3903,0)
PSJ LM 14D MAR^14 Day MAR^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3903,1,0)
^^5^5^2960404^^
"KRN",101,3903,1,1,0)
This allows the user to print a selected patient's medication orders on
"KRN",101,3903,1,2,0)
a Medication Administration Record (MAR) for the charting of the
"KRN",101,3903,1,3,0)
administration of the orders over a 14 day period. It is designed to
"KRN",101,3903,1,4,0)
replace the manual Continuing Medication Record (CMR).
"KRN",101,3903,1,5,0)
This protocol assumes that a patient has already been selected.
"KRN",101,3903,15)
S VALMBCK="R"
"KRN",101,3903,20)
N VADM,VAIN S PSGMARDF=14 D FULL^VALM1,ENLM^PSGMMAR
"KRN",101,3903,99)
62754,41556
"KRN",101,3904,-1)
0^49
"KRN",101,3904,0)
PSJ LM PAT PR^Inpatient Medications Profile^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3904,1,0)
^^2^2^2960404^^^
"KRN",101,3904,1,1,0)
This allows the user to print Inpatient Medications orders for a selected
"KRN",101,3904,1,2,0)
patient.  This protocol assumes that the patient has already been selected.
"KRN",101,3904,15)
S VALMBCK="R"
"KRN",101,3904,20)
N VAIN,VADM,PSJLM D FULL^VALM1,ENOR^PSJPR(PSGP)
"KRN",101,3904,99)
62754,41556
"KRN",101,3905,-1)
0^59
"KRN",101,3905,0)
PSJI LM PAT PR^IV Medications Profile^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3905,1,0)
^^4^4^2960124^^^
"KRN",101,3905,1,1,0)
This will allow a patient's IV profile to be sent to a printer.  With
"KRN",101,3905,1,2,0)
each profile printed, a view of each order within the profile can also
"KRN",101,3905,1,3,0)
be printed.  This protocol assumes that a patient has already been
"KRN",101,3905,1,4,0)
selected.
"KRN",101,3905,15)
S VALMBCK="R"
"KRN",101,3905,20)
N VAIN,VADM,PSJLM D FULL^VALM1,ENLM^PSIVPR
"KRN",101,3905,99)
62754,41556
"KRN",101,3906,-1)
0^63
"KRN",101,3906,0)
PSJU LM PAT PR^Unit Dose Medications Profile^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3906,1,0)
^^6^6^2960122^
"KRN",101,3906,1,1,0)
This allows the user to print to any device a profile (list) of a patient's
"KRN",101,3906,1,2,0)
Unit Dose orders for the patient's current or last (if patient has been
"KRN",101,3906,1,3,0)
discharged) admission.  If the user's terminal is selected as the printing
"KRN",101,3906,1,4,0)
device, this option will allow the user to select any of the printed orders
"KRN",101,3906,1,5,0)
to be shown in complete detail, including activity logs, if any.  This
"KRN",101,3906,1,6,0)
protocol assumes that a patient has already been selected.
"KRN",101,3906,15)
S VALMBCK="R"
"KRN",101,3906,20)
N VADM,VAIN,PSJLM D FULL^VALM1,ENLM^PSGPR
"KRN",101,3906,99)
62754,41556
"KRN",101,3907,-1)
0^20
"KRN",101,3907,0)
PSJ LM PNV JUMP^Jump to a Patient^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3907,1,0)
^^2^2^2960125^
"KRN",101,3907,1,1,0)
Used to allow user to skip to a specific patient in the list of pending/non-
"KRN",101,3907,1,2,0)
verified orders selected in PSJU VBW
"KRN",101,3907,15)

"KRN",101,3907,20)
D FULL^VALM1,GOTOP^PSGVBWU
"KRN",101,3907,99)
62754,41556
"KRN",101,3908,-1)
0^47
"KRN",101,3908,0)
PSJ LM NEW ORDER FROM PROFILE^New Order Entry^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3908,1,0)
^101.06^2^2^3120118^^^^
"KRN",101,3908,1,1,0)
This is used to create new Inpatient Medication orders from the profile
"KRN",101,3908,1,2,0)
list. 
"KRN",101,3908,15)
D KILL^PSJBCMA5(+$G(PSJSYSP)) I PSJLK S X=DFN_";DPT(" D ULK^ORX2 D INIT^PSJLMHED(PSJPROT) S VALMBCK="Q"
"KRN",101,3908,20)
K PSJSTARI,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP)) K PSJLK S X=DFN_";DPT(" D LK^ORX2 S PSJLK=Y I Y D LMNEW^PSJOE0(DFN,PSJPROT)
"KRN",101,3908,99)
62754,41556
"KRN",101,3909,-1)
2^21
"KRN",101,3909,0)
PSJ LM OTHER PHARMACY OPTIONS^Other Pharmacy Options^^M^11922^^^^^^^197
"KRN",101,3909,10,0)
^101.01PA^9^9
"KRN",101,3909,10,7,0)
3893^PIC^12^
"KRN",101,3909,10,7,"^")
PSJU LM PL MENU
"KRN",101,3909,10,8,0)
3889^RET^13^
"KRN",101,3909,10,8,"^")
PSJ LM RETURNS/DESTROYED MENU
"KRN",101,3909,10,9,0)
3886^PRO^22^
"KRN",101,3909,10,9,"^")
PSJ LM PROFILE MENU
"KRN",101,3911,-1)
0^25
"KRN",101,3911,0)
PSJU LM SPEED FINISH^Speed Finish^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3911,1,0)
^101.06^2^2^3090326^^^^
"KRN",101,3911,1,1,0)
This protocol will allow a user to finish multiple orders for a patient
"KRN",101,3911,1,2,0)
which are in a pending renewal status without all the usual prompts.
"KRN",101,3911,15)
D RESTORE^PSJHVARS S VALMBCK="Q"
"KRN",101,3911,20)
D ^PSJHVARS D EN^PSGOESF
"KRN",101,3911,99)
62754,41556
"KRN",101,3912,-1)
0^24
"KRN",101,3912,0)
PSJU LM SPEED RENEW^Speed Renew^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3912,1,0)
^^1^1^2960718^^
"KRN",101,3912,1,1,0)
This protocol will allow a user to renew multiple orders for a patient.
"KRN",101,3912,15)
D RESTORE^PSJHVARS S VALMBCK="Q"
"KRN",101,3912,20)
D ^PSJHVARS D EN^PSGOERS
"KRN",101,3912,99)
62754,41556
"KRN",101,3913,-1)
0^23
"KRN",101,3913,0)
PSJU LM SPEED DISCONTINUE^Speed Discontinue^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3913,1,0)
^^2^2^2960729^^^
"KRN",101,3913,1,1,0)
This protocol will allow a user to discontinue multiple medication orders
"KRN",101,3913,1,2,0)
for a patient.
"KRN",101,3913,15)
D RESTORE^PSJHVARS S VALMBCK="Q"
"KRN",101,3913,20)
D ^PSJHVARS D:'$G(PSJHIDFG) EN^PSGOECS
"KRN",101,3913,24)

"KRN",101,3913,99)
62754,41556
"KRN",101,3916,-1)
2^48
"KRN",101,3916,0)
PSJ LM OE MENU^ORDER ENTRY MENU^^M^11922^^^^^^^197
"KRN",101,3916,10,0)
^101.01PA^5^4
"KRN",101,3916,10,1,0)
3850^PI^11^
"KRN",101,3916,10,1,"^")
PSJ LM PATIENT INFO
"KRN",101,3916,10,2,0)
3851^PU^12^
"KRN",101,3916,10,2,"^")
PSJ LM PATIENT DATA
"KRN",101,3916,10,3,0)
3852^SO^31^
"KRN",101,3916,10,3,"^")
PSJ LM SELECT ORDER
"KRN",101,3916,10,5,0)
3908^NO^32^
"KRN",101,3916,10,5,"^")
PSJ LM NEW ORDER FROM PROFILE
"KRN",101,3918,-1)
0^28
"KRN",101,3918,0)
PSJ LM PHARMACY INTERVENTION MENU^Intervention Menu^^M^^PSJ RPHARM^^^^^^INPATIENT MEDICATIONS
"KRN",101,3918,1,0)
^101.06^1^1^3111214^^^^
"KRN",101,3918,1,1,0)
This is the main menu for the Pharmacy Intervention options.
"KRN",101,3918,4)
40
"KRN",101,3918,10,0)
^101.01PA^20^20
"KRN",101,3918,10,16,0)
3922^DI^10^
"KRN",101,3918,10,16,"^")
PSJ LM INTERVENTION DELETE
"KRN",101,3918,10,17,0)
3920^ED^15^
"KRN",101,3918,10,17,"^")
PSJ LM INTERVENTION EDIT
"KRN",101,3918,10,18,0)
3919^NE^20^
"KRN",101,3918,10,18,"^")
PSJ LM INTERVENTION NEW ENTRY
"KRN",101,3918,10,19,0)
3921^PO^25^
"KRN",101,3918,10,19,"^")
PSJ LM INTERVENTION PRINTOUT
"KRN",101,3918,10,20,0)
3923^VP^30^
"KRN",101,3918,10,20,"^")
PSJ LM INTERVENTION VIEW
"KRN",101,3918,15)
S VALMBCK="R"
"KRN",101,3918,99)
62754,41556
"KRN",101,3919,-1)
0^42
"KRN",101,3919,0)
PSJ LM INTERVENTION NEW ENTRY^Enter Pharmacy Intervention^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3919,1,0)
^^2^2^2971209^^^^
"KRN",101,3919,1,1,0)
This option is used to enter an entry into the APSP INTERVENTION file
"KRN",101,3919,1,2,0)
(#32.4).
"KRN",101,3919,15)
S VALMBCK="R"
"KRN",101,3919,20)
D FULL^VALM1 F I=0:0 S DIC(0)="QEAML",DLAYGO=9009032.4,DIC="^APSPQA(32.4,",DIADD="" D ^DIC K DA,DR,DIADD K:Y=-1 X,DIC,DIADD,DA,DIE Q:Y=-1  S DA=+Y,DIE=DIC,DR="[PSO INTERVENTION NEW]" K DIC D ^DIE
"KRN",101,3919,99)
62754,41556
"KRN",101,3920,-1)
0^41
"KRN",101,3920,0)
PSJ LM INTERVENTION EDIT^Edit Pharmacy Intervention^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3920,1,0)
^^2^2^2960403^
"KRN",101,3920,1,1,0)
This option is used to edit an already existing entry in the APSP
"KRN",101,3920,1,2,0)
INTERVENTION file (#32.4).
"KRN",101,3920,15)
S VALMBCK="R"
"KRN",101,3920,20)
D FULL^VALM1 F I=0:0 S DIC(0)="QEAM",DIC="^APSPQA(32.4,",DIC("A")="Select INTERVENTION:" D ^DIC K:Y=-1 X,DIC,DA,DIE Q:Y=-1  S DA=+Y,DIE=DIC,DR="[PSO INTERVENTION EDIT]" D ^DIE
"KRN",101,3920,99)
62754,41556
"KRN",101,3921,-1)
0^43
"KRN",101,3921,0)
PSJ LM INTERVENTION PRINTOUT^Print Pharmacy Intervention^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3921,1,0)
^^3^3^2960403^
"KRN",101,3921,1,1,0)
This option is used to obtain a captioned printout of Pharmacy Interventions
"KRN",101,3921,1,2,0)
for a certain date range.  It will print out on normal width paper and can
"KRN",101,3921,1,3,0)
be queued to print at a later time.
"KRN",101,3921,15)
S VALMBCK="R"
"KRN",101,3921,20)
D FULL^VALM1 S L=0,DIC="^APSPQA(32.4,",FLDS="[PSO INTERVENTIONS]",BY="[PSO INTERVENTIONS]" D EN1^DIP K L,DIC,FLDS,BY,Y
"KRN",101,3921,99)
62754,41556
"KRN",101,3922,-1)
0^40
"KRN",101,3922,0)
PSJ LM INTERVENTION DELETE^Delete Pharmacy Intervention^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3922,1,0)
^^3^3^2960403^
"KRN",101,3922,1,1,0)
This option is used to delete an intervention from the APSP INTERVENTION
"KRN",101,3922,1,2,0)
file (#32.4).  You may only delete an intervention that was entered on
"KRN",101,3922,1,3,0)
the same day.
"KRN",101,3922,15)
S VALMBCK="R"
"KRN",101,3922,20)
D FULL^VALM1,^PSODELI
"KRN",101,3922,99)
62754,41556
"KRN",101,3923,-1)
0^44
"KRN",101,3923,0)
PSJ LM INTERVENTION VIEW^View Pharmacy Intervention^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3923,1,0)
^^2^2^2960403^
"KRN",101,3923,1,1,0)
This option is used to display Pharmacy Interventions in a captioned
"KRN",101,3923,1,2,0)
format.  You may view more than one intervention at a time.
"KRN",101,3923,15)
S VALMBCK="R"
"KRN",101,3923,20)
D FULL^VALM1 S PSOVWI("DIC")="^APSPQA(32.4," D ^PSOVWI
"KRN",101,3923,99)
62754,41556
"KRN",101,3924,-1)
0^36
"KRN",101,3924,0)
PSJ LM AP1^Action Profile #1^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3924,1,0)
^^4^4^2961230^^
"KRN",101,3924,1,1,0)
Allows the user to print a profile of patients' active orders for 
"KRN",101,3924,1,2,0)
review by the physician.  Includes places for the physician to mark
"KRN",101,3924,1,3,0)
each order and sign the profile.  When possible, space is included
"KRN",101,3924,1,4,0)
for new orders.  
"KRN",101,3924,15)
S VALMBCK="R"
"KRN",101,3924,20)
N VADM,VAIN D FULL^VALM1,ENLM^PSGAP
"KRN",101,3924,99)
62754,41556
"KRN",101,3925,-1)
0^37
"KRN",101,3925,0)
PSJ LM AP2^Action Profile #2^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3925,1,0)
^^6^6^2961230^^
"KRN",101,3925,1,1,0)
Allows the user to print a profile of patients' active orders for
"KRN",101,3925,1,2,0)
review by the physician.  Includes places for the physician to mark
"KRN",101,3925,1,3,0)
each order and sign the profile.  When possible, space is included
"KRN",101,3925,1,4,0)
for new orders.
"KRN",101,3925,1,5,0)
The user may choose to print all active orders or expiring orders
"KRN",101,3925,1,6,0)
only.
"KRN",101,3925,15)
S VALMBCK="R"
"KRN",101,3925,20)
N VADM,VAIN D FULL^VALM1,ENLM^PSGCAP
"KRN",101,3925,99)
62754,41556
"KRN",101,3926,-1)
0^39
"KRN",101,3926,0)
PSJ LM EXTP^Patient Profile (Extended)^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3926,1,0)
^^3^3^2961230^^^
"KRN",101,3926,1,1,0)
This report allows viewing all of the orders on file for a patient (not
"KRN",101,3926,1,2,0)
just since last discharge).  All orders that have not been purged can be
"KRN",101,3926,1,3,0)
viewed, or a date entered to start searching forward from.  
"KRN",101,3926,15)
K PSJEXTP S VALMBCK="R"
"KRN",101,3926,20)
N VAIN,VADM,P,PSJLM S PSJEXTP=1 D FULL^VALM1,ENLM^PSJPR
"KRN",101,3926,99)
62754,41556
"KRN",101,3927,-1)
0^68
"KRN",101,3927,0)
PSJU LM PLRP^Reprint Pick List^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3927,1,0)
^^1^1^2960405^
"KRN",101,3927,1,1,0)
Allows the user to PRINT or REPRINT any PICK LIST previously run.
"KRN",101,3927,15)
S VALMBCK="R"
"KRN",101,3927,20)
N VAIN,VADM D FULL^VALM1,^PSGPLRP
"KRN",101,3927,99)
62754,41556
"KRN",101,3928,-1)
0^71
"KRN",101,3928,0)
PSJU PLATCS^Send Pick List to ATC^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3928,1,0)
^101.06^4^4^3010315^^
"KRN",101,3928,1,1,0)
Allows the user to have the appropriate meds from a selected Pick List
"KRN",101,3928,1,2,0)
dispensed through the ATC machine.  PLEASE NOTE that only those
"KRN",101,3928,1,3,0)
meds on the pick list that have the appropriate ATC data (canister #
"KRN",101,3928,1,4,0)
and mnemonic) will dispense through the ATC.
"KRN",101,3928,15)
S VALMBCK="R"
"KRN",101,3928,20)
N VAIN,VADM D FULL^VALM1,^PSGTAP
"KRN",101,3928,99)
62754,41556
"KRN",101,3929,-1)
0^69
"KRN",101,3929,0)
PSJU LM PLUP^Update Pick List^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3929,1,0)
^^5^5^2960405^
"KRN",101,3929,1,1,0)
Allows the pharmacy personnel to update a pick list that has already been
"KRN",101,3929,1,2,0)
run but not yet started, picking up the new orders, renewed orders, and
"KRN",101,3929,1,3,0)
orders that were being edited when the pick list was first run.  This
"KRN",101,3929,1,4,0)
option allows the pharmacist to print only th updated orders, or the
"KRN",101,3929,1,5,0)
entire pick list, including the updated orders.
"KRN",101,3929,15)
S VALMBCK="R"
"KRN",101,3929,20)
N VAIN,VADM D FULL^VALM1,^PSGPLUP
"KRN",101,3929,99)
62754,41556
"KRN",101,3930,-1)
0^45
"KRN",101,3930,0)
PSJ LM MDWS^Medications Due Worksheet^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3930,1,0)
^^3^3^2960405^
"KRN",101,3930,1,1,0)
Allows the user to print the Medications Due Worksheet.  The worksheet
"KRN",101,3930,1,2,0)
shows the patient's orders that are to be administered within a 24 hour
"KRN",101,3930,1,3,0)
period.
"KRN",101,3930,15)
S VALMBCK="R"
"KRN",101,3930,20)
N VAIN,VADM S PSGWD=PSJPWD D FULL^VALM1,ENLM^PSJMDWS
"KRN",101,3930,99)
62754,41556
"KRN",101,3938,-1)
2^2
"KRN",101,3938,0)
PSJ LM PROFILE HIDDEN ACTIONS^Profile Hidden Actions Menu^^M^11922^^^^^^^197
"KRN",101,3938,10,0)
^101.01PA^30^30
"KRN",101,3938,10,1,0)
1803^+^11^
"KRN",101,3938,10,1,"^")
VALM NEXT SCREEN
"KRN",101,3938,10,2,0)
1804^-^12^
"KRN",101,3938,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,3938,10,3,0)
1808^UP^13^
"KRN",101,3938,10,3,"^")
VALM UP ONE LINE
"KRN",101,3938,10,4,0)
1815^ADPL^26^
"KRN",101,3938,10,4,"^")
VALM TURN ON/OFF MENUS
"KRN",101,3938,10,5,0)
1807^FS^15^
"KRN",101,3938,10,5,"^")
VALM FIRST SCREEN
"KRN",101,3938,10,6,0)
1806^LS^16^
"KRN",101,3938,10,6,"^")
VALM LAST SCREEN
"KRN",101,3938,10,7,0)
1827^GO^17^
"KRN",101,3938,10,7,"^")
VALM GOTO PAGE
"KRN",101,3938,10,8,0)
1805^RD^21^
"KRN",101,3938,10,8,"^")
VALM REFRESH
"KRN",101,3938,10,9,0)
1812^PS^22^
"KRN",101,3938,10,9,"^")
VALM PRINT SCREEN
"KRN",101,3938,10,10,0)
1813^PT^23^
"KRN",101,3938,10,10,"^")
VALM PRINT LIST
"KRN",101,3938,10,11,0)
1817^SL^24^
"KRN",101,3938,10,11,"^")
VALM SEARCH LIST
"KRN",101,3938,10,12,0)
1811^Q^25^
"KRN",101,3938,10,12,"^")
VALM QUIT
"KRN",101,3938,10,13,0)
3885^MAR^27^
"KRN",101,3938,10,13,"^")
PSJ LM MAR MENU
"KRN",101,3938,10,14,0)
3900^LBL^31^
"KRN",101,3938,10,14,"^")
PSJ LM LABEL PRINT/REPRINT MENU
"KRN",101,3938,10,15,0)
3907^JP^32^
"KRN",101,3938,10,15,"^")
PSJ LM PNV JUMP
"KRN",101,3938,10,16,0)
3909^OTH^33^
"KRN",101,3938,10,16,"^")
PSJ LM OTHER PHARMACY OPTIONS
"KRN",101,3938,10,23,0)
1809^DN^14^
"KRN",101,3938,10,23,"^")
VALM DOWN A LINE
"KRN",101,3938,10,24,0)
3913^DC^34^
"KRN",101,3938,10,24,"^")
PSJU LM SPEED DISCONTINUE
"KRN",101,3938,10,25,0)
3912^RN^35^
"KRN",101,3938,10,25,"^")
PSJU LM SPEED RENEW
"KRN",101,3938,10,26,0)
3911^SF^36^
"KRN",101,3938,10,26,"^")
PSJU LM SPEED FINISH
"KRN",101,3938,10,27,0)
3940^SV^37^
"KRN",101,3938,10,27,"^")
PSJU LM SPEED VERIFY
"KRN",101,3938,10,28,0)
4893^CWAD^38^
"KRN",101,3938,10,28,"^")
PSJ LM CWAD
"KRN",101,3938,10,29,0)
3918^IN^^
"KRN",101,3938,10,29,"^")
PSJ LM PHARMACY INTERVENTION MENU
"KRN",101,3938,10,30,0)
5986^CK^^
"KRN",101,3938,10,30,"^")
PSJ LM DRUG CHECK
"KRN",101,3939,-1)
2^5
"KRN",101,3939,0)
PSJ LM ORDER VIEW HIDDEN ACTIONS^Order View Hidden Actions Menu^^M^11922^^^^^^^197
"KRN",101,3939,10,0)
^101.01PA^30^30
"KRN",101,3939,10,1,0)
1803^+^11^
"KRN",101,3939,10,1,"^")
VALM NEXT SCREEN
"KRN",101,3939,10,2,0)
1804^-^12^
"KRN",101,3939,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,3939,10,3,0)
1808^UP^13^
"KRN",101,3939,10,3,"^")
VALM UP ONE LINE
"KRN",101,3939,10,7,0)
1807^FS^17^
"KRN",101,3939,10,7,"^")
VALM FIRST SCREEN
"KRN",101,3939,10,8,0)
1806^LS^21^
"KRN",101,3939,10,8,"^")
VALM LAST SCREEN
"KRN",101,3939,10,9,0)
1827^GO^22^
"KRN",101,3939,10,9,"^")
VALM GOTO PAGE
"KRN",101,3939,10,10,0)
1805^RD^23^
"KRN",101,3939,10,10,"^")
VALM REFRESH
"KRN",101,3939,10,11,0)
1812^PS^24^
"KRN",101,3939,10,11,"^")
VALM PRINT SCREEN
"KRN",101,3939,10,12,0)
1813^PT^25^
"KRN",101,3939,10,12,"^")
VALM PRINT LIST
"KRN",101,3939,10,13,0)
1817^SL^26^
"KRN",101,3939,10,13,"^")
VALM SEARCH LIST
"KRN",101,3939,10,14,0)
1811^Q^27^
"KRN",101,3939,10,14,"^")
VALM QUIT
"KRN",101,3939,10,15,0)
3885^MAR^32^
"KRN",101,3939,10,15,"^")
PSJ LM MAR MENU
"KRN",101,3939,10,16,0)
3900^LBL^33^
"KRN",101,3939,10,16,"^")
PSJ LM LABEL PRINT/REPRINT MENU
"KRN",101,3939,10,17,0)
3909^OTH^34^
"KRN",101,3939,10,17,"^")
PSJ LM OTHER PHARMACY OPTIONS
"KRN",101,3939,10,18,0)
3907^JP^35^
"KRN",101,3939,10,18,"^")
PSJ LM PNV JUMP
"KRN",101,3939,10,22,0)
1815^ADPL^31^
"KRN",101,3939,10,22,"^")
VALM TURN ON/OFF MENUS
"KRN",101,3939,10,24,0)
1809^DN^14^
"KRN",101,3939,10,24,"^")
VALM DOWN A LINE
"KRN",101,3939,10,28,0)
3918^IN^^
"KRN",101,3939,10,28,"^")
PSJ LM PHARMACY INTERVENTION MENU
"KRN",101,3939,10,30,0)
5987^DA^40^
"KRN",101,3939,10,30,"^")
PSJ DISPLAY DRUG ALLERGIES
"KRN",101,3940,-1)
0^26
"KRN",101,3940,0)
PSJU LM SPEED VERIFY^Speed Verify^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,3940,1,0)
^101.06^2^2^3090326^^^^
"KRN",101,3940,1,1,0)
This protocol will allow a user to verify multiple orders for a patient.
"KRN",101,3940,1,2,0)
It will only speed verify orders that were created because of a renew.
"KRN",101,3940,2,0)
^101.02A^^0
"KRN",101,3940,4)
^^^
"KRN",101,3940,10,0)
^101.01PA^1^1
"KRN",101,3940,15)
D RESTORE^PSJHVARS S VALMBCK="Q"
"KRN",101,3940,20)
D ^PSJHVARS D EN^PSGOEVS
"KRN",101,3940,99)
62754,41557
"KRN",101,3941,-1)
0^52
"KRN",101,3941,0)
PSJ LM PRINT OUTPATIENT PROFILE^Outpatient Prescriptions^^A^^^^^^^^
"KRN",101,3941,1,0)
^^2^2^2970512^
"KRN",101,3941,1,1,0)
This protocol will call INPAT^PSOBUILD(DFN) to allow a patient's outpatient
"KRN",101,3941,1,2,0)
profile to be viewed while in the Inpatient Meds software.
"KRN",101,3941,2,0)
^101.02A^1^1
"KRN",101,3941,2,1,0)
OP
"KRN",101,3941,2,"B","OP",1)

"KRN",101,3941,15)
S VALMBCK="R" H 1
"KRN",101,3941,20)
D INPAT^PSOBUILD(PSGP)
"KRN",101,3941,99)
62754,41557
"KRN",101,4893,-1)
0^27
"KRN",101,4893,0)
PSJ LM CWAD^CWAD Information^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,4893,1,0)
^^1^1^3020626^
"KRN",101,4893,1,1,0)
Displaying the CWAD information for the selected patient.
"KRN",101,4893,15)
S VALMBCK="R"
"KRN",101,4893,20)
D CWAD^PSJALG(DFN)
"KRN",101,4893,99)
62754,41557
"KRN",101,5986,-1)
0^3
"KRN",101,5986,0)
PSJ LM DRUG CHECK^Check Interactions^^A^^^^^^^^
"KRN",101,5986,1,0)
^101.06^2^2^3120724^^^^
"KRN",101,5986,1,1,0)
This action is used to check for enhanced order checks of a prospective 
"KRN",101,5986,1,2,0)
drug against the drugs on the patient's medication profile screen.
"KRN",101,5986,20)
D DGCK^PSJDGCK
"KRN",101,5986,99)
62754,41557
"KRN",101,5987,-1)
0^1
"KRN",101,5987,0)
PSJ DISPLAY DRUG ALLERGIES^Display Drug Allergies^^A^^^^^^^^INPATIENT MEDICATIONS
"KRN",101,5987,1,0)
^101.06^1^1^3120123^^
"KRN",101,5987,1,1,0)
displays signs/symptoms of an allergy associated to a med order.
"KRN",101,5987,2,0)
^101.02A^1^1
"KRN",101,5987,2,1,0)
DA
"KRN",101,5987,2,"B","DA",1)

"KRN",101,5987,20)
D ^PSJDGAL2
"KRN",101,5987,99)
62754,41557
"KRN",409.61,439,-1)
0^6
"KRN",409.61,439,0)
PSJ LM DETAILED ALLERGY^1^^80^9^20^1^1^Protocol^PSJ LM DETAILED ALLERGY MENU^Detailed ADR List^2^^1
"KRN",409.61,439,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,439,"ARRAY")
 ^TMP("PSJDA",$J)
"KRN",409.61,439,"COL",0)
^409.621^^0
"KRN",409.61,439,"FNL")
D EXIT^PSJLMDA S VALMBCK="Q"
"KRN",409.61,439,"HDR")
D HDR^PSJLMHED(DFN)
"KRN",409.61,439,"INIT")
D INIT^PSJLMDA
"KRN",409.61,447,-1)
0^1
"KRN",409.61,447,0)
PSJ LM OE^1^^80^9^19^1^1^Protocol^PSJ LM OE MENU^Inpatient Order Entry^2^^1
"KRN",409.61,447,1)
^PSJ LM PROFILE HIDDEN ACTIONS
"KRN",409.61,447,"ARRAY")
 ^TMP("PSJPRO",$J)
"KRN",409.61,447,"COL",0)
^409.621^^0
"KRN",409.61,447,"FNL")

"KRN",409.61,447,"HDR")
D HDR^PSJLMHED(DFN) W ""
"KRN",409.61,447,"INIT")
D INIT^PSJLMHED(3)
"KRN",409.61,448,-1)
0^7
"KRN",409.61,448,0)
PSJ LM OE DISPLAY^1^^80^7^19^1^1^^PSJ LM OE FINISH MENU^Unit Dose Edit^2^^1
"KRN",409.61,448,1)
^PSJ LM ORDER VIEW HIDDEN ACTIONS
"KRN",409.61,448,"ARRAY")
 ^TMP("PSJUDE",$J)
"KRN",409.61,448,"COL",0)
^409.621^^0
"KRN",409.61,448,"FNL")
S VALMBCK="R"
"KRN",409.61,448,"HDR")
S XQORM("B")="ACCEPT" D HDR^PSJLMHED(DFN)
"KRN",409.61,448,"INIT")
D INIT^PSJLMUDE(DFN,PSJORD)
"KRN",409.61,450,-1)
0^5
"KRN",409.61,450,0)
PSJ LM PNV^1^^80^9^19^1^1^Protocol^PSJ LM OE MENU^Non-Verified/Pending Orders^2^^1
"KRN",409.61,450,1)
^PSJ LM PROFILE HIDDEN ACTIONS
"KRN",409.61,450,"ARRAY")
 ^TMP("PSJPRO",$J)
"KRN",409.61,450,"COL",0)
^409.621^^0
"KRN",409.61,450,"HDR")
D HDR^PSJLMHED(DFN)
"KRN",409.61,450,"INIT")
D INIT^PSJLMHED(3)
"KRN",409.61,451,-1)
0^8
"KRN",409.61,451,0)
PSJU LM ACCEPT^1^^80^6^22^1^1^Protocol^PSJU LM ACCEPT MENU^Unit Dose Accept^^^1
"KRN",409.61,451,1)
^PSJ LM ORDER VIEW HIDDEN ACTIONS
"KRN",409.61,451,"ARRAY")
 ^TMP("PSJUDE",$J)
"KRN",409.61,451,"COL",0)
^409.621^2^2
"KRN",409.61,451,"COL",1,0)
TEXTL^1^3^^
"KRN",409.61,451,"COL",2,0)
DRUG^^^^H
"KRN",409.61,451,"COL","B","DRUG",2)

"KRN",409.61,451,"COL","B","TEXTL",1)

"KRN",409.61,451,"FNL")

"KRN",409.61,451,"HDR")
D HDR^PSJLMHED(DFN)
"KRN",409.61,451,"INIT")
D INIT^PSJLMUDE($G(PSGP),$G(PSGORD))
"KRN",409.61,453,-1)
0^4
"KRN",409.61,453,0)
PSJU LM OE^1^^80^9^19^1^1^Protocol^PSJ LM OE MENU^Unit Dose Order Entry^2^^1
"KRN",409.61,453,1)
^PSJ LM PROFILE HIDDEN ACTIONS
"KRN",409.61,453,"ARRAY")
 ^TMP("PSJPRO",$J)
"KRN",409.61,453,"FNL")

"KRN",409.61,453,"HDR")
D HDR^PSJLMHED(DFN)
"KRN",409.61,453,"INIT")
D INIT^PSJLMHED(1)
"KRN",409.61,454,-1)
0^2
"KRN",409.61,454,0)
PSJ LM IV OE^1^^80^9^19^1^1^Protocol^PSJ LM IV OE MENU^IV Order Entry^2^^1
"KRN",409.61,454,1)
^PSJ LM PROFILE HIDDEN ACTIONS
"KRN",409.61,454,"ARRAY")
 ^TMP("PSJPRO",$J)
"KRN",409.61,454,"COL",0)
^409.621^^0
"KRN",409.61,454,"FNL")
K ^TMP("PSJPRO",$J)
"KRN",409.61,454,"HDR")
D HDR^PSJLMHED(DFN)
"KRN",409.61,454,"HLP")

"KRN",409.61,454,"INIT")
D ^PSIVPRO
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;LME1^XPDIA1;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
260^3121029^11922
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
21
"RTN","PSGOE7")
0^23^B28193796^B19281966
"RTN","PSGOE7",1,0)
PSGOE7 ;BIR/CML3-SELECT DRUG ;15 MAY 00 / 1:43 PM
"RTN","PSGOE7",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**9,26,34,52,55,50,87,111,181,254,267,260**;16 DEC 97;Build 94
"RTN","PSGOE7",3,0)
 ;
"RTN","PSGOE7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSGOE7",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSGOE7",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOE7",7,0)
 ; NFI-UD chgs for FR#: 1
"RTN","PSGOE7",8,0)
 ; 
"RTN","PSGOE7",9,0)
 ;S PSGDICS="U"_$S($D(PSJOERR):",I",1:"")
"RTN","PSGOE7",10,0)
 S PSGDICS="U"
"RTN","PSGOE7",11,0)
 ;
"RTN","PSGOE7",12,0)
AD ; Ask Drug
"RTN","PSGOE7",13,0)
 K PSJDOSE,PSJDOX ;var array use in ^PSJDOSE
"RTN","PSGOE7",14,0)
 K PSGODO,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP))
"RTN","PSGOE7",15,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="EMQZVT",D="B^C" I '$P(PSJSYSU,";",4) S DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")"
"RTN","PSGOE7",16,0)
 E  D
"RTN","PSGOE7",17,0)
 .I '$D(PSJDGCK) S DIC("T")="",DIC="^PSDRUG(",DIC("S")="I +$G(^PSDRUG(+Y,2)),$P($G(^PSDRUG(+Y,2)),""^"",3)[""U"" S X(1)=+$G(^(""I"")) I $S('X(1):1,1:X(1)>DT)",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSGOE7",18,0)
 .I $D(PSJDGCK) S DIC("T")="",DIC="^PSDRUG(",DIC("S")="I +$G(^PSDRUG(+Y,2)),$$GCN^PSGOE7(+Y),$$PKGFLG^PSGOE7($P($G(^PSDRUG(+Y,2)),""^"",3)) S X(1)=+$G(^(""I"")) I $S('X(1):1,1:X(1)>DT)",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSGOE7",19,0)
 ;
"RTN","PSGOE7",20,0)
AD1 ;
"RTN","PSGOE7",21,0)
 K PSGORD,PSJORD,PSJALLGY,^TMP("PSJINTER",$J),^PS(53.45,+$G(PSJSYSP),5),^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSGOE7",22,0)
 S PSGORQF=0 R !!,"Select DRUG: ",X:DTIME I '$T W $C(7) S X="^"
"RTN","PSGOE7",23,0)
 I $D(PSJDGCK) I ($G(PSJOCNT)=1&(X="")) D  Q
"RTN","PSGOE7",24,0)
 .W !!,"Not enough active profile drugs to perform drug check",!
"RTN","PSGOE7",25,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSGOE7",26,0)
 I $D(PSJDGCK),X="" N PSGDGCKF S PSGDGCKF=1 G DGCKX
"RTN","PSGOE7",27,0)
 I ("^"[X)!(X="") S PSGORQF=1 G DONE
"RTN","PSGOE7",28,0)
 G:X?1"S."1.E DONE
"RTN","PSGOE7",29,0)
 I X?1."?" W !!?2,"Select the medication you wish the patient to receive." W:PSJSYSU<3 "  You should consult",!,"with your pharmacy before ordering any non-formulary medication." W !
"RTN","PSGOE7",30,0)
 D MIX^DIC1 G:X?1."?" AD1 G:"^"[X!(Y'>0) AD1 S (PSGDO,PSGDRG,PSGDRGN,PSGNEDFD,PSGPDRG,PSGPDRGN)=""
"RTN","PSGOE7",31,0)
DGCKX I $P(PSJSYSU,";",4) D  G DO
"RTN","PSGOE7",32,0)
 .S:'$D(PSJDGCK) PSGDRG=+Y,PSGDRGN=Y(0,0)
"RTN","PSGOE7",33,0)
 .S:$D(PSJDGCK)&'$D(PSGDGCKF) PSGDRG=+Y,PSGDRGN=Y(0,0)
"RTN","PSGOE7",34,0)
 .S:$D(PSJDGCK)&$D(PSGDGCKF) PSGDRG=$P($$DGCKIEN^PSJDGCK(),";",2),PSGDRGN=$P($G(^PSDRUG(PSGDRG,0)),U)
"RTN","PSGOE7",35,0)
 .D DIN^PSJDIN(+$G(^PSDRUG(PSGDRG,2)),PSGDRG)
"RTN","PSGOE7",36,0)
 .I '$D(PSJDGCK) I $P(Y(0),"^",9) D NF S:Y>0 PSGDRG=+Y(0),PSGDRGN=Y(0,0) D SNFM
"RTN","PSGOE7",37,0)
 .I $D(PSJDGCK)&'$D(PSGDGCKF) I $P(Y(0),"^",9) D NF S:Y>0 PSGDRG=+Y(0),PSGDRGN=Y(0,0) D SNFM
"RTN","PSGOE7",38,0)
 .S PSGPDRG=+$G(^PSDRUG(PSGDRG,2)),PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",39,0)
 I '$D(PSJDGCK) S PSGPDRG=+Y,PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",40,0)
 I $D(PSJDGCK)&'$D(PSGDGCKF) S PSGPDRG=+Y,PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",41,0)
 ;F Q=1:1:$L(PSGDICS) S X=$P(PSGDICS,",",Q) Q:X=""  S PSJLUAPP=$O(^PS(50.3,PSGPDRG,1,"B",X,0)) I PSJLUAPP S X=$G(^PS(50.3,PSGPDRG,1,PSJLUAPP,0)) Q
"RTN","PSGOE7",42,0)
 S X=$O(^PSDRUG("ASP",PSGPDRG,0)) I X,'$O(^(X)) S PSGDRG=X,PSGDRGN=$$ENDDN^PSGMI(X)
"RTN","PSGOE7",43,0)
 ;
"RTN","PSGOE7",44,0)
DO ; dosage ordered
"RTN","PSGOE7",45,0)
 NEW PSJALLGY
"RTN","PSGOE7",46,0)
 S PSGNEDFD=$$GTNEDFD("U",PSGPDRG)
"RTN","PSGOE7",47,0)
 I $G(PSGDRG),$P(PSJSYSU,";",4) S PSJALLGY(PSGDRG)="" D ENDDC^PSGSICHK(PSGP,PSGDRG) G:$G(PSGORQF) AD
"RTN","PSGOE7",48,0)
 I '$P(PSJSYSU,";",4) S PSGX=PSGPDRG D END^PSGSICHK G:Y<0 AD
"RTN","PSGOE7",49,0)
 S PSGDO=""
"RTN","PSGOE7",50,0)
 ;
"RTN","PSGOE7",51,0)
DONE ;
"RTN","PSGOE7",52,0)
 K DIC,%,%Y,PSGDICS,PSJLUAPP,Q1,Q2,Q3,Z,PSJALLGY Q
"RTN","PSGOE7",53,0)
 ;
"RTN","PSGOE7",54,0)
 ;
"RTN","PSGOE7",55,0)
NF ;
"RTN","PSGOE7",56,0)
 S Y=0 W $C(7),!!,"PLEASE NOTE: The selected item is not currently on your medical center's",!?13,"formulary." Q:'$P(PSJSYSU,";",2)
"RTN","PSGOE7",57,0)
 N CNT S CNT=0 F Q1=0:0 S Q1=$O(^PSDRUG(PSGDRG,65,Q1)) Q:'Q1  I $$CHKDRG(+$G(^(Q1,0))) S CNT=CNT+1
"RTN","PSGOE7",58,0)
 I CNT=0 W !!,"There are no formulary alternatives entered for this item." W:PSJSYSU>2 "  You should consult",!,"with your pharmacy before ordering this item." S Y=0 Q
"RTN","PSGOE7",59,0)
 I CNT=1 S Q1=$O(^PSDRUG(PSGDRG,65,0)),Q1=+$G(^(Q1,0)),Q3=$P(^PSDRUG(Q1,0),"^") W !!,Q3," has been entered as a formulary " W:$X>67 ! W "alternative."
"RTN","PSGOE7",60,0)
 I  F Q=1:1 S %=2 W !!,"Is ",$S(Q=1:"this",1:Q3)," acceptable" D YN^DICN Q:%  D NFOH
"RTN","PSGOE7",61,0)
 I CNT=1 S:%=1 (Y(0),Y)=Q1,Y(0,0)=Q3 S:%<0 Y=-1 Q
"RTN","PSGOE7",62,0)
 K DA,DIC S DA(1)=PSGDRG,DIC="^PSDRUG("_PSGDRG_",65,",DIC(0)="AEMQZ",DIC("A")="Select FORMULARY ALTERNATIVE: " W ! D ^DIC K DIC Q
"RTN","PSGOE7",63,0)
 ;
"RTN","PSGOE7",64,0)
NFOH ;
"RTN","PSGOE7",65,0)
 S X="Answer 'YES' to order this formulary alternative ("_Q3_") for the patient instead of the non-formulary item originally selected.  Answer 'NO' to use the drug originally selected."
"RTN","PSGOE7",66,0)
 W !!?2 F Y=1:1:$L(X," ") S Z=$P(X," ",Y) W:$L(Z)+$X+2>IOM ! W Z," "
"RTN","PSGOE7",67,0)
 Q
"RTN","PSGOE7",68,0)
CHKDRG(DRG) ; Determine if dispense drug is valid for Unit Dose.
"RTN","PSGOE7",69,0)
 I $D(^PSDRUG(DRG,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>DT) Q DRG
"RTN","PSGOE7",70,0)
 Q 0
"RTN","PSGOE7",71,0)
 ;
"RTN","PSGOE7",72,0)
SNFM ; show non-formulary message
"RTN","PSGOE7",73,0)
 S Y=1 Q:PSJSYSU=3!'$O(^PS(59.7,1,21,0))  W $C(7),! S Q=0 F  S Q=$O(^PS(59.7,1,21,Q)) Q:'Q  W !,$G(^(Q,0))
"RTN","PSGOE7",74,0)
 W ! D READ^PSJUTL S Y=1 Q
"RTN","PSGOE7",75,0)
 ;
"RTN","PSGOE7",76,0)
GTNEDFD(APP,PDRG) ; Find defaults from Orderable Item.
"RTN","PSGOE7",77,0)
 Q $P($G(^PS(50.7,+PDRG,0)),"^",5,8)
"RTN","PSGOE7",78,0)
 N Q,X S X=""
"RTN","PSGOE7",79,0)
 F Q=1:1:$L(APP) S X=$E(APP,Q) Q:X=""  S X=$O(^PS(50.3,+PDRG,1,"B",X,0)) I X S X=$P($G(^PS(50.3,+PDRG,1,X,0)),"^",5,8) Q
"RTN","PSGOE7",80,0)
 Q X
"RTN","PSGOE7",81,0)
 ;
"RTN","PSGOE7",82,0)
PKGFLG(PKF) ;Return 0 for not in range of acceptable package flags, 1 for within range
"RTN","PSGOE7",83,0)
 I $S(PKF["U":1,1:0) Q 1
"RTN","PSGOE7",84,0)
 I $S(PKF["I":1,1:0) Q 1
"RTN","PSGOE7",85,0)
 Q 0
"RTN","PSGOE7",86,0)
 ;
"RTN","PSGOE7",87,0)
GCN(PSGIENID) ;Return 0 for not matched, 1 for matched with no GCNSEQNO, 1^1 for matched with a GCNSEQNO
"RTN","PSGOE7",88,0)
 N PSGNDFID,PSGGCNPT,PSGGCNID
"RTN","PSGOE7",89,0)
 S PSGNDFID=$P($G(^PSDRUG(PSGIENID,"ND")),"^"),PSGGCNPT=$P($G(^PSDRUG(PSGIENID,"ND")),"^",3)
"RTN","PSGOE7",90,0)
 I 'PSGNDFID!('PSGGCNPT) Q 0
"RTN","PSGOE7",91,0)
 S PSGGCNID=$$PROD0^PSNAPIS(PSGNDFID,PSGGCNPT)
"RTN","PSGOE7",92,0)
 I $P(PSGGCNID,"^",7) Q PSGIENID_";"_PSGNDFID_";"_$P(PSGGCNID,"^",7)
"RTN","PSGOE7",93,0)
 Q PSGIENID_";"_PSGNDFID
"RTN","PSGOEC")
0^17^B74688532^B67778509
"RTN","PSGOEC",1,0)
PSGOEC ;BIR/CML3-CANCEL ORDERS ;02 Mar 99 / 9:29 AM
"RTN","PSGOEC",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**23,58,110,175,201,134,181,260**;16 DEC 97;Build 94
"RTN","PSGOEC",3,0)
 ;
"RTN","PSGOEC",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEC",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOEC",6,0)
 ; 
"RTN","PSGOEC",7,0)
ENA ; all orders
"RTN","PSGOEC",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  S CF=$P(PSJSYSP0,U,5) N ND,ND1 S ND="$D(^PS(55,PSGP,5,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)",ND1="$D(^PS(53.1,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)"
"RTN","PSGOEC",9,0)
 F  W !!,"Do you want to ",$S(CF:"discontinue",1:"mark for discontinuation")," all of this patient's orders" S %=1 D YN^DICN Q:%  D ENCAM^PSGOEM
"RTN","PSGOEC",10,0)
 S PSGCF=0 Q:%<0  S PSGCF=1,T=$E("T",'PSJSYSU) G:%=1 ENCA F T=0:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND Q
"RTN","PSGOEC",11,0)
 E  F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 Q
"RTN","PSGOEC",12,0)
 E  G DONE
"RTN","PSGOEC",13,0)
 W !!,"SOME OR ALL OF THESE ORDERS HAVE" D ENUMK^PSGOEM Q:%'=1
"RTN","PSGOEC",14,0)
 W !!,"...a few moments, please..." S PSGAL("C")=PSJSYSU*10+21400
"RTN","PSGOEC",15,0)
 F T=PSGDT:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND W "." D RS,^PSGAL5
"RTN","PSGOEC",16,0)
 F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 W "." D RS
"RTN","PSGOEC",17,0)
 W " . . . DONE!" G DONE
"RTN","PSGOEC",18,0)
ENCA ;
"RTN","PSGOEC",19,0)
 D NOW^%DTC S (Q1,PSGDT)=+$E(%,1,12) F  S Q1=$O(^PS(55,PSGP,5,"AUS",Q1)) Q:'Q1  F Q2=0:0 S Q2=$O(^PS(55,PSGP,5,"AUS",Q1,Q2)) Q:'Q2  I $P($G(^PS(55,PSGP,5,Q2,0)),"^",21) Q
"RTN","PSGOEC",20,0)
 E  F Q2=0:0 S Q2=$O(^PS(53.1,"AC",PSGP,Q2)) Q:'Q2  I $P($G(^PS(53.1,Q2,0)),U,21) Q
"RTN","PSGOEC",21,0)
 I  S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0!('$$REQPROV) D  G DONE
"RTN","PSGOEC",22,0)
 .W !!,$C(7),"No changes made to this order." D PAUSE^VALM1
"RTN","PSGOEC",23,0)
 S PSGALR=$S('$D(PSGALO):20,PSGALO?4N&($E(PSGALO)=1):10,1:20) I $P(PSJSYSP0,U,5) D ENHE^PSJADT0 S PSGOP=PSGP D ASET
"RTN","PSGOEC",24,0)
 F SD=PSGDT:0 S SD=$O(^PS(55,PSGP,5,"AUS",SD)) Q:'SD  F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,5,"AUS",SD,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"A" D AC
"RTN","PSGOEC",25,0)
 D NSET S CF=$P(PSJSYSP0,U,5) F PSGORD=0:0 S PSGORD=$O(^PS(53.1,"AC",PSGP,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"N" D NC
"RTN","PSGOEC",26,0)
 W " . . . DONE!" K PSGORD G DONE
"RTN","PSGOEC",27,0)
ENO(PSGP,PSGORD) ; single order
"RTN","PSGOEC",28,0)
 I PSGSTAT="D" W !,"This order has already been DISCONTINUED." D PAUSE^VALM1 Q
"RTN","PSGOEC",29,0)
 S CF=$S($P(PSJSYSP0,U,5):1,PSGORD["U":0,1:($P($G(^PS(53.1,+PSGORD,0)),U,25)=""&($P($G(^(4)),U,7)=DUZ)))
"RTN","PSGOEC",30,0)
 S PSJCOM=+$S(PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSGORD,.2)),"^",8))
"RTN","PSGOEC",31,0)
 I 'CF,PSJCOM W !!,"This order is part of a complex order and CANNOT be marked for discontinuation." Q
"RTN","PSGOEC",32,0)
 I $$PNDRNOK(PSGORD) N PSJDCTYP S PSJDCTYP=$$PNDRNA(PSGORD) D:(PSJDCTYP=1!(PSJDCTYP=2)) PNDRN($G(PSJDCTYP),PSGORD) G DONE
"RTN","PSGOEC",33,0)
 ;I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOEC",34,0)
 ;F  W !!,"Do you want to ",$S(PSJCOM:"discontinue this series of complex orders",CF:"discontinue this order",1:"mark this order for discontinuation") S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSGOEC",35,0)
 ;I %<0 S VALMBCK="" Q
"RTN","PSGOEC",36,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOEC",37,0)
 I PSJCOM F  W !!,"Do you want to discontinue this series of complex orders" S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSGOEC",38,0)
 I 'PSJCOM,CF,'$D(PSJDCDTF) F  W !!,"Do you want to discontinue this order" S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM I %<0 S VALMBCK="" Q
"RTN","PSGOEC",39,0)
 I 'PSJCOM,CF,$D(PSJDCDTF) F  W !!,"Enter DC to discontinue the above order or press <RETURN> to continue:" S %=$S($G(PSJOCFLG):2,1:1) D TST4DC W:%=2 !,"No action taken!" Q:%  D ENDC^PSGOEM I %<0 S VALMBCK="" Q
"RTN","PSGOEC",40,0)
 I 'PSJCOM,'CF,'$D(PSJDCDTF) F  W !!,"Do you want mark this order for discontinuation" S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM I %<0 S VALMBCK="" Q
"RTN","PSGOEC",41,0)
 G:%=1 SOC I $S(PSGORD["U":$D(^PS(55,PSGP,5,+PSGORD,4)),1:$D(^PS(53.1,+PSGORD,4))),$P(^(4),U,12) W !!,"THIS ORDER HAS"
"RTN","PSGOEC",42,0)
 I  D ENUMK^PSGOEM I %=1 W "..." K DA S:PSGORD["A" PSGAL("C")=PSJSYSU*10+21400,DA=+PSGORD,DA(1)=PSGP D RS,^PSGAL5:PSGORD["A" W " . . . DONE!"
"RTN","PSGOEC",43,0)
 G DONE
"RTN","PSGOEC",44,0)
SOC ;
"RTN","PSGOEC",45,0)
 I 'CF,'$P($S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,0)),1:$G(^PS(53.1,+PSGORD,0))),U,21) W !!,"...one moment, please..."
"RTN","PSGOEC",46,0)
 E  I CF,'($G(PSJDCTYP)=2) S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0 D ABORT^PSGOEE G DONE
"RTN","PSGOEC",47,0)
 ; prompt for requesting provider
"RTN","PSGOEC",48,0)
 I '($G(PSJDCTYP)=2) I CF,'$$REQPROV D ABORT^PSGOEE G DONE
"RTN","PSGOEC",49,0)
 K DA D NOW^%DTC S PSGDT=%,T=$E("T",'PSJSYSU),PSGALR=20,DA=+PSGORD,DA(1)=PSGP
"RTN","PSGOEC",50,0)
 I 'PSJCOM D
"RTN","PSGOEC",51,0)
 .I PSGORD["U" D ASET:CF,AC
"RTN","PSGOEC",52,0)
 .I PSGORD'["U" D NSET:CF,NC
"RTN","PSGOEC",53,0)
 I PSJCOM N COMFLG S COMFLG=0 D
"RTN","PSGOEC",54,0)
 . I PSGORD["P" Q:('$$LOCK^PSJOEA(PSGP,PSJCOM))  D 
"RTN","PSGOEC",55,0)
 .. N O S O="" F  S O=$O(^PS(53.1,"ACX",PSJCOM,O)) Q:O=""  S (PSGORD,PSJORD)=O_"P" D NSET,NC
"RTN","PSGOEC",56,0)
 .I PSGORD["U" N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  Q:COMFLG  D
"RTN","PSGOEC",57,0)
 .. Q:OO=PSGORD  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSGOEC",58,0)
 I PSJCOM Q:COMFLG  N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSGOEC",59,0)
 . I OO["V" S ON55=OO D D1^PSIVOPT2 S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3) D
"RTN","PSGOEC",60,0)
 .. D LOG^PSIVORAL N PSJORD S PSJORD=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),P("NAT")=PSJNOO D HL^PSIVORA
"RTN","PSGOEC",61,0)
 . I OO["U" N PSGORD,PSJORD S (PSGORD,PSJORD)=OO D ASET^PSGOEC,AC^PSGOEC
"RTN","PSGOEC",62,0)
 Q
"RTN","PSGOEC",63,0)
D1 N %,DA,DIE,DIU,STP,NSTOP
"RTN","PSGOEC",64,0)
 D NOW^%DTC S NSTOP=+$E(%,1,12),STP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),NSTOP=+$S(STP>NSTOP:NSTOP,1:STP),P(17)="D"
"RTN","PSGOEC",65,0)
 S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR="109////"_NSTOP_$S('$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7):";116////"_STP,1:"")_";100///D;.03////"_NSTOP,PSIVACT=1 D ^DIE
"RTN","PSGOEC",66,0)
 I $S($G(PSIVAC)="OD":0,$G(PSIVAC)'="AD":1,$G(PSGALO)<1060:0,1:$P($G(PSJSYSW0),U,15)) S X=$S($G(PSIVAC)="AD":1,1:2) D ENLBL^PSIVOPT(X,$S(X=1:+$G(PSGUOW),1:DUZ),DFN,3,+ON55,$E("AD",1,3-X))
"RTN","PSGOEC",67,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF  ;* S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'ORIFN
"RTN","PSGOEC",68,0)
 Q
"RTN","PSGOEC",69,0)
OUT ;
"RTN","PSGOEC",70,0)
 W $S(PSJCOM:"...ORDER ",1:"...ORDERS "),$S(CF:"DISCONTINUED!",1:"MARKED!") S PSGCANFL=1
"RTN","PSGOEC",71,0)
DONE ;
"RTN","PSGOEC",72,0)
 K CF,DA,DIE,DP,DR,ORIFN,ORETURN,PSGAL,PSGALR,PSGDA,SD,ST,T,UCF,Y,PSJDCTYP Q
"RTN","PSGOEC",73,0)
ASET ;
"RTN","PSGOEC",74,0)
 S DIE="^PS(55,"_PSGP_",5,",DR="136////@;28////"_$S($P($G(^PS(55,PSGP,5,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_";Q;34////"_PSGDT_$S(T]"":";49////1",1:"")
"RTN","PSGOEC",75,0)
 Q
"RTN","PSGOEC",76,0)
NSET ;
"RTN","PSGOEC",77,0)
 S DIE="^PS(53.1,",DR="28////"_$S($P($G(^PS(53.1,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_$S(T]"":";42////1",1:"")_";25////"_PSGDT Q
"RTN","PSGOEC",78,0)
AC ;
"RTN","PSGOEC",79,0)
 I 'CF K DA S $P(^PS(55,PSGP,5,+PSGORD,4),U,11,14)="^1^"_DUZ_U_PSGDT,PSGAL("C")=13040,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5
"RTN","PSGOEC",80,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",81,0)
 Q:'CF  K DA,ORIFN S PSGAL("C")=PSJSYSU*10+4000,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5 S $P(^(2),U,3)=$P(^PS(55,PSGP,5,+PSGORD,2),U,4) D ^DIE S ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEC",82,0)
 I PSJSYSL K DA S $P(^PS(55,PSGP,5,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD,DA(1)=PSGP D ENL^PSGVDS
"RTN","PSGOEC",83,0)
 S ORIFN=$P($G(^PS(55,PSGP,5,+PSGORD,0)),U,21) D:ORIFN DCOR^PSGOECS
"RTN","PSGOEC",84,0)
 Q
"RTN","PSGOEC",85,0)
NC ;
"RTN","PSGOEC",86,0)
 I 'CF S $P(^PS(53.1,+PSGORD,4),"^",11,14)="^1^"_DUZ_U_PSGDT
"RTN","PSGOEC",87,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"N",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",88,0)
 Q:'CF  S PSGSTAT=$P($G(^PS(53.1,+PSGORD,0)),U,9),PSGORIFN=$P($G(^(0)),U,21)
"RTN","PSGOEC",89,0)
 I PSGSTAT'="U" K DA,ORIFN S DA=+PSGORD D ^DIE I PSJSYSL,PSJSYSL<3,(PSGSTAT'="P") S $P(^PS(53.1,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOO=2,PSGUOW=DUZ,PSGTOL=2 D ENL^PSGVDS
"RTN","PSGOEC",90,0)
 I PSGSTAT="U" K DA S DA=+PSGORD,DIK="^PS(53.1," D ^DIK
"RTN","PSGOEC",91,0)
 I PSGORIFN S ORIFN=PSGORIFN D DCOR^PSGOECS
"RTN","PSGOEC",92,0)
 Q
"RTN","PSGOEC",93,0)
T ;
"RTN","PSGOEC",94,0)
 F  W !!,"Is this due to the patient being transferred" S %=2 D YN^DICN Q:%  D ENCTM^PSGOEM1
"RTN","PSGOEC",95,0)
 S T=$S(%<0:"^",1:$E("T",%=1)) Q
"RTN","PSGOEC",96,0)
RS ;
"RTN","PSGOEC",97,0)
 ; naked ref below is from variable ND1, ^PS(53.1,PSGDA,4)
"RTN","PSGOEC",98,0)
 S $P(^(4),U,11,14)="^^^" Q
"RTN","PSGOEC",99,0)
 ;
"RTN","PSGOEC",100,0)
REQPROV()          ;
"RTN","PSGOEC",101,0)
 I $G(PSJDCTYP)=2 Q 1
"RTN","PSGOEC",102,0)
 K PSJDCPRV,DIC,DUOUT,DTOUT,Y
"RTN","PSGOEC",103,0)
 N PROVIDER,PROVNAME,RESULT,RSB S RESULT=0
"RTN","PSGOEC",104,0)
 S PROVIDER=+$P($G(^PS(55,DFN,5.1)),"^",2),PROVNAME=""
"RTN","PSGOEC",105,0)
 I PROVIDER>0 D
"RTN","PSGOEC",106,0)
 .S DIC=200,DR="53.1;53.4",DIQ="RSB",DIQ(0)="I",DA=PROVIDER D EN^DIQ1
"RTN","PSGOEC",107,0)
 .K DIC,DR,DA,DIQ
"RTN","PSGOEC",108,0)
 .I $G(RSB(200,PROVIDER,53.1,"I"))="1"&(($G(RSB(200,PROVIDER,53.4,"I"))="")!($G(RSB(200,PROVIDER,53.4,"I"))>DT)) D
"RTN","PSGOEC",109,0)
 ..S DIC=200,DA=PROVIDER,DR=".01",DIQ="RSB",DIQ(0)="E" D EN^DIQ1
"RTN","PSGOEC",110,0)
 ..S PROVNAME=$G(RSB(200,PROVIDER,.01,"E")) K DA,DIQ,DR
"RTN","PSGOEC",111,0)
 K DIC S DIC=200,DIC(0)="AEMQZ"
"RTN","PSGOEC",112,0)
 S:PROVNAME]"" DIC("B")=PROVNAME
"RTN","PSGOEC",113,0)
 S DIC("A")="Requesting PROVIDER: "
"RTN","PSGOEC",114,0)
 S DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC
"RTN","PSGOEC",115,0)
 I +Y>0,'$D(DUOUT),'$D(DTOUT) S RESULT=1,PSJDCPRV=+Y
"RTN","PSGOEC",116,0)
 Q RESULT
"RTN","PSGOEC",117,0)
 ;
"RTN","PSGOEC",118,0)
PNDRNA(ORDER) ; Ask Discontinue Pending Renewal only, or both Pending Renew and Renewed Order
"RTN","PSGOEC",119,0)
 ; Perform this action only for pending renewals
"RTN","PSGOEC",120,0)
 I '$G(ORDER)!'($G(ORDER)["P") Q 3
"RTN","PSGOEC",121,0)
 ; Quit if original order is no longer active
"RTN","PSGOEC",122,0)
 N ORIGORD,ORIGSTOP S ORIGORD=$P($G(^PS(53.1,+ORDER,0)),"^",25) Q:'ORIGORD  D  I ORIGSTOP<$G(PSGDT) Q 1
"RTN","PSGOEC",123,0)
 .S ORIGSTOP=$S(ORIGORD["U":$P($G(^PS(55,PSGP,5,+ORIGORD,2)),"^",4),ORIGORD["V":$P($G(^PS(55,PSGP,"IV",+ORIGORD,0)),"^",3),1:"")
"RTN","PSGOEC",124,0)
 N NDP2
"RTN","PSGOEC",125,0)
 S NDP2=^PS(53.1,+ORDER,.2) S DRG=NDP2,DO=$P(DRG,"^",2) S DRG=$$ENPDN^PSGMI($P(DRG,"^"))
"RTN","PSGOEC",126,0)
 S ND2=^PS(53.1,+ORDER,2) S SCH=$P(ND2,"^"),START=$P(ND2,"^",2),START=$$FMTE^XLFDT(START,2)
"RTN","PSGOEC",127,0)
 W !!?5,DRG_" "_DO
"RTN","PSGOEC",128,0)
 W !?5,"This order has a pending status. If this pending order"
"RTN","PSGOEC",129,0)
 W !?5,"is discontinued, the original order may still be active."
"RTN","PSGOEC",130,0)
 S DIR("A")="Select order(s) to discontinue"
"RTN","PSGOEC",131,0)
 S DIR(0)="S^1:DC BOTH Orders;2:DC Pending Order;3:Cancel - No Action Taken"
"RTN","PSGOEC",132,0)
 S DIR("L",1)="1 - DC BOTH Orders"
"RTN","PSGOEC",133,0)
 S DIR("L",2)="2 - DC Pending Order"
"RTN","PSGOEC",134,0)
 S DIR("L",3)="3 - Cancel - No Action Taken" D ^DIR
"RTN","PSGOEC",135,0)
 ; Reverse order - Y=1 - Pending only  Y=2:BOTH
"RTN","PSGOEC",136,0)
 S Y=$S(Y=1:2,Y=2:1,1:3)
"RTN","PSGOEC",137,0)
 Q Y
"RTN","PSGOEC",138,0)
 ;
"RTN","PSGOEC",139,0)
PNDRN(PSJDCTYP,ORDER) ; Perform Discontinue action for Pending order only or both Pending and Renewed
"RTN","PSGOEC",140,0)
 ; Perform this action only for pending renewals
"RTN","PSGOEC",141,0)
 N PSGORD S PSGORD=ORDER
"RTN","PSGOEC",142,0)
 Q:'$G(PSGORD)!'($G(PSGORD)["P")
"RTN","PSGOEC",143,0)
 I PSJDCTYP=1 G SOC
"RTN","PSGOEC",144,0)
 I PSJDCTYP=2 S PSJDCTYP=1 D SOC Q:'$G(PSJDCTYP)  D
"RTN","PSGOEC",145,0)
 .I ($G(PSJNOO)<0) Q
"RTN","PSGOEC",146,0)
 .N ND5310 S ND5310=$G(^PS(53.1,+PSGORD,0))
"RTN","PSGOEC",147,0)
 .N PSGORD S PSGORD=$P(ND5310,"^",25) I PSGORD S PSJDCTYP=2 D SOC K PSJDCTYP
"RTN","PSGOEC",148,0)
 Q
"RTN","PSGOEC",149,0)
 ;
"RTN","PSGOEC",150,0)
PNDRNOK(ORDER) ; Execute DC Pending Renew enhancement only if 
"RTN","PSGOEC",151,0)
 ;                  1) Renewal order is pending/non-verified, and 
"RTN","PSGOEC",152,0)
 ;                  2) Original order is not DC'd or Expired
"RTN","PSGOEC",153,0)
 Q:'$G(PSGORD)!'($G(PSGORD)["P") 0
"RTN","PSGOEC",154,0)
 N ORIGORD,ORIGSTOP S ORIGORD=$P($G(^PS(53.1,+ORDER,0)),"^",25) Q:'ORIGORD 0  D  I ORIGSTOP<$G(PSGDT) Q 0
"RTN","PSGOEC",155,0)
 .S ORIGSTOP=$S(ORIGORD["U":$P($G(^PS(55,PSGP,5,+ORIGORD,2)),"^",4),ORIGORD["V":$P($G(^PS(55,PSGP,"IV",+ORIGORD,0)),"^",3),1:"")
"RTN","PSGOEC",156,0)
 Q:'($P($G(^PS(53.1,+PSGORD,0)),U,24)="R") 0
"RTN","PSGOEC",157,0)
 Q 1
"RTN","PSGOEC",158,0)
 ;
"RTN","PSGOEC",159,0)
TST4DC ; Test for DC at prompt
"RTN","PSGOEC",160,0)
 R X:$S($D(DTIME):DTIME,1:300) I '$T S %=2 Q
"RTN","PSGOEC",161,0)
 S %=$S(X="DC":1,X="Dc":1,X="dc":1,X="dC":1,X="D":1,X="d":1,X="":2,X="^":2,X]"":"",1:2)
"RTN","PSGOEC",162,0)
 Q
"RTN","PSGOEF")
0^7^B99775279^B92772116
"RTN","PSGOEF",1,0)
PSGOEF ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR ;14 May 98 / 2:17 PM
"RTN","PSGOEF",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**7,30,29,35,39,47,50,56,80,116,110,111,133,153,134,222,113,181,260**;16 DEC 97;Build 94
"RTN","PSGOEF",3,0)
 ;
"RTN","PSGOEF",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOEF",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOEF",6,0)
 ; Reference to DOSE^PSSORPH is supported by DBIA 3234.
"RTN","PSGOEF",7,0)
 ;
"RTN","PSGOEF",8,0)
START ;
"RTN","PSGOEF",9,0)
 I '$D(^PS(53.1,+PSGORD)) W $C(7),!?3,"Cannot find this pending order (#",+PSGORD,")." Q
"RTN","PSGOEF",10,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12) K PSGFDX,PSGEFN,PSGOEEF,PSGOES,PSGONF,PSGRDTX S PSGOES=1,(PSGOEF,PSGOEEF)=0,PSGOEEG=3
"RTN","PSGOEF",11,0)
 I $D(PSJTUD) S PSGDO=$P($G(^PS(53.1,+PSGORD,.3)),U),(PSGPDRG,PSGPD)=PSJCOI,(PSGPDRGN,PSGPDN)=$$OINAME^PSJLMUTL(PSGPD)
"RTN","PSGOEF",12,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S X=PSGSCH D EN^PSGORS0 D
"RTN","PSGOEF",13,0)
 . S:($D(X)&($P($G(^PS(53.1,+PSGORD,2)),"^",5)="")&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="N")) PSGAT=PSGS0Y
"RTN","PSGOEF",14,0)
 . NEW PSJDOX,PSJDOSE,PSJPIECE,PSJUNIT,PSJX,X
"RTN","PSGOEF",15,0)
 . S X=$G(^PS(53.1,+PSGORD,1,1,0)) Q:'+X
"RTN","PSGOEF",16,0)
 . D DOSE^PSSORPH(.PSJDOX,+X,"U")
"RTN","PSGOEF",17,0)
 . I $S('$D(PSJDOX):1,1:+PSJDOX(1)=-1) Q
"RTN","PSGOEF",18,0)
 . S PSJPIECE=$S($P(PSJDOX(1),U)="":3,1:1)
"RTN","PSGOEF",19,0)
 . S X=^PS(53.1,+PSGORD,.2)
"RTN","PSGOEF",20,0)
 . S:PSJPIECE=3 PSJDOSE=$P(X,U,2)
"RTN","PSGOEF",21,0)
 . S:PSJPIECE=1 PSJDOSE=$P(X,U,5),PSJUNIT=$P(X,U,6)
"RTN","PSGOEF",22,0)
 . F X=0:0 S X=$O(PSJDOX(X)) Q:+$G(PSJX)!'X  D
"RTN","PSGOEF",23,0)
 .. I PSJPIECE=3,($P(PSJDOX(X),U,3)'=PSJDOSE) Q
"RTN","PSGOEF",24,0)
 .. I PSJPIECE=1,($P(PSJDOX(X),U,1)_$P(PSJDOX(X),U,2)'=(PSJDOSE_PSJUNIT)) Q
"RTN","PSGOEF",25,0)
 .. S:+$P(PSJDOX(X),U,12) $P(^PS(53.45,PSJSYSP,2,1,0),U,2)=+$P(PSJDOX(X),U,12),PSJX=1
"RTN","PSGOEF",26,0)
 I PSGEB'=PSGOPR F X=7,11 S Y=$T(@(3_X)),@("PSGEFN("_X_")="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEF",27,0)
 D GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",28,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S PSGSD="" D:PSGS0Y]""
"RTN","PSGOEF",29,0)
 .N PSJX S PSJX=$P($G(^PS(53.1,+PSGORD,0)),U,25) I PSJX="" Q
"RTN","PSGOEF",30,0)
 .I PSJX["U" S PSGSD=$P($G(^PS(55,DFN,5,+PSJX,2)),U,2) Q
"RTN","PSGOEF",31,0)
 .I PSJX["V" S PSGSD=$P($G(^PS(55,DFN,"IV",+PSJX,0)),U,2) Q
"RTN","PSGOEF",32,0)
 .I PSJX["P" S PSGSD=$P($G(^PS(53.1,+PSJX,2)),U,2)
"RTN","PSGOEF",33,0)
 S:PSGSD="" PSGSD=PSGLI
"RTN","PSGOEF",34,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",+PSGPD)
"RTN","PSGOEF",35,0)
 S:$P($G(PSGNEDFD),U,3)="" $P(PSGNEDFD,U,3)=PSGST  ; N PSGOEA S PSGOEA="R"
"RTN","PSGOEF",36,0)
 S (PSGNESD,PSGSD)=$$ENSD^PSGNE3(PSGSCH,PSGS0Y,PSGLI,PSGSD)
"RTN","PSGOEF",37,0)
 ;if this is a renewal order, ignore any 'requested start date' received.  Use the system calculated start date.
"RTN","PSGOEF",38,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" D
"RTN","PSGOEF",39,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEF",40,0)
 E  D
"RTN","PSGOEF",41,0)
 . S X=$$DSTART^PSJDCU(DFN,$P(^PS(53.1,+PSGORD,0),U,25)) I X]"" S (PSGNESD,PSGSD)=X K PSGRSD
"RTN","PSGOEF",42,0)
 D   ; Extend the Default Stop Date if needed for the first renewed order.
"RTN","PSGOEF",43,0)
 .N PSGOEAO,PSGWALLO
"RTN","PSGOEF",44,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEAO=PSGOEA,PSGOEA="R",PSGWALLO=$P(^PS(55,DFN,5.1),U)
"RTN","PSGOEF",45,0)
 .D ENFD^PSGNE3(PSGLI) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSGOEF",46,0)
 .I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S PSGOEA=PSGOEAO,$P(^PS(55,DFN,5.1),U)=PSGWALLO
"RTN","PSGOEF",47,0)
 N DUR,PSGRNSD S PSGRNSD=+$$LASTREN^PSJLMPRI(DFN,PSGORD) I PSGRNSD S DUR=$$GETDUR^PSJLIVMD(DFN,PSGORD,"P",1) I DUR]"" D
"RTN","PSGOEF",48,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN S PSGFD=$$FMADD^XLFDT(PSGRNSD,,,DURMIN)
"RTN","PSGOEF",49,0)
 S PSGOFD="",PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD),PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOEF",50,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSGOEF",51,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) N DRG,DRGCNT S DRGCNT=0 D
"RTN","PSGOEF",52,0)
 .F X=0:0 S X=$O(^PSDRUG("ASP",+PSGPD,X)) Q:'X!(DRGCNT>1)  S:$P($G(^PSDRUG(+X,2)),U,3)["U" DRGCNT=DRGCNT+1,DRG=+X
"RTN","PSGOEF",53,0)
 .I DRGCNT=1 K ^PS(53.45,PSJSYSP,2) S ^PS(53.45,PSJSYSP,2,1,0)=DRG_U_1,^PS(53.45,PSJSYSP,2,0)="^53.4502^1^1",PS(53.45,PSJSYSP,2,"B",+DRG,1)=""
"RTN","PSGOEF",54,0)
 Q
"RTN","PSGOEF",55,0)
FINISH ;
"RTN","PSGOEF",56,0)
 ; force display of second screen if CPRS order checks exist
"RTN","PSGOEF",57,0)
 N NSFF,PSGOEF39,PSGEDTOI S NSFF=1 K PSJNSS,PSGEDTOI,PSGOEER
"RTN","PSGOEF",58,0)
 I $G(PSGORD),$D(PSGRDTX(+PSGORD)) D  K PSGRDTX
"RTN","PSGOEF",59,0)
 . ;PSJOCDSC stores the default start & stop date ^ cal start & stop date (use in dosing calculation for duration)
"RTN","PSGOEF",60,0)
 . ;for some reasons PSGSD & PSGFD are reset to the cal dates if order has duration defined
"RTN","PSGOEF",61,0)
 . S PSJOCDSC("CX","PSGSD",+PSGORD)=$G(PSGSD)_U_$G(PSGRDTX(+PSGORD,"PSGRSD"))
"RTN","PSGOEF",62,0)
 . S PSJOCDSC("CX","PSGFD",+PSGORD)=$G(PSGFD)_U_$G(PSGRDTX(+PSGORD,"PSGRFD"))
"RTN","PSGOEF",63,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRSD")) PSGSD=PSGRDTX(+PSGORD,"PSGRSD")
"RTN","PSGOEF",64,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRFD")) PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGRFD")):PSGRDTX(+PSGORD,"PSGRFD"),1:$G(PSGNEFD))
"RTN","PSGOEF",65,0)
 N PSJCOM S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8)
"RTN","PSGOEF",66,0)
 ; 
"RTN","PSGOEF",67,0)
 ; PSJ*5*222
"RTN","PSGOEF",68,0)
 ; PSJCT1 is a counter variable.  Every piece of a complex order calls PSGOEF.
"RTN","PSGOEF",69,0)
 ; The only time this code is to look for overlapping admin times is when the
"RTN","PSGOEF",70,0)
 ; first part of a complex order is being finished.  This variable will keep track
"RTN","PSGOEF",71,0)
 ; of how many "parts" of the complex order have been checked.
"RTN","PSGOEF",72,0)
 ; 
"RTN","PSGOEF",73,0)
 ; Also, since the user can select multiple complex orders to finish, like selecting
"RTN","PSGOEF",74,0)
 ; orders 1-2 or 1-3 from the profile, PSJCT1A will keep track of whether the parent
"RTN","PSGOEF",75,0)
 ; order number is the same as the first parent order number selected for finishing.
"RTN","PSGOEF",76,0)
 ; Since the PSJCT1 counter variable will still be set if multiple complex orders
"RTN","PSGOEF",77,0)
 ; are selected, PSJCT1 will be re-set to 1 if the parent complex order number (PSJCT1A) is
"RTN","PSGOEF",78,0)
 ; not equal to the original parent order number (PSJCOM).
"RTN","PSGOEF",79,0)
 ; 
"RTN","PSGOEF",80,0)
 S PSJCT1=$G(PSJCT1)+1
"RTN","PSGOEF",81,0)
 I PSJCT1=1 S PSJCT1A=PSJCOM
"RTN","PSGOEF",82,0)
 I $G(PSJCT1A)'=PSJCOM S PSJCT1=1,PSJCT1A=PSJCOM
"RTN","PSGOEF",83,0)
 ; End of flag setting for PSJ*5*222
"RTN","PSGOEF",84,0)
 ;PRE UAT group requested to not show the second screen since FDB OC has more text and provider override reason appears after 2nd screen 
"RTN","PSGOEF",85,0)
 ;I $O(^PS(53.1,+PSGORD,12,0))!$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSGOEF",86,0)
 ;.Q:$G(PSJLMX)=1  ; there's no second screen to display
"RTN","PSGOEF",87,0)
 ;.S VALMBG=16 D RE^VALM4,PAUSE^VALM1
"RTN","PSGOEF",88,0)
 D FULL^VALM1
"RTN","PSGOEF",89,0)
 I '$D(IOINORM)!('$D(IOINHI)) S X="IORVOFF;IORVON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PSGOEF",90,0)
 I $G(PSJCOM)'="",$G(PSJCT1)=1 D
"RTN","PSGOEF",91,0)
 . D OVERLAP^PSGOEF2 I $G(PSJOVRLP)=1 D
"RTN","PSGOEF",92,0)
 . . N X,X1,DIR
"RTN","PSGOEF",93,0)
 . . W !!,"**WARNING**"
"RTN","PSGOEF",94,0)
 . . W !,"The highlighted admin times for these portions of this complex order overlap.",!!
"RTN","PSGOEF",95,0)
 . . S (X,X1)="" F  S X=$O(^TMP("PSJATOVR",$J,X)) Q:X=""  D
"RTN","PSGOEF",96,0)
 . . . S X1=$G(^TMP("PSJATOVR",$J,X))
"RTN","PSGOEF",97,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),"Part "_X,IORVOFF," has a schedule of "_$P(X1,"^",2)_" and admin time(s) of "
"RTN","PSGOEF",98,0)
 . . . W $S($P(X1,"^",4)=1:IORVON,1:""),$P(X1,"^",3),IORVOFF
"RTN","PSGOEF",99,0)
 . . . W !
"RTN","PSGOEF",100,0)
 . . . W $S($G(PSJOVR("CONJ",X))="A":"AND",$G(PSJOVR("CONJ",X))="T":"THEN",1:""),!
"RTN","PSGOEF",101,0)
 . . W !,"Please ensure the schedules and administration times are appropriate.",!
"RTN","PSGOEF",102,0)
 . . S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSGOEF",103,0)
 K ^TMP("PSJATOVR",$J)
"RTN","PSGOEF",104,0)
 I $G(PSJPROT)=3,'$D(PSJTUD),'$$ENIVUD^PSGOEF1(PSGORD) Q
"RTN","PSGOEF",105,0)
 I $G(PSGOSCH)]"" D  S:$G(PSGS0XT)'="" $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSGOEF",106,0)
 .N PSGOES,PSGS0Y,PSGSCH S X=PSGOSCH K:$G(PSJTUD) NSFF D ENOS^PSGS0
"RTN","PSGOEF",107,0)
 .I '($G(PSGORD)["P"&($P($G(^PS(53.1,+PSGORD,0)),"^",24)="R")) I $G(X)]""&$G(PSGS0Y) S:$G(PSGAT)="" PSGAT=PSGS0Y
"RTN","PSGOEF",108,0)
 .I $G(PSJNSS) S PSGOSCH="" K PSJNSS
"RTN","PSGOEF",109,0)
 .I $G(PSGORD)["P",$G(PSGAT),$G(PSGS0Y),($G(PSGOSCH)]"") I PSGAT'=PSGS0Y D
"RTN","PSGOEF",110,0)
 ..S PSGNSTAT=1 W $C(7),!!,"PLEASE NOTE:  This order's admin times (",PSGAT,")"
"RTN","PSGOEF",111,0)
 ..W !?13," do not match the ward times (",PSGS0Y,")"
"RTN","PSGOEF",112,0)
 ..W !?13," for this administration schedule (",PSGOSCH,")",!
"RTN","PSGOEF",113,0)
 ..S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR K DIR  W !
"RTN","PSGOEF",114,0)
 I $G(PSGS0XT)="" S $P(^PS(53.1,+PSGORD,2),"^",6)=$S($P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:"")
"RTN","PSGOEF",115,0)
 S CHK=0 S:$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" PSGSI=$$ENPC^PSJUTL("U",+PSJSYSP,180,PSGSI)
"RTN","PSGOEF",116,0)
 I '$G(PSJTUD),$G(PSJNSS),($G(PSGOSCH)]"") D NSSCONT^PSGS0(PSGOSCH,PSGS0XT) K PSJNSS S PSGOSCH=""
"RTN","PSGOEF",117,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10)
"RTN","PSGOEF",118,0)
 I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")
"RTN","PSGOEF",119,0)
 I 'PSGOEFF I (($G(PSGS0XT)="D")&($G(PSGAT)="")) S X=" Admin Times",PSGOEFF=1,PSGOEF39=1
"RTN","PSGOEF",120,0)
 I PSGOEFF,X]"" S X=X_" before it can be finished."
"RTN","PSGOEF",121,0)
 I PSGOEFF S CHK=1 W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSGOEF",122,0)
 I $G(PSGOEF39) S PSGOEE=0,PSGOEFF=0 D  I 'PSGOEE D REFRESH^VALM G DONE
"RTN","PSGOEF",123,0)
 .S F1=53.1,MSG=0,Y=$T(39),@("PSGFN(39)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEEF,PSGOEE)=1 W ! D @$P($T(39),";",3) S CHK=0
"RTN","PSGOEF",124,0)
 I PSGOEFF=1 S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0 G:'PSGOEE DONE
"RTN","PSGOEF",125,0)
 I PSGOEFF=11 S F1=53.1,MSG=0,Y=$T(32),@("PSGFN(32)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(32),";",3) D  G:'PSGOEE DONE
"RTN","PSGOEF",126,0)
 .S F1=53.1,MSG=0,Y=$T(38),@("PSGFN(38)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(38),";",3) S CHK=0
"RTN","PSGOEF",127,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(+PSGPD,0) I CHK D ABORTACC Q
"RTN","PSGOEF",128,0)
 I 'PSGOEFF D OC531^PSGOESF ; check every dispense drug from CPRS
"RTN","PSGOEF",129,0)
 S VALMBG=1
"RTN","PSGOEF",130,0)
 I 'PSGOEFF&($D(PSGORQF)) D RE^VALM4 Q
"RTN","PSGOEF",131,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSGOEF",132,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",133,0)
 S PSJLMFIN=1
"RTN","PSGOEF",134,0)
 K PSJACEPT I $O(^PS(53.1,+PSGORD,12,0)) S PSJLMP2=1
"RTN","PSGOEF",135,0)
 S PSGOEENO=0,PSGSTAT=$S($P(PSJSYSP0,U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEF",136,0)
 NEW PSJDOSE,PSJDOX,PSJDSFLG
"RTN","PSGOEF",137,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEF",138,0)
 S:+$G(PSJDSFLG) VALMSG="Dosage Ordered & Dispense Drug are not compatible"
"RTN","PSGOEF",139,0)
 I PSGODO=PSGDO S PSGOEEF(109)=""
"RTN","PSGOEF",140,0)
 I PSGODO'=PSGDO S PSGOEENO=1,VALMSG="This change will cause a new order to be created  "
"RTN","PSGOEF",141,0)
 D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEF",142,0)
 I $G(PSJNSS) D  S PSGOEEF(26)="" K PSJACEPT,PSJNSS
"RTN","PSGOEF",143,0)
 .K DIR S DIR(0)="FOA",DIR("A")="Invalid Schedule" D ^DIR K DIR
"RTN","PSGOEF",144,0)
 I $G(PSGS0XT)="D",'$G(PSGS0Y),'$G(PSGAT),((",P,R,")'[(","_$G(PSGST)_",")) D  S PSGOEEF(39)="" K PSJACEPT
"RTN","PSGOEF",145,0)
 .K DIR S DIR(0)="FOA",DIR("A")="   WARNING - Admin times are required for DAY OF WEEK schedules  " D ^DIR K DIR
"RTN","PSGOEF",146,0)
 ;***PSJ*5*113
"RTN","PSGOEF",147,0)
 I $G(PSGAT)="",(PSGST="C"!(PSGST="R")) D
"RTN","PSGOEF",148,0)
 .I $G(PSGS0XT) Q:$$ODD^PSGS0(PSGS0XT)
"RTN","PSGOEF",149,0)
 .Q:$$PRNOK^PSGS0($G(PSGSCH))
"RTN","PSGOEF",150,0)
 .Q:($P($G(ZZND),"^",5)'="C")
"RTN","PSGOEF",151,0)
 .K PSJACEPT
"RTN","PSGOEF",152,0)
 .K DIR S DIR(0)="FOA",DIR("A")="  WARNING - Admin times are required for CONTINUOUS orders " D ^DIR K DIR
"RTN","PSGOEF",153,0)
 ;***
"RTN","PSGOEF",154,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",155,0)
 I $G(PSJRNF),$G(^PS(53.1,+PSGORD,4)) D
"RTN","PSGOEF",156,0)
 . W $C(7),!!,"ACCEPTING THIS ORDER WILL CHANGE THE STATUS TO ACTIVE."
"RTN","PSGOEF",157,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to make this order Active",DIR("?",1)="Enter ""N"" if you wish to exit without Activating this order,"
"RTN","PSGOEF",158,0)
 . S DIR("?")="or ""Y"" to continue with the Activation process." D ^DIR S:'Y Y=-1 K DIR
"RTN","PSGOEF",159,0)
 I $G(PSJRNF),$G(Y)=-1 S PSJACEPT=0 D ABORTACC Q
"RTN","PSGOEF",160,0)
 I $G(PSJRNF),$G(Y)=1 S PSGOEAV=1
"RTN","PSGOEF",161,0)
 I $G(PSGEDTOI) D OC^PSJOE1
"RTN","PSGOEF",162,0)
 I $S($G(PSGORQF):0,$G(PSGEDTOI):0,$G(PSGOEER)["109^PSGOE8":1,$G(PSGOEER)["3^PSGOE8":1,$G(PSGOEER)["26^PSGOE8":1,$G(PSGOEER)["10^PSGOE81":1,$G(PSGOEER)["25^PSGOE81":1,1:0) D
"RTN","PSGOEF",163,0)
 . NEW PSJDD S PSJDD=+$$DD53P45^PSJMISC()
"RTN","PSGOEF",164,0)
 . D:$G(PSJDD) IN^PSJOCDS($G(PSGORD),"UD",PSJDD)
"RTN","PSGOEF",165,0)
 I $G(PSGORQF) S PSGOEENO=0,PSJACEPT=0
"RTN","PSGOEF",166,0)
 I PSGOEENO S PSJNOO=$$ENNOO^PSJUTL5("E"),PSJACEPT=$S(PSJNOO<0:0,1:1)
"RTN","PSGOEF",167,0)
ACCEPT ;
"RTN","PSGOEF",168,0)
 S VALMBCK=$S($G(PSJACEPT):"Q",1:"R")
"RTN","PSGOEF",169,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",170,0)
 K PSGOES,PSGRSD,PSGRSDN D:PSGOEENO NEW3^PSGOEE D:'PSGOEENO UPD^PSGOEF1 I $D(PSGOEF)!PSGOEENO S PSGCANFL=-1
"RTN","PSGOEF",171,0)
 ;saves drug allergy signs/symptoms PSJ*5*260
"RTN","PSGOEF",172,0)
 I +$G(^TMP("PSODAOC",$J,1,0)) D
"RTN","PSGOEF",173,0)
 .N DA,OCCDT,ORN,ORL,Z,RET,PSJDAOC
"RTN","PSGOEF",174,0)
 .S PSJDAOC="IP MEDS "_$S($G(PSGORD)["P":"Pending/Non-Verified",$G(PSGORD)["U":"Unit Dose",$G(PSGORD)["V":"IV",1:"")_" Order Acceptance",OCCDT=$$NOW^XLFDT
"RTN","PSGOEF",175,0)
 .I PSGORD["P" S ORN=$P(^PS(53.1,+PSGORD,0),U,21)
"RTN","PSGOEF",176,0)
 .I PSGORD["U" S ORN=$P(^PS(55,DFN,5,+PSGORD,0),U,21)
"RTN","PSGOEF",177,0)
 .I PSGORD["V" S ORN=$P(^PS(55,DFN,"IV",+PSGORD,0),U,21)
"RTN","PSGOEF",178,0)
 .Q:'$G(ORN)
"RTN","PSGOEF",179,0)
 .D DAOC^PSJHL3
"RTN","PSGOEF",180,0)
 K ^TMP("PSODAOC",$J)
"RTN","PSGOEF",181,0)
 D DONE1^PSGOEE
"RTN","PSGOEF",182,0)
 D DONE
"RTN","PSGOEF",183,0)
 Q
"RTN","PSGOEF",184,0)
BYPASS ;
"RTN","PSGOEF",185,0)
 S PSGCANFL=1
"RTN","PSGOEF",186,0)
 ;
"RTN","PSGOEF",187,0)
DONE ;
"RTN","PSGOEF",188,0)
 K CHK,DA,DIE,DR,DRG,MSG,Q1,Q2,PSGNSTAT,PSGEDTOI,PSGOEER
"RTN","PSGOEF",189,0)
 K PSJOVR
"RTN","PSGOEF",190,0)
 Q
"RTN","PSGOEF",191,0)
ABORTACC ; Abort Accept process.
"RTN","PSGOEF",192,0)
 K PSJCT1,PSJOVR,PSJOVRLP,PSJCT1A K ^TMP("PSODAOC",$J)
"RTN","PSGOEF",193,0)
 D ABORT^PSGOEE K PSGOEEF D GETUD^PSJLMGUD(PSGP,PSGORD),^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD) S VALMBCK="R",PSGSD=PSGNESD,PSGFD=PSGNEFD Q
"RTN","PSGOEF",194,0)
 ;
"RTN","PSGOEF",195,0)
 ;
"RTN","PSGOEF",196,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEF",197,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEF",198,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEF",199,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEF",200,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEF",201,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEF",202,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEF",203,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1      
"RTN","PSGOEF",204,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEF",205,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEF",206,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEF",207,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEF",208,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEF",209,0)
 ;
"RTN","PSGOEF",210,0)
AH ;
"RTN","PSGOEF",211,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSGOEF",212,0)
 Q
"RTN","PSGOEM")
0^21^B32911590^B31226298
"RTN","PSGOEM",1,0)
PSGOEM ;BIR/CML3-PSGOE MESSAGES ;26 NOV 97 / 8:28 AM 
"RTN","PSGOEM",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**81,260**;16 DEC 97;Build 94
"RTN","PSGOEM",3,0)
 ;
"RTN","PSGOEM",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA# 2256.
"RTN","PSGOEM",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEM",6,0)
 ;
"RTN","PSGOEM",7,0)
ENVM ;
"RTN","PSGOEM",8,0)
 W !!,"  Enter ORDER",$S(PSJON>1:"S (1-"_PSJON,1:" (1"),") you wish to ",$S('$D(PSJPRF):"select.",1:"view.") Q
"RTN","PSGOEM",9,0)
 ;
"RTN","PSGOEM",10,0)
ENCAM ;
"RTN","PSGOEM",11,0)
 W !!,"Enter a 'Y' (or press the RETURN key) to ",$S(PSJSYSU:"",1:"mark for "),"discontinu",$S(PSJSYSU:"e",1:"ation")," all of this"
"RTN","PSGOEM",12,0)
 W:'PSJSYSU ! W:PSJSYSU " " W "patient's" W:PSJSYSU ! W:'PSJSYSU " " W "orders.  Enter an 'N' (or '^') to leave this option now." Q
"RTN","PSGOEM",13,0)
 ;
"RTN","PSGOEM",14,0)
ENCOM ;
"RTN","PSGOEM",15,0)
 W !!,"Enter a 'Y' to ",$S(CF:"discontinue this order",1:"mark this order for discontinuation"),".  Press the RETURN key (or" W:'CF ! W:CF " " W "enter an 'N'" W:CF ! W:'CF " " W "or '^') to leave this option now." Q
"RTN","PSGOEM",16,0)
 ;
"RTN","PSGOEM",17,0)
ENDC ;
"RTN","PSGOEM",18,0)
 W !!,"You must enter 'DC' to discontinue the order or leave blank and press return to continue without discontinuing the order." Q
"RTN","PSGOEM",19,0)
 ;
"RTN","PSGOEM",20,0)
ENUMK ;
"RTN","PSGOEM",21,0)
 W " BEEN 'MARKED FOR DISCONTINUATION'."
"RTN","PSGOEM",22,0)
 F  W !,"DO YOU WANT TO 'UNMARK' ",$S($D(PSGORD):"IT",1:"THEM") S %=2 D YN^DICN Q:%  W !!?2,"Enter 'Y' to UNMARK "_$S($D(PSGORD):"this order",1:"these orders")_".  Enter 'N' to leave the order"_$E("s",$D(PSGORD)[0)_" MARKED AS IS.",!
"RTN","PSGOEM",23,0)
 Q
"RTN","PSGOEM",24,0)
 ;
"RTN","PSGOEM",25,0)
ENHLP(F1,F2) ; order entry fields' help
"RTN","PSGOEM",26,0)
 ; Input: F1 - File #
"RTN","PSGOEM",27,0)
 ;        F2 - Field #
"RTN","PSGOEM",28,0)
 N F,F0,F3,PSJD,PSJHP,PSJX
"RTN","PSGOEM",29,0)
 ;I X="?",$D(^DD(F1,F2,3)) S F=^(3) W !?5 F F0=1:1:$L(F," ") S F3=$P(F," ",F0) W:$L(F3)+$X>78 !?5 W F3_" "
"RTN","PSGOEM",30,0)
 ;
"RTN","PSGOEM",31,0)
 D FIELD^DID(F1,F2,"","HELP-PROMPT","PSJHP")
"RTN","PSGOEM",32,0)
 I X="?",$D(PSJHP("HELP-PROMPT")) S F=$G(PSJHP("HELP-PROMPT")) W !?5 F F0=1:1:$L(F," ") S F3=$P(F," ",F0) W:$L(F3)+$X>78 !?5 W F3_" "
"RTN","PSGOEM",33,0)
 ;
"RTN","PSGOEM",34,0)
 ;W:$D(^DD(F1,F2,12)) !,"("_^(12)_")" I $D(^(4)) X ^(4)
"RTN","PSGOEM",35,0)
 W:$D(^DD(F1,F2,12)) !,"("_^(12)_")" D FIELD^DID(F1,F2,"","XECUTABLE HELP","PSJX") I $D(PSJX("XECUTABLE HELP")) X PSJX("XECUTABLE HELP")
"RTN","PSGOEM",36,0)
 ;
"RTN","PSGOEM",37,0)
 ;  new code
"RTN","PSGOEM",38,0)
 D FIELD^DID(F1,F2,"","DESCRIPTION","PSJD")
"RTN","PSGOEM",39,0)
 G:$S(X="?":1,1:'$O(PSJD("DESCRIPTION",0))) SC F F=0:0 S F=$O(PSJD("DESCRIPTION",F)) Q:'F  I $D(PSJD("DESCRIPTION",F)) W !?2,PSJD("DESCRIPTION",F)
"RTN","PSGOEM",40,0)
 ;I F W:X="??" !?2,"..." I X?3."?" F F=F-1:0 S F=$O(^DD(F1,F2,21,F)) Q:'F  I $D(^(F,0)) W !?2,^(0)
"RTN","PSGOEM",41,0)
 I F2=106 W !?5,"CHOOSE FROM:",!?7,"W",?16,"WRITTEN",!?7,"P",?16,"TELEPHONE",!?7,"V",?16,"VERBAL",!
"RTN","PSGOEM",42,0)
 ; old code
"RTN","PSGOEM",43,0)
 ;G:$S(X="?":1,1:'$O(^DD(F1,F2,21,0))) SC F F=0:0 S F=$O(^DD(F1,F2,21,F)) Q:'F  I $D(^(F,0)) W !?2,^(0)
"RTN","PSGOEM",44,0)
 ;I F W:X="??" !?2,"..." I X?3."?" F F=F-1:0 S F=$O(^DD(F1,F2,21,F)) Q:'F  I $D(^(F,0)) W !?2,^(0),"RB.."
"RTN","PSGOEM",45,0)
 ;I F2=106 W !?5,"CHOOSE FROM:",!?7,"W",?16,"WRITTEN",!?7,"P",?16,"TELEPHONE",!?7,"V",?16,"VERBAL",!
"RTN","PSGOEM",46,0)
 ;
"RTN","PSGOEM",47,0)
SC ;
"RTN","PSGOEM",48,0)
 I F2=5!(F2=6) W !,"CHOOSE FROM:",!?8,0,?16,"NO",!?8,1,?16,"YES" Q
"RTN","PSGOEM",49,0)
 Q
"RTN","PSGOEM",50,0)
 ;
"RTN","PSGOEM",51,0)
ENFF ; up-arrow to another field
"RTN","PSGOEM",52,0)
 S Y=-1 I '$D(PSGFOK) W $C(7),"  ??" Q
"RTN","PSGOEM",53,0)
 ;I X="^301"!($P("^DOSAGE ORDERED",X)="") W:X="^301" "  " S:X="^301" X="^" W $P("^DOSAGE ORDERED",X,2) S Y=301 Q
"RTN","PSGOEM",54,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGFOK(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOEM",55,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGFOK(+Y))" D ^DIC K DIC S Y=+Y Q
"RTN","PSGOEM",56,0)
 ;
"RTN","PSGOEM",57,0)
ENAH ; help text for "ACTION" prompt
"RTN","PSGOEM",58,0)
 W !!,"YOU MAY SELECT:"
"RTN","PSGOEM",59,0)
 W:PSGACT["B" !?5,"B to bypass (take no action on) a pending order."
"RTN","PSGOEM",60,0)
 W:PSGACT["D" !?5,"D (or DC) to discontinue an order.  *WARNING* If you discontinue a",!?7,"non-verified order it is deleted from the system."
"RTN","PSGOEM",61,0)
 W:PSGACT["E" !?5,"E to edit an active or non-verified order.  NOTE: Nursing must be notified",!?7,"of all changes."
"RTN","PSGOEM",62,0)
 W:PSGACT["F" !?5,"F to finish a pending order."
"RTN","PSGOEM",63,0)
 I PSGACT["H" S HF=$S('$D(^PS(55,PSGP,5,+PSGORD,0)):1,1:$P(^(0),"^",9)'="H") W !?5,"H to ",$S(HF:"place this order on",1:"take this order off of")," hold."
"RTN","PSGOEM",64,0)
 W:PSGACT["I" !?5,"I to mark a non-verified order as incomplete, or to unmark a non-verified",!?7,"order so marked.  An order marked as incomplete may not be verified."
"RTN","PSGOEM",65,0)
 W:PSGACT["L" !?5,"L to display either the activity log or the dispense log associated with",!,?7,"this order."
"RTN","PSGOEM",66,0)
 W:PSGACT["N" !?5,"N to mark this order as 'NOT TO BE GIVEN'.  Orders so marked may not be",!?7,"renewed,"_$S(PSJSYSU:"",1:" or")_" reinstated"_$S(PSJSYSU:", or copied.",1:".")
"RTN","PSGOEM",67,0)
 W:PSGACT["R" !?5,"R to ",$S(PSGRRF:"reinstate",1:"renew")," this order."
"RTN","PSGOEM",68,0)
 W:PSGACT["V" !?5,"V to verify (make active) a non-verified order.  NOTE: You cannot verify",!?7,"an order that has been marked as incomplete."
"RTN","PSGOEM",69,0)
 I $D(PSGOEA),PSGOEA?2."?" W !!,"You may also select:" I 'PSGOENG,'$D(PSGODF),PSJPCAF,'PSGDI,'PSGPI W !?5,"C to copy (duplicate) this order into a new, non-verified order."
"RTN","PSGOEM",70,0)
 I $D(PSGOEA),PSGOEA?2."?" W !?5,"P to print this order to a device.",!?5,"S to show this order again."
"RTN","PSGOEM",71,0)
 I PSGOEAV W !!,"PLEASE NOTE: This order is automatically verified, and unless discontinued",!?13,"now, will show as active."
"RTN","PSGOEM",72,0)
 W !!?2,"You may also press the RETURN key if you are finished with this order or wish",!,"to take no action on it." W:'$D(PSGOETOF) "  Enter an '^' if you do not wish to take any action on any other orders."
"RTN","PSGOEM",73,0)
 Q
"RTN","PSGOEV")
0^20^B73577896^B70528939
"RTN","PSGOEV",1,0)
PSGOEV ;BIR/CML3-VERIFY (MAKE ACTIVE) ORDERS ; 4/16/10 9:18am
"RTN","PSGOEV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**5,7,15,28,33,50,64,58,77,78,80,110,111,133,171,207,241,267,268,260**;16 DEC 97;Build 94
"RTN","PSGOEV",3,0)
 ;
"RTN","PSGOEV",4,0)
 ; Reference to ^ORD(101 supported by DBIA #872.
"RTN","PSGOEV",5,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180.
"RTN","PSGOEV",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGOEV",7,0)
 ; Reference to ^PSSLOCK supported by DBIA #2789.
"RTN","PSGOEV",8,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA #2410.
"RTN","PSGOEV",9,0)
 ;
"RTN","PSGOEV",10,0)
EN(PSGORD) ;
"RTN","PSGOEV",11,0)
ENSF ; This entry point is used by Speed finish only.
"RTN","PSGOEV",12,0)
 ; Send SN update to CPRS if auto-verify off and from Order Set entry
"RTN","PSGOEV",13,0)
 S:'$D(PSGOEAV) PSGOEAV=$P($G(PSJSYSP0),"^",9)&$G(PSJSYSU)
"RTN","PSGOEV",14,0)
 I $D(PSGOES),'PSGOEAV,PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSGOEV",15,0)
 D FULL^VALM1 I 'PSJSYSU W $C(7),$C(7),!!," THIS FUNCTION NOT AVAILABLE TO WARD STAFF." Q
"RTN","PSGOEV",16,0)
 S CHK=0 I PSGORD["P" S X=$P($G(^PS(53.1,+PSGORD,0)),"^",19) I X,$D(^PS(55,PSGP,5,$P(^(0),"^",19))) S CHK=+PSGORD,PSGORD=X_"U" L -^PS(53.1,CHK) L +^PS(55,PSGP,5,+PSGORD):1 E  W !!,"Another terminal is editing this order." G DONE
"RTN","PSGOEV",17,0)
 I +PSJSYSU=3 D DDCHK G:CHK DONE
"RTN","PSGOEV",18,0)
 I PSGORD["P" D CHK($G(^PS(53.1,+PSGORD,0)),$G(^(.2)),$G(^(2)))
"RTN","PSGOEV",19,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOEV",20,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=1 S X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",21,0)
 I $G(CHK) Q:$D(PSJSPEED)  D EN^VALM("PSJU LM ACCEPT") G:'$G(PSJACEPT) DONE ;G VFY
"RTN","PSGOEV",22,0)
 I PSGORD["U" G:'$D(^PS(55,PSGP,5,+PSGORD,4)) VFY I +PSJSYSU=3,$P(^(4),"^",3) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A PHARMACIST." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",23,0)
 I PSGORD["U" I +PSJSYSU=1,+^PS(55,PSGP,5,+PSGORD,4) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A NURSE." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",24,0)
 ;
"RTN","PSGOEV",25,0)
VFY ; change status, move to 55, and change label record **ENHANCEMENTS MADE IN PSJ*5.0*260
"RTN","PSGOEV",26,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D VFY^PSJCOM Q
"RTN","PSGOEV",27,0)
 NEW PSJDOSE,PSJDSFLG,PSJDIS,PSGORQF
"RTN","PSGOEV",28,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEV",29,0)
 S PSJDIS=$P(^PS(53.45,PSJSYSP,2,1,0),U,1)
"RTN","PSGOEV",30,0)
 IF $G(PSJNEWOE)=0,'$G(PSJLMFIN),'$G(PSJSTARI),'$G(PSGCOPY) D EN^PSJGMRA($G(DFN),$G(PSJDIS)),IN^PSJOCDS($G(PSGORD),"UD",$G(PSJDIS)),ENDDC^PSGSICHK($G(PSGP),$G(PSJDIS)) IF $G(PSGORQF) D EN^VALM("PSJ LM UD ACTION") QUIT
"RTN","PSGOEV",31,0)
 D FULL^VALM1 ;PSJ*5*241
"RTN","PSGOEV",32,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSGOEV",33,0)
 . S PSGOEEF(109)=1
"RTN","PSGOEV",34,0)
 . S PSJACEPT=0
"RTN","PSGOEV",35,0)
 . ;D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEV",36,0)
 D DDCHK G:CHK DONE
"RTN","PSGOEV",37,0)
 I $G(PSGSCH)]"",((",P,R,")'[(","_PSGST_",")) D  I CHK G DONE
"RTN","PSGOEV",38,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOEV",39,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!,"This is a 'DAY OF WEEK' schedule and MUST have admin times.",! D PAUSE^VALM1
"RTN","PSGOEV",40,0)
 I $G(PSGSCH)]"" D  I CHK G DONE
"RTN","PSGOEV",41,0)
 .N X,Y,PSGS0XT,PSGS0Y,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",42,0)
 W !,"...a few moments, please..."
"RTN","PSGOEV",43,0)
 I PSGORD["P" D
"RTN","PSGOEV",44,0)
 . N PND0,PSGORDR,PSJPRIO,PSJSCHED S PND0=^PS(53.1,+PSGORD,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D  Q
"RTN","PSGOEV",45,0)
 .. N OEORD,OOEORD,FILE55,FILE55N0 S FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSGOEV",46,0)
 .. S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,PSGORD,+$$LASTREN^PSJLMPRI(DFN,PSGORD))
"RTN","PSGOEV",47,0)
 .. S PSGORDP=PSGORD,DIE="^PS(53.1,",DA=+PSGORD,DR="28////A;104////@" W "." D ^DIE
"RTN","PSGOEV",48,0)
 .. D START^PSGOTR(PSGORD,+PSGORDR) I OEORD D
"RTN","PSGOEV",49,0)
 ... K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSGOEV",50,0)
 ... D EN1^PSJHL2(DFN,"SC",PSGORDR),EN^PSGPEN(PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSGOEV",51,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in 55
"RTN","PSGOEV",52,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEV",53,0)
 . S DIE="^PS(53.1,",DA=+PSGORD,DR="28////A" W "." D ^DIE,^PSGOT
"RTN","PSGOEV",54,0)
 . S PSJPRIO=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,.2)),"^",4),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,.2)),"^",4),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,.2)),"^",4))
"RTN","PSGOEV",55,0)
 . S PSJSCHED=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,2)),"^"),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,2)),"^"),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,0)),"^",15))
"RTN","PSGOEV",56,0)
 . I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCHED)="NOW")!($G(PSJSCHED)["STAT") D NOTIFY^PSJHL4(PSGORD,DFN,$G(PSJPRIO),$G(PSJSCHED))
"RTN","PSGOEV",57,0)
 . I $G(PSGRDTX)="" S PSGRDTX=$G(^PS(53.1,+PSGORDP,2.5))
"RTN","PSGOEV",58,0)
 S DA=+PSGORD,DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+22000 D ^PSGAL5 W "." S VND4=$G(^PS(55,PSGP,5,DA,4))
"RTN","PSGOEV",59,0)
 I $G(PSGRDTX) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Start Date",+$G(PSGRDTX))
"RTN","PSGOEV",60,0)
 I $P($G(PSGRDTX),U,3) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Stop Date",+$P($G(PSGRDTX),U,3))
"RTN","PSGOEV",61,0)
 N DUR,DURON S DURON=$S($G(PSGORD):$G(PSGORD),1:"") I DURON D
"RTN","PSGOEV",62,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",1:5),1),1:"")
"RTN","PSGOEV",63,0)
 I $G(DUR)]"" S $P(^PS(55,PSGP,5,+PSGORD,2.5),"^",2)=DUR
"RTN","PSGOEV",64,0)
 D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSGOEV",65,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSGOEV",66,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSGOEV",67,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",9):1,1:$P(VND4,"^",15)) D EN^PSGPEN(+PSGORD)
"RTN","PSGOEV",68,0)
 S $P(VND4,"^",+PSJSYSU=1+9)=1 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSGOEV",69,0)
 I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEV",70,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSGOEV",71,0)
 I '$P(VND4,U,9) S ^PS(55,"APV",PSGP,+PSGORD)=""
"RTN","PSGOEV",72,0)
 I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSGOEV",73,0)
 I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSGOEV",74,0)
 I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSGOEV",75,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSGOEV",76,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOEV",77,0)
 S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)="" S PSGACT="C"_$S('$D(^PS(55,PSGP,5,+PSGORD,4)):"E",$P(^(4),"^",16):"",1:"E")_"RS",PSGCANFL=2
"RTN","PSGOEV",78,0)
 S VALMBCK="Q" D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSGOEV",79,0)
  ; **This is where the Automated Dispensing Machine hook is called. Do NOT DELETE or change this location **
"RTN","PSGOEV",80,0)
 D NEWJ^PSJADM
"RTN","PSGOEV",81,0)
  ; **END of Interface hook **
"RTN","PSGOEV",82,0)
 D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U")
"RTN","PSGOEV",83,0)
DONE ;
"RTN","PSGOEV",84,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSGOEV",85,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSGOEV",86,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSGOEV",87,0)
 .Q:Y="N"
"RTN","PSGOEV",88,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSGOEV",89,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X Q
"RTN","PSGOEV",90,0)
 ;
"RTN","PSGOEV",91,0)
LBL ;
"RTN","PSGOEV",92,0)
 Q
"RTN","PSGOEV",93,0)
 ;
"RTN","PSGOEV",94,0)
CHK(ND,DRG,ND2) ; checks for data in required fields
"RTN","PSGOEV",95,0)
 ; Input: ND  - ^(PS(53.1,PSGORD,0)
"RTN","PSGOEV",96,0)
 ;        DRG - ^(.2)
"RTN","PSGOEV",97,0)
 ;        ND2 - ^(2)
"RTN","PSGOEV",98,0)
 S Y=$G(Y)
"RTN","PSGOEV",99,0)
 S CHK="" I DRG,$D(^PS(50.7,+DRG,0))
"RTN","PSGOEV",100,0)
 E  S CHK=1
"RTN","PSGOEV",101,0)
 I ND="" S CHK=CHK_23
"RTN","PSGOEV",102,0)
 E  S CHK=CHK_$S($P(ND,"^",3):"",1:2)_$S($P(ND,"^",7)]"":"",1:3)
"RTN","PSGOEV",103,0)
 ;The naked reference on the line below refers to the variable ND which is ^PS(53.1,PSGORD,0).
"RTN","PSGOEV",104,0)
 I ND2="" S CHK=CHK_$S('$D(^(0)):4,$P(^(0),"^",7)="OC":"",1:4)_56
"RTN","PSGOEV",105,0)
 E  S CHK=CHK_$S($P(ND2,"^")]"":"",ND="":4,$P(ND,"^",7)="OC":"",1:4)_$S($P(ND2,"^",2):"",1:5)_$S($P(ND2,"^",4):"",1:6)
"RTN","PSGOEV",106,0)
 I $$CHECK^PSGOE8(PSJSYSP),$P(DRG,U,2)="" S CHK=CHK_8
"RTN","PSGOEV",107,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSGOEV",108,0)
 S:'$$DDOK^PSGOE2("^PS(53.45,"_PSJSYSP_",2,",+DRG) CHK=CHK_7,(PSGDFLG,PSGDI)=1
"RTN","PSGOEV",109,0)
 S:'$$OIOK^PSGOE2(+DRG) PSGPFLG=1
"RTN","PSGOEV",110,0)
 I 'CHK,$G(PSGSCH)]"" D
"RTN","PSGOEV",111,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",112,0)
 Q:'CHK
"RTN","PSGOEV",113,0)
 W $C(7)
"RTN","PSGOEV",114,0)
 ;
"RTN","PSGOEV",115,0)
CHKM ;
"RTN","PSGOEV",116,0)
 D FULL^VALM1 K:CHK Y
"RTN","PSGOEV",117,0)
 ; changed to remove ^DD ref
"RTN","PSGOEV",118,0)
 ; PSJ*5*267 VMP Add the 8th condition
"RTN","PSGOEV",119,0)
 W !!,"THE FOLLOWING ",$S($L(CHK)>1:"ARE",1:"IS")," EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:8 W:CHK[X !?5,$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG^DOSAGE ORDERED","^",X)
"RTN","PSGOEV",120,0)
 I CHK=7 W !,"Orders with no dispense drugs or multiple dispense drugs",!,"require dosage ordered"
"RTN","PSGOEV",121,0)
 W:CHK]"" !!,$S($L(CHK)>1:"THESE FIELDS ARE",1:"THIS FIELD IS")," NECESSARY FOR VERIFICATION."
"RTN","PSGOEV",122,0)
 N DIR S DIR(0)="E" D ^DIR I $D(DUOUT)!$D(DTOUT) S CHK=1 Q
"RTN","PSGOEV",123,0)
 Q
"RTN","PSGOEV",124,0)
 ;
"RTN","PSGOEV",125,0)
CONT() ;
"RTN","PSGOEV",126,0)
 NEW DIR,DIRUT,Y
"RTN","PSGOEV",127,0)
 W ! K DIR,DIRUT
"RTN","PSGOEV",128,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="No"
"RTN","PSGOEV",129,0)
 D ^DIR
"RTN","PSGOEV",130,0)
 Q Y
"RTN","PSGOEV",131,0)
 ;
"RTN","PSGOEV",132,0)
DDCHK ; dispense drug check
"RTN","PSGOEV",133,0)
 S DRGF="^PS("_$S(PSGORD["P":"53.1,"_+PSGORD,1:"55,"_PSGP_",5,"_+PSGORD)_",",CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSGOEV",134,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSGOEV",135,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSGOEV",136,0)
 Q:CHK=0
"RTN","PSGOEV",137,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSGOEV",138,0)
 ;
"RTN","PSGOEV",139,0)
DDEDIT ;
"RTN","PSGOEV",140,0)
 ;*** Remove all dispense drug for this order
"RTN","PSGOEV",141,0)
 K @(DRGF_"1)")
"RTN","PSGOEV",142,0)
 ; The naked reference below refers to the indirect full reference in DRGF_"1,"_Q_")", which is either ^PS(53.1,+PSGORD,Q) or ^PS(55,DFN,5,+PSGORD,Q)
"RTN","PSGOEV",143,0)
 K ^PS(53.45,PSJSYSP,2) S (X,Q)=0 F  S Q=$O(@(DRGF_"1,"_Q_")")) Q:'Q  S Y=$G(^(Q,0)),X=Q S ^PS(53.45,PSJSYSP,2,Q,0)=Y I Y S ^PS(53.45,PSJSYSP,2,"B",+Y,Q)=""
"RTN","PSGOEV",144,0)
 I X S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_X_"^"_X
"RTN","PSGOEV",145,0)
 D ENDRG^PSGOEF1(PSGPD,X)
"RTN","PSGOEV",146,0)
 I 'CHK S %X="^PS(53.45,"_PSJSYSP_",2,",%Y=DRGF_"1," D %XY^%RCR S $P(@(DRGF_"1,0)"),"^",2)=$S(DRGF[53.1:"53.11P",1:"55.07P")
"RTN","PSGOEV",147,0)
 K DRG,DRGF Q
"RTN","PSGOEV",148,0)
 ;
"RTN","PSGOEV",149,0)
AESCREEN() ;
"RTN","PSGOEV",150,0)
 ; Output: 0 - Required fields missing and DON'T allow accept
"RTN","PSGOEV",151,0)
 ;         1 - Required fields found.
"RTN","PSGOEV",152,0)
 Q:'$G(CHK) 1
"RTN","PSGOEV",153,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSGOEV",154,0)
 I Y="PSJU LM ACCEPT EDIT" Q 1
"RTN","PSGOEV",155,0)
 Q 0
"RTN","PSGOEV",156,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSGOEV",157,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSGOEV",158,0)
 ;PSGORD : IEN from 55
"RTN","PSGOEV",159,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSGOEV",160,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSGOEV",161,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSGOEV",162,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55.09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSGOEV",163,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSGOEV",164,0)
 . N TXTLN S TXTLN="" F  S TXTLN=$O(^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN)) Q:TXTLN=""  D
"RTN","PSGOEV",165,0)
 .. I TXTLN=0 S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,1,TXTLN)=^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN) Q
"RTN","PSGOEV",166,0)
 .. S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,1,TXTLN,0)=^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN,0)
"RTN","PSGOEV",167,0)
 Q
"RTN","PSJ53P1")
0^22^B8746775^B5710218
"RTN","PSJ53P1",1,0)
PSJ53P1 ;BIR/DB - API FOR INFORMATION FROM FILE 53.1; 5 Sep 03
"RTN","PSJ53P1",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**172,260**;16 DEC 97;Build 94
"RTN","PSJ53P1",3,0)
PSJ(PSJIEN,LIST) ;
"RTN","PSJ53P1",4,0)
 ;PSJIEN - INTERNAL ENTRY NUMBER [REQUIRED]
"RTN","PSJ53P1",5,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSJ53P1",6,0)
 I $G(PSJIEN)="" Q
"RTN","PSJ53P1",7,0)
 I $G(LIST)="" Q
"RTN","PSJ53P1",8,0)
 K ^TMP($J,LIST),DA,^UTILITY("DIQ1",$J),DIQ
"RTN","PSJ53P1",9,0)
 N SEQ,DATA
"RTN","PSJ53P1",10,0)
 I $G(PSJIEN)]"" S DA=PSJIEN I '$D(^PS(53.1,DA,0)) G RET0
"RTN","PSJ53P1",11,0)
 K ^UTILITY("DIQ1",$J),DIC S DIC=53.1,DR=".01;1;3;7;10;25;26;27;28;108;109;115;116;117",DIQ(0)="IE" D EN^DIQ1
"RTN","PSJ53P1",12,0)
 I '$D(^UTILITY("DIQ1",$J)) G RET0
"RTN","PSJ53P1",13,0)
 S ^TMP($J,LIST,0)=1,PSJDA=DA
"RTN","PSJ53P1",14,0)
 S PSJTXT=^UTILITY("DIQ1",$J,53.1,DA,.01,"E")
"RTN","PSJ53P1",15,0)
 F X=.01,1,3,7,10,26,27,28,25,108,109,115,116,117 S ^TMP($J,LIST,DA,X)=$G(^UTILITY("DIQ1",$J,53.1,DA,X,"I"))
"RTN","PSJ53P1",16,0)
 F X=1,3,7,10,28,25,26,108,115,116,117 S ^TMP($J,LIST,DA,X)=$S($G(^UTILITY("DIQ1",$J,53.1,DA,X,"E"))'="":^TMP($J,LIST,DA,X)_"^"_$G(^UTILITY("DIQ1",$J,53.1,DA,X,"E")),1:"")
"RTN","PSJ53P1",17,0)
 S ^TMP($J,LIST,"B",PSJTXT,DA)=""
"RTN","PSJ53P1",18,0)
 S PSJDRG=0 F  S PSJDRG=$O(^PS(53.1,PSJDA,1,PSJDRG)) Q:PSJDRG'>0  D
"RTN","PSJ53P1",19,0)
 .S DA=PSJDA,DIC=53.1,DR=2,DR(53.11)=".01;.02",DIQ(0)="IE",DA(53.11)=PSJDRG D EN^DIQ1 Q:'$D(^UTILITY("DIQ1",$J))
"RTN","PSJ53P1",20,0)
 .S ^TMP($J,LIST,PSJDA,"DDRUG",PSJDRG,.01)=$G(^UTILITY("DIQ1",$J,53.11,PSJDRG,.01,"I"))
"RTN","PSJ53P1",21,0)
 .S ^TMP($J,LIST,PSJDA,"DDRUG",PSJDRG,.02)=$G(^UTILITY("DIQ1",$J,53.11,PSJDRG,.02,"I"))
"RTN","PSJ53P1",22,0)
 .S ^TMP($J,LIST,PSJDA,"DDRUG",PSJDRG,.01)=$S($G(^UTILITY("DIQ1",$J,53.11,PSJDRG,.01,"E"))'="":^TMP($J,LIST,PSJDA,"DDRUG",PSJDRG,.01)_"^"_$G(^UTILITY("DIQ1",$J,53.11,PSJDRG,.01,"E")),1:"")
"RTN","PSJ53P1",23,0)
 .S ^TMP($J,LIST,PSJDA,"DDRUG",0)=$G(^TMP($J,LIST,PSJDA,"DDRUG",0))+1
"RTN","PSJ53P1",24,0)
 I '$D(^TMP($J,LIST,PSJDA,"DDRUG",0)) S ^TMP($J,LIST,PSJDA,"DDRUG",0)="-1^NO DATA FOUND"
"RTN","PSJ53P1",25,0)
 S SEQ=0 F  S SEQ=$O(^PS(53.1,DA,"AD",SEQ)) Q:SEQ=""!(SEQ'?1N.N)  D
"RTN","PSJ53P1",26,0)
 .S (ADDITIVE,DATA)="",DATA=^PS(53.1,DA,"AD",SEQ,0),$P(DATA,"^")=$$GET1^DIQ(52.6,$P(DATA,"^"),.01),^TMP($J,LIST,DA,"ADD",SEQ)=DATA
"RTN","PSJ53P1",27,0)
 I '$D(^TMP($J,LIST,DA,"ADD")) S ^TMP($J,LIST,DA,"ADD",0)="-1^NO DATA FOUND"
"RTN","PSJ53P1",28,0)
 S SEQ=0 F  S SEQ=$O(^PS(53.1,DA,"SOL",SEQ)) Q:SEQ=""!(SEQ'?1N.N)  D
"RTN","PSJ53P1",29,0)
 .S (SOLUTION,DATA)="",DATA=^PS(53.1,DA,"SOL",SEQ,0),$P(DATA,"^")=$$GET1^DIQ(52.7,$P(DATA,"^"),.01),^TMP($J,LIST,DA,"SOL",SEQ)=DATA
"RTN","PSJ53P1",30,0)
 I '$D(^TMP($J,LIST,DA,"SOL")) S ^TMP($J,LIST,DA,"SOL",0)="-1^NO DATA FOUND"
"RTN","PSJ53P1",31,0)
 K PSJIEN,DA,X,PSJTXT,DR,DIC,^UTILITY("DIQ1",$J),DIQ,PSJDA,PSJDRG
"RTN","PSJ53P1",32,0)
 Q
"RTN","PSJ53P1",33,0)
RET0 ;return no data
"RTN","PSJ53P1",34,0)
 K PSJIEN,PSJTXT S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSJBLDOC")
0^15^B43930447^B26846197
"RTN","PSJBLDOC",1,0)
PSJBLDOC ;BIR/MV - API to build ^TMP for prospective and PSJ profile drugs ;03 Aug 98 / 8:42 AM
"RTN","PSJBLDOC",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**181,263,260**;16 DEC 97;Build 94
"RTN","PSJBLDOC",3,0)
 ;
"RTN","PSJBLDOC",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJBLDOC",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJBLDOC",6,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBLDOC",7,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJBLDOC",8,0)
 ; Reference to ^PSSDSAPM is supported by DBIA# 5570.
"RTN","PSJBLDOC",9,0)
 ;
"RTN","PSJBLDOC",10,0)
IN(DFN,LIST,PDRG,PTYP) ;
"RTN","PSJBLDOC",11,0)
 ;Build the IPM profiles and the prospective drugs list for both PSO & PSJ if PDRG is passed in.
"RTN","PSJBLDOC",12,0)
 ;DFN - PATIENT DFN
"RTN","PSJBLDOC",13,0)
 ;LIST - BASE
"RTN","PSJBLDOC",14,0)
 ;PDRG - Drug array in format of PDRG(n)=IEN (#50) ^ Drug name
"RTN","PSJBLDOC",15,0)
 ;       Where n is a sequential number.  Drug name can be OI, Generic name from #50 or Additive/sol name
"RTN","PSJBLDOC",16,0)
 ;PTYP - P1;P2 where P1="I" for Inpatient & "O" for Outpatient, P2= PSJ order#
"RTN","PSJBLDOC",17,0)
 NEW PSJONCNT,PSJDCNT,PSJDRGND,PSJWON
"RTN","PSJBLDOC",18,0)
 S PSJONCNT=0
"RTN","PSJBLDOC",19,0)
 S PSJWON=$P($G(PTYP),";",2)
"RTN","PSJBLDOC",20,0)
 D PROFILE(DFN,PSJWON,PTYP)
"RTN","PSJBLDOC",21,0)
 K ^TMP($J,"PSJPRE","CLINIC")
"RTN","PSJBLDOC",22,0)
 Q
"RTN","PSJBLDOC",23,0)
PROFILE(DFN,PSJWON,PTYP)     ;Setup ^TMP for the active meds to be on the OC profile list.
"RTN","PSJBLDOC",24,0)
 ;DFN:    Patient internal entry number
"RTN","PSJBLDOC",25,0)
 ;PSJWON: The current order number being working on.  It can be null.
"RTN","PSJBLDOC",26,0)
 ;        It is the order being work on (RN, FN..) and should be on the prospective list.
"RTN","PSJBLDOC",27,0)
 ;Output: ^TMP($J,"ORDERS",PSJINX)=DRUG CLASS^NATIONAL DRUG FILE ENTRY
"RTN","PSJBLDOC",28,0)
 ;        _"A"_PSNDFA PRODUCT NAME ENTRY_DISPENSE DRUG NAME^OE/RR #
"RTN","PSJBLDOC",29,0)
 ;        _ORDER NUMBER(P/I/V)_";I"
"RTN","PSJBLDOC",30,0)
 ;
"RTN","PSJBLDOC",31,0)
 NEW BDT,COD,DDRUG,DDRUGND,EDT,F,ON,ON1,PST,WBDT,X,PSJORIEN,%,PSJCLCOD,PSJCLINF,PSJCLIND
"RTN","PSJBLDOC",32,0)
 S PSJWON=$G(PSJWON),PSJCLCOD=""
"RTN","PSJBLDOC",33,0)
 D NOW^%DTC S (BDT,WBDT)=%,EDT=9999999  ; WBDT SET THIS WAY BEFORE CLINIC OC DISPLAY ADDED
"RTN","PSJBLDOC",34,0)
 ;
"RTN","PSJBLDOC",35,0)
 ;Must display any DC/Expired clinic orders withing the last 90 days.  Active, non-verified, pending, hold clinic orders must be displayed in the clinic display format.
"RTN","PSJBLDOC",36,0)
 D CLINICS^PSJCLNOC(DFN)  ;get clinic orders for last 90 days for this patient and set ^TMP($J,"PSJPRE","CLINIC",IEN,FILE_TYPE)=""
"RTN","PSJBLDOC",37,0)
 I $D(^TMP($J,"PSJPRE","CLINIC")) S X1=BDT,X2=-90 D C^%DTC S (BDT,WBDT)=X   ;WBDT TO GET CLINIC ORDERS FOR LAST 90 DAYS
"RTN","PSJBLDOC",38,0)
 ;
"RTN","PSJBLDOC",39,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S COD=ON_"U",PSJCLCOD=2 D:COD'=PSJWON UD
"RTN","PSJBLDOC",40,0)
 S WBDT=BDT,F="^PS(53.1,",PSJCLCOD="" F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJBLDOC",41,0)
 . S COD=ON_"P" Q:COD=PSJWON!($D(PSJVFF)&(COD=$G(PSJORD)))
"RTN","PSJBLDOC",42,0)
 . I $G(PSJCOM),($G(PSJWON)["P") Q:$D(^PS(53.1,"ACX",PSJCOM,+ON))
"RTN","PSJBLDOC",43,0)
 . I $O(^PS(53.1,+ON,"AD",0))!$O(^PS(53.1,+ON,"SOL",0)) S PSJCLCOD=3 D PIV Q
"RTN","PSJBLDOC",44,0)
 . S PSJCLCOD=4
"RTN","PSJBLDOC",45,0)
 . I $$GET1^DIQ(53.1,+ON,4,"I")="I" S PSJCLCOD=5
"RTN","PSJBLDOC",46,0)
 . D UD
"RTN","PSJBLDOC",47,0)
 S WBDT=BDT F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S COD=ON_"V" S PSJCLCOD=1 D:COD'=PSJWON IV
"RTN","PSJBLDOC",48,0)
 K PSJWON
"RTN","PSJBLDOC",49,0)
 Q
"RTN","PSJBLDOC",50,0)
UD ;Get the dispense drugs for the Unit Dose orders.
"RTN","PSJBLDOC",51,0)
 NEW X,PSJQUIT,PSJCNT,DDRUG,DDRUGN,PSJX,PSJOI,PSJEXPDD,PSJUTMP,PSJEDOVR,PSJCLNX
"RTN","PSJBLDOC",52,0)
 S X=@(F_ON_",0)")
"RTN","PSJBLDOC",53,0)
 Q:$P(X,U,9)="R"
"RTN","PSJBLDOC",54,0)
 S (PSJEDOVR,PSJCLINF,PSJCLNX)=0,PSJCLNX=$P(X,U,9)
"RTN","PSJBLDOC",55,0)
 S:$D(^TMP($J,"PSJPRE","CLINIC",+ON,$S(PSJCLCOD=5:"531I",PSJCLCOD=2:"55U",1:"531U"))) PSJCLINF=1
"RTN","PSJBLDOC",56,0)
 Q:$P($G(PTYP),";",1)="O"&('$G(PSJCLINF))
"RTN","PSJBLDOC",57,0)
 Q:$P(X,U,9)="D"&('PSJCLINF)
"RTN","PSJBLDOC",58,0)
 Q:$P(X,U,9)="E"&('PSJCLINF)
"RTN","PSJBLDOC",59,0)
 S PSJORIEN=$P(X,U,21),DDRUG=0
"RTN","PSJBLDOC",60,0)
 ;
"RTN","PSJBLDOC",61,0)
 ;Use the first active DD within the order. If >1 DD, use OI_Dosage form for display name
"RTN","PSJBLDOC",62,0)
 S ON1=0,PSJCNT=0 F  S ON1=$O(@(F_ON_",1,"_ON1_")")) Q:'ON1  S PSJCNT=PSJCNT+1
"RTN","PSJBLDOC",63,0)
 S PSJOI=+$G(@(F_ON_",.2)"))
"RTN","PSJBLDOC",64,0)
 S ON1=0,PSJQUIT=0 F  S ON1=$O(@(F_ON_",1,"_ON1_")")) Q:'+ON1!PSJQUIT  S DDRUG=@(F_ON_",1,"_ON1_",0)") D
"RTN","PSJBLDOC",65,0)
 . Q:'+DDRUG
"RTN","PSJBLDOC",66,0)
 . S PSJX=$P(DDRUG,U,3)
"RTN","PSJBLDOC",67,0)
 . I 'PSJCLINF,PSJX]"",(PSJX'>BDT) Q
"RTN","PSJBLDOC",68,0)
 . D SETIN("PROFILE",$S(PSJCNT>1:$$OIDF^PSJLMUT1(+$G(PSJOI)),1:$P($G(^PSDRUG(DDRUG,0)),U)),+DDRUG,COD,PTYP,PSJCLCOD,PSJCLINF) S PSJQUIT=1
"RTN","PSJBLDOC",69,0)
 ;Quit when an active DD within the order if found
"RTN","PSJBLDOC",70,0)
 Q:+$G(PSJQUIT)
"RTN","PSJBLDOC",71,0)
 ;
"RTN","PSJBLDOC",72,0)
 ;No DD found from the order. Get one from the OI
"RTN","PSJBLDOC",73,0)
 I '+PSJOI D SETIN("PROFILE","NOT FOUND: "_COD,"",COD,1,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",74,0)
 S DDRUG=$P($$DRG^PSSDSAPM(+PSJOI,"I"),U)
"RTN","PSJBLDOC",75,0)
 I +DDRUG D SETIN("PROFILE",$S(PSJCNT>1:$$OIDF^PSJLMUT1(+$G(PSJOI)),1:$P($G(^PSDRUG(DDRUG,0)),U)),+DDRUG,COD,PTYP,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",76,0)
 ;
"RTN","PSJBLDOC",77,0)
 ;Get the first DD from OI
"RTN","PSJBLDOC",78,0)
 I '+DDRUG S DDRUG=$O(^PSDRUG("ASP",PSJOI,0)) I +DDRUG D SETIN("PROFILE",$S(PSJCNT>1:$$OIDF^PSJLMUT1(+$G(PSJOI)),1:$P($G(^PSDRUG(DDRUG,0)),U)),+DDRUG,COD,PTYP,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",79,0)
 ;
"RTN","PSJBLDOC",80,0)
 ;Set exception when no DD found
"RTN","PSJBLDOC",81,0)
 I '+DDRUG D SETIN("PROFILE",$$OIDF^PSJLMUT1(+$G(PSJOI)),"",COD,1,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",82,0)
 Q
"RTN","PSJBLDOC",83,0)
PIV ;Get the dispense drugs for the Pending IV orders.
"RTN","PSJBLDOC",84,0)
 NEW PSJ0,PSJX,DDRUG,PSJNM,PSJCLNTY
"RTN","PSJBLDOC",85,0)
 S PSJX=^PS(53.1,+ON,0),PSJORIEN=$P(PSJX,U,21) Q:$P(PSJX,U,27)="R"
"RTN","PSJBLDOC",86,0)
 S (PSJEDOVR,PSJCLINF,PSJCLNTY)=0,PSJCLNTY=$$GET1^DIQ(53.1,+ON,4,"I")
"RTN","PSJBLDOC",87,0)
 S:$D(^TMP($J,"PSJPRE","CLINIC",+ON,531_PSJCLNTY)) PSJCLINF=1
"RTN","PSJBLDOC",88,0)
 Q:$P($G(PTYP),";",1)="O"&('$G(PSJCLINF))
"RTN","PSJBLDOC",89,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"AD",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",90,0)
 . S PSJX=^PS(53.1,+ON,"AD",ON1,0),PSJ0=$$IV0("AD",+PSJX)
"RTN","PSJBLDOC",91,0)
 . S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",92,0)
 . I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",93,0)
 . D SETIN("PROFILE",$P(PSJ0,U)_" "_$P(PSJX,U,2),$P(PSJ0,U,2),COD,PTYP,PSJCLCOD,PSJCLINF)
"RTN","PSJBLDOC",94,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,+ON,"SOL",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",95,0)
 . S PSJX=^PS(53.1,+ON,"SOL",ON1,0) D
"RTN","PSJBLDOC",96,0)
 . I $$PREMIX^PSJMISC(+PSJX) D
"RTN","PSJBLDOC",97,0)
 .. S PSJ0=$$IV0("",+PSJX)
"RTN","PSJBLDOC",98,0)
 .. S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",99,0)
 .. I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",100,0)
 .. D SETIN("PROFILE",$P(PSJ0,U)_" "_$P(PSJX,U,2),$P(PSJ0,U,2),COD,PTYP,PSJCLCOD,PSJCLINF)
"RTN","PSJBLDOC",101,0)
 Q
"RTN","PSJBLDOC",102,0)
IV ;Get the dispense drugs for the IV orders.
"RTN","PSJBLDOC",103,0)
 NEW PSJ0,PSJX,DDRUG,PSJNM,PSJCLNX
"RTN","PSJBLDOC",104,0)
 S PSJX=^PS(55,DFN,"IV",ON,0),PSJORIEN=$P(PSJX,U,21),(PSJCLINF,PSJCLNX)=0,PSJCLNX=$P(PSJX,U,17)
"RTN","PSJBLDOC",105,0)
 Q:$P(PSJX,U,17)="R"
"RTN","PSJBLDOC",106,0)
 S:$D(^TMP($J,"PSJPRE","CLINIC",+ON,"55I")) PSJCLINF=1
"RTN","PSJBLDOC",107,0)
 Q:$P($G(PTYP),";",1)="O"&('$G(PSJCLINF))
"RTN","PSJBLDOC",108,0)
 Q:$P(PSJX,U,17)="D"&('PSJCLINF)
"RTN","PSJBLDOC",109,0)
 Q:$P(PSJX,U,17)="E"&('PSJCLINF)
"RTN","PSJBLDOC",110,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"AD",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",111,0)
 . S PSJX=^PS(55,DFN,"IV",ON,"AD",ON1,0),PSJ0=$$IV0("AD",+PSJX)
"RTN","PSJBLDOC",112,0)
 . S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",113,0)
 . I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",114,0)
 . D SETIN("PROFILE",PSJNM,DDRUG,COD,PTYP,PSJCLCOD,PSJCLINF)
"RTN","PSJBLDOC",115,0)
 ; Only include Pre-mix in the OC.
"RTN","PSJBLDOC",116,0)
 S ON1=0 F  S ON1=$O(^PS(55,DFN,"IV",ON,"SOL",ON1)) Q:'ON1  D
"RTN","PSJBLDOC",117,0)
 . S PSJX=^PS(55,DFN,"IV",ON,"SOL",ON1,0)
"RTN","PSJBLDOC",118,0)
 . I $$PREMIX^PSJMISC(+PSJX) D
"RTN","PSJBLDOC",119,0)
 .. S PSJ0=$$IV0("",+PSJX)
"RTN","PSJBLDOC",120,0)
 .. S PSJNM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJBLDOC",121,0)
 .. I '+DDRUG D SETIN("PROFILE",PSJNM,"",COD,4,PSJCLCOD,PSJCLINF) Q
"RTN","PSJBLDOC",122,0)
 .. D SETIN("PROFILE",PSJNM,DDRUG,COD,PTYP,PSJCLCOD,PSJCLINF)
"RTN","PSJBLDOC",123,0)
 Q
"RTN","PSJBLDOC",124,0)
SETIN(PSJFLG,PSJNM,DDRUG,ON,PSJCODE,PSJCLCOD,PSJCLINF) ;Set ^TMP($J,"PSJPRE,"IN" arrays.
"RTN","PSJBLDOC",125,0)
 ;ON = ON with "U/V/P"
"RTN","PSJBLDOC",126,0)
 ;PSJFLG = "PROSPECTIVE" or "PROFILE"
"RTN","PSJBLDOC",127,0)
 ;PSJNM = This should be the AD/SOL print name or IV order.  Use Dispense drug name if U/D order
"RTN","PSJBLDOC",128,0)
 ;PSJPON = 4 piece pharmacy order #
"RTN","PSJBLDOC",129,0)
 NEW PSJPON
"RTN","PSJBLDOC",130,0)
 Q:$G(PSJFLG)=""
"RTN","PSJBLDOC",131,0)
 S PSJONCNT=$G(PSJONCNT)+1
"RTN","PSJBLDOC",132,0)
 S PSJPON=$S(PSJCLINF:"C"_PSJCLCOD_";",1:"I;")_ON_";"_PSJFLG_";"_PSJONCNT
"RTN","PSJBLDOC",133,0)
 I $P(PSJCODE,";")="O" S PSJPON="C"_PSJCLCOD_";"_+ON_";"_PSJFLG_";"_PSJONCNT
"RTN","PSJBLDOC",134,0)
 I '+$G(DDRUG) D  Q
"RTN","PSJBLDOC",135,0)
 . I +$G(PSJCODE) D NODD($G(PSJCODE),PSJNM,PSJPON,LIST)
"RTN","PSJBLDOC",136,0)
 Q:$$SUP^PSSDSAPI(+DDRUG)
"RTN","PSJBLDOC",137,0)
 I $G(PSJNM)="" S PSJNM=$P($G(^PSDRUG(+DDRUG,0)),U)
"RTN","PSJBLDOC",138,0)
 S PSJFLG=$S($G(PSJDGCK):"PROSPECTIVE",1:"PROFILE") ;when using DX hidden action
"RTN","PSJBLDOC",139,0)
 S ^TMP($J,LIST,"IN",PSJFLG,PSJPON)=+$$GCN^PSJMISC(+DDRUG)_U_$$GTVUID^PSJMISC(+DDRUG)_U_+DDRUG_U_PSJNM_U_$G(PSJORIEN)_U_"I"_U_PSJCLCOD_";"_PSJCLINF
"RTN","PSJBLDOC",140,0)
 Q
"RTN","PSJBLDOC",141,0)
IV0(PSJAD,PSIVIEN) ;Return ad/sol zero node
"RTN","PSJBLDOC",142,0)
 ;PSJAD = "AD" is passed in if it additive, otherwise it's null
"RTN","PSJBLDOC",143,0)
 I PSJAD="AD" Q $G(^PS(52.6,+$G(PSIVIEN),0))
"RTN","PSJBLDOC",144,0)
 I $G(PSJAD)="" Q $G(^PS(52.7,+$G(PSIVIEN),0))
"RTN","PSJBLDOC",145,0)
 Q ""
"RTN","PSJBLDOC",146,0)
NODD(PSJCODE,PSJOIDF,PSJPON,PSJBASE) ;Set ^TMP for OI without a dispense drug
"RTN","PSJBLDOC",147,0)
 ;PSJCODE - A numeric code to trigger the appropriate exception message 
"RTN","PSJBLDOC",148,0)
 ;PSJOIDF - Orderable Item name_Dose form (can be CPRS OI)
"RTN","PSJBLDOC",149,0)
 ;PSJPON - Pharmacy order #
"RTN","PSJBLDOC",150,0)
 ;PSJBASE - Base subscript
"RTN","PSJBLDOC",151,0)
 Q:$G(PSJOIDF)=""
"RTN","PSJBLDOC",152,0)
 Q:$G(PSJBASE)=""
"RTN","PSJBLDOC",153,0)
 Q:'+$G(PSJCODE)
"RTN","PSJBLDOC",154,0)
 ;S PSJIV("OI_ERROR",PSJOIDF)=$G(PSJCODE)_U_$G(PSJPON)
"RTN","PSJBLDOC",155,0)
 S ^TMP($J,PSJBASE,"IN","EXCEPTIONS","OI",PSJOIDF)=PSJCODE_U_$G(PSJPON)
"RTN","PSJBLDOC",156,0)
 Q
"RTN","PSJCLNOC")
0^18^B82441248^n/a
"RTN","PSJCLNOC",1,0)
PSJCLNOC ;BIR/LE - Clinic Order Check Utilities ;26 FEB 12 / 12:42 PM
"RTN","PSJCLNOC",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**260**;16 DEC 97;Build 94
"RTN","PSJCLNOC",3,0)
 ;Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSJCLNOC",4,0)
 ;
"RTN","PSJCLNOC",5,0)
CLINICS(PSJDFN) ;
"RTN","PSJCLNOC",6,0)
 N X,X1,X2,BDT,PSJSTDT,PSJCLIN,PSJCLINF,ORDID,PSJSTA,PSJUTMP,PSJTYP,PSJCANEX,PSJCLCOD,EDT,PST,PSJSTPDT,PSJTODAY,PSJCLINIC,PSJXREF,PSSAPTDT
"RTN","PSJCLNOC",7,0)
 D NOW^%DTC S PSJTODAY=%,EDT=9999999
"RTN","PSJCLNOC",8,0)
 K ^TMP($J,"PSJPRE","CLINIC")
"RTN","PSJCLNOC",9,0)
 S X1=PSJTODAY,X2=-90 D C^%DTC S (PSJSTDT,BDT)=X,(PSJCLIN,PSJCLINF,ORDID,PSJCLINIC)=""
"RTN","PSJCLNOC",10,0)
 F PSJXREF="AUDC","AIVC" F  S PSJSTDT=$O(^PS(55,PSJXREF,PSJSTDT)) Q:PSJSTDT=""  F  S PSJCLINIC=$O(^PS(55,PSJXREF,PSJSTDT,PSJCLINIC)) Q:PSJCLINIC=""  D
"RTN","PSJCLNOC",11,0)
 .I $D(^PS(55,PSJXREF,PSJSTDT,PSJCLINIC,PSJDFN)) F  S ORDID=$O(^PS(55,PSJXREF,PSJSTDT,PSJCLINIC,PSJDFN,ORDID)) Q:ORDID=""  D
"RTN","PSJCLNOC",12,0)
 ..S PSSAPTDT=""  ;clinic orders must have an appointment date and time
"RTN","PSJCLNOC",13,0)
 ..I PSJXREF="AUDC" S PSSAPTDT=$$GET1^DIQ(55.06,ORDID_","_DFN_",",131)
"RTN","PSJCLNOC",14,0)
 ..I PSJXREF="AIVC" S PSSAPTDT=$$GET1^DIQ(55.01,ORDID_","_DFN_",",139)
"RTN","PSJCLNOC",15,0)
 ..Q:PSSAPTDT=""
"RTN","PSJCLNOC",16,0)
 ..S ^TMP($J,"PSJPRE","CLINIC",ORDID,$S(PSJXREF="AUDC":"55U",1:"55I"))=""
"RTN","PSJCLNOC",17,0)
 ;
"RTN","PSJCLNOC",18,0)
D531 ;
"RTN","PSJCLNOC",19,0)
 S PSJSTDT=BDT,(PSJTYP,PSJCLINF,ORDID)=""
"RTN","PSJCLNOC",20,0)
 F PST="P","N" F ORDID=0:0 S ORDID=$O(^PS(53.1,"AS",PST,PSJDFN,ORDID)) Q:'ORDID  D
"RTN","PSJCLNOC",21,0)
 .S PSJTYP="",PSJTYP=$$GET1^DIQ(53.1,ORDID,4,"I")
"RTN","PSJCLNOC",22,0)
 .S PSJCLINF=$$CLINIC(PSJDFN,+ORDID,$S(PSJTYP="U":"4;",PSJTYP="I"!(PSJTYP="H")!(PSJTYP="F"):3,1:0))
"RTN","PSJCLNOC",23,0)
 .I PSJCLINF S ^TMP($J,"PSJPRE","CLINIC",ORDID,531_PSJTYP)=""
"RTN","PSJCLNOC",24,0)
 Q
"RTN","PSJCLNOC",25,0)
 ;
"RTN","PSJCLNOC",26,0)
CLINIC(DFN,ON,PSJCLCOD) ;
"RTN","PSJCLNOC",27,0)
 N FILE,ORTYPE,PIECE,FLDS,FLD1,FLD2
"RTN","PSJCLNOC",28,0)
 S ORTYPE=$P(PSJCLCOD,";")
"RTN","PSJCLNOC",29,0)
 Q:ORTYPE=0
"RTN","PSJCLNOC",30,0)
  I ORTYPE=1 S FILE=55.01,FLDS="136;139",FLD1=136,FLD2=139
"RTN","PSJCLNOC",31,0)
  I ORTYPE=2 S FILE=55.06,FLDS="130;131",FLD1=130,FLD2=131
"RTN","PSJCLNOC",32,0)
  I ORTYPE=3!(ORTYPE=4) S FILE=53.1,FLDS="113;126",FLD1=113,FLD2=126
"RTN","PSJCLNOC",33,0)
  ;
"RTN","PSJCLNOC",34,0)
CLN ;get clinic order information
"RTN","PSJCLNOC",35,0)
 N CLINIC,APPTDT,CLINFLG,PSJUTMP
"RTN","PSJCLNOC",36,0)
 D GETS^DIQ(FILE,ON_","_DFN,FLDS,"I","PSJUTMP")
"RTN","PSJCLNOC",37,0)
 S (CLINIC,APPTDT,CLINFLG)=""
"RTN","PSJCLNOC",38,0)
 S:$D(PSJUTMP(FILE,ON_","_DFN_",",FLD1,"I")) CLINIC=PSJUTMP(FILE,ON_","_DFN_",",FLD1,"I")
"RTN","PSJCLNOC",39,0)
 S:$D(PSJUTMP(FILE,ON_","_DFN_",",FLD2,"I")) APPTDT=PSJUTMP(FILE,ON_","_DFN_",",FLD2,"I")
"RTN","PSJCLNOC",40,0)
 I CLINIC=""!(APPTDT="") Q 0
"RTN","PSJCLNOC",41,0)
 S CLINFLG=$$GET1^DIQ(44,CLINIC,2802,"I")
"RTN","PSJCLNOC",42,0)
 I 'CLINFLG Q 0
"RTN","PSJCLNOC",43,0)
 Q 1
"RTN","PSJCLNOC",44,0)
 ;----------------------------------
"RTN","PSJCLNOC",45,0)
CANEXP(DFN,ON,PSJCLCOD) ;
"RTN","PSJCLNOC",46,0)
 N FILE,ORTYPE,PIECE,FLDS,FLD1,FLD2,FLD3
"RTN","PSJCLNOC",47,0)
 S ORTYPE=$P(PSJCLCOD,";")
"RTN","PSJCLNOC",48,0)
 I ORTYPE=1 S FILE=55.06,FLDS=".03;100;109",FLD1=.03,FLD2=109,FLD3=100
"RTN","PSJCLNOC",49,0)
 I ORTYPE=2 S FILE=55.06,FLDS="28;34;48",FLD1=34,FLD2=48,FLD3=28
"RTN","PSJCLNOC",50,0)
 I ORTYPE=3!(ORTYPE=4) S FILE=53.1,FLDS="25;28;38",FLD1=25,FLD2=38,FLD3=28
"RTN","PSJCLNOC",51,0)
 ;
"RTN","PSJCLNOC",52,0)
CE ;check to see if Rx is outside the stop date + 90 days time frame
"RTN","PSJCLNOC",53,0)
 N CANEXPDT,PSJUTMP,PSJDCEXD,X1,X2,X,PSJCLNX
"RTN","PSJCLNOC",54,0)
 S (PSJCLNX,PSJDCEXD,CANEXPDT,X,X1,X2)=""
"RTN","PSJCLNOC",55,0)
 D GETS^DIQ(FILE,ON_","_DFN,FLDS,"I","PSJUTMP")
"RTN","PSJCLNOC",56,0)
 S:$D(PSJUTMP(FILE,ON_","_DFN_",",FLD3,"I")) PSJCLNX=PSJUTMP(FILE,ON_","_DFN_",",FLD3,"I")
"RTN","PSJCLNOC",57,0)
 S:'$D(PSJCLNX) PSJCLNX="" Q:PSJCLNX=""!('$D(PSJCLNX)) 0
"RTN","PSJCLNOC",58,0)
 I PSJCLNX="D" S:$D(PSJUTMP(FILE,ON_","_DFN_",",FLD1,"I")) CANEXPDT=PSJUTMP(FILE,ON_","_DFN_",",FLD1,"I")
"RTN","PSJCLNOC",59,0)
 I PSJCLNX="E"!(CANEXPDT="") S:$D(PSJUTMP(FILE,ON_","_DFN_",",FLD2,"I")) CANEXPDT=PSJUTMP(FILE,ON_","_DFN_",",FLD2,"I")
"RTN","PSJCLNOC",60,0)
 I CANEXPDT="" Q 0
"RTN","PSJCLNOC",61,0)
 S X1=CANEXPDT,X2=90 D C^%DTC S PSJDCEXD=X
"RTN","PSJCLNOC",62,0)
 I BDT>PSJDCEXD Q 0
"RTN","PSJCLNOC",63,0)
 Q 1
"RTN","PSJCLNOC",64,0)
 ;---------------------------------
"RTN","PSJCLNOC",65,0)
SETIN(PSJFLG,PSJPON,PSJNM,PSJCLCOD) ;
"RTN","PSJCLNOC",66,0)
 N TMP,STATUS,STARTDT,STOPDT,SCHEDULE,DOSAGE,ORDID,PSJCDFN,TYPE,FLG,INFUSE
"RTN","PSJCLNOC",67,0)
 S ORDID=$P(PSJCLCOD,";",1),PSJCDFN=$P(PSJCLCOD,";",3)
"RTN","PSJCLNOC",68,0)
 S TYPE="IN"
"RTN","PSJCLNOC",69,0)
 S ^TMP($J,LIST,"CLINIC",PSJPON)=ORDID_"^"_PSJCDFN_"^"_PSJNM_"^"_$P(PSJCLCOD,";",2)
"RTN","PSJCLNOC",70,0)
 Q
"RTN","PSJCLNOC",71,0)
 ;
"RTN","PSJCLNOC",72,0)
GET(PSJCON,PSJCDFN,ORDID,PSJCCODE,PSJNM,PSJCGET)  ;
"RTN","PSJCLNOC",73,0)
 N TYPE,LIST
"RTN","PSJCLNOC",74,0)
 S TYPE="IN",LIST="PSJPRE",(DOSAGE,STATUS,STARTDT,STOPDT,SCHEDULE,INFUSE,STARTDTF,STOPDTF)=""
"RTN","PSJCLNOC",75,0)
 I PSJCCODE=1 S FLG=0 D GETF55
"RTN","PSJCLNOC",76,0)
 I PSJCCODE=2 S FLG=1 D GETF55
"RTN","PSJCLNOC",77,0)
 I PSJCCODE=3 D GETF531
"RTN","PSJCLNOC",78,0)
 I PSJCCODE=4!(PSJCCODE=5) D GETF531
"RTN","PSJCLNOC",79,0)
 Q
"RTN","PSJCLNOC",80,0)
 ;
"RTN","PSJCLNOC",81,0)
GETF55 ;get file 55 clinic info
"RTN","PSJCLNOC",82,0)
 D GETS^DIQ($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN,$S(FLG:"10;26;28;34;59;109",1:".02;.03;.08;.09;100;131"),,"TMP")
"RTN","PSJCLNOC",83,0)
 S:$D(TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:28,1:100))) STATUS=TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:28,1:100))
"RTN","PSJCLNOC",84,0)
 S:$D(TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:10,1:.02))) STARTDT=TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:10,1:.02))
"RTN","PSJCLNOC",85,0)
 S:$D(TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:34,1:.03))) STOPDT=TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:34,1:.03))
"RTN","PSJCLNOC",86,0)
 S:$D(TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:26,1:.09))) SCHEDULE=TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:26,1:.09))
"RTN","PSJCLNOC",87,0)
 S:$D(TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:109,1:131))) DOSAGE=TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:109,1:131))
"RTN","PSJCLNOC",88,0)
 S:$D(TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:59,1:.08))) INFUSE=TMP($S(FLG:55.06,1:55.01),ORDID_","_PSJCDFN_",",$S(FLG:59,1:.08))
"RTN","PSJCLNOC",89,0)
 S PSJCGET(ORDID)=STATUS_"^"_STARTDT_"^"_STOPDT_"^"_SCHEDULE_"^"_DOSAGE_"^"_INFUSE_"^"_PSJNM
"RTN","PSJCLNOC",90,0)
 Q:PSJCCODE=2!(PSJCCODE=4)
"RTN","PSJCLNOC",91,0)
 ;IV additives and solutions
"RTN","PSJCLNOC",92,0)
 N ON1,PSJX,DDRUG,PSJ0,PSJDNAM
"RTN","PSJCLNOC",93,0)
 S ON1=0 F  S ON1=$O(^PS(55,PSJCDFN,"IV",ORDID,"AD",ON1)) Q:'ON1!(ON1'?1N.N)   D
"RTN","PSJCLNOC",94,0)
 . S PSJX=^PS(55,PSJCDFN,"IV",ORDID,"AD",ON1,0),PSJ0=$$IV0^PSJBLDOC("AD",+PSJX)
"RTN","PSJCLNOC",95,0)
 . S DDRUG=$P(PSJ0,U,2),PSJDNAM=$P(PSJ0,U)_" "_$P(PSJX,U,2)
"RTN","PSJCLNOC",96,0)
 . S PSJCGET(ORDID,"ADDITIVE",ON1)=PSJDNAM_"^"_DDRUG_"^"_ORDID_"^"_$P(PSJX,"^",3)
"RTN","PSJCLNOC",97,0)
 ; Pre-mix in the OC.
"RTN","PSJCLNOC",98,0)
 S ON1=0 F  S ON1=$O(^PS(55,PSJCDFN,"IV",ORDID,"SOL",ON1)) Q:'ON1!(ON1'?1N.N)   D
"RTN","PSJCLNOC",99,0)
 . S PSJX=^PS(55,PSJCDFN,"IV",ORDID,"SOL",ON1,0)
"RTN","PSJCLNOC",100,0)
 . S PSJ0=$$IV0^PSJBLDOC("",+PSJX),DDRUG=$P(PSJ0,U,2)
"RTN","PSJCLNOC",101,0)
 . S PSJDNAM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJCLNOC",102,0)
 . S PSJCGET(ORDID,"SOLUTION",ON1)=PSJDNAM_"^"_DDRUG_"^"_INFUSE
"RTN","PSJCLNOC",103,0)
 Q
"RTN","PSJCLNOC",104,0)
 ;
"RTN","PSJCLNOC",105,0)
GETF531 ;get file 53.1 clinic info
"RTN","PSJCLNOC",106,0)
 D GETS^DIQ(53.1,ORDID_","_PSJCDFN,"28;10;25;26;27;109;115;116;117",,"TMP")
"RTN","PSJCLNOC",107,0)
 S:$D(TMP(53.1,ORDID_","_PSJCDFN_",",28)) STATUS=TMP(53.1,ORDID_","_PSJCDFN_",",28)
"RTN","PSJCLNOC",108,0)
 S:$D(TMP(53.1,ORDID_","_PSJCDFN_",",10)) STARTDT=TMP(53.1,ORDID_","_PSJCDFN_",",10)
"RTN","PSJCLNOC",109,0)
 I STARTDT="" S:$D(TMP(53.1,ORDID_","_PSJCDFN_",",115)) STARTDT=TMP(53.1,ORDID_","_PSJCDFN_",",115) S:STARTDT'="" STARTDTF=1
"RTN","PSJCLNOC",110,0)
 S:$D(TMP(53.1,ORDID_","_PSJCDFN_",",116)) DURATION=TMP(53.1,ORDID_","_PSJCDFN_",",116)
"RTN","PSJCLNOC",111,0)
 S:$D(TMP(53.1,ORDID_","_PSJCDFN_",",25)) STOPDT=TMP(53.1,ORDID_","_PSJCDFN_",",25)
"RTN","PSJCLNOC",112,0)
 I STOPDT="" S:$D(TMP(53.1,ORDID_","_PSJCDFN_",",117)) STOPDT=TMP(53.1,ORDID_","_PSJCDFN_",",117) S:STOPDT'="" STOPDTF=1
"RTN","PSJCLNOC",113,0)
 S:$D(TMP(53.1,ORDID_","_PSJCDFN_",",27)) ORDDATE=TMP(53.1,ORDID_","_PSJCDFN_",",27)
"RTN","PSJCLNOC",114,0)
 S:$D(TMP(53.1,ORDID_","_PSJCDFN_",",26)) SCHEDULE=TMP(53.1,ORDID_","_PSJCDFN_",",26)
"RTN","PSJCLNOC",115,0)
 S:$D(TMP(53.1,ORDID_","_PSJCDFN_",",109)) DOSAGE=TMP(53.1,ORDID_","_PSJCDFN_",",109)
"RTN","PSJCLNOC",116,0)
 S PSJCGET(ORDID)=STATUS_"^"_STARTDT_"^"_STOPDT_"^"_SCHEDULE_"^"_DOSAGE_"^"_INFUSE_"^"_PSJNM_"^"_STARTDTF_"^"_STOPDTF_"^"_ORDDATE
"RTN","PSJCLNOC",117,0)
  ;IV additives and solutions
"RTN","PSJCLNOC",118,0)
 N ON1,PSJX,DDRUG,ADDITIVE,SOLUTION,PSJ0,PSJDNAM
"RTN","PSJCLNOC",119,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,ORDID,"AD",ON1)) Q:'ON1!(ON1'?1N.N)  D
"RTN","PSJCLNOC",120,0)
 . S PSJX=^PS(53.1,ORDID,"AD",ON1,0),PSJ0=$$IV0^PSJBLDOC("AD",+PSJX)
"RTN","PSJCLNOC",121,0)
 . S DDRUG=$P(PSJ0,U,2),PSJDNAM=$P(PSJ0,U)_" "_$P(PSJX,U,2)
"RTN","PSJCLNOC",122,0)
 . S PSJCGET(ORDID,"ADDITIVE",ON1)=PSJDNAM_"^"_DDRUG_"^"_ORDID_"^"_$P(PSJX,"^",3)
"RTN","PSJCLNOC",123,0)
 ; Pre-mix in the OC.
"RTN","PSJCLNOC",124,0)
 S ON1=0 F  S ON1=$O(^PS(53.1,ORDID,"SOL",ON1)) Q:'ON1!(ON1'?1N.N)   D
"RTN","PSJCLNOC",125,0)
 . S PSJX=^PS(53.1,ORDID,"SOL",ON1,0)
"RTN","PSJCLNOC",126,0)
 . S PSJ0=$$IV0^PSJBLDOC("",+PSJX)
"RTN","PSJCLNOC",127,0)
 . S DDRUG=$P(PSJ0,U,2)
"RTN","PSJCLNOC",128,0)
 . S PSJDNAM=$P(PSJ0,U)_" "_$P(PSJX,U,2),DDRUG=$P(PSJ0,U,2)
"RTN","PSJCLNOC",129,0)
 . S PSJCGET(ORDID,"SOLUTION",ON1)=PSJDNAM_"^"_DDRUG_"^"_INFUSE
"RTN","PSJCLNOC",130,0)
 Q
"RTN","PSJCLNOC",131,0)
 ;
"RTN","PSJCLNOC",132,0)
DISPCLN(PSJP,PSJCLINF) ;
"RTN","PSJCLNOC",133,0)
 N DRGNAME,STATUS,STARTDT,STOPDT,SCHEDULE,ORDID,DOSAGE,DATA,PSJDSPON,PSJCON,PSJCDFN,PSJCGET,INFUSE,PSJCCODE,DURATION,STARTDTF,STOPDTF,ORDDATE
"RTN","PSJCLNOC",134,0)
 I $G(PSJSORT)>10 S PSJDSPON($P(PSJP(4),";",2))=""
"RTN","PSJCLNOC",135,0)
DISP2 ;
"RTN","PSJCLNOC",136,0)
 S PSJCON=PSJP(4),PSJCGET=""
"RTN","PSJCLNOC",137,0)
 S PSJCDFN=DFN
"RTN","PSJCLNOC",138,0)
 S ORDID=$P(PSJCON,";",2),ORDID=+ORDID
"RTN","PSJCLNOC",139,0)
 S PSJCCODE=$P(PSJCLINF,";",1)
"RTN","PSJCLNOC",140,0)
 S (DRGNAME,PSJNM)=PSJP(2)
"RTN","PSJCLNOC",141,0)
 D GET(PSJCON,PSJCDFN,ORDID,PSJCCODE,PSJNM,.PSJCGET)
"RTN","PSJCLNOC",142,0)
 S DATA="",DATA=PSJCGET(ORDID)
"RTN","PSJCLNOC",143,0)
 Q:DATA=""
"RTN","PSJCLNOC",144,0)
 S (STATUS,STARTDT,STOPDT,SCHEDULE,DOSAGE)=""
"RTN","PSJCLNOC",145,0)
 S STATUS=$P(DATA,"^",1),STARTDT=$P(DATA,"^",2),STOPDT=$P(DATA,"^",3),SCHEDULE=$P(DATA,"^",4),DOSAGE=$P(DATA,"^",5)
"RTN","PSJCLNOC",146,0)
 S STARTDTF=$P(DATA,"^",8),STOPDTF=$P(DATA,"^",9),ORDDATE=$P(DATA,"^",10)
"RTN","PSJCLNOC",147,0)
 I ($Y+6)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJCLNOC",148,0)
 W !,$J("Clinic Order: ",23)_DRGNAME_" ("_STATUS_")"
"RTN","PSJCLNOC",149,0)
 I $D(PSJCGET(ORDID,"ADDITIVE"))!($D(PSJCGET(ORDID,"SOLUTION"))) D IVDISP G EXIT
"RTN","PSJCLNOC",150,0)
 W !,$J("Schedule: ",23),SCHEDULE
"RTN","PSJCLNOC",151,0)
 W !,$J("Dosage: ",23),DOSAGE
"RTN","PSJCLNOC",152,0)
 I STARTDT=""&(ORDDATE'="") W !,$J("Order Date: ",23),ORDDATE
"RTN","PSJCLNOC",153,0)
 I STARTDT'="" W !,$J($S($G(STARTDTF):"Requested Start Date: ",1:"Start Date: "),23),STARTDT
"RTN","PSJCLNOC",154,0)
 E  W !,$J("Start Date: ",23),"********"
"RTN","PSJCLNOC",155,0)
 I STOPDT'="" W !,$J($S($G(STOPDTF):"Requested Stop Date: ",1:"Stop Date: "),23),STOPDT
"RTN","PSJCLNOC",156,0)
 E  W !,$J("Stop Date: ",23),"********"
"RTN","PSJCLNOC",157,0)
 W !
"RTN","PSJCLNOC",158,0)
 I ($Y+6)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJCLNOC",159,0)
EXIT ;
"RTN","PSJCLNOC",160,0)
 K PSJCGET
"RTN","PSJCLNOC",161,0)
 Q 
"RTN","PSJCLNOC",162,0)
 ;
"RTN","PSJCLNOC",163,0)
CLNDISP(PSJCLINF) ;
"RTN","PSJCLNOC",164,0)
 N DRGNAME,STATUS,STARTDT,STOPDT,SCHEDULE,ORDID,DOSAGE,DATA,PSJDSPON,PSJCON,PSJCDFN,PSJCGET,INFUSE,PSJCCODE,PSJP,STARTDTF,STOPDTF,ORDDATE
"RTN","PSJCLNOC",165,0)
 S PSJP(2)=PSJCLINF(3)
"RTN","PSJCLNOC",166,0)
 S PSJP(4)=PSJCLINF(2)
"RTN","PSJCLNOC",167,0)
 D DISP2
"RTN","PSJCLNOC",168,0)
 Q
"RTN","PSJCLNOC",169,0)
 ;
"RTN","PSJCLNOC",170,0)
IVDISP ;
"RTN","PSJCLNOC",171,0)
 N SEQ,ADATA,SDATA,DNAM,BOTTLE,AFLG,SFLG,SSEQ,SNAM,ADDS
"RTN","PSJCLNOC",172,0)
 S ADDS="",SEQ=0 F  S SEQ=$O(PSJCGET(ORDID,"ADDITIVE",SEQ)) Q:SEQ=""  D
"RTN","PSJCLNOC",173,0)
 .S ADATA=PSJCGET(ORDID,"ADDITIVE",SEQ)
"RTN","PSJCLNOC",174,0)
 .S DNAM=$P(ADATA,"^")
"RTN","PSJCLNOC",175,0)
 .Q:DNAM=DRGNAME
"RTN","PSJCLNOC",176,0)
 .S BOTTLE=$P(ADATA,"^",4)
"RTN","PSJCLNOC",177,0)
 .I '$G(AFLG) S ADDS=DNAM S:BOTTLE'="" ADDS=ADDS_" ("_BOTTLE_")"
"RTN","PSJCLNOC",178,0)
 .I $G(AFLG) S ADDS=ADDS_", "_DNAM S:BOTTLE'="" ADDS=ADDS_" ("_BOTTLE_")"
"RTN","PSJCLNOC",179,0)
 .W:'$G(AFLG) !,$J("Other Additive(s): ",23)
"RTN","PSJCLNOC",180,0)
 .S:'$G(AFLG) AFLG=1
"RTN","PSJCLNOC",181,0)
 I $G(AFLG) D MYWRITE^PSJMISC(ADDS,23,78)
"RTN","PSJCLNOC",182,0)
 S (SDATA,SNAM,INFUSE,SFLG)="",SSEQ=0
"RTN","PSJCLNOC",183,0)
 S SSEQ=0 F  S SSEQ=$O(PSJCGET(ORDID,"SOLUTION",SSEQ)) Q:SSEQ=""  D
"RTN","PSJCLNOC",184,0)
 .S SDATA=PSJCGET(ORDID,"SOLUTION",SSEQ)
"RTN","PSJCLNOC",185,0)
 .S SNAM=$P(SDATA,"^",1),INFUSE=$P(SDATA,"^",3)
"RTN","PSJCLNOC",186,0)
 .W:'$G(SFLG) !,$J("Solution(s): ",23)_SNAM_" "_INFUSE
"RTN","PSJCLNOC",187,0)
 .I $G(SFLG) W !?23,SNAM_" "_INFUSE
"RTN","PSJCLNOC",188,0)
 .S SFLG=1
"RTN","PSJCLNOC",189,0)
 W:SCHEDULE'="" !,$J("Schedule: ",23),SCHEDULE
"RTN","PSJCLNOC",190,0)
 I STARTDT=""&(ORDDATE'="") W !,$J("Order Date: ",23),ORDDATE
"RTN","PSJCLNOC",191,0)
 I STARTDT'="" W !,$J($S($G(STARTDTF):"Requested Start Date: ",1:"Start Date: "),23),STARTDT
"RTN","PSJCLNOC",192,0)
 E  W !,$J("Start Date: ",23),"********"
"RTN","PSJCLNOC",193,0)
 I STOPDT'="" W !,$J($S($G(STOPDTF):"Requested Stop Date: ",1:"Stop Date: "),23),STOPDT
"RTN","PSJCLNOC",194,0)
 E  W !,$J("Stop Date: ",23),"********"
"RTN","PSJCLNOC",195,0)
 W !
"RTN","PSJCLNOC",196,0)
 I ($Y+6)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJCLNOC",197,0)
 Q
"RTN","PSJDGAL2")
0^10^B21809934^n/a
"RTN","PSJDGAL2",1,0)
PSJDGAL2 ;BIR/SAB-displays stored DRUG ALLERGY w/sign/symptoms ;10/27/11  02:22
"RTN","PSJDGAL2",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**260**;16 DEC 97;Build 94
"RTN","PSJDGAL2",3,0)
 ;External reference to ^PS(50.605, supported by DBIA 696
"RTN","PSJDGAL2",4,0)
 ;External reference to GETOC4^OROCAPI1 supported by DBIA 5729
"RTN","PSJDGAL2",5,0)
 ;External reference to ^ORD(100.05 supported by DBIA 5731
"RTN","PSJDGAL2",6,0)
 ;External reference to ^GMRD(120.83 supported by DBIA 5767
"RTN","PSJDGAL2",7,0)
 ;External reference to ^PS(55 supported by DBIA 2191
"RTN","PSJDGAL2",8,0)
 ;
"RTN","PSJDGAL2",9,0)
 W @IOF
"RTN","PSJDGAL2",10,0)
 N ZORN,X,RET,DA,ZCNT,ZCNTT,PSJDAOC,ZZQ,XXI,ZI,SEVT,ZFND,SEVN S (ZCNT,ZCNTT,ZFND)=0
"RTN","PSJDGAL2",11,0)
 ;gets drug allergy order chks PSJ*5*260
"RTN","PSJDGAL2",12,0)
 I $G(PSJORD)["P" S ZORN=+$P(^PS(53.1,+PSJORD,0),U,21)
"RTN","PSJDGAL2",13,0)
 I $G(PSJORD)["U" S ZORN=+$P(^PS(55,DFN,5,+PSJORD,0),U,21)
"RTN","PSJDGAL2",14,0)
 I $G(PSJORD)["V" S ZORN=+$P(^PS(55,DFN,"IV",+PSJORD,0),U,21)
"RTN","PSJDGAL2",15,0)
 G:'$G(ZORN) EXT
"RTN","PSJDGAL2",16,0)
 S PSJDAOC="IP MEDS "_$S($G(PSJORD)["U":"Unit Dose",$G(PSJORD)["V":"IV",1:"Pending/Non-Verified")_" Order"
"RTN","PSJDGAL2",17,0)
 K ^TMP("PSJDAOCD",$J) D GETOC4^OROCAPI1(ZORN,.RET)
"RTN","PSJDGAL2",18,0)
BRK I $O(RET(ZORN,"DATA",""))="" W !,"NO Drug Allergy Order Checks found for "_PSJDAOC G EXT
"RTN","PSJDGAL2",19,0)
 F ZI=0:0 S ZI=$O(RET(ZORN,"DATA",ZI)) Q:'ZI  I $P(RET(ZORN,"DATA",ZI,1),"^")=3 S ZCNTT=1
"RTN","PSJDGAL2",20,0)
 I 'ZCNTT W !,"NO Drug Allergy Order Checks found for "_PSJDAOC G EXT
"RTN","PSJDGAL2",21,0)
 F ZI=0:0 S ZI=$O(RET(ZORN,"DATA",ZI)) Q:'ZI  I $P(RET(ZORN,"DATA",ZI,1),"^")=3 D
"RTN","PSJDGAL2",22,0)
 .S ZCNT=ZCNT+1,^TMP("PSJDAOCD",$J,"AOC",ZCNT,0)=$P(RET(ZORN,"DATA",ZI,0),"^",3)_"^"_$P(^VA(200,$P(RET(ZORN,"DATA",ZI,0),"^",4),0),"^")
"RTN","PSJDGAL2",23,0)
 .I $G(RET(ZORN,"DATA",ZI,"OR",1,0))]"" S ^TMP("PSJDAOCD",$J,"AOR",$G(RET(ZORN,"DATA",ZI,"OR",1,0)))=""
"RTN","PSJDGAL2",24,0)
 .;
"RTN","PSJDGAL2",25,0)
 .F XXI=0:0 S XXI=$O(^ORD(100.05,ZI,4,XXI)) Q:'XXI  D:$P($G(^ORD(100.05,ZI,4,XXI,0)),"^",3)]""
"RTN","PSJDGAL2",26,0)
 ..S ZFND=1,^TMP("PSJDAOCD",$J,"CA",$P(^ORD(100.05,ZI,4,XXI,0),"^",3))=""
"RTN","PSJDGAL2",27,0)
 ..S ^TMP("PSJDAOCD",$J,"OH")=$P(^ORD(100.05,ZI,4,XXI,0),"^",7),IT=+$P(^ORD(100.05,ZI,4,XXI,0),"^",5)
"RTN","PSJDGAL2",28,0)
 ..S SEVT=$P(^ORD(100.05,ZI,4,XXI,0),"^",8),SEVN=$S(SEVT=1:"MILD",SEVT=2:"MODERATE",SEVT=3:"SEVERE",1:"Not Entered")
"RTN","PSJDGAL2",29,0)
 ..F ZZQ=0:0 S ZZQ=$O(^ORD(100.05,ZI,4,XXI,1,ZZQ)) Q:'ZZQ  S ^TMP("PSJDAOCD",$J,"DC",$P(^ORD(100.05,ZI,4,XXI,1,ZZQ,0),"^"))=$P(^PS(50.605,$P(^ORD(100.05,ZI,4,XXI,1,ZZQ,0),"^"),0),"^")_" "_$P(^(0),"^",2)
"RTN","PSJDGAL2",30,0)
 ..F ZZQ=0:0 S ZZQ=$O(^ORD(100.05,ZI,4,XXI,2,ZZQ)) Q:'ZZQ  S ^TMP("PSJDAOCD",$J,"DI",$P(^PS(50.416,$P(^ORD(100.05,ZI,4,XXI,2,ZZQ,0),"^"),0),"^"))=""
"RTN","PSJDGAL2",31,0)
 ..F ZZQ=0:0 S ZZQ=$O(^ORD(100.05,ZI,4,XXI,3,ZZQ)) Q:'ZZQ  S ^TMP("PSJDAOCD",$J,"SS",$P(^GMRD(120.83,$P(^ORD(100.05,ZI,4,XXI,3,ZZQ,0),"^"),0),"^"))=""
"RTN","PSJDGAL2",32,0)
 I 'ZFND W !,"NO Drug Allergy Order Checks found for "_PSJDAOC G EXT
"RTN","PSJDGAL2",33,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=55,DIWF="" N Z,ZI,ZX
"RTN","PSJDGAL2",34,0)
 D FULL^VALM1 N ING,SS,DC,CA,OH,CAG S (ING,SS,DC,CA)=""
"RTN","PSJDGAL2",35,0)
 S CA=$O(^TMP("PSJDAOCD",$J,"CA",""))
"RTN","PSJDGAL2",36,0)
 W !,"Drug Allergy Occurrence Event for "_PSJDAOC,!
"RTN","PSJDGAL2",37,0)
 ; F ZXX=0:0 S ZXX=$O(^TMP("PSJDAOCD",$J,"AOC",ZXX)) Q:'ZXX  W !?3,$P(^TMP("PSJDAOCD",$J,"AOC",ZXX,0),"^")
"RTN","PSJDGAL2",38,0)
 S CAG="^"_$P(CA,";",2)_$P(CA,";")_",0)"
"RTN","PSJDGAL2",39,0)
 W !,"    Causative Agent: "_$S(CA="None Found":CA,1:$P(@(CAG),"^"))
"RTN","PSJDGAL2",40,0)
 S OH=$G(^TMP("PSJDAOCD",$J,"OH")) W !,"Historical/Observed: "_$S(OH="H":"HISTORICAL",OH="O":"OBSERVED",1:"Not Entered")
"RTN","PSJDGAL2",41,0)
 W !,"           Severity: "_SEVN
"RTN","PSJDGAL2",42,0)
 W !,"         Ingredient: " I $O(^TMP("PSJDAOCD",$J,"DI",""))]"" D
"RTN","PSJDGAL2",43,0)
 .F  S ING=$O(^TMP("PSJDAOCD",$J,"DI",ING)) Q:ING=""  S X=ING_", " D ^DIWP
"RTN","PSJDGAL2",44,0)
 .F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?21,^UTILITY($J,"W",1,ZX,0),!
"RTN","PSJDGAL2",45,0)
 .K ^UTILITY($J,"W") S DIWL=1,DIWR=55,DIWF="" N Z,ZI,ZX
"RTN","PSJDGAL2",46,0)
 E  W "None Entered",!
"RTN","PSJDGAL2",47,0)
 ;
"RTN","PSJDGAL2",48,0)
 W "     Signs/Symptoms: " I $O(^TMP("PSJDAOCD",$J,"SS",""))]"" D
"RTN","PSJDGAL2",49,0)
 .F  S SS=$O(^TMP("PSJDAOCD",$J,"SS",SS)) Q:SS=""  S X=SS_", " D ^DIWP
"RTN","PSJDGAL2",50,0)
 .F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?21,^UTILITY($J,"W",1,ZX,0),!
"RTN","PSJDGAL2",51,0)
 .K ^UTILITY($J,"W") S DIWL=1,DIWR=55,DIWF="" N Z,ZI,ZX
"RTN","PSJDGAL2",52,0)
 E  W "None Entered",!
"RTN","PSJDGAL2",53,0)
 ;
"RTN","PSJDGAL2",54,0)
 W "         Drug Class: " I $O(^TMP("PSJDAOCD",$J,"DC",0))]"" D
"RTN","PSJDGAL2",55,0)
 .F DC=0:0 S DC=$O(^TMP("PSJDAOCD",$J,"DC",DC)) Q:'DC  S X=^TMP("PSJDAOCD",$J,"DC",DC)_", " D ^DIWP
"RTN","PSJDGAL2",56,0)
 .F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?21,^UTILITY($J,"W",1,ZX,0),!
"RTN","PSJDGAL2",57,0)
 .K ^UTILITY($J,"W") S DIWL=1,DIWR=55,DIWF="" N Z,ZI,ZX
"RTN","PSJDGAL2",58,0)
 E  W !
"RTN","PSJDGAL2",59,0)
 ;
"RTN","PSJDGAL2",60,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=55,DIWF="" N Z,ZI,ZX,OR,X
"RTN","PSJDGAL2",61,0)
 S OR="" W "Provider Override Reason: " S OR=$O(^TMP("PSJDAOCD",$J,"AOR",""))
"RTN","PSJDGAL2",62,0)
 S X=$S($G(OR)]"":OR,1:"N/A - Order Entered Through VistA") D ^DIWP
"RTN","PSJDGAL2",63,0)
 F ZX=0:0 S ZX=$O(^UTILITY($J,"W",1,ZX)) Q:'ZX  W ?26,^UTILITY($J,"W",1,ZX,0),!
"RTN","PSJDGAL2",64,0)
 ;E  W "N/A - Order Entered Through VistA"
"RTN","PSJDGAL2",65,0)
 I IT D
"RTN","PSJDGAL2",66,0)
 .K DIC,DR,DIQ,DA,INTY S DIC=9009032.4,DA=IT,DR=".01;.03;.04;.08",DIQ="INTY" D EN^DIQ1
"RTN","PSJDGAL2",67,0)
 .W !,"  Intervention Date: "_INTY(9009032.4,IT,.01)
"RTN","PSJDGAL2",68,0)
 .W !,"           Provider: "_INTY(9009032.4,IT,.03)
"RTN","PSJDGAL2",69,0)
 .W !,"         Pharmacist: "_INTY(9009032.4,IT,.04)
"RTN","PSJDGAL2",70,0)
 .W !,"     Recommendation: "_INTY(9009032.4,IT,.08)
"RTN","PSJDGAL2",71,0)
 .K DIC,DR,DIQ,DA,INTY
"RTN","PSJDGAL2",72,0)
 E  W !," Pharmacist Intervention Not Entered"
"RTN","PSJDGAL2",73,0)
EXT W !
"RTN","PSJDGAL2",74,0)
 K DIR,DUOUT,DIRUT,ZFND
"RTN","PSJDGAL2",75,0)
 S DIR(0)="E",DIR("A")="Press Return to Continue",DIR("?")="Press Return to Redisplay Rx."
"RTN","PSJDGAL2",76,0)
 D ^DIR S VALMBCK="R" K DIR,DUOUT,DIRUT
"RTN","PSJDGAL2",77,0)
 K ^TMP("PSJDAOCD",$J)
"RTN","PSJDGAL2",78,0)
 Q
"RTN","PSJDGCK")
0^4^B7861600^n/a
"RTN","PSJDGCK",1,0)
PSJDGCK ;HP/MJE - Drug Interaction Utility ;09/22/11 5:00pm
"RTN","PSJDGCK",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**260**;16 DEC 97;Build 94
"RTN","PSJDGCK",3,0)
 ;External references to ^PSSDSAPM supported by DBIA 5570
"RTN","PSJDGCK",4,0)
 ;
"RTN","PSJDGCK",5,0)
DGCK ;
"RTN","PSJDGCK",6,0)
 S PSJDGCK=1
"RTN","PSJDGCK",7,0)
 D FULL^VALM1
"RTN","PSJDGCK",8,0)
 I $D(PSJDGCK)&($G(VALM("TITLE"))="IV Order Entry") D EN^PSJO1(2)
"RTN","PSJDGCK",9,0)
 I $$DGCKIEN^PSJDGCK()="" D
"RTN","PSJDGCK",10,0)
 .W !!,"Not enough active profile drugs to perform drug check",!
"RTN","PSJDGCK",11,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSJDGCK",12,0)
 E  D ^PSGOE7
"RTN","PSJDGCK",13,0)
DGCKEND S VALMBCK="R"
"RTN","PSJDGCK",14,0)
 K PSJDGCK
"RTN","PSJDGCK",15,0)
 Q
"RTN","PSJDGCK",16,0)
 ;
"RTN","PSJDGCK",17,0)
DGCKIEN() ;
"RTN","PSJDGCK",18,0)
 N PSJDGCK7 S PSJDGCK7="" I '$D(^TMP("PSJ",$J)) Q PSJDGCK7
"RTN","PSJDGCK",19,0)
 I $D(PSJDGCK) D
"RTN","PSJDGCK",20,0)
 .N PSJDGCK1,PSJDGCK2,PSJDGCK3,PSJDGCK4,PSJDGCK5,PSJDGCK6 S (PSJDGCK1,PSJDGCK2,PSJDGCK3,PSJDGCK4,PSJDGCK5,PSJDGCK6)=""
"RTN","PSJDGCK",21,0)
 .S PSJDGCK1=$O(^TMP("PSJ",$J,PSJDGCK1)),PSJDGCK2=$O(^TMP("PSJ",$J,PSJDGCK1,PSJDGCK2)),PSJDGCK3=$O(^TMP("PSJ",$J,PSJDGCK1,PSJDGCK2,PSJDGCK3)),PSJDGCK4=$O(^TMP("PSJ",$J,PSJDGCK1,PSJDGCK2,PSJDGCK3,PSJDGCK4))
"RTN","PSJDGCK",22,0)
 .I PSJDGCK4["U" S PSJDGCK5=$$GET1^DIQ(55.06,+PSJDGCK4_","_DFN_",",108,"I"),PSJDGCK6=$$DRG^PSSDSAPM(+PSJDGCK5,"I"),PSJDGCK7=$$GET1^DIQ(50,$P(PSJDGCK6,";"),.01,"E")
"RTN","PSJDGCK",23,0)
 .I PSJDGCK4["V" S PSJDGCK5=$$GET1^DIQ(55.01,+PSJDGCK4_","_DFN_",",130,"I"),PSJDGCK6=$$DRG^PSSDSAPM(+PSJDGCK5,"I"),PSJDGCK7=$$GET1^DIQ(50,$P(PSJDGCK6,";"),.01,"E")
"RTN","PSJDGCK",24,0)
 .I PSJDGCK4["P"!(PSJDGCK4["N") S PSJDGCK5=$$GET1^DIQ(53.1,+PSJDGCK4_","_DFN_",",108,"I"),PSJDGCK6=$$DRG^PSSDSAPM(+PSJDGCK5,"I"),PSJDGCK7=$$GET1^DIQ(50,$P(PSJDGCK6,";"),.01,"E")
"RTN","PSJDGCK",25,0)
 .S PSJDGCK7=PSJDGCK7_";"_$P(PSJDGCK6,";")
"RTN","PSJDGCK",26,0)
 Q PSJDGCK7
"RTN","PSJDGCK",27,0)
 ;
"RTN","PSJDGCK",28,0)
PSJSUPCK(CHK) ;
"RTN","PSJDGCK",29,0)
 I '($P($G(^PSDRUG(CHK,0)),"^",3)["S"!($E($P($G(^PSDRUG(CHK,0)),"^",2),1,2)="XA")) K CHK Q 0
"RTN","PSJDGCK",30,0)
 W !,"You have selected a supply item, please select another drug"
"RTN","PSJDGCK",31,0)
 W !,"or leave blank and hit enter for Profile Order Checks."
"RTN","PSJDGCK",32,0)
 K CHK
"RTN","PSJDGCK",33,0)
 Q 1
"RTN","PSJGMRA")
0^8^B26285552^B22172498
"RTN","PSJGMRA",1,0)
PSJGMRA ;BIR/MV - Retrieve and display Allergy data ;6 Jun 07 / 3:37 PM
"RTN","PSJGMRA",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**181,270,260**;16 DEC 97;Build 94
"RTN","PSJGMRA",3,0)
 ;
"RTN","PSJGMRA",4,0)
 ; Reference to ^PS(50.605 is supported by DBIA 696.
"RTN","PSJGMRA",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJGMRA",6,0)
 ; Reference to ^TMP("GMRAOC" supported by DBIA 4848.
"RTN","PSJGMRA",7,0)
 ; Reference to GETDATA^GMRAOR supported by DBIA 4847.
"RTN","PSJGMRA",8,0)
 ; Reference to PSODGAL1 supported by DBIA 5764.
"RTN","PSJGMRA",9,0)
 ; Reference to ^PS(50.7 supported by DBIA 2180
"RTN","PSJGMRA",10,0)
 ;
"RTN","PSJGMRA",11,0)
EN(DFN,PSJDD) ;
"RTN","PSJGMRA",12,0)
 ;DFN - Patient IEN
"RTN","PSJGMRA",13,0)
 ;PSJDD - ^PSDRUG IEN
"RTN","PSJGMRA",14,0)
 Q:'+$G(DFN)
"RTN","PSJGMRA",15,0)
 Q:'+$G(PSJDD)
"RTN","PSJGMRA",16,0)
 N PTR,GMRAING,PSJACK,PSJCLCNT,PSJFLG,PSJVACL,DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,PSJNEW,X,Y,PSODRUG,PSODFN,PSJAOC
"RTN","PSJGMRA",17,0)
 K ^TMP("GMRAOC",$J),^TMP($J,"PSJCLS"),PSJVACL,^TMP("PSJDAI",$J),^TMP("PSJDAOC",$J)
"RTN","PSJGMRA",18,0)
 S DIC=50,DIC(0)="MQZV",X=PSJDD D ^DIC K DIC Q:Y=-1
"RTN","PSJGMRA",19,0)
 S PSODRUG("IEN")=PSJDD,PSODRUG("VA CLASS")=$P(Y(0),"^",2),PSODRUG("NAME")=$P(Y(0),"^")
"RTN","PSJGMRA",20,0)
 S:+$G(^PSDRUG(+Y,2)) PSODRUG("OI")=+$G(^(2)),PSODRUG("OIN")=$P(^PS(50.7,+$G(^(2)),0),"^")
"RTN","PSJGMRA",21,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(PSJDD,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSJGMRA",22,0)
 ;changed n psj*5*260
"RTN","PSJGMRA",23,0)
 S PSODFN=DFN G ^PSODGAL1
"RTN","PSJGMRA",24,0)
 ;
"RTN","PSJGMRA",25,0)
 S PSJACK=0
"RTN","PSJGMRA",26,0)
 S PTR=$P($G(^PSDRUG(PSJDD,"ND")),U)_"."_$P($G(^PSDRUG(PSJDD,"ND")),U,3)
"RTN","PSJGMRA",27,0)
 I +PTR S PSJACK=$$NDF()
"RTN","PSJGMRA",28,0)
 S PSJCLCNT=$$CLASS()
"RTN","PSJGMRA",29,0)
 D DISP
"RTN","PSJGMRA",30,0)
 K ^TMP("GMRAOC",$J),^TMP($J,"PSJCLS")
"RTN","PSJGMRA",31,0)
 Q
"RTN","PSJGMRA",32,0)
NDF() ;Process NDF drug
"RTN","PSJGMRA",33,0)
 NEW PSJLP
"RTN","PSJGMRA",34,0)
 S PSJACK=0
"RTN","PSJGMRA",35,0)
 K ^TMP("GMRAOC",$J)
"RTN","PSJGMRA",36,0)
 S PSJACK=$$ORCHK^GMRAOR(DFN,"DR",PTR)
"RTN","PSJGMRA",37,0)
 Q PSJACK
"RTN","PSJGMRA",38,0)
CLASS() ;
"RTN","PSJGMRA",39,0)
 NEW PSJLEN,PSJLOC,PSJCLCHK,PSJCLNM,PSJDDCL,INVCL,INVCNT
"RTN","PSJGMRA",40,0)
 S PSJDDCL=$P($G(^PSDRUG(+PSJDD,0)),U,2)
"RTN","PSJGMRA",41,0)
 S PSJLEN=4,PSJCLCNT=0
"RTN","PSJGMRA",42,0)
 I $E(PSJDDCL,1,4)="CN10" S PSJLEN=5 ;look at 5 chars if ANALGESICS
"RTN","PSJGMRA",43,0)
 ;
"RTN","PSJGMRA",44,0)
 K GMRADRCL,^TMP("GMRAOC",$J,"APC"),^TMP($J,"PSJCLS")
"RTN","PSJGMRA",45,0)
 D GETDATA^GMRAOR(DFN)
"RTN","PSJGMRA",46,0)
 I '$D(^TMP("GMRAOC",$J,"APC")) Q 0
"RTN","PSJGMRA",47,0)
 ;
"RTN","PSJGMRA",48,0)
 S PSJVACL="" F  S PSJVACL=$O(^TMP("GMRAOC",$J,"APC",PSJVACL)) Q:PSJVACL=""  D
"RTN","PSJGMRA",49,0)
 .;*PSJ*5*270 - Check for invalid drug class, print warning message
"RTN","PSJGMRA",50,0)
 . S PSJLOC=^TMP("GMRAOC",$J,"APC",PSJVACL),PSJCLNM=$P($G(^PS(50.605,+$O(^PS(50.605,"B",PSJVACL,0)),0)),U,2)
"RTN","PSJGMRA",51,0)
 . I $G(PSJCLNM)="" S INVCL(PSJVACL)="" Q
"RTN","PSJGMRA",52,0)
 . S PSJVACL(PSJVACL)=PSJVACL_U_PSJCLNM_" ("_PSJLOC_")"
"RTN","PSJGMRA",53,0)
 . S PSJCLCNT=PSJCLCNT+1
"RTN","PSJGMRA",54,0)
 I $D(INVCL) D
"RTN","PSJGMRA",55,0)
 . W $C(7),!!,"WARNING: The following drug class does not exist in the VA DRUG CLASS file",!
"RTN","PSJGMRA",56,0)
 . W "         (#50.605).  Please do a manual Drug-Allergy order check and notify",!
"RTN","PSJGMRA",57,0)
 . W "         the pharmacy ADPAC for follow up.",!
"RTN","PSJGMRA",58,0)
 . S INVCNT="" F  S INVCNT=$O(INVCL(INVCNT)) Q:INVCNT=""  W !,"VA Drug Class: ",INVCNT
"RTN","PSJGMRA",59,0)
 . W ! S DIR("A")="Press Return to continue",DIR(0)="E",DIR("?")="Press Return to continue" D ^DIR K DIR W !
"RTN","PSJGMRA",60,0)
 ;
"RTN","PSJGMRA",61,0)
 S PSJCLCHK=0,PSJVACL="" F  S PSJVACL=$O(PSJVACL(PSJVACL)) Q:PSJVACL=""  D
"RTN","PSJGMRA",62,0)
 .I $E(PSJDDCL,1,PSJLEN)=$E(PSJVACL,1,PSJLEN) D
"RTN","PSJGMRA",63,0)
 .. S PSJCLCHK=PSJCLCHK+1
"RTN","PSJGMRA",64,0)
 .. S ^TMP($J,"PSJCLS",PSJCLCHK)=PSJVACL_" "_$P(PSJVACL(PSJVACL),"^",2)
"RTN","PSJGMRA",65,0)
 K ^TMP("GMRAOC",$J)
"RTN","PSJGMRA",66,0)
 Q PSJCLCHK
"RTN","PSJGMRA",67,0)
DISP ;
"RTN","PSJGMRA",68,0)
 NEW PSJLOC,PSJNIEN,PSJNM,PSJVACL,X,PSJX
"RTN","PSJGMRA",69,0)
 S PSJFLG=0
"RTN","PSJGMRA",70,0)
 S PSJX=$O(^TMP("GMRAOC",$J,"APC",""))
"RTN","PSJGMRA",71,0)
 I '$G(PSJACK)&'$G(PSJCLCNT) Q
"RTN","PSJGMRA",72,0)
 S PSJFLG=1
"RTN","PSJGMRA",73,0)
 W $C(7),!!,"A Drug-Allergy Reaction exists for this medication and/or class!"
"RTN","PSJGMRA",74,0)
 W !!,?3,"Drug: "_$P($G(^PSDRUG(PSJDD,0)),"^")
"RTN","PSJGMRA",75,0)
 I PSJACK D
"RTN","PSJGMRA",76,0)
 . S PSJX=""
"RTN","PSJGMRA",77,0)
 . F X=0:0 S X=$O(GMRAING(X)) Q:'X  D
"RTN","PSJGMRA",78,0)
 .. S PSJX=PSJX_$S(PSJX="":"",1:", ")_GMRAING(X)
"RTN","PSJGMRA",79,0)
 . I PSJX]"" W !?6,"Ingredients: " D MYWRITE^PSJMISC(PSJX,19,75)
"RTN","PSJGMRA",80,0)
 D:PSJCLCNT DISPCL
"RTN","PSJGMRA",81,0)
 D:(PSJFLG&'$D(PSJDGCK)) INTERV("ALLERGY")
"RTN","PSJGMRA",82,0)
 Q
"RTN","PSJGMRA",83,0)
DISPCL ;Display class(es)
"RTN","PSJGMRA",84,0)
 NEW PSJX,X
"RTN","PSJGMRA",85,0)
 Q:'$D(^TMP($J,"PSJCLS"))
"RTN","PSJGMRA",86,0)
 S PSJX=""
"RTN","PSJGMRA",87,0)
 S PSJVACL="" F  S PSJVACL=$O(^TMP($J,"PSJCLS",PSJVACL)) Q:PSJVACL=""  D
"RTN","PSJGMRA",88,0)
 . S PSJX=PSJX_$S(PSJX="":"",1:", ")_^TMP($J,"PSJCLS",PSJVACL)
"RTN","PSJGMRA",89,0)
 . S PSJFLG=1
"RTN","PSJGMRA",90,0)
 I PSJX]"" D
"RTN","PSJGMRA",91,0)
 . W !,?6,"Drug Class: "
"RTN","PSJGMRA",92,0)
 . D MYWRITE^PSJMISC(PSJX,19,75)
"RTN","PSJGMRA",93,0)
 Q
"RTN","PSJGMRA",94,0)
 ;
"RTN","PSJGMRA",95,0)
INTERV(PSJRXREQ,PSJDD1) ;Prompt if user to log an intervention for significant interaction
"RTN","PSJGMRA",96,0)
 ;PSPRXREQ - intervention type
"RTN","PSJGMRA",97,0)
 ;PSJDD1 - Prospective drug name
"RTN","PSJGMRA",98,0)
 NEW DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,X
"RTN","PSJGMRA",99,0)
 I $G(PSGORQF)=1 Q
"RTN","PSJGMRA",100,0)
 S DIR(0)="SA^1:YES;0:NO",DIR("A")="Do you want to Intervene? ",DIR("B")=$S($G(PSJRXREQ)="ALLERGY":"YES",1:"NO")
"RTN","PSJGMRA",101,0)
 I $G(PSJDD1)]"" S DIR("A")="Do you want to Intervene with "_PSJDD1_"? "
"RTN","PSJGMRA",102,0)
 W ! D ^DIR
"RTN","PSJGMRA",103,0)
 S DIR("?",1)="Answer 'YES' if you DO want to enter an intervention for this medication,"
"RTN","PSJGMRA",104,0)
 S DIR("?")="       'NO' if you DON'T want to enter an intervention for this medication,"
"RTN","PSJGMRA",105,0)
 I Y S PSGP=DFN D ^PSJRXI W !
"RTN","PSJGMRA",106,0)
 Q 
"RTN","PSJGMRA",107,0)
RINTERV(PSJRXREQ,PSJDD1) ;Prompt user to log an intervention for critical interaction
"RTN","PSJGMRA",108,0)
 ;PSPRXREQ - intervention type
"RTN","PSJGMRA",109,0)
 ;PSJDD1 - Prospective drug name
"RTN","PSJGMRA",110,0)
 NEW DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,X
"RTN","PSJGMRA",111,0)
 K PSGORQF
"RTN","PSJGMRA",112,0)
 S DIR(0)="SA^1:YES;0:NO",DIR("A")="Do you want to Continue? ",DIR("B")="NO"
"RTN","PSJGMRA",113,0)
 I $G(PSJDD1)]"" S DIR("A")="Do you want to Continue with "_PSJDD1_"? "
"RTN","PSJGMRA",114,0)
 S DIR("?",1)="Enter 'NO' if you wish to exit without continuing with the order,",DIR("?")="or 'YES' to continue with the order entry process."
"RTN","PSJGMRA",115,0)
 D ^DIR
"RTN","PSJGMRA",116,0)
 I 'Y S PSGORQF=1 S VALMBCK="R" Q
"RTN","PSJGMRA",117,0)
 I Y S PSGP=DFN D ^PSJRXI W !
"RTN","PSJGMRA",118,0)
 Q
"RTN","PSJHEAD")
0^11^B30136774^B27612125
"RTN","PSJHEAD",1,0)
PSJHEAD ;BIR/KKA-PROFILE HEADER ; 4/1/08 4:29pm
"RTN","PSJHEAD",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**8,20,85,95,203,260**;16 DEC 97;Build 94
"RTN","PSJHEAD",3,0)
 ;
"RTN","PSJHEAD",4,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJHEAD",5,0)
 ;External reference to $$BSA^PSSDSAPI supported by DBIA 5425.
"RTN","PSJHEAD",6,0)
 ;
"RTN","PSJHEAD",7,0)
ENTRY(DFN,PSJOPC,PG,PSJNARC,PSJTEAM,PSJY2K)   ;
"RTN","PSJHEAD",8,0)
 ;DFN=patient internal entry number
"RTN","PSJHEAD",9,0)
 ;PSJOPC=a code showing what type of option is printing the header
"RTN","PSJHEAD",10,0)
 ;PG=page number
"RTN","PSJHEAD",11,0)
 ;PSJNARC=code telling whether or not to print narrative
"RTN","PSJHEAD",12,0)
 ;PSJTEAM=code telling whether or not to print team
"RTN","PSJHEAD",13,0)
 ;PSJY2K=code telling whether or not to print 4 digit year
"RTN","PSJHEAD",14,0)
STUFF ;
"RTN","PSJHEAD",15,0)
 N %,ALFLG,GONE,HDT,KKA,LEN,LENCHK,PSGALG,PSGADR,PSGDT,PSGVWA,PSJPAD,PSJPAGE,PSJPDD,PSJPDOB,PSJPDX,PSJPHT,PSJPHTD,PSJPPID,PSJPR,PSJPRB,PSJPSEX,PSJPTD,PSJPWD,PSJPWDN,PSJPWT,PSJWTD,RB,SI,TEAM,WCNT,WRD,X
"RTN","PSJHEAD",16,0)
 ;
"RTN","PSJHEAD",17,0)
 ;PPAGE=the page of the individual we are now printing. This is needed to keep track of how we print the Allergy/ADR info
"RTN","PSJHEAD",18,0)
 ;PSJNEW is set at the top of all options which call this header, if this is the first time the option has called the routine, PSJNEW will exist
"RTN","PSJHEAD",19,0)
 ;
"RTN","PSJHEAD",20,0)
 I $D(PSJNEW) S PSGPTMP=0,PPAGE=1 K PSJNEW
"RTN","PSJHEAD",21,0)
 S PSGP=DFN S:PSGP=$G(PSGPTMP) PPAGE=PPAGE+1 I PSGP'=$G(PSGPTMP) S PSGPTMP=PSGP,PPAGE=1
"RTN","PSJHEAD",22,0)
 D NOW^%DTC S PSGDT=%,HDT=$$ENDTC^PSGMI(PSGDT)
"RTN","PSJHEAD",23,0)
 S VA200=1 D INP^VADPT
"RTN","PSJHEAD",24,0)
 I VAIN(4) S PSJPWD=+VAIN(4),PSJPWDN=$P(VAIN(4),"^",2),(PSJPRB,RB)=VAIN(5),PSJPAD=+VAIN(7),PSJPDX=VAIN(9),PSJPDD="",PSJPTD=$S($D(^PS(55,DFN,5.1)):$P(^(5.1),"^",4),1:"")
"RTN","PSJHEAD",25,0)
 I 'VAIN(4) S VAIP("D")="L" D IN5^VADPT S PSJPWD=+VAIP(5),PSJPWDN=$P(VAIP(5),"^",2),(PSJPRB,RB)=$P(VAIP(6),"^",2),PSJPAD=+VAIP(13,1),PSJPDX=VAIP(9) D
"RTN","PSJHEAD",26,0)
 .S PSGID=+VAIP(3),X=+VAIP(4)=12!(+VAIP(4)=38),PSJPTD="",PSJPDD=PSGID_"^"_$$ENDTC^PSGMI(PSGID) S:X PSJPDD=PSJPDD_"^1"
"RTN","PSJHEAD",27,0)
 D DEM^VADPT,HTWT^PSJAC(DFN)
"RTN","PSJHEAD",28,0)
 S PSGP(0)=VADM(1),PSJPDOB=+VADM(3),PSJPAGE=VADM(4),PSJPSEX=$S(VADM(5)]"":VADM(5),1:"?^____"),PSJPPID=VA("PID")
"RTN","PSJHEAD",29,0)
 F X="PSJPAD","PSJPDOB","PSJPTD" I $G(@X) S $P(@X,"^",2)=$S($D(PSJY2K):$$ENDTC2^PSGMI(+@X),1:$$ENDTC^PSGMI(+@X))
"RTN","PSJHEAD",30,0)
ENHEAD ; print new page, name, ssn, dob, and ward
"RTN","PSJHEAD",31,0)
 I $D(ENGET) S RB=$S($G(PSJPRB)]"":PSJPRB,1:"* NF *")
"RTN","PSJHEAD",32,0)
 S SLS="",$P(SLS," -",15)=""
"RTN","PSJHEAD",33,0)
 ;* I PSJOPC]"" W:$Y @IOF W ! W:PSJOPC="ALL" ?16,"I N P A T I E N T   M E D I C A T I O N S" W:PSJOPC="UD" ?19,"U N I T   D O S E   P R O F I L E" W:PSJOPC="IV" !,?19,"I V  P A T I E N T  P R O F I L E" W ?64,HDT,!,SLS,SLS,$E(SLS,1,24),!
"RTN","PSJHEAD",34,0)
 I PSJOPC]"" D
"RTN","PSJHEAD",35,0)
 . W:$Y @IOF
"RTN","PSJHEAD",36,0)
 . W ! W:PSJOPC="ALL" ?16,"I N P A T I E N T   M E D I C A T I O N S" W:PSJOPC="UD" ?19,"U N I T   D O S E   P R O F I L E" W:PSJOPC="IV" !,?19,"I V  P A T I E N T  P R O F I L E" W ?64,HDT
"RTN","PSJHEAD",37,0)
 . NEW X S X=$$SITE^PSGMMAR2(80)
"RTN","PSJHEAD",38,0)
 . W !?+X,$P(X,U,2),!,SLS,SLS,$E(SLS,1,24),!
"RTN","PSJHEAD",39,0)
 W ?1,$P(PSGP(0),"^"),?34,"  ",$S('PSJPDD:"",$G(PSJIVOF):"",1:"Last "),"Ward: ",$S(PSJPDD&($G(PSJIVOF)):"OUTPATIENT",PSJPWDN]"":PSJPWDN,1:"* NF *") W:$D(PSJPR) ?75-$L(PG),"Pg: ",PG-$D(PSGVWA)
"RTN","PSJHEAD",40,0)
 W !?4,"PID: ",PSJPPID W:'PSJPDD ?26 W:PSJPDD ?21,"Last " W "Room-Bed: ",$S(RB="":"* NF *",1:RB),?53,"Ht(cm): ",?61 W:PSJPHT["_" PSJPHT W:PSJPHT'["_" $J(PSJPHT,6,2) W ?68,PSJPHTD
"RTN","PSJHEAD",41,0)
 W !?4,"DOB: ",$S($D(PSJY2K):$E($P(PSJPDOB,"^",2),1,10),1:$E($P(PSJPDOB,"^",2),1,8))_"  ("_PSJPAGE_")"
"RTN","PSJHEAD",42,0)
 I (PSJTEAM=1)&(RB]"") S TEAM=$S($O(^PS(57.7,"AWRT",$G(PSJPWD),$G(RB),0)):$O(^(0)),1:"") S:TEAM]"" TEAM=$G(^PS(57.7,$G(PSJPWD),1,TEAM,0))
"RTN","PSJHEAD",43,0)
 I $D(TEAM) W ?30,"Team: ",$S(TEAM]"":TEAM,1:"* NF *")
"RTN","PSJHEAD",44,0)
 W ?53,"Wt(kg): ",?61 W:PSJPWT["_" PSJPWT W:PSJPWT'["_" $J(PSJPWT,6,2) W ?68,PSJPWTD
"RTN","PSJHEAD",45,0)
 W !?4,"Sex: ",$P(PSJPSEX,"^",2),?'PSJPDD*5+46,$S(PSJPDD:"Last ",1:""),"Admitted: ",$S($D(PSJY2K):$E($P(PSJPAD,"^",2),1,10),1:$E($P(PSJPAD,"^",2),1,8))
"RTN","PSJHEAD",46,0)
 W !?5,"Dx: ",$S(PSJPDX]"":PSJPDX,1:"* NF *") S X=$S(PSJPDD:PSJPDD,1:$G(PSJPTD)) I X W ?PSJPDD>0*6+43,$S(PSJPDD:"Discharged: ",1:"Last transferred: "),$S($D(PSJY2K):$E($P(X,"^",2),1,10),1:$E($P(X,"^",2),1,8))
"RTN","PSJHEAD",47,0)
 S PSJBSA=$$BSA^PSSDSAPI(DFN),PSJBSA=$P(PSJBSA,"^",3),PSJBSA=$S(PSJBSA'>0:"_________",1:$J(PSJBSA,4,2))
"RTN","PSJHEAD",48,0)
 S RSLT=$$CRCL^PSJLMHED(DFN)
"RTN","PSJHEAD",49,0)
 I $P(RSLT,"^",2)["Not Found" S ZDSPL=" CrCL: "_$P(RSLT,"^",2)
"RTN","PSJHEAD",50,0)
 E  S ZDSPL=" CrCL: "_$P($G(RSLT),"^",2)_"(est.) "_"(CREAT:"_$P($G(RSLT),"^",3)_"mg/dL "_$P($G(RSLT),"^")_")"
"RTN","PSJHEAD",51,0)
 W !?2,ZDSPL,?51,"BSA (m2): ",$G(PSJBSA) K ZDSPL,RSLT,PSJBSA
"RTN","PSJHEAD",52,0)
 I PSJNARC=1 W !?1,"Pharmacy Narrative: " S WCNT=1,SI=$G(^PS(55,DFN,1)) W:SI=""&($E(IOST)="P") " ____________________" I SI]"" D
"RTN","PSJHEAD",53,0)
 .S LENCHK=0,LEN=$L(SI)
"RTN","PSJHEAD",54,0)
 .F  S WRD=$P(SI," ",WCNT) Q:$L(WRD)=0&(LENCHK'<LEN)  S WCNT=WCNT+1 W:$X+$L(WRD)>79 !,?21 W " ",WRD S LENCHK=LENCHK+$L(WRD)+1
"RTN","PSJHEAD",55,0)
 S PSGP=DFN,ALFLG=0 D ATS^PSJMUTL(68,68,2)
"RTN","PSJHEAD",56,0)
 W !?1,"Allergies: " D:PSGALG+PSGVALG+PSGADR+PSGVADR=0 NONE I PSGALG+PSGVALG+PSGADR+PSGVADR>0 D ALG,ADR I ALFLG D
"RTN","PSJHEAD",57,0)
 .W "See patient's first ",$S($E(IOST)="C":"screen",1:"page")," for Allergies/Adverse Reactions"
"RTN","PSJHEAD",58,0)
 I $D(^PS(55,DFN,5.1)),$P(^(5.1),"^",7) S X=$P(^(5.1),"^",10),X="* ALL "_$S($P(^(5.1),"^",7)=1:"UNIT DOSE ",1:"")_"ORDERS PLACED ON HOLD "_$E("(",X]"")_X_$E(")",X]"")_" *" W $C(7),!!?80-$L(X)\2,X
"RTN","PSJHEAD",59,0)
 Q
"RTN","PSJHEAD",60,0)
NONE ;
"RTN","PSJHEAD",61,0)
 ;W:$E(IOST)="P" "______________________________" W !?7,"ADR: " W:$E(IOST)="P" "____________________________________"
"RTN","PSJHEAD",62,0)
 W "No Allergy Assessment" W !?7,"ADR: " W:$E(IOST)="P" "____________________________________"
"RTN","PSJHEAD",63,0)
 Q
"RTN","PSJHEAD",64,0)
ALG ;
"RTN","PSJHEAD",65,0)
 I PPAGE>1&((PSGALG'<68)!(PSGADR'<63)) S ALFLG=1 Q
"RTN","PSJHEAD",66,0)
 I PSGVALG(1)["NKA",(PSGALG(1)["NKA") S PSGALG(1)=""
"RTN","PSJHEAD",67,0)
 I PSGALG=20,(PSGALG(1)["__________") D
"RTN","PSJHEAD",68,0)
 . I PSGVADR=20,(PSGVADR(1)["__________") S PSGALG(1)="" S:PSGVALG(1)["__________" PSGVALG(1)="No Allergy Assessment"
"RTN","PSJHEAD",69,0)
 S KKA=0 F  S KKA=$O(PSGVALG(KKA)) Q:'KKA  W:KKA>1 !?12 W PSGVALG(KKA)
"RTN","PSJHEAD",70,0)
 I PSGALG(1)]"",(PSGALG(1)'["__________") W !," NV Aller.: " D
"RTN","PSJHEAD",71,0)
 . S KKA=0 F  S KKA=$O(PSGALG(KKA)) Q:'KKA  W:KKA>1 !?12 W PSGALG(KKA)
"RTN","PSJHEAD",72,0)
 Q
"RTN","PSJHEAD",73,0)
ADR ;
"RTN","PSJHEAD",74,0)
 Q:ALFLG
"RTN","PSJHEAD",75,0)
 W !?7,"ADR: "
"RTN","PSJHEAD",76,0)
 I PSGVADR(1)["NKA",(PSGADR(1)["NKA") S PSGADR(1)=""
"RTN","PSJHEAD",77,0)
 I PSGADR=20,(PSGADR(1)["__________") S PSGADR(1)=""
"RTN","PSJHEAD",78,0)
 S KKA=0 F  S KKA=$O(PSGVADR(KKA)) Q:'KKA  W:KKA>1 !?12 W PSGVADR(KKA)
"RTN","PSJHEAD",79,0)
 I PSGADR(1)]"" W !?4,"NV ADR: " D
"RTN","PSJHEAD",80,0)
 . S KKA=0 F  S KKA=$O(PSGADR(KKA)) Q:'KKA  W:KKA>1 !?12 W PSGADR(KKA)
"RTN","PSJHEAD",81,0)
 Q
"RTN","PSJHL3")
0^9^B111350623^B90089505
"RTN","PSJHL3",1,0)
PSJHL3 ;BIR/RLW-PHARMACY ORDER SEGMENTS ;4/24/12 2:46pm
"RTN","PSJHL3",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**1,11,14,40,42,47,50,56,58,92,101,102,123,110,111,152,134,226,267,260**;16 DEC 97;Build 94
"RTN","PSJHL3",3,0)
 ;
"RTN","PSJHL3",4,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJHL3",5,0)
 ; Reference to ^PS(50.607 is supported by DBIA# 2221.        
"RTN","PSJHL3",6,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL3",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL3",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL3",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL3",10,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL3",11,0)
 ; Reference to ^PSDRUG( is supported by DBIA# 2192.
"RTN","PSJHL3",12,0)
 ; Reference to ^PSNDF( is supported by DBIA# 2195.
"RTN","PSJHL3",13,0)
 ; Reference to ^VA(200 is supported by DBIA# 10060.
"RTN","PSJHL3",14,0)
 ; Reference to ^PSNAPIS is supported by DBIA# 2531.
"RTN","PSJHL3",15,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJHL3",16,0)
 ; Reference to ^PSSUTIL1 is supported by DBIA# 3179.
"RTN","PSJHL3",17,0)
 ; Reference to ^ORHLESC is supported by DBIA# 4922.
"RTN","PSJHL3",18,0)
 ;
"RTN","PSJHL3",19,0)
 ;*267 Change NTE|21 so it can send over the Long Wp Special Inst/
"RTN","PSJHL3",20,0)
 ;     Other Prt Info fields if populated.
"RTN","PSJHL3",21,0)
 ;
"RTN","PSJHL3",22,0)
EN1(PSJHLDFN,PSOC,PSJORDER) ; start here
"RTN","PSJHL3",23,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL3",24,0)
 ;               PSJORDER (file root of order)
"RTN","PSJHL3",25,0)
 ;               OC (order control code - NW for new order, OK for finished order, OC for order canceled)
"RTN","PSJHL3",26,0)
 I $G(PSJHLDFN)']""!$G(PSOC)']""!$G(PSJORDER)']"" W !,"INSUFFICIENT DATA FOR ^PSJHL3" Q
"RTN","PSJHL3",27,0)
 N COMMENTS,DDIEA,DDNUM,DOSE,DOSEFORM,DOSEOR,NAME,DURATION,IVTYPE,NODE1,NODE2,NDNODE,OINODE,PSGPLS,PSGPLF,PRODNAME,SPDIEN,UNIT,UNITS,CNT,DDIEN,SCHEDULE,PSGST
"RTN","PSJHL3",28,0)
 D INIT
"RTN","PSJHL3",29,0)
 S IVTYPE=$S(RXORDER["U":"",1:$$IVTYPE^PSJHLU(PSJORDER))
"RTN","PSJHL3",30,0)
 D RXO,RXE,RXR D ZRX
"RTN","PSJHL3",31,0)
 D CALL^PSJHLU(PSJI)
"RTN","PSJHL3",32,0)
 ;PSJ*5*260
"RTN","PSJHL3",33,0)
 I +$G(^TMP("PSODAOC",$J,1,0)) D
"RTN","PSJHL3",34,0)
 .N DA,OCCDT,ORN,ORL,Z,RET,PSJDAOC,RXN
"RTN","PSJHL3",35,0)
 .S PSJDAOC="IP MEDS "_$S($G(PSJOCFG)]"":PSJOCFG,1:"")_" Order Acceptance",OCCDT=$$NOW^XLFDT
"RTN","PSJHL3",36,0)
 .S RXN=+RXORDER
"RTN","PSJHL3",37,0)
 .I RXORDER["P" S ORN=$P(^PS(53.1,+RXORDER,0),U,21)
"RTN","PSJHL3",38,0)
 .I RXORDER["U" S ORN=$P(^PS(55,DFN,5,+RXORDER,0),U,21)
"RTN","PSJHL3",39,0)
 .I RXORDER["V" S ORN=$P(^PS(55,DFN,"IV",+RXORDER,0),U,21)
"RTN","PSJHL3",40,0)
 .Q:'$G(ORN)
"RTN","PSJHL3",41,0)
 .D DAOC
"RTN","PSJHL3",42,0)
 Q
"RTN","PSJHL3",43,0)
INIT ; initialize HL7 variables
"RTN","PSJHL3",44,0)
 D INIT^PSJHLU
"RTN","PSJHL3",45,0)
 Q
"RTN","PSJHL3",46,0)
RXO ; pharmacy prescription order segment (used to send Orderable Item to OE/RR)
"RTN","PSJHL3",47,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL3",48,0)
 S FIELD(0)="RXO"
"RTN","PSJHL3",49,0)
 S OINODE=$G(@(PSJORDER_".2)"))
"RTN","PSJHL3",50,0)
 S SPDIEN=+$P(OINODE,"^"),DOSEOR=$$ESC^ORHLESC($P(OINODE,"^",2)),DOSE=$P(OINODE,"^",5),UNIT=$P(OINODE,"^",6) S:'$G(PSJBCBU) UNIT=$$ESC^ORHLESC(UNIT)
"RTN","PSJHL3",51,0)
 S FIELD(1)=$S(SPDIEN=0:"^^^^",1:"^^^"_SPDIEN_"^")
"RTN","PSJHL3",52,0)
 I SPDIEN S DOSEFORM=$P($G(^PS(50.7,SPDIEN,0)),"^",2),NAME=$P($G(^PS(50.606,+DOSEFORM,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME) S FIELD(1)=FIELD(1)_$$ESC^ORHLESC($P($G(^PS(50.7,SPDIEN,0)),"^"))_" "_NAME
"RTN","PSJHL3",53,0)
 S FIELD(1)=FIELD(1)_"^99PSP"
"RTN","PSJHL3",54,0)
 N IVLNOD S IVLNOD=$G(@(PSJORDER_"2.5)")) D
"RTN","PSJHL3",55,0)
 .S IVLIM=$P(IVLNOD,"^",4) I IVLIM?1"a".N S IVLIM="doses"_$P(IVLIM,"a",2)
"RTN","PSJHL3",56,0)
 .S $P(FIELD(1),"^",3)=IVLIM
"RTN","PSJHL3",57,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",58,0)
 Q
"RTN","PSJHL3",59,0)
RXE ; pharmacy encoded order segment
"RTN","PSJHL3",60,0)
 S (UNITS,NDNODE,SPDIEN,PRODNAME,DDNUM,DDIEN,CNT)="",LIMIT=26 X PSJCLEAR
"RTN","PSJHL3",61,0)
 S FIELD(0)="RXE"
"RTN","PSJHL3",62,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)")),NODEPT2=$G(@(PSJORDER_".2)"))
"RTN","PSJHL3",63,0)
  I $G(PSGST)="" N PSGST D
"RTN","PSJHL3",64,0)
 .I $G(RXORDER)["V" N X,ZZND,LYN,PSGS0XT,PSGS0Y,PSGOES S PSGOES=1 S X=$G(P(9)) I X]"" D EN^PSGS0 S:$G(ZZND)'="" PSGST=$P(ZZND,"^",5) Q
"RTN","PSJHL3",65,0)
 .S PSGST=$P($G(NODE1),"^",7)
"RTN","PSJHL3",66,0)
 I RXORDER["V" D IVRXE Q
"RTN","PSJHL3",67,0)
 I RXORDER["P",IVTYPE="F" D IVRXE Q
"RTN","PSJHL3",68,0)
 I RXORDER["P",$P(NODE1,"^",4)="H" D IVRXE Q
"RTN","PSJHL3",69,0)
 N RENEW S RENEW=$$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL3",70,0)
 S PSGPLS=$S($G(PSJEXPOE):$P(NODE2,"^",2),RENEW>$P(NODE2,"^",2):RENEW,1:$P(NODE2,"^",2))
"RTN","PSJHL3",71,0)
 S PSGPLF=$S($G(PSJEXPOE):PSJEXPOE,1:$P(NODE2,"^",4))
"RTN","PSJHL3",72,0)
 S FIELD(1)="^"_$S($G(PSJBCBU):$P(NODE2,"^"),1:$$ESC^ORHLESC($P(NODE2,"^")))_"&"_$P(NODE2,"^",5)_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)_"^"_$P($G(NODEPT2),"^",4)_"^"_$G(PSGST)
"RTN","PSJHL3",73,0)
 S FIELD(21)="^"_$P(NODE2,"^",5)_"^99PSA^^^"
"RTN","PSJHL3",74,0)
 I ($G(DOSEOR)']"")!($O(@(PSJORDER_"1,"" "")"),-1)=1) D
"RTN","PSJHL3",75,0)
 .S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  Q:CNT=1  S DDIEN=+$G(@(PSJORDER_"1,"_DDNUM_",0)")) D
"RTN","PSJHL3",76,0)
 ..S FIELD(1)=$S($P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2)="":"1",1:$P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2))_"&"_FIELD(1)
"RTN","PSJHL3",77,0)
 ..S FIELD(1)=DOSE_"&"_UNIT_"&"_FIELD(1),$P(FIELD(1),"^",8)=$S($G(DOSEOR)]"":$G(DOSEOR),1:DOSE_UNIT)
"RTN","PSJHL3",78,0)
 ..S:$P(FIELD(1),"^",8)="" $P(FIELD(1),"^",8)=$$ESC^ORHLESC($G(@(PSJORDER_".3)")))
"RTN","PSJHL3",79,0)
 ..S NDNODE=$G(^PSDRUG(DDIEN,"ND"))
"RTN","PSJHL3",80,0)
 ..;  CHANGE FOR NEW NDF CALL
"RTN","PSJHL3",81,0)
 ..S PRODNAME=$S($T(^PSNAPIS)]"":$$PROD0^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),$G(^PSNDF(+NDNODE,5,+$P(NDNODE,"^",3),0))]"":^(0),1:"N/A")
"RTN","PSJHL3",82,0)
 ..S:PRODNAME="" PRODNAME="N/A"
"RTN","PSJHL3",83,0)
 ..S FIELD(2)=$S(PRODNAME="N/A":"^^",1:+NDNODE_"."_+$P(NDNODE,"^",3)_"^"_$P(NDNODE,"^",2)_"^"_"99NDF")_"^"_DDIEN_"^"_$S($G(PSJBCBU):$P($G(^PSDRUG(DDIEN,0)),"^"),1:$$ESC^ORHLESC($P($G(^PSDRUG(DDIEN,0)),"^")))_"^"_"99PSD"
"RTN","PSJHL3",84,0)
 ..S UNITS=$S(PRODNAME="N/A":"N/A",1:$S($T(^PSNAPIS)]"":$P($$DFSU^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),"^",5),1:$P($G(^PSNDF(+NDNODE,2,+$P(PRODNAME,"^",2),3,+$P(PRODNAME,"^",3),4,+$P(PRODNAME,"^",4),0)),"^")))
"RTN","PSJHL3",85,0)
 ..S FIELD(5)="^^^"_$$ESC^ORHLESC(UNITS)_"^"_$$ESC^ORHLESC($P($G(^PS(50.607,UNITS,0)),"^"))_"^99PSU"
"RTN","PSJHL3",86,0)
 ..S FIELD(6)="^^^"_$$ESC^ORHLESC($G(DOSEFORM))_"^"_$$ESC^ORHLESC($P($G(^PS(50.606,+$G(DOSEFORM),0)),"^"))_"^99PSF"
"RTN","PSJHL3",87,0)
 ..S FIELD(25)=$$EN^PSSUTIL1(DDIEN),FIELD(26)=$P(FIELD(25),"|",2),FIELD(25)=$P(FIELD(25),"|")
"RTN","PSJHL3",88,0)
 ..I $P(FIELD(25),"^",5)]"" S $P(FIELD(25),"^",5)=$$ESC^ORHLESC($P(FIELD(25),"^",5))
"RTN","PSJHL3",89,0)
 ..S CNT=CNT+1
"RTN","PSJHL3",90,0)
 E  S $P(FIELD(1),"^",8)=$$ESC^ORHLESC(DOSEOR)
"RTN","PSJHL3",91,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME) S FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",92,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",93,0)
 D SEGMENT2^PSJHLU
"RTN","PSJHL3",94,0)
 Q
"RTN","PSJHL3",95,0)
IVRXE ; RXE segment for IV orders
"RTN","PSJHL3",96,0)
 ; If an Inpatient Med IV order, send RXE w/dispense drug info.  
"RTN","PSJHL3",97,0)
 ; If an IV FLUID order, send start/stop date and duration in the RXE
"RTN","PSJHL3",98,0)
 ; and send an RXC for each additive and solution.
"RTN","PSJHL3",99,0)
 N ADSNODE,PSJRENEW S PSJRENEW=$$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL3",100,0)
 I RXORDER["V" S PSGPLS=$S($G(PSJEXPOE):$P(NODE1,"^",2),PSJRENEW>$P(NODE1,"^",2):PSJRENEW,1:$P(NODE1,"^",2)),PSGPLF=$S($G(PSJEXPOE):PSJEXPOE,1:$P(NODE1,"^",3))
"RTN","PSJHL3",101,0)
 E  S PSGPLS=$P(NODE2,"^",2),PSGPLF=$P(NODE2,"^",4)
"RTN","PSJHL3",102,0)
 S FIELD(1)="^"_$S(PSJORDER["IV":($P(NODE1,"^",9)_"&"_$P(NODE1,"^",11)),1:$P(NODE2,"^"))_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)_"^"_$G(P("PRY"))
"RTN","PSJHL3",103,0)
 S FIELD(21)="^"_$S(PSJORDER["IV":$P(NODE1,"^",11),1:$P(NODE2,"^",5))_"^99PSA^^^"
"RTN","PSJHL3",104,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^") S:'$G(PSJBCBU) NAME=$$ESC^ORHLESC(NAME)
"RTN","PSJHL3",105,0)
 S FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",106,0)
 N X,Y
"RTN","PSJHL3",107,0)
 I RXORDER["V" S INFUSE=$P(NODE1,"^",8)
"RTN","PSJHL3",108,0)
 E  S INFUSE=$P($G(@(PSJORDER_"8)")),"^",5)
"RTN","PSJHL3",109,0)
 I INFUSE?1N.N1" ml/hr" S FIELD(23)=+INFUSE,Y=$P(INFUSE,+INFUSE,2),Y=$$TRIM^XLFSTR(Y,"LR"," "),FIELD(24)="^^^^"_Y_"^PSU"
"RTN","PSJHL3",110,0)
 I FIELD(23)="",FIELD(24)="" S FIELD(23)=INFUSE
"RTN","PSJHL3",111,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",112,0)
 K SEGMENT I RXORDER["V" S JJ=0 F  S JJ=$O(@(PSJORDER_"5,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$S($G(PSJBCBU):$G(@(PSJORDER_"5,"_JJ_",0)")),1:$$ESC^ORHLESC($G(@(PSJORDER_"5,"_JJ_",0)"))))
"RTN","PSJHL3",113,0)
 E  S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$S($G(PSJBCBU):$G(@(PSJORDER_"12,"_JJ_",0)")),1:$G(@(PSJORDER_"12,"_JJ_",0)")))
"RTN","PSJHL3",114,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_SEGMENT(0) D
"RTN","PSJHL3",115,0)
 .D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHL3",116,0)
 ;build NTE 21 with Special Inst/Other Prt Info Wp fields     *267
"RTN","PSJHL3",117,0)
 N QQ K ^TMP("PSJBCMA5",$J)
"RTN","PSJHL3",118,0)
 D GETSIOPI^PSJBCMA5(PSJHLDFN,RXORDER,1) I ($G(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,1))["Instructions too long. See Order View or BCMA for full text"),($G(PSJORD)["P"),($G(RXORDER)["V") D
"RTN","PSJHL3",119,0)
 .N OPIAL,OPIALFLG S OPIAL=0,OPIALFLG=0 F  S OPIAL=$O(^PS(55,PSJHLDFN,"IV",+RXORDER,"A",OPIAL)) Q:'OPIAL  I ($G(^PS(55,PSJHLDFN,"IV",+RXORDER,"A",OPIAL,1,1,0))["OTHER PRINT INFO") S OPIALFLG=1
"RTN","PSJHL3",120,0)
 .Q:$P($G(^PS(55,PSJHLDFN,"IV",+RXORDER,2)),"^",8)'="N"!$G(OPIALFLG)  D GETSIOPI^PSJBCMA5(PSJHLDFN,PSJORD,1)
"RTN","PSJHL3",121,0)
 .N LINES,TEXT1 S LINES=($G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD))),TEXT1=$G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD,1))
"RTN","PSJHL3",122,0)
 .Q:LINES<1!(LINES=1&(TEXT1'["Instructions too long. See Order View or BCMA for full text"))
"RTN","PSJHL3",123,0)
 .K ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER) M ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER)=^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD) K ^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD)
"RTN","PSJHL3",124,0)
 I RXORDER["V"!(RXORDER["U") I ($G(PSJORD)["P"),($P($G(^PS(53.1,+PSJORD,0)),"^",25)=RXORDER) D
"RTN","PSJHL3",125,0)
 .D GETSIOPI^PSJBCMA5(PSJHLDFN,PSJORD,1)
"RTN","PSJHL3",126,0)
 .N LINES,TEXT1 S LINES=($G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD))),TEXT1=$G(^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD,1))
"RTN","PSJHL3",127,0)
 .Q:LINES<1!(LINES=1&(TEXT1["Instructions too long. See Order View or BCMA for full text"))
"RTN","PSJHL3",128,0)
 .K ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER) M ^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER)=^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD) K ^TMP("PSJBCMA5",$J,PSJHLDFN,PSJORD)
"RTN","PSJHL3",129,0)
 F QQ=0:0 S QQ=$O(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ)) Q:'QQ  D
"RTN","PSJHL3",130,0)
 .I QQ=1 S SEGMENT(0)="NTE|21|L|"_$$ESC^ORHLESC(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ)) S:$G(PSJBCBU) SEGMENT(0)=SEGMENT(0)_"\.br\" Q
"RTN","PSJHL3",131,0)
 .S SEGMENT(QQ-1)=$$ESC^ORHLESC(^TMP("PSJBCMA5",$J,PSJHLDFN,RXORDER,QQ))
"RTN","PSJHL3",132,0)
 .I $G(PSJBCBU) S SEGMENT(QQ-1)=SEGMENT(QQ-1)_"\.br\"
"RTN","PSJHL3",133,0)
 I RXORDER["V",'$D(SEGMENT(0)) N OPIHDR S OPIHDR=$D(^PS(55,PSJHLDFN,"IV",+RXORDER,10,0)) I $P(OPIHDR,"^",2),'$P(OPIHDR,"^",3) S SEGMENT(0)="NTE|21|L|"
"RTN","PSJHL3",134,0)
 I $D(SEGMENT(0)) D SET^PSJHLU K SEGMENT,^TMP("PSJBCMA5",$J)
"RTN","PSJHL3",135,0)
 ;end   *267
"RTN","PSJHL3",136,0)
RXC ;component segments
"RTN","PSJHL3",137,0)
 N ADDITIVE,SOLUTION,SUB,TYPE,AD,SOL,PTR,NUM,UTMP,XTMP
"RTN","PSJHL3",138,0)
 S LIMIT=24 X PSJCLEAR
"RTN","PSJHL3",139,0)
 S FIELD(0)="RXC"
"RTN","PSJHL3",140,0)
 ; In the line below, the naked reference refers to the full global reference represented in PSJORDER_TYPE...
"RTN","PSJHL3",141,0)
 ; This could be a reference to either ^PS(53.1 or ^PS(55
"RTN","PSJHL3",142,0)
 S AD="AD",SOL="SOL" F TYPE="AD","SOL" S SUB=0 F  S SUB=$O(@(PSJORDER_TYPE_","_SUB_")")) Q:SUB=""  S NODE1=$G(^(SUB,0)) Q:NODE1=""  D
"RTN","PSJHL3",143,0)
 .S FIELD(1)=$S(TYPE="AD":"A",1:"B")
"RTN","PSJHL3",144,0)
 .I FIELD(1)="A",($P(NODE1,U,3)="") S $P(NODE1,U,3)="A"
"RTN","PSJHL3",145,0)
 .S PTR=+$S(TYPE="AD":+$P($G(^PS(52.6,$P(NODE1,"^"),0)),"^",11),1:+$P($G(^PS(52.7,$P(NODE1,"^"),0)),"^",11))
"RTN","PSJHL3",146,0)
 .S FIELD(2)="^^^"_$S($G(PSJBCBU):+$P(NODE1,"^"),1:PTR)_"^"_$S($G(PSJBCBU):$S(TYPE="AD":$P($G(^PS(52.6,+$P(NODE1,"^"),0)),"^"),1:$P($G(^PS(52.7,+$P(NODE1,"^"),0)),"^")_" "_$P($G(^(0)),U,4)),1:$P($G(^PS(50.7,PTR,0)),"^"))
"RTN","PSJHL3",147,0)
 .S:(TYPE="AD"&$G(PSJBCBU)) FIELD(2)=FIELD(2)_$S($P(NODE1,"^",3)]"":" BOTTLE: "_$P(NODE1,"^",3),1:"")
"RTN","PSJHL3",148,0)
 .S FIELD(2)=FIELD(2)_"^99PSP"
"RTN","PSJHL3",149,0)
 .S FIELD(3)=$P($P(NODE1,"^",2)," ")
"RTN","PSJHL3",150,0)
 .S FIELD(4)=$P($P(NODE1,"^",2)," ",2)
"RTN","PSJHL3",151,0)
 .S FIELD(5)=$P(NODE1,"^",3)
"RTN","PSJHL3",152,0)
 .F XTMP=1:1:14 S UTMP($P("ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU^MG-PE^NANOGRAM^MMOL","^",XTMP))="PSIV-"_XTMP
"RTN","PSJHL3",153,0)
 .S NUM="" S:FIELD(4)'="" NUM=$G(UTMP(FIELD(4)))
"RTN","PSJHL3",154,0)
 .S FIELD(4)="^^^"_NUM_"^"_FIELD(4)_"^99OTH"
"RTN","PSJHL3",155,0)
 .D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",156,0)
 Q
"RTN","PSJHL3",157,0)
RXR ; med route segment
"RTN","PSJHL3",158,0)
 S LIMIT=4 X PSJCLEAR
"RTN","PSJHL3",159,0)
 S FIELD(0)="RXR"
"RTN","PSJHL3",160,0)
 I PSJORDER["IV" S FIELD(1)="^^^"_$P($G(@(PSJORDER_".2)")),"^",3) Q:$P(FIELD(1),U,4)=""  D
"RTN","PSJHL3",161,0)
 .N PSJUNITS S PSJUNITS=$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^")))
"RTN","PSJHL3",162,0)
 .S FIELD(1)=FIELD(1)_"^"_PSJUNITS_"^99PSR"
"RTN","PSJHL3",163,0)
 .S:$G(PSJBCBU) FIELD(4)="^^^"_$P($G(@(PSJORDER_"0)")),"^",4)_"^"_$$CODES^PSIVUTL($P($G(@(PSJORDER_"0)")),"^",4),55.01,.04)_"^99PSR"
"RTN","PSJHL3",164,0)
 I PSJORDER[53.1 S FIELD(1)="^^^"_$P($G(@(PSJORDER_"0)")),"^",3) Q:$P(FIELD(1),U,4)=""  D
"RTN","PSJHL3",165,0)
 .N PSJUNITS S PSJUNITS=$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^")))
"RTN","PSJHL3",166,0)
 .S FIELD(1)=FIELD(1)_"^"_PSJUNITS_"^99PSR"
"RTN","PSJHL3",167,0)
 .S:$G(PSJBCBU) FIELD(4)="^^^"_$P($G(@(PSJORDER_"0)")),"^",4)_"^"_$$CODES^PSIVUTL($P($G(@(PSJORDER_"0)")),"^",4),53.1,4)_"^99PSR"
"RTN","PSJHL3",168,0)
 S:FIELD(1)="" FIELD(1)="^^^"_$P(NODE1,"^",3)_"^"_$S($G(PSJBCBU):$P($G(^PS(51.2,+$P(NODE1,"^",3),0)),"^"),1:$$ESC^ORHLESC($P($G(^PS(51.2,+$P(NODE1,"^",3),0)),"^")))_"^99PSR"
"RTN","PSJHL3",169,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",170,0)
 Q
"RTN","PSJHL3",171,0)
ZRX ; pharmacy Z-segment
"RTN","PSJHL3",172,0)
 D ZRX^PSJHLU
"RTN","PSJHL3",173,0)
 Q
"RTN","PSJHL3",174,0)
CNT ;Count dispense drugs for an order
"RTN","PSJHL3",175,0)
 S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  S CNT=CNT+1
"RTN","PSJHL3",176,0)
 Q
"RTN","PSJHL3",177,0)
DAOC ;stores drug allergies w/sign/symptoms - psj*5*260
"RTN","PSJHL3",178,0)
 S ORL(1,1)=+ORN_"^"_PSJDAOC_"^"_DUZ_"^"_OCCDT_"^3^"
"RTN","PSJHL3",179,0)
 S ORL(1,2)="A Drug-Allergy Reaction exists for this medication and/or class"
"RTN","PSJHL3",180,0)
 D SAVEOC^OROCAPI1(.ORL,.RET)
"RTN","PSJHL3",181,0)
 S DA=$O(RET(1,0)) Q:'DA
"RTN","PSJHL3",182,0)
 S $P(^ORD(100.05,DA,0),"^",2)=6
"RTN","PSJHL3",183,0)
 S ^ORD(100.05,DA,4,0)="100.517PA^1^1"
"RTN","PSJHL3",184,0)
 S ^ORD(100.05,DA,4,1,0)=^TMP("PSODAOC",$J,1,0)
"RTN","PSJHL3",185,0)
 S ^ORD(100.05,DA,4,"B",$P(^TMP("PSODAOC",$J,1,0),"^"),1)=""
"RTN","PSJHL3",186,0)
 ;
"RTN","PSJHL3",187,0)
 I $O(^TMP("PSODAOC",$J,1,0)) F I=0:0 S I=$O(^TMP("PSODAOC",$J,1,I)) Q:'I  D
"RTN","PSJHL3",188,0)
 .S ^ORD(100.05,DA,4,1,1,0)="100.5173PA^"_I_"^"_I
"RTN","PSJHL3",189,0)
 .S ^ORD(100.05,DA,4,1,1,I,0)=^TMP("PSODAOC",$J,1,I)
"RTN","PSJHL3",190,0)
 .S ^ORD(100.05,DA,4,1,1,"B",^TMP("PSODAOC",$J,1,I),I)=""
"RTN","PSJHL3",191,0)
 ;
"RTN","PSJHL3",192,0)
 I $O(^TMP("PSODAOC",$J,2,0)) S Z=0 F I=0:0 S I=$O(^TMP("PSODAOC",$J,2,I)) Q:'I  S Z=Z+1 D
"RTN","PSJHL3",193,0)
 .S ^ORD(100.05,DA,4,1,2,0)="100.5174PA^"_Z_"^"_Z
"RTN","PSJHL3",194,0)
 .S ^ORD(100.05,DA,4,1,2,Z,0)=^TMP("PSODAOC",$J,2,I)
"RTN","PSJHL3",195,0)
 .S ^ORD(100.05,DA,4,1,2,"B",^TMP("PSODAOC",$J,2,I),Z)=""
"RTN","PSJHL3",196,0)
 ;
"RTN","PSJHL3",197,0)
 I $O(^TMP("PSODAOC",$J,3,0)) F I=0:0 S I=$O(^TMP("PSODAOC",$J,3,I)) Q:'I  D
"RTN","PSJHL3",198,0)
 .S ^ORD(100.05,DA,4,1,3,0)="100.5175PA^"_I_"^"_I
"RTN","PSJHL3",199,0)
 .S ^ORD(100.05,DA,4,1,3,I,0)=^TMP("PSODAOC",$J,3,I)
"RTN","PSJHL3",200,0)
 .S ^ORD(100.05,DA,4,1,3,"B",^TMP("PSODAOC",$J,3,I),I)=""
"RTN","PSJHL3",201,0)
 Q
"RTN","PSJLIACT")
0^19^B49301561^B42921851
"RTN","PSJLIACT",1,0)
PSJLIACT ;BIR/MV-IV ACTION ;28 Jul 98 / 8:50 AM
"RTN","PSJLIACT",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**15,47,62,58,82,97,80,110,111,134,181,247,260**;16 DEC 97;Build 94
"RTN","PSJLIACT",3,0)
 ;
"RTN","PSJLIACT",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLIACT",5,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA 2410.
"RTN","PSJLIACT",6,0)
 ;
"RTN","PSJLIACT",7,0)
DC ; Discontinue order
"RTN","PSJLIACT",8,0)
 K PSGORQF
"RTN","PSJLIACT",9,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",10,0)
 S PSJCOM=+$S(PSJORD["V":$P($G(^PS(55,DFN,"IV",+PSJORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSJORD,.2)),"^",8))
"RTN","PSJLIACT",11,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSJORD)
"RTN","PSJLIACT",12,0)
 I PSJCOM F  W !!,"Do you want to discontinue this order" S %=1 D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSJLIACT",13,0)
 I PSJCOM,%'=1 S VALMBK="" Q
"RTN","PSJLIACT",14,0)
 I $G(ON55)["P",$G(PSIVOORD) S PSJORD=ON55 ;*247 - Correct DCing newly copied orders
"RTN","PSJLIACT",15,0)
 I PSJORD["V" D DC^PSIVORA D:'$G(PSJOCFLG) EN^PSJLIORD(DFN,ON) Q
"RTN","PSJLIACT",16,0)
 D:PSJORD["P" DISCONT^PSIVORC
"RTN","PSJLIACT",17,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",18,0)
 Q
"RTN","PSJLIACT",19,0)
ACEDIT ; Display LM screen and AC and EDit actions
"RTN","PSJLIACT",20,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",21,0)
 S VALMBCK=$S($G(PSIVACEP):"Q",1:"R")
"RTN","PSJLIACT",22,0)
 Q
"RTN","PSJLIACT",23,0)
AEEXIT ; Call for EXIT CODE in PSJ LM IV AC/EDIT
"RTN","PSJLIACT",24,0)
 K PSGORQF
"RTN","PSJLIACT",25,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSJLIACT",26,0)
 I ON["P" D GT531^PSIVORFA(DFN,ON) D:P("OT")'="I" GTDATA^PSJLIFN
"RTN","PSJLIACT",27,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",28,0)
 K PSIVENO
"RTN","PSJLIACT",29,0)
 Q
"RTN","PSJLIACT",30,0)
EDIT ; Edit order
"RTN","PSJLIACT",31,0)
 K PSIVFN1 NEW PSIVNBD
"RTN","PSJLIACT",32,0)
 I $D(PSGACT),PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJLIACT",33,0)
 D EDIT1
"RTN","PSJLIACT",34,0)
 Q:$D(PSIVNBD)!($G(PSIVCOPY)&'$G(PSIVENO))
"RTN","PSJLIACT",35,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",36,0)
 S VALMBCK=$S($G(PSIVFN1):"Q",1:"R")
"RTN","PSJLIACT",37,0)
 Q
"RTN","PSJLIACT",38,0)
EDIT1 ;
"RTN","PSJLIACT",39,0)
 K PSGORQF
"RTN","PSJLIACT",40,0)
 ;Ensure P() is defined
"RTN","PSJLIACT",41,0)
 I $D(P)<10 S XQORQUIT=1,P("PON")="",PSIVNBD=1 D  Q
"RTN","PSJLIACT",42,0)
 .W !,"WARNING: An error has occurred. Changes will not be saved"
"RTN","PSJLIACT",43,0)
 .D PAUSE^VALM1
"RTN","PSJLIACT",44,0)
 .S VALMBCK="Q"
"RTN","PSJLIACT",45,0)
 I "ANP"'[P(17) W !,"You cannot edit an inactive order" D PAUSE^VALM1 Q
"RTN","PSJLIACT",46,0)
 S:$G(ON55)="" ON55=$G(PSJORD)
"RTN","PSJLIACT",47,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",48,0)
 ;* Edit a new back door order
"RTN","PSJLIACT",49,0)
 I ($G(ON55)["V"&($G(P("21FLG"))="")) D  Q
"RTN","PSJLIACT",50,0)
 . D GSTRING^PSIVORE1,GTFLDS^PSIVORFE
"RTN","PSJLIACT",51,0)
 . I $G(ON55)["V",'$G(DONE) D OK^PSIVORE
"RTN","PSJLIACT",52,0)
 . S VALMBCK="Q",PSIVNBD=1
"RTN","PSJLIACT",53,0)
 ;* Edit an active order
"RTN","PSJLIACT",54,0)
 I $G(ON55)["V" NEW PSJEDIT1 D E^PSIVOPT1 D  Q
"RTN","PSJLIACT",55,0)
 . I $G(PSJIVBD) K PSJIVBD D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",56,0)
 I $G(ON55)["P" D EDIT^PSIVORC ;Edit incomplete order.
"RTN","PSJLIACT",57,0)
 K P("OVRIDE")
"RTN","PSJLIACT",58,0)
 Q
"RTN","PSJLIACT",59,0)
ACCEPT ; Accept order
"RTN","PSJLIACT",60,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",61,0)
 ;Accept IV from back door.
"RTN","PSJLIACT",62,0)
 I $G(PSJIVBD) K PSJIVBD D OK^PSIVORE S VALMBCK="Q" Q
"RTN","PSJLIACT",63,0)
 ;D:'$G(PSGORQF) IN^PSJOCDS($G(ON),"IV","") Q:$G(PSGORQF)
"RTN","PSJLIACT",64,0)
 I ON["V" D ACCEPT^PSIVOPT1 Q
"RTN","PSJLIACT",65,0)
 S PSIVFN1=1
"RTN","PSJLIACT",66,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIACT",67,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",68,0)
 Q
"RTN","PSJLIACT",69,0)
R ; Renewal
"RTN","PSJLIACT",70,0)
 K PSGORQF
"RTN","PSJLIACT",71,0)
 S PSJREN=1
"RTN","PSJLIACT",72,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",73,0)
 NEW PSIVAC S PSIVAC="PR" K PSGFDX
"RTN","PSJLIACT",74,0)
 D R^PSIVOPT
"RTN","PSJLIACT",75,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",76,0)
 K PSJREN
"RTN","PSJLIACT",77,0)
 Q
"RTN","PSJLIACT",78,0)
H ; Hold
"RTN","PSJLIACT",79,0)
 K PSGORQF
"RTN","PSJLIACT",80,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",81,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",82,0)
 D H^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",83,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",84,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",85,0)
 Q
"RTN","PSJLIACT",86,0)
L ; Activity Log
"RTN","PSJLIACT",87,0)
 NEW PSIVLAB,PSIVLOG,PSJHIS S (PSIVLAB,PSIVLOG)=1
"RTN","PSJLIACT",88,0)
 D EN^PSIVVW1
"RTN","PSJLIACT",89,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",90,0)
 S VALMBCK="R"
"RTN","PSJLIACT",91,0)
 Q
"RTN","PSJLIACT",92,0)
O ; On Call
"RTN","PSJLIACT",93,0)
 K PSGORQF
"RTN","PSJLIACT",94,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",95,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",96,0)
 D O^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",97,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",98,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",99,0)
 Q
"RTN","PSJLIACT",100,0)
VF ; Make the order active **ENHANCEMENTS MADE IN PSJ*5.0*260
"RTN","PSJLIACT",101,0)
 NEW PSIVCHG,PSGORQF,PSJVFF S PSIVCHG=0
"RTN","PSJLIACT",102,0)
 IF VALM("TITLE")="ACTIVE IV " W !!,">>>  Verify may not be selected at this point." D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSJLIACT",103,0)
 ELSE  IF $G(PSGSTAT)="NON-VERIFIED",$G(PSJNEWOE)=0 S PSJVFF=1 D EN^PSJGMRA($G(DFN),$G(PSGPD)),IN^PSJOCDS($G(PSGORD),"IV",""),OC^PSIVOC K PSJVFF Q:$G(PSGORQF)
"RTN","PSJLIACT",104,0)
 ELSE  IF '$G(PSGORQF),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",105,0)
 ELSE  IF $G(PSIVFN1),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",106,0)
 ELSE  IF $G(PSGDEF),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",107,0)
 ELSE  IF $G(PSIVCOPY),(ON["V") S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",108,0)
 D ACTIVE^PSIVORC2
"RTN","PSJLIACT",109,0)
 Q
"RTN","PSJLIACT",110,0)
VF1(PSIVREA,PSIVAL,PSIVLOG) ;
"RTN","PSJLIACT",111,0)
 ;Update 4 node and set activity log.
"RTN","PSJLIACT",112,0)
 ;PSIVREA: the reason use by LOG^PSIVORAL
"RTN","PSJLIACT",113,0)
 ;PSIVAL : the description reason
"RTN","PSJLIACT",114,0)
 ;PSIVLOG: Log an activity if = 1
"RTN","PSJLIACT",115,0)
 K PSGORQF
"RTN","PSJLIACT",116,0)
 I '+$G(OD)!($L($G(OD))>16) K OD
"RTN","PSJLIACT",117,0)
 D:+PSJSYSU=3 ^PSIVORE1
"RTN","PSJLIACT",118,0)
 NEW DIE,DA,DR,PSJX,XX,PSIVACT,PSJRQND
"RTN","PSJLIACT",119,0)
 S PSIVACT=1
"RTN","PSJLIACT",120,0)
 S PSJX=$G(^PS(55,DFN,"IV",+ON55,4)),XX=""
"RTN","PSJLIACT",121,0)
 I $P(PSJX,U)="" S XX=";143////0"
"RTN","PSJLIACT",122,0)
 I $P(PSJX,U,4)="" S XX=XX_U_";142////0"
"RTN","PSJLIACT",123,0)
 D NOW^%DTC
"RTN","PSJLIACT",124,0)
 S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",125,0)
 I +PSJSYSU=3 S DR="140////"_DUZ_";141////"_$E(%,1,12)_";142////1"_$P(XX,U)
"RTN","PSJLIACT",126,0)
 I +PSJSYSU=1 S DR="16////"_DUZ_";17////"_$E(%,1,12)_";143////1"_$P(XX,U,2)
"RTN","PSJLIACT",127,0)
 I $G(P("PRY"))="D" S DR=DR_";.22////"_+P("IVRM")
"RTN","PSJLIACT",128,0)
 D ^DIE
"RTN","PSJLIACT",129,0)
 ; If pending IV renew is edited during finish, go back and DE the original active order left in RENEWED status
"RTN","PSJLIACT",130,0)
 S PREREN=$S(ON55["V":$G(@(DIE_"+ON55,2)")),1:""),PREREN=$P(PREREN,"^",5) I PREREN D  K PREREN
"RTN","PSJLIACT",131,0)
 . I PREREN["P" S PREREN=$G(@("^PS(53.1,+PREREN,0)")),PREREN=$P(PREREN,"^",25)
"RTN","PSJLIACT",132,0)
 . I PREREN["V" N PRERENOD S PRERENOD=$G(@("^PS(55,DFN,""IV"",+PREREN,0)")) I $P(PRERENOD,"^",17)="R",($G(P("RES"))="E") D
"RTN","PSJLIACT",133,0)
 ..  S DIE="^PS(55,"_DFN_",""IV"",",DA=+PREREN,DA(1)=DFN
"RTN","PSJLIACT",134,0)
 ..  S DR="100////D;.03////"_PSGDT S ORIGSTOP=$P($G(@("^PS(55,DFN,""IV"",+PREREN,2)")),"^",3) I ORIGSTOP S DR=DR_";116////"_ORIGSTOP
"RTN","PSJLIACT",135,0)
 ..  D ^DIE D EN1^PSJHL2(DFN,"SC",PREREN)
"RTN","PSJLIACT",136,0)
 K DR,DIE,DA
"RTN","PSJLIACT",137,0)
 I (+PSJSYSU=3)&($G(P("PRY"))="D") D
"RTN","PSJLIACT",138,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJLIACT",139,0)
 .Q:Y="N"
"RTN","PSJLIACT",140,0)
 .D MAIN^TIUEDIT(3,.TIUDA,DFN,"","","","",1)
"RTN","PSJLIACT",141,0)
 Q:'$G(PSIVLOG)
"RTN","PSJLIACT",142,0)
 I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D
"RTN","PSJLIACT",143,0)
 . NEW DIC,DA,X,Y,XX,DO D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJLIACT",144,0)
 . S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJLIACT",145,0)
 . S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJLIACT",146,0)
 . S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJLIACT",147,0)
 . D FILE^DICN
"RTN","PSJLIACT",148,0)
 NEW PSIVALCK
"RTN","PSJLIACT",149,0)
 S PSIVREA="V",PSIVALT=""
"RTN","PSJLIACT",150,0)
 S PSIVAL=PSIVAL_$S(+PSJSYSU=3:"PHARMACIST",1:"NURSE")
"RTN","PSJLIACT",151,0)
 D LOG^PSIVORAL K PSIVAL,PSIVREA,PSIVLN
"RTN","PSJLIACT",152,0)
 I $G(PSJORD)["P" S PSIVREA="V",PSIVALT="",PSGRDTX=$G(^PS(53.1,+PSJORD,2.5)) D
"RTN","PSJLIACT",153,0)
 . I $G(PSGRDTX) S PSIVAL="Requested Start Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U))) D LOG^PSIVORAL
"RTN","PSJLIACT",154,0)
 . I $P(PSGRDTX,U,3) S PSIVREA="V",PSIVALT="" S PSIVAL="Requested Stop Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U,3))) D LOG^PSIVORAL
"RTN","PSJLIACT",155,0)
 N DUR I $G(PSJORD) S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S(PSJORD["P":"P",1:"IV"),1) I DUR]""  D
"RTN","PSJLIACT",156,0)
 . K DR S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",157,0)
 . S DR=$S($G(IVLIMIT):"152////"_DUR,1:"151////"_DUR) K IVLIMIT
"RTN","PSJLIACT",158,0)
 . D ^DIE
"RTN","PSJLIACT",159,0)
 D EN1^PSJHL2(DFN,"SC",ON55)
"RTN","PSJLIACT",160,0)
 D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSJLIACT",161,0)
 D GT55^PSIVORFB S OLDON=$P($G(^PS(55,DFN,"IV",+ON55,2)),"^",5),P("OLDON")=OLDON
"RTN","PSJLIACT",162,0)
 N PSJPRIO,PSJSCH,NODE0,NODEP2 S NODE0=$G(^PS(55,DFN,"IV",+ON55,0)),NODEP2=$G(^PS(55,DFN,"IV",+ON55,.2))
"RTN","PSJLIACT",163,0)
 S PSJPRIO=$P(NODEP2,"^",4),PSJSCH=$P(NODE0,"^",9)
"RTN","PSJLIACT",164,0)
 I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCH)="NOW")!($G(PSJSCH)["STAT") D NOTIFY^PSJHL4(ON55,DFN,$G(PSJPRIO),$G(PSJSCH))
"RTN","PSJLIACT",165,0)
 Q
"RTN","PSJLMHED")
0^12^B50472528^B30170338
"RTN","PSJLMHED",1,0)
PSJLMHED ;BIR/MLM-BUILD LM HEADERS ;28 Jan 98 / 2:18 PM
"RTN","PSJLMHED",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**4,58,85,110,148,181,260**;16 DEC 97;Build 94
"RTN","PSJLMHED",3,0)
 ;
"RTN","PSJLMHED",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMHED",5,0)
 ; Reference to CWAD^ORQPT2 is supported by DBIA 2831.
"RTN","PSJLMHED",6,0)
 ; Reference to ^SC is supported by DBIA 10040.
"RTN","PSJLMHED",7,0)
 ;External reference to $$BSA^PSSDSAPI supported by DBIA 5425.
"RTN","PSJLMHED",8,0)
 ;External reference to ^ORQQVI supported by DBIA 5770.
"RTN","PSJLMHED",9,0)
 ;External reference to ^ORQPTQ4 supported by DBIA 5785.
"RTN","PSJLMHED",10,0)
 ;External reference to ^ORB31 supported by DBIA 5140.
"RTN","PSJLMHED",11,0)
 ;External reference to ^ORQQLR1 supported by DBIA 5787.
"RTN","PSJLMHED",12,0)
 ;
"RTN","PSJLMHED",13,0)
HDR(DFN) ; -- list screen header
"RTN","PSJLMHED",14,0)
 ;   input:       DFN := ifn of pat
"RTN","PSJLMHED",15,0)
 ;  output:  VALMHDR() := hdr array
"RTN","PSJLMHED",16,0)
 ;
"RTN","PSJLMHED",17,0)
 K VAIN,VADM,GMRA,PSJACNWP,PSJ,VAERR,VA,X
"RTN","PSJLMHED",18,0)
 S PSJACNWP=1 D ENBOTH^PSJAC
"RTN","PSJLMHED",19,0)
 D HDRO(DFN)
"RTN","PSJLMHED",20,0)
 S PSJ="   Sex: "_$P(PSJPSEX,U,2),VALMHDR(4)=$$SETSTR^VALM1($S(PSJPDD:"Last ",1:"     ")_"Admitted: "_$P(PSJPAD,U,2),PSJ,45,23)
"RTN","PSJLMHED",21,0)
 S PSJ="    Dx: "_PSJPDX
"RTN","PSJLMHED",22,0)
 S:PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Discharged: "_$E($P(PSJPDD,U,2),1,8),PSJ,48,26)
"RTN","PSJLMHED",23,0)
 S:'PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Last transferred: "_$$ENDTC^PSGMI(PSJPTD),PSJ,42,26)
"RTN","PSJLMHED",24,0)
 S PSJBSA=$$BSA^PSSDSAPI(DFN),PSJBSA=$P(PSJBSA,"^",3),PSJBSA=$S(PSJBSA'>0:"__________",1:$J(PSJBSA,4,2))
"RTN","PSJLMHED",25,0)
 S RSLT=$$CRCL(DFN)
"RTN","PSJLMHED",26,0)
 I $P(RSLT,"^",2)["Not Found" S ZDSPL="  CrCL: "_$P(RSLT,"^",2)
"RTN","PSJLMHED",27,0)
 E  S ZDSPL=" CrCL: "_$P($G(RSLT),"^",2)_"(est.) "_"(CREAT:"_$P($G(RSLT),"^",3)_"mg/dL "_$P($G(RSLT),"^")_")"
"RTN","PSJLMHED",28,0)
 S PSJDB=$G(ZDSPL),VALMHDR(6)=$$SETSTR^VALM1("BSA (m2): "_$G(PSJBSA),PSJDB,50,23) K PSJBSA
"RTN","PSJLMHED",29,0)
 Q
"RTN","PSJLMHED",30,0)
 ; 
"RTN","PSJLMHED",31,0)
HDRO(DFN) ; Standardized part of profile header.
"RTN","PSJLMHED",32,0)
 N PSJCLIN,PSJAPPT,PSJCLINN,RMORDT S (PSJCLIN,PSJAPPT)=0,(RMORDAT,PSJCLINN)="" I $G(PSJORD) D
"RTN","PSJLMHED",33,0)
 . S PSJCLIN=$S($G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,"DSS")),$G(PSJORD)["U":$G(^PS(55,DFN,5,+PSJORD,8)),$G(PSJORD)["P":$G(^PS(53.1,+PSJORD,"DSS")),1:"")
"RTN","PSJLMHED",34,0)
 . S:PSJCLIN PSJAPPT=$P($G(PSJCLIN),U,2) I PSJCLIN,PSJAPPT S PSJCLINN=$P($G(^SC(+PSJCLIN,0)),U)
"RTN","PSJLMHED",35,0)
 K VALMHDR I PSJCLINN]"" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1("   Clinic: "_PSJCLINN,PSJ,28,26)
"RTN","PSJLMHED",36,0)
 I PSJCLINN="" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1($S('PSJPDD:"     ",1:"Last ")_"Ward: "_PSJPWDN,PSJ,30,18)
"RTN","PSJLMHED",37,0)
 S X=$$CWAD^ORQPT2(DFN)
"RTN","PSJLMHED",38,0)
 S:X]"" X=IORVON_X_IORVOFF,PSJ=$$SETSTR^VALM1(X,PSJ,80-$L(X),80) S VALMHDR(1)=PSJ
"RTN","PSJLMHED",39,0)
 S PSJ="   PID: "_$P(PSJPSSN,U,2)
"RTN","PSJLMHED",40,0)
 S RMORDT=$S($G(PSJPDD):"Last ",1:"     ")_"Room-Bed: "_$G(PSJPRB)
"RTN","PSJLMHED",41,0)
 I PSJCLINN]"",PSJAPPT S RMORDT="Clinic Date: "_$$ENDTC^PSGMI(PSJAPPT),RMORDT=$P(RMORDT,"  ")_" "_$P(RMORDT,"  ",2)
"RTN","PSJLMHED",42,0)
 S PSJ=$$SETSTR^VALM1(RMORDT,PSJ,26,28),VALMHDR(2)=$$SETSTR^VALM1("Ht(cm): "_PSJPHT_" "_PSJPHTD,PSJ,55,25)
"RTN","PSJLMHED",43,0)
 S PSJ="   DOB: "_$P($P(PSJPDOB,U,2)," ")_" ("_PSJPAGE_")",VALMHDR(3)=$$SETSTR^VALM1("Wt(kg): "_PSJPWT_" "_PSJPWTD,PSJ,55,25)
"RTN","PSJLMHED",44,0)
 Q
"RTN","PSJLMHED",45,0)
 ;
"RTN","PSJLMHED",46,0)
INIT(PSJPROT) ; -- init bld vars
"RTN","PSJLMHED",47,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJLMHED",48,0)
 K PSJUDPRF,^TMP("PSJ",$J),^TMP("PSJON",$J),^TMP("PSJPRO",$J)
"RTN","PSJLMHED",49,0)
 S:PSJPROT=1 PSJUDPRF=1
"RTN","PSJLMHED",50,0)
 D KILL^VALM10(),EN^PSJO1(PSJPROT)
"RTN","PSJLMHED",51,0)
 I '$D(^TMP("PSJ",$J)) W !!,?22,"NO ORDERS FOUND FOR "_$S(PSJOL="S":"SHORT",1:"LONG")_" PROFILE." S VALMQUIT=1 D PAUSE^PSJLMUTL Q
"RTN","PSJLMHED",52,0)
 S PSJTF=0,PSJLN=1,PSJEN=1,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""  D
"RTN","PSJLMHED",53,0)
 .S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJLMHED",54,0)
 .I PSJTF'=$E(PSJC,1)!(PSJC="CC")!(PSJC="CD")!(PSJC="BD") Q:PSJC="CB"  Q:PSJC="O"  Q:PSJC="DF"  D TF S PSJTF=$E(PSJC,1)    ;DAM 8-29-07 Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJLMHED",55,0)
 .S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",56,0)
 .. S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""  Q:PSJC="CB"  Q:PSJC="O"  Q:PSJC="DF"  D ON      ;DAM 8-29-07  Added Q:PSJC="CB"  Q:PSJC="O"
"RTN","PSJLMHED",57,0)
 .;
"RTN","PSJLMHED",58,0)
 .;DAM 8-29-07   New code to place Pending Orders after Pending Renewal Orders on the roll and scroll display.  Non-Active Orders appear last.
"RTN","PSJLMHED",59,0)
 S PSJTF=0,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""  D
"RTN","PSJLMHED",60,0)
 . S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",PSJC="DF":"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJLMHED",61,0)
 . I PSJC="CB" D TF S PSJTF=$E(PSJC,1)                            ;These are Pending Orders
"RTN","PSJLMHED",62,0)
 . I PSJC="CB" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",63,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJLMHED",64,0)
 . I PSJC="DF" D TF S PSJTF=$E(PSJC,1)                              ;These are recently DC Orders (mv)
"RTN","PSJLMHED",65,0)
 . I PSJC="DF" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",66,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJLMHED",67,0)
 . I PSJC="O" D TF S PSJTF=$E(PSJC,1)                              ;These are Non-Active Orders
"RTN","PSJLMHED",68,0)
 . I PSJC="O" S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",69,0)
 . . S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""   D ON
"RTN","PSJLMHED",70,0)
 .; END DAM changes
"RTN","PSJLMHED",71,0)
 .;
"RTN","PSJLMHED",72,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMHED",73,0)
DONE ;
"RTN","PSJLMHED",74,0)
 K PSJC,PSJEN,PSJLN,PSJST,PSJS,CNT,PSJPRI
"RTN","PSJLMHED",75,0)
 Q
"RTN","PSJLMHED",76,0)
 ;
"RTN","PSJLMHED",77,0)
ON ;
"RTN","PSJLMHED",78,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJLMHED",79,0)
 S PSJO="" F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO)   D
"RTN","PSJLMHED",80,0)
 .N PRJPRI S PSJPRI=$S(PSJO["V":$P($G(^PS(55,PSGP,"IV",+PSJO,.2)),"^",4),PSJO["U":$P($G(^PS(55,PSGP,5,+PSJO,.2)),"^",4),1:$P($G(^PS(53.1,+PSJO,.2)),"^",4))
"RTN","PSJLMHED",81,0)
 .S ^TMP("PSJON",$J,PSJEN)=PSJO,PSJL=$J(PSJEN,4) D @$S(PSJO["V":"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)",PSJO["U":"PUD^PSJLMPRU(PSGP,PSJO,PSJF,DN)",1:"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)") S ^TMP("PSJPRO",$J,0)=PSJEN,PSJEN=PSJEN+1
"RTN","PSJLMHED",82,0)
 Q
"RTN","PSJLMHED",83,0)
 ;
"RTN","PSJLMHED",84,0)
TF ; Set up order type header
"RTN","PSJLMHED",85,0)
 NEW PSJDFHDR
"RTN","PSJLMHED",86,0)
 I $D(^TMP("PSJ",$J,PSJC)) D
"RTN","PSJLMHED",87,0)
 .S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSJLMHED",88,0)
 .S PSJDFHDR="RECENTLY DISCONTINUED/EXPIRED (LAST "_+$G(PSJDCEXP)_" HOURS)"
"RTN","PSJLMHED",89,0)
 .N C,X,Y S C=PSJC,Y="",$P(Y," -",40)=""
"RTN","PSJLMHED",90,0)
 .S X=$S(C="A":$$TXT^PSJO("A"),C["CC":$$TXT^PSJO("PR"),C["CD":$$TXT^PSJO("PC"),C["C":$$TXT^PSJO("P"),C["BD":$$TXT^PSJO("NC"),C["B":$$TXT^PSJO("N"),C["DF":PSJDFHDR,1:$$TXT^PSJO("NA"))
"RTN","PSJLMHED",91,0)
 .S ^TMP("PSJPRO",$J,PSJLN,0)=$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80),PSJLN=PSJLN+1
"RTN","PSJLMHED",92,0)
 Q
"RTN","PSJLMHED",93,0)
TEST ;
"RTN","PSJLMHED",94,0)
 N X,Y S Y="",$P(Y," -",40)=""
"RTN","PSJLMHED",95,0)
 F X="A C T I V E","P E N D I N G   R E N E W A L S","P E N D I N G ","N O N - V E R I F I E D","N O N - A C T I V E" W !,$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80)
"RTN","PSJLMHED",96,0)
 Q
"RTN","PSJLMHED",97,0)
CRCL(DFN) ;
"RTN","PSJLMHED",98,0)
 N HTGT60,ABW,IBW,BWRATIO,BWDIFF,LOWBW,ADJBW,X1,X2,RSLT,PSCR,PSRW,ABW,ZHT,PSRH,PSCXTL,PSCXTLS,SCR,OCXT,OCXTS,SCRV,ZAGE,SEX
"RTN","PSJLMHED",99,0)
 S RSLT="0^<Not Found>"
"RTN","PSJLMHED",100,0)
 S PSCR="^^^^^^0"
"RTN","PSJLMHED",101,0)
 D VITAL^ORQQVI("WEIGHT","WT",DFN,.PSRW,0,"",$$NOW^XLFDT)
"RTN","PSJLMHED",102,0)
 Q:'$D(PSRW) RSLT
"RTN","PSJLMHED",103,0)
 S ABW=$P(PSRW(1),U,3) Q:+$G(ABW)<1 RSLT
"RTN","PSJLMHED",104,0)
 S ABW=ABW/2.2  ;ABW (actual body weight) in kg
"RTN","PSJLMHED",105,0)
 D VITAL^ORQQVI("HEIGHT","HT",DFN,.PSRH,0,"",$$NOW^XLFDT)
"RTN","PSJLMHED",106,0)
 Q:'$D(PSRH) RSLT
"RTN","PSJLMHED",107,0)
 S ZHT=$P(PSRH(1),U,3) Q:+$G(ZHT)<1 RSLT
"RTN","PSJLMHED",108,0)
 S ZAGE=$$AGE^ORQPTQ4(DFN) Q:'ZAGE RSLT
"RTN","PSJLMHED",109,0)
 S SEX=$P($$SEX^ORQPTQ4(DFN),U,1) Q:'$L(SEX) RSLT
"RTN","PSJLMHED",110,0)
 S PSCXTL="" Q:'$$TERMLKUP^ORB31(.PSCXTL,"SERUM CREATININE") RSLT
"RTN","PSJLMHED",111,0)
 S PSCXTLS="" Q:'$$TERMLKUP^ORB31(.PSCXTLS,"SERUM SPECIMEN") RSLT
"RTN","PSJLMHED",112,0)
 S SCR="",OCXT=0 F  S OCXT=$O(PSCXTL(OCXT)) Q:'OCXT  D
"RTN","PSJLMHED",113,0)
 .S OCXTS=0 F  S OCXTS=$O(PSCXTLS(OCXTS)) Q:'OCXTS  D
"RTN","PSJLMHED",114,0)
 ..S SCR=$$LOCL^ORQQLR1(DFN,$P(PSCXTL(OCXT),U),$P(PSCXTLS(OCXTS),U))
"RTN","PSJLMHED",115,0)
 ..I $P(SCR,U,7)>$P(PSCR,U,7) S PSCR=SCR
"RTN","PSJLMHED",116,0)
 S SCR=PSCR,SCRV=$P(SCR,U,3) Q:+$G(SCRV)<.01 RSLT
"RTN","PSJLMHED",117,0)
 S SCRD=$P(SCR,U,7) Q:'$L(SCRD) RSLT
"RTN","PSJLMHED",118,0)
 ;
"RTN","PSJLMHED",119,0)
 S HTGT60=$S(ZHT>60:(ZHT-60)*2.3,1:0)  ;if ht > 60 inches
"RTN","PSJLMHED",120,0)
 I HTGT60>0 D
"RTN","PSJLMHED",121,0)
 .S IBW=$S(SEX="M":50+HTGT60,1:45.5+HTGT60)  ;Ideal Body Weight
"RTN","PSJLMHED",122,0)
 .S BWRATIO=(ABW/IBW)  ;body weight ratio
"RTN","PSJLMHED",123,0)
 .S BWDIFF=$S(ABW>IBW:ABW-IBW,1:0)
"RTN","PSJLMHED",124,0)
 .S LOWBW=$S(IBW<ABW:IBW,1:ABW)
"RTN","PSJLMHED",125,0)
 .I BWRATIO>1.3,(BWDIFF>0) S ADJBW=((0.3*BWDIFF)+IBW)
"RTN","PSJLMHED",126,0)
 .E  S ADJBW=LOWBW
"RTN","PSJLMHED",127,0)
 I +$G(ADJBW)<1 D
"RTN","PSJLMHED",128,0)
 .S ADJBW=ABW
"RTN","PSJLMHED",129,0)
 S CRCL=(((140-ZAGE)*ADJBW)/(SCRV*72))
"RTN","PSJLMHED",130,0)
 ;
"RTN","PSJLMHED",131,0)
 S:SEX="M" RSLT=SCRD_U_$J(CRCL,1,1)
"RTN","PSJLMHED",132,0)
 S:SEX="F" RSLT=SCRD_U_$J((CRCL*.85),1,1)
"RTN","PSJLMHED",133,0)
 S X1=$P(RSLT,"^"),X2=$$FMTE^XLFDT(X1,"2M"),$P(RSLT,"^")=$P(X2,"@") K X1,X2
"RTN","PSJLMHED",134,0)
 S $P(RSLT,"^",3)=$P($G(SCR),"^",3)
"RTN","PSJLMHED",135,0)
 K HTGT60,ABW,IBW,BWRATIO,BWDIFF,LOWBW,ADJBW,X1,X2,PSCR,PSRW,ABW,ZHT,PSRH,ZAGE,PSCXTL,PSCXTLS,SCR,OCXT,OCXTS,SCRV,CRCL
"RTN","PSJLMHED",136,0)
 Q RSLT
"RTN","PSJOC")
0^5^B27066758^B19432161
"RTN","PSJOC",1,0)
PSJOC ;BIR/MV - NEW ORDER CHECKS DRIVER ;6 Jun 07 / 3:37 PM
"RTN","PSJOC",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**181,260**;16 DEC 97;Build 94
"RTN","PSJOC",3,0)
 ;
"RTN","PSJOC",4,0)
 ; Reference to ^PSODDPR4 is supported by DBIA# 5366.
"RTN","PSJOC",5,0)
 ; Reference to ^PSSHRQ2 is supported by DBIA# 5369.
"RTN","PSJOC",6,0)
 ;
"RTN","PSJOC",7,0)
OC(PSPDRG,PSJPTYP) ;
"RTN","PSJOC",8,0)
 ;PSPDRG - Drug array in format of PDRG(n)=IEN (#50) ^ Drug Name
"RTN","PSJOC",9,0)
 ;Where n is a sequential number.  The Drug Name can be OI, Generic name form #50, or Add/Sol name
"RTN","PSJOC",10,0)
 ;PSJPTYP - P1 ; P2
"RTN","PSJOC",11,0)
 ; Where P1 is "I" for Inpatient, "O" for Outpatient
"RTN","PSJOC",12,0)
 ;       P2 is the Inpatient Order Number (for PSJ use only)
"RTN","PSJOC",13,0)
 ;PSJOCERR(DRUG NAME)="Reason text". Where Drug Name can be either OI name or AD/SOL name.
"RTN","PSJOC",14,0)
 NEW PSJOCERR
"RTN","PSJOC",15,0)
 ;Quit OC if FDB link is down.  PSGORQF is defined if user wish to stop the order process
"RTN","PSJOC",16,0)
 I $$SYS^PSJOCERR() Q
"RTN","PSJOC",17,0)
 ;
"RTN","PSJOC",18,0)
 I $D(PSJDGCK) W !!,"Building MEDS profile please wait...",!
"RTN","PSJOC",19,0)
 D BLD^PSODDPR4(DFN,"PSJPRE",.PSPDRG,PSJPTYP)
"RTN","PSJOC",20,0)
 D DISPLAY
"RTN","PSJOC",21,0)
 K ^TMP($J,"PSJPRE")
"RTN","PSJOC",22,0)
 Q
"RTN","PSJOC",23,0)
DISPLAY ;
"RTN","PSJOC",24,0)
 NEW PSJPAUSE,PSJOLDSV,PSJDNM,PSJMON,PSJOC,PSJOCDT,PSJOCDTL,PSJOCLST,PSJP,PSJS,PSJPON,PSJDN,PSJSEV,PSJECNT
"RTN","PSJOC",25,0)
 D GMRAOC
"RTN","PSJOC",26,0)
 Q:'$$DSPSERR()
"RTN","PSJOC",27,0)
 D FULL^VALM1
"RTN","PSJOC",28,0)
 W @IOF,"Now Processing Enhanced Order Checks!  Please wait...",!
"RTN","PSJOC",29,0)
 ; If there are no OC or errors to display, this var will trigger a pause before continue /w the order
"RTN","PSJOC",30,0)
 S PSJPAUSE=1
"RTN","PSJOC",31,0)
 D DRUGERR
"RTN","PSJOC",32,0)
 I $D(PSJDGCK) W:'$D(^TMP($J,"PSJPRE","OUT","DRUGDRUG"))&'$D(^TMP($J,"PSJPRE","OUT","THERAPY",1)) !,"No Order Check Warnings Found",!
"RTN","PSJOC",33,0)
 ;Process drug interaction & drug interception
"RTN","PSJOC",34,0)
 D DI^PSJOCDI
"RTN","PSJOC",35,0)
 Q:$G(PSGORQF)
"RTN","PSJOC",36,0)
 D DSPERR^PSJOCERR("DRUGDRUG")
"RTN","PSJOC",37,0)
 ;Process duplicate therapy order checks
"RTN","PSJOC",38,0)
 D:'$D(PSJDGCK) DT^PSJOCDT
"RTN","PSJOC",39,0)
 I $D(PSJDGCK) D:$D(^TMP($J,"PSJPRE","OUT","THERAPY")) DTDGCK^PSJOCDT
"RTN","PSJOC",40,0)
 D:'$G(PSGORQF) DSPERR^PSJOCERR("THERAPY")
"RTN","PSJOC",41,0)
 I $D(PSJDGCK),'$D(^TMP($J,"PSJPRE","OUT","THERAPY")) D PAUSE^PSJLMUT1 Q  ;DX action
"RTN","PSJOC",42,0)
 Q:$G(PSGORQF)
"RTN","PSJOC",43,0)
 D:$G(PSJPAUSE) PAUSE^PSJLMUT1
"RTN","PSJOC",44,0)
 Q
"RTN","PSJOC",45,0)
 ;
"RTN","PSJOC",46,0)
GMRAOC ;Display allergy & CPRS OC regardless if FDB is connected
"RTN","PSJOC",47,0)
 D ALLERGY
"RTN","PSJOC",48,0)
 D CPRS^PSJOCOR(.PSPDRG)
"RTN","PSJOC",49,0)
 Q
"RTN","PSJOC",50,0)
ALLERGY ;Do allergy order check
"RTN","PSJOC",51,0)
 ;The allergy check will be processed for each of the dispense drug stores in the PSJALLGY array
"RTN","PSJOC",52,0)
 ;PSJALLGY(X)="" Where X is the disp drug IEN.  PSJALLGY array store all dispense drugs use in an order
"RTN","PSJOC",53,0)
 ;
"RTN","PSJOC",54,0)
 I '$D(PSJDGCK) D
"RTN","PSJOC",55,0)
 .NEW PSJDD
"RTN","PSJOC",56,0)
 .F PSJDD=0:0 S PSJDD=$O(PSJALLGY(PSJDD)) Q:'PSJDD  D EN^PSJGMRA(DFN,PSJDD)
"RTN","PSJOC",57,0)
 I $D(PSJDGCK) D
"RTN","PSJOC",58,0)
 .S PSJXX="" S PSJYY=1
"RTN","PSJOC",59,0)
 .F  S PSJXX=$O(^TMP($J,"PSJPRE","IN","PROSPECTIVE",PSJXX)) Q:PSJXX=""  D
"RTN","PSJOC",60,0)
 ..S PSJALLGY(PSJYY,$P(^TMP($J,"PSJPRE","IN","PROSPECTIVE",PSJXX),U,3))=""
"RTN","PSJOC",61,0)
 ..S PSJYY=PSJYY+1
"RTN","PSJOC",62,0)
 .F PSJDD=0:0 S PSJDD=$O(PSJALLGY(PSJDD)) Q:'PSJDD  F PSJCC=0:0 S PSJCC=$O(PSJALLGY(PSJDD,PSJCC)) Q:'PSJCC  D EN^PSJGMRA(DFN,PSJCC)
"RTN","PSJOC",63,0)
 K PSJXX,PSJYY,PSJDD,PSJCC,PSJALLGY
"RTN","PSJOC",64,0)
 Q
"RTN","PSJOC",65,0)
DSPORD(ON,PSJNLST,PSJCLINF) ;Display the order data
"RTN","PSJOC",66,0)
 ;ON - ON_U/V/P ex: 21V
"RTN","PSJOC",67,0)
 ;PSJNLST - It's number list and also use to trigger pg break, line break
"RTN","PSJOC",68,0)
 NEW PSJCOL,PSJX,PSJOC,PSJLINE,X
"RTN","PSJOC",69,0)
 Q:ON=""
"RTN","PSJOC",70,0)
 S:'$D(PSJCLINF) PSJCLINF=";0"
"RTN","PSJOC",71,0)
 S PSJLINE=1,PSJCOL=1
"RTN","PSJOC",72,0)
 I $P(PSJCLINF,";",2) D CLNDISP^PSJCLNOC(.PSJCLINF) D  Q
"RTN","PSJOC",73,0)
 .I $G(PSJNLST)="",(($Y+6)>IOSL) D PAUSE^PSJLMUT1 W @IOF
"RTN","PSJOC",74,0)
 I ON'["V" D DSPLORDU^PSJLMUT1(DFN,ON)
"RTN","PSJOC",75,0)
 I ON["V" D DSPLORDV^PSJLMUT1(DFN,ON)
"RTN","PSJOC",76,0)
 F PSJX=0:0 S PSJX=$O(PSJOC(ON,PSJX)) Q:'PSJX  D
"RTN","PSJOC",77,0)
 . I $G(PSJNLST)="",(($Y+6)>IOSL) D PAUSE^PSJLMUT1 W @IOF
"RTN","PSJOC",78,0)
 . W !
"RTN","PSJOC",79,0)
 . I $G(PSJNLST) W:(PSJX=1) PSJNLST W:(PSJX>1) ?$L(PSJNLST)
"RTN","PSJOC",80,0)
 . S X=PSJOC(ON,PSJX)
"RTN","PSJOC",81,0)
 . W $E(X,9,$L(X))
"RTN","PSJOC",82,0)
 W !
"RTN","PSJOC",83,0)
 Q
"RTN","PSJOC",84,0)
 ;
"RTN","PSJOC",85,0)
DRUGERR ;Display drug level errors
"RTN","PSJOC",86,0)
 NEW PSJPON,PSJN,PSJNV,PSJDSPFG,PSJPERR,PSJX
"RTN","PSJOC",87,0)
 ;Only display the exceptions once per patient.
"RTN","PSJOC",88,0)
 ;PSJEXCPT(PSJDNM_REASON) - Array for invalid drugs that already display to once within a pt selection
"RTN","PSJOC",89,0)
 S PSJDSPFG=0
"RTN","PSJOC",90,0)
 S PSJPERR=$$PROSPERR()
"RTN","PSJOC",91,0)
 S PSJPON="" F  S PSJPON=$O(^TMP($J,"PSJPRE","OUT","EXCEPTIONS",PSJPON)) Q:PSJPON=""  D
"RTN","PSJOC",92,0)
 . F PSJN=0:0 S PSJN=$O(^TMP($J,"PSJPRE","OUT","EXCEPTIONS",PSJPON,PSJN)) Q:'PSJN  D
"RTN","PSJOC",93,0)
 .. S PSJNV=$G(^TMP($J,"PSJPRE","OUT","EXCEPTIONS",PSJPON,PSJN))
"RTN","PSJOC",94,0)
 .. I ($P(PSJPON,";",3)="PROSPECTIVE") S PSJX='$$ERRCHK("PROSPECTIVE",$P(PSJNV,U,3)_$P(PSJNV,U,10))
"RTN","PSJOC",95,0)
 .. I PSJPERR,($P(PSJPON,";",3)="PROFILE") Q
"RTN","PSJOC",96,0)
 .. I ($P(PSJPON,";",3)="PROFILE"),'$$ERRCHK("PROFILE",$P(PSJNV,U,3)_$P(PSJNV,U,10)) Q
"RTN","PSJOC",97,0)
 .. D DSPDRGER()
"RTN","PSJOC",98,0)
 I PSJDSPFG D PAUSE^PSJLMUT1 W @IOF
"RTN","PSJOC",99,0)
 Q
"RTN","PSJOC",100,0)
DSPDRGER(PSJDSFLG) ;
"RTN","PSJOC",101,0)
 NEW PSJTXT
"RTN","PSJOC",102,0)
 S PSJTXT=$P(PSJNV,U,7)
"RTN","PSJOC",103,0)
 S X="Enhanced Order Checks cannot "
"RTN","PSJOC",104,0)
 I $G(PSJDSFLG),(PSJTXT[X) S PSJTXT="Dosing Checks could not "_$P(PSJTXT,X,2)
"RTN","PSJOC",105,0)
 S PSJDSPFG=1
"RTN","PSJOC",106,0)
 K PSJPAUSE
"RTN","PSJOC",107,0)
 I ($Y+6)>IOSL D PAUSE^PSJLMUT1 W @IOF
"RTN","PSJOC",108,0)
 W !
"RTN","PSJOC",109,0)
 D WRITE^PSJMISC(PSJTXT,,79)
"RTN","PSJOC",110,0)
 D:$P(PSJNV,U,10)]"" WRITE^PSJMISC("Reason: "_$P(PSJNV,U,10),3,79)
"RTN","PSJOC",111,0)
 W !
"RTN","PSJOC",112,0)
 Q
"RTN","PSJOC",113,0)
ERRCHK(PSJTYPE,PSJX) ;
"RTN","PSJOC",114,0)
 ;PSJTYPE - Either "PROFILE" or "PROSPECTIVE"
"RTN","PSJOC",115,0)
 ;PSJX - Drug name_Error reason
"RTN","PSJOC",116,0)
 ;Return 1 if this error drug has not displayed to the user.
"RTN","PSJOC",117,0)
 I $G(PSJX)="" Q 0
"RTN","PSJOC",118,0)
 I $G(PSJTYPE)="" Q 0
"RTN","PSJOC",119,0)
 I PSJTYPE="PROFILE",'$D(PSJEXCPT(PSJTYPE,PSJX)) S PSJEXCPT(PSJTYPE,PSJX)="" Q 1
"RTN","PSJOC",120,0)
 I PSJTYPE="PROSPECTIVE",'$D(PSJEXCPT(PSJTYPE,PSJX)) S PSJEXCPT(PSJTYPE,PSJX)="" Q 1
"RTN","PSJOC",121,0)
 Q 0
"RTN","PSJOC",122,0)
PING(PSJMSG) ;Check if FDB is down.  Return 0 if it is
"RTN","PSJOC",123,0)
 ;pass in a message to customize the display
"RTN","PSJOC",124,0)
 S ^TMP($J,"PSJPRE","IN","PING")=""
"RTN","PSJOC",125,0)
 D IN^PSSHRQ2("PSJPRE")
"RTN","PSJOC",126,0)
 Q $$DSPSERR($G(PSJMSG))
"RTN","PSJOC",127,0)
DSPSERR(PSJMSG) ;Display system errors
"RTN","PSJOC",128,0)
 NEW X
"RTN","PSJOC",129,0)
 S X=$G(^TMP($J,"PSJPRE","OUT",0))
"RTN","PSJOC",130,0)
 I $P(X,U)=-1 D NOFDB($P(X,U,2),$G(PSJMSG))
"RTN","PSJOC",131,0)
 Q $S($P(X,U)=-1:0,1:1)
"RTN","PSJOC",132,0)
NOFDB(PSJX,PSJMSG) ;Display connection down message
"RTN","PSJOC",133,0)
 Q:$G(PSJX)=""
"RTN","PSJOC",134,0)
 I $G(PSJMSG)]"" W !!,"No dosing checks can be performed"
"RTN","PSJOC",135,0)
 I $G(PSJMSG)="" W !!,"No Enhanced Order Checks can be performed."
"RTN","PSJOC",136,0)
 W !,"   Reason: ",PSJX,!!
"RTN","PSJOC",137,0)
 K PSJX
"RTN","PSJOC",138,0)
 Q
"RTN","PSJOC",139,0)
PROSPERR() ;Return 1 if only prospective exception should be displayed.
"RTN","PSJOC",140,0)
 NEW PSJPERR,PSJPON
"RTN","PSJOC",141,0)
 S PSJPERR=1
"RTN","PSJOC",142,0)
 ;If all prospectives are caught in the exception then display them only and omit the profile drugs
"RTN","PSJOC",143,0)
 S PSJPON="" F  S PSJPON=$O(^TMP($J,"PSJPRE","IN","PROSPECTIVE",PSJPON)) Q:PSJPON=""  Q:'PSJPERR  D
"RTN","PSJOC",144,0)
 . I $D(^TMP($J,"PSJPRE","OUT","EXCEPTIONS",PSJPON)) Q
"RTN","PSJOC",145,0)
 . S PSJPERR=0
"RTN","PSJOC",146,0)
 Q PSJPERR
"RTN","PSJOCDC")
0^16^B2536866^B1499223
"RTN","PSJOCDC",1,0)
PSJOCDC ;BIR/MV - NEW ORDER CHECKS MISC. ;6 Jun 07 / 3:37 PM
"RTN","PSJOCDC",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**181,260**;16 DEC 97;Build 94
"RTN","PSJOCDC",3,0)
 ;
"RTN","PSJOCDC",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJOCDC",5,0)
 ;
"RTN","PSJOCDC",6,0)
DC(PSGP,PSJORD,PSJCLINF) ;DC orders during Duplicate Therapy order checks
"RTN","PSJOCDC",7,0)
 ;PSGP - Patient DFN
"RTN","PSJOCDC",8,0)
 ;PSJORD - Order #_u/v/p
"RTN","PSJOCDC",9,0)
 ;Save local arrays and variables to be restored after DC order(s)
"RTN","PSJOCDC",10,0)
 Q:'$D(PSJORD)
"RTN","PSJOCDC",11,0)
 S PSJDCDTF=1
"RTN","PSJOCDC",12,0)
 D ^PSJOCVAR
"RTN","PSJOCDC",13,0)
 NEW ON S ON=PSJORD
"RTN","PSJOCDC",14,0)
 I $$DSPORD(PSJORD,.PSJCLINF) D DCORD
"RTN","PSJOCDC",15,0)
 D RESTORE^PSJOCVAR
"RTN","PSJOCDC",16,0)
 K PSJDCDTF
"RTN","PSJOCDC",17,0)
 Q
"RTN","PSJOCDC",18,0)
DCORD ;DC order according to order type
"RTN","PSJOCDC",19,0)
 ;PSJOCFLG is used in DC^PSJLIACT so the newly DC order during DT will not redisplay.
"RTN","PSJOCDC",20,0)
 NEW PSJOCFLG S PSJOCFLG=1
"RTN","PSJOCDC",21,0)
 I PSJORD["U" D DCUD Q
"RTN","PSJOCDC",22,0)
 ; DC pending, active IV and complex orders
"RTN","PSJOCDC",23,0)
 D DC^PSJLIACT
"RTN","PSJOCDC",24,0)
 Q
"RTN","PSJOCDC",25,0)
DSPORD(PSJORD,PSJCLINF) ;Display the order about to DC and check if the user wish to DC to order
"RTN","PSJOCDC",26,0)
 ;Returns 1 if continuing with DC the duplicate order.
"RTN","PSJOCDC",27,0)
 ;Returns 0 if not to DC.
"RTN","PSJOCDC",28,0)
 ; 
"RTN","PSJOCDC",29,0)
 NEW %
"RTN","PSJOCDC",30,0)
 D DSPORD^PSJOC(PSJORD,,.PSJCLINF)
"RTN","PSJOCDC",31,0)
 ;DC^PSJOE does the DC prompt
"RTN","PSJOCDC",32,0)
 I PSJORD["U" Q 1
"RTN","PSJOCDC",33,0)
ASKDC W !!,"Enter DC to discontinue the above order or press <RETURN> to continue:" S %=2 D TST4DC^PSGOEC W:%=2 !,"No action taken!"
"RTN","PSJOCDC",34,0)
 W !
"RTN","PSJOCDC",35,0)
 I %="" D ENDC^PSGOEM W ! G ASKDC
"RTN","PSJOCDC",36,0)
 I %=1 Q 1
"RTN","PSJOCDC",37,0)
 Q 0
"RTN","PSJOCDC",38,0)
DCUD ;DC a U/D order
"RTN","PSJOCDC",39,0)
 ;Setup necessary variables needed by DC^PSJOE
"RTN","PSJOCDC",40,0)
 NEW PSGOEEWF,PSGSTAT,DIR,PSJDCFLG
"RTN","PSJOCDC",41,0)
 S PSJDCFLG=1
"RTN","PSJOCDC",42,0)
 S PSGSTAT=$P($G(^PS(55,PSGP,5,+PSJORD,0)),U,9)
"RTN","PSJOCDC",43,0)
 S PSGOEEWF="^PS(55,"_PSGP_",5,"_+PSJORD_","
"RTN","PSJOCDC",44,0)
 D SYSL^PSGSETU
"RTN","PSJOCDC",45,0)
 D DC^PSJOE(PSGP,PSJORD)
"RTN","PSJOCDC",46,0)
 K PSJDCFLG
"RTN","PSJOCDC",47,0)
 Q
"RTN","PSJOCDI")
0^14^B91203881^B82259996
"RTN","PSJOCDI",1,0)
PSJOCDI ;BIR/MV - DISPLAY DRUG INTERACTION ORDER CHECKS ;6 Jun 07 / 3:37 PM
"RTN","PSJOCDI",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**181,260**;16 DEC 97;Build 94
"RTN","PSJOCDI",3,0)
 ; Reference to ^PSODRDU2 is supported by DBIA #2189
"RTN","PSJOCDI",4,0)
 ;
"RTN","PSJOCDI",5,0)
DI ;
"RTN","PSJOCDI",6,0)
 NEW PSJDN,PSJDNM,PSJMON,PSJOCLST,PSJPON,PSJSEV,PSJHDR,PSJRDI,PSJ2,PSJONFLG,PSJCRTCL,PSJSORT,PSJGROUP,PSJCLINF,PSJDXOPT
"RTN","PSJOCDI",7,0)
 ;If interception occurred, display message to user
"RTN","PSJOCDI",8,0)
 ;
"RTN","PSJOCDI",9,0)
 ;Store VUID from Remote data in PSJRDI(PSJON)=VUID.
"RTN","PSJOCDI",10,0)
 D RDIVUID
"RTN","PSJOCDI",11,0)
 S PSJ2=0
"RTN","PSJOCDI",12,0)
 ;Loop through drug drug order checks output
"RTN","PSJOCDI",13,0)
 S PSJSEV="" F  S PSJSEV=$O(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV)) Q:PSJSEV=""!($G(PSGORQF))  D
"RTN","PSJOCDI",14,0)
 . S PSJDNM="" F  S PSJDNM=$O(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM)) Q:PSJDNM=""!($G(PSGORQF))  D
"RTN","PSJOCDI",15,0)
 .. S PSJPON="" F  S PSJPON=$O(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON)) Q:PSJPON=""!($G(PSGORQF))  D
"RTN","PSJOCDI",16,0)
 ... S PSJCLINF="",PSJDXOPT=$S($G(PSJDGCK):"PROSPECTIVE",1:"PROFILE")
"RTN","PSJOCDI",17,0)
 ... S PSJCLINF="",PSJCLINF=$P($G(^TMP($J,"PSJPRE","IN",PSJDXOPT,PSJPON)),"^",7)
"RTN","PSJOCDI",18,0)
 ... F PSJDN=0:0 S PSJDN=$O(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON,PSJDN)) Q:'PSJDN!($G(PSGORQF))  D SORTORD
"RTN","PSJOCDI",19,0)
 I $O(PSJOCLST(""))="" Q
"RTN","PSJOCDI",20,0)
 D CRITICAL
"RTN","PSJOCDI",21,0)
 D DSPLOC
"RTN","PSJOCDI",22,0)
 I $D(^TMP($J,"PSJPRE","OUT","DRUGDRUG","S")) D
"RTN","PSJOCDI",23,0)
 . W !,"*** REFER TO MONOGRAPH FOR SIGNIFICANT INTERACTION CLINICAL EFFECTS",!
"RTN","PSJOCDI",24,0)
 D LINE^PSJMISC("=",81)
"RTN","PSJOCDI",25,0)
 W !
"RTN","PSJOCDI",26,0)
 D MON^PSJMON(.PSJMON)
"RTN","PSJOCDI",27,0)
 D:$G(PSJONFLG)&('$D(PSJDGCK)) INTERV
"RTN","PSJOCDI",28,0)
 Q
"RTN","PSJOCDI",29,0)
DSPLOC ;Display drug drug interaction - sorted by severity, prospective drug (50,.01), profile drug (VAgen name), package, seq#
"RTN","PSJOCDI",30,0)
 NEW PSJDN,PSJDNV,PSJPON,PSJP,PSJX,X,PSJXSEV,PSJXNM,PSJXNM1,PSJXSORT,PSJXDN,PSJSORT,PSJPSPEC,PSJPROFL,PSJ2,PSJSEV,PSJHDRS,PSJDSPON,PSJCLINF
"RTN","PSJOCDI",31,0)
 ;
"RTN","PSJOCDI",32,0)
 K PSJPAUSE
"RTN","PSJOCDI",33,0)
 ;Get the last drug in the sort list so a '=' line is printed instead of '.'
"RTN","PSJOCDI",34,0)
 S PSJLINE=".",PSJHDRS=""
"RTN","PSJOCDI",35,0)
 S PSJXSEV=$O(PSJOCLST(""),-1)
"RTN","PSJOCDI",36,0)
 S PSJXNM=$O(PSJOCLST(PSJXSEV,""),-1)
"RTN","PSJOCDI",37,0)
 S PSJXNM1=$O(PSJOCLST(PSJXSEV,PSJXNM,""),-1)
"RTN","PSJOCDI",38,0)
 S PSJXSORT=$O(PSJOCLST(PSJXSEV,PSJXNM,PSJXNM1,""),-1)
"RTN","PSJOCDI",39,0)
 S PSJXDN=$O(PSJOCLST(PSJXSEV,PSJXNM,PSJXNM1,PSJXSORT,""),-1)
"RTN","PSJOCDI",40,0)
 ;
"RTN","PSJOCDI",41,0)
 ;S PSJSEV="" F  S PSJSEV=$O(PSJOCLST(PSJSEV)) Q:PSJSEV=""  D
"RTN","PSJOCDI",42,0)
 ;Displaying Critical orders
"RTN","PSJOCDI",43,0)
 S PSJSEV="C"
"RTN","PSJOCDI",44,0)
 I $D(PSJCRTCL) D LINE^PSJMISC("=",81)
"RTN","PSJOCDI",45,0)
 F PSJSORT=0:0 S PSJSORT=$O(PSJCRTCL(PSJSORT)) Q:'PSJSORT  D
"RTN","PSJOCDI",46,0)
 . F PSJGROUP=0:0 S PSJGROUP=$O(PSJCRTCL(PSJSORT,PSJGROUP)) Q:'PSJGROUP  D
"RTN","PSJOCDI",47,0)
 .. S X=$G(PSJCRTCL(PSJSORT,PSJGROUP))
"RTN","PSJOCDI",48,0)
 .. D DSPCRTCL($P(X,U),$P(X,U,2))
"RTN","PSJOCDI",49,0)
 ;Displaying Significant orders
"RTN","PSJOCDI",50,0)
 K PSJDSPON
"RTN","PSJOCDI",51,0)
 S PSJSEV="S"
"RTN","PSJOCDI",52,0)
 S PSJPSPEC="" F  S PSJPSPEC=$O(PSJOCLST(PSJSEV,PSJPSPEC)) Q:PSJPSPEC=""  D
"RTN","PSJOCDI",53,0)
 . D LINE^PSJMISC("=",81)
"RTN","PSJOCDI",54,0)
 . F PSJSORT=0:0 S PSJSORT=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJSORT)) Q:'PSJSORT  D
"RTN","PSJOCDI",55,0)
 .. F PSJ2=0:0 S PSJ2=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJSORT,PSJ2)) Q:'PSJ2  D
"RTN","PSJOCDI",56,0)
 ... S PSJDNV=PSJOCLST(PSJSEV,PSJPSPEC,PSJSORT,PSJ2)
"RTN","PSJOCDI",57,0)
 ... D DISPON
"RTN","PSJOCDI",58,0)
 . W !
"RTN","PSJOCDI",59,0)
 Q
"RTN","PSJOCDI",60,0)
DSPCRTCL(PSJPSPEC,PSJPROFL) ;Display Critical orders
"RTN","PSJOCDI",61,0)
 NEW PSJSORT,PSJ2
"RTN","PSJOCDI",62,0)
 Q:$G(PSJPSPEC)=""
"RTN","PSJOCDI",63,0)
 Q:$G(PSJPROFL)=""
"RTN","PSJOCDI",64,0)
 F PSJSORT=0:0 S PSJSORT=$O(PSJOCLST("C",PSJPSPEC,PSJPROFL,PSJSORT)) Q:'PSJSORT  D
"RTN","PSJOCDI",65,0)
 . F PSJ2=0:0 S PSJ2=$O(PSJOCLST("C",PSJPSPEC,PSJPROFL,PSJSORT,PSJ2)) Q:'PSJ2  D
"RTN","PSJOCDI",66,0)
 .. S PSJDNV=PSJOCLST("C",PSJPSPEC,PSJPROFL,PSJSORT,PSJ2)
"RTN","PSJOCDI",67,0)
 .. D DISPON
"RTN","PSJOCDI",68,0)
 Q
"RTN","PSJOCDI",69,0)
DISPON ; Display orders & clin effects if applied.
"RTN","PSJOCDI",70,0)
 F X=1:1:11 S PSJP(X)=$P(PSJDNV,U,X)
"RTN","PSJOCDI",71,0)
 S PSJCLINF=$P(PSJDNV,U,12)
"RTN","PSJOCDI",72,0)
 I ($G(PSJHDR)'=$P(PSJDNV,U,3))!(PSJHDRS'=PSJSEV) S PSJHDR=$P(PSJDNV,U,3),PSJHDRS=PSJSEV K PSJDSPON D HDR(PSJHDR)
"RTN","PSJOCDI",73,0)
 I ($Y+8)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJOCDI",74,0)
 I PSJSORT=10 D
"RTN","PSJOCDI",75,0)
 . S PSJONFLG=1
"RTN","PSJOCDI",76,0)
 . I $P(PSJCLINF,";",2) D DISPCLN^PSJCLNOC(.PSJP,PSJCLINF) Q
"RTN","PSJOCDI",77,0)
 . D DSPDRG(PSJP(4),$P(PSJDNV,U,2),PSJCLINF)
"RTN","PSJOCDI",78,0)
 I ($Y+6)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJOCDI",79,0)
 I PSJSORT>10 S PSJONFLG=1 D
"RTN","PSJOCDI",80,0)
 . I $D(PSJDSPON(PSJP(4))) Q
"RTN","PSJOCDI",81,0)
 . S PSJDSPON(PSJP(4))=""
"RTN","PSJOCDI",82,0)
 . I $P($P(PSJDNV,U,12),";",2) D DISPCLN^PSJCLNOC(.PSJP,PSJCLINF) Q
"RTN","PSJOCDI",83,0)
 . D EN^PSODRDU2(DFN,PSJP(4),"PSJPRE")
"RTN","PSJOCDI",84,0)
 I ($Y+6)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJOCDI",85,0)
DISPON2 ;
"RTN","PSJOCDI",86,0)
 I PSJSEV=PSJXSEV,(PSJPSPEC=PSJXNM),(PSJSORT=PSJXSORT),(PSJ2=PSJXDN) S PSJLINE="="
"RTN","PSJOCDI",87,0)
 I PSJSEV="C",$$DSPLCLIN(PSJ2) D CLIN(PSJP(5),PSJP(2),PSJP(4),PSJP(1),PSJLINE)
"RTN","PSJOCDI",88,0)
 I ($Y+6)>IOSL D PAUSE^PSJMISC() W @IOF
"RTN","PSJOCDI",89,0)
 Q
"RTN","PSJOCDI",90,0)
SORTORD ;Sort drug drug output to display in order of: Inpatient, Active Rx, Remote Rx, Pending Rx, Non_VA
"RTN","PSJOCDI",91,0)
 NEW PDJDNV,PSJX
"RTN","PSJOCDI",92,0)
 S PSJDNV=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON,PSJDN))
"RTN","PSJOCDI",93,0)
 I $E(PSJPON,1,1)'="I" D
"RTN","PSJOCDI",94,0)
 . S PSJX=$E($P(PSJPON,";"),1,1)
"RTN","PSJOCDI",95,0)
 . D OCLST($S(PSJX["C":10,PSJX="O":20,PSJX="R":30,PSJX="P":40,PSJX="N":50,1:""),PSJCLINF)
"RTN","PSJOCDI",96,0)
 I $E(PSJPON,1,1)="I" D OCLST(10,PSJCLINF)
"RTN","PSJOCDI",97,0)
 Q
"RTN","PSJOCDI",98,0)
OCLST(PSJ1,PSJCLINF) ;Sort orders into array to display later
"RTN","PSJOCDI",99,0)
 ;PSJOCLST(PSJSEV("C",PSJPSPEC,PSJPROFL,PSJ1-package,PSJ2)=P1...P6 (P1=SEQ NO, P2=Drug Name(Profile), P3=Drug Name(Prospective)
"RTN","PSJOCDI",100,0)
 ;  (P4=Pharm order# ,P5=Severity, P6=P3 IEN)
"RTN","PSJOCDI",101,0)
 ;PSJOCLST(PSJSEV("S",PSJPSPEC,PSJ1-package,PSJ2)=P1...P12 (P1=SEQ NO, P2=Drug Name(Profile), P3=Drug Name(Prospective), P12=PSJCLINF
"RTN","PSJOCDI",102,0)
 ;  (P4=Pharm order# ,P5=Severity, P6=P3 IEN)
"RTN","PSJOCDI",103,0)
 ;PSJSEV: Sort first by severity
"RTN","PSJOCDI",104,0)
 ;PSJ1: 10=PSJ Order
"RTN","PSJOCDI",105,0)
 ;      20=PSO Active Rx
"RTN","PSJOCDI",106,0)
 ;      30=Remote Rx
"RTN","PSJOCDI",107,0)
 ;      40=PSO pending
"RTN","PSJOCDI",108,0)
 ;      50=Non-VA
"RTN","PSJOCDI",109,0)
 ;PSJ2: A counter
"RTN","PSJOCDI",110,0)
 NEW PSJDNV,PSJMONTI,PSJMONV,PSJVAGEN,PSJON1,PSJON2,PSJONFG,PSJPSPEC,PSJPROFL
"RTN","PSJOCDI",111,0)
 Q:'$G(PSJ1)
"RTN","PSJOCDI",112,0)
 S PSJ2=$G(PSJ2)+1
"RTN","PSJOCDI",113,0)
 S PSJDNV=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON,PSJDN))
"RTN","PSJOCDI",114,0)
 S PSJPSPEC=$P(PSJDNV,U,4) S:PSJPSPEC="" PSJPSPEC="UNKNOWN DRUG NAME"
"RTN","PSJOCDI",115,0)
 ; Criticals are grouped by profile VAGEN name and then package type
"RTN","PSJOCDI",116,0)
 I PSJSEV="C" D
"RTN","PSJOCDI",117,0)
 . S PSJVAGEN=$$VAGEN^PSJMISC(+$P(PSJDNV,U,3)) I PSJVAGEN="" S PSJVAGEN=PSJDNM
"RTN","PSJOCDI",118,0)
 . S PSJOCLST(PSJSEV,PSJPSPEC,PSJVAGEN,PSJ1,PSJ2)=PSJDN_U_$G(PSJDNM)_U_$P(PSJDNV,U,4)_U_PSJPON_U_PSJSEV_U_$P(PSJDNV,U,2)_"^^^^^^"_PSJCLINF
"RTN","PSJOCDI",119,0)
 ; Significants are grouped by package type so Inpatient orders display first
"RTN","PSJOCDI",120,0)
 I PSJSEV="S" D 
"RTN","PSJOCDI",121,0)
 . S PSJOCLST(PSJSEV,PSJPSPEC,PSJ1,PSJ2)=PSJDN_U_$G(PSJDNM)_U_$P(PSJDNV,U,4)_U_PSJPON_U_PSJSEV_U_$P(PSJDNV,U,2)_"^^^^^^"_PSJCLINF
"RTN","PSJOCDI",122,0)
 S PSJMONTI=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON,PSJDN,"PMON",3,0))
"RTN","PSJOCDI",123,0)
 S PSJMONTI=$P(PSJMONTI,"MONOGRAPH TITLE:  ",2) Q:PSJMONTI=""
"RTN","PSJOCDI",124,0)
 S PSJVAGEN=$$VAGEN^PSJMISC(+$P(PSJDNV,U,3))
"RTN","PSJOCDI",125,0)
 I PSJVAGEN="",'+$P(PSJDNV,U,3) S PSJVAGEN=$$GENVUID^PSJMISC($G(PSJRDI(PSJPON)))
"RTN","PSJOCDI",126,0)
 Q:PSJVAGEN=""
"RTN","PSJOCDI",127,0)
 S PSJVAGEN=PSJVAGEN_"+"_$P(PSJDNV,U,4)
"RTN","PSJOCDI",128,0)
 S PSJMONV=$G(PSJMON(PSJVAGEN,PSJMONTI))
"RTN","PSJOCDI",129,0)
 I PSJMONTI]"" D
"RTN","PSJOCDI",130,0)
 . S $P(PSJMON(PSJVAGEN,PSJMONTI),U,1,7)=PSJDN_U_$G(PSJDNM)_U_+$P(PSJDNV,U,3)_U_$P(PSJDNV,U,4)_U_+$P(PSJDNV,U,2)_U_PSJPON_U_PSJSEV
"RTN","PSJOCDI",131,0)
 . S $P(PSJMON(PSJVAGEN,PSJMONTI),U,11)=PSJVAGEN
"RTN","PSJOCDI",132,0)
 I PSJMONV]"" D
"RTN","PSJOCDI",133,0)
 . I $P(PSJMONV,U,7)'=PSJSEV S $P(PSJMON(PSJVAGEN,PSJMONTI),U,9)=1
"RTN","PSJOCDI",134,0)
 . S PSJONFG=0
"RTN","PSJOCDI",135,0)
 . S PSJON1=$P($P(PSJMONV,U,6),";")
"RTN","PSJOCDI",136,0)
 . S PSJON2=$P(PSJPON,";")
"RTN","PSJOCDI",137,0)
 . I PSJON1="I",PSJON2'="I" S PSJONFG=1
"RTN","PSJOCDI",138,0)
 . I PSJON1'="I",PSJON2="I" S PSJONFG=1
"RTN","PSJOCDI",139,0)
 . I PSJONFG S $P(PSJMON(PSJVAGEN,PSJMONTI),U,10)=1
"RTN","PSJOCDI",140,0)
 K PSJON1,PSJON2,PSJONFG
"RTN","PSJOCDI",141,0)
 Q
"RTN","PSJOCDI",142,0)
CLIN(PSJSEV,PSJDNM,PSJPON,PSJDN,PSJLINE) ;
"RTN","PSJOCDI",143,0)
 ;No longer need to display the clinical effect for Significant
"RTN","PSJOCDI",144,0)
 Q:PSJSEV="S"
"RTN","PSJOCDI",145,0)
 NEW PSJCLINV,PSJX
"RTN","PSJOCDI",146,0)
 I $G(PSJLINE)="" S PSJLINE="."
"RTN","PSJOCDI",147,0)
 S PSJCLINV=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJSEV,PSJDNM,PSJPON,PSJDN,"CLIN"))
"RTN","PSJOCDI",148,0)
 W !
"RTN","PSJOCDI",149,0)
 S PSJX=$P(PSJCLINV,"CLINICAL EFFECTS:  ",2) I ($Y+($L(PSJX)\65)+4)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJOCDI",150,0)
 D WRITE^PSJMISC(PSJX)
"RTN","PSJOCDI",151,0)
 W !
"RTN","PSJOCDI",152,0)
 I ($Y+8)>IOSL D PAUSE^PSJMISC(0,0) W @IOF
"RTN","PSJOCDI",153,0)
 Q
"RTN","PSJOCDI",154,0)
INTERV ;Log intervention.  Required for Critical.
"RTN","PSJOCDI",155,0)
 ;Critical interaction MUST log an intervention before continue with the order
"RTN","PSJOCDI",156,0)
 ;Only log one intervention for a prospective drug & log it for the higher severity
"RTN","PSJOCDI",157,0)
 NEW PSJSEV,PSJDD,PSJDN,PSJNDV,PSJTYPE,PSJINTVD,PSJPROFL
"RTN","PSJOCDI",158,0)
 K PSJDDSV,PSJINTVD
"RTN","PSJOCDI",159,0)
 ;Required intervention for each of the prospective drug with critical interactions
"RTN","PSJOCDI",160,0)
 F PSJSEV="C" Q:$G(PSGORQF)  S PSJPSPEC="" F  S PSJPSPEC=$O(PSJOCLST(PSJSEV,PSJPSPEC)) Q:PSJPSPEC=""  D
"RTN","PSJOCDI",161,0)
 . S PSJPROFL="" F  S PSJPROFL=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL)) Q:PSJPROFL=""  D
"RTN","PSJOCDI",162,0)
 .. F PSJTYPE=0:0 S PSJTYPE=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJTYPE)) Q:'PSJTYPE  D
"RTN","PSJOCDI",163,0)
 ... F PSJDN=0:0 S PSJDN=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJTYPE,PSJDN)) Q:'PSJDN  Q:$G(PSGORQF)  D
"RTN","PSJOCDI",164,0)
 .... S PSJNDV=$G(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJTYPE,PSJDN)),PSJDD=$P(PSJNDV,U,6)
"RTN","PSJOCDI",165,0)
 .... ;I ($P($P(PSJNDV,U,4),";",1)="I"),('$D(PSJINTVD($P(PSJNDV,U,3)))) D
"RTN","PSJOCDI",166,0)
 .... I '$D(PSJINTVD($P(PSJNDV,U,3))) D
"RTN","PSJOCDI",167,0)
 ..... S (PSJINTVD($P(PSJNDV,U,3)))=""
"RTN","PSJOCDI",168,0)
 ..... D:'$D(PSJDGCK) RINTERV^PSJGMRA("CRITICAL DRUG INTERACTION",$P(PSJNDV,U,3))
"RTN","PSJOCDI",169,0)
 ;
"RTN","PSJOCDI",170,0)
 ; Optional intervention for each of the prospective drug(not the same as critical) with significant interactions
"RTN","PSJOCDI",171,0)
 F PSJSEV="S" Q:$G(PSGORQF)  S PSJPSPEC="" F  S PSJPSPEC=$O(PSJOCLST(PSJSEV,PSJPSPEC)) Q:PSJPSPEC=""  D
"RTN","PSJOCDI",172,0)
 . F PSJTYPE=0:0 S PSJTYPE=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJTYPE)) Q:'PSJTYPE  D
"RTN","PSJOCDI",173,0)
 .. F PSJDN=0:0 S PSJDN=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJTYPE,PSJDN)) Q:'PSJDN  Q:$G(PSGORQF)  D
"RTN","PSJOCDI",174,0)
 ... S PSJNDV=$G(PSJOCLST(PSJSEV,PSJPSPEC,PSJTYPE,PSJDN)),PSJDD=$P(PSJNDV,U,6)
"RTN","PSJOCDI",175,0)
 ... I '$D(PSJINTVD($P(PSJNDV,U,3))) D
"RTN","PSJOCDI",176,0)
 .... S (PSJINTVD($P(PSJNDV,U,3)))=""
"RTN","PSJOCDI",177,0)
 .... D:'$D(PSJDGCK) INTERV^PSJGMRA("SIGNIFICANT DRUG INTERACTION",$P(PSJNDV,U,3))
"RTN","PSJOCDI",178,0)
 Q
"RTN","PSJOCDI",179,0)
HDR(PSJDNM) ;Display the intro text on drug interaction
"RTN","PSJOCDI",180,0)
 W !,"This patient is receiving the following order(s) that have a "
"RTN","PSJOCDI",181,0)
 W $S($G(PSJSEV)="C":"CRITICAL",$G(PSJSEV)="S":"SIGNIFICANT",1:"")_" Drug"
"RTN","PSJOCDI",182,0)
 W !,"Interaction with "_$G(PSJDNM)_":",!
"RTN","PSJOCDI",183,0)
 Q
"RTN","PSJOCDI",184,0)
DSPDRG(PSJPON,PSJDNM,PSJCLINF) ;Display order info or drug name from prospective.
"RTN","PSJOCDI",185,0)
 Q:$G(PSJPON)=""
"RTN","PSJOCDI",186,0)
 I $P(PSJPON,";",3)="PROSPECTIVE" W !?8,$G(PSJDNM),! Q
"RTN","PSJOCDI",187,0)
 I $D(PSJDSPON(PSJPON)) Q
"RTN","PSJOCDI",188,0)
 S PSJDSPON(PSJPON)=""
"RTN","PSJOCDI",189,0)
 I ($Y+8)>IOSL D PAUSE^PSJMISC(1,0) W @IOF
"RTN","PSJOCDI",190,0)
 D DSPORD^PSJOC($P(PSJPON,";",2),"",PSJCLINF)
"RTN","PSJOCDI",191,0)
 Q
"RTN","PSJOCDI",192,0)
RDIVUID ;Loop thru the "IN" global to store the VUID for remote Rx
"RTN","PSJOCDI",193,0)
 NEW PSJPON,PSJVUID
"RTN","PSJOCDI",194,0)
 K PSJRDI
"RTN","PSJOCDI",195,0)
 S PSJPON=""
"RTN","PSJOCDI",196,0)
 F  S PSJPON=$O(^TMP($J,"PSJPRE","IN","PROFILE",PSJPON)) Q:PSJPON=""  I $E(PSJPON,1,1)="R" D
"RTN","PSJOCDI",197,0)
 . S PSJVUID=$P($G(^TMP($J,"PSJPRE","IN","PROFILE",PSJPON)),U,2)
"RTN","PSJOCDI",198,0)
 . S:+PSJVUID PSJRDI(PSJPON)=PSJVUID
"RTN","PSJOCDI",199,0)
 Q
"RTN","PSJOCDI",200,0)
DSPLCLIN(PSJ2) ;If the next drug on the list is diff the flag to display the clin effects.
"RTN","PSJOCDI",201,0)
 NEW PSJCLINC,PSJCLINN,PSJDNVC,PSJDNVN,PSJPC,PSJPN,PSJ2N,PSJSORTN
"RTN","PSJOCDI",202,0)
 I $G(PSJ2)="" Q 0
"RTN","PSJOCDI",203,0)
 S PSJDNVC=PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT,PSJ2)
"RTN","PSJOCDI",204,0)
 F X=1:1:10 S PSJPC(X)=$P(PSJDNVC,U,X)
"RTN","PSJOCDI",205,0)
 S PSJ2N=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT,PSJ2))
"RTN","PSJOCDI",206,0)
 I 'PSJ2N S PSJSORTN=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT)) Q:'PSJSORTN 1
"RTN","PSJOCDI",207,0)
 S PSJ2N=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT,0)) Q:'PSJ2N 1
"RTN","PSJOCDI",208,0)
 S PSJDNVN=PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT,PSJ2N)
"RTN","PSJOCDI",209,0)
 F X=1:1:10 S PSJPN(X)=$P(PSJDNVN,U,X)
"RTN","PSJOCDI",210,0)
 I $S(PSJPC(5)="":1,PSJPC(2)="":1,PSJPC(4)="":1,'+PSJPC(1):1,PSJPN(5)="":1,PSJPN(2)="":1,PSJPN(4)="":1,'+PSJPN(1):1,1:0) Q 0
"RTN","PSJOCDI",211,0)
 S PSJCLINC=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJPC(5),PSJPC(2),PSJPC(4),PSJPC(1),"CLIN"))
"RTN","PSJOCDI",212,0)
 S PSJCLINN=$G(^TMP($J,"PSJPRE","OUT","DRUGDRUG",PSJPN(5),PSJPN(2),PSJPN(4),PSJPN(1),"CLIN"))
"RTN","PSJOCDI",213,0)
 I (PSJCLINC'=PSJCLINN) Q 1
"RTN","PSJOCDI",214,0)
 Q 0
"RTN","PSJOCDI",215,0)
CRITICAL ;
"RTN","PSJOCDI",216,0)
 NEW PSJGROUP,PSJNEXT
"RTN","PSJOCDI",217,0)
 S PSJGROUP=0,PSJNEXT=0
"RTN","PSJOCDI",218,0)
 S PSJSEV="C"
"RTN","PSJOCDI",219,0)
 S PSJPSPEC="" F  S PSJPSPEC=$O(PSJOCLST(PSJSEV,PSJPSPEC)) Q:PSJPSPEC=""  D
"RTN","PSJOCDI",220,0)
 . S PSJPROFL="" F  S PSJPROFL=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL)) Q:PSJPROFL=""  D
"RTN","PSJOCDI",221,0)
 .. S PSJNEXT=0
"RTN","PSJOCDI",222,0)
 .. S PSJGROUP=PSJGROUP+1
"RTN","PSJOCDI",223,0)
 .. F PSJSORT=0:0 S PSJSORT=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT)) Q:'PSJSORT  D
"RTN","PSJOCDI",224,0)
 ... Q:PSJNEXT
"RTN","PSJOCDI",225,0)
 ... F PSJ2=0:0 S PSJ2=$O(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT,PSJ2)) Q:'PSJ2  D
"RTN","PSJOCDI",226,0)
 .... Q:PSJNEXT
"RTN","PSJOCDI",227,0)
 .... S PSJCRTCL(PSJSORT,PSJGROUP)=PSJPSPEC_U_PSJPROFL_U_$P(PSJOCLST(PSJSEV,PSJPSPEC,PSJPROFL,PSJSORT,PSJ2),"^",12)
"RTN","PSJOCDI",228,0)
 .... S PSJNEXT=1
"RTN","PSJOCDI",229,0)
 Q
"RTN","PSJOCDT")
0^6^B48494609^B28304577
"RTN","PSJOCDT",1,0)
PSJOCDT ;BIR/MV - PROCESS DUPLICATE THERAPY ORDER CHECKS ;6 Jun 07 / 3:37 PM
"RTN","PSJOCDT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**181,260**;16 DEC 97;Build 94
"RTN","PSJOCDT",3,0)
 ;
"RTN","PSJOCDT",4,0)
 ; Reference to EN^PSODRDU2 is supported by DBIA# 2189.
"RTN","PSJOCDT",5,0)
 ;
"RTN","PSJOCDT",6,0)
DT ;
"RTN","PSJOCDT",7,0)
 NEW PSJN1,PSJCLASS,PSJDNCNT,PSJNDV,PSJPROSP,PSJOCDT
"RTN","PSJOCDT",8,0)
 S PSJCLASS=""
"RTN","PSJOCDT",9,0)
 F PSJN1=0:0 S PSJN1=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1)) Q:'PSJN1  D
"RTN","PSJOCDT",10,0)
 . D SETCLASS
"RTN","PSJOCDT",11,0)
 . F PSJDNCNT=0:0 S PSJDNCNT=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",PSJDNCNT)) Q:'PSJDNCNT  D
"RTN","PSJOCDT",12,0)
 .. S PSJNDV=$G(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",PSJDNCNT))
"RTN","PSJOCDT",13,0)
 .. D SETOC
"RTN","PSJOCDT",14,0)
 I '$D(PSJPROSP) Q
"RTN","PSJOCDT",15,0)
 D DSPOC
"RTN","PSJOCDT",16,0)
 Q
"RTN","PSJOCDT",17,0)
DTDGCK ;This version of DT is only executed when the user selects hidden action CK (Drug Check)
"RTN","PSJOCDT",18,0)
 NEW PSJN1,PSJCLASS,PSJDNCNT,PSJNDV,PSJPROSP,PSJOCDT,PSJXX
"RTN","PSJOCDT",19,0)
 S PSJCLASS=""
"RTN","PSJOCDT",20,0)
 F PSJXX=1:1:2 D
"RTN","PSJOCDT",21,0)
 .F PSJN1=0:0 S PSJN1=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1)) Q:'PSJN1  D
"RTN","PSJOCDT",22,0)
 ..I PSJXX=1 I $P(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",1),";",3)'="PROSPECTIVE" Q
"RTN","PSJOCDT",23,0)
 ..I PSJXX=2 I $P(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",1),";",3)'="PROFILE" Q
"RTN","PSJOCDT",24,0)
 ..D SETCLASS
"RTN","PSJOCDT",25,0)
 ..F PSJDNCNT=0:0 S PSJDNCNT=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",PSJDNCNT)) Q:'PSJDNCNT  D
"RTN","PSJOCDT",26,0)
 ...S PSJNDV=$G(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",PSJDNCNT))
"RTN","PSJOCDT",27,0)
 ...D SETOC
"RTN","PSJOCDT",28,0)
 ..D DSPOC K PSJOCDT,PSJPROSP S PSJCLASS=""
"RTN","PSJOCDT",29,0)
 Q
"RTN","PSJOCDT",30,0)
DSPOC ;
"RTN","PSJOCDT",31,0)
 ;PSJDSPON(ON) - Is set after the order is displayed so the same order is not displayed again
"RTN","PSJOCDT",32,0)
 NEW PSJTYPE,PSJDNM,PSPON,PSJPONX,PSJX,PSJDSPON,PSJCLINF
"RTN","PSJOCDT",33,0)
 D HDR
"RTN","PSJOCDT",34,0)
 F PSJTYPE=0:0 S PSJTYPE=$O(PSJOCDT(PSJTYPE)) Q:'PSJTYPE  D
"RTN","PSJOCDT",35,0)
 . S PSJDNM="" F  S PSJDNM=$O(PSJOCDT(PSJTYPE,PSJDNM)) Q:PSJDNM=""  D
"RTN","PSJOCDT",36,0)
 .. S PSJPON="" F  S PSJPON=$O(PSJOCDT(PSJTYPE,PSJDNM,PSJPON)) Q:PSJPON=""  D
"RTN","PSJOCDT",37,0)
 ... K PSJCLINF S PSJCLINF="" I $P(PSJPON,";",2)'="",PSJOCDT(PSJTYPE,PSJDNM,PSJPON)'=""  S PSJCLINF=PSJOCDT(PSJTYPE,PSJDNM,PSJPON),PSJCLINF(2)=PSJPON,PSJCLINF(3)=PSJDNM
"RTN","PSJOCDT",38,0)
 ... I ($Y+6)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",39,0)
 ... S PSJPONX=$P(PSJPON,";",2)
"RTN","PSJOCDT",40,0)
 ... I PSJTYPE=10,+PSJPONX D
"RTN","PSJOCDT",41,0)
 .... I '$D(PSJDSPON(PSJPONX)) D DSPORD^PSJOC(PSJPONX,,.PSJCLINF)
"RTN","PSJOCDT",42,0)
 .... S PSJDSPON(PSJPONX)=""
"RTN","PSJOCDT",43,0)
 ... I ($Y+8)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",44,0)
 ... I PSJTYPE>10 D
"RTN","PSJOCDT",45,0)
 .... I PSJCLINF D CLNDISP^PSJCLNOC(.PSJCLINF) Q
"RTN","PSJOCDT",46,0)
 .... D EN^PSODRDU2(DFN,PSJPON,"PSJPRE")
"RTN","PSJOCDT",47,0)
 ;Break the display text this way so the info on classes are indented correctly
"RTN","PSJOCDT",48,0)
 S PSJCLASS=" Involved in Therapeutic Duplication(s): "_PSJCLASS
"RTN","PSJOCDT",49,0)
 S PSJX=$L(PSJCLASS)\65 I ($Y+PSJX+4)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",50,0)
 W !,"Class(es)"
"RTN","PSJOCDT",51,0)
 D MYWRITE^PSJMISC(PSJCLASS,3,67)
"RTN","PSJOCDT",52,0)
 I ($Y+8)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",53,0)
 W !
"RTN","PSJOCDT",54,0)
 ;D LINE^PSJMISC($S($G(PSJOLDN):PSJLINE,1:"="),81)
"RTN","PSJOCDT",55,0)
 D LINE^PSJMISC("=",81)
"RTN","PSJOCDT",56,0)
 I '$D(PSJOCDT(10)),$D(PSJOCDT) K PSJPAUSE D PAUSE^PSJLMUT1 W @IOF Q
"RTN","PSJOCDT",57,0)
 ;I ($Y+8)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",58,0)
 ;I $D(PSJDGCK) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR Q
"RTN","PSJOCDT",59,0)
 I $D(PSJDGCK) Q
"RTN","PSJOCDT",60,0)
 D CONT
"RTN","PSJOCDT",61,0)
 Q:$G(PSGORQF)
"RTN","PSJOCDT",62,0)
 S PSJY=$$SORTLST()
"RTN","PSJOCDT",63,0)
 K PSJPAUSE
"RTN","PSJOCDT",64,0)
 I PSJY=1 D  Q
"RTN","PSJOCDT",65,0)
 . W !!
"RTN","PSJOCDT",66,0)
 . D:'$D(PSJDGCK) PROCLST(PSJY)
"RTN","PSJOCDT",67,0)
 I (PSJY>1),+$$DCPROMPT() D
"RTN","PSJOCDT",68,0)
 . W !
"RTN","PSJOCDT",69,0)
 . S PSJY=$$LST() W !
"RTN","PSJOCDT",70,0)
 . D:'$D(PSJDGCK) PROCLST(PSJY)
"RTN","PSJOCDT",71,0)
 Q
"RTN","PSJOCDT",72,0)
HDR ;
"RTN","PSJOCDT",73,0)
 NEW PSJHDR,PSJDNM
"RTN","PSJOCDT",74,0)
 I $D(^TMP($J,"PSJPRE","OUT","DRUGDRUG")) W @IOF
"RTN","PSJOCDT",75,0)
 D LINE^PSJMISC("=",81)
"RTN","PSJOCDT",76,0)
 S PSJHDR="This patient is already receiving the following INPATIENT and/or OUTPATIENT order(s) for a drug in the same therapeutic class(es)"
"RTN","PSJOCDT",77,0)
 S:$D(PSJDGCK) PSJHDR="This patient is already receiving the following INPATIENT and/or OUTPATIENT order(s) for drugs in the same therapeutic class(es)"
"RTN","PSJOCDT",78,0)
 S PSJDNM=$O(PSJPROSP("UD",""))
"RTN","PSJOCDT",79,0)
 I PSJDNM]"" S PSJHDR=PSJHDR_" as "_PSJDNM_":" D WRITE^PSJMISC(PSJHDR,1,77) Q
"RTN","PSJOCDT",80,0)
 D WRITE^PSJMISC(PSJHDR_":",1,77)
"RTN","PSJOCDT",81,0)
HDR2 ;
"RTN","PSJOCDT",82,0)
 W !,"Drug(s) Ordered:"
"RTN","PSJOCDT",83,0)
 S PSJDNM="" F  S PSJDNM=$O(PSJPROSP("IV",PSJDNM)) Q:PSJDNM=""  D
"RTN","PSJOCDT",84,0)
 . W !,?3,PSJDNM
"RTN","PSJOCDT",85,0)
 . I ($Y+8)>IOSL D PAUSE^PSJMISC() W @IOF
"RTN","PSJOCDT",86,0)
 W !
"RTN","PSJOCDT",87,0)
 Q
"RTN","PSJOCDT",88,0)
SETCLASS ;Store all classes to display at the end.
"RTN","PSJOCDT",89,0)
 NEW PSJN2,PSJCLS
"RTN","PSJOCDT",90,0)
 F PSJN2=0:0 S PSJN2=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,PSJN2)) Q:'PSJN2  D
"RTN","PSJOCDT",91,0)
 . S PSJCLS=$G(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,PSJN2,"CLASS"))
"RTN","PSJOCDT",92,0)
 . S PSJCLASS=PSJCLASS_$S(PSJCLASS="":"",1:", ")_PSJCLS
"RTN","PSJOCDT",93,0)
 Q
"RTN","PSJOCDT",94,0)
SETOC ;Set PSJOCDT array to sort by Package(Inpt, Outpt: Active, Remote, Pending, Non-VA
"RTN","PSJOCDT",95,0)
 ;PSJPROSP(UD/IV,drugname)="" - This is used to display the header
"RTN","PSJOCDT",96,0)
 ;PSJOCDT(package,drugname,Pharm ord#)=""
"RTN","PSJOCDT",97,0)
 NEW PSJPON,PSJPKG,PSJTYPE,PSJDNM,PSJPONX,PSJCLINF,PSJDXOPT
"RTN","PSJOCDT",98,0)
 S PSJPON=$P(PSJNDV,U) Q:PSJPON=""
"RTN","PSJOCDT",99,0)
 S PSJCLINF="",PSJDXOPT=$S($G(PSJDGCK):"PROSPECTIVE",1:"PROFILE")
"RTN","PSJOCDT",100,0)
 I $P(PSJPON,";",3)'="PROSPECTIVE" S PSJCLINF=$P(^TMP($J,"PSJPRE","IN",PSJDXOPT,PSJPON),"^",7)
"RTN","PSJOCDT",101,0)
 S PSJPONX=$P(PSJPON,";",2)
"RTN","PSJOCDT",102,0)
 S PSJTYPE=$P(PSJPON,";") Q:PSJTYPE=""
"RTN","PSJOCDT",103,0)
 S PSJDNM=$P(PSJNDV,U,3) Q:PSJDNM=""
"RTN","PSJOCDT",104,0)
 S PSJPKG=$S(PSJTYPE["C":10,PSJTYPE="I":10,PSJTYPE="O":20,PSJTYPE="R":30,PSJTYPE="P":40,PSJTYPE="N":50,1:"")
"RTN","PSJOCDT",105,0)
 ; Set prospective drug name array to display in the header.
"RTN","PSJOCDT",106,0)
 I PSJPKG=10,($P(PSJPON,";",3)="PROSPECTIVE") D  Q
"RTN","PSJOCDT",107,0)
 . I PSJPONX["V" S PSJPROSP("IV",PSJDNM)="" Q
"RTN","PSJOCDT",108,0)
 . I PSJPONX["P",+$G(PSJLIFNI) S PSJPROSP("IV",PSJDNM)="" Q
"RTN","PSJOCDT",109,0)
 . I PSJPONX["P",($P($G(^PS(53.1,+PSJPONX,8)),U)]"") S PSJPROSP("IV",PSJDNM)="" Q
"RTN","PSJOCDT",110,0)
 . S PSJPROSP("UD",PSJDNM)=""
"RTN","PSJOCDT",111,0)
 S PSJOCDT(PSJPKG,PSJDNM,PSJPON)=PSJCLINF
"RTN","PSJOCDT",112,0)
 Q
"RTN","PSJOCDT",113,0)
CONT ;Display the continue prompt.
"RTN","PSJOCDT",114,0)
 NEW DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,X
"RTN","PSJOCDT",115,0)
 W !
"RTN","PSJOCDT",116,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")=$S($D(PSJDGCK):"Do you wish to continue",1:"Do you wish to continue with the current order")
"RTN","PSJOCDT",117,0)
 S DIR("?",1)="Enter 'NO' if you wish to not continue with the order,",DIR("?")="or 'YES' to continue with the current order."
"RTN","PSJOCDT",118,0)
 D ^DIR
"RTN","PSJOCDT",119,0)
 I 'Y!($G(PSJDGCK)) S PSGORQF=1 S VALMBCK="R"
"RTN","PSJOCDT",120,0)
 Q
"RTN","PSJOCDT",121,0)
DCPROMPT() ;Prompt if user wants to DC order(s)
"RTN","PSJOCDT",122,0)
 NEW DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,X
"RTN","PSJOCDT",123,0)
 W !
"RTN","PSJOCDT",124,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you wish to DISCONTINUE any of the listed INPATIENT orders"
"RTN","PSJOCDT",125,0)
 S DIR("?",1)="Enter 'NO' if you don't wish to discontinue any of the order(s),",DIR("?")="or 'YES' to discontinue selected order(s)."
"RTN","PSJOCDT",126,0)
 D ^DIR
"RTN","PSJOCDT",127,0)
 Q Y
"RTN","PSJOCDT",128,0)
SORTLST() ;Sort orders into a numeric list
"RTN","PSJOCDT",129,0)
 NEW DIR,DIRUT,DTOUT,DUOUT,PSJN,PSJPON1,PSJMONV,PSJS,PSJSEV1,PSJX,X,Y,PSJDNM,PSJPONX,PSJDSPON,PSOCLINF
"RTN","PSJOCDT",130,0)
 ;Sort orders into a numeric list
"RTN","PSJOCDT",131,0)
 Q:'$D(PSJOCDT(10)) 0
"RTN","PSJOCDT",132,0)
 S PSJN=0,PSJDNM=""
"RTN","PSJOCDT",133,0)
 F  S PSJDNM=$O(PSJOCDT(10,PSJDNM)) Q:PSJDNM=""  S PSJS="" F  S PSJS=$O(PSJOCDT(10,PSJDNM,PSJS)) Q:PSJS=""  D
"RTN","PSJOCDT",134,0)
 . S PSJPONX=$P(PSJS,";",2)
"RTN","PSJOCDT",135,0)
 . I $D(PSJDSPON(PSJPONX)) Q
"RTN","PSJOCDT",136,0)
 .; S PSJCLINF="",PSJCLINF=PSJOCDT(10,PSJDNM,PSJS)
"RTN","PSJOCDT",137,0)
 . S PSJDSPON(PSJPONX)=""
"RTN","PSJOCDT",138,0)
 . S PSJN=PSJN+1
"RTN","PSJOCDT",139,0)
 . S PSJOCDTL(PSJN)=PSJPONX
"RTN","PSJOCDT",140,0)
 .; S:'$P(PSJCLINF,";",2) PSJOCDTL(PSJN)=PSJPONX ; rule: don't show clinic orders in the "to be DC'ed" list
"RTN","PSJOCDT",141,0)
 Q PSJN
"RTN","PSJOCDT",142,0)
LST() ;
"RTN","PSJOCDT",143,0)
 ;Only present the list if there are more than 1 orders the list
"RTN","PSJOCDT",144,0)
 F PSJX=0:0 S PSJX=$O(PSJOCDTL(PSJX)) Q:'PSJX  D
"RTN","PSJOCDT",145,0)
 . I ($Y+6)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",146,0)
 . D DSPORD^PSJOC(PSJOCDTL(PSJX),PSJX_".  ")
"RTN","PSJOCDT",147,0)
 W !
"RTN","PSJOCDT",148,0)
 K DIR S DIR(0)="LO^1:"_$O(PSJOCDTL(""),-1),DIR("A")="Enter a list or range of numbers to discontinue" D ^DIR
"RTN","PSJOCDT",149,0)
 Q Y
"RTN","PSJOCDT",150,0)
PROCLST(PSJY) ;DC the orders selected by user
"RTN","PSJOCDT",151,0)
 NEW PSJX,PSJX1,PSJON,PSJCLINF
"RTN","PSJOCDT",152,0)
 F PSJX1=1:1:$L(PSJY) S PSJX=$P(PSJY,",",PSJX1) Q:PSJX=""  D
"RTN","PSJOCDT",153,0)
 . I ($Y+8)>IOSL D PAUSE^PSJMISC() W @IOF
"RTN","PSJOCDT",154,0)
 . I '$D(PSJOCDTL(PSJX)) Q
"RTN","PSJOCDT",155,0)
 . S PSJON=PSJOCDTL(PSJX),PSJCLINF=0
"RTN","PSJOCDT",156,0)
 . I $D(PSJOCDTL(PSJX,"CLN")) S PSJCLINF=$P(PSJOCDTL(PSJX,"CLN"),"^"),PSJCLINF(2)=$P(PSJOCDTL(PSJX,"CLN"),"^",2),PSJCLINF(3)=$P(PSJOCDTL(PSJX,"CLN"),"^",3)
"RTN","PSJOCDT",157,0)
 . D DC^PSJOCDC(PSGP,PSJON,.PSJCLINF)
"RTN","PSJOCDT",158,0)
 . W !
"RTN","PSJOCDT",159,0)
 Q
"RTN","PSJUTL1")
0^3^B56131679^B55397965
"RTN","PSJUTL1",1,0)
PSJUTL1 ;BIR/MLM-MISC. INPATIENT UTILITIES ;29 Jul 98 / 4:29 PM
"RTN","PSJUTL1",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**15,50,58,260**;16 DEC 97;Build 94
"RTN","PSJUTL1",3,0)
 ;
"RTN","PSJUTL1",4,0)
 ; Reference to ^PSSLOCK is supported by DBIA# 2789.
"RTN","PSJUTL1",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJUTL1",6,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJUTL1",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJUTL1",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJUTL1",9,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSJUTL1",10,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJUTL1",11,0)
 ; Reference to ^XPD(9.7 is supported by DBIA# 2197.
"RTN","PSJUTL1",12,0)
 ; Reference to ^PSSDIUTL is supported by DBIA# 5737.
"RTN","PSJUTL1",13,0)
 ;
"RTN","PSJUTL1",14,0)
CONVERT(DFN,TYPE) ;
"RTN","PSJUTL1",15,0)
 ; Convert existing UD orders to new format. Only run once/patient, and
"RTN","PSJUTL1",16,0)
 ; only converts orders with a stop date<(5.0 Install date-365)
"RTN","PSJUTL1",17,0)
 ;  DFN = Patient IEN
"RTN","PSJUTL1",18,0)
 ; TYPE = Background or Interactive mode
"RTN","PSJUTL1",19,0)
 ;
"RTN","PSJUTL1",20,0)
 S TYPE=TYPE&($E($G(IOST))="C")
"RTN","PSJUTL1",21,0)
 ;I '$D(^PS(55,DFN,0))!($P($G(^PS(55,DFN,5.1)),U,11)=1) Q
"RTN","PSJUTL1",22,0)
 ;I $S($P($G(^PS(55,DFN,5.1)),U,11)=1:1,$O(^PS(55,DFN,"IV",0)):0,$O(^PS(55,DFN,5,0)):0,1:'$O(^PS(53.1,"C",DFN,0))) Q
"RTN","PSJUTL1",23,0)
 I $P($G(^PS(55,DFN,5.1)),U,11)=1 Q
"RTN","PSJUTL1",24,0)
 N ADS,ADS1,DDRG,ND,ON,ON1,PSGDT,PSJOI,STAT,STPDT,STS,X,XX,X1,X2
"RTN","PSJUTL1",25,0)
 ;I '$D(^PS(55,DFN,0)) D
"RTN","PSJUTL1",26,0)
 ;I '$D(^PS(55,DFN,0))&(($O(^PS(55,DFN,"IV",0)))!($O(^PS(55,DFN,5,0)))!($O(^PS(53.1,"C",DFN,0)))) D
"RTN","PSJUTL1",27,0)
 I '$D(^PS(55,DFN,0))&($D(^PS(55,DFN))!($O(^PS(53.1,"C",DFN,0)))) D
"RTN","PSJUTL1",28,0)
 .N X,Y,DA,DIK S ^PS(55,DFN,0)=DFN K DIK S DA=DFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK
"RTN","PSJUTL1",29,0)
 ;I TYPE W !!,"Converting old orders for ",$P($G(^DPT(DFN,0)),U)," to new format."
"RTN","PSJUTL1",30,0)
 S X1=$P($G(^PS(59.7,1,20)),U,2),X2=-365 I 'X1 D NOW^%DTC S X1=$P(%,".")
"RTN","PSJUTL1",31,0)
 D C^%DTC S PSGDT=X
"RTN","PSJUTL1",32,0)
 ;Convert and Backfill orders in 53.1.
"RTN","PSJUTL1",33,0)
 F STAT="D","DE","N","P","U" S STS=$O(^PS(53.1,"AS",STAT)) F ON=0:0 S ON=$O(^PS(53.1,"AS",STAT,DFN,ON)) Q:'ON  I '$G(^PS(53.1,ON,.2)) D
"RTN","PSJUTL1",34,0)
 .S PSJOI="",ND=$G(^PS(53.1,+ON,.1)),DDRG=+$G(^PS(53.1,ON,1,+$O(^PS(53.1,ON,1,0)),0)) S:DDRG PSJOI=+$G(^PSDRUG(DDRG,2))
"RTN","PSJUTL1",35,0)
 .I 'PSJOI F DDRG=0:0 S DDRG=$O(^PSDRUG("AP",+ND,DDRG)) Q:'DDRG!PSJOI  S PSJOI=+$G(^PSDRUG(DDRG,2)) D
"RTN","PSJUTL1",36,0)
 .; convert pending UD orders that have "I" in 4th piece for TYPE
"RTN","PSJUTL1",37,0)
 .I STAT="P",($P($G(^PS(53.1,ON,0)),"^",4)="I"),(PSJOI) S $P(^PS(53.1,ON,0),"^",4)=$$CNV2(PSJOI)
"RTN","PSJUTL1",38,0)
 .I PSJOI S ^PS(53.1,ON,.2)=PSJOI_U_$P(ND,U,2) W:TYPE "."
"RTN","PSJUTL1",39,0)
 .I PSJOI!($P($G(^PS(53.1,+ON,0)),U,4)="F") D EN1^PSJHL2(DFN,"ZC",ON_"P")
"RTN","PSJUTL1",40,0)
 .; convert order location codes for ^PS(53.1
"RTN","PSJUTL1",41,0)
 .K PSJXX S PSJXX=$G(^PS(53.1,ON,0)) I $L(PSJXX) S $P(PSJXX,"^",25,26)=$$CNV($P(PSJXX,"^",25))_"^"_$$CNV($P(PSJXX,"^",26)) S ^(0)=PSJXX K PSJXX
"RTN","PSJUTL1",42,0)
 ;Convert and Backfill UD orders.
"RTN","PSJUTL1",43,0)
 F STPDT=PSGDT:0 S STPDT=$O(^PS(55,DFN,5,"AUS",STPDT)) Q:'STPDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",STPDT,ON)) Q:'ON  I '$G(^PS(55,DFN,5,ON,.2)) D
"RTN","PSJUTL1",44,0)
 .S PSJOI="",ND=$G(^PS(55,DFN,5,+ON,.1)),DDRG=$O(^PS(55,DFN,5,ON,1,0)),XX=+$G(^PS(55,DFN,5,ON,1,+DDRG,0)) S:XX PSJOI=+$G(^PSDRUG(XX,2))
"RTN","PSJUTL1",45,0)
 .I 'PSJOI F DDRG=0:0 S DDRG=$O(^PSDRUG("AP",+ND,DDRG)) Q:'DDRG!PSJOI  S PSJOI=+$G(^PSDRUG(DDRG,2))
"RTN","PSJUTL1",46,0)
 .I PSJOI S ^PS(55,DFN,5,ON,.2)=PSJOI_U_$P(ND,U,2) W:TYPE "." D EN1^PSJHL2(DFN,"ZC",ON_"U")
"RTN","PSJUTL1",47,0)
 .; convert order location codes for Unit Dose orders
"RTN","PSJUTL1",48,0)
 .K PSJXX S PSJXX=$G(^PS(55,DFN,5,ON,0)) I $L(PSJXX) S $P(PSJXX,"^",25,26)=$$CNV($P(PSJXX,"^",25))_"^"_$$CNV($P(PSJXX,"^",26)) S ^(0)=PSJXX K PSJXX
"RTN","PSJUTL1",49,0)
 ;Convert and Backfill IV orders.
"RTN","PSJUTL1",50,0)
 F STPDT=PSGDT:0 S STPDT=$O(^PS(55,DFN,"IV","AIS",STPDT)) Q:'STPDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",STPDT,ON)) Q:'ON  I '$G(^PS(55,DFN,"IV",ON,.2)) D
"RTN","PSJUTL1",51,0)
 .S PSJOI="",ND=$G(^PS(55,DFN,"IV",ON,6)) F ADS="AD","SOL" I 'PSJOI F ON1=0:0 S ON1=$O(^PS(55,DFN,"IV",ON,ADS,ON1))  Q:'ON1!PSJOI  S XX=+$G(^PS(55,DFN,"IV",ON,ADS,ON1,0)) D
"RTN","PSJUTL1",52,0)
 ..S:XX PSJOI=$S(ADS="AD":$P($G(^PS(52.6,XX,0)),U,11),1:$P($G(^PS(52.7,XX,0)),U,11)) I PSJOI  S ^PS(55,DFN,"IV",ON,.2)=PSJOI_U_$P(ND,U,2,3) W:TYPE "."
"RTN","PSJUTL1",53,0)
 .S PSJ200=$P($G(^PS(55,DFN,"IV",ON,2)),U,3) Q:PSJ200=""
"RTN","PSJUTL1",54,0)
 .S X=$O(^VA(200,"B",PSJ200,0)),XX=$O(^VA(200,"B",PSJ200,X))
"RTN","PSJUTL1",55,0)
 .I 'X!XX S ^XTMP("PSJ NEW PERSON",PSJ200,DFN,ON)="" Q
"RTN","PSJUTL1",56,0)
 .S $P(^PS(55,DFN,"IV",ON,2),U,11)=X
"RTN","PSJUTL1",57,0)
 .D EN1^PSJHL2(DFN,"ZC",ON_"V")
"RTN","PSJUTL1",58,0)
 .; convert order location codes for IVs
"RTN","PSJUTL1",59,0)
 .K PSJXX S PSJXX=$G(^PS(55,DFN,"IV",ON,2)) I $L(PSJXX) S $P(PSJXX,"^",5,6)=$$CNV($P(PSJXX,"^",5))_"^"_$$CNV($P(PSJXX,"^",6)) S ^(2)=PSJXX K PSJXX
"RTN","PSJUTL1",60,0)
 ;Delete Unreleased entries after converting.
"RTN","PSJUTL1",61,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","U",DFN,ON)) Q:'ON  I $G(^PS(53.1,ON,.2)) S DIK="^PS(53.1,",DA=ON D ^DIK K DIK
"RTN","PSJUTL1",62,0)
 S:$D(^PS(55,DFN,0)) $P(^PS(55,DFN,5.1),U,11)=1
"RTN","PSJUTL1",63,0)
 Q
"RTN","PSJUTL1",64,0)
 ;
"RTN","PSJUTL1",65,0)
NFWS(DFN,ON,PSJPWD)       ; Determine if order is NF or WS
"RTN","PSJUTL1",66,0)
 ;Input: DFN - Patient IEN
"RTN","PSJUTL1",67,0)
 ;        ON - Order #_Order Code
"RTN","PSJUTL1",68,0)
 ;    PSJPWD - IEN of patient's ward
"RTN","PSJUTL1",69,0)
 ; Where Order Code IDs order location ("P":53.1; "U":55.06,1:55.01)
"RTN","PSJUTL1",70,0)
 ;Output: NF flag^WS flag^Self Med^Hosp Supplied Self Med
"RTN","PSJUTL1",71,0)
 N ND
"RTN","PSJUTL1",72,0)
 Q:$S(ON["U":0,1:ON'["P") ""
"RTN","PSJUTL1",73,0)
 ;S PSJPWD="",X=$P($G(^DPT(DFN,.1)),U) I X]"" S PSJPWD=$O(^DIC(42,"B",X,0))
"RTN","PSJUTL1",74,0)
 S PSJ="",PSJREF=$S(ON["P":"^PS(53.1,",1:"^PS(55,"_DFN_",5,")_+ON_","
"RTN","PSJUTL1",75,0)
 F PSJDD=0:0 S PSJDD=$O(@(PSJREF_"1,"_PSJDD_")")) Q:'PSJDD  S ND=$G(^(PSJDD,0)) D CHKDD
"RTN","PSJUTL1",76,0)
 S $P(PSJ,U,3,4)=$P($G(@(PSJREF_"0)")),U,5,6)
"RTN","PSJUTL1",77,0)
 Q PSJ
"RTN","PSJUTL1",78,0)
 ;
"RTN","PSJUTL1",79,0)
CHKDD ; Determine if dispense drug is NF or WS
"RTN","PSJUTL1",80,0)
 ;
"RTN","PSJUTL1",81,0)
 S:$P($G(^PSDRUG(+ND,0)),U,9) $P(PSJ,U)=1
"RTN","PSJUTL1",82,0)
 S:$$WSCHK^PSJO(PSJPWD,+ND) $P(PSJ,U,2)=1
"RTN","PSJUTL1",83,0)
 Q
"RTN","PSJUTL1",84,0)
FIND ;
"RTN","PSJUTL1",85,0)
 F DFN=0:0 S DFN=$O(^PS(55,DFN)) Q:'DFN  D
"RTN","PSJUTL1",86,0)
 .I $O(^PS(55,DFN,5,0))!$O(^PS(55,DFN,"IV",0)) D
"RTN","PSJUTL1",87,0)
 ..I '$P($G(^PS(55,DFN,5.1)),U,11) W !,DFN
"RTN","PSJUTL1",88,0)
 Q
"RTN","PSJUTL1",89,0)
 ;
"RTN","PSJUTL1",90,0)
CNV(PSJM)          ; converts order location codes to just 'U' 'P' and 'V'
"RTN","PSJUTL1",91,0)
 I PSJM="" Q PSJM
"RTN","PSJUTL1",92,0)
 I PSJM["V" Q PSJM
"RTN","PSJUTL1",93,0)
 I PSJM["A"!(PSJM["O") Q ($E(PSJM,1,$L(+PSJM))_"U")
"RTN","PSJUTL1",94,0)
 I PSJM["N"!(PSJM["P") Q ($E(PSJM,1,$L(+PSJM))_"P")
"RTN","PSJUTL1",95,0)
 Q PSJM
"RTN","PSJUTL1",96,0)
CNV2(IEN507)          ; converts pending orders with 3rd piece set to "I"
"RTN","PSJUTL1",97,0)
 ;            is the orderable item marked for IV ?
"RTN","PSJUTL1",98,0)
 I $P($G(^PS(50.7,IEN507,0)),"^",3)=1 Q "I"
"RTN","PSJUTL1",99,0)
 E  Q "U"
"RTN","PSJUTL1",100,0)
 Q
"RTN","PSJUTL1",101,0)
CNIV(DFN)    ;Converts OI on active and pending IV orders for POE
"RTN","PSJUTL1",102,0)
 ;for all patients or a selected patient
"RTN","PSJUTL1",103,0)
 NEW ON,PSGDT,STPDT,START,PSJX
"RTN","PSJUTL1",104,0)
 I $G(DFN) D  Q:PSJX>1
"RTN","PSJUTL1",105,0)
 . S PSJX=$P($G(^PS(55,DFN,5.1)),U,11)
"RTN","PSJUTL1",106,0)
 . Q:PSJX=3
"RTN","PSJUTL1",107,0)
 . I PSJX=2 D MARKIV^PSJUTL3(DFN) Q
"RTN","PSJUTL1",108,0)
 ;I '$D(^XTMP("PSSCONA")),'$D(^XTMP("PSSCONS")) Q
"RTN","PSJUTL1",109,0)
 D NOW^%DTC S START=%
"RTN","PSJUTL1",110,0)
 S X1=DT_".0001",X2=-365
"RTN","PSJUTL1",111,0)
 D C^%DTC S PSGDT=X
"RTN","PSJUTL1",112,0)
 I $G(DFN) D CNIV1(DFN),MARKIV^PSJUTL3(DFN) Q
"RTN","PSJUTL1",113,0)
 NEW DFN
"RTN","PSJUTL1",114,0)
 F DFN=0:0 S DFN=$O(^PS(55,DFN)) Q:'DFN  D CNIV1(DFN),MARKIV^PSJUTL3(DFN)
"RTN","PSJUTL1",115,0)
 D ENIVUD^PSJ0050
"RTN","PSJUTL1",116,0)
 D SEND
"RTN","PSJUTL1",117,0)
 Q
"RTN","PSJUTL1",118,0)
CNIV1(DFN)   ;
"RTN","PSJUTL1",119,0)
 ;I $P($G(^PS(55,DFN,5.1)),U,11)=2 Q
"RTN","PSJUTL1",120,0)
 Q:'$$L^PSSLOCK(DFN,0)
"RTN","PSJUTL1",121,0)
 S $P(^PS(55,DFN,5.1),U,11)=2
"RTN","PSJUTL1",122,0)
 I '$D(^XTMP("PSSCONA")),'$D(^XTMP("PSSCONS")) D UL^PSSLOCK(DFN) Q
"RTN","PSJUTL1",123,0)
 F STPDT=PSGDT:0 S STPDT=$O(^PS(55,DFN,"IV","AIS",STPDT)) Q:'STPDT  D
"RTN","PSJUTL1",124,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",STPDT,ON)) Q:'ON  D IVCHK
"RTN","PSJUTL1",125,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","P",DFN,ON)) Q:'ON  D PENDING
"RTN","PSJUTL1",126,0)
 D UL^PSSLOCK(DFN)
"RTN","PSJUTL1",127,0)
 Q
"RTN","PSJUTL1",128,0)
IVCHK ;Match AD/SOL against Xtmp
"RTN","PSJUTL1",129,0)
 NEW PSJAD,PSJCNR,PSJOI,PSJSOL,PSJXAD,PSJXNOI,PSJXSOL
"RTN","PSJUTL1",130,0)
 S PSJOI=+$G(^PS(55,DFN,"IV",ON,.2)) Q:'+PSJOI
"RTN","PSJUTL1",131,0)
 ;
"RTN","PSJUTL1",132,0)
 ;Set local array for AD/SOL from the order
"RTN","PSJUTL1",133,0)
 F PSJAD=0:0 S PSJAD=$O(^PS(55,DFN,"IV",ON,"AD",PSJAD)) Q:'PSJAD  D
"RTN","PSJUTL1",134,0)
 . I $G(^PS(55,DFN,"IV",ON,"AD",PSJAD,0)) S PSJAD(+^(0))=""
"RTN","PSJUTL1",135,0)
 F PSJSOL=0:0 S PSJSOL=$O(^PS(55,DFN,"IV",ON,"SOL",PSJSOL)) Q:'PSJSOL  D
"RTN","PSJUTL1",136,0)
 . I $G(^PS(55,DFN,"IV",ON,"SOL",PSJSOL,0)) S PSJSOL(+^(0))=""
"RTN","PSJUTL1",137,0)
 D MATCH,UPD(ON_"V")
"RTN","PSJUTL1",138,0)
 Q
"RTN","PSJUTL1",139,0)
 ;
"RTN","PSJUTL1",140,0)
MATCH ;If AD/SOL from XTMP matches to AD/SOL within the order, set new OI array
"RTN","PSJUTL1",141,0)
 K PSJXNOI
"RTN","PSJUTL1",142,0)
 F PSJXAD=0:0 S PSJXAD=$O(^XTMP("PSSCONA",+PSJOI,PSJXAD)) Q:'PSJXAD  D
"RTN","PSJUTL1",143,0)
 . I $D(PSJAD(PSJXAD)) S PSJXNOI(+^XTMP("PSSCONA",+PSJOI,PSJXAD))=""
"RTN","PSJUTL1",144,0)
 F PSJXSOL=0:0 S PSJXSOL=$O(^XTMP("PSSCONS",+PSJOI,PSJXSOL)) Q:'PSJXSOL  D
"RTN","PSJUTL1",145,0)
 . I $D(PSJSOL(PSJXSOL)) S PSJXNOI(+^XTMP("PSSCONS",+PSJOI,PSJXSOL))=""
"RTN","PSJUTL1",146,0)
 Q
"RTN","PSJUTL1",147,0)
 ;
"RTN","PSJUTL1",148,0)
UPD(ON) ;Loop thru the new OI array
"RTN","PSJUTL1",149,0)
 NEW PSJCNT S PSJCNT=0
"RTN","PSJUTL1",150,0)
 F X=0:0 S X=$O(PSJXNOI(X)) Q:'X  S PSJCNT=PSJCNT+1
"RTN","PSJUTL1",151,0)
 I PSJCNT=1 D
"RTN","PSJUTL1",152,0)
 . S PSJXNOI=$O(PSJXNOI(0))
"RTN","PSJUTL1",153,0)
 . I +PSJOI=PSJXNOI Q
"RTN","PSJUTL1",154,0)
 . S X=$P($G(^PS(50.7,PSJXNOI,0)),U,4)
"RTN","PSJUTL1",155,0)
 . I X]"",(X'>DT) Q
"RTN","PSJUTL1",156,0)
 . ;/W !,"DFN: ",DFN," ON: ",ON," NEW OI: ",PSJXNOI
"RTN","PSJUTL1",157,0)
 . S:ON["V" $P(^PS(55,DFN,"IV",+ON,.2),U,1)=+PSJXNOI
"RTN","PSJUTL1",158,0)
 . S:ON["P" $P(^PS(53.1,+ON,.2),U,1)=+PSJXNOI
"RTN","PSJUTL1",159,0)
 . D EN1^PSJHL2(DFN,"ZC",ON)
"RTN","PSJUTL1",160,0)
 . D EN^PSJ0050(DFN,+ON,+PSJOI,PSJXNOI)
"RTN","PSJUTL1",161,0)
 Q
"RTN","PSJUTL1",162,0)
PENDING ;Converting Pending IV order with Ad/Sol
"RTN","PSJUTL1",163,0)
 NEW PSJAD,PSJOI,PSJSOL,PSJXNOI
"RTN","PSJUTL1",164,0)
 S X=$P($G(^PS(53.1,ON,0)),U,4) I $S(X="I":0,X="F":0,1:1) Q
"RTN","PSJUTL1",165,0)
 S PSJOI=+$G(^PS(53.1,ON,.2)) Q:'+PSJOI
"RTN","PSJUTL1",166,0)
 ;
"RTN","PSJUTL1",167,0)
 ;If pending has no AD/SOL, and on 1 new OI matched to old OI then update.
"RTN","PSJUTL1",168,0)
 I '$D(^PS(53.1,ON,"AD")),'$D(^PS(53.1,ON,"SOL")) D  Q
"RTN","PSJUTL1",169,0)
 . F X=0:0 S X=$O(^XTMP("PSSCONA",PSJOI,X)) Q:'X  S PSJXNOI(+^(X))=""
"RTN","PSJUTL1",170,0)
 . F X=0:0 S X=$O(^XTMP("PSSCONS",PSJOI,X)) Q:'X  S PSJXNOI(+^(X))=""
"RTN","PSJUTL1",171,0)
 . D UPD(ON_"P")
"RTN","PSJUTL1",172,0)
 ;
"RTN","PSJUTL1",173,0)
 ;Loop thru the pending AD/SOL
"RTN","PSJUTL1",174,0)
 F PSJAD=0:0 S PSJAD=$O(^PS(53.1,ON,"AD",PSJAD)) Q:'PSJAD  D
"RTN","PSJUTL1",175,0)
 . I $G(^PS(53.1,ON,"AD",PSJAD,0)) S PSJAD(+^(0))=""
"RTN","PSJUTL1",176,0)
 F PSJSOL=0:0 S PSJSOL=$O(^PS(55,ON,"SOL",PSJSOL)) Q:'PSJSOL  D
"RTN","PSJUTL1",177,0)
 . I $G(^PS(53.1,ON,"SOL",PSJSOL,0)) S PSJSOL(+^(0))=""
"RTN","PSJUTL1",178,0)
 D MATCH,UPD(ON_"P")
"RTN","PSJUTL1",179,0)
 Q
"RTN","PSJUTL1",180,0)
SEND ;Send mail message
"RTN","PSJUTL1",181,0)
 NEW DIFROM,XMDUZ,XMSUB,XMTEXT,XMY,STOP,LINE
"RTN","PSJUTL1",182,0)
 D NOW^%DTC S STOP=%
"RTN","PSJUTL1",183,0)
 S LINE(1)="The conversion was first started:  "_$$FMTE^XLFDT(START)
"RTN","PSJUTL1",184,0)
 S LINE(2)="It ran to completion:              "_$$FMTE^XLFDT(STOP)
"RTN","PSJUTL1",185,0)
 S XMSUB="Inpatient Meds IV conversion",XMTEXT="LINE("
"RTN","PSJUTL1",186,0)
 S XMDUZ="Inpatient Meds POE"
"RTN","PSJUTL1",187,0)
 S XMY(+DUZ)="" D ^XMD
"RTN","PSJUTL1",188,0)
 Q
"RTN","PSJUTL1",189,0)
PSSDGCK ;Run Drug Check Util
"RTN","PSJUTL1",190,0)
 D ^PSSDIUTL
"RTN","PSJUTL1",191,0)
 Q
"RTN","PSJUTL1",192,0)
INSTLDT() ;Return the date PSJ*5*58 was first installed
"RTN","PSJUTL1",193,0)
 NEW DIC,X,Y
"RTN","PSJUTL1",194,0)
 S X=$O(^XPD(9.7,"B","PSJ*5.0*58",0))
"RTN","PSJUTL1",195,0)
 Q:'+X ""
"RTN","PSJUTL1",196,0)
 S DIC="^XPD(9.7,",DIC(0)="NZ" D ^DIC
"RTN","PSJUTL1",197,0)
 Q $P($G(Y(0)),U,3)
"RTN","PSJUTL5")
0^24^B22923563^B20944683
"RTN","PSJUTL5",1,0)
PSJUTL5 ;BIR/MLM-UTILITY TO HANDLE NATURE OF ORDER FOR OE/RR ; 3/22/10 1:53pm
"RTN","PSJUTL5",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**40,218,260**;16 DEC 97;Build 94
"RTN","PSJUTL5",3,0)
 ;
"RTN","PSJUTL5",4,0)
ENNOO(X) ; nature of order (for oe/rr)
"RTN","PSJUTL5",5,0)
 ; X - Action taken on order.
"RTN","PSJUTL5",6,0)
 N Y S Y="W" I 'PSJSYSU Q Y
"RTN","PSJUTL5",7,0)
 K Y N DA,DIR,ACT S ACT=X
"RTN","PSJUTL5",8,0)
 D FULL^VALM1
"RTN","PSJUTL5",9,0)
 I $G(ACT)]"" D @ACT
"RTN","PSJUTL5",10,0)
 E  S Y=-1 Q Y
"RTN","PSJUTL5",11,0)
 Q:$D(Y) Y
"RTN","PSJUTL5",12,0)
 S DIR("A")="NATURE OF ORDER: ",DIR("B")="WRITTEN"
"RTN","PSJUTL5",13,0)
 S DIR("?",1)="This specifies the nature of the order, how it originated, or how any",DIR("?",2)="action performed on the order originated."
"RTN","PSJUTL5",14,0)
 S DIR("?",3)="Nature of order controls whether CPRS will ask for a provider's signature",DIR("?",4)="for the order and whether a chart copy will be printed."
"RTN","PSJUTL5",15,0)
 S DIR("?")="Nature of order MUST be entered, but if the package sees the user as a ward clerk or pharmacy technician, the nature of order may only be written."
"RTN","PSJUTL5",16,0)
 S DIR("??")="^D HELP^PSJUTL5"
"RTN","PSJUTL5",17,0)
 D ^DIR I $D(DIRUT) K DIRUT S Y=-1 Q Y
"RTN","PSJUTL5",18,0)
 Q Y
"RTN","PSJUTL5",19,0)
 ;Sets DIR(0) based on action being taken.
"RTN","PSJUTL5",20,0)
N I $T(NA^ORX1)]"" S Y=$$NA^ORX1("W",0,"B","NATURE OF ORDER",0,"WVPSXDIE") S:Y'="^" Y=$P(Y,"^",3) S:Y="^" Y=-1 Q
"RTN","PSJUTL5",21,0)
 I $T(NA^ORX1)="" S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONED;S:SERVICE CORRECTION;X:REJECTED;D:DUPLICATE;I:POLICY;E:PHYSICIAN ENTERED;" Q
"RTN","PSJUTL5",22,0)
E I $T(NA^ORX1)]"" S Y=$$NA^ORX1("S",0,"B","NATURE OF ORDER",0,"WVPSXDIE") S:Y'="^" Y=$P(Y,"^",3) S:Y="^" Y=-1 Q
"RTN","PSJUTL5",23,0)
 I $T(NA^ORX1)="" S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONED;S:SERVICE CORRECTION;X:REJECTED;D:DUPLICATE;I:POLICY;E:PHYSICIAN ENTERED;" Q
"RTN","PSJUTL5",24,0)
R I $T(NA^ORX1)]"" S Y=$$NA^ORX1("W",0,"B","NATURE OF ORDER",0,"WVPSXDIE") S:Y'="^" Y=$P(Y,"^",3) S:Y="^" Y=-1 Q
"RTN","PSJUTL5",25,0)
 I $T(NA^ORX1)="" S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONED;S:SERVICE CORRECTION;X:REJECTED;D:DUPLICATE;I:POLICY;E:PHYSICIAN ENTERED;" Q
"RTN","PSJUTL5",26,0)
 ;*218 Added R to DC
"RTN","PSJUTL5",27,0)
D I $T(NA^ORX1)]"" S Y=$$NA^ORX1("W",0,"B","NATURE OF ORDER",0,"WVPSXDIER") S:Y'="^" Y=$P(Y,"^",3) S:Y="^" Y=-1 Q
"RTN","PSJUTL5",28,0)
 I $T(NA^ORX1)="" S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONED;S:SERVICE CORRECTION;X:REJECTED;D:DUPLICATE;I:POLICY;E:PHYSICIAN ENTERED;R:SERVICE REJECT;" Q
"RTN","PSJUTL5",29,0)
H I $T(NA^ORX1)]"" S Y=$$NA^ORX1("W",0,"B","NATURE OF ORDER",0,"WVPSDIE") S:Y'="^" Y=$P(Y,"^",3) S:Y="^" Y=-1 Q
"RTN","PSJUTL5",30,0)
 I $T(NA^ORX1)="" S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONED;S:SERVICE CORRECTION;D:DUPLICATE;I:POLICY;E:PHYSICIAN ENTERED;" Q
"RTN","PSJUTL5",31,0)
V I $T(NA^ORX1)]"" S Y=$$NA^ORX1("W",0,"B","NATURE OF ORDER",0,"WVPSXDIER") S:Y'="^" Y=$P(Y,"^",3) S:Y="^" Y=-1 Q
"RTN","PSJUTL5",32,0)
 I $T(NA^ORX1)="" S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONED;S:SERVICE CORRECTION;X:REJECTED;D:DUPLICATE;I:POLICY;E:PHYSICIAN ENTERED;R:SERVICE REJECT;" Q
"RTN","PSJUTL5",33,0)
 ;
"RTN","PSJUTL5",34,0)
HELP ;Extended Help
"RTN","PSJUTL5",35,0)
 W !?55,"Prompted for   Chart Copy",!?55,"Signature in   Printed?",!?55,"CPRS?",!
"RTN","PSJUTL5",36,0)
 D @$S("N^E^R^D"[ACT:"WH,VH,PH,SH,XH,DH,IH,EH",1:"WH,VH,PH,SH,DH,IH,EH") Q
"RTN","PSJUTL5",37,0)
WH W !?2,"Written",?12," - The source of the order is a written",?59,"No",?74,"No",!?15,"doctor's order." Q
"RTN","PSJUTL5",38,0)
VH W !?2,"Verbal",?12," - A doctor verbally requested the order.",?59,"Yes",?74,"Yes" Q
"RTN","PSJUTL5",39,0)
PH W !?2,"Telephoned",?12," - A doctor phoned the service to request",?59,"Yes",?74,"Yes",!?15,"the order." Q
"RTN","PSJUTL5",40,0)
SH W !?2,"Service",?12," - The service is discontinuing or adding",?59,"No",?74,"No",!?2,"Correction",?15,"new orders to carry out the intent of",!?15,"an order already received." Q
"RTN","PSJUTL5",41,0)
XH W !?2,"Rejected",?12," - The service discontinued the order",?59,"No",?74,"No",!?15,"because it was unable to perform the",!?15,"task." Q
"RTN","PSJUTL5",42,0)
DH W !?2,"Duplicate",?12," - This applies to orders that are",?59,"No",?74,"Yes",!?15,"discontinued because they are a",!?15,"duplicate of another order." Q
"RTN","PSJUTL5",43,0)
IH W !?2,"Policy",?12," - These are orders that are created as",?59,"No",?74,"Yes",!?15,"a matter of hospital policy." Q
"RTN","PSJUTL5",44,0)
EH W !?2,"Physician",?12," - These are orders that are entered by",?59,"Yes",?74,"Yes",!?2,"Entered",?15,"the ordering provider." Q
"VER")
8.0^22.0
"BLD",8512,6)
^242
**END**
**END**
