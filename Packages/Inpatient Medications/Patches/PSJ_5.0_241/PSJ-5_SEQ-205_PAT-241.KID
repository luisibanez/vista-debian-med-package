Released PSJ*5*241 SEQ #205
Extracted from mail message
**KIDS**:PSJ*5.0*241^

**INSTALL NAME**
PSJ*5.0*241
"BLD",8437,0)
PSJ*5.0*241^INPATIENT MEDICATIONS^0^3101008^y
"BLD",8437,1,0)
^^10^10^3100901^
"BLD",8437,1,1,0)
The purpose of this patch is to provide software bug fixes for Inpatient
"BLD",8437,1,2,0)
Medications to correct the display of various warning messages, and for
"BLD",8437,1,3,0)
the Non-Verified/Pending Orders Report to correct the order count and 
"BLD",8437,1,4,0)
patient list displays and to prevent a crash. This patch corrects the
"BLD",8437,1,5,0)
following issues:
"BLD",8437,1,6,0)
 
"BLD",8437,1,7,0)
-Category "^Other" can't be retrieved
"BLD",8437,1,8,0)
-Warning for Complex Orders
"BLD",8437,1,9,0)
-Dosage Ordered and Dispense Units do not match warning
"BLD",8437,1,10,0)
-Error in Order Summary of Non-Verified/Pending Orders Report
"BLD",8437,4,0)
^9.64PA^^
"BLD",8437,6.3)
10
"BLD",8437,"KRN",0)
^9.67PA^779.2^20
"BLD",8437,"KRN",.4,0)
.4
"BLD",8437,"KRN",.401,0)
.401
"BLD",8437,"KRN",.402,0)
.402
"BLD",8437,"KRN",.403,0)
.403
"BLD",8437,"KRN",.5,0)
.5
"BLD",8437,"KRN",.84,0)
.84
"BLD",8437,"KRN",3.6,0)
3.6
"BLD",8437,"KRN",3.8,0)
3.8
"BLD",8437,"KRN",9.2,0)
9.2
"BLD",8437,"KRN",9.8,0)
9.8
"BLD",8437,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",8437,"KRN",9.8,"NM",1,0)
PSGVBW^^0^B65649356
"BLD",8437,"KRN",9.8,"NM",2,0)
PSGVBWU^^0^B77076603
"BLD",8437,"KRN",9.8,"NM",3,0)
PSGOEV^^0^B64524901
"BLD",8437,"KRN",9.8,"NM",4,0)
PSJOE0^^0^B25720453
"BLD",8437,"KRN",9.8,"NM",5,0)
PSGVBW1^^0^B4852503
"BLD",8437,"KRN",9.8,"NM","B","PSGOEV",3)

"BLD",8437,"KRN",9.8,"NM","B","PSGVBW",1)

"BLD",8437,"KRN",9.8,"NM","B","PSGVBW1",5)

"BLD",8437,"KRN",9.8,"NM","B","PSGVBWU",2)

"BLD",8437,"KRN",9.8,"NM","B","PSJOE0",4)

"BLD",8437,"KRN",19,0)
19
"BLD",8437,"KRN",19,"NM",0)
^9.68A^^
"BLD",8437,"KRN",19.1,0)
19.1
"BLD",8437,"KRN",101,0)
101
"BLD",8437,"KRN",409.61,0)
409.61
"BLD",8437,"KRN",771,0)
771
"BLD",8437,"KRN",779.2,0)
779.2
"BLD",8437,"KRN",870,0)
870
"BLD",8437,"KRN",8989.51,0)
8989.51
"BLD",8437,"KRN",8989.52,0)
8989.52
"BLD",8437,"KRN",8994,0)
8994
"BLD",8437,"KRN","B",.4,.4)

"BLD",8437,"KRN","B",.401,.401)

"BLD",8437,"KRN","B",.402,.402)

"BLD",8437,"KRN","B",.403,.403)

"BLD",8437,"KRN","B",.5,.5)

"BLD",8437,"KRN","B",.84,.84)

"BLD",8437,"KRN","B",3.6,3.6)

"BLD",8437,"KRN","B",3.8,3.8)

"BLD",8437,"KRN","B",9.2,9.2)

"BLD",8437,"KRN","B",9.8,9.8)

"BLD",8437,"KRN","B",19,19)

"BLD",8437,"KRN","B",19.1,19.1)

"BLD",8437,"KRN","B",101,101)

"BLD",8437,"KRN","B",409.61,409.61)

"BLD",8437,"KRN","B",771,771)

"BLD",8437,"KRN","B",779.2,779.2)

"BLD",8437,"KRN","B",870,870)

"BLD",8437,"KRN","B",8989.51,8989.51)

"BLD",8437,"KRN","B",8989.52,8989.52)

"BLD",8437,"KRN","B",8994,8994)

"BLD",8437,"QUES",0)
^9.62^^
"BLD",8437,"REQB",0)
^9.611^4^4
"BLD",8437,"REQB",1,0)
PSJ*5.0*155^2
"BLD",8437,"REQB",2,0)
PSJ*5.0*162^2
"BLD",8437,"REQB",3,0)
PSJ*5.0*196^2
"BLD",8437,"REQB",4,0)
PSJ*5.0*207^2
"BLD",8437,"REQB","B","PSJ*5.0*155",1)

"BLD",8437,"REQB","B","PSJ*5.0*162",2)

"BLD",8437,"REQB","B","PSJ*5.0*196",3)

"BLD",8437,"REQB","B","PSJ*5.0*207",4)

"MBREQ")
0
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,20,0)
^9.402P^^
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
241^3101008
"PKG",203,22,1,"PAH",1,1,0)
^^10^10^3101008
"PKG",203,22,1,"PAH",1,1,1,0)
The purpose of this patch is to provide software bug fixes for Inpatient
"PKG",203,22,1,"PAH",1,1,2,0)
Medications to correct the display of various warning messages, and for
"PKG",203,22,1,"PAH",1,1,3,0)
the Non-Verified/Pending Orders Report to correct the order count and 
"PKG",203,22,1,"PAH",1,1,4,0)
patient list displays and to prevent a crash. This patch corrects the
"PKG",203,22,1,"PAH",1,1,5,0)
following issues:
"PKG",203,22,1,"PAH",1,1,6,0)
 
"PKG",203,22,1,"PAH",1,1,7,0)
-Category "^Other" can't be retrieved
"PKG",203,22,1,"PAH",1,1,8,0)
-Warning for Complex Orders
"PKG",203,22,1,"PAH",1,1,9,0)
-Dosage Ordered and Dispense Units do not match warning
"PKG",203,22,1,"PAH",1,1,10,0)
-Error in Order Summary of Non-Verified/Pending Orders Report
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PSGOEV")
0^3^B64524901^B64035774
"RTN","PSGOEV",1,0)
PSGOEV ;BIR/CML3-VERIFY (MAKE ACTIVE) ORDERS ; 4/16/10 9:18am
"RTN","PSGOEV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**5,7,15,28,33,50,64,58,77,78,80,110,111,133,171,207,241**;16 DEC 97;Build 10
"RTN","PSGOEV",3,0)
 ;
"RTN","PSGOEV",4,0)
 ; Reference to ^ORD(101 supported by DBIA #872.
"RTN","PSGOEV",5,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180.
"RTN","PSGOEV",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGOEV",7,0)
 ; Reference to ^PSSLOCK supported by DBIA #2789.
"RTN","PSGOEV",8,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA #2410.
"RTN","PSGOEV",9,0)
 ;
"RTN","PSGOEV",10,0)
EN(PSGORD) ;
"RTN","PSGOEV",11,0)
ENSF ; This entry point is used by Speed finish only.
"RTN","PSGOEV",12,0)
 ; Send SN update to CPRS if auto-verify off and from Order Set entry
"RTN","PSGOEV",13,0)
 S:'$D(PSGOEAV) PSGOEAV=$P($G(PSJSYSP0),"^",9)&$G(PSJSYSU)
"RTN","PSGOEV",14,0)
 I $D(PSGOES),'PSGOEAV,PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSGOEV",15,0)
 D FULL^VALM1 I 'PSJSYSU W $C(7),$C(7),!!," THIS FUNCTION NOT AVAILABLE TO WARD STAFF." Q
"RTN","PSGOEV",16,0)
 S CHK=0 I PSGORD["P" S X=$P($G(^PS(53.1,+PSGORD,0)),"^",19) I X,$D(^PS(55,PSGP,5,$P(^(0),"^",19))) S CHK=+PSGORD,PSGORD=X_"U" L -^PS(53.1,CHK) L +^PS(55,PSGP,5,+PSGORD):1 E  W !!,"Another terminal is editing this order." G DONE
"RTN","PSGOEV",17,0)
 I +PSJSYSU=3 D DDCHK G:CHK DONE
"RTN","PSGOEV",18,0)
 I PSGORD["P" D CHK($G(^PS(53.1,+PSGORD,0)),$G(^(.2)),$G(^(2)))
"RTN","PSGOEV",19,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOEV",20,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=1 S X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",21,0)
 I $G(CHK) Q:$D(PSJSPEED)  D EN^VALM("PSJU LM ACCEPT") G:'$G(PSJACEPT) DONE ;G VFY
"RTN","PSGOEV",22,0)
 I PSGORD["U" G:'$D(^PS(55,PSGP,5,+PSGORD,4)) VFY I +PSJSYSU=3,$P(^(4),"^",3) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A PHARMACIST." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",23,0)
 I PSGORD["U" I +PSJSYSU=1,+^PS(55,PSGP,5,+PSGORD,4) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A NURSE." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",24,0)
 ;
"RTN","PSGOEV",25,0)
VFY ; change status, move to 55, and change label record
"RTN","PSGOEV",26,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D VFY^PSJCOM Q
"RTN","PSGOEV",27,0)
 NEW PSJDOSE,PSJDSFLG
"RTN","PSGOEV",28,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEV",29,0)
 D FULL^VALM1 ;PSJ*5*241
"RTN","PSGOEV",30,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSGOEV",31,0)
 . S PSGOEEF(109)=1
"RTN","PSGOEV",32,0)
 . S PSJACEPT=0
"RTN","PSGOEV",33,0)
 . ;D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEV",34,0)
 D DDCHK G:CHK DONE
"RTN","PSGOEV",35,0)
 I $G(PSGSCH)]"",((",P,R,")'[(","_PSGST_",")) D  I CHK G DONE
"RTN","PSGOEV",36,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOEV",37,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!,"This is a 'DAY OF WEEK' schedule and MUST have admin times.",! D PAUSE^VALM1
"RTN","PSGOEV",38,0)
 I $G(PSGSCH)]"" D  I CHK G DONE
"RTN","PSGOEV",39,0)
 .N X,Y,PSGS0XT,PSGS0Y,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",40,0)
 W !,"...a few moments, please..."
"RTN","PSGOEV",41,0)
 I PSGORD["P" D
"RTN","PSGOEV",42,0)
 . N PND0,PSGORDR,PSJPRIO,PSJSCHED S PND0=^PS(53.1,+PSGORD,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D  Q
"RTN","PSGOEV",43,0)
 .. N OEORD,OOEORD,FILE55,FILE55N0 S FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSGOEV",44,0)
 .. S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,PSGORD,+$$LASTREN^PSJLMPRI(DFN,PSGORD))
"RTN","PSGOEV",45,0)
 .. S PSGORDP=PSGORD,DIE="^PS(53.1,",DA=+PSGORD,DR="28////A;104////@" W "." D ^DIE
"RTN","PSGOEV",46,0)
 .. D START^PSGOTR(PSGORD,+PSGORDR) I OEORD D
"RTN","PSGOEV",47,0)
 ... K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSGOEV",48,0)
 ... D EN1^PSJHL2(DFN,"SC",PSGORDR),EN^PSGPEN(PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSGOEV",49,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in 55
"RTN","PSGOEV",50,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEV",51,0)
 . S DIE="^PS(53.1,",DA=+PSGORD,DR="28////A" W "." D ^DIE,^PSGOT
"RTN","PSGOEV",52,0)
 . S PSJPRIO=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,.2)),"^",4),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,.2)),"^",4),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,.2)),"^",4))
"RTN","PSGOEV",53,0)
 . S PSJSCHED=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,2)),"^"),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,2)),"^"),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,0)),"^",15))
"RTN","PSGOEV",54,0)
 . I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCHED)="NOW")!($G(PSJSCHED)["STAT") D NOTIFY^PSJHL4(PSGORD,DFN,$G(PSJPRIO),$G(PSJSCHED))
"RTN","PSGOEV",55,0)
 . I $G(PSGRDTX)="" S PSGRDTX=$G(^PS(53.1,+PSGORDP,2.5))
"RTN","PSGOEV",56,0)
 S DA=+PSGORD,DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+22000 D ^PSGAL5 W "." S VND4=$G(^PS(55,PSGP,5,DA,4))
"RTN","PSGOEV",57,0)
 I $G(PSGRDTX) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Start Date",+$G(PSGRDTX))
"RTN","PSGOEV",58,0)
 I $P($G(PSGRDTX),U,3) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Stop Date",+$P($G(PSGRDTX),U,3))
"RTN","PSGOEV",59,0)
 N DUR,DURON S DURON=$S($G(PSGORD):$G(PSGORD),1:"") I DURON D
"RTN","PSGOEV",60,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",1:5),1),1:"")
"RTN","PSGOEV",61,0)
 I $G(DUR)]"" S $P(^PS(55,PSGP,5,+PSGORD,2.5),"^",2)=DUR
"RTN","PSGOEV",62,0)
 D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSGOEV",63,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSGOEV",64,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSGOEV",65,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",9):1,1:$P(VND4,"^",15)) D EN^PSGPEN(+PSGORD)
"RTN","PSGOEV",66,0)
 S $P(VND4,"^",+PSJSYSU=1+9)=1 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSGOEV",67,0)
 ;S $P(VND4,"^",+PSJSYSU=1+9)=1,$P(VND4,U,+PSJSYSU=3+9)=0
"RTN","PSGOEV",68,0)
 I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEV",69,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSGOEV",70,0)
 I '$P(VND4,U,9) S ^PS(55,"APV",PSGP,+PSGORD)=""
"RTN","PSGOEV",71,0)
 I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSGOEV",72,0)
 I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSGOEV",73,0)
 I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSGOEV",74,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSGOEV",75,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOEV",76,0)
 S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)="" S PSGACT="C"_$S('$D(^PS(55,PSGP,5,+PSGORD,4)):"E",$P(^(4),"^",16):"",1:"E")_"RS",PSGCANFL=2
"RTN","PSGOEV",77,0)
 S VALMBCK="Q" D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSGOEV",78,0)
 D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U")
"RTN","PSGOEV",79,0)
DONE ;
"RTN","PSGOEV",80,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSGOEV",81,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSGOEV",82,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSGOEV",83,0)
 .Q:Y="N"
"RTN","PSGOEV",84,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSGOEV",85,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X Q
"RTN","PSGOEV",86,0)
 ;
"RTN","PSGOEV",87,0)
LBL ;
"RTN","PSGOEV",88,0)
 Q
"RTN","PSGOEV",89,0)
 ;
"RTN","PSGOEV",90,0)
CHK(ND,DRG,ND2) ; checks for data in required fields
"RTN","PSGOEV",91,0)
 ; Input: ND  - ^(PS(53.1,PSGORD,0)
"RTN","PSGOEV",92,0)
 ;        DRG - ^(.2)
"RTN","PSGOEV",93,0)
 ;        ND2 - ^(2)
"RTN","PSGOEV",94,0)
 S CHK="" I DRG,$D(^PS(50.7,+DRG,0))
"RTN","PSGOEV",95,0)
 E  S CHK=1
"RTN","PSGOEV",96,0)
 I ND="" S CHK=CHK_23
"RTN","PSGOEV",97,0)
 E  S CHK=CHK_$S($P(ND,"^",3):"",1:2)_$S($P(ND,"^",7)]"":"",1:3)
"RTN","PSGOEV",98,0)
 ;The naked reference on the line below refers to the variable ND which is ^PS(53.1,PSGORD,0).
"RTN","PSGOEV",99,0)
 I ND2="" S CHK=CHK_$S('$D(^(0)):4,$P(^(0),"^",7)="OC":"",1:4)_56
"RTN","PSGOEV",100,0)
 E  S CHK=CHK_$S($P(ND2,"^")]"":"",ND="":4,$P(ND,"^",7)="OC":"",1:4)_$S($P(ND2,"^",2):"",1:5)_$S($P(ND2,"^",4):"",1:6)
"RTN","PSGOEV",101,0)
 I $$CHECK^PSGOE8(PSJSYSP),$P(DRG,U,2)="" S CHK=CHK_8
"RTN","PSGOEV",102,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSGOEV",103,0)
 S:'$$DDOK^PSGOE2("^PS(53.45,"_PSJSYSP_",2,",+DRG) CHK=CHK_7,(PSGDFLG,PSGDI)=1
"RTN","PSGOEV",104,0)
 S:'$$OIOK^PSGOE2(+DRG) PSGPFLG=1
"RTN","PSGOEV",105,0)
 I 'CHK,$G(PSGSCH)]"" D
"RTN","PSGOEV",106,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",107,0)
 Q:'CHK
"RTN","PSGOEV",108,0)
 W $C(7)
"RTN","PSGOEV",109,0)
 ;
"RTN","PSGOEV",110,0)
CHKM ;
"RTN","PSGOEV",111,0)
 D FULL^VALM1
"RTN","PSGOEV",112,0)
 ; changed to remove ^DD ref
"RTN","PSGOEV",113,0)
 W !!,"THE FOLLOWING ",$S($L(CHK)>1:"ARE",1:"IS")," EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:7 W:CHK[X !?5,$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG","^",X)
"RTN","PSGOEV",114,0)
 I CHK=7 W !,"Orders with no dispense drugs or multiple dispense drugs",!,"require dosage ordered"
"RTN","PSGOEV",115,0)
 W:CHK]"" !!,$S($L(CHK)>1:"THESE FIELDS ARE",1:"THIS FIELD IS")," NECESSARY FOR VERIFICATION."
"RTN","PSGOEV",116,0)
 N DIR S DIR(0)="E" D ^DIR I $D(DUOUT)!$D(DTOUT) S CHK=1 Q
"RTN","PSGOEV",117,0)
 Q
"RTN","PSGOEV",118,0)
 ;
"RTN","PSGOEV",119,0)
CONT() ;
"RTN","PSGOEV",120,0)
 NEW DIR,DIRUT,Y
"RTN","PSGOEV",121,0)
 W ! K DIR,DIRUT
"RTN","PSGOEV",122,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="Yes"
"RTN","PSGOEV",123,0)
 D ^DIR
"RTN","PSGOEV",124,0)
 Q Y
"RTN","PSGOEV",125,0)
 ;
"RTN","PSGOEV",126,0)
DDCHK ; dispense drug check
"RTN","PSGOEV",127,0)
 S DRGF="^PS("_$S(PSGORD["P":"53.1,"_+PSGORD,1:"55,"_PSGP_",5,"_+PSGORD)_",",CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSGOEV",128,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSGOEV",129,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSGOEV",130,0)
 Q:CHK=0
"RTN","PSGOEV",131,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSGOEV",132,0)
 ;
"RTN","PSGOEV",133,0)
DDEDIT ;
"RTN","PSGOEV",134,0)
 ;*** Remove all dispense drug for this order
"RTN","PSGOEV",135,0)
 K @(DRGF_"1)")
"RTN","PSGOEV",136,0)
 ; The naked reference below refers to the indirect full reference in DRGF_"1,"_Q_")", which is either ^PS(53.1,+PSGORD,Q) or ^PS(55,DFN,5,+PSGORD,Q)
"RTN","PSGOEV",137,0)
 K ^PS(53.45,PSJSYSP,2) S (X,Q)=0 F  S Q=$O(@(DRGF_"1,"_Q_")")) Q:'Q  S Y=$G(^(Q,0)),X=Q S ^PS(53.45,PSJSYSP,2,Q,0)=Y I Y S ^PS(53.45,PSJSYSP,2,"B",+Y,Q)=""
"RTN","PSGOEV",138,0)
 I X S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_X_"^"_X
"RTN","PSGOEV",139,0)
 D ENDRG^PSGOEF1(PSGPD,X)
"RTN","PSGOEV",140,0)
 I 'CHK S %X="^PS(53.45,"_PSJSYSP_",2,",%Y=DRGF_"1," D %XY^%RCR S $P(@(DRGF_"1,0)"),"^",2)=$S(DRGF[53.1:"53.11P",1:"55.07P")
"RTN","PSGOEV",141,0)
 K DRG,DRGF Q
"RTN","PSGOEV",142,0)
 ;
"RTN","PSGOEV",143,0)
AESCREEN() ;
"RTN","PSGOEV",144,0)
 ; Output: 0 - Required fields missing and DON'T allow accept
"RTN","PSGOEV",145,0)
 ;         1 - Required fields found.
"RTN","PSGOEV",146,0)
 Q:'$G(CHK) 1
"RTN","PSGOEV",147,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSGOEV",148,0)
 I Y="PSJU LM ACCEPT EDIT" Q 1
"RTN","PSGOEV",149,0)
 Q 0
"RTN","PSGOEV",150,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSGOEV",151,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSGOEV",152,0)
 ;PSGORD : IEN from 55
"RTN","PSGOEV",153,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSGOEV",154,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSGOEV",155,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSGOEV",156,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55.09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSGOEV",157,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSGOEV",158,0)
 Q
"RTN","PSGVBW")
0^1^B65649356^B60599815
"RTN","PSGVBW",1,0)
PSGVBW ;BIR/CML3,MV-VERIFY ORDERS BY WARD, WARD GROUP, OR PATIENT ; 5/25/10 12:00pm
"RTN","PSGVBW",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**5,16,39,59,62,67,58,81,80,110,111,133,139,155,241**;16 DEC 97;Build 10
"RTN","PSGVBW",3,0)
 ;
"RTN","PSGVBW",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGVBW",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177
"RTN","PSGVBW",6,0)
 ;
"RTN","PSGVBW",7,0)
 N PSJNEW,PSGPTMP,PPAGE,CL,CG S PSJNEW=1
"RTN","PSGVBW",8,0)
START ;
"RTN","PSGVBW",9,0)
 D ENCV^PSGSETU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",10,0)
 ;I ($P(PSJSYSU,";")=3)!($P(PSJSYSU,";",3)=2) 
"RTN","PSGVBW",11,0)
 D ^PSIVXU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",12,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSGVBW",13,0)
 I '$D(^XTMP("PSJPVNV")) D
"RTN","PSGVBW",14,0)
 .K DIR S DIR(0)="Y",DIR("A")="Display an Order Summary",DIR("B")="NO"
"RTN","PSGVBW",15,0)
 .S DIR("?",1)="Enter 'YES' to see a summary of orders by type and ward group",DIR("?")="or 'NO' to go directly to patient selection."
"RTN","PSGVBW",16,0)
 .D ^DIR K DIR Q:$D(DIRUT)!$D(DUOUT)  I Y D CNTORDRS^PSGVBWU
"RTN","PSGVBW",17,0)
 K ^TMP("PSJ",$J) S PSGPXN=0 D GTOOP G:$D(DIRUT) DONE L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE
"RTN","PSGVBW",18,0)
 S PSGSSH="VBW",PSGPXN=0,PSJPROT=$S($P(PSJSYSU,";",3)=3:3,$G(PSJRNF):3,$G(PSJIRNF):3,1:1)
"RTN","PSGVBW",19,0)
 S PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING")
"RTN","PSGVBW",20,0)
 F  K ^TMP("PSJSELECT",$J) D ^PSGSEL Q:"^"[PSGSS  F  S (PSGP,WD,WG)=0 S PSGPTMP=0,PPAGE=1 D @PSGSS Q:+Y'>0  D GO
"RTN","PSGVBW",21,0)
 ;
"RTN","PSGVBW",22,0)
DONE ;
"RTN","PSGVBW",23,0)
 K ^TMP("PSGVBW",$J),^TMP("PSJSELECT",$J),^TMP("PSJLIST",$J),^TMP("PSJON",$J)
"RTN","PSGVBW",24,0)
 K CHK,D0,DRGI,FQC,J,ND,ON,PN,PSGODT,PSGOEA,PSGOP,PSGSS,PSGSSH,RB,SD,ST,TM,WD,WDN,WG,PRI,PSJPNV,PSJCT,PSGCLF
"RTN","PSGVBW",25,0)
 K PSGODDD,PSGOEORF,PSJORL,PSJORPCL,PSJORTOU,PSJORVP,PSGTOL,PSJTOO,PSGUOW,PSGONV,PX,PSGOEAV,PSGPX,PSGVBWTO,PSGVBWW,PSJOPC,PSGOENOF,PSJPROT,PSJLM,PSJASK
"RTN","PSGVBW",26,0)
 L -^PS(53.45,PSJSYSP) G:$G(PSGPXN) ^PSGPER1 D ENKV^PSGSETU K ND Q
"RTN","PSGVBW",27,0)
 ;
"RTN","PSGVBW",28,0)
GO ;
"RTN","PSGVBW",29,0)
 I PSGSS'="P" W !,"...a few moments, please..." K ^TMP("PSGVBW",$J) D ARRAY K CHK,ON,PN,RB,SD,TM,WD,WDN,WG,X,Y
"RTN","PSGVBW",30,0)
 I PSGSS'="P",'$D(^TMP("PSGVBW",$J)) W !,$C(7),"NO ",PSGVBWW," ORDERS FOR ",$S(PSGSS="P":"PATIENT",PSGSS="L":"CLINIC GROUP",PSGSS="C":"CLINIC",1:"WARD"),$S(PSGSS="G":" GROUP",1:"")," SELECTED." Q
"RTN","PSGVBW",31,0)
 D ^PSGVBW0 Q
"RTN","PSGVBW",32,0)
 ;
"RTN","PSGVBW",33,0)
 ; look-ups on ward group, ward, or patient; depending on value of SS
"RTN","PSGVBW",34,0)
G ;
"RTN","PSGVBW",35,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD GROUP: "
"RTN","PSGVBW",36,0)
 S DIR("?")="^D GDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",37,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",38,0)
 ;S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: "
"RTN","PSGVBW",39,0)
GDIC ;
"RTN","PSGVBW",40,0)
 K DIC S DIC="^PS(57.5,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 WG=+Y
"RTN","PSGVBW",41,0)
 W:X["?" !!,"Enter ""^OTHER"" to include all orders from the wards that do not",!,"belong to a ward group, or orders that have neither a ward nor a clinic.",! ;PSJ*5*241: Updated help text
"RTN","PSGVBW",42,0)
 Q
"RTN","PSGVBW",43,0)
C ;
"RTN","PSGVBW",44,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGVBW",45,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",46,0)
CDIC ;
"RTN","PSGVBW",47,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y
"RTN","PSGVBW",48,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGVBW",49,0)
 Q
"RTN","PSGVBW",50,0)
L ;
"RTN","PSGVBW",51,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGVBW",52,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",53,0)
LDIC ;
"RTN","PSGVBW",54,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y
"RTN","PSGVBW",55,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGVBW",56,0)
 Q
"RTN","PSGVBW",57,0)
W ;
"RTN","PSGVBW",58,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD: "
"RTN","PSGVBW",59,0)
 S DIR("?")="^D WDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",60,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",61,0)
WDIC ;
"RTN","PSGVBW",62,0)
 ;S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: "
"RTN","PSGVBW",63,0)
 K DIC S DIC="^DIC(42,",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 WD=+Y
"RTN","PSGVBW",64,0)
 W:X["?" !!,"Enter ""^OTHER"" for Outpatient IV orders",!
"RTN","PSGVBW",65,0)
 Q
"RTN","PSGVBW",66,0)
P ;
"RTN","PSGVBW",67,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1 F  D ^PSJP Q:PSGP<0  D
"RTN","PSGVBW",68,0)
 .S PSJNV=0
"RTN","PSGVBW",69,0)
 .NEW ON,XX F ON=0:0 S ON=$O(^PS(53.1,"AS","N",PSGP,ON)) Q:'ON  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) I XX S PSJNV=1 Q
"RTN","PSGVBW",70,0)
 .;S PSJNV=$O(^PS(53.1,"AS","N",+PSGP,0)),PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",71,0)
 .S PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",72,0)
 .I 'PSJNV D ^PSJAC D
"RTN","PSGVBW",73,0)
 ..I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",74,0)
 ..S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",75,0)
 ..I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD!PSJNV  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  S PSJNV=1 Q
"RTN","PSGVBW",76,0)
 ..I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D" D IFT2 I  S PSJNV=1 Q
"RTN","PSGVBW",77,0)
 .S X=$S(PSJTOO=1:PSJNV,PSJTOO=2:PSJPEN,1:(PSJNV+PSJPEN))
"RTN","PSGVBW",78,0)
 .I X D SETPN S ^TMP("PSJSELECT",$J,PSJCNT)=PN,^TMP("PSJSELECT",$J,"B",$P(PN,U),PSJCNT)="",PSJCNT=PSJCNT+1 Q
"RTN","PSGVBW",79,0)
 .W !,"No ",PSGVBWW," orders found for this patient."
"RTN","PSGVBW",80,0)
 S:$D(^TMP("PSJSELECT",$J)) Y=1
"RTN","PSGVBW",81,0)
 Q
"RTN","PSGVBW",82,0)
 ;
"RTN","PSGVBW",83,0)
ARRAY ; put patient(s) with non-verified orders into array
"RTN","PSGVBW",84,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",85,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING") I PSGSS="P" D IF S:$T ^TMP("PSGVBW",$J)=$P(PSGP(0),"^")_"^"_PSGP Q
"RTN","PSGVBW",86,0)
 G CG:PSGSS="L",CL:PSGSS="C",WD:PSGSS="W" F WD=0:0 S WD=$O(^PS(57.5,"AC",WG,WD)) Q:'WD  D WD
"RTN","PSGVBW",87,0)
 Q
"RTN","PSGVBW",88,0)
 ;
"RTN","PSGVBW",89,0)
CG S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D CL
"RTN","PSGVBW",90,0)
 Q
"RTN","PSGVBW",91,0)
CL S WDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGVBW",92,0)
 S PSGP="",PSGCLF=1 F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:PSGP=""  D ^PSJAC,IF
"RTN","PSGVBW",93,0)
 K PSGCLF
"RTN","PSGVBW",94,0)
 Q
"RTN","PSGVBW",95,0)
WD S WDN=$S($D(^DIC(42,WD,0)):$P(^(0),"^"),1:"") I WDN]"" F PSGP=0:0 S PSGP=$O(^DPT("CN",WDN,PSGP)) Q:'PSGP  I $S($D(^PS(55,"APV",PSGP)):1,$D(^PS(55,"APIV",PSGP)):1,$O(^PS(55,PSGP,5,"AUS",PSGDT)):1,1:$D(^PS(53.1,"AC",PSGP))) D ^PSJAC,IF
"RTN","PSGVBW",96,0)
 Q
"RTN","PSGVBW",97,0)
IF ;BHW;PSJ*5*155;Added PSGCLF and PS(53.1,"AD" Check below.  If called from CL subroutine and the order Doesn't exist for that Clinic, then QUIT.;PSJ*5*241: Changed quit conditions
"RTN","PSGVBW",98,0)
 W "." I PSJTOO'=1 F ON=0:0 S ON=$O(^PS(53.1,"AS","P",PSGP,ON)) Q:'ON!(($G(PSGCLF))&('$D(^PS(53.1,"AD",+$G(CL),PSGP,+$G(ON)))))!(($G(WDN)="ZZ")&(+$P($G(^PS(53.1,+$G(ON),"DSS")),U,1)'=0))  S X=$P($G(^PS(53.1,ON,0)),U,4),Y=0 I "FIU"[X D  G:Y SET
"RTN","PSGVBW",99,0)
 .I PSJPAC=3 S Y=1 Q
"RTN","PSGVBW",100,0)
 .I PSJPAC=2 S Y=X'="U" Q
"RTN","PSGVBW",101,0)
 .I PSJPAC=1 S Y=X="U"
"RTN","PSGVBW",102,0)
 Q:PSJTOO=2
"RTN","PSGVBW",103,0)
 F X="N","I" I $D(^PS(53.1,"AS",X,PSGP)) NEW XX S XX=0 D  G:XX SET
"RTN","PSGVBW",104,0)
 . NEW ON F ON=0:0 S ON=$O(^PS(53.1,"AS",X,PSGP,ON)) Q:'ON!(($G(WDN)="ZZ")&(+$P($G(^PS(53.1,+$G(ON),"DSS")),U,1)'=0))  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) Q:XX
"RTN","PSGVBW",105,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",106,0)
 I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  G SET
"RTN","PSGVBW",107,0)
 ;*PSJ*5*241: Expired IV orders must be one-time
"RTN","PSGVBW",108,0)
 I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  D
"RTN","PSGVBW",109,0)
 .N SCH,STYPE S STYPE=0,SCH=$P($G(^PS(55,PSGP,"IV",ON,0)),U,9)
"RTN","PSGVBW",110,0)
 .S:SCH]"" SCH=$O(^PS(51.1,"APPSJ",SCH,STYPE)) S:SCH]"" STYPE=$P(^PS(51.1,SCH,0),U,5)
"RTN","PSGVBW",111,0)
 .I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D",'(($P(^(0),"^",17)="E")&($G(STYPE)'="O")) D IFT2 I  G SET
"RTN","PSGVBW",112,0)
 Q
"RTN","PSGVBW",113,0)
 ;
"RTN","PSGVBW",114,0)
IFT ;
"RTN","PSGVBW",115,0)
 S ND=$G(^PS(55,PSGP,5,ON,4)) I $S(SD>PSGDT:$S(ND="":1,'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1)):1,$P(ND,"^",13):1,$P(ND,"^",19):1,$P(ND,"^",23):1,1:$P(ND,"^",16)),ST="O":$S(ND="":1,1:'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1))),1:$P(ND,"^",16))
"RTN","PSGVBW",116,0)
 Q
"RTN","PSGVBW",117,0)
 ;
"RTN","PSGVBW",118,0)
IFT2 ;
"RTN","PSGVBW",119,0)
 ;S ND=$G(^PS(55,PSGP,"IV",ON,4)) I $S((SD>PSGDT)&(ND=""):1,'$P(ND,"^",$S(+PSJSYSU=1:1,1:4)):1,1:0)
"RTN","PSGVBW",120,0)
 S ND=$G(^PS(55,PSGP,"IV",ON,4))
"RTN","PSGVBW",121,0)
 I ($P($G(^PS(55,PSGP,"IV",ON,.2)),"^",4)="D")&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4)))  Q
"RTN","PSGVBW",122,0)
 I $S((SD>PSGDT)&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4))):1,1:0)
"RTN","PSGVBW",123,0)
 Q
"RTN","PSGVBW",124,0)
SET ;
"RTN","PSGVBW",125,0)
 S TM=$S(PSJPRB="":"",1:$P($G(^PS(57.7,WD,1,+$O(^PS(57.7,"AWRT",WD,PSJPRB,0)),0)),"^")) S:TM="" TM="zz"
"RTN","PSGVBW",126,0)
 ;
"RTN","PSGVBW",127,0)
SETPN ;
"RTN","PSGVBW",128,0)
 S PN=$P(PSGP(0),"^")_U_PSGP_U_PSJPBID S:PSGSS'="P" ^TMP("PSGVBW",$J,WDN,TM,PN)=""
"RTN","PSGVBW",129,0)
 Q
"RTN","PSGVBW",130,0)
 ;
"RTN","PSGVBW",131,0)
GTOOP ; Get 'Type Of Order' and Package
"RTN","PSGVBW",132,0)
 I $P(PSJSYSU,";",3)<2,'$G(PSJRNF),'$G(PSJIRNF) S PSJPAC=0,PSJTOO=1 D GTPAC Q
"RTN","PSGVBW",133,0)
 S (PSJPAC,PSJTOO)=0 W !!,"1) Non-Verified Orders",!,"2) Pending Orders",!!
"RTN","PSGVBW",134,0)
 N DIR S DIR(0)="LAO^1:2",DIR("A")="Select Order Type(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" D ^DIR
"RTN","PSGVBW",135,0)
 I 'Y D EXIT("TYPE OF ORDER") Q
"RTN","PSGVBW",136,0)
 S PSJTOO=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",137,0)
 D GTPAC
"RTN","PSGVBW",138,0)
 I 'PSJPAC D EXIT("PACKAGE") Q
"RTN","PSGVBW",139,0)
 Q
"RTN","PSGVBW",140,0)
GTPAC ;
"RTN","PSGVBW",141,0)
 ;S PSJTOO=$S($L(Y)>2:3,1:$P(Y,",")) Q:PSJTOO=1
"RTN","PSGVBW",142,0)
 ;I $G(PSJRNF) S PSJPAC=1 Q
"RTN","PSGVBW",143,0)
 I ($G(PSJRNF))&('$G(PSJIRNF))&(PSJTOO=2) S PSJPAC=1 Q
"RTN","PSGVBW",144,0)
 I ($G(PSJIRNF))&('$G(PSJRNF))&(PSJTOO=2) S PSJPAC=2 Q
"RTN","PSGVBW",145,0)
 W !!,"1) Unit Dose Orders",!,"2) IV Orders",!
"RTN","PSGVBW",146,0)
 K DIR S DIR(0)="LAO^1:2",DIR("A")="Select Package(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",147,0)
 S PSJPAC=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",148,0)
 Q
"RTN","PSGVBW",149,0)
EXIT(X) ;
"RTN","PSGVBW",150,0)
 W !!,X," not selected, option terminated."
"RTN","PSGVBW",151,0)
 Q
"RTN","PSGVBW",152,0)
 ;
"RTN","PSGVBW",153,0)
TOH ;
"RTN","PSGVBW",154,0)
 W !!,"SELECT FROM:",!?5,"1 - NON-VERIFIED ORDERS",!?5,"2 - PENDING ORDERS"
"RTN","PSGVBW",155,0)
 W !!?2,"Enter '1' if you want to verify non-verified orders.  Enter '2' if you",!,"want to complete pending orders.  Enter '1,2' or '1-2' if you want to do both." Q
"RTN","PSGVBW1")
0^5^B4852503^B3427001
"RTN","PSGVBW1",1,0)
PSGVBW1 ;BIR/CML3,MV-NON-VERFIED ORDERS UTILITES ; 5/3/10 3:44pm
"RTN","PSGVBW1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**5,111,241**;16 DEC 97;Build 10
"RTN","PSGVBW1",3,0)
 ;
"RTN","PSGVBW1",4,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGVBW1",5,0)
 ;
"RTN","PSGVBW1",6,0)
ENPROF ;
"RTN","PSGVBW1",7,0)
 I +PSJSYSU=1 S PSGOENOF=0 D NOW^%DTC F Q=%:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q  F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,4)),$P(^(4),"^",10) S PSGOENOF=1 Q
"RTN","PSGVBW1",8,0)
 W !!,$S($P(PSGP(0),"^")]"":$P(PSGP(0),"^"),1:PSGP_";DPT(") W:PSJPBID "  (",PSJPBID,")"
"RTN","PSGVBW1",9,0)
 D ENL^PSGOU Q:PSGOL["^"
"RTN","PSGVBW1",10,0)
 K ZTSAVE S PSGTIR="^PSJAC,^PSGO",ZTDESC="PATIENT PROFILE",PSGPR=1 F X="PSGP","PSGP(0)","PSGPR","PSGOL","PSGPTMP","PPAGE" S ZTSAVE(X)=""
"RTN","PSGVBW1",11,0)
 Q:PSGOL="N"
"RTN","PSGVBW1",12,0)
 D ENDEV^PSGTI K PSGPR Q:POP!$D(IO("Q"))
"RTN","PSGVBW1",13,0)
 S PSGVBW=IO'=IO(0)!($E(IOST)'="C") D ^PSGO D ^%ZISC Q:PSGVBW
"RTN","PSGVBW1",14,0)
PEND K DIR S DIR(0)="E" W ! D ^DIR K DIR Q
"RTN","PSGVBW1",15,0)
 ;
"RTN","PSGVBW1",16,0)
OUTPT ;Set up Outpatient IV for non/ver pending option.
"RTN","PSGVBW1",17,0)
 K ^TMP("PSGVBW",$J)
"RTN","PSGVBW1",18,0)
 NEW PSJSTAT,PSJTOO1,PSJPAC1
"RTN","PSGVBW1",19,0)
 ;I PSJTOO'=2 S PSJSTAT="N" D PSGP
"RTN","PSGVBW1",20,0)
 ;I PSJTOO'=1 S PSJSTAT="P" D PSGP
"RTN","PSGVBW1",21,0)
 S PSJSTAT="N" D PSGP
"RTN","PSGVBW1",22,0)
 S PSJSTAT="P" D PSGP
"RTN","PSGVBW1",23,0)
 N PSJXR,PSJUDIV S PSJXR(1)=$S(+PSJSYSU=3:"APV",1:"ANV"),PSJXR(2)=$S(+PSJSYSU=3:"APIV",1:"ANIV") ;*PSJ*5*241: added block
"RTN","PSGVBW1",24,0)
 F PSJUDIV=1:1:2 F DFN=0:0 S DFN=$O(^PS(55,PSJXR(PSJUDIV),DFN)) Q:'DFN  D
"RTN","PSGVBW1",25,0)
 . NEW VAIN D INP^VADPT
"RTN","PSGVBW1",26,0)
 . I $G(VAIN(4))&(PSGSS="G"&'$D(^PS(57.5,"AB",+VAIN(4)))) D
"RTN","PSGVBW1",27,0)
 .. S PSGP=DFN D ^PSJAC S WDN="ZZ" D IF^PSGVBW
"RTN","PSGVBW1",28,0)
 D ^PSGVBW0
"RTN","PSGVBW1",29,0)
 S Y=-1
"RTN","PSGVBW1",30,0)
 Q
"RTN","PSGVBW1",31,0)
PSGP ;
"RTN","PSGVBW1",32,0)
 F PSGP=0:0 S PSGP=$O(^PS(53.1,"AS",PSJSTAT,PSGP)) Q:'PSGP  D
"RTN","PSGVBW1",33,0)
 . NEW VAIN S DFN=PSGP D INP^VADPT
"RTN","PSGVBW1",34,0)
 . I '+(VAIN(4))!(PSGSS="G"&'$D(^PS(57.5,"AB",+VAIN(4)))) D
"RTN","PSGVBW1",35,0)
 .. ;I PSJSTAT="N",'+VAIN(4) Q
"RTN","PSGVBW1",36,0)
 .. D ^PSJAC S WDN="ZZ" D IF^PSGVBW
"RTN","PSGVBW1",37,0)
 Q
"RTN","PSGVBWU")
0^2^B77076603^B62025597
"RTN","PSGVBWU",1,0)
PSGVBWU ;BIR/CML3,MV-GET ORDERS FOR COMPLETE/VERIFY ; 6/2/10 10:44am
"RTN","PSGVBWU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,44,47,67,58,110,111,196,241**;16 DEC 97;Build 10
"RTN","PSGVBWU",3,0)
 ;
"RTN","PSGVBWU",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGVBWU",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177
"RTN","PSGVBWU",6,0)
 ;
"RTN","PSGVBWU",7,0)
ECHK(DFN,O,DT,SD) ;
"RTN","PSGVBWU",8,0)
 N OK S OK=0
"RTN","PSGVBWU",9,0)
 I $P($G(^PS(55,DFN,5,O,0)),U,9)'["D" S ND=$G(^(0)) Q:ND="" 0  S ND4=$G(^(4)) D
"RTN","PSGVBWU",10,0)
 .;I "DE"'[$P($G(^PS(55,DFN,5,O,0)),U,9) S ND=$G(^(0)) Q:ND="" 0  S ND4=$G(^(4)) D
"RTN","PSGVBWU",11,0)
 .I $S(SD>PSGDT:$S(ND="":1,'$P(ND4,U,$S(PSJSYSU:PSJSYSU,1:1)):1,$P(ND4,U,13):1,$P(ND4,U,19):1,$P(ND4,U,23):1,1:$P(ND4,U,16)),$P(ND,U,7)="O":$S(ND4="":1,1:'$P(ND4,U,$S(PSJSYSU:PSJSYSU,1:1))),1:$P(ND4,U,16)) S OK=1
"RTN","PSGVBWU",12,0)
 Q OK
"RTN","PSGVBWU",13,0)
ECHK2(DFN,O,DT,SD) ;
"RTN","PSGVBWU",14,0)
 N OK S OK=0
"RTN","PSGVBWU",15,0)
 ;*PSJ*5*241: Include one-time IV orders
"RTN","PSGVBWU",16,0)
 N SCH,STYPE S STYPE=0,SCH=$P($G(^PS(55,DFN,"IV",O,0)),U,9)
"RTN","PSGVBWU",17,0)
 S:SCH]"" SCH=$O(^PS(51.1,"APPSJ",SCH,STYPE)) S:SCH]"" STYPE=$P(^PS(51.1,SCH,0),U,5)
"RTN","PSGVBWU",18,0)
 I $P($G(^PS(55,DFN,"IV",O,0)),U,17)'["D" S ND=$G(^(0)) Q:ND="" 0  S ND4=$G(^(4)) D:(SD>PSGDT)!((SD>PSJPAD)&($G(STYPE)="O"))
"RTN","PSGVBWU",19,0)
 . I (+PSJSYSU=1)&('$P(ND4,U,+PSJSYSU)) S OK=1 Q
"RTN","PSGVBWU",20,0)
 . I (+PSJSYSU=3)&('$P(ND4,U,+PSJSYSU+1)) S OK=1 Q
"RTN","PSGVBWU",21,0)
 Q OK
"RTN","PSGVBWU",22,0)
 ;
"RTN","PSGVBWU",23,0)
SET ;
"RTN","PSGVBWU",24,0)
 I ON["P",$G(PSJCOM)]"",$G(PRNTON)=+PSJCOM Q
"RTN","PSGVBWU",25,0)
 I ON["P",$G(PSJCOM)]"" S PRNTON=+PSJCOM,ON=+PSJCOM
"RTN","PSGVBWU",26,0)
 S PSJPRIO=$S($G(PSJPRIO)="S":"A",1:"Z"),^TMP("PSJON",$J,PSJPRIO,LD_U_ON)=""
"RTN","PSGVBWU",27,0)
 Q
"RTN","PSGVBWU",28,0)
 ;
"RTN","PSGVBWU",29,0)
CNTORDRS ; Display # pending orders by type and ward group
"RTN","PSGVBWU",30,0)
 K ^TMP("PSJ",$J) D:$G(IOST(0)) ENS^%ZISS
"RTN","PSGVBWU",31,0)
 N DFN,DIRUT,ON,TYP,PSGODT,PSJWD,PSJWG,X,X1,X2
"RTN","PSGVBWU",32,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBWU",33,0)
 W !!,"Searching for Pending and Non-Verified orders"
"RTN","PSGVBWU",34,0)
 F STAT="P","N","I" F DFN=0:0 S DFN=$O(^PS(53.1,"AS",STAT,DFN)) Q:'DFN  D
"RTN","PSGVBWU",35,0)
 .W "." S PSJWG=$$WGNM($P($G(^DPT(DFN,.1)),U))
"RTN","PSGVBWU",36,0)
 .F ON=0:0 S ON=$O(^PS(53.1,"AS",STAT,DFN,ON)) Q:'ON  D
"RTN","PSGVBWU",37,0)
 .. N OWG,A,CGN,CGNM
"RTN","PSGVBWU",38,0)
 ..;GMZ:PSJ*5*196;Display order totals on all clinic groups in which a clinic belongs.
"RTN","PSGVBWU",39,0)
 .. S OWG=PSJWG I PSJWG="ZZ",$D(^PS(53.1,ON,"DSS")) S A=^("DSS") D CGNM(A,OWG,.CGNM) D
"RTN","PSGVBWU",40,0)
 ... I '$D(CGNM) S CGN=$P(^SC(+A,0),"^")_"^C",PSJWG=$P(^SC(+A,0),"^")_"^C" D
"RTN","PSGVBWU",41,0)
 ....I CGN]"" S TYP=$P($G(^PS(53.1,ON,0)),U,4),OTYP=$S((STAT="P")&(TYP="F"):1,(STAT="P")&(TYP="I"):1,(STAT="P")&(TYP="U"):2,TYP="F":3,TYP="I":3,1:4) D CNTSET(PSJWG,OTYP) S PSJWG=OWG Q 
"RTN","PSGVBWU",42,0)
 ... S PSJSQ="" F  S PSJSQ=$O(CGNM(+A,PSJSQ)) Q:PSJSQ=""  D
"RTN","PSGVBWU",43,0)
 .... S (PSJWG,CGN)=$P(CGNM(+A,PSJSQ),"^",1)_"^CG" I CGN]"" S TYP=$P($G(^PS(53.1,ON,0)),U,4),OTYP=$S((STAT="P")&(TYP="F"):1,(STAT="P")&(TYP="I"):1,(STAT="P")&(TYP="U"):2,TYP="F":3,TYP="I":3,1:4) D CNTSET(PSJWG,OTYP) S PSJWG=OWG
"RTN","PSGVBWU",44,0)
 .. Q:$G(CGN)]""  S TYP=$P($G(^PS(53.1,ON,0)),U,4),OTYP=$S((STAT="P")&(TYP="F"):1,(STAT="P")&(TYP="I"):1,(STAT="P")&(TYP="U"):2,TYP="F":3,TYP="I":3,1:4) D CNTSET(PSJWG,OTYP) S PSJWG=OWG
"RTN","PSGVBWU",45,0)
 ;
"RTN","PSGVBWU",46,0)
 I '$D(^XTMP("PSJPVNV")) D
"RTN","PSGVBWU",47,0)
 .N PSJXR S PSJXR=$S(+PSJSYSU=3:"APV",1:"ANV") F DFN=0:0 S DFN=$O(^PS(55,PSJXR,DFN)) Q:'DFN  D
"RTN","PSGVBWU",48,0)
 ..W "." D IN5^VADPT S PSJPAD=+VAIP(3) K VAIP F PSGORD=0:0 S PSGORD=$O(^PS(55,PSJXR,DFN,PSGORD)) Q:'PSGORD  D
"RTN","PSGVBWU",49,0)
 ...S PSGST=$P($G(^PS(55,DFN,5,PSGORD,0)),U,7),PSGFD=$P($G(^(2)),U,4) I ((PSGST="O")&(PSJPAD>0)&(PSGFD>PSJPAD))!((PSGST'="O")&(PSGFD'<PSGODT)) I $$ECHK(DFN,PSGORD,PSGDT,PSGFD) S PSJWD=$P($G(^DPT(DFN,.1)),U) I PSJWD]"" D
"RTN","PSGVBWU",50,0)
 ....S PSJWG=$$WGNM(PSJWD)
"RTN","PSGVBWU",51,0)
 .... N OWG,A
"RTN","PSGVBWU",52,0)
 ....;*PSJ*5*241:Rewrote CGNM call (5 lines)
"RTN","PSGVBWU",53,0)
 .... N CGNM,PSJWG1 S OWG=PSJWG I PSJWG="ZZ",$D(^PS(55,DFN,5,PSGORD,8)) S A=^(8) D CGNM(A,OWG,.CGNM) D
"RTN","PSGVBWU",54,0)
 ..... I '$D(CGNM) S PSJWG=$P(^SC(+A,0),"^")_"^C" D:PSJWG]"" CNTSET(PSJWG,4)
"RTN","PSGVBWU",55,0)
 ..... I $D(CGNM) S PSJWG="" F  S PSJWG=$O(CGNM(+A,PSJWG)) Q:PSJWG=""   D
"RTN","PSGVBWU",56,0)
 ......S PSJWG1=$P(CGNM(+A,PSJWG),U,1)_"^CG" D CNTSET(PSJWG1,4)
"RTN","PSGVBWU",57,0)
 .... D:(OWG'="ZZ")!('$D(^PS(55,DFN,5,PSGORD,8))) CNTSET(PSJWG,4) S PSJWG=OWG
"RTN","PSGVBWU",58,0)
 .N PSJXR S PSJXR=$S(+PSJSYSU=3:"APIV",1:"ANIV") F DFN=0:0 S DFN=$O(^PS(55,PSJXR,DFN)) Q:'DFN  D
"RTN","PSGVBWU",59,0)
 ..W "." D IN5^VADPT S PSJPAD=+VAIP(3) K VAIP F PSGORD=0:0 S PSGORD=$O(^PS(55,PSJXR,DFN,PSGORD)) Q:'PSGORD  D
"RTN","PSGVBWU",60,0)
 ...S PSGFD=$P($G(^PS(55,DFN,"IV",PSGORD,0)),U,3) I $$ECHK2(DFN,PSGORD,PSGDT,PSGFD) S PSJWD=$P($G(^DPT(DFN,.1)),U) I PSJWD]"" D
"RTN","PSGVBWU",61,0)
 ....S PSJWG=$$WGNM(PSJWD)
"RTN","PSGVBWU",62,0)
 .... N OWG,A
"RTN","PSGVBWU",63,0)
 ....;*PSJ*5*241: Rewrote CGNM call (5 lines)
"RTN","PSGVBWU",64,0)
 .... N CGNM,PSJWG1 S OWG=PSJWG I PSJWG="ZZ",$D(^PS(55,DFN,"IV",PSGORD,"DSS")) S A=^("DSS") D CGNM(A,OWG,.CGNM) D
"RTN","PSGVBWU",65,0)
 ..... I '$D(CGNM) S PSJWG=$P(^SC(+A,0),"^")_"^C" D:PSJWG]"" CNTSET(PSJWG,3)
"RTN","PSGVBWU",66,0)
 ..... I $D(CGNM) S PSJWG="" F  S PSJWG=$O(CGNM(+A,PSJWG)) Q:PSJWG=""  D
"RTN","PSGVBWU",67,0)
 ...... S PSJWG1=$P(CGNM(+A,PSJWG),U,1)_"^CG" D CNTSET(PSJWG1,3)
"RTN","PSGVBWU",68,0)
 .... D:(OWG'="ZZ")!('$D(^PS(55,DFN,5,PSGORD,8))) CNTSET(PSJWG,3) S PSJWG=OWG
"RTN","PSGVBWU",69,0)
 I $D(^XTMP("PSJPVNV")) S PSJWD="" F  S PSJWD=$O(^DPT("CN",PSJWD)) Q:PSJWD=""  S PSJWG=$$WGNM(PSJWD) F DFN=0:0 S DFN=$O(^DPT("CN",PSJWD,DFN)) Q:'DFN  D
"RTN","PSGVBWU",70,0)
 .; removed ref to ^DGPM
"RTN","PSGVBWU",71,0)
 .;S PSJPAD=9999999.9999999-$O(^DGPM("ATID1",DFN,0))
"RTN","PSGVBWU",72,0)
 .D IN5^VADPT S PSJPAD=+VAIP(3) K VAIP
"RTN","PSGVBWU",73,0)
 .W "."
"RTN","PSGVBWU",74,0)
 .F PSJST="C","O","OC","P","R" F PSGFD=$S(PSJST="O":PSJPAD,1:PSGODT):0 S PSGFD=$O(^PS(55,DFN,5,"AU",PSJST,PSGFD)) Q:'PSGFD  D
"RTN","PSGVBWU",75,0)
 ..F PSGORD=0:0 S PSGORD=$O(^PS(55,DFN,5,"AU",PSJST,PSGFD,PSGORD)) Q:'PSGORD  I $$ECHK(DFN,PSGORD,PSGDT,PSGFD) D
"RTN","PSGVBWU",76,0)
 ... N OWG,A
"RTN","PSGVBWU",77,0)
 ...;*PSJ*5*241: Rewrote CGNM call (5 lines)
"RTN","PSGVBWU",78,0)
 ... N CGNM,PSJWG1 S OWG=PSJWG I PSJWG="ZZ",$D(^PS(55,DFN,"IV",PSGORD,"DSS")) D CGNM(A,OWG,.CGNM) D
"RTN","PSGVBWU",79,0)
 .... I '$D(CGNM) S PSJWG=$P(^SC(+A,0),"^")_"^C" D:PSJWG]"" CNTSET(PSJWG,3)
"RTN","PSGVBWU",80,0)
 .... I $D(CGNM) S PSJWG="" F  S PSJWG=$O(CGNM(+A,PSJWG)) Q:PSJWG=""  D
"RTN","PSGVBWU",81,0)
 ..... S PSJWG1=$P(CGNM(+A,PSJWG),U,1)_"^CG" D CNTSET(PSJWG1,3)
"RTN","PSGVBWU",82,0)
 ... D:(OWG'="ZZ")!('$D(^PS(55,DFN,5,PSGORD,8))) CNTSET(PSJWG,3) S PSJWG=OWG
"RTN","PSGVBWU",83,0)
 .F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,"IV","AIS",SD,O)) Q:'O  S ON=O_"V" I $$ECHK2(PSGP,O,PSGDT,SD) D
"RTN","PSGVBWU",84,0)
 .. N OWG,A
"RTN","PSGVBWU",85,0)
 ..;*PSJ*5*241: Rewrote CGNM call (5 lines)
"RTN","PSGVBWU",86,0)
 .. N CGNM,PSJWG1 S OWG=PSJWG I PSJWG="ZZ",$D(^PS(55,DFN,"IV",PSGORD,"DSS")) D CGNM(A,OWG,.CGNM) D
"RTN","PSGVBWU",87,0)
 ... I '$D(CGNM) S PSJWG=$P(^SC(+A,0),"^")_"^C" D:PSJWG]"" CNTSET(PSJWG,3)
"RTN","PSGVBWU",88,0)
 ... I $D(CGNM) S PSJWG="" F  S PSJWG=$O(CGNM(+A,PSJWG)) Q:PSJWG=""  D
"RTN","PSGVBWU",89,0)
 .... S PSJWG1=$P(CGNM(+A,PSJWG),U,1)_"^CG" D CNTSET(PSJWG1,3)
"RTN","PSGVBWU",90,0)
 .. D:(OWG'="ZZ")!('$D(^PS(55,DFN,5,PSGORD,8))) CNTSET(PSJWG,3) S PSJWG=OWG
"RTN","PSGVBWU",91,0)
 ;
"RTN","PSGVBWU",92,0)
DISPLAY ;
"RTN","PSGVBWU",93,0)
 N H,I
"RTN","PSGVBWU",94,0)
 D CNTHEAD I '$D(^TMP("PSJ",$J)) W ?21,"No pending/non-verified orders found.",! Q
"RTN","PSGVBWU",95,0)
 S H("WG")="Ward Groups",H("CG")="Clinic Groups",H("C")="Clinics"
"RTN","PSGVBWU",96,0)
 F I="WG","CG","C" I $D(^TMP("PSJ",$J,I)) D
"RTN","PSGVBWU",97,0)
 . I I'="CG" W !,H(I),!!
"RTN","PSGVBWU",98,0)
 . I I="CG" W !,H(I),?13,"- The same order may be listed under more than 1 Clinic Group;",!,?15,"Therefore sum of Orders listed may not match total number of",!,?15,"pending orders. ",!!
"RTN","PSGVBWU",99,0)
 . S WG="" F  S WG=$O(^TMP("PSJ",$J,I,WG)) Q:WG=""!$D(DIRUT)  S X=$G(^(WG)) D
"RTN","PSGVBWU",100,0)
 .. ;W $S(WG="ZZ":"^OTHER",1:WG),?30,$J(+X,6),?44,$J(+$P(X,U,2),6),?58,$J(+$P(X,U,3),6),?72,$J(+$P(X,U,4),6),!
"RTN","PSGVBWU",101,0)
 .. W $S(WG="ZZ":"^OTHER",1:WG),?26,$J(+X,6),?36,$J(+$P(X,U,2),6),?51,$J(+$P(X,U,3),6),?63,$J(+$P(X,U,4),6),!
"RTN","PSGVBWU",102,0)
 .. I $Y>(IOSL-2) N DIR S DIR(0)="E" D ^DIR Q:$D(DIRUT)  D CNTHEAD
"RTN","PSGVBWU",103,0)
 Q
"RTN","PSGVBWU",104,0)
CNTSET(WG,X) ; Update counters for ward group totals
"RTN","PSGVBWU",105,0)
 ; Input: WG - Ward Group IEN
"RTN","PSGVBWU",106,0)
 ;         X - piece identifying order type.
"RTN","PSGVBWU",107,0)
 I $P(WG,"^",2)="" S $P(^TMP("PSJ",$J,"WG",WG),U,X)=$P($G(^TMP("PSJ",$J,"WG",WG)),U,X)+1 Q
"RTN","PSGVBWU",108,0)
 I $P(WG,"^",2)]"" S $P(^TMP("PSJ",$J,$P(WG,"^",2),$P(WG,"^")),U,X)=$P($G(^TMP("PSJ",$J,$P(WG,"^",2),$P(WG,"^"))),U,X)+1 Q
"RTN","PSGVBWU",109,0)
 Q
"RTN","PSGVBWU",110,0)
 ;
"RTN","PSGVBWU",111,0)
WGNM(WD) ; DETERMINE WARD GROUP NAME
"RTN","PSGVBWU",112,0)
 N WG
"RTN","PSGVBWU",113,0)
 I WD]"" S WG=+$O(^PS(57.5,"AB",+$O(^DIC(42,"B",WD,0)),0)),WG=$P($G(^PS(57.5,WG,0)),U)
"RTN","PSGVBWU",114,0)
 S:$G(WG)="" WG="ZZ"
"RTN","PSGVBWU",115,0)
 Q WG
"RTN","PSGVBWU",116,0)
 ;
"RTN","PSGVBWU",117,0)
CGNM(A,WGN,CGNM) ;DETERMINE CLINIC GROUP NAME
"RTN","PSGVBWU",118,0)
 N B,CGN
"RTN","PSGVBWU",119,0)
 ;I $P(A,"^",2)="" Q WGN
"RTN","PSGVBWU",120,0)
 S (B,CGN)="" F  S B=$O(^PS(57.8,"AC",+A,B)) Q:B=""  D
"RTN","PSGVBWU",121,0)
 . S CGNM(+A,B)=$P(^PS(57.8,B,0),"^")
"RTN","PSGVBWU",122,0)
 I $P(CGN,"^")="" S CGN=$P(^SC(+A,0),"^")_"^C"
"RTN","PSGVBWU",123,0)
 Q
"RTN","PSGVBWU",124,0)
 ;
"RTN","PSGVBWU",125,0)
CNTHEAD ; Header for order count.
"RTN","PSGVBWU",126,0)
 ;W @IOF,!,?16,"Pending/Non-Verified Order Totals by Ward Group",!!,?29,"Pending",?43,"Pending",?57,"Pending",!
"RTN","PSGVBWU",127,0)
 ;W "Ward Group",?30,"Fluids",?48,"IV",?55,"Unit Dose",?66,"Non-Verified",!!
"RTN","PSGVBWU",128,0)
 W @IOF,!,?16,"Pending/Non-Verified Order Totals by Ward Group/Clinic Location",!!,?33,"Pending",?56,"Non-Verified",!
"RTN","PSGVBWU",129,0)
 W "Ward Group/Clinic Location",?30,"IV",?40,"UD",?55,"IV",?67,"UD",!
"RTN","PSGVBWU",130,0)
 Q
"RTN","PSGVBWU",131,0)
 ;
"RTN","PSGVBWU",132,0)
ENGORD ; get and sort order
"RTN","PSGVBWU",133,0)
 N PSJCOM,PRNTON
"RTN","PSGVBWU",134,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),X1=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT),UDU=$P(PSJSYSU,";",3)>1 K ^TMP("PSJON",$J)
"RTN","PSGVBWU",135,0)
 W !!,"...a few moments, please..."
"RTN","PSGVBWU",136,0)
 I PSJTOO'=2 F PSGO2=+PSJPAD:0 S PSGO2=$O(^PS(55,PSGP,5,"AUS",PSGO2)) Q:'PSGO2  Q:PSGO2>PSGDT  F PSGO3=0:0 S PSGO3=$O(^PS(55,PSGP,5,"AUS",PSGO2,PSGO3)) Q:'PSGO3  I $D(^PS(55,PSGP,5,PSGO3,0)) S PSGO4=^(0) I "DEH"'[$E($P(PSGO4,"^",9)) D ENUH
"RTN","PSGVBWU",137,0)
 K PSGO1,PSGO2,PSGO3,PSGO4
"RTN","PSGVBWU",138,0)
 I PSJTOO'=1 F SD="I","P" F O=0:0 S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  D
"RTN","PSGVBWU",139,0)
 .S ND=$G(^PS(53.1,O,0)),PSJPRIO=$P($G(^(.2)),U,4),PSJCOM=$P($G(^(.2)),U,8),LD=$P($G(^PS(53.1,O,0)),U,16),ON=O_"P"
"RTN","PSGVBWU",140,0)
 .I $S(PSJPAC=3:1,PSJPAC=1&($P(ND,U,4)="U"):1,PSJPAC=2&($P(ND,U,4)'="U"):1,+$P(ND,U,13)&$G(PSJRNF):1,+$P(ND,U,13)&$G(PSJIRNF):1,1:0) D SET
"RTN","PSGVBWU",141,0)
 Q:PSJTOO=2
"RTN","PSGVBWU",142,0)
 F ST="C","O","OC","P","R" F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  S ON=O_"U" I $$ECHK(PSGP,O,PSGDT,SD) S LD=$P($G(^PS(55,PSGP,5,O,0)),U,16) D SET
"RTN","PSGVBWU",143,0)
 F O=0:0 S O=$O(^PS(53.1,"AS","N",PSGP,O)) Q:'O  S LD=$P($G(^PS(53.1,O,0)),U,16),PSJCOM=$P($G(^(.2)),U,8) S ON=O_"P" D SET
"RTN","PSGVBWU",144,0)
 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,"IV","AIS",SD,O)) Q:'O  S ON=O_"V" I $$ECHK2(PSGP,O,PSGDT,SD) S LD=$P($G(^PS(55,PSGP,"IV",O,2)),U) D SET
"RTN","PSGVBWU",145,0)
 Q
"RTN","PSGVBWU",146,0)
 ;
"RTN","PSGVBWU",147,0)
ENUH ;
"RTN","PSGVBWU",148,0)
 S $P(^PS(55,PSGP,5,PSGO3,0),"^",9)="E" D EN1^PSJHL2(PSGP,"SC",PSGO3_"U")
"RTN","PSGVBWU",149,0)
 Q
"RTN","PSGVBWU",150,0)
GOTOP ; Skip to a specific patient in list.
"RTN","PSGVBWU",151,0)
 I '$$HIDDEN^PSJLMUTL("JUMP") S VALMBCK="R" Q
"RTN","PSGVBWU",152,0)
 K PSJGOTO,DIR S DIR(0)="SM^J:Jump to a specific patient;E:Exit",DIR("A")="Select Action: ",DIR("B")="Exit" D ^DIR
"RTN","PSGVBWU",153,0)
 Q:"JE"'[Y
"RTN","PSGVBWU",154,0)
 I Y="E" S PSJGOTO=Y Q
"RTN","PSGVBWU",155,0)
 K DIR S DIR(0)="PO^2:AEMQZ",DIR("S")="I $P(^(0),U)]"""",$D(^TMP(""PSJSELECT"",$J,""B"",$P(^(0),U)))",DIR("??")="^D GOTOPH^PSGVBWU" D ^DIR I Y<0 S PSGTOTO=Y Q
"RTN","PSGVBWU",156,0)
 S VALMBCK="R",PSJGOTO=$S($P(Y,U,2)="":"E",1:$O(^TMP("PSJSELECT",$J,"B",$P(Y,U,2),0)))
"RTN","PSGVBWU",157,0)
 Q
"RTN","PSGVBWU",158,0)
 ;
"RTN","PSGVBWU",159,0)
GOTOPH ;
"RTN","PSGVBWU",160,0)
 F X=0:0 S X=$O(^TMP("PSJSELECT",$J,X)) Q:'X  W !,$P($G(^TMP("PSJSELECT",$J,X)),U) I X#IOSL=0 N DIR S DIR(0)="E" D ^DIR Q:$D(DIRUT)
"RTN","PSGVBWU",161,0)
 Q
"RTN","PSGVBWU",162,0)
 Q
"RTN","PSJOE0")
0^4^B25720453^B27948190
"RTN","PSJOE0",1,0)
PSJOE0 ;BIR/CML3-INPATIENT PROFILE AND ORDER ENTRY ; 4/15/10 2:45pm
"RTN","PSJOE0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**47,56,110,133,162,241**;16 DEC 97;Build 10
"RTN","PSJOE0",3,0)
 ;
"RTN","PSJOE0",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJOE0",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJOE0",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJOE0",7,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJOE0",8,0)
 ;
"RTN","PSJOE0",9,0)
START ; print orders
"RTN","PSJOE0",10,0)
 W:X]"" $P("^PROFILE",X,2) D ENL^PSJO3 G:PSJOL="^" DONE Q:PSJOL="N"  K PSJPR S PSGOEAV=0,PSJNARC=1 D ^PSJO I 'PSJON Q
"RTN","PSJOE0",11,0)
 ;
"RTN","PSJOE0",12,0)
ENVW ; ask user to select or view any of the orders shown
"RTN","PSJOE0",13,0)
 S (PSGONC,PSGONR,PSGONV)=0,PSGLMT=PSJON S:$D(PSJPRF) PSGPRF=1 D ENASR^PSGON K PSGPRF
"RTN","PSJOE0",14,0)
 ;G:X="^" DONE I X]"" S PSGOEA=""
"RTN","PSJOE0",15,0)
 G:X["^" DONE I X]"" S PSGOEA=""
"RTN","PSJOE0",16,0)
 K PSJDLW
"RTN","PSJOE0",17,0)
 I  F PSJOE=1:1:PSGODDD S PSGOE=PSJOE F PSJOE1=1:1:$L(PSGODDD(PSJOE),",")-1 S PSJOE2=$P(PSGODDD(PSJOE),",",PSJOE1),(PSGORD,PSJORD)=^TMP("PSJON",$J,PSJOE2) G:$D(PSJDLW) DONE D 
"RTN","PSJOE0",18,0)
 .I PSJORD=+PSJORD N PSJO,PSJO1 S PSJO=PSJORD,PSJO1=0 F  S PSJO1=$O(^PS(53.1,"ACX",PSJO,PSJO1)) Q:'PSJO1  Q:PSGOEA["^"  Q:$D(PSJDLW)  S PSJORD=PSJO1_"P" D GODO S PSJORD=""
"RTN","PSJOE0",19,0)
 .Q:PSJORD=""  Q:PSGOEA["^"
"RTN","PSJOE0",20,0)
 .D GODO Q:PSGOEA["^"
"RTN","PSJOE0",21,0)
 Q
"RTN","PSJOE0",22,0)
 ;
"RTN","PSJOE0",23,0)
LMNEW(PSGP,PSJPROT) ;Entry point for new order entry from listman.
"RTN","PSJOE0",24,0)
 ; PSGP = DFN
"RTN","PSJOE0",25,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJOE0",26,0)
 ;
"RTN","PSJOE0",27,0)
 ;S VALM("BM")=9 D CKNEW
"RTN","PSJOE0",28,0)
 D CKNEW N PSJUDPRF S PSJNEWOE=1
"RTN","PSJOE0",29,0)
 S PSGPTS=PSJPTS,PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU,PSGOEDMR=$O(^PS(51.2,"B","ORAL",0)),PSGOEPR=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",2),1:0),PSJORQF=0,PSJOEPF=""
"RTN","PSJOE0",30,0)
 I PSGOEPR>0,$D(^VA(200,+PSGOEPR,"PS")) S PSGOEPR=$S('$P(^("PS"),"^",4):PSGOEPR,($P(^("PS"),"^",4)<DT):0,1:PSGOEPR)
"RTN","PSJOE0",31,0)
 S:'PSGOEPR PSGOEPR=PSJPTSP
"RTN","PSJOE0",32,0)
 ;* F PSJOE=0:0 Q:PSJORQF  D:PSJPCAF&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1,(+PSJSYSU=3) D ENIN^PSIVORE
"RTN","PSJOE0",33,0)
 ;F PSJOE=0:0 Q:PSJORQF  D:PSJPCAF&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1 D ENIN^PSIVORE
"RTN","PSJOE0",34,0)
 ; line below fixes bug in line above - infinite loop when selecting New Order in Unit Dose OE for Outpatient.
"RTN","PSJOE0",35,0)
 F PSJOE=0:0 Q:PSJORQF!('(PSJPCAF&(PSJPROT'=2))&(PSJPROT'>1))  D:PSJPCAF&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1 D ENIN^PSIVORE
"RTN","PSJOE0",36,0)
 Q
"RTN","PSJOE0",37,0)
 ;
"RTN","PSJOE0",38,0)
DONE ;
"RTN","PSJOE0",39,0)
 K PSG,PSGDL,PSGDLS,PSGDO,PSGDRG,PSGDRGN,PSGFD,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGOES,PSGOPR,PSGORD,PSGOROE1,PSGPR,PSGPRN,PSGS0XT,PSGS0Y,PSGSCH,PSGSD,PSGSI,PSGSM,PSGST,PSGSTN,PSGUD,PSGX,PSJDLW,PSJLM,PSJNARC,PSIVAC
"RTN","PSJOE0",40,0)
 K P,PSGEFN,PSGOEEF
"RTN","PSJOE0",41,0)
 Q
"RTN","PSJOE0",42,0)
 ;
"RTN","PSJOE0",43,0)
CKNEW ;
"RTN","PSJOE0",44,0)
 K CF,CHK,OD,PSGLMT,PSGODDD,PSGOEA,PSGON,PSGONC,PSGONR,PSGONV,PSGORD,PSJCOM,PSJOE1,PSJOE2 Q:$D(PSJPRF)
"RTN","PSJOE0",45,0)
 I $P(PSJPDD,"^",3) W !!?2,"Patient is shown as deceased.  You may not enter orders for this patient." D CONT Q
"RTN","PSJOE0",46,0)
 I 'PSJPCAF W !!,"(NOTE: You cannot enter Unit Dose orders for this patient.)" D CONT
"RTN","PSJOE0",47,0)
 Q
"RTN","PSJOE0",48,0)
 ;
"RTN","PSJOE0",49,0)
CONT ;
"RTN","PSJOE0",50,0)
 K DIR S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSJOE0",51,0)
 Q
"RTN","PSJOE0",52,0)
 ;
"RTN","PSJOE0",53,0)
GODO ;Display selected order.
"RTN","PSJOE0",54,0)
 S PSIVAC="C" I $S(PSJORD["V":1,PSJORD["P":$P($G(^PS(53.1,+PSJORD,0)),"^",4)="F",1:0) D @$S($D(PSJPRP):"ENINP^PSIVOPT(DFN,PSJORD)",1:"ENIN^PSIVOPT") G GODO1
"RTN","PSJOE0",55,0)
 I '$D(PSJPRP),(PSJORD["P"),($P($G(^PS(53.1,+PSJORD,0)),U,4)="I") D ASKTYP Q:$D(DIRUT)  I Y="I" D ENIN^PSIVOPT G GODO1
"RTN","PSJOE0",56,0)
 S PSGORD=PSJORD D EN2^PSGVW,^PSGOE1:'$D(PSJPRF)
"RTN","PSJOE0",57,0)
GODO1 ;
"RTN","PSJOE0",58,0)
 I $D(PSJPRP),'PSJPR K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT)!$D(DTOUT) PSJDLW=1 Q:$D(PSJDLW)  W:$Y @IOF
"RTN","PSJOE0",59,0)
 Q
"RTN","PSJOE0",60,0)
 ;
"RTN","PSJOE0",61,0)
ASKTYP ; Ask if completing as IV or UD.
"RTN","PSJOE0",62,0)
 Q
"RTN","PSJOE0",63,0)
 W !! D PIV^PSIVUTL(+PSJORD_"P")
"RTN","PSJOE0",64,0)
 I $G(PSJPDD) S DIR(0)="E" D ^DIR S Y="I" Q
"RTN","PSJOE0",65,0)
 W ! K DIR S DIR(0)="SOA^U:Unit Dose;I:IV Medication",DIR("A")="Do you wish to complete this as an IV or Unit Dose order (I/U)? ",DIR("?")="^D PENDIU^PSJO3" D ^DIR
"RTN","PSJOE0",66,0)
 Q
"RTN","PSJOE0",67,0)
 ;
"RTN","PSJOE0",68,0)
OLDCOM(DFN,PSJORD) ;
"RTN","PSJOE0",69,0)
 Q:$$COMPLEX^PSJOE(DFN,PSJORD)
"RTN","PSJOE0",70,0)
 N DURFLG S DURFLG=$S($G(PSJORD)["P":$G(^PS(53.1,+PSJORD,2.5)),$G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,2.5)),1:$G(^PS(55,DFN,5,+PSJORD,2.5))) I $P(DURFLG,"^",2)]"" D
"RTN","PSJOE0",71,0)
 . D CLEAR^VALM1 W !!!!!?21," * WARNING * "
"RTN","PSJOE0",72,0)
 . W !!!?5,"The following order contains a Requested Duration"
"RTN","PSJOE0",73,0)
 . W !?12,"and may be part of a complex dose!"
"RTN","PSJOE0",74,0)
 . W !!," Review the entire profile to determine appropriate action(s).",!!!!!!! D PAUSE^VALM1
"RTN","PSJOE0",75,0)
 Q
"RTN","PSJOE0",76,0)
AM ;
"RTN","PSJOE0",77,0)
 W !!?2,"Enter a 'Y' (or press the RETURN key) to enter new INPATIENT orders for this",!,"patient.  Enter an 'N' (or an '^') if there are no new orders for this patient."
"RTN","PSJOE0",78,0)
 W:'PSJPCAF !!?2,"PLEASE NOTE: The patient selected is NOT shown as currently admitted.",!,"Therefore, you cannot enter Unit Dose orders for this patient.  (You can enter",!,"IV orders.)" Q
"VER")
8.0^22.0
"BLD",8437,6)
^205
**END**
**END**
