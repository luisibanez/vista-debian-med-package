Released PSJ*5*288 SEQ #243
Extracted from mail message
**KIDS**:PSJ*5.0*288^

**INSTALL NAME**
PSJ*5.0*288
"BLD",8514,0)
PSJ*5.0*288^INPATIENT MEDICATIONS^0^3121214^y
"BLD",8514,4,0)
^9.64PA^^
"BLD",8514,6.3)
7
"BLD",8514,"ABPKG")
n
"BLD",8514,"KRN",0)
^9.67PA^779.2^20
"BLD",8514,"KRN",.4,0)
.4
"BLD",8514,"KRN",.401,0)
.401
"BLD",8514,"KRN",.402,0)
.402
"BLD",8514,"KRN",.403,0)
.403
"BLD",8514,"KRN",.5,0)
.5
"BLD",8514,"KRN",.84,0)
.84
"BLD",8514,"KRN",3.6,0)
3.6
"BLD",8514,"KRN",3.8,0)
3.8
"BLD",8514,"KRN",9.2,0)
9.2
"BLD",8514,"KRN",9.8,0)
9.8
"BLD",8514,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",8514,"KRN",9.8,"NM",1,0)
PSGOE7^^0^B28469184
"BLD",8514,"KRN",9.8,"NM",2,0)
PSJOCDT^^0^B55186647
"BLD",8514,"KRN",9.8,"NM",3,0)
PSJDGCK^^0^B7938407
"BLD",8514,"KRN",9.8,"NM",4,0)
PSGOEV^^0^B81363759
"BLD",8514,"KRN",9.8,"NM",5,0)
PSGOEC^^0^B75069336
"BLD",8514,"KRN",9.8,"NM","B","PSGOE7",1)

"BLD",8514,"KRN",9.8,"NM","B","PSGOEC",5)

"BLD",8514,"KRN",9.8,"NM","B","PSGOEV",4)

"BLD",8514,"KRN",9.8,"NM","B","PSJDGCK",3)

"BLD",8514,"KRN",9.8,"NM","B","PSJOCDT",2)

"BLD",8514,"KRN",19,0)
19
"BLD",8514,"KRN",19.1,0)
19.1
"BLD",8514,"KRN",101,0)
101
"BLD",8514,"KRN",409.61,0)
409.61
"BLD",8514,"KRN",771,0)
771
"BLD",8514,"KRN",779.2,0)
779.2
"BLD",8514,"KRN",870,0)
870
"BLD",8514,"KRN",8989.51,0)
8989.51
"BLD",8514,"KRN",8989.52,0)
8989.52
"BLD",8514,"KRN",8994,0)
8994
"BLD",8514,"KRN","B",.4,.4)

"BLD",8514,"KRN","B",.401,.401)

"BLD",8514,"KRN","B",.402,.402)

"BLD",8514,"KRN","B",.403,.403)

"BLD",8514,"KRN","B",.5,.5)

"BLD",8514,"KRN","B",.84,.84)

"BLD",8514,"KRN","B",3.6,3.6)

"BLD",8514,"KRN","B",3.8,3.8)

"BLD",8514,"KRN","B",9.2,9.2)

"BLD",8514,"KRN","B",9.8,9.8)

"BLD",8514,"KRN","B",19,19)

"BLD",8514,"KRN","B",19.1,19.1)

"BLD",8514,"KRN","B",101,101)

"BLD",8514,"KRN","B",409.61,409.61)

"BLD",8514,"KRN","B",771,771)

"BLD",8514,"KRN","B",779.2,779.2)

"BLD",8514,"KRN","B",870,870)

"BLD",8514,"KRN","B",8989.51,8989.51)

"BLD",8514,"KRN","B",8989.52,8989.52)

"BLD",8514,"KRN","B",8994,8994)

"BLD",8514,"QUES",0)
^9.62^^
"BLD",8514,"REQB",0)
^9.611^1^1
"BLD",8514,"REQB",1,0)
PSJ*5.0*260^2
"BLD",8514,"REQB","B","PSJ*5.0*260",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
288^3121214
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PSGOE7")
0^1^B28469184^B28193796
"RTN","PSGOE7",1,0)
PSGOE7 ;BIR/CML3-SELECT DRUG ;15 MAY 00 / 1:43 PM
"RTN","PSGOE7",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**9,26,34,52,55,50,87,111,181,254,267,260,288**;16 DEC 97;Build 7
"RTN","PSGOE7",3,0)
 ;
"RTN","PSGOE7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSGOE7",5,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSGOE7",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOE7",7,0)
 ; NFI-UD chgs for FR#: 1
"RTN","PSGOE7",8,0)
 ; 
"RTN","PSGOE7",9,0)
 ;S PSGDICS="U"_$S($D(PSJOERR):",I",1:"")
"RTN","PSGOE7",10,0)
 S PSGDICS="U"
"RTN","PSGOE7",11,0)
 ;
"RTN","PSGOE7",12,0)
AD ; Ask Drug
"RTN","PSGOE7",13,0)
 K PSJDOSE,PSJDOX ;var array use in ^PSJDOSE
"RTN","PSGOE7",14,0)
 K PSGODO,^TMP("PSJINTER",$J) D KILL^PSJBCMA5(+$G(PSJSYSP))
"RTN","PSGOE7",15,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="EMQZVT",D="B^C" I '$P(PSJSYSU,";",4) S DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")"
"RTN","PSGOE7",16,0)
 E  D
"RTN","PSGOE7",17,0)
 .I '$D(PSJDGCK) S DIC("T")="",DIC="^PSDRUG(",DIC("S")="I +$G(^PSDRUG(+Y,2)),$P($G(^PSDRUG(+Y,2)),""^"",3)[""U"" S X(1)=+$G(^(""I"")) I $S('X(1):1,1:X(1)>DT)",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSGOE7",18,0)
 .I $D(PSJDGCK) S DIC("T")="",DIC="^PSDRUG(",DIC("S")="I +$G(^PSDRUG(+Y,2)),$$GCN^PSGOE7(+Y),$$PKGFLG^PSGOE7($P($G(^PSDRUG(+Y,2)),""^"",3)) S X(1)=+$G(^(""I"")) I $S('X(1):1,1:X(1)>DT)",D="B^C^VAPN^VAC^NDC^XATC"
"RTN","PSGOE7",19,0)
 ;
"RTN","PSGOE7",20,0)
AD1 ;
"RTN","PSGOE7",21,0)
 K PSGORD,PSJORD,PSJALLGY,^TMP("PSJINTER",$J),^PS(53.45,+$G(PSJSYSP),5),^PS(53.45,+$G(PSJSYSP),6)
"RTN","PSGOE7",22,0)
 S PSGORQF=0 R !!,"Select DRUG: ",X:DTIME I '$T W $C(7) S X="^"
"RTN","PSGOE7",23,0)
 I $D(PSJDGCK) I ($G(PSJOCNT)=1&(X="")) D  Q
"RTN","PSGOE7",24,0)
 .W !!,"Not enough active profile drugs to perform drug check",!
"RTN","PSGOE7",25,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSGOE7",26,0)
 I $D(PSJDGCK),X="" N PSGDGCKF S PSGDGCKF=1 G DGCKX
"RTN","PSGOE7",27,0)
 I ("^"[X)!(X="") S PSGORQF=1 G DONE
"RTN","PSGOE7",28,0)
 G:X?1"S."1.E DONE
"RTN","PSGOE7",29,0)
 I X?1."?" W !!?2,"Select the medication you wish the patient to receive." W:PSJSYSU<3 "  You should consult",!,"with your pharmacy before ordering any non-formulary medication." W !
"RTN","PSGOE7",30,0)
 D MIX^DIC1 G:X?1."?" AD1 G:"^"[X!(Y'>0) AD1 G:$$PSJSUPCK^PSJDGCK(+Y) AD1 S (PSGDO,PSGDRG,PSGDRGN,PSGNEDFD,PSGPDRG,PSGPDRGN)=""
"RTN","PSGOE7",31,0)
DGCKX I $P(PSJSYSU,";",4) D  G DO
"RTN","PSGOE7",32,0)
 .S:'$D(PSJDGCK) PSGDRG=+Y,PSGDRGN=Y(0,0)
"RTN","PSGOE7",33,0)
 .S:$D(PSJDGCK)&'$D(PSGDGCKF) PSGDRG=+Y,PSGDRGN=Y(0,0)
"RTN","PSGOE7",34,0)
 .S:$D(PSJDGCK)&$D(PSGDGCKF) PSGDRG=$P($$DGCKIEN^PSJDGCK(),";",2),PSGDRGN=$P($G(^PSDRUG(PSGDRG,0)),U)
"RTN","PSGOE7",35,0)
 .D DIN^PSJDIN(+$G(^PSDRUG(PSGDRG,2)),PSGDRG)
"RTN","PSGOE7",36,0)
 .I '$D(PSJDGCK) I $P(Y(0),"^",9) D NF S:Y>0 PSGDRG=+Y(0),PSGDRGN=Y(0,0) D SNFM
"RTN","PSGOE7",37,0)
 .I $D(PSJDGCK)&'$D(PSGDGCKF) I $P(Y(0),"^",9) D NF S:Y>0 PSGDRG=+Y(0),PSGDRGN=Y(0,0) D SNFM
"RTN","PSGOE7",38,0)
 .S PSGPDRG=+$G(^PSDRUG(PSGDRG,2)),PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",39,0)
 I '$D(PSJDGCK) S PSGPDRG=+Y,PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",40,0)
 I $D(PSJDGCK)&'$D(PSGDGCKF) S PSGPDRG=+Y,PSGPDRGN=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE7",41,0)
 ;F Q=1:1:$L(PSGDICS) S X=$P(PSGDICS,",",Q) Q:X=""  S PSJLUAPP=$O(^PS(50.3,PSGPDRG,1,"B",X,0)) I PSJLUAPP S X=$G(^PS(50.3,PSGPDRG,1,PSJLUAPP,0)) Q
"RTN","PSGOE7",42,0)
 S X=$O(^PSDRUG("ASP",PSGPDRG,0)) I X,'$O(^(X)) S PSGDRG=X,PSGDRGN=$$ENDDN^PSGMI(X)
"RTN","PSGOE7",43,0)
 ;
"RTN","PSGOE7",44,0)
DO ; dosage ordered
"RTN","PSGOE7",45,0)
 NEW PSJALLGY
"RTN","PSGOE7",46,0)
 S PSGNEDFD=$$GTNEDFD("U",PSGPDRG)
"RTN","PSGOE7",47,0)
 I $G(PSGDRG),$P(PSJSYSU,";",4) S PSJALLGY(PSGDRG)="" D ENDDC^PSGSICHK(PSGP,PSGDRG) G:$G(PSGORQF) AD
"RTN","PSGOE7",48,0)
 I '$P(PSJSYSU,";",4) S PSGX=PSGPDRG D END^PSGSICHK G:Y<0 AD
"RTN","PSGOE7",49,0)
 S PSGDO=""
"RTN","PSGOE7",50,0)
 ;
"RTN","PSGOE7",51,0)
DONE ;
"RTN","PSGOE7",52,0)
 K DIC,%,%Y,PSGDICS,PSJLUAPP,Q1,Q2,Q3,Z,PSJALLGY Q
"RTN","PSGOE7",53,0)
 ;
"RTN","PSGOE7",54,0)
 ;
"RTN","PSGOE7",55,0)
NF ;
"RTN","PSGOE7",56,0)
 S Y=0 W $C(7),!!,"PLEASE NOTE: The selected item is not currently on your medical center's",!?13,"formulary." Q:'$P(PSJSYSU,";",2)
"RTN","PSGOE7",57,0)
 N CNT S CNT=0 F Q1=0:0 S Q1=$O(^PSDRUG(PSGDRG,65,Q1)) Q:'Q1  I $$CHKDRG(+$G(^(Q1,0))) S CNT=CNT+1
"RTN","PSGOE7",58,0)
 I CNT=0 W !!,"There are no formulary alternatives entered for this item." W:PSJSYSU>2 "  You should consult",!,"with your pharmacy before ordering this item." S Y=0 Q
"RTN","PSGOE7",59,0)
 I CNT=1 S Q1=$O(^PSDRUG(PSGDRG,65,0)),Q1=+$G(^(Q1,0)),Q3=$P(^PSDRUG(Q1,0),"^") W !!,Q3," has been entered as a formulary " W:$X>67 ! W "alternative."
"RTN","PSGOE7",60,0)
 I  F Q=1:1 S %=2 W !!,"Is ",$S(Q=1:"this",1:Q3)," acceptable" D YN^DICN Q:%  D NFOH
"RTN","PSGOE7",61,0)
 I CNT=1 S:%=1 (Y(0),Y)=Q1,Y(0,0)=Q3 S:%<0 Y=-1 Q
"RTN","PSGOE7",62,0)
 K DA,DIC S DA(1)=PSGDRG,DIC="^PSDRUG("_PSGDRG_",65,",DIC(0)="AEMQZ",DIC("A")="Select FORMULARY ALTERNATIVE: " W ! D ^DIC K DIC Q
"RTN","PSGOE7",63,0)
 ;
"RTN","PSGOE7",64,0)
NFOH ;
"RTN","PSGOE7",65,0)
 S X="Answer 'YES' to order this formulary alternative ("_Q3_") for the patient instead of the non-formulary item originally selected.  Answer 'NO' to use the drug originally selected."
"RTN","PSGOE7",66,0)
 W !!?2 F Y=1:1:$L(X," ") S Z=$P(X," ",Y) W:$L(Z)+$X+2>IOM ! W Z," "
"RTN","PSGOE7",67,0)
 Q
"RTN","PSGOE7",68,0)
CHKDRG(DRG) ; Determine if dispense drug is valid for Unit Dose.
"RTN","PSGOE7",69,0)
 I $D(^PSDRUG(DRG,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>DT) Q DRG
"RTN","PSGOE7",70,0)
 Q 0
"RTN","PSGOE7",71,0)
 ;
"RTN","PSGOE7",72,0)
SNFM ; show non-formulary message
"RTN","PSGOE7",73,0)
 S Y=1 Q:PSJSYSU=3!'$O(^PS(59.7,1,21,0))  W $C(7),! S Q=0 F  S Q=$O(^PS(59.7,1,21,Q)) Q:'Q  W !,$G(^(Q,0))
"RTN","PSGOE7",74,0)
 W ! D READ^PSJUTL S Y=1 Q
"RTN","PSGOE7",75,0)
 ;
"RTN","PSGOE7",76,0)
GTNEDFD(APP,PDRG) ; Find defaults from Orderable Item.
"RTN","PSGOE7",77,0)
 Q $P($G(^PS(50.7,+PDRG,0)),"^",5,8)
"RTN","PSGOE7",78,0)
 N Q,X S X=""
"RTN","PSGOE7",79,0)
 F Q=1:1:$L(APP) S X=$E(APP,Q) Q:X=""  S X=$O(^PS(50.3,+PDRG,1,"B",X,0)) I X S X=$P($G(^PS(50.3,+PDRG,1,X,0)),"^",5,8) Q
"RTN","PSGOE7",80,0)
 Q X
"RTN","PSGOE7",81,0)
 ;
"RTN","PSGOE7",82,0)
PKGFLG(PKF) ;Return 0 for not in range of acceptable package flags, 1 for within range
"RTN","PSGOE7",83,0)
 I $S(PKF["U":1,1:0) Q 1
"RTN","PSGOE7",84,0)
 I $S(PKF["I":1,1:0) Q 1
"RTN","PSGOE7",85,0)
 Q 0
"RTN","PSGOE7",86,0)
 ;
"RTN","PSGOE7",87,0)
GCN(PSGIENID) ;Return 0 for not matched, 1 for matched with no GCNSEQNO, 1^1 for matched with a GCNSEQNO
"RTN","PSGOE7",88,0)
 N PSGNDFID,PSGGCNPT,PSGGCNID
"RTN","PSGOE7",89,0)
 S PSGNDFID=$P($G(^PSDRUG(PSGIENID,"ND")),"^"),PSGGCNPT=$P($G(^PSDRUG(PSGIENID,"ND")),"^",3)
"RTN","PSGOE7",90,0)
 I 'PSGNDFID!('PSGGCNPT) Q 0
"RTN","PSGOE7",91,0)
 S PSGGCNID=$$PROD0^PSNAPIS(PSGNDFID,PSGGCNPT)
"RTN","PSGOE7",92,0)
 I $P(PSGGCNID,"^",7) Q PSGIENID_";"_PSGNDFID_";"_$P(PSGGCNID,"^",7)
"RTN","PSGOE7",93,0)
 Q PSGIENID_";"_PSGNDFID
"RTN","PSGOEC")
0^5^B75069336^B74688532
"RTN","PSGOEC",1,0)
PSGOEC ;BIR/CML3-CANCEL ORDERS ;02 Mar 99 / 9:29 AM
"RTN","PSGOEC",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**23,58,110,175,201,134,181,260,288**;16 DEC 97;Build 7
"RTN","PSGOEC",3,0)
 ;
"RTN","PSGOEC",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEC",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOEC",6,0)
 ; 
"RTN","PSGOEC",7,0)
ENA ; all orders
"RTN","PSGOEC",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  S CF=$P(PSJSYSP0,U,5) N ND,ND1 S ND="$D(^PS(55,PSGP,5,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)",ND1="$D(^PS(53.1,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)"
"RTN","PSGOEC",9,0)
 F  W !!,"Do you want to ",$S(CF:"discontinue",1:"mark for discontinuation")," all of this patient's orders" S %=1 D YN^DICN Q:%  D ENCAM^PSGOEM
"RTN","PSGOEC",10,0)
 S PSGCF=0 Q:%<0  S PSGCF=1,T=$E("T",'PSJSYSU) G:%=1 ENCA F T=0:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND Q
"RTN","PSGOEC",11,0)
 E  F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 Q
"RTN","PSGOEC",12,0)
 E  G DONE
"RTN","PSGOEC",13,0)
 W !!,"SOME OR ALL OF THESE ORDERS HAVE" D ENUMK^PSGOEM Q:%'=1
"RTN","PSGOEC",14,0)
 W !!,"...a few moments, please..." S PSGAL("C")=PSJSYSU*10+21400
"RTN","PSGOEC",15,0)
 F T=PSGDT:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND W "." D RS,^PSGAL5
"RTN","PSGOEC",16,0)
 F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 W "." D RS
"RTN","PSGOEC",17,0)
 W " . . . DONE!" G DONE
"RTN","PSGOEC",18,0)
ENCA ;
"RTN","PSGOEC",19,0)
 D NOW^%DTC S (Q1,PSGDT)=+$E(%,1,12) F  S Q1=$O(^PS(55,PSGP,5,"AUS",Q1)) Q:'Q1  F Q2=0:0 S Q2=$O(^PS(55,PSGP,5,"AUS",Q1,Q2)) Q:'Q2  I $P($G(^PS(55,PSGP,5,Q2,0)),"^",21) Q
"RTN","PSGOEC",20,0)
 E  F Q2=0:0 S Q2=$O(^PS(53.1,"AC",PSGP,Q2)) Q:'Q2  I $P($G(^PS(53.1,Q2,0)),U,21) Q
"RTN","PSGOEC",21,0)
 I  S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0!('$$REQPROV) D  G DONE
"RTN","PSGOEC",22,0)
 .W !!,$C(7),"No changes made to this order." D PAUSE^VALM1
"RTN","PSGOEC",23,0)
 S PSGALR=$S('$D(PSGALO):20,PSGALO?4N&($E(PSGALO)=1):10,1:20) I $P(PSJSYSP0,U,5) D ENHE^PSJADT0 S PSGOP=PSGP D ASET
"RTN","PSGOEC",24,0)
 F SD=PSGDT:0 S SD=$O(^PS(55,PSGP,5,"AUS",SD)) Q:'SD  F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,5,"AUS",SD,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"A" D AC
"RTN","PSGOEC",25,0)
 D NSET S CF=$P(PSJSYSP0,U,5) F PSGORD=0:0 S PSGORD=$O(^PS(53.1,"AC",PSGP,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"N" D NC
"RTN","PSGOEC",26,0)
 W " . . . DONE!" K PSGORD G DONE
"RTN","PSGOEC",27,0)
ENO(PSGP,PSGORD) ; single order
"RTN","PSGOEC",28,0)
 I PSGSTAT="D" W !,"This order has already been DISCONTINUED." D PAUSE^VALM1 Q
"RTN","PSGOEC",29,0)
 S CF=$S($P(PSJSYSP0,U,5):1,PSGORD["U":0,1:($P($G(^PS(53.1,+PSGORD,0)),U,25)=""&($P($G(^(4)),U,7)=DUZ)))
"RTN","PSGOEC",30,0)
 S PSJCOM=+$S(PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSGORD,.2)),"^",8))
"RTN","PSGOEC",31,0)
 I 'CF,PSJCOM W !!,"This order is part of a complex order and CANNOT be marked for discontinuation." Q
"RTN","PSGOEC",32,0)
 I $$PNDRNOK(PSGORD) N PSJDCTYP S PSJDCTYP=$$PNDRNA(PSGORD) D:(PSJDCTYP=1!(PSJDCTYP=2)) PNDRN($G(PSJDCTYP),PSGORD) G DONE
"RTN","PSGOEC",33,0)
 ;I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOEC",34,0)
 ;F  W !!,"Do you want to ",$S(PSJCOM:"discontinue this series of complex orders",CF:"discontinue this order",1:"mark this order for discontinuation") S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSGOEC",35,0)
 ;I %<0 S VALMBCK="" Q
"RTN","PSGOEC",36,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOEC",37,0)
 I PSJCOM F  W !!,"Do you want to discontinue this series of complex orders" S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSGOEC",38,0)
 I 'PSJCOM,CF,'$D(PSJDCDTF) F  W !!,"Do you want to discontinue this order" S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM I %<0 S VALMBCK="" Q
"RTN","PSGOEC",39,0)
 I 'PSJCOM,CF,$D(PSJDCDTF) F  W !!,"Enter DC to discontinue the above order or press <RETURN> to continue:" S %=$S($G(PSJOCFLG):2,1:1) D TST4DC W:%=2 !,"No action taken!" Q:%  D ENDC^PSGOEM I %<0 S VALMBCK="" Q
"RTN","PSGOEC",40,0)
 I 'PSJCOM,'CF,'$D(PSJDCDTF) F  W !!,"Do you want mark this order for discontinuation" S %=$S($G(PSJOCFLG):2,1:1) D YN^DICN Q:%  D ENCOM^PSGOEM I %<0 S VALMBCK="" Q
"RTN","PSGOEC",41,0)
 G:%=1 SOC I $S(PSGORD["U":$D(^PS(55,PSGP,5,+PSGORD,4)),1:$D(^PS(53.1,+PSGORD,4))),$P(^(4),U,12) W !!,"THIS ORDER HAS"
"RTN","PSGOEC",42,0)
 I  D ENUMK^PSGOEM I %=1 W "..." K DA S:PSGORD["A" PSGAL("C")=PSJSYSU*10+21400,DA=+PSGORD,DA(1)=PSGP D RS,^PSGAL5:PSGORD["A" W " . . . DONE!"
"RTN","PSGOEC",43,0)
 G DONE
"RTN","PSGOEC",44,0)
SOC ;
"RTN","PSGOEC",45,0)
 I 'CF,'$P($S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,0)),1:$G(^PS(53.1,+PSGORD,0))),U,21) W !!,"...one moment, please..."
"RTN","PSGOEC",46,0)
 E  I CF,'($G(PSJDCTYP)=2) S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0 D ABORT^PSGOEE G DONE
"RTN","PSGOEC",47,0)
 ; prompt for requesting provider
"RTN","PSGOEC",48,0)
 I '($G(PSJDCTYP)=2) I CF,'$$REQPROV D ABORT^PSGOEE G DONE
"RTN","PSGOEC",49,0)
 K DA D NOW^%DTC S PSGDT=%,T=$E("T",'PSJSYSU),PSGALR=20,DA=+PSGORD,DA(1)=PSGP
"RTN","PSGOEC",50,0)
 I 'PSJCOM D
"RTN","PSGOEC",51,0)
 .I PSGORD["U" D ASET:CF,AC
"RTN","PSGOEC",52,0)
 .I PSGORD'["U" D NSET:CF,NC
"RTN","PSGOEC",53,0)
 I PSJCOM N COMFLG S COMFLG=0 D
"RTN","PSGOEC",54,0)
 . I PSGORD["P" Q:('$$LOCK^PSJOEA(PSGP,PSJCOM))  D 
"RTN","PSGOEC",55,0)
 .. N O S O="" F  S O=$O(^PS(53.1,"ACX",PSJCOM,O)) Q:O=""  S (PSGORD,PSJORD)=O_"P" D NSET,NC
"RTN","PSGOEC",56,0)
 .I PSGORD["U" N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  Q:COMFLG  D
"RTN","PSGOEC",57,0)
 .. Q:OO=PSGORD  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSGOEC",58,0)
 I PSJCOM Q:COMFLG  N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSGOEC",59,0)
 . I OO["V" S ON55=OO D D1^PSIVOPT2 S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3) D
"RTN","PSGOEC",60,0)
 .. D LOG^PSIVORAL N PSJORD S PSJORD=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),P("NAT")=PSJNOO D HL^PSIVORA
"RTN","PSGOEC",61,0)
 . I OO["U" N PSGORD,PSJORD S (PSGORD,PSJORD)=OO D ASET^PSGOEC,AC^PSGOEC
"RTN","PSGOEC",62,0)
 Q
"RTN","PSGOEC",63,0)
D1 N %,DA,DIE,DIU,STP,NSTOP
"RTN","PSGOEC",64,0)
 D NOW^%DTC S NSTOP=+$E(%,1,12),STP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),NSTOP=+$S(STP>NSTOP:NSTOP,1:STP),P(17)="D"
"RTN","PSGOEC",65,0)
 S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR="109////"_NSTOP_$S('$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7):";116////"_STP,1:"")_";100///D;.03////"_NSTOP,PSIVACT=1 D ^DIE
"RTN","PSGOEC",66,0)
 I $S($G(PSIVAC)="OD":0,$G(PSIVAC)'="AD":1,$G(PSGALO)<1060:0,1:$P($G(PSJSYSW0),U,15)) S X=$S($G(PSIVAC)="AD":1,1:2) D ENLBL^PSIVOPT(X,$S(X=1:+$G(PSGUOW),1:DUZ),DFN,3,+ON55,$E("AD",1,3-X))
"RTN","PSGOEC",67,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF  ;* S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'ORIFN
"RTN","PSGOEC",68,0)
 Q
"RTN","PSGOEC",69,0)
OUT ;
"RTN","PSGOEC",70,0)
 W $S(PSJCOM:"...ORDER ",1:"...ORDERS "),$S(CF:"DISCONTINUED!",1:"MARKED!") S PSGCANFL=1
"RTN","PSGOEC",71,0)
DONE ;
"RTN","PSGOEC",72,0)
 K CF,DA,DIE,DP,DR,ORIFN,ORETURN,PSGAL,PSGALR,PSGDA,SD,ST,T,UCF,Y,PSJDCTYP Q
"RTN","PSGOEC",73,0)
ASET ;
"RTN","PSGOEC",74,0)
 S DIE="^PS(55,"_PSGP_",5,",DR="136////@;28////"_$S($P($G(^PS(55,PSGP,5,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_";Q;34////"_PSGDT_$S(T]"":";49////1",1:"")
"RTN","PSGOEC",75,0)
 Q
"RTN","PSGOEC",76,0)
NSET ;
"RTN","PSGOEC",77,0)
 S DIE="^PS(53.1,",DR="28////"_$S($P($G(^PS(53.1,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_$S(T]"":";42////1",1:"")_";25////"_PSGDT Q
"RTN","PSGOEC",78,0)
AC ;
"RTN","PSGOEC",79,0)
 I 'CF K DA S $P(^PS(55,PSGP,5,+PSGORD,4),U,11,14)="^1^"_DUZ_U_PSGDT,PSGAL("C")=13040,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5
"RTN","PSGOEC",80,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",81,0)
 Q:'CF  K DA,ORIFN S PSGAL("C")=PSJSYSU*10+4000,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5 S $P(^(2),U,3)=$P(^PS(55,PSGP,5,+PSGORD,2),U,4) D ^DIE S ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEC",82,0)
 I '$D(PSJSYSL) S PSJSYSL=""
"RTN","PSGOEC",83,0)
 I PSJSYSL K DA S $P(^PS(55,PSGP,5,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD,DA(1)=PSGP D ENL^PSGVDS
"RTN","PSGOEC",84,0)
 S ORIFN=$P($G(^PS(55,PSGP,5,+PSGORD,0)),U,21) D:ORIFN DCOR^PSGOECS
"RTN","PSGOEC",85,0)
 Q
"RTN","PSGOEC",86,0)
NC ;
"RTN","PSGOEC",87,0)
 I 'CF S $P(^PS(53.1,+PSGORD,4),"^",11,14)="^1^"_DUZ_U_PSGDT
"RTN","PSGOEC",88,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"N",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",89,0)
 Q:'CF  S PSGSTAT=$P($G(^PS(53.1,+PSGORD,0)),U,9),PSGORIFN=$P($G(^(0)),U,21)
"RTN","PSGOEC",90,0)
 I PSGSTAT'="U" K DA,ORIFN S DA=+PSGORD D ^DIE I PSJSYSL,PSJSYSL<3,(PSGSTAT'="P") S $P(^PS(53.1,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOO=2,PSGUOW=DUZ,PSGTOL=2 D ENL^PSGVDS
"RTN","PSGOEC",91,0)
 I PSGSTAT="U" K DA S DA=+PSGORD,DIK="^PS(53.1," D ^DIK
"RTN","PSGOEC",92,0)
 I PSGORIFN S ORIFN=PSGORIFN D DCOR^PSGOECS
"RTN","PSGOEC",93,0)
 Q
"RTN","PSGOEC",94,0)
T ;
"RTN","PSGOEC",95,0)
 F  W !!,"Is this due to the patient being transferred" S %=2 D YN^DICN Q:%  D ENCTM^PSGOEM1
"RTN","PSGOEC",96,0)
 S T=$S(%<0:"^",1:$E("T",%=1)) Q
"RTN","PSGOEC",97,0)
RS ;
"RTN","PSGOEC",98,0)
 ; naked ref below is from variable ND1, ^PS(53.1,PSGDA,4)
"RTN","PSGOEC",99,0)
 S $P(^(4),U,11,14)="^^^" Q
"RTN","PSGOEC",100,0)
 ;
"RTN","PSGOEC",101,0)
REQPROV()          ;
"RTN","PSGOEC",102,0)
 I $G(PSJDCTYP)=2 Q 1
"RTN","PSGOEC",103,0)
 K PSJDCPRV,DIC,DUOUT,DTOUT,Y
"RTN","PSGOEC",104,0)
 N PROVIDER,PROVNAME,RESULT,RSB S RESULT=0
"RTN","PSGOEC",105,0)
 S PROVIDER=+$P($G(^PS(55,DFN,5.1)),"^",2),PROVNAME=""
"RTN","PSGOEC",106,0)
 I PROVIDER>0 D
"RTN","PSGOEC",107,0)
 .S DIC=200,DR="53.1;53.4",DIQ="RSB",DIQ(0)="I",DA=PROVIDER D EN^DIQ1
"RTN","PSGOEC",108,0)
 .K DIC,DR,DA,DIQ
"RTN","PSGOEC",109,0)
 .I $G(RSB(200,PROVIDER,53.1,"I"))="1"&(($G(RSB(200,PROVIDER,53.4,"I"))="")!($G(RSB(200,PROVIDER,53.4,"I"))>DT)) D
"RTN","PSGOEC",110,0)
 ..S DIC=200,DA=PROVIDER,DR=".01",DIQ="RSB",DIQ(0)="E" D EN^DIQ1
"RTN","PSGOEC",111,0)
 ..S PROVNAME=$G(RSB(200,PROVIDER,.01,"E")) K DA,DIQ,DR
"RTN","PSGOEC",112,0)
 K DIC S DIC=200,DIC(0)="AEMQZ"
"RTN","PSGOEC",113,0)
 S:PROVNAME]"" DIC("B")=PROVNAME
"RTN","PSGOEC",114,0)
 S DIC("A")="Requesting PROVIDER: "
"RTN","PSGOEC",115,0)
 S DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC
"RTN","PSGOEC",116,0)
 I +Y>0,'$D(DUOUT),'$D(DTOUT) S RESULT=1,PSJDCPRV=+Y
"RTN","PSGOEC",117,0)
 Q RESULT
"RTN","PSGOEC",118,0)
 ;
"RTN","PSGOEC",119,0)
PNDRNA(ORDER) ; Ask Discontinue Pending Renewal only, or both Pending Renew and Renewed Order
"RTN","PSGOEC",120,0)
 ; Perform this action only for pending renewals
"RTN","PSGOEC",121,0)
 I '$G(ORDER)!'($G(ORDER)["P") Q 3
"RTN","PSGOEC",122,0)
 ; Quit if original order is no longer active
"RTN","PSGOEC",123,0)
 N ORIGORD,ORIGSTOP S ORIGORD=$P($G(^PS(53.1,+ORDER,0)),"^",25) Q:'ORIGORD  D  I ORIGSTOP<$G(PSGDT) Q 1
"RTN","PSGOEC",124,0)
 .S ORIGSTOP=$S(ORIGORD["U":$P($G(^PS(55,PSGP,5,+ORIGORD,2)),"^",4),ORIGORD["V":$P($G(^PS(55,PSGP,"IV",+ORIGORD,0)),"^",3),1:"")
"RTN","PSGOEC",125,0)
 N NDP2
"RTN","PSGOEC",126,0)
 S NDP2=^PS(53.1,+ORDER,.2) S DRG=NDP2,DO=$P(DRG,"^",2) S DRG=$$ENPDN^PSGMI($P(DRG,"^"))
"RTN","PSGOEC",127,0)
 S ND2=^PS(53.1,+ORDER,2) S SCH=$P(ND2,"^"),START=$P(ND2,"^",2),START=$$FMTE^XLFDT(START,2)
"RTN","PSGOEC",128,0)
 W !!?5,DRG_" "_DO
"RTN","PSGOEC",129,0)
 W !?5,"This order has a pending status. If this pending order"
"RTN","PSGOEC",130,0)
 W !?5,"is discontinued, the original order may still be active."
"RTN","PSGOEC",131,0)
 S DIR("A")="Select order(s) to discontinue"
"RTN","PSGOEC",132,0)
 S DIR(0)="S^1:DC BOTH Orders;2:DC Pending Order;3:Cancel - No Action Taken"
"RTN","PSGOEC",133,0)
 S DIR("L",1)="1 - DC BOTH Orders"
"RTN","PSGOEC",134,0)
 S DIR("L",2)="2 - DC Pending Order"
"RTN","PSGOEC",135,0)
 S DIR("L",3)="3 - Cancel - No Action Taken" D ^DIR
"RTN","PSGOEC",136,0)
 ; Reverse order - Y=1 - Pending only  Y=2:BOTH
"RTN","PSGOEC",137,0)
 S Y=$S(Y=1:2,Y=2:1,1:3)
"RTN","PSGOEC",138,0)
 Q Y
"RTN","PSGOEC",139,0)
 ;
"RTN","PSGOEC",140,0)
PNDRN(PSJDCTYP,ORDER) ; Perform Discontinue action for Pending order only or both Pending and Renewed
"RTN","PSGOEC",141,0)
 ; Perform this action only for pending renewals
"RTN","PSGOEC",142,0)
 N PSGORD S PSGORD=ORDER
"RTN","PSGOEC",143,0)
 Q:'$G(PSGORD)!'($G(PSGORD)["P")
"RTN","PSGOEC",144,0)
 I PSJDCTYP=1 G SOC
"RTN","PSGOEC",145,0)
 I PSJDCTYP=2 S PSJDCTYP=1 D SOC Q:'$G(PSJDCTYP)  D
"RTN","PSGOEC",146,0)
 .I ($G(PSJNOO)<0) Q
"RTN","PSGOEC",147,0)
 .N ND5310 S ND5310=$G(^PS(53.1,+PSGORD,0))
"RTN","PSGOEC",148,0)
 .N PSGORD S PSGORD=$P(ND5310,"^",25) I PSGORD S PSJDCTYP=2 D SOC K PSJDCTYP
"RTN","PSGOEC",149,0)
 Q
"RTN","PSGOEC",150,0)
 ;
"RTN","PSGOEC",151,0)
PNDRNOK(ORDER) ; Execute DC Pending Renew enhancement only if 
"RTN","PSGOEC",152,0)
 ;                  1) Renewal order is pending/non-verified, and 
"RTN","PSGOEC",153,0)
 ;                  2) Original order is not DC'd or Expired
"RTN","PSGOEC",154,0)
 Q:'$G(PSGORD)!'($G(PSGORD)["P") 0
"RTN","PSGOEC",155,0)
 N ORIGORD,ORIGSTOP S ORIGORD=$P($G(^PS(53.1,+ORDER,0)),"^",25) Q:'ORIGORD 0  D  I ORIGSTOP<$G(PSGDT) Q 0
"RTN","PSGOEC",156,0)
 .S ORIGSTOP=$S(ORIGORD["U":$P($G(^PS(55,PSGP,5,+ORIGORD,2)),"^",4),ORIGORD["V":$P($G(^PS(55,PSGP,"IV",+ORIGORD,0)),"^",3),1:"")
"RTN","PSGOEC",157,0)
 Q:'($P($G(^PS(53.1,+PSGORD,0)),U,24)="R") 0
"RTN","PSGOEC",158,0)
 Q 1
"RTN","PSGOEC",159,0)
 ;
"RTN","PSGOEC",160,0)
TST4DC ; Test for DC at prompt
"RTN","PSGOEC",161,0)
 R X:$S($D(DTIME):DTIME,1:300) I '$T S %=2 Q
"RTN","PSGOEC",162,0)
 S %=$S(X="DC":1,X="Dc":1,X="dc":1,X="dC":1,X="D":1,X="d":1,X="":2,X="^":2,X]"":"",1:2)
"RTN","PSGOEC",163,0)
 Q
"RTN","PSGOEV")
0^4^B81363759^B73577896
"RTN","PSGOEV",1,0)
PSGOEV ;BIR/CML3-VERIFY (MAKE ACTIVE) ORDERS ; 4/16/10 9:18am
"RTN","PSGOEV",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**5,7,15,28,33,50,64,58,77,78,80,110,111,133,171,207,241,267,268,260,288**;16 DEC 97;Build 7
"RTN","PSGOEV",3,0)
 ;
"RTN","PSGOEV",4,0)
 ; Reference to ^ORD(101 supported by DBIA #872.
"RTN","PSGOEV",5,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180.
"RTN","PSGOEV",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGOEV",7,0)
 ; Reference to ^PSSLOCK supported by DBIA #2789.
"RTN","PSGOEV",8,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA #2410.
"RTN","PSGOEV",9,0)
 ;
"RTN","PSGOEV",10,0)
EN(PSGORD) ;
"RTN","PSGOEV",11,0)
ENSF ; This entry point is used by Speed finish only.
"RTN","PSGOEV",12,0)
 ; Send SN update to CPRS if auto-verify off and from Order Set entry
"RTN","PSGOEV",13,0)
 S:'$D(PSGOEAV) PSGOEAV=$P($G(PSJSYSP0),"^",9)&$G(PSJSYSU)
"RTN","PSGOEV",14,0)
 I $D(PSGOES),'PSGOEAV,PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSGOEV",15,0)
 D FULL^VALM1 I 'PSJSYSU W $C(7),$C(7),!!," THIS FUNCTION NOT AVAILABLE TO WARD STAFF." Q
"RTN","PSGOEV",16,0)
 S CHK=0 I PSGORD["P" S X=$P($G(^PS(53.1,+PSGORD,0)),"^",19) I X,$D(^PS(55,PSGP,5,$P(^(0),"^",19))) S CHK=+PSGORD,PSGORD=X_"U" L -^PS(53.1,CHK) L +^PS(55,PSGP,5,+PSGORD):1 E  W !!,"Another terminal is editing this order." G DONE
"RTN","PSGOEV",17,0)
 I +PSJSYSU=3 D DDCHK G:CHK DONE
"RTN","PSGOEV",18,0)
 I PSGORD["P" D CHK($G(^PS(53.1,+PSGORD,0)),$G(^(.2)),$G(^(2)))
"RTN","PSGOEV",19,0)
 I $G(PSGSCH)]"" D
"RTN","PSGOEV",20,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=1 S X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",21,0)
 I $G(CHK) Q:$D(PSJSPEED)  D EN^VALM("PSJU LM ACCEPT") G:'$G(PSJACEPT) DONE ;G VFY
"RTN","PSGOEV",22,0)
 I PSGORD["U" G:'$D(^PS(55,PSGP,5,+PSGORD,4)) VFY I +PSJSYSU=3,$P(^(4),"^",3) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A PHARMACIST." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",23,0)
 I PSGORD["U" I +PSJSYSU=1,+^PS(55,PSGP,5,+PSGORD,4) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A NURSE." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",24,0)
 ;
"RTN","PSGOEV",25,0)
VFY ; change status, move to 55, and change label record **ENHANCEMENTS MADE IN PSJ*5.0*260 **CCR 6214 **CCR 6244
"RTN","PSGOEV",26,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D VFY^PSJCOM Q
"RTN","PSGOEV",27,0)
 NEW PSJDOSE,PSJDSFLG,PSJDIS,PSGORQF,PSJCNT,PSJCNT1,PSJCNT2,LIST,PSJFLG,PSGDN SET PSJDIS="",PSJCNT=0,PSJCNT1="",PSJCNT2="",LIST="PSGPRE",PSJFLG="",PSGDN=""
"RTN","PSGOEV",28,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEV",29,0)
 SET PSJFLG=+$G(PSGORD)
"RTN","PSGOEV",30,0)
 FOR  SET PSJCNT=$O(^PS(53.1,PSJFLG,1,PSJCNT)) Q:'+PSJCNT  D
"RTN","PSGOEV",31,0)
 .IF $D(^PS(53.1,PSJFLG,1,PSJCNT,0)) SET PSGDN=$P($G(^PS(53.1,PSJFLG,1,PSJCNT,0)),U,1)
"RTN","PSGOEV",32,0)
 .IF ($P($G(^PSDRUG(PSGDN,0)),U,3)'["S")&($E($P($G(^PSDRUG(PSGDN,0)),U,2),1,2)'="XA")  D
"RTN","PSGOEV",33,0)
 ..D PROFILE^PSJBLDOC($G(DFN),LIST,"I;"_$G(PSGORD))
"RTN","PSGOEV",34,0)
 ..FOR  SET PSJCNT1=$O(^TMP($J,LIST,"IN","PROFILE",PSJCNT1)) Q:(PSJCNT1="")!(PSJDIS'="")  D
"RTN","PSGOEV",35,0)
 ...SET PSJCNT2=$P(PSJCNT1,";",2)
"RTN","PSGOEV",36,0)
 ...IF PSJCNT2=$G(PSGORD) SET PSJDIS=$P(^TMP($J,LIST,"IN","PROFILE",PSJCNT1),U,3)
"RTN","PSGOEV",37,0)
 ..;**Do order checks if PSJDIS (Dispense drug IEN) has a value
"RTN","PSGOEV",38,0)
 ..IF $G(PSJNEWOE)=0,'$G(PSJLMFIN),'$G(PSJSTARI),'$G(PSGCOPY),$G(PSJDIS)  D 
"RTN","PSGOEV",39,0)
 ...D EN^PSJGMRA($G(DFN),PSJDIS),IN^PSJOCDS($G(PSGORD),"UD",PSJDIS),ENDDC^PSGSICHK($G(PSGP),PSJDIS) IF $G(PSGORQF) K ^TMP($J,LIST) D EN^VALM("PSJ LM UD ACTION") QUIT
"RTN","PSGOEV",40,0)
 IF $G(PSGORQF) QUIT
"RTN","PSGOEV",41,0)
 D FULL^VALM1 ;PSJ*5*241
"RTN","PSGOEV",42,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSGOEV",43,0)
 . S PSGOEEF(109)=1
"RTN","PSGOEV",44,0)
 . S PSJACEPT=0
"RTN","PSGOEV",45,0)
 . ;D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEV",46,0)
 D DDCHK G:CHK DONE
"RTN","PSGOEV",47,0)
 I $G(PSGSCH)]"",((",P,R,")'[(","_PSGST_",")) D  I CHK G DONE
"RTN","PSGOEV",48,0)
 .N SWD,SDW,XABB,X,QX S X=$G(PSGSCH) D DW^PSGS0 Q:($G(X)="")  I $G(PSGS0XT)="" S PSGS0XT="D"
"RTN","PSGOEV",49,0)
 .I $G(PSGS0XT)="D",$G(PSGAT)="" S CHK=1 W !!,"This is a 'DAY OF WEEK' schedule and MUST have admin times.",! D PAUSE^VALM1
"RTN","PSGOEV",50,0)
 I $G(PSGSCH)]"" D  I CHK G DONE
"RTN","PSGOEV",51,0)
 .N X,Y,PSGS0XT,PSGS0Y,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",52,0)
 W !,"...a few moments, please..."
"RTN","PSGOEV",53,0)
 I PSGORD["P" D
"RTN","PSGOEV",54,0)
 . N PND0,PSGORDR,PSJPRIO,PSJSCHED S PND0=^PS(53.1,+PSGORD,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D  Q
"RTN","PSGOEV",55,0)
 .. N OEORD,OOEORD,FILE55,FILE55N0 S FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSGOEV",56,0)
 .. S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,PSGORD,+$$LASTREN^PSJLMPRI(DFN,PSGORD))
"RTN","PSGOEV",57,0)
 .. S PSGORDP=PSGORD,DIE="^PS(53.1,",DA=+PSGORD,DR="28////A;104////@" W "." D ^DIE
"RTN","PSGOEV",58,0)
 .. D START^PSGOTR(PSGORD,+PSGORDR) I OEORD D
"RTN","PSGOEV",59,0)
 ... K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSGOEV",60,0)
 ... D EN1^PSJHL2(DFN,"SC",PSGORDR),EN^PSGPEN(PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSGOEV",61,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in 55
"RTN","PSGOEV",62,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEV",63,0)
 . S DIE="^PS(53.1,",DA=+PSGORD,DR="28////A" W "." D ^DIE,^PSGOT
"RTN","PSGOEV",64,0)
 . S PSJPRIO=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,.2)),"^",4),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,.2)),"^",4),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,.2)),"^",4))
"RTN","PSGOEV",65,0)
 . S PSJSCHED=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,2)),"^"),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,2)),"^"),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,0)),"^",15))
"RTN","PSGOEV",66,0)
 . I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCHED)="NOW")!($G(PSJSCHED)["STAT") D NOTIFY^PSJHL4(PSGORD,DFN,$G(PSJPRIO),$G(PSJSCHED))
"RTN","PSGOEV",67,0)
 . I $G(PSGRDTX)="" S PSGRDTX=$G(^PS(53.1,+PSGORDP,2.5))
"RTN","PSGOEV",68,0)
 S DA=+PSGORD,DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+22000 D ^PSGAL5 W "." S VND4=$G(^PS(55,PSGP,5,DA,4))
"RTN","PSGOEV",69,0)
 I $G(PSGRDTX) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Start Date",+$G(PSGRDTX))
"RTN","PSGOEV",70,0)
 I $P($G(PSGRDTX),U,3) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Stop Date",+$P($G(PSGRDTX),U,3))
"RTN","PSGOEV",71,0)
 N DUR,DURON S DURON=$S($G(PSGORD):$G(PSGORD),1:"") I DURON D
"RTN","PSGOEV",72,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",1:5),1),1:"")
"RTN","PSGOEV",73,0)
 I $G(DUR)]"" S $P(^PS(55,PSGP,5,+PSGORD,2.5),"^",2)=DUR
"RTN","PSGOEV",74,0)
 D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSGOEV",75,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSGOEV",76,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSGOEV",77,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",9):1,1:$P(VND4,"^",15)) D EN^PSGPEN(+PSGORD)
"RTN","PSGOEV",78,0)
 S $P(VND4,"^",+PSJSYSU=1+9)=1 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSGOEV",79,0)
 I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEV",80,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSGOEV",81,0)
 I '$P(VND4,U,9) S ^PS(55,"APV",PSGP,+PSGORD)=""
"RTN","PSGOEV",82,0)
 I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSGOEV",83,0)
 I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSGOEV",84,0)
 I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSGOEV",85,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSGOEV",86,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOEV",87,0)
 S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)="" S PSGACT="C"_$S('$D(^PS(55,PSGP,5,+PSGORD,4)):"E",$P(^(4),"^",16):"",1:"E")_"RS",PSGCANFL=2
"RTN","PSGOEV",88,0)
 S VALMBCK="Q" D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSGOEV",89,0)
  ; **This is where the Automated Dispensing Machine hook is called. Do NOT DELETE or change this location **
"RTN","PSGOEV",90,0)
 D NEWJ^PSJADM
"RTN","PSGOEV",91,0)
  ; **END of Interface hook **
"RTN","PSGOEV",92,0)
 D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U")
"RTN","PSGOEV",93,0)
DONE ;
"RTN","PSGOEV",94,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSGOEV",95,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSGOEV",96,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSGOEV",97,0)
 .Q:Y="N"
"RTN","PSGOEV",98,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSGOEV",99,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X Q
"RTN","PSGOEV",100,0)
 ;
"RTN","PSGOEV",101,0)
LBL ;
"RTN","PSGOEV",102,0)
 Q
"RTN","PSGOEV",103,0)
 ;
"RTN","PSGOEV",104,0)
CHK(ND,DRG,ND2) ; checks for data in required fields
"RTN","PSGOEV",105,0)
 ; Input: ND  - ^(PS(53.1,PSGORD,0)
"RTN","PSGOEV",106,0)
 ;        DRG - ^(.2)
"RTN","PSGOEV",107,0)
 ;        ND2 - ^(2)
"RTN","PSGOEV",108,0)
 S Y=$G(Y)
"RTN","PSGOEV",109,0)
 S CHK="" I DRG,$D(^PS(50.7,+DRG,0))
"RTN","PSGOEV",110,0)
 E  S CHK=1
"RTN","PSGOEV",111,0)
 I ND="" S CHK=CHK_23
"RTN","PSGOEV",112,0)
 E  S CHK=CHK_$S($P(ND,"^",3):"",1:2)_$S($P(ND,"^",7)]"":"",1:3)
"RTN","PSGOEV",113,0)
 ;The naked reference on the line below refers to the variable ND which is ^PS(53.1,PSGORD,0).
"RTN","PSGOEV",114,0)
 I ND2="" S CHK=CHK_$S('$D(^(0)):4,$P(^(0),"^",7)="OC":"",1:4)_56
"RTN","PSGOEV",115,0)
 E  S CHK=CHK_$S($P(ND2,"^")]"":"",ND="":4,$P(ND,"^",7)="OC":"",1:4)_$S($P(ND2,"^",2):"",1:5)_$S($P(ND2,"^",4):"",1:6)
"RTN","PSGOEV",116,0)
 I $$CHECK^PSGOE8(PSJSYSP),$P(DRG,U,2)="" S CHK=CHK_8
"RTN","PSGOEV",117,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSGOEV",118,0)
 S:'$$DDOK^PSGOE2("^PS(53.45,"_PSJSYSP_",2,",+DRG) CHK=CHK_7,(PSGDFLG,PSGDI)=1
"RTN","PSGOEV",119,0)
 S:'$$OIOK^PSGOE2(+DRG) PSGPFLG=1
"RTN","PSGOEV",120,0)
 I 'CHK,$G(PSGSCH)]"" D
"RTN","PSGOEV",121,0)
 .N X,Y,PSGS0Y,PSGS0XT,PSGOES S PSGOES=2,X=PSGSCH D ENOS^PSGS0 I $G(X)="" S CHK=4
"RTN","PSGOEV",122,0)
 Q:'CHK
"RTN","PSGOEV",123,0)
 W $C(7)
"RTN","PSGOEV",124,0)
 ;
"RTN","PSGOEV",125,0)
CHKM ;
"RTN","PSGOEV",126,0)
 D FULL^VALM1 K:CHK Y
"RTN","PSGOEV",127,0)
 ; changed to remove ^DD ref
"RTN","PSGOEV",128,0)
 ; PSJ*5*267 VMP Add the 8th condition
"RTN","PSGOEV",129,0)
 W !!,"THE FOLLOWING ",$S($L(CHK)>1:"ARE",1:"IS")," EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:8 W:CHK[X !?5,$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG^DOSAGE ORDERED","^",X)
"RTN","PSGOEV",130,0)
 I CHK=7 W !,"Orders with no dispense drugs or multiple dispense drugs",!,"require dosage ordered"
"RTN","PSGOEV",131,0)
 W:CHK]"" !!,$S($L(CHK)>1:"THESE FIELDS ARE",1:"THIS FIELD IS")," NECESSARY FOR VERIFICATION."
"RTN","PSGOEV",132,0)
 N DIR S DIR(0)="E" D ^DIR I $D(DUOUT)!$D(DTOUT) S CHK=1 Q
"RTN","PSGOEV",133,0)
 Q
"RTN","PSGOEV",134,0)
 ;
"RTN","PSGOEV",135,0)
CONT() ;
"RTN","PSGOEV",136,0)
 NEW DIR,DIRUT,Y
"RTN","PSGOEV",137,0)
 W ! K DIR,DIRUT
"RTN","PSGOEV",138,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="No"
"RTN","PSGOEV",139,0)
 D ^DIR
"RTN","PSGOEV",140,0)
 Q Y
"RTN","PSGOEV",141,0)
 ;
"RTN","PSGOEV",142,0)
DDCHK ; dispense drug check
"RTN","PSGOEV",143,0)
 S DRGF="^PS("_$S(PSGORD["P":"53.1,"_+PSGORD,1:"55,"_PSGP_",5,"_+PSGORD)_",",CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSGOEV",144,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSGOEV",145,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSGOEV",146,0)
 Q:CHK=0
"RTN","PSGOEV",147,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSGOEV",148,0)
 ;
"RTN","PSGOEV",149,0)
DDEDIT ;
"RTN","PSGOEV",150,0)
 ;*** Remove all dispense drug for this order
"RTN","PSGOEV",151,0)
 K @(DRGF_"1)")
"RTN","PSGOEV",152,0)
 ; The naked reference below refers to the indirect full reference in DRGF_"1,"_Q_")", which is either ^PS(53.1,+PSGORD,Q) or ^PS(55,DFN,5,+PSGORD,Q)
"RTN","PSGOEV",153,0)
 K ^PS(53.45,PSJSYSP,2) S (X,Q)=0 F  S Q=$O(@(DRGF_"1,"_Q_")")) Q:'Q  S Y=$G(^(Q,0)),X=Q S ^PS(53.45,PSJSYSP,2,Q,0)=Y I Y S ^PS(53.45,PSJSYSP,2,"B",+Y,Q)=""
"RTN","PSGOEV",154,0)
 I X S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_X_"^"_X
"RTN","PSGOEV",155,0)
 D ENDRG^PSGOEF1(PSGPD,X)
"RTN","PSGOEV",156,0)
 I 'CHK S %X="^PS(53.45,"_PSJSYSP_",2,",%Y=DRGF_"1," D %XY^%RCR S $P(@(DRGF_"1,0)"),"^",2)=$S(DRGF[53.1:"53.11P",1:"55.07P")
"RTN","PSGOEV",157,0)
 K DRG,DRGF Q
"RTN","PSGOEV",158,0)
 ;
"RTN","PSGOEV",159,0)
AESCREEN() ;
"RTN","PSGOEV",160,0)
 ; Output: 0 - Required fields missing and DON'T allow accept
"RTN","PSGOEV",161,0)
 ;         1 - Required fields found.
"RTN","PSGOEV",162,0)
 Q:'$G(CHK) 1
"RTN","PSGOEV",163,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSGOEV",164,0)
 I Y="PSJU LM ACCEPT EDIT" Q 1
"RTN","PSGOEV",165,0)
 Q 0
"RTN","PSGOEV",166,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSGOEV",167,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSGOEV",168,0)
 ;PSGORD : IEN from 55
"RTN","PSGOEV",169,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSGOEV",170,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSGOEV",171,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSGOEV",172,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55.09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSGOEV",173,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSGOEV",174,0)
 . N TXTLN S TXTLN="" F  S TXTLN=$O(^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN)) Q:TXTLN=""  D
"RTN","PSGOEV",175,0)
 .. I TXTLN=0 S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,1,TXTLN)=^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN) Q
"RTN","PSGOEV",176,0)
 .. S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,1,TXTLN,0)=^PS(53.1,+PSGORDP,"A",PSGX,1,TXTLN,0)
"RTN","PSGOEV",177,0)
 Q
"RTN","PSJDGCK")
0^3^B7938407^B7861600
"RTN","PSJDGCK",1,0)
PSJDGCK ;HP/MJE - Drug Interaction Utility ;09/22/11 5:00pm
"RTN","PSJDGCK",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**260,288**;16 DEC 97;Build 7
"RTN","PSJDGCK",3,0)
 ;External references to ^PSSDSAPM supported by DBIA 5570
"RTN","PSJDGCK",4,0)
 ;
"RTN","PSJDGCK",5,0)
DGCK ;
"RTN","PSJDGCK",6,0)
 S PSJDGCK=1
"RTN","PSJDGCK",7,0)
 D FULL^VALM1
"RTN","PSJDGCK",8,0)
 I $D(PSJDGCK)&($G(VALM("TITLE"))="IV Order Entry") D EN^PSJO1(2)
"RTN","PSJDGCK",9,0)
 I $$DGCKIEN^PSJDGCK()="" D
"RTN","PSJDGCK",10,0)
 .W !!,"Not enough active profile drugs to perform drug check",!
"RTN","PSJDGCK",11,0)
 .K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR W @IOF
"RTN","PSJDGCK",12,0)
 E  D ^PSGOE7
"RTN","PSJDGCK",13,0)
DGCKEND S VALMBCK="R"
"RTN","PSJDGCK",14,0)
 K PSJDGCK
"RTN","PSJDGCK",15,0)
 Q
"RTN","PSJDGCK",16,0)
 ;
"RTN","PSJDGCK",17,0)
DGCKIEN() ;
"RTN","PSJDGCK",18,0)
 N PSJDGCK7 S PSJDGCK7="" I '$D(^TMP("PSJ",$J)) Q PSJDGCK7
"RTN","PSJDGCK",19,0)
 I $D(PSJDGCK) D
"RTN","PSJDGCK",20,0)
 .N PSJDGCK1,PSJDGCK2,PSJDGCK3,PSJDGCK4,PSJDGCK5,PSJDGCK6 S (PSJDGCK1,PSJDGCK2,PSJDGCK3,PSJDGCK4,PSJDGCK5,PSJDGCK6)=""
"RTN","PSJDGCK",21,0)
 .S PSJDGCK1=$O(^TMP("PSJ",$J,PSJDGCK1)),PSJDGCK2=$O(^TMP("PSJ",$J,PSJDGCK1,PSJDGCK2)),PSJDGCK3=$O(^TMP("PSJ",$J,PSJDGCK1,PSJDGCK2,PSJDGCK3)),PSJDGCK4=$O(^TMP("PSJ",$J,PSJDGCK1,PSJDGCK2,PSJDGCK3,PSJDGCK4))
"RTN","PSJDGCK",22,0)
 .I PSJDGCK4["U" S PSJDGCK5=$$GET1^DIQ(55.06,+PSJDGCK4_","_DFN_",",108,"I"),PSJDGCK6=$$DRG^PSSDSAPM(+PSJDGCK5,"I"),PSJDGCK7=$$GET1^DIQ(50,$P(PSJDGCK6,";"),.01,"E")
"RTN","PSJDGCK",23,0)
 .I PSJDGCK4["V" S PSJDGCK5=$$GET1^DIQ(55.01,+PSJDGCK4_","_DFN_",",130,"I"),PSJDGCK6=$$DRG^PSSDSAPM(+PSJDGCK5,"I"),PSJDGCK7=$$GET1^DIQ(50,$P(PSJDGCK6,";"),.01,"E")
"RTN","PSJDGCK",24,0)
 .I PSJDGCK4["P"!(PSJDGCK4["N") S PSJDGCK5=$$GET1^DIQ(53.1,+PSJDGCK4_","_DFN_",",108,"I"),PSJDGCK6=$$DRG^PSSDSAPM(+PSJDGCK5,"I"),PSJDGCK7=$$GET1^DIQ(50,$P(PSJDGCK6,";"),.01,"E")
"RTN","PSJDGCK",25,0)
 .S PSJDGCK7=PSJDGCK7_";"_$P(PSJDGCK6,";")
"RTN","PSJDGCK",26,0)
 Q PSJDGCK7
"RTN","PSJDGCK",27,0)
 ;
"RTN","PSJDGCK",28,0)
PSJSUPCK(CHK) ;
"RTN","PSJDGCK",29,0)
 I '$D(PSJDGCK) K CHK Q 0
"RTN","PSJDGCK",30,0)
 I '($P($G(^PSDRUG(CHK,0)),"^",3)["S"!($E($P($G(^PSDRUG(CHK,0)),"^",2),1,2)="XA")) K CHK Q 0
"RTN","PSJDGCK",31,0)
 W !,"You have selected a supply item, please select another drug"
"RTN","PSJDGCK",32,0)
 W !,"or leave blank and hit enter for Profile Order Checks."
"RTN","PSJDGCK",33,0)
 K CHK
"RTN","PSJDGCK",34,0)
 Q 1
"RTN","PSJOCDT")
0^2^B55186647^B48494609
"RTN","PSJOCDT",1,0)
PSJOCDT ;BIR/MV - PROCESS DUPLICATE THERAPY ORDER CHECKS ;6 Jun 07 / 3:37 PM
"RTN","PSJOCDT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**181,260,288**;16 DEC 97;Build 7
"RTN","PSJOCDT",3,0)
 ;
"RTN","PSJOCDT",4,0)
 ; Reference to EN^PSODRDU2 is supported by DBIA# 2189.
"RTN","PSJOCDT",5,0)
 ;
"RTN","PSJOCDT",6,0)
DT ;
"RTN","PSJOCDT",7,0)
 NEW PSJN1,PSJCLASS,PSJDNCNT,PSJNDV,PSJPROSP,PSJOCDT
"RTN","PSJOCDT",8,0)
 S PSJCLASS=""
"RTN","PSJOCDT",9,0)
 F PSJN1=0:0 S PSJN1=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1)) Q:'PSJN1  D
"RTN","PSJOCDT",10,0)
 . D SETCLASS
"RTN","PSJOCDT",11,0)
 . F PSJDNCNT=0:0 S PSJDNCNT=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",PSJDNCNT)) Q:'PSJDNCNT  D
"RTN","PSJOCDT",12,0)
 .. S PSJNDV=$G(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",PSJDNCNT))
"RTN","PSJOCDT",13,0)
 .. D SETOC
"RTN","PSJOCDT",14,0)
 I '$D(PSJPROSP) Q
"RTN","PSJOCDT",15,0)
 D DSPOC
"RTN","PSJOCDT",16,0)
 Q
"RTN","PSJOCDT",17,0)
DTDGCK ;This version of DT is only executed when the user selects hidden action CK (Drug Check)
"RTN","PSJOCDT",18,0)
 NEW PSJN1,PSJCLASS,PSJDNCNT,PSJNDV,PSJPROSP,PSJOCDT,PSJXX
"RTN","PSJOCDT",19,0)
 S PSJCLASS=""
"RTN","PSJOCDT",20,0)
 F PSJXX=1:1:2 D
"RTN","PSJOCDT",21,0)
 .F PSJN1=0:0 S PSJN1=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1)) Q:'PSJN1  D
"RTN","PSJOCDT",22,0)
 ..I PSJXX=1 I $P(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",1),";",3)'="PROSPECTIVE" Q
"RTN","PSJOCDT",23,0)
 ..I PSJXX=2 I $P(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",1),";",3)'="PROFILE" Q
"RTN","PSJOCDT",24,0)
 ..D SETCLASS
"RTN","PSJOCDT",25,0)
 ..F PSJDNCNT=0:0 S PSJDNCNT=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",PSJDNCNT)) Q:'PSJDNCNT  D
"RTN","PSJOCDT",26,0)
 ...S PSJNDV=$G(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,"DRUGS",PSJDNCNT))
"RTN","PSJOCDT",27,0)
 ...D SETOC
"RTN","PSJOCDT",28,0)
 ..D DSPOC K PSJOCDT,PSJPROSP S PSJCLASS=""
"RTN","PSJOCDT",29,0)
 Q
"RTN","PSJOCDT",30,0)
DSPOC ;
"RTN","PSJOCDT",31,0)
 ;PSJDSPON(ON) - Is set after the order is displayed so the same order is not displayed again
"RTN","PSJOCDT",32,0)
 NEW PSJTYPE,PSJDNM,PSPON,PSJPONX,PSJX,PSJDSPON,PSJCLINF
"RTN","PSJOCDT",33,0)
 D HDR
"RTN","PSJOCDT",34,0)
 F PSJTYPE=0:0 S PSJTYPE=$O(PSJOCDT(PSJTYPE)) Q:'PSJTYPE  D
"RTN","PSJOCDT",35,0)
 . S PSJDNM="" F  S PSJDNM=$O(PSJOCDT(PSJTYPE,PSJDNM)) Q:PSJDNM=""  D
"RTN","PSJOCDT",36,0)
 .. S PSJPON="" F  S PSJPON=$O(PSJOCDT(PSJTYPE,PSJDNM,PSJPON)) Q:PSJPON=""  D
"RTN","PSJOCDT",37,0)
 ... K PSJCLINF S PSJCLINF="" I $P(PSJPON,";",2)'="",PSJOCDT(PSJTYPE,PSJDNM,PSJPON)'=""  S PSJCLINF=PSJOCDT(PSJTYPE,PSJDNM,PSJPON),PSJCLINF(2)=PSJPON,PSJCLINF(3)=PSJDNM
"RTN","PSJOCDT",38,0)
 ... I ($Y+6)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",39,0)
 ... S PSJPONX=$P(PSJPON,";",2)
"RTN","PSJOCDT",40,0)
 ... I PSJTYPE=10,+PSJPONX D
"RTN","PSJOCDT",41,0)
 .... I '$D(PSJDSPON(PSJPONX)) D DSPORD^PSJOC(PSJPONX,,.PSJCLINF)
"RTN","PSJOCDT",42,0)
 .... S PSJDSPON(PSJPONX)=""
"RTN","PSJOCDT",43,0)
 ... I ($Y+8)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",44,0)
 ... I PSJTYPE>10 D
"RTN","PSJOCDT",45,0)
 .... I PSJCLINF D CLNDISP^PSJCLNOC(.PSJCLINF) Q
"RTN","PSJOCDT",46,0)
 .... D EN^PSODRDU2(DFN,PSJPON,"PSJPRE")
"RTN","PSJOCDT",47,0)
 ;Break the display text this way so the info on classes are indented correctly
"RTN","PSJOCDT",48,0)
 S PSJCLASS=" Involved in Therapeutic Duplication(s): "_PSJCLASS
"RTN","PSJOCDT",49,0)
 S PSJX=$L(PSJCLASS)\65 I ($Y+PSJX+4)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",50,0)
 W !,"Class(es)"
"RTN","PSJOCDT",51,0)
 D MYWRITE^PSJMISC(PSJCLASS,3,67)
"RTN","PSJOCDT",52,0)
 I ($Y+8)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",53,0)
 W !
"RTN","PSJOCDT",54,0)
 ;D LINE^PSJMISC($S($G(PSJOLDN):PSJLINE,1:"="),81)
"RTN","PSJOCDT",55,0)
 D LINE^PSJMISC("=",81)
"RTN","PSJOCDT",56,0)
 I '$D(PSJOCDT(10)),$D(PSJOCDT) K PSJPAUSE D PAUSE^PSJLMUT1 W @IOF Q
"RTN","PSJOCDT",57,0)
 ;I ($Y+8)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",58,0)
 I $D(PSJDGCK) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue..." D ^DIR K DIR Q
"RTN","PSJOCDT",59,0)
 I $D(PSJDGCK) Q
"RTN","PSJOCDT",60,0)
 D CONT
"RTN","PSJOCDT",61,0)
 Q:$G(PSGORQF)
"RTN","PSJOCDT",62,0)
 S PSJY=$$SORTLST()
"RTN","PSJOCDT",63,0)
 K PSJPAUSE
"RTN","PSJOCDT",64,0)
 I PSJY=1 D  Q
"RTN","PSJOCDT",65,0)
 . W !!
"RTN","PSJOCDT",66,0)
 . D:'$D(PSJDGCK) PROCLST(PSJY)
"RTN","PSJOCDT",67,0)
 I (PSJY>1),+$$DCPROMPT() D
"RTN","PSJOCDT",68,0)
 . W !
"RTN","PSJOCDT",69,0)
 . S PSJY=$$LST() W !
"RTN","PSJOCDT",70,0)
 . D:'$D(PSJDGCK) PROCLST(PSJY)
"RTN","PSJOCDT",71,0)
 Q
"RTN","PSJOCDT",72,0)
HDR ;
"RTN","PSJOCDT",73,0)
 NEW PSJHDR,PSJDNM
"RTN","PSJOCDT",74,0)
 I $D(^TMP($J,"PSJPRE","OUT","DRUGDRUG")) W @IOF
"RTN","PSJOCDT",75,0)
 D LINE^PSJMISC("=",81)
"RTN","PSJOCDT",76,0)
 S PSJHDR="This patient is already receiving the following INPATIENT and/or OUTPATIENT order(s) for a drug in the same therapeutic class(es)"
"RTN","PSJOCDT",77,0)
 S:$D(PSJDGCK) PSJHDR="This patient is already receiving the following INPATIENT and/or OUTPATIENT order(s) for drugs in the same therapeutic class(es)"
"RTN","PSJOCDT",78,0)
 S PSJDNM=$O(PSJPROSP("UD",""))
"RTN","PSJOCDT",79,0)
 I PSJDNM]"" S PSJHDR=PSJHDR_" as "_PSJDNM_":" D WRITE^PSJMISC(PSJHDR,1,77) Q
"RTN","PSJOCDT",80,0)
 D WRITE^PSJMISC(PSJHDR_":",1,77)
"RTN","PSJOCDT",81,0)
HDR2 ;
"RTN","PSJOCDT",82,0)
 W !,"Drug(s) Ordered:"
"RTN","PSJOCDT",83,0)
 S PSJDNM="" F  S PSJDNM=$O(PSJPROSP("IV",PSJDNM)) Q:PSJDNM=""  D
"RTN","PSJOCDT",84,0)
 . W !,?3,PSJDNM
"RTN","PSJOCDT",85,0)
 . I ($Y+8)>IOSL D PAUSE^PSJMISC() W @IOF
"RTN","PSJOCDT",86,0)
 W !
"RTN","PSJOCDT",87,0)
 Q
"RTN","PSJOCDT",88,0)
SETCLASS ;Store all classes to display at the end.
"RTN","PSJOCDT",89,0)
 NEW PSJN2,PSJCLS
"RTN","PSJOCDT",90,0)
 F PSJN2=0:0 S PSJN2=$O(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,PSJN2)) Q:'PSJN2  D
"RTN","PSJOCDT",91,0)
 . S PSJCLS=$G(^TMP($J,"PSJPRE","OUT","THERAPY",PSJN1,PSJN2,"CLASS"))
"RTN","PSJOCDT",92,0)
 . S PSJCLASS=PSJCLASS_$S(PSJCLASS="":"",1:", ")_PSJCLS
"RTN","PSJOCDT",93,0)
 Q
"RTN","PSJOCDT",94,0)
SETOC ;Set PSJOCDT array to sort by Package(Inpt, Outpt: Active, Remote, Pending, Non-VA
"RTN","PSJOCDT",95,0)
 ;PSJPROSP(UD/IV,drugname)="" - This is used to display the header
"RTN","PSJOCDT",96,0)
 ;PSJOCDT(package,drugname,Pharm ord#)=""
"RTN","PSJOCDT",97,0)
 NEW PSJPON,PSJPKG,PSJTYPE,PSJDNM,PSJPONX,PSJCLINF,PSJDXOPT
"RTN","PSJOCDT",98,0)
 S PSJPON=$P(PSJNDV,U) Q:PSJPON=""
"RTN","PSJOCDT",99,0)
 S PSJCLINF="",PSJDXOPT=$S($G(PSJDGCK):"PROSPECTIVE",1:"PROFILE")
"RTN","PSJOCDT",100,0)
 I $P(PSJPON,";",3)'="PROSPECTIVE" S PSJCLINF=$P(^TMP($J,"PSJPRE","IN",PSJDXOPT,PSJPON),"^",7)
"RTN","PSJOCDT",101,0)
 S PSJPONX=$P(PSJPON,";",2)
"RTN","PSJOCDT",102,0)
 S PSJTYPE=$P(PSJPON,";") Q:PSJTYPE=""
"RTN","PSJOCDT",103,0)
 S PSJDNM=$P(PSJNDV,U,3) Q:PSJDNM=""
"RTN","PSJOCDT",104,0)
 S PSJPKG=$S(PSJTYPE["C":10,PSJTYPE="I":10,PSJTYPE="O":20,PSJTYPE="R":30,PSJTYPE="P":40,PSJTYPE="N":50,1:"")
"RTN","PSJOCDT",105,0)
 ; Set prospective drug name array to display in the header.
"RTN","PSJOCDT",106,0)
 I PSJPKG=10,($P(PSJPON,";",3)="PROSPECTIVE") D  Q
"RTN","PSJOCDT",107,0)
 . I PSJPONX["V" S PSJPROSP("IV",PSJDNM)="" Q
"RTN","PSJOCDT",108,0)
 . I PSJPONX["P",+$G(PSJLIFNI) S PSJPROSP("IV",PSJDNM)="" Q
"RTN","PSJOCDT",109,0)
 . I PSJPONX["P",($P($G(^PS(53.1,+PSJPONX,8)),U)]"") S PSJPROSP("IV",PSJDNM)="" Q
"RTN","PSJOCDT",110,0)
 . S PSJPROSP("UD",PSJDNM)=""
"RTN","PSJOCDT",111,0)
 S PSJOCDT(PSJPKG,PSJDNM,PSJPON)=PSJCLINF
"RTN","PSJOCDT",112,0)
 Q
"RTN","PSJOCDT",113,0)
CONT ;Display the continue prompt.
"RTN","PSJOCDT",114,0)
 NEW DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,X
"RTN","PSJOCDT",115,0)
 W !
"RTN","PSJOCDT",116,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")=$S($D(PSJDGCK):"Do you wish to continue",1:"Do you wish to continue with the current order")
"RTN","PSJOCDT",117,0)
 S DIR("?",1)="Enter 'NO' if you wish to not continue with the order,",DIR("?")="or 'YES' to continue with the current order."
"RTN","PSJOCDT",118,0)
 D ^DIR
"RTN","PSJOCDT",119,0)
 I 'Y!($G(PSJDGCK)) S PSGORQF=1 S VALMBCK="R"
"RTN","PSJOCDT",120,0)
 Q
"RTN","PSJOCDT",121,0)
DCPROMPT() ;Prompt if user wants to DC order(s)
"RTN","PSJOCDT",122,0)
 NEW DIR,DTOUT,DIRUT,DIROUT,DUOUT,Y,X
"RTN","PSJOCDT",123,0)
 W !
"RTN","PSJOCDT",124,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you wish to DISCONTINUE any of the listed INPATIENT orders"
"RTN","PSJOCDT",125,0)
 S DIR("?",1)="Enter 'NO' if you don't wish to discontinue any of the order(s),",DIR("?")="or 'YES' to discontinue selected order(s)."
"RTN","PSJOCDT",126,0)
 D ^DIR
"RTN","PSJOCDT",127,0)
 Q Y
"RTN","PSJOCDT",128,0)
SORTLST() ;Sort orders into a numeric list
"RTN","PSJOCDT",129,0)
 NEW DIR,DIRUT,DTOUT,DUOUT,PSJN,PSJPON1,PSJMONV,PSJS,PSJSEV1,PSJX,X,Y,PSJDNM,PSJPONX,PSJDSPON,PSOCLINF
"RTN","PSJOCDT",130,0)
 ;Sort orders into a numeric list
"RTN","PSJOCDT",131,0)
 Q:'$D(PSJOCDT(10)) 0
"RTN","PSJOCDT",132,0)
 S PSJN=0,PSJDNM=""
"RTN","PSJOCDT",133,0)
 F  S PSJDNM=$O(PSJOCDT(10,PSJDNM)) Q:PSJDNM=""  S PSJS="" F  S PSJS=$O(PSJOCDT(10,PSJDNM,PSJS)) Q:PSJS=""  D
"RTN","PSJOCDT",134,0)
 . S PSJPONX=$P(PSJS,";",2)
"RTN","PSJOCDT",135,0)
 . S PSJCLINF="",PSJCLINF=PSJOCDT(10,PSJDNM,PSJS)
"RTN","PSJOCDT",136,0)
 . ;Business Rule(s): don't show orders that have a status of DISCONTINUED in list
"RTN","PSJOCDT",137,0)
 . S PSJDSPON(PSJPONX)=""
"RTN","PSJOCDT",138,0)
 . S:'$$CKDC^PSJOCDT PSJN=PSJN+1,PSJOCDTL(PSJN)=PSJPONX
"RTN","PSJOCDT",139,0)
 Q PSJN
"RTN","PSJOCDT",140,0)
LST() ;
"RTN","PSJOCDT",141,0)
 ;Only present the list if there are more than 1 orders the list
"RTN","PSJOCDT",142,0)
 F PSJX=0:0 S PSJX=$O(PSJOCDTL(PSJX)) Q:'PSJX  D
"RTN","PSJOCDT",143,0)
 . I ($Y+6)>IOSL D PAUSE^PSJMISC(1,) W @IOF
"RTN","PSJOCDT",144,0)
 . D DSPORD^PSJOC(PSJOCDTL(PSJX),PSJX_".  ")
"RTN","PSJOCDT",145,0)
 W !
"RTN","PSJOCDT",146,0)
 K DIR S DIR(0)="LO^1:"_$O(PSJOCDTL(""),-1),DIR("A")="Enter a list or range of numbers to discontinue" D ^DIR
"RTN","PSJOCDT",147,0)
 Q Y
"RTN","PSJOCDT",148,0)
PROCLST(PSJY) ;DC the orders selected by user
"RTN","PSJOCDT",149,0)
 NEW PSJX,PSJX1,PSJON,PSJCLINF
"RTN","PSJOCDT",150,0)
 F PSJX1=1:1:$L(PSJY) S PSJX=$P(PSJY,",",PSJX1) Q:PSJX=""  D
"RTN","PSJOCDT",151,0)
 . I ($Y+8)>IOSL D PAUSE^PSJMISC() W @IOF
"RTN","PSJOCDT",152,0)
 . I '$D(PSJOCDTL(PSJX)) Q
"RTN","PSJOCDT",153,0)
 . S PSJON=PSJOCDTL(PSJX),PSJCLINF=0
"RTN","PSJOCDT",154,0)
 . I $D(PSJOCDTL(PSJX,"CLN")) S PSJCLINF=$P(PSJOCDTL(PSJX,"CLN"),"^"),PSJCLINF(2)=$P(PSJOCDTL(PSJX,"CLN"),"^",2),PSJCLINF(3)=$P(PSJOCDTL(PSJX,"CLN"),"^",3)
"RTN","PSJOCDT",155,0)
 . D DC^PSJOCDC(PSGP,PSJON,.PSJCLINF)
"RTN","PSJOCDT",156,0)
 . W !
"RTN","PSJOCDT",157,0)
 Q
"RTN","PSJOCDT",158,0)
CKDC() ; rule: don't show orders that have a status of DISCONTINUED in list
"RTN","PSJOCDT",159,0)
 N PSJCKPON,PSJCKFLD
"RTN","PSJOCDT",160,0)
 S (PSJCKFLD,PSJCKPON)="",PSJCKPON=$S(PSJPONX["U":55.06,PSJPONX["I"!(PSJPONX["V"):55.01,1:53.1)
"RTN","PSJOCDT",161,0)
 S PSJCKFLD=$S(PSJPONX["V"!(PSJPONX="I"):"100",1:"28")  ;Unit dose and pending/non-verified file statuses are in field 28 in each file
"RTN","PSJOCDT",162,0)
 D GETS^DIQ(PSJCKPON,+PSJPONX_","_DFN,PSJCKFLD,"I","DCTMP")
"RTN","PSJOCDT",163,0)
 I '$D(DCTMP(PSJCKPON,+PSJPONX_","_DFN_",",PSJCKFLD,"I")) K DCTMP Q 0
"RTN","PSJOCDT",164,0)
 I DCTMP(PSJCKPON,+PSJPONX_","_DFN_",",PSJCKFLD,"I")="D" K DCTMP Q 1
"RTN","PSJOCDT",165,0)
 K DCTMP Q 0
"VER")
8.0^22.0
"BLD",8514,6)
^243
**END**
**END**
