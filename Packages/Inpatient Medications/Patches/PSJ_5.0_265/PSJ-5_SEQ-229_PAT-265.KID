Released PSJ*5*265 SEQ #229
Extracted from mail message
**KIDS**:PSJ*5.0*265^

**INSTALL NAME**
PSJ*5.0*265
"BLD",8623,0)
PSJ*5.0*265^INPATIENT MEDICATIONS^0^3110920^y
"BLD",8623,1,0)
^^8^8^3110915^
"BLD",8623,1,1,0)
This patch will resolve the following issues in the Inpatient Medications 
"BLD",8623,1,2,0)
package:
"BLD",8623,1,3,0)
 
"BLD",8623,1,4,0)
-Pending Clinic orders not accessible in Non-Verified/Pending Orders
"BLD",8623,1,5,0)
 Report
"BLD",8623,1,6,0)
-Non-Verified Clinic orders not accessible in Non-Verified/Pending Orders
"BLD",8623,1,7,0)
 Report
"BLD",8623,1,8,0)
-Loop when editing Stop Date 
"BLD",8623,4,0)
^9.64PA^^
"BLD",8623,6.3)
4
"BLD",8623,"INID")
^n
"BLD",8623,"INIT")
EN^PSJ50265
"BLD",8623,"KRN",0)
^9.67PA^779.2^20
"BLD",8623,"KRN",.4,0)
.4
"BLD",8623,"KRN",.401,0)
.401
"BLD",8623,"KRN",.402,0)
.402
"BLD",8623,"KRN",.403,0)
.403
"BLD",8623,"KRN",.5,0)
.5
"BLD",8623,"KRN",.84,0)
.84
"BLD",8623,"KRN",3.6,0)
3.6
"BLD",8623,"KRN",3.8,0)
3.8
"BLD",8623,"KRN",9.2,0)
9.2
"BLD",8623,"KRN",9.8,0)
9.8
"BLD",8623,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",8623,"KRN",9.8,"NM",1,0)
PSGAXR^^0^B8428515
"BLD",8623,"KRN",9.8,"NM",2,0)
PSGOE91^^0^B41731482
"BLD",8623,"KRN",9.8,"NM",3,0)
PSGVBW^^0^B96887631
"BLD",8623,"KRN",9.8,"NM","B","PSGAXR",1)

"BLD",8623,"KRN",9.8,"NM","B","PSGOE91",2)

"BLD",8623,"KRN",9.8,"NM","B","PSGVBW",3)

"BLD",8623,"KRN",19,0)
19
"BLD",8623,"KRN",19.1,0)
19.1
"BLD",8623,"KRN",101,0)
101
"BLD",8623,"KRN",409.61,0)
409.61
"BLD",8623,"KRN",771,0)
771
"BLD",8623,"KRN",779.2,0)
779.2
"BLD",8623,"KRN",870,0)
870
"BLD",8623,"KRN",8989.51,0)
8989.51
"BLD",8623,"KRN",8989.52,0)
8989.52
"BLD",8623,"KRN",8994,0)
8994
"BLD",8623,"KRN","B",.4,.4)

"BLD",8623,"KRN","B",.401,.401)

"BLD",8623,"KRN","B",.402,.402)

"BLD",8623,"KRN","B",.403,.403)

"BLD",8623,"KRN","B",.5,.5)

"BLD",8623,"KRN","B",.84,.84)

"BLD",8623,"KRN","B",3.6,3.6)

"BLD",8623,"KRN","B",3.8,3.8)

"BLD",8623,"KRN","B",9.2,9.2)

"BLD",8623,"KRN","B",9.8,9.8)

"BLD",8623,"KRN","B",19,19)

"BLD",8623,"KRN","B",19.1,19.1)

"BLD",8623,"KRN","B",101,101)

"BLD",8623,"KRN","B",409.61,409.61)

"BLD",8623,"KRN","B",771,771)

"BLD",8623,"KRN","B",779.2,779.2)

"BLD",8623,"KRN","B",870,870)

"BLD",8623,"KRN","B",8989.51,8989.51)

"BLD",8623,"KRN","B",8989.52,8989.52)

"BLD",8623,"KRN","B",8994,8994)

"BLD",8623,"QUES",0)
^9.62^^
"BLD",8623,"REQB",0)
^9.611^2^2
"BLD",8623,"REQB",1,0)
PSJ*5.0*179^2
"BLD",8623,"REQB",2,0)
PSJ*5.0*243^2
"BLD",8623,"REQB","B","PSJ*5.0*179",1)

"BLD",8623,"REQB","B","PSJ*5.0*243",2)

"INIT")
EN^PSJ50265
"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
265^3110920
"PKG",221,22,1,"PAH",1,1,0)
^^8^8^3110920
"PKG",221,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues in the Inpatient Medications 
"PKG",221,22,1,"PAH",1,1,2,0)
package:
"PKG",221,22,1,"PAH",1,1,3,0)
 
"PKG",221,22,1,"PAH",1,1,4,0)
-Pending Clinic orders not accessible in Non-Verified/Pending Orders
"PKG",221,22,1,"PAH",1,1,5,0)
 Report
"PKG",221,22,1,"PAH",1,1,6,0)
-Non-Verified Clinic orders not accessible in Non-Verified/Pending Orders
"PKG",221,22,1,"PAH",1,1,7,0)
 Report
"PKG",221,22,1,"PAH",1,1,8,0)
-Loop when editing Stop Date 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSGAXR")
0^1^B8428515^B7839791
"RTN","PSGAXR",1,0)
PSGAXR ;BIR/CML3-EXECUTE VARIOUS XREFS ;24 JUN 96 / 12:06 PM
"RTN","PSGAXR",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**111,265**;16 DEC 97;Build 4
"RTN","PSGAXR",3,0)
 ;
"RTN","PSGAXR",4,0)
ENSS ; set x-refs under 53.1,28
"RTN","PSGAXR",5,0)
 S ZZ=+$G(^PS(53.1,DA,.2)),ZZZ=+$G(^PS(53.1,DA,"DSS")) S:$D(PSGP)[0 PSGP=$P($G(^PS(53.1,DA,0)),"^",15)_"^1" I 'PSGP,'ZZ K ZZ K:$P(PSGP,"^",2) PSGP Q
"RTN","PSGAXR",6,0)
 I PSGP D 
"RTN","PSGAXR",7,0)
 . S ^PS(53.1,"AS",X,+PSGP,DA)="" I $S(X["A":0,1:X'["D") S ^PS(53.1,"AC",+PSGP,DA)="" S:ZZ ^PS(53.1,"AOD",+PSGP,ZZ,DA)="" S:ZZZ ^PS(53.1,"AD",ZZZ,+PSGP,DA)=""
"RTN","PSGAXR",8,0)
 . I X="P",+$P($G(^PS(53.1,DA,4)),U) S ^PS(53.1,"AV",+PSGP,DA)=""
"RTN","PSGAXR",9,0)
 ;I X]"" S ZZ=$S($G(ORIFN):ORIFN,1:$P($G(^PS(53.1,DA,0)),"^",21)_"^1") I ZZ S ORIFN=+ZZ D ENSC^PSGORU K:$P(ZZ,"^",2) ORIFN
"RTN","PSGAXR",10,0)
 ;D EN1^PSJHL2(PSGP,"OC",DA_"P")
"RTN","PSGAXR",11,0)
 K ZZ,ZZZ K:$P(PSGP,"^",2) PSGP Q
"RTN","PSGAXR",12,0)
 ;
"RTN","PSGAXR",13,0)
ENSK ; kill x-refs under 53.1,28
"RTN","PSGAXR",14,0)
 S:$D(PSGP)[0 PSGP=$P($G(^PS(53.1,DA,0)),"^",15)_"^1" S ZZ=+$G(^PS(53.1,DA,.1)),ZZZ=+$G(^PS(53.1,DA,"DSS"))
"RTN","PSGAXR",15,0)
 I PSGP K ^PS(53.1,"AC",+PSGP,DA),^PS(53.1,"AS",X,+PSGP,DA),^PS(53.1,"AV",+PSGP,DA) K:ZZ ^PS(53.1,"AOD",+PSGP,ZZ,DA) K:ZZZ ^PS(53.1,"AD",ZZZ,+PSGP,DA)
"RTN","PSGAXR",16,0)
 K ZZ,ZZZ K:$P(PSGP,"^",2) PSGP Q
"RTN","PSGAXR",17,0)
 ;
"RTN","PSGAXR",18,0)
ENNDS ; set x-refs under 53.1,.1
"RTN","PSGAXR",19,0)
 S ^PS(53.1,"D",X,DA)="" S:$D(PSGP)[0 PSGP=$P($G(^PS(53.1,DA,0)),"^",15)_"^1" I PSGP S PSGX=X D END^PSGSICHK S X=PSGX,PSGX=$P($G(^PS(53.1,DA,0)),"^",9) I $S(PSGX["A":0,1:PSGX'["D") S ^PS(53.1,"AOD",+PSGP,X,DA)=""
"RTN","PSGAXR",20,0)
 K PSGX K:$P(PSGP,"^",2) PSGP Q
"RTN","PSGAXR",21,0)
 ;
"RTN","PSGAXR",22,0)
ENNDK ; kill x-refs under 53.1,.1
"RTN","PSGAXR",23,0)
 S:$D(PSGP)[0 PSGP=$P($G(^PS(53.1,DA,0)),"^",15)_"^1" K ^PS(53.1,"D",X,DA) K:PSGP ^PS(53.1,"AOD",+PSGP,X,DA) K:$P(PSGP,"^",2) PSGP Q
"RTN","PSGAXR",24,0)
 ;
"RTN","PSGAXR",25,0)
ENNPS ; set x-refs under 53.1,.5
"RTN","PSGAXR",26,0)
 S ^PS(53.1,"C",X,DA)="",PSGX=$P($G(^PS(53.1,DA,0)),"^",9) S:PSGX]"" ^PS(53.1,"AS",PSGX,X,DA)=""
"RTN","PSGAXR",27,0)
 I $S(PSGX["A":0,1:PSGX'["D") S ^PS(53.1,"AC",X,DA)=""
"RTN","PSGAXR",28,0)
 I PSGX="P",+$P($G(^PS(53.1,DA,4)),U) S ^PS(53.1,"AV",X,DA)=""
"RTN","PSGAXR",29,0)
 S:PSGX ^PS(53.1,"AOD",X,PSGX,DA)=""
"RTN","PSGAXR",30,0)
 K PSGX Q
"RTN","PSGAXR",31,0)
 ;
"RTN","PSGAXR",32,0)
ENNPK ; kill x-refs under 53.1,.5
"RTN","PSGAXR",33,0)
 K ^PS(53.1,"AC",X,DA),^PS(53.1,"C",X,DA) S PSGX=$P($G(^PS(53.1,DA,0)),"^",9) K:PSGX]"" ^PS(53.1,"AS",PSGX,X,DA) S PSGX=+$G(^PS(53.1,DA,.1)) K:PSGX ^PS(53.1,"AOD",X,PSGX,DA)
"RTN","PSGAXR",34,0)
 K ^PS(53.1,"AV",X,DA)
"RTN","PSGAXR",35,0)
 K PSGX Q
"RTN","PSGAXR",36,0)
ENNACK ; Set x-refs under Nurse verification for acknowleged pending orders.
"RTN","PSGAXR",37,0)
 S PSGX=$G(^PS(53.1,DA,0)) S PSGP=$P(PSGX,U,15)
"RTN","PSGAXR",38,0)
 S PSGST=$P(PSGX,U,9)
"RTN","PSGAXR",39,0)
 I PSGP,+X,(PSGST="P") S ^PS(53.1,"AV",PSGP,DA)=""
"RTN","PSGAXR",40,0)
 K PSGX,PSGP,PSGST Q
"RTN","PSGAXR",41,0)
ENNACKK ; Kill x-refs under Nurse verification
"RTN","PSGAXR",42,0)
 S PSGP=$P($G(^PS(53.1,DA,0)),U,15)
"RTN","PSGAXR",43,0)
 K:+PSGP ^PS(53.1,"AV",+PSGP,DA) Q
"RTN","PSGOE91")
0^2^B41731482^B41627571
"RTN","PSGOE91",1,0)
PSGOE91 ;BIR/CML3-ACTIVE ORDER EDIT (CONT.) ; 8/4/10 7:07am
"RTN","PSGOE91",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,64,58,110,111,136,113,179,265**;16 DEC 97;Build 4
"RTN","PSGOE91",3,0)
 ;
"RTN","PSGOE91",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE91",5,0)
 ;
"RTN","PSGOE91",6,0)
41 ; admin times
"RTN","PSGOE91",7,0)
 S MSG=0,PSGF2=41,ORIG=$G(PSGAT) S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",8,0)
 I $$ODD^PSGS0(PSGS0XT)!(PSGST="P")!$$PRNOK^PSGS0($G(PSGSCH)) G DONE
"RTN","PSGOE91",9,0)
A41 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",10,0)
 . W !!?5,"ADMIN TIMES may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",11,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!('$T) W:'$T $C(7) S PSGOEE=0 S:X="^" (X,PSGAT)=ORIG G DONE
"RTN","PSGOE91",12,0)
 I X="" S:$G(PSGAT) X=PSGAT
"RTN","PSGOE91",13,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A41
"RTN","PSGOE91",14,0)
 I X="@" I (PSGS0XT="D")!(PSGSCH["@") I ((",P,R,OC,O,")'[(","_$G(PSGST)_",")) D  G A41
"RTN","PSGOE91",15,0)
 .W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(55.06,41)
"RTN","PSGOE91",16,0)
 I X="@" D DEL G:%'=1 A41 S PSGAT="",X=""
"RTN","PSGOE91",17,0)
 I (PSGST="O")!($G(PSGST)="OC")!($G(PSGST)="P")!$$ODD^PSGS0($P(ZZND,"^",3))!($P(ZZND,"^",5)="O") I X="" S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE91",18,0)
 I $G(PSGS0XT) I '$$ODD^PSGS0(PSGS0XT),$G(PSGST)'="P",$G(PSGST)'="OC",'$$PRNOK^PSGS0(PSGSCH) I ($G(PSGST)'="O") D TIMES I '$D(X) G A41
"RTN","PSGOE91",19,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",20,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",21,0)
 S PSGOAT=PSGAT
"RTN","PSGOE91",22,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE91",23,0)
 ;
"RTN","PSGOE91",24,0)
8 ; special instructions
"RTN","PSGOE91",25,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE91"
"RTN","PSGOE91",26,0)
A8 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE91",27,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE91",28,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE91",29,0)
 N DIR S DIR(0)="FO^1:180^D ^PSGSICHK",DIR("A")="SPECIAL INSTRUCTIONS",DIR("??")="^D ENHLP^PSGOEM(55.06,8)" S:$G(PSGSI)]"" DIR("B")=$P(PSGSI,"^") D ^DIR I $D(DUOUT)!$D(DTOUT) S PSGOEE=0 G DONE
"RTN","PSGOE91",30,0)
 I $E(X)=U D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",31,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",32,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE91",33,0)
 I Y="",PSGSI="" G DONE
"RTN","PSGOE91",34,0)
 S PSGSI=$S(Y]"":Y,1:PSGSI),PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE91",35,0)
 Q
"RTN","PSGOE91",36,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":PSGSI_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",37,0)
 I X="" S X=PSGSI I X="" G DONE
"RTN","PSGOE91",38,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",39,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",40,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE91",41,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",42,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",43,0)
 S PSGSI=X G DONE
"RTN","PSGOE91",44,0)
 ;
"RTN","PSGOE91",45,0)
10 ; start date/time
"RTN","PSGOE91",46,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE91"
"RTN","PSGOE91",47,0)
A10 ;
"RTN","PSGOE91",48,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",49,0)
 . W !!?5,"Start Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",50,0)
 K PSGSDX
"RTN","PSGOE91",51,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",52,0)
 I X="",PSGSD W "  "_PSGSDN G DONE
"RTN","PSGOE91",53,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE91",54,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,10)
"RTN","PSGOE91",55,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A10
"RTN","PSGOE91",56,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(55.06,10) G A10
"RTN","PSGOE91",57,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE91",58,0)
 S (PSGSDX,PSGSD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) G DONE
"RTN","PSGOE91",59,0)
 ;
"RTN","PSGOE91",60,0)
34 ; stop date
"RTN","PSGOE91",61,0)
 S MSG=0,PSGF2=34 S:PSGOEEF(PSGF2) BACK="34^PSGOE91"
"RTN","PSGOE91",62,0)
A34 ;
"RTN","PSGOE91",63,0)
 K PSGFDX
"RTN","PSGOE91",64,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",65,0)
 . W !!?5,"Stop Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",66,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",67,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W34
"RTN","PSGOE91",68,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A34
"RTN","PSGOE91",69,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,34)
"RTN","PSGOE91",70,0)
 I X=+X,(X>0),(X'>2000000) G A34:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE91",71,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A34 S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE91",72,0)
W34 ;Compare to Start Date
"RTN","PSGOE91",73,0)
 N Z,MSG
"RTN","PSGOE91",74,0)
 D DOSE I $G(Z)]"",Z>$S($G(PSGFD):PSGFD,1:$G(PSGNEFD)) D  G A34
"RTN","PSGOE91",75,0)
 . S MSG(1)="There is no administration time that falls between the Start Date/Time"
"RTN","PSGOE91",76,0)
 . S MSG(2)="and the Stop Date/Time."
"RTN","PSGOE91",77,0)
 . D EN^DDIOL(.MSG)
"RTN","PSGOE91",78,0)
 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE91",79,0)
 ;
"RTN","PSGOE91",80,0)
DONE ;
"RTN","PSGOE91",81,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE91",82,0)
 ;BHW;PSJ*5*179; - Remove EFD call.  Added to PSGOEE.
"RTN","PSGOE91",83,0)
 ;D EFDACT^PSJUTL
"RTN","PSGOE91",84,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE91",85,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT,ORIG Q
"RTN","PSGOE91",86,0)
 ;
"RTN","PSGOE91",87,0)
FF ; up-arrow to another field
"RTN","PSGOE91",88,0)
 D ENFF^PSGOEM I Y>0,Y'=41,Y'=8,Y'=10,Y'=34 S Y=Y_"^PSGOE9"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE91"
"RTN","PSGOE91",89,0)
 Q
"RTN","PSGOE91",90,0)
 ;
"RTN","PSGOE91",91,0)
DEL ; delete entry
"RTN","PSGOE91",92,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE91",93,0)
 Q
"RTN","PSGOE91",94,0)
 ;
"RTN","PSGOE91",95,0)
TIMES ;At least one admin time, not more than interval allows.
"RTN","PSGOE91",96,0)
 I $G(PSGST)'="O",($G(PSGST)'="OC"),($G(PSGST)'="R") I X="" D EN^DDIOL("This order requires at least one administration time.") K X Q  ;No times
"RTN","PSGOE91",97,0)
 N H,I,MAX
"RTN","PSGOE91",98,0)
 I PSGSCH]"" I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",3)
"RTN","PSGOE91",99,0)
 I $G(PSGST)="O",$L(X,"-")>1 D EN^DDIOL("This is a One Time Order. Only one administration time is permitted.") K X Q
"RTN","PSGOE91",100,0)
 I $G(PSGST)="O" Q  ;Done validating One Time
"RTN","PSGOE91",101,0)
 I +$G(I)=0 Q  ;No frequency - can not check frequency related items
"RTN","PSGOE91",102,0)
 S MAX=1440/I
"RTN","PSGOE91",103,0)
 I MAX<1,$L(X,"-")>1 D EN^DDIOL("This order requires one administration time.") K X Q
"RTN","PSGOE91",104,0)
 I MAX'<1,$L(X,"-")>MAX D EN^DDIOL("The number of admin times entered is greater than indicated by the schedule.") K X Q  ;Too many times
"RTN","PSGOE91",105,0)
 I MAX'<1,$L(X,"-")<MAX D EN^DDIOL("The number of admin times entered is fewer than indicated by the schedule.")  ;Too few times
"RTN","PSGOE91",106,0)
 Q
"RTN","PSGOE91",107,0)
 ;
"RTN","PSGOE91",108,0)
DOSE ;Make certain at least one dose is given.
"RTN","PSGOE91",109,0)
 N INFO,X
"RTN","PSGOE91",110,0)
 S Z="",INFO=($S($G(PSGSD):PSGSD,1:$G(PSGNESD)))_U_($S($G(PSGFD):PSGFD,1:$G(PSGNEFD)))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSGOE91",111,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSGOE91",112,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSGOE91",113,0)
 S Z=$$ENQ^PSJORP2(PSGP,INFO)  ;Expected first dose.
"RTN","PSGOE91",114,0)
 Q
"RTN","PSGVBW")
0^3^B96887631^B96214965
"RTN","PSGVBW",1,0)
PSGVBW ;BIR/CML3,MV - VERIFY ORDERS BY WARD, WARD GROUP, PATIENT, OR PRIORITY ;10/22/98 3:14 PM
"RTN","PSGVBW",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**5,16,39,59,62,67,58,81,80,110,111,133,139,155,241,243,265**;DEC 16, 1997;Build 4
"RTN","PSGVBW",3,0)
 ;
"RTN","PSGVBW",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGVBW",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177
"RTN","PSGVBW",6,0)
 ; Reference to ^DPT is supported by DBIA #10035
"RTN","PSGVBW",7,0)
 ;
"RTN","PSGVBW",8,0)
 N PSJNEW,PSGPTMP,PPAGE,CL,CG S PSJNEW=1
"RTN","PSGVBW",9,0)
START ; Lookup patient by ward group, ward, priority, or patient; depending on value of PSGSS
"RTN","PSGVBW",10,0)
 ; 
"RTN","PSGVBW",11,0)
 D ENCV^PSGSETU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",12,0)
 D ^PSIVXU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",13,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSGVBW",14,0)
 I '$D(^XTMP("PSJPVNV")) D
"RTN","PSGVBW",15,0)
 .K DIR S DIR(0)="Y",DIR("A")="Display an Order Summary",DIR("B")="NO"
"RTN","PSGVBW",16,0)
 .S DIR("?",1)="Enter 'YES' to see a summary of orders by type and ward group",DIR("?")="or 'NO' to go directly to patient selection."
"RTN","PSGVBW",17,0)
 .D ^DIR K DIR Q:$D(DIRUT)!$D(DUOUT)  I Y D CNTORDRS^PSGVBWU
"RTN","PSGVBW",18,0)
 K ^TMP("PSJ",$J) S PSGPXN=0 D GTOOP G:$D(DIRUT) DONE L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE
"RTN","PSGVBW",19,0)
 S PSGSSH="VBW",PSGPXN=0,PSJPROT=$S($P(PSJSYSU,";",3)=3:3,$G(PSJRNF):3,$G(PSJIRNF):3,1:1)
"RTN","PSGVBW",20,0)
 S PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING")
"RTN","PSGVBW",21,0)
 F  K ^TMP("PSJSELECT",$J) D PRI^PSGSEL Q:"^"[PSGSS  F  S (PSGP,WD,WG)=0 S PSGPTMP=0,PPAGE=1 K PSGPRIF D @PSGSS Q:+Y'>0  D GO
"RTN","PSGVBW",22,0)
 ;
"RTN","PSGVBW",23,0)
DONE ; Cleanup
"RTN","PSGVBW",24,0)
 D DONE2
"RTN","PSGVBW",25,0)
 K SETWDN,PTPRI,SETTM,SETPN,SUBS,TMPWD,STATUS
"RTN","PSGVBW",26,0)
 K CHK,D0,DRGI,FQC,J,ND,ON,PN,PSGODT,PSGOEA,PSGOP,PSGSS,PSGSSH,RB,SD,ST,TM,WD,WDN,WG,PRI,PSJPNV,PSJCT,PSGCLF,PSGPRIF,LIDT,WDNAME,IFPRI
"RTN","PSGVBW",27,0)
 K PSGODDD,PSGOEORF,PSJORL,PSJORPCL,PSJORTOU,PSJORVP,PSGTOL,PSJTOO,PSGUOW,PSGONV,PX,PSGOEAV,PSGPX,PSGVBWTO,PSGVBWW,PSJOPC,PSGOENOF,PSJPROT,PSJLM,PSJASK
"RTN","PSGVBW",28,0)
 K PSJPAC,PSJINDEX,PSJCNT,PSIVSN,PSGWORP1,PSGWORP2,PSGVBY,PSGVBWN,PSGVBTM,PSGVBPN,PSGPXN,PSGPRIN,PSGPRD,PSGINWD,PSGINCL,PRDON,PRDNS,PRD,PPN,ORDT
"RTN","PSGVBW",29,0)
 L -^PS(53.45,PSJSYSP) G:$G(PSGPXN) ^PSGPER1 D ENKV^PSGSETU K ND Q
"RTN","PSGVBW",30,0)
 ;
"RTN","PSGVBW",31,0)
DONE2 ; Partial Cleanup
"RTN","PSGVBW",32,0)
 K ^TMP("PSGVBW",$J),^TMP("PSGVBW2",$J),^TMP("PSGVBW3",$J),^TMP("PSJSELECT",$J),^TMP("PSJLIST",$J),^TMP("PSJON",$J)
"RTN","PSGVBW",33,0)
 K PRD
"RTN","PSGVBW",34,0)
 Q
"RTN","PSGVBW",35,0)
 ;
"RTN","PSGVBW",36,0)
GO ; Find and display matching patients
"RTN","PSGVBW",37,0)
 I PSGSS'="P" W !,"...a few moments, please..." K ^TMP("PSGVBW",$J),^TMP("PSGVBW2",$J) D ARRAY K CHK,ON,PN,RB,SD,TM,WD,WDN,WG,X,Y
"RTN","PSGVBW",38,0)
 I PSGSS'="P",'$D(^TMP("PSGVBW",$J)) W !,$C(7),"NO ",PSGVBWW," ORDERS FOR ",$S(PSGSS="P":"PATIENT",PSGSS="L":"CLINIC GROUP",PSGSS="C":"CLINIC",PSGSS="PR":"PRIORITY",1:"WARD"),$S(PSGSS="G":" GROUP",1:"")," SELECTED." Q
"RTN","PSGVBW",39,0)
 D ^PSGVBW0,DONE2 Q
"RTN","PSGVBW",40,0)
 ;
"RTN","PSGVBW",41,0)
G ; Select a Ward Group
"RTN","PSGVBW",42,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD GROUP: "
"RTN","PSGVBW",43,0)
 S DIR("?")="^D GDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",44,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",45,0)
GDIC ; Ward Group lookup
"RTN","PSGVBW",46,0)
 K DIC S DIC="^PS(57.5,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 WG=+Y
"RTN","PSGVBW",47,0)
 W:X["?" !!,"Enter ""^OTHER"" to include all orders from the wards that do not",!,"belong to a ward group, or orders that have neither a ward nor a clinic.",! ;PSJ*5*241: Updated help text
"RTN","PSGVBW",48,0)
 Q
"RTN","PSGVBW",49,0)
C ; Select a Clinic
"RTN","PSGVBW",50,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGVBW",51,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",52,0)
CDIC ; Clinic lookup
"RTN","PSGVBW",53,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y
"RTN","PSGVBW",54,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGVBW",55,0)
 Q
"RTN","PSGVBW",56,0)
L ; Select a Clinic Group
"RTN","PSGVBW",57,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGVBW",58,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",59,0)
LDIC ; Clinic Group lookup
"RTN","PSGVBW",60,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y
"RTN","PSGVBW",61,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGVBW",62,0)
 Q
"RTN","PSGVBW",63,0)
W ; Select a Ward
"RTN","PSGVBW",64,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD: "
"RTN","PSGVBW",65,0)
 S DIR("?")="^D WDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",66,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",67,0)
WDIC ; Ward lookup
"RTN","PSGVBW",68,0)
 K DIC S DIC="^DIC(42,",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 WD=+Y
"RTN","PSGVBW",69,0)
 W:X["?" !!,"Enter ""^OTHER"" for Outpatient IV orders",!
"RTN","PSGVBW",70,0)
 Q
"RTN","PSGVBW",71,0)
PR ; Select order priority
"RTN","PSGVBW",72,0)
 K DIR S DIR(0)="SO^1:STAT;2:ASAP;3:ROUTINE"
"RTN","PSGVBW",73,0)
 S DIR("A")="Select 1-3 ",DIR("?")="        Choose a Priority."
"RTN","PSGVBW",74,0)
 S DIR("?",1)="Enter a PRIORITY to include all patients with orders containing that PRIORITY"
"RTN","PSGVBW",75,0)
 D ^DIR S:Y>0 PRD=+Y S:+Y>0 WDN=$S(PRD=1:"STAT",PRD=2:"ASAP",3:"ROUTINE")
"RTN","PSGVBW",76,0)
 Q
"RTN","PSGVBW",77,0)
P ; Select patient
"RTN","PSGVBW",78,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1 F  D ^PSJP Q:PSGP<0  D
"RTN","PSGVBW",79,0)
 .S PSJNV=0
"RTN","PSGVBW",80,0)
 .NEW ON,XX F ON=0:0 S ON=$O(^PS(53.1,"AS","N",PSGP,ON)) Q:'ON  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) I XX S PSJNV=1 Q
"RTN","PSGVBW",81,0)
 .;S PSJNV=$O(^PS(53.1,"AS","N",+PSGP,0)),PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",82,0)
 .S PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",83,0)
 .I 'PSJNV D ^PSJAC D
"RTN","PSGVBW",84,0)
 ..I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",85,0)
 ..S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",86,0)
 ..I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD!PSJNV  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  S PSJNV=1 Q
"RTN","PSGVBW",87,0)
 ..I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D" D IFT2 I  S PSJNV=1 Q
"RTN","PSGVBW",88,0)
 .S X=$S(PSJTOO=1:PSJNV,PSJTOO=2:PSJPEN,1:(PSJNV+PSJPEN))
"RTN","PSGVBW",89,0)
 .I X D SETPN S ^TMP("PSJSELECT",$J,PSJCNT)=PN,^TMP("PSJSELECT",$J,"B",$P(PN,U),PSJCNT)="",PSJCNT=PSJCNT+1 Q
"RTN","PSGVBW",90,0)
 .W !,"No ",PSGVBWW," orders found for this patient."
"RTN","PSGVBW",91,0)
 S:$D(^TMP("PSJSELECT",$J)) Y=1
"RTN","PSGVBW",92,0)
 Q
"RTN","PSGVBW",93,0)
ARRAY ; put patient(s) with non-verified orders into array
"RTN","PSGVBW",94,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",95,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING") I PSGSS="P" D IF S:$T ^TMP("PSGVBW",$J)=$P(PSGP(0),"^")_"^"_PSGP Q
"RTN","PSGVBW",96,0)
 G CG:PSGSS="L",CL:PSGSS="C",WD:PSGSS="W",PRI:PSGSS="PR" S WD=0 F  S WD=$O(^PS(57.5,"AC",WG,WD)) Q:'WD  D WD
"RTN","PSGVBW",97,0)
 Q
"RTN","PSGVBW",98,0)
 ;
"RTN","PSGVBW",99,0)
CG ; Find all clinics in selected clinic group
"RTN","PSGVBW",100,0)
 S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D CL
"RTN","PSGVBW",101,0)
 Q
"RTN","PSGVBW",102,0)
CL ; Find all patients in selected clinic
"RTN","PSGVBW",103,0)
 S WDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGVBW",104,0)
 S PSGP="",PSGCLF=1 F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:PSGP=""  D ^PSJAC,IF
"RTN","PSGVBW",105,0)
 K PSGCLF
"RTN","PSGVBW",106,0)
 Q
"RTN","PSGVBW",107,0)
WD ; Find all patients in selected ward
"RTN","PSGVBW",108,0)
 S WDN=$S($D(^DIC(42,WD,0)):$P(^(0),"^"),1:"")
"RTN","PSGVBW",109,0)
 I WDN]"" S PSGP=0 F  S PSGP=$O(^DPT("CN",WDN,PSGP)) Q:'PSGP  D
"RTN","PSGVBW",110,0)
 .I $S($D(^PS(55,"APV",PSGP)):1,$D(^PS(55,"APIV",PSGP)):1,$O(^PS(55,PSGP,5,"AUS",PSGDT)):1,1:$D(^PS(53.1,"AC",PSGP))) D ^PSJAC,IF
"RTN","PSGVBW",111,0)
 Q
"RTN","PSGVBW",112,0)
PRI ; Find orders with selected Priority
"RTN","PSGVBW",113,0)
 ; Once a patient is identified in any status index ("I", "N", or "P"), all orders for that patient are checked in the 
"RTN","PSGVBW",114,0)
 ; IF subroutine. To prevent unnecessary duplication of processing, "PSGVBW3" node of ^TMP, sorted by patient, will be 
"RTN","PSGVBW",115,0)
 ; set when a patient's orders are processed, and checked for each status index. If patient exists in the "PSGVBW3" node,
"RTN","PSGVBW",116,0)
 ; patient has already been processed, so quit.
"RTN","PSGVBW",117,0)
 N NDP2,PSGALL,ND0,PSGPRIFZ K ^TMP("PSGVBW3",$J)
"RTN","PSGVBW",118,0)
 S PSGPRIF=1 F STATUS="I","N","P" S PSGP=0 F  S PSGP=$O(^PS(53.1,"AS",STATUS,PSGP)) Q:'PSGP  Q:($D(^TMP("PSGVBW3",$J,PSGP)))  D ^PSJAC,IF
"RTN","PSGVBW",119,0)
 K ^TMP("PSGVBW3",$J)
"RTN","PSGVBW",120,0)
 Q
"RTN","PSGVBW",121,0)
IF ;BHW;PSJ*5*155;Added PSGCLF and PS(53.1,"AD" Check below.  If called from CL subroutine and the order Doesn't exist for that Clinic, then QUIT.;PSJ*5*241:Changed quit conditions
"RTN","PSGVBW",122,0)
 W "." I PSJTOO'=1 S ON=0 F  S ON=$O(^PS(53.1,"AS","P",PSGP,ON)) Q:'ON!(($G(WDN)="ZZ")&(+$P($G(^PS(53.1,+$G(ON),"DSS")),U,1)'=0))  D
"RTN","PSGVBW",123,0)
 .Q:(($G(PSGCLF))&('$D(^PS(53.1,"AD",+$G(CL),PSGP,+$G(ON)))))  ;PSJ*5*265 - move quit condition inside loop
"RTN","PSGVBW",124,0)
 .S X=$P($G(^PS(53.1,ON,0)),U,4),IFPRI=0,Y=0 I "FIU"[X D  D:Y SET
"RTN","PSGVBW",125,0)
 ..I $G(PSGPRIF) D  Q:'IFPRI
"RTN","PSGVBW",126,0)
 ...N PRIO S PRIO=$P($G(^PS(53.1,+ON,.2)),"^",4),PRIO=$S(PRIO="S":1,PRIO="A":2,1:3) S IFPRI=$S(PRD=PRIO:1,1:"")
"RTN","PSGVBW",127,0)
 ..I PSJPAC=3 S Y=1 Q
"RTN","PSGVBW",128,0)
 ..I PSJPAC=2 S Y=X'="U" Q
"RTN","PSGVBW",129,0)
 ..I PSJPAC=1 S Y=X="U"
"RTN","PSGVBW",130,0)
 I PSJTOO=2 D  Q
"RTN","PSGVBW",131,0)
 .I '$G(PSGPRIF),$D(^TMP("PSGVBW2",$J)) D SET2
"RTN","PSGVBW",132,0)
 F X="N","I" I $D(^PS(53.1,"AS",X,PSGP)) NEW XX S XX=0 D  I XX D SET K ON
"RTN","PSGVBW",133,0)
 . NEW PRIOAR F ON=0:0 S ON=$O(^PS(53.1,"AS",X,PSGP,ON)) Q:'ON!(($G(WDN)="ZZ")&(+$P($G(^PS(53.1,+$G(ON),"DSS")),U,1)'=0))  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) I XX D  Q:($G(PRD)&$G(XX))
"RTN","PSGVBW",134,0)
 .. S PRIOAR=$P($G(^PS(53.1,+$G(ON),.2)),U,4) S PRIOAR=$S(PRIOAR="S":"S",PRIOAR="A":"A",1:"R")
"RTN","PSGVBW",135,0)
 .. I $G(PRD) S XX=$S(PRD=1&(PRIOAR="S"):1,PRD=2&(PRIOAR="A"):1,PRD=3&(PRIOAR="R"):1,1:0) Q
"RTN","PSGVBW",136,0)
 .. S PRIOAR(PRIOAR)=ON
"RTN","PSGVBW",137,0)
 . Q:$G(PRD)  S ON=$S($G(PRIOAR("S")):PRIOAR("S"),$G(PRIOAR("A")):PRIOAR("A"),1:$G(PRIOAR("R")))
"RTN","PSGVBW",138,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",139,0)
 I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  D SET
"RTN","PSGVBW",140,0)
 ;*PSJ*5*241:Expired IV orders must be one-time
"RTN","PSGVBW",141,0)
 I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  D
"RTN","PSGVBW",142,0)
 .N SCH,STYPE S STYPE=0,SCH=$P($G(^PS(55,PSGP,"IV",ON,0)),U,9)
"RTN","PSGVBW",143,0)
 .S:SCH]"" SCH=$O(^PS(51.1,"APPSJ",SCH,STYPE)) S:SCH]"" STYPE=$P($G(^PS(51.1,SCH,0)),U,5)
"RTN","PSGVBW",144,0)
 .I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D",'(($P(^(0),"^",17)="E")&($G(STYPE)'="O")) D IFT2 I  D SET
"RTN","PSGVBW",145,0)
 I '$G(PSGPRIF),$D(^TMP("PSGVBW2",$J)) D SET2
"RTN","PSGVBW",146,0)
 Q
"RTN","PSGVBW",147,0)
 ;
"RTN","PSGVBW",148,0)
IFT ; Loop through active UD orders in ^PS(55 that have not been verified by pharmacist.
"RTN","PSGVBW",149,0)
 S ND=$G(^PS(55,PSGP,5,ON,4)) I $S(SD>PSGDT:$S(ND="":1,'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1)):1,$P(ND,"^",13):1,$P(ND,"^",19):1,$P(ND,"^",23):1,1:$P(ND,"^",16)),ST="O":$S(ND="":1,1:'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1))),1:$P(ND,"^",16))
"RTN","PSGVBW",150,0)
 Q
"RTN","PSGVBW",151,0)
 ;
"RTN","PSGVBW",152,0)
IFT2 ; Loop through active IV orders in ^PS(55 that have not been verified by pharmacist.
"RTN","PSGVBW",153,0)
 ;S ND=$G(^PS(55,PSGP,"IV",ON,4)) I $S((SD>PSGDT)&(ND=""):1,'$P(ND,"^",$S(+PSJSYSU=1:1,1:4)):1,1:0)
"RTN","PSGVBW",154,0)
 S ND=$G(^PS(55,PSGP,"IV",ON,4))
"RTN","PSGVBW",155,0)
 I ($P($G(^PS(55,PSGP,"IV",ON,.2)),"^",4)="D")&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4)))  Q
"RTN","PSGVBW",156,0)
 I $S((SD>PSGDT)&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4))):1,1:0)
"RTN","PSGVBW",157,0)
 Q
"RTN","PSGVBW",158,0)
SET ; Set patient specific variables for ^TMP subscripts
"RTN","PSGVBW",159,0)
 S PRDON=""
"RTN","PSGVBW",160,0)
 I $G(ON) S PRDON=$P($G(^PS(53.1,+ON,.2)),"^",4),PRDON=$S(PRDON="A":"ASAP",PRDON="S":"STAT",PRDON="R":"ROUTINE",1:"zz")
"RTN","PSGVBW",161,0)
 S PTPRI=$S(PRDON="STAT":1,PRDON="ASAP":2,PRDON="ROUTINE":3,1:3)
"RTN","PSGVBW",162,0)
 I $G(PSGPRIF) Q:(PRD'=PTPRI)
"RTN","PSGVBW",163,0)
 K DIC,X,Y,WDNAME,TMPWD S WDNAME=$G(^DPT(+PSGP,.1)) S X=WDNAME,DIC="^DIC(42,",DIC(0)="BOXZ" D ^DIC S TMPWD=+Y
"RTN","PSGVBW",164,0)
 S TM=$S(PSJPRB="":"",1:$P($G(^PS(57.7,TMPWD,1,+$O(^PS(57.7,"AWRT",TMPWD,PSJPRB,0)),0)),"^")) S:TM="" TM="zz"
"RTN","PSGVBW",165,0)
 ;
"RTN","PSGVBW",166,0)
SETPN ; If searching for specific priority:
"RTN","PSGVBW",167,0)
 ;            -  set patient into ^TMP("PSGBW" sorted by Priority Name, Priority #, Team, Patient Name^IEN^SSN
"RTN","PSGVBW",168,0)
 ; If not searching for specific priority:
"RTN","PSGVBW",169,0)
 ;            - set patient into ^TMP("PSGVBW2" sorted by 'Patient Name^IEN^SSN', then Priority
"RTN","PSGVBW",170,0)
 ;            - set patient into ^TMP("PSGVBW3" sorted by Patient IEN
"RTN","PSGVBW",171,0)
 S PN=$P(PSGP(0),"^")_U_PSGP_U_PSJPBID
"RTN","PSGVBW",172,0)
 Q:PSGSS="P"
"RTN","PSGVBW",173,0)
 I $G(PSGPRIF) S ^TMP("PSGVBW",$J,WDN,PTPRI,TM,PN)="" Q
"RTN","PSGVBW",174,0)
 S ^TMP("PSGVBW2",$J,PN,+$G(PTPRI))=WDN_"^"_TM,^TMP("PSGVBW3",$J,+PSGP)=""
"RTN","PSGVBW",175,0)
 Q
"RTN","PSGVBW",176,0)
 ;
"RTN","PSGVBW",177,0)
SET2 ; If not searching for a specific priority,find the highest priority order associated with patient. 
"RTN","PSGVBW",178,0)
 ; Set the patient into ^TMP("PSGVBW" sorted by highest Priority Name, Priority #, Team, Patient Name^IEN^SSN
"RTN","PSGVBW",179,0)
 S SETPN="" F  S SETPN=$O(^TMP("PSGVBW2",$J,SETPN)) Q:SETPN=""  D
"RTN","PSGVBW",180,0)
 .S PTPRI=$O(^TMP("PSGVBW2",$J,SETPN,0)) Q:'$G(PTPRI)
"RTN","PSGVBW",181,0)
 .S SUBS=$G(^TMP("PSGVBW2",$J,SETPN,PTPRI)),SETWDN=$P(SUBS,"^"),SETTM=$P(SUBS,"^",2) Q:SETWDN=""!(SETTM="")
"RTN","PSGVBW",182,0)
 .S ^TMP("PSGVBW",$J,SETWDN,PTPRI,SETTM,SETPN)=""
"RTN","PSGVBW",183,0)
 K ^TMP("PSGVBW2",$J)
"RTN","PSGVBW",184,0)
 Q
"RTN","PSGVBW",185,0)
GTOOP ; Get 'Type Of Order' and Package
"RTN","PSGVBW",186,0)
 I $P(PSJSYSU,";",3)<2,'$G(PSJRNF),'$G(PSJIRNF) S PSJPAC=0,PSJTOO=1 D GTPAC Q
"RTN","PSGVBW",187,0)
 S (PSJPAC,PSJTOO)=0 W !!,"1) Non-Verified Orders",!,"2) Pending Orders",!!
"RTN","PSGVBW",188,0)
 N DIR S DIR(0)="LAO^1:2",DIR("A")="Select Order Type(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" D ^DIR
"RTN","PSGVBW",189,0)
 I 'Y D EXIT("TYPE OF ORDER") Q
"RTN","PSGVBW",190,0)
 S PSJTOO=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",191,0)
 D GTPAC
"RTN","PSGVBW",192,0)
 I 'PSJPAC D EXIT("PACKAGE") Q
"RTN","PSGVBW",193,0)
 Q
"RTN","PSGVBW",194,0)
 ;
"RTN","PSGVBW",195,0)
GTPAC ; Prompt user for Package
"RTN","PSGVBW",196,0)
 I ($G(PSJRNF))&('$G(PSJIRNF))&(PSJTOO=2) S PSJPAC=1 Q
"RTN","PSGVBW",197,0)
 I ($G(PSJIRNF))&('$G(PSJRNF))&(PSJTOO=2) S PSJPAC=2 Q
"RTN","PSGVBW",198,0)
 W !!,"1) Unit Dose Orders",!,"2) IV Orders",!
"RTN","PSGVBW",199,0)
 K DIR S DIR(0)="LAO^1:2",DIR("A")="Select Package(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",200,0)
 S PSJPAC=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",201,0)
 Q
"RTN","PSGVBW",202,0)
EXIT(X) ; Generic user error message
"RTN","PSGVBW",203,0)
 W !!,X," not selected, option terminated."
"RTN","PSGVBW",204,0)
 Q
"RTN","PSGVBW",205,0)
 ;
"RTN","PSGVBW",206,0)
TOH ; Help text
"RTN","PSGVBW",207,0)
 W !!,"SELECT FROM:",!?5,"1 - NON-VERIFIED ORDERS",!?5,"2 - PENDING ORDERS"
"RTN","PSGVBW",208,0)
 W !!?2,"Enter '1' if you want to verify non-verified orders.  Enter '2' if you",!,"want to complete pending orders.  Enter '1,2' or '1-2' if you want to do both." Q
"RTN","PSJ50265")
0^^B666023^n/a
"RTN","PSJ50265",1,0)
PSJ50265 ;BP-OIFO/JME - POST INSTALL FOR PATCH PSJ*5.0*265 ; Compiled September 20, 2011 8:50
"RTN","PSJ50265",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**265**;16 DEC 97;Build 4
"RTN","PSJ50265",3,0)
 ;
"RTN","PSJ50265",4,0)
EN ;
"RTN","PSJ50265",5,0)
 N CL,PSJP,DA
"RTN","PSJ50265",6,0)
 S PSJP=0 F  S PSJP=$O(^PS(53.1,"AS","N",PSJP)) Q:'PSJP  D
"RTN","PSJ50265",7,0)
 . S DA=0 F  S DA=$O(^PS(53.1,"AS","N",PSJP,DA)) Q:'DA  D
"RTN","PSJ50265",8,0)
 .. S CL=+$G(^PS(53.1,DA,"DSS")) Q:'CL
"RTN","PSJ50265",9,0)
 .. D NOW^%DTC I '$D(^PS(53.1,"AD",CL,PSJP,DA)),$P(^PS(53.1,DA,2),U,4)>% S ^PS(53.1,"AD",CL,PSJP,DA)=""
"RTN","PSJ50265",10,0)
 Q
"VER")
8.0^22.0
"BLD",8623,6)
^229
**END**
**END**
