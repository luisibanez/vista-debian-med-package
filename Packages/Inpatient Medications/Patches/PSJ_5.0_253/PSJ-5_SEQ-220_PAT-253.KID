Released PSJ*5*253 SEQ #220
Extracted from mail message
**KIDS**:PSJ*5.0*253^

**INSTALL NAME**
PSJ*5.0*253
"BLD",7965,0)
PSJ*5.0*253^INPATIENT MEDICATIONS^0^3110914^y
"BLD",7965,1,0)
^^22^22^3110426^
"BLD",7965,1,1,0)
This patch contains the following enhancement:
"BLD",7965,1,2,0)
 
"BLD",7965,1,3,0)
1. This patch implements functionality that retrieves Computerized
"BLD",7965,1,4,0)
   Patient Record System (CPRS) V. 1.0 order checks and corresponding
"BLD",7965,1,5,0)
   provider override reason from the Order Check Instances (#100.05)
"BLD",7965,1,6,0)
   file, and provides the order checks and provider override reason
"BLD",7965,1,7,0)
   to Bar Code Medication Administration (BCMA) V. 3.0 for display
"BLD",7965,1,8,0)
   in the BCMA Display Order report.
"BLD",7965,1,9,0)
 
"BLD",7965,1,10,0)
 
"BLD",7965,1,11,0)
This patch contains the following two defect fixes:
"BLD",7965,1,12,0)
 
"BLD",7965,1,13,0)
1. This patch corrects an issue in Bar Code Medication Administration
"BLD",7965,1,14,0)
   V. 3.0 in which orders do not display on the Virtual Due List (VDL) 
"BLD",7965,1,15,0)
   if the order's Schedule Type is Continuous or Fill on Request, and 
"BLD",7965,1,16,0)
   the order contains a Schedule defined in the Administration Schedule 
"BLD",7965,1,17,0)
   File (#51.1) with a Schedule Type of On Call.
"BLD",7965,1,18,0)
 
"BLD",7965,1,19,0)
2. This patch corrects an issue in Inpatient Medications V. 5.0 in which
"BLD",7965,1,20,0)
   changing a Non-Verified order's Schedule Type to On Call automatically
"BLD",7965,1,21,0)
   changes the name of the order's Schedule to On Call without alerting 
"BLD",7965,1,22,0)
   the user.
"BLD",7965,4,0)
^9.64PA^^0
"BLD",7965,6)
4^
"BLD",7965,6.3)
31
"BLD",7965,"ABPKG")
n
"BLD",7965,"INID")
^n
"BLD",7965,"INIT")
EN^PSJ0253
"BLD",7965,"KRN",0)
^9.67PA^779.2^20
"BLD",7965,"KRN",.4,0)
.4
"BLD",7965,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7965,"KRN",.401,0)
.401
"BLD",7965,"KRN",.402,0)
.402
"BLD",7965,"KRN",.403,0)
.403
"BLD",7965,"KRN",.5,0)
.5
"BLD",7965,"KRN",.84,0)
.84
"BLD",7965,"KRN",3.6,0)
3.6
"BLD",7965,"KRN",3.8,0)
3.8
"BLD",7965,"KRN",9.2,0)
9.2
"BLD",7965,"KRN",9.8,0)
9.8
"BLD",7965,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",7965,"KRN",9.8,"NM",1,0)
PSJBCMA^^0^B78979447
"BLD",7965,"KRN",9.8,"NM",2,0)
PSGOE4^^0^B31371280
"BLD",7965,"KRN",9.8,"NM",3,0)
PSJ0253^^0^B187235
"BLD",7965,"KRN",9.8,"NM",5,0)
PSJBCMA1^^0^B68412667
"BLD",7965,"KRN",9.8,"NM","B","PSGOE4",2)

"BLD",7965,"KRN",9.8,"NM","B","PSJ0253",3)

"BLD",7965,"KRN",9.8,"NM","B","PSJBCMA",1)

"BLD",7965,"KRN",9.8,"NM","B","PSJBCMA1",5)

"BLD",7965,"KRN",19,0)
19
"BLD",7965,"KRN",19.1,0)
19.1
"BLD",7965,"KRN",101,0)
101
"BLD",7965,"KRN",409.61,0)
409.61
"BLD",7965,"KRN",771,0)
771
"BLD",7965,"KRN",779.2,0)
779.2
"BLD",7965,"KRN",870,0)
870
"BLD",7965,"KRN",8989.51,0)
8989.51
"BLD",7965,"KRN",8989.52,0)
8989.52
"BLD",7965,"KRN",8994,0)
8994
"BLD",7965,"KRN","B",.4,.4)

"BLD",7965,"KRN","B",.401,.401)

"BLD",7965,"KRN","B",.402,.402)

"BLD",7965,"KRN","B",.403,.403)

"BLD",7965,"KRN","B",.5,.5)

"BLD",7965,"KRN","B",.84,.84)

"BLD",7965,"KRN","B",3.6,3.6)

"BLD",7965,"KRN","B",3.8,3.8)

"BLD",7965,"KRN","B",9.2,9.2)

"BLD",7965,"KRN","B",9.8,9.8)

"BLD",7965,"KRN","B",19,19)

"BLD",7965,"KRN","B",19.1,19.1)

"BLD",7965,"KRN","B",101,101)

"BLD",7965,"KRN","B",409.61,409.61)

"BLD",7965,"KRN","B",771,771)

"BLD",7965,"KRN","B",779.2,779.2)

"BLD",7965,"KRN","B",870,870)

"BLD",7965,"KRN","B",8989.51,8989.51)

"BLD",7965,"KRN","B",8989.52,8989.52)

"BLD",7965,"KRN","B",8994,8994)

"BLD",7965,"PRET")

"BLD",7965,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7965,"QUES",0)
^9.62^^0
"BLD",7965,"REQB",0)
^9.611^2^2
"BLD",7965,"REQB",1,0)
PSJ*5.0*245^2
"BLD",7965,"REQB",2,0)
PSJ*5.0*225^2
"BLD",7965,"REQB","B","PSJ*5.0*225",2)

"BLD",7965,"REQB","B","PSJ*5.0*245",1)

"INIT")
EN^PSJ0253
"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
253^3110914^10000000009
"PKG",197,22,1,"PAH",1,1,0)
^^22^22^3110914
"PKG",197,22,1,"PAH",1,1,1,0)
This patch contains the following enhancement:
"PKG",197,22,1,"PAH",1,1,2,0)
 
"PKG",197,22,1,"PAH",1,1,3,0)
1. This patch implements functionality that retrieves Computerized
"PKG",197,22,1,"PAH",1,1,4,0)
   Patient Record System (CPRS) V. 1.0 order checks and corresponding
"PKG",197,22,1,"PAH",1,1,5,0)
   provider override reason from the Order Check Instances (#100.05)
"PKG",197,22,1,"PAH",1,1,6,0)
   file, and provides the order checks and provider override reason
"PKG",197,22,1,"PAH",1,1,7,0)
   to Bar Code Medication Administration (BCMA) V. 3.0 for display
"PKG",197,22,1,"PAH",1,1,8,0)
   in the BCMA Display Order report.
"PKG",197,22,1,"PAH",1,1,9,0)
 
"PKG",197,22,1,"PAH",1,1,10,0)
 
"PKG",197,22,1,"PAH",1,1,11,0)
This patch contains the following two defect fixes:
"PKG",197,22,1,"PAH",1,1,12,0)
 
"PKG",197,22,1,"PAH",1,1,13,0)
1. This patch corrects an issue in Bar Code Medication Administration
"PKG",197,22,1,"PAH",1,1,14,0)
   V. 3.0 in which orders do not display on the Virtual Due List (VDL) 
"PKG",197,22,1,"PAH",1,1,15,0)
   if the order's Schedule Type is Continuous or Fill on Request, and 
"PKG",197,22,1,"PAH",1,1,16,0)
   the order contains a Schedule defined in the Administration Schedule 
"PKG",197,22,1,"PAH",1,1,17,0)
   File (#51.1) with a Schedule Type of On Call.
"PKG",197,22,1,"PAH",1,1,18,0)
 
"PKG",197,22,1,"PAH",1,1,19,0)
2. This patch corrects an issue in Inpatient Medications V. 5.0 in which
"PKG",197,22,1,"PAH",1,1,20,0)
   changing a Non-Verified order's Schedule Type to On Call automatically
"PKG",197,22,1,"PAH",1,1,21,0)
   changes the name of the order's Schedule to On Call without alerting 
"PKG",197,22,1,"PAH",1,1,22,0)
   the user.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSGOE4")
0^2^B31371280^B31772207
"RTN","PSGOE4",1,0)
PSGOE4 ;BIR/CML3 - REGULAR ORDER ENTRY ;06 Feb 01 / 4:31 PM
"RTN","PSGOE4",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**2,50,64,58,111,113,245,253**;16 DEC, 1997;Build 31
"RTN","PSGOE4",3,0)
 ;
"RTN","PSGOE4",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGOE4",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGOE4",6,0)
 ;
"RTN","PSGOE4",7,0)
 K PSGOES S PSGMR=$S($P(PSGNEDFD,"^",2):$P(PSGNEDFD,"^",2),1:PSGOEDMR),PSGSCH=$P(PSGNEDFD,"^",4),PSGPR=PSGOEPR,(PSGSD,PSGFD,PSGSM,PSGHSM,PSGUD,PSGSI,PSGOROE1,PSGNEFD,PSGMRN)=""
"RTN","PSGOE4",8,0)
 S:PSGMR PSGMRN=$S('$P(PSGNEDFD,"^",2):"ORAL",'$D(^PS(51.2,PSGMR,0)):PSGMR,$P(^(0),"^")]"":$P(^(0),"^"),1:PSGMR) I PSGPR S PSGPRN=$P($G(^VA(200,PSGPR,0)),"^") S:PSGPRN="" PSGPRN=PSGPR
"RTN","PSGOE4",9,0)
 S PSGST=$S($P(PSGNEDFD,"^",3)]"":$P(PSGNEDFD,"^",3),1:"C"),PSGSTN=$$ENSTN^PSGMI(PSGST),F1=53.1 K PSGFOK S PSGFOK(2)=""
"RTN","PSGOE4",10,0)
 S:$P(PSJSYSU,";",4) PSGFOK(2)="" K ^PS(53.45,PSJSYSP,1),^(2) I PSGDRG S ^(2,0)="^53.4502P^"_PSGDRG_"^1",^(1,0)=PSGDRG,^PS(53.45,PSJSYSP,2,"B",PSGDRG,1)=""
"RTN","PSGOE4",11,0)
 ;
"RTN","PSGOE4",12,0)
109 ; dosage ordered
"RTN","PSGOE4",13,0)
 I $P(PSJSYSU,";",4) D GETDOSE^PSJDOSE(PSGDRG) G:PSGOROE1 DONE G:'$G(PSGOE3) 3
"RTN","PSGOE4",14,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",15,0)
 I X="" S X=PSGDO ;I X="" W $C(7),"  (Required)" G 109
"RTN","PSGOE4",16,0)
 S PSGF2=109 I X="@" S PSGDO="" ;W $C(7),"  (Required)" G 109
"RTN","PSGOE4",17,0)
 I X="@" D DEL G:%'=1 109 S (PSGDO,PSGFOK(109),PSGUD)="" G 3
"RTN","PSGOE4",18,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE4",19,0)
 I $E(X)="^" D FF G:Y>0 @Y G 109
"RTN","PSGOE4",20,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE4",21,0)
 I $S(X="":0,X?.E1C.E:1,$L(X)>20:1,X="":1,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G 109
"RTN","PSGOE4",22,0)
 S PSGDO=X,PSGFOK(109)=""
"RTN","PSGOE4",23,0)
 ;
"RTN","PSGOE4",24,0)
13 ; units per dose
"RTN","PSGOE4",25,0)
 ;/** NO LONGER USE WITH POE
"RTN","PSGOE4",26,0)
 Q:$G(PSGOE3)
"RTN","PSGOE4",27,0)
 G:'$P(PSJSYSU,";",4) 3 I $D(PSGFOK(13)) S PSGFOK(13)=1 D 2^PSGOE42 S PSGFOK(13)="" G 3
"RTN","PSGOE4",28,0)
 ;
"RTN","PSGOE4",29,0)
A13 ;
"RTN","PSGOE4",30,0)
 W !,"UNITS PER DOSE: ",$S(PSGUD:PSGUD_"// ",1:"") R X:DTIME I X="^"!'$T S PSGOROE1=1 G DONE
"RTN","PSGOE4",31,0)
 I X="" W:'PSGUD "  (1)" G S13
"RTN","PSGOE4",32,0)
 S PSGF2=13 I X="@",'PSGUD W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,13) G A13
"RTN","PSGOE4",33,0)
 I X="@" D DEL G:%'=1 13 S PSGUD="" G S13
"RTN","PSGOE4",34,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,13) G A13
"RTN","PSGOE4",35,0)
 I $E(X)="^" D FF G:Y>0 @Y G A13
"RTN","PSGOE4",36,0)
 I X?1.2N1"/"1.2N S X=+$J(+X/$P(X,"/",2),0,2) W "  ("_$E("0",X<1)_X_")"
"RTN","PSGOE4",37,0)
 I $S($L(X)>12:1,X'=+X:1,X>50:1,X<0:1,1:X?.N1"."3.N) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,13) G 13
"RTN","PSGOE4",38,0)
 S PSGUD=X W:'X "  (1)"
"RTN","PSGOE4",39,0)
 ;
"RTN","PSGOE4",40,0)
S13 ;
"RTN","PSGOE4",41,0)
 S PSGFOK(13)="" I PSGDRG S $P(^PS(53.45,PSJSYSP,2,1,0),"^",2)=PSGUD
"RTN","PSGOE4",42,0)
 ;
"RTN","PSGOE4",43,0)
3 ; med route
"RTN","PSGOE4",44,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",45,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) S PSGFOK(3)=""
"RTN","PSGOE4",46,0)
 S PSGF2=3 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,2) G 3
"RTN","PSGOE4",47,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE4",48,0)
 I $E(X)="^" D FF G:Y>0 @Y G 3
"RTN","PSGOE4",49,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G 3
"RTN","PSGOE4",50,0)
 S PSGMR=+Y,PSGMRN=$P(Y(0),"^") S PSGFOK(3)=""
"RTN","PSGOE4",51,0)
 Q:$G(PSGOE3)
"RTN","PSGOE4",52,0)
 ;
"RTN","PSGOE4",53,0)
26 ; schedule
"RTN","PSGOE4",54,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE4",55,0)
 S PSGF2=26 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",56,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",57,0)
 I $E(X)="^" D FF G:Y>0 @Y G 26
"RTN","PSGOE4",58,0)
 S DOW=0 I $$DOW^PSIVUTL(X) S DOW=1,PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST),PSGS0Y=$P(X,"@",2)
"RTN","PSGOE4",59,0)
 N PSJSLUP S PSJSLUP=1 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G 26
"RTN","PSGOE4",60,0)
 I PSGSCH[" PRN",$$PRNOK^PSGS0(PSGSCH) S PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",61,0)
 S PSGSCH=X,$P(PSGNEDFD,"^",4)=X,PSGFOK(26)="" I PSGS0XT="O" S $P(PSGNEDFD,"^",3)="O",PSGST="O",PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",62,0)
 I $G(PSGOE3) D  Q
"RTN","PSGOE4",63,0)
 . S PSGSCH=X,PSGST=$S($G(DOW):"C",PSGS0XT="O":"O",PSGST="R":"R",X["PRN":"P",X="ON CALL":"OC",PSGST]"":PSGST,1:"C"),PSGFOK(26)=""
"RTN","PSGOE4",64,0)
 . S $P(PSGNEDFD,"^",3)=PSGST S:PSGSCH=""!(X?1." ") PSGSCH="PRN"
"RTN","PSGOE4",65,0)
 . S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",66,0)
 K DOW
"RTN","PSGOE4",67,0)
 ;
"RTN","PSGOE4",68,0)
7 ; schedule type
"RTN","PSGOE4",69,0)
 Q:$G(PSGOE3)
"RTN","PSGOE4",70,0)
 D  ;Default Schedule Type from Schedule file - PSJ*5*113 - DRF
"RTN","PSGOE4",71,0)
 . N XX
"RTN","PSGOE4",72,0)
 . I $$DOW^PSIVUTL(PSGSCH) S PSGST="C",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE4",73,0)
 . I PSGSCH[" PRN",$$PRNOK^PSGS0(PSGSCH) S PSGST="P",PSGSTN=$$ENSTN^PSGMI(PSGST) Q
"RTN","PSGOE4",74,0)
 . I PSGSCH]"" D
"RTN","PSGOE4",75,0)
 .. S XX=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0))
"RTN","PSGOE4",76,0)
 .. S PSGST=$P($G(^PS(51.1,XX,0)),"^",5) I PSGST="D" S PSGST="C"
"RTN","PSGOE4",77,0)
 .. S PSGSTN=$$ENSTN^PSGMI(PSGST)
"RTN","PSGOE4",78,0)
 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOROE1=1 W $C(7) G DONE
"RTN","PSGOE4",79,0)
 I X="" S:PSGST="OC" PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" W "  "_PSGSTN S PSGFOK(7)="" S $P(PSGNEDFD,"^",3)=PSGST G ^PSGOE41
"RTN","PSGOE4",80,0)
 S PSGF2=7 I X="@"!(X?1."?") W:X="@" $C(7),"  ??  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G 7
"RTN","PSGOE4",81,0)
 I $E(X)="^" D FF G:Y>0 @Y G 7
"RTN","PSGOE4",82,0)
 S:X="F" X="R" S X=$S(X="PRN":"P",X="ON CALL":"OC",X="FILL on REQUEST":"R",1:X)
"RTN","PSGOE4",83,0)
 I ",OC,P,R,"[(","_X_",") S PSGST=X,$P(PSGNEDFD,"^",3)=X,PSGSTN=$S(X="P":"PRN",X="R":"FILL ON REQUEST",1:"ON CALL") W "  "_PSGSTN S PSGFOK(7)="" G:X="R" 8^PSGOE41 S (PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE4",84,0)
 F Y="C^CONTINUOUS","O^ONE TIME","OC^ON CALL","P^PRN","R^FILL on REQUEST" I $P($P(Y,"^",2),X)="" W $P($P(Y,"^",2),X,2) S PSGST=$P(Y,"^"),PSGSTN=$P(Y,"^",2),$P(PSGNEDFD,"^",3)=PSGST Q
"RTN","PSGOE4",85,0)
 E  W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,7) G 7
"RTN","PSGOE4",86,0)
 I PSGST="R" S PSGFOK(7)="" G 8^PSGOE41
"RTN","PSGOE4",87,0)
 S PSGFOK(7)=""
"RTN","PSGOE4",88,0)
 ;
"RTN","PSGOE4",89,0)
 G ^PSGOE41
"RTN","PSGOE4",90,0)
 ;
"RTN","PSGOE4",91,0)
DONE ;
"RTN","PSGOE4",92,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE4",93,0)
 K F,F0,F1,PSGF2,F3,PSG,PSGSD,SDT Q
"RTN","PSGOE4",94,0)
 ;
"RTN","PSGOE4",95,0)
FF ; up-arrow to another field
"RTN","PSGOE4",96,0)
 D ENFF^PSGOEM I Y>0,Y'=109,Y'=13,Y'=3,Y'=7,Y'=26 S:Y=2 FB=PSGF2_"^PSGOE4" S Y=Y_"^PSGOE4"_$S("^39^8^10^25^"[("^"_Y_"^"):1,1:2)
"RTN","PSGOE4",97,0)
 Q
"RTN","PSGOE4",98,0)
 ;
"RTN","PSGOE4",99,0)
DEL ; delete entry
"RTN","PSGOE4",100,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE4",101,0)
 Q
"RTN","PSJ0253")
0^3^B187235^n/a
"RTN","PSJ0253",1,0)
PSJ0253 ;BIR/JCH - Remove ON CALL Cross Reference in Schedule Type (#7) field in Non-Verified Orders (#53.1) file ;23 Mar 11 / 7:30 AM
"RTN","PSJ0253",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**253**;16 DEC 97;Build 31
"RTN","PSJ0253",3,0)
 ;
"RTN","PSJ0253",4,0)
 ;Reference to ^DDMOD is supported by DBIA# 2916.
"RTN","PSJ0253",5,0)
 ;
"RTN","PSJ0253",6,0)
 Q
"RTN","PSJ0253",7,0)
 ;
"RTN","PSJ0253",8,0)
EN ; Delete the ON CALL Cross Reference from the Schedule Type field in file ^PS(53.1.
"RTN","PSJ0253",9,0)
 ;
"RTN","PSJ0253",10,0)
 N PSJFIL,PSJFLD,PSJXREF
"RTN","PSJ0253",11,0)
 S PSJFIL=53.1,PSJFLD=7,PSJXREF=1
"RTN","PSJ0253",12,0)
 D DELIX^DDMOD(PSJFIL,PSJFLD,PSJXREF)
"RTN","PSJ0253",13,0)
 Q
"RTN","PSJBCMA")
0^1^B78979447^B74176392
"RTN","PSJBCMA",1,0)
PSJBCMA ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ;16 Mar 99 / 10:13 AM
"RTN","PSJBCMA",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**32,41,46,57,63,66,56,69,58,81,91,104,111,112,186,159,173,190,113,225,253**;16 DEC 97;Build 31
"RTN","PSJBCMA",3,0)
 ;
"RTN","PSJBCMA",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJBCMA",5,0)
 ; Reference to ^PS(51 is supported by DBIA 2176.
"RTN","PSJBCMA",6,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSJBCMA",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJBCMA",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJBCMA",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJBCMA",10,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBCMA",11,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJBCMA",12,0)
 ; Usage of this routine by BCMA is supported by DBIA 2828.
"RTN","PSJBCMA",13,0)
 ;
"RTN","PSJBCMA",14,0)
EN(DFN,BDT,OTDATE)         ; return condensed list of inpatient meds
"RTN","PSJBCMA",15,0)
 NEW CNT,DN,F,FON,ON,PST,WBDT,X,X1,X2,Y,%
"RTN","PSJBCMA",16,0)
 D:+$G(DFN) ORDER
"RTN","PSJBCMA",17,0)
 I '$D(^TMP("PSJ",$J,1,0)) S ^(0)=-1
"RTN","PSJBCMA",18,0)
 K PSJINX
"RTN","PSJBCMA",19,0)
 Q
"RTN","PSJBCMA",20,0)
ORDER ;Loop thru orders.
"RTN","PSJBCMA",21,0)
 I '+$G(BDT) D NOW^%DTC S BDT=%
"RTN","PSJBCMA",22,0)
 I BDT'["." S BDT=BDT_".0001"
"RTN","PSJBCMA",23,0)
 S PSJINX=0
"RTN","PSJBCMA",24,0)
 ;U/D orders
"RTN","PSJBCMA",25,0)
 S F="^PS(55,DFN,5,",WBDT=BDT
"RTN","PSJBCMA",26,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",27,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  S FON=ON_"U",PSJON(FON)="" D UDVAR
"RTN","PSJBCMA",28,0)
 ;IV orders
"RTN","PSJBCMA",29,0)
 S F="^PS(55,DFN,""IV"",",WBDT=BDT
"RTN","PSJBCMA",30,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",31,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  S FON=ON_"V",PSJON(FON)="" D IVVAR
"RTN","PSJBCMA",32,0)
 ;Pending orders
"RTN","PSJBCMA",33,0)
 S F="^PS(53.1,"
"RTN","PSJBCMA",34,0)
 F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  D
"RTN","PSJBCMA",35,0)
 . S FON=ON_"P"
"RTN","PSJBCMA",36,0)
 . S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="F":"IVVAR",1:"UDVAR")
"RTN","PSJBCMA",37,0)
 ;When a one-time order is found, check against PSJON(FON) array to
"RTN","PSJBCMA",38,0)
 ;make sure no duplicates return on ^TMP.
"RTN","PSJBCMA",39,0)
 I '+$G(OTDATE) D NOW^%DTC S X1=$E(%,1,12),X2=-30 D C^%DTC S OTDATE=X
"RTN","PSJBCMA",40,0)
 I OTDATE'["." S OTDATE=OTDATE_".0001"
"RTN","PSJBCMA",41,0)
 Q:BDT'>OTDATE
"RTN","PSJBCMA",42,0)
 S F="^PS(55,DFN,5,",WBDT=OTDATE
"RTN","PSJBCMA",43,0)
 F  S WBDT=$O(^PS(55,DFN,5,"AU","O",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",44,0)
 .  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AU","O",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",45,0)
 .. S FON=ON_"U" D:'$D(PSJON(FON)) UDVAR
"RTN","PSJBCMA",46,0)
 S F="^PS(55,DFN,""IV"",",WBDT=OTDATE
"RTN","PSJBCMA",47,0)
 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  D
"RTN","PSJBCMA",48,0)
 . F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D
"RTN","PSJBCMA",49,0)
 .. S X=$P($G(^PS(55,DFN,"IV",ON,0)),U,9)
"RTN","PSJBCMA",50,0)
 .. I X]"",$$ONE(DFN,ON_"V",X,$P(X,"^",2),$P(X,"^",3))="O" D
"RTN","PSJBCMA",51,0)
 ... S FON=ON_"V" D:'$D(PSJON(FON)) IVVAR
"RTN","PSJBCMA",52,0)
 K PSJON,PSJBCID
"RTN","PSJBCMA",53,0)
 Q
"RTN","PSJBCMA",54,0)
UDVAR ;Set ^TMP for Unit dose & Pending orders
"RTN","PSJBCMA",55,0)
 N CLINIC
"RTN","PSJBCMA",56,0)
 D UDPEND Q:'$$CLINICS($G(CLINIC)) 
"RTN","PSJBCMA",57,0)
 D TMP
"RTN","PSJBCMA",58,0)
 ;Setup Dispense drug for ^TMP
"RTN","PSJBCMA",59,0)
 S CNT=0 D NOW^%DTC
"RTN","PSJBCMA",60,0)
 F X=0:0 S X=$O(@(F_ON_",1,"_X_")")) Q:'X  D
"RTN","PSJBCMA",61,0)
 . S PSJDD=@(F_ON_",1,"_X_",0)") I $P(PSJDD,"^",3)]"",$P(PSJDD,"^",3)'>% Q
"RTN","PSJBCMA",62,0)
 .;*225 Don't allow 0
"RTN","PSJBCMA",63,0)
 . I +$P(PSJDD,"^",2)=0 S $P(PSJDD,"^",2)=1
"RTN","PSJBCMA",64,0)
 . S CNT=CNT+1
"RTN","PSJBCMA",65,0)
 . S ^TMP("PSJ",$J,PSJINX,700,CNT,0)=+PSJDD_U_$P($G(^PSDRUG(+PSJDD,0)),U)_U_$S((FON["U")&($P(PSJDD,U,2)=""):1,(FON["U")&($E($P(PSJDD,U,2))="."):"0"_$P(PSJDD,U,2),1:$P(PSJDD,U,2))_U_$P(PSJDD,U,3)
"RTN","PSJBCMA",66,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,700,0)=CNT
"RTN","PSJBCMA",67,0)
 K PSJ,PSJDD
"RTN","PSJBCMA",68,0)
 Q
"RTN","PSJBCMA",69,0)
IVVAR ;Set variables for IV and pending orders
"RTN","PSJBCMA",70,0)
 NEW ND,X,Y,CLINIC
"RTN","PSJBCMA",71,0)
 I FON["P" D UDPEND Q:'$$CLINICS(CLINIC)  S PSJ("INFRATE")=$P($G(^PS(53.1,ON,8)),U,5)
"RTN","PSJBCMA",72,0)
 I FON["V" D  Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",73,0)
 . S X=$G(^PS(55,DFN,"IV",ON,0)),CLINIC=$G(^("DSS")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",74,0)
 . S PSJ("STARTDT")=$P(X,U,2),PSJ("STOPDT")=$P(X,U,3)
"RTN","PSJBCMA",75,0)
 . S PSJ("INFRATE")=$P(X,U,8),PSJ("SCHD")=$P(X,U,9)
"RTN","PSJBCMA",76,0)
 . S PSJ("ADM")=$P(X,U,11),PSJ("AUTO")=$P(X,U,12),PSJ("STATUS")=$P(X,U,17)
"RTN","PSJBCMA",77,0)
 . S PSJ("IVTYPE")=$P(X,U,4),PSJ("INSYR")=$P(X,U,5)
"RTN","PSJBCMA",78,0)
 . S PSJ("CPRS")=$P(X,U,21),PSJ("CHEMO")=$P(X,U,23)
"RTN","PSJBCMA",79,0)
 . S X=$G(^PS(55,DFN,"IV",ON,.2))
"RTN","PSJBCMA",80,0)
 . S PSJ("DO")="",PSJ("MR")=$P(X,U,3),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA",81,0)
 . I PSJ("FLG") D
"RTN","PSJBCMA",82,0)
 .. N S1,A,B,C
"RTN","PSJBCMA",83,0)
 .. S S1="" F  S S1=$O(^PS(55,DFN,"IV",ON,"A",S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,2),B=$P(C,U,4) Q:A="UG"  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA",84,0)
 ... Q:A'="G"
"RTN","PSJBCMA",85,0)
 ... S PSJ("SRC")=$S(B["FLAGGED BY PHARM":"PHARMACIST",B["FLAGGED BY CPRS":"CPRS",1:"")
"RTN","PSJBCMA",86,0)
 ... S PSJ("COM")=$P(B," ",4,99)
"RTN","PSJBCMA",87,0)
 . S PSJ("OI")=+X
"RTN","PSJBCMA",88,0)
 . S X=$G(^PS(55,DFN,"IV",ON,2))
"RTN","PSJBCMA",89,0)
 . S PSJ("PREV")=$P(X,U,5) I PSJ("PREV")["V",(+PSJ("PREV")=+ON) S PSJ("PREV")=""
"RTN","PSJBCMA",90,0)
 . S PSJ("FOLLOW")=$P(X,U,6),PSJ("RFO")=$P(X,U,9) I PSJ("FOLLOW")["V",(+PSJ("FOLLOW")=+ON) S (PSJ("FOLLOW"),PSJ("RFO"))=""
"RTN","PSJBCMA",91,0)
 . S PSJ("SIOPI")=$S($P($G(^PS(55,DFN,"IV",+ON,3)),"^",2)&($P($G(^PS(55,DFN,"IV",+ON,3)),"^")'=""):"!",1:"")_$P($G(^(3)),"^")
"RTN","PSJBCMA",92,0)
 . N SCHD S SCHD=PSJ("SCHD")
"RTN","PSJBCMA",93,0)
 . S PSJ("STC")=$$ONE(DFN,ON_"V",SCHD,PSJ("STARTDT"),PSJ("STOPDT"))
"RTN","PSJBCMA",94,0)
 . I PSJ("STC")=""!(PSJ("STC")="C") S PSJ("STC")=$S(SCHD["PRN":"P",1:"C")
"RTN","PSJBCMA",95,0)
 . I PSJ("STC")="C" S PSJ("STC")=$S($$ONCALL(SCHD):"OC",1:"C")
"RTN","PSJBCMA",96,0)
 D TMP
"RTN","PSJBCMA",97,0)
 S CNT=0
"RTN","PSJBCMA",98,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  D
"RTN","PSJBCMA",99,0)
 . S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$G(^PS(52.6,+ND,0))
"RTN","PSJBCMA",100,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,850,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(ND,U,3)
"RTN","PSJBCMA",101,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,850,0)=CNT,CNT=0
"RTN","PSJBCMA",102,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  D
"RTN","PSJBCMA",103,0)
 . S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0))
"RTN","PSJBCMA",104,0)
 . S CNT=CNT+1,^TMP("PSJ",$J,PSJINX,950,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJBCMA",105,0)
 S:CNT ^TMP("PSJ",$J,PSJINX,950,0)=CNT
"RTN","PSJBCMA",106,0)
 K PSJ
"RTN","PSJBCMA",107,0)
 S X1=0
"RTN","PSJBCMA",108,0)
 F  S X1=$O(^PS(55,DFN,"IVBCMA",X1)) Q:'X1  D
"RTN","PSJBCMA",109,0)
 . S XX=$G(^PS(55,DFN,"IVBCMA",X1,0)) Q:ON'=$P(XX,"^",2)  S PSJBCID=$P(XX,"^"),X2=0
"RTN","PSJBCMA",110,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"AD",X2)) Q:'X2  S X=^(X2,0),^TMP("PSJ",$J,PSJINX,800,PSJBCID,I)=+X_"^"_$S($D(^PS(52.6,+X,0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",111,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,800,PSJBCID,0)=I-1
"RTN","PSJBCMA",112,0)
 . S X2=0
"RTN","PSJBCMA",113,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"SOL",X2)) Q:'X2  S X=^(X2,0),^TMP("PSJ",$J,PSJINX,900,PSJBCID,I)=$P(X,"^")_"^"_$S($D(^PS(52.7,$P(X,"^"),0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA",114,0)
 . I I>1 S ^TMP("PSJ",$J,PSJINX,900,PSJBCID,0)=I-1
"RTN","PSJBCMA",115,0)
 Q
"RTN","PSJBCMA",116,0)
UDPEND ;
"RTN","PSJBCMA",117,0)
 S X=$G(@(F_ON_",0)")) I $P(F,",")[53.1 S CLINIC=$G(@(F_ON_",""DSS"")")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",118,0)
 I $P(F,",")[55 S CLINIC=$G(@(F_ON_",8)")) Q:'$$CLINICS(CLINIC)
"RTN","PSJBCMA",119,0)
 S PSJ("MR")=$P(X,U,3),PSJ("SM")=$P(X,U,5),PSJ("HSM")=$P(X,U,6)
"RTN","PSJBCMA",120,0)
 S PSJ("ST")=$P(X,U,7),PSJ("STATUS")=$P(X,U,9)
"RTN","PSJBCMA",121,0)
 S PSJ("CPRS")=$P(X,U,21),PSJ("PREV")=$P(X,U,25),PSJ("FOLLOW")=$P(X,U,26),PSJ("RFO")=$P(X,U,27)
"RTN","PSJBCMA",122,0)
 S:FON["U" PSJ("NGIVEN")=$P(X,U,22)
"RTN","PSJBCMA",123,0)
 S X=$G(@(F_ON_",.2)"))
"RTN","PSJBCMA",124,0)
 S PSJ("DO")=$P(X,U,2),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA",125,0)
 I PSJ("FLG") D
"RTN","PSJBCMA",126,0)
 . N S1,A,B,C
"RTN","PSJBCMA",127,0)
 . S S1="" F  S S1=$O(^PS(55,DFN,5,ON,9,S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,3),B=$P(C,U,4) Q:A=7010!(A=7030)  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA",128,0)
 .. Q:A'=7000&(A'=7020)
"RTN","PSJBCMA",129,0)
 .. S PSJ("SRC")=$S(A=7000:"PHARMACIST",A=7020:"CPRS",1:"")
"RTN","PSJBCMA",130,0)
 .. S PSJ("COM")=$G(@(F_ON_",13)"))
"RTN","PSJBCMA",131,0)
 S PSJ("OI")=+X
"RTN","PSJBCMA",132,0)
 S X=$G(@(F_ON_",2)"))
"RTN","PSJBCMA",133,0)
 S PSJ("SCHD")=$P(X,U),PSJ("STARTDT")=$P(X,U,2)
"RTN","PSJBCMA",134,0)
 S PSJ("STOPDT")=$P(X,U,4),PSJ("ADM")=$P(X,U,5)
"RTN","PSJBCMA",135,0)
 S X=$G(@(F_ON_",4)"))
"RTN","PSJBCMA",136,0)
 S PSJ("AUTO")=$P(X,U,11)
"RTN","PSJBCMA",137,0)
 ;naked reference on line below refers to  full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJBCMA",138,0)
 S PSJ("SIOPI")=$S($P($G(@(F_ON_",6)")),"^",2)&($P($G(@(F_ON_",6)")),"^")'=""):"!",1:"")_$$ENSET($P($G(^(6)),"^"))
"RTN","PSJBCMA",139,0)
 D SIOPI
"RTN","PSJBCMA",140,0)
 S PSJ("STC")=PSJ("ST")
"RTN","PSJBCMA",141,0)
 I PSJ("ST")="R"!(PSJ("ST")="C") S PSJ("STC")=$S(PSJ("SCHD")["PRN":"P",$$ONCALL(PSJ("SCHD")):"OC",$$ONE(DFN,FON,PSJ("SCHD"))="O":"O",1:"C")
"RTN","PSJBCMA",142,0)
 Q
"RTN","PSJBCMA",143,0)
TMP ;Setup ^TMP that have common fields between IV and U/D
"RTN","PSJBCMA",144,0)
 N A
"RTN","PSJBCMA",145,0)
 S PSJINX=PSJINX+1
"RTN","PSJBCMA",146,0)
 S PSJ("OINAME")=$$OIDF^PSJLMUT1(+PSJ("OI")) I PSJ("OINAME")["NOT FOUND" S PSJ("OINAME")=""
"RTN","PSJBCMA",147,0)
 S PSJ("OIDF")=$$GET1^DIQ(50.7,+PSJ("OI"),.02)
"RTN","PSJBCMA",148,0)
 I PSJ("OINAME")="" S PSJ("OIDF")=""
"RTN","PSJBCMA",149,0)
 S A=$G(^PS(51.2,+PSJ("MR"),0)),PSJ("MRABB")=$P(A,U,3),PSJ("MRNM")=$P(A,U)
"RTN","PSJBCMA",150,0)
 S ^TMP("PSJ",$J,PSJINX,0)=DFN_U_+ON_U_FON_U_PSJ("PREV")_U_PSJ("FOLLOW")_U_$G(PSJ("IVTYPE"))_U_$G(PSJ("INSYR"))_U_$G(PSJ("CHEMO"))_U_PSJ("CPRS")_U_$G(PSJ("RFO"))
"RTN","PSJBCMA",151,0)
 S ^TMP("PSJ",$J,PSJINX,1)=PSJ("MRABB")_U_PSJ("STC")_U_$G(PSJ("SCHD"))_U_PSJ("STARTDT")_U_PSJ("STOPDT")_U_PSJ("ADM")_U_PSJ("STATUS")_U_$G(PSJ("NGIVEN"))_U_$G(PSJ("ST"))_U_$G(PSJ("AUTO"))
"RTN","PSJBCMA",152,0)
 S ^TMP("PSJ",$J,PSJINX,1,0)=$P(A,U,8)_U_PSJ("MRNM")_U_$P(A,U,9)
"RTN","PSJBCMA",153,0)
 S ^TMP("PSJ",$J,PSJINX,2)=PSJ("DO")_U_$G(PSJ("INFRATE"))_U_$G(PSJ("SM"))_U_$G(PSJ("HSM"))
"RTN","PSJBCMA",154,0)
 S ^TMP("PSJ",$J,PSJINX,3)=PSJ("OI")_U_PSJ("OINAME")_U_PSJ("OIDF")
"RTN","PSJBCMA",155,0)
 S ^TMP("PSJ",$J,PSJINX,4)=PSJ("SIOPI")
"RTN","PSJBCMA",156,0)
 S A=$$SNDTSTA^PSJHL4A(PSJ("PRI"),PSJ("SCHD"))
"RTN","PSJBCMA",157,0)
 S ^TMP("PSJ",$J,PSJINX,5)=$S(A=1:0,1:1)_U_PSJ("FLG")_U_PSJ("SRC")_U_PSJ("COM")
"RTN","PSJBCMA",158,0)
 Q
"RTN","PSJBCMA",159,0)
SIOPI ; Use provider comments if order is pending and there is no SI
"RTN","PSJBCMA",160,0)
 NEW X,Y,Z
"RTN","PSJBCMA",161,0)
 I FON["P",(PSJ("SIOPI")=""),$O(^PS(53.1,+ON,12,0)) D
"RTN","PSJBCMA",162,0)
 . F X=0:0 S X=$O(^PS(53.1,+ON,12,X)) Q:'X  S Z=$G(^(X,0)) D
"RTN","PSJBCMA",163,0)
 .. S Y=$L(PSJ("SIOPI"))
"RTN","PSJBCMA",164,0)
 .. S:Y+$L(Z)'>179 PSJ("SIOPI")=PSJ("SIOPI")_Z_""
"RTN","PSJBCMA",165,0)
 . I Y+$L(Z)>179 S PSJ("SIOPI")="SEE PROVIDER COMMENTS"
"RTN","PSJBCMA",166,0)
 Q
"RTN","PSJBCMA",167,0)
ENSET(X) ; expands SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSJBCMA",168,0)
 N X1,X2,Y S Y=""
"RTN","PSJBCMA",169,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) I X2]"" S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSJBCMA",170,0)
 S Y=$E(Y,1,$L(Y)-1)
"RTN","PSJBCMA",171,0)
 Q Y
"RTN","PSJBCMA",172,0)
ONE(DFN,ORD,SCH,START,STOP) ;Determine if order is one-time, and return schedule type
"RTN","PSJBCMA",173,0)
 ; Input:  DFN - patient's IEN
"RTN","PSJBCMA",174,0)
 ;         ORD - order number
"RTN","PSJBCMA",175,0)
 ;         SCH - schedule text (required)
"RTN","PSJBCMA",176,0)
 ;         START - order start date (optional)
"RTN","PSJBCMA",177,0)
 ;         STOP - order stop date (optional)
"RTN","PSJBCMA",178,0)
 N X,ONEFRQ,TYP,T
"RTN","PSJBCMA",179,0)
 I $G(PSJ("PREV")),$G(PSJ("FOLLOW")) I +PSJ("PREV")=+PSJ("FOLLOW") S (PSJ("PREV"),PSJ("FOLLOW"))=""
"RTN","PSJBCMA",180,0)
 ; PSJ*5*190 One-Time PRN
"RTN","PSJBCMA",181,0)
 I $G(SCH)="",$G(DFN),$G(ORD) D
"RTN","PSJBCMA",182,0)
 .I ORD["U" S SCH=$P($G(^PS(55,DFN,5,+ORD,2)),"^")
"RTN","PSJBCMA",183,0)
 .I ORD["V" S SCH=$P($G(^PS(55,DFN,"IV",+ORD,0)),"^",9)
"RTN","PSJBCMA",184,0)
 I $G(SCH)]"",$$OTPRN^PSJBCMA3(SCH)="O" Q "O"
"RTN","PSJBCMA",185,0)
 I $G(DFN)]"",$G(ORD)]"",ORD["U",$P(^PS(55,DFN,5,+ORD,0),"^",7)'="R" Q $P(^PS(55,DFN,5,+ORD,0),"^",7)
"RTN","PSJBCMA",186,0)
 I $G(SCH)="" Q ""
"RTN","PSJBCMA",187,0)
 ; PSJ*5*113 Determine schedule type from ^PS(51.1, not from schedule name.
"RTN","PSJBCMA",188,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="D":"C",1:X)
"RTN","PSJBCMA",189,0)
 I $G(START)]"",$G(STOP)]"",START=STOP Q "O"
"RTN","PSJBCMA",190,0)
 I $$DAY(SCH) Q "C"
"RTN","PSJBCMA",191,0)
 Q ""
"RTN","PSJBCMA",192,0)
CLINIC(CL) ;
"RTN","PSJBCMA",193,0)
 I $P(CL,"^",2)?7N!($P(CL,"^",2)?7N1".".N) Q 1
"RTN","PSJBCMA",194,0)
 Q 0
"RTN","PSJBCMA",195,0)
CLINICS(CL) ;
"RTN","PSJBCMA",196,0)
 Q:'$$CLINIC(CL) 1
"RTN","PSJBCMA",197,0)
 Q:'$D(^PS(53.46,"B",+CL)) 1
"RTN","PSJBCMA",198,0)
 N A
"RTN","PSJBCMA",199,0)
 S A=$O(^PS(53.46,"B",+CL,"")) Q:'A 1
"RTN","PSJBCMA",200,0)
 Q $P(^PS(53.46,A,0),"^",4)
"RTN","PSJBCMA",201,0)
DAY(SCH) ;determine if this is a 'day of the week' schedule
"RTN","PSJBCMA",202,0)
 I $G(SCH)="" Q 0
"RTN","PSJBCMA",203,0)
 N D,DAY,DAYS,I,X
"RTN","PSJBCMA",204,0)
 S DAYS="SUNDAY,MONDAY,TUESDAY,WEDNESDAY,THURSDAY,FRIDAY,SATURDAY"
"RTN","PSJBCMA",205,0)
 F I=1:1 S D=$P(SCH,"-",I) Q:D=""  D  Q:X=0
"RTN","PSJBCMA",206,0)
 . S X=0 F J=1:1:7 S DAY=$P(DAYS,",",J) D  Q:X=1
"RTN","PSJBCMA",207,0)
 .. I D=$E(DAY,1,$L(D)) S X=1
"RTN","PSJBCMA",208,0)
 Q X
"RTN","PSJBCMA",209,0)
 ;
"RTN","PSJBCMA",210,0)
ONCALL(SCHD) ; Check if a schedule is type On Call (all "APPSJ" schedules with a given name must have the same schedule type)
"RTN","PSJBCMA",211,0)
 N NXT,SCHARR,OCCHK
"RTN","PSJBCMA",212,0)
 S OCCHK=0
"RTN","PSJBCMA",213,0)
 Q:$G(SCHD)="" OCCHK
"RTN","PSJBCMA",214,0)
 Q:'$D(^PS(51.1,"APPSJ",SCHD)) OCCHK
"RTN","PSJBCMA",215,0)
 S NXT=0 F  S NXT=$O(^PS(51.1,"APPSJ",SCHD,NXT)) Q:'NXT  S TYP=$P($G(^PS(51.1,+NXT,0)),"^",5) S:TYP]"" SCHARR(TYP)=""
"RTN","PSJBCMA",216,0)
 I '$D(SCHARR("OC")) S OCCHK=0 Q OCCHK
"RTN","PSJBCMA",217,0)
 I $O(SCHARR("OC"))]""!($O(SCHARR("OC"),-1)]"") S OCCHK=0 Q OCCHK
"RTN","PSJBCMA",218,0)
 I $D(SCHARR("OC")) S OCCHK=1
"RTN","PSJBCMA",219,0)
 Q OCCHK
"RTN","PSJBCMA1")
0^5^B68412667^B70492057
"RTN","PSJBCMA1",1,0)
PSJBCMA1 ;BIR/MV-RETURN INFORMATION FOR AN ORDER ;16 Mar 99 / 10:59 AM
"RTN","PSJBCMA1",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**32,41,46,57,63,66,56,58,81,91,104,186,159,173,253**;16 DEC 97;Build 31
"RTN","PSJBCMA1",3,0)
 ;
"RTN","PSJBCMA1",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJBCMA1",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJBCMA1",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJBCMA1",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJBCMA1",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJBCMA1",9,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJBCMA1",10,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJBCMA1",11,0)
 ; Reference to ^DIQ is supported by DBIA 2056.
"RTN","PSJBCMA1",12,0)
 ; Usage of this routine by BCMA is supported by DBIA 2829.
"RTN","PSJBCMA1",13,0)
 ;
"RTN","PSJBCMA1",14,0)
EN(DFN,ON,PSJTMP)         ; return detail data for Inpatient Meds.
"RTN","PSJBCMA1",15,0)
 NEW F,A
"RTN","PSJBCMA1",16,0)
 S PSJTMP=$S($G(PSJTMP)=1:"PSJ1",1:"PSJ")
"RTN","PSJBCMA1",17,0)
 I $G(ON)["U" S F="^PS(55,+$G(DFN),5,+ON" D:$D(@(F_")")) UDVAR
"RTN","PSJBCMA1",18,0)
 I $G(ON)["V" S F="^PS(55,+$G(DFN),""IV"",+ON" D:$D(@(F_")")) IVVAR
"RTN","PSJBCMA1",19,0)
 I $G(ON)["P" S F="^PS(53.1,+ON",X=$P($G(^PS(53.1,+ON,0)),U,4) D:$D(@(F_")")) @$S(X="F":"IVVAR",1:"UDVAR")
"RTN","PSJBCMA1",20,0)
 I '$D(^TMP(PSJTMP,$J,0)) S ^(0)=-1
"RTN","PSJBCMA1",21,0)
 Q
"RTN","PSJBCMA1",22,0)
 ;
"RTN","PSJBCMA1",23,0)
UDVAR ;* Set ^TMP for Unit dose & Pending orders
"RTN","PSJBCMA1",24,0)
 NEW CNT,X
"RTN","PSJBCMA1",25,0)
 D UDPEND
"RTN","PSJBCMA1",26,0)
 D TMP
"RTN","PSJBCMA1",27,0)
 ;* Setup Dispense drug for ^TMP
"RTN","PSJBCMA1",28,0)
 S CNT=0 D NOW^%DTC
"RTN","PSJBCMA1",29,0)
 F X=0:0 S X=$O(@(F_",1,"_X_")")) Q:'X  D
"RTN","PSJBCMA1",30,0)
 . S PSJDD=@(F_",1,"_X_",0)") I $P(PSJDD,"^",3)]"",$P(PSJDD,"^",3)'>% Q
"RTN","PSJBCMA1",31,0)
 . S CNT=CNT+1
"RTN","PSJBCMA1",32,0)
 . S ^TMP(PSJTMP,$J,700,CNT,0)=+PSJDD_U_$P($G(^PSDRUG(+PSJDD,0)),U)_U_$S((ON["U")&($P(PSJDD,U,2)=""):1,(ON["U")&($E($P(PSJDD,U,2))="."):"0"_$P(PSJDD,U,2),1:$P(PSJDD,U,2))_U_$P(PSJDD,U,3)
"RTN","PSJBCMA1",33,0)
 S:CNT ^TMP(PSJTMP,$J,700,0)=CNT
"RTN","PSJBCMA1",34,0)
 K PSJ,PSJDD,PSJDN
"RTN","PSJBCMA1",35,0)
 Q
"RTN","PSJBCMA1",36,0)
IVVAR ;* Set variables for IV and pending orders
"RTN","PSJBCMA1",37,0)
 NEW CNT,DN,ND,X,Y
"RTN","PSJBCMA1",38,0)
 I ON["P" D UDPEND S PSJ("INFRATE")=$P($G(^PS(53.1,ON,8)),U,5)
"RTN","PSJBCMA1",39,0)
 I ON["V" D
"RTN","PSJBCMA1",40,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,0))
"RTN","PSJBCMA1",41,0)
 . S PSJ("STARTDT")=$P(X,U,2),PSJ("STOPDT")=$P(X,U,3)
"RTN","PSJBCMA1",42,0)
 . S PSJ("PROVIDER")=$P(X,U,6)
"RTN","PSJBCMA1",43,0)
 . S PSJ("INFRATE")=$P(X,U,8),PSJ("SCHD")=$P(X,U,9)
"RTN","PSJBCMA1",44,0)
 . S PSJ("ADM")=$P(X,U,11),PSJ("AUTO")=$P(X,U,12),PSJ("STATUS")=$P(X,U,17)
"RTN","PSJBCMA1",45,0)
 . S PSJ("FREQ")=$P(X,U,15),PSJ("IVTYPE")=$P(X,U,4)
"RTN","PSJBCMA1",46,0)
 . S PSJ("INSYR")=$P(X,U,5),PSJ("CPRS")=$P(X,U,21),PSJ("CHEMO")=$P(X,U,23)
"RTN","PSJBCMA1",47,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,.2))
"RTN","PSJBCMA1",48,0)
 . S PSJ("OI")=$P(X,U),PSJ("DO")="",PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA1",49,0)
 . I PSJ("FLG") D
"RTN","PSJBCMA1",50,0)
 .. N S1,A,B,C
"RTN","PSJBCMA1",51,0)
 .. S S1="" F  S S1=$O(^PS(55,DFN,"IV",+ON,"A",S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,2),B=$P(C,U,4) Q:A="UG"  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA1",52,0)
 ... Q:A'="G"
"RTN","PSJBCMA1",53,0)
 ... S PSJ("SRC")=$S(B["FLAGGED BY PHARM":"PHARMACIST",B["FLAGGED BY CPRS":"CPRS",1:"")
"RTN","PSJBCMA1",54,0)
 ... S PSJ("COM")=$P(B," ",4,99)
"RTN","PSJBCMA1",55,0)
 . S PSJ("MR")=$P(X,U,3)
"RTN","PSJBCMA1",56,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,4))
"RTN","PSJBCMA1",57,0)
 . S PSJ("NURSE")=$P(X,U)
"RTN","PSJBCMA1",58,0)
 . S PSJ("PHARM")=$P(X,U,4)
"RTN","PSJBCMA1",59,0)
 . S X=$G(^PS(55,DFN,"IV",+ON,2))
"RTN","PSJBCMA1",60,0)
 . S PSJ("LDT")=$P(X,U)
"RTN","PSJBCMA1",61,0)
 . S PSJ("PREV")=$P(X,U,5),PSJ("FOLLOW")=$P(X,U,6)
"RTN","PSJBCMA1",62,0)
 . S PSJ("SIOPI")=$S($P($G(^PS(55,DFN,"IV",+ON,3)),"^",2)&($P($G(^PS(55,DFN,"IV",+ON,3)),"^")'=""):"!",1:"")_$P($G(^(3)),"^")
"RTN","PSJBCMA1",63,0)
 . N SCHD S SCHD=PSJ("SCHD")  ; SCHD var required to shorten $Select
"RTN","PSJBCMA1",64,0)
 . S PSJ("STC")=$$ONE^PSJBCMA(DFN,ON,SCHD,PSJ("STARTDT"),PSJ("STOPDT"))
"RTN","PSJBCMA1",65,0)
 . I PSJ("STC")=""!(PSJ("STC")="C") S PSJ("STC")=$S(SCHD["PRN":"P",1:"C")
"RTN","PSJBCMA1",66,0)
 . I PSJ("STC")="C" S PSJ("STC")=$S($$ONCALL^PSJBCMA(PSJ("SCHD")):"OC",1:"C")
"RTN","PSJBCMA1",67,0)
 . S PSJ("NURSE")=$P($G(^PS(55,DFN,"IV",+ON,4)),U)
"RTN","PSJBCMA1",68,0)
 D TMP
"RTN","PSJBCMA1",69,0)
 S X=$P($G(^PS(55,DFN,"IV",+ON,1)),U) S:X]"" ^TMP(PSJTMP,$J,6)=X
"RTN","PSJBCMA1",70,0)
 S CNT=0
"RTN","PSJBCMA1",71,0)
 F X=0:0 S X=$O(@(F_",""AD"","_X_")")) Q:'X  D
"RTN","PSJBCMA1",72,0)
 . S ND=$G(@(F_",""AD"","_X_",0)")),DN=$G(^PS(52.6,+ND,0)) ;,AOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I AOINAME["NOTFOUND" S AOINAME=""
"RTN","PSJBCMA1",73,0)
 . S CNT=CNT+1,^TMP(PSJTMP,$J,850,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(ND,U,3) ;_U_U_$P(DN,U,11)_U_AOINAME_U_AOIDF
"RTN","PSJBCMA1",74,0)
 S:CNT ^TMP(PSJTMP,$J,850,0)=CNT,CNT=0
"RTN","PSJBCMA1",75,0)
 F X=0:0 S X=$O(@(F_",""SOL"","_X_")")) Q:'X  D
"RTN","PSJBCMA1",76,0)
 . S ND=$G(@(F_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)) ;,SOINAME=$$OIDF^PSJLMUT1(+$P(DN,U,11)) I SOINAME["NOTFOUND" S SOINAME=""
"RTN","PSJBCMA1",77,0)
 . S CNT=CNT+1,^TMP(PSJTMP,$J,950,CNT,0)=+ND_U_$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4) ;_U_U_$P(DN,U,11)_U_SOINAME_U_SOIDF
"RTN","PSJBCMA1",78,0)
 S:CNT ^TMP(PSJTMP,$J,950,0)=CNT
"RTN","PSJBCMA1",79,0)
 K PSJ
"RTN","PSJBCMA1",80,0)
 S X1=0
"RTN","PSJBCMA1",81,0)
 F  S X1=$O(^PS(55,DFN,"IVBCMA",X1)) Q:'X1  D
"RTN","PSJBCMA1",82,0)
 . S XX=$G(^PS(55,DFN,"IVBCMA",X1,0)) Q:$P(XX,"^",2)'=+ON  S PSJBCID=$P(XX,"^"),X2=0
"RTN","PSJBCMA1",83,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"AD",X2)) Q:'X2  S X=^(X2,0),^TMP(PSJTMP,$J,800,PSJBCID,I)=+X_"^"_$S($D(^PS(52.6,+X,0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA1",84,0)
 . I I>1 S ^TMP(PSJTMP,$J,800,PSJBCID,0)=I-1
"RTN","PSJBCMA1",85,0)
 . S X2=0
"RTN","PSJBCMA1",86,0)
 . F I=1:1 S X2=$O(^PS(55,DFN,"IVBCMA",X1,"SOL",X2)) Q:'X2  S X=^(X2,0),^TMP(PSJTMP,$J,900,PSJBCID,I)=$P(X,"^")_"^"_$S($D(^PS(52.7,$P(X,"^"),0)):$P(^(0),"^"),1:"*****")_"^"_$P(X,"^",2,99)
"RTN","PSJBCMA1",87,0)
 . I I>1 S ^TMP(PSJTMP,$J,900,PSJBCID,0)=I-1
"RTN","PSJBCMA1",88,0)
 . S ^TMP(PSJTMP,$J,1000,PSJBCID)=$P(XX,"^",6)_"^"_$P(XX,"^",8)_"^"_$P(XX,"^",7)
"RTN","PSJBCMA1",89,0)
 Q
"RTN","PSJBCMA1",90,0)
UDPEND ;
"RTN","PSJBCMA1",91,0)
 S X=$G(@(F_",0)"))
"RTN","PSJBCMA1",92,0)
 S PSJ("PROVIDER")=$P(X,U,2)
"RTN","PSJBCMA1",93,0)
 S PSJ("MR")=$P(X,U,3),PSJ("SM")=$P(X,U,5),PSJ("HSM")=$P(X,U,6)
"RTN","PSJBCMA1",94,0)
 S PSJ("ST")=$P(X,U,7),PSJ("STATUS")=$P(X,U,9)
"RTN","PSJBCMA1",95,0)
 S PSJ("LDT")=$P(X,U,16)
"RTN","PSJBCMA1",96,0)
 S:ON["U" PSJ("NGIVEN")=$P(X,U,22)
"RTN","PSJBCMA1",97,0)
 S PSJ("SMYN")=$S(+PSJ("SM"):"YES",1:"NO")
"RTN","PSJBCMA1",98,0)
 S PSJ("HSMYN")=$S(+PSJ("HSM"):"YES",1:"NO")
"RTN","PSJBCMA1",99,0)
 S PSJ("CPRS")=$P(X,U,21),PSJ("PREV")=$P(X,U,25),PSJ("FOLLOW")=$P(X,U,26)
"RTN","PSJBCMA1",100,0)
 S X=$G(@(F_",.2)"))
"RTN","PSJBCMA1",101,0)
 S PSJ("OI")=$P(X,U),PSJ("DO")=$P(X,U,2),PSJ("PRI")=$P(X,U,4),PSJ("FLG")=$P(X,U,7),PSJ("COM")="",PSJ("SRC")=""
"RTN","PSJBCMA1",102,0)
 I PSJ("FLG") D
"RTN","PSJBCMA1",103,0)
 . N S1,A,B,C
"RTN","PSJBCMA1",104,0)
 . S S1="" F  S S1=$O(^PS(55,DFN,5,+ON,9,S1),-1) Q:'S1  S C=$G(^(S1,0)) S A=$P(C,U,3),B=$P(C,U,4) Q:A=7010!(A=7030)  D  I PSJ("SRC")]"" Q
"RTN","PSJBCMA1",105,0)
 .. Q:A'=7000&(A'=7020)
"RTN","PSJBCMA1",106,0)
 .. S PSJ("SRC")=$S(A=7000:"PHARMACIST",A=7020:"CPRS",1:"")
"RTN","PSJBCMA1",107,0)
 .. S PSJ("COM")=$G(@(F_",13)"))
"RTN","PSJBCMA1",108,0)
 S X=$G(@(F_",2)"))
"RTN","PSJBCMA1",109,0)
 S PSJ("SCHD")=$P(X,U),PSJ("STARTDT")=$P(X,U,2)
"RTN","PSJBCMA1",110,0)
 S PSJ("STC")=PSJ("ST")
"RTN","PSJBCMA1",111,0)
 I PSJ("ST")="R"!(PSJ("ST")="C") S PSJ("STC")=$S(PSJ("SCHD")["PRN":"P",$$ONCALL^PSJBCMA(PSJ("SCHD")):"OC",$$ONE^PSJBCMA(DFN,ON,PSJ("SCHD"))="O":"O",1:"C")
"RTN","PSJBCMA1",112,0)
 I PSJ("STC")="O" S PSJ("ST")="O"
"RTN","PSJBCMA1",113,0)
 S PSJ("STOPDT")=$P(X,U,4),PSJ("ADM")=$P(X,U,5)
"RTN","PSJBCMA1",114,0)
 S PSJ("FREQ")=$P(X,U,6)
"RTN","PSJBCMA1",115,0)
 S X=$G(@(F_",4)"))
"RTN","PSJBCMA1",116,0)
 S PSJ("NURSE")=$P(X,U),PSJ("AUTO")=$P(X,U,11)
"RTN","PSJBCMA1",117,0)
 S:ON["U" PSJ("PHARM")=+$P(X,U,3)
"RTN","PSJBCMA1",118,0)
 ; the naked reference on the line below refers to the full reference created by indirect reference to F, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJBCMA1",119,0)
 S PSJ("SIOPI")=$S($P($G(@(F_",6)")),"^",2)&($P($G(@(F_",6)")),"^")'=""):"!",1:"")_$$ENSET^PSJBCMA($P($G(^(6)),"^"))
"RTN","PSJBCMA1",120,0)
 NEW FON S FON=ON D SIOPI^PSJBCMA
"RTN","PSJBCMA1",121,0)
 Q 
"RTN","PSJBCMA1",122,0)
 ;
"RTN","PSJBCMA1",123,0)
TMP ;* Setup ^TMP that have common fields between IV and U/D
"RTN","PSJBCMA1",124,0)
 D NAME(PSJ("PROVIDER"),.PSJNAME,"","")
"RTN","PSJBCMA1",125,0)
 S PSJ("PRONAME")=PSJNAME K PSJNAME
"RTN","PSJBCMA1",126,0)
 I $D(PSJ("PHARM")) D
"RTN","PSJBCMA1",127,0)
 . D NAME(PSJ("PHARM"),.PSJNAME,.PSJINIT,.PSJPIEN)
"RTN","PSJBCMA1",128,0)
 . S PSJ("PHARM")=PSJPIEN,PSJ("PNAME")=PSJNAME,PSJ("PINIT")=PSJINIT K PSJNAME,PSJINIT,PSJPIEN
"RTN","PSJBCMA1",129,0)
 I +PSJ("NURSE") D
"RTN","PSJBCMA1",130,0)
 . D NAME(PSJ("NURSE"),.PSJNAME,.PSJINIT,"")
"RTN","PSJBCMA1",131,0)
 . S PSJ("NNAME")=PSJNAME,PSJ("NINIT")=PSJINIT K PSJNAME,PSJINIT
"RTN","PSJBCMA1",132,0)
 S A=$G(^PS(51.2,+PSJ("MR"),0)),PSJ("MRNM")=$P(A,U),PSJ("MRABB")=$P(A,U,3),PSJ("MRPIJ")=$P(A,U,8),PSJ("MRIVP")=$P(A,U,9)
"RTN","PSJBCMA1",133,0)
 S PSJ("OINAME")=$$OIDF^PSJLMUT1(+PSJ("OI")) I PSJ("OINAME")["NOT FOUND" S PSJ("OINAME")=""
"RTN","PSJBCMA1",134,0)
 S PSJ("OIDF")=$$GET1^DIQ(50.7,+PSJ("OI"),.02)
"RTN","PSJBCMA1",135,0)
 I PSJ("OINAME")="" S PSJ("OIDF")=""
"RTN","PSJBCMA1",136,0)
 S PSJ("LDTN")=$$DATE(PSJ("LDT"))
"RTN","PSJBCMA1",137,0)
 S PSJ("STARTDTN")=$$DATE(PSJ("STARTDT"))
"RTN","PSJBCMA1",138,0)
 S PSJ("STOPDTN")=$$DATE(PSJ("STOPDT"))
"RTN","PSJBCMA1",139,0)
 S X=$S(ON["V":PSJ("STC"),1:PSJ("ST"))
"RTN","PSJBCMA1",140,0)
 S PSJ("STNAME")=$S(X="C":"CONTINUOUS",X="O":"ONE TIME",X="P":"PRN",X="R":"FILL ON REQUEST",X="OC":"ON CALL",1:"NOT FOUND")
"RTN","PSJBCMA1",141,0)
 ;
"RTN","PSJBCMA1",142,0)
 S ^TMP(PSJTMP,$J,0)=DFN_U_+ON_U_ON_U_PSJ("PREV")_U_PSJ("FOLLOW")_U_$G(PSJ("IVTYPE"))_U_$G(PSJ("INSYR"))_U_$G(PSJ("CHEMO"))_U_PSJ("CPRS")
"RTN","PSJBCMA1",143,0)
 S ^TMP(PSJTMP,$J,1)=PSJ("PROVIDER")_U_PSJ("PRONAME")_U_PSJ("MR")_U_PSJ("MRABB")_U_$G(PSJ("SM"))_U_$G(PSJ("SMYN"))_U_$G(PSJ("HSM"))_U_$G(PSJ("HSMYN"))_U_$G(PSJ("NGIVEN"))_U_PSJ("STATUS")
"RTN","PSJBCMA1",144,0)
 S ^TMP(PSJTMP,$J,1)=^TMP(PSJTMP,$J,1)_U_$$STATUS(ON,PSJ("STATUS"))_U_$G(PSJ("AUTO"))_U_$G(PSJ("MRNM"))
"RTN","PSJBCMA1",145,0)
 S ^TMP(PSJTMP,$J,1,0)=PSJ("MRPIJ")_U_$G(PSJ("MRIVP"))
"RTN","PSJBCMA1",146,0)
 S ^TMP(PSJTMP,$J,2)=PSJ("OI")_U_PSJ("OINAME")_U_PSJ("DO")_U_$G(PSJ("INFRATE"))_U_$G(PSJ("SCHD"))_U_PSJ("OIDF")
"RTN","PSJBCMA1",147,0)
 S ^TMP(PSJTMP,$J,3)=PSJ("SIOPI")
"RTN","PSJBCMA1",148,0)
 S ^TMP(PSJTMP,$J,4)=PSJ("STC")_U_$G(PSJ("STNAME"))_U_PSJ("LDT")_U_PSJ("LDTN")_U_PSJ("STARTDT")_U_PSJ("STARTDTN")_U_PSJ("STOPDT")_U_PSJ("STOPDTN")_U_$$ADMIN(PSJ("ADM"))_U_$G(PSJ("ST"))_U_$G(PSJ("FREQ"))
"RTN","PSJBCMA1",149,0)
 S ^TMP(PSJTMP,$J,5)=$G(PSJ("NURSE"))_U_$G(PSJ("NNAME"))_U_$G(PSJ("NINIT"))_U_$G(PSJ("PHARM"))_U_$G(PSJ("PNAME"))_U_$G(PSJ("PINIT"))
"RTN","PSJBCMA1",150,0)
 S A=$$SNDTSTA^PSJHL4A(PSJ("PRI"),PSJ("SCHD"))
"RTN","PSJBCMA1",151,0)
 S ^TMP(PSJTMP,$J,7)=$S(A=1:0,1:1)_U_PSJ("FLG")_U_PSJ("SRC")_U_PSJ("COM")
"RTN","PSJBCMA1",152,0)
 Q
"RTN","PSJBCMA1",153,0)
 ;
"RTN","PSJBCMA1",154,0)
NAME(X,NAME,INIT,IEN)  ;Lookup in ^VA(200.
"RTN","PSJBCMA1",155,0)
 ;X = IEN or Name in ^VA(200
"RTN","PSJBCMA1",156,0)
 ;IEN = Return IEN in ^VA(200
"RTN","PSJBCMA1",157,0)
 ;NAME = Return the name in 200
"RTN","PSJBCMA1",158,0)
 ;INIT = Return the initial
"RTN","PSJBCMA1",159,0)
 NEW DIC,Y
"RTN","PSJBCMA1",160,0)
 S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSJBCMA1",161,0)
 S IEN=+Y
"RTN","PSJBCMA1",162,0)
 S NAME=$G(Y(0,0))
"RTN","PSJBCMA1",163,0)
 S INIT=$P($G(Y(0)),U,2)
"RTN","PSJBCMA1",164,0)
 Q
"RTN","PSJBCMA1",165,0)
 ;
"RTN","PSJBCMA1",166,0)
DATE(Y) ; FM internal date/time to user readable, 4 digit year
"RTN","PSJBCMA1",167,0)
 ; Y - date in FileMan internal format
"RTN","PSJBCMA1",168,0)
 I $G(Y) S Y=Y_$E(".",Y'[".")_"0000" Q $E(Y,4,5)_"/"_$E(Y,6,7)_"/"_($E(Y,1,3)+1700)_"  "_$E(Y,9,10)_":"_$E(Y,11,12)
"RTN","PSJBCMA1",169,0)
 Q "********"
"RTN","PSJBCMA1",170,0)
 ;
"RTN","PSJBCMA1",171,0)
STATUS(ON,X)          ;
"RTN","PSJBCMA1",172,0)
 ; ON = IEN_"I/U/P"
"RTN","PSJBCMA1",173,0)
 ; X  = STATUS
"RTN","PSJBCMA1",174,0)
 I X="P" Q $S(ON["P":"PENDING",ON["V":"PURGE",1:"NOT FOUND")
"RTN","PSJBCMA1",175,0)
 Q $S(X="A":"ACTIVE",X="D":"DISCONTINUED",X="E":"EXPIRED",X="H":"HOLD",X="R":"RENEWED",X="RE":"REINSTATED",X="N":"NON-VERFIED",X="DE":"DISCONTINUED (EDIT)",X="O":"ON CALL",1:"NOT FOUND")
"RTN","PSJBCMA1",176,0)
 ;
"RTN","PSJBCMA1",177,0)
ADMIN(X) ;
"RTN","PSJBCMA1",178,0)
 NEW Y,PSJADM,PSJX S PSJADM=""
"RTN","PSJBCMA1",179,0)
 I X="" Q ""
"RTN","PSJBCMA1",180,0)
 F Y=1:1:$L(X,"-") S PSJX=$E($P(X,"-",Y)_"0000",1,4) D
"RTN","PSJBCMA1",181,0)
 . S PSJADM=PSJADM_$S(PSJADM]"":"-",1:"")_PSJX
"RTN","PSJBCMA1",182,0)
 Q PSJADM
"RTN","PSJBCMA1",183,0)
 ;
"VER")
8.0^22.0
"BLD",7965,6)
^220
**END**
**END**
