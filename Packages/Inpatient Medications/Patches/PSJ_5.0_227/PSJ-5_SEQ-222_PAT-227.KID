Released PSJ*5*227 SEQ #222
Extracted from mail message
**KIDS**:PSJ*5.0*227^

**INSTALL NAME**
PSJ*5.0*227
"BLD",8640,0)
PSJ*5.0*227^INPATIENT MEDICATIONS^0^3111004^y
"BLD",8640,1,0)
^^8^8^3111004^
"BLD",8640,1,1,0)
This patch addresses the following 3 issues:
"BLD",8640,1,2,0)
 
"BLD",8640,1,3,0)
1. When entering a new UNIT DOSE order in VistA, using <space bar> <enter>
"BLD",8640,1,4,0)
   at the SCHEDULE prompt causes an error.
"BLD",8640,1,5,0)
 
"BLD",8640,1,6,0)
2. Undefined error when editing IV Quick Code schedule
"BLD",8640,1,7,0)
 
"BLD",8640,1,8,0)
3. Incorrect DIN drug information for Unit Dose orders
"BLD",8640,4,0)
^9.64PA^^
"BLD",8640,6.3)
1
"BLD",8640,"KRN",0)
^9.67PA^779.2^20
"BLD",8640,"KRN",.4,0)
.4
"BLD",8640,"KRN",.401,0)
.401
"BLD",8640,"KRN",.402,0)
.402
"BLD",8640,"KRN",.403,0)
.403
"BLD",8640,"KRN",.5,0)
.5
"BLD",8640,"KRN",.84,0)
.84
"BLD",8640,"KRN",3.6,0)
3.6
"BLD",8640,"KRN",3.8,0)
3.8
"BLD",8640,"KRN",9.2,0)
9.2
"BLD",8640,"KRN",9.8,0)
9.8
"BLD",8640,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",8640,"KRN",9.8,"NM",1,0)
PSGS0^^0^B75935708
"BLD",8640,"KRN",9.8,"NM",2,0)
PSJDIN^^0^B31115413
"BLD",8640,"KRN",9.8,"NM","B","PSGS0",1)

"BLD",8640,"KRN",9.8,"NM","B","PSJDIN",2)

"BLD",8640,"KRN",19,0)
19
"BLD",8640,"KRN",19,"NM",0)
^9.68A^^
"BLD",8640,"KRN",19.1,0)
19.1
"BLD",8640,"KRN",101,0)
101
"BLD",8640,"KRN",409.61,0)
409.61
"BLD",8640,"KRN",771,0)
771
"BLD",8640,"KRN",779.2,0)
779.2
"BLD",8640,"KRN",870,0)
870
"BLD",8640,"KRN",8989.51,0)
8989.51
"BLD",8640,"KRN",8989.52,0)
8989.52
"BLD",8640,"KRN",8994,0)
8994
"BLD",8640,"KRN","B",.4,.4)

"BLD",8640,"KRN","B",.401,.401)

"BLD",8640,"KRN","B",.402,.402)

"BLD",8640,"KRN","B",.403,.403)

"BLD",8640,"KRN","B",.5,.5)

"BLD",8640,"KRN","B",.84,.84)

"BLD",8640,"KRN","B",3.6,3.6)

"BLD",8640,"KRN","B",3.8,3.8)

"BLD",8640,"KRN","B",9.2,9.2)

"BLD",8640,"KRN","B",9.8,9.8)

"BLD",8640,"KRN","B",19,19)

"BLD",8640,"KRN","B",19.1,19.1)

"BLD",8640,"KRN","B",101,101)

"BLD",8640,"KRN","B",409.61,409.61)

"BLD",8640,"KRN","B",771,771)

"BLD",8640,"KRN","B",779.2,779.2)

"BLD",8640,"KRN","B",870,870)

"BLD",8640,"KRN","B",8989.51,8989.51)

"BLD",8640,"KRN","B",8989.52,8989.52)

"BLD",8640,"KRN","B",8994,8994)

"BLD",8640,"QUES",0)
^9.62^^
"BLD",8640,"REQB",0)
^9.611^2^2
"BLD",8640,"REQB",1,0)
PSJ*5.0*245^2
"BLD",8640,"REQB",2,0)
PSJ*5.0*76^2
"BLD",8640,"REQB","B","PSJ*5.0*245",1)

"BLD",8640,"REQB","B","PSJ*5.0*76",2)

"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
227^3111004
"PKG",221,22,1,"PAH",1,1,0)
^^8^8^3111004
"PKG",221,22,1,"PAH",1,1,1,0)
This patch addresses the following 3 issues:
"PKG",221,22,1,"PAH",1,1,2,0)
 
"PKG",221,22,1,"PAH",1,1,3,0)
1. When entering a new UNIT DOSE order in VistA, using <space bar> <enter>
"PKG",221,22,1,"PAH",1,1,4,0)
   at the SCHEDULE prompt causes an error.
"PKG",221,22,1,"PAH",1,1,5,0)
 
"PKG",221,22,1,"PAH",1,1,6,0)
2. Undefined error when editing IV Quick Code schedule
"PKG",221,22,1,"PAH",1,1,7,0)
 
"PKG",221,22,1,"PAH",1,1,8,0)
3. Incorrect DIN drug information for Unit Dose orders
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSGS0")
0^1^B75935708^B75670987
"RTN","PSGS0",1,0)
PSGS0 ;BIR/CML3 - SCHEDULE PROCESSOR ;06/22/09 7:12 PM
"RTN","PSGS0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**12,25,26,50,63,74,83,116,110,111,133,138,174,134,213,207,190,113,245,227**;DEC 16, 1997;Build 1
"RTN","PSGS0",3,0)
 ;
"RTN","PSGS0",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177.
"RTN","PSGS0",5,0)
 ; Reference to ^PS(55   is supported by DBIA 2191.
"RTN","PSGS0",6,0)
 ;
"RTN","PSGS0",7,0)
ENA ; entry point for train option
"RTN","PSGS0",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGS0",9,0)
 F  S (PSGS0Y,PSGS0XT)="" R !!,"Select STANDARD SCHEDULE: ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" ENQ^PSGSH I X'?1."?" D EN W:$D(X)[0 $C(7),"  ??" I $D(X)#2,'PSGS0Y,PSGS0XT W "  Every ",PSGS0XT," minutes"
"RTN","PSGS0",10,0)
 K DIC,DIE,PSGS0XT,PSGS0Y,Q,X,Y,PSGDT Q
"RTN","PSGS0",11,0)
 ;
"RTN","PSGS0",12,0)
EN3 ;
"RTN","PSGS0",13,0)
 S PSGST=$P($G(^PS(53.1,DA,0)),"^",7) G EN
"RTN","PSGS0",14,0)
 ;
"RTN","PSGS0",15,0)
EN5 ;
"RTN","PSGS0",16,0)
 S PSGST=$P($G(^PS(55,DA(1),5,DA,0)),"^",7)
"RTN","PSGS0",17,0)
 ;
"RTN","PSGS0",18,0)
EN ; validate
"RTN","PSGS0",19,0)
 K PSGS0Y
"RTN","PSGS0",20,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X)>70)!($L(X)<1) K X Q
"RTN","PSGS0",21,0)
 S:X'=" " X=$$TRIM^XLFSTR(X,"R"," ") ;PSJ*5*227 - Prevent schedule crash
"RTN","PSGS0",22,0)
 I X?.E1L.E S X=$$ENLU^PSGMI(X) I '$D(PSGOES) D EN^DDIOL("  ("_X_")")
"RTN","PSGS0",23,0)
 ;
"RTN","PSGS0",24,0)
ENOS ; order set entry
"RTN","PSGS0",25,0)
 N X0,Y0,PSJXI,PSJDIC2,TMPAT
"RTN","PSGS0",26,0)
 I $G(X)="",$G(P(2)),$G(P(3)) S X=$G(P(9))
"RTN","PSGS0",27,0)
 I $G(X)="" Q
"RTN","PSGS0",28,0)
 S PSGXT=$G(PSGS0XT),(PSGS0XT,PSGS0Y,XT,Y,PSJNSS)=""
"RTN","PSGS0",29,0)
 S X0=X I X?2.4N1"-".E!(X?2.4N) D ENCHK S:$D(X) Y=X G Q
"RTN","PSGS0",30,0)
 ; * GUI 27 CHANGES * Check for admin times to be derived from 'base' schedule
"RTN","PSGS0",31,0)
 I X["@" S TMPAT=$P(X,"@",2) I TMPAT]"" D
"RTN","PSGS0",32,0)
 .I '$D(^PS(51.1,"AC","PSJ",TMPAT)) K TMPAT Q
"RTN","PSGS0",33,0)
 .I '$$DOW^PSIVUTL($P(X,"@")) K TMPAT Q
"RTN","PSGS0",34,0)
 .N LYN,ZZND,PSGS0XT,PSGS0Y,X S (PSGS0Y,PSGS0XT,X)=""
"RTN","PSGS0",35,0)
 .S X=TMPAT D DIC I $G(Y0)>0 S TMPAT=Y0
"RTN","PSGS0",36,0)
 I $G(TMPAT) S (PSGS0Y,$P(X,"@",2))=TMPAT,PSGS0XT="D"
"RTN","PSGS0",37,0)
 ; * GUI 27 CHANGES *
"RTN","PSGS0",38,0)
 I X["PRN",$$PRNOK(X),'$D(^PS(51.1,"AC","PSJ",X)) D  G Q
"RTN","PSGS0",39,0)
 .;PSJ*5*190 Check for One-time PRN
"RTN","PSGS0",40,0)
 .I $$ONE^PSJBCMA($G(DFN),$G(ON),X)="O" S XT="O" Q
"RTN","PSGS0",41,0)
 .I X["@"!$$DOW^PSIVUTL($P(X," PRN")) N DOW D  I $G(DOW) S (Y0,Y,PSGS0Y)=$P($P(X,"@",2)," ")
"RTN","PSGS0",42,0)
 ..N TMP S TMP=X N X S X=$P(TMP," PRN") D DW I $G(X)]"" S DOW=1
"RTN","PSGS0",43,0)
 ..I $G(DOW),$G(PSGST)]"" I ",P,R,"'[(","_PSGST_",") S (XT,PSGS0XT)="D"
"RTN","PSGS0",44,0)
 D DIC I $G(XT)]""!$G(Y0)!($G(X)]""&$G(PSJXI)) D  Q:'$D(X)  I $G(X)]"",PSGS0XT'="D" G:$D(^PS(51.1,"AC","PSJ",X)) Q3 I $P(X,"@")]"" G:$D(^PS(51.1,"AC","PSJ",$P(X,"@"))) Q3
"RTN","PSGS0",45,0)
 .S PSGS0XT=XT S:$G(Y0) (Y,PSGS0Y)=Y0 S:'PSGS0Y&((PSGS0XT)="D")&(X["@") PSGS0Y=$P(X,"@",2)
"RTN","PSGS0",46,0)
 .S PSGS0Y=$P(PSGS0Y," ")
"RTN","PSGS0",47,0)
 .; If entering from Verify action, and schedule exists in schedule file, and order's schedule is continuous,
"RTN","PSGS0",48,0)
 .; OR the order's schedule type is fill on request and the order's schedule is defined as continuous in schedule file,
"RTN","PSGS0",49,0)
 .; AND the order's schedule is not a PRN schedule, the order must have admin times.
"RTN","PSGS0",50,0)
 .Q:$G(PSGOES)'=2  Q:'$D(^PS(51.1,"AC","PSJ",X))
"RTN","PSGS0",51,0)
 .I $G(PSGST)="C"!($G(PSGST)="R"&($P($G(ZZND),"^",3))) I ($G(PSGST)'="P"),($G(PSGSCH)'[" PRN"),('$G(PSGAT)&'$G(PSGS0Y)),'$$ODD^PSGS0($G(PSGS0XT)) Q:($P($G(ZZND),"^",5)="O")  Q:$$ODD^PSGS0($P(ZZND,"^",3))  K X Q
"RTN","PSGS0",52,0)
 N TMPSCHX S TMPSCHX=X I $L(X,"@")<3 S TMPX=X D DW I $G(X)]"" K PSJNSS S (PSGS0XT,XT)="D" D  G Q
"RTN","PSGS0",53,0)
 .S Y=$S(($G(TMPSCHX)["@"):$P(TMPSCHX,"@",2),1:"")
"RTN","PSGS0",54,0)
 .I Y,(X'["@"),(TMPSCHX["@") S X=TMPSCHX
"RTN","PSGS0",55,0)
 S X=TMPSCHX
"RTN","PSGS0",56,0)
 I X'="" I $D(^PS(51.1,"AC","PSJ",X)) K PSJNSS G Q
"RTN","PSGS0",57,0)
 ;
"RTN","PSGS0",58,0)
NS I ($G(X)="^")!($G(X)="") K X S Y="" Q
"RTN","PSGS0",59,0)
 N NS S NS=0,PSJNSS=0
"RTN","PSGS0",60,0)
 I $G(Y)'>0 S X=X0,Y="",NS=1,PSJNSS=1
"RTN","PSGS0",61,0)
Q ;
"RTN","PSGS0",62,0)
 S PSGS0XT=$S(XT]"":XT,1:$G(PSGS0XT)),PSGS0Y=$S($G(Y):Y,$G(PSGS0Y):PSGS0Y,1:"") S:PSGS0XT<0 PSGS0XT=""
"RTN","PSGS0",63,0)
 I ('$G(PSGS0Y)&'$G(PSJDIC2)&$G(PSGAT))&'$G(PSJNEWOE)&$G(PSGS0XT) I PSGS0XT<1441 I ($L($G(PSGAT),"-")=PSGS0XT/1440)!($G(X)]""&($G(PSGSCH)=$G(X))) S PSGS0Y=$G(PSGAT)
"RTN","PSGS0",64,0)
Q2 K YY
"RTN","PSGS0",65,0)
 I '$G(PSJNSS),'$G(PSGS0Y),$G(YY) S PSGS0Y=YY
"RTN","PSGS0",66,0)
 I $G(X)]"",$$SCHREQ^PSJLIVFD(.P) D
"RTN","PSGS0",67,0)
 .I $$DOW^PSIVUTL(X)!$$PRNOK(X)!$D(^PS(51.1,"AC","PSJ",X)) S PSJNSS=0 Q
"RTN","PSGS0",68,0)
 .I $G(P(2))&$G(P(3)) D NSSCONT(X,PSGS0XT) S TMPX="" K X
"RTN","PSGS0",69,0)
 I ($G(PSJNSS)&($G(VALMBCK)'="Q"))!($G(PSJNSS)&$G(PSJLIFNI))!($G(PSJNSS)&$G(PSJTUD)) D
"RTN","PSGS0",70,0)
 .I $G(P(2))&$G(P(3)) Q
"RTN","PSGS0",71,0)
 .I ($G(X)]"") I ($G(PSGS0XT)'="D") D NSSCONT(X,PSGS0XT) S TMPX="" K X
"RTN","PSGS0",72,0)
Q3 I $G(X)]"" I $D(^PS(51.1,"AC","PSJ",X)) K PSJNSS
"RTN","PSGS0",73,0)
 K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSGS0",74,0)
 ;
"RTN","PSGS0",75,0)
NSSCONT(SCH,FREQ) ;
"RTN","PSGS0",76,0)
 Q:SCH=""!($G(VALMBCK)]"")!$G(PSGMARSD)!$G(PSIVFN1)
"RTN","PSGS0",77,0)
 I $G(PSGOES),'$G(NSFF) Q
"RTN","PSGS0",78,0)
 N PSGS0XT,PSGSCH,DIR,X,Y S PSGSCH=SCH,PSGS0XT=FREQ,PSJNSS=1
"RTN","PSGS0",79,0)
 D NSSMSG I ($L(PSJNSS)>2),'$G(PSJXI) W !!,PSJNSS,! S PSJNSS=1
"RTN","PSGS0",80,0)
 S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSGS0",81,0)
 K NSFF Q
"RTN","PSGS0",82,0)
 ;
"RTN","PSGS0",83,0)
NSSMSG ;
"RTN","PSGS0",84,0)
 Q:$G(PSJXI)
"RTN","PSGS0",85,0)
 I '(",O,"[(","_$G(PSGST)_",")),$G(PSJNSS),$G(PSGSCH)]"" D
"RTN","PSGS0",86,0)
 .S PSJNSS=" WARNING - "_PSGSCH_" is an invalid schedule."
"RTN","PSGS0",87,0)
 S PSGSCH="",PSGS0XT=""
"RTN","PSGS0",88,0)
 Q
"RTN","PSGS0",89,0)
 ;
"RTN","PSGS0",90,0)
NSO(FQ) ;
"RTN","PSGS0",91,0)
 Q:'FQ!(FQ<0)!(",D,O,"[(","_$G(PSGST)_",")) ""
"RTN","PSGS0",92,0)
 K FRQOUT S FRQOUT=$S(FQ<60:(FQ_"minute"),(FQ<1440)&(FQ#60):(FQ_" minute"),(FQ<1440)!(FQ#1440):(FQ/60_" hour"),1:(FQ/1440_" day")) D
"RTN","PSGS0",93,0)
 . S:(+FRQOUT'=1) FRQOUT=FRQOUT_"s"
"RTN","PSGS0",94,0)
 Q FRQOUT
"RTN","PSGS0",95,0)
 ;
"RTN","PSGS0",96,0)
ENCHK ;
"RTN","PSGS0",97,0)
 N H,I
"RTN","PSGS0",98,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSGS0",99,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSGS0",100,0)
 S X(1)=$L(X(1)) I X'["-"&((X>$E(2400,1,X(1))!($E(X,3,4)>59))) K X Q
"RTN","PSGS0",101,0)
 F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$E(2400,1,X(1)):1,$E(X(3),3,4)>59:1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSGS0",102,0)
 Q:'$D(X)
"RTN","PSGS0",103,0)
 F X(2)=1:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $E(X(3),3,4)>59 K X Q
"RTN","PSGS0",104,0)
 Q:'$D(X)
"RTN","PSGS0",105,0)
 S X(1)=$L(X,"-"),X(2)=$G(PSGS0XT),PSGSCH=$S($G(PSGSCH)]"":PSGSCH,1:$G(P(9)))
"RTN","PSGS0",106,0)
 I $G(PSGSCH)="" Q  ;No schedule info, so just validate the numbers and quit.
"RTN","PSGS0",107,0)
 I $D(^PS(51.1,"AC","PSJ",PSGSCH)) S H=+$O(^PS(51.1,"AC","PSJ",PSGSCH,0)) S I=$P($G(^PS(51.1,H,0)),"^",5)
"RTN","PSGS0",108,0)
 I $G(I)="" S I=$S(PSGSCH["PRN":"P",1:"C")
"RTN","PSGS0",109,0)
 I I="D",$L(X,"-")>0 K:$D(X) X(1),X(2),X(3) S I="C" Q  ;DOW schedules require at least one admin time
"RTN","PSGS0",110,0)
 I $G(I)="O" D  Q  ;One Time schedules
"RTN","PSGS0",111,0)
 . I $L(X,"-")>1 K X Q  ;One Time schedules allow one admin time
"RTN","PSGS0",112,0)
 I X(2)="" Q  ;No frequency - cannot validate admin times to frequency
"RTN","PSGS0",113,0)
 I X(2)>1439,$L(X,"-")>1 K X Q  ;PSJ*5*113 Schedules with frequency greater than 1 day can only have one admin time.
"RTN","PSGS0",114,0)
 I X(2)>0,X(2)<1440,X(1)>(1440/X(2)) K X Q  ;PSJ*5*113 Admin times must match frequency or fewer
"RTN","PSGS0",115,0)
 I X(2)>0,X(2)<1440,1440#X(2)'=0,X(1)>0 K X Q  ;PSJ*5*113 Odd schedules cannot have admin times
"RTN","PSGS0",116,0)
 I X(2)>0,X(2)>1440,X(2)#1440'=0,X(1)>1 K X Q  ;PSJ*5*113 Odd schedules cannot have admin times
"RTN","PSGS0",117,0)
 K:$D(X) X(1),X(2),X(3)
"RTN","PSGS0",118,0)
 Q
"RTN","PSGS0",119,0)
 ;
"RTN","PSGS0",120,0)
DIC ; Check for schedule's existence in ADMINISTRATION SCHEDULE file (#51.1)
"RTN","PSGS0",121,0)
 ; Input:    
"RTN","PSGS0",122,0)
 ;           X = Schedule Name
"RTN","PSGS0",123,0)
 ;     PSJSLUP = If $G(PSJSLUP), perform interactive fileman lookup (optional).
"RTN","PSGS0",124,0)
 ;     PSGSFLG = If $G(PSGSFLG), return schedule IEN in PSGSCIEN variable (optional)
"RTN","PSGS0",125,0)
 ;    PSJLIFNI = Flag indicating a U/D order is being finished as an IV (optional).
"RTN","PSGS0",126,0)
 ;      PSGOES = If PSGOES=1, IX^DIC is called silently. If PSGOES=2, IX^DIC is not called (optional).
"RTN","PSGS0",127,0)
 ;      PSJPWD = IEN of Inpatient Ward associated with the patient/order/schedule combination (optional).
"RTN","PSGS0",128,0)
 ; Output:
"RTN","PSGS0",129,0)
 ;           X = Schedule Name if valid Input Schedule X, undefined if invalid Input Schedule X.
"RTN","PSGS0",130,0)
 ;     PSGS0XT = Frequency of validated schedule.
"RTN","PSGS0",131,0)
 ;     PSGS0Y  = Default Admin Times of validated schedule.
"RTN","PSGS0",132,0)
 ;    PSGSCIEN = IEN of validated schedule, if PSGSLFG is passed in and is evaluated to TRUE.
"RTN","PSGS0",133,0)
 ;
"RTN","PSGS0",134,0)
 K Y0,PSJXI N Y,PSGS0ST
"RTN","PSGS0",135,0)
 S Z=0 F PSJXI=0:1 S Z=$O(^PS(51.1,"AC","PSJ",X,Z)) Q:'Z
"RTN","PSGS0",136,0)
 I $G(X)]"",'$G(PSJSLUP) D
"RTN","PSGS0",137,0)
 .I $D(^PS(51.1,"AC","PSJ",X)) D  Q:$G(PSGS0Y)&($G(PSGS0XT)]"")
"RTN","PSGS0",138,0)
 ..I $$DOW^PSIVUTL(X) S PSGS0XT="D",PSJNSS=0 S:X["@" (Y0,PSGS0Y)=$P(X,"@",2) Q
"RTN","PSGS0",139,0)
 ..I $G(NSFF) S Y0=$S($G(PSGS0Y):PSGS0Y,$G(PSGAT)&'$G(PSJNEWOE):PSGAT,1:"") S:Y0 PSGS0Y=Y0
"RTN","PSGS0",140,0)
 .; Check for duplicate schedules - force selection
"RTN","PSGS0",141,0)
 .Q:PSJXI>1&('$G(PSGOES))&($G(PSGS0XT)]"")
"RTN","PSGS0",142,0)
 .I $D(^PS(51.1,"AC","PSJ",X)) N FREQ,ADMATCH S FREQ=$G(PSGS0XT) D
"RTN","PSGS0",143,0)
 ..N PSGS0XT,PSGS0Y,PSGST D ADMIN^PSJORPOE S:$G(PSGS0XT) XT=PSGS0XT S:$G(PSGS0Y) (Y0,Y)=PSGS0Y I $G(PSGST)'="" S PSGS0ST=PSGST
"RTN","PSGS0",144,0)
 ..;Check flag PSGSFLG to determine whether to return the schedule IEN in PSGSCIEN.
"RTN","PSGS0",145,0)
 .S:$G(XT)]"" PSGS0XT=XT S:$G(Y) PSGS0Y=Y
"RTN","PSGS0",146,0)
 .I $$DOW^PSIVUTL(X) S:PSGS0XT="" (XT,PSGS0XT)="D" S:PSGS0Y="" (Y0,PSGS0Y)=$S($P(X,"@",2):$P(X,"@",2),1:"")
"RTN","PSGS0",147,0)
 I $G(PSJLIFNI)!($G(P(4))]""&($G(P(2))]"")) I '$D(^PS(51.1,"AC","PSJ",X))!($G(PSJXI)>1) S PSJSLUP=1
"RTN","PSGS0",148,0)
 I $G(NSFF),$G(PSJXI)>1 D
"RTN","PSGS0",149,0)
 .I $G(PSGS0XT)="",$G(NSFF),$G(PSGXT)]"" S PSGS0XT=PSGXT Q
"RTN","PSGS0",150,0)
 .I $G(PSGS0XT)=""!($G(PSGS0Y)="") S PSJSLUP=1
"RTN","PSGS0",151,0)
 I '$G(PSJSLUP) Q:$G(PSGS0XT)]""&($G(PSGS0Y)]"")  Q:($G(PSGS0XT)="D"&('$D(^PS(51.1,"AC","PSJ",X))))
"RTN","PSGS0",152,0)
 Q:$G(PSGOES)=2
"RTN","PSGS0",153,0)
 Q:$G(PSGS0XT)]""&(PSJXI=1)
"RTN","PSGS0",154,0)
 I $G(PSGS0ST)="O",PSJXI=1 Q  ;one-time order,exact match (PSJ*5*207)
"RTN","PSGS0",155,0)
 K PSJSLUP
"RTN","PSGS0",156,0)
 ;
"RTN","PSGS0",157,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSGOES))_"ISZ",DIC("W")="W ""  "","_$S('$D(PSJPWD):"$P(^(0),""^"",2)",'PSJPWD:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ"
"RTN","PSGS0",158,0)
 S PSJDIC2=1
"RTN","PSGS0",159,0)
 D IX^DIC K DIC S:$D(DIE)#2 DIC=DIE I Y'>0 D  Q
"RTN","PSGS0",160,0)
 .I '$$DOW^PSIVUTL(X),'$$PRNOK(X),'$$ODD($G(PSGS0XT)),'$$ODD($P($G(ZZND),"^",3)),($P($G(ZZND),"^",5)'="O") S X="",PSJNSS=1,XT="",PSJXI=""
"RTN","PSGS0",161,0)
 S XT=$S("C"[$P(Y(0),"^",5):$P(Y(0),"^",3),1:$P(Y(0),"^",5))
"RTN","PSGS0",162,0)
 S X=+Y,Y="" I $D(PSJPWD),$D(^PS(51.1,+X,1,+PSJPWD,0)) S Y=$P(^(0),"^",2)
"RTN","PSGS0",163,0)
 ;Check flag PSGSFLG to determine whether to return the schedule IEN in PSGSCIEN.
"RTN","PSGS0",164,0)
 I $G(PSGSFLG) S PSGSCIEN=X
"RTN","PSGS0",165,0)
 S (X,X0)=Y(0,0) S:$G(Y)="" Y=$P(Y(0),"^",2)
"RTN","PSGS0",166,0)
 S (PSGS0Y,Y0)=$G(Y),Y0(0)=Y(0) I $P(Y(0),"^",3) S XT=$P(Y(0),"^",3)
"RTN","PSGS0",167,0)
 I $G(PSGS0XT)="",$$DOW^PSIVUTL(X) S (XT,PSGS0XT)="D"
"RTN","PSGS0",168,0)
 Q
"RTN","PSGS0",169,0)
 ;
"RTN","PSGS0",170,0)
DW ;
"RTN","PSGS0",171,0)
 N Y
"RTN","PSGS0",172,0)
 Q:($L(X,"@")>2)
"RTN","PSGS0",173,0)
 N AT I X["@" S AT=$P(X,"@",2)
"RTN","PSGS0",174,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) N XABB S XABB=""
"RTN","PSGS0",175,0)
 I X]"" D ENCHK Q:'$D(X)
"RTN","PSGS0",176,0)
 S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-"  ;F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSGS0",177,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSGS0",178,0)
 I $D(X) F II=1:1:$L(X,X(1)) S XABB=$G(XABB)_$E($P(X,X(1),II),1,2)_"-"
"RTN","PSGS0",179,0)
 K X(1) S:$D(X) X=SDW I $G(X)]"" I $TR(XABB,"-")]"" S X=$E($G(XABB),1,$L(XABB)-1)
"RTN","PSGS0",180,0)
 I $G(AT) S PSGS0Y=AT
"RTN","PSGS0",181,0)
 Q
"RTN","PSGS0",182,0)
DWC I $L(Z)<2 K X Q
"RTN","PSGS0",183,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSGS0",184,0)
 E  K X
"RTN","PSGS0",185,0)
 Q
"RTN","PSGS0",186,0)
 ;
"RTN","PSGS0",187,0)
PRNOK(PSCH) ;
"RTN","PSGS0",188,0)
 Q:PSCH'["PRN" 0
"RTN","PSGS0",189,0)
 I $TR(PSCH," ")="PRN" Q 1
"RTN","PSGS0",190,0)
 N BASE,I,OK S OK=0 S I=$P(PSCH," PRN") I I]"",$D(^PS(51.1,"AC","PSJ",I)) S OK=1
"RTN","PSGS0",191,0)
 I 'OK D
"RTN","PSGS0",192,0)
 .I PSCH["@" I $D(^PS(51.1,"AC","PSJ",$P(PSCH,"@")))!$$DOW^PSIVUTL($P(PSCH,"@")) S OK=1 Q
"RTN","PSGS0",193,0)
 .I $$DOW^PSIVUTL($P(PSCH," PRN")) S OK=1
"RTN","PSGS0",194,0)
 Q OK
"RTN","PSGS0",195,0)
ODD(PSF) ;determine if this is an odd schedule
"RTN","PSGS0",196,0)
 I PSF>1439,PSF#1440 Q 1
"RTN","PSGS0",197,0)
 I PSF,PSF<1440,1440#PSF Q 1
"RTN","PSGS0",198,0)
 Q 0
"RTN","PSJDIN")
0^2^B31115413^B30761774
"RTN","PSJDIN",1,0)
PSJDIN ;BIR/MV - National Formulary Indicator Utility ;4 MAR 2000/ 4:27 PM
"RTN","PSJDIN",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**50,56,76,227**;16 DEC 97;Build 1
"RTN","PSJDIN",3,0)
 ;
"RTN","PSJDIN",4,0)
 ; Reference to ^PSSDIN is supported by DBIA# 3166.
"RTN","PSJDIN",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJDIN",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJDIN",7,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJDIN",8,0)
 ; Reference tp ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJDIN",9,0)
 ;
"RTN","PSJDIN",10,0)
DINIV(FIL,DRGTMP)      ;
"RTN","PSJDIN",11,0)
 ;*Find the DD & OI IEN for the additive or solution
"RTN","PSJDIN",12,0)
 ;*FIL:    52.6 or 52.7
"RTN","PSJDIN",13,0)
 ;*DRGTMP: Additive or Solution's IEN
"RTN","PSJDIN",14,0)
 ;
"RTN","PSJDIN",15,0)
 NEW PSJDRG,PSJOI,PSJDD,PSJDIN,PSJINDEX
"RTN","PSJDIN",16,0)
 S PSJDRG=$P(^PS(FIL,+DRGTMP,0),U,2),PSJOI=$P(^PS(FIL,+DRGTMP,0),U,11)
"RTN","PSJDIN",17,0)
 D DIN(PSJOI,PSJDRG)
"RTN","PSJDIN",18,0)
 Q
"RTN","PSJDIN",19,0)
DIN(PSJOI,PSJDRG)       ;
"RTN","PSJDIN",20,0)
 ;*This will issue the Restriction/guideline prompt for both OI & DD
"RTN","PSJDIN",21,0)
 ;*PSJOI:   Orderable Item IEN
"RTN","PSJDIN",22,0)
 ;*PSJDRG:   Dispense drug IEN
"RTN","PSJDIN",23,0)
 ;
"RTN","PSJDIN",24,0)
 NEW PSJDIN,PSJDD,PSJINDEX,Y,X,XIT
"RTN","PSJDIN",25,0)
 D EN^PSSDIN(PSJOI,PSJDRG)
"RTN","PSJDIN",26,0)
 Q:$O(^TMP("PSSDIN",$J,""))=""
"RTN","PSJDIN",27,0)
 S PSJDIN=$$PROMPT^PSSDIN
"RTN","PSJDIN",28,0)
 W:"DOY"[Y @IOF
"RTN","PSJDIN",29,0)
 I PSJDIN="D"!(PSJDIN="Y") D  Q:XIT=U
"RTN","PSJDIN",30,0)
 . W !!,"Dispense Drug Text:" W ! D TXD("DD") W !!
"RTN","PSJDIN",31,0)
 I PSJDIN="O"!(PSJDIN="Y") D
"RTN","PSJDIN",32,0)
 . W !!,"Orderable Item Text:" W ! D TXD("OI") W !!
"RTN","PSJDIN",33,0)
 D PAUSE^VALM1,CLEAR^VALM1
"RTN","PSJDIN",34,0)
 Q
"RTN","PSJDIN",35,0)
TXD(N1) ;
"RTN","PSJDIN",36,0)
 ;N1 = "OI" or "DD"
"RTN","PSJDIN",37,0)
 ;DISPLAY OI/DD DRUG TEXT
"RTN","PSJDIN",38,0)
 N N2,N3,N4,NX S XIT="",NX="PSSDIN"  ;
"RTN","PSJDIN",39,0)
 S N2="" F  S N2=$O(^TMP(NX,$J,N1,N2)) Q:'N2!(XIT=U)  D
"RTN","PSJDIN",40,0)
 .S N3="" F  S N3=$O(^TMP(NX,$J,N1,N2,N3)) Q:'N3!(XIT=U)  D
"RTN","PSJDIN",41,0)
 ..S N4="" F  S N4=$O(^TMP(NX,$J,N1,N2,N3,N4)) Q:'N4!(XIT=U)  D
"RTN","PSJDIN",42,0)
 ...W !?5,^TMP(NX,$J,N1,N2,N3,N4) I $Y>15 W ! D HLD S XIT=X
"RTN","PSJDIN",43,0)
 Q
"RTN","PSJDIN",44,0)
HLD ;
"RTN","PSJDIN",45,0)
 W !
"RTN","PSJDIN",46,0)
 ;K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSJDIN",47,0)
 K DIR
"RTN","PSJDIN",48,0)
 S DIR(0)="E",DIR("A")="Press Return to Continue or ""^"" to Exit: "
"RTN","PSJDIN",49,0)
 D ^DIR K DIR
"RTN","PSJDIN",50,0)
 W @IOF
"RTN","PSJDIN",51,0)
 Q
"RTN","PSJDIN",52,0)
NFIV(FIL,PSJIVIEN,PSJNF)        ;
"RTN","PSJDIN",53,0)
 ;*Return N/F and msg display for ad/sol.
"RTN","PSJDIN",54,0)
 ;*FIL:   "AD" or "SOL"
"RTN","PSJDIN",55,0)
 ;*PSIVIEN: Additive or Solution's IEN
"RTN","PSJDIN",56,0)
 ;*PSJNF:   0 node from file 50
"RTN","PSJDIN",57,0)
 ;*PSJNF("NF"):  Only exist if it is a Non-formulary
"RTN","PSJDIN",58,0)
 ;*PSJNF("MSG"): Return the message field to be displayed /w IV names
"RTN","PSJDIN",59,0)
 ;
"RTN","PSJDIN",60,0)
 S PSJNF=$G(^PSDRUG(+$P($G(^PS(FIL,+PSJIVIEN,0)),U,2),0))
"RTN","PSJDIN",61,0)
 S PSJNF("NF")=$S($P(PSJNF,U,9)=1:" *N/F*",1:"")
"RTN","PSJDIN",62,0)
 S PSJNF("MSG")=$P(PSJNF,U,10)
"RTN","PSJDIN",63,0)
 Q
"RTN","PSJDIN",64,0)
DINFLIV(DRG)   ;
"RTN","PSJDIN",65,0)
 ;*This module will find all drug text that exist for the Orderable 
"RTN","PSJDIN",66,0)
 ;*Items & dispense drugs associated with the Additive(s) & Solution(s)
"RTN","PSJDIN",67,0)
 ;*within the IV order.  Once a drug text exist, return the <DIN> 
"RTN","PSJDIN",68,0)
 ;*indicator to be displayed within the order view.
"RTN","PSJDIN",69,0)
 ;
"RTN","PSJDIN",70,0)
 ;*DRG:  Drug array from the IV order
"RTN","PSJDIN",71,0)
 NEW PSJFIL,PSJND,PSJX,PSJFL
"RTN","PSJDIN",72,0)
 F PSJFIL="AD","SOL" F PSJND=0:0 S PSJND=$O(DRG(PSJFIL,PSJND)) Q:'PSJND!$G(PSJFL)  D
"RTN","PSJDIN",73,0)
 . S PSJX=$G(^PS($S(PSJFIL="AD":52.6,1:52.7),+DRG(PSJFIL,PSJND),0)) D EN^PSSDIN($P(PSJX,U,11),$P(PSJX,U,2))
"RTN","PSJDIN",74,0)
 . I $O(^TMP("PSSDIN",$J,""))]"" S PSJFL=1 Q
"RTN","PSJDIN",75,0)
 I '$G(PSJFL),$G(PSJORD)["P" S PSJFL=$$DINFLUD(+P("PD")),PSJFL=$S(PSJFL]"":1,1:0)
"RTN","PSJDIN",76,0)
 K ^TMP("PSSDIN",$J)
"RTN","PSJDIN",77,0)
 Q $S($G(PSJFL):" <DIN>",1:"")
"RTN","PSJDIN",78,0)
 ;
"RTN","PSJDIN",79,0)
DINFLUD(PSJOI,PSJDDA) ;
"RTN","PSJDIN",80,0)
 ;*This module will find all drug text that exist for the Orderable 
"RTN","PSJDIN",81,0)
 ;*items & dispense drugs associated with the unit dose order.  Once
"RTN","PSJDIN",82,0)
 ;*a drug text exist, return the <DIN> indicator to be displayed with
"RTN","PSJDIN",83,0)
 ;*the order view.
"RTN","PSJDIN",84,0)
 ;*PSJOI:  Orderable IEN (Require)
"RTN","PSJDIN",85,0)
 ;*PSJDDA: Dispense drug array within the order (Optional)
"RTN","PSJDIN",86,0)
 ;
"RTN","PSJDIN",87,0)
 NEW PSJFL,PSJDD
"RTN","PSJDIN",88,0)
 D EN^PSSDIN(PSJOI) I $O(^TMP("PSSDIN",$J,"OI",0)) K ^TMP("PSSDIN",$J) Q "<DIN>"
"RTN","PSJDIN",89,0)
 F PSJDD=0:0 S PSJDD=$O(PSJDDA(PSJDD)) Q:'PSJDD  D
"RTN","PSJDIN",90,0)
 . D EN^PSSDIN(,PSJDD) I $O(^TMP("PSSDIN",$J,"DD",0)) S PSJFL=1 Q
"RTN","PSJDIN",91,0)
 K ^TMP("PSSDIN",$J)
"RTN","PSJDIN",92,0)
 Q $S($G(PSJFL):"<DIN>",1:"")
"RTN","PSJDIN",93,0)
 ;
"RTN","PSJDIN",94,0)
DINHIDE(PSJDFN,PSJORD) ;
"RTN","PSJDIN",95,0)
 ;*Display drug text from the hidden action. 
"RTN","PSJDIN",96,0)
 ;*PSJDFN: Patient IEN (Require)
"RTN","PSJDIN",97,0)
 ;*PSJORD: Order #_"UVP" (Required)
"RTN","PSJDIN",98,0)
 ;*DRG:    IV DRG array (Required for IV but Optional for UD orders)
"RTN","PSJDIN",99,0)
 ;
"RTN","PSJDIN",100,0)
 D:PSJORD["V" IV
"RTN","PSJDIN",101,0)
 D:PSJORD["U" UD
"RTN","PSJDIN",102,0)
 I PSJORD["P" D
"RTN","PSJDIN",103,0)
 . D @($S($P(^PS(53.1,+PSJORD,0),U,4)="U":"UD",1:"IV"))  ;PSJ*5*227 - Unit Dose DIN fix
"RTN","PSJDIN",104,0)
 I PSJORD="" D NEWUD
"RTN","PSJDIN",105,0)
 K ^TMP("PSSDIN",$J)
"RTN","PSJDIN",106,0)
 Q
"RTN","PSJDIN",107,0)
IV ;
"RTN","PSJDIN",108,0)
 ;NEW DRG,DRGI,DRGT,ND,ON55,Y
"RTN","PSJDIN",109,0)
 ;D:PSJORD["P" GT531^PSIVORFA(DFN,PSJORD)
"RTN","PSJDIN",110,0)
 ;I PSJORD["V" S ON55=PSJORD D GTDRG^PSIVORFB
"RTN","PSJDIN",111,0)
 ;*Loop thru IV DRG array to find OI & DD IEN from each AD & SOL.
"RTN","PSJDIN",112,0)
 ;
"RTN","PSJDIN",113,0)
 NEW FIL,NAME,PSJDD,PSJNF,PSJOI,PSJX,Y,X,PSJXY
"RTN","PSJDIN",114,0)
 D FULL^VALM1 W @IOF
"RTN","PSJDIN",115,0)
 W !,"Drug restriction/guideline info:"
"RTN","PSJDIN",116,0)
 F FIL="AD","SOL" F PSJX=0:0 S PSJX=$O(DRG(FIL,PSJX)) Q:'PSJX  D
"RTN","PSJDIN",117,0)
 . NEW X
"RTN","PSJDIN",118,0)
 . S PSJXY=1
"RTN","PSJDIN",119,0)
 . SET NAME=$P(DRG(FIL,PSJX),U,2)
"RTN","PSJDIN",120,0)
 . W !!,"IV "_$S(FIL="AD":"Additive",1:"Solution")_": "_NAME
"RTN","PSJDIN",121,0)
 . D NFIV(FIL,+PSJX,.PSJNF) W $G(PSJNF("NF")),!
"RTN","PSJDIN",122,0)
 . S X=$S(FIL="AD":$G(^PS(52.6,+DRG(FIL,PSJX),0)),1:$G(^PS(52.7,+DRG(FIL,PSJX),0)))
"RTN","PSJDIN",123,0)
 . S PSJOI=$P(X,U,11),PSJDD=$P(X,U,2) D EN^PSSDIN(+PSJOI,+PSJDD)
"RTN","PSJDIN",124,0)
 . D DINOI(PSJOI,3)
"RTN","PSJDIN",125,0)
 . D DINDD(PSJDD,3)
"RTN","PSJDIN",126,0)
 D:'$G(PSJXY) HLD
"RTN","PSJDIN",127,0)
 K ^TMP("PSSDIN",$J)
"RTN","PSJDIN",128,0)
 Q
"RTN","PSJDIN",129,0)
UD ;
"RTN","PSJDIN",130,0)
 ;*Loop thru Unit dose order for Orderable Item & Dispense drug
"RTN","PSJDIN",131,0)
 ;
"RTN","PSJDIN",132,0)
 NEW F,PSJDD,PSJDDX,PSJOI,PSJXY
"RTN","PSJDIN",133,0)
 D FULL^VALM1 W @IOF
"RTN","PSJDIN",134,0)
 W !,"Drug restriction/guideline info:"
"RTN","PSJDIN",135,0)
 S F=$S(PSJORD["U":"^PS(55,PSJDFN,5,+PSJORD,",1:"^PS(53.1,+PSJORD,")
"RTN","PSJDIN",136,0)
 S PSJOI=+@(F_".2)") D EN^PSSDIN(PSJOI),DINOI(PSJOI,3)
"RTN","PSJDIN",137,0)
 ;*Loop thru dispense drug array
"RTN","PSJDIN",138,0)
 F PSJDDX=0:0 S PSJDDX=$O(@(F_"1,"_PSJDDX_")")) Q:'PSJDDX  D
"RTN","PSJDIN",139,0)
 . S PSJXY=1
"RTN","PSJDIN",140,0)
 . S PSJDD=+@(F_"1,"_PSJDDX_",0)")
"RTN","PSJDIN",141,0)
 . D EN^PSSDIN(PSJOI,PSJDD)
"RTN","PSJDIN",142,0)
 . D DINDD(PSJDD,3)
"RTN","PSJDIN",143,0)
 D:'$G(PSJXY) HLD
"RTN","PSJDIN",144,0)
 K ^TMP("PSSDIN",$J)
"RTN","PSJDIN",145,0)
 Q
"RTN","PSJDIN",146,0)
NEWUD ;*New backdoor order doesn't have an order# yet.
"RTN","PSJDIN",147,0)
 ;*Loop thru Orderable Item & Dispense drug
"RTN","PSJDIN",148,0)
 ;
"RTN","PSJDIN",149,0)
 NEW F,PSJDD,PSJDDX,PSJOI,PSJXY
"RTN","PSJDIN",150,0)
 D FULL^VALM1 W @IOF
"RTN","PSJDIN",151,0)
 W !,"Drug restriction/guideline info:"
"RTN","PSJDIN",152,0)
 S PSJOI=+$G(PSGPD) D EN^PSSDIN(PSJOI),DINOI(PSJOI,3)
"RTN","PSJDIN",153,0)
 ;*Loop thru dispense drug array
"RTN","PSJDIN",154,0)
 F PSJDDX=0:0 S PSJDDX=$O(^PS(53.45,PSJSYSP,2,PSJDDX)) Q:'PSJDDX  D
"RTN","PSJDIN",155,0)
 . S PSJXY=1
"RTN","PSJDIN",156,0)
 . S PSJDD=+$G(^PS(53.45,PSJSYSP,2,PSJDDX,0))
"RTN","PSJDIN",157,0)
 . D EN^PSSDIN(PSJOI,PSJDD)
"RTN","PSJDIN",158,0)
 . D DINDD(PSJDD,3)
"RTN","PSJDIN",159,0)
 D:'$G(PSJXY) HLD
"RTN","PSJDIN",160,0)
 K ^TMP("PSSDIN",$J)
"RTN","PSJDIN",161,0)
 Q
"RTN","PSJDIN",162,0)
DINOI(PSJOI,COL)    ;
"RTN","PSJDIN",163,0)
 ;*Display drug text for Orderable Item
"RTN","PSJDIN",164,0)
 ;*OI:   Orderable Item IEN
"RTN","PSJDIN",165,0)
 ;*COl:  Column to display the text in
"RTN","PSJDIN",166,0)
 ;
"RTN","PSJDIN",167,0)
 NEW X,XX
"RTN","PSJDIN",168,0)
 W !!,?COL,"Orderable Item: "_$$OINAME^PSJLMUTL(PSJOI)_$$OINF(PSJOI),!
"RTN","PSJDIN",169,0)
 I '$O(^TMP("PSSDIN",$J,"OI",PSJOI,0)) W !,?10,"No information available",! Q
"RTN","PSJDIN",170,0)
 D TXD("OI") W !
"RTN","PSJDIN",171,0)
 Q
"RTN","PSJDIN",172,0)
DINDD(PSJDD,COL)        ;
"RTN","PSJDIN",173,0)
 ;*Display drug text for Dispense drug
"RTN","PSJDIN",174,0)
 ;*PSJDD:  Dispense drug IEN
"RTN","PSJDIN",175,0)
 ;*COL:    Column to display the text in
"RTN","PSJDIN",176,0)
 ;
"RTN","PSJDIN",177,0)
 NEW X
"RTN","PSJDIN",178,0)
 W !,?COL,"Dispense drug: "_$$DDNAME^PSJLMUTL(+PSJDD)_$$DDNF(PSJDD),!
"RTN","PSJDIN",179,0)
 I '$O(^TMP("PSSDIN",$J,"DD",PSJDD,0)) W !?10,"No information available",! D HLD Q
"RTN","PSJDIN",180,0)
 D TXD("DD"),HLD W @IOF
"RTN","PSJDIN",181,0)
 Q
"RTN","PSJDIN",182,0)
OINF(PSJOI)        ;
"RTN","PSJDIN",183,0)
 ;*Return *N/F* if the orderable item is Non-formulary
"RTN","PSJDIN",184,0)
 ;*PSJOI: Orderable item IEN
"RTN","PSJDIN",185,0)
 ;
"RTN","PSJDIN",186,0)
 Q $S($P($G(^PS(50.7,+PSJOI,0)),U,12)=1:" *N/F*",1:"")
"RTN","PSJDIN",187,0)
 ;
"RTN","PSJDIN",188,0)
DDNF(PSJDD)     ;
"RTN","PSJDIN",189,0)
 ;**Return *N/F* if the dispense drug is Non-formulary
"RTN","PSJDIN",190,0)
 ;*PSJDD: Dispense drug IEN
"RTN","PSJDIN",191,0)
 ;
"RTN","PSJDIN",192,0)
 Q $S($P($G(^PSDRUG(+PSJDD,0)),U,9)=1:" *N/F*",1:"")
"RTN","PSJDIN",193,0)
        
"RTN","PSJDIN",194,0)
  
"RTN","PSJDIN",195,0)
   
"RTN","PSJDIN",196,0)
       
"RTN","PSJDIN",197,0)
  
"RTN","PSJDIN",198,0)
         
"VER")
8.0^22.0
"BLD",8640,6)
^222
**END**
**END**
