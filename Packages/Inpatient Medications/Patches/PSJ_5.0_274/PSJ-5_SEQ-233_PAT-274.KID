Released PSJ*5*274 SEQ #233
Extracted from mail message
**KIDS**:PSJ*5.0*274^

**INSTALL NAME**
PSJ*5.0*274
"BLD",8730,0)
PSJ*5.0*274^INPATIENT MEDICATIONS^0^3120215^y
"BLD",8730,1,0)
^^4^4^3120215^
"BLD",8730,1,1,0)
This patch will resolve the following issue in the Inpatient Medications 
"BLD",8730,1,2,0)
package:
"BLD",8730,1,3,0)
 
"BLD",8730,1,4,0)
-Undefined error from surgery package auto-discontinue
"BLD",8730,4,0)
^9.64PA^^
"BLD",8730,6.3)
2
"BLD",8730,"KRN",0)
^9.67PA^779.2^20
"BLD",8730,"KRN",.4,0)
.4
"BLD",8730,"KRN",.401,0)
.401
"BLD",8730,"KRN",.402,0)
.402
"BLD",8730,"KRN",.403,0)
.403
"BLD",8730,"KRN",.5,0)
.5
"BLD",8730,"KRN",.84,0)
.84
"BLD",8730,"KRN",3.6,0)
3.6
"BLD",8730,"KRN",3.8,0)
3.8
"BLD",8730,"KRN",9.2,0)
9.2
"BLD",8730,"KRN",9.8,0)
9.8
"BLD",8730,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8730,"KRN",9.8,"NM",1,0)
PSJADT0^^0^B33182966
"BLD",8730,"KRN",9.8,"NM","B","PSJADT0",1)

"BLD",8730,"KRN",19,0)
19
"BLD",8730,"KRN",19.1,0)
19.1
"BLD",8730,"KRN",101,0)
101
"BLD",8730,"KRN",409.61,0)
409.61
"BLD",8730,"KRN",771,0)
771
"BLD",8730,"KRN",779.2,0)
779.2
"BLD",8730,"KRN",870,0)
870
"BLD",8730,"KRN",8989.51,0)
8989.51
"BLD",8730,"KRN",8989.52,0)
8989.52
"BLD",8730,"KRN",8994,0)
8994
"BLD",8730,"KRN","B",.4,.4)

"BLD",8730,"KRN","B",.401,.401)

"BLD",8730,"KRN","B",.402,.402)

"BLD",8730,"KRN","B",.403,.403)

"BLD",8730,"KRN","B",.5,.5)

"BLD",8730,"KRN","B",.84,.84)

"BLD",8730,"KRN","B",3.6,3.6)

"BLD",8730,"KRN","B",3.8,3.8)

"BLD",8730,"KRN","B",9.2,9.2)

"BLD",8730,"KRN","B",9.8,9.8)

"BLD",8730,"KRN","B",19,19)

"BLD",8730,"KRN","B",19.1,19.1)

"BLD",8730,"KRN","B",101,101)

"BLD",8730,"KRN","B",409.61,409.61)

"BLD",8730,"KRN","B",771,771)

"BLD",8730,"KRN","B",779.2,779.2)

"BLD",8730,"KRN","B",870,870)

"BLD",8730,"KRN","B",8989.51,8989.51)

"BLD",8730,"KRN","B",8989.52,8989.52)

"BLD",8730,"KRN","B",8994,8994)

"BLD",8730,"QUES",0)
^9.62^^
"BLD",8730,"REQB",0)
^9.611^1^1
"BLD",8730,"REQB",1,0)
PSJ*5.0*181^2
"BLD",8730,"REQB","B","PSJ*5.0*181",1)

"MBREQ")
0
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
274^3120215
"PKG",221,22,1,"PAH",1,1,0)
^^4^4^3120215
"PKG",221,22,1,"PAH",1,1,1,0)
This patch will resolve the following issue in the Inpatient Medications 
"PKG",221,22,1,"PAH",1,1,2,0)
package:
"PKG",221,22,1,"PAH",1,1,3,0)
 
"PKG",221,22,1,"PAH",1,1,4,0)
-Undefined error from surgery package auto-discontinue
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJADT0")
0^1^B33182966^B33159772
"RTN","PSJADT0",1,0)
PSJADT0 ;BIR/CML3,PR,MLM-AUTO DC/HOLD CANCEL ;11 Aug 98 / 8:25 AM
"RTN","PSJADT0",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**17,111,112,135,181,274**;16 DEC 97;Build 2
"RTN","PSJADT0",3,0)
 ;
"RTN","PSJADT0",4,0)
 ;Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJADT0",5,0)
 ;
"RTN","PSJADT0",6,0)
ENDC ; dc active orders first, then non-verified orders
"RTN","PSJADT0",7,0)
 W:'$D(PSJQUIET)&'$D(DGQUIET) !,"...discontinuing Inpatient Medication orders..."
"RTN","PSJADT0",8,0)
 S $P(PSJPIND,"^")=""
"RTN","PSJADT0",9,0)
 D NOW^%DTC N PSJDCDT S (PSJDCDT,PSGDT)=+%,PSJSYSW0="" I PSJFW S PSJSYSW=$O(^PS(59.6,"B",PSJFW,0)) S:PSJSYSW PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJADT0",10,0)
 I PSGALO=1010!(PSGALO=1030)!(PSGALO=1050) D AUDDD
"RTN","PSJADT0",11,0)
 D ENUNM^PSGOU S PSGALR=10,DIE="^PS(55,"_PSGP_",5," S:PSJFW PSGTOL=1,PSGUOW=PSJFW,PSGTOO=1
"RTN","PSJADT0",12,0)
 F PSJS=PSGDT:0 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJS)) Q:'PSJS  F PSJDA=0:0 S PSJDA=$O(^PS(55,PSGP,5,"AUS",PSJS,PSJDA)) Q:'PSJDA  D
"RTN","PSJADT0",13,0)
 .Q:'$$DCIMO(PSGP,PSJDA,"U") 
"RTN","PSJADT0",14,0)
 .;first naked reference below refers to the full global reference to the right of the = sign (inside the $S)
"RTN","PSJADT0",15,0)
 .K DA S DA(1)=PSGP,DA=PSJDA,PSGAL("C")=0,$P(^(2),"^",3)=$S($D(^PS(55,PSGP,5,DA,2)):$P(^(2),"^",4),1:"")
"RTN","PSJADT0",16,0)
 .D ^PSGAL5
"RTN","PSJADT0",17,0)
 .K TMP
"RTN","PSJADT0",18,0)
 .S TMP(55.06,""_PSJDA_","_PSGP_","_"",28)="D"
"RTN","PSJADT0",19,0)
 .S TMP(55.06,""_PSJDA_","_PSGP_","_"",136)=$S(PSGALO=1010:"DD",1:"DA")
"RTN","PSJADT0",20,0)
 .D FILE^DIE("","TMP")
"RTN","PSJADT0",21,0)
 .K TMP
"RTN","PSJADT0",22,0)
 .S TMP(55.06,""_PSJDA_","_PSGP_","_"",34)=PSJDCDT
"RTN","PSJADT0",23,0)
 .S TMP(55.06,""_PSJDA_","_PSGP_","_"",49)=1
"RTN","PSJADT0",24,0)
 .D FILE^DIE("","TMP")
"RTN","PSJADT0",25,0)
 .K TMP
"RTN","PSJADT0",26,0)
 .D EN1^PSJHL2(PSGP,"OD",PSJDA_"U","AUTO DC")
"RTN","PSJADT0",27,0)
 .I PSGALO'=1050 S DA=PSJDA,^PS(55,"AUE",PSGP,DA)="" I $P(PSJSYSW0,"^",15),(PSGALO'<1060) S $P(^PS(55,PSGP,5,PSJDA,7),"^",1,2)=PSJDCDT_"^D" D ENL^PSGVDS
"RTN","PSJADT0",28,0)
 S PSGTOO=2 F PSJDA=0:0 S PSJDA=$O(^PS(53.1,"AC",PSGP,PSJDA)) Q:'PSJDA  D
"RTN","PSJADT0",29,0)
 .Q:'$$DCIMO(PSGP,PSJDA,"P")
"RTN","PSJADT0",30,0)
 .I PSGALO'<1060,$P(PSJSYSW0,U,15),$P($G(^PS(53.1,PSJDA,0)),U,9)="N" K DA D ENLBL^PSIVOPT(PSGTOL,PSGUOW,DFN,2,+PSJDA,"AD")
"RTN","PSJADT0",31,0)
 .K DA S DA=PSJDA D  I $P($G(^PS(53.1,DA,0)),"^",21) D EN1^PSJHL2(PSGP,"OC",PSJDA_"P","AUTO DC")
"RTN","PSJADT0",32,0)
 ..K TMP
"RTN","PSJADT0",33,0)
 ..S TMP(53.1,""_PSJDA_","_"",28)="D"
"RTN","PSJADT0",34,0)
 ..S TMP(53.1,""_PSJDA_","_"",42)=1
"RTN","PSJADT0",35,0)
 ..D FILE^DIE("","TMP")
"RTN","PSJADT0",36,0)
 ..K TMP
"RTN","PSJADT0",37,0)
 ;
"RTN","PSJADT0",38,0)
ENIV ;
"RTN","PSJADT0",39,0)
 S DFN=PSGP F PSJIVON=0:0 S PSJIVON=$O(^PS(55,DFN,"IV",PSJIVON)) Q:'PSJIVON  S Y=$G(^(PSJIVON,0)) I "PDEN"'[$P(Y,U,17) S P(17)=$P(Y,U,17),P(3)=$P(Y,U,3) D DC
"RTN","PSJADT0",40,0)
 Q
"RTN","PSJADT0",41,0)
DC ;
"RTN","PSJADT0",42,0)
 Q:'$$DCIMO(DFN,PSJIVON,"V")
"RTN","PSJADT0",43,0)
 S (ON,ON55)=PSJIVON_"V" D NOW^%DTC I P(17)="H",P(3)<% D  D EXPIR^PSIVOE Q
"RTN","PSJADT0",44,0)
 .K TMP
"RTN","PSJADT0",45,0)
 .S TMP(55.01,""_+ON_","_DFN_","_"",100)="E"
"RTN","PSJADT0",46,0)
 .D FILE^DIE("","TMP")
"RTN","PSJADT0",47,0)
 .K TMP
"RTN","PSJADT0",48,0)
 K PSIVALT S PSIVAC="AD",PSIVALCK="STOP",PSIVREA="D",PSIVAL=$S('+$G(PSGALO):$G(PSIVRES),1:$P($G(^PS(53.3,+PSGALO,0)),U)) D D1^PSIVOPT2,LOG^PSIVORAL
"RTN","PSJADT0",49,0)
 K TMP
"RTN","PSJADT0",50,0)
 S TMP(55.01,""_+ON_","_DFN_","_"",157)=$S($G(PSGALO)=1010:"DD",1:"DA")
"RTN","PSJADT0",51,0)
 S TMP(55.01,""_+ON_","_DFN_","_"",.03)=PSJDCDT
"RTN","PSJADT0",52,0)
 S TMP(55.01,""_+ON_","_DFN_","_"",121)=1
"RTN","PSJADT0",53,0)
 D FILE^DIE("","TMP")
"RTN","PSJADT0",54,0)
 K TMP
"RTN","PSJADT0",55,0)
 D EN1^PSJHL2(DFN,"OD",+ON_"V","AUTO DC")
"RTN","PSJADT0",56,0)
 S PSJIVDCF=1
"RTN","PSJADT0",57,0)
 Q
"RTN","PSJADT0",58,0)
 ;
"RTN","PSJADT0",59,0)
SIVDIE ; Setup DIE,DA for IV
"RTN","PSJADT0",60,0)
 K DA,DIE,DR S DA=+ON,DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"","
"RTN","PSJADT0",61,0)
 Q
"RTN","PSJADT0",62,0)
 ;
"RTN","PSJADT0",63,0)
AUDDD ; set up orders for discharge report and purging
"RTN","PSJADT0",64,0)
 S DIS=+VAIP(17,1) I $S('DIS:1,1:$D(^PS(55,"AUDDD",DIS,PSGP))) Q
"RTN","PSJADT0",65,0)
 S X=$$EN^PSGCT(+VAIP(13,1),-1)
"RTN","PSJADT0",66,0)
 F Q=X:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q  F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $S($D(^PS(55,PSGP,5,QQ,0)):'$P(^(0),"^",20),1:1) S $P(^(0),"^",20)=DIS,^PS(55,"AUDDD",DIS,PSGP,QQ)=""
"RTN","PSJADT0",67,0)
 Q
"RTN","PSJADT0",68,0)
 ;
"RTN","PSJADT0",69,0)
ENHE ; status from hold to expired
"RTN","PSJADT0",70,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),DIE="^PS(55,"_PSGP_",5,"
"RTN","PSJADT0",71,0)
 F PSJS=+PSJPAD:0 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJS)) Q:'PSJS  Q:PSJS>PSGDT  F PSJDA=0:0 S PSJDA=$O(^PS(55,PSGP,5,"AUS",PSJS,PSJDA)) Q:'PSJDA  K DA S DA(1)=PSGP,DA=PSJDA I $D(^PS(55,PSGP,5,DA,0)),$P(^(0),"^",9)="H" S DR="28////E" D ^DIE
"RTN","PSJADT0",72,0)
 Q
"RTN","PSJADT0",73,0)
 ;
"RTN","PSJADT0",74,0)
ENUNDC(PSJDCDT,PSGP,PSJUOW,PSGALO) ; Auto-reinstate orders DC'ed due to a patient movement.
"RTN","PSJADT0",75,0)
 N PSJSYSW0 D NOW^%DTC S PSJUNDC=1,PSGDT=%,PSJFIRST='$D(PSJQUIET),PSJSYSW0=$G(^PS(59.6,+$O(^PS(59.6,"B",+PSJUOW,0)),0))
"RTN","PSJADT0",76,0)
 S PSJS=$O(^PS(55,PSGP,5,"AUS",PSJDCDT-.0002)) F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,5,"AUS",+PSJS,PSGORD)) Q:'PSGORD  D
"RTN","PSJADT0",77,0)
 .I $P($G(^PS(55,PSGP,5,PSGORD,0)),U,9)["D",$P($G(^(4)),U,11) D DISREIN,ENRI^PSGOERI
"RTN","PSJADT0",78,0)
 .S ^PS(55,"AUE",PSGP,PSGORD)=""
"RTN","PSJADT0",79,0)
 ;
"RTN","PSJADT0",80,0)
 S:PSJS="" PSJS=$O(^PS(55,PSGP,"IV","AIS",PSJDCDT-.0002))
"RTN","PSJADT0",81,0)
 F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,"IV","AIS",+PSJS,PSGORD)) Q:'PSGORD  D
"RTN","PSJADT0",82,0)
 .I $P($G(^PS(55,PSGP,"IV",PSGORD,0)),U,12),$P($G(^(2)),U,7)>PSGDT S P(3)=$P($G(^(0)),U,3) D DISREIN,ENARI^PSIVOPT(PSGP,PSGORD,+PSJUOW,PSGALO)
"RTN","PSJADT0",83,0)
 I $D(^TMP("PSJUNDC")) S ^TMP("PSJUNDC",$J,DFN)=$P(^DPT(DFN,0),"^")_"^"_$G(^DPT(PSGP,.1))_"^"_PSGALO D ^PSJADT2
"RTN","PSJADT0",84,0)
 ;
"RTN","PSJADT0",85,0)
ENKL ;
"RTN","PSJADT0",86,0)
 F UW=0:0 S UW=$O(^PS(53.41,1,1,UW)) Q:'UW  D  I '$O(^PS(53.41,1,1,0)) K DA S DA=1,DIK="^PS(53.41," D ^DIK
"RTN","PSJADT0",87,0)
 .F PSGP=0:0 S PSGP=$O(^PS(53.41,1,1,UW,1,PSGP)) Q:'PSGP  D  I '$O(^PS(53.41,1,1,UW,1,0)) K DA S DIK="^PS(53.41,1,1,",DA(1)=1,DA=UW D ^DIK
"RTN","PSJADT0",88,0)
 ..F TO=0:0 S TO=$O(^PS(53.41,1,1,UW,1,PSGP,1,TO)) Q:'TO  D  I '$O(^PS(53.41,1,1,UW,1,PSGP,1,0)) K DA S DA(2)=1,DA(1)=UW,DA=PSGP,DIK="^PS(53.41,1,1,"_UW_",1," D ^DIK
"RTN","PSJADT0",89,0)
 ...I '$O(^PS(53.41,1,1,UW,1,PSGP,1,TO,1,0))  K DA S DA(3)=1,DA(2)=UW,DA(1)=PSGP,DA=TO,DIK="^PS(53.41,1,1,"_UW_",1,"_PSGP_",1," D ^DIK
"RTN","PSJADT0",90,0)
 K DA,DIK,P,PSGDT,PSGP,PSGORD,PSJS,PSJUNDC,TO,UW
"RTN","PSJADT0",91,0)
 Q
"RTN","PSJADT0",92,0)
 ;
"RTN","PSJADT0",93,0)
DISREIN ; Display reinstate msg. for first order.
"RTN","PSJADT0",94,0)
 W:PSJFIRST&'$D(DGQUIET) !,"...reinstating Inpatient Medication orders..." S PSJFIRST=0
"RTN","PSJADT0",95,0)
 Q
"RTN","PSJADT0",96,0)
 ;
"RTN","PSJADT0",97,0)
DCIMO(DFN,ON,TYP) ; Check parameter before DC'ing clinic order
"RTN","PSJADT0",98,0)
 N GLO,IMOND,A,CLINIC,APPT,B,C S GLO=$S(TYP="P":"^PS(53.1,",TYP="U":"^PS(55,"_DFN_",5,",TYP="V":"^PS(55,"_PSGP_",""IV"",",1:"") I TYP="" Q 1
"RTN","PSJADT0",99,0)
 S IMOND=$S(TYP="P"!(TYP="V"):"""DSS""",TYP="U":8,1:"") I IMOND="" Q 1
"RTN","PSJADT0",100,0)
 S GLO=GLO_+ON_","_IMOND_")",A=$G(@GLO),CLINIC=$P(A,"^"),APPT=$P(A,"^",2)
"RTN","PSJADT0",101,0)
 Q:'$$CLINIC^PSJBCMA(A) 1
"RTN","PSJADT0",102,0)
 I '$D(^PS(53.46,"B",CLINIC)) Q 1
"RTN","PSJADT0",103,0)
 S B=$O(^PS(53.46,"B",CLINIC,"")),C=+$P(^PS(53.46,B,0),"^",3) Q C
"VER")
8.0^22.0
"BLD",8730,6)
^233
**END**
**END**
