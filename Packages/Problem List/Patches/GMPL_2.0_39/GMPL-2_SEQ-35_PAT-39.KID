Released GMPL*2*39 SEQ #35
Extracted from mail message
**KIDS**:GMPL*2.0*39^

**INSTALL NAME**
GMPL*2.0*39
"BLD",8035,0)
GMPL*2.0*39^PROBLEM LIST^0^3110614^y
"BLD",8035,1,0)
^^1^1^3100521^
"BLD",8035,1,1,0)
FIX FOR UNDEFINED VARIABLE ERROR IN GMPLUTL1
"BLD",8035,4,0)
^9.64PA^^
"BLD",8035,6)
4^
"BLD",8035,6.3)
7
"BLD",8035,"ABPKG")
n
"BLD",8035,"KRN",0)
^9.67PA^779.2^20
"BLD",8035,"KRN",.4,0)
.4
"BLD",8035,"KRN",.401,0)
.401
"BLD",8035,"KRN",.402,0)
.402
"BLD",8035,"KRN",.403,0)
.403
"BLD",8035,"KRN",.5,0)
.5
"BLD",8035,"KRN",.84,0)
.84
"BLD",8035,"KRN",3.6,0)
3.6
"BLD",8035,"KRN",3.8,0)
3.8
"BLD",8035,"KRN",9.2,0)
9.2
"BLD",8035,"KRN",9.8,0)
9.8
"BLD",8035,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",8035,"KRN",9.8,"NM",1,0)
GMPLUTL^^0^B40762056
"BLD",8035,"KRN",9.8,"NM",2,0)
GMPLUTL1^^0^B25149940
"BLD",8035,"KRN",9.8,"NM","B","GMPLUTL",1)

"BLD",8035,"KRN",9.8,"NM","B","GMPLUTL1",2)

"BLD",8035,"KRN",19,0)
19
"BLD",8035,"KRN",19.1,0)
19.1
"BLD",8035,"KRN",101,0)
101
"BLD",8035,"KRN",409.61,0)
409.61
"BLD",8035,"KRN",771,0)
771
"BLD",8035,"KRN",779.2,0)
779.2
"BLD",8035,"KRN",870,0)
870
"BLD",8035,"KRN",8989.51,0)
8989.51
"BLD",8035,"KRN",8989.52,0)
8989.52
"BLD",8035,"KRN",8994,0)
8994
"BLD",8035,"KRN","B",.4,.4)

"BLD",8035,"KRN","B",.401,.401)

"BLD",8035,"KRN","B",.402,.402)

"BLD",8035,"KRN","B",.403,.403)

"BLD",8035,"KRN","B",.5,.5)

"BLD",8035,"KRN","B",.84,.84)

"BLD",8035,"KRN","B",3.6,3.6)

"BLD",8035,"KRN","B",3.8,3.8)

"BLD",8035,"KRN","B",9.2,9.2)

"BLD",8035,"KRN","B",9.8,9.8)

"BLD",8035,"KRN","B",19,19)

"BLD",8035,"KRN","B",19.1,19.1)

"BLD",8035,"KRN","B",101,101)

"BLD",8035,"KRN","B",409.61,409.61)

"BLD",8035,"KRN","B",771,771)

"BLD",8035,"KRN","B",779.2,779.2)

"BLD",8035,"KRN","B",870,870)

"BLD",8035,"KRN","B",8989.51,8989.51)

"BLD",8035,"KRN","B",8989.52,8989.52)

"BLD",8035,"KRN","B",8994,8994)

"BLD",8035,"QUES",0)
^9.62^^
"BLD",8035,"REQB",0)
^9.611^1^1
"BLD",8035,"REQB",1,0)
GMPL*2.0*35^2
"BLD",8035,"REQB","B","GMPL*2.0*35",1)

"MBREQ")
0
"PKG",394,-1)
1^1
"PKG",394,0)
PROBLEM LIST^GMPL^Automated Patient Problem List
"PKG",394,20,0)
^9.402P^^
"PKG",394,22,0)
^9.49I^1^1
"PKG",394,22,1,0)
2.0^2940825^2950304
"PKG",394,22,1,"PAH",1,0)
39^3110614^33253
"PKG",394,22,1,"PAH",1,1,0)
^^1^1^3110614
"PKG",394,22,1,"PAH",1,1,1,0)
FIX FOR UNDEFINED VARIABLE ERROR IN GMPLUTL1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMPLUTL")
0^1^B40762056^B40604448
"RTN","GMPLUTL",1,0)
GMPLUTL ; SLC/MKB/KER -- PL Utilities                      ; 4/15/2002
"RTN","GMPLUTL",2,0)
 ;;2.0;Problem List;**3,6,8,10,16,26,35,39**;Aug 25, 1994;Build 7
"RTN","GMPLUTL",3,0)
 ;
"RTN","GMPLUTL",4,0)
 ; External References
"RTN","GMPLUTL",5,0)
 ;   DBIA    348  ^DPT(
"RTN","GMPLUTL",6,0)
 ;   DBIA  10082  ^ICD9(
"RTN","GMPLUTL",7,0)
 ;   DBIA  10006  ^VA(200
"RTN","GMPLUTL",8,0)
 ;          
"RTN","GMPLUTL",9,0)
ACTIVE(GMPDFN,GMPL) ; Returns list of Active Problems for a Patient
"RTN","GMPLUTL",10,0)
 ;          
"RTN","GMPLUTL",11,0)
 ;   GMPDFN   Pointer to Patient
"RTN","GMPLUTL",12,0)
 ;   GMPL     Array in which the problems will be
"RTN","GMPLUTL",13,0)
 ;            returned, passed by reference
"RTN","GMPLUTL",14,0)
 ;          
"RTN","GMPLUTL",15,0)
 ;   GMPL(#,0)  Problem file (#9000011) IEN
"RTN","GMPLUTL",16,0)
 ;   GMPL(#,1)  Piece 1:  Pointer to Problem (Lexicon file #757.01)
"RTN","GMPLUTL",17,0)
 ;                    2:  Provider Narrative 
"RTN","GMPLUTL",18,0)
 ;                 NOTE:  the provider narrative may be different
"RTN","GMPLUTL",19,0)
 ;                        from the Lexicon term in file 757.01
"RTN","GMPLUTL",20,0)
 ;   GMPL(#,2)  Piece 1:  Pointer to ICD Diagnosis (file #80)
"RTN","GMPLUTL",21,0)
 ;                    2:  ICD-9 Code
"RTN","GMPLUTL",22,0)
 ;   GMPL(#,3)  Piece 1:  Internal Date of Onset
"RTN","GMPLUTL",23,0)
 ;                    2:  External Date of Onset 00/00/00
"RTN","GMPLUTL",24,0)
 ;   GMPL(#,4)  Piece 1:  Abbreviated Service Connection
"RTN","GMPLUTL",25,0)
 ;                            SC^Service Connected
"RTN","GMPLUTL",26,0)
 ;                            NSC^Not Service Connected
"RTN","GMPLUTL",27,0)
 ;                            null
"RTN","GMPLUTL",28,0)
 ;                    2:  Full text Service Connection
"RTN","GMPLUTL",29,0)
 ;   GMPL(#,5)  Piece 1:  Abbreviated Exposure
"RTN","GMPLUTL",30,0)
 ;                        Full text Exposure
"RTN","GMPLUTL",31,0)
 ;                            AO^Agent Orange
"RTN","GMPLUTL",32,0)
 ;                            IR^Radiation
"RTN","GMPLUTL",33,0)
 ;                            EC^Evn Contaminants
"RTN","GMPLUTL",34,0)
 ;                            HNC^Head/Neck Cancer
"RTN","GMPLUTL",35,0)
 ;                            MST^Mil Sexual Trauma
"RTN","GMPLUTL",36,0)
 ;                            CV^Combat Vet
"RTN","GMPLUTL",37,0)
 ;                            SHD^SHAD
"RTN","GMPLUTL",38,0)
 ;                            null
"RTN","GMPLUTL",39,0)
 ;          
"RTN","GMPLUTL",40,0)
 N I,IFN,CNT,GMPL0,GMPL1,SP,NUM,ONSET,GMPLIST,GMPLVIEW,GMPARAM,GMPTOTAL
"RTN","GMPLUTL",41,0)
 Q:$G(GMPDFN)'>0  S CNT=0,SP=""
"RTN","GMPLUTL",42,0)
 S GMPARAM("QUIET")=1,GMPARAM("REV")=$P($G(^GMPL(125.99,1,0)),U,5)="R"
"RTN","GMPLUTL",43,0)
 S GMPLVIEW("ACT")="A",GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLUTL",44,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLUTL",45,0)
 F NUM=0:0 S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLUTL",46,0)
 . S IFN=+GMPLIST(NUM) Q:IFN'>0
"RTN","GMPLUTL",47,0)
 . S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),CNT=CNT+1,GMPL(CNT,0)=IFN
"RTN","GMPLUTL",48,0)
 . S GMPL(CNT,1)=+GMPL1_U_$$PROBTEXT^GMPLX(IFN)
"RTN","GMPLUTL",49,0)
 . S GMPL(CNT,2)=+GMPL0_U_$P($G(^ICD9(+GMPL0,0)),U),ONSET=$P(GMPL0,U,13)
"RTN","GMPLUTL",50,0)
 . S GMPL(CNT,3)=$S(ONSET:ONSET_U_$$EXTDT^GMPLX(ONSET),1:"")
"RTN","GMPLUTL",51,0)
 . S GMPL(CNT,4)=$S(+$P(GMPL1,U,10):"SC^SERVICE-CONNECTED",$P(GMPL1,U,10)=0:"NSC^NOT SERVICE-CONNECTED",1:"")
"RTN","GMPLUTL",52,0)
 . F I=11,12,13,15,16,17,18 S:$P(GMPL1,U,I) SP=$S(I=11:"A",I=12:"I",I=13:"P",I=15:"H",16:"M",17:"C",1:"S")
"RTN","GMPLUTL",53,0)
 . S GMPL(CNT,5)=$S(SP="A":"AO^AGENT ORANGE",SP="I":"IR^RADIATION",SP="P":"EC^ENV CONTAMINANTS",SP="H":"HNC^HEAD AND/OR NECK CANCER",SP="M":"MST^MILIARY SEXUAL TRAUMA",SP="C":"CV^COMBAT VET",SP="S":"SHD^SHAD",1:"")
"RTN","GMPLUTL",54,0)
 S GMPL(0)=CNT
"RTN","GMPLUTL",55,0)
 Q
"RTN","GMPLUTL",56,0)
 ;
"RTN","GMPLUTL",57,0)
CREATE(PL,PLY) ; Creates a new problem
"RTN","GMPLUTL",58,0)
 ;           
"RTN","GMPLUTL",59,0)
 ;  Input array, passed by reference
"RTN","GMPLUTL",60,0)
 ;    Required
"RTN","GMPLUTL",61,0)
 ;      PL("PATIENT")    Pointer to Patient #2
"RTN","GMPLUTL",62,0)
 ;      PL("NARRATIVE")  Text as entered by provider
"RTN","GMPLUTL",63,0)
 ;      PL("PROVIDER")   Pointer to provider #200
"RTN","GMPLUTL",64,0)
 ;    Optional
"RTN","GMPLUTL",65,0)
 ;      PL("DIAGNOSIS")  Pointer to ICD-9 #80
"RTN","GMPLUTL",66,0)
 ;      PL("LEXICON")    Pointer to Lexicon #757.01
"RTN","GMPLUTL",67,0)
 ;      PL("STATUS")     A = Active   I = Inactive
"RTN","GMPLUTL",68,0)
 ;      PL("ONSET")      Internal Date of Onset
"RTN","GMPLUTL",69,0)
 ;      PL("RECORDED")   Internal Date Recorded
"RTN","GMPLUTL",70,0)
 ;      PL("RESOLVED")   Internal Date Problem was Resolved
"RTN","GMPLUTL",71,0)
 ;      PL("COMMENT")    Comment text, up to 60 characters
"RTN","GMPLUTL",72,0)
 ;      PL("LOCATION")   Pointer to Hospital Location
"RTN","GMPLUTL",73,0)
 ;      PL("SC")         Service Connected 1 = Yes 0 = No
"RTN","GMPLUTL",74,0)
 ;      PL("AO")         Agent Orange      1 = Yes 0 = No
"RTN","GMPLUTL",75,0)
 ;      PL("IR")         Radiation         1 = Yes 0 = No
"RTN","GMPLUTL",76,0)
 ;      PL("EC")         Env Contamination 1 = Yes 0 = No
"RTN","GMPLUTL",77,0)
 ;      PL("HNC")        Head/Neck Cancer  1 = Yes 0 = No
"RTN","GMPLUTL",78,0)
 ;      PL("MST")        Mil Sexual Trauma 1 = Yes 0 = No
"RTN","GMPLUTL",79,0)
 ;      PL("CV")         Combat Vet        1 = Yes 0 = No
"RTN","GMPLUTL",80,0)
 ;      PL("SHD")        Shipboard Hazard & Defense 1=Yes  0=No
"RTN","GMPLUTL",81,0)
 ;                   
"RTN","GMPLUTL",82,0)
 ;  Output, passed by reference
"RTN","GMPLUTL",83,0)
 ;      PLY              Equivalent of Fileman Y, DA
"RTN","GMPLUTL",84,0)
 ;      PLY(0)           Equivalent of Fileman Y(0)
"RTN","GMPLUTL",85,0)
 ;               
"RTN","GMPLUTL",86,0)
 N GMPI,GMPQUIT,GMPVAMC,GMPVA,GMPFLD,GMPSC,GMPAGTOR,GMPION,GMPGULF
"RTN","GMPLUTL",87,0)
 N GMPHNC,GMPMST,GMPCV,GMPSHD,DA,GMPDFN,GMPROV
"RTN","GMPLUTL",88,0)
 K PLY S PLY=-1,PLY(0)=""
"RTN","GMPLUTL",89,0)
 S GMPVAMC=+$G(DUZ(2)),GMPVA=$S($G(DUZ("AG"))="V":1,1:0)
"RTN","GMPLUTL",90,0)
 I '$L($G(PL("NARRATIVE"))) S PLY(0)="Missing problem narrative" Q
"RTN","GMPLUTL",91,0)
 I '$D(^DPT(+$G(PL("PATIENT")),0)) S PLY(0)="Invalid patient" Q
"RTN","GMPLUTL",92,0)
 I '$D(^VA(200,+$G(PL("PROVIDER")),0)) S PLY(0)="Invalid provider" Q
"RTN","GMPLUTL",93,0)
 S GMPDFN=+PL("PATIENT"),(GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST,GMPCV,GMPSHD)=0
"RTN","GMPLUTL",94,0)
 D:GMPVA VADPT^GMPLX1(GMPDFN)
"RTN","GMPLUTL",95,0)
 F GMPI="DIAGNOSI","LEXICON","DUPLICAT","LOCATION","STATUS" D @(GMPI_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",96,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",97,0)
 F GMPI="ONSET","RESOLVED","RECORDED","SC","AO","IR","EC","HNC","MST","CV","SHD" D @(GMPI_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",98,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",99,0)
CR1 ; Ok to Create
"RTN","GMPLUTL",100,0)
 S GMPFLD(.01)=PL("DIAGNOSIS"),GMPFLD(1.01)=PL("LEXICON")
"RTN","GMPLUTL",101,0)
 S GMPFLD(.05)=U_$E(PL("NARRATIVE"),1,80)
"RTN","GMPLUTL",102,0)
 S (GMPROV,GMPFLD(1.04),GMPFLD(1.05))=+PL("PROVIDER")
"RTN","GMPLUTL",103,0)
 S GMPFLD(1.06)=$$SERVICE^GMPLX1(+PL("PROVIDER"))
"RTN","GMPLUTL",104,0)
 S GMPFLD(.13)=PL("ONSET"),GMPFLD(1.09)=PL("RECORDED")
"RTN","GMPLUTL",105,0)
 S GMPFLD(1.02)=$S('$P(^GMPL(125.99,1,0),U,2):"P",$G(GMPLUSER):"P",1:"T")
"RTN","GMPLUTL",106,0)
 S GMPFLD(.12)=PL("STATUS"),GMPFLD(1.14)="",GMPFLD(1.07)=PL("RESOLVED")
"RTN","GMPLUTL",107,0)
 S GMPFLD(10,0)=0,GMPFLD(1.03)=$G(DUZ),GMPFLD(1.08)=PL("LOCATION")
"RTN","GMPLUTL",108,0)
 S:$L($G(PL("COMMENT"))) GMPFLD(10,"NEW",1)=$E(PL("COMMENT"),1,60)
"RTN","GMPLUTL",109,0)
 S GMPFLD(1.1)=PL("SC"),GMPFLD(1.11)=PL("AO"),GMPFLD(1.12)=PL("IR")
"RTN","GMPLUTL",110,0)
 S GMPFLD(1.13)=PL("EC"),GMPFLD(1.15)=$G(PL("HNC")),GMPFLD(1.16)=$G(PL("MST"))
"RTN","GMPLUTL",111,0)
 S GMPFLD(1.17)=$G(PL("CV")),GMPFLD(1.18)=$G(PL("SHD"))
"RTN","GMPLUTL",112,0)
 D NEW^GMPLSAVE S PLY=DA
"RTN","GMPLUTL",113,0)
CRQ ; Quit Create
"RTN","GMPLUTL",114,0)
 Q
"RTN","GMPLUTL",115,0)
 ;            
"RTN","GMPLUTL",116,0)
UPDATE(PL,PLY) ; Update a Problem/Create if Not Found
"RTN","GMPLUTL",117,0)
 ;            
"RTN","GMPLUTL",118,0)
 ;  Input array, passed by reference
"RTN","GMPLUTL",119,0)
 ;    Required
"RTN","GMPLUTL",120,0)
 ;      PL("PROBLEM")    Pointer to Problem #9000011
"RTN","GMPLUTL",121,0)
 ;      PL("PROVIDER")   Pointer to provider #200
"RTN","GMPLUTL",122,0)
 ;            
"RTN","GMPLUTL",123,0)
 ;    Optional
"RTN","GMPLUTL",124,0)
 ;      PL("NARRATIVE")  Text as entered by provider
"RTN","GMPLUTL",125,0)
 ;      PL("DIAGNOSIS")  Pointer to ICD-9 #80
"RTN","GMPLUTL",126,0)
 ;      PL("LEXICON")    Pointer to Lexicon #757.01
"RTN","GMPLUTL",127,0)
 ;      PL("STATUS")     A = Active   I = Inactive
"RTN","GMPLUTL",128,0)
 ;      PL("ONSET")      Internal Date of Onset
"RTN","GMPLUTL",129,0)
 ;      PL("RECORDED")   Internal Date Recorded
"RTN","GMPLUTL",130,0)
 ;      PL("RESOLVED")   Internal Date Problem was Resolved
"RTN","GMPLUTL",131,0)
 ;      PL("COMMENT")    Comment text, up to 60 characters
"RTN","GMPLUTL",132,0)
 ;      PL("LOCATION")   Pointer to Hospital Location
"RTN","GMPLUTL",133,0)
 ;      PL("SC")         Service Connected 1 = Yes 0 = No
"RTN","GMPLUTL",134,0)
 ;      PL("AO")         Agent Orange      1 = Yes 0 = No
"RTN","GMPLUTL",135,0)
 ;      PL("IR")         Radiation         1 = Yes 0 = No
"RTN","GMPLUTL",136,0)
 ;      PL("EC")         Env Contamination 1 = Yes 0 = No
"RTN","GMPLUTL",137,0)
 ;      PL("HNC")        Head/Neck Cancer  1 = Yes 0 = No
"RTN","GMPLUTL",138,0)
 ;      PL("MST")        Mil Sexual Trauma 1 = Yes 0 = No
"RTN","GMPLUTL",139,0)
 ;      PL("CV")         Combat Veteran    1 = Yes 0 = No
"RTN","GMPLUTL",140,0)
 ;      PL("SHD")        SHAD              1 = Yes 0 = No
"RTN","GMPLUTL",141,0)
 ;            
"RTN","GMPLUTL",142,0)
 ;  Output, passed by reference
"RTN","GMPLUTL",143,0)
 ;      PLY              Equivalent of Fileman Y, DA
"RTN","GMPLUTL",144,0)
 ;      PLY(0)           Equivalent of Fileman Y(0)
"RTN","GMPLUTL",145,0)
 ;            
"RTN","GMPLUTL",146,0)
 N GMPORIG,GMPFLD,FLD,ITEMS,SUB,GMPI,DIFFRENT,GMPIFN,GMPVAMC,GMPVA,GMPROV,GMPQUIT,GMPDFN
"RTN","GMPLUTL",147,0)
 S GMPVAMC=+$G(DUZ(2)),GMPVA=$S($G(DUZ("AG"))="V":1,1:0),PLY=-1,PLY(0)=""
"RTN","GMPLUTL",148,0)
 S GMPIFN=$G(PL("PROBLEM")) I GMPIFN="" D CREATE(.PL,.PLY) Q
"RTN","GMPLUTL",149,0)
 I '$D(^AUPNPROB(GMPIFN,0)) S PLY(0)="Invalid problem" Q
"RTN","GMPLUTL",150,0)
 I '$D(^VA(200,+$G(PL("PROVIDER")),0)) S PLY(0)="Invalid provider" Q
"RTN","GMPLUTL",151,0)
 S GMPROV=+$G(PL("PROVIDER")),GMPDFN=+$P(^AUPNPROB(GMPIFN,0),U,2)
"RTN","GMPLUTL",152,0)
 D GETFLDS^GMPLEDT3(GMPIFN) I '$D(GMPFLD) S PLY(0)="Invalid problem" Q
"RTN","GMPLUTL",153,0)
 I +$G(PL("PATIENT")),+PL("PATIENT")'=GMPDFN S PLY(0)="Patient does not match for this problem" Q
"RTN","GMPLUTL",154,0)
 I $L($G(PL("RECORDED"))) S PLY(0)="Date Recorded is not editable" Q
"RTN","GMPLUTL",155,0)
 S (GMPSC,GMPAGTOR,GMPION,GMPGULF)=0 D:GMPVA VADPT^GMPLX1(GMPDFN)
"RTN","GMPLUTL",156,0)
 S ITEMS="LEXICON^DIAGNOSIS^LOCATION^STATUS^ONSET^RESOLVED^SC^AO^IR^EC^HNC^MST^SHD",FLD="1.01^.01^1.08^.12^.13^1.07^1.1^1.11^1.12^1.13^1.15^1.16^1.17^1.18"
"RTN","GMPLUTL",157,0)
 F GMPI=1:1 S SUB=$P(ITEMS,U,GMPI) Q:SUB=""  D  Q:$D(GMPQUIT)
"RTN","GMPLUTL",158,0)
 . I '$L($G(PL(SUB))) S PL(SUB)=$P(GMPFLD($P(FLD,U,GMPI)),U) Q
"RTN","GMPLUTL",159,0)
 . I SUB="STATUS",PL(SUB)="@" S GMPQUIT=1,PLY(0)="Cannot delete problem status" Q
"RTN","GMPLUTL",160,0)
 . I PL(SUB)'="@" D @($E(SUB,1,8)_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",161,0)
 . S GMPFLD($P(FLD,U,GMPI))=$S(PL(SUB)="@":"",1:PL(SUB)),DIFFRENT=1
"RTN","GMPLUTL",162,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",163,0)
 I +GMPFLD(1.07),GMPFLD(1.07)<GMPFLD(.13) S PLY(0)="Date Resolved cannot be prior to Date of Onset" Q
"RTN","GMPLUTL",164,0)
 I +GMPFLD(1.09),GMPFLD(1.09)<GMPFLD(.13) S PLY(0)="Date Recorded cannot be prior to Date of Onset" Q
"RTN","GMPLUTL",165,0)
 S:$L($G(PL("NARRATIVE"))) GMPFLD(.05)=U_PL("NARRATIVE"),DIFFRENT=1
"RTN","GMPLUTL",166,0)
 S:$L($G(PL("COMMENT"))) GMPFLD(10,"NEW",1)=$E(PL("COMMENT"),1,60),DIFFRENT=1
"RTN","GMPLUTL",167,0)
 D:$D(DIFFRENT) EN^GMPLSAVE S PLY=GMPIFN,PLY(0)=""
"RTN","GMPLUTL",168,0)
 Q
"RTN","GMPLUTL1")
0^2^B25149940^B25017636
"RTN","GMPLUTL1",1,0)
GMPLUTL1 ; SLC/MKB/KER -- PL Utilities (cont)               ; 04/15/2002
"RTN","GMPLUTL1",2,0)
 ;;2.0;Problem List;**3,8,7,9,26,35,39**;Aug 25, 1994;Build 7
"RTN","GMPLUTL1",3,0)
 ;
"RTN","GMPLUTL1",4,0)
 ; External References
"RTN","GMPLUTL1",5,0)
 ;   DBIA   446  ^AUTNPOV(
"RTN","GMPLUTL1",6,0)
 ;   DBIA 10082  ^ICD9(
"RTN","GMPLUTL1",7,0)
 ;   DBIA  1571  ^LEX(757.01
"RTN","GMPLUTL1",8,0)
 ;   DBIA 10040  ^SC(
"RTN","GMPLUTL1",9,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLUTL1",10,0)
 ;   DBIA 10003  ^%DT
"RTN","GMPLUTL1",11,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMPLUTL1",12,0)
 ;                   
"RTN","GMPLUTL1",13,0)
 ; All entry points in this routine expect the 
"RTN","GMPLUTL1",14,0)
 ; PL("data item") array from routine ^GMPLUTL.
"RTN","GMPLUTL1",15,0)
 ;                   
"RTN","GMPLUTL1",16,0)
 ;   Entry     Expected Variable
"RTN","GMPLUTL1",17,0)
 ;   Point     From VADPT^GMPLX1
"RTN","GMPLUTL1",18,0)
 ;    AO           GMPAGTOR
"RTN","GMPLUTL1",19,0)
 ;    IR           GMPION
"RTN","GMPLUTL1",20,0)
 ;    EC           GMPGULF
"RTN","GMPLUTL1",21,0)
 ;    HNC          GMPHNC
"RTN","GMPLUTL1",22,0)
 ;    MST          GMPMST
"RTN","GMPLUTL1",23,0)
 ;    CV           GMPCV
"RTN","GMPLUTL1",24,0)
 ;    SHD          GMPSHD
"RTN","GMPLUTL1",25,0)
 ;                   
"RTN","GMPLUTL1",26,0)
 Q
"RTN","GMPLUTL1",27,0)
DIAGNOSI ; ICD Diagnosis Pointer
"RTN","GMPLUTL1",28,0)
 S:'$L($G(PL("DIAGNOSIS"))) PL("DIAGNOSIS")=$$NOS^GMPLX
"RTN","GMPLUTL1",29,0)
 Q:$D(^ICD9(+PL("DIAGNOSIS"),0))
"RTN","GMPLUTL1",30,0)
 S GMPQUIT=1,PLY(0)="Invalid ICD Diagnosis"
"RTN","GMPLUTL1",31,0)
 Q
"RTN","GMPLUTL1",32,0)
 ;
"RTN","GMPLUTL1",33,0)
LEXICON ; Clinical Lexicon Pointer
"RTN","GMPLUTL1",34,0)
 S:'$L($G(PL("LEXICON"))) PL("LEXICON")=1
"RTN","GMPLUTL1",35,0)
 Q:$D(^LEX(757.01,+PL("LEXICON"),0))
"RTN","GMPLUTL1",36,0)
 S GMPQUIT=1,PLY(0)="Invalid Lexicon term"
"RTN","GMPLUTL1",37,0)
 Q
"RTN","GMPLUTL1",38,0)
DUPLICAT ; Problem Already on the List 
"RTN","GMPLUTL1",39,0)
 N DUPL
"RTN","GMPLUTL1",40,0)
 Q:$P($G(^GMPL(125.99,1,0)),U,6)'=1
"RTN","GMPLUTL1",41,0)
 S:'$L($G(PL("DIAGNOSIS"))) PL("DIAGNOSIS")=$$NOS^GMPLX
"RTN","GMPLUTL1",42,0)
 I '$D(^AUPNPROB("B",+PL("DIAGNOSIS")))!('$D(^AUPNPROB("AC",GMPDFN))) Q
"RTN","GMPLUTL1",43,0)
 F IFN=0:0 S IFN=$O(^AUPNPROB("AC",GMPDFN,IFN)) Q:IFN'>0  D  Q:$D(GMPQUIT)
"RTN","GMPLUTL1",44,0)
 . S (DUPL(1),DUPL(2))=0
"RTN","GMPLUTL1",45,0)
 . S NODE0=$G(^AUPNPROB(IFN,0)),NODE1=$G(^(1)) Q:$P(NODE1,U,2)="H"
"RTN","GMPLUTL1",46,0)
 . I +PL("DIAGNOSIS")=+NODE0 S DUPL(1)=IFN
"RTN","GMPLUTL1",47,0)
 . S:PL("NARRATIVE")=$$UP^XLFSTR($P(^AUTNPOV($P(NODE0,U,5),0),U)) DUPL(2)=IFN
"RTN","GMPLUTL1",48,0)
 . I DUPL(1)>0&DUPL(2)>0 S GMPQUIT=1,PLY(0)="Duplicate problem"
"RTN","GMPLUTL1",49,0)
 Q
"RTN","GMPLUTL1",50,0)
 ;
"RTN","GMPLUTL1",51,0)
LOCATION ; Hospital Location (Clinic) Pointer
"RTN","GMPLUTL1",52,0)
 S:'$D(PL("LOCATION")) PL("LOCATION")="" Q:'$L(PL("LOCATION"))
"RTN","GMPLUTL1",53,0)
 I $D(^SC(+PL("LOCATION"),0)) S:$P(^(0),U,3)'="C" PL("LOCAATION")="" Q
"RTN","GMPLUTL1",54,0)
 S GMPQUIT=1,PLY(0)="Invalid hospital location"
"RTN","GMPLUTL1",55,0)
 Q
"RTN","GMPLUTL1",56,0)
 ;
"RTN","GMPLUTL1",57,0)
PROVIDER ; Responsible Provider
"RTN","GMPLUTL1",58,0)
 S:'$D(PL("PROVIDER")) PL("PROVIDER")=""
"RTN","GMPLUTL1",59,0)
 Q:'$L(PL("PROVIDER"))  Q:$D(^VA(200,+PL("PROVIDER"),0))
"RTN","GMPLUTL1",60,0)
 S GMPQUIT=1,PLY(0)="Invalid provider"
"RTN","GMPLUTL1",61,0)
 Q
"RTN","GMPLUTL1",62,0)
 ;
"RTN","GMPLUTL1",63,0)
STATUS ; Problem Status
"RTN","GMPLUTL1",64,0)
 S:$G(PL("STATUS"))="" PL("STATUS")="A"
"RTN","GMPLUTL1",65,0)
 I "^A^I^a^i^"[(U_PL("STATUS")_U) S PL("STATUS")=$$UP^XLFSTR(PL("STATUS")) Q
"RTN","GMPLUTL1",66,0)
 S GMPQUIT=1,PLY(0)="Invalid problem status"
"RTN","GMPLUTL1",67,0)
 Q
"RTN","GMPLUTL1",68,0)
 ;
"RTN","GMPLUTL1",69,0)
ONSET ; Date of Onset
"RTN","GMPLUTL1",70,0)
 N %DT,Y,X
"RTN","GMPLUTL1",71,0)
 S:'$D(PL("ONSET")) PL("ONSET")="" Q:'$L(PL("ONSET"))
"RTN","GMPLUTL1",72,0)
 S %DT="P",%DT(0)="-NOW",X=PL("ONSET") D ^%DT
"RTN","GMPLUTL1",73,0)
 I Y>0 S PL("ONSET")=Y Q
"RTN","GMPLUTL1",74,0)
 S GMPQUIT=1,PLY(0)="Invalid Date of Onset"
"RTN","GMPLUTL1",75,0)
 Q
"RTN","GMPLUTL1",76,0)
 ;
"RTN","GMPLUTL1",77,0)
RESOLVED ; Date Resolved (Requires STATUS, ONSET)
"RTN","GMPLUTL1",78,0)
 N %DT,Y,X
"RTN","GMPLUTL1",79,0)
 S:'$D(PL("RESOLVED")) PL("RESOLVED")="" Q:'$L(PL("RESOLVED"))
"RTN","GMPLUTL1",80,0)
 S %DT="P",%DT(0)="-NOW",X=PL("RESOLVED") D ^%DT
"RTN","GMPLUTL1",81,0)
 I Y'>0 S GMPQUIT=1,PLY(0)="Invalid Date Resolved" Q
"RTN","GMPLUTL1",82,0)
 I PL("STATUS")="A" S GMPQUIT=1,PLY(0)="Active problems cannot have a Date Resolved" Q
"RTN","GMPLUTL1",83,0)
 I Y<PL("ONSET") S GMPQUIT=1,PLY(0)="Date Resolved cannot be prior to Date of Onset" Q
"RTN","GMPLUTL1",84,0)
 S PL("RESOLVED")=Y
"RTN","GMPLUTL1",85,0)
 Q
"RTN","GMPLUTL1",86,0)
 ;
"RTN","GMPLUTL1",87,0)
RECORDED ; Date Recorded (Requires ONSET)
"RTN","GMPLUTL1",88,0)
 N %DT,Y,X
"RTN","GMPLUTL1",89,0)
 S:'$D(PL("RECORDED")) PL("RECORDED")="" Q:'$L(PL("RECORDED"))
"RTN","GMPLUTL1",90,0)
 S %DT="P",%DT(0)="-NOW",X=PL("RECORDED") D ^%DT
"RTN","GMPLUTL1",91,0)
 I Y'>0 S GMPQUIT=1,PLY(0)="Invalid Date Recorded" Q
"RTN","GMPLUTL1",92,0)
 I PL("RECORDED")<PL("ONSET") S GMPQUIT=1,PLY(0)="Date Recorded cannot be prior to Date of Onset" Q
"RTN","GMPLUTL1",93,0)
 S PL("RECORDED")=Y
"RTN","GMPLUTL1",94,0)
 Q
"RTN","GMPLUTL1",95,0)
 ;
"RTN","GMPLUTL1",96,0)
SC ; SC condition flag
"RTN","GMPLUTL1",97,0)
 S:'$D(PL("SC")) PL("SC")=""
"RTN","GMPLUTL1",98,0)
 I "^^1^0^"'[(U_PL("SC")_U) S GMPQUIT=1,PLY(0)="Invalid SC flag" Q
"RTN","GMPLUTL1",99,0)
 I 'GMPSC,+PL("SC") S GMPQUIT=1,PLY(0)="Invalid SC flag"
"RTN","GMPLUTL1",100,0)
 Q
"RTN","GMPLUTL1",101,0)
 ;
"RTN","GMPLUTL1",102,0)
AO ; AO exposure flag (Requires GMPAGTOR)
"RTN","GMPLUTL1",103,0)
 S:'$D(PL("AO")) PL("AO")=""
"RTN","GMPLUTL1",104,0)
 I "^^1^0^"'[(U_PL("AO")_U) S GMPQUIT=1,PLY(0)="Invalid AO flag" Q
"RTN","GMPLUTL1",105,0)
 I 'GMPAGTOR,+PL("AO") S GMPQUIT=1,PLY(0)="Invalid AO flag"
"RTN","GMPLUTL1",106,0)
 Q
"RTN","GMPLUTL1",107,0)
 ;
"RTN","GMPLUTL1",108,0)
IR ; IR exposure flag (Requires GMPION)
"RTN","GMPLUTL1",109,0)
 S:'$D(PL("IR")) PL("IR")=""
"RTN","GMPLUTL1",110,0)
 I "^^1^0^"'[(U_PL("IR")_U) S GMPQUIT=1,PLY(0)="Invalid IR flag" Q
"RTN","GMPLUTL1",111,0)
 I 'GMPION,+PL("IR") S GMPQUIT=1,PLY(0)="Invalid IR flag"
"RTN","GMPLUTL1",112,0)
 Q
"RTN","GMPLUTL1",113,0)
 ;
"RTN","GMPLUTL1",114,0)
EC ; EC exposure flag (Requires GMPGULF)
"RTN","GMPLUTL1",115,0)
 S:'$D(PL("EC")) PL("EC")=""
"RTN","GMPLUTL1",116,0)
 I "^^1^0^"'[(U_PL("EC")_U) S GMPQUIT=1,PLY(0)="Invalid EC flag" Q
"RTN","GMPLUTL1",117,0)
 I 'GMPGULF,+PL("EC") S GMPQUIT=1,PLY(0)="Invalid EC flag"
"RTN","GMPLUTL1",118,0)
 Q
"RTN","GMPLUTL1",119,0)
HNC ; HNC/NTR exposure flag (Requires GMPHNC)
"RTN","GMPLUTL1",120,0)
 S:'$D(PL("HNC")) PL("HNC")=""
"RTN","GMPLUTL1",121,0)
 I "^^1^0^"'[(U_PL("HNC")_U) S GMPQUIT=1,PLY(0)="Invalid HNC flag" Q
"RTN","GMPLUTL1",122,0)
 I 'GMPHNC,+PL("HNC") S GMPQUIT=1,PLY(0)="Invalid HNC flag"
"RTN","GMPLUTL1",123,0)
 Q
"RTN","GMPLUTL1",124,0)
MST ; MST exposure flag (Requires GMPMST)
"RTN","GMPLUTL1",125,0)
 S:'$D(PL("MST")) PL("MST")=""
"RTN","GMPLUTL1",126,0)
 I "^^1^0^"'[(U_PL("MST")_U) S GMPQUIT=1,PLY(0)="Invalid MST flag" Q
"RTN","GMPLUTL1",127,0)
 I 'GMPMST,+PL("MST") S GMPQUIT=1,PLY(0)="Invalid MST flag"
"RTN","GMPLUTL1",128,0)
 Q
"RTN","GMPLUTL1",129,0)
CV ; CV exposure flag (Requires GMPCV)
"RTN","GMPLUTL1",130,0)
 S:'$D(PL("CV")) PL("CV")=""
"RTN","GMPLUTL1",131,0)
 I "^^1^0^"'[(U_PL("CV")_U) S GMPQUIT=1,PLY(0)="Invalid CV flag" Q
"RTN","GMPLUTL1",132,0)
 I 'GMPCV,+PL("CV") S GMPQUIT=1,PLY(0)="Invalid CV flag"
"RTN","GMPLUTL1",133,0)
 Q
"RTN","GMPLUTL1",134,0)
SHD ; SHD exposure flag (Requires GMPSHD)
"RTN","GMPLUTL1",135,0)
 S:'$D(PL("SHD")) PL("SHD")=""
"RTN","GMPLUTL1",136,0)
 I "^^1^0^"'[(U_PL("SHD")_U) S GMPQUIT=1,PLY(0)="Invalid SHD flag" Q
"RTN","GMPLUTL1",137,0)
 I 'GMPSHD,+PL("SHD") S GMPQUIT=1,PLY(0)="Invalid SHD flag"
"RTN","GMPLUTL1",138,0)
 Q
"VER")
8.0^22.0
"BLD",8035,6)
^35
**END**
**END**
