Released PRCA*4.5*264 SEQ #245
Extracted from mail message
**KIDS**:PRCA*4.5*264^

**INSTALL NAME**
PRCA*4.5*264
"BLD",8269,0)
PRCA*4.5*264^ACCOUNTS RECEIVABLE^0^3100311^y
"BLD",8269,1,0)
^^6^6^3100311^
"BLD",8269,1,1,0)
This patch addresses two issues.  The first issue is regarding the EEOB
"BLD",8269,1,2,0)
WORKLIST option showing the unrelated Explanation of Benefit (EOB) results
"BLD",8269,1,3,0)
on a selected electronic remittance advice (ERA).
"BLD",8269,1,4,0)
 
"BLD",8269,1,5,0)
The second issue is about the "***Trans # xxxxxxxx REQUST QUEUED ***"
"BLD",8269,1,6,0)
message incorrectly appearing in the Brief Account Profile option.
"BLD",8269,4,0)
^9.64PA^^
"BLD",8269,6.3)
1
"BLD",8269,"KRN",0)
^9.67PA^779.2^20
"BLD",8269,"KRN",.4,0)
.4
"BLD",8269,"KRN",.401,0)
.401
"BLD",8269,"KRN",.402,0)
.402
"BLD",8269,"KRN",.403,0)
.403
"BLD",8269,"KRN",.5,0)
.5
"BLD",8269,"KRN",.84,0)
.84
"BLD",8269,"KRN",3.6,0)
3.6
"BLD",8269,"KRN",3.8,0)
3.8
"BLD",8269,"KRN",9.2,0)
9.2
"BLD",8269,"KRN",9.8,0)
9.8
"BLD",8269,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",8269,"KRN",9.8,"NM",1,0)
RCDPESR2^^0^B79069253
"BLD",8269,"KRN",9.8,"NM",2,0)
PRCACOL^^0^B22513060
"BLD",8269,"KRN",9.8,"NM","B","PRCACOL",2)

"BLD",8269,"KRN",9.8,"NM","B","RCDPESR2",1)

"BLD",8269,"KRN",19,0)
19
"BLD",8269,"KRN",19.1,0)
19.1
"BLD",8269,"KRN",101,0)
101
"BLD",8269,"KRN",409.61,0)
409.61
"BLD",8269,"KRN",771,0)
771
"BLD",8269,"KRN",779.2,0)
779.2
"BLD",8269,"KRN",870,0)
870
"BLD",8269,"KRN",8989.51,0)
8989.51
"BLD",8269,"KRN",8989.52,0)
8989.52
"BLD",8269,"KRN",8994,0)
8994
"BLD",8269,"KRN","B",.4,.4)

"BLD",8269,"KRN","B",.401,.401)

"BLD",8269,"KRN","B",.402,.402)

"BLD",8269,"KRN","B",.403,.403)

"BLD",8269,"KRN","B",.5,.5)

"BLD",8269,"KRN","B",.84,.84)

"BLD",8269,"KRN","B",3.6,3.6)

"BLD",8269,"KRN","B",3.8,3.8)

"BLD",8269,"KRN","B",9.2,9.2)

"BLD",8269,"KRN","B",9.8,9.8)

"BLD",8269,"KRN","B",19,19)

"BLD",8269,"KRN","B",19.1,19.1)

"BLD",8269,"KRN","B",101,101)

"BLD",8269,"KRN","B",409.61,409.61)

"BLD",8269,"KRN","B",771,771)

"BLD",8269,"KRN","B",779.2,779.2)

"BLD",8269,"KRN","B",870,870)

"BLD",8269,"KRN","B",8989.51,8989.51)

"BLD",8269,"KRN","B",8989.52,8989.52)

"BLD",8269,"KRN","B",8994,8994)

"BLD",8269,"QUES",0)
^9.62^^
"BLD",8269,"REQB",0)
^9.611^2^2
"BLD",8269,"REQB",1,0)
PRCA*4.5*198^2
"BLD",8269,"REQB",2,0)
PRCA*4.5*252^2
"BLD",8269,"REQB","B","PRCA*4.5*198",1)

"BLD",8269,"REQB","B","PRCA*4.5*252",2)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
264^3100311
"PKG",142,22,1,"PAH",1,1,0)
^^6^6^3100311
"PKG",142,22,1,"PAH",1,1,1,0)
This patch addresses two issues.  The first issue is regarding the EEOB
"PKG",142,22,1,"PAH",1,1,2,0)
WORKLIST option showing the unrelated Explanation of Benefit (EOB) results
"PKG",142,22,1,"PAH",1,1,3,0)
on a selected electronic remittance advice (ERA).
"PKG",142,22,1,"PAH",1,1,4,0)
 
"PKG",142,22,1,"PAH",1,1,5,0)
The second issue is about the "***Trans # xxxxxxxx REQUST QUEUED ***"
"PKG",142,22,1,"PAH",1,1,6,0)
message incorrectly appearing in the Brief Account Profile option.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PRCACOL")
0^2^B22513060^B22482657
"RTN","PRCACOL",1,0)
PRCACOL ;WASH-ISC@ALTOONA,PA/LDB-Payment History Report ;9/27/93  4:31 PM
"RTN","PRCACOL",2,0)
V ;;4.5;Accounts Receivable;**165,198,264**;Mar 20, 1995;Build 1
"RTN","PRCACOL",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCACOL",4,0)
 ;
"RTN","PRCACOL",5,0)
EN ;Ask debtor and date range for payment history
"RTN","PRCACOL",6,0)
 N DPTNOFZY,DPTNOFZK S (DPTNOFZY,DPTNOFZK)=1
"RTN","PRCACOL",7,0)
 K DIR S POP=0
"RTN","PRCACOL",8,0)
 S DIR(0)="PO^340:QEAMZ",DIR("A")="Select Patient ",DIR("?")="Enter a Patient name" D ^DIR
"RTN","PRCACOL",9,0)
 I $D(DIRUT)!(Y="") G EXIT1
"RTN","PRCACOL",10,0)
 I $P($G(^RCD(340,+Y,0)),U)'["DPT" W *7 G EN
"RTN","PRCACOL",11,0)
 S DEBTOR=+Y K DIR
"RTN","PRCACOL",12,0)
 I '$D(^PRCA(433,"ATD",DEBTOR)) W !,"This patient has made no payments." Q
"RTN","PRCACOL",13,0)
 S BDATE=$S(($$LST^RCFN01(DEBTOR,2)<0):$$FMADD^XLFDT(DT,-30),1:+$$LST^RCFN01(DEBTOR,2)),DIR(0)="DO^2880101:DT",DIR("A")="Payment history beginning date",DIR("B")=$$FMTE^XLFDT(BDATE,"1D")
"RTN","PRCACOL",14,0)
 S DIR("?")="The default date is either the last statement day or T-30, but any date may be entered."
"RTN","PRCACOL",15,0)
 D ^DIR
"RTN","PRCACOL",16,0)
 S:Y'="" BDATE=Y I $D(DIRUT)&'Y G EXIT1 Q
"RTN","PRCACOL",17,0)
 K DIR,X,Y
"RTN","PRCACOL",18,0)
 S DIR(0)="DO^"_BDATE_":DT",DIR("A")="Payment history ending date",DIR("B")=$$FMTE^XLFDT(DT,"1D")
"RTN","PRCACOL",19,0)
 D ^DIR S:Y="" Y=DT I $D(DIRUT)&'Y G EXIT1 Q
"RTN","PRCACOL",20,0)
 S EDATE=Y
"RTN","PRCACOL",21,0)
 K DIR
"RTN","PRCACOL",22,0)
 S %ZIS="AEQ" D ^%ZIS G:POP EXIT1
"RTN","PRCACOL",23,0)
 I $D(IO("Q")) D  Q
"RTN","PRCACOL",24,0)
 .S ZTSAVE("DEBTOR")="",ZTSAVE("BDATE")="",ZTSAVE("EDATE")="",ZTRTN="DQ^PRCACOL",ZTDESC="Patient Payment/Refund Transaction History Report"
"RTN","PRCACOL",25,0)
 .D ^%ZTLOAD,^%ZISC,EXIT1 K ZTSAVE,ZTRTN,IO("Q") Q
"RTN","PRCACOL",26,0)
 ;
"RTN","PRCACOL",27,0)
DQ ;Call to build array of payment transactions
"RTN","PRCACOL",28,0)
 ;
"RTN","PRCACOL",29,0)
 U IO
"RTN","PRCACOL",30,0)
 D TRANS
"RTN","PRCACOL",31,0)
 I '$D(^TMP($J,"PRCACOL")) D HDR W !!,"This patient has no payments or refunds during this time period."
"RTN","PRCACOL",32,0)
 I $D(^TMP($J)) D HDR,PRINT
"RTN","PRCACOL",33,0)
 ;
"RTN","PRCACOL",34,0)
EXIT1 K AMT,BDATE,EDATE,DATE,DEBTOR,DIR,DUOUT,DX,DY,LINE,PG,PNODE,TN,X,Y,ZTSK,TOTPD,TOTREF,TOTPRIN,TOTINT,TOTADM,^TMP($J),^UTILITY($J)
"RTN","PRCACOL",35,0)
 I $D(DIRUT)!POP K DIRUT,POP Q
"RTN","PRCACOL",36,0)
 ;end of routine
"RTN","PRCACOL",37,0)
EXIT2 I $E(IOST,1,2)'="C-" W @IOF D ^%ZISC Q
"RTN","PRCACOL",38,0)
 I $E(IOST,1,2)="C-"  D ENS^%ZISS S DY=IOM-1,DX=0 X IOXY D KILL^%ZISS K DIR,X,Y,^UTILITY($J) S DIR(0)="E" D ^DIR
"RTN","PRCACOL",39,0)
 I $D(DIRUT) K DIRUT Q
"RTN","PRCACOL",40,0)
 D ^%ZISC
"RTN","PRCACOL",41,0)
 G EN
"RTN","PRCACOL",42,0)
 ;
"RTN","PRCACOL",43,0)
TRANS ;Build array of transactions
"RTN","PRCACOL",44,0)
 S (PG,TOTPD,TOTREF,TOTPRIN,TOTINT,TOTADM)=0,$P(LINE,"-",75)="-" K ^TMP($J) D DT^DICRW
"RTN","PRCACOL",45,0)
 S BILL=0 F  S BILL=$O(^PRCA(430,"C",DEBTOR,BILL)) Q:'BILL  D
"RTN","PRCACOL",46,0)
 .S TN=0 F  S TN=$O(^PRCA(433,"C",+BILL,TN)) Q:'TN  D
"RTN","PRCACOL",47,0)
 ..I $D(^PRCA(433,TN,0)),$D(^(1)),"^2^34^41^"[("^"_$P(^(1),"^",2)_"^") D
"RTN","PRCACOL",48,0)
 ...;  if transaction is not complete (2), do not display it
"RTN","PRCACOL",49,0)
 ...I $P(^PRCA(433,TN,0),"^",4)'=2 Q
"RTN","PRCACOL",50,0)
 ...S X=^PRCA(433,TN,1),DATE=+X Q:DATE<BDATE!(+X>EDATE)
"RTN","PRCACOL",51,0)
 ...S ^TMP($J,"PRCACOL",DATE,TN)=$P($G(^PRCA(433,+TN,0)),U,2)_U_$P(X,U)_U_$S($P(X,U,2)=41:"Y",1:"")_U_$P(X,U,3)_U_$P(X,U,5)
"RTN","PRCACOL",52,0)
 ...S:$P(^TMP($J,"PRCACOL",DATE,TN),U,3)'="Y" TOTPD=TOTPD+$P(X,U,5) S:$P(^(TN),U,3)="Y" TOTREF=TOTREF+$P(X,U,5)
"RTN","PRCACOL",53,0)
 ...I $D(^PRCA(433,TN,3)) S X=^(3),^TMP($J,"PRCACOL",DATE,TN)=^TMP($J,"PRCACOL",DATE,TN)_U_$P(X,U)_U_$P(X,U,2)_U_$P(X,U,3) D
"RTN","PRCACOL",54,0)
 ....S:$P(^TMP($J,"PRCACOL",DATE,TN),U,3)'="Y" TOTPRIN=TOTPRIN+$P(X,U),TOTINT=TOTINT+$P(X,U,2),TOTADM=TOTADM+$P(X,U,3)
"RTN","PRCACOL",55,0)
 Q
"RTN","PRCACOL",56,0)
 ;
"RTN","PRCACOL",57,0)
PRINT ;Print transactions
"RTN","PRCACOL",58,0)
 S DATE=0 F  S DATE=$O(^TMP($J,"PRCACOL",DATE)) Q:'DATE  Q:$D(DIRUT)  D
"RTN","PRCACOL",59,0)
 .S TN=0 F  S TN=$O(^TMP($J,"PRCACOL",DATE,TN)) Q:'TN  D SCRN Q:$D(DIRUT)  D
"RTN","PRCACOL",60,0)
 ..S PNODE=^TMP($J,"PRCACOL",DATE,TN) W !,$$FMTE^XLFDT($P(PNODE,U,2),"1D"),?15,$P($G(^PRCA(430,+$P(PNODE,U),0)),U)
"RTN","PRCACOL",61,0)
 ..W ?27,$P(PNODE,U,3),?32,$P(PNODE,U,4),?42 S AMT=$P(PNODE,U,5) W $J(AMT,6,2)
"RTN","PRCACOL",62,0)
 ..F X=1:1:3 S X(X)=$P(PNODE,U,X+5) W:X=1 ?50,$J(X(X),6,2) W:X=2 ?58,$J(X(X),6,2) W:X=3 ?66,$J(X(X),6,2)
"RTN","PRCACOL",63,0)
 ..D SCRN Q:$D(DIRUT)
"RTN","PRCACOL",64,0)
 ..Q
"RTN","PRCACOL",65,0)
 .Q
"RTN","PRCACOL",66,0)
 ;
"RTN","PRCACOL",67,0)
 D SCRN Q:$D(DIRUT)
"RTN","PRCACOL",68,0)
 W !!,?25,"      Total Principal Paid: ",?50,$J(TOTPRIN,12,2)
"RTN","PRCACOL",69,0)
 D SCRN Q:$D(DIRUT)
"RTN","PRCACOL",70,0)
 W !,?25,"       Total Interest Paid: ",?50,$J(TOTINT,12,2)
"RTN","PRCACOL",71,0)
 D SCRN Q:$D(DIRUT)
"RTN","PRCACOL",72,0)
 W !,?25,"          Total Admin Paid: ",?50,$J(TOTADM,12,2)
"RTN","PRCACOL",73,0)
 D SCRN Q:$D(DIRUT)
"RTN","PRCACOL",74,0)
 W !,?25,"                Total Paid: ",?50,$J(TOTPD,12,2)
"RTN","PRCACOL",75,0)
 D SCRN Q:$D(DIRUT)
"RTN","PRCACOL",76,0)
 W !,?25,"              Total Refund: ",?50,$J(TOTREF,12,2)
"RTN","PRCACOL",77,0)
 Q
"RTN","PRCACOL",78,0)
 ;
"RTN","PRCACOL",79,0)
SCRN ;Check for screen
"RTN","PRCACOL",80,0)
 K DIR I ($Y+3)>IOSL D
"RTN","PRCACOL",81,0)
 .I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR Q:$D(DIRUT)
"RTN","PRCACOL",82,0)
 .D HDR
"RTN","PRCACOL",83,0)
 Q
"RTN","PRCACOL",84,0)
 ;
"RTN","PRCACOL",85,0)
HDR ;Heading for report
"RTN","PRCACOL",86,0)
 S PG=PG+1
"RTN","PRCACOL",87,0)
 W @IOF,!,?20,"Patient Payment History Report",?70,"Page ",PG
"RTN","PRCACOL",88,0)
 W !,?20,"------------------------------"
"RTN","PRCACOL",89,0)
 W !!,?18,"For Patient: ",$$NAM^RCFN01(DEBTOR),!,?25,"SSN : ",$$SSN^RCFN01(DEBTOR)
"RTN","PRCACOL",90,0)
 W !,?20,"For dates: ",$$FMTE^XLFDT(BDATE,"ID"),"-",$$FMTE^XLFDT(EDATE,"1D")
"RTN","PRCACOL",91,0)
 W !!,"    DATE OF",!,"PAYMENT/REFUND",?16,"BILL #",?25,"REFUND",?32,"RECEIPT #",?42,"AMOUNT",?51,"PRIN.",?59,"INT.",?67,"ADMIN.",!,LINE
"RTN","PRCACOL",92,0)
 Q
"RTN","RCDPESR2")
0^1^B79069253^B78955148
"RTN","RCDPESR2",1,0)
RCDPESR2 ;ALB/TMK - Server auto-upd - EDI Lockbox ;06/03/02
"RTN","RCDPESR2",2,0)
 ;;4.5;Accounts Receivable;**173,216,208,230,252,264**;Mar 20, 1995;Build 1
"RTN","RCDPESR2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPESR2",4,0)
 ; IA 4042 (IBCEOB)
"RTN","RCDPESR2",5,0)
 ;
"RTN","RCDPESR2",6,0)
TASKERA(RCTDA) ; Task to upd ERA
"RTN","RCDPESR2",7,0)
 ; RCTDA = ien 344.5
"RTN","RCDPESR2",8,0)
 N ZTDTH,ZTUCI,ZTSAVE,ZTIO,ZTDESC,ZTRTN,ZTSK,DIE,DR,DA
"RTN","RCDPESR2",9,0)
 S (ZTSAVE("DT"),ZTSAVE("U"),ZTSAVE("DUZ"))="",ZTSAVE("ZTREQ")="@",ZTRTN="NEWERA^RCDPESR2("_RCTDA_",0)",ZTDTH=$H,ZTIO=""
"RTN","RCDPESR2",10,0)
 D ^%ZTLOAD
"RTN","RCDPESR2",11,0)
 Q
"RTN","RCDPESR2",12,0)
 ;
"RTN","RCDPESR2",13,0)
NEWERA(RCTDA,RCREFILE) ;Tasked
"RTN","RCDPESR2",14,0)
 ; Add new EOB's to IB & ERA tot rec to AR
"RTN","RCDPESR2",15,0)
 ; RCTDA = ien 344.5
"RTN","RCDPESR2",16,0)
 ; RCREFILE = 1: re-filing rec via exc proc
"RTN","RCDPESR2",17,0)
 N RCDUPERR,RCPAYER,RCRTOT,RCE,RCEC,RCERR,RCR1,RCADJ,DIE,DR,DA,Z,Q
"RTN","RCDPESR2",18,0)
 S ZTREQ="@"
"RTN","RCDPESR2",19,0)
 K ^TMP($J,"RCDPERA")
"RTN","RCDPESR2",20,0)
 L +^RCY(344.5,RCTDA):5
"RTN","RCDPESR2",21,0)
 I $D(ZTQUEUED) S DIE="^RCY(344.5,",DA=RCTDA,DR=".05////"_ZTSK_";.04////1" D ^DIE
"RTN","RCDPESR2",22,0)
 I $P($G(^RCY(344.5,RCTDA,0)),U,5),'$G(RCREFILE) S DIE="^RCY(344.5,",DA=RCTDA,DR=".1////4;.08///1" D ^DIE
"RTN","RCDPESR2",23,0)
 S RCR1=$P($G(^RCY(344.5,RCTDA,0)),U,7),RCPAYER=$P($G(^RCY(344.5,RCTDA,3)),U)
"RTN","RCDPESR2",24,0)
 S RCRTOT=$S(RCR1:RCR1,1:$$ERATOT^RCDPESR6(RCTDA,.RCERR)) ; ERA rec
"RTN","RCDPESR2",25,0)
 S RCDUPERR=$S($G(RCERR)="DUP"!($G(RCERR(1))=-2):$G(RCERR(1)),1:0) K RCERR(1)
"RTN","RCDPESR2",26,0)
 I RCRTOT,'RCR1 S DIE="^RCY(344.5,",DR=".07////"_RCRTOT,DA=RCTDA D ^DIE
"RTN","RCDPESR2",27,0)
 D:RCDUPERR'=-2 UPDEOB(RCTDA,5,$S('$G(RCREFILE):RCDUPERR,1:-1)) ; Add EOB det to IB
"RTN","RCDPESR2",28,0)
 I RCRTOT D UPDCON^RCDPESR6(RCRTOT),UPDADJ^RCDPESR6(RCRTOT),UPD3444^RCDPESR6(.RCRTOT) ; Bills added 344.41
"RTN","RCDPESR2",29,0)
 I RCRTOT,RCTDA S DIE="^RCY(344.5,",DR=".08////0;.1///@",DA=RCTDA D ^DIE
"RTN","RCDPESR2",30,0)
 I 'RCRTOT D  G QNEW
"RTN","RCDPESR2",31,0)
 .I RCDUPERR Q:'RCTDA  D  S RCTDA="" Q
"RTN","RCDPESR2",32,0)
 ..I RCDUPERR=-2 D BULLERA^RCDPESR0("D",RCTDA,$P($G(^RCY(344.5,RCTDA,0)),U,11),"EDI LBOX - DUPLICATE ERA NOT FILED "_$E(RCPAYER,1,20),.RCERR,0)
"RTN","RCDPESR2",33,0)
 ..D TEMPDEL^RCDPESR1(RCTDA)
"RTN","RCDPESR2",34,0)
 .S RCE(1)=$$FMTE^XLFDT($$NOW^XLFDT(),2)_" An error occurred while storing ERA data.",RCE(2)="No totals data was stored for this ERA record"_$S('$G(RCREFILE):" and an",1:" on this re-file attempt.")
"RTN","RCDPESR2",35,0)
 .S RCE(3)=$S('$G(RCREFILE):"ERA transmission exception was created.",1:"")
"RTN","RCDPESR2",36,0)
 .D WP^DIE(344.5,RCTDA_",",5,"A","RCE")
"RTN","RCDPESR2",37,0)
 .S DIE="^RCY(344.5,",DA=RCTDA,DR=".07///@;.08////1;.1////1" D ^DIE
"RTN","RCDPESR2",38,0)
 .K RCERR
"RTN","RCDPESR2",39,0)
 .S RCERR(1)=$$FMTE^XLFDT($$NOW^XLFDT(),2)_" The ERA data could not be stored. The AR receipt",RCERR(2)=" for this data must be created/processed manually for the bills included"
"RTN","RCDPESR2",40,0)
 .S RCERR(3)=" in this ERA."_$S('$G(RCREFILE):"",1:"  This error occurred during a refile attempt."),RCERR(4)=" "
"RTN","RCDPESR2",41,0)
 .D BULLERA^RCDPESR0("DF",RCTDA,$P($G(^RCY(344.5,RCTDA,0)),U,11),"EDI LBOX - TOTALS FILE EXCEPTION "_$E(RCPAYER,1,20),.RCERR,0)
"RTN","RCDPESR2",42,0)
 .K RCERR
"RTN","RCDPESR2",43,0)
 I $$ADJ^RCDPEU(RCRTOT,.RCADJ) D  ;Bulletin adjs
"RTN","RCDPESR2",44,0)
 .S RCEC=$$ADJERR^RCDPESR3(.RCERR)
"RTN","RCDPESR2",45,0)
 .I RCADJ'=2 S RCEC=RCEC+1,RCERR(RCEC)=" THERE ARE ERA LEVEL ADJUSTMENT(S)",RCEC=RCEC+1,RCERR(RCEC)=" "
"RTN","RCDPESR2",46,0)
 .I RCADJ'=1 S RCEC=RCEC+1,RCERR(RCEC)=" THE FOLLOWING BILL(S) HAVE RETRACTIONS:" D
"RTN","RCDPESR2",47,0)
 ..S (Q,Z)=0 S Z=0 F  S Z=$O(RCADJ(RCRTOT,Z)) Q:'Z  S:'Q RCEC=RCEC+1,RCERR(RCEC)="  " S Q=Q+1,RCERR(RCEC)=RCERR(RCEC)_"  "_RCADJ(RCRTOT,Z) S:Q=4 Q=0
"RTN","RCDPESR2",48,0)
 ..S RCEC=RCEC+1,RCERR(RCEC)=" "
"RTN","RCDPESR2",49,0)
 .D BULLERA^RCDPESR0("D",RCTDA,$P($G(^RCY(344.5,RCTDA,0)),U,11),"EDI LBOX - ERA HAS ADJ/TAKEBACKS "_$E(RCPAYER,1,20),.RCERR,0)
"RTN","RCDPESR2",50,0)
 ;
"RTN","RCDPESR2",51,0)
QNEW I RCTDA,'$P($G(^RCY(344.5,RCTDA,0)),U,8) D TEMPDEL^RCDPESR1(RCTDA) S RCTDA=""
"RTN","RCDPESR2",52,0)
 I RCTDA,$P($G(^RCY(344.5,RCTDA,0)),U)'="" S DIE="^RCY(344.5,",DR=".04////0;.05///@"_$S('$G(RCR1)&$G(RCRTOT):";.07////"_RCRTOT,1:""),DA=RCTDA D ^DIE
"RTN","RCDPESR2",53,0)
 K ^TMP($J,"RCDPERA")
"RTN","RCDPESR2",54,0)
 I RCTDA L -^RCY(344.5,RCTDA)
"RTN","RCDPESR2",55,0)
 Q
"RTN","RCDPESR2",56,0)
 ;
"RTN","RCDPESR2",57,0)
UPDEOB(RCTDA,RCFILE,DUP) ;Upd 361.1 from ERA msg in 344.5 or .4
"RTN","RCDPESR2",58,0)
 ;RCTDA = ien ERA msg in 344.5 or ;subfile in 344.4
"RTN","RCDPESR2",59,0)
 ;RCFILE = 4 file 344.4, 5 if 344.5
"RTN","RCDPESR2",60,0)
 ;DUP = msg # if dup msg, but not same # or -1 if same msg #
"RTN","RCDPESR2",61,0)
 ;Returned for each bill in ERA:
"RTN","RCDPESR2",62,0)
 ;^TMP($J,"RCDPEOB",n)=Bill ien^AR bill#^SrvDt
"RTN","RCDPESR2",63,0)
 ;^TMP($J,"RCDPEOB",n,"EOB")=EOB ien^amt pd^ins co ptr^rev flg^EEOB pn^amtbld^^^^BPNPI^RNPI^ETQual^LN^FN
"RTN","RCDPESR2",64,0)
 ;^TMP($J,"RCDPEOB","ADJ",x)=adj rec ('02')
"RTN","RCDPESR2",65,0)
 ;Also:
"RTN","RCDPESR2",66,0)
 ;^TMP($J,"RCDPEOB","HDR")=hdr rec from txmn
"RTN","RCDPESR2",67,0)
 ;^TMP($J,"RCDPEOB","CONTACT")=ERA contact rec ('01')
"RTN","RCDPESR2",68,0)
 ;
"RTN","RCDPESR2",69,0)
 N RCGBL,RC,RC0,RCCT,RCCT1,RCEOB,RCBILL,RCDPBNPI,RCMNUM,RCIFN,RCIB,RCERR,RCSTAR,RCET,RCX,RCXMG,Z,Q,DA,DR,DIE,RCPAYER,RCFILED,RCEOBD,RCNOUPD,REFORM,RCSD,RCERR1,C5
"RTN","RCDPESR2",70,0)
 K ^TMP($J,"RCDP-EOB"),^TMP("RCDPERR-EOB",$J)
"RTN","RCDPESR2",71,0)
 ;
"RTN","RCDPESR2",72,0)
 S RCPAYER="",RCFILED=1,RCNOUPD=0
"RTN","RCDPESR2",73,0)
 I RCFILE=5 D
"RTN","RCDPESR2",74,0)
 .S RCGBL=$NA(^RCY(344.5,RCTDA,2))
"RTN","RCDPESR2",75,0)
 .S RCMNUM=+$G(^RCY(344.5,RCTDA,0)),RCXMG=$P($G(^(0)),U,11)
"RTN","RCDPESR2",76,0)
 .I $G(DUP) S RCNOUPD=$S(DUP>0:+DUP,1:RCXMG)
"RTN","RCDPESR2",77,0)
 .S ^TMP($J,"RCDPEOB","HDR")=$G(^RCY(344.5,RCTDA,2,1,0))
"RTN","RCDPESR2",78,0)
 .I $P(^TMP($J,"RCDPEOB","HDR"),U)["XFR",'$P($G(^RCY(344.5,RCTDA,0)),U,14) D
"RTN","RCDPESR2",79,0)
 ..D SENDACK^RCDPESR5(RCTDA,1)
"RTN","RCDPESR2",80,0)
 ..S DR=".14////1",DIE="^RCY(344.5,",DA=RCTDA D ^DIE
"RTN","RCDPESR2",81,0)
 ;
"RTN","RCDPESR2",82,0)
 I RCFILE=4 D
"RTN","RCDPESR2",83,0)
 .S RCGBL=$NA(^RCY(344.4,+RCTDA,1,+$P(RCTDA,";",2),1))
"RTN","RCDPESR2",84,0)
 .S RCMNUM=$P($G(^RCY(344.4,+RCTDA,0)),U,12),RCXMG=$P($G(^(0)),U,12)
"RTN","RCDPESR2",85,0)
 .S ^TMP($J,"RCDPEOB","HDR")=$G(^RCY(344.4,+RCTDA,1,+$P(RCTDA,";",2),1,1,0))
"RTN","RCDPESR2",86,0)
 ;
"RTN","RCDPESR2",87,0)
 S RCPAYER=$P($G(^TMP($J,"RCDPEOB","HDR")),U,6)
"RTN","RCDPESR2",88,0)
 S RCDPBNPI=$P($G(^TMP($J,"RCDPEOB","HDR")),U,18)
"RTN","RCDPESR2",89,0)
 ;
"RTN","RCDPESR2",90,0)
 ;srv dates
"RTN","RCDPESR2",91,0)
 S RCSD=$NA(^TMP($J,"RCSRVDT")) K @RCSD
"RTN","RCDPESR2",92,0)
 N CP5 S CP5="",RC=1,C5=0
"RTN","RCDPESR2",93,0)
 F  S RC=$O(@RCGBL@(RC)) Q:'RC  S RC0=$G(^(RC,0)) D
"RTN","RCDPESR2",94,0)
 .I RC0<5 Q
"RTN","RCDPESR2",95,0)
 .I +RC0=5 S C5=RC,CP5=$P(RC0,U,2) Q
"RTN","RCDPESR2",96,0)
 .I +RC0=40,CP5?1.7N,C5,'$D(@RCSD@(C5)) S @RCSD@(C5)=$P(RC0,U,19) ;serv date
"RTN","RCDPESR2",97,0)
 ;
"RTN","RCDPESR2",98,0)
 S RC=1,(RCCT,RCCT1,RCX,REFORM)=0,RCBILL=""
"RTN","RCDPESR2",99,0)
 S RCERR1=$NA(^TMP("RCERR1",$J)) K @RCERR1
"RTN","RCDPESR2",100,0)
 F  S RC=$O(@RCGBL@(RC)) Q:'RC  S RC0=$G(^(RC,0)) D
"RTN","RCDPESR2",101,0)
 .I RCFILE=5,+RC0=1 D  Q
"RTN","RCDPESR2",102,0)
 ..S ^TMP($J,"RCDPEOB","CONTACT")=RC0
"RTN","RCDPESR2",103,0)
 .;
"RTN","RCDPESR2",104,0)
 .I RCFILE=5,+RC0=2 D  Q
"RTN","RCDPESR2",105,0)
 ..S RCX=RCX+1,^TMP($J,"RCDPEOB","ADJ",RCX)=RC0
"RTN","RCDPESR2",106,0)
 .;
"RTN","RCDPESR2",107,0)
 .I +RC0=5 S RCCT=RCCT+1,RCCT1=0 D
"RTN","RCDPESR2",108,0)
 ..S REFORM=0
"RTN","RCDPESR2",109,0)
 ..S Z=$$BILL^RCDPESR1($P(RC0,U,2),$G(@RCSD@(RC)),.RCIB)
"RTN","RCDPESR2",110,0)
 ..I Z S RCBILL=$P($G(^PRCA(430,Z,0)),U) I RCBILL'="",RCBILL'=$P(RC0,U,2) S REFORM=1,$P(RC0,U,2)=RCBILL
"RTN","RCDPESR2",111,0)
 ..S RCBILL=$P(RC0,U,2)
"RTN","RCDPESR2",112,0)
 ..S Z=$S(Z>0:$S($G(RCIB):Z,1:-1),1:-1)
"RTN","RCDPESR2",113,0)
 ..S ^TMP($J,"RCDP-EOB",RCCT,0)=Z_U_RCBILL_U_$G(@RCSD@(RC))
"RTN","RCDPESR2",114,0)
 ..S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,5)=$P(RC0,U,3)_","_$P(RC0,U,4)_" "_$P(RC0,U,5) ;Save pt nm
"RTN","RCDPESR2",115,0)
 ..I Z>0 S Q=+$P($G(^PRCA(430,Z,0)),U,9) I $P($G(^RCD(340,Q,0)),U)["DIC(36," S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,3)=+^RCD(340,Q,0) ;Save ins co
"RTN","RCDPESR2",116,0)
 .;
"RTN","RCDPESR2",117,0)
 .I +RC0>5,REFORM S $P(RC0,U,2)=RCBILL ;
"RTN","RCDPESR2",118,0)
 .I +RC0=10 D  ;Save amt pd/billed, rev flg
"RTN","RCDPESR2",119,0)
 ..S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,2)=$S(+$P(RC0,U,11):$J($P(RC0,U,11)/100,"",2),1:0),$P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,6)=$J($P(RC0,U,11),"",2)
"RTN","RCDPESR2",120,0)
 ..I $P(RC0,U,6)="Y"!($P(RC0,U,7)=22) S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,4)=1
"RTN","RCDPESR2",121,0)
 ..S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,10,14)=RCDPBNPI_U_$P(RC0,U,16,19)
"RTN","RCDPESR2",122,0)
 .I RCBILL=$P(RC0,U,2) S RCCT1=RCCT1+1,^TMP($J,"RCDP-EOB",RCCT,RCCT1,0)=RC0
"RTN","RCDPESR2",123,0)
 ;
"RTN","RCDPESR2",124,0)
 S RCSTAR=$TR($J("",15)," ","*"),RCET=RCSTAR_"ERROR/WARNING EEOB DETAIL SEQ #"
"RTN","RCDPESR2",125,0)
 S RCCT=0 F  S RCCT=$O(^TMP($J,"RCDP-EOB",RCCT)) Q:'RCCT  S RCIFN=+$G(^(RCCT,0)),RCBILL=$P($G(^(0)),U,2),^TMP($J,"RCDPEOB",RCCT)=$G(^TMP($J,"RCDP-EOB",RCCT,0)) D
"RTN","RCDPESR2",126,0)
 .S RCEOB=-1,RCEOBD=""
"RTN","RCDPESR2",127,0)
 .I $S(RCIFN>0:$P(^PRCA(430.3,+$P($G(^PRCA(430,+RCIFN,0)),U,8),0),U,3)'=102,RCIFN'>0&($G(DUP)'>0):1,1:0) D
"RTN","RCDPESR2",128,0)
 ..S @RCERR1@(RCCT)=" ",@RCERR1@(RCCT,1)=RCET_RCCT_RCSTAR
"RTN","RCDPESR2",129,0)
 ..S @RCERR1@(RCCT,2)="Bill "_RCBILL_" is"_$S(RCIFN>0:" not in an ACTIVE status in your A/R",1:"n't valid/wasn't found so its detail wasn't stored in IB")
"RTN","RCDPESR2",130,0)
 ..S:RCFILE=5 @RCERR1@(RCCT,"*")=@RCERR1@(RCCT,2)
"RTN","RCDPESR2",131,0)
 ..S @RCERR1@(RCCT,3)="  The reported amount paid on this bill was: "_$P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U,2)
"RTN","RCDPESR2",132,0)
 ..I RCIFN'>0 D
"RTN","RCDPESR2",133,0)
 ...S @RCERR1@(RCCT,4)="  If the bill is not for your site, it must be transferred to the"
"RTN","RCDPESR2",134,0)
 ...S @RCERR1@(RCCT,5)="   correct site and manually adjusted in your AR."
"RTN","RCDPESR2",135,0)
 ...S @RCERR1@(RCCT,6)="  You can perform this transfer using EDI Lockbox ERA/EEOB exception process."
"RTN","RCDPESR2",136,0)
 ...S @RCERR1@(RCCT,7)=" "
"RTN","RCDPESR2",137,0)
 ..D DISP1^RCDPESR5(RCCT,1)
"RTN","RCDPESR2",138,0)
 ..S Q=0 F  S Q=$O(^TMP($J,"RCDP-EOB",RCCT,Q)) Q:'Q  S ^TMP($J,"RCDPEOB",RCCT,Q)=$G(^TMP($J,"RCDP-EOB",RCCT,Q,0))
"RTN","RCDPESR2",139,0)
 ..S ^TMP($J,"RCDPEOB",RCCT)=^TMP($J,"RCDP-EOB",RCCT,0) M ^TMP($J,"RCDPEOB",RCCT,"ERR")=@RCERR1@(RCCT)
"RTN","RCDPESR2",140,0)
 ..I RCFILE=5 D  ;Store err if trans-in failed
"RTN","RCDPESR2",141,0)
 ...N RCE,RC,DIE,X,Y,DA,DR
"RTN","RCDPESR2",142,0)
 ...S RCE(1)=$$FMTE^XLFDT($$NOW^XLFDT(),2)_" "_$G(@RCERR1@(RCCT,"*"))
"RTN","RCDPESR2",143,0)
 ...S RCE(2)=" ",RCFILED=0
"RTN","RCDPESR2",144,0)
 ...D WP^DIE(344.5,RCTDA_",",5,"A","RCE")
"RTN","RCDPESR2",145,0)
 .I RCIFN>0 D
"RTN","RCDPESR2",146,0)
 ..N RCDUPEOB,RCALLDUP
"RTN","RCDPESR2",147,0)
 ..;Chk rec exists
"RTN","RCDPESR2",148,0)
 ..S RCDUPEOB=0
"RTN","RCDPESR2",149,0)
 ..S RCEOB=$$DUP^RCDPESR3(RCMNUM,RCIFN,$P($G(^TMP($J,"RCDPEOB",RCCT,"EOB")),U,2),$P($G(^TMP($J,"RCDPEOB",RCCT,"EOB")),U,6)) ;Same msg for update?
"RTN","RCDPESR2",150,0)
 ..I RCEOB,$P(RCEOB,U,2) S RCEOB=0  ;If chksum exists, let below check it
"RTN","RCDPESR2",151,0)
 ..S ^TMP($J,"RCDP-EOB",RCCT,.5,0)="835ERA" ;Needed - checksum
"RTN","RCDPESR2",152,0)
 ..S RCALLDUP=$$DUP^IBCEOB("^TMP("_$J_",""RCDP-EOB"","_RCCT_")",RCIFN)
"RTN","RCDPESR2",153,0)
 ..I $S(RCALLDUP:1,RCEOB:$G(DUP)'>0,1:0) D
"RTN","RCDPESR2",154,0)
 ...S RCDUPEOB=1
"RTN","RCDPESR2",155,0)
 ...D DUPREC^RCDPESR6(RCET,RCCT,RCSTAR,RCFILE,RCALLDUP,RCEOB,RCBILL,.RCDUPEOB)
"RTN","RCDPESR2",156,0)
 ...S:RCALLDUP RCEOBD=RCALLDUP
"RTN","RCDPESR2",157,0)
 ..;Add stub to 361.1
"RTN","RCDPESR2",158,0)
 ..I 'RCDUPEOB S RCEOB=+$$ADD3611^IBCEOB(RCMNUM,"","",RCIFN,1,"^TMP("_$J_",""RCDP-EOB"","_RCCT_")") ;IA 4042
"RTN","RCDPESR2",159,0)
 ..K ^TMP($J,"RCDP-EOB",RCCT,.5,0)
"RTN","RCDPESR2",160,0)
 ..I RCEOB<0 D:$G(DUP)'>0  Q
"RTN","RCDPESR2",161,0)
 ...S @RCERR1@(RCCT)=" ",^(RCCT,1)=RCET_RCCT_RCSTAR,RCFILED=0
"RTN","RCDPESR2",162,0)
 ...S @RCERR1@(RCCT,2)="Error - EEOB detail not added to IB for bill "_RCBILL,$P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U)=""
"RTN","RCDPESR2",163,0)
 ...S:RCFILE=5 @RCERR1@(RCCT,"*")=@RCERR1@(RCCT,2)
"RTN","RCDPESR2",164,0)
 ...D DISP1^RCDPESR5(RCCT,1)
"RTN","RCDPESR2",165,0)
 ...S Q=0 F  S Q=$O(^TMP($J,"RCDP-EOB",RCCT,Q)) Q:'Q  S ^TMP($J,"RCDPEOB",RCCT,Q)=$G(^TMP($J,"RCDP-EOB",RCCT,Q,0))
"RTN","RCDPESR2",166,0)
 ...S ^TMP($J,"RCDPEOB",RCCT)=^TMP($J,"RCDP-EOB",RCCT,0) M ^TMP($J,"RCDPEOB",RCCT,"ERR")=@RCERR1@(RCCT)
"RTN","RCDPESR2",167,0)
 ..;Upd 361.1, needs ^TMP($J,"RCDPEOB","HDR" and $J,"RCDP-EOB"
"RTN","RCDPESR2",168,0)
 ..I RCDUPEOB'<0 S RCNOUPD=0 D UPD3611^IBCEOB(RCEOB,RCCT,1)
"RTN","RCDPESR2",169,0)
 ..;errors in ^TMP("RCDPERR-EOB",$J
"RTN","RCDPESR2",170,0)
 ..I $O(^TMP("RCDPERR-EOB",$J,0)) D ERRUPD^IBCEOB(RCEOB,"RCDPERR-EOB")
"RTN","RCDPESR2",171,0)
 ..S $P(^TMP($J,"RCDPEOB",RCCT,"EOB"),U)=$S('$G(RCEOBD):RCEOB,1:RCEOBD)
"RTN","RCDPESR2",172,0)
 .K ^TMP("RCDPERR-EOB",$J)
"RTN","RCDPESR2",173,0)
 ;
"RTN","RCDPESR2",174,0)
 I RCNOUPD D DUPERA^RCDPESR3($G(DUP),RCNOUPD)
"RTN","RCDPESR2",175,0)
 I $O(@RCERR1@("")) D BULLS^RCDPESR3(RCFILE,RCTDA,$S(RCNOUPD:RCNOUPD,1:$G(DUP)),$G(RCXMG))
"RTN","RCDPESR2",176,0)
 K ^TMP("RCDPERR-EOB",$J),^TMP($J,"RCDP-EOB"),@RCERR1,@RCSD
"RTN","RCDPESR2",177,0)
 D CLEAN^DILF
"RTN","RCDPESR2",178,0)
 Q
"VER")
8.0^22.0
"BLD",8269,6)
^245
**END**
**END**
