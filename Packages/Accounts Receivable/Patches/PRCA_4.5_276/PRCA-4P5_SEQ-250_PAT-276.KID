Released PRCA*4.5*276 SEQ #250
Extracted from mail message
**KIDS**:PRCA*4.5*276^

**INSTALL NAME**
PRCA*4.5*276
"BLD",7678,0)
PRCA*4.5*276^ACCOUNTS RECEIVABLE^0^3111208^y
"BLD",7678,4,0)
^9.64PA^344.4^2
"BLD",7678,4,344.31,0)
344.31
"BLD",7678,4,344.31,2,0)
^9.641^344.31^1
"BLD",7678,4,344.31,2,344.31,0)
EDI THIRD PARTY EFT DETAIL  (File-top level)
"BLD",7678,4,344.31,2,344.31,1,0)
^9.6411^.19^3
"BLD",7678,4,344.31,2,344.31,1,.17,0)
REMOVED BY
"BLD",7678,4,344.31,2,344.31,1,.18,0)
REMOVED DATE
"BLD",7678,4,344.31,2,344.31,1,.19,0)
REMOVAL JUSTIFICATION
"BLD",7678,4,344.31,222)
y^n^p^^^^n^^n
"BLD",7678,4,344.31,224)

"BLD",7678,4,344.4,0)
344.4
"BLD",7678,4,344.4,2,0)
^9.641^344.4^1
"BLD",7678,4,344.4,2,344.4,0)
ELECTRONIC REMITTANCE ADVICE  (File-top level)
"BLD",7678,4,344.4,2,344.4,1,0)
^9.6411^.04^6
"BLD",7678,4,344.4,2,344.4,1,.04,0)
ERA DATE
"BLD",7678,4,344.4,2,344.4,1,.16,0)
RETURNED BY
"BLD",7678,4,344.4,2,344.4,1,.17,0)
RETURNED DATE
"BLD",7678,4,344.4,2,344.4,1,.18,0)
RETURN JUSTIFICATION
"BLD",7678,4,344.4,2,344.4,1,7.01,0)
DATE/TIME ERA LINKED
"BLD",7678,4,344.4,2,344.4,1,7.02,0)
ERA LINKED BY
"BLD",7678,4,344.4,222)
y^n^p^^^^n^^n
"BLD",7678,4,344.4,224)

"BLD",7678,4,"APDD",344.31,344.31)

"BLD",7678,4,"APDD",344.31,344.31,.17)

"BLD",7678,4,"APDD",344.31,344.31,.18)

"BLD",7678,4,"APDD",344.31,344.31,.19)

"BLD",7678,4,"APDD",344.4,344.4)

"BLD",7678,4,"APDD",344.4,344.4,.04)

"BLD",7678,4,"APDD",344.4,344.4,.16)

"BLD",7678,4,"APDD",344.4,344.4,.17)

"BLD",7678,4,"APDD",344.4,344.4,.18)

"BLD",7678,4,"APDD",344.4,344.4,7.01)

"BLD",7678,4,"APDD",344.4,344.4,7.02)

"BLD",7678,4,"B",344.31,344.31)

"BLD",7678,4,"B",344.4,344.4)

"BLD",7678,6.3)
87
"BLD",7678,"ABPKG")
n
"BLD",7678,"INI")
PR^PRCAP276
"BLD",7678,"INID")
^y^n
"BLD",7678,"INIT")
POST^PRCAP276
"BLD",7678,"KRN",0)
^9.67PA^779.2^20
"BLD",7678,"KRN",.4,0)
.4
"BLD",7678,"KRN",.4,"NM",0)
^9.68A^2^2
"BLD",7678,"KRN",.4,"NM",1,0)
PRCA BILL LIST    FILE #430^430^0
"BLD",7678,"KRN",.4,"NM",2,0)
PRCA TRANS PROFILE    FILE #433^433^0
"BLD",7678,"KRN",.4,"NM","B","PRCA BILL LIST    FILE #430",1)

"BLD",7678,"KRN",.4,"NM","B","PRCA TRANS PROFILE    FILE #433",2)

"BLD",7678,"KRN",.401,0)
.401
"BLD",7678,"KRN",.401,"NM",0)
^9.68A^^
"BLD",7678,"KRN",.402,0)
.402
"BLD",7678,"KRN",.402,"NM",0)
^9.68A^^
"BLD",7678,"KRN",.403,0)
.403
"BLD",7678,"KRN",.403,"NM",0)
^9.68A^^
"BLD",7678,"KRN",.5,0)
.5
"BLD",7678,"KRN",.5,"NM",0)
^9.68A^^
"BLD",7678,"KRN",.84,0)
.84
"BLD",7678,"KRN",3.6,0)
3.6
"BLD",7678,"KRN",3.8,0)
3.8
"BLD",7678,"KRN",3.8,"NM",0)
^9.68A^2^2
"BLD",7678,"KRN",3.8,"NM",1,0)
RCDPE AUDIT^^0
"BLD",7678,"KRN",3.8,"NM",2,0)
RCDPE MOVE COPY^^0
"BLD",7678,"KRN",3.8,"NM","B","RCDPE AUDIT",1)

"BLD",7678,"KRN",3.8,"NM","B","RCDPE MOVE COPY",2)

"BLD",7678,"KRN",9.2,0)
9.2
"BLD",7678,"KRN",9.8,0)
9.8
"BLD",7678,"KRN",9.8,"NM",0)
^9.68A^49^33
"BLD",7678,"KRN",9.8,"NM",4,0)
RCDPEWL7^^0^B93160515
"BLD",7678,"KRN",9.8,"NM",6,0)
RCDPE8NZ^^0^B54377716
"BLD",7678,"KRN",9.8,"NM",9,0)
PRCAAPR^^0^B12999899
"BLD",7678,"KRN",9.8,"NM",10,0)
PRCAATR^^0^B18030407
"BLD",7678,"KRN",9.8,"NM",11,0)
RCDPBPLM^^0^B56287524
"BLD",7678,"KRN",9.8,"NM",12,0)
RCDPRTP1^^0^B33114320
"BLD",7678,"KRN",9.8,"NM",13,0)
RCDPRTP2^^0^B14571790
"BLD",7678,"KRN",9.8,"NM",15,0)
PRCAAPR1^^0^B43343192
"BLD",7678,"KRN",9.8,"NM",16,0)
RCDPBTLM^^0^B49476140
"BLD",7678,"KRN",9.8,"NM",17,0)
RCDPEDA1^^0^B22465629
"BLD",7678,"KRN",9.8,"NM",22,0)
RCDPEDAR^^0^B105086845
"BLD",7678,"KRN",9.8,"NM",23,0)
PRCABIL1^^0^B25296320
"BLD",7678,"KRN",9.8,"NM",25,0)
RCDPAYER^^0^B25868382
"BLD",7678,"KRN",9.8,"NM",27,0)
RCDPEWL8^^0^B78778752
"BLD",7678,"KRN",9.8,"NM",30,0)
PRCAP276^^0^B2991391
"BLD",7678,"KRN",9.8,"NM",31,0)
RCDPEWL3^^0^B86449608
"BLD",7678,"KRN",9.8,"NM",32,0)
RCDPEWL6^^0^B83585540
"BLD",7678,"KRN",9.8,"NM",33,0)
RCBEUBIL^^0^B20763062
"BLD",7678,"KRN",9.8,"NM",34,0)
RCBEUTR1^^0^B35457473
"BLD",7678,"KRN",9.8,"NM",36,0)
RCDPRPL4^^0^B35834476
"BLD",7678,"KRN",9.8,"NM",37,0)
RCDPEAC^^0^B83292786
"BLD",7678,"KRN",9.8,"NM",38,0)
RCDPEM^^0^B59208170
"BLD",7678,"KRN",9.8,"NM",39,0)
RCDPEM2^^0^B171488766
"BLD",7678,"KRN",9.8,"NM",40,0)
RCDPEM3^^0^B109331342
"BLD",7678,"KRN",9.8,"NM",41,0)
RCDPEM4^^0^B186028415
"BLD",7678,"KRN",9.8,"NM",42,0)
RCDPEM5^^0^B72301084
"BLD",7678,"KRN",9.8,"NM",43,0)
RCDPEM6^^0^B40220654
"BLD",7678,"KRN",9.8,"NM",44,0)
RCDPEM7^^0^B44597294
"BLD",7678,"KRN",9.8,"NM",45,0)
RCDPEM8^^0^B32433593
"BLD",7678,"KRN",9.8,"NM",46,0)
RCDPEM9^^0^B25446642
"BLD",7678,"KRN",9.8,"NM",47,0)
RCDPEAR^^0^B2410803
"BLD",7678,"KRN",9.8,"NM",48,0)
RCDPEAR1^^0^B109842855
"BLD",7678,"KRN",9.8,"NM",49,0)
RCDPEAR2^^0^B60443432
"BLD",7678,"KRN",9.8,"NM","B","PRCAAPR",9)

"BLD",7678,"KRN",9.8,"NM","B","PRCAAPR1",15)

"BLD",7678,"KRN",9.8,"NM","B","PRCAATR",10)

"BLD",7678,"KRN",9.8,"NM","B","PRCABIL1",23)

"BLD",7678,"KRN",9.8,"NM","B","PRCAP276",30)

"BLD",7678,"KRN",9.8,"NM","B","RCBEUBIL",33)

"BLD",7678,"KRN",9.8,"NM","B","RCBEUTR1",34)

"BLD",7678,"KRN",9.8,"NM","B","RCDPAYER",25)

"BLD",7678,"KRN",9.8,"NM","B","RCDPBPLM",11)

"BLD",7678,"KRN",9.8,"NM","B","RCDPBTLM",16)

"BLD",7678,"KRN",9.8,"NM","B","RCDPE8NZ",6)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEAC",37)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEAR",47)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEAR1",48)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEAR2",49)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEDA1",17)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEDAR",22)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEM",38)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEM2",39)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEM3",40)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEM4",41)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEM5",42)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEM6",43)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEM7",44)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEM8",45)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEM9",46)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEWL3",31)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEWL6",32)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEWL7",4)

"BLD",7678,"KRN",9.8,"NM","B","RCDPEWL8",27)

"BLD",7678,"KRN",9.8,"NM","B","RCDPRPL4",36)

"BLD",7678,"KRN",9.8,"NM","B","RCDPRTP1",12)

"BLD",7678,"KRN",9.8,"NM","B","RCDPRTP2",13)

"BLD",7678,"KRN",19,0)
19
"BLD",7678,"KRN",19,"NM",0)
^9.68A^15^11
"BLD",7678,"KRN",19,"NM",1,0)
RCDPE WORKLOAD NOTIFICATION^^0
"BLD",7678,"KRN",19,"NM",2,0)
RCDPE ERA POSTED BY PAPER EOB^^0
"BLD",7678,"KRN",19,"NM",5,0)
RCDPE RETURNED ERA AUDIT^^0^
"BLD",7678,"KRN",19,"NM",6,0)
RCDPE EFT AUDIT REPORT^^0^
"BLD",7678,"KRN",19,"NM",8,0)
RCDPE EEOB MOVE/COPY^^0^
"BLD",7678,"KRN",19,"NM",9,0)
RCDPE EEOB MOVE/COPY REPORT^^0^
"BLD",7678,"KRN",19,"NM",10,0)
RCDPE ERA W/PAPER EOB REPORT^^0^
"BLD",7678,"KRN",19,"NM",12,0)
RCDPE REMOVE DUP DEPOSITS^^0
"BLD",7678,"KRN",19,"NM",13,0)
RCDPE EDI LOCKBOX MENU^^2
"BLD",7678,"KRN",19,"NM",14,0)
RCDPE EDI LOCKBOX REPORTS MENU^^2
"BLD",7678,"KRN",19,"NM",15,0)
RCDPE ERA RETURNED TO PAYER^^0
"BLD",7678,"KRN",19,"NM","B","RCDPE EDI LOCKBOX MENU",13)

"BLD",7678,"KRN",19,"NM","B","RCDPE EDI LOCKBOX REPORTS MENU",14)

"BLD",7678,"KRN",19,"NM","B","RCDPE EEOB MOVE/COPY",8)

"BLD",7678,"KRN",19,"NM","B","RCDPE EEOB MOVE/COPY REPORT",9)

"BLD",7678,"KRN",19,"NM","B","RCDPE EFT AUDIT REPORT",6)

"BLD",7678,"KRN",19,"NM","B","RCDPE ERA POSTED BY PAPER EOB",2)

"BLD",7678,"KRN",19,"NM","B","RCDPE ERA RETURNED TO PAYER",15)

"BLD",7678,"KRN",19,"NM","B","RCDPE ERA W/PAPER EOB REPORT",10)

"BLD",7678,"KRN",19,"NM","B","RCDPE REMOVE DUP DEPOSITS",12)

"BLD",7678,"KRN",19,"NM","B","RCDPE RETURNED ERA AUDIT",5)

"BLD",7678,"KRN",19,"NM","B","RCDPE WORKLOAD NOTIFICATION",1)

"BLD",7678,"KRN",19.1,0)
19.1
"BLD",7678,"KRN",19.1,"NM",0)
^9.68A^3^2
"BLD",7678,"KRN",19.1,"NM",2,0)
RCDPE REMOVE DUPLICATES^^0
"BLD",7678,"KRN",19.1,"NM",3,0)
RCDPE MARK ERA^^0
"BLD",7678,"KRN",19.1,"NM","B","RCDPE MARK ERA",3)

"BLD",7678,"KRN",19.1,"NM","B","RCDPE REMOVE DUPLICATES",2)

"BLD",7678,"KRN",101,0)
101
"BLD",7678,"KRN",101,"NM",0)
^9.68A^1^1
"BLD",7678,"KRN",101,"NM",1,0)
RCDPE EOB WORKLIST ADJUST^^0
"BLD",7678,"KRN",101,"NM","B","RCDPE EOB WORKLIST ADJUST",1)

"BLD",7678,"KRN",409.61,0)
409.61
"BLD",7678,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",7678,"KRN",771,0)
771
"BLD",7678,"KRN",779.2,0)
779.2
"BLD",7678,"KRN",870,0)
870
"BLD",7678,"KRN",8989.51,0)
8989.51
"BLD",7678,"KRN",8989.52,0)
8989.52
"BLD",7678,"KRN",8994,0)
8994
"BLD",7678,"KRN","B",.4,.4)

"BLD",7678,"KRN","B",.401,.401)

"BLD",7678,"KRN","B",.402,.402)

"BLD",7678,"KRN","B",.403,.403)

"BLD",7678,"KRN","B",.5,.5)

"BLD",7678,"KRN","B",.84,.84)

"BLD",7678,"KRN","B",3.6,3.6)

"BLD",7678,"KRN","B",3.8,3.8)

"BLD",7678,"KRN","B",9.2,9.2)

"BLD",7678,"KRN","B",9.8,9.8)

"BLD",7678,"KRN","B",19,19)

"BLD",7678,"KRN","B",19.1,19.1)

"BLD",7678,"KRN","B",101,101)

"BLD",7678,"KRN","B",409.61,409.61)

"BLD",7678,"KRN","B",771,771)

"BLD",7678,"KRN","B",779.2,779.2)

"BLD",7678,"KRN","B",870,870)

"BLD",7678,"KRN","B",8989.51,8989.51)

"BLD",7678,"KRN","B",8989.52,8989.52)

"BLD",7678,"KRN","B",8994,8994)

"BLD",7678,"QUES",0)
^9.62^^
"BLD",7678,"REQB",0)
^9.611^38^10
"BLD",7678,"REQB",29,0)
PRCA*4.5*269^2
"BLD",7678,"REQB",30,0)
IB*2.0*451^2
"BLD",7678,"REQB",31,0)
PRCA*4.5*247^2
"BLD",7678,"REQB",32,0)
PRCA*4.5*241^2
"BLD",7678,"REQB",33,0)
PRCA*4.5*233^2
"BLD",7678,"REQB",34,0)
PRCA*4.5*221^2
"BLD",7678,"REQB",35,0)
PRCA*4.5*220^2
"BLD",7678,"REQB",36,0)
PRCA*4.5*218^2
"BLD",7678,"REQB",37,0)
PRCA*4.5*151^2
"BLD",7678,"REQB",38,0)
PRCA*4.5*271^2
"BLD",7678,"REQB","B","IB*2.0*451",30)

"BLD",7678,"REQB","B","PRCA*4.5*151",37)

"BLD",7678,"REQB","B","PRCA*4.5*218",36)

"BLD",7678,"REQB","B","PRCA*4.5*220",35)

"BLD",7678,"REQB","B","PRCA*4.5*221",34)

"BLD",7678,"REQB","B","PRCA*4.5*233",33)

"BLD",7678,"REQB","B","PRCA*4.5*241",32)

"BLD",7678,"REQB","B","PRCA*4.5*247",31)

"BLD",7678,"REQB","B","PRCA*4.5*269",29)

"BLD",7678,"REQB","B","PRCA*4.5*271",38)

"FIA",344.31)
EDI THIRD PARTY EFT DETAIL
"FIA",344.31,0)
^RCY(344.31,
"FIA",344.31,0,0)
344.31PI
"FIA",344.31,0,1)
y^n^p^^^^n^^n
"FIA",344.31,0,10)

"FIA",344.31,0,11)

"FIA",344.31,0,"RLRO")

"FIA",344.31,0,"VR")
4.5^PRCA
"FIA",344.31,344.31)
1
"FIA",344.31,344.31,.17)

"FIA",344.31,344.31,.18)

"FIA",344.31,344.31,.19)

"FIA",344.4)
ELECTRONIC REMITTANCE ADVICE
"FIA",344.4,0)
^RCY(344.4,
"FIA",344.4,0,0)
344.4I
"FIA",344.4,0,1)
y^n^p^^^^n^^n
"FIA",344.4,0,10)

"FIA",344.4,0,11)

"FIA",344.4,0,"RLRO")

"FIA",344.4,0,"VR")
4.5^PRCA
"FIA",344.4,344.4)
1
"FIA",344.4,344.4,.04)

"FIA",344.4,344.4,.16)

"FIA",344.4,344.4,.17)

"FIA",344.4,344.4,.18)

"FIA",344.4,344.4,7.01)

"FIA",344.4,344.4,7.02)

"INI")
PR^PRCAP276
"INIT")
POST^PRCAP276
"KRN",.4,418,-1)
0^1
"KRN",.4,418,0)
PRCA BILL LIST^3111206.1048^^430^^^3111208
"KRN",.4,418,"%D",0)
^^2^2^2881006^
"KRN",.4,418,"%D",1,0)
This template prints a listing of bills and their original amounts.
"KRN",.4,418,"%D",2,0)
OPTION: PRCA BILL LIST
"KRN",.4,418,"F",1)

"KRN",.4,418,"F",2)
S PRCOUT=$$COMP3^PRCAAPR(D0) I PRCOUT'="%" S PRCOUT=$$IBEEOBCK^PRCAAPR1(D0);X;"";Z;"S PRCOUT=$$COMP3^PRCAAPR(D0) I PRCOUT'="%" S PRCOUT=$$IBEEOBCK^PRCAAPR1(D0)"~
"KRN",.4,418,"F",3)
W $G(PRCOUT)_$P($G(^PRCA(430,D0,0)),"^",1);C1;L12;"Bill #";Z;"W $G(PRCOUT)_$P($G(^PRCA(430,D0,0)),"^",1)"~
"KRN",.4,418,"F",4)
S DIP(1)=$S($D(^PRCA(430,D0,0)):^(0),1:"") S X=$P(DIP(1),U,10) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;L8;C15;"Date Prepared";Z;"NUMDATE(DATE BILL PREPARED)"~
"KRN",.4,418,"F",5)
9;L15;C25;"Debtor"~100;L4;C42;"Form Type"~8;L10;C48;"Status"~3;C60;L9;"Original Amount"~11;C71;L9;"Current Balance"~
"KRN",.4,418,"H")
ACCOUNTS RECEIVABLE LIST
"KRN",.4,452,-1)
0^2
"KRN",.4,452,0)
PRCA TRANS PROFILE^3111005.1354^^433^^^3110517
"KRN",.4,452,"%D",0)
^^1^1^2890124^
"KRN",.4,452,"%D",1,0)
This template displays/prints a profile for transaction of an AR.
"KRN",.4,452,"DXS")
4
"KRN",.4,452,"DXS",1,9.2)
S I(0,0)=$G(D0),DIP(1)=$S($D(^PRCA(433,D0,0)):^(0),1:""),D0=$P(DIP(1),U,2) S:'D0!'$D(^PRCA(430,+D0,0)) D0=-1 S I(100,0)=$G(D0),DIP(101)=$S($D(^PRCA(430,D0,0)):^(0),1:"")
"KRN",.4,452,"DXS",1,9.3)
X DXS(1,9.2) S DIP(102)=$G(X),D0=$P(DIP(101),U,9) S:'D0!'$D(^RCD(340,+D0,0)) D0=-1 S DIP(201)=$S($D(^RCD(340,D0,0)):^(0),1:"")
"KRN",.4,452,"DXS",2,9)
S PRCOUT=$$COMP3^PRCAAPR($P(X,"^",2)) S:PRCOUT'="%" PRCOUT=$$IBEEOBCK^PRCAAPR1($P(X,"^",2)) W ?50,$G(PRCOUT)_$P(^PRCA(430,$P(X,"^",2),0),"^",1)
"KRN",.4,452,"DXS",3,9)
X DXS(3,9.3) S X=X S Y=X,X=DIP(6),X=X S X=X_Y_")",DIP(7)=$G(X) S X=1,DIP(8)=$G(X) S X="",X=$S(DIP(5):DIP(7),DIP(8):X) S Y=X,X=DIP(2),X=X_Y
"KRN",.4,452,"DXS",3,9.2)
S DIP(4)=$C(59)_$P($G(^DD(433,7,0)),U,3),DIP(3)=$S($D(^PRCA(433,D0,0)):^(0),1:""),DIP(1)=$S($D(^PRCA(433,D0,1)):^(1),1:"") S X=$P($G(^PRCA(430.3,+$P(DIP(1),U,2),0)),U)
"KRN",.4,452,"DXS",3,9.3)
X DXS(3,9.2) S DIP(2)=$G(X) S X=$P($P(DIP(4),$C(59)_$P(DIP(3),U,7)_":",2),$C(59))]"",DIP(5)=$G(X) S X=" (",DIP(6)=$G(X) S X=$P(DIP(3),U,7)
"KRN",.4,452,"F",1)
"ACCOUNT:";C1~N DIERR X DXS(1,9.3) S X=$$EXTERNAL^DIDU(340,.01,"",$P(DIP(201),U,1)) S D0=I(0,0) W X K DIP;C10;L25;Z;".03:9"~"SSN:";C35~
"KRN",.4,452,"F",2)
S X=$$SSN^RCFN01(+$$EN^PRCAFN1(D0)),X=$S(X<0:"",1:X) W ?40,X;Z;"S X=$$SSN^RCFN01(+$$EN^PRCAFN1(D0)),X=$S(X<0:"",1:X) W ?40,X"~"TRANS. NO:";C1~
"KRN",.4,452,"F",3)
.01;C12;L9~"BILL NO:";C35~
"KRN",.4,452,"F",4)
X DXS(2,9);Z;"S PRCOUT=$$COMP3^PRCAAPR($P(X,"^",2)) S:PRCOUT'="%" PRCOUT=$$IBEEOBCK^PRCAAPR1($P(X,"^",2)) W ?50,$G(PRCOUT)_$P(^PRCA(430,$P(X,"^",2),0),"^",1)"~
"KRN",.4,452,"F",5)
"TRANS. DATE:";C1~11;C18~"TRANS. TYPE:";C35~X DXS(3,9) W X K DIP;C50;L26;Z;"TRANSACTION TYPE_$S(#7]"":" ("_INTERNAL(#7)_")",1:"")"~
"KRN",.4,452,"F",6)
D EN1^PRCADR3;Z;"D EN1^PRCADR3"~" ";C1~"Brief Comment: ";C1~5.02;C16~"Follow-up Date: ";C50~
"KRN",.4,452,"F",7)
S DIP(1)=$S($D(^PRCA(433,D0,5)):^(5),1:"") S X=$P(DIP(1),U,3) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;C66;Z;"NUMDATE(FOLLOW-UP DATE)"~
"KRN",.4,452,"F",8)
" ";C1~"COMMENTS: ";S1;C1~86;C13;L75~41,.01;C13~"RECEIPT #: ";C1~13~"PROCESSED BY: ";S1;C1~42~
"KRN",.4,452,"H")
@
"KRN",.4,452,"IOM")
80
"KRN",.4,452,"LAST")

"KRN",.4,452,"ROU")
^PRCATR3
"KRN",.4,452,"ROUOLD")
PRCATR3
"KRN",.4,452,"SUB")
1
"KRN",3.8,342,-1)
0^1
"KRN",3.8,342,0)
RCDPE AUDIT^PU^y^^^0^
"KRN",3.8,342,2,0)
^3.801^3^3^3111110^^^^
"KRN",3.8,342,2,1,0)
This is the mail group that will receive warning bulletins produced by the
"KRN",3.8,342,2,2,0)
ePayments Workload Notification process. Warnings for overdue EFT and ERA
"KRN",3.8,342,2,3,0)
are sent to this group.
"KRN",3.8,342,3)

"KRN",3.8,348,-1)
0^2
"KRN",3.8,348,0)
RCDPE MOVE COPY^PU^y^^^^
"KRN",3.8,348,2,0)
^^3^3^3111205^
"KRN",3.8,348,2,1,0)
This is the mail group that will receive bulletins sent by the AR nightly 
"KRN",3.8,348,2,2,0)
process. Details of EOB any move or copy transactions from the EDI Lockbox
"KRN",3.8,348,2,3,0)
menu option 'EEOB Move/Copy' are included in the bulletin.
"KRN",3.8,348,3)

"KRN",3.8,348,5,0)
^3.811P
"KRN",19,2927821,-1)
2^13
"KRN",19,2927821,0)
RCDPE EDI LOCKBOX MENU^EDI Lockbox^^M^66481^^^^^^^
"KRN",19,2927821,10,0)
^19.01IP^15^12
"KRN",19,2927821,10,7,0)
2927824^REP
"KRN",19,2927821,10,7,"^")
RCDPE EDI LOCKBOX REPORTS MENU
"KRN",19,2927821,10,11,0)
2927830^UP
"KRN",19,2927821,10,11,"^")
RCDPE ERA POSTED BY PAPER EOB
"KRN",19,2927821,10,13,0)
2928165^RET
"KRN",19,2927821,10,13,"^")
RCDPE ERA RETURNED TO PAYER
"KRN",19,2927821,10,14,0)
2929253^MC
"KRN",19,2927821,10,14,"^")
RCDPE EEOB MOVE/COPY
"KRN",19,2927821,10,15,0)
2929255^REFT
"KRN",19,2927821,10,15,"^")
RCDPE REMOVE DUP DEPOSITS
"KRN",19,2927821,"U")
EDI LOCKBOX
"KRN",19,2927824,-1)
2^14
"KRN",19,2927824,0)
RCDPE EDI LOCKBOX REPORTS MENU^EDI Lockbox Reports Menu^^M^66481^^^^^^^
"KRN",19,2927824,10,0)
^19.01IP^12^11
"KRN",19,2927824,10,9,0)
2929254^RETR^
"KRN",19,2927824,10,9,"^")
RCDPE RETURNED ERA AUDIT
"KRN",19,2927824,10,10,0)
2929256^POSR^
"KRN",19,2927824,10,10,"^")
RCDPE ERA W/PAPER EOB REPORT
"KRN",19,2927824,10,11,0)
2929257^DUPR
"KRN",19,2927824,10,11,"^")
RCDPE EFT AUDIT REPORT
"KRN",19,2927824,10,12,0)
2929258^MCR
"KRN",19,2927824,10,12,"^")
RCDPE EEOB MOVE/COPY REPORT
"KRN",19,2927824,"U")
EDI LOCKBOX REPORTS MENU
"KRN",19,2927830,-1)
0^2
"KRN",19,2927830,0)
RCDPE ERA POSTED BY PAPER EOB^Update ERA Posted Using Paper EOB^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,2927830,1,0)
^19.06^4^4^3030828^^^^
"KRN",19,2927830,1,1,0)
This option is used to mark an ERA as posted when the paper EOB containing
"KRN",19,2927830,1,2,0)
this ERA data was posted to your A/R and FMS and no reference to the ERA
"KRN",19,2927830,1,3,0)
was included.  This will mark the ERA as posted.  It will require you to
"KRN",19,2927830,1,4,0)
enter the receipt # that was used to post the ERA information.
"KRN",19,2927830,25)
POSTED^RCDPEM2
"KRN",19,2927830,"U")
UPDATE ERA POSTED USING PAPER 
"KRN",19,2928165,-1)
0^15
"KRN",19,2928165,0)
RCDPE ERA RETURNED TO PAYER^Mark ERA Returned To Payer^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,2928165,1,0)
^^4^4^3110915^
"KRN",19,2928165,1,1,0)
This option allows you to mark an ERA as RETURNED TO PAYER/NOT POSTED.
"KRN",19,2928165,1,2,0)
You may only select an ERA that is unmatched to paper check and that is 
"KRN",19,2928165,1,3,0)
UNPOSTED.  This marks the POSTED status of the ERA as NOT POSTED-RETURNED 
"KRN",19,2928165,1,4,0)
and the EFT MATCH STATUS to MATCHED TO PAPER CHECK.
"KRN",19,2928165,25)
RETN^RCDPEM2
"KRN",19,2928165,"U")
MARK ERA RETURNED TO PAYER
"KRN",19,2929252,-1)
0^1
"KRN",19,2929252,0)
RCDPE WORKLOAD NOTIFICATION^ePayments Workload Notifications^^A^^^^^^^^ACCOUNTS RECEIVABLE^^1
"KRN",19,2929252,1,0)
^19.06^3^3^3110513^^^
"KRN",19,2929252,1,1,0)
This scheduled option sends warnings bulletins to the RCDPE AUDIT mail 
"KRN",19,2929252,1,2,0)
group. Bulletins are created for ERA over 30 days overdue and EFT over 14 
"KRN",19,2929252,1,3,0)
days overdue.
"KRN",19,2929252,10.1)
Workload Notification
"KRN",19,2929252,20)
D EN^RCDPEM7
"KRN",19,2929252,200.9)
y
"KRN",19,2929252,"U")
EPAYMENTS WORKLOAD NOTIFICATIO
"KRN",19,2929253,-1)
0^8
"KRN",19,2929253,0)
RCDPE EEOB MOVE/COPY^EEOB Move/Copy^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,2929253,1,0)
^19.06^2^2^3110318^^
"KRN",19,2929253,1,1,0)
This option allows an EEOB incorrectly matched to a claim to be moved to 
"KRN",19,2929253,1,2,0)
the correct claim or claims.
"KRN",19,2929253,25)
EN^RCDPEM5
"KRN",19,2929253,"U")
EEOB MOVE/COPY
"KRN",19,2929254,-1)
0^5
"KRN",19,2929254,0)
RCDPE RETURNED ERA AUDIT^Mark ERAs Returned to Payer Audit Report^^R^^^^^^^^ACCOUNTS RECEIVABLE^^
"KRN",19,2929254,1,0)
^^2^2^3110328^
"KRN",19,2929254,1,1,0)
This report lists ERAs that have been marked as returned to payer.  It 
"KRN",19,2929254,1,2,0)
can be filtered by Station/Division and by date range.
"KRN",19,2929254,10.1)

"KRN",19,2929254,20)

"KRN",19,2929254,25)
EN^RCDPEM3
"KRN",19,2929254,"U")
MARK ERAS RETURNED TO PAYER AU
"KRN",19,2929255,-1)
0^12
"KRN",19,2929255,0)
RCDPE REMOVE DUP DEPOSITS^Remove Duplicate EFT Deposits^^R^^^^^^^^^^
"KRN",19,2929255,1,0)
^^2^2^3110408^
"KRN",19,2929255,1,1,0)
Allows authorized users to mark and EFT as a duplicate.  Requires that 
"KRN",19,2929255,1,2,0)
the user have the RCDPE REMOVE DUPLICATES security key.
"KRN",19,2929255,10.1)

"KRN",19,2929255,20)

"KRN",19,2929255,25)
RETN^RCDPEM3
"KRN",19,2929255,"U")
REMOVE DUPLICATE EFT DEPOSITS
"KRN",19,2929256,-1)
0^10
"KRN",19,2929256,0)
RCDPE ERA W/PAPER EOB REPORT^ERAs Posted with Paper EOB Audit Report^^R^^^^^^^y^ACCOUNTS RECEIVABLE
"KRN",19,2929256,1,0)
^19.06^2^2^3110825^^
"KRN",19,2929256,1,1,0)
This report lists ERAs that have been marked as posted with paper EOB.
"KRN",19,2929256,1,2,0)
The report can be filtered by Station/Division and by date range.  
"KRN",19,2929256,25)
POST^RCDPEM4
"KRN",19,2929256,"U")
ERAS POSTED WITH PAPER EOB AUD
"KRN",19,2929257,-1)
0^6
"KRN",19,2929257,0)
RCDPE EFT AUDIT REPORT^Duplicate EFT Deposits Audit Report^^R^^^^^^^^ACCOUNTS RECEIVABLE^^
"KRN",19,2929257,1,0)
^19.06^1^1^3110824^^^^
"KRN",19,2929257,1,1,0)
This report lists EFTs which have been marked as duplicates.
"KRN",19,2929257,10.1)

"KRN",19,2929257,20)

"KRN",19,2929257,25)
EN1^RCDPEM6
"KRN",19,2929257,"U")
DUPLICATE EFT DEPOSITS AUDIT R
"KRN",19,2929258,-1)
0^9
"KRN",19,2929258,0)
RCDPE EEOB MOVE/COPY REPORT^EEOB Move/Copy Audit Report^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,2929258,1,0)
^^2^2^3110426^
"KRN",19,2929258,1,1,0)
This report lists EOBs that have been moved or copied to new claim
"KRN",19,2929258,1,2,0)
numbers. The report can be filtered by Station/Division and by date range.
"KRN",19,2929258,25)
EOB^RCDPEM4
"KRN",19,2929258,"U")
EEOB MOVE/COPY AUDIT REPORT
"KRN",19.1,538,-1)
0^2
"KRN",19.1,538,0)
RCDPE REMOVE DUPLICATES^Remove Duplicate EFTs
"KRN",19.1,538,1,0)
^^1^1^3110822^
"KRN",19.1,538,1,1,0)
Restricts usage of the Remove Duplicate EFT Deposits option.
"KRN",19.1,552,-1)
0^3
"KRN",19.1,552,0)
RCDPE MARK ERA^Mark ERA Returned to Payer
"KRN",19.1,552,1,0)
^^1^1^3110822^
"KRN",19.1,552,1,1,0)
Restricts usage of the Mark ERA Returned to Payer option.
"KRN",101,3798,-1)
0^1
"KRN",101,3798,0)
RCDPE EOB WORKLIST ADJUST^Adjust (Inc/Dec)^^A^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",101,3798,20)
D ADJUST^RCDPEWL6
"KRN",101,3798,24)

"KRN",101,3798,99)
59478,54074
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",158,-1)
1^1
"PKG",158,0)
ACCOUNTS RECEIVABLE^PRCA^FMS
"PKG",158,20,0)
^9.402P^1^1
"PKG",158,20,1,0)
2^^PRCAMRG
"PKG",158,20,1,1)

"PKG",158,20,"B",2,1)

"PKG",158,22,0)
^9.49I^1^1
"PKG",158,22,1,0)
4.5^2950320^2960423
"PKG",158,22,1,"PAH",1,0)
276^3111208
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
33
"RTN","PRCAAPR")
0^9^B12999899^B10684039
"RTN","PRCAAPR",1,0)
PRCAAPR ;WASH-ISC@ALTOONA,PA/RGY - PATIENT ACCOUNT PROFILE (CONT) ;3/9/94  8:41 AM
"RTN","PRCAAPR",2,0)
V ;;4.5;Accounts Receivable;**198,221,276**;Mar 20, 1995;Build 87
"RTN","PRCAAPR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCAAPR",4,0)
EN(PRCATY) ;
"RTN","PRCAAPR",5,0)
 NEW DIC,X,Y,DEBT,PRCADB,DA,PRCA,COUNT,OUT,SEL,BILL,BAT,TRAN,DR,DXS,DTOUT,DIROUT,DIRUT,DUOUT
"RTN","PRCAAPR",6,0)
ASK N DPTNOFZY,DPTNOFZK S (DPTNOFZY,DPTNOFZK)=1
"RTN","PRCAAPR",7,0)
 ; PRCA*4.5*276, add blank line before prompt for easier use
"RTN","PRCAAPR",8,0)
 K OUT S COUNT=0 R !!,"Select DEBTOR NAME or BILL NUMBER: ",X:DTIME I "^"[$E(X) S $P(DEBT,"^",2)="" G Q
"RTN","PRCAAPR",9,0)
 S X=$$UPPER^VALM1(X)
"RTN","PRCAAPR",10,0)
 S Y=$S($O(^PRCA(430,"B",X,0)):$O(^(0)),$O(^PRCA(430,"D",X,0)):$O(^(0)),1:-1)
"RTN","PRCAAPR",11,0)
 I Y>0 S DEBT=$P($G(^PRCA(430,Y,0)),"^",9) I DEBT S PRCADB=$P($G(^RCD(340,DEBT,0)),"^"),^DISV(DUZ,"^PRCA(430,")=Y,$P(DEBT,"^",2)=$$NAM^RCFN01(DEBT) D COMP,EN1^PRCAATR(Y) G:$D(DTOUT) Q G ASK
"RTN","PRCAAPR",12,0)
 S DIC="^RCD(340,",DIC(0)="E" D ^DIC G:Y<0 ASK
"RTN","PRCAAPR",13,0)
 S ^DISV(DUZ,"^RCD(340,")=+Y,PRCADB=$P(Y,"^",2),DEBT=+Y_"^"_$P(@("^"_$P(PRCADB,";",2)_+PRCADB_",0)"),"^")
"RTN","PRCAAPR",14,0)
 D COMP,HDR^PRCAAPR1,HDR2^PRCAAPR1,DIS^PRCAAPR1 G:'$D(DTOUT) ASK
"RTN","PRCAAPR",15,0)
Q K ^TMP("PRCAAPR",$J) Q
"RTN","PRCAAPR",16,0)
COMP ;Compile patient bills
"RTN","PRCAAPR",17,0)
 K ^TMP("PRCAAPR",$J)
"RTN","PRCAAPR",18,0)
 NEW STAT,STAT1,CNT,Y
"RTN","PRCAAPR",19,0)
 S STAT1=0
"RTN","PRCAAPR",20,0)
 F CNT=1:1 S STAT1=+$S(PRCATY="ALL":$O(^PRCA(430,"AS",+DEBT,STAT1)),1:$O(^PRCA(430.3,"AC",+$P(PRCATY,",",CNT),0))) Q:'STAT1  F BILL=0:0 S BILL=$O(^PRCA(430,"AS",+DEBT,STAT1,BILL)) Q:'BILL  D COMP1
"RTN","PRCAAPR",21,0)
 I PRCADB[";DPT(" F BILL=0:0 S BILL=$O(^PRCA(430,"E",+PRCADB,BILL)) Q:'BILL  I PRCATY="ALL"!((","_PRCATY_",")[(","_$P($G(^PRCA(430.3,+$P($G(^PRCA(430,BILL,0)),"^",8),0)),"^",3)_",")) D COMP1
"RTN","PRCAAPR",22,0)
 F BAT=0:0 S BAT=$O(^RCY(344,"AC",PRCADB,BAT)) Q:'BAT  F TRAN=0:0 S TRAN=$O(^RCY(344,"AC",PRCADB,BAT,TRAN)) Q:'TRAN  I $G(^RCY(344,BAT,1,TRAN,0))]"",$P(^(0),"^",5)="" D COMP2
"RTN","PRCAAPR",23,0)
 Q
"RTN","PRCAAPR",24,0)
COMP1 S STAT=$P($G(^PRCA(430.3,+$P($G(^PRCA(430,BILL,0)),"^",8),0)),"^",3) Q:STAT=""
"RTN","PRCAAPR",25,0)
 S X=$G(^PRCA(430,BILL,7)),Y=$P(X,"^")+$P(X,"^",2)+$P(X,"^",3)+$P(X,"^",4)+$P(X,"^",5)
"RTN","PRCAAPR",26,0)
 I $P(^PRCA(430,BILL,0),"^",2)=$O(^PRCA(430.2,"AC",33,0)) S Y=-Y
"RTN","PRCAAPR",27,0)
 S Y=$S($P(^PRCA(430,BILL,0),"^",2)=$O(^PRCA(430.2,"AC",33,0))&(STAT'=112):0,$P(^PRCA(430,BILL,0),"^",9)'=+DEBT:0,",102,107,112,"[(","_STAT_","):Y,1:0)
"RTN","PRCAAPR",28,0)
 S ^TMP("PRCAAPR",$J,"C")=$G(^TMP("PRCAAPR",$J,"C"))+Y
"RTN","PRCAAPR",29,0)
 S ^TMP("PRCAAPR",$J,"C",STAT)=$G(^TMP("PRCAAPR",$J,"C",STAT))+Y_"^"_STAT,^(STAT,BILL)=$P(X,"^",1,5)
"RTN","PRCAAPR",30,0)
 Q
"RTN","PRCAAPR",31,0)
COMP2 ;Compile payments
"RTN","PRCAAPR",32,0)
 S Y=$P(^RCY(344,BAT,1,TRAN,0),"^",4)
"RTN","PRCAAPR",33,0)
 S ^TMP("PRCAAPR",$J,"C")=$G(^TMP("PRCAAPR",$J,"C"))-Y
"RTN","PRCAAPR",34,0)
 S ^TMP("PRCAAPR",$J,"C",99)=$G(^TMP("PRCAAPR",$J,"C",99))-Y_"^99",^TMP("PRCAAPR",$J,"C",99,$P(^RCY(344,BAT,0),"^")_"-"_TRAN)=$P(^RCY(344,BAT,1,TRAN,0),"^",4)
"RTN","PRCAAPR",35,0)
 Q
"RTN","PRCAAPR",36,0)
 ;
"RTN","PRCAAPR",37,0)
COMP3(RCBILL) ; PRCA*4.5*276
"RTN","PRCAAPR",38,0)
 ; Check for 1st and 3rd party payment activity on bill
"RTN","PRCAAPR",39,0)
 ; RCBILL is the IEN for the bill # in files #399/#430 and must be valid,
"RTN","PRCAAPR",40,0)
 ; check the EOB type and exclude it if it is an MRA. Otherwise,
"RTN","PRCAAPR",41,0)
 ; returns the EEOB indicator '%' if payment activity was found.
"RTN","PRCAAPR",42,0)
 ; Access to file #361.1 covered by IA #4051.
"RTN","PRCAAPR",43,0)
 ; Access to file #399 covered by IA #3820.
"RTN","PRCAAPR",44,0)
 N PRCOUT,PRCVAL,Z
"RTN","PRCAAPR",45,0)
 I $G(RCBILL)=0 Q ""
"RTN","PRCAAPR",46,0)
 I '$O(^IBM(361.1,"B",RCBILL,0)) Q ""  ; no entry here
"RTN","PRCAAPR",47,0)
 I $P($G(^DGCR(399,RCBILL,0)),"^",13)=1 Q ""  ;avoid 'ENTERED/NOT REVIEWED' status
"RTN","PRCAAPR",48,0)
 ; handle both single and multiple bill entries in file #361.1
"RTN","PRCAAPR",49,0)
 S Z=0 F  S Z=$O(^IBM(361.1,"B",RCBILL,Z)) Q:'Z  D  Q:$G(PRCOUT)="%"
"RTN","PRCAAPR",50,0)
 . S PRCVAL=$G(^IBM(361.1,Z,0))
"RTN","PRCAAPR",51,0)
 . S PRCOUT=$S($P(PRCVAL,"^",4)=1:"",$P(PRCVAL,"^",4)=0:"%",1:"")
"RTN","PRCAAPR",52,0)
 Q PRCOUT  ; EOB indicator for either 1st or 3rd party payment on bill
"RTN","PRCAAPR1")
0^15^B43343192^B30720068
"RTN","PRCAAPR1",1,0)
PRCAAPR1 ;WASH-ISC@ALTOONA,PA/RGY - PATIENT ACCOUNT PROFILE ;2/12/97  11:48 AM
"RTN","PRCAAPR1",2,0)
 ;;4.5;Accounts Receivable;**34,45,108,143,141,206,192,218,276**;Mar 20, 1995;Build 87
"RTN","PRCAAPR1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCAAPR1",4,0)
HDR ;Head for Account profile
"RTN","PRCAAPR1",5,0)
 S X="",$P(X,"=",23)="" W @IOF,!,X,"   A c c o u n t   P r o f i l e   ",X
"RTN","PRCAAPR1",6,0)
HDR1 N DMC,IBRX,RSN,TOP4,TOP6,DPTFLG,ACCTNUM,RCCV
"RTN","PRCAAPR1",7,0)
 S IBRX=0,DPTFLG=0
"RTN","PRCAAPR1",8,0)
 ;
"RTN","PRCAAPR1",9,0)
 ;Display new 'Statement Account Number" (Patch 206)
"RTN","PRCAAPR1",10,0)
 I PRCADB["DPT(" S DPTFLG=1,ACCTNUM=$$ACCT(PRCADB)
"RTN","PRCAAPR1",11,0)
 ;
"RTN","PRCAAPR1",12,0)
 W !,$P(DEBT,"^",2) I DPTFLG!(PRCADB["VA(200,") S X=$S(PRCADB["DPT(":$P(^DPT(+PRCADB,0),"^",9),1:$P($G(^VA(200,+PRCADB,1)),"^",9)) W " (",$E(X,1,3),"-",$E(X,4,5),"-",$E(X,6,9),")"
"RTN","PRCAAPR1",13,0)
 W ?53,"Statement Day: ",$S($$PST^RCAMFN01(+DEBT)>0:$$PST^RCAMFN01(+DEBT),1:"N/A")
"RTN","PRCAAPR1",14,0)
 K Y S X("ADD")=$$DADD^RCAMADD(PRCADB)
"RTN","PRCAAPR1",15,0)
 ;
"RTN","PRCAAPR1",16,0)
 ;Display new 'Statement Account Number" (Patch 206)
"RTN","PRCAAPR1",17,0)
 I DPTFLG W !,"Statement Account #: ",ACCTNUM,?52,"Last Statement: "
"RTN","PRCAAPR1",18,0)
 E  W !?52,"Last Statement: "
"RTN","PRCAAPR1",19,0)
 ;
"RTN","PRCAAPR1",20,0)
 S Y=+$$LST^RCFN01(PRCADB,2)
"RTN","PRCAAPR1",21,0)
 I Y>0 S Y("CCPC")=$$FPS^RCCPCFN(+DEBT) S:Y("CCPC") Y=+$P(Y("CCPC"),"^")
"RTN","PRCAAPR1",22,0)
 W $S(Y=-1:"N/A",1:$$SLH^RCFN01(Y))
"RTN","PRCAAPR1",23,0)
 W !,$P(X("ADD"),"^")
"RTN","PRCAAPR1",24,0)
 W:+$G(Y("CCPC")) ?52,"Activity as of: ",$$SLH^RCFN01($$ASOF^RCCPCFN($P(Y("CCPC"),"^",2)))
"RTN","PRCAAPR1",25,0)
 W:$P(X("ADD"),"^",2)]"" !,$P(X("ADD"),"^",2) W:$P(X("ADD"),"^",3)]"" !,$P(X("ADD"),"^",3)
"RTN","PRCAAPR1",26,0)
 W ! W:$P(X("ADD"),"^",4)]"" $P(X("ADD"),"^",4),", ",$P(X("ADD"),"^",5),"  ",$S($P(X("ADD"),"^",6):$P(X("ADD"),"^",6),1:$P(X("ADD"),"^",8))
"RTN","PRCAAPR1",27,0)
 W ?55,"Amount Owed: ",?69,$J(+$G(^TMP("PRCAAPR",$J,"C")),9,2)
"RTN","PRCAAPR1",28,0)
 W !,"Phone #: ",$S($P(X("ADD"),"^",7)]"":$P(X("ADD"),"^",7),1:"N/A")
"RTN","PRCAAPR1",29,0)
 I PRCADB["DPT(" W ?51,"RX Copay Exempt: " S IBRX=$$RXST^IBARXEU(+PRCADB,DT) W $S($P(IBRX,U)=1:"YES",$P(IBRX,U)=0:"NO",1:"N/A")
"RTN","PRCAAPR1",30,0)
 I PRCADB["DPT(" W !?57,"CV Status: " S RCCV=$$CVEDT^DGCV(+PRCADB,DT) W $S($P(RCCV,U,3)>0:"YES",1:"NO") I $P(RCCV,U,2) W !?52,"CV Status Ends: ",$$SLH^RCFN01($P(RCCV,U,2))
"RTN","PRCAAPR1",31,0)
 ; *108 add exemption reason/dmc info
"RTN","PRCAAPR1",32,0)
 I IBRX>0,($P(IBRX,U)=1) S DIC="^IBE(354.2,",DIC(0)="M",X=+$P(IBRX,"^",3) D ^DIC I Y>0 W !,?54,"(",$P(Y,"^",2),")"
"RTN","PRCAAPR1",33,0)
 I $D(^RCD(340,"DMC",1,+DEBT)) S DMC=$G(^RCD(340,+DEBT,3)) D
"RTN","PRCAAPR1",34,0)
 .I $P(DMC,"^",2) W !,"** Account forwarded to DMC: ",$$SLH^RCFN01($P(DMC,"^",2)),?50,"Total DMC Amount: ",?69,$J($P(DMC,"^",5),9,2)
"RTN","PRCAAPR1",35,0)
 .I $P(DMC,"^",9)'="" W !,?49,"Lesser Amt to DMC: ",?69,$J($P(DMC,"^",9),9,2)
"RTN","PRCAAPR1",36,0)
 .Q
"RTN","PRCAAPR1",37,0)
 I $D(^RCD(340,"TOP",+DEBT)) S TOP4=$G(^RCD(340,+DEBT,4)),TOP6=$G(^(6)) D
"RTN","PRCAAPR1",38,0)
 .I +TOP6 W !,"** Account forwarded to TOP: ",$$SLH^RCFN01($P(TOP6,"^")),?45,"Total TOP Amount: ",?65,$J($P(TOP4,"^",3),13,2)
"RTN","PRCAAPR1",39,0)
 .I $P(TOP6,"^",6) W !,?45,"TOP HOLD DATE: ",$$SLH^RCFN01($P(TOP6,"^",6))
"RTN","PRCAAPR1",40,0)
 .Q
"RTN","PRCAAPR1",41,0)
 I $O(^RCD(340,+DEBT,2,0)) D
"RTN","PRCAAPR1",42,0)
 .S Y=0 F X=0:0 S X=$O(^RCD(340,+DEBT,2,X)) Q:'X  W:'Y ! W !,$G(^(X,0)) S Y=Y+1 W:Y=3&$O(^RCD(340,+DEBT,2,X)) "..." Q:Y=3
"RTN","PRCAAPR1",43,0)
 .Q
"RTN","PRCAAPR1",44,0)
 Q
"RTN","PRCAAPR1",45,0)
 ; PRCA*4.5*276 - moved headers right to add EOB indicator to bill #, adjusted at tag BLN accordingly
"RTN","PRCAAPR1",46,0)
HDR2 W !!,"#",?4,"Bill #",?17,"Est",?29,"Type",?38,"Paid",?47,"Prin",?56,"Int",?64,"Adm",?72,"Balance"
"RTN","PRCAAPR1",47,0)
 Q
"RTN","PRCAAPR1",48,0)
DIS ;Display bill line items
"RTN","PRCAAPR1",49,0)
 NEW STAT1
"RTN","PRCAAPR1",50,0)
 I '$O(^TMP("PRCAAPR",$J,"C",0)) S X="",$P(X,"*",22)="" W !!,X,"  NO ACCOUNT INFORMATION AVAILABLE  ",X G Q1
"RTN","PRCAAPR1",51,0)
 F STAT1=0:0 S STAT1=$O(^TMP("PRCAAPR",$J,"C",STAT1)) Q:'STAT1!$D(OUT)  D BHDR S BILL=0 F  S BILL=$O(^TMP("PRCAAPR",$J,"C",STAT1,BILL)) Q:BILL=""!$D(OUT)  D BLN
"RTN","PRCAAPR1",52,0)
 I '$D(OUT) D READ
"RTN","PRCAAPR1",53,0)
Q1 Q
"RTN","PRCAAPR1",54,0)
BHDR ;Display status line
"RTN","PRCAAPR1",55,0)
 S X=$S(+$P(^TMP("PRCAAPR",$J,"C",STAT1),"^",2)=99:"PAYMENTS",1:$P($G(^PRCA(430.3,+$O(^PRCA(430.3,"AC",+$P(^TMP("PRCAAPR",$J,"C",STAT1),"^",2),0)),0)),"^"))
"RTN","PRCAAPR1",56,0)
 S Y=" "_X_" ("_$J(+^TMP("PRCAAPR",$J,"C",STAT1),0,2)_") " W ! F X=1:1:80-$L(Y)/2 W "-"
"RTN","PRCAAPR1",57,0)
 W Y F X=1:1:IOM-$X-1 W "-"
"RTN","PRCAAPR1",58,0)
 Q
"RTN","PRCAAPR1",59,0)
BLN ;
"RTN","PRCAAPR1",60,0)
 N PRCOUT
"RTN","PRCAAPR1",61,0)
 I $Y+5>IOSL,COUNT D READ G:$D(OUT) Q2 D HDR,HDR2,BHDR
"RTN","PRCAAPR1",62,0)
 ; PRCA*4.5*276, attach EOB indicator '%' to bill # when applicable
"RTN","PRCAAPR1",63,0)
 S PRCOUT=$$COMP3^PRCAAPR(BILL)
"RTN","PRCAAPR1",64,0)
 I STAT1'=99,PRCOUT'="%" S PRCOUT=$$IBEEOBCK(BILL)
"RTN","PRCAAPR1",65,0)
 S:STAT1'=99 COUNT=COUNT+1,^TMP("PRCAAPR",$J,"O",COUNT)=BILL S X=$S(STAT1=99:BILL,1:$G(PRCOUT)_$G(^PRCA(430,BILL,0)))
"RTN","PRCAAPR1",66,0)
 W !,$S(STAT1'=99:COUNT,1:"*"),?4,$P(X,"^") W:STAT1'=99 ?17,$$SLH^RCFN01($P(X,"^",10))
"RTN","PRCAAPR1",67,0)
 W:STAT1'=99 ?29,$S($P(X,"^",2)=31:"TRIC PT",1:$E($P($G(^PRCA(430.2,$S($O(^PRCA(430.2,"AC",24,0))=$P(X,"^",2):+$P(X,"^",16),1:+$P(X,"^",2)),0)),"^"),1,7))  ; PRCA*4.5*192 changed CHMP PT to TRIC PT
"RTN","PRCAAPR1",68,0)
 W:STAT1=99 ?29,"PAYMENT"
"RTN","PRCAAPR1",69,0)
 S X=$S(STAT1=99:"^^^^^^"_^TMP("PRCAAPR",$J,"C",STAT1,BILL),1:$G(^PRCA(430,BILL,7))) W ?38 W:STAT1=99 "-" W $J($P(X,"^",7)+$P(X,"^",8)+$P(X,"^",9)+$P(X,"^",10)+$P(X,"^",11),0,2)
"RTN","PRCAAPR1",70,0)
 W ?46 W:STAT1=99 " " W:STAT1'=99 $S($P(^PRCA(430,BILL,0),"^",2)=$O(^PRCA(430.2,"AC",33,0)):"-",1:" ")
"RTN","PRCAAPR1",71,0)
 W $J($P(X,"^"),0,2),?56,$J($P(X,"^",2),1,2),?64,$J($P(X,"^",3),0,2),?69,$S(STAT1=99:"-",$P(^PRCA(430,BILL,0),"^",2)=$O(^PRCA(430.2,"AC",33,0)):"-",1:" ")
"RTN","PRCAAPR1",72,0)
 W $S(STAT1=99:$J(^TMP("PRCAAPR",$J,"C",STAT1,BILL),0,2),1:$J($P(X,"^")+$P(X,"^",2)+$P(X,"^",3)+$P(X,"^",4)+$P(X,"^",5),9,2))
"RTN","PRCAAPR1",73,0)
 K ^TMP("PRCAAPR",$J,"C",STAT1,BILL) K:$O(^TMP("PRCAAPR",$J,"C",STAT1,""))="" ^TMP("PRCAAPR",$J,"C",STAT1)
"RTN","PRCAAPR1",74,0)
Q2 Q
"RTN","PRCAAPR1",75,0)
READ ;Read bill number
"RTN","PRCAAPR1",76,0)
 W !!,"Select 1-",COUNT W:$O(^TMP("PRCAAPR",$J,"C","")) " or return to continue" R ": ",X:DTIME I X["^"!'$T S:'$T DTOUT=1 S OUT=1 G Q3
"RTN","PRCAAPR1",77,0)
 I X["?" W !!,"To see detailed information for a bill number, enter the corresponding '#'",!,"next to the bill.  (Ex: 1 or 1,3)" G READ
"RTN","PRCAAPR1",78,0)
 I X="",'$O(^TMP("PRCAAPR",$J,"C","")) S OUT=1 G Q3
"RTN","PRCAAPR1",79,0)
 G:X="" Q3 S SEL=X
"RTN","PRCAAPR1",80,0)
 F X=1:1:$L(SEL,",") S Y=$P(SEL,",",X) I Y'?1N.N!'$D(^TMP("PRCAAPR",$J,"O",+Y)) W *7," ??" G READ
"RTN","PRCAAPR1",81,0)
 S OUT=1 F X=1:1:$L(SEL,",") S Y=$P(SEL,",",X) D EN1^PRCAATR($G(^TMP("PRCAAPR",$J,"O",+Y)))
"RTN","PRCAAPR1",82,0)
Q3 Q
"RTN","PRCAAPR1",83,0)
 ;
"RTN","PRCAAPR1",84,0)
ACCT(DFN) ;Get account number. Join station with DFN (Patch 206)
"RTN","PRCAAPR1",85,0)
 N SITE,ACCT,ACCT1,LEN
"RTN","PRCAAPR1",86,0)
 S DFN=+DFN
"RTN","PRCAAPR1",87,0)
 S LEN=$L(DFN)-1
"RTN","PRCAAPR1",88,0)
 S SITE=$$SITE^RCMSITE                          ;station number
"RTN","PRCAAPR1",89,0)
 S ACCT=$$RJ^XLFSTR(DFN,13,0)                   ;add leading zeroes
"RTN","PRCAAPR1",90,0)
 S ACCT1=SITE_"-"_$E(ACCT,1,$L(ACCT)-$L(DFN))   ;add hyphen
"RTN","PRCAAPR1",91,0)
 S ACCT1=ACCT1_"-"_$E(ACCT,$L(ACCT)-LEN,99)     ;add hyphen
"RTN","PRCAAPR1",92,0)
 S ACCT1=ACCT1_"-"_$E($P($P(DEBT,U,2),","),1,5) ;add last name
"RTN","PRCAAPR1",93,0)
 Q ACCT1
"RTN","PRCAAPR1",94,0)
 ;
"RTN","PRCAAPR1",95,0)
 ; PRCA*4.5*276 -  Use Event Date to find an associated 3rd Party bill with an associated EEOB
"RTN","PRCAAPR1",96,0)
IBEEOBCK(PRCAAR) ; Passed AR Bill
"RTN","PRCAAPR1",97,0)
 ; Function will quit as soon as a 3rd party bill is located that has an associated EEOB
"RTN","PRCAAPR1",98,0)
 ;
"RTN","PRCAAPR1",99,0)
 ; Find 3rd Party Bills with an Event Date
"RTN","PRCAAPR1",100,0)
 N PRCAREF,PRCAEEOB,PRCADT,DFN,DBTR,X1
"RTN","PRCAAPR1",101,0)
 ; Get DFN
"RTN","PRCAAPR1",102,0)
 S DBTR=+$P($G(^PRCA(430,PRCAAR,0)),U,9)
"RTN","PRCAAPR1",103,0)
 S X1=$P($G(^RCD(340,DBTR,0)),U) I X1'["DPT" Q ""
"RTN","PRCAAPR1",104,0)
 S DFN=+X1
"RTN","PRCAAPR1",105,0)
 S PRCAEEOB=""
"RTN","PRCAAPR1",106,0)
 ; Loop through Xref of ARbill (#430) to Action file (#350)
"RTN","PRCAAPR1",107,0)
 I +$G(PRCAAR) S PRCAREF=0 F  S PRCAREF=$O(^IB("ABIL",$P($G(^PRCA(430,PRCAAR,0)),"^"),PRCAREF)) Q:'PRCAREF  D  Q:PRCAEEOB="%"
"RTN","PRCAAPR1",108,0)
 . S PRCADT=$P($G(^IB(PRCAREF,0)),"^",17) ;Get event Date
"RTN","PRCAAPR1",109,0)
 . I PRCADT S PRCAEEOB=$$TPEVDT(DFN,PRCADT) Q:PRCAEEOB="%"
"RTN","PRCAAPR1",110,0)
 . I PRCADT S PRCAEEOB=$$TPOPV(DFN,PRCADT)
"RTN","PRCAAPR1",111,0)
 ;
"RTN","PRCAAPR1",112,0)
 Q PRCAEEOB
"RTN","PRCAAPR1",113,0)
 ;
"RTN","PRCAAPR1",114,0)
 ; PRCA*4.5*276 - Traverse all THIRD PARTY bills for a patient with a specific Event Date (399,.03)
"RTN","PRCAAPR1",115,0)
TPEVDT(DFN,EVDT) ;
"RTN","PRCAAPR1",116,0)
 ; Function will quit as soon as a 3rd party bill is located that has an associated EEOB
"RTN","PRCAAPR1",117,0)
 N PRCAIFN,PRCADT,PRCAEEOB
"RTN","PRCAAPR1",118,0)
 S PRCAEEOB=""
"RTN","PRCAAPR1",119,0)
 I +$G(DFN),+$G(EVDT) S PRCADT=(EVDT\1)-.001 F  S PRCADT=$O(^DGCR(399,"D",PRCADT)) Q:'PRCADT!((PRCADT\1)>(EVDT\1))  D  Q:PRCAEEOB="%"
"RTN","PRCAAPR1",120,0)
 . S PRCAIFN=0 F  S PRCAIFN=$O(^DGCR(399,"D",PRCADT,PRCAIFN)) Q:'PRCAIFN  D  Q:PRCAEEOB="%"
"RTN","PRCAAPR1",121,0)
 .. Q:DFN'=$P($G(^DGCR(399,PRCAIFN,0)),U,2)
"RTN","PRCAAPR1",122,0)
 .. ; attach EOB indicator '%' to bill # when applicable
"RTN","PRCAAPR1",123,0)
 .. S PRCAEEOB=$$COMP3^PRCAAPR(PRCAIFN)
"RTN","PRCAAPR1",124,0)
 Q PRCAEEOB
"RTN","PRCAAPR1",125,0)
 ;
"RTN","PRCAAPR1",126,0)
 ; PRCA*4.5*276 - Traverse all THIRD PARTY bills for a patient with any Opt Visit Dates same as Event Date (399,43)
"RTN","PRCAAPR1",127,0)
TPOPV(DFN,EVDT) ;
"RTN","PRCAAPR1",128,0)
 ; Function will quit as soon as a 3rd party bill is located that has an associated EEOB
"RTN","PRCAAPR1",129,0)
 N PRCAIFN,PRCAEEOB
"RTN","PRCAAPR1",130,0)
 S PRCAEEOB=""
"RTN","PRCAAPR1",131,0)
 I +$G(DFN),+$G(EVDT) S PRCAIFN=0 F  S PRCAIFN=$O(^DGCR(399,"AOPV",DFN,EVDT,PRCAIFN)) Q:'PRCAIFN  D  Q:PRCAEEOB="%"
"RTN","PRCAAPR1",132,0)
 . ; attach EOB indicator '%' to bill # when applicable
"RTN","PRCAAPR1",133,0)
 . S PRCAEEOB=$$COMP3^PRCAAPR(PRCAIFN)
"RTN","PRCAAPR1",134,0)
 Q PRCAEEOB
"RTN","PRCAATR")
0^10^B18030407^B16891827
"RTN","PRCAATR",1,0)
PRCAATR ;WASH-ISC@ALTOONA,PA/RGY - VIEW TRANSACTION FOR BILLS ;2/14/96  2:46 PM
"RTN","PRCAATR",2,0)
V ;;4.5;Accounts Receivable;**36,104,172,138,233,276**;Mar 20, 1995;Build 87
"RTN","PRCAATR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCAATR",4,0)
EN1(BILL) ;ENTRY POINT FROM PRCAAPR
"RTN","PRCAATR",5,0)
 NEW X,COUNT,OUT,TRAN,SEL,PRCAATRX,PRCAIO,PRCAIOS,D0,PRCAQUE,POP,PRCAPRT,Y,ZTSK,PRCOUT
"RTN","PRCAATR",6,0)
 I '$D(BILL) G Q
"RTN","PRCAATR",7,0)
 I BILL'?1N.N!'$D(^PRCA(430,+BILL,0)) G Q
"RTN","PRCAATR",8,0)
 ; PRCA*4.5*276
"RTN","PRCAATR",9,0)
 S PRCOUT=$$COMP3^PRCAAPR(BILL) ; check for 1st and 3rd party payments
"RTN","PRCAATR",10,0)
 I PRCOUT'="%" S PRCOUT=$$IBEEOBCK^PRCAAPR1(BILL)
"RTN","PRCAATR",11,0)
 S PRCAPRT=1,PRCAIO=IO(0),PRCAIO(0)=IO(0),COUNT=0 K ^TMP("PRCAATR",$J)
"RTN","PRCAATR",12,0)
 D HDR,DIS,^%ZISC
"RTN","PRCAATR",13,0)
Q K ^TMP("PRCAATR",$J),IO("Q") Q
"RTN","PRCAATR",14,0)
HDR ;Header
"RTN","PRCAATR",15,0)
 D HDR^PRCAAPR1
"RTN","PRCAATR",16,0)
 I $P($G(^PRCA(430,BILL,13)),"^") W !,"MEDICARE CONTRACTUAL ADJUSTMENT: ",$J($P($G(^PRCA(430,BILL,13)),"^"),0,2)
"RTN","PRCAATR",17,0)
 I $P($G(^PRCA(430,BILL,13)),"^",2) W !,"UNREIMBURSED MEDICARE EXPENSE: ",$J($P($G(^PRCA(430,BILL,13)),"^",2),0,2)
"RTN","PRCAATR",18,0)
 ; PRCA*4.5*276 - attach EEOB indicator to bill number
"RTN","PRCAATR",19,0)
 W !,"Bill #: ",$G(PRCOUT)_$P(^PRCA(430,BILL,0),"^") D:$P(^(0),"^",9)'=+DEBT DEB
"RTN","PRCAATR",20,0)
 W !!,"#",?8,"Tr #",?17,"Type",?52,"Date",?70,"Amount"
"RTN","PRCAATR",21,0)
 S X="",$P(X,"-",IOM)="" W !,X
"RTN","PRCAATR",22,0)
 Q
"RTN","PRCAATR",23,0)
DIS ;Display transactions
"RTN","PRCAATR",24,0)
 W !,?17,"Original Amount",?52,$$SLH^RCFN01($P(^PRCA(430,BILL,0),"^",10)),?65,$J($P(^(0),"^",3),11,2)
"RTN","PRCAATR",25,0)
 I '$O(^PRCA(433,"C",BILL,0)) D
"RTN","PRCAATR",26,0)
 . S X="",$P(X,"*",20)="" W !!,X,"  NO TRANSACTION INFORMATION AVAILABLE  ",X
"RTN","PRCAATR",27,0)
RD . R !!,"Press return to continue: ",X:DTIME S:'$T DTOUT=1 S OUT=1
"RTN","PRCAATR",28,0)
 . I X["?" W !!,"Press the return key to return to menu." G RD
"RTN","PRCAATR",29,0)
 . Q
"RTN","PRCAATR",30,0)
 F TRAN=0:0 S TRAN=$O(^PRCA(433,"C",BILL,TRAN)) Q:'TRAN!$D(OUT)  D TLN
"RTN","PRCAATR",31,0)
 S X=$G(^PRCA(430,BILL,7))
"RTN","PRCAATR",32,0)
 I '$D(OUT) W !?65,"-----------",!,?64,"$",$J($P(X,"^")+$P(X,"^",2)+$P(X,"^",3)+$P(X,"^",4)+$P(X,"^",5),11,2) D READ
"RTN","PRCAATR",33,0)
 Q
"RTN","PRCAATR",34,0)
TLN ;Display a transaction
"RTN","PRCAATR",35,0)
 N YR
"RTN","PRCAATR",36,0)
 I $Y+5>IOSL,COUNT D READ G:$D(DTOUT)!$D(OUT) Q1 D HDR
"RTN","PRCAATR",37,0)
 S COUNT=COUNT+1,X=$G(^PRCA(433,TRAN,1)),^TMP("PRCAATR",$J,COUNT)=TRAN
"RTN","PRCAATR",38,0)
 W !,COUNT,$S($P(^PRCA(433,TRAN,0),"^",4)=1!$P(^(0),"^",10):"(I)",1:""),?8,TRAN,?17
"RTN","PRCAATR",39,0)
 W $S($P($G(^PRCA(430.3,+$P(X,"^",2),0)),"^",3)=17:$P($G(^PRCA(433,TRAN,5)),"^",2),1:$P($G(^(0)),"^"))
"RTN","PRCAATR",40,0)
 ;  show decrease adjustments as negative (patch 4.5*172)
"RTN","PRCAATR",41,0)
 I $P(X,"^",2)=35 S:$P(X,"^",5)>0 $P(X,"^",5)=-$P(X,"^",5)
"RTN","PRCAATR",42,0)
 W ?52,$S(+X:$$SLH^RCFN01(+X),1:""),?65,$J($P(X,"^",5),11,2)
"RTN","PRCAATR",43,0)
Q1 Q
"RTN","PRCAATR",44,0)
READ ;Read a trans number
"RTN","PRCAATR",45,0)
 I IO'=IO(0) G Q2
"RTN","PRCAATR",46,0)
ASK W !!,"Select 1-",COUNT,$S(PRCAPRT:" or 'P' to Print",1:" to print") W:TRAN " or return to continue" R ": ",X:DTIME I X["^"!'$T S:'$T DTOUT=1 S OUT=1 G Q2
"RTN","PRCAATR",47,0)
 I PRCAPRT,X="P" S %ZIS="MQ" D ^%ZIS D  S PRCAPRT=0,PRCAIO=IO,PRCAIO(0)=IO(0) G:'POP ASK K POP S OUT=1 G Q2
"RTN","PRCAATR",48,0)
 . I $D(IO("S")) S PRCAIOS=ION D ^%ZISC
"RTN","PRCAATR",49,0)
 . Q
"RTN","PRCAATR",50,0)
 I X["?" W !!,"To see detailed information for a transaction number, enter the corresponding '#'",!,"next to the transaction.  (Ex: 1 or 1,3)" G ASK
"RTN","PRCAATR",51,0)
 I X="" S:TRAN="" OUT=1 G Q2
"RTN","PRCAATR",52,0)
 S SEL=X
"RTN","PRCAATR",53,0)
 F X=1:1:$L(SEL,",") S Y=$P(SEL,",",X) I Y'?1N.N!'$D(^TMP("PRCAATR",$J,+Y)) W *7," ??" G READ
"RTN","PRCAATR",54,0)
 F PRCAATRX=1:1:$L(SEL,",") S Y=$P(SEL,",",PRCAATRX) D VT Q:$D(OUT)
"RTN","PRCAATR",55,0)
 S OUT=1
"RTN","PRCAATR",56,0)
Q2 Q
"RTN","PRCAATR",57,0)
VT ;View a transaction
"RTN","PRCAATR",58,0)
 N IOP,%ZIS,ZTRTN,ZTDESC,ZTSAVE,ZTDTH
"RTN","PRCAATR",59,0)
 S D0=$G(^TMP("PRCAATR",$J,+Y)) G:'D0 Q3
"RTN","PRCAATR",60,0)
 I $D(IO("Q")) S ZTSAVE("D0")="",ZTSAVE("PRCAIO")=IO,ZTSAVE("PRCAIO(0)")=IO(0),ZTRTN="DQ^PRCAATR",ZTDESC="AR TRANS PROFILE",ZTDTH=$H D ^%ZTLOAD W !,"*** Trans # ",D0," REQUEST QUEUED ***" G Q3
"RTN","PRCAATR",61,0)
 I IO'=IO(0) W !,"OK, Printing Transaction # ",D0," ..."
"RTN","PRCAATR",62,0)
 I $D(PRCAIOS) S IOP=PRCAIOS D ^%ZIS
"RTN","PRCAATR",63,0)
 U IO D DQ U IO(0)
"RTN","PRCAATR",64,0)
Q3 Q
"RTN","PRCAATR",65,0)
DQ ;
"RTN","PRCAATR",66,0)
 W @IOF S X="",$P(X,"=",30)="" W !,X," TRANSACTION PROFILE ",X,!!
"RTN","PRCAATR",67,0)
 K DXS D ^PRCATR3 K DXS S X=D0 D ENF^IBOLK
"RTN","PRCAATR",68,0)
RD1 I $E(IOST)="C" R !!,"PRESS <RETURN> TO CONTINUE: ",X:DTIME S:'$T DTOUT=1,OUT=1 I X["?" W !!,"Press return to view next transaction or to continue" G RD1
"RTN","PRCAATR",69,0)
 Q
"RTN","PRCAATR",70,0)
DEB ;View debtor
"RTN","PRCAATR",71,0)
 NEW PRCA
"RTN","PRCAATR",72,0)
 S PRCA=$P(^PRCA(430,BILL,0),"^",9) I PRCA S PRCA=$P(^RCD(340,PRCA,0),"^") W "   ",$P($G(@("^"_$P(PRCA,";",2)_+PRCA_",0)")),"^")
"RTN","PRCAATR",73,0)
 Q
"RTN","PRCABIL1")
0^23^B25296320^B25254789
"RTN","PRCABIL1",1,0)
PRCABIL1 ;SF-ISC/RSD - ENTER BILL INFO ;10/16/96  7:04 PM
"RTN","PRCABIL1",2,0)
V ;;4.5;Accounts Receivable;**57,64,109,147,220,276**;Mar 20, 1995;Build 87
"RTN","PRCABIL1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCABIL1",4,0)
EN1 ;ENTER NEW BILL
"RTN","PRCABIL1",5,0)
 D ST Q:'%  N CP
"RTN","PRCABIL1",6,0)
EN10 D EN^PRCABIL2 G Q:'$D(PRCABN) S $P(^PRCA(430,PRCABN,0),"^",8)=$O(^PRCA(430.3,"AC",201,0)) D EN G EN10
"RTN","PRCABIL1",7,0)
EN2 ;EDIT BILL
"RTN","PRCABIL1",8,0)
EN20 D SVC^PRCABIL Q:'$D(PRCAP("S"))  S DIC("S")="S Z0=$S($D(^PRCA(430.3,+$P(^(0),U,8),0)):$P(^(0),U,3),1:0) I Z0>199,Z0<210,'$P($G(^PRCA(430,Y,3)),U,3),+$P($G(^(100)),U,2)="_PRCAP("S")
"RTN","PRCABIL1",9,0)
 D BILLN^PRCAUTL G Q:'$D(PRCABN) D EN G EN20
"RTN","PRCABIL1",10,0)
EN4 ;CANCEL BILL
"RTN","PRCABIL1",11,0)
EN40 D SVC^PRCABIL Q:'$D(PRCAP("S"))  S DIC("S")="S Z0=$S($D(^PRCA(430.3,+$P(^(0),U,8),0)):$P(^(0),U,3),1:0) I Z0>199,Z0<210,$D(^PRCA(430,Y,100)),+$P(^(100),U,2)="_PRCAP("S")
"RTN","PRCABIL1",12,0)
 D BILLN^PRCAUTL G Q:'$D(PRCABN)
"RTN","PRCABIL1",13,0)
YN S %=2 W !,"  Sure you want to cancel this Bill" D YN^DICN
"RTN","PRCABIL1",14,0)
 I %=0 W !,*7,"Answer 'Yes' or 'No' " G YN
"RTN","PRCABIL1",15,0)
 I %'=1 D Q G EN40
"RTN","PRCABIL1",16,0)
 S $P(^PRCA(430,PRCABN,0),"^",14)=DT,$P(^(0),"^",17)=DUZ,$P(^(9),"^",6)=$P(^(0),"^",8),PRCA("STATUS")=$O(^PRCA(430.3,"AC",210,0)) D UPSTATS^PRCAUT2 K PRCA("STATUS") D Q G EN40
"RTN","PRCABIL1",17,0)
EN K PRCADFM S DA=PRCABN D LCK G Q:'$D(DA)
"RTN","PRCABIL1",18,0)
 S DIE="^PRCA(430,"
"RTN","PRCABIL1",19,0)
 I $D(RCAMEND) S X=+^PRCA(430,DA,100) I X?1N,X<4,X>0 G FORM
"RTN","PRCABIL1",20,0)
 S DR="100" D ^DIE G:X'?1N Q
"RTN","PRCABIL1",21,0)
FORM N PRCACAT,PRCAFUND
"RTN","PRCABIL1",22,0)
 S DR="[PRCA BILL "_$P("1081^1080^1114","^",X)_"]",PRCABT=X D ^DIE
"RTN","PRCABIL1",23,0)
 S:$D(DUZ) $P(^PRCA(430,PRCABN,9),U,8)=DUZ
"RTN","PRCABIL1",24,0)
 S PRCACAT=$P(^PRCA(430,PRCABN,0),U,2)
"RTN","PRCABIL1",25,0)
 I PRCACAT>39,PRCACAT<45 D
"RTN","PRCABIL1",26,0)
    .S X=PRCACAT,PRCAFUND=$S(X=40:"05",X=41:"06",X=42:"07",X=43:"08",1:"10"),PRCAFUND=5287_PRCAFUND
"RTN","PRCABIL1",27,0)
    .S DR="259////"_"09;203////^S X=PRCAFUND"
"RTN","PRCABIL1",28,0)
    .;I PRCAFUND'=528707 S DR=DR_";258////1"
"RTN","PRCABIL1",29,0)
    .D ^DIE
"RTN","PRCABIL1",30,0)
    .Q
"RTN","PRCABIL1",31,0)
 I $P(^PRCA(430,PRCABN,0),U,9)=""!('$D(^(100))!('$D(^(101)))) D MESG W !,"Bill is incomplete and must be re-edited !",*7 G Q
"RTN","PRCABIL1",32,0)
 D EN4^PRCABIL S PRCAMT1=0,PRCAMTY=0,DIK="^PRCA(430,PRCABN,2,"
"RTN","PRCABIL1",33,0)
 F PRCAI=0:0 S PRCAI=$O(^PRCA(430,PRCABN,2,PRCAI)) Q:'PRCAI  I $D(^(PRCAI,0)) S X=^(0) I $P(X,"^",8)]"" S PRCAMT1=PRCAMT1+$P(X,"^",8),PRCAMTY=PRCAMTY+1
"RTN","PRCABIL1",34,0)
 I 'PRCAMT1 W !!,"Fiscal Year Amount was not entered !  Bill is incomplete",*7 G Q
"RTN","PRCABIL1",35,0)
 I PRCAMTY>1 W !!,"Multiple Fiscal Years are not allowed at this time !",!,"Bill is incomplete and must be re-edited.",*7 G Q
"RTN","PRCABIL1",36,0)
 ;S DIE=DIK,DA(1)=PRCABN,DA=+$O(^PRCA(430,PRCABN,2,0)),DR=".01;7" S:'DA ^PRCA(430,PRCABN,2,0)="^430.01" D ^DIE
"RTN","PRCABIL1",37,0)
 I PRCAMT1'=PRCAMT,PRCABT'=1 W !!,"Fiscal Year Amounts do not equal the total bill amount !",!,"Bill is incomplete and must be re-edited !",*7 G Q
"RTN","PRCABIL1",38,0)
 I PRCAMT1'=PRCAMT,PRCABT=1 D  ;
"RTN","PRCABIL1",39,0)
 . N DIE,DA,DR
"RTN","PRCABIL1",40,0)
 . S PRCAMT1=PRCAMT
"RTN","PRCABIL1",41,0)
 . S DIE="^PRCA(430,PRCABN,2,"
"RTN","PRCABIL1",42,0)
 . S DA(1)=PRCABN
"RTN","PRCABIL1",43,0)
 . S DA=+$O(^PRCA(430,PRCABN,2,0))
"RTN","PRCABIL1",44,0)
 . S DR="1///"_PRCAMT1
"RTN","PRCABIL1",45,0)
 . QUIT:'DA
"RTN","PRCABIL1",46,0)
 . ; 
"RTN","PRCABIL1",47,0)
 . DO ^DIE
"RTN","PRCABIL1",48,0)
 ;
"RTN","PRCABIL1",49,0)
 S Y=$P(^PRCA(430,PRCABN,0),"^",9),Y=Y_"^"_$P(^RCD(340,Y,0),"^",1)
"RTN","PRCABIL1",50,0)
 G:$P(Y,";",2)="DPT("!($P(Y,";",2)="DIC(36,") CONT
"RTN","PRCABIL1",51,0)
 S PRCANODE=.11 S:$P(Y,";",2)="DIC(4," PRCANODE=1 S PRCANODE="^"_$P(Y,";",2)_+$P(Y,"^",2)_","_PRCANODE_")",PRCANODE=$G(@PRCANODE)
"RTN","PRCABIL1",52,0)
 I $P(PRCANODE,"^",1)="" S DR=$P(Y,"^",2),%=1 W !," (No Street Address)  Edit Debtor Address: " D YN^DICN,EN1^RCAM(DR):%=1 K DIE,DR,DA
"RTN","PRCABIL1",53,0)
CONT S Y=^PRCA(430,PRCABN,0),$P(Y,"^",3)=PRCAMT,PRCA("STATUS")=$O(^PRCA(430.3,"AC",205,0)),^PRCA(430,PRCABN,0)=Y,$P(^PRCA(430,PRCABN,7),"^")=PRCAMT
"RTN","PRCABIL1",54,0)
 I '$D(RCAMEND) S DIE="^PRCA(430,",DA=PRCABN,DR="8////"_PRCA("STATUS")_"" D ^DIE K DIE,DR,DA
"RTN","PRCABIL1",55,0)
DISP S %=1,PRCADFM=1 W !,"   Display/Print Bill:"
"RTN","PRCABIL1",56,0)
 K IOP D YN^DICN
"RTN","PRCABIL1",57,0)
 I %=0 W !,*7,"Answer 'Yes' or 'No' " G DISP
"RTN","PRCABIL1",58,0)
 D ^PRCABD:%=1
"RTN","PRCABIL1",59,0)
Q L -^PRCA(430,+$G(PRCABN),0)
"RTN","PRCABIL1",60,0)
 K %,%Y,A,B,C,D0,DA,DIC,DIE,DIK,DR,I,PRCA,PRCABC,PRCABN,PRCABT,PRCADFM,PRCAI,PRCAKCT,PRCANM,PRCARN,PRCATIME,PRCAMT,PRCAMTY,PRCANM,PRCANODE,PRCAMT1,PRCAMT2,PRCAQ,PRCAP,PRCAT,PRCATY,PRCAX,X,Y,Z0,ZRTN,ZTSK Q
"RTN","PRCABIL1",61,0)
LCK L +^PRCA(430,DA,0):0 I  Q
"RTN","PRCABIL1",62,0)
 W !,"ANOTHER USER IS EDITING THIS ENTRY !" K DA Q
"RTN","PRCABIL1",63,0)
CP ;CONTROL POINT LOOK-UP
"RTN","PRCABIL1",64,0)
 N DIC,PRC,DIE,DA,DR,X,Y,PRCSIP,PRCSI
"RTN","PRCABIL1",65,0)
 S PRC("SITE")=$S($G(PRCA("SITE")):PRCA("SITE"),1:$$SITE^RCMSITE)
"RTN","PRCABIL1",66,0)
 ;S PRC("SITE")=$$SITE^RCMSITE
"RTN","PRCABIL1",67,0)
 S DIC("B")=$P($G(^PRCA(430,PRCABN,11)),U)
"RTN","PRCABIL1",68,0)
 D CP^PRCSUT I '$G(PRC("CP")) Q
"RTN","PRCABIL1",69,0)
 I PRC("CP")<0 Q
"RTN","PRCABIL1",70,0)
 S $P(^PRCA(430,PRCABN,11),U)=PRC("CP")
"RTN","PRCABIL1",71,0)
 Q
"RTN","PRCABIL1",72,0)
ST D CKSITE^PRCAUDT S %=$D(PRCA("CKSITE")) Q
"RTN","PRCABIL1",73,0)
ST1 D SVC^PRCABIL S %=$S($D(PRCAP("S")):1,1:0) Q:%
"RTN","PRCABIL1",74,0)
 K PRCAP Q
"RTN","PRCABIL1",75,0)
DIP D SVC^PRCABIL Q:'$D(PRCAP("S"))
"RTN","PRCABIL1",76,0)
 ; PRCA*4.5*276 - add '@' to BILL NO. in the 'BY' paramter so that printout does not show it as a sorting field.
"RTN","PRCABIL1",77,0)
 S FR=PRCAP("S")_",?,@",TO=PRCAP("S")_",?",L=0,DIC="^PRCA(430,",FLDS="[PRCA BILL LIST]",BY="@INTERNAL(SERVICE),@BILL NO.,FORM TYPE" D EN1^DIP K BY,DHD,DIC,FLDS,FR,L,PRCAP,TO Q
"RTN","PRCABIL1",78,0)
MESG I $P(^PRCA(430,PRCABN,0),U,9)="" W !,?3,"Debtor (or Payer) data is missing."
"RTN","PRCABIL1",79,0)
 I '$D(^PRCA(430,PRCABN,100)) W !,?3,"Service (or Section) , Form type or Voucher number data is missing."
"RTN","PRCABIL1",80,0)
 I '$D(^PRCA(430,PRCABN,101)) W !,?3,"Date of Charge data does not exist."
"RTN","PRCABIL1",81,0)
 W ! Q
"RTN","PRCAP276")
0^30^B2991391^n/a
"RTN","PRCAP276",1,0)
PRCAP276 ;OIFO-BAYPINES/RBN - PRE-INSTALL ROUTINE ;6/6/11 12:29pm
"RTN","PRCAP276",2,0)
 ;;4.5;Accounts Receivable;**276**;Mar 20, 1995;Build 87
"RTN","PRCAP276",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCAP276",4,0)
 ;
"RTN","PRCAP276",5,0)
 ;  icr #1157 Authorizes use of $$DELETE^XPDMENU()
"RTN","PRCAP276",6,0)
 Q
"RTN","PRCAP276",7,0)
PR ; Pre-install entry point
"RTN","PRCAP276",8,0)
 ; Creates KIDS checkpoint with call back
"RTN","PRCAP276",9,0)
 N OPT,Y
"RTN","PRCAP276",10,0)
 F OPT="OPT" D
"RTN","PRCAP276",11,0)
 . S Y=$$NEWCP^XPDUTL(OPT,OPT_"^PRCAP276")
"RTN","PRCAP276",12,0)
 . I 'Y D BMES^XPDUTL("ERROR Creating "_OPT_" Checkpoint.")
"RTN","PRCAP276",13,0)
 Q
"RTN","PRCAP276",14,0)
OPT ; pre-install to remove report from reports menu
"RTN","PRCAP276",15,0)
 N MENU,OPT
"RTN","PRCAP276",16,0)
 D BMES^XPDUTL("  Updating Menu...")
"RTN","PRCAP276",17,0)
 S MENU="RCDPE EDI LOCKBOX REPORTS MENU"
"RTN","PRCAP276",18,0)
 S OPT=$$DELETE^XPDMENU(MENU,"RCDPE DEPOSIT RECON REPORT")
"RTN","PRCAP276",19,0)
 ; clear x-refs 'E' and 'G' if they are present
"RTN","PRCAP276",20,0)
 I $P($G(^RCY(344.4,0)),"^",4)=0 Q
"RTN","PRCAP276",21,0)
 E  D
"RTN","PRCAP276",22,0)
 . I $D(^RCY(344.4,"G")) S DIK="^RCY(344.4,",DIK(1)=".04^G" D ENALL2^DIK K DIK ; clear index
"RTN","PRCAP276",23,0)
 . I $D(^RCY(344.4,"E")) S DIK="^RCY(344.4,",DIK(1)=".17^E" D ENALL2^DIK K DIK
"RTN","PRCAP276",24,0)
 Q
"RTN","PRCAP276",25,0)
 ;
"RTN","PRCAP276",26,0)
POST ; post-install to re-index fields #.04 and #.17 in file #344.4. The
"RTN","PRCAP276",27,0)
 ; cross-ref 'AC' and 'AD' will be populated only if we find data.
"RTN","PRCAP276",28,0)
 I $P($G(^RCY(344.4,0)),"^",4)>0 D
"RTN","PRCAP276",29,0)
 . D BMES^XPDUTL("Indexing fields #.04 and #.17 in ELECTRONIC REMITTANCE ADVICE File #344.4")
"RTN","PRCAP276",30,0)
 . D WAIT^DICD
"RTN","PRCAP276",31,0)
 . S DIK="^RCY(344.4,",DIK(1)=".04^AC" D ENALL^DIK K DIK ; new index
"RTN","PRCAP276",32,0)
 . S DIK="^RCY(344.4,",DIK(1)=".17^AD" D ENALL^DIK K DIK
"RTN","PRCAP276",33,0)
 . D BMES^XPDUTL("<<< Indexing complete!")
"RTN","PRCAP276",34,0)
 Q
"RTN","RCBEUBIL")
0^33^B20763062^B20443775
"RTN","RCBEUBIL",1,0)
RCBEUBIL ;WISC/RFJ-utilties for bills (in file 430)                  ;1 Jun 00
"RTN","RCBEUBIL",2,0)
 ;;4.5;Accounts Receivable;**153,226,276**;Mar 20, 1995;Build 87
"RTN","RCBEUBIL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCBEUBIL",4,0)
 Q
"RTN","RCBEUBIL",5,0)
 ;
"RTN","RCBEUBIL",6,0)
 ;
"RTN","RCBEUBIL",7,0)
GETABILL() ;  select an active bill
"RTN","RCBEUBIL",8,0)
 N RCBILLDA,RCCAT,RCCATEG,STATUS
"RTN","RCBEUBIL",9,0)
 F  D  Q:RCBILLDA
"RTN","RCBEUBIL",10,0)
 .   W !! S RCBILLDA=$$SELBILL^RCDPBTLM
"RTN","RCBEUBIL",11,0)
 .   I RCBILLDA=0 S RCBILLDA=-1 Q
"RTN","RCBEUBIL",12,0)
 .   I RCBILLDA<1 Q
"RTN","RCBEUBIL",13,0)
 .   ;  bill must be active
"RTN","RCBEUBIL",14,0)
 .   S STATUS=$P($G(^PRCA(430,RCBILLDA,0)),"^",8)
"RTN","RCBEUBIL",15,0)
 .   I STATUS'=16,STATUS'=42 W !,"THIS IS NOT AN ACTIVE BILL !",! S RCBILLDA=0 Q
"RTN","RCBEUBIL",16,0)
 .   ;
"RTN","RCBEUBIL",17,0)
 .   ;  determine if bill can be adjusted based on category
"RTN","RCBEUBIL",18,0)
 .   K RCCAT D RCCAT^RCRCUTL(.RCCAT)  ;returns rccat(category) array
"RTN","RCBEUBIL",19,0)
 .   S RCCATEG=+$P(^PRCA(430,RCBILLDA,0),"^",2)
"RTN","RCBEUBIL",20,0)
 .   I +$G(RCCAT(RCCATEG))=1,$$REFST^RCRCUTL(RCBILLDA) W !!,"YOU CANNOT USE THIS OPTION TO ADJUST REFERRED "_$P($G(RCCAT(RCCATEG)),"^",2)_" BILLS !",! S RCBILLDA=0 Q
"RTN","RCBEUBIL",21,0)
 .   ;
"RTN","RCBEUBIL",22,0)
 .   I RCCATEG=26 W !,"YOU CANNOT ADJUST A PREPAYMENT BILL !",! S RCBILLDA=0 Q
"RTN","RCBEUBIL",23,0)
 Q RCBILLDA
"RTN","RCBEUBIL",24,0)
 ;
"RTN","RCBEUBIL",25,0)
 ;
"RTN","RCBEUBIL",26,0)
EDIT430(RCBILLDA,DR) ;  edit the fields in 430 with the DR string passed
"RTN","RCBEUBIL",27,0)
 I '$D(^PRCA(430,RCBILLDA)) Q
"RTN","RCBEUBIL",28,0)
 N %,D,D0,D1,DA,DDH,DI,DIC,DICR,DIE,DIG,DIH,DIU,DIV,DIW,DQ,J,X,Y
"RTN","RCBEUBIL",29,0)
 S (DIC,DIE)="^PRCA(430,",DA=RCBILLDA
"RTN","RCBEUBIL",30,0)
 D ^DIE
"RTN","RCBEUBIL",31,0)
 ;  user pressed up-arrow
"RTN","RCBEUBIL",32,0)
 I $D(Y) Q "0^BILL FIELDS NOT UPDATED"
"RTN","RCBEUBIL",33,0)
 Q 1
"RTN","RCBEUBIL",34,0)
 ;
"RTN","RCBEUBIL",35,0)
 ;
"RTN","RCBEUBIL",36,0)
CHGSTAT(RCBILLDA,STATUS) ;  change the current status
"RTN","RCBEUBIL",37,0)
 I '$D(^PRCA(430,RCBILLDA,0)) Q
"RTN","RCBEUBIL",38,0)
 ;  if the current status equals the new status, quit
"RTN","RCBEUBIL",39,0)
 I $P(^PRCA(430,RCBILLDA,0),"^",8)=STATUS Q
"RTN","RCBEUBIL",40,0)
 ;  if the status not defined in file 430.3, quit
"RTN","RCBEUBIL",41,0)
 I '$D(^PRCA(430.3,STATUS,0)) Q
"RTN","RCBEUBIL",42,0)
 N %,D,D0,DA,DI,DIC,DICR,DIE,DIG,DIH,DIU,DIV,DIW,DQ,DR,PREVSTAT,X,Y
"RTN","RCBEUBIL",43,0)
 S (DIC,DIE)="^PRCA(430,",DA=RCBILLDA
"RTN","RCBEUBIL",44,0)
 ;  build DR string
"RTN","RCBEUBIL",45,0)
 S DR=""
"RTN","RCBEUBIL",46,0)
 ;  get the current status and set to previous status
"RTN","RCBEUBIL",47,0)
 S PREVSTAT=$P($G(^PRCA(430,RCBILLDA,0)),"^",8)
"RTN","RCBEUBIL",48,0)
 ;  if previous status equal to new status, quit
"RTN","RCBEUBIL",49,0)
 I PREVSTAT=STATUS Q
"RTN","RCBEUBIL",50,0)
 I PREVSTAT S DR=DR_"95////"_PREVSTAT_";"
"RTN","RCBEUBIL",51,0)
 S DR=DR_"8////"_STATUS_";"    ;current status
"RTN","RCBEUBIL",52,0)
 S DR=DR_"17////"_$G(DUZ)_";"  ;status updated by
"RTN","RCBEUBIL",53,0)
 D ^DIE
"RTN","RCBEUBIL",54,0)
 Q
"RTN","RCBEUBIL",55,0)
 ;
"RTN","RCBEUBIL",56,0)
 ;
"RTN","RCBEUBIL",57,0)
SETRCDOJ(RCBILLDA,RCTRANDA,RCDOJ) ;  set the bill and transaction to rc or doj
"RTN","RCBEUBIL",58,0)
 ;  rcdoj = code RC or DOJ
"RTN","RCBEUBIL",59,0)
 N D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCBEUBIL",60,0)
 S (DIC,DIE)="^PRCA(430,",DA=RCBILLDA
"RTN","RCBEUBIL",61,0)
 S DR="65////"_RCDOJ_";"
"RTN","RCBEUBIL",62,0)
 D ^DIE
"RTN","RCBEUBIL",63,0)
 ;
"RTN","RCBEUBIL",64,0)
 S (DIC,DIE)="^PRCA(433,",DA=RCTRANDA
"RTN","RCBEUBIL",65,0)
 S DR="7////"_RCDOJ_";"
"RTN","RCBEUBIL",66,0)
 D ^DIE
"RTN","RCBEUBIL",67,0)
 Q
"RTN","RCBEUBIL",68,0)
 ;
"RTN","RCBEUBIL",69,0)
SETBAL(RCTRANDA,RCNFLG) ;  set the bills balance by adding value of transaction
"RTN","RCBEUBIL",70,0)
 N RCBILLDA,RCDATA7,VALUE
"RTN","RCBEUBIL",71,0)
 S RCBILLDA=$P($G(^PRCA(433,RCTRANDA,0)),"^",2) I 'RCBILLDA Q
"RTN","RCBEUBIL",72,0)
 ;  get the value of the transaction
"RTN","RCBEUBIL",73,0)
 S VALUE=$P($$TRANVALU^RCDPBTLM(RCTRANDA),"^",2,6)
"RTN","RCBEUBIL",74,0)
 ;  there is no value on the transaction
"RTN","RCBEUBIL",75,0)
 I $TR(VALUE,"^0")="" Q
"RTN","RCBEUBIL",76,0)
 ;
"RTN","RCBEUBIL",77,0)
 S RCDATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEUBIL",78,0)
 ; PRCA276 - next line: if adjustment causes negative balance entry in ACCOUNTS RECEIVABLE file not updated
"RTN","RCBEUBIL",79,0)
 I $P(RCDATA7,"^",1)+$P(VALUE,"^")<0 S RCNFLG=1 Q
"RTN","RCBEUBIL",80,0)
 S $P(RCDATA7,"^",1)=$P(RCDATA7,"^")+$P(VALUE,"^") ; principal
"RTN","RCBEUBIL",81,0)
 S $P(RCDATA7,"^",2)=$P(RCDATA7,"^",2)+$P(VALUE,"^",2) ; interest
"RTN","RCBEUBIL",82,0)
 S $P(RCDATA7,"^",3)=$P(RCDATA7,"^",3)+$P(VALUE,"^",3) ; admin
"RTN","RCBEUBIL",83,0)
 S $P(RCDATA7,"^",4)=$P(RCDATA7,"^",4)+$P(VALUE,"^",4) ; marshal fee
"RTN","RCBEUBIL",84,0)
 S $P(RCDATA7,"^",5)=$P(RCDATA7,"^",5)+$P(VALUE,"^",5) ; court cost
"RTN","RCBEUBIL",85,0)
 S $P(^PRCA(430,RCBILLDA,7),"^",1,5)=$P(RCDATA7,"^",1,5)
"RTN","RCBEUBIL",86,0)
 Q
"RTN","RCBEUBIL",87,0)
 ;
"RTN","RCBEUBIL",88,0)
FYMULT(RCTRANDA) ;  update the fiscal year multiple for bill
"RTN","RCBEUBIL",89,0)
 ;  to equal the fiscal year multiple for transaction in file 433
"RTN","RCBEUBIL",90,0)
 N RCBILLDA,FYDA
"RTN","RCBEUBIL",91,0)
 S RCBILLDA=$P($G(^PRCA(433,RCTRANDA,0)),"^",2) I 'RCBILLDA Q
"RTN","RCBEUBIL",92,0)
 S FYDA=0
"RTN","RCBEUBIL",93,0)
 F  S FYDA=$O(^PRCA(433,RCTRANDA,4,FYDA)) Q:'FYDA  D
"RTN","RCBEUBIL",94,0)
 .   I $D(^PRCA(430,RCBILLDA,2,FYDA,0)) S $P(^PRCA(430,RCBILLDA,2,FYDA,0),"^",2)=$P(^PRCA(433,RCTRANDA,4,FYDA,0),"^",2)
"RTN","RCBEUBIL",95,0)
 Q
"RTN","RCBEUBIL",96,0)
 ;
"RTN","RCBEUBIL",97,0)
 ;
"RTN","RCBEUBIL",98,0)
SHOWBILL(RCBILLDA) ;  show data for bill
"RTN","RCBEUBIL",99,0)
 N DATA7
"RTN","RCBEUBIL",100,0)
 S DATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEUBIL",101,0)
 W !?8,"Principal Balance: ",$J($P(DATA7,"^"),9,2)
"RTN","RCBEUBIL",102,0)
 W !?8," Interest Balance: ",$J($P(DATA7,"^",2),9,2)
"RTN","RCBEUBIL",103,0)
 W !?8,"    Admin Balance: ",$J($P(DATA7,"^",3)+$P(DATA7,"^",4)+$P(DATA7,"^",5),9,2)
"RTN","RCBEUBIL",104,0)
 W !?27,"---------"
"RTN","RCBEUBIL",105,0)
 W !?8,"    TOTAL Balance: ",$J($P(DATA7,"^")+$P(DATA7,"^",2)+$P(DATA7,"^",3)+$P(DATA7,"^",4)+$P(DATA7,"^",5),9,2)
"RTN","RCBEUBIL",106,0)
 Q
"RTN","RCBEUBIL",107,0)
 ;
"RTN","RCBEUBIL",108,0)
 ;
"RTN","RCBEUBIL",109,0)
ADDCOMM(RCBILLDA,COMMENT) ;  automatically put a comment on a bill
"RTN","RCBEUBIL",110,0)
 ;  comment in the array comment(1)=first line
"RTN","RCBEUBIL",111,0)
 ;                       comment(2)=second line
"RTN","RCBEUBIL",112,0)
 N CURRLINE,LINE
"RTN","RCBEUBIL",113,0)
 ;  get the last line
"RTN","RCBEUBIL",114,0)
 S CURRLINE=$O(^PRCA(430,RCBILLDA,10,99999999),-1)
"RTN","RCBEUBIL",115,0)
 ;  if comment already on transaction, add a blank line and
"RTN","RCBEUBIL",116,0)
 ;  date time of new comment
"RTN","RCBEUBIL",117,0)
 I CURRLINE D
"RTN","RCBEUBIL",118,0)
 .   S CURRLINE=CURRLINE+1,^PRCA(430,RCBILLDA,10,CURRLINE,0)=" "
"RTN","RCBEUBIL",119,0)
 .   S CURRLINE=CURRLINE+1,^PRCA(430,RCBILLDA,10,CURRLINE,0)="Comment added on: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","RCBEUBIL",120,0)
 ;  add new lines
"RTN","RCBEUBIL",121,0)
 F LINE=1:1 Q:'$D(COMMENT(LINE))  S ^PRCA(430,RCBILLDA,10,CURRLINE+LINE,0)=COMMENT(LINE)
"RTN","RCBEUBIL",122,0)
 ;  set the 0th node
"RTN","RCBEUBIL",123,0)
 S ^PRCA(430,RCBILLDA,10,0)="^^"_(CURRLINE+LINE-1)_"^"_(CURRLINE+LINE-1)_"^"_DT_"^"
"RTN","RCBEUBIL",124,0)
 Q
"RTN","RCBEUTR1")
0^34^B35457473^B33352818
"RTN","RCBEUTR1",1,0)
RCBEUTR1 ;WISC/RFJ-add int,admin chg or increase,decrease principal  ;1 Jun 00
"RTN","RCBEUTR1",2,0)
 ;;4.5;Accounts Receivable;**153,169,192,226,270,276**;Mar 20, 1995;Build 87
"RTN","RCBEUTR1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCBEUTR1",4,0)
 Q
"RTN","RCBEUTR1",5,0)
 ;
"RTN","RCBEUTR1",6,0)
 ;
"RTN","RCBEUTR1",7,0)
INTADM(RCBILLDA,RCVALUE,RCCOMMNT,RCDATE) ;  add an intererst/admin charge (transaction type=13)
"RTN","RCBEUTR1",8,0)
 ;  for a bill.  rcvalue = interest ^ admin ^ penalty ^ marshal fee ^ court cost
"RTN","RCBEUTR1",9,0)
 ;  for the transaction.  rcdate = process date (optional)
"RTN","RCBEUTR1",10,0)
 ;  returns transaction number if successful
"RTN","RCBEUTR1",11,0)
 ;
"RTN","RCBEUTR1",12,0)
 N RCDRSTRG,RCTRANDA,Y
"RTN","RCBEUTR1",13,0)
 ;  add the transaction (if added to 433, transaction is locked)
"RTN","RCBEUTR1",14,0)
 S RCTRANDA=$$ADD433^RCBEUTRA(RCBILLDA,13) I 'RCTRANDA Q 0
"RTN","RCBEUTR1",15,0)
 ;
"RTN","RCBEUTR1",16,0)
 ;  build dr string
"RTN","RCBEUTR1",17,0)
 ;  transaction date (strip off time)
"RTN","RCBEUTR1",18,0)
 S RCDRSTRG="11////"_$S($G(RCDATE):$P(RCDATE,"."),1:DT)_";"
"RTN","RCBEUTR1",19,0)
 ;
"RTN","RCBEUTR1",20,0)
 ;  transaction values
"RTN","RCBEUTR1",21,0)
 S RCDRSTRG=RCDRSTRG_"15////"_($P(RCVALUE,"^")+$P(RCVALUE,"^",2)+$P(RCVALUE,"^",3)+$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5))_";"
"RTN","RCBEUTR1",22,0)
 I $P(RCVALUE,"^",4) S RCDRSTRG=RCDRSTRG_"25////"_$P(RCVALUE,"^",4)_";"  ;marshal fee
"RTN","RCBEUTR1",23,0)
 I $P(RCVALUE,"^",5) S RCDRSTRG=RCDRSTRG_"26////"_$P(RCVALUE,"^",5)_";"  ;court cost
"RTN","RCBEUTR1",24,0)
 I $P(RCVALUE,"^",1) S RCDRSTRG=RCDRSTRG_"27////"_$P(RCVALUE,"^",1)_";"  ;interest
"RTN","RCBEUTR1",25,0)
 I $P(RCVALUE,"^",2) S RCDRSTRG=RCDRSTRG_"28////"_$P(RCVALUE,"^",2)_";"  ;admin
"RTN","RCBEUTR1",26,0)
 I $P(RCVALUE,"^",3) S RCDRSTRG=RCDRSTRG_"29////"_$P(RCVALUE,"^",3)_";"  ;penalty
"RTN","RCBEUTR1",27,0)
 I $G(RCDATE) S RCDRSTRG=RCDRSTRG_"19////"_RCDATE_";"  ;date entered
"RTN","RCBEUTR1",28,0)
 ;
"RTN","RCBEUTR1",29,0)
 ;  input the fields for the transaction
"RTN","RCBEUTR1",30,0)
 S Y=$$EDIT433^RCBEUTRA(RCTRANDA,RCDRSTRG) I 'Y L -^PRCA(433,RCTRANDA) Q 0
"RTN","RCBEUTR1",31,0)
 ;
"RTN","RCBEUTR1",32,0)
 ;  set the comment
"RTN","RCBEUTR1",33,0)
 I $D(RCCOMMNT(1)) D ADDCOMM^RCBEUTRA(RCTRANDA,.RCCOMMNT)
"RTN","RCBEUTR1",34,0)
 ;
"RTN","RCBEUTR1",35,0)
 ;  move over 433 from 430 (no principal, just move it)
"RTN","RCBEUTR1",36,0)
 D FY433^RCBEUTRA(RCTRANDA)
"RTN","RCBEUTR1",37,0)
 ;
"RTN","RCBEUTR1",38,0)
 ;  mark transaction as processed
"RTN","RCBEUTR1",39,0)
 D PROCESS^RCBEUTRA(RCTRANDA)
"RTN","RCBEUTR1",40,0)
 ;
"RTN","RCBEUTR1",41,0)
 ;  update the bill file with the balance of the transaction
"RTN","RCBEUTR1",42,0)
 D SETBAL^RCBEUBIL(RCTRANDA)
"RTN","RCBEUTR1",43,0)
 ;
"RTN","RCBEUTR1",44,0)
 ;  if the bill has no balance, close or cancel it
"RTN","RCBEUTR1",45,0)
 D CLOSEIT(RCBILLDA)
"RTN","RCBEUTR1",46,0)
 ;
"RTN","RCBEUTR1",47,0)
 ;  clear the lock and return the transaction added
"RTN","RCBEUTR1",48,0)
 L -^PRCA(433,RCTRANDA)
"RTN","RCBEUTR1",49,0)
 Q RCTRANDA
"RTN","RCBEUTR1",50,0)
 ;
"RTN","RCBEUTR1",51,0)
 ; PRCA*4.5*270 add CRD flag so FMS knows this is a corrected record
"RTN","RCBEUTR1",52,0)
 ; INCDEC(RCBILLDA,RCVALUE,RCCOMMNT,RCDATE,RCPREPAY,RCONTADJ) ;  automatically
"RTN","RCBEUTR1",53,0)
INCDEC(RCBILLDA,RCVALUE,RCCOMMNT,RCDATE,RCPREPAY,RCONTADJ,RCCRD) ;
"RTN","RCBEUTR1",54,0)
 ;  automatically create an increase or decrease adjustment for a bill
"RTN","RCBEUTR1",55,0)
 ;  pass variables:
"RTN","RCBEUTR1",56,0)
 ;      rcvalue  = principal value for the transaction.
"RTN","RCBEUTR1",57,0)
 ;                 if rcvalue is less than zero, it will create a
"RTN","RCBEUTR1",58,0)
 ;                 decrease adjustment.  if rcvalue is greater than
"RTN","RCBEUTR1",59,0)
 ;                 zero, it will create an increase adjustment.
"RTN","RCBEUTR1",60,0)
 ;      rccommnt = the comments for the word processing field.
"RTN","RCBEUTR1",61,0)
 ;      rcdate   = optional processing date and time.  if not
"RTN","RCBEUTR1",62,0)
 ;                 passed, the current date and time will be used
"RTN","RCBEUTR1",63,0)
 ;      rcprepay = optional prepayment transaction.  this is the
"RTN","RCBEUTR1",64,0)
 ;                 payment transaction applied to the bill to
"RTN","RCBEUTR1",65,0)
 ;                 create the decrease adjustment.  this gets
"RTN","RCBEUTR1",66,0)
 ;                 stored in field 20 (file 433).
"RTN","RCBEUTR1",67,0)
 ;      rcontadj = optional contract adjustment.  if 1 then this
"RTN","RCBEUTR1",68,0)
 ;                 gets stored in field 88 (file 433).
"RTN","RCBEUTR1",69,0)
 ;      rccrd    = optional corrected flag.  If 1, then FMS must 1st cancel or delete the
"RTN","RCBEUTR1",70,0)
 ;                 original billing document before creating the new one.
"RTN","RCBEUTR1",71,0)
 ;
"RTN","RCBEUTR1",72,0)
 ;  returns transaction number added to 433 if successful.
"RTN","RCBEUTR1",73,0)
 ;
"RTN","RCBEUTR1",74,0)
 N ADJNUMB,RCDRSTRG,RCTRANDA,X,Y,RCNEG
"RTN","RCBEUTR1",75,0)
 ;
"RTN","RCBEUTR1",76,0)
 ;  add the transaction (if added to 433, transaction is locked)
"RTN","RCBEUTR1",77,0)
 S RCTRANDA=$$ADD433^RCBEUTRA(RCBILLDA,$S(RCVALUE>0:1,1:35)) I 'RCTRANDA Q 0
"RTN","RCBEUTR1",78,0)
 ;
"RTN","RCBEUTR1",79,0)
 ;  build dr string
"RTN","RCBEUTR1",80,0)
 ;  11=transaction date (strip off time)
"RTN","RCBEUTR1",81,0)
 S RCDRSTRG="11////"_$S($G(RCDATE):$P(RCDATE,"."),1:DT)_";"
"RTN","RCBEUTR1",82,0)
 ;  transaction value (make sure it is not negative)
"RTN","RCBEUTR1",83,0)
 I RCVALUE<0 S RCVALUE=-RCVALUE
"RTN","RCBEUTR1",84,0)
 S RCDRSTRG=RCDRSTRG_"15////"_RCVALUE_";"
"RTN","RCBEUTR1",85,0)
 S RCDRSTRG=RCDRSTRG_"81////"_RCVALUE_";"
"RTN","RCBEUTR1",86,0)
 ;
"RTN","RCBEUTR1",87,0)
 ;  get the next adjustment number if increase(1) or decrease(35)
"RTN","RCBEUTR1",88,0)
 ;  start with the last transaction and work backwards
"RTN","RCBEUTR1",89,0)
 S X=999999999999,ADJNUMB=1
"RTN","RCBEUTR1",90,0)
 F  S X=$O(^PRCA(433,"C",RCBILLDA,X),-1) Q:'X  I $P($G(^PRCA(433,X,1)),"^",4) I $P(^(1),"^",2)=1!($P(^(1),"^",2)=35) S ADJNUMB=$P(^(1),"^",4)+1 Q
"RTN","RCBEUTR1",91,0)
 S RCDRSTRG=RCDRSTRG_"14////"_ADJNUMB_";"
"RTN","RCBEUTR1",92,0)
 ;
"RTN","RCBEUTR1",93,0)
 ;  date entered
"RTN","RCBEUTR1",94,0)
 I $G(RCDATE) S RCDRSTRG=RCDRSTRG_"19////"_RCDATE_";"
"RTN","RCBEUTR1",95,0)
 ;
"RTN","RCBEUTR1",96,0)
 ;  store the prepayment transaction
"RTN","RCBEUTR1",97,0)
 I $G(RCPREPAY) D
"RTN","RCBEUTR1",98,0)
 .   S RCDRSTRG=RCDRSTRG_"20////"_RCPREPAY_";"
"RTN","RCBEUTR1",99,0)
 .   ;  for prepayments, set the incomplete transaction flag
"RTN","RCBEUTR1",100,0)
 .   ;  this will no longer be used after patch 146 and can
"RTN","RCBEUTR1",101,0)
 .   ;  be removed
"RTN","RCBEUTR1",102,0)
 .   S RCDRSTRG=RCDRSTRG_"10////1;"
"RTN","RCBEUTR1",103,0)
 ;
"RTN","RCBEUTR1",104,0)
 ;  contract adjustment
"RTN","RCBEUTR1",105,0)
 I $G(RCONTADJ) S RCDRSTRG=RCDRSTRG_"88///1;"
"RTN","RCBEUTR1",106,0)
 ;
"RTN","RCBEUTR1",107,0)
 ;  input the fields for the transaction
"RTN","RCBEUTR1",108,0)
 S Y=$$EDIT433^RCBEUTRA(RCTRANDA,RCDRSTRG) I 'Y L -^PRCA(433,RCTRANDA) Q 0
"RTN","RCBEUTR1",109,0)
 ;
"RTN","RCBEUTR1",110,0)
 ;  set the comment
"RTN","RCBEUTR1",111,0)
 I $D(RCCOMMNT(1)) D ADDCOMM^RCBEUTRA(RCTRANDA,.RCCOMMNT)
"RTN","RCBEUTR1",112,0)
 ;
"RTN","RCBEUTR1",113,0)
 ;  mark the transaction processed
"RTN","RCBEUTR1",114,0)
 D PROCESS^RCBEUTRA(RCTRANDA)
"RTN","RCBEUTR1",115,0)
 ;
"RTN","RCBEUTR1",116,0)
 ;  update the fiscal year multiple (must be done after marked as
"RTN","RCBEUTR1",117,0)
 ;  processed so the value is defined)
"RTN","RCBEUTR1",118,0)
 D FYMULT^RCBEUTRA(RCTRANDA)
"RTN","RCBEUTR1",119,0)
 ;
"RTN","RCBEUTR1",120,0)
 ;  update the bill file with the balance of the transaction
"RTN","RCBEUTR1",121,0)
 ; PRCA276 - add exception condition - needs to quit receipt processing when negative claim balance could result
"RTN","RCBEUTR1",122,0)
 S RCNEG=0 D SETBAL^RCBEUBIL(RCTRANDA,.RCNEG) I RCNEG D DEL433^RCBEUTRA(RCTRANDA,"CANCELLED WORKLIST DEC ADJ TO PREVENT NEG PRIN BAL",1) L -^PRCA(433,RCTRANDA) Q "0^1"
"RTN","RCBEUTR1",123,0)
 ;
"RTN","RCBEUTR1",124,0)
 ;  if the bill has no balance, close or cancel it
"RTN","RCBEUTR1",125,0)
 D CLOSEIT(RCBILLDA)
"RTN","RCBEUTR1",126,0)
 ;
"RTN","RCBEUTR1",127,0)
 ;  send FMS document if non-accrued (redo this later on)
"RTN","RCBEUTR1",128,0)
 I '$$ACCK^PRCAACC(RCBILLDA) D
"RTN","RCBEUTR1",129,0)
 .   N D0,DA,DI,DIC,DIE,DIQ2,DQ,DR,ENT,FMSNUM,GECSDATA
"RTN","RCBEUTR1",130,0)
 .   N CATEG,DATA1,ERR
"RTN","RCBEUTR1",131,0)
 .   S CATEG=$P($G(^PRCA(430,RCBILLDA,0)),"^",2)
"RTN","RCBEUTR1",132,0)
 .   ;
"RTN","RCBEUTR1",133,0)
 .   ;  category=29 champva, do not send to fms, quit
"RTN","RCBEUTR1",134,0)
 .   I CATEG=29 Q
"RTN","RCBEUTR1",135,0)
 .   ;
"RTN","RCBEUTR1",136,0)
 .   ;  category=30 tricare or 32 tricare third party, and contract adj
"RTN","RCBEUTR1",137,0)
 .   I (CATEG=30!(CATEG=32)),$P($G(^PRCA(433,RCTRANDA,8)),"^",8) D  Q
"RTN","RCBEUTR1",138,0)
 .   .   S DATA1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCBEUTR1",139,0)
 .   .   D EN^PRCAFWO(RCBILLDA,$P(DATA1,"^",1),$P(DATA1,"^",5),$$SITE^RCMSITE,RCTRANDA)
"RTN","RCBEUTR1",140,0)
 .   ;
"RTN","RCBEUTR1",141,0)
 .   ;  all other categories
"RTN","RCBEUTR1",142,0)
 .   ;  pass trans amount(1;5),trans type(1;2),trans date(1;1)
"RTN","RCBEUTR1",143,0)
 .   S DATA1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCBEUTR1",144,0)
 .   ;
"RTN","RCBEUTR1",145,0)
 .   ; PRCA*4.5*270 - pass CRD flag to FMS
"RTN","RCBEUTR1",146,0)
 .   D EN^PRCAFBDM(RCBILLDA,$P(DATA1,"^",5),$P(DATA1,"^",2),$P(DATA1,"^",1),RCTRANDA,.ERR,$G(RCCRD))
"RTN","RCBEUTR1",147,0)
 ;
"RTN","RCBEUTR1",148,0)
 ;  clear the lock and return the transaction added
"RTN","RCBEUTR1",149,0)
 L -^PRCA(433,RCTRANDA)
"RTN","RCBEUTR1",150,0)
 Q RCTRANDA
"RTN","RCBEUTR1",151,0)
 ;
"RTN","RCBEUTR1",152,0)
 ;
"RTN","RCBEUTR1",153,0)
CLOSEIT(RCBILLDA) ;  check to cancel or close bill with no balance
"RTN","RCBEUTR1",154,0)
 N AMTPAID,BILLBAL,DATA7,TRANDA
"RTN","RCBEUTR1",155,0)
 ;  if the bill has no balance, close or cancel it
"RTN","RCBEUTR1",156,0)
 S DATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEUTR1",157,0)
 S BILLBAL=$P(DATA7,"^")+$P(DATA7,"^",2)+$P(DATA7,"^",3)+$P(DATA7,"^",4)+$P(DATA7,"^",5)
"RTN","RCBEUTR1",158,0)
 I 'BILLBAL D
"RTN","RCBEUTR1",159,0)
 .   ;  get payments recorded against the bill.  if payments have been
"RTN","RCBEUTR1",160,0)
 .   ;  made, then the status of the bill should be collected/closed.
"RTN","RCBEUTR1",161,0)
 .   S AMTPAID=$P(DATA7,"^",7)+$P(DATA7,"^",8)+$P(DATA7,"^",9)+$P(DATA7,"^",10)+$P(DATA7,"^",11)
"RTN","RCBEUTR1",162,0)
 .   I AMTPAID D CHGSTAT^RCBEUBIL(RCBILLDA,22) Q
"RTN","RCBEUTR1",163,0)
 .   ;  if the last transaction was a decrease contract adjustment,
"RTN","RCBEUTR1",164,0)
 .   ;  then the status will be collected/closed
"RTN","RCBEUTR1",165,0)
 .   S TRANDA=+$O(^PRCA(433,"C",RCBILLDA,999999999999),-1)
"RTN","RCBEUTR1",166,0)
 .   I $P($G(^PRCA(433,TRANDA,8)),"^",8) D CHGSTAT^RCBEUBIL(RCBILLDA,22) Q
"RTN","RCBEUTR1",167,0)
 .   ;  otherwise it should be cancellation
"RTN","RCBEUTR1",168,0)
 .   D CHGSTAT^RCBEUBIL(RCBILLDA,39)
"RTN","RCBEUTR1",169,0)
 Q
"RTN","RCDPAYER")
0^25^B25868382^B13162829
"RTN","RCDPAYER",1,0)
RCDPAYER ;ALB/PJH - TPJI Utility ;9/5/11 11:40pm
"RTN","RCDPAYER",2,0)
 ;;4.5;Accounts Receivable;**269,276**;Mar 20, 1995;Build 87
"RTN","RCDPAYER",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPAYER",4,0)
 ;
"RTN","RCDPAYER",5,0)
 ;Integration Agreement 5549
"RTN","RCDPAYER",6,0)
 ;
"RTN","RCDPAYER",7,0)
 Q
"RTN","RCDPAYER",8,0)
 ;
"RTN","RCDPAYER",9,0)
EN(IB3611) ;Called from IBJTTC
"RTN","RCDPAYER",10,0)
 ; IB3611 = ien of EXPLANATION OF BENEFITS file (361.1)
"RTN","RCDPAYER",11,0)
 ; gathers payer contact data from file 361.1 and 344.4
"RTN","RCDPAYER",12,0)
 ; returns the data to IBJTTC for display on COMMENT HISTORY screen of TPJI
"RTN","RCDPAYER",13,0)
 N AR3444,CONTACTS,ERA3,FOUND,I,IBTEXT,IB25,STR,WEB,NAME
"RTN","RCDPAYER",14,0)
 ;
"RTN","RCDPAYER",15,0)
 S CONTACTS="",STR="",FOUND=0,WEB="",NAME=""
"RTN","RCDPAYER",16,0)
 ;
"RTN","RCDPAYER",17,0)
 ;Retrieve contacts from EOB file
"RTN","RCDPAYER",18,0)
 S IB25=$P($G(^IBM(361.1,IB3611,25)),U,1,7) ;IA 4051
"RTN","RCDPAYER",19,0)
 S:$TR(IB25,U,"")]"" FOUND=1,STR=IB25
"RTN","RCDPAYER",20,0)
 ;
"RTN","RCDPAYER",21,0)
 ;Get ERA reference
"RTN","RCDPAYER",22,0)
 S AR3444=$O(^RCY(344.4,"ADET",IB3611,""))
"RTN","RCDPAYER",23,0)
 ;
"RTN","RCDPAYER",24,0)
 ;If no contact in EOB retrieve contacts from ERA file
"RTN","RCDPAYER",25,0)
 I AR3444,'FOUND D
"RTN","RCDPAYER",26,0)
 .S ERA3=$P($G(^RCY(344.4,AR3444,3)),U,1,7)
"RTN","RCDPAYER",27,0)
 .S:$TR(ERA3,U,"")]"" FOUND=1,STR=ERA3
"RTN","RCDPAYER",28,0)
 ;
"RTN","RCDPAYER",29,0)
 ;Retrieve Payer Web Address from ERA file
"RTN","RCDPAYER",30,0)
 I AR3444 S WEB=$P($G(^RCY(344.4,AR3444,5)),U) S:WEB]"" FOUND=1
"RTN","RCDPAYER",31,0)
 ;
"RTN","RCDPAYER",32,0)
 ;Get Payer Contact Name
"RTN","RCDPAYER",33,0)
 S NAME=$P(STR,U) S:NAME]"" FOUND=1
"RTN","RCDPAYER",34,0)
 ;
"RTN","RCDPAYER",35,0)
 ;Format contacts
"RTN","RCDPAYER",36,0)
 I STR]"" D
"RTN","RCDPAYER",37,0)
 .N I,CTYP,CPOS
"RTN","RCDPAYER",38,0)
 .F I=2,4,6 D:$P(STR,U,I)]""
"RTN","RCDPAYER",39,0)
 ..;Validate contact type
"RTN","RCDPAYER",40,0)
 ..S CTYP=$P(STR,U,I+1)
"RTN","RCDPAYER",41,0)
 ..S CPOS=$S(CTYP="TE":1,CTYP="FX":2,CTYP="EM":3,CTYP="EX":4,1:0)
"RTN","RCDPAYER",42,0)
 ..Q:'CPOS
"RTN","RCDPAYER",43,0)
 ..;Save only first occurance of each type of contact
"RTN","RCDPAYER",44,0)
 ..S:$P(CONTACTS,U,CPOS)="" $P(CONTACTS,U,CPOS)=$P(STR,U,I)
"RTN","RCDPAYER",45,0)
 ;
"RTN","RCDPAYER",46,0)
 ;Allow for misfiled legacy contact data
"RTN","RCDPAYER",47,0)
 I FOUND,NAME="",WEB="",CONTACTS="" S FOUND=0
"RTN","RCDPAYER",48,0)
 ;Return found_web_phone_fax_email
"RTN","RCDPAYER",49,0)
 Q FOUND_U_NAME_U_WEB_U_CONTACTS
"RTN","RCDPAYER",50,0)
 ;
"RTN","RCDPAYER",51,0)
ADD(PRCABN) ;Update AR Transaction file #433 with comment type transaction
"RTN","RCDPAYER",52,0)
 ;PRCABN = Bill/Claim IEN for file #399.
"RTN","RCDPAYER",53,0)
 ;called only if 'ERA Contact Information' type comment is not found
"RTN","RCDPAYER",54,0)
 ;serves as a notice to the user that the contact data came from the 835 ERA. Called from IBJTTC
"RTN","RCDPAYER",55,0)
 ;
"RTN","RCDPAYER",56,0)
 ;Note; PJH 8/11/2010 - see ADJUST^RCJIBFN3 (called by ARCA^IBJTA1)
"RTN","RCDPAYER",57,0)
 ;
"RTN","RCDPAYER",58,0)
 N AUTHDT,IBIFN,MRADT,STATUS
"RTN","RCDPAYER",59,0)
 S IBIFN=PRCABN
"RTN","RCDPAYER",60,0)
 S STATUS=$P($G(^DGCR(399,IBIFN,0)),U,13)
"RTN","RCDPAYER",61,0)
 S AUTHDT=$P($G(^DGCR(399,IBIFN,"S")),U,10)
"RTN","RCDPAYER",62,0)
 S MRADT=$P($G(^DGCR(399,IBIFN,"S")),U,7)
"RTN","RCDPAYER",63,0)
 ;
"RTN","RCDPAYER",64,0)
 ;If claim status is "NOT REVIEWED" or claim status is "CANCELLED"
"RTN","RCDPAYER",65,0)
 ;with neither MRA request date nor Authorization date present
"RTN","RCDPAYER",66,0)
 ;comment may not be added
"RTN","RCDPAYER",67,0)
 I STATUS=1!(STATUS=7&(MRADT="")&(AUTHDT="")) Q
"RTN","RCDPAYER",68,0)
 ;
"RTN","RCDPAYER",69,0)
 ;If claim status is "REQUEST MRA" or claim status is "CANCELLED"
"RTN","RCDPAYER",70,0)
 ;with MRA request date present, but no Authorization date comment
"RTN","RCDPAYER",71,0)
 ;cannot be added
"RTN","RCDPAYER",72,0)
 I STATUS=2!(STATUS=7&(MRADT'="")&(AUTHDT="")) Q
"RTN","RCDPAYER",73,0)
 ;
"RTN","RCDPAYER",74,0)
 ;Ignore bill cancelled in IB
"RTN","RCDPAYER",75,0)
 I '$D(^PRCA(430,PRCABN,2,0)) Q
"RTN","RCDPAYER",76,0)
 ;
"RTN","RCDPAYER",77,0)
 ;Ignore Archived bill
"RTN","RCDPAYER",78,0)
 I $P($G(^PRCA(430,PRCABN,0)),"^",8)=49 Q
"RTN","RCDPAYER",79,0)
 ;
"RTN","RCDPAYER",80,0)
 ;Build AR Transaction
"RTN","RCDPAYER",81,0)
 ;
"RTN","RCDPAYER",82,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY
"RTN","RCDPAYER",83,0)
 ;
"RTN","RCDPAYER",84,0)
 ;Create stub record in 433
"RTN","RCDPAYER",85,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCDPAYER",86,0)
 ;
"RTN","RCDPAYER",87,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCDPAYER",88,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCDPAYER",89,0)
 ;
"RTN","RCDPAYER",90,0)
 ;Direct update of [PRCA COMMENT] edit template fields 
"RTN","RCDPAYER",91,0)
 ;(excluding Date of Contact, Extended Comments and Follow-up Date)
"RTN","RCDPAYER",92,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCDPAYER",93,0)
 S DR=".03////"_PRCABN ;Bill Number
"RTN","RCDPAYER",94,0)
 S DR=DR_";3////0" ;Calm Code Done
"RTN","RCDPAYER",95,0)
 S DR=DR_";12////"_$O(^PRCA(430.3,"AC",17,0)) ;Transaction Type
"RTN","RCDPAYER",96,0)
 S DR=DR_";15////0" ;Transaction Amount
"RTN","RCDPAYER",97,0)
 S DR=DR_";42////.5" ;Processed by POSTMASTER
"RTN","RCDPAYER",98,0)
 S DR=DR_";11////"_DT ;Transaction date
"RTN","RCDPAYER",99,0)
 S DR=DR_";4////2" ;Transaction status (complete)
"RTN","RCDPAYER",100,0)
 S DR=DR_";5.02////ERA Payer Contact Information" D ^DIE
"RTN","RCDPAYER",101,0)
 ;
"RTN","RCDPAYER",102,0)
 ;Leave validation checks in place
"RTN","RCDPAYER",103,0)
 I $P($G(^PRCA(433,PRCAEN,5)),"^",2)=""!'$P(^PRCA(433,PRCAEN,1),"^") S PRCACOMM="TRANSACTION INCOMPLETE" D DELETE^PRCAWO1 K PRCACOMM Q
"RTN","RCDPAYER",104,0)
 ;
"RTN","RCDPAYER",105,0)
 I '$D(PRCAD("DELETE")) S RCASK=1 D TRANUP^PRCAUTL,UPPRIN^PRCADJ
"RTN","RCDPAYER",106,0)
 ;
"RTN","RCDPAYER",107,0)
 I $P($G(^RCD(340,+$P(^PRCA(430,PRCABN,0),"^",9),0)),"^")[";DPT(" D
"RTN","RCDPAYER",108,0)
 .;Ensure comment does not appear on patient statement
"RTN","RCDPAYER",109,0)
 .S $P(^PRCA(433,PRCAEN,0),"^",10)=1
"RTN","RCDPAYER",110,0)
 Q
"RTN","RCDPAYER",111,0)
 ;
"RTN","RCDPAYER",112,0)
 ;Audit Comment from EOB Move/Copy
"RTN","RCDPAYER",113,0)
AUDIT(ORIG,TEXT,MODE) ;
"RTN","RCDPAYER",114,0)
 ; ORIG = ien of entry in 361.1
"RTN","RCDPAYER",115,0)
 ; TEXT = move/copy reason
"RTN","RCDPAYER",116,0)
 ; MODE = is this a move or a copy event
"RTN","RCDPAYER",117,0)
 ;
"RTN","RCDPAYER",118,0)
 ;Translate EOB ien  to claim number IA 4051
"RTN","RCDPAYER",119,0)
 N PRCABN
"RTN","RCDPAYER",120,0)
 S PRCABN=$P($G(^IBM(361.1,ORIG,0)),U) Q:'PRCABN
"RTN","RCDPAYER",121,0)
 ;Build AR Transaction
"RTN","RCDPAYER",122,0)
 ;
"RTN","RCDPAYER",123,0)
 N PRCAEN,PRCAA1,DR,DIE,DA,D0,PRCAD,RCASK,PRCAA2,PRCA,PRCATY
"RTN","RCDPAYER",124,0)
 ;
"RTN","RCDPAYER",125,0)
 ;Create stub record in 433
"RTN","RCDPAYER",126,0)
 D SETTR^PRCAUTL,PATTR^PRCAUTL Q:'$D(PRCAEN)
"RTN","RCDPAYER",127,0)
 ;
"RTN","RCDPAYER",128,0)
 S PRCAA1=$S($D(^PRCA(433,PRCAEN,4,0)):+$P(^(0),U,4),1:0)
"RTN","RCDPAYER",129,0)
 Q:PRCAA1'>0  S PRCAA2=$P(^(0),U,3)
"RTN","RCDPAYER",130,0)
 ;
"RTN","RCDPAYER",131,0)
 N MTEXT,INIT
"RTN","RCDPAYER",132,0)
 S INIT=$$GET1^DIQ(200,DUZ,1)
"RTN","RCDPAYER",133,0)
 S:INIT="" INIT="USER UNK."
"RTN","RCDPAYER",134,0)
 S MTEXT="EEOB MOVED BY "_INIT
"RTN","RCDPAYER",135,0)
 I MODE="C" S MTEXT="EEOB COPIED BY "_INIT
"RTN","RCDPAYER",136,0)
 I MODE="W" S MTEXT="EEOB MOVE/COPY IN SPLIT/EDIT"
"RTN","RCDPAYER",137,0)
 ;Direct update of [PRCA COMMENT] edit template fields 
"RTN","RCDPAYER",138,0)
 ;(excluding Date of Contact, Extended Comments and Follow-up Date)
"RTN","RCDPAYER",139,0)
 S DIE="^PRCA(433,",DA=PRCAEN
"RTN","RCDPAYER",140,0)
 S DR=".03////"_PRCABN ;Bill Number
"RTN","RCDPAYER",141,0)
 S DR=DR_";3////0" ;Calm Code Done
"RTN","RCDPAYER",142,0)
 S DR=DR_";12////"_$O(^PRCA(430.3,"AC",17,0)) ;Transaction Type
"RTN","RCDPAYER",143,0)
 S DR=DR_";15////0" ;Transaction Amount
"RTN","RCDPAYER",144,0)
 S DR=DR_";42////"_DUZ ;Processed by  ; kl - 8/23/11 move/copy needs to have the actual user not postmaster
"RTN","RCDPAYER",145,0)
 S DR=DR_";11////"_DT ;Transaction date
"RTN","RCDPAYER",146,0)
 S DR=DR_";4////2" ;Transaction status (complete)
"RTN","RCDPAYER",147,0)
 S DR=DR_";5.02////"_MTEXT ;Brief comment
"RTN","RCDPAYER",148,0)
 D ^DIE
"RTN","RCDPAYER",149,0)
 ;Store justification text in comment field
"RTN","RCDPAYER",150,0)
 N DA,DIC,DLAYGO,DR,X
"RTN","RCDPAYER",151,0)
 S DA(1)=PRCAEN
"RTN","RCDPAYER",152,0)
 S DIC="^PRCA(433,"_DA(1)_",7,",DIC(0)="L",X=$P(TEXT,U)
"RTN","RCDPAYER",153,0)
 D FILE^DICN
"RTN","RCDPAYER",154,0)
 ;Store auto generated text from stand alone option in comment field
"RTN","RCDPAYER",155,0)
 I $P(TEXT,U,2)]"" D
"RTN","RCDPAYER",156,0)
 .N DA,DIC,DLAYGO,DR,X
"RTN","RCDPAYER",157,0)
 .S DA(1)=PRCAEN
"RTN","RCDPAYER",158,0)
 .S DIC="^PRCA(433,"_DA(1)_",7,",DIC(0)="L",X="- "_$P(TEXT,U,2)
"RTN","RCDPAYER",159,0)
 .D FILE^DICN
"RTN","RCDPAYER",160,0)
 Q
"RTN","RCDPBPLM")
0^11^B56287524^B53138816
"RTN","RCDPBPLM",1,0)
RCDPBPLM ;WISC/RFJ - bill profile ;1 Jun 99
"RTN","RCDPBPLM",2,0)
 ;;4.5;Accounts Receivable;**114,153,159,241,276**;Mar 20, 1995;Build 87
"RTN","RCDPBPLM",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPBPLM",4,0)
 ;
"RTN","RCDPBPLM",5,0)
 ;
"RTN","RCDPBPLM",6,0)
 ;  called from menu option (19)
"RTN","RCDPBPLM",7,0)
 ;
"RTN","RCDPBPLM",8,0)
 N RCBILLDA,RCDPFXIT
"RTN","RCDPBPLM",9,0)
 ;
"RTN","RCDPBPLM",10,0)
 F  D  Q:'RCBILLDA
"RTN","RCDPBPLM",11,0)
 . W !! S RCBILLDA=$$SELBILL^RCDPBTLM
"RTN","RCDPBPLM",12,0)
 . I RCBILLDA<1 S RCBILLDA=0 Q
"RTN","RCDPBPLM",13,0)
 . D EN^VALM("RCDP BILL PROFILE")
"RTN","RCDPBPLM",14,0)
 . ;  fast exit
"RTN","RCDPBPLM",15,0)
 . I $G(RCDPFXIT) S RCBILLDA=0
"RTN","RCDPBPLM",16,0)
 Q
"RTN","RCDPBPLM",17,0)
 ;
"RTN","RCDPBPLM",18,0)
 ;
"RTN","RCDPBPLM",19,0)
INIT ;  initialization for list manager list
"RTN","RCDPBPLM",20,0)
 ;  requires rcbillda
"RTN","RCDPBPLM",21,0)
 N BILLED,COMMDA,DATA,PAID,RCDPDATA,RCFYDA,RCLINE,REPTYPE,X1,X2,RCDEBTOR,DFN
"RTN","RCDPBPLM",22,0)
 K ^TMP("RCDPBPLM",$J),^TMP("VALM VIDEO",$J)
"RTN","RCDPBPLM",23,0)
 ;
"RTN","RCDPBPLM",24,0)
 ;  fast exit
"RTN","RCDPBPLM",25,0)
 I $G(RCDPFXIT) S VALMQUIT=1 Q
"RTN","RCDPBPLM",26,0)
 ;
"RTN","RCDPBPLM",27,0)
 D DIQ430(RCBILLDA,".01:300")
"RTN","RCDPBPLM",28,0)
 ;
"RTN","RCDPBPLM",29,0)
 ;  set the listmanager line number
"RTN","RCDPBPLM",30,0)
 S RCLINE=0
"RTN","RCDPBPLM",31,0)
 ;
"RTN","RCDPBPLM",32,0)
 S DATA=$$ACCNTHDR^RCDPAPLM(RCDPDATA(430,RCBILLDA,9,"I"))
"RTN","RCDPBPLM",33,0)
 S RCLINE=RCLINE+1 D SET("Account: "_$P(DATA,"^")_" "_$P(DATA,"^",2),RCLINE,1,80)
"RTN","RCDPBPLM",34,0)
 D SET($P(DATA,"^",3),RCLINE,60,80)
"RTN","RCDPBPLM",35,0)
 S %="" I $TR($P(DATA,"^",4,9),"^")'="" S %=$P(DATA,"^",4)_", "_$P(DATA,"^",7)_", "_$P(DATA,"^",8)_"  "_$P(DATA,"^",9)
"RTN","RCDPBPLM",36,0)
 S RCLINE=RCLINE+1 D SET("   Addr: "_%,RCLINE,1,80)
"RTN","RCDPBPLM",37,0)
 S RCLINE=RCLINE+1 D SET("  Phone: "_$P(DATA,"^",10),RCLINE,1,80)
"RTN","RCDPBPLM",38,0)
 S RCDEBTOR=$P(^PRCA(430,RCBILLDA,0),U,9)
"RTN","RCDPBPLM",39,0)
 I $P(^RCD(340,+RCDEBTOR,0),U)["DPT(" S DFN=+^(0) D
"RTN","RCDPBPLM",40,0)
 . Q:$$EMGRES^DGUTL(DFN)'["K"
"RTN","RCDPBPLM",41,0)
 . S RCLINE=RCLINE+1
"RTN","RCDPBPLM",42,0)
 . D SET("EMERGENCY RESPONSE INDICATOR: HURRICANE KATRINA",RCLINE,1,80)
"RTN","RCDPBPLM",43,0)
 ;
"RTN","RCDPBPLM",44,0)
 ;  bill descriptive data
"RTN","RCDPBPLM",45,0)
 S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPBPLM",46,0)
 ; PRCA*4.5*276 - get 1st/3rd party payment add EEOB indicator when applicable
"RTN","RCDPBPLM",47,0)
 S PRCOUT=$$COMP3^PRCAAPR(RCBILLDA)
"RTN","RCDPBPLM",48,0)
 I PRCOUT'="%" S PRCOUT=$$IBEEOBCK^PRCAAPR1(RCBILLDA)
"RTN","RCDPBPLM",49,0)
 S RCLINE=RCLINE+1 ; D SET("Bill Number",RCLINE,1,80,.01,IOUON,IOUOFF)
"RTN","RCDPBPLM",50,0)
 D SET("Bill Number: "_$G(PRCOUT)_$P(RCDPDATA(430,RCBILLDA,.01,"E"),"^"),RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPBPLM",51,0)
 D SET("Category",RCLINE,40,80,2)
"RTN","RCDPBPLM",52,0)
 S RCLINE=RCLINE+1 D SET("Date  Prepared",RCLINE,1,80,10)
"RTN","RCDPBPLM",53,0)
 D SET("Status",RCLINE,42,80,8)
"RTN","RCDPBPLM",54,0)
 S RCLINE=RCLINE+1 D SET("Date Activated",RCLINE,1,80,60)
"RTN","RCDPBPLM",55,0)
 S RCLINE=RCLINE+1 D SET("Date Status Up",RCLINE,1,80,14)
"RTN","RCDPBPLM",56,0)
 D SET("By",RCLINE,46,80,17)
"RTN","RCDPBPLM",57,0)
 ;display TP bills Division of Care
"RTN","RCDPBPLM",58,0)
 I "T"=$P($G(^PRCA(430.2,+RCDPDATA(430,RCBILLDA,2,"I"),0)),"^",6) D
"RTN","RCDPBPLM",59,0)
 . S RCDIV=$$DIV^IBJDF2(RCBILLDA) I +RCDIV D
"RTN","RCDPBPLM",60,0)
 .. S RCDIV=$P($G(^DG(40.8,RCDIV,0)),U,1) I RCDIV="" Q
"RTN","RCDPBPLM",61,0)
 .. S RCLINE=RCLINE+1 D SET("Division of Care: "_RCDIV,RCLINE,1,80)
"RTN","RCDPBPLM",62,0)
 S RCLINE=RCLINE+1 D SET("Resulting From",RCLINE,1,80,4.5)
"RTN","RCDPBPLM",63,0)
 I RCDPDATA(430,RCBILLDA,15.1,"E")'="" D
"RTN","RCDPBPLM",64,0)
 . S RCLINE=RCLINE+1 D SET("  Type of Care",RCLINE,1,80,15.1)
"RTN","RCDPBPLM",65,0)
 S RCLINE=RCLINE+1 D SET("        Remark",RCLINE,1,80,15)
"RTN","RCDPBPLM",66,0)
 ;  display comments if there
"RTN","RCDPBPLM",67,0)
 I $O(^PRCA(430,RCBILLDA,10,0)) D
"RTN","RCDPBPLM",68,0)
 . S RCLINE=RCLINE+1 D SET("Comments:",RCLINE,1,80)
"RTN","RCDPBPLM",69,0)
 . S COMMDA=0 F  S COMMDA=$O(^PRCA(430,RCBILLDA,10,COMMDA)) Q:'COMMDA  D
"RTN","RCDPBPLM",70,0)
 .. S RCLINE=RCLINE+1 D SET("  "_$G(^PRCA(430,RCBILLDA,10,COMMDA,0)),RCLINE,1,80)
"RTN","RCDPBPLM",71,0)
 ;
"RTN","RCDPBPLM",72,0)
 ;  int/adm rate and date
"RTN","RCDPBPLM",73,0)
 S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPBPLM",74,0)
 S DATA=$$INT^RCMSFN01(RCDPDATA(430,RCBILLDA,10,"I"))
"RTN","RCDPBPLM",75,0)
 S Y=$P(DATA,"^",2) I Y D DD^%DT
"RTN","RCDPBPLM",76,0)
 S RCLINE=RCLINE+1 D SET("Interest Effective Rate Date: "_Y,RCLINE,1,80)
"RTN","RCDPBPLM",77,0)
 D SET(" Annual Rate: "_$P(DATA,"^"),RCLINE,55,80)
"RTN","RCDPBPLM",78,0)
 S DATA=$$ADM^RCMSFN01(RCDPDATA(430,RCBILLDA,10,"I"))
"RTN","RCDPBPLM",79,0)
 S Y=$P(DATA,"^",2) I Y D DD^%DT
"RTN","RCDPBPLM",80,0)
 S RCLINE=RCLINE+1 D SET("   Admin Effective Rate Date: "_Y,RCLINE,1,80)
"RTN","RCDPBPLM",81,0)
 D SET("Monthly Rate: "_$P(DATA,"^"),RCLINE,55,80)
"RTN","RCDPBPLM",82,0)
 S RCLINE=RCLINE+1 D SET("  Last Int/Admin Charge Date",RCLINE,1,80,67)
"RTN","RCDPBPLM",83,0)
 ;
"RTN","RCDPBPLM",84,0)
 ;  put bill balances on first line of second screen
"RTN","RCDPBPLM",85,0)
 F RCLINE=RCLINE+1:1:16 D SET(" ",RCLINE,1,80)
"RTN","RCDPBPLM",86,0)
 ;
"RTN","RCDPBPLM",87,0)
 ;  bill dollars
"RTN","RCDPBPLM",88,0)
 S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPBPLM",89,0)
 S RCLINE=RCLINE+1 D SET("Bill Balances           Billed          Paid",RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPBPLM",90,0)
 S RCLINE=RCLINE+1 D SET("     Principal: "_$J(RCDPDATA(430,RCBILLDA,71,"E"),14,2)_$J(RCDPDATA(430,RCBILLDA,77,"E"),14,2),RCLINE,1,80)
"RTN","RCDPBPLM",91,0)
 D SET("       Original Amt: "_$J(RCDPDATA(430,RCBILLDA,3,"E"),11,2),RCLINE,48,80)
"RTN","RCDPBPLM",92,0)
 S RCLINE=RCLINE+1 D SET("      Interest: "_$J(RCDPDATA(430,RCBILLDA,72,"E"),14,2)_$J(RCDPDATA(430,RCBILLDA,78,"E"),14,2),RCLINE,1,80)
"RTN","RCDPBPLM",93,0)
 I $G(RCDPDATA(430,RCBILLDA,131,"E")) D SET("Medicare Contr  Adj: "_$J(RCDPDATA(430,RCBILLDA,131,"E"),11,2),RCLINE,48,80)
"RTN","RCDPBPLM",94,0)
 I RCDPDATA(430,RCBILLDA,74,"E") D
"RTN","RCDPBPLM",95,0)
 . S RCLINE=RCLINE+1 D SET("  Marshall Fee: "_$J(RCDPDATA(430,RCBILLDA,74,"E"),14,2)_$J(RCDPDATA(430,RCBILLDA,79.1,"E"),14,2),RCLINE,1,80)
"RTN","RCDPBPLM",96,0)
 I RCDPDATA(430,RCBILLDA,75,"E") D
"RTN","RCDPBPLM",97,0)
 . S RCLINE=RCLINE+1 D SET("    Court Cost: "_$J(RCDPDATA(430,RCBILLDA,75,"E"),14,2),RCLINE,1,80)
"RTN","RCDPBPLM",98,0)
 S RCLINE=RCLINE+1 D SET("Administrative: "_$J(RCDPDATA(430,RCBILLDA,73,"E"),14,2)_$J(RCDPDATA(430,RCBILLDA,79,"E"),14,2),RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPBPLM",99,0)
 I $G(RCDPDATA(430,RCBILLDA,132,"E")) D SET("Medicare Unreim Exp: "_$J(RCDPDATA(430,RCBILLDA,132,"E"),11,2),RCLINE,48,80)
"RTN","RCDPBPLM",100,0)
 ;  compute totals
"RTN","RCDPBPLM",101,0)
 S BILLED=0 F %=71,72,73,74,75 S BILLED=BILLED+RCDPDATA(430,RCBILLDA,%,"E")
"RTN","RCDPBPLM",102,0)
 S PAID=0 F %=77,78,79,79.1 S PAID=PAID+RCDPDATA(430,RCBILLDA,%,"E")
"RTN","RCDPBPLM",103,0)
 S RCLINE=RCLINE+1 D SET("       Current: "_$J(BILLED,14,2)_$J(PAID,14,2),RCLINE,1,80)
"RTN","RCDPBPLM",104,0)
 ;
"RTN","RCDPBPLM",105,0)
 ;  show refund if there
"RTN","RCDPBPLM",106,0)
 I RCDPDATA(430,RCBILLDA,79.18,"E") D
"RTN","RCDPBPLM",107,0)
 . S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPBPLM",108,0)
 . S RCLINE=RCLINE+1 D SET("Refunded Amount",RCLINE,1,80,79.18)
"RTN","RCDPBPLM",109,0)
 . D SET("Date",RCLINE,27,80,79.19)
"RTN","RCDPBPLM",110,0)
 . D SET("By",RCLINE,50,80,79.21)
"RTN","RCDPBPLM",111,0)
 ;
"RTN","RCDPBPLM",112,0)
 ;  accounting data
"RTN","RCDPBPLM",113,0)
 S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPBPLM",114,0)
 S RCLINE=RCLINE+1 D SET("Accounting Data",RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPBPLM",115,0)
 ;  fiscal year multiple
"RTN","RCDPBPLM",116,0)
 D SET("Fiscal Year",RCLINE,20,32,0,IOUON,IOUOFF)
"RTN","RCDPBPLM",117,0)
 D SET("Approp Code",RCLINE,34,46,0,IOUON,IOUOFF)
"RTN","RCDPBPLM",118,0)
 D SET("Amount",RCLINE,50,60,0,IOUON,IOUOFF)
"RTN","RCDPBPLM",119,0)
 S RCFYDA=0 F  S RCFYDA=$O(^PRCA(430,RCBILLDA,2,RCFYDA)) Q:'RCFYDA  D
"RTN","RCDPBPLM",120,0)
 . S DATA=$G(^PRCA(430,RCBILLDA,2,RCFYDA,0))
"RTN","RCDPBPLM",121,0)
 . S RCLINE=RCLINE+1
"RTN","RCDPBPLM",122,0)
 . D SET($J($P(DATA,"^"),30),RCLINE,1,80)     ;fiscal year
"RTN","RCDPBPLM",123,0)
 . D SET($J(RCDPDATA(430,RCBILLDA,203,"E"),6),RCLINE,39,45) ;fund
"RTN","RCDPBPLM",124,0)
 . D SET($J($P(DATA,"^",2),8,2),RCLINE,48,80)   ;amount
"RTN","RCDPBPLM",125,0)
 ; determine which rsc to display
"RTN","RCDPBPLM",126,0)
 S %=RCDPDATA(430,RCBILLDA,255.1,"E") I %="" S %=RCDPDATA(430,RCBILLDA,255,"E")
"RTN","RCDPBPLM",127,0)
 S RCLINE=RCLINE+1 D SET("Rev Srce Code: "_%,RCLINE,1,80)
"RTN","RCDPBPLM",128,0)
 ;
"RTN","RCDPBPLM",129,0)
 ;  collection data
"RTN","RCDPBPLM",130,0)
 S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPBPLM",131,0)
 S RCLINE=RCLINE+1 D SET("Collection Follow up Data",RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPBPLM",132,0)
 S RCLINE=RCLINE+1 D SET("        Letter1",RCLINE,1,80,61)
"RTN","RCDPBPLM",133,0)
 S RCLINE=RCLINE+1 D SET("        Letter2",RCLINE,1,80,62)
"RTN","RCDPBPLM",134,0)
 S RCLINE=RCLINE+1 D SET("        Letter3",RCLINE,1,80,63)
"RTN","RCDPBPLM",135,0)
 S RCLINE=RCLINE+1 D SET("        Letter4",RCLINE,1,80,68)
"RTN","RCDPBPLM",136,0)
 I RCDPDATA(430,RCBILLDA,68.6,"I") D
"RTN","RCDPBPLM",137,0)
 . S RCLINE=RCLINE+1 D SET("     IRS Letter",RCLINE,1,80,68.6)
"RTN","RCDPBPLM",138,0)
 . D SET("Amount",RCLINE,65,80,68.93)
"RTN","RCDPBPLM",139,0)
 I RCDPDATA(430,RCBILLDA,64,"I") D
"RTN","RCDPBPLM",140,0)
 . S RCLINE=RCLINE+1 D SET("DC/DOJ Ref Date",RCLINE,1,80,64)
"RTN","RCDPBPLM",141,0)
 . D SET("To",RCLINE,40,80,65)
"RTN","RCDPBPLM",142,0)
 . D SET("Amount",RCLINE,65,80,66)
"RTN","RCDPBPLM",143,0)
 ;
"RTN","RCDPBPLM",144,0)
 ;  repayment plan (show only if there)
"RTN","RCDPBPLM",145,0)
 I RCDPDATA(430,RCBILLDA,41,"I") D REPAY^RCDPBPLI
"RTN","RCDPBPLM",146,0)
 ;
"RTN","RCDPBPLM",147,0)
 ;  irs data (show only if there)
"RTN","RCDPBPLM",148,0)
 I RCDPDATA(430,RCBILLDA,68.7,"I") D IRS^RCDPBPLI
"RTN","RCDPBPLM",149,0)
 ;
"RTN","RCDPBPLM",150,0)
 ;  dmc data (show only if there)
"RTN","RCDPBPLM",151,0)
 I RCDPDATA(430,RCBILLDA,121,"I") D DMC^RCDPBPLI
"RTN","RCDPBPLM",152,0)
 ;
"RTN","RCDPBPLM",153,0)
 ;  top data (show only if there)
"RTN","RCDPBPLM",154,0)
 I $G(RCDPDATA(430,RCBILLDA,141,"I")) D TOP^RCDPBPLI
"RTN","RCDPBPLM",155,0)
 ;
"RTN","RCDPBPLM",156,0)
 ;  get the report type based on category.  if third party show
"RTN","RCDPBPLM",157,0)
 ;  insurance data
"RTN","RCDPBPLM",158,0)
 S REPTYPE=$P($G(^PRCA(430.2,+RCDPDATA(430,RCBILLDA,2,"I"),0)),"^",6)
"RTN","RCDPBPLM",159,0)
 I REPTYPE="T" D INSUR^RCDPBPLI
"RTN","RCDPBPLM",160,0)
 ;
"RTN","RCDPBPLM",161,0)
 ;  report type for employee or vendor, show description field 106
"RTN","RCDPBPLM",162,0)
 I REPTYPE="O"!(REPTYPE="V") D INIT^RCDPBPLI
"RTN","RCDPBPLM",163,0)
 ;
"RTN","RCDPBPLM",164,0)
 ;  show transactions and reasons
"RTN","RCDPBPLM",165,0)
 D TRANINIT^RCDPBPLI
"RTN","RCDPBPLM",166,0)
 ;
"RTN","RCDPBPLM",167,0)
 ;  set valmcnt to number of lines in the list
"RTN","RCDPBPLM",168,0)
 S VALMCNT=RCLINE
"RTN","RCDPBPLM",169,0)
 D HDR
"RTN","RCDPBPLM",170,0)
 Q
"RTN","RCDPBPLM",171,0)
 ;
"RTN","RCDPBPLM",172,0)
 ;
"RTN","RCDPBPLM",173,0)
HDR ;  header code for list manager display
"RTN","RCDPBPLM",174,0)
 ;  requires rcbillda
"RTN","RCDPBPLM",175,0)
 S VALMHDR(1)="***** ACCOUNTS RECEIVABLE BILL PROFILE FOR "_$P($G(^PRCA(430,RCBILLDA,0)),"^")_" *****"
"RTN","RCDPBPLM",176,0)
 ; PRCA*4.5*276 - add explanation of '%' for the user
"RTN","RCDPBPLM",177,0)
 S VALMSG="|% EEOB | Enter ?? for more actions|" ; PRCA*4.5*276
"RTN","RCDPBPLM",178,0)
 Q
"RTN","RCDPBPLM",179,0)
 ;
"RTN","RCDPBPLM",180,0)
 ;
"RTN","RCDPBPLM",181,0)
EXIT ;  exit list manager option and clean up
"RTN","RCDPBPLM",182,0)
 K ^TMP("RCDPBPLM",$J)
"RTN","RCDPBPLM",183,0)
 Q
"RTN","RCDPBPLM",184,0)
 ;
"RTN","RCDPBPLM",185,0)
 ;
"RTN","RCDPBPLM",186,0)
SET(STRING,LINE,COLBEG,COLEND,FIELD,ON,OFF) ;  set array
"RTN","RCDPBPLM",187,0)
 I $G(FIELD) S STRING=STRING_$S(STRING="":"",1:": ")_$G(RCDPDATA(430,RCBILLDA,FIELD,"E"))
"RTN","RCDPBPLM",188,0)
 I STRING="",'$G(FIELD) Q
"RTN","RCDPBPLM",189,0)
 I '$D(@VALMAR@(LINE,0)) D SET^VALM10(LINE,$J("",80))
"RTN","RCDPBPLM",190,0)
 D SET^VALM10(LINE,$$SETSTR^VALM1(STRING,@VALMAR@(LINE,0),COLBEG,COLEND-COLBEG+1))
"RTN","RCDPBPLM",191,0)
 I $G(ON)]""!($G(OFF)]"") D CNTRL^VALM10(LINE,COLBEG,$L(STRING),ON,OFF)
"RTN","RCDPBPLM",192,0)
 Q
"RTN","RCDPBPLM",193,0)
 ;
"RTN","RCDPBPLM",194,0)
 ;
"RTN","RCDPBPLM",195,0)
DIQ430(DA,DR) ;  diq call to retrieve data for dr fields in file 430
"RTN","RCDPBPLM",196,0)
 N D0,DIC,DIQ,DIQ2
"RTN","RCDPBPLM",197,0)
 K RCDPDATA(430,DA)
"RTN","RCDPBPLM",198,0)
 S DIQ(0)="IE",DIC="^PRCA(430,",DIQ="RCDPDATA" D EN^DIQ1
"RTN","RCDPBPLM",199,0)
 Q
"RTN","RCDPBTLM")
0^16^B49476140^B47109458
"RTN","RCDPBTLM",1,0)
RCDPBTLM ;WISC/RFJ - bill transactions List Manager top routine ;1 Jun 99
"RTN","RCDPBTLM",2,0)
 ;;4.5;Accounts Receivable;**114,148,153,168,169,198,247,271,276**;Mar 20, 1995;Build 87
"RTN","RCDPBTLM",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPBTLM",4,0)
 ;
"RTN","RCDPBTLM",5,0)
 ; Reference to $$REC^IBRFN supported by DBIA 2031
"RTN","RCDPBTLM",6,0)
 ;
"RTN","RCDPBTLM",7,0)
 ;  called from menu option (19)
"RTN","RCDPBTLM",8,0)
 ;
"RTN","RCDPBTLM",9,0)
 N RCBILLDA,RCDPFXIT
"RTN","RCDPBTLM",10,0)
 ;
"RTN","RCDPBTLM",11,0)
 F  D  Q:'RCBILLDA
"RTN","RCDPBTLM",12,0)
 .   W !! S RCBILLDA=$$SELBILL
"RTN","RCDPBTLM",13,0)
 .   I RCBILLDA<1 S RCBILLDA=0 Q
"RTN","RCDPBTLM",14,0)
 .   D EN^VALM("RCDP TRANSACTIONS LIST")
"RTN","RCDPBTLM",15,0)
 .   ;  fast exit
"RTN","RCDPBTLM",16,0)
 .   I $G(RCDPFXIT) S RCBILLDA=0
"RTN","RCDPBTLM",17,0)
 Q
"RTN","RCDPBTLM",18,0)
 ;
"RTN","RCDPBTLM",19,0)
 ;
"RTN","RCDPBTLM",20,0)
INIT ;  initialization for list manager list
"RTN","RCDPBTLM",21,0)
 ;  requires rcbillda
"RTN","RCDPBTLM",22,0)
 N ADMIN,DATE,RCLINE,RCLIST,RCTOTAL,RCTRAN,RCTRANDA
"RTN","RCDPBTLM",23,0)
 K ^TMP("RCDPBTLM",$J),^TMP("VALM VIDEO",$J)
"RTN","RCDPBTLM",24,0)
 ;
"RTN","RCDPBTLM",25,0)
 ;  fast exit
"RTN","RCDPBTLM",26,0)
 I $G(RCDPFXIT) S VALMQUIT=1 Q
"RTN","RCDPBTLM",27,0)
 ;
"RTN","RCDPBTLM",28,0)
 ;  set the List Manager line number
"RTN","RCDPBTLM",29,0)
 S RCLINE=0
"RTN","RCDPBTLM",30,0)
 ;  set the List Manager transaction number
"RTN","RCDPBTLM",31,0)
 S RCTRAN=0
"RTN","RCDPBTLM",32,0)
 ;
"RTN","RCDPBTLM",33,0)
 ;  get transactions and balance for bill
"RTN","RCDPBTLM",34,0)
 S RCTOTAL=$$GETTRANS(RCBILLDA)
"RTN","RCDPBTLM",35,0)
 ;
"RTN","RCDPBTLM",36,0)
 S DATE="" F  S DATE=$O(RCLIST(DATE)) Q:'DATE  D
"RTN","RCDPBTLM",37,0)
 .   S RCTRANDA="" F  S RCTRANDA=$O(RCLIST(DATE,RCTRANDA)) Q:RCTRANDA=""  D
"RTN","RCDPBTLM",38,0)
 .   .   S RCLINE=RCLINE+1
"RTN","RCDPBTLM",39,0)
 .   .   ;
"RTN","RCDPBTLM",40,0)
 .   .   ;  create an index array for transaction lookup in list
"RTN","RCDPBTLM",41,0)
 .   .   I RCTRANDA D
"RTN","RCDPBTLM",42,0)
 .   .   .   S RCTRAN=RCTRAN+1
"RTN","RCDPBTLM",43,0)
 .   .   .   S ^TMP("RCDPBTLM",$J,"IDX",RCTRAN,RCTRAN)=RCTRANDA
"RTN","RCDPBTLM",44,0)
 .   .   .   D SET^RCDPAPLI(RCTRAN,RCLINE,1,80,0,IORVON,IORVOFF)
"RTN","RCDPBTLM",45,0)
 .   .   ;
"RTN","RCDPBTLM",46,0)
 .   .   D SET^RCDPAPLI($S(RCTRANDA:RCTRANDA,1:" "),RCLINE,4,80)
"RTN","RCDPBTLM",47,0)
 .   .   D SET^RCDPAPLI($E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_$E(DATE,2,3),RCLINE,13,21)
"RTN","RCDPBTLM",48,0)
 .   .   D SET^RCDPAPLI($TR($P(RCLIST(DATE,RCTRANDA),"^"),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz"),RCLINE,25,50)
"RTN","RCDPBTLM",49,0)
 .   .   D SET^RCDPAPLI($J($P(RCLIST(DATE,RCTRANDA),"^",2),9,2),RCLINE,53,62)
"RTN","RCDPBTLM",50,0)
 .   .   D SET^RCDPAPLI($J($P(RCLIST(DATE,RCTRANDA),"^",3),9,2),RCLINE,62,71)
"RTN","RCDPBTLM",51,0)
 .   .   ;  add marshal fee and court cost to create admin dollars
"RTN","RCDPBTLM",52,0)
 .   .   S ADMIN=$P(RCLIST(DATE,RCTRANDA),"^",4)+$P(RCLIST(DATE,RCTRANDA),"^",5)+$P(RCLIST(DATE,RCTRANDA),"^",6)
"RTN","RCDPBTLM",53,0)
 .   .   D SET^RCDPAPLI($J(ADMIN,9,2),RCLINE,71,80)
"RTN","RCDPBTLM",54,0)
 ;
"RTN","RCDPBTLM",55,0)
 ;  show totals
"RTN","RCDPBTLM",56,0)
 S RCLINE=RCLINE+1
"RTN","RCDPBTLM",57,0)
 D SET^RCDPAPLI("                                                    --------- -------- --------",RCLINE,1,80)
"RTN","RCDPBTLM",58,0)
 S RCLINE=RCLINE+1
"RTN","RCDPBTLM",59,0)
 D SET^RCDPAPLI("   TOTAL BALANCE FOR BILL",RCLINE,1,80)
"RTN","RCDPBTLM",60,0)
 D SET^RCDPAPLI($J($P(RCTOTAL,"^",1),9,2),RCLINE,53,62)
"RTN","RCDPBTLM",61,0)
 D SET^RCDPAPLI($J($P(RCTOTAL,"^",2),9,2),RCLINE,62,71)
"RTN","RCDPBTLM",62,0)
 D SET^RCDPAPLI($J($P(RCTOTAL,"^",3)+$P(RCTOTAL,"^",4)+$P(RCTOTAL,"^",5),9,2),RCLINE,71,80)
"RTN","RCDPBTLM",63,0)
 ;
"RTN","RCDPBTLM",64,0)
 ;  compare totals to what is stored in the file
"RTN","RCDPBTLM",65,0)
 N RCDATA7,RCFOUT
"RTN","RCDPBTLM",66,0)
 S RCDATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCDPBTLM",67,0)
 ;  for a write-off bill, the balance should equal all zeros, for
"RTN","RCDPBTLM",68,0)
 ;  these bills, node 7 is the write-off amount, so for the out of
"RTN","RCDPBTLM",69,0)
 ;  balance check to work, node 7 needs to be adjusted to all zeros
"RTN","RCDPBTLM",70,0)
 I $P(^PRCA(430,RCBILLDA,0),"^",8)=23 S RCDATA7="0^0^0^0^0"
"RTN","RCDPBTLM",71,0)
 I +$P(RCDATA7,"^",1)'=+$P(RCTOTAL,"^",1) S RCFOUT=1
"RTN","RCDPBTLM",72,0)
 I +$P(RCDATA7,"^",2)'=+$P(RCTOTAL,"^",2) S RCFOUT=1
"RTN","RCDPBTLM",73,0)
 I ($P(RCDATA7,"^",3)+$P(RCDATA7,"^",4)+$P(RCDATA7,"^",5))'=+$P(RCTOTAL,"^",3) S RCFOUT=1
"RTN","RCDPBTLM",74,0)
 I $G(RCFOUT) D
"RTN","RCDPBTLM",75,0)
 .   S RCLINE=RCLINE+1
"RTN","RCDPBTLM",76,0)
 .   D SET^RCDPAPLI(" ",RCLINE,1,80)
"RTN","RCDPBTLM",77,0)
 .   S RCLINE=RCLINE+1
"RTN","RCDPBTLM",78,0)
 .   D SET^RCDPAPLI("  STORED BALANCE FOR BILL (** INCORRECT **)",RCLINE,1,80)
"RTN","RCDPBTLM",79,0)
 .   D SET^RCDPAPLI($J($P(RCDATA7,"^",1),9,2),RCLINE,53,62)
"RTN","RCDPBTLM",80,0)
 .   D SET^RCDPAPLI($J($P(RCDATA7,"^",2),9,2),RCLINE,62,71)
"RTN","RCDPBTLM",81,0)
 .   D SET^RCDPAPLI($J($P(RCDATA7,"^",3)+$P(RCDATA7,"^",4)+$P(RCDATA7,"^",5),9,2),RCLINE,71,80)
"RTN","RCDPBTLM",82,0)
 ;
"RTN","RCDPBTLM",83,0)
 ;  set valmcnt to number of lines in the list
"RTN","RCDPBTLM",84,0)
 S VALMCNT=RCLINE
"RTN","RCDPBTLM",85,0)
 D HDR
"RTN","RCDPBTLM",86,0)
 Q
"RTN","RCDPBTLM",87,0)
 ;
"RTN","RCDPBTLM",88,0)
 ;
"RTN","RCDPBTLM",89,0)
HDR ;  header code for list manager display
"RTN","RCDPBTLM",90,0)
 ;  requires rcbillda
"RTN","RCDPBTLM",91,0)
 N %,DATA,RCDEBTDA,RCDPDATA
"RTN","RCDPBTLM",92,0)
 ;
"RTN","RCDPBTLM",93,0)
 D DIQ430^RCDPBPLM(RCBILLDA,".01;8;")
"RTN","RCDPBTLM",94,0)
 ;
"RTN","RCDPBTLM",95,0)
 S RCDEBTDA=$P(^PRCA(430,RCBILLDA,0),"^",9)
"RTN","RCDPBTLM",96,0)
 S DATA=$$ACCNTHDR^RCDPAPLM(RCDEBTDA)
"RTN","RCDPBTLM",97,0)
 ;
"RTN","RCDPBTLM",98,0)
 S %="",$P(%," ",80)=""
"RTN","RCDPBTLM",99,0)
 ; PRCA*4.5*276 - get EEOB indicator for 1st/3rd party payment and attach to bill when applicable
"RTN","RCDPBTLM",100,0)
 S PRCOUT=$$COMP3^PRCAAPR(RCBILLDA)
"RTN","RCDPBTLM",101,0)
 I PRCOUT'="%" S PRCOUT=$$IBEEOBCK^PRCAAPR1(RCBILLDA)
"RTN","RCDPBTLM",102,0)
 S VALMHDR(1)=$E("Bill #: "_$G(PRCOUT)_$G(RCDPDATA(430,RCBILLDA,.01,"E"))_%,1,25)_"Account: "_$P(DATA,"^")_$P(DATA,"^",2)
"RTN","RCDPBTLM",103,0)
 S VALMHDR(2)=$E("Status: "_$G(RCDPDATA(430,RCBILLDA,8,"E"))_%,1,25)_$E("   Addr: "_$P(DATA,"^",4)_", "_$P(DATA,"^",7)_", "_$P(DATA,"^",8)_"  "_$P(DATA,"^",9)_%,1,55)
"RTN","RCDPBTLM",104,0)
 ; PRCA*4.5*276 - show caption for user
"RTN","RCDPBTLM",105,0)
 S VALMSG="|% EEOB | Enter ?? for more actions |" ; PRCA*4.5*276
"RTN","RCDPBTLM",106,0)
 Q
"RTN","RCDPBTLM",107,0)
 S VALMHDR(3)="  "_IORVON_$E("Bill Balance: "_$J($P(RCTOTAL,"^")+$P(RCTOTAL,"^",2)+$P(RCTOTAL,"^",3)+$P(RCTOTAL,"^",4)+$P(RCTOTAL,"^",5),0,2)_%,1,23)_IORVOFF_"  Phone: "_$P(DATA,"^",10)
"RTN","RCDPBTLM",108,0)
 Q
"RTN","RCDPBTLM",109,0)
 ;
"RTN","RCDPBTLM",110,0)
 ;
"RTN","RCDPBTLM",111,0)
EXIT ;  exit list manager option and clean up
"RTN","RCDPBTLM",112,0)
 K ^TMP("RCDPBTLM",$J),^TMP("RCDPBTLMX",$J)
"RTN","RCDPBTLM",113,0)
 Q
"RTN","RCDPBTLM",114,0)
 ;
"RTN","RCDPBTLM",115,0)
 ;
"RTN","RCDPBTLM",116,0)
SELBILL() ;  select a bill
"RTN","RCDPBTLM",117,0)
 ;  returns -1 for timeout or ^, 0 for no selection, or ien of bill
"RTN","RCDPBTLM",118,0)
 N %,%Y,C,DIC,DTOUT,DUOUT,RCBEFLUP,X,Y
"RTN","RCDPBTLM",119,0)
 N DPTNOFZY,DPTNOFZK S (DPTNOFZY,DPTNOFZK)=1
"RTN","RCDPBTLM",120,0)
 N RCY,DIR,DIRUT
"RTN","RCDPBTLM",121,0)
 ; allow user to get the record using bill# or ECME#
"RTN","RCDPBTLM",122,0)
 S DIR("A")="Select (B)ILL or (E)CME#: "
"RTN","RCDPBTLM",123,0)
 S DIR(0)="SA^B:BILL NUMBER;E:ECME#"
"RTN","RCDPBTLM",124,0)
 S DIR("B")="B"
"RTN","RCDPBTLM",125,0)
 D ^DIR K DIR I $D(DIRUT) Q 0
"RTN","RCDPBTLM",126,0)
 S RCY=Y
"RTN","RCDPBTLM",127,0)
 I RCY="E" Q $$SELECME
"RTN","RCDPBTLM",128,0)
 S DIC="^PRCA(430,",DIC(0)="QEAM",DIC("A")="Select BILL: "
"RTN","RCDPBTLM",129,0)
 S DIC("W")="D DICW^RCBEUBI1"
"RTN","RCDPBTLM",130,0)
 ;  special lookup on input
"RTN","RCDPBTLM",131,0)
 S RCBEFLUP=1
"RTN","RCDPBTLM",132,0)
 D ^DIC
"RTN","RCDPBTLM",133,0)
 I Y<0,'$G(DUOUT),'$G(DTOUT) S Y=0
"RTN","RCDPBTLM",134,0)
 Q +Y
"RTN","RCDPBTLM",135,0)
 ;
"RTN","RCDPBTLM",136,0)
 ;
"RTN","RCDPBTLM",137,0)
GETTRANS(BILLDA) ;  original amount goes first for bill
"RTN","RCDPBTLM",138,0)
 ;  returns list of transactions in
"RTN","RCDPBTLM",139,0)
 ;  rclist(date,tranda)=trantype ^ principle ^ interest ^ admin
"RTN","RCDPBTLM",140,0)
 ;  returns principle balance ^ interest balance ^ admin balance
"RTN","RCDPBTLM",141,0)
 ;        ^ marshall fee balance ^ court cost balance
"RTN","RCDPBTLM",142,0)
 N %,ADMBAL,AMTDISP,CCBAL,DATA1,DATE,INTBAL,MFBAL,PRINBAL,RCDPDATA,TRANDA,VALUE
"RTN","RCDPBTLM",143,0)
 ;
"RTN","RCDPBTLM",144,0)
 D DIQ430^RCDPBPLM(BILLDA,"3;60;")
"RTN","RCDPBTLM",145,0)
 ;
"RTN","RCDPBTLM",146,0)
 K RCLIST
"RTN","RCDPBTLM",147,0)
 S (ADMBAL,CCBAL,INTBAL,MFBAL,PRINBAL)=0
"RTN","RCDPBTLM",148,0)
 S PRINBAL=RCDPDATA(430,BILLDA,3,"I")
"RTN","RCDPBTLM",149,0)
 ;  loop transaction and add to list
"RTN","RCDPBTLM",150,0)
 S TRANDA=0 F  S TRANDA=$O(^PRCA(433,"C",BILLDA,TRANDA)) Q:'TRANDA  D
"RTN","RCDPBTLM",151,0)
 .   S DATA1=$G(^PRCA(433,TRANDA,1))
"RTN","RCDPBTLM",152,0)
 .   S DATE=$P(DATA1,"^",9) I 'DATE Q
"RTN","RCDPBTLM",153,0)
 .   S VALUE=$$TRANVALU(TRANDA) I VALUE="" Q
"RTN","RCDPBTLM",154,0)
 .   S RCLIST($P(DATE,"."),TRANDA)=$P($G(^PRCA(430.3,+$P(DATA1,"^",2),0)),"^")_VALUE
"RTN","RCDPBTLM",155,0)
 .   ;
"RTN","RCDPBTLM",156,0)
 .   ;  calculate bill's balance
"RTN","RCDPBTLM",157,0)
 .   S PRINBAL=PRINBAL+$P(VALUE,"^",2)
"RTN","RCDPBTLM",158,0)
 .   S INTBAL=INTBAL+$P(VALUE,"^",3)
"RTN","RCDPBTLM",159,0)
 .   S ADMBAL=ADMBAL+$P(VALUE,"^",4)
"RTN","RCDPBTLM",160,0)
 .   S MFBAL=MFBAL+$P(VALUE,"^",5)
"RTN","RCDPBTLM",161,0)
 .   S CCBAL=CCBAL+$P(VALUE,"^",6)
"RTN","RCDPBTLM",162,0)
 ;
"RTN","RCDPBTLM",163,0)
 S DATE=$G(RCDPDATA(430,BILLDA,60,"I"))
"RTN","RCDPBTLM",164,0)
 ;  check to make sure activation date is not greater than first transaction
"RTN","RCDPBTLM",165,0)
 S %=$O(RCLIST(0)) I DATE>% S DATE=%
"RTN","RCDPBTLM",166,0)
 S RCLIST(+$P(DATE,"."),0)="original amount^"_RCDPDATA(430,BILLDA,3,"I")
"RTN","RCDPBTLM",167,0)
 ;
"RTN","RCDPBTLM",168,0)
 Q PRINBAL_"^"_INTBAL_"^"_ADMBAL_"^"_MFBAL_"^"_CCBAL
"RTN","RCDPBTLM",169,0)
 ;
"RTN","RCDPBTLM",170,0)
 ;
"RTN","RCDPBTLM",171,0)
TRANVALU(TRANDA) ;  return the transaction value as displayed (with + or - sign)
"RTN","RCDPBTLM",172,0)
 N TYPE,VALUE
"RTN","RCDPBTLM",173,0)
 S VALUE=$$TRANBAL^RCRJRCOT(TRANDA)
"RTN","RCDPBTLM",174,0)
 ;  no dollars on transaction
"RTN","RCDPBTLM",175,0)
 I '$P(VALUE,"^"),'$P(VALUE,"^",2),'$P(VALUE,"^",3),'$P(VALUE,"^",4),'$P(VALUE,"^",5) Q ""
"RTN","RCDPBTLM",176,0)
 ;  check type for payments, etc, make values (-) to subtract
"RTN","RCDPBTLM",177,0)
 S TYPE=$P($G(^PRCA(433,TRANDA,1)),"^",2)
"RTN","RCDPBTLM",178,0)
 I TYPE=2!(TYPE=8)!(TYPE=9)!(TYPE=10)!(TYPE=11)!(TYPE=14)!(TYPE=29)!(TYPE=34)!(TYPE=35)!(TYPE=41) D
"RTN","RCDPBTLM",179,0)
 .   S $P(VALUE,"^",1)=-$P(VALUE,"^",1)
"RTN","RCDPBTLM",180,0)
 .   S $P(VALUE,"^",2)=-$P(VALUE,"^",2)
"RTN","RCDPBTLM",181,0)
 .   S $P(VALUE,"^",3)=-$P(VALUE,"^",3)
"RTN","RCDPBTLM",182,0)
 .   S $P(VALUE,"^",4)=-$P(VALUE,"^",4)
"RTN","RCDPBTLM",183,0)
 .   S $P(VALUE,"^",5)=-$P(VALUE,"^",5)
"RTN","RCDPBTLM",184,0)
 ;
"RTN","RCDPBTLM",185,0)
 ;  the following transaction types should not change the bills balance
"RTN","RCDPBTLM",186,0)
 ;  return the amount displayed in the description and 0 for value
"RTN","RCDPBTLM",187,0)
 ;    refer to RC 3, refer to DOJ 4, reestablish 5, returned 6 and 32
"RTN","RCDPBTLM",188,0)
 ;    repayment plan 25, amended 33, suspended 47, unsuspended 46
"RTN","RCDPBTLM",189,0)
 K AMTDISP
"RTN","RCDPBTLM",190,0)
 I TYPE=3!(TYPE=4)!(TYPE=5)!(TYPE=6)!(TYPE=25)!(TYPE=32)!(TYPE=33)!(TYPE=46)!(TYPE=47) D
"RTN","RCDPBTLM",191,0)
 .   S AMTDISP=" ($"_$J($P(VALUE,"^")+$P(VALUE,"^",2)+$P(VALUE,"^",3)+$P(VALUE,"^",4)+$P(VALUE,"^",5),0,2)_")"
"RTN","RCDPBTLM",192,0)
 .   S VALUE=""
"RTN","RCDPBTLM",193,0)
 Q $G(AMTDISP)_"^"_VALUE
"RTN","RCDPBTLM",194,0)
 ;
"RTN","RCDPBTLM",195,0)
SELECME() ;
"RTN","RCDPBTLM",196,0)
 ; function takes the user input of the ECME # to return a valid ien of file 430
"RTN","RCDPBTLM",197,0)
 ; if an invalid ECME is evaluated then the process keeps asking the user for ECME #
"RTN","RCDPBTLM",198,0)
 ; until a valid ECME# is entered or until the user enters a "^" or null value
"RTN","RCDPBTLM",199,0)
 ; output - returns the IEN of the record entry in the ACCOUNT RECEIVABLE file (#430) or "??"
"RTN","RCDPBTLM",200,0)
 N RCECME,RCBILL,DIR,DIRUT,Y
"RTN","RCDPBTLM",201,0)
 S DIR(0)="FO^1:12^I X'?1.12N W !!,""Cannot contain alpha characters"" K X"
"RTN","RCDPBTLM",202,0)
 S DIR("A")="Select ECME#"
"RTN","RCDPBTLM",203,0)
RET D ^DIR I $D(DIRUT) Q 0
"RTN","RCDPBTLM",204,0)
 S RCECME=$S(+Y>0:Y,1:0)
"RTN","RCDPBTLM",205,0)
 S RCBILL=$$REC^IBRFN(RCECME)    ; IA 2031
"RTN","RCDPBTLM",206,0)
 I RCBILL<0 W !!,"??" G RET
"RTN","RCDPBTLM",207,0)
 E  W !!,$P($G(^PRCA(430,+RCBILL,0)),"^")," "
"RTN","RCDPBTLM",208,0)
 Q RCBILL
"RTN","RCDPBTLM",209,0)
 ;RCDPBTLM
"RTN","RCDPE8NZ")
0^6^B54377716^B24021950
"RTN","RCDPE8NZ",1,0)
RCDPE8NZ ;ALB/TMK/KML - Unapplied EFT Deposits report ;19 MAR 2003
"RTN","RCDPE8NZ",2,0)
 ;;4.5;Accounts Receivable;**173,212,208,269,276**;Mar 20, 1995;Build 87
"RTN","RCDPE8NZ",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPE8NZ",4,0)
 ;
"RTN","RCDPE8NZ",5,0)
EN ; entrypoint for stand-alone report option
"RTN","RCDPE8NZ",6,0)
 N %ZIS,ZTRTN,ZTSAVE,ZTDESC,POP,ZTSK,DIR,X,Y,RCDISPTY,RCSTDT,RCENDT
"RTN","RCDPE8NZ",7,0)
 S DIR("A")="START DATE: "
"RTN","RCDPE8NZ",8,0)
 S DIR(0)="DOA^:"_DT_":AEP" W ! D ^DIR K DIR
"RTN","RCDPE8NZ",9,0)
 Q:Y=""  Q:$D(DUOUT)!$D(DTOUT)
"RTN","RCDPE8NZ",10,0)
 S RCSTDT=+Y
"RTN","RCDPE8NZ",11,0)
 S DIR("A")="END DATE: "
"RTN","RCDPE8NZ",12,0)
 S DIR("B")=Y(0)
"RTN","RCDPE8NZ",13,0)
 S DIR(0)="DAO^"_RCSTDT_":"_DT_":APE" W ! D ^DIR K DIR
"RTN","RCDPE8NZ",14,0)
 Q:$D(DUOUT)!$D(DTOUT)
"RTN","RCDPE8NZ",15,0)
 S RCENDT=+Y
"RTN","RCDPE8NZ",16,0)
 ; ask if export to excel format is wanted
"RTN","RCDPE8NZ",17,0)
 S RCDISPTY=$$DISPTY^RCDPEM3()
"RTN","RCDPE8NZ",18,0)
 I RCDISPTY=-1 Q
"RTN","RCDPE8NZ",19,0)
 I RCDISPTY D INFO^RCDPEM6
"RTN","RCDPE8NZ",20,0)
 ; Ask device
"RTN","RCDPE8NZ",21,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPE8NZ",22,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPE8NZ",23,0)
 . S ZTRTN="PR^RCDPE8NZ",ZTDESC="AR - List of unlinked EFT deposit payments"
"RTN","RCDPE8NZ",24,0)
 . S ZTSAVE("RC*")=""
"RTN","RCDPE8NZ",25,0)
 . D ^%ZTLOAD
"RTN","RCDPE8NZ",26,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPE8NZ",27,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPE8NZ",28,0)
 U IO
"RTN","RCDPE8NZ",29,0)
 D PR
"RTN","RCDPE8NZ",30,0)
 Q
"RTN","RCDPE8NZ",31,0)
 ;
"RTN","RCDPE8NZ",32,0)
PR ; Entrypoint for queued job
"RTN","RCDPE8NZ",33,0)
 N RCCT,RCPG,RCEFT,RCEFT1,RCDATA,RCDATA0,RCDA,RCREC,RCSTAT,RCDT,RCTOT,RCEFTD,RCSTOP,RCRDT
"RTN","RCDPE8NZ",34,0)
 N Z,RCSUM,RCUNAP,RCPOST,RCTR,RCCR,ZTSTOP,RECEXT
"RTN","RCDPE8NZ",35,0)
 ;
"RTN","RCDPE8NZ",36,0)
 ;  get list of unlinked EFT deposit data
"RTN","RCDPE8NZ",37,0)
 K ^TMP("RCDPE8NZZ_EFT",$J) ; subscripts: dep date,EFT ien,EFT det ien
"RTN","RCDPE8NZ",38,0)
 ;  Data is FMS doc indicator^FMS doc #^FMS Doc Status
"RTN","RCDPE8NZ",39,0)
 ;    FMS doc indicator = -1:no receipt  -2:no FMS doc  1:FMS doc exists
"RTN","RCDPE8NZ",40,0)
 ;
"RTN","RCDPE8NZ",41,0)
 S (RCCT,RCSTOP,RCSUM,RCUNAP)=0
"RTN","RCDPE8NZ",42,0)
 S RCEFT1="" F  S RCEFT1=$O(^RCY(344.3,"ARDEP",RCEFT1)) Q:RCEFT1=""!RCSTOP  S RCDA=0 F  S RCDA=$O(^RCY(344.3,"ARDEP",RCEFT1,RCDA)) Q:'RCDA  D  Q:RCSTOP
"RTN","RCDPE8NZ",43,0)
 . S RCDATA=$G(^RCY(344.3,RCDA,0)),RCDT=$P(RCDATA,U,7),RCTOT=0
"RTN","RCDPE8NZ",44,0)
 . Q:RCDT<RCSTDT  ; Before start date
"RTN","RCDPE8NZ",45,0)
 . Q:RCDT>(RCENDT+.999999)  ; After the end date
"RTN","RCDPE8NZ",46,0)
 . Q:'$P(RCDATA,"^",8)  ; no payment amt
"RTN","RCDPE8NZ",47,0)
 . S RCEFT=0 F  S RCEFT=$O(^RCY(344.31,"B",RCDA,RCEFT)) Q:'RCEFT!RCSTOP  S RCDATA0=$G(^RCY(344.31,RCEFT,0)) D  Q:RCSTOP
"RTN","RCDPE8NZ",48,0)
 . . S RCCT=RCCT+1
"RTN","RCDPE8NZ",49,0)
 . . I '(RCCT#100),$D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ Q
"RTN","RCDPE8NZ",50,0)
 . . S RCREC=$$GETREC(RCEFT,RCDATA0,.RECEXT)
"RTN","RCDPE8NZ",51,0)
 . . Q:RCREC="PURGED"  ; need to prevent processed EFTs that had receipts purged from being generated on the report
"RTN","RCDPE8NZ",52,0)
 . . ;; PRCA276 - need to add EFT entries without a receipt to the total number of unapplied deposits
"RTN","RCDPE8NZ",53,0)
 . . I 'RCREC S RCUNAP=RCUNAP+1,^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCDA,RCEFT)=-1,RCTOT=RCTOT+$P(RCDATA0,U,7) Q  ; No receipt therefore no FMS document
"RTN","RCDPE8NZ",54,0)
 . . S RCSTAT=$$FMSSTAT^RCDPUREC(RCREC)
"RTN","RCDPE8NZ",55,0)
 . . I $E($P(RCSTAT,U),1,2)="TR",$P(RCSTAT,U,2)["ACCEPTED" Q
"RTN","RCDPE8NZ",56,0)
 . . S RCUNAP=RCUNAP+1,RCTOT=RCTOT+$P(RCDATA0,U,7)  ; total unapplied deposits and total dollar amount of unapplied deposits
"RTN","RCDPE8NZ",57,0)
 . . I $P(RCSTAT,U,2)="NOT ENTERED" S ^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCDA,RCEFT)="-2^^"_$P(RCSTAT,U) Q  ; No FMS doc
"RTN","RCDPE8NZ",58,0)
 . . S ^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCDA,RCEFT)="1^"_$P(RCSTAT,U,1,2)_"^"_RECEXT
"RTN","RCDPE8NZ",59,0)
 . S:RCTOT ^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCDA)=RCTOT,RCSUM=RCSUM+RCTOT
"RTN","RCDPE8NZ",60,0)
 I RCDISPTY D EXCEL Q
"RTN","RCDPE8NZ",61,0)
 D RPT
"RTN","RCDPE8NZ",62,0)
 Q
"RTN","RCDPE8NZ",63,0)
 ;
"RTN","RCDPE8NZ",64,0)
RPT ;  display/print the report using data populated in temporary global array
"RTN","RCDPE8NZ",65,0)
 S (RCPG,RCDT)=0,RCRDT=$$FMTE^XLFDT($$NOW^XLFDT(),2)
"RTN","RCDPE8NZ",66,0)
 F  S RCDT=$O(^TMP("RCDPE8NZZ_EFT",$J,RCDT)) Q:'RCDT  D  Q:RCSTOP
"RTN","RCDPE8NZ",67,0)
 . I 'RCPG!(($Y+5)>IOSL) D HDR(RCRDT,.RCPG,.RCSTOP) Q:RCSTOP
"RTN","RCDPE8NZ",68,0)
 . W ! S Z="DEPOSIT DATE: "_$$FMTE^XLFDT(RCDT,1) W ?(80-$L(Z)\2),Z,!
"RTN","RCDPE8NZ",69,0)
 . S RCEFT1=0 F  S RCEFT1=$O(^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCEFT1)) Q:'RCEFT1  D
"RTN","RCDPE8NZ",70,0)
 . . S RCCT=RCCT+1
"RTN","RCDPE8NZ",71,0)
 . . I '(RCCT#100),$D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 W:$G(RCPG) !!,"TASK STOPPED BY USER!!" K ZTREQ Q
"RTN","RCDPE8NZ",72,0)
 . . S RCDATA0=$G(^RCY(344.3,RCEFT1,0))
"RTN","RCDPE8NZ",73,0)
 . . I ($Y+5)>IOSL D HDR(RCRDT,.RCPG,.RCSTOP) Q:RCSTOP
"RTN","RCDPE8NZ",74,0)
 . . W !,$J("",4),$E($P(RCDATA0,U,6)_$S('$$HACEFT^RCDPEU(RCEFT1):"",1:"-HAC")_$J("",10),1,10)_"  "_$E($$FMTE^XLFDT($P(RCDATA0,U,7),2)_$J("",16),1,16)_"  "_$E($J(+$P(RCDATA0,U,8),"",2)_$J("",20),1,20)
"RTN","RCDPE8NZ",75,0)
 . . W "  "_$J(+$G(^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCEFT1)),"",2)
"RTN","RCDPE8NZ",76,0)
 . . S RCEFT=0 F  S RCEFT=$O(^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCEFT1,RCEFT)) Q:'RCEFT  S RCDATA=$G(^(RCEFT)),RCEFTD=$G(^RCY(344.31,RCEFT,0)) D
"RTN","RCDPE8NZ",77,0)
 . . . I ($Y+5)>IOSL D HDR(RCRDT,.RCPG,.RCSTOP) Q:RCSTOP
"RTN","RCDPE8NZ",78,0)
 . . . W !,$J("",5)_$P(RCEFTD,U,2)_"/"_$P(RCEFTD,U,3),!,$J("",6)_$E($P(RCEFTD,U,4)_$J("",50),1,50)_" "
"RTN","RCDPE8NZ",79,0)
 . . . W $E($J(+$P(RCEFTD,U,7),"",2)_$J("",12),1,12)_" "_$S($P(RCDATA,U,4)'="":$P(RCDATA,U,4),1:"NO RECEIPT")
"RTN","RCDPE8NZ",80,0)
 . . . S Z=$P(RCEFTD,U,8)
"RTN","RCDPE8NZ",81,0)
 . . . W !,$J("",8)_$E($S('Z:"UNMATCHED",Z=2:"PAPER EOB",1:"MATCHED TO ERA #: "_$P(RCEFTD,U,10)_$S(Z=-1:" (TOTALS MISMATCH)",1:""))_$J("",40),1,40)_"  "
"RTN","RCDPE8NZ",82,0)
 . . . W $S($P(RCDATA,U)=-1:"NO RECEIPT",$P(RCDATA,U)=-2:"NO FMS DOCUMENT",1:$E($P(RCDATA,U,2)_" - "_$P(RCDATA,U,3),1,30)),!
"RTN","RCDPE8NZ",83,0)
 I '$D(^TMP("RCDPE8NZZ_EFT",$J)) D HDR(RCRDT,.RCPG,.RCSTOP) W !!!,?26,"*** NO RECORDS TO PRINT ***"
"RTN","RCDPE8NZ",84,0)
 I $D(^TMP("RCDPE8NZZ_EFT",$J)) W !,"******** END OF REPORT ********",!
"RTN","RCDPE8NZ",85,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPE8NZ",86,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPE8NZ",87,0)
 G:RCSTOP RPTQ
"RTN","RCDPE8NZ",88,0)
 I $E(IOST,1,2)="C-" D ASK(.RCSTOP)
"RTN","RCDPE8NZ",89,0)
 ;
"RTN","RCDPE8NZ",90,0)
RPTQ K ^TMP("RCDPE8NZZ_EFT",$J)
"RTN","RCDPE8NZ",91,0)
 Q
"RTN","RCDPE8NZ",92,0)
 ;
"RTN","RCDPE8NZ",93,0)
GETREC(EFTDA,EFTDET,RECEXT) ;  prca276
"RTN","RCDPE8NZ",94,0)
 ; input - EFTDA - IEN OF 344.31
"RTN","RCDPE8NZ",95,0)
 ; input - EFTDET - data stored at the 0 subscript of the THIRD PARTY EFT DETAIL file (344.31)
"RTN","RCDPE8NZ",96,0)
 ; input - RECEXT passed by reference
"RTN","RCDPE8NZ",97,0)
 ; output - RECEXT populated with the external receipt value that gets generated on the report
"RTN","RCDPE8NZ",98,0)
 ; output - RECEIPT - returns internal value of the receipt that either comes from the EFT file (344.31) or the ERA file (344.4) 
"RTN","RCDPE8NZ",99,0)
 N RECEIPT
"RTN","RCDPE8NZ",100,0)
 S RECEXT=0
"RTN","RCDPE8NZ",101,0)
 S RECEIPT=+$P($G(^RCY(344.4,+$P(EFTDET,U,10),0)),U,8)  ; get receipt off the ERA record
"RTN","RCDPE8NZ",102,0)
 I 'RECEIPT,$P(EFTDET,U,8)=2 S RECEIPT=+$O(^RCY(344,"AEFT",EFTDA,0))  ; EFT processed against paper EOB
"RTN","RCDPE8NZ",103,0)
 I 'RECEIPT S RECEIPT=$P(EFTDET,U,9) ; receipt not posted in payment file so get from EFT detail (unprocessed EFT)
"RTN","RCDPE8NZ",104,0)
 I +RECEIPT,'$D(^RCY(344,RECEIPT)) Q "PURGED"  ; handle purged receipts but broken pointer exists in 344.31; need to handle as a processed EFT 
"RTN","RCDPE8NZ",105,0)
 I +RECEIPT S RECEXT=$P(^RCY(344,RECEIPT,0),U)
"RTN","RCDPE8NZ",106,0)
 Q +RECEIPT
"RTN","RCDPE8NZ",107,0)
 ;
"RTN","RCDPE8NZ",108,0)
HDR(RCRDT,RCPG,RCSTOP) ; Print header data
"RTN","RCDPE8NZ",109,0)
 N Z0
"RTN","RCDPE8NZ",110,0)
 I 'RCSTOP,RCPG D ASK(.RCSTOP) Q:RCSTOP
"RTN","RCDPE8NZ",111,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPE8NZ",112,0)
 S RCPG=RCPG+1
"RTN","RCDPE8NZ",113,0)
 S Z0="Unapplied EFT Deposits Report",Z0=$J("",80-$L(Z0)\2)_Z0 W !,Z0 W ?70,"Page: ",RCPG
"RTN","RCDPE8NZ",114,0)
 S Z0="Run Date: "_RCRDT,Z0=$J("",80-$L(Z0)\2)_Z0 W !,Z0
"RTN","RCDPE8NZ",115,0)
 S Z0="Date Range: "_$$FMTE^XLFDT(RCSTDT,2)_" - "_$$FMTE^XLFDT(RCENDT,2)_" (Deposit Date)",Z0=$J("",80-$L(Z0)\2)_Z0 W !,Z0
"RTN","RCDPE8NZ",116,0)
 I RCPG=1 D
"RTN","RCDPE8NZ",117,0)
 . S Z0="TOTAL NUMBER OF UNAPPLIED DEPOSITS: "_RCUNAP,Z0=$J("",80-$L(Z0)\2)_Z0 W !,Z0
"RTN","RCDPE8NZ",118,0)
 . S Z0="TOTAL AMOUNT OF UNAPPLIED DEPOSITS: $"_$FN(RCSUM,",",2),Z0=$J("",80-$L(Z0)\2)_Z0 W !,Z0,!
"RTN","RCDPE8NZ",119,0)
 W !!,"    DEPOSIT #   DEPOSIT DATE      TOT AMT OF DEPOSIT    TOT AMT UNPOSTED"
"RTN","RCDPE8NZ",120,0)
 W !,"     PAYER/ID",!,$J("",6)_"TRACE #"_$J("",44)_"PAYMENT AMT  RECEIPT #",!,$J("",8)_$E("ERA MATCHED"_$J("",40),1,40)_"  FMS DOC #/STATUS"
"RTN","RCDPE8NZ",121,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","RCDPE8NZ",122,0)
 Q
"RTN","RCDPE8NZ",123,0)
 ;
"RTN","RCDPE8NZ",124,0)
ASK(RCSTOP) ;
"RTN","RCDPE8NZ",125,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPE8NZ",126,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPE8NZ",127,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPE8NZ",128,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPE8NZ",129,0)
 Q
"RTN","RCDPE8NZ",130,0)
 ;
"RTN","RCDPE8NZ",131,0)
EXCEL ; Print report formatted for export to Excel
"RTN","RCDPE8NZ",132,0)
 N STR1
"RTN","RCDPE8NZ",133,0)
 W !,"DEPOSIT #^DEPOSIT DATE^TOT AMT DEPOSIT^TOT AMT UNPOSTED^PAYER ID^TRACE #^PAYMENT AMT^RECEIPT #^ERA MATCHED^FMS DOC #/STATUS",!
"RTN","RCDPE8NZ",134,0)
 S RCDT=0 F  S RCDT=$O(^TMP("RCDPE8NZZ_EFT",$J,RCDT)) Q:'RCDT  D  Q:RCSTOP
"RTN","RCDPE8NZ",135,0)
 .S RCEFT1=0 F  S RCEFT1=$O(^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCEFT1)) Q:'RCEFT1  D
"RTN","RCDPE8NZ",136,0)
 ..S RCDATA0=$G(^RCY(344.3,RCEFT1,0))
"RTN","RCDPE8NZ",137,0)
 ..S STR1=$P(RCDATA0,U,6)_$S('$$HACEFT^RCDPEU(RCEFT1):"",1:"-HAC")_U_$$FMTE^XLFDT($P(RCDATA0,U,7))_U_$P(RCDATA0,U,8)_U
"RTN","RCDPE8NZ",138,0)
 ..S STR1=STR1_+$G(^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCEFT1))_U
"RTN","RCDPE8NZ",139,0)
 ..;
"RTN","RCDPE8NZ",140,0)
 ..S RCEFT=0 F  S RCEFT=$O(^TMP("RCDPE8NZZ_EFT",$J,RCDT,RCEFT1,RCEFT)) Q:'RCEFT  S RCDATA=$G(^(RCEFT)),RCEFTD=$G(^RCY(344.31,RCEFT,0)) D
"RTN","RCDPE8NZ",141,0)
 ...W STR1
"RTN","RCDPE8NZ",142,0)
 ...W $P(RCEFTD,U,2)_"/"_$P(RCEFTD,U,3)_U_$P(RCEFTD,U,4)_U
"RTN","RCDPE8NZ",143,0)
 ...W +$P(RCEFTD,U,7)_U_$S($P(RCDATA,U,4)'="":$P(RCDATA,U,4),1:"NO RECEIPT")_U
"RTN","RCDPE8NZ",144,0)
 ...W $P(RCEFTD,U,10)_U
"RTN","RCDPE8NZ",145,0)
 ...W $S($P(RCDATA,U)=-1:"NO RECEIPT",$P(RCDATA,U)=-2:"NO FMS DOCUMENT",1:$P(RCDATA,U,2)_" - "_$P(RCDATA,U,3))
"RTN","RCDPE8NZ",146,0)
 ...W !
"RTN","RCDPE8NZ",147,0)
 Q
"RTN","RCDPEAC")
0^37^B83292786^B66599458
"RTN","RCDPEAC",1,0)
RCDPEAC ;ALB/TMK/PJH - ACTIVE BILLS WITH EEOB ON FILE ;8/2/10 4:31pm
"RTN","RCDPEAC",2,0)
 ;;4.5;Accounts Receivable;**208,269,276**;Mar 20, 1995;Build 87
"RTN","RCDPEAC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEAC",4,0)
 ;
"RTN","RCDPEAC",5,0)
EN ; Entrypoint for producing the report
"RTN","RCDPEAC",6,0)
 N RCSORT,RCINS,ZTRTN,ZTDESC,ZTSAVE,ZTSK,%ZIS,POP,RCCT,RCDISPTY,VAUTD
"RTN","RCDPEAC",7,0)
 ; PRCA*4.5*276 - Query Division
"RTN","RCDPEAC",8,0)
 D DIVISION^VAUTOMA
"RTN","RCDPEAC",9,0)
 I 'VAUTD&($D(VAUTD)'=11) Q
"RTN","RCDPEAC",10,0)
 ; PRCA*4.5*276 - select report format
"RTN","RCDPEAC",11,0)
 Q:'$$SELECT(.RCINS,.RCSORT)
"RTN","RCDPEAC",12,0)
 W !
"RTN","RCDPEAC",13,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPEAC",14,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPEAC",15,0)
 . S ZTRTN="ENQ^RCDPEAC",ZTDESC="AR - ACTIVE BILLS WITH EEOB REPORT",ZTSAVE("*")=""
"RTN","RCDPEAC",16,0)
 . D ^%ZTLOAD
"RTN","RCDPEAC",17,0)
 . W !!,$S($D(ZTSK):"Your task number"_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEAC",18,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEAC",19,0)
 U IO
"RTN","RCDPEAC",20,0)
 ;
"RTN","RCDPEAC",21,0)
ENQ ; Queued entrypoint for the report
"RTN","RCDPEAC",22,0)
 ; RCSORT and array RCINS must exist
"RTN","RCDPEAC",23,0)
 ; RCINS = "A" for all ins co, "R" for range, "S" for selected individual
"RTN","RCDPEAC",24,0)
 ;         for RCINS="R"  ("FR")=from payer name and ("TR")=to payer name
"RTN","RCDPEAC",25,0)
 ;         for RCINS="S"  ("S",INS CO IEN IN FILE 36)=""
"RTN","RCDPEAC",26,0)
 ; RCSORT = "PN" for sort by patient name followed by ;- if reverse order
"RTN","RCDPEAC",27,0)
 ;          "L4" for sort by patient SSN followed by ;- if reverse order
"RTN","RCDPEAC",28,0)
 ;
"RTN","RCDPEAC",29,0)
 N Z,Z0,RCACT,RCBILL,RCEOB,RCTOT,RCSTOP,RCNEW,RCZ,RCZ0,RCEXT,RCEX
"RTN","RCDPEAC",30,0)
 N RCZ1,RCBILL,RC399,RCPT,RC430,RC0,RCEOB,X,Y,RCSSN
"RTN","RCDPEAC",31,0)
 K ^TMP($J,"RCSORT")
"RTN","RCDPEAC",32,0)
 S RCEXT=0 ; Set Excel page 1 count
"RTN","RCDPEAC",33,0)
 S RCACT=+$O(^PRCA(430.3,"AC",102,0)) ; Get active status ien
"RTN","RCDPEAC",34,0)
 G:'RCACT ENOUT
"RTN","RCDPEAC",35,0)
 ;
"RTN","RCDPEAC",36,0)
 S RCBILL=0
"RTN","RCDPEAC",37,0)
 F  S RCBILL=$O(^PRCA(430,"AC",RCACT,RCBILL)) Q:RCBILL=""  I +$G(^PRCA(430,RCBILL,7))>0,$$INCLUDE(.RCINS,RCBILL),$$EEOB(RCBILL,.RCEOB) D
"RTN","RCDPEAC",38,0)
 . S (RCTOT,RCEOB)=0 F  S RCEOB=$O(RCEOB(RCEOB)) Q:'RCEOB  S RCTOT=RCTOT+$G(^IBM(361.1,RCEOB,1)),^TMP($J,"RCSORT",$$INSNM(RCBILL),$$SL1(RCSORT,RCBILL),RCBILL,+RCEOB(RCEOB),RCEOB)=""
"RTN","RCDPEAC",39,0)
 . I $O(RCEOB(0)) S ^TMP($J,"RCSORT",$$INSNM(RCBILL),$$SL1(RCSORT,RCBILL),RCBILL)=RCTOT
"RTN","RCDPEAC",40,0)
 ;
"RTN","RCDPEAC",41,0)
 S RCZ="",(RCPG,RCSTOP,RCNEW)=0
"RTN","RCDPEAC",42,0)
 F  S RCZ=$O(^TMP($J,"RCSORT",RCZ)) Q:RCZ=""!RCSTOP  S RCZ0="" S:$G(RCINS)="R"!($G(RCINS)="S") RCNEW=1 D
"RTN","RCDPEAC",43,0)
 . I RCSORT'["-" D
"RTN","RCDPEAC",44,0)
 .. S RCZ0="" F  S RCZ0=$O(^TMP($J,"RCSORT",RCZ,RCZ0)) Q:RCZ0=""!RCSTOP  D OUTPUT(RCZ,RCZ0,RCSORT,.RCSTOP,.RCINS,.RCPG,RCNEW) S RCNEW=0
"RTN","RCDPEAC",45,0)
 . I RCSORT["-" D
"RTN","RCDPEAC",46,0)
 .. S RCZ0="" F  S RCZ0=$O(^TMP($J,"RCSORT",RCZ,RCZ0),-1) Q:RCZ0=""!RCSTOP  D OUTPUT(RCZ,RCZ0,RCSORT,.RCSTOP,.RCINS,.RCPG,.RCNEW) S RCNEW=0
"RTN","RCDPEAC",47,0)
 ;
"RTN","RCDPEAC",48,0)
 I '$D(^TMP($J,"RCSORT")) D HDR(RCPG,.RCINS) W !!!,?26,"*** NO RECORDS TO PRINT ***"
"RTN","RCDPEAC",49,0)
 I $D(^TMP($J,"RCSORT")) W !,"******** END OF REPORT ********",!
"RTN","RCDPEAC",50,0)
 ;
"RTN","RCDPEAC",51,0)
ENOUT I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAC",52,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAC",53,0)
 K ^TMP($J,"RCSORT")
"RTN","RCDPEAC",54,0)
 Q
"RTN","RCDPEAC",55,0)
 ;
"RTN","RCDPEAC",56,0)
OUTPUT(RCZ,RCZ0,RCSORT,RCSTOP,RCINS,RCPG,RCNEW) ; Output the data
"RTN","RCDPEAC",57,0)
 ; RCZ, RCZ0 are the first 2 sort levels for the array
"RTN","RCDPEAC",58,0)
 ; RCINS = insurance co info array
"RTN","RCDPEAC",59,0)
 ; RCSTOP passed by ref - returned if user chooses to stop
"RTN","RCDPEAC",60,0)
 ; RCNEW = 1 if the header should be forced to print
"RTN","RCDPEAC",61,0)
 ;N RCZ1,RCBILL,RC399,RCPT,RC430,RC0,RCEOB,X,Y,RCSSN  new statement needs to put at the top of calling subroutine.
"RTN","RCDPEAC",62,0)
 S RCBILL=0 F  S RCBILL=$O(^TMP($J,"RCSORT",RCZ,RCZ0,RCBILL)) Q:'RCBILL!RCSTOP  S RCZ1="" F  S RCZ1=$O(^TMP($J,"RCSORT",RCZ,RCZ0,RCBILL,RCZ1)) Q:RCZ1=""!RCSTOP  D
"RTN","RCDPEAC",63,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAC",64,0)
 . S RC399=$G(^DGCR(399,RCBILL,0)),RCPT=+$P(RC399,U,2),RC430=$G(^PRCA(430,RCBILL,0))
"RTN","RCDPEAC",65,0)
 . ; PRCA*4.5*276 - Check for Division
"RTN","RCDPEAC",66,0)
 . I VAUTD=0 Q:$P(RC399,U,22)=""  Q:$G(VAUTD($P(RC399,U,22)))=""
"RTN","RCDPEAC",67,0)
 . S RCSTOP=$$NEWPG(.RCPG,.RCINS,RCNEW) S RCNEW=0 Q:RCSTOP
"RTN","RCDPEAC",68,0)
 . S RCSTOP=$$NEWPG(.RCPG,.RCINS,RCNEW) Q:RCSTOP
"RTN","RCDPEAC",69,0)
 . S X=$$GET1^DIQ(430,RCBILL_",",11)
"RTN","RCDPEAC",70,0)
 . ; PRCA*4.5*276 - Row #1: Print last 4 SSN only - Move Bill Number to end
"RTN","RCDPEAC",71,0)
 . S RCSSN=$P($G(^DPT(RCPT,0)),U,9),RCSSN=$E(RCSSN,$L(RCSSN)-3,$L(RCSSN))
"RTN","RCDPEAC",72,0)
 . I $G(RCDISPTY) S RCEX=$P($G(^DPT(RCPT,0)),U)_"^"_RCSSN_"^"_$TR($P(RC430,U),"-","")
"RTN","RCDPEAC",73,0)
 . E  W !,$E($P($G(^DPT(RCPT,0)),U)_$J("",25),1,25)_"  "_$E(RCSSN_$J("",5),1,5)_"  "_$TR($P(RC430,U),"-","")
"RTN","RCDPEAC",74,0)
 . ; PRCA*4.5*276 - Row #2: Move Ins Name, Balance, Amt Bill, Amt Paid
"RTN","RCDPEAC",75,0)
 . S Y=+$G(^TMP($J,"RCSORT",RCZ,RCZ0,RCBILL))
"RTN","RCDPEAC",76,0)
 . I $G(RCDISPTY) S RCEX=RCEX_"^"_$$INSNM(RCBILL)_"^"_+X_"^"_+$P(RC430,U,3)_"^"_Y
"RTN","RCDPEAC",77,0)
 . E  W !,$E($$INSNM(RCBILL)_$J("",30),1,30)_$E($J("",12)_$J(+X,"",2),1+$L($J(+X,"",2)),12+$L($J(+X,"",2)))_$E($J("",13)_$J(+$P(RC430,U,3),"",2),1+$L($J(+$P(RC430,U,3),"",2)),13+$L($J(+$P(RC430,U,3),"",2))) W $E($J("",13),1,13-$L(Y))_$J(Y,"",2)
"RTN","RCDPEAC",78,0)
 . ; PRCA*4.5*276 Do not display Date Referred
"RTN","RCDPEAC",79,0)
 . S RCEOB=0 F  S RCEOB=$O(^TMP($J,"RCSORT",RCZ,RCZ0,RCBILL,RCZ1,RCEOB)) Q:'RCEOB!RCSTOP  D
"RTN","RCDPEAC",80,0)
 .. S RCSTOP=$$NEWPG(.RCPG,.RCINS,RCNEW)
"RTN","RCDPEAC",81,0)
 .. Q:RCSTOP
"RTN","RCDPEAC",82,0)
 .. S RC0=$G(^IBM(361.1,RCEOB,0))
"RTN","RCDPEAC",83,0)
 .. S RCSTOP=$$NEWPG(.RCPG,.RCINS,RCNEW) Q:RCSTOP
"RTN","RCDPEAC",84,0)
 .. ; PRCA*4.5*276 - Row #3: Trace#, Date Rec'd, Date Posted
"RTN","RCDPEAC",85,0)
 .. I $G(RCDISPTY) W !,RCEX_"^"_$P(RC0,U,7)_"^"_$$FMTE^XLFDT($P(RC0,U,5),"2D")_"^"_$S(RCZ1:$$FMTE^XLFDT(RCZ1,"2D"),1:"")
"RTN","RCDPEAC",86,0)
 .. E  W !,?3,$P(RC0,U,7)_$J("",51-$L($P(RC0,U,7)))_$E($$FMTE^XLFDT($P(RC0,U,5),"2D")_$J("",8),1,8)_" "_" "_$E($S(RCZ1:$$FMTE^XLFDT(RCZ1,"2D"),1:"")_$J("",8),1,8)
"RTN","RCDPEAC",87,0)
 . I '$G(RCDISPTY) W !
"RTN","RCDPEAC",88,0)
 ;
"RTN","RCDPEAC",89,0)
 Q
"RTN","RCDPEAC",90,0)
 ;
"RTN","RCDPEAC",91,0)
INCLUDE(RCINS,RCZ) ; Function returns 1 if record should be included based
"RTN","RCDPEAC",92,0)
 ; on ins co
"RTN","RCDPEAC",93,0)
 ; RCINS = array containing insurance co information
"RTN","RCDPEAC",94,0)
 ; RCZ = ien of the entry in file 430
"RTN","RCDPEAC",95,0)
 N OK,RCI,RCINM
"RTN","RCDPEAC",96,0)
 S OK=0
"RTN","RCDPEAC",97,0)
 S RCI=+$$INS(RCZ)
"RTN","RCDPEAC",98,0)
 ;
"RTN","RCDPEAC",99,0)
 I 'RCI G INCQ ; Not a third party bill
"RTN","RCDPEAC",100,0)
 ;
"RTN","RCDPEAC",101,0)
 I RCINS="A" S OK=1
"RTN","RCDPEAC",102,0)
 ;
"RTN","RCDPEAC",103,0)
 I RCINS="S"!(RCINS="R") D
"RTN","RCDPEAC",104,0)
 . I RCINS="S" S:$D(RCINS("S",RCI)) OK=1 Q
"RTN","RCDPEAC",105,0)
 . S RCINM=$$INSNM(RCZ) ; INS CO NAME
"RTN","RCDPEAC",106,0)
 . I $S(RCINM=RCINS("FR")!(RCINM]RCINS("FR")):RCINM']RCINS("TO"),1:0) S OK=1
"RTN","RCDPEAC",107,0)
 ;
"RTN","RCDPEAC",108,0)
INCQ Q OK
"RTN","RCDPEAC",109,0)
 ;
"RTN","RCDPEAC",110,0)
INSNM(RCZ) ; Returns the name of the insurance co for bill ien RCZ file 430
"RTN","RCDPEAC",111,0)
 N NM
"RTN","RCDPEAC",112,0)
 S NM=$P($G(^DIC(36,+$$INS(RCZ),0)),U)
"RTN","RCDPEAC",113,0)
 Q NM
"RTN","RCDPEAC",114,0)
 ;
"RTN","RCDPEAC",115,0)
INS(RCZ) ; Returns ien of insurance co for bill ien RCZ from file 430
"RTN","RCDPEAC",116,0)
 N RC
"RTN","RCDPEAC",117,0)
 S RC=$P($G(^PRCA(430,RCZ,0)),U,9) ;DEBTOR
"RTN","RCDPEAC",118,0)
 Q $S($P($G(^RCD(340,+RC,0)),U)'["DIC(36":"",1:+^(0))
"RTN","RCDPEAC",119,0)
 ;
"RTN","RCDPEAC",120,0)
NEWPG(RCPG,RCINS,RCNEW) ; Check for new page needed, output header
"RTN","RCDPEAC",121,0)
 ; RCINS = ins co selection criteria
"RTN","RCDPEAC",122,0)
 ; RCNEW = 1 to force new page
"RTN","RCDPEAC",123,0)
 ; Function returns 1 if user chooses to stop output
"RTN","RCDPEAC",124,0)
 I RCNEW!'RCPG!(($Y+5)>IOSL) D
"RTN","RCDPEAC",125,0)
 . D:RCPG ASK(.RCSTOP) I RCSTOP Q
"RTN","RCDPEAC",126,0)
 . D HDR(.RCPG,.RCINS)
"RTN","RCDPEAC",127,0)
 Q RCSTOP
"RTN","RCDPEAC",128,0)
 ;
"RTN","RCDPEAC",129,0)
EEOB(RCZ,RCEOB) ; Find all non-MRA  EEOBs for bill ien RCZ
"RTN","RCDPEAC",130,0)
 ; Function returns 1 if any valid EEOBs found, 0 if none
"RTN","RCDPEAC",131,0)
 ; RCEOB(eob ien)=date posted returned for valid EEOBs found -
"RTN","RCDPEAC",132,0)
 ;                pass by reference
"RTN","RCDPEAC",133,0)
 N OK,Z
"RTN","RCDPEAC",134,0)
 K RCEOB
"RTN","RCDPEAC",135,0)
 ;
"RTN","RCDPEAC",136,0)
 S OK=0
"RTN","RCDPEAC",137,0)
 S Z=0 F  S Z=$O(^IBM(361.1,"B",RCZ,Z)) Q:'Z  I $P($G(^IBM(361.1,Z,0)),U,4)'=1 D
"RTN","RCDPEAC",138,0)
 . N Z0,Z1,Z00
"RTN","RCDPEAC",139,0)
 . S Z0=+$O(^RCY(344.4,"ADET",Z,0)) ; ERA entry received in
"RTN","RCDPEAC",140,0)
 . S Z1=+$P($G(^RCY(344.4,Z0,0)),U,8) ; Receipt
"RTN","RCDPEAC",141,0)
 . S Z00=$P($G(^RCY(344.4,Z0,0)),U,14)
"RTN","RCDPEAC",142,0)
 . I Z1,$S(Z00=1!(Z00=2):1,1:0) S RCEOB(Z)=+$P($G(^RCY(344,Z1,0)),U,8),OK=1
"RTN","RCDPEAC",143,0)
 ;
"RTN","RCDPEAC",144,0)
 Q OK
"RTN","RCDPEAC",145,0)
 ;
"RTN","RCDPEAC",146,0)
SL1(RCSORT,RCZ) ; Function returns 1st sort level data from ien RCZ in file 430
"RTN","RCDPEAC",147,0)
 ; RCSORT = "PN" for patient name sort = "L4" for SSN last 4 sort
"RTN","RCDPEAC",148,0)
 N DAT
"RTN","RCDPEAC",149,0)
 I RCSORT="PN" S DAT=$P($G(^DPT(+$P($G(^PRCA(430,RCZ,0)),U,7),0)),U)
"RTN","RCDPEAC",150,0)
 I RCSORT="L4" S DAT=$P($G(^DPT(+$P($G(^PRCA(430,RCZ,0)),U,7),0)),U,9),DAT=$E(DAT,$L(DAT)-3,$L(DAT))
"RTN","RCDPEAC",151,0)
 Q $S($G(DAT)'="":DAT,1:" ")
"RTN","RCDPEAC",152,0)
 ;
"RTN","RCDPEAC",153,0)
SELECT(RCINS,RCSORT) ; Select insurance co and sort criteria and if output for EXCEL format is selected
"RTN","RCDPEAC",154,0)
 ; Function returns values selected for RCSORT and RCINS - passed by ref
"RTN","RCDPEAC",155,0)
 N RCQUIT,DONE,DIR,X,Y
"RTN","RCDPEAC",156,0)
 S (RCQUIT,DONE)=0
"RTN","RCDPEAC",157,0)
 S DIR(0)="SA^A:ALL;S:SPECIFIC;R:RANGE",DIR("A")="RUN REPORT FOR (A)LL, (S)PECIFIC, OR (R)ANGE OF INSURANCE COMPANIES?: ",DIR("B")="ALL" W ! D ^DIR K DIR
"RTN","RCDPEAC",158,0)
 I $D(DTOUT)!$D(DUOUT) G SELQ
"RTN","RCDPEAC",159,0)
 ;
"RTN","RCDPEAC",160,0)
 S RCINS=Y
"RTN","RCDPEAC",161,0)
 I RCINS="S" D  G:RCQUIT SELQ
"RTN","RCDPEAC",162,0)
 . W !
"RTN","RCDPEAC",163,0)
 . F  D LIST(.DIR,.RCINS) S DIR("A")="SELECT "_$S($O(RCINS("S",0)):"ANOTHER ",1:"")_"INSURANCE COMPANY"_$S($O(RCINS("S",0)):" (PRESS RETURN WHEN DONE)",1:"")_": ",DIR(0)="PAO^DIC(36,:AEMQ" D ^DIR K DIR D  Q:Y'>0
"RTN","RCDPEAC",164,0)
 .. I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEAC",165,0)
 .. I Y>0 S RCINS("S",+Y)=""
"RTN","RCDPEAC",166,0)
 . I '$O(RCINS("S",0)) S RCQUIT=1 W !!,"NO INSURANCE COMPANIES SELECTED - NO REPORT GENERATED" S DIR(0)="E" D ^DIR K DIR
"RTN","RCDPEAC",167,0)
 ;
"RTN","RCDPEAC",168,0)
 I RCINS="R" D  I RCQUIT W !!,"NO INSURANCE COMPANY NAME RANGE SELECTED - NO REPORT GENERATED" S DIR(0)="E" D ^DIR K DIR G SELQ
"RTN","RCDPEAC",169,0)
 . W !
"RTN","RCDPEAC",170,0)
 . S DIR("?")="ENTER 1-30 UPPERCASE CHARACTERS OF THE FIRST NAME TO INCLUDE"
"RTN","RCDPEAC",171,0)
 . S DIR(0)="FA^1:30^K:X'?.U X",DIR("A")="START WITH INSURANCE COMPANY NAME: " D ^DIR K DIR
"RTN","RCDPEAC",172,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEAC",173,0)
 . S RCINS("FR")=Y
"RTN","RCDPEAC",174,0)
 . S DIR("?")="ENTER 1-30 UPPERCASE CHARACTERS OF THE LAST NAME TO INCLUDE"
"RTN","RCDPEAC",175,0)
 . S DIR(0)="FA^1:30^K:X'?.U X",DIR("A")="GO TO INSURANCE COMPANY NAME: ",DIR("B")=$E(RCINS("FR"),1,27)_"ZZZ"
"RTN","RCDPEAC",176,0)
 . F  W ! D ^DIR Q:$S($D(DTOUT)!$D(DUOUT):1,1:RCINS("FR")']Y)  W !,"'GO TO' NAME MUST COME AFTER 'START WITH' NAME"
"RTN","RCDPEAC",177,0)
 . K DIR
"RTN","RCDPEAC",178,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEAC",179,0)
 . S RCINS("TO")=Y
"RTN","RCDPEAC",180,0)
 S DIR(0)="SA^P:PATIENT NAME;L:LAST 4 OF PATIENT SSN",DIR("A")="WITHIN INS CO, SORT BY (P)ATIENT NAME OR (L)AST 4 OF SSN?: ",DIR("B")="PATIENT NAME" W ! D ^DIR K DIR
"RTN","RCDPEAC",181,0)
 I $D(DTOUT)!$D(DUOUT) G SELQ
"RTN","RCDPEAC",182,0)
 S RCSORT=$S(Y="P":"PN",1:"L4")
"RTN","RCDPEAC",183,0)
 S DIR(0)="SA^F:FIRST TO LAST;L:LAST TO FIRST",DIR("A")="SORT "_$S(RCSORT="PN":"PATIENT NAME",1:"LAST 4")_" (F)IRST TO LAST OR (L)AST TO FIRST?: ",DIR("B")="FIRST TO LAST" D ^DIR K DIR
"RTN","RCDPEAC",184,0)
 I $D(DTOUT)!$D(DUOUT) G SELQ
"RTN","RCDPEAC",185,0)
 I Y="L" S RCSORT=RCSORT_";-"
"RTN","RCDPEAC",186,0)
 ;
"RTN","RCDPEAC",187,0)
 ; PRCA*4.5*276 - Determine whether to gather data for Excel report.
"RTN","RCDPEAC",188,0)
 S RCDISPTY=$$DISPTY^RCDPEM3() G SELQ:RCDISPTY=-1
"RTN","RCDPEAC",189,0)
 I RCDISPTY D INFO^RCDPEM6
"RTN","RCDPEAC",190,0)
 S DONE=1
"RTN","RCDPEAC",191,0)
 ;
"RTN","RCDPEAC",192,0)
SELQ Q DONE
"RTN","RCDPEAC",193,0)
 ;
"RTN","RCDPEAC",194,0)
LIST(DIR,RCINS) ; Sets up help array for ins co selected in DIR("?")
"RTN","RCDPEAC",195,0)
 N CT,Z
"RTN","RCDPEAC",196,0)
 S CT=1
"RTN","RCDPEAC",197,0)
 I '$O(RCINS("S",0)) S DIR("?")="NO INSURANCE COMPANIES SELECTED" Q
"RTN","RCDPEAC",198,0)
 S DIR("?",1)="INSURANCE COMPANIES ALREADY SELECTED:"
"RTN","RCDPEAC",199,0)
 S Z=0 F  S Z=$O(RCINS("S",Z)) Q:'Z  S CT=CT+1,DIR("?",CT)="   "_$P($G(^DIC(36,Z,0)),U)
"RTN","RCDPEAC",200,0)
 S DIR("?")=" "
"RTN","RCDPEAC",201,0)
 Q
"RTN","RCDPEAC",202,0)
 ;
"RTN","RCDPEAC",203,0)
 ; PRCA*4.5*276 - Modify all headers
"RTN","RCDPEAC",204,0)
HDR(RCPG,RCINS) ;Print report hdr
"RTN","RCDPEAC",205,0)
 ; RCPG = last page #
"RTN","RCDPEAC",206,0)
 I $G(RCDISPTY) Q:RCEXT=1  S RCEXT=1 W !,"PATIENT NAME^SSN^BILL#^INS CO NAME^BALANCE^AMT BILLE^AMT PAID^TRACE#^DT REC'D^DT POST" Q
"RTN","RCDPEAC",207,0)
 N Z,Z0,X
"RTN","RCDPEAC",208,0)
 S Z0=""
"RTN","RCDPEAC",209,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPEAC",210,0)
 S RCPG=$G(RCPG)+1
"RTN","RCDPEAC",211,0)
 S Z="EDI LOCKBOX ACTIVE BILLS W/EEOB REPORT     Page: "_RCPG D HDRP(Z,0)
"RTN","RCDPEAC",212,0)
 S Z="RUN DATE: "_$$NOW^RCDPEM6 D HDRP(Z,1)
"RTN","RCDPEAC",213,0)
 I VAUTD=1 D HDRP("DIVISIONS: ALL",1)
"RTN","RCDPEAC",214,0)
 I VAUTD=0 D
"RTN","RCDPEAC",215,0)
 . S Z0=0,Z="DIVISIONS: " F X=1:1 S Z0=$O(VAUTD(Z0)) Q:Z0=""  S:X>1 Z=Z_", " S Z=Z_VAUTD(Z0)
"RTN","RCDPEAC",216,0)
 . D HDRP(Z,1)
"RTN","RCDPEAC",217,0)
 I RCINS="S" S Z=0,Z0="" F  S Z=$O(RCINS("S",Z)) Q:'Z  S Z0=Z0_$S(Z0'="":",",1:"")_$P($G(^DIC(36,Z,0)),U)
"RTN","RCDPEAC",218,0)
 S Z0="PAYERS: "_$S(RCINS="A":"ALL",RCINS="R":"RANGE FROM "_RCINS("FR")_"-"_RCINS("TO"),1:"")_Z0 D HDRP(Z0,1)
"RTN","RCDPEAC",219,0)
 W !!,"PATIENT NAME               SSN    BILL#"
"RTN","RCDPEAC",220,0)
 W !,"INS CO NAME                        BALANCE   AMT BILLED        AMT PAID"
"RTN","RCDPEAC",221,0)
 W !,"   TRACE#                                             DT REC'D  DT POST"
"RTN","RCDPEAC",222,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","RCDPEAC",223,0)
 Q
"RTN","RCDPEAC",224,0)
HDRP(Z,X) ; PRCA*4.5*276 - Print Header (Z=String, X=1 (line feed) X=0 (no LF)
"RTN","RCDPEAC",225,0)
 I X=1 W !
"RTN","RCDPEAC",226,0)
 W ?(80-$L(Z)\2),Z
"RTN","RCDPEAC",227,0)
 Q
"RTN","RCDPEAC",228,0)
 ;
"RTN","RCDPEAC",229,0)
ASK(RCSTOP) ;
"RTN","RCDPEAC",230,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEAC",231,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEAC",232,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEAC",233,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEAC",234,0)
 Q
"RTN","RCDPEAC",235,0)
 ;
"RTN","RCDPEAR")
0^47^B2410803^B2522562
"RTN","RCDPEAR",1,0)
RCDPEAR ;ALB/TMK - ELECTRONIC ERA AGING REPORTS FROM NIGHTLY JOB ;04-NOV-02
"RTN","RCDPEAR",2,0)
 ;;4.5;Accounts Receivable;**173,276**;Mar 20, 1995;Build 87
"RTN","RCDPEAR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEAR",4,0)
 Q
"RTN","RCDPEAR",5,0)
 ;
"RTN","RCDPEAR",6,0)
AGERPT ; Entry from nightly job to run the AR EDI Lockbox Aging reports
"RTN","RCDPEAR",7,0)
 ; Bulletin is not wanted if aging parameter does not have a value
"RTN","RCDPEAR",8,0)
 ;
"RTN","RCDPEAR",9,0)
 ; ERA Aging Report
"RTN","RCDPEAR",10,0)
 I $P($G(^RC(342,1,7)),U,3)'="" D  ; Check for ERA Aging Parameter
"RTN","RCDPEAR",11,0)
 . K ^TMP($J,"RCERAAGE")
"RTN","RCDPEAR",12,0)
 . D RPTOUT^RCDPEAR1("RCERAAGE")  ; prca 276
"RTN","RCDPEAR",13,0)
 . D BULL("EDI LBOX ERA UNMATCHED AGING REPORT FOR "_$$FMTE^XLFDT(DT,2),"RCERAAGE")
"RTN","RCDPEAR",14,0)
 . K ^TMP($J,"RCERAAGE")
"RTN","RCDPEAR",15,0)
 ;
"RTN","RCDPEAR",16,0)
 ; EFT Aging Report
"RTN","RCDPEAR",17,0)
 I $P($G(^RC(342,1,7)),U,2)'="" D  ; Check for EFT Aging Parameter
"RTN","RCDPEAR",18,0)
 . K ^TMP($J,"RCEFTAGE")
"RTN","RCDPEAR",19,0)
 . D RPTOUT^RCDPEAR2("RCEFTAGE")  ;prca276
"RTN","RCDPEAR",20,0)
 . D BULL("EDI LBOX EFT UNMATCHED AGING REPORT FOR "_$$FMTE^XLFDT(DT,2),"RCEFTAGE")
"RTN","RCDPEAR",21,0)
 . K ^TMP($J,"RCEFTAGE")
"RTN","RCDPEAR",22,0)
 ;
"RTN","RCDPEAR",23,0)
 Q
"RTN","RCDPEAR",24,0)
 ;
"RTN","RCDPEAR",25,0)
BULL(RCSUBJ,RCSUB) ; Send bulletin for aging reports
"RTN","RCDPEAR",26,0)
 N XMBODY,XMB,XMINSTR,XMTYPE,XMFULL,XMTO,RCXM,XMZ,XMERR
"RTN","RCDPEAR",27,0)
 S XMTO("I:G.RCDPE PAYMENTS")=""
"RTN","RCDPEAR",28,0)
 S XMBODY="^TMP("_$J_","""_RCSUB_""")"
"RTN","RCDPEAR",29,0)
 D
"RTN","RCDPEAR",30,0)
 . N DUZ S DUZ=.5,DUZ(0)="@"
"RTN","RCDPEAR",31,0)
 . D SENDMSG^XMXAPI(.5,RCSUBJ,XMBODY,.XMTO,,.XMZ)
"RTN","RCDPEAR",32,0)
 Q
"RTN","RCDPEAR",33,0)
 ;
"RTN","RCDPEAR1")
0^48^B109842855^B37135763
"RTN","RCDPEAR1",1,0)
RCDPEAR1 ;ALB/TMK/PJH - ELECTRONIC ERA AGING REPORT - FILE 344.4 ;31-OCT-02
"RTN","RCDPEAR1",2,0)
 ;;4.5;Accounts Receivable;**173,269,276**;Mar 20, 1995;Build 87
"RTN","RCDPEAR1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEAR1",4,0)
 Q
"RTN","RCDPEAR1",5,0)
 ;
"RTN","RCDPEAR1",6,0)
EN1 ; Entry from option - run on the fly
"RTN","RCDPEAR1",7,0)
 N RCIND,RCDISPTY,RCEND,RCRANGE,RCNP,RCJOB,RCSTART,RCJOB1
"RTN","RCDPEAR1",8,0)
 N %ZIS,ZTSK,ZTSTOP,ZTDESC,ZTSAVE,ZTQUEUED,ZTRTN,POP,VAUTD,RCBAL
"RTN","RCDPEAR1",9,0)
 S RCIND=1
"RTN","RCDPEAR1",10,0)
 D DIVISION^VAUTOMA
"RTN","RCDPEAR1",11,0)
 I 'VAUTD&($D(VAUTD)'=11) G EN1Q
"RTN","RCDPEAR1",12,0)
 S RCRANGE=$$DTRNG^RCDPEM4()
"RTN","RCDPEAR1",13,0)
 I RCRANGE=0 G EN1Q
"RTN","RCDPEAR1",14,0)
 I $P(RCRANGE,U,1) S RCSTART=$P(RCRANGE,U,2),RCEND=$P(RCRANGE,U,3)
"RTN","RCDPEAR1",15,0)
 ;Get insurance company to be used as filter
"RTN","RCDPEAR1",16,0)
 S RCNP=$$GETPAY^RCDPEM9(344.4)
"RTN","RCDPEAR1",17,0)
 I RCNP=-1 G EN1Q
"RTN","RCDPEAR1",18,0)
 ; Get Zero Balance Filter
"RTN","RCDPEAR1",19,0)
 S RCBAL=$$RCBAL() I RCBAL=-1 G EN1Q
"RTN","RCDPEAR1",20,0)
 S RCDISPTY=$$DISPTY^RCDPEM3() I RCDISPTY=-1 G EN1Q
"RTN","RCDPEAR1",21,0)
 I RCDISPTY D INFO^RCDPEM6
"RTN","RCDPEAR1",22,0)
 S:$D(VAUTD)=11&(VAUTD'=1) RCIND=RCIND+1
"RTN","RCDPEAR1",23,0)
 S:$P($G(RCRANGE),U)>0 RCIND=RCIND+3
"RTN","RCDPEAR1",24,0)
 S:$D(^TMP("RCSELPAY",$J))&(RCNP=1) RCIND=RCIND+5
"RTN","RCDPEAR1",25,0)
 I $D(DUOUT)!$D(DTOUT) G EN1Q
"RTN","RCDPEAR1",26,0)
 S RCJOB=$J
"RTN","RCDPEAR1",27,0)
 ; Ask device
"RTN","RCDPEAR1",28,0)
 S %ZIS="QM" D ^%ZIS G:POP EN1Q
"RTN","RCDPEAR1",29,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPEAR1",30,0)
 .S ZTRTN="RPTOUT^RCDPEAR1",ZTDESC="AR - EDI LOCKBOX ERA AGING REPORT"
"RTN","RCDPEAR1",31,0)
 .S ZTSAVE("*")=""
"RTN","RCDPEAR1",32,0)
 .S RCJOB1="RCSELPAY,"_$H
"RTN","RCDPEAR1",33,0)
 .K ^TMP(RCJOB1,$J)
"RTN","RCDPEAR1",34,0)
 .M ^TMP(RCJOB1,$J)=^TMP("RCSELPAY",$J)
"RTN","RCDPEAR1",35,0)
 .D ^%ZTLOAD
"RTN","RCDPEAR1",36,0)
 .W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this $J.")
"RTN","RCDPEAR1",37,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEAR1",38,0)
 U IO
"RTN","RCDPEAR1",39,0)
 D RPTOUT
"RTN","RCDPEAR1",40,0)
EN1Q K ^TMP("RCSELPAY",$J),^TMP("RCPAYER",$J)
"RTN","RCDPEAR1",41,0)
 Q
"RTN","RCDPEAR1",42,0)
 ;
"RTN","RCDPEAR1",43,0)
RPTOUT(RCPRT) ; Entrypoint for queued job, nightly job
"RTN","RCDPEAR1",44,0)
 ; RCPRT = name of the subscript for ^TMP to use to return all lines
"RTN","RCDPEAR1",45,0)
 ;        (for bulletin).  If undefined or null, output is printed
"RTN","RCDPEAR1",46,0)
 ; Return global if RCPRT not null: ^TMP($J,RCPRT,line#)=line text
"RTN","RCDPEAR1",47,0)
 N ERAIEN,RCCT,RCPG,RCSTOP,RCNT,RCDATA,RCOUT,RCEDT,RC0,RC7,RCZ,RCZ0,RCZ1,RC00,RCTOT,Z,Z0,RCPAY
"RTN","RCDPEAR1",48,0)
 N STA,STNUM,STNAM
"RTN","RCDPEAR1",49,0)
 S RCPRT=$G(RCPRT),(RCCT,RCSTOP,RCPG,RCNT,RCTOT)=0
"RTN","RCDPEAR1",50,0)
 K ^TMP($J,"RCERA_AGED"),^TMP($J,"RCERA_ADJ")
"RTN","RCDPEAR1",51,0)
 I $G(RCJOB)'="",RCJOB'=$J D
"RTN","RCDPEAR1",52,0)
 . K ^TMP("RCSELPAY",$J)
"RTN","RCDPEAR1",53,0)
 . M ^TMP("RCSELPAY",$J)=^TMP(RCJOB1,RCJOB)
"RTN","RCDPEAR1",54,0)
 . K ^TMP(RCJOB1,RCJOB)
"RTN","RCDPEAR1",55,0)
 . S RCJOB=$J
"RTN","RCDPEAR1",56,0)
 I RCPRT'="" K ^TMP($J,RCPRT)
"RTN","RCDPEAR1",57,0)
 S RCZ0=0 F  S RCZ0=$O(^RCY(344.4,"AMATCH",0,RCZ0)) Q:'RCZ0  D
"RTN","RCDPEAR1",58,0)
 .S RC7=$P($G(^RCY(344.4,RCZ0,0)),U,7)\1  ; era file date/time
"RTN","RCDPEAR1",59,0)
 .; Check Station/Division
"RTN","RCDPEAR1",60,0)
 .;I '$$CHKDIV^RCDPEDAR(RCZ0,1,.VAUTD) Q
"RTN","RCDPEAR1",61,0)
 . I 'VAUTD D ERASTA^RCDPEM4(RCZ0,.STA,.STNUM,.STNAM) I '$D(VAUTD(STA)) Q
"RTN","RCDPEAR1",62,0)
 .; Check for payer match
"RTN","RCDPEAR1",63,0)
 .I '$$CHKPYR^RCDPEDAR(RCZ0,1,RCJOB) Q
"RTN","RCDPEAR1",64,0)
 .; Check date range
"RTN","RCDPEAR1",65,0)
 .I $P(RCRANGE,U,1) D  Q:'ERAIEN
"RTN","RCDPEAR1",66,0)
 ..S ERAIEN=$P($G(^RCY(344.4,RCZ0,0)),U,7)\1
"RTN","RCDPEAR1",67,0)
 .I $P(RCRANGE,U,1) Q:(RCSTART>RC7)!(RC7>RCEND)
"RTN","RCDPEAR1",68,0)
 .; Check for Zero Bal
"RTN","RCDPEAR1",69,0)
 . I 'RCBAL,'+$P($G(^RCY(344.4,RCZ0,0)),U,5) Q
"RTN","RCDPEAR1",70,0)
 .;  - include on report
"RTN","RCDPEAR1",71,0)
 .S ^TMP($J,"RCERA_AGED",$$FMDIFF^XLFDT(RC7,DT),RCZ0)=0,RCNT=RCNT+1
"RTN","RCDPEAR1",72,0)
 ;
"RTN","RCDPEAR1",73,0)
 ; build local payer array here
"RTN","RCDPEAR1",74,0)
 D SELPAY(RCNP,RCJOB,.RCPAY)
"RTN","RCDPEAR1",75,0)
 ; Calculate total amount for ERA
"RTN","RCDPEAR1",76,0)
 ;
"RTN","RCDPEAR1",77,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCERA_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCERA_AGED",RCZ,RCZ0)) Q:'RCZ0  D
"RTN","RCDPEAR1",78,0)
 .S RC0=$G(^RCY(344.4,RCZ0,0)),RCTOT=RCTOT+$P(RC0,U,5)
"RTN","RCDPEAR1",79,0)
 I RCDISPTY  D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.VAUTD,.RCPAY),EXCEL Q  ; prca 276  
"RTN","RCDPEAR1",80,0)
 ;
"RTN","RCDPEAR1",81,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCERA_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCERA_AGED",RCZ,RCZ0)) Q:'RCZ0  D  G:RCSTOP PRTQ
"RTN","RCDPEAR1",82,0)
 .I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W:RCPRT="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR1",83,0)
 .I RCPG D SETLINE(" ",.RCCT,.RCPRT) ; On detail list, skip line
"RTN","RCDPEAR1",84,0)
 .I 'RCPG!(($Y+5)>IOSL) D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.VAUTD,.RCPAY) Q:RCSTOP
"RTN","RCDPEAR1",85,0)
 .S RC0=$G(^RCY(344.4,RCZ0,0)),RCTOT=RCTOT+$P(RC0,U,5)
"RTN","RCDPEAR1",86,0)
 .S Z=$$SETSTR^VALM1($J(-RCZ,4),"",1,4)
"RTN","RCDPEAR1",87,0)
 .S Z=$$SETSTR^VALM1("  "_$P(RC0,U,2),Z,5,50)
"RTN","RCDPEAR1",88,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",89,0)
 .S Z=$$SETSTR^VALM1($P(RC0,U,6)_"/"_$P(RC0,U,3),"",11,69)
"RTN","RCDPEAR1",90,0)
 .S Z=$$SETSTR^VALM1("  "_$$FMTE^XLFDT($P(RC0,U,4),2),Z,70,10)
"RTN","RCDPEAR1",91,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",92,0)
 .S Z=$$SETSTR^VALM1($J("",16)_$S($P(RC0,U,7):$$FMTE^XLFDT($P(RC0,U,7)\1,2),1:""),"",1,25)
"RTN","RCDPEAR1",93,0)
 .S Z=$$SETSTR^VALM1("  "_$J($P(RC0,U,5),15,2),Z,26,17)
"RTN","RCDPEAR1",94,0)
 .S Z=$$SETSTR^VALM1("  "_+$P(RC0,U,11),Z,43,11)
"RTN","RCDPEAR1",95,0)
 .S Z=$$SETSTR^VALM1("  "_$P(RC0,U),Z_$S('$$HACERA^RCDPEU(RCZ0):"",1:" (HAC ERA)"),54,26)
"RTN","RCDPEAR1",96,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",97,0)
 .I "23"[$$ADJ^RCDPEU(RCZ0) D SETLINE($J("",9)_"** CLAIM LEVEL ADJUSTMENTS EXIST FOR THIS ERA ***",.RCCT,RCPRT)
"RTN","RCDPEAR1",98,0)
 .I $O(^RCY(344.4,RCZ0,2,0)) D  ; ERA level adjustments exist
"RTN","RCDPEAR1",99,0)
 ..N Q
"RTN","RCDPEAR1",100,0)
 ..D DISPADJ^RCDPESR8(RCZ0,"^TMP("_$J_",""RCERA_ADJ"")")
"RTN","RCDPEAR1",101,0)
 ..I $O(^TMP($J,"RCERA_ADJ",0)) D SETLINE($J("",9)_"** GENERAL ADJUSTMENT DATA EXISTS FOR ERA **",.RCCT,RCPRT)
"RTN","RCDPEAR1",102,0)
 ..S Q=0 F  S Q=$O(^TMP($J,"RCERA_ADJ",Q)) Q:'Q  D SETLINE($J("",9)_$G(^TMP($J,"RCERA_ADJ",Q)),.RCCT,RCPRT)
"RTN","RCDPEAR1",103,0)
 .;
"RTN","RCDPEAR1",104,0)
 .S RCZ1=0 F  S RCZ1=$O(^RCY(344.4,RCZ0,1,RCZ1)) Q:'RCZ1  S RC00=$G(^(RCZ1,0)) D  Q:RCSTOP
"RTN","RCDPEAR1",105,0)
 ..N D
"RTN","RCDPEAR1",106,0)
 ..K RCDATA,RCOUT
"RTN","RCDPEAR1",107,0)
 ..I ($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.VAUTD,.RCPAY) Q:RCSTOP
"RTN","RCDPEAR1",108,0)
 ..S D=$J("",7)_" EEOB Seq #: "_$P(RC00,U)_$S($D(^RCY(344.4,RCZ0,1,"ATB",1,RCZ1)):" (REVERSAL)",1:"")_"  EEOB "
"RTN","RCDPEAR1",109,0)
 ..S D=D_$S('$P(RC00,U,2):"not on file",1:"on file for "_$P($G(^DGCR(399,+$G(^IBM(361.1,+$P(RC00,U,2),0)),0)),U))_"  "_$J(+$P(RC00,U,3),"",2)
"RTN","RCDPEAR1",110,0)
 ..D SETLINE(D,.RCCT,RCPRT)
"RTN","RCDPEAR1",111,0)
 ..Q:$P(RC00,U,2)
"RTN","RCDPEAR1",112,0)
 ..D DISP^RCDPESR0("^RCY(344.4,"_RCZ0_",1,"_RCZ1_",1)","RCDATA",1,"RCOUT",68,1)
"RTN","RCDPEAR1",113,0)
 ..I '$O(RCOUT(0)) D SETLINE($J("",9)_" NO DETAIL FOUND",.RCCT,RCPRT) Q
"RTN","RCDPEAR1",114,0)
 ..S Z=0 F  S Z=$O(RCOUT(Z)) Q:'Z  D  Q:RCSTOP
"RTN","RCDPEAR1",115,0)
 ... I ($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.VAUTD,.RCPAY) Q:RCSTOP
"RTN","RCDPEAR1",116,0)
 ... D SETLINE($J("",9)_"*"_RCOUT(Z),.RCCT,RCPRT)
"RTN","RCDPEAR1",117,0)
 ;
"RTN","RCDPEAR1",118,0)
 F Z0=1:1:2 D SETLINE(" ",.RCCT,RCPRT)
"RTN","RCDPEAR1",119,0)
 I ($Y+7)>IOSL!'RCPG D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.VAUTD,.RCPAY)
"RTN","RCDPEAR1",120,0)
 ;
"RTN","RCDPEAR1",121,0)
 W !,"******** END OF REPORT ********",!
"RTN","RCDPEAR1",122,0)
PRTQ I '$D(ZTQUEUED),'RCSTOP,RCPG,RCPRT="" D ASK()
"RTN","RCDPEAR1",123,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAR1",124,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAR1",125,0)
 K ^TMP($J,"RCERA_AGED"),^TMP("RCSELPAY",$J)
"RTN","RCDPEAR1",126,0)
 Q
"RTN","RCDPEAR1",127,0)
 ;
"RTN","RCDPEAR1",128,0)
HDR(RCCT,RCPG,RCSTOP,RCPRT,RCRANGE,VAUTD,RCPAY) ;Prints report heading
"RTN","RCDPEAR1",129,0)
 ; Function returns RCPG = current page # and RCCT = running line count
"RTN","RCDPEAR1",130,0)
 ;   and RCSTOP = 1 if user aborted print 
"RTN","RCDPEAR1",131,0)
 ; Parameters must be passed by reference
"RTN","RCDPEAR1",132,0)
 ; RCPRT = name of the subscript for ^TMP to use to return all lines
"RTN","RCDPEAR1",133,0)
 ;        (for bulletin).  If undefined or null, output is printed
"RTN","RCDPEAR1",134,0)
 ; RCRANGE - date range filter value to be printed as part of the header
"RTN","RCDPEAR1",135,0)
 ; VAUTD (required/pass-by-ref) - Division filter value(s)
"RTN","RCDPEAR1",136,0)
 ; RCPAY (required/pass-by-ref) - Payer filter value(s)
"RTN","RCDPEAR1",137,0)
 ;
"RTN","RCDPEAR1",138,0)
 N Z,Z0,START,END,SUB,%,CNT
"RTN","RCDPEAR1",139,0)
 Q:$G(RCSTOP)
"RTN","RCDPEAR1",140,0)
 I RCPG!($E(IOST,1,2)="C-") D  Q:$G(RCSTOP)
"RTN","RCDPEAR1",141,0)
 .I RCPG&($E(IOST,1,2)="C-")&(RCPRT="") D ASK(.RCSTOP) Q:RCSTOP
"RTN","RCDPEAR1",142,0)
 .I RCPRT="" W @IOF,*13 Q  ; Write form feed for report
"RTN","RCDPEAR1",143,0)
 S RCPG=RCPG+1,Z0="ERA UNMATCHED AGING REPORT"
"RTN","RCDPEAR1",144,0)
 S Z=$$SETSTR^VALM1($J("",80-$L(Z0)\2)_Z0,"",1,79)
"RTN","RCDPEAR1",145,0)
 S:'RCDISPTY Z=$$SETSTR^VALM1("Page: "_RCPG,Z,64,17)
"RTN","RCDPEAR1",146,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",147,0)
 D NOW^%DTC
"RTN","RCDPEAR1",148,0)
 S Z="RUN DATE/TIME: "_$$FMTE^XLFDT(%,2),Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",149,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",150,0)
 S END=$P(RCRANGE,U,3)
"RTN","RCDPEAR1",151,0)
 ; divisions
"RTN","RCDPEAR1",152,0)
 S Z="DIVISIONS: "
"RTN","RCDPEAR1",153,0)
 I $D(VAUTD)=1 D
"RTN","RCDPEAR1",154,0)
 .S Z=Z_"ALL",Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",155,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",156,0)
 .S Z=""
"RTN","RCDPEAR1",157,0)
 I $D(VAUTD)>1,'VAUTD D
"RTN","RCDPEAR1",158,0)
 .S SUB=VAUTD
"RTN","RCDPEAR1",159,0)
 .F  S SUB=$O(VAUTD(SUB)) Q:'SUB  D
"RTN","RCDPEAR1",160,0)
 ..I Z="DIVISIONS: " S Z=Z_VAUTD(SUB) Q
"RTN","RCDPEAR1",161,0)
 ..S Z=Z_$S(Z]"":",",1:"")_VAUTD(SUB)
"RTN","RCDPEAR1",162,0)
 ..I $L(Z)>50 D
"RTN","RCDPEAR1",163,0)
 ...S Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",164,0)
 ...D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",165,0)
 ...S Z=""
"RTN","RCDPEAR1",166,0)
 I Z]"" D
"RTN","RCDPEAR1",167,0)
 .S Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",168,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",169,0)
 ;
"RTN","RCDPEAR1",170,0)
 ; Payers
"RTN","RCDPEAR1",171,0)
 S Z="PAYERS: "
"RTN","RCDPEAR1",172,0)
 I $D(RCPAY)=1 S Z=Z_RCPAY
"RTN","RCDPEAR1",173,0)
 I $D(RCPAY)=10 D
"RTN","RCDPEAR1",174,0)
 .S CNT=0
"RTN","RCDPEAR1",175,0)
 .F  S CNT=$O(RCPAY(CNT)) Q:'CNT  D
"RTN","RCDPEAR1",176,0)
 ..I Z="PAYERS: " S Z=Z_RCPAY(CNT) Q
"RTN","RCDPEAR1",177,0)
 ..S Z=Z_$S(Z]"":",",1:"")_RCPAY(CNT)
"RTN","RCDPEAR1",178,0)
 ..I $L(Z)>50 D
"RTN","RCDPEAR1",179,0)
 ...S Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",180,0)
 ...D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",181,0)
 ...S Z=""
"RTN","RCDPEAR1",182,0)
 I Z]"" D
"RTN","RCDPEAR1",183,0)
 .S Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",184,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",185,0)
 S START=$P(RCRANGE,U,2)
"RTN","RCDPEAR1",186,0)
 S Z="DATE RANGE: "_$P($$FMTE^XLFDT(START,2),"@")_" - "_$P($$FMTE^XLFDT(END,2),"@")_" (ERA FILE DATE)",Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",187,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",188,0)
 Q:RCDISPTY  ; prca 276 - do not print column headers for excel format
"RTN","RCDPEAR1",189,0)
 D SETLINE(" ",.RCCT,RCPRT)
"RTN","RCDPEAR1",190,0)
 D SETLINE("AGED",.RCCT,RCPRT)
"RTN","RCDPEAR1",191,0)
 S Z=$$SETSTR^VALM1("DAYS"_$J("",2)_"TRACE #","",1,79)
"RTN","RCDPEAR1",192,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",193,0)
 S Z=$$SETSTR^VALM1($J("",10)_"PAYMENT FROM/ID"_$J("",46)_"ERA DATE","",1,79)
"RTN","RCDPEAR1",194,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",195,0)
 S Z=$$SETSTR^VALM1($J("",16)_"FILE DATE"_$J("",6)_"AMOUNT PAID"_$J("",2)_"EEOB CNT "_$J("",2)_"ERA #",Z,1,79)
"RTN","RCDPEAR1",196,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",197,0)
 D SETLINE($TR($J("",IOM-1)," ","="),.RCCT,RCPRT)
"RTN","RCDPEAR1",198,0)
 I RCPG=1 D
"RTN","RCDPEAR1",199,0)
 .D SETLINE("TOTALS:",.RCCT,RCPRT)
"RTN","RCDPEAR1",200,0)
 .S Z=$$SETSTR^VALM1(" NUMBER AGED ELECTRONIC ERA MESSAGES FOUND: "_RCNT,"",1,79)
"RTN","RCDPEAR1",201,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",202,0)
 .S Z=$$SETSTR^VALM1(" AMOUNT AGED ELECTRONIC ERA MESSAGES FOUND: $"_$FN(+RCTOT,",",2),"",1,79)
"RTN","RCDPEAR1",203,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",204,0)
 .D SETLINE($TR($J("",IOM-1)," ","="),.RCCT,RCPRT)
"RTN","RCDPEAR1",205,0)
 Q
"RTN","RCDPEAR1",206,0)
 ;
"RTN","RCDPEAR1",207,0)
EXCEL ; Print report to screen, one record per line for export to MS Excel.
"RTN","RCDPEAR1",208,0)
 N RCLFLG,RCZ,RCZ0,RC00,Z,D,RCZ1,RZ,RZ1
"RTN","RCDPEAR1",209,0)
 W !!,"Aged Days^Trace #^Payment From/ID^ERA Date^File Date^Amount Paid^EEOB Cnt^ERA #^EEOB Detail"
"RTN","RCDPEAR1",210,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCERA_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCERA_AGED",RCZ,RCZ0)) Q:'RCZ0  D  G:RCSTOP PRTQ2
"RTN","RCDPEAR1",211,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W:RCPRT="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR1",212,0)
 . S RC0=$G(^RCY(344.4,RCZ0,0))
"RTN","RCDPEAR1",213,0)
 . S Z=$J(-RCZ,4)_U_$P(RC0,U,2)_U_$P(RC0,U,6)_"/"_$P(RC0,U,3)_U_$$FMTE^XLFDT($P(RC0,U,4),2)_U_$$FMTE^XLFDT($P(RC0,U,7),2)_U
"RTN","RCDPEAR1",214,0)
 . S Z=Z_$P(RC0,U,5)_U_$P(RC0,U,11)_U_$P(RC0,U)
"RTN","RCDPEAR1",215,0)
 . W !,Z
"RTN","RCDPEAR1",216,0)
 . S RZ=Z,RZ1=0
"RTN","RCDPEAR1",217,0)
 . K Z
"RTN","RCDPEAR1",218,0)
 .;;;
"RTN","RCDPEAR1",219,0)
 . I "23"[$$ADJ^RCDPEU(RCZ0) D EXCEL1 W "^** CLAIM LEVEL ADJUSTMENTS EXIST FOR THIS ERA ***"
"RTN","RCDPEAR1",220,0)
 . I $O(^RCY(344.4,RCZ0,2,0)) D  ; ERA level adjustments exist
"RTN","RCDPEAR1",221,0)
 . . N Q
"RTN","RCDPEAR1",222,0)
 . . D DISPADJ^RCDPESR8(RCZ0,"^TMP("_$J_",""RCERA_ADJ"")")
"RTN","RCDPEAR1",223,0)
 . . I $O(^TMP($J,"RCERA_ADJ",0)) D EXCEL1 W "^** GENERAL ADJUSTMENT DATA EXISTS FOR ERA **"
"RTN","RCDPEAR1",224,0)
 . . S Q=0 F  S Q=$O(^TMP($J,"RCERA_ADJ",Q)) Q:'Q  D EXCEL1 W "^"_$G(^TMP($J,"RCERA_ADJ",Q))
"RTN","RCDPEAR1",225,0)
 .;
"RTN","RCDPEAR1",226,0)
 . S RCZ1=0 F  S RCZ1=$O(^RCY(344.4,RCZ0,1,RCZ1)) Q:'RCZ1  S RC00=$G(^(RCZ1,0)) D  Q:RCSTOP
"RTN","RCDPEAR1",227,0)
 . . N D
"RTN","RCDPEAR1",228,0)
 . . K RCDATA,RCOUT
"RTN","RCDPEAR1",229,0)
 . . S D=" EEOB Seq #: "_$P(RC00,U)_$S($D(^RCY(344.4,RCZ0,1,"ATB",1,RCZ1)):" (REVERSAL)",1:"")_"  EEOB "
"RTN","RCDPEAR1",230,0)
 . . S D=D_$S('$P(RC00,U,2):"not on file",1:"on file for "_$P($G(^DGCR(399,+$G(^IBM(361.1,+$P(RC00,U,2),0)),0)),U))_"  "_$J(+$P(RC00,U,3),"",2)
"RTN","RCDPEAR1",231,0)
 . . D EXCEL1 W "^",D
"RTN","RCDPEAR1",232,0)
 . . Q:$P(RC00,U,2)
"RTN","RCDPEAR1",233,0)
 . . D DISP^RCDPESR0("^RCY(344.4,"_RCZ0_",1,"_RCZ1_",1)","RCDATA",1,"RCOUT",68,1)
"RTN","RCDPEAR1",234,0)
 . . I '$O(RCOUT(0)) D EXCEL1 W "^NO DETAIL FOUND" Q
"RTN","RCDPEAR1",235,0)
 . . S Z=0 F  S Z=$O(RCOUT(Z)) Q:'Z  D  Q:RCSTOP
"RTN","RCDPEAR1",236,0)
 . . . D EXCEL1 W "^*"_RCOUT(Z)
"RTN","RCDPEAR1",237,0)
 W !,"******** END OF REPORT ********",!
"RTN","RCDPEAR1",238,0)
 Q
"RTN","RCDPEAR1",239,0)
 ;
"RTN","RCDPEAR1",240,0)
EXCEL1 ; Display repeat info line before each EEOB detail section.
"RTN","RCDPEAR1",241,0)
 ; First detail line does not need it
"RTN","RCDPEAR1",242,0)
 I RZ1 W !,RZ Q
"RTN","RCDPEAR1",243,0)
 S RZ1=1 Q
"RTN","RCDPEAR1",244,0)
 ;
"RTN","RCDPEAR1",245,0)
PRTQ2 I '$D(ZTQUEUED),'RCSTOP,RCPG,RCPRT="" D ASK()
"RTN","RCDPEAR1",246,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAR1",247,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAR1",248,0)
 K ^TMP($J,"RCEFT_AGED")
"RTN","RCDPEAR1",249,0)
 Q
"RTN","RCDPEAR1",250,0)
 ;
"RTN","RCDPEAR1",251,0)
TEXT ; Filtered by messages
"RTN","RCDPEAR1",252,0)
 ;;No Filters Applied
"RTN","RCDPEAR1",253,0)
 ;;Station/Division
"RTN","RCDPEAR1",254,0)
 ;;
"RTN","RCDPEAR1",255,0)
 ;;Date Range
"RTN","RCDPEAR1",256,0)
 ;;Station/Division, Date Range
"RTN","RCDPEAR1",257,0)
 ;;Payer
"RTN","RCDPEAR1",258,0)
 ;;Station/Division, Payer
"RTN","RCDPEAR1",259,0)
 ;;
"RTN","RCDPEAR1",260,0)
 ;;Date Range, Payer
"RTN","RCDPEAR1",261,0)
 ;;Station/Division, Date Range, Payer
"RTN","RCDPEAR1",262,0)
 Q
"RTN","RCDPEAR1",263,0)
 ;
"RTN","RCDPEAR1",264,0)
SETLINE(Z,RCCT,RCPRT) ; Sets line into print global or writes line
"RTN","RCDPEAR1",265,0)
 ; Z = txt to output
"RTN","RCDPEAR1",266,0)
 ; RCCT = if defined = line counter
"RTN","RCDPEAR1",267,0)
 ; RCPRT = if defined = flag if 1, indicates output to global, no writes 
"RTN","RCDPEAR1",268,0)
 I $G(RCPRT)="" W !,Z Q
"RTN","RCDPEAR1",269,0)
 S RCCT=RCCT+1
"RTN","RCDPEAR1",270,0)
 S ^TMP($J,RCPRT,RCCT)=Z
"RTN","RCDPEAR1",271,0)
 Q
"RTN","RCDPEAR1",272,0)
 ;
"RTN","RCDPEAR1",273,0)
ASK(RCSTOP) ; Ask to continue
"RTN","RCDPEAR1",274,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEAR1",275,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEAR1",276,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEAR1",277,0)
 S DIR(0)="E" W ! D ^DIR K DIR
"RTN","RCDPEAR1",278,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEAR1",279,0)
 Q
"RTN","RCDPEAR1",280,0)
 ;
"RTN","RCDPEAR1",281,0)
SELPAY(RCNP,RCJOB,RCPAY) ;localize the payer filters for header display
"RTN","RCDPEAR1",282,0)
 ; Input:
"RTN","RCDPEAR1",283,0)
 ;   RCNP (pass-by-val/required) - payer filter response indicator (2=ALL, 3=SPECIFIC)
"RTN","RCDPEAR1",284,0)
 ;   RCJOB - job number to access the populated temporary global array in case report was tasked to run
"RTN","RCDPEAR1",285,0)
 ; Output:
"RTN","RCDPEAR1",286,0)
 ;   RCPAY (pass-by-ref/required) - local array of payers e.g. RCPAY="ALL", RCPAY(1)="Aetna",
"RTN","RCDPEAR1",287,0)
 ;                                  or RCPAY="start payer = end payer"
"RTN","RCDPEAR1",288,0)
 ;
"RTN","RCDPEAR1",289,0)
 N CNT,I
"RTN","RCDPEAR1",290,0)
 I RCNP=2 S RCPAY="ALL" Q
"RTN","RCDPEAR1",291,0)
 S:RCJOB="" RCJOB=$J   ; RCJOB should not be null
"RTN","RCDPEAR1",292,0)
 I RCNP=3 D  Q
"RTN","RCDPEAR1",293,0)
 .S CNT=0
"RTN","RCDPEAR1",294,0)
 .F  S CNT=$O(^TMP("RCSELPAY",RCJOB,CNT)) Q:'CNT  D
"RTN","RCDPEAR1",295,0)
 ..S RCPAY(CNT)=^TMP("RCSELPAY",RCJOB,CNT)
"RTN","RCDPEAR1",296,0)
 ;RCNP indicates a range of payers
"RTN","RCDPEAR1",297,0)
 S I=$O(^TMP("RCSELPAY",RCJOB,"")),RCPAY=^(I)_" - "
"RTN","RCDPEAR1",298,0)
 S I=$O(^TMP("RCSELPAY",RCJOB,""),-1),RCPAY=RCPAY_^(I)
"RTN","RCDPEAR1",299,0)
 Q
"RTN","RCDPEAR1",300,0)
RCBAL() ; Get Zero Payment Filter
"RTN","RCDPEAR1",301,0)
 ; INPUTS   : User input from keyboard
"RTN","RCDPEAR1",302,0)
 ; RETURNS  : Output destination (0=Display; 1=MS Excel)
"RTN","RCDPEAR1",303,0)
 ; LOCAL VARIABLES :
"RTN","RCDPEAR1",304,0)
 ; DIR,DUOUT - Standard FileMan variables
"RTN","RCDPEAR1",305,0)
 ; Y         - User input
"RTN","RCDPEAR1",306,0)
 N DIR,DUOUT,Y
"RTN","RCDPEAR1",307,0)
 S DIR(0)="Y"
"RTN","RCDPEAR1",308,0)
 S DIR("A")="INCLUDE ZERO PAYMENT AMOUNTS (Y/N): "
"RTN","RCDPEAR1",309,0)
 S DIR("B")="Y"
"RTN","RCDPEAR1",310,0)
 D ^DIR K DIR
"RTN","RCDPEAR1",311,0)
 I $D(DUOUT)!$D(DIRUT) S Y=-1
"RTN","RCDPEAR1",312,0)
 Q Y
"RTN","RCDPEAR2")
0^49^B60443432^B32087204
"RTN","RCDPEAR2",1,0)
RCDPEAR2 ;ALB/TMK/PJH - EFT Unmatched Aging Report - FILE 344.3 ;04-NOV-02
"RTN","RCDPEAR2",2,0)
 ;;4.5;Accounts Receivable;**173,269,276**;Mar 20, 1995;Build 87
"RTN","RCDPEAR2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEAR2",4,0)
 Q
"RTN","RCDPEAR2",5,0)
 ;
"RTN","RCDPEAR2",6,0)
EN1 ; Entry from option - run on the fly
"RTN","RCDPEAR2",7,0)
 N DIR,Y,%ZIS,ZTRTN,ZTSAVE,ZTDESC,POP,X,RCNP,RCJOB,RCJOB1
"RTN","RCDPEAR2",8,0)
 N RCRANGE,RCDISPTY,RCSTART,ZTSTOP,RCEND,DIC,RCIND
"RTN","RCDPEAR2",9,0)
 S RCIND=1
"RTN","RCDPEAR2",10,0)
 S RCRANGE=$$DTRNG^RCDPEM4()
"RTN","RCDPEAR2",11,0)
 I RCRANGE=0 G EN1Q
"RTN","RCDPEAR2",12,0)
 I $P(RCRANGE,U,1) D
"RTN","RCDPEAR2",13,0)
 . S RCSTART=$P(RCRANGE,U,2)-1
"RTN","RCDPEAR2",14,0)
 . S RCEND=$P(RCRANGE,U,3)
"RTN","RCDPEAR2",15,0)
 ;Get insurance company to be used as filter
"RTN","RCDPEAR2",16,0)
 S RCNP=$$GETPAY^RCDPEM9(344.31) I RCNP=-1 G EN1Q
"RTN","RCDPEAR2",17,0)
 ;Get display type
"RTN","RCDPEAR2",18,0)
 S RCDISPTY=$$DISPTY^RCDPEM3() Q:RCDISPTY=-1
"RTN","RCDPEAR2",19,0)
 I $D(DUOUT)!$D(DTOUT) G EN1Q
"RTN","RCDPEAR2",20,0)
 I RCDISPTY D INFO^RCDPEM6
"RTN","RCDPEAR2",21,0)
 S:$P($G(RCRANGE),U)>0 RCIND=RCIND+3
"RTN","RCDPEAR2",22,0)
 S:$D(^TMP("RCSELPAY",$J))&(RCNP=1) RCIND=RCIND+5
"RTN","RCDPEAR2",23,0)
 S RCJOB=$J
"RTN","RCDPEAR2",24,0)
 ; Ask device
"RTN","RCDPEAR2",25,0)
 S %ZIS="QM" D ^%ZIS G:POP EN1Q
"RTN","RCDPEAR2",26,0)
 I $D(IO("Q")) D  G EN1Q
"RTN","RCDPEAR2",27,0)
 . S ZTRTN="RPTOUT^RCDPEAR2",ZTDESC="EFT AGING REPORT"
"RTN","RCDPEAR2",28,0)
 . S ZTSAVE("*")=""
"RTN","RCDPEAR2",29,0)
 . S RCJOB1="RCSELPAY,"_$H
"RTN","RCDPEAR2",30,0)
 . K ^TMP(RCJOB1,$J)
"RTN","RCDPEAR2",31,0)
 . M ^TMP(RCJOB1,$J)=^TMP("RCSELPAY",$J)
"RTN","RCDPEAR2",32,0)
 . D ^%ZTLOAD
"RTN","RCDPEAR2",33,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEAR2",34,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEAR2",35,0)
 U IO
"RTN","RCDPEAR2",36,0)
 D RPTOUT
"RTN","RCDPEAR2",37,0)
EN1Q Q
"RTN","RCDPEAR2",38,0)
 ;
"RTN","RCDPEAR2",39,0)
RPTOUT(RCPRT) ; Entrypoint for queued job, nightly job
"RTN","RCDPEAR2",40,0)
 ; RCPRT = name of the subscript for ^TMP to use to return all lines
"RTN","RCDPEAR2",41,0)
 ;        (for bulletin).  If undefined or null, output is printed
"RTN","RCDPEAR2",42,0)
 ; Return global if RCPRT not null: ^TMP($J,RCPRT,line#)=line text
"RTN","RCDPEAR2",43,0)
 N RCCT,RCPG,RCPGS,RCSTOP,RCNT,RCTOT,RCOUT,RC0,RC13,RCZ,RCZ0,RC00,Z,Z0,DIC,DUOUT,X,RCPAY,RCRUNDT
"RTN","RCDPEAR2",44,0)
 S RCPRT=$G(RCPRT)
"RTN","RCDPEAR2",45,0)
 S (RCCT,RCSTOP,RCPG,RCNT,RCTOT,RCPGS)=0,RCRUNDT=$$NOW^RCDPEM6
"RTN","RCDPEAR2",46,0)
 S RCPGS=1
"RTN","RCDPEAR2",47,0)
 K ^TMP($J,"RCERA_AGED"),^TMP($J,"RCERA_ADJ")
"RTN","RCDPEAR2",48,0)
 I $G(RCJOB)'="",RCJOB'=$J D
"RTN","RCDPEAR2",49,0)
 . K ^TMP("RCSELPAY",$J)
"RTN","RCDPEAR2",50,0)
 . M ^TMP("RCSELPAY",$J)=^TMP(RCJOB1,RCJOB)
"RTN","RCDPEAR2",51,0)
 . K ^TMP(RCJOB1,RCJOB)
"RTN","RCDPEAR2",52,0)
 . S RCJOB=$J
"RTN","RCDPEAR2",53,0)
 ; build local payer array here
"RTN","RCDPEAR2",54,0)
 D SELPAY^RCDPEAR1(RCNP,RCJOB,.RCPAY)
"RTN","RCDPEAR2",55,0)
 I RCPRT'="" K ^TMP($J,RCPRT)
"RTN","RCDPEAR2",56,0)
 S RCZ0=0 F  S RCZ0=$O(^RCY(344.31,"AMATCH",0,RCZ0)) Q:'RCZ0  D
"RTN","RCDPEAR2",57,0)
 .Q:$P($G(^RCY(344.31,RCZ0,3)),U)
"RTN","RCDPEAR2",58,0)
 .Q:$P($G(^RCY(344.31,RCZ0,0)),U,7)=0
"RTN","RCDPEAR2",59,0)
 .S RC13=$P($G(^RCY(344.31,RCZ0,0)),U,13)  ;date received
"RTN","RCDPEAR2",60,0)
 .; Check for payer match
"RTN","RCDPEAR2",61,0)
 .I '$$CHKPYR^RCDPEDAR(RCZ0,0,RCJOB) Q
"RTN","RCDPEAR2",62,0)
 .; Check date range
"RTN","RCDPEAR2",63,0)
 .I $P(RCRANGE,U,1) Q:(RCSTART>RC13)!(RC13>RCEND)
"RTN","RCDPEAR2",64,0)
 .; Passed all the filters - include on report
"RTN","RCDPEAR2",65,0)
 .S ^TMP($J,"RCEFT_AGED",$$FMDIFF^XLFDT(RC13,DT),RCZ0)=0,RCNT=RCNT+1
"RTN","RCDPEAR2",66,0)
 I RCDISPTY D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.RCPAY,RCRUNDT),EXCEL Q
"RTN","RCDPEAR2",67,0)
 ;
"RTN","RCDPEAR2",68,0)
 ; Find total amount of EFTs
"RTN","RCDPEAR2",69,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCEFT_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCEFT_AGED",RCZ,RCZ0)) Q:'RCZ0  D  G:RCSTOP PRTQ
"RTN","RCDPEAR2",70,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W:RCPRT="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR2",71,0)
 . S RC0=$G(^RCY(344.31,RCZ0,0)),RC00=$G(^RCY(344.3,+RC0,0))
"RTN","RCDPEAR2",72,0)
 . S RCTOT=RCTOT+$P(RC0,U,7)
"RTN","RCDPEAR2",73,0)
 ;
"RTN","RCDPEAR2",74,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCEFT_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCEFT_AGED",RCZ,RCZ0)) Q:'RCZ0  D  G:RCSTOP PRTQ
"RTN","RCDPEAR2",75,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W:RCPRT="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR2",76,0)
 . I RCPG D SETLINE(" ",.RCCT,.RCPRT) ; On detail list, skip line
"RTN","RCDPEAR2",77,0)
 . I 'RCPG!(($Y+5)>IOSL) S RCPGS=RCPGS+1 D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.RCPAY,RCRUNDT) Q:RCSTOP
"RTN","RCDPEAR2",78,0)
 . S RC0=$G(^RCY(344.31,RCZ0,0)),RC00=$G(^RCY(344.3,+RC0,0))
"RTN","RCDPEAR2",79,0)
 . S RCTOT=RCTOT+$P(RC0,U,7)
"RTN","RCDPEAR2",80,0)
 . S Z=$$SETSTR^VALM1($J(-RCZ,4),"",1,4)
"RTN","RCDPEAR2",81,0)
 . S Z=$$SETSTR^VALM1("  "_$P(RC0,U,4),Z,5,75)
"RTN","RCDPEAR2",82,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",83,0)
 . S Z=$$SETSTR^VALM1($P(RC0,U,2)_"/"_$P(RC0,U,3),"",11,69)
"RTN","RCDPEAR2",84,0)
 . S Z=$$SETSTR^VALM1("  "_$$FMTE^XLFDT($P(RC0,U,12),2),Z,70,10)
"RTN","RCDPEAR2",85,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",86,0)
 . S Z=$$SETSTR^VALM1($J("",6)_$S($P(RC0,U,13):$$FMTE^XLFDT($P(RC0,U,13),2),1:""),"",1,17)
"RTN","RCDPEAR2",87,0)
 . S Z=$$SETSTR^VALM1("  "_$J($P(RC0,U,7),15,2),Z,18,17)
"RTN","RCDPEAR2",88,0)
 . S Z=$$SETSTR^VALM1("  "_$P(RC00,U,6),Z,35,8)
"RTN","RCDPEAR2",89,0)
 . S Z=$$SETSTR^VALM1("  "_$S($P(RC00,U,12):"",1:"NOT ")_"POSTED TO 8NZZ"_$S($P(RC00,U,12):" ON "_$$FMTE^XLFDT($P(RC00,U,11),2),1:""),Z,44,36)
"RTN","RCDPEAR2",90,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",91,0)
 . ;
"RTN","RCDPEAR2",92,0)
 . K RCOUT
"RTN","RCDPEAR2",93,0)
 . D GETS^DIQ(344.31,RCZ0_",",2,"E","RCOUT")
"RTN","RCDPEAR2",94,0)
 . Q:'$O(RCOUT(344.31,RCZ0_",",2,0))
"RTN","RCDPEAR2",95,0)
 . D SETLINE($J("",8)_"--EXCEPTION NOTES--",.RCCT,RCPRT)
"RTN","RCDPEAR2",96,0)
 . S Z=0 F  S Z=$O(RCOUT(344.31,RCZ0_",",2,Z)) Q:'Z  D  Q:RCSTOP
"RTN","RCDPEAR2",97,0)
 .. I ($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.RCPAY,RCRUNDT) Q:RCSTOP
"RTN","RCDPEAR2",98,0)
 .. D SETLINE($J("",8)_" "_RCOUT(344.31,RCZ0_",",2,Z),.RCCT,RCPRT)
"RTN","RCDPEAR2",99,0)
 ;
"RTN","RCDPEAR2",100,0)
 F Z0=1:1:2 D SETLINE(" ",.RCCT,RCPRT)
"RTN","RCDPEAR2",101,0)
 I ($Y+7)>IOSL!'RCPG D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.RCPAY,RCRUNDT)
"RTN","RCDPEAR2",102,0)
 S Z=$$SETSTR^VALM1("TOTALS:","",1,79)
"RTN","RCDPEAR2",103,0)
 ;
"RTN","RCDPEAR2",104,0)
 W !,"*** END OF REPORT ***",!
"RTN","RCDPEAR2",105,0)
PRTQ I '$D(ZTQUEUED),'RCSTOP,RCPG,RCPRT="" D ASK()
"RTN","RCDPEAR2",106,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAR2",107,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAR2",108,0)
 K ^TMP($J,"RCEFT_AGED"),ZTQUEUED
"RTN","RCDPEAR2",109,0)
 Q
"RTN","RCDPEAR2",110,0)
 ;
"RTN","RCDPEAR2",111,0)
HDR(RCCT,RCPG,RCSTOP,RCPRT,RCRANGE,RCPAY,RCRUNDT) ;Prints report heading
"RTN","RCDPEAR2",112,0)
 ; Function returns RCPG = current page # and RCCT = running line count
"RTN","RCDPEAR2",113,0)
 ;   and RCSTOP = 1 if user aborted print 
"RTN","RCDPEAR2",114,0)
 ; Above parameters must be passed by reference
"RTN","RCDPEAR2",115,0)
 ; RCPRT = name of the subscript for ^TMP to use to return all lines
"RTN","RCDPEAR2",116,0)
 ;        (for bulletin).  If undefined or null, output is printed
"RTN","RCDPEAR2",117,0)
 ; RCRANGE - date range filter value to be printed as part of the header
"RTN","RCDPEAR2",118,0)
 ; RCPAY (required/pass-by-ref) - Payer filter value(s)
"RTN","RCDPEAR2",119,0)
 ;
"RTN","RCDPEAR2",120,0)
 N CNT,END,START,Z,Z0
"RTN","RCDPEAR2",121,0)
 I RCPG!($E(IOST,1,2)="C-") D
"RTN","RCDPEAR2",122,0)
 . I RCPG&($E(IOST,1,2)="C-")&(RCPRT="") D ASK(.RCSTOP) Q:RCSTOP
"RTN","RCDPEAR2",123,0)
 . I RCPRT="" W @IOF,*13 Q  ; Write form feed for report
"RTN","RCDPEAR2",124,0)
 Q:$G(RCSTOP)
"RTN","RCDPEAR2",125,0)
 S RCPG=RCPG+1
"RTN","RCDPEAR2",126,0)
 S Z0="EFT UNMATCHED AGING REPORT"
"RTN","RCDPEAR2",127,0)
 S Z=$$SETSTR^VALM1($J("",80-$L(Z0)\2)_Z0,"",1,79)
"RTN","RCDPEAR2",128,0)
 S:'RCDISPTY Z=$$SETSTR^VALM1("Page: "_RCPG,Z,64,17)
"RTN","RCDPEAR2",129,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",130,0)
 S Z0="RUN DATE: "_RCRUNDT,Z0=$J("",80-$L(Z0)\2)_Z0
"RTN","RCDPEAR2",131,0)
 S Z=$$SETSTR^VALM1(Z0,"",1,79)
"RTN","RCDPEAR2",132,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",133,0)
 ; Payer(s)
"RTN","RCDPEAR2",134,0)
 S Z="PAYERS: "
"RTN","RCDPEAR2",135,0)
 I $D(RCPAY)=1 S Z=Z_RCPAY
"RTN","RCDPEAR2",136,0)
 I $D(RCPAY)=10 D
"RTN","RCDPEAR2",137,0)
 . S CNT=0
"RTN","RCDPEAR2",138,0)
 . F  S CNT=$O(RCPAY(CNT)) Q:'CNT  D
"RTN","RCDPEAR2",139,0)
 .. I Z="PAYERS: " S Z=Z_RCPAY(CNT) Q
"RTN","RCDPEAR2",140,0)
 .. S Z=Z_$S(Z]"":",",1:"")_RCPAY(CNT)
"RTN","RCDPEAR2",141,0)
 .. I $L(Z)>60 D
"RTN","RCDPEAR2",142,0)
 ... S Z=$J("",88-$L(Z)\2)_Z
"RTN","RCDPEAR2",143,0)
 ... D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",144,0)
 ... S Z=""
"RTN","RCDPEAR2",145,0)
 I Z]"" D
"RTN","RCDPEAR2",146,0)
 . S Z=$J("",88-$L(Z)\2)_Z
"RTN","RCDPEAR2",147,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",148,0)
 ; Date Range
"RTN","RCDPEAR2",149,0)
 S END=$P(RCRANGE,U,3)
"RTN","RCDPEAR2",150,0)
 S START=$P(RCRANGE,U,2)
"RTN","RCDPEAR2",151,0)
 S Z="DATE RANGE: "_$P($$FMTE^XLFDT(START,2),"@")_" - "_$P($$FMTE^XLFDT(END,2),"@")_" (DATE EFT FILED)",Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR2",152,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",153,0)
 Q:RCDISPTY
"RTN","RCDPEAR2",154,0)
 D SETLINE("AGED",.RCCT,RCPRT)
"RTN","RCDPEAR2",155,0)
 S Z=$$SETSTR^VALM1("DAYS"_$J("",2)_"TRACE #","",1,79)
"RTN","RCDPEAR2",156,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",157,0)
 S Z=$$SETSTR^VALM1($J("",10)_"DEPOSIT FROM/ID"_$J("",46)_"DEP DATE","",1,79)
"RTN","RCDPEAR2",158,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",159,0)
 S Z=$$SETSTR^VALM1($J("",6)_"FILE DATE"_$J("",5)_"DEPOSIT AMOUNT"_$J("",2)_"DEP #  "_$J("",2)_"DEPOSIT POST STATUS",Z,1,79)
"RTN","RCDPEAR2",160,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",161,0)
 D SETLINE($TR($J("",IOM-1)," ","="),.RCCT,RCPRT)
"RTN","RCDPEAR2",162,0)
 I RCPG=1 D
"RTN","RCDPEAR2",163,0)
 . S Z=$$SETSTR^VALM1("TOTALS:","",1,79)
"RTN","RCDPEAR2",164,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",165,0)
 . S Z=$$SETSTR^VALM1(" NUMBER AGED ELECTRONIC EFT MESSAGES FOUND: "_RCNT,"",1,79)
"RTN","RCDPEAR2",166,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",167,0)
 . S Z=$$SETSTR^VALM1(" AMOUNT AGED ELECTRONIC EFT MESSAGES FOUND: $"_$FN(+RCTOT,",",2),"",1,79)
"RTN","RCDPEAR2",168,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",169,0)
 . D SETLINE($TR($J("",IOM-1)," ","="),.RCCT,RCPRT)
"RTN","RCDPEAR2",170,0)
 Q
"RTN","RCDPEAR2",171,0)
 ;
"RTN","RCDPEAR2",172,0)
SETLINE(Z,RCCT,RCPRT) ; Sets line into print global or writes line
"RTN","RCDPEAR2",173,0)
 ; Z = txt to output
"RTN","RCDPEAR2",174,0)
 ; RCCT = line counter
"RTN","RCDPEAR2",175,0)
 ; RCPRT = flag if 1, indicates output to global, no writes 
"RTN","RCDPEAR2",176,0)
 S RCCT=RCCT+1
"RTN","RCDPEAR2",177,0)
 I RCPRT="" W !,Z Q
"RTN","RCDPEAR2",178,0)
 S ^TMP($J,RCPRT,RCCT)=Z
"RTN","RCDPEAR2",179,0)
 Q
"RTN","RCDPEAR2",180,0)
 ;
"RTN","RCDPEAR2",181,0)
ASK(RCSTOP) ; Ask to continue
"RTN","RCDPEAR2",182,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEAR2",183,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEAR2",184,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEAR2",185,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEAR2",186,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEAR2",187,0)
 Q
"RTN","RCDPEAR2",188,0)
 ;
"RTN","RCDPEAR2",189,0)
EXCEL ; Print report to screen, one record per line for export to MS Excel.
"RTN","RCDPEAR2",190,0)
 W !!,"Aged Days^Trace #^Deposit From/ID^File Date^Deposit Amount^Deposit #^Deposit Post Status^Deposit Date"
"RTN","RCDPEAR2",191,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCEFT_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCEFT_AGED",RCZ,RCZ0)) Q:'RCZ0  D  G:RCSTOP PRTQ2
"RTN","RCDPEAR2",192,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W:RCPRT="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR2",193,0)
 . S RC0=$G(^RCY(344.31,RCZ0,0)),RC00=$G(^RCY(344.3,+RC0,0))
"RTN","RCDPEAR2",194,0)
 . S Z=$J(-RCZ,4)_"^"_$P(RC0,U,4)_"^"_$P(RC0,U,2)_"/"_$P(RC0,U,3)_"^"_$S($P(RC0,U,13):$$FMTE^XLFDT($P(RC0,U,13),2),1:"")_"^"
"RTN","RCDPEAR2",195,0)
 . S Z=Z_$P(RC0,U,7)_"^"_$P(RC00,U,6)_"^"_$S($P(RC00,U,12):"",1:"NOT ")_"POSTED TO 8NZZ"_$S($P(RC00,U,12):"^"_$$FMTE^XLFDT($P(RC0,U,12),2),1:"")
"RTN","RCDPEAR2",196,0)
 . W !,Z
"RTN","RCDPEAR2",197,0)
 W !!,"*** END OF REPORT ***",!
"RTN","RCDPEAR2",198,0)
 ;
"RTN","RCDPEAR2",199,0)
PRTQ2 ;
"RTN","RCDPEAR2",200,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAR2",201,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAR2",202,0)
 K ^TMP($J,"RCEFT_AGED"),^TMP("RCSELPAY",$J),^TMP("RCPAYER",$J),^TMP($J,"RCERA_ADJ")
"RTN","RCDPEAR2",203,0)
 Q
"RTN","RCDPEDA1")
0^17^B22465629^B14062058
"RTN","RCDPEDA1",1,0)
RCDPEDA1 ;ALB/TMK/PJH - ACTIVITY REPORT HEADER ;04-NOV-02
"RTN","RCDPEDA1",2,0)
 ;;4.5;Accounts Receivable;**173,269,276**;Mar 20, 1995;Build 87
"RTN","RCDPEDA1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEDA1",4,0)
 Q
"RTN","RCDPEDA1",5,0)
 ;
"RTN","RCDPEDA1",6,0)
HDR(RCCT,RCPG,RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) ;Prints report heading
"RTN","RCDPEDA1",7,0)
 ; Function returns RCPG = current page # and RCCT = running line count
"RTN","RCDPEDA1",8,0)
 ;   and RCSTOP = 1 if user aborted print
"RTN","RCDPEDA1",9,0)
 ; Parameters RCCT,RCPG,RCSTOP must be passed by reference
"RTN","RCDPEDA1",10,0)
 ; RCDT1,RCDT2 = from,to date
"RTN","RCDPEDA1",11,0)
 ; RCDET = flag = 1 if detail is desired
"RTN","RCDPEDA1",12,0)
 N Z,Z0,Z1,X,Y
"RTN","RCDPEDA1",13,0)
 Q:RCNITE&(RCPG)
"RTN","RCDPEDA1",14,0)
 I RCPG!($E(IOST,1,2)="C-") D
"RTN","RCDPEDA1",15,0)
 . Q:$G(RCNITE)
"RTN","RCDPEDA1",16,0)
 . I RCPG&($E(IOST,1,2)="C-") D ASK(.RCSTOP) Q:RCSTOP
"RTN","RCDPEDA1",17,0)
 . W @IOF,*13 ; Write form feed
"RTN","RCDPEDA1",18,0)
 Q:RCSTOP
"RTN","RCDPEDA1",19,0)
 S RCPG=RCPG+1
"RTN","RCDPEDA1",20,0)
 I '$D(RCNP) N RCNP S RCNP=2  ; PRCA276 if coming from nightly job need to define payer selection variable
"RTN","RCDPEDA1",21,0)
 I '$D(VAUTD) N VAUTD S VAUTD=1  ; PRCA276 if coming from nightly job need to define division selection variable
"RTN","RCDPEDA1",22,0)
 S Z0="EDI LOCKBOX DAILY ACTIVITY "_$S($G(RCDET):"DETAIL",1:"SUMMARY")_" REPORT"
"RTN","RCDPEDA1",23,0)
 S Z=$$SETSTR^VALM1($J("",80-$L(Z0)\2)_Z0,"",1,79)
"RTN","RCDPEDA1",24,0)
 S Z=$$SETSTR^VALM1("Page: "_RCPG,Z,70,10)
"RTN","RCDPEDA1",25,0)
 D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",26,0)
 S Z="RUN DATE: "_$$FMTE^XLFDT($$NOW^XLFDT(),2),Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA1",27,0)
 D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",28,0)
 ;prca276 add divisions to header
"RTN","RCDPEDA1",29,0)
 S Z1="" I 'VAUTD S Z0=0 F  S Z0=$O(VAUTD(Z0)) Q:'Z0  S Z1=Z1_VAUTD(Z0)_", "
"RTN","RCDPEDA1",30,0)
 S Z="DIVISIONS: "_$S(VAUTD:"ALL",1:$E(Z1,1,$L(Z1)-2)),Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA1",31,0)
 D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",32,0)
 ; prca 276 add payer selection list to header
"RTN","RCDPEDA1",33,0)
 S Z1="" I RCNP'=2 S Z0=0 F  S Z0=$O(^TMP("RCSELPAY",$J,Z0)) Q:'Z0  S Z1=Z1_^TMP("RCSELPAY",$J,Z0)_", "
"RTN","RCDPEDA1",34,0)
 S Z="PAYERS: "_$S(RCNP=2:"ALL",1:$E(Z1,1,$L(Z1)-2)),Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA1",35,0)
 D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",36,0)
 ;prca 276  add date filter to header
"RTN","RCDPEDA1",37,0)
 S Z="DATE RANGE: "_$$FMTE^XLFDT(RCDT1,2)_" - "_$$FMTE^XLFDT(RCDT2,2)_" (Date Deposit Added)",Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA1",38,0)
 D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",39,0)
 D SETLINE^RCDPEDAR(RCNITE," ",.RCCT)
"RTN","RCDPEDA1",40,0)
 I $G(RCDET) D
"RTN","RCDPEDA1",41,0)
 . S Z=$$SETSTR^VALM1("DEP #   DEPOSIT DT  "_$J("",22)_"DEP AMOUNT          FMS DEPOSIT STAT","",1,80)
"RTN","RCDPEDA1",42,0)
 . D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",43,0)
 . D SETLINE^RCDPEDAR(RCNITE," ",.RCCT)
"RTN","RCDPEDA1",44,0)
 . S Z=$$SETSTR^VALM1($J("",3)_"EFT #"_$J("",23)_"DATE PD   PAYMENT AMOUNT     ERA MATCH STATUS","",1,80)
"RTN","RCDPEDA1",45,0)
 . D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",46,0)
 . S Z=$$SETSTR^VALM1($J("",10)_"EFT PAYER TRACE #","",1,30)
"RTN","RCDPEDA1",47,0)
 . D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",48,0)
 . S Z=$$SETSTR^VALM1($J("",14)_"PAYMENT FROM","",1,30)
"RTN","RCDPEDA1",49,0)
 . D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",50,0)
 . S Z=$$SETSTR^VALM1($J("",45)_"DEP RECEIPT #","",1,60)
"RTN","RCDPEDA1",51,0)
 . S Z=$$SETSTR^VALM1("DEP RECEIPT STATUS",Z,61,19)
"RTN","RCDPEDA1",52,0)
 . D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",53,0)
 D SETLINE^RCDPEDAR(RCNITE,$TR($J("",IOM-1)," ","="),.RCCT)
"RTN","RCDPEDA1",54,0)
 Q
"RTN","RCDPEDA1",55,0)
 ;
"RTN","RCDPEDA1",56,0)
ASK(RCSTOP) ; Ask to continue
"RTN","RCDPEDA1",57,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEDA1",58,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEDA1",59,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEDA1",60,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEDA1",61,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEDA1",62,0)
 Q
"RTN","RCDPEDA1",63,0)
 ;
"RTN","RCDPEDA1",64,0)
EFTDET(Z2,Z3,RCCT,RCPG,RCSTOP,RCDT1,RCDT2,RCDET,RCFMS1,RCNITE) ; Display EFT Detail
"RTN","RCDPEDA1",65,0)
 N DATA,X
"RTN","RCDPEDA1",66,0)
 S X=$$SETSTR^VALM1($P(Z3,U),"",4,6)
"RTN","RCDPEDA1",67,0)
 S X=$$SETSTR^VALM1($$FMTE^XLFDT($P(Z3,U,12)\1,2),X,32,8)
"RTN","RCDPEDA1",68,0)
 S X=$$SETSTR^VALM1($J($P(Z3,U,7),"",2),X,42,18)
"RTN","RCDPEDA1",69,0)
 S X=$$SETSTR^VALM1($$EXTERNAL^DILFD(344.31,.08,"",+$P(Z3,U,8))_$S($P(Z3,U,8)=1:"/ERA #"_$P(Z3,U,10),1:""),X,61,20)
"RTN","RCDPEDA1",70,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDA1",71,0)
 D SETLINE^RCDPEDAR(RCNITE,X,.RCCT)
"RTN","RCDPEDA1",72,0)
 S X=$$SETSTR^VALM1($P(Z3,U,4),"",11,61)
"RTN","RCDPEDA1",73,0)
 D SETLINE^RCDPEDAR(RCNITE,X,.RCCT)
"RTN","RCDPEDA1",74,0)
 S X=$$SETSTR^VALM1($P(Z3,U,2)_"/"_$P(Z3,U,3),"",15,65)
"RTN","RCDPEDA1",75,0)
 D SETLINE^RCDPEDAR(RCNITE,X,.RCCT)
"RTN","RCDPEDA1",76,0)
 S X=""
"RTN","RCDPEDA1",77,0)
 I $P(Z3,U,9) S X=$$SETSTR^VALM1($P($G(^RCY(344,+$P(Z3,U,9),0)),U),X,46,10)
"RTN","RCDPEDA1",78,0)
 S X=$$SETSTR^VALM1($G(RCFMS1(Z2)),X,61,19)
"RTN","RCDPEDA1",79,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDA1",80,0)
 D SETLINE^RCDPEDAR(RCNITE,X,.RCCT)
"RTN","RCDPEDA1",81,0)
 I $O(^RCY(344.31,Z2,2,0)) D  Q:RCSTOP
"RTN","RCDPEDA1",82,0)
 . N V
"RTN","RCDPEDA1",83,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDA1",84,0)
 . D SETLINE^RCDPEDAR(RCNITE,$J("",10)_"ERROR MESSAGES FOR EFT DETAIL:",.RCCT)
"RTN","RCDPEDA1",85,0)
 . S V=0 F  S V=$O(^RCY(344.31,Z2,2,V)) Q:'V  D  Q:RCSTOP
"RTN","RCDPEDA1",86,0)
 .. I '$G(RCNITE),($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDA1",87,0)
 .. D SETLINE^RCDPEDAR(RCNITE,$J("",12)_$G(^RCY(344.31,Z2,2,V,0)),.RCCT)
"RTN","RCDPEDA1",88,0)
 I $D(^RCY(344.31,Z2,3)) D
"RTN","RCDPEDA1",89,0)
 .S DATA=$G(^RCY(344.31,Z2,3))
"RTN","RCDPEDA1",90,0)
 .S X="   MARKED AS DUPLICATE: "_$$FMTE^XLFDT($P(DATA,U,2),5)_" "_$$EXTERNAL^DILFD(344.31,.17,,$P(DATA,U))
"RTN","RCDPEDA1",91,0)
 .D SETLINE^RCDPEDAR(RCNITE,X,.RCCT)
"RTN","RCDPEDA1",92,0)
 .D SETLINE^RCDPEDAR(RCNITE,"",.RCCT)
"RTN","RCDPEDA1",93,0)
 .Q
"RTN","RCDPEDA1",94,0)
 Q
"RTN","RCDPEDA1",95,0)
 ;
"RTN","RCDPEDA1",96,0)
 ; *** Begin PRCA*4.5*276 - RBN ***
"RTN","RCDPEDA1",97,0)
TEXT ; Filtered by messages
"RTN","RCDPEDA1",98,0)
 ;;No Filters Applied
"RTN","RCDPEDA1",99,0)
 ;;Station/Division
"RTN","RCDPEDA1",100,0)
 ;;
"RTN","RCDPEDA1",101,0)
 ;;Date Range
"RTN","RCDPEDA1",102,0)
 ;;Station/Division, Date Range
"RTN","RCDPEDA1",103,0)
 ;;Payer
"RTN","RCDPEDA1",104,0)
 ;;Station/Division, Payer
"RTN","RCDPEDA1",105,0)
 ;;
"RTN","RCDPEDA1",106,0)
 ;;Date Range, Payer
"RTN","RCDPEDA1",107,0)
 ;;Station/Division, Date Range, Payer
"RTN","RCDPEDA1",108,0)
 Q
"RTN","RCDPEDA1",109,0)
 ;
"RTN","RCDPEDA1",110,0)
 ; *** End PRCA*4.5*276 ***
"RTN","RCDPEDAR")
0^22^B105086845^B75522675
"RTN","RCDPEDAR",1,0)
RCDPEDAR ;ALB/TMK - ACTIVITY REPORT ;04-NOV-02
"RTN","RCDPEDAR",2,0)
 ;;4.5;Accounts Receivable;**173,276**;Mar 20, 1995;Build 87
"RTN","RCDPEDAR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEDAR",4,0)
 Q
"RTN","RCDPEDAR",5,0)
 ;
"RTN","RCDPEDAR",6,0)
RPT ; Daily Activity Rpt On Demand
"RTN","RCDPEDAR",7,0)
 N DUOUT,DTOUT,DIR,X,Y,RCDT1,RCDT2,RCDET,ZTRTN,ZTSK,ZTDESC,ZTSTOP,%ZIS,POP
"RTN","RCDPEDAR",8,0)
 N RCDIV,RCINC,VAUTD,RCRANGE,RCNP,RCJOB
"RTN","RCDPEDAR",9,0)
 ; Get division/station
"RTN","RCDPEDAR",10,0)
 D DIVISION^VAUTOMA
"RTN","RCDPEDAR",11,0)
 I 'VAUTD&($D(VAUTD)'=11) G RPTQ
"RTN","RCDPEDAR",12,0)
 S DIR("A")="(S)UMMARY OR (D)ETAIL?: ",DIR(0)="SA^S:SUMMARY TOTALS ONLY;D:DETAIL AND TOTALS"
"RTN","RCDPEDAR",13,0)
 S DIR("B")="D" D ^DIR K DIR
"RTN","RCDPEDAR",14,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") G RPTQ
"RTN","RCDPEDAR",15,0)
 S RCDET=(Y="D")
"RTN","RCDPEDAR",16,0)
 S DIR("?")="ENTER THE EARLIEST DATE OF RECEIPT OF DEPOSIT TO INCLUDE ON THE REPORT"
"RTN","RCDPEDAR",17,0)
 S DIR(0)="DAO^:"_DT_":APE",DIR("A")="START DATE: " D ^DIR K DIR
"RTN","RCDPEDAR",18,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") G RPTQ
"RTN","RCDPEDAR",19,0)
 S RCDT1=Y
"RTN","RCDPEDAR",20,0)
 S DIR("?")="ENTER THE LATEST DATE OF RECEIPT OF DEPOSIT TO INCLUDE ON THE REPORT"
"RTN","RCDPEDAR",21,0)
 S DIR("B")=Y(0)
"RTN","RCDPEDAR",22,0)
 S DIR(0)="DAO^"_RCDT1_":"_DT_":APE",DIR("A")="END DATE: " D ^DIR K DIR
"RTN","RCDPEDAR",23,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") G RPTQ
"RTN","RCDPEDAR",24,0)
 S RCDT2=Y
"RTN","RCDPEDAR",25,0)
 ;Get insurance company to be used as filter
"RTN","RCDPEDAR",26,0)
 S RCNP=$$GETPAY^RCDPEM9(344.31) I RCNP<0 G RPTQ
"RTN","RCDPEDAR",27,0)
 S RCJOB=$J
"RTN","RCDPEDAR",28,0)
 ; Ask device
"RTN","RCDPEDAR",29,0)
 S %ZIS="QM" D ^%ZIS G:POP RPTQ
"RTN","RCDPEDAR",30,0)
 I $D(IO("Q")) D  G RPTQ
"RTN","RCDPEDAR",31,0)
 . S ZTRTN="EN^RCDPEDAR("_RCDET_","_RCDT1_","_RCDT2_")",ZTDESC="AR - EDI LOCKBOX DAILY ACTIVITY REPORT"
"RTN","RCDPEDAR",32,0)
 . S ZTSAVE("*")=""
"RTN","RCDPEDAR",33,0)
 . D ^%ZTLOAD
"RTN","RCDPEDAR",34,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEDAR",35,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEDAR",36,0)
 U IO
"RTN","RCDPEDAR",37,0)
 D EN(RCDET,RCDT1,RCDT2)
"RTN","RCDPEDAR",38,0)
RPTQ Q
"RTN","RCDPEDAR",39,0)
 ;
"RTN","RCDPEDAR",40,0)
EN(RCDET,RCDT1,RCDT2) ; Entry point for queued job
"RTN","RCDPEDAR",41,0)
 ; RCDET = 1 to include detail, 0 for totals only
"RTN","RCDPEDAR",42,0)
 ; RCDT1,RCDT2 = date from,to
"RTN","RCDPEDAR",43,0)
 N Z,Z0,RC,RCT,DATA,RCSTOP,RCPG,RCIEN,STATION,RCFLG
"RTN","RCDPEDAR",44,0)
 K ^TMP("RCDAILYACT",$J)
"RTN","RCDPEDAR",45,0)
 S Z=RCDT1-.0001,(RCSTOP,RCT)=0
"RTN","RCDPEDAR",46,0)
 F  S Z=$O(^RCY(344.3,"ARECDT",Z)) Q:'Z!(Z>(RCDT2_".9999"))!RCSTOP  D
"RTN","RCDPEDAR",47,0)
 .S Z0=0 F  S Z0=$O(^RCY(344.3,"ARECDT",Z,Z0)) Q:'Z0!RCSTOP  D
"RTN","RCDPEDAR",48,0)
 ..S DATA=$G(^RCY(344.3,Z0,0)),RCFLG=0
"RTN","RCDPEDAR",49,0)
 ..S RCIEN="" F  S RCIEN=$O(^RCY(344.31,"B",Z0,RCIEN)) Q:RCIEN=""  D
"RTN","RCDPEDAR",50,0)
 ...; check payer
"RTN","RCDPEDAR",51,0)
 ...I '$$CHKPYR(RCIEN,0,RCJOB) Q
"RTN","RCDPEDAR",52,0)
 ...; check station/division
"RTN","RCDPEDAR",53,0)
 ...I '$$CHKDIV(RCIEN,0,.VAUTD) Q
"RTN","RCDPEDAR",54,0)
 ...S RCFLG=1,^TMP("RCDAILYACT",$J,Z\1,Z0,"EFT",RCIEN)=""
"RTN","RCDPEDAR",55,0)
 ...Q
"RTN","RCDPEDAR",56,0)
 ..I RCFLG S ^TMP("RCDAILYACT",$J,Z\1,Z0)=DATA
"RTN","RCDPEDAR",57,0)
 ..S RCT=RCT+1 I '(RCT#100),$D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ Q  ; Check for user stopped every 100 records
"RTN","RCDPEDAR",58,0)
 ..Q
"RTN","RCDPEDAR",59,0)
 .Q
"RTN","RCDPEDAR",60,0)
 D:'RCSTOP RPT1(0,RCDET,RCDT1,RCDT2,.RCSTOP,.RCPG)
"RTN","RCDPEDAR",61,0)
 D ENQ(RCSTOP,$G(RCPG))
"RTN","RCDPEDAR",62,0)
 Q
"RTN","RCDPEDAR",63,0)
 ;
"RTN","RCDPEDAR",64,0)
RPT1(RCNITE,RCDET,RCDT1,RCDT2,RCSTOP,RCPG) ; Entrypoint for nightly job
"RTN","RCDPEDAR",65,0)
 ; RCNITE = 1 if called from nightly job, 0 if called from on demand
"RTN","RCDPEDAR",66,0)
 ; RCDET = 1 to include detail, 0 for totals only
"RTN","RCDPEDAR",67,0)
 ; RCDT1,RCDT2 = date from,to
"RTN","RCDPEDAR",68,0)
 ; RCSTOP = returned = 1 if user elected to quit job
"RTN","RCDPEDAR",69,0)
 ; RCPG = the last page # printed, returned if passed by reference
"RTN","RCDPEDAR",70,0)
 ;
"RTN","RCDPEDAR",71,0)
 N X,Q,Q0,Z,Z0,Z1,Z2,Z3,ZCT,RCCT,RCDEP,RCDEPA,RCDEPAP,RCFMS,RCFMS1,RCD1,RCFMSTOT,RCEFT,RCMATCH,RCDEPREC,RCDT
"RTN","RCDPEDAR",72,0)
 N D,DIC,I,RCIEN,RCPAY
"RTN","RCDPEDAR",73,0)
 S (RCSTOP,RCPG,ZCT,RCCT,RCDEP,RCDEPA,RCDEPAP,RCDEPREC,Z)=0,RCD1=1
"RTN","RCDPEDAR",74,0)
 S RCNITE=+$G(RCNITE)
"RTN","RCDPEDAR",75,0)
 F  S Z=$O(^TMP("RCDAILYACT",$J,Z)) Q:'Z  D  G:RCSTOP RPT1Q ; Z = date
"RTN","RCDPEDAR",76,0)
 . I 'RCPG!$S('$G(RCNITE):($Y+5)>IOSL,1:0) D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) S RCDT=1 Q:RCSTOP
"RTN","RCDPEDAR",77,0)
 . S Q="DATE EFT DEPOSIT RECEIVED: "_$$FMTE^XLFDT(Z,2),Q=$J("",80-$L(Q)\2)_Q ; Center it
"RTN","RCDPEDAR",78,0)
 . I 'RCD1,$G(RCDET) D SETLINE(RCNITE,"",.RCCT) ; Skip line if >1 dt on pg
"RTN","RCDPEDAR",79,0)
 . S RCDT=0
"RTN","RCDPEDAR",80,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",81,0)
 . I $G(RCDET) D
"RTN","RCDPEDAR",82,0)
 .. D SETLINE(RCNITE,Q,.RCCT)
"RTN","RCDPEDAR",83,0)
 .. D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",84,0)
 . ; Z0 = ien of entry in file 344.3
"RTN","RCDPEDAR",85,0)
 . K RCEFT("D"),RCMATCH("D"),RCFMS("D")
"RTN","RCDPEDAR",86,0)
 . S Z0=0 F  S Z0=$O(^TMP("RCDAILYACT",$J,Z,Z0)) Q:'Z0  D  Q:RCSTOP
"RTN","RCDPEDAR",87,0)
 .. S Z1=$G(^TMP("RCDAILYACT",$J,Z,Z0))
"RTN","RCDPEDAR",88,0)
 .. S RCDEPREC=+$O(^RCY(344,"AD",+$P(Z1,U,3),0)),RCDEP(Z)=$G(RCDEP(Z))+1,RCDEPA(Z)=$G(RCDEPA(Z))+$P(Z1,U,8)
"RTN","RCDPEDAR",89,0)
 .. I $P($G(^RCY(344,RCDEPREC,2)),U)="" S RCFMS("D",-1)=$G(RCFMS("D",-1))+$P(Z1,U,8),RCFMS="NO FMS DOC"
"RTN","RCDPEDAR",90,0)
 .. I $P($G(^RCY(344,RCDEPREC,2)),U)'="" D
"RTN","RCDPEDAR",91,0)
 ... S X=$$STATUS^GECSSGET($P(^RCY(344,RCDEPREC,2),U))
"RTN","RCDPEDAR",92,0)
 ... I X=-1 S RCFMS("D",-1)=$G(RCFMS("D",-1))+$P(Z1,U,8) Q
"RTN","RCDPEDAR",93,0)
 ... S RCFMS=$E($P(X," "),1,10),Q=$E(X),Q=$S(Q="E"!(Q="R"):0,Q="Q":2,1:1),RCFMS("D",Q)=$G(RCFMS("D",Q))+$P(Z1,U,8)
"RTN","RCDPEDAR",94,0)
 ... ;
"RTN","RCDPEDAR",95,0)
 .. I $G(RCDET) D  Q:RCSTOP
"RTN","RCDPEDAR",96,0)
 ... S X=$$SETSTR^VALM1($P(Z1,U,6),"",1,6)
"RTN","RCDPEDAR",97,0)
 ... S X=$$SETSTR^VALM1($$FMTE^XLFDT($P(Z1,U,7)\1,2),X,9,10)
"RTN","RCDPEDAR",98,0)
 ... S X=$$SETSTR^VALM1("",X,21,10)
"RTN","RCDPEDAR",99,0)
 ... S X=$$SETSTR^VALM1("",X,32,10)
"RTN","RCDPEDAR",100,0)
 ... S X=$$SETSTR^VALM1($E($J($P(Z1,U,8),"",2)_$J("",20),1,20)_RCFMS,X,43,37)
"RTN","RCDPEDAR",101,0)
 ... I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",102,0)
 ... D SETLINE(RCNITE,X,.RCCT)
"RTN","RCDPEDAR",103,0)
 .. S RCFMSTOT=0,RCFMS1="NO FMS DOC"
"RTN","RCDPEDAR",104,0)
 .. I $O(^RCY(344.3,Z0,2,0)) D  Q:RCSTOP
"RTN","RCDPEDAR",105,0)
 ... N V
"RTN","RCDPEDAR",106,0)
 ... I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",107,0)
 ... D SETLINE(RCNITE,$J("",10)_"ERROR MESSAGES FOR EFT:",.RCCT)
"RTN","RCDPEDAR",108,0)
 ... S V=0 F  S V=$O(^RCY(344.3,Z0,2,V)) Q:'V  D  Q:RCSTOP
"RTN","RCDPEDAR",109,0)
 .... I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",110,0)
 .... D SETLINE(RCNITE,$J("",12)_$G(^RCY(344.3,Z0,2,V,0)),.RCCT)
"RTN","RCDPEDAR",111,0)
 .. S Z2=0 F  S Z2=$O(^TMP("RCDAILYACT",$J,Z,Z0,"EFT",Z2)) Q:'Z2  S Z3=$G(^RCY(344.31,Z2,0)) D  Q:RCSTOP
"RTN","RCDPEDAR",112,0)
 ... S RCEFT("D")=$G(RCEFT("D"))+1
"RTN","RCDPEDAR",113,0)
 ... S X=$S($P($G(^RCY(344,+$P(Z3,U,9),2)),U)'="":$$STATUS^GECSSGET($P(^RCY(344,+$P(Z3,U,9),2),U)),1:"")
"RTN","RCDPEDAR",114,0)
 ... I X'="",X'=-1,$E(X)'="R",$E(X)'="E" S RCFMSTOT=RCFMSTOT+$P(Z3,U,7),RCFMS1=$S($E(X)="Q":"QUEUED TO POST",1:"POSTED")
"RTN","RCDPEDAR",115,0)
 ... S RCFMS1(Z2)=$S(X="":"",X=-1:"NO FMS DOC",1:$E($P(X," "),1,10))
"RTN","RCDPEDAR",116,0)
 ... I $P(Z3,U,8) S RCMATCH("D")=$G(RCMATCH("D"))+1
"RTN","RCDPEDAR",117,0)
 ... I $G(RCDET) D EFTDET^RCDPEDA1(Z2,Z3,.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,.RCFMS1,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",118,0)
 .. ;
"RTN","RCDPEDAR",119,0)
 .. Q:RCSTOP
"RTN","RCDPEDAR",120,0)
 .. I RCDET D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",121,0)
 . ;
"RTN","RCDPEDAR",122,0)
 . Q:RCSTOP
"RTN","RCDPEDAR",123,0)
 . S RCDEPA=RCDEPA+$G(RCDEPA(Z)),RCDEP=RCDEP+$G(RCDEP(Z)),RCDEPAP=RCDEPAP+$G(RCDEPAP(Z)),RCFMSTOT("D")=$G(RCFMSTOT("D"))+$G(RCFMSTOT),RCEFT("T")=$G(RCEFT("T"))+$G(RCEFT("D")),RCMATCH("T")=$G(RCMATCH("T"))+$G(RCMATCH("D"))
"RTN","RCDPEDAR",124,0)
 . F Q=-1,0,1,2 S RCFMS("T",Q)=$G(RCFMS("T",Q))+$G(RCFMS("D",Q))
"RTN","RCDPEDAR",125,0)
 . D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",126,0)
 . I $S('$G(RCNITE):($Y+5)>IOSL,1:0)!'RCPG D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",127,0)
 . D SETLINE(RCNITE,$E("**TOTALS FOR DATE: "_$$FMTE^XLFDT(Z\1,2)_$J("",30),1,30)_"   # OF DEPOSIT TICKETS RECEIVED: "_+$G(RCDEP(Z))_$J("",5),.RCCT)
"RTN","RCDPEDAR",128,0)
 . D SETLINE(RCNITE,$J("",29)_"TOTAL AMOUNT OF DEPOSITS RECEIVED: $"_$J(+$G(RCDEPA(Z)),"",2),.RCCT)
"RTN","RCDPEDAR",129,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",130,0)
 . D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",131,0)
 . D SETLINE(RCNITE,$J("",20)_"DEPOSIT AMOUNTS SENT TO FMS:",.RCCT)
"RTN","RCDPEDAR",132,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",133,0)
 . D SETLINE(RCNITE,$J("",39)_"ACCEPTED: $"_$J(+$G(RCFMS("D",1)),"",2),.RCCT)
"RTN","RCDPEDAR",134,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",135,0)
 . D SETLINE(RCNITE,$J("",41)_"QUEUED: $"_$J(+$G(RCFMS("D",2)),"",2),.RCCT)
"RTN","RCDPEDAR",136,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",137,0)
 . D SETLINE(RCNITE,$J("",35)_"ERROR/REJECT: $"_$J(+$G(RCFMS("D",0)),"",2),.RCCT)
"RTN","RCDPEDAR",138,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",139,0)
 . D SETLINE(RCNITE,$J("",37)_"NOT IN FMS: $"_$J(+$G(RCFMS("D",-1)),"",2),.RCCT)
"RTN","RCDPEDAR",140,0)
 . D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",141,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",142,0)
 . D SETLINE(RCNITE,$J("",26)_"# EFT PAYMENT RECORDS: "_+$G(RCEFT("D")),.RCCT)
"RTN","RCDPEDAR",143,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",144,0)
 . D SETLINE(RCNITE,$J("",25)_"# EFT PAYMENTS MATCHED: "_+$G(RCMATCH("D")),.RCCT)
"RTN","RCDPEDAR",145,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",146,0)
 . D SETLINE(RCNITE,$J("",18)_"MATCHED PAYMENT AMOUNT POSTED: $"_$J(+$G(RCDEPAP(Z)),"",2),.RCCT)
"RTN","RCDPEDAR",147,0)
 . D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",148,0)
 I '$O(^TMP("RCDAILYACT",$J,0)) D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE)
"RTN","RCDPEDAR",149,0)
 G:RCSTOP!RCNITE RPT1Q
"RTN","RCDPEDAR",150,0)
 D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",151,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",152,0)
 D SETLINE(RCNITE,$E("**** TOTALS FOR DATE RANGE:"_$J("",30),1,30)_"   # OF DEPOSIT TICKETS RECEIVED: "_+$G(RCDEP)_$J("",5),.RCCT)
"RTN","RCDPEDAR",153,0)
 D SETLINE(RCNITE,$J("",29)_"TOTAL AMOUNT OF DEPOSITS RECEIVED: $"_$J(+$G(RCDEPA),"",2),.RCCT)
"RTN","RCDPEDAR",154,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",155,0)
 D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",156,0)
 D SETLINE(RCNITE,$J("",20)_"DEPOSIT AMOUNTS SENT TO FMS:",.RCCT)
"RTN","RCDPEDAR",157,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",158,0)
 D SETLINE(RCNITE,$J("",39)_"ACCEPTED: $"_+$G(RCFMS("T",1)),.RCCT)
"RTN","RCDPEDAR",159,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",160,0)
 D SETLINE(RCNITE,$J("",41)_"QUEUED: $"_+$G(RCFMS("T",2)),.RCCT)
"RTN","RCDPEDAR",161,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",162,0)
 D SETLINE(RCNITE,$J("",35)_"ERROR/REJECT: $"_+$G(RCFMS("T",0)),.RCCT)
"RTN","RCDPEDAR",163,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",164,0)
 D SETLINE(RCNITE,$J("",37)_"NOT IN FMS: $"_$J(+$G(RCFMS("T",-1)),"",2),.RCCT)
"RTN","RCDPEDAR",165,0)
 D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",166,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",167,0)
 D SETLINE(RCNITE,$J("",26)_"# EFT PAYMENT RECORDS: "_+$G(RCEFT("T")),.RCCT)
"RTN","RCDPEDAR",168,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",169,0)
 D SETLINE(RCNITE,$J("",25)_"# EFT PAYMENTS MATCHED: "_+$G(RCMATCH("T")),.RCCT)
"RTN","RCDPEDAR",170,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",171,0)
 D SETLINE(RCNITE,$J("",18)_"MATCHED PAYMENT AMOUNT POSTED: $"_$J(+$G(RCDEPAP),"",2),.RCCT)
"RTN","RCDPEDAR",172,0)
 D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",173,0)
 ;
"RTN","RCDPEDAR",174,0)
 W !,"******** END OF REPORT ********",!
"RTN","RCDPEDAR",175,0)
RPT1Q K ^TMP("RCDAILYACT",$J)
"RTN","RCDPEDAR",176,0)
 Q
"RTN","RCDPEDAR",177,0)
 ;
"RTN","RCDPEDAR",178,0)
ENQ(RCSTOP,RCPG) ; Clean up
"RTN","RCDPEDAR",179,0)
 I '$D(ZTQUEUED) D ^%ZISC I 'RCSTOP,RCPG D ASK^RCDPEDA1()
"RTN","RCDPEDAR",180,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEDAR",181,0)
 Q
"RTN","RCDPEDAR",182,0)
 ;
"RTN","RCDPEDAR",183,0)
SETLINE(RCNITE,Z,RCCT) ; Writes line
"RTN","RCDPEDAR",184,0)
 ; RCNITE = 1 to set array,  0 to write line
"RTN","RCDPEDAR",185,0)
 ; Z = txt to output
"RTN","RCDPEDAR",186,0)
 ; RCCT = line counter
"RTN","RCDPEDAR",187,0)
 S RCCT=RCCT+1
"RTN","RCDPEDAR",188,0)
 I $G(RCNITE) S ^TMP($J,"RCDPE_DAR",RCCT)=Z Q
"RTN","RCDPEDAR",189,0)
 W !,Z
"RTN","RCDPEDAR",190,0)
 Q
"RTN","RCDPEDAR",191,0)
 ;
"RTN","RCDPEDAR",192,0)
EFTDET(Z2,Z3,RCCT,RCPG,RCSTOP,RCDT1,RCDT2,RCDET,RCFMS1,RCNITE) ; Display EFT Detail
"RTN","RCDPEDAR",193,0)
 N X
"RTN","RCDPEDAR",194,0)
 I RCFLG W !,"^^^^^"
"RTN","RCDPEDAR",195,0)
 S RCFLG=1
"RTN","RCDPEDAR",196,0)
 W $P(Z3,U,1)_U
"RTN","RCDPEDAR",197,0)
 W $$FMTE^XLFDT($P(Z3,U,12)\1,2)_U
"RTN","RCDPEDAR",198,0)
 W $P(Z3,U,7)_U
"RTN","RCDPEDAR",199,0)
 W $$EXTERNAL^DILFD(344.31,.08,"",+$P(Z3,U,8))_$S($P(Z3,U,8)=1:":"_$P(Z3,U,10),1:"")_U
"RTN","RCDPEDAR",200,0)
 W $P(Z3,U,4)_U
"RTN","RCDPEDAR",201,0)
 W $P(Z3,U,2)_"/"_$P(Z3,U,3)_U
"RTN","RCDPEDAR",202,0)
 I $P(Z3,U,9) W $P($G(^RCY(344,+$P(Z3,U,9),0)),U)_U
"RTN","RCDPEDAR",203,0)
 I '$P(Z3,U,9) W U
"RTN","RCDPEDAR",204,0)
 W $G(RCFMS1(Z2))_U
"RTN","RCDPEDAR",205,0)
 I $O(^RCY(344.31,Z2,2,0)) D  W U Q:RCSTOP
"RTN","RCDPEDAR",206,0)
 . N V
"RTN","RCDPEDAR",207,0)
 . S V=0 F  S V=$O(^RCY(344.31,Z2,2,V)) Q:'V  D  Q:RCSTOP
"RTN","RCDPEDAR",208,0)
 .. W $G(^RCY(344.31,Z2,2,V,0))_";"
"RTN","RCDPEDAR",209,0)
 I $D(^RCY(344.31,Z2,3)) D WP^RCDPEM6($P(^RCY(344.31,Z2,3),U,3)) Q
"RTN","RCDPEDAR",210,0)
 W $P($G(^RCY(344.31,Z2,3)),U,3)
"RTN","RCDPEDAR",211,0)
 Q
"RTN","RCDPEDAR",212,0)
 ;
"RTN","RCDPEDAR",213,0)
CHKPYR(IEN,FLG,RCJOB) ;
"RTN","RCDPEDAR",214,0)
 ; IEN - ien in file 344.31 or 344.4
"RTN","RCDPEDAR",215,0)
 ; FLG - 0 if IEN contains ien in file 344.31, 1 if IEN contains ien in file 344.4
"RTN","RCDPEDAR",216,0)
 ; RCJOB - need to pass in the job number to access the previously populated temporary global array ^TMP("RCSELPAY",RCJOB) when rpt is queued to run
"RTN","RCDPEDAR",217,0)
 ; returns 1 if payer in 344.31/.02 or 344.4/.06 is in the list of selected payers ^TMP("RCSELPAY",RCJOB)
"RTN","RCDPEDAR",218,0)
 ; returns 0 otherwise
"RTN","RCDPEDAR",219,0)
 ;
"RTN","RCDPEDAR",220,0)
 N RCPAY,RES,Z
"RTN","RCDPEDAR",221,0)
 S RES=0
"RTN","RCDPEDAR",222,0)
 S:$G(RCJOB)="" RCJOB=$J
"RTN","RCDPEDAR",223,0)
 S RCPAY="" I IEN S RCPAY=$S(FLG:$P($G(^RCY(344.4,IEN,0)),U,6),1:$P($G(^RCY(344.31,IEN,0)),U,2))
"RTN","RCDPEDAR",224,0)
 I RCPAY'="" S (RCFLG,Z)=0 F  S Z=$O(^TMP("RCSELPAY",RCJOB,Z)) Q:Z=""  S:$E(RCPAY,1,30)=$G(^TMP("RCSELPAY",RCJOB,Z)) RES=1 I RES Q
"RTN","RCDPEDAR",225,0)
 Q RES
"RTN","RCDPEDAR",226,0)
 ;
"RTN","RCDPEDAR",227,0)
CHKDIV(IEN,FLG,VAUTD) ;
"RTN","RCDPEDAR",228,0)
 ; IEN - ien in file 344.31 or 344.4
"RTN","RCDPEDAR",229,0)
 ; FLG - 0 if IEN contains ien in file 344.31, 1 if IEN contains ien in file 344.4
"RTN","RCDPEDAR",230,0)
 ; VAUTD - array of selected divisions from DIVISION^VAUTOMA API call
"RTN","RCDPEDAR",231,0)
 ; returns 1 if division associated with an entry in 344.31 is on the list in VAUTD
"RTN","RCDPEDAR",232,0)
 ; returns 0 otherwise
"RTN","RCDPEDAR",233,0)
 N ERA,I,NAME,RCSTA,RES
"RTN","RCDPEDAR",234,0)
 S RES=0
"RTN","RCDPEDAR",235,0)
 I VAUTD=1 S RES=1 G CHKDIVX
"RTN","RCDPEDAR",236,0)
 I 'IEN G CHKDIVX
"RTN","RCDPEDAR",237,0)
 S ERA=$S(FLG:IEN,1:$P($G(^RCY(344.31,IEN,0)),U,10))
"RTN","RCDPEDAR",238,0)
 S RCSTA=$$ERASTA^RCDPEM3(ERA),NAME=$P(RCSTA,U)
"RTN","RCDPEDAR",239,0)
 I NAME="UNKNOWN" G CHKDIVX
"RTN","RCDPEDAR",240,0)
 S I=0 I 'VAUTD F  S I=$O(VAUTD(I)) Q:'I!RES  I NAME=VAUTD(I) S RES=1
"RTN","RCDPEDAR",241,0)
CHKDIVX ;
"RTN","RCDPEDAR",242,0)
 Q RES
"RTN","RCDPEM")
0^38^B59208170^B54192380
"RTN","RCDPEM",1,0)
RCDPEM ;ALB/TMK/PJH - POST EFT, ERA MATCHING TO EFT ;5/31/11 6:15pm
"RTN","RCDPEM",2,0)
 ;;4.5;Accounts Receivable;**173,255,269,276**;Mar 20, 1995;Build 87
"RTN","RCDPEM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEM",4,0)
 ; IA 4050 covers call to SPL1^IBCEOBAR
"RTN","RCDPEM",5,0)
 Q
"RTN","RCDPEM",6,0)
 ; Note - keep processing in line with RCDPXPAP 
"RTN","RCDPEM",7,0)
EN ; Post EFT deposits, auto-match EFT's and ERA's 
"RTN","RCDPEM",8,0)
 ;
"RTN","RCDPEM",9,0)
 K ^TMP($J,"RCDPETOT")
"RTN","RCDPEM",10,0)
 ; ^TMP($J,"RCDPETOT",344.3 or 344.31,file ien)=
"RTN","RCDPEM",11,0)
 ;  (1) match (0/1/-1)   (2) total $   (3) posted (0/1)  (4) error ref
"RTN","RCDPEM",12,0)
 ;  (5) EFT deposit ien 344.1 if added for EFT
"RTN","RCDPEM",13,0)
 ;
"RTN","RCDPEM",14,0)
 N RCZ,RCSUM,RCDEP,RECTDA,RC0,RCER,RCDUZ,Z,Z0,Z1,DA,X,Y,DIE,DR
"RTN","RCDPEM",15,0)
 M RCDUZ=DUZ
"RTN","RCDPEM",16,0)
 N DUZ S DUZ=+$O(^VA(200,"B","EDILOCKBOX,AUTOMATIC",0)),DUZ(0)="" S:'DUZ DUZ=.5
"RTN","RCDPEM",17,0)
 K ^TMP($J,"RCXM"),^TMP($J,"RCTOT")
"RTN","RCDPEM",18,0)
 S ZTREQ="@"
"RTN","RCDPEM",19,0)
 L +^RCY(344.3,"ALOCK"):5 I '$T D  G ENQ ; Lock record
"RTN","RCDPEM",20,0)
 . ; Send bulletin that job could not be run
"RTN","RCDPEM",21,0)
 . S ^TMP($J,"RCXM",1)="The nightly job to post EFT deposits and match EFTs to ERAs could not be run",^TMP($J,"RCXM",2)="Another match process was already running (lock on ^RCY(344.3,""ALOCK"") )"
"RTN","RCDPEM",22,0)
 . D SENDBULL^RCDPEM1
"RTN","RCDPEM",23,0)
 ;
"RTN","RCDPEM",24,0)
 ; Post deposits for any unposted EFTs in file 344.3
"RTN","RCDPEM",25,0)
 ; 'Unposted' EFTs have a 0 in AMOUNT POSTED field
"RTN","RCDPEM",26,0)
 S ^TMP($J,"RCTOT","EFT_DEP")=0
"RTN","RCDPEM",27,0)
 S RCZ=0 F  S RCZ=$O(^RCY(344.3,"APOST",0,RCZ)) Q:'RCZ  S RC0=$G(^RCY(344.3,RCZ,0))  I RC0'="",$P(RC0,U,8),($E($P(RC0,U,6),1,3)="469")!($E($P(RC0,U,6),1,3)="569") D
"RTN","RCDPEM",28,0)
 . S ^TMP($J,"RCTOT","EFT_DEP")=^TMP($J,"RCTOT","EFT_DEP")+1
"RTN","RCDPEM",29,0)
 . ; Verify check sums
"RTN","RCDPEM",30,0)
 . S RCSUM=$$CHKSUM^RCDPESR3(RCZ)
"RTN","RCDPEM",31,0)
 . I RCSUM'=$P(RC0,U,9) D  Q
"RTN","RCDPEM",32,0)
 .. ; Bulletin that check sums do not match
"RTN","RCDPEM",33,0)
 .. ; Update record error list and checksum error field
"RTN","RCDPEM",34,0)
 .. S RCER(1)=$$SETERR^RCDPEM0(2)
"RTN","RCDPEM",35,0)
 .. S RCER(2)="  Checksum is invalid and the EFT deposit record is corrupted.",RCER(3)="  Stored Checksum = "_$P(RC0,U,9)_" Calculated Checksum: "_RCSUM,RCER(4)="  This EFT deposit cannot be sent to FMS.  You must ask for it to be"
"RTN","RCDPEM",36,0)
 .. S RCER(5)="   retransmitted to your site."
"RTN","RCDPEM",37,0)
 .. D BULL^RCDPEM1(344.3,RC0,.RCER)
"RTN","RCDPEM",38,0)
 .. S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,4)=+$G(^TMP($J,"RCXM",0))
"RTN","RCDPEM",39,0)
 .. D STORERR^RCDPEM0(RCZ,.RCER)
"RTN","RCDPEM",40,0)
 .. S DIE="^RCY(344.3,",DA=RCZ,DR=".1////1" D ^DIE
"RTN","RCDPEM",41,0)
 .. S ^TMP($J,"RCTOT","CSUM")=$G(^TMP($J,"RCTOT","CSUM"))+1
"RTN","RCDPEM",42,0)
 . ;
"RTN","RCDPEM",43,0)
 . S RCDEP=+$P(RC0,U,3),RECTDA=+$O(^RCY(344,"AD",RCDEP,0))
"RTN","RCDPEM",44,0)
 . I RCDEP D LOCKDEP(RCDEP,1)
"RTN","RCDPEM",45,0)
 . I 'RCDEP!'RECTDA D  ;  Add deposit and/or receipt to files 344.1, 344
"RTN","RCDPEM",46,0)
 .. I 'RCDEP D  ; Add dep record RCDEP, update field .03 with the pointer
"RTN","RCDPEM",47,0)
 ... S RCDEP=+$$ADDDEP^RCDPEM0($P(RC0,U,6),$P(RC0,U,7),RCZ)
"RTN","RCDPEM",48,0)
 ... S ^TMP($J,"RCTOT","DEPOSIT")=$G(^TMP($J,"RCTOT","DEPOSIT"))+1
"RTN","RCDPEM",49,0)
 .. ;
"RTN","RCDPEM",50,0)
 .. I 'RECTDA,RCDEP D  ; Add receipt record, post to rev source cd 8NZZ
"RTN","RCDPEM",51,0)
 ... S RECTDA=+$$ADDREC^RCDPEM0(RCDEP,RCZ)
"RTN","RCDPEM",52,0)
 .. ;
"RTN","RCDPEM",53,0)
 . I RCDEP D LOCKDEP(RCDEP,0)
"RTN","RCDPEM",54,0)
 . ;
"RTN","RCDPEM",55,0)
 . I 'RCDEP!'RECTDA D  Q  ; Could not add entry to file 344.1 or 344 
"RTN","RCDPEM",56,0)
 .. ; Send a bulletin, update error text
"RTN","RCDPEM",57,0)
 .. S RCER(1)=$$SETERR^RCDPEM0(2),RCER(2)="  "_$S('RCDEP:"Neither a deposit nor a receipt were able",1:"A receipt was not able")_" to be added - no match attempted"
"RTN","RCDPEM",58,0)
 .. I RCDEP,'RECTDA S RCER(3)="  Deposit Ticket # created: "_$P($G(^RCY(344.1,+$P(RC0,U,3),0)),U)
"RTN","RCDPEM",59,0)
 .. S RCER($O(RCER(""),-1)+1)="This EFT deposit can't be sent to FMS.  You must ask Austin to retransmit"
"RTN","RCDPEM",60,0)
 .. D BULL^RCDPEM1(344.3,RC0,.RCER)
"RTN","RCDPEM",61,0)
 .. S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,4)=+$G(^TMP($J,"RCXM",0))
"RTN","RCDPEM",62,0)
 .. D STORERR^RCDPEM0(RCZ,.RCER)
"RTN","RCDPEM",63,0)
 .. S ^TMP($J,"RCTOT","ERR")=$G(^TMP($J,"RCTOT","ERR"))+1
"RTN","RCDPEM",64,0)
 . ;
"RTN","RCDPEM",65,0)
 . S DIE="^RCY(344.31," S Z=0 F  S Z=$O(^RCY(344.31,"B",RCZ,Z)) Q:'Z  S DA=Z,DR=".11////1" D ^DIE
"RTN","RCDPEM",66,0)
 ;
"RTN","RCDPEM",67,0)
 D MATCH(0,1)
"RTN","RCDPEM",68,0)
 L -^RCY(344.3,"ALOCK")
"RTN","RCDPEM",69,0)
ENQ K ^TMP($J,"RCDPETOT")
"RTN","RCDPEM",70,0)
 ;
"RTN","RCDPEM",71,0)
 ;ePayments 5010 part II enhancements
"RTN","RCDPEM",72,0)
 ;Create Bulletins of EEOB Moved or Copied today
"RTN","RCDPEM",73,0)
 D EN^RCDPEM8
"RTN","RCDPEM",74,0)
 Q
"RTN","RCDPEM",75,0)
 ;
"RTN","RCDPEM",76,0)
MATCH(RCMAN,RCPROC) ; Try to matched unmatched EFTs
"RTN","RCDPEM",77,0)
 ; RCMAN = 1 if job run manually, outside of nightly processing
"RTN","RCDPEM",78,0)
 ; RCPROC = 1 if called from EFT-EOB automatch, 0 if from manual match
"RTN","RCDPEM",79,0)
 ;
"RTN","RCDPEM",80,0)
 N RC0,RCER,RCZ,RCHAC
"RTN","RCDPEM",81,0)
 I '$O(^RCY(344.31,"AMATCH",0,0)) D  G MATCHQ
"RTN","RCDPEM",82,0)
 . ; Send bulletin - no unmatched EFTs found
"RTN","RCDPEM",83,0)
 . N RCT
"RTN","RCDPEM",84,0)
 . S RCT=+$O(^TMP($J,"RCXM"," "),-1)+1
"RTN","RCDPEM",85,0)
 . S ^TMP($J,"RCXM",RCT)=$S('$G(RCMAN):"The nightly job",1:"The manual option")_" to match EFTs has found no EFTs are currently unmatched on your system"
"RTN","RCDPEM",86,0)
 . I $G(RCMAN) S ^TMP($J,"RCXM",RCT+1)="The action was initiated by "_$P($G(^VA(200,DUZ,0)),U)
"RTN","RCDPEM",87,0)
 . D SENDBULL^RCDPEM1
"RTN","RCDPEM",88,0)
 ;
"RTN","RCDPEM",89,0)
 S RCZ=0 F  S RCZ=$O(^RCY(344.31,"AMATCH",0,RCZ)) Q:'RCZ  D
"RTN","RCDPEM",90,0)
 . K RCER
"RTN","RCDPEM",91,0)
 . S RC0=$G(^RCY(344.31,RCZ,0)),RCHAC=($E($P($G(^RCY(344.3,+RC0,0)),U,6),1,3)="HAC")
"RTN","RCDPEM",92,0)
 . Q:RC0=""  ; Bad xref
"RTN","RCDPEM",93,0)
 . Q:$S('RCHAC:'$P(RC0,U,11),1:0)  ; EFT deposit must have been recorded
"RTN","RCDPEM",94,0)
 . S ^TMP($J,"RCTOT","EFT")=$G(^TMP($J,"RCTOT","EFT"))+1
"RTN","RCDPEM",95,0)
 . I RCHAC S ^TMP($J,"RCTOT","EFT_HAC")=$G(^TMP($J,"RCTOT","EFT_HAC"))+1
"RTN","RCDPEM",96,0)
 . S ^TMP($J,"RCDPETOT",344.31,RCZ)=""
"RTN","RCDPEM",97,0)
 . ;
"RTN","RCDPEM",98,0)
 . D MATCH^RCDPEM0(RCZ,RCPROC)
"RTN","RCDPEM",99,0)
 ;
"RTN","RCDPEM",100,0)
 I '$O(^TMP($J,"RCXM",0)) K RCER S RCER(1)="",RCER(2)="NO EXCEPTIONS WHILE MATCHING EFTs-ERAs OR IN RECORDING THE DEPOSITS TO FMS" D BULL^RCDPEM1("","",.RCER) K RCER
"RTN","RCDPEM",101,0)
 D EN2^RCDPEM1,BULL^RCDPEM1("","",.RCER)
"RTN","RCDPEM",102,0)
 D SENDBULL^RCDPEM1
"RTN","RCDPEM",103,0)
 ;
"RTN","RCDPEM",104,0)
MATCHQ K ^TMP($J,"RCDPETOT"),^TMP($J,"RCTOT")
"RTN","RCDPEM",105,0)
 Q
"RTN","RCDPEM",106,0)
 ;
"RTN","RCDPEM",107,0)
LOCKDEP(RCDEP,LOCK) ; Lock/confirm deposit ien RCDEP file 341.1
"RTN","RCDPEM",108,0)
 ; If LOCK = 1 lock deposit
"RTN","RCDPEM",109,0)
 ; If LOCK = 0 unlock deposit
"RTN","RCDPEM",110,0)
 I $G(LOCK) D
"RTN","RCDPEM",111,0)
 . L +^RCY(344.1,RCDEP,0)
"RTN","RCDPEM",112,0)
 . D CONFIRM^RCDPUDEP(RCDEP) ; confirm to prevent changes
"RTN","RCDPEM",113,0)
 I '$G(LOCK) L -^RCY(344.1,RCDEP,0)
"RTN","RCDPEM",114,0)
 Q
"RTN","RCDPEM",115,0)
 ;
"RTN","RCDPEM",116,0)
RCPTDET(RCRZ,RECTDA1,RCER) ; Adds detail to a receipt based on file 344.49
"RTN","RCDPEM",117,0)
 ; RCRZ = ien of ERA entry in file 344.49
"RTN","RCDPEM",118,0)
 ; RECTDA1 = ien of receipt entry in file 344
"RTN","RCDPEM",119,0)
 ; RCER = error array returned if passed by reference
"RTN","RCDPEM",120,0)
 ;
"RTN","RCDPEM",121,0)
 N RCR,RCSPL,RCZ0,RCTRANDA,RCQ,DR,DA,DIE,X,Y,Q,Z0,Z1,Z
"RTN","RCDPEM",122,0)
 ;
"RTN","RCDPEM",123,0)
 S RCR=0 F  S RCR=$O(^RCY(344.49,RCRZ,1,RCR)) Q:'RCR  D
"RTN","RCDPEM",124,0)
 . S RCZ0=$G(^RCY(344.49,RCRZ,1,RCR,0))
"RTN","RCDPEM",125,0)
 . I $P(RCZ0,U)'["." S RCSPL(+RCZ0)=$P(RCZ0,U,9) Q
"RTN","RCDPEM",126,0)
 . I $S(+$P(RCZ0,U,3)=0:$P($G(^RCY(344.49,RCRZ,0)),U,3),1:$P(RCZ0,U,3)<0) S RCSPL(RCZ0\1,+RCZ0)=RCZ0 Q
"RTN","RCDPEM",127,0)
 . S RCTRANDA=$$ADDTRAN^RCDPURET(RECTDA1)
"RTN","RCDPEM",128,0)
 . ;
"RTN","RCDPEM",129,0)
 . I 'RCTRANDA D  Q  ; Error adding receipt detail
"RTN","RCDPEM",130,0)
 .. S RCER(1)=$$SETERR^RCDPEM0() S RCER($O(RCER(""),-1)+1)="  NO DETAIL LINE ADDED TO RECEIPT "_$P($G(^RCY(344,RECTDA1,0)),U)_" FOR LINE #"_$P(RCZ0,U)_" IN EEOB WORKLIST SCRATCH PAD"
"RTN","RCDPEM",131,0)
 . ;
"RTN","RCDPEM",132,0)
 . ;Store receipt line detail
"RTN","RCDPEM",133,0)
 . D DET(RCRZ,RCR,RECTDA1,RCTRANDA)
"RTN","RCDPEM",134,0)
 . S RCSPL(RCZ0\1,+RCZ0)=RCZ0
"RTN","RCDPEM",135,0)
 S Z=0 F  S Z=$O(RCSPL(Z)) Q:'Z  S RCQ=+$G(RCSPL(Z)) I RCQ D
"RTN","RCDPEM",136,0)
 .;;Move EEOB if one claim entered-changed 10/19/11-see +25^RCDPEWL8
"RTN","RCDPEM",137,0)
 . S Z1=$O(RCSPL(Z,"")) Q:Z1=""
"RTN","RCDPEM",138,0)
 . I $O(RCSPL(Z,""),-1)=Z1,'$$SPLIT(Z,Z1,RCERA) Q  ; No split occurred
"RTN","RCDPEM",139,0)
 . S Z1=0 F  S Z1=$O(RCSPL(Z,Z1)) Q:'Z1  S Z0=$G(RCSPL(Z,Z1)) D
"RTN","RCDPEM",140,0)
 .. S Q=+$P($G(^RCY(344.4,RCRZ,1,RCQ,0)),U,2) ; EOB detail rec
"RTN","RCDPEM",141,0)
 .. Q:'Q
"RTN","RCDPEM",142,0)
 .. I '$P(Z0,U,7)!($P(Z0,U,2)="") D  ; Suspensed
"RTN","RCDPEM",143,0)
 ... D SPL1^IBCEOBAR(Q,$S($P(Z0,U,2)="":"NO BILL",1:$P(Z0,U,2)),"",$P(Z0,U,6)) ; IA 4050
"RTN","RCDPEM",144,0)
 .. E  D
"RTN","RCDPEM",145,0)
 ... D SPL1^IBCEOBAR(Q,$P(Z0,U,2),$P(Z0,U,7),$P(Z0,U,6)) ; Add the split bill # ; IA 4050
"RTN","RCDPEM",146,0)
 ;
"RTN","RCDPEM",147,0)
 Q
"RTN","RCDPEM",148,0)
SPLIT(Z,Z1,RCERA) ;Check if worklist was split but to to single claim
"RTN","RCDPEM",149,0)
 N SUB,NBILL,OBILL
"RTN","RCDPEM",150,0)
 ;Find split line in scratchpad
"RTN","RCDPEM",151,0)
 S SUB=$O(^RCY(344.49,RCERA,1,"B",Z1,"")) Q:'SUB 0
"RTN","RCDPEM",152,0)
 ;Get original claim number from scratchpad
"RTN","RCDPEM",153,0)
 S OBILL=$P($G(^RCY(344.49,RCERA,1,SUB-1,0)),U,2)
"RTN","RCDPEM",154,0)
 ;New claim number
"RTN","RCDPEM",155,0)
 S NBILL=$P(RCSPL(Z,Z1),U,2)
"RTN","RCDPEM",156,0)
 ;If new and old claim are not the same this is a move via split
"RTN","RCDPEM",157,0)
 I OBILL'="",OBILL'=NBILL Q 1
"RTN","RCDPEM",158,0)
 ;Otherwise this is not a split
"RTN","RCDPEM",159,0)
 Q 0
"RTN","RCDPEM",160,0)
 ;
"RTN","RCDPEM",161,0)
DET(RCZ,RCR,RECTDA1,RCTRANDA) ; Store receipt detail
"RTN","RCDPEM",162,0)
 ; RCZ = ien of entry file 344.49
"RTN","RCDPEM",163,0)
 ; RCR = ien of entry in file 344.491
"RTN","RCDPEM",164,0)
 ; RCPROC = Function calling this subroutine
"RTN","RCDPEM",165,0)
 ;        = 1 EFT match to ERA   = 0 manual add receipt
"RTN","RCDPEM",166,0)
 ; RECTDA1 = ien of entry in file 344
"RTN","RCDPEM",167,0)
 ; RCTRANDA = ien of entry in subfile 344.01
"RTN","RCDPEM",168,0)
 ;
"RTN","RCDPEM",169,0)
 N DIE,DA,DR,X,Y,Z,RCUP,RCCOM,RCZ0,RC0
"RTN","RCDPEM",170,0)
 S RC0=$G(^RCY(344.49,RCZ,0))
"RTN","RCDPEM",171,0)
 S RCZ0=$G(^RCY(344.49,RCZ,1,RCR,0))
"RTN","RCDPEM",172,0)
 S DR="",RCUP=+$O(^RCY(344.49,RCZ,1,"B",+RCZ0/1,0)),RCUP=$G(^RCY(344.49,RCZ,1,RCUP,0))
"RTN","RCDPEM",173,0)
 I $P(RCZ0,U,7) S DR=".09////^S X="_+$P(RCZ0,U,7)_"_$C(59)_""PRCA(430,"";"
"RTN","RCDPEM",174,0)
 S DR=DR_".04////"_(+$P(RCZ0,U,3))_";.27////"_RCR_";"
"RTN","RCDPEM",175,0)
 I $P(RC0,U,5)'="" S DR=DR_".1////"_$P(RC0,U,5)_";"
"RTN","RCDPEM",176,0)
 I $P(RC0,U,6)'="" S DR=DR_".08////"_$P(RC0,U,6)_";"
"RTN","RCDPEM",177,0)
 S RCCOM=$P(RCZ0,U,10)
"RTN","RCDPEM",178,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCZ,1,RCR,1,Z)) Q:'Z  I $P($G(^(Z,0)),U,5)=1 S DR=DR_".28////1;" Q  ; Update receipt line with dec adj flag
"RTN","RCDPEM",179,0)
 I $P(RCUP,U,2)["**ADJ" S DR=DR_"1.02////"_$E($S(RCCOM'="":RCCOM_"/",1:"")_$S($P($P(RCUP,U,2),"ADJ",2):"ERA adjustment - no bill referenced",1:"Total of EFT mismatched to ERA"),1,60)_";"
"RTN","RCDPEM",180,0)
 I $P($G(^RCY(344.49,RCZ,0)),U,4)'="" S DR=DR_".07////"_$P($G(^RCY(344.49,RCZ,0)),U,4)_";"
"RTN","RCDPEM",181,0)
 S DA(1)=RECTDA1,DA=RCTRANDA,DIE="^RCY(344,"_DA(1)_",1,"
"RTN","RCDPEM",182,0)
 D ^DIE
"RTN","RCDPEM",183,0)
 Q
"RTN","RCDPEM",184,0)
 ;
"RTN","RCDPEM2")
0^39^B171488766^B62281734
"RTN","RCDPEM2",1,0)
RCDPEM2 ;ALB/TMK/PJH - MANUAL ERA AND EFT MATCHING ;05-NOV-02
"RTN","RCDPEM2",2,0)
 ;;4.5;Accounts Receivable;**173,208,276**;Mar 20, 1995;Build 87
"RTN","RCDPEM2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM2",4,0)
 Q
"RTN","RCDPEM2",5,0)
MATCH1 ; Manually 'match' an ERA to an EFT
"RTN","RCDPEM2",6,0)
 N DA,DR,DIE,DIC,DIR,X,Y,RCEFT,RCERA,RCNAME,RCMATCH,RCQUIT,DUOUT,DTOUT
"RTN","RCDPEM2",7,0)
 W !,"THIS OPTION WILL ALLOW YOU TO MANUALLY MATCH AN EFT DETAIL RECORD",!,"WITH AN ERA RECORD"
"RTN","RCDPEM2",8,0)
M1 S DIR("A")="SELECT THE UNMATCHED EFT TO MATCH TO AN ERA: "
"RTN","RCDPEM2",9,0)
 S DIR(0)="PAO^RCY(344.31,:AEMQ",DIR("S")="I '$P(^(0),U,8)"
"RTN","RCDPEM2",10,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",11,0)
 I $D(DUOUT)!$D(DTOUT)!(Y<0) G M1Q
"RTN","RCDPEM2",12,0)
 S RCEFT=+Y,RCEFT(0)=$G(^RCY(344.31,+Y,0))
"RTN","RCDPEM2",13,0)
 W !
"RTN","RCDPEM2",14,0)
 S DIC="^RCY(344.31,",DR="0",DA=RCEFT D EN^DIQ
"RTN","RCDPEM2",15,0)
 W !
"RTN","RCDPEM2",16,0)
 S DIR("A")="ARE YOU SURE THIS IS THE EFT YOU WANT TO MATCH?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",17,0)
 I $D(DUOUT)!$D(DTOUT) G M1Q
"RTN","RCDPEM2",18,0)
 I Y'=1 G M1
"RTN","RCDPEM2",19,0)
M12 S DIR("A")="SELECT THE UNMATCHED ERA TO MATCH TO EFT #"_RCEFT_": "
"RTN","RCDPEM2",20,0)
 S DIR(0)="PAO^RCY(344.4,:AEMQ",DIR("S")="I '$P(^(0),U,9),'$P(^(0),U,8)"
"RTN","RCDPEM2",21,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",22,0)
 I $D(DUOUT)!$D(DTOUT)!(Y<0) G M1Q
"RTN","RCDPEM2",23,0)
 S RCERA=+Y,RCERA(0)=$G(^RCY(344.4,+Y,0))
"RTN","RCDPEM2",24,0)
 W !
"RTN","RCDPEM2",25,0)
 S DIC="^RCY(344.4,",DR="0",DA=RCERA D EN^DIQ
"RTN","RCDPEM2",26,0)
 W !
"RTN","RCDPEM2",27,0)
 S DIR("A")="ARE YOU SURE THIS IS THE CORRECT ERA TO MATCH TO?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",28,0)
 I $D(DUOUT)!$D(DTOUT) G M1Q
"RTN","RCDPEM2",29,0)
 I Y'=1 G M12
"RTN","RCDPEM2",30,0)
 S RCMATCH=(+$P(RCERA(0),U,5)=+$P(RCEFT(0),U,7))
"RTN","RCDPEM2",31,0)
 S RCNAME=($P(RCERA(0),U,6)=$P(RCEFT(0),U,2))
"RTN","RCDPEM2",32,0)
 I 'RCMATCH!'RCNAME D  G:RCQUIT M1Q
"RTN","RCDPEM2",33,0)
 . N Z
"RTN","RCDPEM2",34,0)
 . S RCQUIT=0,Z=1
"RTN","RCDPEM2",35,0)
 . S DIR("A",1)="***WARNING***"
"RTN","RCDPEM2",36,0)
 . I 'RCNAME S Z=Z+1,DIR("A",Z)=$J("",3)_"> The payer names on these two records do not agree"
"RTN","RCDPEM2",37,0)
 . I 'RCMATCH S Z=Z+1,DIR("A",Z)=$J("",3)_"> The amount of payment on these two records do not agree"
"RTN","RCDPEM2",38,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("A")="ARE YOU SURE YOU WANT TO MATCH THESE 2 RECORDS?: " W ! D ^DIR K DIR
"RTN","RCDPEM2",39,0)
 . I $S($D(DUOUT)!$D(DTOUT):1,Y'=1:1,1:0) S RCQUIT=1 Q
"RTN","RCDPEM2",40,0)
 S DIE="^RCY(344.4,",DR=".09////1",DA=RCERA D ^DIE
"RTN","RCDPEM2",41,0)
 I '$D(Y) S DIE="^RCY(344.31,",DR=".08////1;.1////"_RCERA,DA=RCEFT D ^DIE
"RTN","RCDPEM2",42,0)
 S DIR(0)="EA",DIR("A",1)="EFT #"_RCEFT_" WAS "_$S('$D(Y):"SUCCESSFULLY",1:"NOT")_" MATCHED TO ERA #"_RCERA,DIR("A")="PRESS RETURN TO CONTINUE: " D ^DIR K DIR
"RTN","RCDPEM2",43,0)
M1Q Q
"RTN","RCDPEM2",44,0)
 ;
"RTN","RCDPEM2",45,0)
MATCH2 ; Manually 'match' a 0-balance EFT to a paper EOB
"RTN","RCDPEM2",46,0)
 N DUOUT,DTOUT,DA,DR,DIE,DIC,DIR,X,Y,RCEFT,RCRCPT
"RTN","RCDPEM2",47,0)
 W !,"THIS OPTION WILL ALLOW YOU TO MANUALLY MARK A 0-BALANCE EFT DETAIL RECORD",!,"AS MATCHED TO A PAPER EOB"
"RTN","RCDPEM2",48,0)
M2 S DIR("A")="SELECT THE UNMATCHED 0-BALANCE EFT TO MARK AS MATCHED TO PAPER EOB: "
"RTN","RCDPEM2",49,0)
 S DIR(0)="PAO^RCY(344.31,:AEMQ",DIR("S")="I '$P(^(0),U,8),'$P(^(0),U,7)"
"RTN","RCDPEM2",50,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",51,0)
 I $D(DUOUT)!$D(DTOUT)!(Y'>0) G M2Q
"RTN","RCDPEM2",52,0)
 S RCEFT=+Y
"RTN","RCDPEM2",53,0)
 W !
"RTN","RCDPEM2",54,0)
 S DIC="^RCY(344.31,",DR="0",DA=RCEFT D EN^DIQ
"RTN","RCDPEM2",55,0)
 W !
"RTN","RCDPEM2",56,0)
 S DIR("A")="ARE YOU SURE THIS IS THE EFT YOU WANT TO MARK AS MATCHED?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",57,0)
 I $D(DUOUT)!$D(DTOUT) G M2Q
"RTN","RCDPEM2",58,0)
 I Y'=1 G M2
"RTN","RCDPEM2",59,0)
 S DIE="^RCY(344.31,",DR=".08////2",DA=RCEFT D ^DIE
"RTN","RCDPEM2",60,0)
 S DIR(0)="EA",DIR("A")="EFT #"_RCEFT_" WAS "_$S('$D(Y):"SUCCESSFULLY",1:"NOT")_" MARKED AS MATCHED TO PAPER EOB" D ^DIR K DIR
"RTN","RCDPEM2",61,0)
M2Q Q
"RTN","RCDPEM2",62,0)
 ;
"RTN","RCDPEM2",63,0)
MANTR ; Mark an EFT detail record as 'TR' posted manually
"RTN","RCDPEM2",64,0)
 N DA,DR,DIC,DIE,DIR,X,Y,RCEFT,DUOUT,DTOUT,RCZ0,RCTR,RCHOW
"RTN","RCDPEM2",65,0)
 ; EFT detail cannot be associated with a receipt or TR document
"RTN","RCDPEM2",66,0)
 ;
"RTN","RCDPEM2",67,0)
 W !,"*****",!," YOU SHOULD ONLY USE THIS OPTION IF YOU HAVE AN EFT DETAIL RECORD ON YOUR",!," UNAPPLIED DEPOSIT REPORT WHOSE DETAIL WAS ENTERED ON LINE VIA A TR DOCUMENT",!,"*****",!
"RTN","RCDPEM2",68,0)
 S DIC(0)="AEMQ",DIC("S")="I $P(^(0),U,16)="""",$P(^(0),U,11)",DIC("A")="SELECT THE EFT DETAIL WHOSE 'TR' DOC WAS MANUALLY ENTERED ON LINE: ",DIC="^RCY(344.31,"
"RTN","RCDPEM2",69,0)
 W ! D ^DIC K DIC
"RTN","RCDPEM2",70,0)
 I Y'>0 G MANTRQ
"RTN","RCDPEM2",71,0)
 S RCEFT=+Y,RCZ0=$G(^RCY(344.31,RCEFT,0))
"RTN","RCDPEM2",72,0)
 S DIR(0)="FA^2:30^K:X'?1""TR"".E X",DIR("A")="ENTER THE TR DOC # THAT WAS ENTERED ON-LINE FOR THE EFT DETAIL: "
"RTN","RCDPEM2",73,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",74,0)
 I $D(DTOUT)!$D(DUOUT) G MANTRQ
"RTN","RCDPEM2",75,0)
 S RCTR=Y,DR=""
"RTN","RCDPEM2",76,0)
 ;
"RTN","RCDPEM2",77,0)
 I '$P(RCZ0,U,8) D  G:RCQUIT MANTRQ  ;Unmatched
"RTN","RCDPEM2",78,0)
 . S DIR(0)="SA^E:ELECTRONIC ERA;P:PAPER EOB",DIR("A")="WAS THE EFT DETAIL RECEIVED BY (E)RA or (P)APER EOB?: " W ! D ^DIR K DIR
"RTN","RCDPEM2",79,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEM2",80,0)
 . S RCHOW=Y,DR=""
"RTN","RCDPEM2",81,0)
 . I RCHOW="E" D
"RTN","RCDPEM2",82,0)
 .. S DR=";.09R;.08////1"
"RTN","RCDPEM2",83,0)
 . I RCHOW="P" D
"RTN","RCDPEM2",84,0)
 .. S DR=";.08////2"
"RTN","RCDPEM2",85,0)
 ;
"RTN","RCDPEM2",86,0)
 S DIR(0)="YA",DIR("B")="NO",DIR("A",1)="THIS WILL MARK EFT DETAIL #: "_RCEFT_" AS MANUALLY POSTED",DIR("A",2)="  USING TR DOC: "_RCTR
"RTN","RCDPEM2",87,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: " W ! D ^DIR K DIR
"RTN","RCDPEM2",88,0)
 I Y'=1 D  G MANTRQ
"RTN","RCDPEM2",89,0)
 . S DIR(0)="EA",DIR("A")="EFT NOT UPDATED - PRESS RETURN TO CONTINUE: " W ! D ^DIR K DIR
"RTN","RCDPEM2",90,0)
 S DIE="^RCY(344.31,",DA=RCEFT,DR=".16R"_DR D ^DIE
"RTN","RCDPEM2",91,0)
 I $D(Y) D
"RTN","RCDPEM2",92,0)
 . S DIE="^RCY(344.31,",DA=RCEFT,DR=".16///@;.08///"_$S($P(RCZ0,U,8)'="":$P(RCZ0,U,8),1:"@") D ^DIE
"RTN","RCDPEM2",93,0)
 . S DIR("A")="EFT NOT UPDATED - PRESS RETURN TO CONTINUE"
"RTN","RCDPEM2",94,0)
 E  D
"RTN","RCDPEM2",95,0)
 . S DIR("A")="STATUS UPDATED FOR EFT DETAIL #: "_RCEFT_" - PRESS RETURN TO CONTINUE: "
"RTN","RCDPEM2",96,0)
 S DIR(0)="EA"
"RTN","RCDPEM2",97,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",98,0)
 ;
"RTN","RCDPEM2",99,0)
MANTRQ Q
"RTN","RCDPEM2",100,0)
 ;
"RTN","RCDPEM2",101,0)
CHK() ; Function returns the ien of CHECK/MO payment type
"RTN","RCDPEM2",102,0)
 Q +$O(^RC(341.1,"AC",4,0))
"RTN","RCDPEM2",103,0)
 ;
"RTN","RCDPEM2",104,0)
 ;; Begin PRCA*4.5*276 - PJH
"RTN","RCDPEM2",105,0)
POSTED ;
"RTN","RCDPEM2",106,0)
 N DIR,X,Y
"RTN","RCDPEM2",107,0)
 S DIR("A")="Select type of receipt to ERA link"
"RTN","RCDPEM2",108,0)
 S DIR("B")="M"
"RTN","RCDPEM2",109,0)
 S DIR(0)="S^M:Manually select receipt to post;"
"RTN","RCDPEM2",110,0)
 S DIR(0)=DIR(0)_"A:Automatic search for receipt to post"
"RTN","RCDPEM2",111,0)
 D ^DIR K DIR
"RTN","RCDPEM2",112,0)
 I Y="M" D MANUAL Q
"RTN","RCDPEM2",113,0)
 I Y="A" D AUTO
"RTN","RCDPEM2",114,0)
 Q
"RTN","RCDPEM2",115,0)
 ;
"RTN","RCDPEM2",116,0)
MANUAL ; Mark an ERA as posted when the data was previously posted using
"RTN","RCDPEM2",117,0)
 ; paper EOB information
"RTN","RCDPEM2",118,0)
 N DIC,DIE,DIR,DA,DR,ERA,RCPT,X,Y,%
"RTN","RCDPEM2",119,0)
 ; Must be unmatched or matched to paper check, must be accepted by FMS, must not be posted yet
"RTN","RCDPEM2",120,0)
 W !!,"THIS OPTION IS USED WHEN YOU HAVE POSTED AN ERA PAID WITH A PAPER CHECK",!,"BY USING THE PAPER EOB AND YOU DID NOT REFERENCE THE ERA IN THE RECEIPT",!!
"RTN","RCDPEM2",121,0)
MAN1 S DIC("S")="I ""02""[+$P(^(0),U,9),$P(^(0),U,14)=0",DIC="^RCY(344.4,",DIC(0)="AEMQ"
"RTN","RCDPEM2",122,0)
 D ^DIC K DIC
"RTN","RCDPEM2",123,0)
 ;
"RTN","RCDPEM2",124,0)
 I Y'>0 G MANUALQ
"RTN","RCDPEM2",125,0)
 ;
"RTN","RCDPEM2",126,0)
 ;Check if ERA is already linked to a receipt
"RTN","RCDPEM2",127,0)
 I $$RCHECK(+Y) G MAN1
"RTN","RCDPEM2",128,0)
 S ERA=+Y
"RTN","RCDPEM2",129,0)
 ;
"RTN","RCDPEM2",130,0)
 S DIC="^RCY(344,",DIC(0)="AEMQ",DIC("A")="RECEIPT: ",DIC("S")="I $$FMS^RCDPEM2(Y,0)"
"RTN","RCDPEM2",131,0)
 D ^DIC K DIC
"RTN","RCDPEM2",132,0)
 I Y'>0 G MANUALQ
"RTN","RCDPEM2",133,0)
 S RCPT=+Y
"RTN","RCDPEM2",134,0)
 ;
"RTN","RCDPEM2",135,0)
 D NOW^%DTC
"RTN","RCDPEM2",136,0)
 ;Update Receipt #, EFT Match Status, Detail Post Status and Paper EOB
"RTN","RCDPEM2",137,0)
 S DIE="^RCY(344.4,",DR=".08////"_RCPT_";.09////2;.14////2;20.03////1",DA=ERA
"RTN","RCDPEM2",138,0)
 ;Update Date/Time Posted and User fields
"RTN","RCDPEM2",139,0)
 S DR=DR_";7.01///"_%_";7.02///"_DUZ
"RTN","RCDPEM2",140,0)
 D ^DIE
"RTN","RCDPEM2",141,0)
 I '$D(Y) D
"RTN","RCDPEM2",142,0)
 . S DIR(0)="EA",DIR("A",1)="ERA HAS BEEN MARKED AS POSTED USING PAPER EOB",DIR("A")="PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEM2",143,0)
 ;
"RTN","RCDPEM2",144,0)
MANUALQ Q
"RTN","RCDPEM2",145,0)
 ;
"RTN","RCDPEM2",146,0)
 ;VISN 15 software - created by Karen Flores
"RTN","RCDPEM2",147,0)
 ;
"RTN","RCDPEM2",148,0)
AUTO ;Select ERA's for linking to receipt
"RTN","RCDPEM2",149,0)
 N EXIT
"RTN","RCDPEM2",150,0)
 S EXIT=0 F  D LNKERA Q:EXIT
"RTN","RCDPEM2",151,0)
 Q
"RTN","RCDPEM2",152,0)
 ;
"RTN","RCDPEM2",153,0)
RCHECK(RCSCR) ;Check if already linked to a receipt
"RTN","RCDPEM2",154,0)
 N REC,RNUM,RNAM,AMT
"RTN","RCDPEM2",155,0)
 S REC=$G(^RCY(344.4,RCSCR,0)),RNUM=$P(REC,U,8)
"RTN","RCDPEM2",156,0)
 ;Ignore check if zero amount ERA
"RTN","RCDPEM2",157,0)
 Q:'$P(REC,U,5) 0
"RTN","RCDPEM2",158,0)
 ;Check if already linked to a different receipt
"RTN","RCDPEM2",159,0)
 Q:'RNUM 0
"RTN","RCDPEM2",160,0)
 S RNAM=$P($G(^RCY(344,RNUM,0)),U)
"RTN","RCDPEM2",161,0)
 W !!,"ERA ",RCSCR," is already linked to receipt ",RNAM,!
"RTN","RCDPEM2",162,0)
 Q 1
"RTN","RCDPEM2",163,0)
 ;
"RTN","RCDPEM2",164,0)
LNKERA ;Select ERA
"RTN","RCDPEM2",165,0)
 N ABORT,DIC,DUOUT,DTOUT,REC,RCSCR,X,Y
"RTN","RCDPEM2",166,0)
 ;Must be unposted and either unmatched or matched to paper check
"RTN","RCDPEM2",167,0)
 S DIC("S")="I ""02""[+$P(^(0),U,9),$P(^(0),U,14)=0"
"RTN","RCDPEM2",168,0)
 S DIC="^RCY(344.4,",DIC(0)="AEMQ" W ! D ^DIC K DIC
"RTN","RCDPEM2",169,0)
 S RCSCR=+Y I RCSCR'>0 S EXIT=1 Q
"RTN","RCDPEM2",170,0)
 ;Check if already linked to a different receipt
"RTN","RCDPEM2",171,0)
 Q:$$RCHECK(RCSCR)
"RTN","RCDPEM2",172,0)
 ;
"RTN","RCDPEM2",173,0)
 ;Finds receipt automatically from AR TRANSACTION file #433 
"RTN","RCDPEM2",174,0)
 N AMT,ART,ARTND1,ATTY,BILL,EOB,EOBND,FOUND,RCND,RCSCR1,RECEPT,TAMT
"RTN","RCDPEM2",175,0)
 N TRACE
"RTN","RCDPEM2",176,0)
 ;Trace# from ERA
"RTN","RCDPEM2",177,0)
 S TRACE=$P($G(^RCY(344.4,RCSCR,0)),U,2)
"RTN","RCDPEM2",178,0)
 ;Clear workfile
"RTN","RCDPEM2",179,0)
 K ^TMP("RCDPEM2",$J)
"RTN","RCDPEM2",180,0)
 ;
"RTN","RCDPEM2",181,0)
 S (FOUND,ABORT,RCSCR1)=0
"RTN","RCDPEM2",182,0)
 ;Scan claim lines in ERA for non zero bills
"RTN","RCDPEM2",183,0)
 F  S RCSCR1=$O(^RCY(344.4,RCSCR,1,RCSCR1)) Q:+RCSCR1=0!(FOUND)  D
"RTN","RCDPEM2",184,0)
 .S RCND=$G(^RCY(344.4,RCSCR,1,RCSCR1,0))
"RTN","RCDPEM2",185,0)
 .;Ignore bill if AMOUNT PAID is zero
"RTN","RCDPEM2",186,0)
 .S AMT=$P(RCND,"^",3) Q:+AMT=0
"RTN","RCDPEM2",187,0)
 .;Ignore if EOB has no EOB detail record
"RTN","RCDPEM2",188,0)
 .S EOB=+$P(RCND,"^",2) Q:'EOB
"RTN","RCDPEM2",189,0)
 .;Get EOB detail record
"RTN","RCDPEM2",190,0)
 .S EOBND=$G(^IBM(361.1,EOB,0))
"RTN","RCDPEM2",191,0)
 .;Extract Bill number from EOB detail
"RTN","RCDPEM2",192,0)
 .S BILL=$P(EOBND,"^",1) Q:BILL=""
"RTN","RCDPEM2",193,0)
 .;Ignore duplicate bills on ERA
"RTN","RCDPEM2",194,0)
 .Q:$D(^TMP("RCDPEM2",$J,BILL))
"RTN","RCDPEM2",195,0)
 .S ^TMP("RCDPEM2",$J,BILL)=""
"RTN","RCDPEM2",196,0)
 .;Search AR TRANSACTION file #433 for the bill - newest first
"RTN","RCDPEM2",197,0)
 .S ART=""
"RTN","RCDPEM2",198,0)
 .F  S ART=$O(^PRCA(433,"C",BILL,ART),-1) Q:+ART=0!(FOUND)  D
"RTN","RCDPEM2",199,0)
 ..S ARTND1=$G(^PRCA(433,ART,1))
"RTN","RCDPEM2",200,0)
 ..;Get transaction type
"RTN","RCDPEM2",201,0)
 ..S ATTY=$P(ARTND1,"^",2) Q:'ATTY
"RTN","RCDPEM2",202,0)
 ..;Ignore if not a payment
"RTN","RCDPEM2",203,0)
 ..S ATTY=$P($G(^PRCA(430.3,ATTY,0)),"^",1) Q:ATTY'["PAYMENT"
"RTN","RCDPEM2",204,0)
 ..;Get receipt number
"RTN","RCDPEM2",205,0)
 ..S RECEPT=$P(ARTND1,"^",3) Q:RECEPT=""
"RTN","RCDPEM2",206,0)
 ..;Ignore receipt if status is not 'ACCEPTED BY FMS'
"RTN","RCDPEM2",207,0)
 ..Q:'$$FMS(RECEPT,1)
"RTN","RCDPEM2",208,0)
 ..W !!,"PATIENT: "_$$PNM4^RCDPEWL1(RCSCR,RCSCR1)
"RTN","RCDPEM2",209,0)
 ..W !,"Bill number: ",$P($G(^DGCR(399,BILL,0)),U)
"RTN","RCDPEM2",210,0)
 ..W !,"Check #: ",$$CHQ(RECEPT,BILL)
"RTN","RCDPEM2",211,0)
 ..W !,"Trace #: ",TRACE
"RTN","RCDPEM2",212,0)
 ..W !,"DOS: ",$$FMTE^XLFDT($P($G(^DGCR(399,BILL,0)),U,3))
"RTN","RCDPEM2",213,0)
 ..S TAMT=+$P(ARTND1,"^",5)
"RTN","RCDPEM2",214,0)
 ..W !,"AR Transaction amount: ",TAMT
"RTN","RCDPEM2",215,0)
 ..W !,"RECEIPT#: ",RECEPT
"RTN","RCDPEM2",216,0)
 ..W !,"Date of Receipt: ",$$FMTE^XLFDT($$DATE(RECEPT))
"RTN","RCDPEM2",217,0)
 ..W !,"Total Receipt AMOUNT: ",$J($$AMT(RECEPT),2,2),!
"RTN","RCDPEM2",218,0)
 ..S DIR(0)="Y",DIR("B")="YES"
"RTN","RCDPEM2",219,0)
 ..S DIR("A")="Link to update Remittance entry # "_RCSCR
"RTN","RCDPEM2",220,0)
 ..S DIR("A")=DIR("A")_" with receipt "_RECEPT
"RTN","RCDPEM2",221,0)
 ..D ^DIR K DIR
"RTN","RCDPEM2",222,0)
 ..;Aborted
"RTN","RCDPEM2",223,0)
 ..I $D(DUOUT)!$D(DTOUT) S ABORT=1,FOUND=1 Q
"RTN","RCDPEM2",224,0)
 ..;Attempt to update ERA - finish if successful
"RTN","RCDPEM2",225,0)
 ..I +Y>0 D UPDERA(RCSCR,RECEPT,.FOUND)
"RTN","RCDPEM2",226,0)
 ;Update failed
"RTN","RCDPEM2",227,0)
 I FOUND=0 W !!,"No matching payment transactions found for this ERA"
"RTN","RCDPEM2",228,0)
 ;Clear workfile
"RTN","RCDPEM2",229,0)
 K ^TMP("RCDPEM2",$J)
"RTN","RCDPEM2",230,0)
 Q
"RTN","RCDPEM2",231,0)
 ;
"RTN","RCDPEM2",232,0)
UPDERA(DA,RECEPT,FOUND) ;Mark ERA as posted to paper EOB
"RTN","RCDPEM2",233,0)
 N Y,X,DR,DIE,%
"RTN","RCDPEM2",234,0)
 D NOW^%DTC
"RTN","RCDPEM2",235,0)
 S DIE="^RCY(344.4,",FOUND=0
"RTN","RCDPEM2",236,0)
 ;Update Receipt #, EFT Match Status, Detail Post Status and Paper EOB
"RTN","RCDPEM2",237,0)
 S DR=".08///"_RECEPT_";.09///2;.14///2;20.03///1"
"RTN","RCDPEM2",238,0)
 ;Update Date/Time Posted and User fields
"RTN","RCDPEM2",239,0)
 S DR=DR_";7.01///"_%_";7.02///"_DUZ
"RTN","RCDPEM2",240,0)
 D ^DIE
"RTN","RCDPEM2",241,0)
 I '$D(Y) D
"RTN","RCDPEM2",242,0)
 .K DIR
"RTN","RCDPEM2",243,0)
 .S DIR(0)="EA"
"RTN","RCDPEM2",244,0)
 .S DIR("A",1)="ERA HAS BEEN MARKED AS POSTED USING PAPER EOB"
"RTN","RCDPEM2",245,0)
 .S DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEM2",246,0)
 .S FOUND=1
"RTN","RCDPEM2",247,0)
 E  W !,"Unable to update ERA for receipt "_RECEPT,!
"RTN","RCDPEM2",248,0)
 Q FOUND
"RTN","RCDPEM2",249,0)
 ;
"RTN","RCDPEM2",250,0)
 ;Check FMS status
"RTN","RCDPEM2",251,0)
FMS(RECEPT,FLG) ;
"RTN","RCDPEM2",252,0)
 ; FLG = 1 if RECEPT contains receipt number
"RTN","RCDPEM2",253,0)
 ; FLG = 0 if RECEPT contains ien of the receipt
"RTN","RCDPEM2",254,0)
 N FMSDOCNO,RCRECTDA,RES
"RTN","RCDPEM2",255,0)
 S RES=0 I $G(RECEPT)="" G FMSX
"RTN","RCDPEM2",256,0)
 ;Get receipt IEN
"RTN","RCDPEM2",257,0)
 I 'FLG S RCRECTDA=RECEPT
"RTN","RCDPEM2",258,0)
 I FLG S RCRECTDA=$O(^RCY(344,"B",RECEPT,0))
"RTN","RCDPEM2",259,0)
 I 'RCRECTDA G FMSX
"RTN","RCDPEM2",260,0)
 ;Get FMS document number
"RTN","RCDPEM2",261,0)
 S FMSDOCNO=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPEM2",262,0)
 ;Ignore if not accepted
"RTN","RCDPEM2",263,0)
 I $P(FMSDOCNO,U,2)'="ACCEPTED BY FMS" G FMSX
"RTN","RCDPEM2",264,0)
 ;Otherwise can be linked
"RTN","RCDPEM2",265,0)
 S RES=1
"RTN","RCDPEM2",266,0)
FMSX ;
"RTN","RCDPEM2",267,0)
 Q RES
"RTN","RCDPEM2",268,0)
 ;
"RTN","RCDPEM2",269,0)
DATE(RECEPT) ;
"RTN","RCDPEM2",270,0)
 N RCRECTDA
"RTN","RCDPEM2",271,0)
 ;Get receipt IEN
"RTN","RCDPEM2",272,0)
 S RCRECTDA=$O(^RCY(344,"B",RECEPT,0)) Q:'RCRECTDA 0
"RTN","RCDPEM2",273,0)
 ;Return Receipt date
"RTN","RCDPEM2",274,0)
 Q $P($G(^RCY(344,RCRECTDA,0)),U,3)
"RTN","RCDPEM2",275,0)
 ;
"RTN","RCDPEM2",276,0)
AMT(RECEPT) ;Total Receipt amount
"RTN","RCDPEM2",277,0)
 N RCRECTDA,RCTRAN,RCTOT
"RTN","RCDPEM2",278,0)
 ;Get receipt IEN
"RTN","RCDPEM2",279,0)
 S RCRECTDA=$O(^RCY(344,"B",RECEPT,0)) Q:'RCRECTDA 0
"RTN","RCDPEM2",280,0)
 ;Total the Receipt transactions
"RTN","RCDPEM2",281,0)
 S RCTRAN=0,RCTOT=0
"RTN","RCDPEM2",282,0)
 F  S RCTRAN=$O(^RCY(344,RCRECTDA,1,RCTRAN)) Q:'RCTRAN  D
"RTN","RCDPEM2",283,0)
 .S RCTOT=RCTOT+$P($G(^RCY(344,RCRECTDA,1,RCTRAN,0)),U,4)
"RTN","RCDPEM2",284,0)
 Q RCTOT
"RTN","RCDPEM2",285,0)
 ;
"RTN","RCDPEM2",286,0)
CHQ(RECEPT,BILL) ;Get check number for this bill
"RTN","RCDPEM2",287,0)
 N RCRECTDA,RCTRAN,RCCHK,PATBILL
"RTN","RCDPEM2",288,0)
 ;Get receipt IEN
"RTN","RCDPEM2",289,0)
 S RCRECTDA=$O(^RCY(344,"B",RECEPT,0)) Q:'RCRECTDA ""
"RTN","RCDPEM2",290,0)
 ;Scan Receipt looking for this bill IEN
"RTN","RCDPEM2",291,0)
 S RCTRAN=0,RCCHK=""
"RTN","RCDPEM2",292,0)
 F  S RCTRAN=$O(^RCY(344,RCRECTDA,1,RCTRAN)) Q:'RCTRAN  D  Q:RCCHK]""
"RTN","RCDPEM2",293,0)
 .;Check for match on bill IEN
"RTN","RCDPEM2",294,0)
 .S PATBILL=$P($G(^RCY(344,RCRECTDA,1,RCTRAN,0)),U,3)
"RTN","RCDPEM2",295,0)
 .;Ignore Patient pointers or null field
"RTN","RCDPEM2",296,0)
 .Q:$P(PATBILL,";",2)'="PRCA(430,"
"RTN","RCDPEM2",297,0)
 .;Compare bill IEN399 to IEN430
"RTN","RCDPEM2",298,0)
 .Q:$P(PATBILL,";")'=BILL
"RTN","RCDPEM2",299,0)
 .;Get check number for this line
"RTN","RCDPEM2",300,0)
 .S RCCHK=$P($G(^RCY(344,RCRECTDA,1,RCTRAN,0)),U,7)
"RTN","RCDPEM2",301,0)
 Q RCCHK
"RTN","RCDPEM2",302,0)
 ;
"RTN","RCDPEM2",303,0)
 ;; End PRCA*4.5*276 - PJH
"RTN","RCDPEM2",304,0)
 ;
"RTN","RCDPEM2",305,0)
MATCH3 ; Manually 'match' a 0-balance ERA that has no check or EFT
"RTN","RCDPEM2",306,0)
 N DUOUT,DTOUT,DA,DR,DIE,DIC,DIR,X,Y,RCERA,RCRCPT
"RTN","RCDPEM2",307,0)
 W !,"THIS OPTION WILL ALLOW YOU TO MANUALLY MARK A 0-BALANCE ERA WITH NO",!,"CHECK OR EFT AS 'MATCH-0 PAYMENT' TO REMOVE IT FROM THE ERA AGING REPORT"
"RTN","RCDPEM2",308,0)
M3 S DIR("A")="SELECT THE UNMATCHED 0-BALANCE ERA TO MARK AS MATCHED: "
"RTN","RCDPEM2",309,0)
 S DIR(0)="PAO^RCY(344.4,:AEMQ",DIR("S")="I '$P(^(0),U,9),'$P(^(0),U,5)"
"RTN","RCDPEM2",310,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",311,0)
 I $D(DUOUT)!$D(DTOUT)!(Y'>0) G M3Q
"RTN","RCDPEM2",312,0)
 S RCERA=+Y
"RTN","RCDPEM2",313,0)
 W !
"RTN","RCDPEM2",314,0)
 S DIC="^RCY(344.4,",DR="0",DA=RCERA D EN^DIQ
"RTN","RCDPEM2",315,0)
 W !
"RTN","RCDPEM2",316,0)
 S DIR("A")="ARE YOU SURE THIS IS THE ERA YOU WANT TO MARK AS MATCH-0 PAYMENT?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",317,0)
 I $D(DUOUT)!$D(DTOUT) G M3Q
"RTN","RCDPEM2",318,0)
 I Y'=1 G M3
"RTN","RCDPEM2",319,0)
 S DIE="^RCY(344.4,",DR=".09////3",DA=RCERA D ^DIE
"RTN","RCDPEM2",320,0)
 S DIR(0)="EA",DIR("A")="ERA #"_RCERA_" WAS "_$S('$D(Y):"SUCCESSFULLY",1:"NOT")_" MARKED AS MATCH-0 PAYMENT" D ^DIR K DIR
"RTN","RCDPEM2",321,0)
M3Q Q
"RTN","RCDPEM2",322,0)
 ;
"RTN","RCDPEM2",323,0)
UNMATCH ; Used to 'unmatch' an ERA matched in error
"RTN","RCDPEM2",324,0)
 N X,Y,DIR,DIC,DIE,DIK,DA,DR,RCWL,RCEFT,RCQUIT
"RTN","RCDPEM2",325,0)
 S DIC(0)="AEMQ",DIC="^RCY(344.4,",DIC("S")="I '$P(^(0),U,8),$S('$P(^(0),U,14):1,1:$P(^(0),U,9)=3),$P(^(0),U,9)" D ^DIC K DIC
"RTN","RCDPEM2",326,0)
 Q:Y'>0
"RTN","RCDPEM2",327,0)
 S RCWL=+Y,RCQUIT=0
"RTN","RCDPEM2",328,0)
 I $D(^RCY(344.49,RCWL,0)) D  Q:RCQUIT
"RTN","RCDPEM2",329,0)
 . S DIR(0)="YA",DIR("A",1)="THIS ERA ALREADY HAS A WORKLIST ENTRY AND MUST BE DELETED BEFORE IT CAN BE UNMATCHED",DIR("A")="DO YOU WANT TO DELETE THE WORKLIST ENTRY FOR THIS ERA NOW?: "
"RTN","RCDPEM2",330,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEM2",331,0)
 . I Y'=1 S RCQUIT=1 Q
"RTN","RCDPEM2",332,0)
 . S DIK="^RCY(344.49,",DA=RCWL D ^DIK
"RTN","RCDPEM2",333,0)
 I $O(^RCY(344.31,"AERA",RCWL,0)) S RCEFT=+$O(^(0)) D  Q:RCQUIT
"RTN","RCDPEM2",334,0)
 . S DIR("A",1)="THIS ERA IS MATCHED TO EFT #"_RCEFT,DIR("A")="ARE YOU SURE YOU WANT TO UNMATCH THEM?: ",DIR(0)="YA"
"RTN","RCDPEM2",335,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEM2",336,0)
 . I Y'=1 S RCQUIT=1 Q
"RTN","RCDPEM2",337,0)
 . S DIE="^RCY(344.31,",DR=".1///@;.08////0",DA=RCEFT D ^DIE
"RTN","RCDPEM2",338,0)
 . W !,"EFT #"_RCEFT_" IS NOW UNMATCHED",!
"RTN","RCDPEM2",339,0)
 S DIE="^RCY(344.4,",DR=".09////0;.13///@;.14////0",DA=RCWL D ^DIE
"RTN","RCDPEM2",340,0)
 S DIR("A")="ERA HAS BEEN SUCCESSFULLY UNMATCHED - PRESS RETURN TO CONTINUE "
"RTN","RCDPEM2",341,0)
 S DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEM2",342,0)
 Q
"RTN","RCDPEM2",343,0)
 ;
"RTN","RCDPEM2",344,0)
 ;
"RTN","RCDPEM2",345,0)
RETN ; Entrypoint for returned ERA
"RTN","RCDPEM2",346,0)
 N DIR,X,Y,DTOUT,DUOUT,DIC,RCY,DIE,DA,DR,MSG,%
"RTN","RCDPEM2",347,0)
 D OWNSKEY^XUSRB(.MSG,"RCDPE MARK ERA",DUZ)
"RTN","RCDPEM2",348,0)
 I 'MSG(0) W !,"SORRY, YOU ARE NOT AUTHORIZED TO USE THIS OPTION",! S DIR(0)="E" D ^DIR K DIR Q
"RTN","RCDPEM2",349,0)
 W !!,"Use this option to remove an ERA from your worklist that doesn't belong to you"
"RTN","RCDPEM2",350,0)
 W !,"or cannot be removed with the 'Update ERA Posted Using Paper EOB option'."
"RTN","RCDPEM2",351,0)
 W !,"The ERA can no longer be accessed for processing, but can be viewed under your"
"RTN","RCDPEM2",352,0)
 W !,"posted worklist. Option is locked with RCDPE MARK ERA key and needs a removal"
"RTN","RCDPEM2",353,0)
 W !,"justification for auditing purposes.",!
"RTN","RCDPEM2",354,0)
 S DIC="^RCY(344.4,",DIC(0)="AEMQ",DIC("S")="I '$P(^(0),U,9),'$P(^(0),U,14)" D ^DIC K DIC
"RTN","RCDPEM2",355,0)
 Q:Y'>0
"RTN","RCDPEM2",356,0)
 S RCY=+Y
"RTN","RCDPEM2",357,0)
 S DIR(0)="YA",DIR("A",1)="THIS WILL MARK THE ERA # "_+Y_" AS RETURNED TO PAYER/NOT POSTED",DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE? " W ! D ^DIR K DIR
"RTN","RCDPEM2",358,0)
 W !
"RTN","RCDPEM2",359,0)
 I $D(DUOUT)!$D(DTOUT)!(Y=0) D NOCHNG Q
"RTN","RCDPEM2",360,0)
 S DIE="^RCY(344.4,",DA=RCY,DR=".18" D ^DIE
"RTN","RCDPEM2",361,0)
 I $D(Y) D NOCHNG Q
"RTN","RCDPEM2",362,0)
 D NOW^%DTC S DR=".14////4;.09////2;.16////"_DUZ_";.17////"_% D ^DIE
"RTN","RCDPEM2",363,0)
 S DIR(0)="EA",DIR("A")="PRESS RETURN TO CONTINUE"
"RTN","RCDPEM2",364,0)
 W ! D ^DIR
"RTN","RCDPEM2",365,0)
 Q
"RTN","RCDPEM2",366,0)
 ;
"RTN","RCDPEM2",367,0)
NOCHNG ;
"RTN","RCDPEM2",368,0)
 N DIR,X,Y,DTOUT,DUOUT
"RTN","RCDPEM2",369,0)
 D EN^DDIOL("NO CHANGES HAVE BEEN MADE.","","!")
"RTN","RCDPEM2",370,0)
 S DIR(0)="EA",DIR("A")="PRESS RETURN TO CONTINUE: "
"RTN","RCDPEM2",371,0)
 W !! D ^DIR
"RTN","RCDPEM2",372,0)
 Q
"RTN","RCDPEM3")
0^40^B109331342^n/a
"RTN","RCDPEM3",1,0)
RCDPEM3 ;OIFO-BAYPINES/RBN - ERA AUDIT REPORT and return EFT function ;8/15/11 11:26am
"RTN","RCDPEM3",2,0)
 ;;4.5;Accounts Receivable;**276**;Mar 20, 1995;Build 87
"RTN","RCDPEM3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM3",4,0)
 ;
"RTN","RCDPEM3",5,0)
 ; General read access of IB EOB file #361.1 is allowed from AR (IA 4051)
"RTN","RCDPEM3",6,0)
 Q
"RTN","RCDPEM3",7,0)
 ;
"RTN","RCDPEM3",8,0)
 ; DESCRIPTION : The following generates an audit report that displays all ERAs
"RTN","RCDPEM3",9,0)
 ;               that have been returned to the payer.  The user can select
"RTN","RCDPEM3",10,0)
 ;               several filters with which to limit the number of ERAs displayed:
"RTN","RCDPEM3",11,0)
 ;                 * Station/Division - the default is all.
"RTN","RCDPEM3",12,0)
 ;                 * Date Range       - the default is all.
"RTN","RCDPEM3",13,0)
 ;                 * Start Date       - no default, P:Date Returned to Payer;R:Date ERA Received;B:Both Dates.
"RTN","RCDPEM3",14,0)
 ;                 
"RTN","RCDPEM3",15,0)
 ; INPUTS      : The user is prompted for the Station/Division.
"RTN","RCDPEM3",16,0)
 ;               The user is prompted for the Date/Time range
"RTN","RCDPEM3",17,0)
 ;               The user is prompted for the Start Date.
"RTN","RCDPEM3",18,0)
 ;
"RTN","RCDPEM3",19,0)
 ; OUTPUTS     : A report which displays returned ERAs.  The report has the following
"RTN","RCDPEM3",20,0)
 ;               headings:
"RTN","RCDPEM3",21,0)
 ;                 * User name - The name of the user who performed the transaction.
"RTN","RCDPEM3",22,0)
 ;                 * Date/Time ERA received from the payer.
"RTN","RCDPEM3",23,0)
 ;                 * Date/Tine ERA returned to payer.
"RTN","RCDPEM3",24,0)
 ;                 * Freetext justification for returning the ERA to payer.
"RTN","RCDPEM3",25,0)
 ;                 * ERA number.
"RTN","RCDPEM3",26,0)
 ;                 * Trace number.
"RTN","RCDPEM3",27,0)
 ;                 * Dollar amount of ERA.
"RTN","RCDPEM3",28,0)
 ;                 * Payer name.
"RTN","RCDPEM3",29,0)
 ;
"RTN","RCDPEM3",30,0)
 ; LOCAL VARIABLES: RCNAME   - Name of user who performed transaction.
"RTN","RCDPEM3",31,0)
 ;                  RCDTRV   - Date/time ERA was received from payer.
"RTN","RCDPEM3",32,0)
 ;                  RCDTMK   - Date/time ERA was marked as returned.
"RTN","RCDPEM3",33,0)
 ;                  RCJUST   - Justification for marking ERA as returned (free text).
"RTN","RCDPEM3",34,0)
 ;                  RCERA    - The ERA number.
"RTN","RCDPEM3",35,0)
 ;                  RCTRACE  - The ERA trace number.
"RTN","RCDPEM3",36,0)
 ;                  RCTOT    - Total dollar amount of the ERA.
"RTN","RCDPEM3",37,0)
 ;                  RCPNAM   - Payer name of the ERA.
"RTN","RCDPEM3",38,0)
 ;                  RCSTDIV  - Station/Division.
"RTN","RCDPEM3",39,0)
 ;                  RCDTRNG  - Date/Time range of report (an array: range_flag^start_date^end_date).
"RTN","RCDPEM3",40,0)
 ;                  RCDISP   - Display/print/Excel flag.
"RTN","RCDPEM3",41,0)
 ;                  RCPAGE   - Current page number of the report.
"RTN","RCDPEM3",42,0)
 ;                  RCPRB    - Selected Start Date (P:Date Returned to Payer;R:Date ERA Received;B:Both Dates).
"RTN","RCDPEM3",43,0)
 ;                  FileMan  - Several standard FileMan variables (v.gr. DIR,DIC,etc..
"RTN","RCDPEM3",44,0)
 ;                  Misc.    - X, Y, I and other used for counters and temp values.
"RTN","RCDPEM3",45,0)
 ;
"RTN","RCDPEM3",46,0)
 ; GLOBALS        : ^RCY(344.4 - ELECTRONIC REMITTANCE ADVICE file (#344.4).
"RTN","RCDPEM3",47,0)
 ;                  ^TMP($J,"RCDPEM3",LINE #) - Report data (body of report).  Data structure:
"RTN","RCDPEM3",48,0)
 ;      
"RTN","RCDPEM3",49,0)
 ; STATION NAME^STATION #^TRACE #^PAYER^DEPOSIT #^DATE RETURNED^USER^JUSTIFICATION^ERA #^ERA DATE^T0TAL AMOUNT
"RTN","RCDPEM3",50,0)
 ;
"RTN","RCDPEM3",51,0)
EN ; Main entry point for ERA Audit Report
"RTN","RCDPEM3",52,0)
 N RCDTRNG,RCRANGE,RCDIV,RCSTA,RCDISP,RCPAGE,STANUM,STANAM,RCSTART,RCEND,RCSTOP,RCPG,RCIND,I,RCSTN,RCPRB
"RTN","RCDPEM3",53,0)
 N %ZIS,POP,VAUTD,ZTDESC,ZTRTN,ZTSAVE
"RTN","RCDPEM3",54,0)
 ;
"RTN","RCDPEM3",55,0)
 S (RCSTART,RCEND,RCSTOP,RCPG,RCPRB)=0
"RTN","RCDPEM3",56,0)
 S RCRANGE="0^^"
"RTN","RCDPEM3",57,0)
 S RCDTRNG=0
"RTN","RCDPEM3",58,0)
 S RCPAGE=0
"RTN","RCDPEM3",59,0)
 S RCIND=1
"RTN","RCDPEM3",60,0)
 ; PRCA*4.5*276 - Modify Header display
"RTN","RCDPEM3",61,0)
 S RCDIV="ALL"
"RTN","RCDPEM3",62,0)
 S RCPRB=$$DTPRB^RCDPEM4()
"RTN","RCDPEM3",63,0)
 I RCPRB=0 G EXIT
"RTN","RCDPEM3",64,0)
 S RCRANGE=$$DTRNG^RCDPEM4()
"RTN","RCDPEM3",65,0)
 I RCRANGE=0 G EXIT
"RTN","RCDPEM3",66,0)
 S RCSTART=$P(RCRANGE,U,2),RCEND=$P(RCRANGE,U,3)
"RTN","RCDPEM3",67,0)
 D DIVISION^VAUTOMA Q:Y=-1
"RTN","RCDPEM3",68,0)
 I 'VAUTD&($D(VAUTD)'=11) G EXIT
"RTN","RCDPEM3",69,0)
 I VAUTD=0 D
"RTN","RCDPEM3",70,0)
 .S (I,RCDIV)="" F  S I=$O(VAUTD(I)) Q:'I  S RCDIV=RCDIV_", "_VAUTD(I)
"RTN","RCDPEM3",71,0)
 .S RCDIV=$E(RCDIV,3,$L(RCDIV))
"RTN","RCDPEM3",72,0)
 .Q
"RTN","RCDPEM3",73,0)
 S RCDISP=$$DISPTY() G:+RCDISP=-1 EXIT
"RTN","RCDPEM3",74,0)
 I $D(DUOUT)!$D(DTOUT) G EXIT
"RTN","RCDPEM3",75,0)
 I RCDISP D INFO^RCDPEM6
"RTN","RCDPEM3",76,0)
 S:'VAUTD RCIND=RCIND+1
"RTN","RCDPEM3",77,0)
 S:$P($G(RCRANGE),U)>0 RCIND=RCIND+3
"RTN","RCDPEM3",78,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPEM3",79,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPEM3",80,0)
 . S ZTRTN="ENRPT^RCDPEM3"
"RTN","RCDPEM3",81,0)
 . S ZTDESC="ERA's Returned to Payer Audit Report"
"RTN","RCDPEM3",82,0)
 . S ZTSAVE("RC*")="",ZTSAVE("VAUTD")=""
"RTN","RCDPEM3",83,0)
 . D ^%ZTLOAD
"RTN","RCDPEM3",84,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEM3",85,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEM3",86,0)
 U IO
"RTN","RCDPEM3",87,0)
 ;
"RTN","RCDPEM3",88,0)
ENRPT ;
"RTN","RCDPEM3",89,0)
 D REPRT
"RTN","RCDPEM3",90,0)
 D DISP(RCDISP)
"RTN","RCDPEM3",91,0)
 D EXIT
"RTN","RCDPEM3",92,0)
 Q
"RTN","RCDPEM3",93,0)
 ;
"RTN","RCDPEM3",94,0)
DISPTY() ; Get display/output type
"RTN","RCDPEM3",95,0)
 ; INPUTS   : User input from keyboard
"RTN","RCDPEM3",96,0)
 ; RETURNS  : Output destination (0=Display; 1=MS Excel)
"RTN","RCDPEM3",97,0)
 ; LOCAL VARIABLES :
"RTN","RCDPEM3",98,0)
 ; DIR,DUOUT - Standard FileMan variables
"RTN","RCDPEM3",99,0)
 ; Y         - User input
"RTN","RCDPEM3",100,0)
 N DIR,DUOUT,Y
"RTN","RCDPEM3",101,0)
 S DIR(0)="Y"
"RTN","RCDPEM3",102,0)
 S DIR("A")="EXPORT THE REPORT TO Microsoft Excel (Y/N): "
"RTN","RCDPEM3",103,0)
 S DIR("B")="NO"
"RTN","RCDPEM3",104,0)
 D ^DIR K DIR
"RTN","RCDPEM3",105,0)
 I $D(DUOUT)!$D(DIRUT) S Y=-1
"RTN","RCDPEM3",106,0)
 Q Y
"RTN","RCDPEM3",107,0)
 ;
"RTN","RCDPEM3",108,0)
ERASTA(ERAIEN) ; Get the station for this ERA (ERAIEN = ien of the ERA in question)
"RTN","RCDPEM3",109,0)
 ; INPUTS :  ERAIEN - ien of the ERA in question.
"RTN","RCDPEM3",110,0)
 ; LOCAL VARIABLES:
"RTN","RCDPEM3",111,0)
 ; ERAEOB  - EOB corresponding to the ERA
"RTN","RCDPEM3",112,0)
 ; ERABILL - Bill corresponding to the ERA
"RTN","RCDPEM3",113,0)
 ; STA     - IEN of the Station of the ERA, or -1 if not found
"RTN","RCDPEM3",114,0)
 N ERAEOB,ERABILL,STA,STNAM,STNUM
"RTN","RCDPEM3",115,0)
 S (ERAEOB,ERABILL,STA,STNAM,STNUM)=""
"RTN","RCDPEM3",116,0)
 S STA=-1,STNUM=""
"RTN","RCDPEM3",117,0)
 I ERAIEN D
"RTN","RCDPEM3",118,0)
 . S ERAEOB=$P($G(^RCY(344.4,ERAIEN,1,1,0)),U,2) Q:'ERAEOB
"RTN","RCDPEM3",119,0)
 . S ERABILL=$P($G(^IBM(361.1,ERAEOB,0)),U,1) Q:'ERABILL
"RTN","RCDPEM3",120,0)
 . S STA=$P(^DGCR(399,ERABILL,0),U,22) Q:'STA
"RTN","RCDPEM3",121,0)
 . S STNAM=$$EXTERNAL^DILFD(399,.22,,STA)
"RTN","RCDPEM3",122,0)
 . S STNUM=$P($G(^DG(40.8,STA,0)),U,2) ;IA 417
"RTN","RCDPEM3",123,0)
 S:$G(STNAM)="" STNAM="UNKNOWN",STNUM="UNKNOWN"
"RTN","RCDPEM3",124,0)
 S STNAM=STNAM_"^"_STNUM
"RTN","RCDPEM3",125,0)
 Q STNAM
"RTN","RCDPEM3",126,0)
 ;
"RTN","RCDPEM3",127,0)
REPRT ; Generate the report ^TMP array
"RTN","RCDPEM3",128,0)
 ; INPUTS : None
"RTN","RCDPEM3",129,0)
 ; LOCAL VARIABLES:
"RTN","RCDPEM3",130,0)
 ; DTIEN  - IEN of ERA from "E" index (date/time)
"RTN","RCDPEM3",131,0)
 ; DTERA  - Date ERA received
"RTN","RCDPEM3",132,0)
 ; START  - Start date of report date range
"RTN","RCDPEM3",133,0)
 ; END    - End date of report date range
"RTN","RCDPEM3",134,0)
 ; ERAIEN - IEN of ERA
"RTN","RCDPEM3",135,0)
 ; STANAM - Name of Station/Division
"RTN","RCDPEM3",136,0)
 ; STANUM - Station/Division number
"RTN","RCDPEM3",137,0)
 ; RCPRB  - Start date (P:Date Returned to Payer;R:Date ERA Received;B:Both Dates)
"RTN","RCDPEM3",138,0)
 N DTIEN,START,END,ERAIEN,X1,X2,X,DTERA
"RTN","RCDPEM3",139,0)
 K ^TMP($J,"RCDPEM3")
"RTN","RCDPEM3",140,0)
 S (DTIEN,ERAIEN)=""
"RTN","RCDPEM3",141,0)
 ; If user picked P:Date Returned to Payer OR B:Both Dates, use index "AD"
"RTN","RCDPEM3",142,0)
 I (RCPRB="P")!(RCPRB="B") D
"RTN","RCDPEM3",143,0)
 . S DTIEN=$P(RCRANGE,U,1)
"RTN","RCDPEM3",144,0)
 . S END=$P(RCRANGE,U,3)
"RTN","RCDPEM3",145,0)
 . S START=$P(RCRANGE,U,2)
"RTN","RCDPEM3",146,0)
 . F  S DTIEN=$O(^RCY(344.4,"AD",DTIEN)) Q:'DTIEN!(DTIEN\1>END)  D
"RTN","RCDPEM3",147,0)
 . . F  S ERAIEN=$O(^RCY(344.4,"AD",DTIEN,ERAIEN)) Q:'ERAIEN  D
"RTN","RCDPEM3",148,0)
 . . . Q:'$D(^RCY(344.4,ERAIEN,6))
"RTN","RCDPEM3",149,0)
 . . . I (START'>DTIEN\1)&(DTIEN\1'>END) D PROC(ERAIEN)
"RTN","RCDPEM3",150,0)
 ; If user picked R:Date ERA Received OR B:Both Dates, use index "AC"
"RTN","RCDPEM3",151,0)
 S (DTIEN,ERAIEN)=""
"RTN","RCDPEM3",152,0)
 I (RCPRB="R")!(RCPRB="B") D
"RTN","RCDPEM3",153,0)
 . S END=$P(RCRANGE,U,3)
"RTN","RCDPEM3",154,0)
 . S START=$P(RCRANGE,U,2)
"RTN","RCDPEM3",155,0)
 . F  S DTIEN=$O(^RCY(344.4,"AC",DTIEN)) Q:'DTIEN  D
"RTN","RCDPEM3",156,0)
 . . F  S ERAIEN=$O(^RCY(344.4,"AC",DTIEN,ERAIEN)) Q:'ERAIEN  D
"RTN","RCDPEM3",157,0)
 . . . Q:'$D(^RCY(344.4,ERAIEN,6))
"RTN","RCDPEM3",158,0)
 . . . Q:$D(^TMP($J,"RCDPEM3",$P(^RCY(344.4,ERAIEN,0),U,1)))  ;data is in ^TMP global
"RTN","RCDPEM3",159,0)
 . . . S DTERA=$P($G(^RCY(344.4,ERAIEN,0)),U,4)\1 Q:'DTERA 
"RTN","RCDPEM3",160,0)
 . . . I START>DTERA Q
"RTN","RCDPEM3",161,0)
 . . . I END<DTERA Q
"RTN","RCDPEM3",162,0)
 . . . D PROC(ERAIEN)
"RTN","RCDPEM3",163,0)
 Q
"RTN","RCDPEM3",164,0)
 ;
"RTN","RCDPEM3",165,0)
DISP(RCDISP) ; Format the display for screen/printer or MS Excel
"RTN","RCDPEM3",166,0)
 ; INPUTS  : RCDISP -  Display/print/Excel flag.
"RTN","RCDPEM3",167,0)
 ; RETURNS : Nothing - builds the actual report
"RTN","RCDPEM3",168,0)
 ; LOCAL VARIABLES: IEN - line number of the data in ^TMP (see above)
"RTN","RCDPEM3",169,0)
 N IEN,LEN,RCNAM
"RTN","RCDPEM3",170,0)
 D HDR(RCDISP)
"RTN","RCDPEM3",171,0)
 S IEN=0
"RTN","RCDPEM3",172,0)
 ; PRCA*4.5*276 - Modify Display
"RTN","RCDPEM3",173,0)
 F  S IEN=$O(^TMP($J,"RCDPEM3",IEN)) Q:'IEN!RCSTOP  D
"RTN","RCDPEM3",174,0)
 . I 'RCDISP D
"RTN","RCDPEM3",175,0)
 . . W !
"RTN","RCDPEM3",176,0)
 . . I $Y>(IOSL-5) D HDR(RCDISP) Q:RCSTOP
"RTN","RCDPEM3",177,0)
 . . ; W $P(^TMP($J,"RCDPEM3",IEN),U,2),! Trace#
"RTN","RCDPEM3",178,0)
 . . W $P(^TMP($J,"RCDPEM3",IEN),U,3) ;ERA
"RTN","RCDPEM3",179,0)
 . . W ?15,$P(^TMP($J,"RCDPEM3",IEN),U,2),! ; Payer Name
"RTN","RCDPEM3",180,0)
 . . W ?5,$P(^TMP($J,"RCDPEM3",IEN),U,4)
"RTN","RCDPEM3",181,0)
 . . W ?29,$P(^TMP($J,"RCDPEM3",IEN),U,5) ; Date Time Returnd
"RTN","RCDPEM3",182,0)
 . . W ?46,$P(^TMP($J,"RCDPEM3",IEN),U,6) ; ERA Rec
"RTN","RCDPEM3",183,0)
 . . S RCNAM=$P(^TMP($J,"RCDPEM3",IEN),U,7) ; Tot Paid
"RTN","RCDPEM3",184,0)
 . . W ?58,$E(RCNAM,1,19),! ; USer who returned
"RTN","RCDPEM3",185,0)
 . . S A=$P(^TMP($J,"RCDPEM3",IEN),U,8)
"RTN","RCDPEM3",186,0)
 . . D WP(A)
"RTN","RCDPEM3",187,0)
 . I RCDISP D
"RTN","RCDPEM3",188,0)
 . . W !,^TMP($J,"RCDPEM3",IEN)
"RTN","RCDPEM3",189,0)
 W !
"RTN","RCDPEM3",190,0)
 W !,"******** END OF REPORT ********",!
"RTN","RCDPEM3",191,0)
 Q
"RTN","RCDPEM3",192,0)
 ;
"RTN","RCDPEM3",193,0)
PROC(ERAIEN) ;  Put the actual data into the ^TMP global based on filters.
"RTN","RCDPEM3",194,0)
 ; INPUTS : ERAIEN  - ERAIEN = ien of the ERA in question
"RTN","RCDPEM3",195,0)
 ; RETURNS: Nothing - Builds each entry in the ^TMP global
"RTN","RCDPEM3",196,0)
 ; LOCAL VARIABLES :
"RTN","RCDPEM3",197,0)
 ; ERAEOB - EOB corresponding to this ERA
"RTN","RCDPEM3",198,0)
 ; RCDIV  - Name of station
"RTN","RCDPEM3",199,0)
 ; STNUM  - Station number
"RTN","RCDPEM3",200,0)
 ; DTERA  - Date of ERA
"RTN","RCDPEM3",201,0)
 ; DTRTN  - Date ERA returned
"RTN","RCDPEM3",202,0)
 ; JUST   - Justification for returning ERA
"RTN","RCDPEM3",203,0)
 ; TRACE  - Trace number of the ERA
"RTN","RCDPEM3",204,0)
 ; AMT    - Total amount of the ERA
"RTN","RCDPEM3",205,0)
 ; PAYER  - ERA payer
"RTN","RCDPEM3",206,0)
 ; USER   - User who completed the return ERA transaction
"RTN","RCDPEM3",207,0)
 ; Y      - Used for time conversion
"RTN","RCDPEM3",208,0)
 ; DEPO   - Amount of ERA deposit
"RTN","RCDPEM3",209,0)
 N STATION,ERAEOB,DTERA,DTRTN,JUST,TRACE,AMT,PAYER,USER,Y,DEPO,ERA,RCLOCDV,PAYER
"RTN","RCDPEM3",210,0)
 S RCSTA=$$ERASTA(ERAIEN)
"RTN","RCDPEM3",211,0)
 I $P(RCSTA,U)=-1 S RCSTA="UNKNOWN",RCSTN="UNKNOWN"
"RTN","RCDPEM3",212,0)
 E  S RCSTN=$P(RCSTA,U,2),RCSTA=$P(RCSTA,U,1)
"RTN","RCDPEM3",213,0)
 ; PRCA*4.5*276 - Modify Display
"RTN","RCDPEM3",214,0)
 Q:RCDIV'[RCSTA&(RCDIV'="ALL")
"RTN","RCDPEM3",215,0)
 S ERAEOB=$P($G(^RCY(344.4,ERAIEN,1,1,0)),U,2)
"RTN","RCDPEM3",216,0)
 S Y=$P(^RCY(344.4,ERAIEN,0),U,4)
"RTN","RCDPEM3",217,0)
 S DTERA=$$FMTE^XLFDT(Y,"2D")
"RTN","RCDPEM3",218,0)
 S USER=$P(^RCY(344.4,ERAIEN,6),U,1)
"RTN","RCDPEM3",219,0)
 S USER=$$NAME^XUSER(USER,"F")
"RTN","RCDPEM3",220,0)
 S Y=$P(^RCY(344.4,ERAIEN,6),U,2)
"RTN","RCDPEM3",221,0)
 ; D DD^%DT
"RTN","RCDPEM3",222,0)
 S DTRTN=$$FMTE^XLFDT(Y,2)
"RTN","RCDPEM3",223,0)
 S JUST=$P(^RCY(344.4,ERAIEN,6),U,3)
"RTN","RCDPEM3",224,0)
 S ERA=$P(^RCY(344.4,ERAIEN,0),U,1)
"RTN","RCDPEM3",225,0)
 S TRACE=$P(^RCY(344.4,ERAIEN,0),U,2)
"RTN","RCDPEM3",226,0)
 S AMT=$P(^RCY(344.4,ERAIEN,0),U,5)
"RTN","RCDPEM3",227,0)
 S PAYER=""
"RTN","RCDPEM3",228,0)
 S:ERAEOB PAYER=$P($G(^IBM(361.1,ERAEOB,0)),U,2)
"RTN","RCDPEM3",229,0)
 S:ERAEOB&($G(PAYER)) PAYER=$$EXTERNAL^DILFD(361.1,.02,,PAYER)
"RTN","RCDPEM3",230,0)
 I '$D(PAYER)!(PAYER="") S PAYER="UNKNOWN"
"RTN","RCDPEM3",231,0)
 S DEPO=$P($G(^RCY(344.1,ERAIEN,0)),U,8)
"RTN","RCDPEM3",232,0)
 S:DEPO DEPO=$P($G(^RCY(344,DEPO,0)),U,6)
"RTN","RCDPEM3",233,0)
 S:DEPO DEPO=$P($G(^RCY(344.1,DEPO,0)),U,1)
"RTN","RCDPEM3",234,0)
 S:'$G(DEPO) DEPO="UNKNOWN"
"RTN","RCDPEM3",235,0)
 ; PRCA*4.5*276 - Remove Trace# from Excel
"RTN","RCDPEM3",236,0)
 S ^TMP($J,"RCDPEM3",ERA)=RCSTA_"^"_PAYER_"^"_ERA_"^"_DTRTN_"^"_DTERA_"^"_AMT_"^"_USER_"^"_JUST
"RTN","RCDPEM3",237,0)
 Q
"RTN","RCDPEM3",238,0)
 ;
"RTN","RCDPEM3",239,0)
HDR(RCDISP) ; Print the report header
"RTN","RCDPEM3",240,0)
 ; INPUTS   : RCDISP - Display/print/Excel flag
"RTN","RCDPEM3",241,0)
 ; RETURNS  : Nothing - Displays the report header to the screen formatted for type of output selected
"RTN","RCDPEM3",242,0)
 ; LOCAL VARIABLES :
"RTN","RCDPEM3",243,0)
 ; MSG  - Array containing the header data.
"RTN","RCDPEM3",244,0)
 ; DATE - The date of the report
"RTN","RCDPEM3",245,0)
 ; Y,%  - Used for date conversion
"RTN","RCDPEM3",246,0)
 N MSG,DATE,Y,%,Z,END,START
"RTN","RCDPEM3",247,0)
 S END=$P(RCRANGE,U,3)
"RTN","RCDPEM3",248,0)
 S START=$P(RCRANGE,U,2)
"RTN","RCDPEM3",249,0)
 ; PRCA*4.5*276 - Modify headers
"RTN","RCDPEM3",250,0)
 I 'RCDISP D
"RTN","RCDPEM3",251,0)
 . I RCPAGE D ASK(.RCSTOP,0) Q:RCSTOP
"RTN","RCDPEM3",252,0)
 . S RCPAGE=RCPAGE+1
"RTN","RCDPEM3",253,0)
 . D NOW^%DTC
"RTN","RCDPEM3",254,0)
 . S Y=%
"RTN","RCDPEM3",255,0)
 . S DATE=$$FMTE^XLFDT(Y,2)
"RTN","RCDPEM3",256,0)
 . W @IOF
"RTN","RCDPEM3",257,0)
 . W "                                                                                "
"RTN","RCDPEM3",258,0)
 . S Z="             Mark ERAs Returned to Payer - Audit Report            Page "_RCPAGE
"RTN","RCDPEM3",259,0)
 . W $J("",80-$L(Z)\2),Z,!
"RTN","RCDPEM3",260,0)
 . S Z="DIVISIONS: "_RCDIV W $J("",80-$L(Z)\2),Z,!
"RTN","RCDPEM3",261,0)
 . S Z="Run Date/Time:  "_DATE W $J("",80-$L(Z)\2),Z,!
"RTN","RCDPEM3",262,0)
 . S Z="DATE RANGE: "_$P($$FMTE^XLFDT(START,2),"@")_" - "_$P($$FMTE^XLFDT(END,2),"@")
"RTN","RCDPEM3",263,0)
 . S Z=Z_" ("_$S(RCPRB="B":"Received & Returned",RCPRB="P":"Date returned to payer",1:"Date ERA Received")_")"
"RTN","RCDPEM3",264,0)
 . W $J("",80-$L(Z)\2),Z,!
"RTN","RCDPEM3",265,0)
 . W !
"RTN","RCDPEM3",266,0)
 . W "ERA#           Payer Name",!
"RTN","RCDPEM3",267,0)
 . W "    Date/Time                Date ERA         Total Amt   User Who",!
"RTN","RCDPEM3",268,0)
 . W "    Returned                 Received         Paid        Returned",!
"RTN","RCDPEM3",269,0)
 . W "================================================================================"
"RTN","RCDPEM3",270,0)
 I RCDISP D
"RTN","RCDPEM3",271,0)
 . W "STATION NAME^PAYER^ERA NUMBER^DATE RETURNED^DATE RECEIVED^AMOUNT^USER^JUSTIFICATION"
"RTN","RCDPEM3",272,0)
 Q
"RTN","RCDPEM3",273,0)
 ;
"RTN","RCDPEM3",274,0)
PAUSE ;  Pause the display until the user presses enter/return
"RTN","RCDPEM3",275,0)
 ; Straight FileMan call and variables - See FileMan documentation
"RTN","RCDPEM3",276,0)
 N DIR,DUOUT
"RTN","RCDPEM3",277,0)
 S DIR(0)="E"
"RTN","RCDPEM3",278,0)
 D ^DIR K DIR
"RTN","RCDPEM3",279,0)
 I $D(DUOUT) G EXIT
"RTN","RCDPEM3",280,0)
 Q
"RTN","RCDPEM3",281,0)
 ;
"RTN","RCDPEM3",282,0)
EXIT ; Gracefully exit
"RTN","RCDPEM3",283,0)
 ; Kills off any remaining variables and resets output device
"RTN","RCDPEM3",284,0)
 ;
"RTN","RCDPEM3",285,0)
 D ^%ZISC
"RTN","RCDPEM3",286,0)
 K X,STNAM,STNUM,^TMP($J,"RCDPEM3")
"RTN","RCDPEM3",287,0)
 Q
"RTN","RCDPEM3",288,0)
 ;
"RTN","RCDPEM3",289,0)
WP(A,T) ; Pretty print the justification comments
"RTN","RCDPEM3",290,0)
 ; INPUTS   : A - Justification text
"RTN","RCDPEM3",291,0)
 ; RETURNS  : Nothing - Displays the justification comments on display nicely formatted
"RTN","RCDPEM3",292,0)
 ;
"RTN","RCDPEM3",293,0)
 K ^UTILITY($J,"W")
"RTN","RCDPEM3",294,0)
 N JUST,X,DIWL,DIWR,DIWF
"RTN","RCDPEM3",295,0)
 S JUST=A
"RTN","RCDPEM3",296,0)
 W "Justification Comments:  "
"RTN","RCDPEM3",297,0)
 I $L(JUST)<54 W JUST,!
"RTN","RCDPEM3",298,0)
 E  D
"RTN","RCDPEM3",299,0)
 . S X=JUST,DIWL=26,DIWR=78,DIWF="W"
"RTN","RCDPEM3",300,0)
 . D ^DIWP,^DIWW
"RTN","RCDPEM3",301,0)
 Q
"RTN","RCDPEM3",302,0)
 ;
"RTN","RCDPEM3",303,0)
RETN ; Entry point for remove EFT
"RTN","RCDPEM3",304,0)
 N DIR,X,Y,DTOUT,DIC,RCY,DIE,DA,DR,MSG,%,RCYDISP
"RTN","RCDPEM3",305,0)
 D OWNSKEY^XUSRB(.MSG,"RCDPE REMOVE DUPLICATES",DUZ)
"RTN","RCDPEM3",306,0)
 I 'MSG(0) W !,"SORRY, YOU ARE NOT AUTHORIZED TO USE THIS OPTION",! S DIR(0)="E" D ^DIR K DIR Q
"RTN","RCDPEM3",307,0)
 W !!,"          WARNING: REMOVING AN EFT IS **NOT** REVERSIBLE"
"RTN","RCDPEM3",308,0)
 W !,"  USE THIS OPTION ONLY IF YOU ARE SURE YOU WANT TO REMOVE THIS EFT."
"RTN","RCDPEM3",309,0)
 W !,"PLEASE BE AWARE THAT ONCE AN EFT IS REMOVED --- IT CANNOT BE RESTORED.",!!
"RTN","RCDPEM3",310,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RCDPEM3",311,0)
 S DIR("A")="Are you sure you want to continue"
"RTN","RCDPEM3",312,0)
 D ^DIR K DIR
"RTN","RCDPEM3",313,0)
 I $D(DUOUT)!$D(DTOUT)!'Y Q
"RTN","RCDPEM3",314,0)
 S DIC="^RCY(344.31,"
"RTN","RCDPEM3",315,0)
 S DIC(0)="AEMQ",DIC("S")="I '$P(^(0),U,8)"
"RTN","RCDPEM3",316,0)
 D ^DIC K DIC
"RTN","RCDPEM3",317,0)
 S RCY=+Y
"RTN","RCDPEM3",318,0)
 Q:RCY=-1
"RTN","RCDPEM3",319,0)
 S RCYDISP=$P(^RCY(344.31,RCY,0),U) ; Get the actual EFT number
"RTN","RCDPEM3",320,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","RCDPEM3",321,0)
 S DIR("A",1)="THIS WILL MARK THE EFT # "_+RCYDISP_" AS REMOVED"
"RTN","RCDPEM3",322,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: "
"RTN","RCDPEM3",323,0)
 W !
"RTN","RCDPEM3",324,0)
 D ^DIR K DIR
"RTN","RCDPEM3",325,0)
 I $D(DUOUT)!$D(DTOUT)!(Y=0) D NOCHNG Q
"RTN","RCDPEM3",326,0)
 S DIE="^RCY(344.31,",DA=RCY,DR=".19" D ^DIE
"RTN","RCDPEM3",327,0)
 I $D(Y) D NOCHNG Q
"RTN","RCDPEM3",328,0)
 D NOW^%DTC S DR=".08////1;.17////"_DUZ_";.18////"_% D ^DIE
"RTN","RCDPEM3",329,0)
 W !!
"RTN","RCDPEM3",330,0)
 S DIR(0)="EA"
"RTN","RCDPEM3",331,0)
 S DIR("A")="PRESS RETURN TO CONTINUE"
"RTN","RCDPEM3",332,0)
 S DIR("A",1)="EFT # "_RCYDISP_" HAS BEEN MARKED AS REMOVED"
"RTN","RCDPEM3",333,0)
 D ^DIR
"RTN","RCDPEM3",334,0)
 Q
"RTN","RCDPEM3",335,0)
 ;
"RTN","RCDPEM3",336,0)
ASK(STOP,MODE) ; Ask to continue
"RTN","RCDPEM3",337,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEM3",338,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEM3",339,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEM3",340,0)
 S:MODE DIR("A")="Enter RETURN to finish"
"RTN","RCDPEM3",341,0)
 S DIR(0)="E" W ! D ^DIR K DIR
"RTN","RCDPEM3",342,0)
 I ($D(DIRUT))!($D(DUOUT)) S STOP=1 Q
"RTN","RCDPEM3",343,0)
 Q
"RTN","RCDPEM3",344,0)
 ;
"RTN","RCDPEM3",345,0)
TEXT ; Filtered by messages
"RTN","RCDPEM3",346,0)
 ;;No Filters Applied
"RTN","RCDPEM3",347,0)
 ;;Station/Division
"RTN","RCDPEM3",348,0)
 ;;
"RTN","RCDPEM3",349,0)
 ;;Date Range
"RTN","RCDPEM3",350,0)
 ;;Station/Division, Date Range
"RTN","RCDPEM3",351,0)
 ;;Payer
"RTN","RCDPEM3",352,0)
 ;;Station/Division, Payer
"RTN","RCDPEM3",353,0)
 ;;
"RTN","RCDPEM3",354,0)
 ;;Date Range, Payer
"RTN","RCDPEM3",355,0)
 ;;Station/Division, Date Range, Payer
"RTN","RCDPEM3",356,0)
 Q
"RTN","RCDPEM3",357,0)
 ;
"RTN","RCDPEM3",358,0)
NOCHNG ;
"RTN","RCDPEM3",359,0)
 N DIR,X,Y,DTOUT,DUOUT
"RTN","RCDPEM3",360,0)
 S DIR(0)="EA"
"RTN","RCDPEM3",361,0)
 S DIR("A")="PRESS RETURN TO CONTINUE: "
"RTN","RCDPEM3",362,0)
 S DIR("A",1)="***  This EFT was NOT Removed."
"RTN","RCDPEM3",363,0)
 W !! D ^DIR
"RTN","RCDPEM3",364,0)
 Q
"RTN","RCDPEM4")
0^41^B186028415^n/a
"RTN","RCDPEM4",1,0)
RCDPEM4 ;OIFO-BAYPINES/PJH - EPAYMENTS AUDIT REPORTS ;9/8/11 3:33pm
"RTN","RCDPEM4",2,0)
 ;;4.5;Accounts Receivable;**276**;Mar 20, 1995;Build 87
"RTN","RCDPEM4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM4",4,0)
 ;
"RTN","RCDPEM4",5,0)
EOB ; Main entry point for EOB Move/Copy Report
"RTN","RCDPEM4",6,0)
 N RTYPE
"RTN","RCDPEM4",7,0)
 S RTYPE="EOB"
"RTN","RCDPEM4",8,0)
 D EN1
"RTN","RCDPEM4",9,0)
 Q
"RTN","RCDPEM4",10,0)
 ;
"RTN","RCDPEM4",11,0)
POST ; Main entry point for ERA Posted with Paper EOB Report
"RTN","RCDPEM4",12,0)
 N RTYPE
"RTN","RCDPEM4",13,0)
 S RTYPE="ERA"
"RTN","RCDPEM4",14,0)
 D EN1
"RTN","RCDPEM4",15,0)
 Q
"RTN","RCDPEM4",16,0)
 ;
"RTN","RCDPEM4",17,0)
EN1 ;collect filter and device options
"RTN","RCDPEM4",18,0)
 N RCDTRNG,RCRANGE,RCDIV,RCSTA,RCDISP,RCPAGE,STANUM,STANAM,X,Y
"RTN","RCDPEM4",19,0)
 N %ZIS,ZTSK,ZTDESC,ZTSAVE,ZTQUEUED,ZTRTN,POP,RCPROG,VAUTD
"RTN","RCDPEM4",20,0)
 ;Initialize page and start point
"RTN","RCDPEM4",21,0)
 S (RCDTRNG,RCPAGE)=0,RCPROG="RCDPEM4"
"RTN","RCDPEM4",22,0)
 ;Select Date Range for Report
"RTN","RCDPEM4",23,0)
 S RCRANGE=$$DTRNG() Q:RCRANGE=0
"RTN","RCDPEM4",24,0)
 ;Select Filter/Sort by Division
"RTN","RCDPEM4",25,0)
 D STADIV Q:RCDIV=0
"RTN","RCDPEM4",26,0)
 ;Select Display Type
"RTN","RCDPEM4",27,0)
 S RCDISP=$$DISPTY() Q:RCDISP=-1
"RTN","RCDPEM4",28,0)
 ;Display capture information for Excel
"RTN","RCDPEM4",29,0)
 I RCDISP D INFO^RCDPEM6
"RTN","RCDPEM4",30,0)
 ;Select output device
"RTN","RCDPEM4",31,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPEM4",32,0)
 ;Option to queue
"RTN","RCDPEM4",33,0)
 I 'RCDISP,$D(IO("Q")) D  Q
"RTN","RCDPEM4",34,0)
 .S ZTRTN="REPORT^RCDPEM4"
"RTN","RCDPEM4",35,0)
 .S ZTDESC="EDI LOCKBOX PAPER EOB AUDIT REPORT"
"RTN","RCDPEM4",36,0)
 .S ZTSAVE("RC*")="",ZTSAVE("RTYPE")="",ZTSAVE("VAUTD")=""
"RTN","RCDPEM4",37,0)
 .D ^%ZTLOAD
"RTN","RCDPEM4",38,0)
 .I $D(ZTSK) W !!,"Your task number "_ZTSK_" has been queued."
"RTN","RCDPEM4",39,0)
 .E  W !!,"Unable to queue this job."
"RTN","RCDPEM4",40,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEM4",41,0)
 ;
"RTN","RCDPEM4",42,0)
 ;Compile and Print Report
"RTN","RCDPEM4",43,0)
 D REPORT
"RTN","RCDPEM4",44,0)
 Q
"RTN","RCDPEM4",45,0)
 ;
"RTN","RCDPEM4",46,0)
REPORT ;Compile and print report
"RTN","RCDPEM4",47,0)
 K ^TMP(RCPROG,$J)
"RTN","RCDPEM4",48,0)
 ;Scan ERA file for entries in date range
"RTN","RCDPEM4",49,0)
 I RTYPE="ERA" D COMPILE
"RTN","RCDPEM4",50,0)
 ;Scan EOB file for entries in date range
"RTN","RCDPEM4",51,0)
 I RTYPE="EOB" D COMPILE1
"RTN","RCDPEM4",52,0)
 ;Display Report
"RTN","RCDPEM4",53,0)
 D DISP
"RTN","RCDPEM4",54,0)
 ;Clear workfile
"RTN","RCDPEM4",55,0)
 K ^TMP(RCPROG,$J)
"RTN","RCDPEM4",56,0)
 Q
"RTN","RCDPEM4",57,0)
 ;
"RTN","RCDPEM4",58,0)
COMPILE ;Generate the ERA posted with paper EOB report ^TMP array
"RTN","RCDPEM4",59,0)
 N START,END,ERAIEN,STA,STNAM,STNUM
"RTN","RCDPEM4",60,0)
 ;Date Range
"RTN","RCDPEM4",61,0)
 S START=0,END="9999999",SUB=0
"RTN","RCDPEM4",62,0)
 S:$P(RCRANGE,U) START=$P(RCRANGE,U,2),END=$P(RCRANGE,U,3)
"RTN","RCDPEM4",63,0)
 ;Selected division or All
"RTN","RCDPEM4",64,0)
 ;Scan AFL index for ERA within date range
"RTN","RCDPEM4",65,0)
 F  S START=$O(^RCY(344.4,"AFL",START)) Q:'START  Q:(START\1)>END  D
"RTN","RCDPEM4",66,0)
 .S ERAIEN=""
"RTN","RCDPEM4",67,0)
 .F  S ERAIEN=$O(^RCY(344.4,"AFL",START,ERAIEN)) Q:'ERAIEN  D
"RTN","RCDPEM4",68,0)
 ..;Ignore if not posted with paper EOB
"RTN","RCDPEM4",69,0)
 ..Q:'$D(^RCY(344.4,ERAIEN,7))
"RTN","RCDPEM4",70,0)
 ..;Check division
"RTN","RCDPEM4",71,0)
 ..D ERASTA(ERAIEN,.STA,.STNUM,.STNAM)
"RTN","RCDPEM4",72,0)
 ..I RCDIV=2,'$D(VAUTD(STA)) Q
"RTN","RCDPEM4",73,0)
 ..;Save to workfile
"RTN","RCDPEM4",74,0)
 ..D SAVE(ERAIEN,STA,STNUM,STNAM)
"RTN","RCDPEM4",75,0)
 ;
"RTN","RCDPEM4",76,0)
 Q
"RTN","RCDPEM4",77,0)
 ;
"RTN","RCDPEM4",78,0)
SAVE(ERAIEN,STA,STNUM,STNAM) ;Put the data into the ^TMP global
"RTN","RCDPEM4",79,0)
 ; INPUTS: ERAIEN = ien of the ERA
"RTN","RCDPEM4",80,0)
 ;         STNUM= station IEN
"RTN","RCDPEM4",81,0)
 ; RETURNS  : Builds each entry in the ^TMP global
"RTN","RCDPEM4",82,0)
 ;
"RTN","RCDPEM4",83,0)
 N SUB,GLOB,CNT,USER,DATE,Y,DEPO,ERA,REC0,REC7,MATCH,POST
"RTN","RCDPEM4",84,0)
 S REC0=$G(^RCY(344.4,ERAIEN,0))
"RTN","RCDPEM4",85,0)
 S REC7=$G(^RCY(344.4,ERAIEN,7))
"RTN","RCDPEM4",86,0)
 ;User marked ERA as posted to paper EOB
"RTN","RCDPEM4",87,0)
 S USER=$P(REC7,U,2)
"RTN","RCDPEM4",88,0)
 S USER=$$NAME^XUSER(USER,"F")
"RTN","RCDPEM4",89,0)
 ;Date/Time ERA was marked posted 
"RTN","RCDPEM4",90,0)
 S DATE=$$FMTE^XLFDT($P(REC7,U),"2S")
"RTN","RCDPEM4",91,0)
 ;ERA number
"RTN","RCDPEM4",92,0)
 S ERA=$P(REC0,U)
"RTN","RCDPEM4",93,0)
 ;Deposit
"RTN","RCDPEM4",94,0)
 S DEPO=$P(REC0,U,8),DEPO=$$EXTERNAL^DILFD(344.4,.08,,DEPO)
"RTN","RCDPEM4",95,0)
 ;EFT Match Status
"RTN","RCDPEM4",96,0)
 S MATCH=$P(REC0,U,9),MATCH=$$EXTERNAL^DILFD(344.4,.09,,MATCH)
"RTN","RCDPEM4",97,0)
 ;Detail Post Status
"RTN","RCDPEM4",98,0)
 S POST=$P(REC0,U,14),POST=$$EXTERNAL^DILFD(344.4,.14,,POST)
"RTN","RCDPEM4",99,0)
 ;Update workfile
"RTN","RCDPEM4",100,0)
 S SUB=$S(RCDIV=2:"DIV",1:"ALL"),GLOB=$NA(^TMP(RCPROG,$J))
"RTN","RCDPEM4",101,0)
 ;sorting is done in EXCEL - else use STA as subscript
"RTN","RCDPEM4",102,0)
 S CNT=$G(@GLOB@(SUB))+1,@GLOB@(SUB)=CNT
"RTN","RCDPEM4",103,0)
 S @GLOB@(SUB,CNT)=STNAM_U_STNUM_U_DATE_U_USER_U_ERA_U_DEPO_U_MATCH_U_POST
"RTN","RCDPEM4",104,0)
 Q
"RTN","RCDPEM4",105,0)
 ;
"RTN","RCDPEM4",106,0)
COMPILE1 ;Generate the EOB Moved/Copy report ^TMP array
"RTN","RCDPEM4",107,0)
 N DTSUB,START,END,EOBIEN,IEN101,STA,STNAM,STNUM
"RTN","RCDPEM4",108,0)
 ;Date Range
"RTN","RCDPEM4",109,0)
 S START=0,END="9999999"
"RTN","RCDPEM4",110,0)
 S:$P(RCRANGE,U) START=$P(RCRANGE,U,2),END=$P(RCRANGE,U,3)
"RTN","RCDPEM4",111,0)
 ;Selected division or All
"RTN","RCDPEM4",112,0)
 ;Scan AEOB index for EOB within date range
"RTN","RCDPEM4",113,0)
 F  S START=$O(^IBM(361.1,"AEOB",START)) Q:'START  Q:(START\1)>END  D
"RTN","RCDPEM4",114,0)
 .S EOBIEN=""
"RTN","RCDPEM4",115,0)
 .F  S EOBIEN=$O(^IBM(361.1,"AEOB",START,EOBIEN)) Q:'EOBIEN  D
"RTN","RCDPEM4",116,0)
 ..;Ignore if not MOVED/COPIED
"RTN","RCDPEM4",117,0)
 ..S IEN101=$O(^IBM(361.1,"AEOB",START,EOBIEN,"")) Q:'IEN101
"RTN","RCDPEM4",118,0)
 ..;Check division
"RTN","RCDPEM4",119,0)
 ..D EOBSTA(EOBIEN,.STA,.STNUM,.STNAM)
"RTN","RCDPEM4",120,0)
 ..I RCDIV=2,'$D(VAUTD(STA)) Q
"RTN","RCDPEM4",121,0)
 ..;Save to workfile
"RTN","RCDPEM4",122,0)
 ..D SAVE1(EOBIEN,IEN101,STA,STNUM,STNAM)
"RTN","RCDPEM4",123,0)
 Q
"RTN","RCDPEM4",124,0)
 ;
"RTN","RCDPEM4",125,0)
 ;
"RTN","RCDPEM4",126,0)
SAVE1(EOBIEN,IEN101,STA,STNUM,STNAM) ;Put the data into the ^TMP global
"RTN","RCDPEM4",127,0)
 ; INPUTS: EOBIEN = ien of the EOB
"RTN","RCDPEM4",128,0)
 ;         STNUM= station ien
"RTN","RCDPEM4",129,0)
 ; RETURNS  : Builds each entry in the ^TMP global
"RTN","RCDPEM4",130,0)
 ;
"RTN","RCDPEM4",131,0)
 N GLOB,CNT,SUB
"RTN","RCDPEM4",132,0)
 N USER,DATE,Y,DEPO,REC101,JUST,ORIG,TRACE,ERA,PAYAMT,OTHER,NBILL,X,ACTION
"RTN","RCDPEM4",133,0)
 S REC101=$G(^IBM(361.1,EOBIEN,101,IEN101,0))
"RTN","RCDPEM4",134,0)
 ;User who did MOVE/COPY
"RTN","RCDPEM4",135,0)
 S USER=$P(REC101,U,2)
"RTN","RCDPEM4",136,0)
 S USER=$$NAME^XUSER(USER,"F")
"RTN","RCDPEM4",137,0)
 ;Date/Time ERA was marked posted 
"RTN","RCDPEM4",138,0)
 S DATE=$$FMTE^XLFDT($P(REC101,U),"2S")
"RTN","RCDPEM4",139,0)
 ;Justification comment
"RTN","RCDPEM4",140,0)
 S JUST=$P(REC101,U,3)
"RTN","RCDPEM4",141,0)
 ;Moved or Copied
"RTN","RCDPEM4",142,0)
 S ACTION=$S($P(REC101,U,5)="C":"COPIED",$P(REC101,U,5)="M":"MOVED",1:"")
"RTN","RCDPEM4",143,0)
 ;Original bill pointer
"RTN","RCDPEM4",144,0)
 S ORIG=$P(REC101,U,4)
"RTN","RCDPEM4",145,0)
 ;Ignore if original bill is null (this is EOB copied from)
"RTN","RCDPEM4",146,0)
 Q:'ORIG
"RTN","RCDPEM4",147,0)
 ;Get claim number from pointer
"RTN","RCDPEM4",148,0)
 S ORIG=$$EXTERNAL^DILFD(361.1,.01,,ORIG)
"RTN","RCDPEM4",149,0)
 S X=$O(^PRCA(430,"D",ORIG,""))
"RTN","RCDPEM4",150,0)
 I $G(X) S X=$P($G(^PRCA(430,X,0)),U) I X'="" S ORIG=$TR(X,"-","")
"RTN","RCDPEM4",151,0)
 ;New Bill (only displayed for a move)
"RTN","RCDPEM4",152,0)
 S NBILL=$$EXTERNAL^DILFD(361.1,.01,,$P($G(^IBM(361.1,EOBIEN,0)),U))
"RTN","RCDPEM4",153,0)
 ;Paid Amount
"RTN","RCDPEM4",154,0)
 S PAYAMT=$P($G(^IBM(361.1,EOBIEN,1)),U)
"RTN","RCDPEM4",155,0)
 ;Trace Number
"RTN","RCDPEM4",156,0)
 S TRACE=$P($G(^IBM(361.1,EOBIEN,0)),U,7),ERA=""
"RTN","RCDPEM4",157,0)
 ;ERA number
"RTN","RCDPEM4",158,0)
 S:TRACE]"" ERA=$O(^RCY(344.4,"D",TRACE,""))
"RTN","RCDPEM4",159,0)
 ;Other bill numbers
"RTN","RCDPEM4",160,0)
 S OTHER=$$OTHER(EOBIEN,IEN101)
"RTN","RCDPEM4",161,0)
 ;
"RTN","RCDPEM4",162,0)
 ;Update workfile
"RTN","RCDPEM4",163,0)
 S SUB=$S(RCDIV=2:"DIV",1:"ALL"),GLOB=$NA(^TMP(RCPROG,$J))
"RTN","RCDPEM4",164,0)
 ;sorting is done in EXCEL - else use STA as subscript
"RTN","RCDPEM4",165,0)
 S CNT=$G(@GLOB@(SUB))+1,@GLOB@(SUB)=CNT
"RTN","RCDPEM4",166,0)
 S @GLOB@(SUB,CNT)=STNAM_U_STNUM_U_DATE_U_USER_U_ORIG_U_NBILL_U_ERA
"RTN","RCDPEM4",167,0)
 S @GLOB@(SUB,CNT)=@GLOB@(SUB,CNT)_U_TRACE_U_PAYAMT_U_JUST_U_OTHER_U_ACTION
"RTN","RCDPEM4",168,0)
 Q
"RTN","RCDPEM4",169,0)
 ;
"RTN","RCDPEM4",170,0)
OTHER(EOBIEN,IEN101) ;Build list of bill numbers
"RTN","RCDPEM4",171,0)
 N SUB,NBILL,STR,FOUND
"RTN","RCDPEM4",172,0)
 S SUB=0,FOUND=0,STR=""
"RTN","RCDPEM4",173,0)
 F  S SUB=$O(^IBM(361.1,EOBIEN,101,IEN101,1,SUB)) Q:'SUB  D
"RTN","RCDPEM4",174,0)
 .S NBILL=$G(^IBM(361.1,EOBIEN,101,IEN101,1,SUB,0)) Q:'NBILL
"RTN","RCDPEM4",175,0)
 .S NBILL=$$EXTERNAL^DILFD(361.1,.01,,NBILL)
"RTN","RCDPEM4",176,0)
 .I FOUND S STR=STR_", "
"RTN","RCDPEM4",177,0)
 .S STR=STR_NBILL,FOUND=1
"RTN","RCDPEM4",178,0)
 S:'FOUND STR=STR_"NONE"
"RTN","RCDPEM4",179,0)
 Q STR
"RTN","RCDPEM4",180,0)
 ;
"RTN","RCDPEM4",181,0)
DISP ; Format the display for screen/printer or MS Excel
"RTN","RCDPEM4",182,0)
 N FILTER,IEN,RCSTOP,SUB
"RTN","RCDPEM4",183,0)
 ;
"RTN","RCDPEM4",184,0)
 ;Open device
"RTN","RCDPEM4",185,0)
 U IO
"RTN","RCDPEM4",186,0)
 ;
"RTN","RCDPEM4",187,0)
 ;Report by division or 'ALL'
"RTN","RCDPEM4",188,0)
 ;Format Division Filter
"RTN","RCDPEM4",189,0)
 S FILTER=$S(RTYPE="EOB":"ALL STATIONS/DIVISIONS",1:"ALL") I RCDIV=2 S FILTER=$$LINE(.VAUTD)
"RTN","RCDPEM4",190,0)
 S SUB="",RCSTOP=0
"RTN","RCDPEM4",191,0)
 F  S SUB=$O(^TMP(RCPROG,$J,SUB)) Q:SUB=""  D  Q:RCSTOP
"RTN","RCDPEM4",192,0)
 .;Display Header
"RTN","RCDPEM4",193,0)
 .D HDR(RCDISP,RTYPE,.VAUTD)
"RTN","RCDPEM4",194,0)
 .;
"RTN","RCDPEM4",195,0)
 .S IEN=""
"RTN","RCDPEM4",196,0)
 .F  S IEN=$O(^TMP(RCPROG,$J,SUB,IEN)) Q:'IEN  D  Q:RCSTOP
"RTN","RCDPEM4",197,0)
 ..I 'RCDISP D  Q:RCSTOP
"RTN","RCDPEM4",198,0)
 ...;ERA posted with paper EOB
"RTN","RCDPEM4",199,0)
 ...I RTYPE="ERA" D
"RTN","RCDPEM4",200,0)
 ....I $Y>(IOSL-3) D HDR(RCDISP,RTYPE,.VAUTD) Q:RCSTOP
"RTN","RCDPEM4",201,0)
 ....W !,$P(^TMP(RCPROG,$J,SUB,IEN),U,5) ;ERA#
"RTN","RCDPEM4",202,0)
 ....W ?11,$P(^TMP(RCPROG,$J,SUB,IEN),U,6) ;RECEIPT#
"RTN","RCDPEM4",203,0)
 ....W ?23,$P(^TMP(RCPROG,$J,SUB,IEN),U,3) ;DATE/TIME
"RTN","RCDPEM4",204,0)
 ....W ?41,$P(^TMP(RCPROG,$J,SUB,IEN),U,4) ;USER LASTNAME,FIRSTNAME
"RTN","RCDPEM4",205,0)
 ....W ?57,$P(^TMP(RCPROG,$J,SUB,IEN),U,7) ;MATCH STATUS
"RTN","RCDPEM4",206,0)
 ....W !,?61,$P(^TMP(RCPROG,$J,SUB,IEN),U,8) ;POST STATUS
"RTN","RCDPEM4",207,0)
 ...;EOB Moved/Copied
"RTN","RCDPEM4",208,0)
 ...I RTYPE="EOB" D
"RTN","RCDPEM4",209,0)
 ....I $Y>(IOSL-6) D HDR(RCDISP,RTYPE,.VAUTD) Q:RCSTOP
"RTN","RCDPEM4",210,0)
 ....W !,$P(^TMP(RCPROG,$J,SUB,IEN),U,5) ;ORIGINAL BILL
"RTN","RCDPEM4",211,0)
 ....W ?20,$P(^TMP(RCPROG,$J,SUB,IEN),U,8) ;TRACE
"RTN","RCDPEM4",212,0)
 ....W !?6,$P(^TMP(RCPROG,$J,SUB,IEN),U,7) ;ERA
"RTN","RCDPEM4",213,0)
 ....W ?15,$P(^TMP(RCPROG,$J,SUB,IEN),U,3) ;DATE/TIME
"RTN","RCDPEM4",214,0)
 ....W ?35,$P(^TMP(RCPROG,$J,SUB,IEN),U,12) ;MOVED/COPIED
"RTN","RCDPEM4",215,0)
 ....W ?50,$P(^TMP(RCPROG,$J,SUB,IEN),U,9) ;PAYMENT AMOUNT
"RTN","RCDPEM4",216,0)
 ....W ?61,$P(^TMP(RCPROG,$J,SUB,IEN),U,4) ; USER LASTNAME,FIRSTNAME
"RTN","RCDPEM4",217,0)
 ....W !,"New Bill: ",$P(^TMP(RCPROG,$J,SUB,IEN),U,6) ;NEW BILL
"RTN","RCDPEM4",218,0)
 ....W ?25,"Other Bill Number(s): "
"RTN","RCDPEM4",219,0)
 ....W $P(^TMP(RCPROG,$J,SUB,IEN),U,11) ;OTHER BILLS
"RTN","RCDPEM4",220,0)
 ....N JUST,DIWL,DIWR,DIWF,X
"RTN","RCDPEM4",221,0)
 ....K ^UTILITY($J,"W")
"RTN","RCDPEM4",222,0)
 ....S JUST=$P(^TMP(RCPROG,$J,SUB,IEN),U,10)
"RTN","RCDPEM4",223,0)
 ....W !,"Justification Comments:  "
"RTN","RCDPEM4",224,0)
 ....I $L(JUST)<54 W JUST,!
"RTN","RCDPEM4",225,0)
 ....E  D
"RTN","RCDPEM4",226,0)
 .....S X=JUST,DIWL=26,DIWR=78,DIWF="W"
"RTN","RCDPEM4",227,0)
 .....D ^DIWP,^DIWW
"RTN","RCDPEM4",228,0)
 ..I RCDISP D
"RTN","RCDPEM4",229,0)
 ...W !,^TMP(RCPROG,$J,SUB,IEN)
"RTN","RCDPEM4",230,0)
 .;
"RTN","RCDPEM4",231,0)
 .I 'RCSTOP W !,"******** END OF REPORT ********",!
"RTN","RCDPEM4",232,0)
 ;
"RTN","RCDPEM4",233,0)
 I '$D(^TMP(RCPROG,$J))&(RTYPE="EOB")&('RCDISP) D
"RTN","RCDPEM4",234,0)
 .D HDR(0,RTYPE,.VAUTD)
"RTN","RCDPEM4",235,0)
 .W !!!!,?26,"*** NO RECORDS TO PRINT ***"
"RTN","RCDPEM4",236,0)
 ;
"RTN","RCDPEM4",237,0)
 I '$D(^TMP(RCPROG,$J))&(RTYPE="ERA")&('RCDISP) D
"RTN","RCDPEM4",238,0)
 .D HDR(0,RTYPE,.VAUTD)
"RTN","RCDPEM4",239,0)
 .W !!!!,?26,"*** NO RECORDS TO PRINT ***"
"RTN","RCDPEM4",240,0)
 ;Close device
"RTN","RCDPEM4",241,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEM4",242,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEM4",243,0)
 Q
"RTN","RCDPEM4",244,0)
 ;
"RTN","RCDPEM4",245,0)
LINE(VAUTD) ;List selected stations
"RTN","RCDPEM4",246,0)
 N LINE,SUB
"RTN","RCDPEM4",247,0)
 S LINE="",SUB=""
"RTN","RCDPEM4",248,0)
 F  S SUB=$O(VAUTD(SUB)) Q:'SUB  D
"RTN","RCDPEM4",249,0)
 .S LINE=LINE_$G(VAUTD(SUB))_", "
"RTN","RCDPEM4",250,0)
 Q $E(LINE,1,$L(LINE)-2)
"RTN","RCDPEM4",251,0)
 ;
"RTN","RCDPEM4",252,0)
SELDIV(VAUTD,Z) ;Devisions are orginized as Z(1)="DIV1,DIV2,..., Z(2)="DIVN,DIVN+1,... etc.
"RTN","RCDPEM4",253,0)
 ; Input:
"RTN","RCDPEM4",254,0)
 ;   VAUTD (required/pass-by-ref) - Division(s) array; result of call to DIVISION^VAUTOMA
"RTN","RCDPEM4",255,0)
 ; Output:
"RTN","RCDPEM4",256,0)
 ;   Z (required/pass-by-ref) - reformatted array of divisions
"RTN","RCDPEM4",257,0)
 ;
"RTN","RCDPEM4",258,0)
 N SUB,CNT
"RTN","RCDPEM4",259,0)
 S CNT=1,Z(CNT)="DIVISIONS: "
"RTN","RCDPEM4",260,0)
 I $D(VAUTD)=1 D  Q
"RTN","RCDPEM4",261,0)
 . S Z(CNT)=Z(CNT)_"ALL"
"RTN","RCDPEM4",262,0)
 . S Z(CNT)=$J("",80-$L(Z(CNT))\2)_Z(CNT)
"RTN","RCDPEM4",263,0)
 I $D(VAUTD)>1,'VAUTD D
"RTN","RCDPEM4",264,0)
 . S SUB=VAUTD
"RTN","RCDPEM4",265,0)
 . F  S SUB=$O(VAUTD(SUB)) Q:'SUB  D
"RTN","RCDPEM4",266,0)
 . . I Z(CNT)="DIVISIONS: " S Z(CNT)=Z(CNT)_VAUTD(SUB) Q
"RTN","RCDPEM4",267,0)
 . . S Z(CNT)=Z(CNT)_$S(Z(CNT)]"":",",1:"")_VAUTD(SUB)
"RTN","RCDPEM4",268,0)
 . . I $L(Z(CNT))>50 D
"RTN","RCDPEM4",269,0)
 . . . S Z(CNT)=$J("",80-$L(Z(CNT))\2)_Z(CNT)
"RTN","RCDPEM4",270,0)
 . . . S CNT=CNT+1,Z(CNT)=""
"RTN","RCDPEM4",271,0)
 I Z(CNT)]"" D
"RTN","RCDPEM4",272,0)
 . S Z(CNT)=$J("",80-$L(Z(CNT))\2)_Z(CNT)
"RTN","RCDPEM4",273,0)
 I Z(CNT)="" K Z(CNT)
"RTN","RCDPEM4",274,0)
 Q
"RTN","RCDPEM4",275,0)
 ;
"RTN","RCDPEM4",276,0)
HDR(RCDISP,TYPE,VAUTD) ; Print the report header
"RTN","RCDPEM4",277,0)
 ; INPUTS: RCDISP - Display/print/Excel flag
"RTN","RCDPEM4",278,0)
 ;         TYPE - Report Type (EOB or ERA)
"RTN","RCDPEM4",279,0)
 N START,END,MSG,DATE,Y,%,DIV,SUB,Z0
"RTN","RCDPEM4",280,0)
 S START=$$FMTE^XLFDT($P(RCRANGE,U,2),2)
"RTN","RCDPEM4",281,0)
 S END=$$FMTE^XLFDT($P(RCRANGE,U,3),2)
"RTN","RCDPEM4",282,0)
 ;
"RTN","RCDPEM4",283,0)
 I 'RCDISP D
"RTN","RCDPEM4",284,0)
 .I RCPAGE D ASK(.RCSTOP,0) Q:RCSTOP
"RTN","RCDPEM4",285,0)
 .S RCPAGE=RCPAGE+1
"RTN","RCDPEM4",286,0)
 .D NOW^%DTC
"RTN","RCDPEM4",287,0)
 .S DATE=$$FMTE^XLFDT(%,"2S")
"RTN","RCDPEM4",288,0)
 .W @IOF
"RTN","RCDPEM4",289,0)
 .I TYPE="ERA" D
"RTN","RCDPEM4",290,0)
 ..S SUB=1
"RTN","RCDPEM4",291,0)
 ..S MSG(SUB)="ERAs Posted with Paper EOB - Audit Report",MSG(SUB)=$J("",80-$L(MSG(SUB))\2)_MSG(SUB)
"RTN","RCDPEM4",292,0)
 ..S MSG(SUB)=MSG(SUB)_"      Page: "_RCPAGE
"RTN","RCDPEM4",293,0)
 ..S SUB=SUB+1
"RTN","RCDPEM4",294,0)
 ..S MSG(SUB)="Run Date: "_DATE,MSG(SUB)=$J("",80-$L(MSG(SUB))\2)_MSG(SUB)
"RTN","RCDPEM4",295,0)
 ..D SELDIV(.VAUTD,.DIV)
"RTN","RCDPEM4",296,0)
 ..S DIV=0
"RTN","RCDPEM4",297,0)
 ..F  S DIV=$O(DIV(DIV)) Q:'DIV  D
"RTN","RCDPEM4",298,0)
 ...S SUB=SUB+1
"RTN","RCDPEM4",299,0)
 ...S MSG(SUB)=DIV(DIV)
"RTN","RCDPEM4",300,0)
 ..S SUB=SUB+1
"RTN","RCDPEM4",301,0)
 ..S MSG(SUB)="Date Range: "_START_" - "_END_" (DATE ERA UPDATED)",MSG(SUB)=$J("",80-$L(MSG(SUB))\2)_MSG(SUB)
"RTN","RCDPEM4",302,0)
 ..S SUB=SUB+1
"RTN","RCDPEM4",303,0)
 ..S MSG(SUB)=" ",SUB=SUB+1
"RTN","RCDPEM4",304,0)
 ..S MSG(SUB)="                       Date/Time         User Who        EFT Match Status"
"RTN","RCDPEM4",305,0)
 ..S SUB=SUB+1
"RTN","RCDPEM4",306,0)
 ..S MSG(SUB)="ERA #      Receipt #   ERA Updated       Updated             Detail Post Status"
"RTN","RCDPEM4",307,0)
 ..S SUB=SUB+1
"RTN","RCDPEM4",308,0)
 ..S MSG(SUB)="==============================================================================="
"RTN","RCDPEM4",309,0)
 .I TYPE="EOB" D
"RTN","RCDPEM4",310,0)
 ..S MSG(1)="                         EEOB Move/Copy - Audit Report "
"RTN","RCDPEM4",311,0)
 ..S MSG(1)=MSG(1)_"        Page: "_RCPAGE
"RTN","RCDPEM4",312,0)
 ..S MSG(2)="                        Run Date/Time: "_DATE
"RTN","RCDPEM4",313,0)
 ..S Z0=FILTER S:VAUTD=1 Z0="ALL" S Z0="DIVISIONS: "_Z0
"RTN","RCDPEM4",314,0)
 ..S MSG(3)=$S($L(Z0)<75:$J("",75-$L(Z0)\2),1:"")_Z0
"RTN","RCDPEM4",315,0)
 ..S MSG(4)="           Date Range: "_START_" - "_END_" (Date EEOB was Moved/Copied)"
"RTN","RCDPEM4",316,0)
 ..S MSG(5)=" "
"RTN","RCDPEM4",317,0)
 ..S MSG(6)="Orig Bill#          Trace #"
"RTN","RCDPEM4",318,0)
 ..S MSG(7)="                                                  Total Amt  User Who"
"RTN","RCDPEM4",319,0)
 ..S MSG(8)="     ERA #     Date/Time       Moved/Copied       Paid       Moved/Copied"
"RTN","RCDPEM4",320,0)
 ..S MSG(9)="=============================================================================="
"RTN","RCDPEM4",321,0)
 .D EN^DDIOL(.MSG)
"RTN","RCDPEM4",322,0)
 I RCDISP,TYPE="ERA" D
"RTN","RCDPEM4",323,0)
 .W !,"STATION^STATION NUMBER^DATE/TIME^USER^ERA^RECEIPT^MATCH STATUS^POSTED STATUS"
"RTN","RCDPEM4",324,0)
 I RCDISP,TYPE="EOB" D
"RTN","RCDPEM4",325,0)
 .W !,"STATION^STATION NUMBER^DATE/TIME^USER^ORIGINAL BILL^NEW BILL^ERA#^TRACE#^PAYMENT AMOUNT^JUSTIFICATION^OTHER BILLS^MOVED/COPIED"
"RTN","RCDPEM4",326,0)
 Q
"RTN","RCDPEM4",327,0)
 ;
"RTN","RCDPEM4",328,0)
ASK(STOP,MODE) ; Ask to continue
"RTN","RCDPEM4",329,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEM4",330,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEM4",331,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEM4",332,0)
 S:MODE=1 DIR("A")="Enter RETURN to finish"
"RTN","RCDPEM4",333,0)
 S DIR(0)="E" D ^DIR
"RTN","RCDPEM4",334,0)
 I ($D(DIRUT))!($D(DUOUT)) S STOP=1
"RTN","RCDPEM4",335,0)
 Q
"RTN","RCDPEM4",336,0)
 ;
"RTN","RCDPEM4",337,0)
INFO ;Useful Info for Excel capture
"RTN","RCDPEM4",338,0)
 W !!!,?10
"RTN","RCDPEM4",339,0)
 W "Before continuing, please set up your terminal to capture the"
"RTN","RCDPEM4",340,0)
 W !,?10
"RTN","RCDPEM4",341,0)
 W "detail report data. On some terminals, this can  be  done  by"
"RTN","RCDPEM4",342,0)
 W !,?10
"RTN","RCDPEM4",343,0)
 W "clicking  on the 'Tools' menu above, then click  on  'Capture"
"RTN","RCDPEM4",344,0)
 w !,?10
"RTN","RCDPEM4",345,0)
 W "Incoming  Data' to save to  Desktop. This  report  may take a"
"RTN","RCDPEM4",346,0)
 W !,?10
"RTN","RCDPEM4",347,0)
 W "while to run."
"RTN","RCDPEM4",348,0)
 W !!,?10
"RTN","RCDPEM4",349,0)
 W "Note: To avoid  undesired  wrapping of the data  saved to the"
"RTN","RCDPEM4",350,0)
 W !,?10
"RTN","RCDPEM4",351,0)
 W "      file, please enter '0;256;999' at the 'DEVICE:' prompt."
"RTN","RCDPEM4",352,0)
 W !!,?10
"RTN","RCDPEM4",353,0)
 W "      Also, set the terminal display width to 256 characters."
"RTN","RCDPEM4",354,0)
 W !,?10
"RTN","RCDPEM4",355,0)
 W "      On some terminals, this can be done by  clicking on the"
"RTN","RCDPEM4",356,0)
 W !,?10
"RTN","RCDPEM4",357,0)
 W "      'Setup' menu above, then click on  'Display' to  change"
"RTN","RCDPEM4",358,0)
 W !,?10
"RTN","RCDPEM4",359,0)
 W "      width to 256 characters"
"RTN","RCDPEM4",360,0)
 W !!
"RTN","RCDPEM4",361,0)
 Q
"RTN","RCDPEM4",362,0)
 ;
"RTN","RCDPEM4",363,0)
DTRNG() ; Get the date range for the report
"RTN","RCDPEM4",364,0)
 N DIR,DUOUT,RNGFLG,X,Y,RCSTART,RCEND
"RTN","RCDPEM4",365,0)
 D DATES(.RCSTART,.RCEND)
"RTN","RCDPEM4",366,0)
 Q:RCSTART=-1 0
"RTN","RCDPEM4",367,0)
 Q:RCSTART "1^"_RCSTART_"^"_RCEND
"RTN","RCDPEM4",368,0)
 Q:'RCSTART "0^^"
"RTN","RCDPEM4",369,0)
 Q 0
"RTN","RCDPEM4",370,0)
 ;
"RTN","RCDPEM4",371,0)
DATES(BDATE,EDATE) ;Get a date range.
"RTN","RCDPEM4",372,0)
 S (BDATE,EDATE)=0
"RTN","RCDPEM4",373,0)
 S DIR("?")="ENTER THE EARLIEST DATE OF RECEIPT OF DEPOSIT TO INCLUDE ON THE REPORT"
"RTN","RCDPEM4",374,0)
 S DIR(0)="DAO^:"_DT_":APE",DIR("A")="START DATE: " D ^DIR K DIR
"RTN","RCDPEM4",375,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") S BDATE=-1 Q
"RTN","RCDPEM4",376,0)
 S BDATE=Y
"RTN","RCDPEM4",377,0)
 S DIR("?")="ENTER THE LATEST DATE OF RECEIPT OF DEPOSIT TO INCLUDE ON THE REPORT"
"RTN","RCDPEM4",378,0)
 S DIR("B")=Y(0)
"RTN","RCDPEM4",379,0)
 S DIR(0)="DAO^"_BDATE_":"_DT_":APE",DIR("A")="END DATE: " D ^DIR K DIR
"RTN","RCDPEM4",380,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") S BDATE=-1 Q
"RTN","RCDPEM4",381,0)
 S EDATE=Y
"RTN","RCDPEM4",382,0)
 Q
"RTN","RCDPEM4",383,0)
 ;
"RTN","RCDPEM4",384,0)
STADIV ;Division/Station Filter/Sort
"RTN","RCDPEM4",385,0)
 ;
"RTN","RCDPEM4",386,0)
 ;Sort selection
"RTN","RCDPEM4",387,0)
 N DIR,DUOUT,Y
"RTN","RCDPEM4",388,0)
 S RCDIV=0
"RTN","RCDPEM4",389,0)
 ;
"RTN","RCDPEM4",390,0)
 ;Division selection - IA 664
"RTN","RCDPEM4",391,0)
 ;RETURNS Y=-1 (quit), Y=0 (for all),Y=1 (selected divisions in VAUTD)
"RTN","RCDPEM4",392,0)
 D DIVISION^VAUTOMA Q:Y<0
"RTN","RCDPEM4",393,0)
 ;
"RTN","RCDPEM4",394,0)
 ;If ALL selected
"RTN","RCDPEM4",395,0)
 I Y=0 S RCDIV=1 Q
"RTN","RCDPEM4",396,0)
 ;If some DIVISIONS selected
"RTN","RCDPEM4",397,0)
 S RCDIV=2
"RTN","RCDPEM4",398,0)
 Q
"RTN","RCDPEM4",399,0)
 ;
"RTN","RCDPEM4",400,0)
DISPTY() ; Get display/output type
"RTN","RCDPEM4",401,0)
 N DIR,DUOUT,Y
"RTN","RCDPEM4",402,0)
 S DIR(0)="Y"
"RTN","RCDPEM4",403,0)
 S DIR("A")="Export the report to Microsoft Excel"
"RTN","RCDPEM4",404,0)
 S DIR("B")="NO"
"RTN","RCDPEM4",405,0)
 D ^DIR I $G(DUOUT) Q -1
"RTN","RCDPEM4",406,0)
 Q Y
"RTN","RCDPEM4",407,0)
 ;
"RTN","RCDPEM4",408,0)
ERASTA(ERAIEN,STA,STNUM,STNAM) ; Get the station for this ERA
"RTN","RCDPEM4",409,0)
 ;Allowed read on 399 via IA 3820
"RTN","RCDPEM4",410,0)
 N ERAEOB,ERABILL,STAIEN
"RTN","RCDPEM4",411,0)
 S (ERAEOB,ERABILL)=""
"RTN","RCDPEM4",412,0)
 S (STA,STNUM,STNAM)="UNKNOWN"
"RTN","RCDPEM4",413,0)
 D
"RTN","RCDPEM4",414,0)
 .S ERAEOB=$P(^RCY(344.4,ERAIEN,1,1,0),U,2) Q:'ERAEOB
"RTN","RCDPEM4",415,0)
 .S ERABILL=$P(^IBM(361.1,ERAEOB,0),U,1) Q:'ERABILL
"RTN","RCDPEM4",416,0)
 .S STAIEN=$P(^DGCR(399,ERABILL,0),U,22) Q:'STAIEN
"RTN","RCDPEM4",417,0)
 .S STA=STAIEN
"RTN","RCDPEM4",418,0)
 .S STNAM=$$EXTERNAL^DILFD(399,.22,,STA)
"RTN","RCDPEM4",419,0)
 .S STNUM=$P($G(^DG(40.8,STAIEN,0)),U,2) ;IA 417
"RTN","RCDPEM4",420,0)
 Q
"RTN","RCDPEM4",421,0)
 ;
"RTN","RCDPEM4",422,0)
EOBSTA(EOBIEN,STA,STNUM,STNAM) ; Get the station for this EOB
"RTN","RCDPEM4",423,0)
 ;Allowed read on 399 via IA 3820
"RTN","RCDPEM4",424,0)
 N BILL,STAIEN
"RTN","RCDPEM4",425,0)
 S (BILL)=""
"RTN","RCDPEM4",426,0)
 S (STA,STNUM,STNAM)="UNKNOWN"
"RTN","RCDPEM4",427,0)
 D
"RTN","RCDPEM4",428,0)
 .S BILL=$P(^IBM(361.1,EOBIEN,0),U,1) Q:'BILL
"RTN","RCDPEM4",429,0)
 .S STAIEN=$P($G(^DGCR(399,BILL,0)),U,22) Q:'STAIEN
"RTN","RCDPEM4",430,0)
 .S STA=STAIEN
"RTN","RCDPEM4",431,0)
 .S STNAM=$$EXTERNAL^DILFD(399,.22,,STA)
"RTN","RCDPEM4",432,0)
 .S STNUM=$P($G(^DG(40.8,STAIEN,0)),U,2) ;IA 417
"RTN","RCDPEM4",433,0)
 Q
"RTN","RCDPEM4",434,0)
 ;
"RTN","RCDPEM4",435,0)
DTPRB() ; Get the Start Date type
"RTN","RCDPEM4",436,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","RCDPEM4",437,0)
 S DIR(0)="SBO^P:Date Returned to Payer;R:Date ERA Received;B:Both Dates"
"RTN","RCDPEM4",438,0)
 S DIR("A")="Select Start Date"
"RTN","RCDPEM4",439,0)
 D ^DIR K DIR
"RTN","RCDPEM4",440,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") S Y=0
"RTN","RCDPEM4",441,0)
 Q Y
"RTN","RCDPEM5")
0^42^B72301084^n/a
"RTN","RCDPEM5",1,0)
RCDPEM5 ;ALB/PJH - EPAYMENTS MOVE EEOB TO NEW CLAIM ;9/5/11 11:48pm
"RTN","RCDPEM5",2,0)
 ;;4.5;Accounts Receivable;**173,208,276**;Mar 20, 1995;Build 87
"RTN","RCDPEM5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM5",4,0)
 Q
"RTN","RCDPEM5",5,0)
 ;
"RTN","RCDPEM5",6,0)
EN ;Entry point for EEOB Move/Copy Option
"RTN","RCDPEM5",7,0)
 ;
"RTN","RCDPEM5",8,0)
 N DIR,X,Y,DIROUT,DUOUT,MODE
"RTN","RCDPEM5",9,0)
 S DIR("A")="Select action"
"RTN","RCDPEM5",10,0)
 S DIR("B")="M"
"RTN","RCDPEM5",11,0)
 S DIR(0)="S^M:Move EEOB to different claim;"
"RTN","RCDPEM5",12,0)
 S DIR(0)=DIR(0)_"C:Copy EEOB to multiple claims"
"RTN","RCDPEM5",13,0)
 D ^DIR Q:$G(DIROUT)!$G(DUOUT)
"RTN","RCDPEM5",14,0)
 S MODE=Y
"RTN","RCDPEM5",15,0)
 ;
"RTN","RCDPEM5",16,0)
 ;Read access to file #361.1 under IA 4051
"RTN","RCDPEM5",17,0)
 ;
"RTN","RCDPEM5",18,0)
 N DIC,DIE,DIR,DA,DR,X,Y,ORIG,ORIGNAM,NCLAIM
"RTN","RCDPEM5",19,0)
 ;
"RTN","RCDPEM5",20,0)
 ;Allow selection of a original third party EOB
"RTN","RCDPEM5",21,0)
 S DIC("A")="Select EXPLANATION OF BENEFIT (EEOB) to "_$S(MODE="M":"MOVE",1:"COPY")_": "
"RTN","RCDPEM5",22,0)
 S DIC("S")="I $P(^(0),U,4)=0",DIC="^IBM(361.1,",DIC(0)="AEMQ"
"RTN","RCDPEM5",23,0)
 W ! D ^DIC K DIC
"RTN","RCDPEM5",24,0)
 ;
"RTN","RCDPEM5",25,0)
 I Y'>0 Q
"RTN","RCDPEM5",26,0)
 ; controlled subscription 1992
"RTN","RCDPEM5",27,0)
 S ORIG=+Y,ORIGNAM=$$GET1^DIQ(399,$P(Y,U,2),.01)
"RTN","RCDPEM5",28,0)
 ;
"RTN","RCDPEM5",29,0)
 ;Get current bill payer sequence from claim - IA 3820
"RTN","RCDPEM5",30,0)
 D
"RTN","RCDPEM5",31,0)
 .N CURR,IEN399
"RTN","RCDPEM5",32,0)
 .S IEN399=$P($G(^IBM(361.1,ORIG,0)),U) Q:'IEN399
"RTN","RCDPEM5",33,0)
 .S CURR=$P($G(^DGCR(399,IEN399,0)),U,21) I (CURR'="T")&(CURR'="S") Q
"RTN","RCDPEM5",34,0)
 .W !!,"Warning - selected EOB has secondary claims and may have tertiary claims"
"RTN","RCDPEM5",35,0)
 ;
"RTN","RCDPEM5",36,0)
 ;Lock Original EOB
"RTN","RCDPEM5",37,0)
 Q:'$$LOCK^IBCEOB4(ORIG)
"RTN","RCDPEM5",38,0)
 ;
"RTN","RCDPEM5",39,0)
 ;Select Claim(s) to Move/Copy to
"RTN","RCDPEM5",40,0)
 N RCBILL,RCBILLNM,NCLAIM,NCLAIMX,QUIT,SUB,LIT
"RTN","RCDPEM5",41,0)
 S SUB=0,QUIT=0,LIT=""
"RTN","RCDPEM5",42,0)
 W !
"RTN","RCDPEM5",43,0)
 F  D  Q:QUIT  Q:SUB&(MODE="M")
"RTN","RCDPEM5",44,0)
 .;Allow selection of a third party claim
"RTN","RCDPEM5",45,0)
 .I MODE="M" S DIC("A")="Select A/R Bill to MOVE to: "
"RTN","RCDPEM5",46,0)
 .I MODE="C" S DIC("A")="Select "_LIT_"A/R Bill to COPY to: "
"RTN","RCDPEM5",47,0)
 .S DIC="^PRCA(430,",DIC(0)="AEMQ",DIC("S")="I $D(^DGCR(399,+Y,0))&($$VALSTAT^RCDPEM5(+Y))"
"RTN","RCDPEM5",48,0)
 .D ^DIC K DIC
"RTN","RCDPEM5",49,0)
 .I Y'>0 S QUIT=1 Q
"RTN","RCDPEM5",50,0)
 .;
"RTN","RCDPEM5",51,0)
 .S RCBILL=+Y,RCBILLNM=$P($P(Y,U,2),"-",2)
"RTN","RCDPEM5",52,0)
 .I ORIGNAM=RCBILLNM,MODE="M" W !,"Cannot move EEOB to same claim" Q
"RTN","RCDPEM5",53,0)
 .I $D(NCLAIMX(RCBILL)) W !,"Claim already entered" Q
"RTN","RCDPEM5",54,0)
 .S SUB=SUB+1,NCLAIM(SUB)=RCBILL,NCLAIMX(RCBILL)=""
"RTN","RCDPEM5",55,0)
 .S:MODE="C" LIT="another "
"RTN","RCDPEM5",56,0)
 ;
"RTN","RCDPEM5",57,0)
 I $G(DUOUT)!$G(DIROUT) D EXIT Q
"RTN","RCDPEM5",58,0)
 ;
"RTN","RCDPEM5",59,0)
 ;User Exit or no claims selected
"RTN","RCDPEM5",60,0)
 I '$O(NCLAIM("")) D EXIT Q
"RTN","RCDPEM5",61,0)
 ;
"RTN","RCDPEM5",62,0)
 ;Prompt user to continue
"RTN","RCDPEM5",63,0)
 N DIR,X,Y,DIROUT
"RTN","RCDPEM5",64,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","RCDPEM5",65,0)
 S DIR("A")=$$PROMPT(ORIG,.NCLAIM,MODE)
"RTN","RCDPEM5",66,0)
 W ! D ^DIR
"RTN","RCDPEM5",67,0)
 ;
"RTN","RCDPEM5",68,0)
 I $G(DIROUT)!$G(DUOUT)!(Y=0) D EXIT Q
"RTN","RCDPEM5",69,0)
 ;
"RTN","RCDPEM5",70,0)
 ;Enter Justification Comment
"RTN","RCDPEM5",71,0)
 N DIR,DIROUT,DUOUT,JCOM,X,Y
"RTN","RCDPEM5",72,0)
 S DIR(0)="FA^1:100^K:$TR(X,"" "","""")="""" X",DIR("A")="Enter JUSTIFICATION COMMENT: "
"RTN","RCDPEM5",73,0)
 W ! D ^DIR I $G(DIROUT)!$G(DUOUT) W !!,"Update not performed" D EXIT Q
"RTN","RCDPEM5",74,0)
 S JCOM=Y
"RTN","RCDPEM5",75,0)
 ;
"RTN","RCDPEM5",76,0)
 ;Update EOB
"RTN","RCDPEM5",77,0)
 D UPDATE(ORIG,.NCLAIM,MODE,JCOM),EXIT
"RTN","RCDPEM5",78,0)
 ;
"RTN","RCDPEM5",79,0)
 Q
"RTN","RCDPEM5",80,0)
 ;
"RTN","RCDPEM5",81,0)
 ;Unlock original EOB
"RTN","RCDPEM5",82,0)
EXIT D UNLOCK^IBCEOB4(ORIG)
"RTN","RCDPEM5",83,0)
 Q
"RTN","RCDPEM5",84,0)
 ;
"RTN","RCDPEM5",85,0)
 ;File EOB #361.1 changes - Integration Agreement 5671 for IBCEOB4
"RTN","RCDPEM5",86,0)
UPDATE(ORIG,NCLAIM,MODE,JUST) ;
"RTN","RCDPEM5",87,0)
 N JUST1
"RTN","RCDPEM5",88,0)
 ;Timestamp
"RTN","RCDPEM5",89,0)
 N %,DTME D NOW^%DTC S DTME=%  ;kml prevent "%" getting clobbered
"RTN","RCDPEM5",90,0)
 ;Move EOB
"RTN","RCDPEM5",91,0)
 I MODE="M" D
"RTN","RCDPEM5",92,0)
 .;Auto generate text for AR comments on original claim
"RTN","RCDPEM5",93,0)
 .S JUST1=$$JUST1(ORIG,.NCLAIM,"M",0)
"RTN","RCDPEM5",94,0)
 .;Update AR Comments on the 'from bill'
"RTN","RCDPEM5",95,0)
 .D AUDIT^RCDPAYER(ORIG,JUST_"^"_JUST1,MODE)
"RTN","RCDPEM5",96,0)
 .;Change claim number on EEOB
"RTN","RCDPEM5",97,0)
 .D MOVE^IBCEOB4(ORIG,NCLAIM(1),DUZ,DTME,JUST,MODE)
"RTN","RCDPEM5",98,0)
 .;Update AR Comments on 'to bill'
"RTN","RCDPEM5",99,0)
 .D AUDIT^RCDPAYER(ORIG,JUST_"^"_JUST1,MODE)
"RTN","RCDPEM5",100,0)
 ;Copy EOB
"RTN","RCDPEM5",101,0)
 I MODE="C" D
"RTN","RCDPEM5",102,0)
 .D COPY^IBCEOB4(ORIG,.NCLAIM,DUZ,DTME,JUST,MODE)
"RTN","RCDPEM5",103,0)
 .;Auto generate text for AR comments on original claim
"RTN","RCDPEM5",104,0)
 .S JUST1=$$JUST1(ORIG,.NCLAIM,"C",0)
"RTN","RCDPEM5",105,0)
 .;Update AR Comments on original claim
"RTN","RCDPEM5",106,0)
 .D AUDIT^RCDPAYER(ORIG,JUST_"^"_JUST1,MODE)
"RTN","RCDPEM5",107,0)
 .;Auto generate text for AR comments on new claim
"RTN","RCDPEM5",108,0)
 .S JUST1=$$JUST1(ORIG,.NCLAIM,"C",1)
"RTN","RCDPEM5",109,0)
 .;Update AR Comments on new claims
"RTN","RCDPEM5",110,0)
 .N SUB,NEWEOB
"RTN","RCDPEM5",111,0)
 .S SUB=0
"RTN","RCDPEM5",112,0)
 .F  S SUB=$O(NCLAIM(SUB)) Q:'SUB  D
"RTN","RCDPEM5",113,0)
 ..;Convert Claim pointer to EOB pointer
"RTN","RCDPEM5",114,0)
 ..S NEWEOB=$O(^IBM(361.1,"B",NCLAIM(SUB),0)) Q:'NEWEOB
"RTN","RCDPEM5",115,0)
 ..D AUDIT^RCDPAYER(NEWEOB,JUST_"^"_JUST1,MODE)
"RTN","RCDPEM5",116,0)
 W !!,"EEOB Update Complete" H 1
"RTN","RCDPEM5",117,0)
 Q
"RTN","RCDPEM5",118,0)
 ;
"RTN","RCDPEM5",119,0)
 ;Called from Worklist/Scratchpad option Split/Edit FILESP^RCDPEWL8
"RTN","RCDPEM5",120,0)
UPDWL(OBILL,RCSPLIT,RCERA) ;
"RTN","RCDPEM5",121,0)
 N NCLAIM,SUB,SUB1,NBILL,ORIG,MOVE,JUST,JUST1,DTME,VALID
"RTN","RCDPEM5",122,0)
 ;Find EOB for the claim
"RTN","RCDPEM5",123,0)
 S ORIG=$$FINDEOB(RCERA,OBILL) I 'ORIG Q 1
"RTN","RCDPEM5",124,0)
 ;Default operation is move
"RTN","RCDPEM5",125,0)
 S (SUB,SUB1)=0,MOVE=1,VALID=1
"RTN","RCDPEM5",126,0)
 ;Loop through split lines 
"RTN","RCDPEM5",127,0)
 F  S SUB=$O(RCSPLIT(SUB)) Q:'SUB  D
"RTN","RCDPEM5",128,0)
 .;Bill Number
"RTN","RCDPEM5",129,0)
 .S NBILL=$P(RCSPLIT(SUB),U)
"RTN","RCDPEM5",130,0)
 .;Ignore suspense claims, piece 5 is pointer to AR claim file 430
"RTN","RCDPEM5",131,0)
 .Q:$P(RCSPLIT(SUB),U,5)=""
"RTN","RCDPEM5",132,0)
 .;If original bill is in the array then default operation is copy
"RTN","RCDPEM5",133,0)
 .I OBILL=NBILL S MOVE=0 Q
"RTN","RCDPEM5",134,0)
 .;Save POINTER to AR Claim file 430 (DINUM to 399)
"RTN","RCDPEM5",135,0)
 .S SUB1=SUB1+1,NCLAIM(SUB1)=$P(RCSPLIT(SUB),U,5)
"RTN","RCDPEM5",136,0)
 ;If all copied to claims are suspense no further action needed on EOB
"RTN","RCDPEM5",137,0)
 I SUB1=0 Q 1
"RTN","RCDPEM5",138,0)
 ;Prompt user to continue
"RTN","RCDPEM5",139,0)
 N DIR,X,Y,DIROUT,MODE
"RTN","RCDPEM5",140,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","RCDPEM5",141,0)
 S MODE=$S(MOVE:"M",1:"C")
"RTN","RCDPEM5",142,0)
 S DIR("A")=$$PROMPT(ORIG,.NCLAIM,MODE)
"RTN","RCDPEM5",143,0)
 W ! D ^DIR
"RTN","RCDPEM5",144,0)
 ;
"RTN","RCDPEM5",145,0)
 I $G(DIROUT)!$G(DUOUT)!(Y=0) D EXIT Q 0
"RTN","RCDPEM5",146,0)
 ;
"RTN","RCDPEM5",147,0)
 ;Lock Original EOB
"RTN","RCDPEM5",148,0)
 I '$$LOCK^IBCEOB4(ORIG) Q 0
"RTN","RCDPEM5",149,0)
 ;
"RTN","RCDPEM5",150,0)
 ;Timestamp
"RTN","RCDPEM5",151,0)
 N % D NOW^%DTC S DTME=% ; kml - fixed undefined with "%" getting clobbered
"RTN","RCDPEM5",152,0)
 ;If original EOB is moved - move original EOB to first new claim
"RTN","RCDPEM5",153,0)
 I MOVE D
"RTN","RCDPEM5",154,0)
 .;Automatic creation of justification text
"RTN","RCDPEM5",155,0)
 .S JUST=$$JUST(ORIG,.NCLAIM,"M",0)
"RTN","RCDPEM5",156,0)
 .;Update AR comments on 'from claim'
"RTN","RCDPEM5",157,0)
 .D AUDIT^RCDPAYER(ORIG,JUST,"W")
"RTN","RCDPEM5",158,0)
 .;Change claim number on EOB
"RTN","RCDPEM5",159,0)
 .D MOVE^IBCEOB4(ORIG,NCLAIM(1),DUZ,DTME,JUST,MODE) Q:SUB1=1
"RTN","RCDPEM5",160,0)
 .;Copy any additional claims to new EOBs
"RTN","RCDPEM5",161,0)
 .N CCLAIM M CCLAIM=NCLAIM K CCLAIM(1)
"RTN","RCDPEM5",162,0)
 .S JUST1=$$JUST(ORIG,.NCLAIM,"M",1)
"RTN","RCDPEM5",163,0)
 .D COPY^IBCEOB4(ORIG,.CCLAIM,DUZ,DTME,JUST1,MODE)
"RTN","RCDPEM5",164,0)
 ;
"RTN","RCDPEM5",165,0)
 ;If original EOB is not moved - copy all new claims to new EOBs
"RTN","RCDPEM5",166,0)
 I 'MOVE D
"RTN","RCDPEM5",167,0)
 .S JUST=$$JUST(ORIG,.NCLAIM,"C",0) ;Just. Text for original EEOB
"RTN","RCDPEM5",168,0)
 .S JUST1=$$JUST(ORIG,.NCLAIM,"C",1) ;Just. Text for copied to EEOB
"RTN","RCDPEM5",169,0)
 .D COPY^IBCEOB4(ORIG,.NCLAIM,DUZ,DTME,JUST,MODE)
"RTN","RCDPEM5",170,0)
 ;
"RTN","RCDPEM5",171,0)
 ;Update AR Comments on 'to claim'
"RTN","RCDPEM5",172,0)
 D AUDIT^RCDPAYER(ORIG,JUST,"W")
"RTN","RCDPEM5",173,0)
 ;
"RTN","RCDPEM5",174,0)
 ;Get list of other copied claims
"RTN","RCDPEM5",175,0)
 N OCLAIM,SUB M OCLAIM=NCLAIM
"RTN","RCDPEM5",176,0)
 ;Ignore first of these claim if this was a move
"RTN","RCDPEM5",177,0)
 I MOVE K OCLAIM(1)
"RTN","RCDPEM5",178,0)
 ;Update AR comments for other claims
"RTN","RCDPEM5",179,0)
 N SUB,NEWEOB
"RTN","RCDPEM5",180,0)
 S SUB=0
"RTN","RCDPEM5",181,0)
 F  S SUB=$O(OCLAIM(SUB)) Q:'SUB  D
"RTN","RCDPEM5",182,0)
 .;Convert Claim pointer to EOB pointer
"RTN","RCDPEM5",183,0)
 .S NEWEOB=$O(^IBM(361.1,"B",OCLAIM(SUB),0)) Q:'NEWEOB
"RTN","RCDPEM5",184,0)
 .D AUDIT^RCDPAYER(NEWEOB,JUST1,"W")
"RTN","RCDPEM5",185,0)
 ;
"RTN","RCDPEM5",186,0)
 W !!,"EEOB Update Complete" H 1
"RTN","RCDPEM5",187,0)
 Q 1
"RTN","RCDPEM5",188,0)
 ;
"RTN","RCDPEM5",189,0)
PROMPT(ORIG,NCLAIM,MODE) ;Construct prompt text
"RTN","RCDPEM5",190,0)
 N FIRST,STR,STR1,SUB,TEXT
"RTN","RCDPEM5",191,0)
 ;Move or copy text
"RTN","RCDPEM5",192,0)
 S TEXT=$$EXTERNAL^DILFD(361.1,.01,,$P($G(^IBM(361.1,ORIG,0)),U))
"RTN","RCDPEM5",193,0)
 I MODE="M" S STR="Move EEOB from claim "_TEXT_" to claim "
"RTN","RCDPEM5",194,0)
 E  S STR="Copy EEOB from claim "_TEXT_" to claim(s) "
"RTN","RCDPEM5",195,0)
 ;Build list of claims
"RTN","RCDPEM5",196,0)
 S STR1="",SUB="",FIRST=1
"RTN","RCDPEM5",197,0)
 F  S SUB=$O(NCLAIM(SUB)) Q:'SUB  D
"RTN","RCDPEM5",198,0)
 .S TEXT=$P($G(^PRCA(430,NCLAIM(SUB),0)),U)
"RTN","RCDPEM5",199,0)
 .I FIRST S STR1=STR1_$P(TEXT,"-",2),FIRST=0 Q
"RTN","RCDPEM5",200,0)
 .S STR1=STR1_", "_$P(TEXT,"-",2)
"RTN","RCDPEM5",201,0)
 ;Return full prompt text
"RTN","RCDPEM5",202,0)
 Q STR_STR1_" "
"RTN","RCDPEM5",203,0)
 ;
"RTN","RCDPEM5",204,0)
JUST(ORIG,NCLAIM,MODE,TYPE) ;Construct justification text for worklist option
"RTN","RCDPEM5",205,0)
 N FIRST,STR,STR1,SUB,TEXT
"RTN","RCDPEM5",206,0)
 ;Original bill numbe
"RTN","RCDPEM5",207,0)
 S TEXT=$$EXTERNAL^DILFD(361.1,.01,,$P($G(^IBM(361.1,ORIG,0)),U))
"RTN","RCDPEM5",208,0)
 ;Justification comment for original EOB
"RTN","RCDPEM5",209,0)
 I TYPE=0 D
"RTN","RCDPEM5",210,0)
 .I MODE="M" S STR="EEOB from claim "_TEXT_" moved to claim "
"RTN","RCDPEM5",211,0)
 .I MODE="C" S STR="EEOB from claim "_TEXT_" copied to claim(s) "
"RTN","RCDPEM5",212,0)
 .;Build list of claims
"RTN","RCDPEM5",213,0)
 .S STR1="",SUB="",FIRST=1
"RTN","RCDPEM5",214,0)
 .F  S SUB=$O(NCLAIM(SUB)) Q:'SUB  D
"RTN","RCDPEM5",215,0)
 ..S TEXT=$P($G(^PRCA(430,NCLAIM(SUB),0)),U)
"RTN","RCDPEM5",216,0)
 ..I FIRST S STR1=STR1_$P(TEXT,"-",2),FIRST=0 Q
"RTN","RCDPEM5",217,0)
 ..S STR1=STR1_", "_$P(TEXT,"-",2)
"RTN","RCDPEM5",218,0)
 ;Justification comment for new EOB's
"RTN","RCDPEM5",219,0)
 I TYPE=1 D
"RTN","RCDPEM5",220,0)
 .I MODE="M" S STR="EEOB moved from EEOB for claim "_TEXT,STR1=""
"RTN","RCDPEM5",221,0)
 .I MODE="C" S STR="EEOB copied from EEOB for claim "_TEXT,STR1=""
"RTN","RCDPEM5",222,0)
 ;Return full justification text
"RTN","RCDPEM5",223,0)
 Q STR_STR1_" by Split/Edit Line"
"RTN","RCDPEM5",224,0)
 ;
"RTN","RCDPEM5",225,0)
JUST1(ORIG,NCLAIM,MODE,TYPE) ;Construct AR comment for stand alone option
"RTN","RCDPEM5",226,0)
 N FIRST,STR,STR1,SUB,TEXT
"RTN","RCDPEM5",227,0)
 ;Original bill numbe
"RTN","RCDPEM5",228,0)
 S TEXT=$$EXTERNAL^DILFD(361.1,.01,,$P($G(^IBM(361.1,ORIG,0)),U))
"RTN","RCDPEM5",229,0)
 ;Justification comment for original EOB
"RTN","RCDPEM5",230,0)
 I TYPE=0 D
"RTN","RCDPEM5",231,0)
 .I MODE="M" S STR="EEOB from claim "_TEXT_" moved to claim "
"RTN","RCDPEM5",232,0)
 .I MODE="C" S STR="EEOB from claim "_TEXT_" copied to claim(s) "
"RTN","RCDPEM5",233,0)
 .;Build list of claims
"RTN","RCDPEM5",234,0)
 .S STR1="",SUB="",FIRST=1
"RTN","RCDPEM5",235,0)
 .F  S SUB=$O(NCLAIM(SUB)) Q:'SUB  D
"RTN","RCDPEM5",236,0)
 ..S TEXT=$P($G(^PRCA(430,NCLAIM(SUB),0)),U)
"RTN","RCDPEM5",237,0)
 ..I FIRST S STR1=STR1_$P(TEXT,"-",2),FIRST=0 Q
"RTN","RCDPEM5",238,0)
 ..S STR1=STR1_", "_$P(TEXT,"-",2)
"RTN","RCDPEM5",239,0)
 ;Justification comment for new EOB's
"RTN","RCDPEM5",240,0)
 I TYPE=1 D
"RTN","RCDPEM5",241,0)
 .I MODE="M" S STR="EEOB moved from EEOB for claim "_TEXT,STR1=""
"RTN","RCDPEM5",242,0)
 .I MODE="C" S STR="EEOB copied from EEOB for claim "_TEXT,STR1=""
"RTN","RCDPEM5",243,0)
 ;Return comment text
"RTN","RCDPEM5",244,0)
 Q STR_STR1
"RTN","RCDPEM5",245,0)
 ;
"RTN","RCDPEM5",246,0)
FINDEOB(IEN3444,BILL) ;Find EOB for a claim within an ERA
"RTN","RCDPEM5",247,0)
 N IEN3611,SUB
"RTN","RCDPEM5",248,0)
 S (SUB,IEN3611)=0
"RTN","RCDPEM5",249,0)
 F  S SUB=$O(^RCY(344.4,IEN3444,1,"AC",SUB)) Q:'SUB  D  Q:IEN3611
"RTN","RCDPEM5",250,0)
 .I $$EXTERNAL^DILFD(344.41,.02,,SUB)=BILL S IEN3611=SUB
"RTN","RCDPEM5",251,0)
 Q IEN3611
"RTN","RCDPEM5",252,0)
 ;
"RTN","RCDPEM5",253,0)
VALSTAT(CLIEN) ; validation on current status of the AR claim selected for the move/copy event  
"RTN","RCDPEM5",254,0)
 ; Claims that are in a incomplete state cannot be selected
"RTN","RCDPEM5",255,0)
 ; incomplete states are determined at CURRENT STATUS (8,430) of the AR claim
"RTN","RCDPEM5",256,0)
 ; AR claims with 'BILL INCOMPLETE', 'INCOMPLETE', 'NEW BILL' statuses cannot be selected 
"RTN","RCDPEM5",257,0)
 ; CLIEN=430 ien
"RTN","RCDPEM5",258,0)
 ; returns 0 or 1
"RTN","RCDPEM5",259,0)
 N CSTAT,FLAG
"RTN","RCDPEM5",260,0)
 S CSTAT=$$GET1^DIQ(430,CLIEN,8)
"RTN","RCDPEM5",261,0)
 S FLAG=$S(CSTAT="BILL INCOMPLETE":0,CSTAT="INCOMPLETE":0,CSTAT="NEW BILL":0,1:1)
"RTN","RCDPEM5",262,0)
 Q FLAG
"RTN","RCDPEM6")
0^43^B40220654^n/a
"RTN","RCDPEM6",1,0)
RCDPEM6 ;OIFO-BAYPINES/RBN - DUPLICATE EFT DEPOSITS AUDIT REPORTS ;8/14/11 3:20pm
"RTN","RCDPEM6",2,0)
 ;;4.5;Accounts Receivable;**276**;Mar 20, 1995;Build 87
"RTN","RCDPEM6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM6",4,0)
 ;
"RTN","RCDPEM6",5,0)
 ; General read access of IB EOB file #361.1 is allowed from AR by IA 4051
"RTN","RCDPEM6",6,0)
 Q
"RTN","RCDPEM6",7,0)
 ;
"RTN","RCDPEM6",8,0)
 ; DESCRIPTION: The following generates an audit report that dislays all EFTs
"RTN","RCDPEM6",9,0)
 ;              that have been removed by the user.  The user must select
"RTN","RCDPEM6",10,0)
 ;              a date range to limit the number of EFTs displayed.
"RTN","RCDPEM6",11,0)
 ;
"RTN","RCDPEM6",12,0)
 ; INPUTS:  The user is prompted for the Date/Time range
"RTN","RCDPEM6",13,0)
 ;
"RTN","RCDPEM6",14,0)
 ; OUTPUTS: A report which displays EFTs that have been removed.  The report has the following
"RTN","RCDPEM6",15,0)
 ;          headings:
"RTN","RCDPEM6",16,0)
 ;          * Trace number
"RTN","RCDPEM6",17,0)
 ;          * Payer name
"RTN","RCDPEM6",18,0)
 ;          * Deposit number
"RTN","RCDPEM6",19,0)
 ;          * Date removed
"RTN","RCDPEM6",20,0)
 ;          * User
"RTN","RCDPEM6",21,0)
 ;          * Justification for removal
"RTN","RCDPEM6",22,0)
 ;
"RTN","RCDPEM6",23,0)
 ; LOCAL VARIABLES: RCEXCEL - Display/print/Excel flag.
"RTN","RCDPEM6",24,0)
 ;                  RCPAGE - Current page number of the report.
"RTN","RCDPEM6",25,0)
 ;                  RCRANGE - Three ^ pieces:
"RTN","RCDPEM6",26,0)
 ;                            1:Dates provided successfully - 1 (Yes), 0 (No)
"RTN","RCDPEM6",27,0)
 ;                            2:Start Date for report
"RTN","RCDPEM6",28,0)
 ;                            3:End Date for report
"RTN","RCDPEM6",29,0)
 ;                  RCSTOP - User Requests Abort (1)
"RTN","RCDPEM6",30,0)
 ;                  FileMan- Several standard FileMan variables (v.gr. DIR,DIC,etc..
"RTN","RCDPEM6",31,0)
 ;                  Misc.  - X, Y, I and other used for counters and temp values.
"RTN","RCDPEM6",32,0)
 ;
"RTN","RCDPEM6",33,0)
 ; GLOBALS: ^RCY(344.31 - EDI THIRD PARTY EFT DETAIL file (#344.31).
"RTN","RCDPEM6",34,0)
 ;          ^TMP($J,"RCDPEM6",LINE #) - Report data (body of report).  Data structure:
"RTN","RCDPEM6",35,0)
 ;
"RTN","RCDPEM6",36,0)
 ;           DEPOSIT NUMBER^PAYER^TRACE NUMBER^AMOUNT^DATE REMOVED^USER^JUSTIFICATION
"RTN","RCDPEM6",37,0)
 ;
"RTN","RCDPEM6",38,0)
EN1 ; Main entry point for EFT Audit Report
"RTN","RCDPEM6",39,0)
 N RCRANGE,RCEXCEL,RCPAGE,Y,RCSTOP,I,START,END,ZTDESC,ZTRTN,ZTSAVE
"RTN","RCDPEM6",40,0)
 S (RCPAGE,RCSTOP)=0
"RTN","RCDPEM6",41,0)
 S RCRANGE=$$DTRNG^RCDPEM4()
"RTN","RCDPEM6",42,0)
 I RCRANGE=0 G EXIT
"RTN","RCDPEM6",43,0)
 S RCEXCEL=$$DISPTY^RCDPEM3() G:+RCEXCEL=-1 EXIT
"RTN","RCDPEM6",44,0)
 ;Display capture information for Excel
"RTN","RCDPEM6",45,0)
 I RCEXCEL D INFO
"RTN","RCDPEM6",46,0)
 ;Select output device
"RTN","RCDPEM6",47,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPEM6",48,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPEM6",49,0)
 . S ZTRTN="ENREM^RCDPEM6"
"RTN","RCDPEM6",50,0)
 . S ZTDESC="Duplicate EFT Deposits Report"
"RTN","RCDPEM6",51,0)
 . S ZTSAVE("RC*")="",ZTSAVE("VAUTD")=""
"RTN","RCDPEM6",52,0)
 . D ^%ZTLOAD
"RTN","RCDPEM6",53,0)
 . I $D(ZTSK) W !!,"Your task number "_ZTSK_" has been queued."
"RTN","RCDPEM6",54,0)
 . E  W !!,"Unable to queue this job."
"RTN","RCDPEM6",55,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEM6",56,0)
 U IO
"RTN","RCDPEM6",57,0)
 ;
"RTN","RCDPEM6",58,0)
ENREM ;
"RTN","RCDPEM6",59,0)
 D REPORT
"RTN","RCDPEM6",60,0)
 D DISPLAY(RCEXCEL)
"RTN","RCDPEM6",61,0)
 D EXIT
"RTN","RCDPEM6",62,0)
 Q
"RTN","RCDPEM6",63,0)
 ;
"RTN","RCDPEM6",64,0)
REPORT ; Generate the report ^TMP array
"RTN","RCDPEM6",65,0)
 ; INPUTS :  None
"RTN","RCDPEM6",66,0)
 ; LOCAL VARIABLES:
"RTN","RCDPEM6",67,0)
 ;  DTIEN    - IEN of EFT from "E" index (date/time)
"RTN","RCDPEM6",68,0)
 ;  START    - Start date of report date range
"RTN","RCDPEM6",69,0)
 ;  END      - End date of report date range
"RTN","RCDPEM6",70,0)
 ;  EFTIEN   - IEN of EFT
"RTN","RCDPEM6",71,0)
 ;
"RTN","RCDPEM6",72,0)
 N DTIEN,EFTIEN,X1,X2,X,Y
"RTN","RCDPEM6",73,0)
 K ^TMP($J,"RCDPEM6")
"RTN","RCDPEM6",74,0)
 S (DTIEN,EFTIEN)=""
"RTN","RCDPEM6",75,0)
 S END=$P(RCRANGE,U,3),START=$P(RCRANGE,U,2)
"RTN","RCDPEM6",76,0)
 I $P($G(RCRANGE),U,1) D
"RTN","RCDPEM6",77,0)
 . S DTIEN=$P(RCRANGE,U,1)-1
"RTN","RCDPEM6",78,0)
 . F  S DTIEN=$O(^RCY(344.31,"E",DTIEN)) Q:'DTIEN  D
"RTN","RCDPEM6",79,0)
 .. S EFTIEN=$O(^RCY(344.31,"E",DTIEN,EFTIEN)) Q:'EFTIEN
"RTN","RCDPEM6",80,0)
 .. Q:'$D(^RCY(344.31,EFTIEN,3))
"RTN","RCDPEM6",81,0)
 .. I (START'>DTIEN\1)&(DTIEN\1'>END) D
"RTN","RCDPEM6",82,0)
 .. . D PROC(EFTIEN)
"RTN","RCDPEM6",83,0)
 .. S EFTIEN=""
"RTN","RCDPEM6",84,0)
 I '$P($G(RCRANGE),U,1) D
"RTN","RCDPEM6",85,0)
 . F  S DTIEN=$O(^RCY(344.31,"E",DTIEN)) Q:'DTIEN  D
"RTN","RCDPEM6",86,0)
 .. S EFTIEN=$O(^RCY(344.31,"E",DTIEN,EFTIEN)) Q:'EFTIEN
"RTN","RCDPEM6",87,0)
 .. Q:'$D(^RCY(344.31,EFTIEN,3))
"RTN","RCDPEM6",88,0)
 .. D PROC(EFTIEN)
"RTN","RCDPEM6",89,0)
 .. S EFTIEN=""
"RTN","RCDPEM6",90,0)
 Q
"RTN","RCDPEM6",91,0)
 ;
"RTN","RCDPEM6",92,0)
DISPLAY(RCEXCEL) ; Format the display for screen/printer or MS Excel
"RTN","RCDPEM6",93,0)
 ; INPUTS  : RCEXCEL -  Display/print/Excel flag.
"RTN","RCDPEM6",94,0)
 ; RETURNS : Nothing - builds the actual report
"RTN","RCDPEM6",95,0)
 ; LOCAL VARIABLES:
"RTN","RCDPEM6",96,0)
 ;  IEN - line number of the data in ^TMP (see above)
"RTN","RCDPEM6",97,0)
 ;  DATE - Date/Time report was run for header
"RTN","RCDPEM6",98,0)
 ;  CNT - Count of EFT Deposits removed
"RTN","RCDPEM6",99,0)
 ;  DATA - Data stored in ^TMP($J,"DUPLICATE EFT",IEN)
"RTN","RCDPEM6",100,0)
 ;
"RTN","RCDPEM6",101,0)
 N IEN,CNT,DATE,LINE,DATA
"RTN","RCDPEM6",102,0)
 S IEN="",CNT=0,DATE=$$NOW()
"RTN","RCDPEM6",103,0)
 D HDR(RCEXCEL)
"RTN","RCDPEM6",104,0)
 F  S IEN=$O(^TMP($J,"DUPLICATE EFT",IEN)) Q:'IEN!RCSTOP  D
"RTN","RCDPEM6",105,0)
 . S CNT=CNT+1
"RTN","RCDPEM6",106,0)
 . S DATA=^TMP($J,"DUPLICATE EFT",IEN)
"RTN","RCDPEM6",107,0)
 . I 'RCEXCEL D
"RTN","RCDPEM6",108,0)
 .. I $Y>(IOSL-5) D HDR(RCEXCEL) Q:RCSTOP
"RTN","RCDPEM6",109,0)
 .. W ?1,$P(DATA,U,1)
"RTN","RCDPEM6",110,0)
 .. W ?16,$P(DATA,U,3),!
"RTN","RCDPEM6",111,0)
 .. W ?6,$P(DATA,U,2),!
"RTN","RCDPEM6",112,0)
 .. W ?16,$J($P(DATA,U,4),0,2)
"RTN","RCDPEM6",113,0)
 .. W ?28,$P(DATA,U,5)
"RTN","RCDPEM6",114,0)
 .. W ?50,$E($P(DATA,U,6),1,25),!
"RTN","RCDPEM6",115,0)
 .. D WP($P(DATA,U,7)) W !
"RTN","RCDPEM6",116,0)
 . I RCEXCEL D
"RTN","RCDPEM6",117,0)
 .. W DATA,!
"RTN","RCDPEM6",118,0)
 I 'RCEXCEL D
"RTN","RCDPEM6",119,0)
 . W !,?1,"Total number of duplicates removed: "_CNT,!
"RTN","RCDPEM6",120,0)
 . W !,?1,"*** END OF REPORT ***",!
"RTN","RCDPEM6",121,0)
 Q
"RTN","RCDPEM6",122,0)
 ;
"RTN","RCDPEM6",123,0)
PROC(EFTIEN) ;  Put the actual data into the ^TMP global based on filters.
"RTN","RCDPEM6",124,0)
 ; INPUTS   : EFTIEN = ien of the EFT in question
"RTN","RCDPEM6",125,0)
 ; RETURNS  : Nothing - Builds each entry in the ^TMP global
"RTN","RCDPEM6",126,0)
 ; LOCAL VARIABLES :
"RTN","RCDPEM6",127,0)
 ; DTRTN  - Date EFT returned
"RTN","RCDPEM6",128,0)
 ; JUST   - Justification for returning EFT
"RTN","RCDPEM6",129,0)
 ; TRACE  - Trace number of the EFT
"RTN","RCDPEM6",130,0)
 ; AMT    - Total amount of the EFT
"RTN","RCDPEM6",131,0)
 ; PAYER  - EFT payer
"RTN","RCDPEM6",132,0)
 ; USER   - User who completed the return EFT transaction
"RTN","RCDPEM6",133,0)
 ; DEPO   - Deposit # of EFT deposit
"RTN","RCDPEM6",134,0)
 ;
"RTN","RCDPEM6",135,0)
 N DTRTN,JUST,TRACE,AMT,PAYER,USER,Y,DEPO,DATA0,DATA3,Z
"RTN","RCDPEM6",136,0)
 S DATA0=$G(^RCY(344.31,EFTIEN,0))
"RTN","RCDPEM6",137,0)
 S DATA3=$G(^RCY(344.31,EFTIEN,3))
"RTN","RCDPEM6",138,0)
 S USER=$P(DATA3,U,1),USER=$$NAME^XUSER(USER,"F")
"RTN","RCDPEM6",139,0)
 S DTRTN=$$FMTE^XLFDT($P(^RCY(344.31,EFTIEN,3),U,2),2)
"RTN","RCDPEM6",140,0)
 S JUST=$P(DATA3,U,3)
"RTN","RCDPEM6",141,0)
 S PAYER=$P(DATA0,U,2) S:PAYER="" PAYER="UNKNOWN"
"RTN","RCDPEM6",142,0)
 S TRACE=$P(DATA0,U,4),AMT=$P(DATA0,U,7)
"RTN","RCDPEM6",143,0)
 S Z=$P(DATA0,U)
"RTN","RCDPEM6",144,0)
 S:Z]"" DEPO=$P($G(^RCY(344.3,Z,0)),U,6)
"RTN","RCDPEM6",145,0)
 S:'$G(DEPO) DEPO="UNKNOWN"
"RTN","RCDPEM6",146,0)
 S ^TMP($J,"DUPLICATE EFT",EFTIEN)=DEPO_"^"_PAYER_"^"_TRACE_"^"_AMT_"^"_DTRTN_"^"_USER_"^"_JUST
"RTN","RCDPEM6",147,0)
 Q
"RTN","RCDPEM6",148,0)
 ;
"RTN","RCDPEM6",149,0)
HDR(RCEXCEL) ; Print the report header
"RTN","RCDPEM6",150,0)
 ; INPUTS   : RCEXCEL - Display/print/Excel flag
"RTN","RCDPEM6",151,0)
 ; RETURNS  : Nothing - Displays the report header to the screen formated for type of output selected
"RTN","RCDPEM6",152,0)
 I 'RCEXCEL D  Q  ;Print report header
"RTN","RCDPEM6",153,0)
 . I RCPAGE D ASK^RCDPEM3(.RCSTOP,0) Q:RCSTOP
"RTN","RCDPEM6",154,0)
 . S RCPAGE=RCPAGE+1
"RTN","RCDPEM6",155,0)
 . W @IOF
"RTN","RCDPEM6",156,0)
 . W ?18,"Duplicate EFT Deposits - Audit Report",?66,"Page "_RCPAGE,!
"RTN","RCDPEM6",157,0)
 . W ?24,"Run Date: "_DATE,!
"RTN","RCDPEM6",158,0)
 . W ?14,"Date Range: ",$$FMTE^XLFDT(START,2)," - ",$$FMTE^XLFDT(END,2)," (DATE EFT REMOVAL)",!!
"RTN","RCDPEM6",159,0)
 . W ?1,"Deposit#",?16,"Trace #",!
"RTN","RCDPEM6",160,0)
 . W ?6,"Payer Name",?28,"Date/Time",?50,"User Who",!
"RTN","RCDPEM6",161,0)
 . W ?16,"Amount",?28,"Removed",?50,"Removed",!
"RTN","RCDPEM6",162,0)
 . W ?1,"===============================================================================",!
"RTN","RCDPEM6",163,0)
 ;Otherwise, print Excel header
"RTN","RCDPEM6",164,0)
 W "DEPOSIT NUMBER^PAYER^TRACE NUMBER^AMOUNT^DATE REMOVED^USER^JUSTIFICATION",!
"RTN","RCDPEM6",165,0)
 Q
"RTN","RCDPEM6",166,0)
 ;
"RTN","RCDPEM6",167,0)
EXIT ; Gracefully exit
"RTN","RCDPEM6",168,0)
 ; Kills of any remaining variables
"RTN","RCDPEM6",169,0)
 D ^%ZISC
"RTN","RCDPEM6",170,0)
 K X,^TMP($J,"DUPLICATE EFT"),STNAM,POP,%ZIS,Y,VAUTD
"RTN","RCDPEM6",171,0)
 Q
"RTN","RCDPEM6",172,0)
 ;
"RTN","RCDPEM6",173,0)
INFO ;Useful Info for Excel capture
"RTN","RCDPEM6",174,0)
 W !!!,?10,"Before continuing, please set up your terminal to capture the"
"RTN","RCDPEM6",175,0)
 W !,?10,"report data as this report may take a while to run."
"RTN","RCDPEM6",176,0)
 W !!,?10,"To avoid  undesired  wrapping of the data  saved to the"
"RTN","RCDPEM6",177,0)
 W !,?10,"file, please enter '0;256;999' at the 'DEVICE:' prompt."
"RTN","RCDPEM6",178,0)
 W !!,?10,"It may be necessary to set up the terminal display width"
"RTN","RCDPEM6",179,0)
 W !,?10,"to 256 characters which can be performed by selecting the"
"RTN","RCDPEM6",180,0)
 W !,?10,"Display option located within the 'Setup' menu on the"
"RTN","RCDPEM6",181,0)
 W !,?10,"tool bar of the terminal emulation software (e.g. KEA,"
"RTN","RCDPEM6",182,0)
 W !,?10,"Reflections or Smarterm).",!!
"RTN","RCDPEM6",183,0)
 Q
"RTN","RCDPEM6",184,0)
 ;
"RTN","RCDPEM6",185,0)
WP(A) ; Pretty print the justification comments
"RTN","RCDPEM6",186,0)
 ; INPUTS   : A - Justification text
"RTN","RCDPEM6",187,0)
 ; RETURNS  : NOTHING
"RTN","RCDPEM6",188,0)
 ; LOCAL VARIABLES :
"RTN","RCDPEM6",189,0)
 ;                 B - Character length of the justification comment
"RTN","RCDPEM6",190,0)
 ;                 C - Number of words in the justification comment
"RTN","RCDPEM6",191,0)
 ;                 I - Loop counter
"RTN","RCDPEM6",192,0)
 ;                 J - Line counter
"RTN","RCDPEM6",193,0)
 ;                 LINE - Justification text to be displayed
"RTN","RCDPEM6",194,0)
 I A="" Q
"RTN","RCDPEM6",195,0)
 N B,C,I,J,LINE
"RTN","RCDPEM6",196,0)
 S B=$L(A),C=$L(A," "),J=1
"RTN","RCDPEM6",197,0)
 S LINE(J)="Justification Comments: "
"RTN","RCDPEM6",198,0)
 F I=1:1:C D
"RTN","RCDPEM6",199,0)
 . I $L(LINE(J))+$L($P(A," ",I))>72 D
"RTN","RCDPEM6",200,0)
 .. S J=J+1,LINE(J)="                        "
"RTN","RCDPEM6",201,0)
 . S LINE(J)=LINE(J)_" "_$P(A," ",I)
"RTN","RCDPEM6",202,0)
 S LINE(0)=J
"RTN","RCDPEM6",203,0)
 F I=1:1:LINE(0) W ?1,LINE(I),!
"RTN","RCDPEM6",204,0)
 Q
"RTN","RCDPEM6",205,0)
 ;
"RTN","RCDPEM6",206,0)
NOW()  ;Returns current date/time in format mm/dd/yy@hh:mm:ss
"RTN","RCDPEM6",207,0)
 N Y,%
"RTN","RCDPEM6",208,0)
 D NOW^%DTC
"RTN","RCDPEM6",209,0)
 S Y=$$FMTE^XLFDT(%,2)
"RTN","RCDPEM6",210,0)
 Q Y
"RTN","RCDPEM7")
0^44^B44597294^n/a
"RTN","RCDPEM7",1,0)
RCDPEM7 ;OIFO-BAYPINES/PJH - OVERDUE EFT AND ERA BULLETINS ;6/7/11 4:18pm
"RTN","RCDPEM7",2,0)
 ;;4.5;Accounts Receivable;**276**;Mar 20, 1995;Build 87
"RTN","RCDPEM7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM7",4,0)
 ;
"RTN","RCDPEM7",5,0)
EN ; Main entry point for overdue EFT/ERA bulletins
"RTN","RCDPEM7",6,0)
 ;
"RTN","RCDPEM7",7,0)
 N TODAY,ERACNT,ERATOT,ERA1CNT,ERA1TOT,EFTCNT,EFTTOT,RCPROG
"RTN","RCDPEM7",8,0)
 ;Clear workfiles
"RTN","RCDPEM7",9,0)
 S RCPROG="RCDPEM7" K ^TMP(RCPROG,$J)
"RTN","RCDPEM7",10,0)
 ;Set counters and totals
"RTN","RCDPEM7",11,0)
 S (EFTCNT,ERACNT,ERA1CNT,EFTTOT,ERATOT,ERA1TOT)=0
"RTN","RCDPEM7",12,0)
 ;Cuttoff of 12:00 am today
"RTN","RCDPEM7",13,0)
 S TODAY=$P($$NOW^XLFDT,".")
"RTN","RCDPEM7",14,0)
 ;
"RTN","RCDPEM7",15,0)
 ;Scan for overdue ERA and unposted ERA
"RTN","RCDPEM7",16,0)
 D ERASCAN
"RTN","RCDPEM7",17,0)
 ;Scan for overdue EFT
"RTN","RCDPEM7",18,0)
 D EFTSCAN
"RTN","RCDPEM7",19,0)
 ;Bulletins
"RTN","RCDPEM7",20,0)
 D BULLETIN
"RTN","RCDPEM7",21,0)
 ;Clear workfiles
"RTN","RCDPEM7",22,0)
 K ^TMP(RCPROG,$J)
"RTN","RCDPEM7",23,0)
 Q
"RTN","RCDPEM7",24,0)
 ;
"RTN","RCDPEM7",25,0)
ERASCAN ;Scan ERA
"RTN","RCDPEM7",26,0)
 N AMT,ERAIEN,REC0,SUB,STATUS,FDATE,PNAME
"RTN","RCDPEM7",27,0)
 ;Scan for unmatched ERA
"RTN","RCDPEM7",28,0)
 S ERAIEN=0,STATUS=0,SUB="ERA"
"RTN","RCDPEM7",29,0)
 F  S ERAIEN=$O(^RCY(344.4,"AMATCH",STATUS,ERAIEN)) Q:'ERAIEN  D
"RTN","RCDPEM7",30,0)
 .S REC0=$G(^RCY(344.4,ERAIEN,0))
"RTN","RCDPEM7",31,0)
 .;Get ERA file date/time
"RTN","RCDPEM7",32,0)
 .S FDATE=$P(REC0,U,7) Q:'FDATE
"RTN","RCDPEM7",33,0)
 .;Ignore if <31 days overdue
"RTN","RCDPEM7",34,0)
 .Q:$$FMDIFF^XLFDT(TODAY,FDATE,1)<31
"RTN","RCDPEM7",35,0)
 .;Trace, Payer Name and Amount
"RTN","RCDPEM7",36,0)
 .S PNAME=$P(REC0,U,6),AMT=$P(REC0,U,5)
"RTN","RCDPEM7",37,0)
 .I $L(PNAME)>35 S PNAME=$E(PNAME,1,35) ; limit size of the name
"RTN","RCDPEM7",38,0)
 .;Update count and totals
"RTN","RCDPEM7",39,0)
 .S ERACNT=ERACNT+1,ERATOT=ERATOT+AMT
"RTN","RCDPEM7",40,0)
 .;Save ERA#, Payer Name, File Date and Amount Paid
"RTN","RCDPEM7",41,0)
 .S ^TMP(RCPROG,$J,"ERA",ERACNT)=$$ERAL(ERAIEN,PNAME,FDATE,AMT)
"RTN","RCDPEM7",42,0)
 ;
"RTN","RCDPEM7",43,0)
 ;Scan for Matched/Unposted ERA
"RTN","RCDPEM7",44,0)
 S SUB="ERA1"
"RTN","RCDPEM7",45,0)
 F STATUS=-1,1,2,3 D
"RTN","RCDPEM7",46,0)
 .S ERAIEN=0 F  S ERAIEN=$O(^RCY(344.4,"AMATCH",STATUS,ERAIEN)) Q:'ERAIEN  D
"RTN","RCDPEM7",47,0)
 ..S REC0=$G(^RCY(344.4,ERAIEN,0))
"RTN","RCDPEM7",48,0)
 ..;Get ERA file date/time
"RTN","RCDPEM7",49,0)
 ..S FDATE=$P(REC0,U,7) Q:'FDATE
"RTN","RCDPEM7",50,0)
 ..;Ignore if <31 days overdue
"RTN","RCDPEM7",51,0)
 ..Q:$$FMDIFF^XLFDT(TODAY,FDATE,1)<31
"RTN","RCDPEM7",52,0)
 ..;Ignore if not unposted posted
"RTN","RCDPEM7",53,0)
 ..Q:$P($G(^RCY(344.4,ERAIEN,0)),U,14)>0
"RTN","RCDPEM7",54,0)
 ..;Payer Name and Amount
"RTN","RCDPEM7",55,0)
 ..S PNAME=$P(REC0,U,6),AMT=$P(REC0,U,5)
"RTN","RCDPEM7",56,0)
 ..I $L(PNAME)>35 S PNAME=$E(PNAME,1,35) ; limit size of the name
"RTN","RCDPEM7",57,0)
 ..;Update count and totals
"RTN","RCDPEM7",58,0)
 ..S ERA1CNT=ERA1CNT+1,ERA1TOT=ERA1TOT+AMT
"RTN","RCDPEM7",59,0)
 ..;Save ERA#, Payer Name, File Date and Amount Paid
"RTN","RCDPEM7",60,0)
 ..S ^TMP(RCPROG,$J,"ERA1",ERA1CNT)=$$ERAL(ERAIEN,PNAME,FDATE,AMT)
"RTN","RCDPEM7",61,0)
 ..Q
"RTN","RCDPEM7",62,0)
 .Q
"RTN","RCDPEM7",63,0)
 Q
"RTN","RCDPEM7",64,0)
 ;
"RTN","RCDPEM7",65,0)
EFTSCAN ;Scan EFT
"RTN","RCDPEM7",66,0)
 N DEPN,EFTIEN,IEN3443,EFTDATE,TRACE,REC0,REC31,STATUS,PAYER,DEPAMT
"RTN","RCDPEM7",67,0)
 ;Scan for unmatched EFT
"RTN","RCDPEM7",68,0)
 S EFTIEN=0,STATUS=0
"RTN","RCDPEM7",69,0)
 F  S EFTIEN=$O(^RCY(344.31,"AMATCH",STATUS,EFTIEN)) Q:'EFTIEN  D
"RTN","RCDPEM7",70,0)
 .S REC31=$G(^RCY(344.31,EFTIEN,0))
"RTN","RCDPEM7",71,0)
 .;Get pointer to EFT file
"RTN","RCDPEM7",72,0)
 .S IEN3443=$P(REC31,U) Q:'IEN3443
"RTN","RCDPEM7",73,0)
 .S REC0=$G(^RCY(344.3,IEN3443,0))
"RTN","RCDPEM7",74,0)
 .;Get EFT file date
"RTN","RCDPEM7",75,0)
 .S EFTDATE=$P(REC0,U,2) Q:'EFTDATE
"RTN","RCDPEM7",76,0)
 .;Ignore if <15 days overdue
"RTN","RCDPEM7",77,0)
 .Q:$$FMDIFF^XLFDT(TODAY,EFTDATE,1)<15
"RTN","RCDPEM7",78,0)
 .;Deposit number and payment amount
"RTN","RCDPEM7",79,0)
 .S DEPN=$P(REC0,U,6),DEPAMT=$P(REC31,U,7)
"RTN","RCDPEM7",80,0)
 .;Payer ID and Trace from EFT detail file
"RTN","RCDPEM7",81,0)
 .S PAYER=$P(REC31,U,2),TRACE=$P(REC31,U,4)
"RTN","RCDPEM7",82,0)
 .;If payer and trace combined are >40 truncate payer name first
"RTN","RCDPEM7",83,0)
 .I $L(PAYER_TRACE)>40 D
"RTN","RCDPEM7",84,0)
 ..I $L(PAYER)>20 S PAYER=$E(PAYER,1,20) ; limit size of the name
"RTN","RCDPEM7",85,0)
 ..Q:$L(PAYER_TRACE)<41
"RTN","RCDPEM7",86,0)
 ..S TRACE=$E(TRACE,1,20) ; limit size of the trace
"RTN","RCDPEM7",87,0)
 .;Update count and totals
"RTN","RCDPEM7",88,0)
 .S EFTCNT=EFTCNT+1,EFTTOT=EFTTOT+DEPAMT
"RTN","RCDPEM7",89,0)
 .;Save Deposit No, Receipt, Payer ID, EFT Date and Deposit Amount
"RTN","RCDPEM7",90,0)
 .S ^TMP(RCPROG,$J,"EFT",EFTCNT)=$$EFTL(DEPN,TRACE,PAYER,EFTDATE,DEPAMT)
"RTN","RCDPEM7",91,0)
 Q
"RTN","RCDPEM7",92,0)
 ;
"RTN","RCDPEM7",93,0)
BULLETIN ;Create bulletins only if overdue EFT/ERA found
"RTN","RCDPEM7",94,0)
 ;
"RTN","RCDPEM7",95,0)
 N ARRAY,SBJ,SUB,CNT,CNT1,RCPROG1,GLB
"RTN","RCDPEM7",96,0)
 S RCPROG1="RCDPEM7A",GLB=$NA(^TMP(RCPROG1,$J,"XMTEXT"))
"RTN","RCDPEM7",97,0)
 ;
"RTN","RCDPEM7",98,0)
 ;Unmatched ERA bulletins
"RTN","RCDPEM7",99,0)
 I ERACNT D
"RTN","RCDPEM7",100,0)
 .;Build header
"RTN","RCDPEM7",101,0)
 .S SUB="ERA" K @GLB
"RTN","RCDPEM7",102,0)
 .S SBJ="EDI LBOX-STA# "_$P($$SITE^VASITE,"^",3)_"-ACTION REQ-Unmatched ERAs > 30 days"
"RTN","RCDPEM7",103,0)
 .S @GLB@(1)="The listed ERAs were received more than 30 days ago and have not yet been"
"RTN","RCDPEM7",104,0)
 .S @GLB@(2)="matched."
"RTN","RCDPEM7",105,0)
 .S @GLB@(3)=" "
"RTN","RCDPEM7",106,0)
 .S @GLB@(4)="Total # of ERAs - "_ERACNT
"RTN","RCDPEM7",107,0)
 .S @GLB@(5)="Total Dollar Amount - "_"$"_$FN(ERATOT,",",2)
"RTN","RCDPEM7",108,0)
 .S @GLB@(6)=" "
"RTN","RCDPEM7",109,0)
 .S @GLB@(7)="ERA#        PAYER NAME                                FILE DATE    AMOUNT PAID"
"RTN","RCDPEM7",110,0)
 .;
"RTN","RCDPEM7",111,0)
 .;Move unmatched ERA search findings into message
"RTN","RCDPEM7",112,0)
 .S CNT=0,CNT1=8,SUB="ERA"
"RTN","RCDPEM7",113,0)
 .F  S CNT=$O(^TMP(RCPROG,$J,SUB,CNT)) Q:'CNT  D
"RTN","RCDPEM7",114,0)
 ..S CNT1=CNT1+1,@GLB@(CNT1)=^TMP(RCPROG,$J,SUB,CNT)
"RTN","RCDPEM7",115,0)
 .S @GLB@(CNT1+1)="** END OF REPORT **"
"RTN","RCDPEM7",116,0)
 .D SEND
"RTN","RCDPEM7",117,0)
 .K @GLB
"RTN","RCDPEM7",118,0)
 ;
"RTN","RCDPEM7",119,0)
 ;Unposted ERA bulletins
"RTN","RCDPEM7",120,0)
 I ERA1CNT D
"RTN","RCDPEM7",121,0)
 .;Build header
"RTN","RCDPEM7",122,0)
 .S SUB="ERA1" K @GLB
"RTN","RCDPEM7",123,0)
 .S SBJ="EDI LBOX-STA# "_$P($$SITE^VASITE,"^",3)_"-ACTION REQ-Matched/Not Posted ERAs > 30 days"
"RTN","RCDPEM7",124,0)
 .S @GLB@(1)="The listed ERAs were received more than 30 days ago and have been matched but"
"RTN","RCDPEM7",125,0)
 .S @GLB@(2)="have not been posted"
"RTN","RCDPEM7",126,0)
 .S @GLB@(3)=" "
"RTN","RCDPEM7",127,0)
 .S @GLB@(4)="Total # of ERAs - "_ERA1CNT
"RTN","RCDPEM7",128,0)
 .S @GLB@(5)="Total Dollar Amount - "_"$"_$FN(ERA1TOT,",",2)
"RTN","RCDPEM7",129,0)
 .S @GLB@(6)=" "
"RTN","RCDPEM7",130,0)
 .S @GLB@(7)="ERA#        PAYER NAME                                FILE DATE    AMOUNT PAID"
"RTN","RCDPEM7",131,0)
 .;
"RTN","RCDPEM7",132,0)
 .;Move unposted ERA search findings into message
"RTN","RCDPEM7",133,0)
 .S CNT=0,CNT1=8
"RTN","RCDPEM7",134,0)
 .F  S CNT=$O(^TMP(RCPROG,$J,SUB,CNT)) Q:'CNT  D
"RTN","RCDPEM7",135,0)
 ..S CNT1=CNT1+1,@GLB@(CNT1)=^TMP(RCPROG,$J,SUB,CNT)
"RTN","RCDPEM7",136,0)
 .S @GLB@(CNT1+1)="** END OF REPORT **"
"RTN","RCDPEM7",137,0)
 .D SEND
"RTN","RCDPEM7",138,0)
 .K @GLB
"RTN","RCDPEM7",139,0)
 ;
"RTN","RCDPEM7",140,0)
 ;Unmatched EFT bulletins
"RTN","RCDPEM7",141,0)
 I EFTCNT D
"RTN","RCDPEM7",142,0)
 .;Build header
"RTN","RCDPEM7",143,0)
 .S SUB="EFT" K @GLB
"RTN","RCDPEM7",144,0)
 .S SBJ="EDI LBOX-STA# "_$P($$SITE^VASITE,"^",3)_"-ACTION REQ-EFTs > 14 days"
"RTN","RCDPEM7",145,0)
 .S @GLB@(1)="The following EFTs were received more than 14 days ago and have not yet"
"RTN","RCDPEM7",146,0)
 .S @GLB@(2)="been matched."
"RTN","RCDPEM7",147,0)
 .S @GLB@(3)=" "
"RTN","RCDPEM7",148,0)
 .S @GLB@(4)="Total # of EFTs - "_EFTCNT
"RTN","RCDPEM7",149,0)
 .S @GLB@(5)="Total Dollar Amount - "_"$"_$FN(EFTTOT,",",2)
"RTN","RCDPEM7",150,0)
 .S @GLB@(6)=" "
"RTN","RCDPEM7",151,0)
 .S @GLB@(7)="DEPOSIT#   PAYER NAME/TRACE#                         EFT DATE    DEPOSIT AMT"
"RTN","RCDPEM7",152,0)
 .;
"RTN","RCDPEM7",153,0)
 .;Move EFT search findings into message
"RTN","RCDPEM7",154,0)
 .S CNT=0,CNT1=8,SUB="EFT"
"RTN","RCDPEM7",155,0)
 .F  S CNT=$O(^TMP(RCPROG,$J,SUB,CNT)) Q:'CNT  D
"RTN","RCDPEM7",156,0)
 ..S CNT1=CNT1+1,@GLB@(CNT1)=^TMP(RCPROG,$J,SUB,CNT)
"RTN","RCDPEM7",157,0)
 .S @GLB@(CNT1+1)="** END OF REPORT **"
"RTN","RCDPEM7",158,0)
 .D SEND
"RTN","RCDPEM7",159,0)
 .K @GLB
"RTN","RCDPEM7",160,0)
 Q
"RTN","RCDPEM7",161,0)
 ;
"RTN","RCDPEM7",162,0)
SEND ;Transmit mail message
"RTN","RCDPEM7",163,0)
 N XMDUZ,XMTEXT,XMSUB,XMY,XMINSTR
"RTN","RCDPEM7",164,0)
 S XMDUZ=DUZ,XMTEXT=GLB,XMSUB=SBJ,XMY("I:G.RCDPE AUDIT")=""
"RTN","RCDPEM7",165,0)
 S XMINSTR("FROM")="POSTMASTER"
"RTN","RCDPEM7",166,0)
 S XMINSTR("FLAGS")="P"
"RTN","RCDPEM7",167,0)
 D SENDMSG^XMXAPI(XMDUZ,XMSUB,XMTEXT,.XMY,.XMINSTR)
"RTN","RCDPEM7",168,0)
 Q
"RTN","RCDPEM7",169,0)
 ;
"RTN","RCDPEM7",170,0)
ERAL(X1,X2,X3,X4) ;Format ERA Message line
"RTN","RCDPEM7",171,0)
 N SPACE
"RTN","RCDPEM7",172,0)
 S SPACE=$J("",80)
"RTN","RCDPEM7",173,0)
 S X1=X1_$E(SPACE,1,12-$L(X1))
"RTN","RCDPEM7",174,0)
 S X2=X1_$E(X2,1,43)_$E(SPACE,1,43-$L(X2))
"RTN","RCDPEM7",175,0)
 S X3=$$FMTE^XLFDT(X3,"2D")
"RTN","RCDPEM7",176,0)
 S X4="$"_$FN(X4,",",2)
"RTN","RCDPEM7",177,0)
 Q X2_$J(X3,8)_$J(X4,15)
"RTN","RCDPEM7",178,0)
 ;
"RTN","RCDPEM7",179,0)
EFTL(X1,X2,X3,X4,X5) ;Format EFT Message line
"RTN","RCDPEM7",180,0)
 N SPACE
"RTN","RCDPEM7",181,0)
 S SPACE=$J("",80)
"RTN","RCDPEM7",182,0)
 S X1=X1_$E(SPACE,1,10-$L(X1))_" "
"RTN","RCDPEM7",183,0)
 S X2=X3_"/"_X2 ;Payer and Trace
"RTN","RCDPEM7",184,0)
 S X2=X1_$E(X2,1,41)_$E(SPACE,1,42-$L(X2))
"RTN","RCDPEM7",185,0)
 S X4=$$FMTE^XLFDT(X4,"2D")
"RTN","RCDPEM7",186,0)
 S X5="$"_$FN(X5,",",2)
"RTN","RCDPEM7",187,0)
 Q X2_$J(X4,8)_$J(X5,15)
"RTN","RCDPEM8")
0^45^B32433593^n/a
"RTN","RCDPEM8",1,0)
RCDPEM8 ;OIFO-BAYPINES/PJH - EOB MOVE/COPY BULLETINS ;10/5/11 10:54am
"RTN","RCDPEM8",2,0)
 ;;4.5;Accounts Receivable;**276**;Mar 20, 1995;Build 87
"RTN","RCDPEM8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM8",4,0)
 ;
"RTN","RCDPEM8",5,0)
EN ; Main entry point for Moved/Copied EOB bulletins
"RTN","RCDPEM8",6,0)
 ;
"RTN","RCDPEM8",7,0)
 ; Integration Agreement IA 451 allows read of file #361.1 from AR
"RTN","RCDPEM8",8,0)
 ;
"RTN","RCDPEM8",9,0)
 N EOBCNT,RCPROG
"RTN","RCDPEM8",10,0)
 ;Clear workfiles
"RTN","RCDPEM8",11,0)
 S RCPROG="RCDPEM8" K ^TMP(RCPROG,$J)
"RTN","RCDPEM8",12,0)
 ;Set count of EOB found
"RTN","RCDPEM8",13,0)
 S EOBCNT=0
"RTN","RCDPEM8",14,0)
 ;
"RTN","RCDPEM8",15,0)
 ;Scan for today's moved/copied EOB's
"RTN","RCDPEM8",16,0)
 D EOBSCAN
"RTN","RCDPEM8",17,0)
 ;Bulletin
"RTN","RCDPEM8",18,0)
 I EOBCNT D BULLETIN
"RTN","RCDPEM8",19,0)
 ;Clear workfiles
"RTN","RCDPEM8",20,0)
 K ^TMP(RCPROG,$J)
"RTN","RCDPEM8",21,0)
 Q
"RTN","RCDPEM8",22,0)
 ;
"RTN","RCDPEM8",23,0)
EOBSCAN ;Scan EOB
"RTN","RCDPEM8",24,0)
 N CDATE,CNT,DONE,EOBIEN,IEN101,NOW
"RTN","RCDPEM8",25,0)
 ;Start day for scan is yesterday
"RTN","RCDPEM8",26,0)
 S NOW=$$NOW^XLFDT,CDATE=$$FMADD^XLFDT($P(NOW,"."),-1)
"RTN","RCDPEM8",27,0)
 ;Scan AEOB index for changed EOBs
"RTN","RCDPEM8",28,0)
 F  S CDATE=$O(^IBM(361.1,"AEOB",CDATE)) Q:'CDATE  D
"RTN","RCDPEM8",29,0)
 .;Check if change was over 24 hours ago
"RTN","RCDPEM8",30,0)
 .I $$FMDIFF^XLFDT(NOW,CDATE,2)>86400 Q
"RTN","RCDPEM8",31,0)
 .;Skip this transaction if all referenced claims are active
"RTN","RCDPEM8",32,0)
 .Q:'$$INACTIVE(CDATE)
"RTN","RCDPEM8",33,0)
 .;Otherwise save bulletin details for EOB's in the transaction
"RTN","RCDPEM8",34,0)
 .S EOBIEN="",CNT=0,EOBCNT=EOBCNT+1
"RTN","RCDPEM8",35,0)
 .F  S EOBIEN=$O(^IBM(361.1,"AEOB",CDATE,EOBIEN)) Q:'EOBIEN  D
"RTN","RCDPEM8",36,0)
 ..;Update counter
"RTN","RCDPEM8",37,0)
 ..S CNT=CNT+1
"RTN","RCDPEM8",38,0)
 ..S IEN101=$O(^IBM(361.1,"AEOB",CDATE,EOBIEN,"")) Q:'IEN101
"RTN","RCDPEM8",39,0)
 ..;Save to workfile
"RTN","RCDPEM8",40,0)
 ..D SAVE(CDATE,EOBIEN,IEN101,EOBCNT,CNT)
"RTN","RCDPEM8",41,0)
 Q
"RTN","RCDPEM8",42,0)
 ;
"RTN","RCDPEM8",43,0)
INACTIVE(CDATE) ;Search for any bill that is not ACTIVE
"RTN","RCDPEM8",44,0)
 N CBILL,FBILL,FOUND,REC101,SUB,SUB101
"RTN","RCDPEM8",45,0)
 S SUB=0,FOUND=0
"RTN","RCDPEM8",46,0)
 F  S SUB=$O(^IBM(361.1,"AEOB",CDATE,SUB)) Q:'SUB  D  Q:FOUND
"RTN","RCDPEM8",47,0)
 .S SUB101=0
"RTN","RCDPEM8",48,0)
 .F  S SUB101=$O(^IBM(361.1,"AEOB",CDATE,SUB,SUB101)) Q:'SUB101  D  Q:FOUND
"RTN","RCDPEM8",49,0)
 ..S REC101=$G(^IBM(361.1,SUB,101,SUB101,0))
"RTN","RCDPEM8",50,0)
 ..;From bill
"RTN","RCDPEM8",51,0)
 ..S FBILL=$P(REC101,U,4)
"RTN","RCDPEM8",52,0)
 ..I FBILL S FOUND=$$CHECK(FBILL) Q:FOUND
"RTN","RCDPEM8",53,0)
 ..;Current bill on EOB
"RTN","RCDPEM8",54,0)
 ..S CBILL=$P($G(^IBM(361.1,SUB,0)),U)
"RTN","RCDPEM8",55,0)
 ..;AR claim status
"RTN","RCDPEM8",56,0)
 ..I CBILL S FOUND=$$CHECK(CBILL)
"RTN","RCDPEM8",57,0)
 Q FOUND
"RTN","RCDPEM8",58,0)
 ;
"RTN","RCDPEM8",59,0)
CHECK(IEN430) ;Check claim status in AR
"RTN","RCDPEM8",60,0)
 I $$GET1^DIQ(430,IEN430,8)="ACTIVE" Q 0
"RTN","RCDPEM8",61,0)
 Q 1
"RTN","RCDPEM8",62,0)
 ;
"RTN","RCDPEM8",63,0)
SAVE(CDATE,EOBIEN,IEN101,EOBCNT,CNT) ;Put the data into the ^TMP global
"RTN","RCDPEM8",64,0)
 ; INPUTS: EOBIEN = ien of the EOB
"RTN","RCDPEM8",65,0)
 ;         IEN101 = ien of individual copy
"RTN","RCDPEM8",66,0)
 ;         EOBCNT = count of EOB found
"RTN","RCDPEM8",67,0)
 ;         CNT = count of claims within transaction
"RTN","RCDPEM8",68,0)
 ; RETURNS  : Builds each entry in the ^TMP global
"RTN","RCDPEM8",69,0)
 ;
"RTN","RCDPEM8",70,0)
 N BIEN,BEXT,DATE,DOS,PATIEN,PATNAM,PIEN,PEXT,PSQ,PSQEXT,REC0,STAT
"RTN","RCDPEM8",71,0)
 N REC101,ORIG,MODE
"RTN","RCDPEM8",72,0)
 ;Get EOB detail
"RTN","RCDPEM8",73,0)
 S REC0=$G(^IBM(361.1,EOBIEN,0))
"RTN","RCDPEM8",74,0)
 ;Bill pointer
"RTN","RCDPEM8",75,0)
 S BIEN=$P(REC0,U) Q:'BIEN
"RTN","RCDPEM8",76,0)
 ;Get audit detail
"RTN","RCDPEM8",77,0)
 S REC101=$G(^IBM(361.1,EOBIEN,101,IEN101,0))
"RTN","RCDPEM8",78,0)
 ;Mode and Original claim
"RTN","RCDPEM8",79,0)
 S ORIG=$P(REC101,U,4),MODE=$P(REC101,U,5)
"RTN","RCDPEM8",80,0)
 ;
"RTN","RCDPEM8",81,0)
 ;If transaction is a move the only EOB is on the new claim
"RTN","RCDPEM8",82,0)
 ;
"RTN","RCDPEM8",83,0)
 ;Create report line for original claim
"RTN","RCDPEM8",84,0)
 I MODE="M",ORIG D
"RTN","RCDPEM8",85,0)
 .N BIEN
"RTN","RCDPEM8",86,0)
 .S BIEN=ORIG D SAVE1 S CNT=CNT+1
"RTN","RCDPEM8",87,0)
 ;
"RTN","RCDPEM8",88,0)
 ;Save transaction for to bill
"RTN","RCDPEM8",89,0)
 D SAVE1
"RTN","RCDPEM8",90,0)
 Q
"RTN","RCDPEM8",91,0)
 ;
"RTN","RCDPEM8",92,0)
SAVE1 ;Save unformatted bill details into ^TMP
"RTN","RCDPEM8",93,0)
 ;
"RTN","RCDPEM8",94,0)
 ;Get Bill number from bill IEN
"RTN","RCDPEM8",95,0)
 S BEXT=$P($G(^PRCA(430,BIEN,0)),U)
"RTN","RCDPEM8",96,0)
 ;Patient IEN
"RTN","RCDPEM8",97,0)
 S PATIEN=$P($G(^DGCR(399,BIEN,0)),U,2)
"RTN","RCDPEM8",98,0)
 ;Patient Name
"RTN","RCDPEM8",99,0)
 S PATNAM=$$EXTERNAL^DILFD(399,.02,,PATIEN)
"RTN","RCDPEM8",100,0)
 ;DOS
"RTN","RCDPEM8",101,0)
 S DOS=$$FMTE^XLFDT($P($G(^DGCR(399,BIEN,0)),U,3),"2D")
"RTN","RCDPEM8",102,0)
 ;Payer
"RTN","RCDPEM8",103,0)
 S PIEN=$P(REC0,U,2)
"RTN","RCDPEM8",104,0)
 ;Payer external form
"RTN","RCDPEM8",105,0)
 S PEXT=$$EXTERNAL^DILFD(361.1,.02,,PIEN)
"RTN","RCDPEM8",106,0)
 ;If no payer name on EOB check AR claim
"RTN","RCDPEM8",107,0)
 I PEXT="" S PEXT=$$GET1^DIQ(430,BIEN,9)
"RTN","RCDPEM8",108,0)
 ;Truncate payer name to 18 characters
"RTN","RCDPEM8",109,0)
 S PEXT=$E(PEXT,1,18)
"RTN","RCDPEM8",110,0)
 ;Payer Sequence
"RTN","RCDPEM8",111,0)
 S PSQ=$P(REC0,U,15)
"RTN","RCDPEM8",112,0)
 ;Payer sequence - external
"RTN","RCDPEM8",113,0)
 S PSQEXT=$$EXTERNAL^DILFD(361.1,.15,,PSQ)
"RTN","RCDPEM8",114,0)
 ;Display sequence if not null
"RTN","RCDPEM8",115,0)
 S:PSQEXT]"" PEXT=PEXT_"/"_PSQEXT
"RTN","RCDPEM8",116,0)
 ;AR claim status
"RTN","RCDPEM8",117,0)
 S STAT=$$GET1^DIQ(430,BIEN,8)
"RTN","RCDPEM8",118,0)
 ;Date/Time EOB was moved/copied
"RTN","RCDPEM8",119,0)
 S DATE=$$FMTE^XLFDT(CDATE,"2S")
"RTN","RCDPEM8",120,0)
 ;
"RTN","RCDPEM8",121,0)
 S ^TMP(RCPROG,$J,EOBCNT,CNT)=DATE_U_BEXT_U_PATNAM_U_DOS_U_PEXT_U_STAT
"RTN","RCDPEM8",122,0)
 Q
"RTN","RCDPEM8",123,0)
 ;
"RTN","RCDPEM8",124,0)
BULLETIN ;Create bulletins only if moved/copied EOB found
"RTN","RCDPEM8",125,0)
 ;
"RTN","RCDPEM8",126,0)
 N ARRAY,BLANK,SBJ,SUB,SUBHDR,SUBHDR1,SUBHDR2,CNT,CNT1,RCPROG1,GLB
"RTN","RCDPEM8",127,0)
 N LINE,DET
"RTN","RCDPEM8",128,0)
 S RCPROG1="RCDPEM8A",GLB=$NA(^TMP(RCPROG1,$J,"XMTEXT"))
"RTN","RCDPEM8",129,0)
 ;
"RTN","RCDPEM8",130,0)
 ;Compile Move/Copy Transactions Bulletin
"RTN","RCDPEM8",131,0)
 ;Build header
"RTN","RCDPEM8",132,0)
 K @GLB
"RTN","RCDPEM8",133,0)
 S SBJ="EDI LBOX-STA# "_$P($$SITE^VASITE,"^",3)_"-Move/Copy Transactions"
"RTN","RCDPEM8",134,0)
 S @GLB@(1)="The listed Move/Copy transaction(s) were performed within the last 24 hours"
"RTN","RCDPEM8",135,0)
 S @GLB@(2)="and at least one of the claims in each of the transactions was NOT ACTIVE."
"RTN","RCDPEM8",136,0)
 S @GLB@(3)=" "
"RTN","RCDPEM8",137,0)
 S @GLB@(4)="Total # of transactions - "_EOBCNT
"RTN","RCDPEM8",138,0)
 S @GLB@(6)=" "
"RTN","RCDPEM8",139,0)
 S @GLB@(7)="BILL #       PATIENT             DOS         PAYER/SEQUENCE"
"RTN","RCDPEM8",140,0)
 S @GLB@(8)="   STATUS"
"RTN","RCDPEM8",141,0)
 S @GLB@(9)="----------------------------------------------------------------------------"
"RTN","RCDPEM8",142,0)
 ;
"RTN","RCDPEM8",143,0)
 ;Sub headers
"RTN","RCDPEM8",144,0)
 S SUBHDR="Transaction "
"RTN","RCDPEM8",145,0)
 S SUBHDR1=" - 'MOVE/COPY FROM' bill "
"RTN","RCDPEM8",146,0)
 S SUBHDR2=" 'MOVE/COPY TO' bill(s)"
"RTN","RCDPEM8",147,0)
 S BLANK=$J("",75)
"RTN","RCDPEM8",148,0)
 ;
"RTN","RCDPEM8",149,0)
 ;Move EOB search findings into message
"RTN","RCDPEM8",150,0)
 S EOBCNT="",CNT1=9
"RTN","RCDPEM8",151,0)
 F  S EOBCNT=$O(^TMP(RCPROG,$J,EOBCNT)) Q:'EOBCNT  D
"RTN","RCDPEM8",152,0)
 .S CNT=0
"RTN","RCDPEM8",153,0)
 .F  S CNT=$O(^TMP(RCPROG,$J,EOBCNT,CNT)) Q:'CNT  D
"RTN","RCDPEM8",154,0)
 ..;EOB data from scan
"RTN","RCDPEM8",155,0)
 ..S DET=$G(^TMP(RCPROG,$J,EOBCNT,CNT))
"RTN","RCDPEM8",156,0)
 ..;Check if 'From' or 'To'
"RTN","RCDPEM8",157,0)
 ..I CNT=1 S LINE=SUBHDR_EOBCNT_SUBHDR1_$P(DET,U)
"RTN","RCDPEM8",158,0)
 ..E  S LINE=SUBHDR2
"RTN","RCDPEM8",159,0)
 ..S CNT1=CNT1+1,@GLB@(CNT1)=LINE
"RTN","RCDPEM8",160,0)
 ..S CNT1=CNT1+1,@GLB@(CNT1)=$$EOBL(DET)
"RTN","RCDPEM8",161,0)
 ..S CNT1=CNT1+1,@GLB@(CNT1)="   "_$P(DET,U,6)
"RTN","RCDPEM8",162,0)
 ..S CNT1=CNT1+1,@GLB@(CNT1)=BLANK
"RTN","RCDPEM8",163,0)
 S @GLB@(CNT1+1)="** END OF REPORT **"
"RTN","RCDPEM8",164,0)
 ;
"RTN","RCDPEM8",165,0)
 ;Transmit mail message
"RTN","RCDPEM8",166,0)
 N XMDUZ,XMTEXT,XMSUB,XMY,XMINSTR
"RTN","RCDPEM8",167,0)
 S XMDUZ=DUZ,XMTEXT=GLB,XMSUB=SBJ,XMY("I:G.RCDPE MOVE COPY")=""
"RTN","RCDPEM8",168,0)
 S XMINSTR("FROM")="POSTMASTER"
"RTN","RCDPEM8",169,0)
 D SENDMSG^XMXAPI(XMDUZ,XMSUB,XMTEXT,.XMY,.XMINSTR)
"RTN","RCDPEM8",170,0)
 K @GLB
"RTN","RCDPEM8",171,0)
 Q
"RTN","RCDPEM8",172,0)
 ;
"RTN","RCDPEM8",173,0)
 ;
"RTN","RCDPEM8",174,0)
EOBL(DET) ;Format EOB line
"RTN","RCDPEM8",175,0)
 N BILL,DOS,PATIENT,PAYER,OUTPUT,SP
"RTN","RCDPEM8",176,0)
 S BILL=$P(DET,U,2),PATIENT=$P(DET,U,3),DOS=$P(DET,U,4),SP=$J("",80)
"RTN","RCDPEM8",177,0)
 S PAYER=$P(DET,U,5)
"RTN","RCDPEM8",178,0)
 ;Truncate patient name
"RTN","RCDPEM8",179,0)
 S PATIENT=$E(PATIENT,1,19)
"RTN","RCDPEM8",180,0)
 ;Bill number
"RTN","RCDPEM8",181,0)
 S OUTPUT=BILL_$E(SP,1,12-$L(BILL))
"RTN","RCDPEM8",182,0)
 ;Patient
"RTN","RCDPEM8",183,0)
 S OUTPUT=OUTPUT_PATIENT_$E(SP,1,20-$L(PATIENT))
"RTN","RCDPEM8",184,0)
 ;DOS
"RTN","RCDPEM8",185,0)
 S OUTPUT=OUTPUT_DOS_$E(SP,1,13-$L(DOS))
"RTN","RCDPEM8",186,0)
 ;Payer
"RTN","RCDPEM8",187,0)
 S OUTPUT=OUTPUT_PAYER
"RTN","RCDPEM8",188,0)
 ;
"RTN","RCDPEM8",189,0)
 Q OUTPUT
"RTN","RCDPEM9")
0^46^B25446642^n/a
"RTN","RCDPEM9",1,0)
RCDPEM9 ;OIFO-BAYPINES/PJH - PAYER SELECTION ;10/18/11 6:17pm
"RTN","RCDPEM9",2,0)
 ;;4.5;Accounts Receivable;**276**;Mar 20, 1995;Build 87
"RTN","RCDPEM9",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM9",4,0)
 ;
"RTN","RCDPEM9",5,0)
GETPAY(FILE) ; Let user select payer for filter
"RTN","RCDPEM9",6,0)
 ;
"RTN","RCDPEM9",7,0)
 ; Returned RTNFLG value
"RTN","RCDPEM9",8,0)
 ;
"RTN","RCDPEM9",9,0)
 ;          -1 = none selected
"RTN","RCDPEM9",10,0)
 ;           1 = range of payers
"RTN","RCDPEM9",11,0)
 ;           2 = all payers selected
"RTN","RCDPEM9",12,0)
 ;           3 = specific payers
"RTN","RCDPEM9",13,0)
 ; 
"RTN","RCDPEM9",14,0)
 ; Payers selected are returned in ^TMP("RCSELPAY",$J
"RTN","RCDPEM9",15,0)
 ;
"RTN","RCDPEM9",16,0)
 N RCPAY,RCINC,CNT,RTNFLG,I,RCANS,INDX,X,RCANS2,DIR,Y,DTOUT,DUOUT
"RTN","RCDPEM9",17,0)
 ;
"RTN","RCDPEM9",18,0)
 S RTNFLG=0,INDX=1
"RTN","RCDPEM9",19,0)
 ;
"RTN","RCDPEM9",20,0)
 ;Clear list of selected payers
"RTN","RCDPEM9",21,0)
 K ^TMP("RCSELPAY",$J)
"RTN","RCDPEM9",22,0)
 ;
"RTN","RCDPEM9",23,0)
 ;Select option required (All, Selected or Range)
"RTN","RCDPEM9",24,0)
 S DIR(0)="SA^A:ALL;S:SPECIFIC;R:RANGE",DIR("A")="RUN REPORT FOR (A)LL, (S)PECIFIC, OR (R)ANGE OF INSURANCE COMPANIES?: ",DIR("B")="ALL" W ! D ^DIR K DIR
"RTN","RCDPEM9",25,0)
 ;Abort on ^ exit or timeout
"RTN","RCDPEM9",26,0)
 I $D(DTOUT)!$D(DUOUT) S RTNFLG=-1 Q RTNFLG
"RTN","RCDPEM9",27,0)
 ;
"RTN","RCDPEM9",28,0)
 ;ALL payers
"RTN","RCDPEM9",29,0)
 I Y="A" D
"RTN","RCDPEM9",30,0)
 .; Build list of ALL stations
"RTN","RCDPEM9",31,0)
 .S CNT=0,RCPAY="",RTNFLG=2
"RTN","RCDPEM9",32,0)
 .F  S RCPAY=$O(^RCY(FILE,"C",RCPAY)) Q:RCPAY=""  D
"RTN","RCDPEM9",33,0)
 ..S CNT=CNT+1,^TMP("RCSELPAY",$J,CNT)=RCPAY
"RTN","RCDPEM9",34,0)
 ;
"RTN","RCDPEM9",35,0)
 ;Selected Payers
"RTN","RCDPEM9",36,0)
 I Y="S" D
"RTN","RCDPEM9",37,0)
 .D GLIST(FILE),GETPAYS(CNT)
"RTN","RCDPEM9",38,0)
 ;
"RTN","RCDPEM9",39,0)
 ;Range of Payers
"RTN","RCDPEM9",40,0)
 I Y="R" D
"RTN","RCDPEM9",41,0)
 .D GLIST(FILE),GETPAYR
"RTN","RCDPEM9",42,0)
 ;
"RTN","RCDPEM9",43,0)
 ;Clear list of all payers
"RTN","RCDPEM9",44,0)
 K:RTNFLG'=2 ^TMP("RCPAYER",$J)
"RTN","RCDPEM9",45,0)
 ;If aborting also clear any selected payers
"RTN","RCDPEM9",46,0)
 K:RTNFLG=-1 ^TMP("RCSELPAY",$J)
"RTN","RCDPEM9",47,0)
 ;
"RTN","RCDPEM9",48,0)
 ;Return value
"RTN","RCDPEM9",49,0)
 Q RTNFLG
"RTN","RCDPEM9",50,0)
 ;
"RTN","RCDPEM9",51,0)
GLIST(FILE) ;Build list for this file
"RTN","RCDPEM9",52,0)
 ;
"RTN","RCDPEM9",53,0)
 ;Clear workfile
"RTN","RCDPEM9",54,0)
 K ^TMP("RCPAYER",$J)
"RTN","RCDPEM9",55,0)
 ;
"RTN","RCDPEM9",56,0)
 ; Build list of available stations
"RTN","RCDPEM9",57,0)
 S CNT=0,RCPAY=""
"RTN","RCDPEM9",58,0)
 F  S RCPAY=$O(^RCY(FILE,"C",RCPAY)) Q:RCPAY=""  D
"RTN","RCDPEM9",59,0)
 .S CNT=CNT+1
"RTN","RCDPEM9",60,0)
 .S ^TMP("RCPAYER",$J,CNT)=RCPAY
"RTN","RCDPEM9",61,0)
 .S ^TMP("RCPAYER",$J,"B",RCPAY,CNT)=""
"RTN","RCDPEM9",62,0)
 ;
"RTN","RCDPEM9",63,0)
 Q
"RTN","RCDPEM9",64,0)
 ;
"RTN","RCDPEM9",65,0)
GETPAYS(CNT) ;select payer for filter, specific
"RTN","RCDPEM9",66,0)
 ;
"RTN","RCDPEM9",67,0)
 N PNAME
"RTN","RCDPEM9",68,0)
 ;
"RTN","RCDPEM9",69,0)
 K ^TMP("RCDPEM9",$J)
"RTN","RCDPEM9",70,0)
 ;
"RTN","RCDPEM9",71,0)
 F  Q:RTNFLG'=0  D
"RTN","RCDPEM9",72,0)
 .N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","RCDPEM9",73,0)
 .S DIR("A")="SELECT INSURANCE COMPANY"
"RTN","RCDPEM9",74,0)
 .S DIR(0)="FO^1:30"
"RTN","RCDPEM9",75,0)
 .S DIR("?")="ENTER THE NAME OF THE PAYER OR '??' TO LIST PAYERS"
"RTN","RCDPEM9",76,0)
 .S DIR("??")="^D LIST^RCDPEM9(CNT)"
"RTN","RCDPEM9",77,0)
 .D ^DIR K DIR
"RTN","RCDPEM9",78,0)
 .;User pressed ENTER
"RTN","RCDPEM9",79,0)
 .I Y="",'$D(DTOUT) S RTNFLG=$S($D(^TMP("RCSELPAY")):3,1:-1) Q
"RTN","RCDPEM9",80,0)
 .;First check for exits
"RTN","RCDPEM9",81,0)
 .I $D(DUOUT)!$D(DTOUT)!$D(DIRUT)!$D(DIROUT) S RTNFLG=-1 Q
"RTN","RCDPEM9",82,0)
 .;Check for  help
"RTN","RCDPEM9",83,0)
 .S (RCANS,RCANS2)=""
"RTN","RCDPEM9",84,0)
 .S RCANS=Y
"RTN","RCDPEM9",85,0)
 .; Now check for exotic user input
"RTN","RCDPEM9",86,0)
 .I '(RCANS?.N) S RCANS2=$O(^TMP("RCPAYER",$J,"B",RCANS,RCANS2)) D:'RCANS2 PART Q:'$G(RCANS2)
"RTN","RCDPEM9",87,0)
 .S:$G(RCANS2) RCANS=RCANS2 I RCANS="" W "  ??" Q
"RTN","RCDPEM9",88,0)
 .I RCANS?.N&((+RCANS<1)!(+RCANS>CNT)) W "  ??" Q
"RTN","RCDPEM9",89,0)
 .I RCANS'?.N W "  ??" Q
"RTN","RCDPEM9",90,0)
 .I $D(^TMP("RCDPEM9",$J,RCANS)) W "  ?? PAYER ALREADY SELECTED" Q
"RTN","RCDPEM9",91,0)
 .S ^TMP("RCDPEM9",$J,RCANS)=""
"RTN","RCDPEM9",92,0)
 .S PNAME=$G(^TMP("RCPAYER",$J,RCANS))
"RTN","RCDPEM9",93,0)
 .W "  "_PNAME
"RTN","RCDPEM9",94,0)
 .S ^TMP("RCSELPAY",$J,INDX)=$G(^TMP("RCPAYER",$J,RCANS))
"RTN","RCDPEM9",95,0)
 .S INDX=INDX+1
"RTN","RCDPEM9",96,0)
 ;
"RTN","RCDPEM9",97,0)
 K ^TMP("RCDPEM9",$J)
"RTN","RCDPEM9",98,0)
 Q
"RTN","RCDPEM9",99,0)
 ;
"RTN","RCDPEM9",100,0)
LIST(CNT) ;
"RTN","RCDPEM9",101,0)
 ; Prompt users for stations to be used for filtering
"RTN","RCDPEM9",102,0)
 N I
"RTN","RCDPEM9",103,0)
 F I=1:1:CNT D
"RTN","RCDPEM9",104,0)
 .W !,I,".",?5,$G(^TMP("RCPAYER",$J,I))
"RTN","RCDPEM9",105,0)
 Q
"RTN","RCDPEM9",106,0)
 ;
"RTN","RCDPEM9",107,0)
PART ;
"RTN","RCDPEM9",108,0)
 N RCPAR,CNT,IEN
"RTN","RCDPEM9",109,0)
 S RCPAR=0,CNT=0
"RTN","RCDPEM9",110,0)
 F  S RCPAR=$O(^TMP("RCPAYER",$J,"B",RCPAR)) Q:RCPAR=""  D
"RTN","RCDPEM9",111,0)
 .S IEN=$O(^TMP("RCPAYER",$J,"B",RCPAR,""))
"RTN","RCDPEM9",112,0)
 .I $E(RCPAR,1,$L(RCANS))[RCANS W !,?10,IEN,".",^TMP("RCPAYER",$J,IEN) S CNT=1
"RTN","RCDPEM9",113,0)
 I 'CNT W "  ??"
"RTN","RCDPEM9",114,0)
 Q
"RTN","RCDPEM9",115,0)
 ;
"RTN","RCDPEM9",116,0)
GETPAYR ;select payer for filter, range
"RTN","RCDPEM9",117,0)
 ; called from ^RCDPEAR1
"RTN","RCDPEM9",118,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,INDX,X,Y,RCINSF,RCINST,NUM
"RTN","RCDPEM9",119,0)
 S DIR("?")="ENTER THE NAME OF THE PAYER OR '??' TO LIST PAYERS"
"RTN","RCDPEM9",120,0)
 S DIR("??")="^D LIST^RCDPEM9(CNT)"
"RTN","RCDPEM9",121,0)
 S DIR(0)="FA^1:30^K:X'?1.U.E X",DIR("A")="START WITH INSURANCE COMPANY NAME: ",DIR("B")=$E($O(^TMP("RCPAYER",$J,"B","")),1,30)
"RTN","RCDPEM9",122,0)
 D ^DIR K DIR
"RTN","RCDPEM9",123,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!(Y="") S RTNFLG=-1 Q
"RTN","RCDPEM9",124,0)
 S RCINSF=Y
"RTN","RCDPEM9",125,0)
 S DIR("?")="ENTER THE NAME OF THE PAYER OR '??' TO LIST PAYERS"
"RTN","RCDPEM9",126,0)
 S DIR("??")="^D LIST^RCDPEM9(CNT)"
"RTN","RCDPEM9",127,0)
 S DIR(0)="FA^1:30^K:X'?1.U.E X",DIR("A")="GO TO INSURANCE COMPANY NAME: ",DIR("B")=$E($O(^TMP("RCPAYER",$J,"B",""),-1),1,30)
"RTN","RCDPEM9",128,0)
 F  W ! D ^DIR Q:$S($D(DTOUT)!$D(DUOUT):1,1:RCINSF']Y)  W !,"'GO TO' NAME MUST COME AFTER 'START WITH' NAME"
"RTN","RCDPEM9",129,0)
 K DIR
"RTN","RCDPEM9",130,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!(Y="") S RTNFLG=-1 Q
"RTN","RCDPEM9",131,0)
 S RCINST=Y_"Z"  ;entry of "ABC" will pick up "ABC INSURANCE" if "Z" is appended
"RTN","RCDPEM9",132,0)
 ;If the first name is an exact match, back up to the previous entry
"RTN","RCDPEM9",133,0)
 I $D(^TMP("RCPAYER",$J,"B",RCINSF)) S RCINSF=$O(^TMP("RCPAYER",$J,"B",RCINSF),-1)
"RTN","RCDPEM9",134,0)
 S INDX=1 F  S RCINSF=$O(^TMP("RCPAYER",$J,"B",RCINSF)) Q:RCINSF=""  Q:RCINSF]RCINST  D
"RTN","RCDPEM9",135,0)
 . S NUM=$O(^TMP("RCPAYER",$J,"B",RCINSF,""))
"RTN","RCDPEM9",136,0)
 . S ^TMP("RCSELPAY",$J,INDX)=$G(^TMP("RCPAYER",$J,NUM))
"RTN","RCDPEM9",137,0)
 . S INDX=INDX+1
"RTN","RCDPEM9",138,0)
 ;Set return value
"RTN","RCDPEM9",139,0)
 I INDX=1 S RTNFLG=-1 Q  ; no entries in selected range
"RTN","RCDPEM9",140,0)
 S RTNFLG=1
"RTN","RCDPEM9",141,0)
 Q
"RTN","RCDPEWL3")
0^31^B86449608^B80108655
"RTN","RCDPEWL3",1,0)
RCDPEWL3 ;ALB/TMK/KML - ELECTRONIC EOB WORKLIST ACTIONS ;24-FEB-03
"RTN","RCDPEWL3",2,0)
 ;;4.5;Accounts Receivable;**173,276**;Mar 20, 1995;Build 87
"RTN","RCDPEWL3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEWL3",4,0)
 Q
"RTN","RCDPEWL3",5,0)
 ;
"RTN","RCDPEWL3",6,0)
SPLIT(RCSCR,RCL) ; Perform line splits
"RTN","RCDPEWL3",7,0)
 N Z,Z0,DIR,X,Y,RCL1,DA,DR,DIE,DIC,RCDONE,RCDIR,RCSPLIT,RCTOT,RCOK,RCLINE
"RTN","RCDPEWL3",8,0)
 ;
"RTN","RCDPEWL3",9,0)
 D CLEAR^VALM1
"RTN","RCDPEWL3",10,0)
 S ^TMP($J,"RCDPE_SPLIT")=""
"RTN","RCDPEWL3",11,0)
 S RCLINE=$G(^TMP("RCDPE-EOB_WLDX",$J,RCL)),RCL1=$G(^TMP("RCDPE-EOB_WLDX",$J,RCL\1))
"RTN","RCDPEWL3",12,0)
 ;
"RTN","RCDPEWL3",13,0)
 S Z=+$O(^TMP("RCDPE-EOB_WLDX",$J,RCL)),Z0=+$G(^TMP("RCDPE-EOB_WLDX",$J,Z)) S:'Z0 Z0=999
"RTN","RCDPEWL3",14,0)
 W !
"RTN","RCDPEWL3",15,0)
 F Z=+RCLINE:1:Z0 Q:'$D(^TMP("RCDPE-EOB_WL",$J,Z,0))!(Z'<Z0)  W !,^TMP("RCDPE-EOB_WL",$J,Z,0)
"RTN","RCDPEWL3",16,0)
 ;
"RTN","RCDPEWL3",17,0)
 I $E($P(RCL1,U,2),1,3)["ADJ" D  G SPLITQ
"RTN","RCDPEWL3",18,0)
 . W !,"THIS IS AN ERA-LEVEL ADJUSTMENT - ONLY THE ADJUSTMENT COMMENT CAN BE EDITED"
"RTN","RCDPEWL3",19,0)
 . S DIR(0)="A" D ^DIR K DIR
"RTN","RCDPEWL3",20,0)
 . S DA(2)=RCSCR,DA(1)=+$P(RCLINE,U,2),DA=+$P($P(RCL1,U,2),"ADJ",2)
"RTN","RCDPEWL3",21,0)
 . Q:'DA
"RTN","RCDPEWL3",22,0)
 . D EDITCOM(.DA)
"RTN","RCDPEWL3",23,0)
 ;
"RTN","RCDPEWL3",24,0)
 S RCDONE=0,RCDIR(1)=$P($G(^RCY(344.49,RCSCR,1,+$P(RCLINE,U,2),0)),U,2),RCDIR(2)=$P($G(^RCY(344.49,RCSCR,1,+$P(RCLINE,U,2),0)),U,5),RCDIR(3)=$P($G(^RCY(344.49,RCSCR,1,+$P(RCLINE,U,2),0)),U,8),RCDIR(6)=+$P(RCLINE,U,2)
"RTN","RCDPEWL3",25,0)
 S RCDIR=RCDIR(1)_U_RCDIR(2)_U_RCDIR(3)
"RTN","RCDPEWL3",26,0)
 ;
"RTN","RCDPEWL3",27,0)
 S RCSPLIT=0
"RTN","RCDPEWL3",28,0)
 I $P(RCDIR,U,3) W !!,"NOTE: THIS LINE HAS AN ADJUSTMENT RECORD ASSOCIATED WITH IT",!
"RTN","RCDPEWL3",29,0)
 F  D  Q:RCDONE
"RTN","RCDPEWL3",30,0)
 . S RCSPLIT=RCSPLIT+1
"RTN","RCDPEWL3",31,0)
 . D EDIT(RCSCR,RCLINE,.RCDIR,.RCSPLIT,"",.RCDONE)
"RTN","RCDPEWL3",32,0)
 . I '$D(RCSPLIT(RCSPLIT)) S RCSPLIT=RCSPLIT-1
"RTN","RCDPEWL3",33,0)
 ;
"RTN","RCDPEWL3",34,0)
 G:'$O(RCSPLIT(0)) SPLITQ
"RTN","RCDPEWL3",35,0)
 N VALMCNT,VALMBG
"RTN","RCDPEWL3",36,0)
 S VALMCNT=0,VALMBG=1
"RTN","RCDPEWL3",37,0)
 S ^TMP($J,"RCDPE_SPLIT_FILE")=1
"RTN","RCDPEWL3",38,0)
 D EN^VALM("RCDPE EOB WORKLIST SPLIT")
"RTN","RCDPEWL3",39,0)
 ;
"RTN","RCDPEWL3",40,0)
SPLITQ Q
"RTN","RCDPEWL3",41,0)
 ;
"RTN","RCDPEWL3",42,0)
TOT(N,RCSPLIT,RCLINE) ; CALCULATE TOTAL OF PAY (N=2) or ADJ (N=3)
"RTN","RCDPEWL3",43,0)
 ; RCSPLIT = the array (passed by ref) where the amounts are stored
"RTN","RCDPEWL3",44,0)
 ; RCLINE = if editing, this is the line # NOT to add in when
"RTN","RCDPEWL3",45,0)
 ;          determining previous amounts entered
"RTN","RCDPEWL3",46,0)
 N Z,Z0
"RTN","RCDPEWL3",47,0)
 S (Z,Z0)=0
"RTN","RCDPEWL3",48,0)
 F  S Z=$O(RCSPLIT(Z)) Q:'Z  I $S('$G(RCLINE):1,1:RCLINE'=Z) S Z0=Z0+$P(RCSPLIT(Z),U,N)
"RTN","RCDPEWL3",49,0)
 Q $J(Z0,"",2)
"RTN","RCDPEWL3",50,0)
 ;
"RTN","RCDPEWL3",51,0)
UPD(Q,Q1) ;
"RTN","RCDPEWL3",52,0)
 N DA,DIE,DR,X,Y
"RTN","RCDPEWL3",53,0)
 S DA(1)=Q,DA=Q1
"RTN","RCDPEWL3",54,0)
 S DIE="^RCY(344.49,"_DA(1)_",1,",DR="2.03////"_DUZ_";2.04////"_$$NOW^XLFDT() D ^DIE
"RTN","RCDPEWL3",55,0)
 S ^TMP("RCDPE_SPLIT_REBLD",$J)=1
"RTN","RCDPEWL3",56,0)
 Q
"RTN","RCDPEWL3",57,0)
 ;
"RTN","RCDPEWL3",58,0)
HDR ;
"RTN","RCDPEWL3",59,0)
 N Z,Z0,ZCT
"RTN","RCDPEWL3",60,0)
 S ZCT=0
"RTN","RCDPEWL3",61,0)
 S Z=+$O(^TMP("RCDPE-EOB_WLDX",$J,RCL)),Z0=+$G(^TMP("RCDPE-EOB_WLDX",$J,Z)) S:'Z0 Z0=999
"RTN","RCDPEWL3",62,0)
 F Z=+RCLINE:1:Z0 Q:'$D(^TMP("RCDPE-EOB_WL",$J,Z,0))!(Z'<Z0)!(ZCT'<6)  S ZCT=ZCT+1,VALMHDR(ZCT)=^TMP("RCDPE-EOB_WL",$J,Z,0)
"RTN","RCDPEWL3",63,0)
 S ZCT=ZCT+1,VALMHDR(ZCT)=" "
"RTN","RCDPEWL3",64,0)
 Q
"RTN","RCDPEWL3",65,0)
 ;
"RTN","RCDPEWL3",66,0)
FNL ;
"RTN","RCDPEWL3",67,0)
 K ^TMP("RCDPE_EOB_SPLIT",$J),^TMP("RCDPE_EOB_SPLIT_OK",$J),^TMP("RCDPE_EOB_SPLITDX",$J)
"RTN","RCDPEWL3",68,0)
 Q
"RTN","RCDPEWL3",69,0)
 ;
"RTN","RCDPEWL3",70,0)
INIT ; Build screen for display
"RTN","RCDPEWL3",71,0)
 ; RCSCR, RCDIR, RCSPLIT must already exist
"RTN","RCDPEWL3",72,0)
 N Z,RCTOT,DIR,X,Y,RCNT,RCCT,Q,RCT
"RTN","RCDPEWL3",73,0)
 K ^TMP("RCDPE_EOB_SPLIT",$J)
"RTN","RCDPEWL3",74,0)
 S (VALMCNT,RCNT)=0
"RTN","RCDPEWL3",75,0)
 S ^TMP("RCDPE_EOB_SPLIT_OK",$J)=1
"RTN","RCDPEWL3",76,0)
 F Z=2,3 S RCTOT(Z)=$$TOT(Z,.RCSPLIT)
"RTN","RCDPEWL3",77,0)
 I +RCTOT(2)'=+$P(RCDIR,U,2)!(+RCTOT(3)'=+$P(RCDIR,U,3)) D
"RTN","RCDPEWL3",78,0)
 . D SET("**** TOTAL AMOUNTS ENTERED DO NOT MATCH THE ORIGINAL AMOUNTS ****",1),SET(" ",1)
"RTN","RCDPEWL3",79,0)
 . S ^TMP("RCDPE_EOB_SPLIT_OK",$J)=0
"RTN","RCDPEWL3",80,0)
 ;
"RTN","RCDPEWL3",81,0)
 S (RCCT,Z,RCT(1),RCT(2),RCT(3))=0
"RTN","RCDPEWL3",82,0)
 F  S Z=$O(RCSPLIT(Z)) Q:'Z  D
"RTN","RCDPEWL3",83,0)
 . S X="",RCCT=RCCT+1
"RTN","RCDPEWL3",84,0)
 . S X=$$SETFLD^VALM1(RCCT,X,"NUM")
"RTN","RCDPEWL3",85,0)
 . S X=$$SETFLD^VALM1($P(RCSPLIT(Z),U)_$S('$P(RCSPLIT(Z),U,5):" (NOT IN A/R)",1:""),X,"CLAIM")
"RTN","RCDPEWL3",86,0)
 . S X=$$SETFLD^VALM1($J(+$P(RCSPLIT(Z),U,2),15,2),X,"PAYMENT"),RCT(1)=RCT(1)+$P(RCSPLIT(Z),U,2)
"RTN","RCDPEWL3",87,0)
 . S X=$$SETFLD^VALM1($J(+$P(RCSPLIT(Z),U,3),15,2),X,"ADJUSTMENT"),RCT(2)=RCT(2)+$P(RCSPLIT(Z),U,3)
"RTN","RCDPEWL3",88,0)
 . S X=$$SETFLD^VALM1($J($P(RCSPLIT(Z),U,2)+$P(RCSPLIT(Z),U,3),15,2),X,"NET"),RCT(3)=RCT(3)+$P(RCSPLIT(Z),U,2)+$P(RCSPLIT(Z),U,3)
"RTN","RCDPEWL3",89,0)
 . D SET(X,RCCT)
"RTN","RCDPEWL3",90,0)
 . I $P(RCSPLIT(Z),U,6)'="",$P(RCSPLIT(Z),U,6)'="@" S X=$$SETSTR^VALM1($J("",10)_$P(RCSPLIT(Z),U,6),"",1,70) D SET(X,RCCT)
"RTN","RCDPEWL3",91,0)
 S Q="",$P(Q,"=",15)=""
"RTN","RCDPEWL3",92,0)
 D SET($J("",32)_Q_"   "_Q_"   "_Q,RCCT),SET($E("    TOTALS: "_$J("",31),1,31)_$E($J(+RCT(1),15,2)_$J("",17),1,17)_$E($J(+RCT(2),15,2)_$J("",17),1,17)_$E($J(+RCT(3),15,2)_$J("",17),1,17),RCCT)
"RTN","RCDPEWL3",93,0)
 ;
"RTN","RCDPEWL3",94,0)
 Q
"RTN","RCDPEWL3",95,0)
 ;
"RTN","RCDPEWL3",96,0)
SET(X,RCSEQ) ;
"RTN","RCDPEWL3",97,0)
 S VALMCNT=VALMCNT+1
"RTN","RCDPEWL3",98,0)
 S ^TMP("RCDPE_EOB_SPLIT",$J,VALMCNT,0)=X
"RTN","RCDPEWL3",99,0)
 S ^TMP("RCDPE_EOB_SPLIT",$J,"IDX",VALMCNT,RCSEQ)=""
"RTN","RCDPEWL3",100,0)
 S ^TMP("RCDPE_EOB_SPLITDX",$J,RCSEQ)=VALMCNT
"RTN","RCDPEWL3",101,0)
 Q
"RTN","RCDPEWL3",102,0)
 ;
"RTN","RCDPEWL3",103,0)
EDITCOM(DA) ; Edit the comment for an adjustment entry
"RTN","RCDPEWL3",104,0)
 N RCX,DIE,X,Y,DR
"RTN","RCDPEWL3",105,0)
 S RCX=$P($G(^RCY(344.49,DA(2),1,DA(1),1,DA,0)),U,9)
"RTN","RCDPEWL3",106,0)
 S DIE="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,",DR=".09"
"RTN","RCDPEWL3",107,0)
 D ^DIE
"RTN","RCDPEWL3",108,0)
 Q:$P($G(^RCY(344.49,DA(2),1,DA(1),1,DA,0)),U,9)=RCX
"RTN","RCDPEWL3",109,0)
 D UPD(DA(2),DA(1))
"RTN","RCDPEWL3",110,0)
 Q
"RTN","RCDPEWL3",111,0)
 ;
"RTN","RCDPEWL3",112,0)
EDIT(RCSCR,RCLINE,RCDIR,RCSPLIT,RCDEF,RCDONE) ; Edit a split line
"RTN","RCDPEWL3",113,0)
 ;
"RTN","RCDPEWL3",114,0)
 N CT,DIR,DIC,X,Y,RCOK,RCL,Z,DUOUT,DTOUT
"RTN","RCDPEWL3",115,0)
 ; Enter claim #
"RTN","RCDPEWL3",116,0)
 S RCL=$G(RCDIR(6))
"RTN","RCDPEWL3",117,0)
EDCL S DIR("?",1)="ENTER THE CLAIM # TO WHICH THE PAYMENT OR ADJUSTMENT WILL BE APPLIED.",DIR("?",2)="THE CLAIM # DOES NOT HAVE TO EXIST IN YOUR AR IF THE PAYMENT/ADJUSTMENT",DIR("?")="BELONGS TO ANOTHER SITE."
"RTN","RCDPEWL3",118,0)
 S DIR(0)="FAO^1:15",DIR("A")="CLAIM #: " S:$P($G(RCDEF),U)'="" DIR("B")=$P(RCDEF,U) S:$G(RCDIR(1))'=""&($G(DIR("B"))="") DIR("B")=RCDIR(1) W ! D ^DIR K DIR
"RTN","RCDPEWL3",119,0)
 I $D(DTOUT)!$D(DUOUT) D ABORT Q
"RTN","RCDPEWL3",120,0)
 I Y="" D  G:'RCDONE EDCL Q
"RTN","RCDPEWL3",121,0)
 . S DIR(0)="YA",DIR("A",1)="YOU MUST SPLIT THE ENTIRE AMOUNT OF THE LINE.",DIR("A",2)=" $"_$J(+RCDIR(2),"",2)_" PAYMENT IS LEFT"_$S($P(RCDIR,U,3)&$G(RCDIR(3)):" AND $"_$J(+RCDIR(3),"",2)_" ADJ IS LEFT",1:"")
"RTN","RCDPEWL3",122,0)
 . S DIR("A")="DO YOU WANT TO ABORT THIS SPLIT NOW?: ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEWL3",123,0)
 . I Y'=0 D ABORT Q
"RTN","RCDPEWL3",124,0)
 S $P(RCSPLIT(RCSPLIT),U)=Y
"RTN","RCDPEWL3",125,0)
 ;
"RTN","RCDPEWL3",126,0)
 I $E(Y,1,3)?3N,$L(Y)>7,Y'["-" S Y=$E(Y,1,3)_"-"_$E(Y,4,$L(Y))
"RTN","RCDPEWL3",127,0)
 I $TR(Y," ")="" S Y=-1
"RTN","RCDPEWL3",128,0)
 I Y'=-1 S DIC="^PRCA(430,",DIC(0)="M" D ^DIC K DIC
"RTN","RCDPEWL3",129,0)
 I +Y>0 D  I 'RCOK K RCSPLIT(RCSPLIT) G EDCL
"RTN","RCDPEWL3",130,0)
 . S RCOK=1
"RTN","RCDPEWL3",131,0)
 . I '$D(^DGCR(399,+Y,0)) W !,"   THIS IS NOT A 3RD PARTY CLAIM. CLAIMS NEED TO BE 3RD PARTY." S RCOK=0 Q  ; prca276 place screen to only allow selection of third party claims
"RTN","RCDPEWL3",132,0)
 . I '$$VALSTAT^RCDPEM5(+Y) W !,"  CLAIM IS IN AN INCOMPLETE STATUS. ENTER ANOTHER CLAIM." S RCOK=0  ; prca276 do not allow incomplete claims
"RTN","RCDPEWL3",133,0)
 I Y<0 D  G:'RCOK EDCL
"RTN","RCDPEWL3",134,0)
 . S RCOK=1
"RTN","RCDPEWL3",135,0)
 . S DIR("A")="   THIS CLAIM WAS NOT FOUND IN YOUR AR.  DO YOU WANT TO CONTINUE?: ",DIR("B")="NO",DIR(0)="YA" D ^DIR K DIR W ! I Y'=1 K RCSPLIT(RCSPLIT) S RCOK=0
"RTN","RCDPEWL3",136,0)
 E  D
"RTN","RCDPEWL3",137,0)
 . S $P(RCSPLIT(RCSPLIT),U,5)=+Y
"RTN","RCDPEWL3",138,0)
 . W "  >>Current claim balance is: ",$J(+$P($$BILL^RCJIBFN2(+Y),U,3),"",2)
"RTN","RCDPEWL3",139,0)
 ; Enter payment
"RTN","RCDPEWL3",140,0)
 S RCDIR(1)=""
"RTN","RCDPEWL3",141,0)
 S DIR("?",1)="**************"
"RTN","RCDPEWL3",142,0)
 S CT=1
"RTN","RCDPEWL3",143,0)
 I $P(RCDIR,U,3) D
"RTN","RCDPEWL3",144,0)
 . S DIR("?",CT+1)="SINCE THIS LINE HAS AN ADJUSTMENT, THE AMOUNT ENTERED HERE SHOULD BE THE",DIR("?",CT+2)="CORRECTED AMOUNT THE PAYER INDICATED THEY SHOULD HAVE PAID FOR THE CLAIM",DIR("?",CT+3)=" ",CT=CT+3
"RTN","RCDPEWL3",145,0)
 S CT=CT+1,DIR("?",CT)="ENTER THE AMT FROM THE PAYMENT TOTAL FOR THIS LINE ("_$J(+$P(RCDIR,U,2),"",2)_")"
"RTN","RCDPEWL3",146,0)
 I $G(RCDEF)="" D
"RTN","RCDPEWL3",147,0)
 . S CT=CT+1,DIR("?",CT)=" THAT APPLIES TO THIS CLAIM.  THE PAYMENT AMOUNT ALREADY USED FOR THIS"
"RTN","RCDPEWL3",148,0)
 . S CT=CT+1,DIR("?",CT)=" LINE SPLIT IS: "_$J(+$$TOT(2,.RCSPLIT,$S(RCDEF="":"",1:RCSPLIT)),"",2)_" LEAVING A BALANCE TO DISTRIBUTE OF: "_$J($P(RCDIR,U,2)-$$TOT(2,.RCSPLIT,$S(RCDEF="":"",1:RCSPLIT)),"",2)
"RTN","RCDPEWL3",149,0)
 S CT=CT+1,DIR("?",CT)="THE TOTAL PAYMENTS ENTERED DURING THIS SPLIT MUST EQUAL THE ORIGINAL LINE",DIR("?")=" PAYMENT AMOUNT OF $"_$J(+$P(RCDIR,U,2),"",2)
"RTN","RCDPEWL3",150,0)
 S DIR(0)="NAO^0:"_$S(RCDEF="":$P(RCDIR,U,2)-$$TOT(2,.RCSPLIT,RCSPLIT),1:$P(RCDIR,U,2))_":2"
"RTN","RCDPEWL3",151,0)
 S DIR("A")="PAYMENT AMOUNT TO APPLY TO THIS CLAIM: " S:$P($G(RCDEF),U,2)'="" DIR("B")=$J(+$P(RCDEF,U,2),"",2) S:$G(RCDIR(2))'=""&($G(DIR("B"))="") DIR("B")=RCDIR(2) D ^DIR K DIR
"RTN","RCDPEWL3",152,0)
 I $D(DTOUT)!$D(DUOUT) K RCSPLIT(RCSPLIT) G EDCL
"RTN","RCDPEWL3",153,0)
 S $P(RCSPLIT(RCSPLIT),U,2)=Y,RCDIR(2)=$J($P(RCDIR,U,2)-$$TOT(2,.RCSPLIT),"",2)
"RTN","RCDPEWL3",154,0)
 ; Enter adj
"RTN","RCDPEWL3",155,0)
 I $O(^RCY(344.49,RCSCR,1,+$P(RCLINE,U,2),1,0)) D  G:'RCOK EDCL
"RTN","RCDPEWL3",156,0)
 . S RCOK=1
"RTN","RCDPEWL3",157,0)
 . W !!,$J("",5)_"THIS LINE CONTAINS AN ADJUSTMENT AMOUNT OF $"_$J(+$P(RCDIR,U,3),"",2),!,$J("",5)_"THIS AMT IS USUALLY THE AMT THE PAYER PREVIOUSLY PAID",!,$J("",5),"ON A CLAIM WHICH THEY HAVE NOW AMENDED.  IF THERE WAS"
"RTN","RCDPEWL3",158,0)
 . W !,$J("",5)_"AN AMT PREVIOUSLY PAID FOR THIS CLAIM, ENTER THAT AMOUNT",!,$J("",5),"AS A NEGATIVE AMOUNT HERE.",!
"RTN","RCDPEWL3",159,0)
 . S DIR("?",1)="**************"
"RTN","RCDPEWL3",160,0)
 . S DIR("?",2)="ENTER THE AMT FROM THE ADJUSTMENT TOTAL FOR THIS LINE ("_$J(+$P(RCDIR,U,3),"",2)_")",DIR("?",3)=" THAT APPLIES TO THIS CLAIM.  THE ADJUSTMENT AMOUNT ALREADY USED FOR THIS"
"RTN","RCDPEWL3",161,0)
 . S DIR("?",4)=" LINE SPLIT IS "_$J(+$$TOT(3,.RCSPLIT,$S(RCDEF="":"",1:RCSPLIT)),"",2)_" LEAVING A BALANCE OF "_$J($P(RCDIR,U,3)-$$TOT(3,.RCSPLIT,$S(RCDEF="":"",1:RCSPLIT)),"",2)_" TO DISTRIBUTE"
"RTN","RCDPEWL3",162,0)
 . S DIR("?",5)=" ENTER IT AS THE NEGATIVE OF THE AMT THE PAYER PREVIOUSLY PAID ON THIS CLAIM"
"RTN","RCDPEWL3",163,0)
 . S DIR("?",6)="THE TOTAL ADJUSTMENTS ENTERED DURING THIS SPLIT MUST EQUAL THE ORIGINAL LINE",DIR("?")=" ADJUSTMENT AMOUNT OF $"_$J(+$P(RCDIR,U,3),"",2)
"RTN","RCDPEWL3",164,0)
 . S DIR(0)="NAO^"_$J($P(RCDIR,U,3)-$$TOT(3,.RCSPLIT,$S(RCDEF="":"",1:RCSPLIT)),"",2)_":0:2",DIR("A")="ADJUSTMENT AMOUNT: " S:$P($G(RCDEF),U,3)'="" DIR("B")=$J(+$P(RCDEF,U,3),"",2) S:$G(RCDIR(3))'=""&($G(DIR("B"))="") DIR("B")=RCDIR(3)
"RTN","RCDPEWL3",165,0)
 . D ^DIR K DIR
"RTN","RCDPEWL3",166,0)
 . I $D(DTOUT)!$D(DUOUT) S RCOK=0 K RCSPLIT(RCSPLIT) Q
"RTN","RCDPEWL3",167,0)
 . S $P(RCSPLIT(RCSPLIT),U,3)=Y,RCDIR(3)=$J($P(RCDIR,U,3)-$$TOT(3,.RCSPLIT),"",2)
"RTN","RCDPEWL3",168,0)
 I +RCDIR(2)=0,+RCDIR(3)=0 S RCDONE=1
"RTN","RCDPEWL3",169,0)
 S DIR(0)="344.491,.1AO",DIR("A")="RECEIPT LINE COMMENT: "
"RTN","RCDPEWL3",170,0)
 I $P($G(RCSPLIT(RCSPLIT)),U,6)'="" D
"RTN","RCDPEWL3",171,0)
 . I $P(RCSPLIT(RCSPLIT),U,6)'="@" S DIR("B")=$P(RCSPLIT(RCSPLIT),U,6)
"RTN","RCDPEWL3",172,0)
 E  D
"RTN","RCDPEWL3",173,0)
 . I $P($G(^RCY(344.49,RCSCR,1,+RCL,0)),U,10)'="" S DIR("B")=$P(^(0),U,10)
"RTN","RCDPEWL3",174,0)
 D ^DIR
"RTN","RCDPEWL3",175,0)
 I Y="",$G(DIR("B"))'="" W "   Comment will be deleted"
"RTN","RCDPEWL3",176,0)
 K DIR
"RTN","RCDPEWL3",177,0)
 I $D(DTOUT)!$D(DUOUT) K RCSPLIT(RCSPLIT) G EDCL
"RTN","RCDPEWL3",178,0)
 S $P(RCSPLIT(RCSPLIT),U,6)=$S(Y="":"@",1:Y)
"RTN","RCDPEWL3",179,0)
 Q
"RTN","RCDPEWL3",180,0)
 ;
"RTN","RCDPEWL3",181,0)
ABORT ; User aborted split - kill split array
"RTN","RCDPEWL3",182,0)
 N Z
"RTN","RCDPEWL3",183,0)
 S Z=RCSPLIT K RCSPLIT S RCSPLIT=Z,RCDONE=1
"RTN","RCDPEWL3",184,0)
 Q
"RTN","RCDPEWL3",185,0)
 ;
"RTN","RCDPEWL6")
0^32^B83585540^B65570960
"RTN","RCDPEWL6",1,0)
RCDPEWL6 ;ALB/TMK/KML - ELECTRONIC EOB WORKLIST ACTIONS ;18-MAR-03
"RTN","RCDPEWL6",2,0)
 ;;4.5;Accounts Receivable;**173,208,222,276**;Mar 20, 1995;Build 87
"RTN","RCDPEWL6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEWL6",4,0)
 Q
"RTN","RCDPEWL6",5,0)
 ;
"RTN","RCDPEWL6",6,0)
DISTADJ ; Distribute an adjustment that retracts a payment to other bill(s)
"RTN","RCDPEWL6",7,0)
 ; NOTE: RCSCR is assumed to be the IEN of the ERA entry in file 344.49
"RTN","RCDPEWL6",8,0)
 N RCDA,RCDA1,RCAMT,RCADJ,RCQUIT,Z,Z0,Z1,DIR,X,Y,CT,RCZ,RCZ1,RCZ2,RCADJOK,TOT,DTOUT,DUOUT
"RTN","RCDPEWL6",9,0)
 N RCNONSP,RCACTIVE,RCZZ1,RCZZ2,RCADJSTR  ; prca276 - variables used to establish non-specific payment adjustments and AR BILL claim status (fix to negative claim balance issue)
"RTN","RCDPEWL6",10,0)
 D FULL^VALM1
"RTN","RCDPEWL6",11,0)
 I $G(RCSCR("NOEDIT")) D NOEDIT^RCDPEWL G DISTQ
"RTN","RCDPEWL6",12,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL G DISTQ
"RTN","RCDPEWL6",13,0)
 ;
"RTN","RCDPEWL6",14,0)
 S Z=0,RCADJOK="" F  S Z=$O(^TMP("RCDPE-EOB_WLDX",$J,Z)) Q:'Z  S Z1=+$P($G(^(Z)),U,2),Z0=$G(^RCY(344.49,RCSCR,1,Z1,0)) D
"RTN","RCDPEWL6",15,0)
 . ;(^RCY(344.49,RCSCR,1,Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","RCDPEWL6",16,0)
 . I $P(Z0,U)'["." S RCADJOK=($P(Z0,U,2)["**ADJ") Q
"RTN","RCDPEWL6",17,0)
 . I '$P(Z0,U,7),'RCADJOK Q  ; Suspense item cannot be used to adjust
"RTN","RCDPEWL6",18,0)
 . I $P(Z0,U,6)<0 S RCZ(Z)=$P(Z0,U,6)_U_Z1 Q
"RTN","RCDPEWL6",19,0)
 . I $P(Z0,U,6)>0 D  Q
"RTN","RCDPEWL6",20,0)
 .. N Q,ONHLD,IBA
"RTN","RCDPEWL6",21,0)
 .. S ONHLD=0
"RTN","RCDPEWL6",22,0)
 .. I $P(Z0,U,7) I $$IB^IBRUTL(+$P(Z0,U,7),1) S Q=0 F  S Q=$O(IBA(Q)) Q:'Q  I $P($G(^IB(+IBA(Q),0)),U,5)=8 S ONHLD=1 Q
"RTN","RCDPEWL6",23,0)
 .. S RCZ1(+$P(Z0,U,6),Z)=Z1_U_ONHLD,RCZ2(Z)=Z1_U_$P(Z0,U,6)_U_ONHLD Q
"RTN","RCDPEWL6",24,0)
 ;
"RTN","RCDPEWL6",25,0)
 I $O(RCZ(0))="" D  G DISTQ
"RTN","RCDPEWL6",26,0)
 . S DIR(0)="EA",DIR("A",1)="NO LINES EXIST NEEDING ADJUSTMENT DISTRIBUTION",DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL6",27,0)
 ;
"RTN","RCDPEWL6",28,0)
 I $O(RCZ1(0))="" D  G DISTQ
"RTN","RCDPEWL6",29,0)
 . S DIR(0)="EA",DIR("A",1)="NO VALID LINES EXIST ON THIS ERA WHERE A DISTRIBUTION CAN BE MADE",DIR("A",2)=$$WHAT(RCSCR),DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL6",30,0)
 ;
"RTN","RCDPEWL6",31,0)
 S RCQUIT=0
"RTN","RCDPEWL6",32,0)
 F  S DIR(0)="NA^1:9999:3",DIR("A")="SELECT A LINE THAT NEEDS AN ADJUSTMENT AMOUNT DISTRIBUTED: " D  Q:RCQUIT
"RTN","RCDPEWL6",33,0)
 . S DIR("?",1)="THE FOLLOWING LINE(S) HAVE AN ADJUSTMENT THAT CAUSED A NEGATIVE NET PAYMENT.",DIR("?",2)="IN ORDER TO BALANCE THE RECEIPT AND THE DEPOSIT, THESE AMOUNTS WILL NEED TO",DIR("?",3)="  BE DISTRIBUTED TO OTHER LINE(S)",CT=3
"RTN","RCDPEWL6",34,0)
 . S Z=0
"RTN","RCDPEWL6",35,0)
 . F  S Z=$O(RCZ(Z)) Q:'Z  S CT=CT+1,DIR("?",CT)="  "_$J(Z,8)_"  "_$J($P(RCZ(Z),U),15,2)
"RTN","RCDPEWL6",36,0)
 . S DIR("?")=" "
"RTN","RCDPEWL6",37,0)
 . I $O(RCZ(0))=$O(RCZ(""),-1) S DIR("B")=$O(RCZ(0))
"RTN","RCDPEWL6",38,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEWL6",39,0)
 . I $D(DUOUT)!$D(DTOUT)!(Y="") S RCQUIT=1,RCDA="" Q
"RTN","RCDPEWL6",40,0)
 . I '$D(^TMP("RCDPE-EOB_WLDX",$J,Y)) W !,"THIS LINE DOES NOT EXIST FOR THIS ERA" W ! Q
"RTN","RCDPEWL6",41,0)
 . I '$D(RCZ(Y)) D  Q:Y=""
"RTN","RCDPEWL6",42,0)
 .. I Y'[".",$D(RCZ(Y_".001")),$O(RCZ(Y+1),-1)=(Y_".001") S Y=Y_".001" Q
"RTN","RCDPEWL6",43,0)
 .. W !,$S(Y["."!($O(RCZ(Y))\1'=(Y\1)):"THIS LINE DOESN'T NEED AN ADJUSTMENT DISTRIBUTION",1:"PLEASE ENTER THE ENTIRE LINE # (Such as: 1.001)") W !
"RTN","RCDPEWL6",44,0)
 .. S Y=""
"RTN","RCDPEWL6",45,0)
 . W !,"  LINE #: "_+Y_"  AMOUNT NEEDED TO DISTRIBUTE: "_$J(+RCZ(Y),"",2),!
"RTN","RCDPEWL6",46,0)
 . ; RCDA = the ien of the line in file 344.491
"RTN","RCDPEWL6",47,0)
 . ; RCDA(1) = the line #        RCDA(2) = the amount to be adjusted (+)
"RTN","RCDPEWL6",48,0)
 . S RCDA=$P(RCZ(Y),U,2),RCDA(1)=Y,RCQUIT=1,RCDA(2)=-$P(RCZ(Y),U)
"RTN","RCDPEWL6",49,0)
 ;
"RTN","RCDPEWL6",50,0)
 G:$G(RCDA)="" DISTQ
"RTN","RCDPEWL6",51,0)
 ;
"RTN","RCDPEWL6",52,0)
 S RCQUIT=0
"RTN","RCDPEWL6",53,0)
 ;
"RTN","RCDPEWL6",54,0)
 S (TOT,Z)=0 F  S Z=$O(RCZ1(Z)) Q:'Z  S TOT=TOT+Z
"RTN","RCDPEWL6",55,0)
 I TOT<RCDA(2) D  G DISTQ
"RTN","RCDPEWL6",56,0)
 . S DIR(0)="EA",DIR("A",1)="THE ERA DOES NOT HAVE ENOUGH VALID PAYMENTS TO OFFSET THIS DISTRIBUTION",DIR("A",2)=$$WHAT(RCSCR),DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL6",57,0)
 F  S DIR(0)="NA^1:9999:3",DIR("A")="SELECT A LINE TO DISTRIBUTE THE ADJUSTMENT AMOUNT TO: " D  Q:RCQUIT
"RTN","RCDPEWL6",58,0)
 . S DIR("?",1)="THE FOLLOWING LINE(S) HAVE A NET PAYMENT THAT CAN BE USED TO OFFSET THE",DIR("?",2)="  NEGATIVE NET PAYMENT FOR LINE "_RCDA(1)_" ("_$J(+$P(RCZ(RCDA(1)),U),"",2)_"):",CT=2
"RTN","RCDPEWL6",59,0)
 . S Z="" F  S Z=$O(RCZ1(Z),-1) Q:'Z  S Z0=0 F  S Z0=$O(RCZ1(Z,Z0)) Q:'Z0  S CT=CT+1,DIR("?",CT)="  "_$J(Z0,8)_"  "_$J(+Z,15,2)_$S($P(RCZ1(Z,Z0),U,2):" On hold exists",1:"")
"RTN","RCDPEWL6",60,0)
 . S DIR("?")=" "
"RTN","RCDPEWL6",61,0)
 . I $O(RCZ2(0))=$O(RCZ2(""),-1) S DIR("B")=$O(RCZ2(0))
"RTN","RCDPEWL6",62,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEWL6",63,0)
 . I $D(DUOUT)!$D(DTOUT)!(Y="") S RCQUIT=1,RCDA1="" Q
"RTN","RCDPEWL6",64,0)
 . I '$D(^TMP("RCDPE-EOB_WLDX",$J,Y)) W !,"THIS LINE DOES NOT EXIST FOR THIS ERA" W ! Q
"RTN","RCDPEWL6",65,0)
 . I '$D(RCZ2(Y)) D  Q:Y=""
"RTN","RCDPEWL6",66,0)
 .. I Y'[".",$D(RCZ2(Y_".001")),$O(RCZ2(Y+1),-1)=(Y_".001") S Y=Y_".001" Q
"RTN","RCDPEWL6",67,0)
 .. I Y'[".",$O(RCZ2(Y))\1'=Y S Y=Y_"."
"RTN","RCDPEWL6",68,0)
 .. W !,$S(Y[".":"THIS LINE CANNOT BE USED FOR AN ADJUSTMENT DISTRIBUTION",1:"PLEASE ENTER THE ENTIRE LINE # (Such as: 1.001)") W !
"RTN","RCDPEWL6",69,0)
 .. S Y=""
"RTN","RCDPEWL6",70,0)
 . ; prca276 - next few lines represent the a fix to prevent distributions agains collected/closed claims (claim balance = zero dollars)
"RTN","RCDPEWL6",71,0)
 . ;distributions should only occur on line items that have specific payments against active claims 
"RTN","RCDPEWL6",72,0)
 . S RCZZ1=$P(^TMP("RCDPE-EOB_WLDX",$J,Y),U,2) ; get line item sequence # off the VIEW order before accessing the scratchpad
"RTN","RCDPEWL6",73,0)
 . S (RCZZ2,RCNONSP)=0 F  S RCZZ2=$O(^RCY(344.49,RCSCR,1,RCZZ1,1,RCZZ2)) Q:'RCZZ2  Q:RCNONSP  S RCADJSTR=$G(^(RCZZ2,0)) S RCNONSP=$S($P(RCADJSTR,U,2)=3:1,$P(RCADJSTR,U,2)=5:1,1:0)    ;identify if non-specific payment adjustments exist
"RTN","RCDPEWL6",74,0)
 . ; do not evaluate claim status for non-specific payment adjustments
"RTN","RCDPEWL6",75,0)
 . I 'RCNONSP D  Q:'RCACTIVE
"RTN","RCDPEWL6",76,0)
 . . S RCACTIVE=$$GET1^DIQ(430,$P(^RCY(344.49,RCSCR,1,RCZZ1,0),U,7),8)
"RTN","RCDPEWL6",77,0)
 . . I (RCACTIVE'="ACTIVE")&(RCACTIVE'="OPEN") S RCACTIVE=0 W !,"THIS IS NOT AN ACTIVE BILL !",!,"CANNOT PERFORM DISTRIBUTION TO THIS CLAIM",! Q
"RTN","RCDPEWL6",78,0)
 . . S RCACTIVE=1
"RTN","RCDPEWL6",79,0)
 . I $P(RCZ2(Y),U,3) W !,"Warning - on-hold exists for this claim",!
"RTN","RCDPEWL6",80,0)
 . W !,"  LINE #: "_+Y_"  LINE BALANCE: "_$J(+$P(RCZ2(Y),U,2),"",2),!
"RTN","RCDPEWL6",81,0)
 . ; RCDA1 = the ien of the line in file 344.491
"RTN","RCDPEWL6",82,0)
 . ; RCDA1(1) = the line # in the display
"RTN","RCDPEWL6",83,0)
 . S RCDA1(1)=Y,RCDA1=+$G(RCZ2(Y)),RCQUIT=1
"RTN","RCDPEWL6",84,0)
 . S Z=$O(^RCY(344.49,RCSCR,1,"B",RCDA1(1)\1,0))
"RTN","RCDPEWL6",85,0)
 . S RCADJ=0
"RTN","RCDPEWL6",86,0)
 . I $P($G(^RCY(344.49,RCSCR,1,Z,0)),U,2)["**ADJ" S RCADJ=1 W !,"THE LINE SELECTED IS AN ADDITIONAL PAYMENT LINE, NOT SPECIFIC TO A CLAIM",!,"THE AMT WILL BE DISTRIBUTED, BUT A DECREASE ADJUSTMENT WILL NOT BE PERFORMED",!
"RTN","RCDPEWL6",87,0)
 ;
"RTN","RCDPEWL6",88,0)
 G:'$G(RCDA1) DISTQ
"RTN","RCDPEWL6",89,0)
 ;
"RTN","RCDPEWL6",90,0)
 S DIR("B")=$S(RCDA(2)<$P(RCZ2(RCDA1(1)),U,2):$J(RCDA(2),"",2),1:$J($P(RCZ2(+RCDA1(1)),U,2),"",2))
"RTN","RCDPEWL6",91,0)
 S DIR(0)="NA^.01:"_DIR("B")_":2",DIR("A")="ADJUSTMENT AMOUNT TO DISTRIBUTE: "
"RTN","RCDPEWL6",92,0)
 S DIR("?",1)="THIS IS THE AMOUNT OF THE ADJUSTMENT THAT SHOULD BE APPLIED TO THIS",DIR("?")="PAYMENT LINE.  THE AMT ENTERED MUST BE BETWEEN .01 AND "_$J(DIR("B"),"",2)
"RTN","RCDPEWL6",93,0)
 D ^DIR K DIR
"RTN","RCDPEWL6",94,0)
 ;
"RTN","RCDPEWL6",95,0)
 I $D(DUOUT)!$D(DTOUT)!'Y D  G DISTQ
"RTN","RCDPEWL6",96,0)
 . S DIR(0)="EA",DIR("A",1)="NO AMOUNT WAS ENTERED - TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL6",97,0)
 S RCAMT=$J(Y,"",2)
"RTN","RCDPEWL6",98,0)
 ;
"RTN","RCDPEWL6",99,0)
 D ^DIR K DIR
"RTN","RCDPEWL6",100,0)
 I $D(DUOUT)!$D(DTOUT) D  G DISTQ
"RTN","RCDPEWL6",101,0)
 . S DIR(0)="EA",DIR("A")="USER ABORT - PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL6",102,0)
 ;
"RTN","RCDPEWL6",103,0)
 S Y=""
"RTN","RCDPEWL6",104,0)
 I 'RCADJ D  G:'$D(RCDA) DISTQ
"RTN","RCDPEWL6",105,0)
 . N Z,RCA
"RTN","RCDPEWL6",106,0)
 . S RCA=0,Z1=+$P($G(^TMP("RCDPE-EOB_WLDX",$J,RCDA(1)\1)),U,2),Z=$G(^RCY(344.49,RCSCR,1,Z1,0)),RCA("#")=+$P($P(Z,U,2),"**ADJ",2)
"RTN","RCDPEWL6",107,0)
 . I $P(Z,U,2)["**ADJ" D
"RTN","RCDPEWL6",108,0)
 .. S RCA=1
"RTN","RCDPEWL6",109,0)
 .. S RCA("REF")=$S(RCA("#"):$P($G(^RCY(344.4,RCSCR,2,RCA("#"),0)),U),1:$P(Z,U,9))
"RTN","RCDPEWL6",110,0)
 . S Z=$S(RCA:RCA("#"),1:$G(^RCY(344.49,RCSCR,1,RCDA,0)))
"RTN","RCDPEWL6",111,0)
 . S DIR(0)="FAO^1:60",DIR("A")="  > ",DIR("A",1)="DECREASE ADJ COMMENT (1-60 CHARACTERS): "
"RTN","RCDPEWL6",112,0)
 . S DIR("B")="RETRACTED FOR "
"RTN","RCDPEWL6",113,0)
 . S DIR("B")=DIR("B")_$S(RCA:"ERA ADJ #"_Z_" Ref: "_RCA("REF"),1:"CLAIM "_$S($P(Z,U,2)'="":$P(Z,U,2),1:"UNKNOWN"))
"RTN","RCDPEWL6",114,0)
 . I $L(DIR("B"))>60 S DIR("B")=$E(DIR("B"),1,60)
"RTN","RCDPEWL6",115,0)
 . D ^DIR K DIR
"RTN","RCDPEWL6",116,0)
 . ;
"RTN","RCDPEWL6",117,0)
 . I $D(DUOUT)!$D(DTOUT) D  Q
"RTN","RCDPEWL6",118,0)
 .. K RCDA
"RTN","RCDPEWL6",119,0)
 .. S DIR(0)="EA",DIR("A")="USER ABORT - PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEWL6",120,0)
 ;
"RTN","RCDPEWL6",121,0)
 D DISTADJ^RCDPEWL4(RCDA,RCDA1,RCAMT,Y)
"RTN","RCDPEWL6",122,0)
 ;
"RTN","RCDPEWL6",123,0)
DISTQ S VALMBCK="R"
"RTN","RCDPEWL6",124,0)
 Q
"RTN","RCDPEWL6",125,0)
 ;
"RTN","RCDPEWL6",126,0)
REFRESH ; Refresh the entry in file 344.49 to remove all user adjustments
"RTN","RCDPEWL6",127,0)
 N RCREDEF,RCQUIT,DIR,X,Y,Z,Z0,DA,DIK
"RTN","RCDPEWL6",128,0)
 D FULL^VALM1
"RTN","RCDPEWL6",129,0)
 I $G(RCSCR("NOEDIT")) D NOEDIT^RCDPEWL G REFQ
"RTN","RCDPEWL6",130,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) D NOBATCH^RCDPEWL G REFQ
"RTN","RCDPEWL6",131,0)
 S DIR(0)="YA"
"RTN","RCDPEWL6",132,0)
 S DIR("A",1)="THIS ACTION WILL DELETE AND REBUILD THIS EEOB WORKLIST SCRATCH PAD ENTRY",DIR("A",2)="ALL EDITS/SPLITS/DISTRIBUTE ADJUSTMENTS ENTERED FOR THIS ERA WILL BE ERASED"
"RTN","RCDPEWL6",133,0)
 S DIR("A",3)="AND ALL ENTRIES MARKED AS MANUALLY VERIFIED WILL BE UNMARKED",DIR("A",4)=" "
"RTN","RCDPEWL6",134,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO DO THIS?: "
"RTN","RCDPEWL6",135,0)
 W ! D ^DIR K DIR
"RTN","RCDPEWL6",136,0)
 I Y'=1 G REFQ
"RTN","RCDPEWL6",137,0)
 I $O(^RCY(344.49,RCSCR,3,0)) S RCQUIT=0 D  I RCQUIT G REFQ
"RTN","RCDPEWL6",138,0)
 . S DIR(0)="YA",DIR("A")="DO YOU WANT TO REDEFINE YOUR BATCHES TOO?: ",DIR("B")="NO" W ! D ^DIR K DIR
"RTN","RCDPEWL6",139,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEWL6",140,0)
 . S RCREDEF=+Y
"RTN","RCDPEWL6",141,0)
 . K ^TMP($J,"BATCHES")
"RTN","RCDPEWL6",142,0)
 . S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,3,Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","RCDPEWL6",143,0)
 .. I RCREDEF S DA=Z,DA(1)=RCSCR,DIK="^RCY(344.49,"_DA(1)_",3," D ^DIK Q
"RTN","RCDPEWL6",144,0)
 .. S ^TMP($J,"BATCHES",+$P(Z0,U,6),$P(Z0,U,7))=+Z0_U_$P(Z0,U,8)
"RTN","RCDPEWL6",145,0)
 . I 'RCREDEF S ^TMP($J,"BATCHES")=+$O(^TMP($J,"BATCHES",0))
"RTN","RCDPEWL6",146,0)
 . I RCREDEF D SETBATCH^RCDPEWLB(RCSCR)
"RTN","RCDPEWL6",147,0)
 D ADDLINES^RCDPEWLA(RCSCR)
"RTN","RCDPEWL6",148,0)
 D BLD^RCDPEWL1($G(^TMP($J,"RC_SORTPARM")))
"RTN","RCDPEWL6",149,0)
 K ^TMP($J,"BATCHES")
"RTN","RCDPEWL6",150,0)
REFQ S VALMBG=1,VALMBCK="R"
"RTN","RCDPEWL6",151,0)
 Q
"RTN","RCDPEWL6",152,0)
 ;
"RTN","RCDPEWL6",153,0)
WHAT(RCSCR) ; Text for what to do if not enough funds found for dist adj
"RTN","RCDPEWL6",154,0)
 Q $S($O(^RCY(344.31,"AERA",+RCSCR,0)):"THIS ERA MUST BE MOVED TO SUSPENSE",1:"THIS ERA'S RECEIPT MUST BE ENTERED MANUALLY")
"RTN","RCDPEWL6",155,0)
 ;
"RTN","RCDPEWL6",156,0)
ADJUST ; Allow entry into increase/decrease adjustment functions
"RTN","RCDPEWL6",157,0)
 N DIR,X,Y,RCTYP,RCY,DIC
"RTN","RCDPEWL6",158,0)
 D FULL^VALM1
"RTN","RCDPEWL6",159,0)
 ;
"RTN","RCDPEWL6",160,0)
 I $G(RCSCR("NOEDIT"))=2 D NOTAV^RCDPEWL2 G ADJUSTQ
"RTN","RCDPEWL6",161,0)
 ; PRCA*4.5*276 - check for authorized user
"RTN","RCDPEWL6",162,0)
 I '$D(^XUSEC("PRCADJ",DUZ)) D  Q
"RTN","RCDPEWL6",163,0)
 .S DIR(0)="EA",DIR("A",1)="The Adjust (Inc/Dec) Action is locked."
"RTN","RCDPEWL6",164,0)
 .S DIR("A",2)="Please speak to your Supervisor to request the key."
"RTN","RCDPEWL6",165,0)
 .S DIR("A")="PRESS RETURN TO CONTINUE" W ! D ^DIR K DIR
"RTN","RCDPEWL6",166,0)
 ; PRCA*4.5*276 - end of changes
"RTN","RCDPEWL6",167,0)
 ;
"RTN","RCDPEWL6",168,0)
 S DIR(0)="SA^D:DECREASE ADJUSTMENT;I:INCREASE ADJUSTMENT",DIR("B")="DECREASE ADJUSTMENT",DIR("A")="TYPE OF ADJUSTMENT: "
"RTN","RCDPEWL6",169,0)
 W ! D ^DIR K DIR
"RTN","RCDPEWL6",170,0)
 M ^TMP("RC_SAVE_TMP",$J)=^TMP($J)
"RTN","RCDPEWL6",171,0)
 I $D(DUOUT)!$D(DTOUT)!(Y="") G ADJUSTQ
"RTN","RCDPEWL6",172,0)
 ;
"RTN","RCDPEWL6",173,0)
 S RCTYP=$S(Y="D":"DECREASE",1:"INCREASE")
"RTN","RCDPEWL6",174,0)
 F  S RCY=$$GETABILL^RCBEUBIL Q:RCY<0!(RCY'<1)
"RTN","RCDPEWL6",175,0)
 G:RCY<1 ADJUSTQ
"RTN","RCDPEWL6",176,0)
 D ADJUST^RCBEADJ(RCTYP,RCY_";"_RCSCR)
"RTN","RCDPEWL6",177,0)
 I $D(^TMP("RC_BILL",$J,RCY)) D
"RTN","RCDPEWL6",178,0)
 . D UPDBAL(RCY)
"RTN","RCDPEWL6",179,0)
 . W !,"Claim balance is now: ",$J(+$P($$BILL^RCJIBFN2(RCY),U,3),"",2)
"RTN","RCDPEWL6",180,0)
 ;
"RTN","RCDPEWL6",181,0)
ADJUSTQ D RESTMP
"RTN","RCDPEWL6",182,0)
 D RET^RCDPEWL2
"RTN","RCDPEWL6",183,0)
 S VALMBCK="R"
"RTN","RCDPEWL6",184,0)
 Q
"RTN","RCDPEWL6",185,0)
 ;
"RTN","RCDPEWL6",186,0)
RESTMP ;
"RTN","RCDPEWL6",187,0)
 I $D(^TMP("RC_SAVE_TMP",$J)) M ^TMP($J)=^TMP("RC_SAVE_TMP",$J) K ^TMP("RC_SAVE_TMP")
"RTN","RCDPEWL6",188,0)
 Q
"RTN","RCDPEWL6",189,0)
 ;
"RTN","RCDPEWL6",190,0)
UPDBAL(RCY) ; Updates the claim balance if bill exists in list
"RTN","RCDPEWL6",191,0)
 ; RCY = ien of bill in file 430
"RTN","RCDPEWL6",192,0)
 ;
"RTN","RCDPEWL6",193,0)
 N X,Y,Z,Z0,Z1
"RTN","RCDPEWL6",194,0)
 S Z0=$J(+$P($$BILL^RCJIBFN2(RCY),U,3),"",2)
"RTN","RCDPEWL6",195,0)
 S Z=0 F  S Z=$O(^TMP("RC_BILL",$J,RCY,Z)) Q:'Z  D
"RTN","RCDPEWL6",196,0)
 . S X=+$G(^TMP("RCDPE-EOB_WLDX",$J,Z))
"RTN","RCDPEWL6",197,0)
 . Q:'X
"RTN","RCDPEWL6",198,0)
 . S Y=$G(^TMP("RCDPE-EOB_WL",$J,X+1,0))
"RTN","RCDPEWL6",199,0)
 . I Y["Claim Bal: " S Z1=$P(Y,"Claim Bal: ")_"Claim Bal: "_Z0_$G(^TMP("RC_BILL",$J,RCY,Z)),^TMP("RCDPE-EOB_WL",$J,X+1,0)=Z1
"RTN","RCDPEWL6",200,0)
 Q
"RTN","RCDPEWL6",201,0)
 ;
"RTN","RCDPEWL7")
0^4^B93160515^B84756815
"RTN","RCDPEWL7",1,0)
RCDPEWL7 ;ALB/TMK/KML - EDI LOCKBOX WORKLIST ERA DISPLAY SCREEN ;16-JAN-04
"RTN","RCDPEWL7",2,0)
 ;;4.5;Accounts Receivable;**208,222,269,276**;Mar 20, 1995;Build 87
"RTN","RCDPEWL7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEWL7",4,0)
 Q
"RTN","RCDPEWL7",5,0)
 ;
"RTN","RCDPEWL7",6,0)
BLD(RCSORT) ; Build list with sort criteria
"RTN","RCDPEWL7",7,0)
 ; RCSORT = the sort levels to use to display the data in ^ pieces
"RTN","RCDPEWL7",8,0)
 ;  piece 1 = the codes for the first level sort (sort code;null or -)
"RTN","RCDPEWL7",9,0)
 ;  piece 2 = the codes for the second level sort
"RTN","RCDPEWL7",10,0)
 ;     sort code is the type of data to sort by;- indicates reverse order
"RTN","RCDPEWL7",11,0)
 N Z,Z1,RCT,RCZ
"RTN","RCDPEWL7",12,0)
 ; PRCA*4.5*276 - keep users informed
"RTN","RCDPEWL7",13,0)
 W !,"...Records found...now sorting...",!
"RTN","RCDPEWL7",14,0)
 S (RCT,VALMCNT)=0
"RTN","RCDPEWL7",15,0)
 I '$D(^TMP($J,"RCERA_LIST")) D
"RTN","RCDPEWL7",16,0)
 . S Z=0 F  S Z=$O(^TMP("RCDPE-ERA_WLDX",$J,Z)) Q:'Z  S RCZ=$P($G(^(Z)),U,2) D
"RTN","RCDPEWL7",17,0)
 .. I $$FILTER^RCDPEWL0(RCZ) S ^TMP($J,"RCERA_LIST",$$SL(RCZ,$P(RCSORT,U)),$$SL(RCZ,$P(RCSORT,U,2)),RCZ)=""
"RTN","RCDPEWL7",18,0)
 . K ^TMP("RCDPE-ERA_WLDX",$J),^TMP("RCDPE-ERA_WL",$J)
"RTN","RCDPEWL7",19,0)
 ;
"RTN","RCDPEWL7",20,0)
 S Z=""
"RTN","RCDPEWL7",21,0)
 I RCSORT'["PN;-" D
"RTN","RCDPEWL7",22,0)
 . F  S Z=$O(^TMP($J,"RCERA_LIST",Z)) Q:Z=""  S Z1="" F  S Z1=$O(^TMP($J,"RCERA_LIST",Z,Z1)) Q:Z1=""  D EXTRACT(Z,Z1,.RCT)
"RTN","RCDPEWL7",23,0)
 ;
"RTN","RCDPEWL7",24,0)
 I $P(RCSORT,U)["PN;-" D
"RTN","RCDPEWL7",25,0)
 . F  S Z=$O(^TMP($J,"RCERA_LIST",Z),-1) Q:Z=""  S Z1="" F  S Z1=$O(^TMP($J,"RCERA_LIST",Z,Z1)) Q:Z1=""  D EXTRACT(Z,Z1,.RCT)
"RTN","RCDPEWL7",26,0)
 ;
"RTN","RCDPEWL7",27,0)
 I $P(RCSORT,U,2)["PN;-" D
"RTN","RCDPEWL7",28,0)
 . F  S Z=$O(^TMP($J,"RCERA_LIST",Z)) Q:Z=""  S Z1="" F  S Z1=$O(^TMP($J,"RCERA_LIST",Z,Z1),-1) Q:Z1=""  D EXTRACT(Z,Z1,.RCT)
"RTN","RCDPEWL7",29,0)
 ;
"RTN","RCDPEWL7",30,0)
 I '$O(^TMP($J,"RCERA_LIST",0)) D SET("No ERAs left for your selection criteria")
"RTN","RCDPEWL7",31,0)
 K ^TMP($J,"RCERA_LIST")
"RTN","RCDPEWL7",32,0)
 S ^TMP("RCERA_PARAMS",$J,"SORT")=RCSORT
"RTN","RCDPEWL7",33,0)
 Q
"RTN","RCDPEWL7",34,0)
 ;
"RTN","RCDPEWL7",35,0)
EXTRACT(RCSRT1,RCSRT2,RCT) ; Extract the data
"RTN","RCDPEWL7",36,0)
 ; RCSRT1 = data value at 1st sort level
"RTN","RCDPEWL7",37,0)
 ; RCSRT2 = data value at 2nd sort level
"RTN","RCDPEWL7",38,0)
 ; RCT = running entry counter - returned if passed by ref
"RTN","RCDPEWL7",39,0)
 N FIRST,RCZ,RC0,RCEFT,RCSTAT,RCPOST,X,Z,Z0
"RTN","RCDPEWL7",40,0)
 S RCZ=0 F  S RCZ=$O(^TMP($J,"RCERA_LIST",RCSRT1,RCSRT2,RCZ)) Q:'RCZ  D
"RTN","RCDPEWL7",41,0)
 . S RCT=RCT+1,RC0=$G(^RCY(344.4,RCZ,0))
"RTN","RCDPEWL7",42,0)
 . S RCEFT=+$O(^RCY(344.31,"AERA",RCZ,0))
"RTN","RCDPEWL7",43,0)
 . S RCSTAT=$S('RCEFT:U_$S($P(RC0,U,15)="CHK":"(CHECK PAYMENT EXPECTED)",$P(RC0,U,15)="NON":"(NO PAYMENT EXPECTED)",$P(RC0,U,9)=2:"(CHECK PAYMENT CHOSEN)",1:"N/A"),1:$$FMSSTAT^RCDPUREC(+$P($G(^RCY(344.31,RCEFT,0)),U,9)))
"RTN","RCDPEWL7",44,0)
 . S RCPOST=$S(RCEFT:"EFT RECEIPT STATUS: ",1:"")_$P(RCSTAT,U,2)
"RTN","RCDPEWL7",45,0)
 . ; kl - epayments patch - display of ERA # needs to account for 10 digits;  TRACE # has been updated from 30 to 50 characters
"RTN","RCDPEWL7",46,0)
 . S X=$E(RCT_$J("",4),1,4)_$S($D(^RCY(344.49,RCZ)):" ",1:"-")_$E($P(RC0,U)_$J("",10),1,10)_"  "_$E($P(RC0,U,2)_$J("",50),1,50)
"RTN","RCDPEWL7",47,0)
 . D SET(X,RCT,RCZ)
"RTN","RCDPEWL7",48,0)
 . S X=$J("",40)_$J($$FMTE^XLFDT($P(RC0,U,7),"2D"),8)_$J("",5)_$J(+$P(RC0,U,5),12,2)
"RTN","RCDPEWL7",49,0)
 . S $E(X,73,80)=$$FMTE^XLFDT($P(RC0,U,7),"2D")
"RTN","RCDPEWL7",50,0)
 . D SET(X,RCT,RCZ)
"RTN","RCDPEWL7",51,0)
 . S X=$J("",12)_$E($P(RC0,U,6)_$J("",30),1,30)_"  APPROX # EEOBs: "_+$$CTEEOB^RCDPEWLB(RCZ)
"RTN","RCDPEWL7",52,0)
 . D SET(X,RCT,RCZ)
"RTN","RCDPEWL7",53,0)
 . S X=$J("",12)_$E($$EXTERNAL^DILFD(344.4,.09,"",$P(RC0,U,9))_$J("",30),1,30)_"  "_RCPOST
"RTN","RCDPEWL7",54,0)
 . D SET(X,RCT)
"RTN","RCDPEWL7",55,0)
 . I $G(^TMP("RCERA_PARAMS",$J,"BATCHON")) D
"RTN","RCDPEWL7",56,0)
 .. S Z=0 F  S Z=$O(^RCY(344.49,RCZ,3,Z)) Q:'Z  S Z0=$G(^(Z,0)) I Z0'="" D
"RTN","RCDPEWL7",57,0)
 ... S X=$J("",12)_$E("- BATCH #"_$P(Z0,U)_$J("",4),1,13)_" "_$E($P(Z0,U,2)_$J("",30),1,30)_"  "_$S('$P(Z0,U,3):"NOT ",1:"")_"READY TO POST"
"RTN","RCDPEWL7",58,0)
 ... D SET(X,RCT)
"RTN","RCDPEWL7",59,0)
 . D SET(" ",RCT)
"RTN","RCDPEWL7",60,0)
 S VALMSG="'-' Before the ERA # indicates no scratchpad entry yet"
"RTN","RCDPEWL7",61,0)
 ;
"RTN","RCDPEWL7",62,0)
 Q
"RTN","RCDPEWL7",63,0)
 ;
"RTN","RCDPEWL7",64,0)
SL(Y,SORT) ; Returns data for sort level from entry Y in file 344.4
"RTN","RCDPEWL7",65,0)
 ; SORT = the sort data in ';' delimited pieces
"RTN","RCDPEWL7",66,0)
 ;    pc 1 = code for sort data
"RTN","RCDPEWL7",67,0)
 ;    pc 2 = the order requested (- or null)
"RTN","RCDPEWL7",68,0)
 ;  
"RTN","RCDPEWL7",69,0)
 N RC0,DAT,SORT1,SORT2
"RTN","RCDPEWL7",70,0)
 S SORT1=$P(SORT,";"),SORT2=$P(SORT,";",2)
"RTN","RCDPEWL7",71,0)
 S RC0=$G(^RCY(344.4,Y,0)),DAT=" "
"RTN","RCDPEWL7",72,0)
 ; No sort
"RTN","RCDPEWL7",73,0)
 I SORT="" G SLQ
"RTN","RCDPEWL7",74,0)
 ; Amt paid
"RTN","RCDPEWL7",75,0)
 I SORT1="AP" D  G SLQ
"RTN","RCDPEWL7",76,0)
 . S DAT=SORT2_+$P(RC0,U,5)
"RTN","RCDPEWL7",77,0)
 ; ERA date pd
"RTN","RCDPEWL7",78,0)
 I SORT1="DP" D  G SLQ
"RTN","RCDPEWL7",79,0)
 . S DAT=SORT2_($P(RC0,U,4)\1)
"RTN","RCDPEWL7",80,0)
 ; Payer name
"RTN","RCDPEWL7",81,0)
 I SORT1="PN" D  G SLQ
"RTN","RCDPEWL7",82,0)
 . S DAT=$$UPPER($P(RC0,U,6))
"RTN","RCDPEWL7",83,0)
 ; ERA date received
"RTN","RCDPEWL7",84,0)
 I SORT1="DR" D  G SLQ
"RTN","RCDPEWL7",85,0)
 . S DAT=SORT2_($P(RC0,U,7)\1)
"RTN","RCDPEWL7",86,0)
 ;
"RTN","RCDPEWL7",87,0)
SLQ Q $S(DAT'="":DAT,1:" ")
"RTN","RCDPEWL7",88,0)
 ;
"RTN","RCDPEWL7",89,0)
INIT ; Entry point for List template to build the display of ERAs
"RTN","RCDPEWL7",90,0)
 ;
"RTN","RCDPEWL7",91,0)
 ; Parameters for selecting ERAs to be included in the list are
"RTN","RCDPEWL7",92,0)
 ; contained in the global ^TMP("RCERA_PARAMS",$J,parameter name)
"RTN","RCDPEWL7",93,0)
 ;
"RTN","RCDPEWL7",94,0)
 N RCZ,RC0,RCT,RCTT,RCQUIT,RCDTFR,RCDTTO,DTOUT,DUOUT,DIR,X,Y,Z,Z1,RCPOST,RCEFT,RCINDX,QFLG
"RTN","RCDPEWL7",95,0)
 D CLEAN^VALM10
"RTN","RCDPEWL7",96,0)
 K ^TMP("RCDPE-ERA_WL",$J),^TMP("RCDPE-ERA_WLDX",$J),^TMP($J,"RCERA_LIST")
"RTN","RCDPEWL7",97,0)
 ;
"RTN","RCDPEWL7",98,0)
 S (RCT,RCTT,RCQUIT)=0
"RTN","RCDPEWL7",99,0)
 ;
"RTN","RCDPEWL7",100,0)
 S RCDTFR=+$P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),U),RCDTTO=$S($P($G(^TMP("RCERA_PARAMS",$J,"RCDT")),U,2):$P(^("RCDT"),U,2),1:DT)
"RTN","RCDPEWL7",101,0)
 ;
"RTN","RCDPEWL7",102,0)
 S RCINDX=$S(RCDTFR:RCDTFR-.00000001,1:0)
"RTN","RCDPEWL7",103,0)
 ;; *** Begin PRCA*4.5*276 - RBN ***
"RTN","RCDPEWL7",104,0)
 W !!,"SEARCHING, PLEASE STANDBY (PRESS '^' TO QUIT SEARCH)",!!
"RTN","RCDPEWL7",105,0)
 ;; *** End PRCA*4.5*276 ***
"RTN","RCDPEWL7",106,0)
 F  S RCINDX=$O(^RCY(344.4,"AFD",RCINDX)) Q:'RCINDX!(RCINDX\1>RCDTTO)!RCQUIT  S RCZ=0 F  S RCZ=$O(^RCY(344.4,"AFD",RCINDX,RCZ)) Q:'RCZ  D  Q:RCQUIT
"RTN","RCDPEWL7",107,0)
 . ;
"RTN","RCDPEWL7",108,0)
 . ;; *** Begin prca*4.5*276 - RBN ***
"RTN","RCDPEWL7",109,0)
 . ;S RCTT=RCTT+1 I '(RCTT#5000) D  Q:RCQUIT
"RTN","RCDPEWL7",110,0)
 . ;. S DIR("A",1)=RCTT_" ERA RECORDS HAVE ALREADY BEEN SEARCHED USING YOUR CRITERIA",DIR("A",2)="LAST DATE SEARCHED WAS "_$$FMTE^XLFDT(RCINDX,"2D"),DIR("A")="DO YOU WANT TO CONTINUE THIS SEARCH?: "
"RTN","RCDPEWL7",111,0)
 . ;. S DIR("B")="NO",DIR("?")="RESPOND NO HERE AND RESTART TO SELECT A DATE RANGE TO LIMIT THE SEARCH",DIR(0)="YA" W ! D ^DIR K DIR
"RTN","RCDPEWL7",112,0)
 . ;. I Y=1!$D(DTOUT) W !,$S($D(DTOUT):"TIME OUT - ",1:""),"SEARCH CONTINUED",! Q
"RTN","RCDPEWL7",113,0)
 . S RCTT=RCTT+1
"RTN","RCDPEWL7",114,0)
 . I (RCTT#10000=0) D  Q:RCQUIT=1
"RTN","RCDPEWL7",115,0)
 . . S RCTT=0
"RTN","RCDPEWL7",116,0)
 . . D WAIT^DICD
"RTN","RCDPEWL7",117,0)
 . . D INITKB^XGF ; supported by DBIA 3173
"RTN","RCDPEWL7",118,0)
 . . S QFLG=$$READ^XGF(1,1)
"RTN","RCDPEWL7",119,0)
 . . Q:$G(DTOUT)
"RTN","RCDPEWL7",120,0)
 . . S:QFLG="^" RCQUIT=1 Q
"RTN","RCDPEWL7",121,0)
 . . I $D(DUOUT)!(Y=0) S RCQUIT=1 Q
"RTN","RCDPEWL7",122,0)
 . . D RESETKB^XGF
"RTN","RCDPEWL7",123,0)
 . ;; *** End PRCA*4.5*276 ***
"RTN","RCDPEWL7",124,0)
 . ;
"RTN","RCDPEWL7",125,0)
 . S RC0=$G(^RCY(344.4,RCZ,0))
"RTN","RCDPEWL7",126,0)
 . I $$FILTER^RCDPEWL0(RCZ) S ^TMP($J,"RCERA_LIST",$$SL(RCZ,"DR"),$$SL(RCZ,""),RCZ)=""
"RTN","RCDPEWL7",127,0)
 ;
"RTN","RCDPEWL7",128,0)
 ; Output the list
"RTN","RCDPEWL7",129,0)
 I 'RCQUIT D
"RTN","RCDPEWL7",130,0)
 . D:$D(^TMP($J,"RCERA_LIST")) BLD("DR^N")
"RTN","RCDPEWL7",131,0)
 . I '$O(^TMP("RCDPE-ERA_WL",$J,0)) D
"RTN","RCDPEWL7",132,0)
 .. S DIR(0)="EA",DIR("A",1)="THERE ARE NO ERAs MATCHING YOUR SELECTION CRITERIA",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR S RCQUIT=1
"RTN","RCDPEWL7",133,0)
 I RCQUIT K ^TMP("RCDPE-ERA_WL",$J),^TMP("RCDPE-ERA_WLDX",$J),^TMP($J,"RCERA_LIST") S VALMQUIT=""
"RTN","RCDPEWL7",134,0)
 Q
"RTN","RCDPEWL7",135,0)
 ;
"RTN","RCDPEWL7",136,0)
HDR ; Header for ERA list
"RTN","RCDPEWL7",137,0)
 N X
"RTN","RCDPEWL7",138,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCMATCH"))
"RTN","RCDPEWL7",139,0)
 S VALMHDR(1)=$E("SELECTED:  MATCH STATUS: "_$S(X="N":"NOT MATCHED",X="M":"MATCHED",1:"BOTH")_$J("",38),1,38)
"RTN","RCDPEWL7",140,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCPOST"))
"RTN","RCDPEWL7",141,0)
 S VALMHDR(1)=VALMHDR(1)_"  POST STATUS: "_$S(X="U":"UNPOSTED",X="P":"POSTED",1:"BOTH")
"RTN","RCDPEWL7",142,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCDT"))
"RTN","RCDPEWL7",143,0)
 S VALMHDR(2)=$J("",11)_"DATE RANGE  : "_$S($P(X,U):$$FMTE^XLFDT($P(X,U),2)_$S($P(X,U,2):"-"_$$FMTE^XLFDT($P(X,U,2),2),1:""),1:"NONE SELECTED")
"RTN","RCDPEWL7",144,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCPAYR"))
"RTN","RCDPEWL7",145,0)
 S VALMHDR(3)=$J("",11)_$S($P(X,U)="A"!(X=""):"ALL PAYERS",1:"PAYERS: "_$P(X,U,2)_"-"_$P(X,U,3))
"RTN","RCDPEWL7",146,0)
 S X=$G(^TMP("RCERA_PARAMS",$J,"RCERA_TRACE#"))
"RTN","RCDPEWL7",147,0)
 S VALMHDR(4)="#   ERA #         TRACE#"
"RTN","RCDPEWL7",148,0)
 Q
"RTN","RCDPEWL7",149,0)
 ;
"RTN","RCDPEWL7",150,0)
FNL ; -- Clean up list
"RTN","RCDPEWL7",151,0)
 K ^TMP("RCDPE-ERA_WL",$J),^TMP("RCDPE-ERA_WLDX",$J),^TMP("RCERA_PARAMS",$J),^TMP($J,"RCERA_LIST")
"RTN","RCDPEWL7",152,0)
 Q
"RTN","RCDPEWL7",153,0)
 ;
"RTN","RCDPEWL7",154,0)
SET(X,RCSEQ,RCSEQ1) ; -- set arrays
"RTN","RCDPEWL7",155,0)
 ; X = the data to set into the global
"RTN","RCDPEWL7",156,0)
 ; RCSEQ = the selectable line #
"RTN","RCDPEWL7",157,0)
 ; RCSEQ1 = the ien of the entry in file 344.4
"RTN","RCDPEWL7",158,0)
 S VALMCNT=VALMCNT+1,^TMP("RCDPE-ERA_WL",$J,VALMCNT,0)=X
"RTN","RCDPEWL7",159,0)
 I $G(RCSEQ) S ^TMP("RCDPE-ERA_WL",$J,"IDX",VALMCNT,RCSEQ)=$G(RCSEQ1)
"RTN","RCDPEWL7",160,0)
 I $G(RCSEQ1) S ^TMP("RCDPE-ERA_WLDX",$J,RCSEQ)=VALMCNT_U_RCSEQ1
"RTN","RCDPEWL7",161,0)
 Q
"RTN","RCDPEWL7",162,0)
 ;
"RTN","RCDPEWL7",163,0)
ENTERWL ; Enter the worklist with an ERA
"RTN","RCDPEWL7",164,0)
 D WL($$SEL())
"RTN","RCDPEWL7",165,0)
 D BLD($G(^TMP("RCERA_PARAMS",$J,"SORT")))
"RTN","RCDPEWL7",166,0)
 S VALMBCK="R"
"RTN","RCDPEWL7",167,0)
 Q
"RTN","RCDPEWL7",168,0)
 ;
"RTN","RCDPEWL7",169,0)
SEL() ; Select an ERA from the ERA list
"RTN","RCDPEWL7",170,0)
 N RCDA,VALMY
"RTN","RCDPEWL7",171,0)
 D FULL^VALM1
"RTN","RCDPEWL7",172,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","RCDPEWL7",173,0)
 S RCERA=0
"RTN","RCDPEWL7",174,0)
 S RCDA=0 F  S RCDA=$O(VALMY(RCDA)) Q:'RCDA  S RCERA=+$P($G(^TMP("RCDPE-ERA_WLDX",$J,RCDA)),U,2)
"RTN","RCDPEWL7",175,0)
 ;
"RTN","RCDPEWL7",176,0)
 Q RCERA
"RTN","RCDPEWL7",177,0)
 ;
"RTN","RCDPEWL7",178,0)
WL(RCERA) ; Enter worklist
"RTN","RCDPEWL7",179,0)
 ; RCERA = ien of the ERA entry in file 344.4
"RTN","RCDPEWL7",180,0)
 N RC0,RCNOED,RCQUIT,RCSORT,DA,DIE,X,Y,DR,DIR,DTOUT,DUOUT
"RTN","RCDPEWL7",181,0)
 Q:RCERA'>0
"RTN","RCDPEWL7",182,0)
 S (RCQUIT,RCNOED)=0,RC0=$G(^RCY(344.4,RCERA,0)),RCSORT=""
"RTN","RCDPEWL7",183,0)
 I $P(RC0,U,8) D
"RTN","RCDPEWL7",184,0)
 . I '$D(^RCY(344.49,RCERA,0)) D  Q
"RTN","RCDPEWL7",185,0)
 .. S RCQUIT=1
"RTN","RCDPEWL7",186,0)
 .. W ! S DIR(0)="EA",DIR("A",1)="A SCRATCH PAD WAS NOT CREATED FOR THIS ERA BEFORE POSTING",DIR("A",2)="USE THE VIEW/PRINT ERA OPTION TO SEE ITS DETAIL",DIR("A")="PRESS RETURN TO CONTINUE: " D ^DIR K DIR Q
"RTN","RCDPEWL7",187,0)
 . ;
"RTN","RCDPEWL7",188,0)
 . S RCNOED=+$P(RC0,U,8)
"RTN","RCDPEWL7",189,0)
 . S DIR(0)="EA",DIR("A",1)="THIS ERA ALREADY HAS A RECEIPT - YOU MAY ONLY VIEW ITS SCRATCH PAD",DIR("A")="PRESS RETURN TO CONTINUE "
"RTN","RCDPEWL7",190,0)
 . W ! D ^DIR K DIR W !
"RTN","RCDPEWL7",191,0)
 I 'RCQUIT D
"RTN","RCDPEWL7",192,0)
 . N RCQUIT
"RTN","RCDPEWL7",193,0)
 . D DISP^RCDPEWL(RCERA,RCNOED)
"RTN","RCDPEWL7",194,0)
 ;
"RTN","RCDPEWL7",195,0)
 I 'RCQUIT,$G(^TMP("RCBATCH_SELECTED",$J)) D
"RTN","RCDPEWL7",196,0)
 . S DA(1)=RCERA,DA=+$G(^TMP("RCBATCH_SELECTED",$J)),DR=".05////0",DIE="^RCY(344.49,"_DA(1)_",3," D ^DIE
"RTN","RCDPEWL7",197,0)
 . L -^RCY(344.49,DA(1),3,DA,0)
"RTN","RCDPEWL7",198,0)
 . K ^TMP("RCBATCH_SELECTED",$J)
"RTN","RCDPEWL7",199,0)
 E  D
"RTN","RCDPEWL7",200,0)
 . L -^RCY(344.4,RCERA,0)
"RTN","RCDPEWL7",201,0)
 Q
"RTN","RCDPEWL7",202,0)
 ;
"RTN","RCDPEWL7",203,0)
PRERA ; View/Print ERA from ERA list menu
"RTN","RCDPEWL7",204,0)
 N RCSCR
"RTN","RCDPEWL7",205,0)
 S RCSCR=$$SEL()
"RTN","RCDPEWL7",206,0)
 I RCSCR>0 D PRERA^RCDPEWL0
"RTN","RCDPEWL7",207,0)
 S VALMBCK="R"
"RTN","RCDPEWL7",208,0)
 Q
"RTN","RCDPEWL7",209,0)
 ;
"RTN","RCDPEWL7",210,0)
BAT(RCERA) ; Select batch, if needed
"RTN","RCDPEWL7",211,0)
 ; Returns 1 if batch selected OK or no batch needed
"RTN","RCDPEWL7",212,0)
 ; RCERA = ien of entry in file 344.49
"RTN","RCDPEWL7",213,0)
 N RCINUSE,RCQUIT,RCADJ,RC0,RCOK,DIR,DTOUT,DUOUT,X,Y,Z
"RTN","RCDPEWL7",214,0)
 K ^TMP("RCBATCH_SELECTED",$J)
"RTN","RCDPEWL7",215,0)
 S RCOK=1
"RTN","RCDPEWL7",216,0)
 I '$O(^RCY(344.49,RCERA,3,0)) G BATQ
"RTN","RCDPEWL7",217,0)
 S RC0=$G(^RCY(344.4,RCERA,0))
"RTN","RCDPEWL7",218,0)
 S (RCQUIT,RCADJ)=0
"RTN","RCDPEWL7",219,0)
 I $$HASADJ^RCDPEWL8(RCERA) D
"RTN","RCDPEWL7",220,0)
 . S RCADJ=1
"RTN","RCDPEWL7",221,0)
 . S DIR("A",1)="THIS ERA HAS NEGATIVE ADJUSTMENTS THAT NEED TO BE DISTRIBUTED TO OTHER",DIR("A",2)="PAYMENTS ON THE ERA.  YOU CANNOT SELECT ANY INDIVIDUAL BATCHES UNTIL",DIR("A",3)="THE DISTRIBUTIONS ARE COMPLETE."
"RTN","RCDPEWL7",222,0)
 . S DIR("A")="PRESS RETURN TO CONTINUE: ",DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEWL7",223,0)
 S RCINUSE=+$O(^RCY(344.49,"AINUSE",1,RCERA,0))
"RTN","RCDPEWL7",224,0)
 I RCINUSE D
"RTN","RCDPEWL7",225,0)
 . N OK,Z
"RTN","RCDPEWL7",226,0)
 . Q:RCADJ!$P(RC0,U,8)
"RTN","RCDPEWL7",227,0)
 . S OK=0 S Z=0 F  S Z=$O(^RCY(344.49,RCERA,3,Z)) Q:'Z  I '$P($G(^RCY(344.49,RCERA,3,Z,0)),U,5) S OK=1 Q
"RTN","RCDPEWL7",228,0)
 . I 'OK D  Q
"RTN","RCDPEWL7",229,0)
 .. S DIR("A",1)="ALL BATCHES WITHIN THIS ERA ARE CURRENTLY IN USE - TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR S RCQUIT=1,RCOK=0 Q
"RTN","RCDPEWL7",230,0)
 . W !!,"AT LEAST 1 BATCH WITHIN THIS ERA IS CURRENTLY IN USE",!,"AT THIS TIME, YOU CAN ONLY ACCESS INDIVIDUAL BATCHES",!
"RTN","RCDPEWL7",231,0)
 . D SELBAT^RCDPEWL8(RCERA,.RCQUIT)
"RTN","RCDPEWL7",232,0)
 . I RCQUIT S RCOK=0
"RTN","RCDPEWL7",233,0)
 E  D
"RTN","RCDPEWL7",234,0)
 . Q:$P(RC0,U,8)!RCADJ  ; Always require the entire ERA be used
"RTN","RCDPEWL7",235,0)
 . S DIR(0)="SA^E:(E)NTIRE ERA;B:(B)ATCH",DIR("A")="DO YOU WANT THE (E)NTIRE ERA OR JUST A (B)ATCH?: " W ! D ^DIR K DIR
"RTN","RCDPEWL7",236,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1,RCOK=0 Q
"RTN","RCDPEWL7",237,0)
 . I Y="E" D  Q
"RTN","RCDPEWL7",238,0)
 .. S RCQUIT=1 F Z=1:1:2 L +^RCY(344.4,RCERA,0):5 I $T S RCQUIT=0 Q
"RTN","RCDPEWL7",239,0)
 .. I RCQUIT S RCOK=0,DIR(0)="EA",DIR("A",1)="ANOTHER USER IS CURRENTLY USING THIS ERA, TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR Q
"RTN","RCDPEWL7",240,0)
 . D SELBAT^RCDPEWL8(RCERA,.RCQUIT)
"RTN","RCDPEWL7",241,0)
 . I RCQUIT S RCOK=0
"RTN","RCDPEWL7",242,0)
 ;
"RTN","RCDPEWL7",243,0)
BATQ Q RCOK
"RTN","RCDPEWL7",244,0)
 ;
"RTN","RCDPEWL7",245,0)
UPPER(X) ; Function returns X as all upper case
"RTN","RCDPEWL7",246,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","RCDPEWL7",247,0)
 ;
"RTN","RCDPEWL8")
0^27^B78778752^B74316733
"RTN","RCDPEWL8",1,0)
RCDPEWL8 ;ALB/TMK/PJH - EDI LOCKBOX WORKLIST ERA LEVEL ;12-FEB-04
"RTN","RCDPEWL8",2,0)
 ;;4.5;Accounts Receivable;**208,269,276**;Mar 20, 1995;Build 87
"RTN","RCDPEWL8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEWL8",4,0)
 Q
"RTN","RCDPEWL8",5,0)
 ;
"RTN","RCDPEWL8",6,0)
FILESP ; Action that files the split lines
"RTN","RCDPEWL8",7,0)
 ; Assumes RCDIR,RCLINE,RCSCR,RCSPLIT array defined
"RTN","RCDPEWL8",8,0)
 N RCTOT,Z,RCZ0,RCZ1,DTOUT,DUOUT,DIR,X,Y,DIE,DA,DR,DIC,DD,DO,DLAYGO,RCZ,RCZZ,RCZT,VALBCK
"RTN","RCDPEWL8",9,0)
 D FULL^VALM1
"RTN","RCDPEWL8",10,0)
 I '$G(^TMP("RCDPE_EOB_SPLIT_OK",$J)) D  Q
"RTN","RCDPEWL8",11,0)
 . S VALMBCK="R"
"RTN","RCDPEWL8",12,0)
 . F Z=2,3 S RCTOT(Z)=$$TOT^RCDPEWL3(Z,.RCSPLIT)
"RTN","RCDPEWL8",13,0)
 . S DIR(0)="EA"
"RTN","RCDPEWL8",14,0)
 . S DIR("A",1)="TOTAL "_$S(+RCTOT(2)'=+$P(RCDIR,U,2):"PAYMENTS",1:"ADJUSTMENTS")_$S(+RCTOT(3)=+$P(RCDIR,U,3):"",+RCTOT(2)'=+$P(RCDIR,U,2):" AND ADJUSTMENTS",1:"")_" DO NOT MATCH THE ORIGINAL AMOUNT(s):"
"RTN","RCDPEWL8",15,0)
 . S DIR("A",2)=$E("  ORIG PAY AMT: "_$J(+$P(RCDIR,U,2),"",2)_$J("",35),1,35)_" ORIG ADJ AMT: "_$J(+$P(RCDIR,U,3),"",2)
"RTN","RCDPEWL8",16,0)
 . S DIR("A",3)=$E("   AMT ENTERED: "_$J(+RCTOT(2),"",2)_$J("",35),1,35)_"  AMT ENTERED: "_$J(+RCTOT(3),"",2)
"RTN","RCDPEWL8",17,0)
 . S DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL8",18,0)
 ;
"RTN","RCDPEWL8",19,0)
 S DA(1)=RCSCR
"RTN","RCDPEWL8",20,0)
 S RCZ0=+$P(RCLINE,U,2),RCZZ=+$G(^RCY(344.49,DA(1),1,RCZ0,0)),RCZZ(1)=""
"RTN","RCDPEWL8",21,0)
 S RCZ=+$O(RCSPLIT(0))
"RTN","RCDPEWL8",22,0)
 ;
"RTN","RCDPEWL8",23,0)
 ;Option to move/copy EOB
"RTN","RCDPEWL8",24,0)
 I RCZ D  Q:$G(VALMBCK)="Q"
"RTN","RCDPEWL8",25,0)
 .;;Move/Copy removed 10/19/11-now in receipt creation +136^RCDPEM
"RTN","RCDPEWL8",26,0)
 .;;Q:$$UPDWL^RCDPEM5($P(RCDIR,U),.RCSPLIT,RCERA)
"RTN","RCDPEWL8",27,0)
 .;;User abort
"RTN","RCDPEWL8",28,0)
 .;;K ^TMP($J,"RCDPE_SPLIT_FILE") S VALMBCK="Q"
"RTN","RCDPEWL8",29,0)
 ;
"RTN","RCDPEWL8",30,0)
 I RCZ D
"RTN","RCDPEWL8",31,0)
 . S DIE="^RCY(344.49,"_DA(1)_",1,",DA=RCZ0,RCZT=$P(RCSPLIT(RCZ),U,2)+$P(RCSPLIT(RCZ),U,3)
"RTN","RCDPEWL8",32,0)
 . S DR=".02////"_$P(RCSPLIT(RCZ),U)_";.05////"_$J(+$P(RCSPLIT(RCZ),U,2),"",2)_";.06////"_$J(+RCZT,"",2)_";.08////"_$J($P(RCSPLIT(RCZ),U,3),"",2)
"RTN","RCDPEWL8",33,0)
 . S DR=DR_";.07///"_$S($P(RCSPLIT(RCZ),U,5):"/"_$P(RCSPLIT(RCZ),U,5),1:"@")_";.03////"_$S(RCZT'<0:$J(+RCZT,"",2),1:"0.00")_$S($P(RCSPLIT(RCZ),U,6)'="":";.1///"_$S($P(RCSPLIT(RCZ),U,6)'="@":"/^S X=$P(RCSPLIT(RCZ),U,6)",1:"@"),1:"")
"RTN","RCDPEWL8",34,0)
 . D ^DIE,UPD^RCDPEWL3(DA(1),DA)
"RTN","RCDPEWL8",35,0)
 . I $P(RCDIR,U,3) D
"RTN","RCDPEWL8",36,0)
 .. N DA
"RTN","RCDPEWL8",37,0)
 .. S DA(2)=RCSCR,DA(1)=RCZ0,DA=1,DIE="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWL8",38,0)
 .. S RCZZ(1)=$G(^RCY(344.49,DA(2),1,DA(1),1,1,0))
"RTN","RCDPEWL8",39,0)
 .. S DR=".03////"_$J(+$P(RCSPLIT(RCZ),U,3),"",2)_$S($P(RCSPLIT(RCZ),U,4)'="":".09////"_$P(RCSPLIT(RCZ),U,4),1:"")
"RTN","RCDPEWL8",40,0)
 .. D ^DIE
"RTN","RCDPEWL8",41,0)
 F  S RCZ=$O(RCSPLIT(RCZ)) Q:'RCZ  D
"RTN","RCDPEWL8",42,0)
 . S DIC(0)="L",DLAYGO=344.491,DIC="^RCY(344.49,"_DA(1)_",1,",X=+$O(^RCY(344.49,RCSCR,1,"B",RCZZ\1+.999),-1)+.001
"RTN","RCDPEWL8",43,0)
 . S DIC("DR")=".02////"_$P(RCSPLIT(RCZ),U)_";.05////"_$J(+$P(RCSPLIT(RCZ),U,2),"",2)_";.08////"_$J(+$P(RCSPLIT(RCZ),U,3),"",2)_";.06////"_$J($P(RCSPLIT(RCZ),U,2)+$P(RCSPLIT(RCZ),U,3),"",2)
"RTN","RCDPEWL8",44,0)
 . I $P(RCSPLIT(RCZ),U,6)'="" S DIC("DR")=DIC("DR")_";.1///"_$S($P(RCSPLIT(RCZ),U,6)'="@":"/^S X=$P(RCSPLIT(RCZ),U,6)",1:"@")
"RTN","RCDPEWL8",45,0)
 . I $P(RCSPLIT(RCZ),U,5) S DIC("DR")=DIC("DR")_";.07////"_$P(RCSPLIT(RCZ),U,5)
"RTN","RCDPEWL8",46,0)
 . K DD,DO D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","RCDPEWL8",47,0)
 . S RCZ1=+Y
"RTN","RCDPEWL8",48,0)
 . I Y D UPD^RCDPEWL3(RCSCR,RCZ1)
"RTN","RCDPEWL8",49,0)
 . I Y,$P(RCDIR,U,3) D
"RTN","RCDPEWL8",50,0)
 .. N DA
"RTN","RCDPEWL8",51,0)
 .. S DA(2)=RCSCR,DA(1)=RCZ1,X=1,DIC(0)="L",DIC="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","RCDPEWL8",52,0)
 .. S DIC("DR")=".02////"_$P(RCZZ(1),U,2)_";.03////"_$J(+$P(RCSPLIT(RCZ),U,3),"",2)_$S($P(RCSPLIT(RCZ),U,4)'="":";.09////"_$P(RCSPLIT(RCZ),U,4),$P(RCZZ(1),U,9)'="":";.09////"_$P(RCZZ(1),U,9),1:"")
"RTN","RCDPEWL8",53,0)
 .. F Z=4:1:8 I $P(RCZZ(1),U,Z)'="" S DIC("DR")=DIC("DR")_";"_(Z/100)_"////"_$P(RCZZ(1),U,Z)
"RTN","RCDPEWL8",54,0)
 .. D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","RCDPEWL8",55,0)
 K ^TMP($J,"RCDPE_SPLIT_FILE")
"RTN","RCDPEWL8",56,0)
 S VALMBCK="Q"
"RTN","RCDPEWL8",57,0)
 Q
"RTN","RCDPEWL8",58,0)
 ;
"RTN","RCDPEWL8",59,0)
SELBAT(RCERA,RCQUIT) ; Select a batch
"RTN","RCDPEWL8",60,0)
 ; If batch is selected, global ^TMP("RCBATCH_SELECTED",$J) is set = 
"RTN","RCDPEWL8",61,0)
 ;   batch ien selected
"RTN","RCDPEWL8",62,0)
 ; RCQUIT = 1 if selection not made
"RTN","RCDPEWL8",63,0)
 N RCBAT,DA,DIE,X,Y,DIC,DUOUT,DTOUT,DIR,DR
"RTN","RCDPEWL8",64,0)
 S RCQUIT=0
"RTN","RCDPEWL8",65,0)
 S DA(1)=RCERA,DIC(0)="AEMQ",DIC="^RCY(344.49,"_DA(1)_",3,",DIC("S")="I '$P(^(0),U,5)" D ^DIC
"RTN","RCDPEWL8",66,0)
 I Y'>0 S RCQUIT=1 Q
"RTN","RCDPEWL8",67,0)
 S RCBAT=+Y
"RTN","RCDPEWL8",68,0)
 L +^RCY(344.4,RCERA,0):5 I '$T S DIR("A",1)="ANOTHER USER HAS JUST ACCESSED THE ENTIRE ERA - TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE ",DIR(0)="EA" W ! D ^DIR K DIR S RCQUIT=1 Q
"RTN","RCDPEWL8",69,0)
 L +^RCY(344.49,RCERA,3,RCBAT,0):5 I '$T!$P($G(^(0)),U,5) S DIR("A",1)="ANOTHER USER HAS JUST OPENED THIS BATCH - TRY AGAIN LATER",DIR("A")="PRESS RETURN TO CONTINUE ",DIR(0)=-"EA" W ! D ^DIR K DIR S RCQUIT=1 Q
"RTN","RCDPEWL8",70,0)
 S DA=RCBAT,DA(1)=RCERA,DIE="^RCY(344.49,"_DA(1)_",3,",DR=".05////1" D ^DIE L -^RCY(344.49,RCERA,3,RCBAT,0)
"RTN","RCDPEWL8",71,0)
 I $P($G(^RCY(344.49,RCERA,3,RCBAT,0)),U,3) D
"RTN","RCDPEWL8",72,0)
 . S DIR(0)="EA",DIR("A",1)="** WARNING - THIS BATCH HAS BEEN FLAGGED AS READY TO POST",DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL8",73,0)
 S ^TMP("RCBATCH_SELECTED",$J)=RCBAT
"RTN","RCDPEWL8",74,0)
 L -^RCY(344.4,RCERA,0)
"RTN","RCDPEWL8",75,0)
 Q
"RTN","RCDPEWL8",76,0)
 ;
"RTN","RCDPEWL8",77,0)
SORT ; Select a new sort for the list of ERAs
"RTN","RCDPEWL8",78,0)
 D FULL^VALM1
"RTN","RCDPEWL8",79,0)
 N RCSORT,DUOUT,DTOUT,DIR,X,Y,RCS1,RCS2,RCORD
"RTN","RCDPEWL8",80,0)
 S VALMBCK="R"
"RTN","RCDPEWL8",81,0)
 S DIR("L",1)="  SELECT A FIRST LEVEL SORT",DIR("L",2)=" "
"RTN","RCDPEWL8",82,0)
 S DIR("L",3)="    A  AMOUNT PAID      E  ERA PAID DATE"
"RTN","RCDPEWL8",83,0)
 S DIR("L")="    P  PAYER NAME       D  DATE ERA RECEIVED"
"RTN","RCDPEWL8",84,0)
 S DIR(0)="S^A:AMOUNT PAID;E:ERA PAID DATE;P:PAYER NAME;D:DATE ERA RECEIVED",DIR("B")=$P($P(DIR(0),"D:",2),";")
"RTN","RCDPEWL8",85,0)
 W ! D ^DIR K DIR
"RTN","RCDPEWL8",86,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","RCDPEWL8",87,0)
 S RCS1=$S(Y="A":"AP",Y="E":"DP",Y="P":"PN",1:"DR")
"RTN","RCDPEWL8",88,0)
 S RCORD=$$ORD(.RCS1)
"RTN","RCDPEWL8",89,0)
 Q:'$D(RCS1)
"RTN","RCDPEWL8",90,0)
 S $P(RCSORT,U)=(RCS1_";"_RCORD)
"RTN","RCDPEWL8",91,0)
 K X
"RTN","RCDPEWL8",92,0)
 S X(1)=$S(RCS1'="AP":"A:AMOUNT PAID",1:"E:ERA PAID DATE")
"RTN","RCDPEWL8",93,0)
 S X(2)=$S(RCS1'="AP"&(RCS1'="DP"):"E:ERA PAID DATE",1:"P:PAYER NAME")
"RTN","RCDPEWL8",94,0)
 S X(3)=$S(RCS1="DR":"P:PAYER NAME",1:"D:DATE ERA RECEIVED")
"RTN","RCDPEWL8",95,0)
 S DIR(0)="S^N:NONE;"_X(1)_";"_X(2)_";"_X(3)
"RTN","RCDPEWL8",96,0)
 S DIR("B")="NONE"
"RTN","RCDPEWL8",97,0)
 S DIR("L",1)="  SELECT A SECOND LEVEL SORT",DIR("L",2)=" "
"RTN","RCDPEWL8",98,0)
 S DIR("L",3)="    N  NONE"_$J("",13)_$P(X(1),":")_"  "_$P(X(1),":",2)
"RTN","RCDPEWL8",99,0)
 S DIR("L")="    "_$E($P(X(2),":")_"  "_$P(X(2),":",2)_$J("",20),1,20)_$P(X(3),":")_"  "_$P(X(3),":",2)
"RTN","RCDPEWL8",100,0)
 K X W ! D ^DIR K DIR
"RTN","RCDPEWL8",101,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","RCDPEWL8",102,0)
 S RCS2=$S(Y="N":"N",Y="A":"AP",Y="E":"DP",Y="P":"PN",1:"DR")
"RTN","RCDPEWL8",103,0)
 S RCORD=$$ORD(.RCS2)
"RTN","RCDPEWL8",104,0)
 Q:'$D(RCS2)
"RTN","RCDPEWL8",105,0)
 S $P(RCSORT,U,2)=(RCS2_";"_RCORD)
"RTN","RCDPEWL8",106,0)
 K ^TMP($J,"RCERA_LIST") D BLD^RCDPEWL7(RCSORT)
"RTN","RCDPEWL8",107,0)
 Q
"RTN","RCDPEWL8",108,0)
 ;
"RTN","RCDPEWL8",109,0)
ORD(RCS) ; Select an order for the sorted field code in RCS
"RTN","RCDPEWL8",110,0)
 ; Kill RCS if nothing selected, passed by reference
"RTN","RCDPEWL8",111,0)
 ; Returns '-' if reverse order selected
"RTN","RCDPEWL8",112,0)
 N DIR,X,Y,ORD,RCQUIT
"RTN","RCDPEWL8",113,0)
 S RCQUIT=0,ORD=""
"RTN","RCDPEWL8",114,0)
 I RCS="N" G ORDQ
"RTN","RCDPEWL8",115,0)
 I RCS="PN" D  G ORDQ
"RTN","RCDPEWL8",116,0)
 . S DIR(0)="SA^F:FIRST TO LAST;L:LAST TO FIRST"
"RTN","RCDPEWL8",117,0)
 . S DIR("B")=$P($P(DIR(0),"F:",2),";")
"RTN","RCDPEWL8",118,0)
 . S DIR("A")="  SORT (F)IRST TO LAST OR (L)AST TO FIRST?: "
"RTN","RCDPEWL8",119,0)
 . D ^DIR K DIR
"RTN","RCDPEWL8",120,0)
 . I $D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",121,0)
 . S ORD=$S(Y="F":"",1:"-")
"RTN","RCDPEWL8",122,0)
 ;
"RTN","RCDPEWL8",123,0)
 I RCS="AP" D  G ORDQ
"RTN","RCDPEWL8",124,0)
 . S DIR("A")="  SORT (L)OWEST TO HIGHEST OR (H)IGHEST TO LOWEST?: "
"RTN","RCDPEWL8",125,0)
 . S DIR(0)="SA^L:LOWEST TO HIGHEST;H:HIGHEST TO LOWEST"
"RTN","RCDPEWL8",126,0)
 . S DIR("B")=$P($P(DIR(0),"L:",2),";")
"RTN","RCDPEWL8",127,0)
 . D ^DIR K DIR
"RTN","RCDPEWL8",128,0)
 . I $D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",129,0)
 . S ORD=$S(Y="L":"",1:"-")
"RTN","RCDPEWL8",130,0)
 ;
"RTN","RCDPEWL8",131,0)
 I RCS="DP"!(RCS="DR") D  G ORDQ
"RTN","RCDPEWL8",132,0)
 . S DIR("A")="  SORT (E)ARLIEST TO LATEST OR (L)ATEST TO EARLIEST?: "
"RTN","RCDPEWL8",133,0)
 . S DIR(0)="SA^E:EARLIEST TO LATEST;L:LATEST TO EARLIEST"
"RTN","RCDPEWL8",134,0)
 . S DIR("B")=$P($P(DIR(0),"E:",2),";")
"RTN","RCDPEWL8",135,0)
 . D ^DIR K DIR
"RTN","RCDPEWL8",136,0)
 . I $D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",137,0)
 . S ORD=$S(Y="E":"",1:"-")
"RTN","RCDPEWL8",138,0)
 ;
"RTN","RCDPEWL8",139,0)
 ; Invalid sort code
"RTN","RCDPEWL8",140,0)
 S RCQUIT=1
"RTN","RCDPEWL8",141,0)
 ;
"RTN","RCDPEWL8",142,0)
ORDQ I RCQUIT K RCS
"RTN","RCDPEWL8",143,0)
 Q ORD
"RTN","RCDPEWL8",144,0)
 ;
"RTN","RCDPEWL8",145,0)
BATDSP ; Ask Display/Hide batch info on ERA list screen
"RTN","RCDPEWL8",146,0)
 N DIR,X,Y,RCZ,DUOUT,DTOUT
"RTN","RCDPEWL8",147,0)
 D FULL^VALM1
"RTN","RCDPEWL8",148,0)
 S RCZ=+$G(^TMP("RCERA_PARAMS",$J,"BATCHON"))
"RTN","RCDPEWL8",149,0)
 S DIR("A",1)="BATCH INFO DISPLAY IS CURRENTLY TURNED "_$S('RCZ:"OFF",1:"ON"),DIR("A")="DO YOU WANT TO TURN IT "_$S('RCZ:"ON",1:"OFF")_" NOW?: "
"RTN","RCDPEWL8",150,0)
 S DIR(0)="YA",DIR("B")="YES" W ! D ^DIR K DIR
"RTN","RCDPEWL8",151,0)
 S VALMBCK="R"
"RTN","RCDPEWL8",152,0)
 Q:$D(DUOUT)!$D(DTOUT)!'Y
"RTN","RCDPEWL8",153,0)
 S ^TMP("RCERA_PARAMS",$J,"BATCHON")=$S(RCZ:0,1:1)
"RTN","RCDPEWL8",154,0)
 D BLD^RCDPEWL7($G(^TMP("RCERA_PARAMS",$J,"SORT")))
"RTN","RCDPEWL8",155,0)
 Q
"RTN","RCDPEWL8",156,0)
 ;
"RTN","RCDPEWL8",157,0)
HASADJ(RCSCR,RCOK) ; Function=1 if WL entry has any adj not yet distributed
"RTN","RCDPEWL8",158,0)
 ; RCSCR = ien of entry in file 344.49
"RTN","RCDPEWL8",159,0)
 ; RCOK = if passed by reference, returns 1 if ANY postable lines exist
"RTN","RCDPEWL8",160,0)
 N Z,Z0,RCSTOP
"RTN","RCDPEWL8",161,0)
 S RCSTOP=0,RCOK=0
"RTN","RCDPEWL8",162,0)
 S Z=0 F  S Z=$O(^RCY(344.49,RCSCR,1,Z)) Q:'Z  S Z0=$G(^(Z,0)) D  Q:RCSTOP
"RTN","RCDPEWL8",163,0)
 . ;HIPAA 5010 - negative value now takes precedence over adjustment
"RTN","RCDPEWL8",164,0)
 . I $P(Z0,U,6)>0!$O(^RCY(344.49,RCSCR,1,Z,1,0)) S RCOK=1
"RTN","RCDPEWL8",165,0)
 . I $P(Z0,U,6)<0 S RCSTOP=1
"RTN","RCDPEWL8",166,0)
 Q RCSTOP
"RTN","RCDPEWL8",167,0)
 ;
"RTN","RCDPEWL8",168,0)
VERIF ; Entrypoint to verification options
"RTN","RCDPEWL8",169,0)
 N DIR,X,Y,RCQUIT,DTOUT,DUOUT
"RTN","RCDPEWL8",170,0)
 D FULL^VALM1
"RTN","RCDPEWL8",171,0)
 ;
"RTN","RCDPEWL8",172,0)
 W !!!!
"RTN","RCDPEWL8",173,0)
 S RCQUIT=0
"RTN","RCDPEWL8",174,0)
 F  D  Q:RCQUIT
"RTN","RCDPEWL8",175,0)
 . W !,"VERIFY EEOBs:",!,?10,"1",$J("",5),"MANUAL MARK AS VERIFIED",!,?10,"2",$J("",5),"REPORT OF UNVERIFIED WITH DISCREPANCIES",!,?10,"3",$J("",5),"QUIT AND RETURN TO WORKLIST"
"RTN","RCDPEWL8",176,0)
 . S DIR(0)="SAO^1:MANUAL VERIFICATION;2:REPORT UNVERIFIED DISCREPANCIES;3:QUIT"
"RTN","RCDPEWL8",177,0)
 . S DIR("A")="Select Action: ",DIR("B")="QUIT" W ! D ^DIR K DIR
"RTN","RCDPEWL8",178,0)
 . I Y=3!(Y="")!$D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",179,0)
 . ;
"RTN","RCDPEWL8",180,0)
 . I Y=1 D MVER^RCDPEV(RCERA) W !! Q
"RTN","RCDPEWL8",181,0)
 . ;
"RTN","RCDPEWL8",182,0)
 . I Y=2 D RPT^RCDPEV0(RCERA) W !! Q
"RTN","RCDPEWL8",183,0)
 ;
"RTN","RCDPEWL8",184,0)
VERIFQ S VALMBCK="R"
"RTN","RCDPEWL8",185,0)
 Q
"RTN","RCDPEWL8",186,0)
 ;
"RTN","RCDPEWL8",187,0)
BATED ; Entrypoint to batch edit options
"RTN","RCDPEWL8",188,0)
 N DIC,DA,DUOUT,DTOUT,DIR,X,Y,RCQUIT
"RTN","RCDPEWL8",189,0)
 D FULL^VALM1
"RTN","RCDPEWL8",190,0)
 ;
"RTN","RCDPEWL8",191,0)
 W !!!!
"RTN","RCDPEWL8",192,0)
 S RCQUIT=0
"RTN","RCDPEWL8",193,0)
 I '$O(^RCY(344.49,RCERA,3,0)) W !,"***** THERE ARE CURRENTLY NO BATCHES DEFINED FOR THIS ERA *****",!
"RTN","RCDPEWL8",194,0)
 ; No menu if entering from a batch level
"RTN","RCDPEWL8",195,0)
 I $G(^TMP("RCBATCH_SELECTED",$J)) W !,"EDITING BATCH #"_+^TMP("RCBATCH_SELECTED",$J) D EDIT^RCDPEWLB(RCERA,+^TMP("RCBATCH_SELECTED",$J)) G BATEDQ
"RTN","RCDPEWL8",196,0)
 F  D  Q:RCQUIT
"RTN","RCDPEWL8",197,0)
 . I '$D(^XUSEC("PRCA ERA BATCH MAINT",DUZ)) D  Q
"RTN","RCDPEWL8",198,0)
 .. S RCQUIT=1
"RTN","RCDPEWL8",199,0)
 .. S DIR(0)="EA",DIR("A")="YOU DO NOT HAVE SECURITY ACCESS TO THIS ACTION - PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEWL8",200,0)
 . W !,"BATCH MAINTENANCE:",!,?10,"1",$J("",5),"EDIT BATCH",!,?10,"2",$J("",5),"NEW BATCH ASSIGNMENT",!,?10,"3",$J("",5),"MARK ALL READY TO POST",!,?10,"4",$J("",5),"BATCH SUMMARY REPORT",!,?10,"5",$J("",5),"QUIT AND RETURN TO WORKLIST"
"RTN","RCDPEWL8",201,0)
 . S DIR(0)="SAO^1:EDIT BATCH;2:NEW BATCHES;3:MARK ALL;4:BATCH SUMMARY;5:QUIT"
"RTN","RCDPEWL8",202,0)
 . S DIR("A")="Select Action: ",DIR("B")="Quit" W ! D ^DIR K DIR
"RTN","RCDPEWL8",203,0)
 . I Y="5"!(Y="")!$D(DUOUT)!$D(DTOUT) S RCQUIT=1 Q
"RTN","RCDPEWL8",204,0)
 . ;
"RTN","RCDPEWL8",205,0)
 . I Y=1 D  W !! Q
"RTN","RCDPEWL8",206,0)
 .. I '$O(^RCY(344.49,RCERA,3,0)) D NOTSET^RCDPEWLC Q
"RTN","RCDPEWL8",207,0)
 .. S DIR("B")="ONE",DIR(0)="SA^A:ALL;O:ONE",DIR("A")="EDIT(A)LL or (O)NE BATCH?: " W ! D ^DIR K DIR
"RTN","RCDPEWL8",208,0)
 .. I $D(DTOUT)!$D(DUOUT) Q
"RTN","RCDPEWL8",209,0)
 .. I Y="A" D EDITALL^RCDPEWLB(RCERA) Q
"RTN","RCDPEWL8",210,0)
 .. S DA(1)=RCERA,DIC="^RCY(344.49,"_DA(1)_",3,",DIC(0)="AEMQ" D ^DIC
"RTN","RCDPEWL8",211,0)
 .. Q:Y'>0
"RTN","RCDPEWL8",212,0)
 .. D EDIT^RCDPEWLB(RCERA,+Y)
"RTN","RCDPEWL8",213,0)
 . ;
"RTN","RCDPEWL8",214,0)
 . I Y=2 D REBATCH^RCDPEWLB(RCERA) W !! Q
"RTN","RCDPEWL8",215,0)
 . ;
"RTN","RCDPEWL8",216,0)
 . I Y=3 D MARKALL^RCDPEWLB(RCERA) W !! Q
"RTN","RCDPEWL8",217,0)
 . ;
"RTN","RCDPEWL8",218,0)
 . I Y=4 D SUMRPT^RCDPEWLC(RCERA) W !! Q
"RTN","RCDPEWL8",219,0)
 ;
"RTN","RCDPEWL8",220,0)
BATEDQ S VALMBCK="R"
"RTN","RCDPEWL8",221,0)
 Q
"RTN","RCDPEWL8",222,0)
 ;
"RTN","RCDPRPL4")
0^36^B35834476^B28923437
"RTN","RCDPRPL4",1,0)
RCDPRPL4 ;WISC/RFJ/PJH-receipt profile listmanager options ;1 Apr 01
"RTN","RCDPRPL4",2,0)
 ;;4.5;Accounts Receivable;**169,172,173,269,276**;Mar 20, 1995;Build 87
"RTN","RCDPRPL4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPRPL4",4,0)
 Q
"RTN","RCDPRPL4",5,0)
 ;
"RTN","RCDPRPL4",6,0)
 ;  this routine contains the entry points for receipt management
"RTN","RCDPRPL4",7,0)
 ;
"RTN","RCDPRPL4",8,0)
 ;
"RTN","RCDPRPL4",9,0)
ONLINE ;  allow the supervisor to mark the CR document as input on line
"RTN","RCDPRPL4",10,0)
 D FULL^VALM1
"RTN","RCDPRPL4",11,0)
 S VALMBCK="R"
"RTN","RCDPRPL4",12,0)
 ;
"RTN","RCDPRPL4",13,0)
 ;  get fms document and status
"RTN","RCDPRPL4",14,0)
 N %,FMSDOC,GECSDATA
"RTN","RCDPRPL4",15,0)
 S FMSDOC=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPRPL4",16,0)
 ;
"RTN","RCDPRPL4",17,0)
 W !!,"This option will allow you to mark a rejected Cash Receipt document as"
"RTN","RCDPRPL4",18,0)
 W !,"entered on line.  This will prevent the document from being listed on"
"RTN","RCDPRPL4",19,0)
 W !,"the nightly mailman message used to help manage the receipts and deposits."
"RTN","RCDPRPL4",20,0)
 ;
"RTN","RCDPRPL4",21,0)
 W !!,"FMS Cash Receipt Document: ",$P(FMSDOC,"^"),?48,"Status: ",$P(FMSDOC,"^",2)
"RTN","RCDPRPL4",22,0)
 ;
"RTN","RCDPRPL4",23,0)
 I '$D(^XUSEC("PRCAY PAYMENT SUP",DUZ)) W !!,"You are not an owner of the supervisor PRCAY PAYMENT SUP security key." D QUIT Q
"RTN","RCDPRPL4",24,0)
 ;
"RTN","RCDPRPL4",25,0)
 ;  cr accepted
"RTN","RCDPRPL4",26,0)
 I $E($P(FMSDOC,"^",2))="A" W !!,"You CANNOT mark the Cash Receipt document as entered on line.",!,"The CR document is ACCEPTED ??" D QUIT Q
"RTN","RCDPRPL4",27,0)
 ;
"RTN","RCDPRPL4",28,0)
 ;  not been transmitted for 2 days
"RTN","RCDPRPL4",29,0)
 I $E($P(FMSDOC,"^",2))="T",$$FMDIFF^XLFDT(DT,$P(^RCY(344,RCRECTDA,0),"^",8))'>2 W !!,"You CANNOT mark the Cash Receipt document as entered on line.",!,"The CR document has NOT been TRANSMITTED for 2 days ??" D QUIT Q
"RTN","RCDPRPL4",30,0)
 ;
"RTN","RCDPRPL4",31,0)
 ;  cr queued for transmission
"RTN","RCDPRPL4",32,0)
 I $E($P(FMSDOC,"^",2))="Q"!($E($P(FMSDOC,"^",2))="M") W !!,"You CANNOT mark the Cash Receipt document as entered on line.",!,"The CR document is waiting to be TRANSMITTED ??" D QUIT Q
"RTN","RCDPRPL4",33,0)
 ;
"RTN","RCDPRPL4",34,0)
 ;  check to see if already marked as entered on line
"RTN","RCDPRPL4",35,0)
 I $E($P(FMSDOC,"^",2))="O" D  Q
"RTN","RCDPRPL4",36,0)
 .   I $$ASKSTAT("REMOVE")'=1 Q
"RTN","RCDPRPL4",37,0)
 .   W !,"... removing CR status as entered on line ..."
"RTN","RCDPRPL4",38,0)
 .   ;  remove the status on field 201
"RTN","RCDPRPL4",39,0)
 .   D EDITREC^RCDPUREC(RCRECTDA,"201////0;")
"RTN","RCDPRPL4",40,0)
 .   ;  show the new status
"RTN","RCDPRPL4",41,0)
 .   S FMSDOC=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPRPL4",42,0)
 .   W !!,"FMS Cash Receipt Document: ",$P(FMSDOC,"^"),?48,"Status: ",$P(FMSDOC,"^",2)
"RTN","RCDPRPL4",43,0)
 .   D QUIT
"RTN","RCDPRPL4",44,0)
 ;
"RTN","RCDPRPL4",45,0)
 ;  ask to change the status to entered on line
"RTN","RCDPRPL4",46,0)
 I $$ASKSTAT("ENTER")'=1 D QUIT Q
"RTN","RCDPRPL4",47,0)
 ;
"RTN","RCDPRPL4",48,0)
 ;  change the status to entered on line
"RTN","RCDPRPL4",49,0)
 W !,"... changing status to entered on line ..."
"RTN","RCDPRPL4",50,0)
 W !,"... changing the generic code sheet stack file status to ACCEPTED ..."
"RTN","RCDPRPL4",51,0)
 ;
"RTN","RCDPRPL4",52,0)
 ;  set the status to entered on line in field 201
"RTN","RCDPRPL4",53,0)
 D EDITREC^RCDPUREC(RCRECTDA,"201////1;")
"RTN","RCDPRPL4",54,0)
 ;
"RTN","RCDPRPL4",55,0)
 ;  set the generic code sheet status as accepted
"RTN","RCDPRPL4",56,0)
 ;  get the document ien
"RTN","RCDPRPL4",57,0)
 D DATA^GECSSGET($P(FMSDOC,"^"))
"RTN","RCDPRPL4",58,0)
 I $G(GECSDATA) D SETSTAT^GECSSTAA(GECSDATA,"A")
"RTN","RCDPRPL4",59,0)
 ;
"RTN","RCDPRPL4",60,0)
 ;  show the new status
"RTN","RCDPRPL4",61,0)
 S FMSDOC=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPRPL4",62,0)
 W !!,"FMS Cash Receipt Document: ",$P(FMSDOC,"^"),?48,"Status: ",$P(FMSDOC,"^",2)
"RTN","RCDPRPL4",63,0)
 ;
"RTN","RCDPRPL4",64,0)
QUIT ;  pause and rebuild the header
"RTN","RCDPRPL4",65,0)
 W !!,"press RETURN to continue: "
"RTN","RCDPRPL4",66,0)
 R %:DTIME
"RTN","RCDPRPL4",67,0)
 D HDR^RCDPRPLM
"RTN","RCDPRPL4",68,0)
 Q
"RTN","RCDPRPL4",69,0)
 ;
"RTN","RCDPRPL4",70,0)
 ;
"RTN","RCDPRPL4",71,0)
ASKSTAT(ACTION) ;  ask if its okay to remove or change the entered online status
"RTN","RCDPRPL4",72,0)
 ;  1 is yes, otherwise no
"RTN","RCDPRPL4",73,0)
 N DIR,DIQ2,DTOUT,DUOUT,X,Y
"RTN","RCDPRPL4",74,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","RCDPRPL4",75,0)
 S DIR("A",1)="  Do you want to "_ACTION_" the status showing the Cash Receipt"
"RTN","RCDPRPL4",76,0)
 S DIR("A")="  document was entered ON LINE"
"RTN","RCDPRPL4",77,0)
 D ^DIR
"RTN","RCDPRPL4",78,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPRPL4",79,0)
 Q Y
"RTN","RCDPRPL4",80,0)
 ;
"RTN","RCDPRPL4",81,0)
ERAWL(RCSCR) ; Generate automatic dec adj from ERA Worklist in RCSCR
"RTN","RCDPRPL4",82,0)
 ; RCADJ returned = 1 if passed by reference and adjustment successful
"RTN","RCDPRPL4",83,0)
 ;       returned = 2 if passed by ref and adjustments aborted
"RTN","RCDPRPL4",84,0)
 ;       returned = -1 if error
"RTN","RCDPRPL4",85,0)
 ;       returned = 0 if no WL adjustments found
"RTN","RCDPRPL4",86,0)
 N RCZ,RCZ0,Z00,V00,RCCOM,RC1,RCADJ,RCOK,WLA
"RTN","RCDPRPL4",87,0)
 S RC1=1,RCZ=0,RCADJ=0
"RTN","RCDPRPL4",88,0)
 F  S RCZ=$O(^RCY(344.49,RCSCR,1,RCZ)) Q:'RCZ!(RCADJ=2)  S V00=$G(^(RCZ,0)),RCZ0=0 F  S RCZ0=$O(^RCY(344.49,RCSCR,1,RCZ,1,RCZ0)) Q:'RCZ0!(RCADJ=2)  S Z00=$G(^(RCZ0,0)) Q:"12"'[+$P(Z00,U,5)  D
"RTN","RCDPRPL4",89,0)
 . S RCCOM(1)=$P(Z00,U,9)
"RTN","RCDPRPL4",90,0)
 . I RC1,$P(Z00,U,5)=1 D  Q:RCADJ=2
"RTN","RCDPRPL4",91,0)
 .. S RC1=0
"RTN","RCDPRPL4",92,0)
 .. S DIR(0)="YA",DIR("B")="YES",DIR("A",1)="Generating automatic decrease adjustments from EDI Lbox Worklist ...",DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: "
"RTN","RCDPRPL4",93,0)
 .. D ^DIR K DIR
"RTN","RCDPRPL4",94,0)
 .. I Y'=1 S RCADJ=2
"RTN","RCDPRPL4",95,0)
 . I $P(Z00,U,8)=1 D  Q  ; previously done
"RTN","RCDPRPL4",96,0)
 .. I $P(Z00,U,5)=1 W !,"  Automatic decrease adj from ERA Worklist for bill #"_$P($G(^PRCA(430,+$P(V00,U,7),0)),U),!,"    for amount of "_$J(+$P(Z00,U,3),"",2)_" was previously completed" S RCADJ=1
"RTN","RCDPRPL4",97,0)
 . I $P(Z00,U,5)=1 D  Q  ; Decrease adj
"RTN","RCDPRPL4",98,0)
 .. S WLA=$$INCDEC^RCBEUTR1($P(V00,U,7),$P(Z00,U,3),.RCCOM,,,1) I 'WLA D
"RTN","RCDPRPL4",99,0)
 ... ; PRCA276 - $$INCDEC can now return "0^1" which means a negative claim balance could have occurred if the decrease adjustment was applied to the claim
"RTN","RCDPRPL4",100,0)
 ... S RCADJ=-1 W !,"  Could not perform automatic decrease adj from ERA Worklist for ",!,"    bill # "_$P($G(^PRCA(430,+$P(V00,U,7),0)),U)_" for amount of "_$J(+$P(Z00,U,3),"",2)
"RTN","RCDPRPL4",101,0)
 ... I $P(WLA,U,2) D
"RTN","RCDPRPL4",102,0)
 .... S RCADJ=2
"RTN","RCDPRPL4",103,0)
 .... W !,"WARNING:  Receipt cannot be processed.",!,"Processing this receipt will cause this bill to have a negative balance",!,"which is outside the scope of VA Accounting regulations."
"RTN","RCDPRPL4",104,0)
 .... W !,"Correct the error and reprocess this receipt."
"RTN","RCDPRPL4",105,0)
 .. E  D  ; success
"RTN","RCDPRPL4",106,0)
 ... D UPD(RCSCR,RCZ,RCZ0)
"RTN","RCDPRPL4",107,0)
 ... S RCADJ=1
"RTN","RCDPRPL4",108,0)
 ... W !,"  EDI Lbox Worklist automatic dec adjustment made to "_$P($G(^PRCA(430,+$P(V00,U,7),0)),U)_": "_$J(+$P(Z00,U,3),"",2)
"RTN","RCDPRPL4",109,0)
 . I $P(Z00,U,5)=2 D  Q  ; Bill comment
"RTN","RCDPRPL4",110,0)
 .. D ADDCOMM^RCBEUTRA($P(V00,U,7),.RCCOM),UPD(RCSCR,RCZ,RCZ0)
"RTN","RCDPRPL4",111,0)
 ;
"RTN","RCDPRPL4",112,0)
 Q $G(RCADJ)
"RTN","RCDPRPL4",113,0)
 ;
"RTN","RCDPRPL4",114,0)
UPD(RCSCR,Z,Z0) ; Mark as complete so it doesn't get done twice
"RTN","RCDPRPL4",115,0)
 N DA,DIE,DR
"RTN","RCDPRPL4",116,0)
 S DA(2)=RCSCR,DA(1)=Z,DA=Z0
"RTN","RCDPRPL4",117,0)
 S DIE="^RCY(344.49,"_DA(2)_",1,"_DA(1)_",1,",DR=".08////1" D ^DIE
"RTN","RCDPRPL4",118,0)
 Q
"RTN","RCDPRPL4",119,0)
 ;
"RTN","RCDPRTP1")
0^12^B33114320^B32458537
"RTN","RCDPRTP1",1,0)
RCDPRTP1 ;ALB/LDB - CLAIMS MATCHING REPORT (PRINT) ;1/26/01  2:56 PM
"RTN","RCDPRTP1",2,0)
 ;;4.5;Accounts Receivable;**151,169,276**;Mar 20, 1995;Build 87
"RTN","RCDPRTP1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPRTP1",4,0)
 ;
"RTN","RCDPRTP1",5,0)
EN ; Entry point to print the Claims Matching Report.
"RTN","RCDPRTP1",6,0)
 N %,DATEDIS1,DATEDIS2,NOW,PG,RCBILL,RCAMT,RCAMT1,RCIBDAT,RCIBFN,RCNAM,RCNAM1,RCNO,RCNOW,RCDLINE,RCLINE,RCPHIT
"RTN","RCDPRTP1",7,0)
 N RCPT,RCQ,RCSSN,RCSTAT,RCTP,X,Y
"RTN","RCDPRTP1",8,0)
 ;
"RTN","RCDPRTP1",9,0)
 ; - initialize report header variables
"RTN","RCDPRTP1",10,0)
 S PG=0
"RTN","RCDPRTP1",11,0)
 I RCSORT'=2,(RCSORT'=4) D
"RTN","RCDPRTP1",12,0)
 .S Y=$P(DATESTRT,".") D DD^%DT S DATEDIS1=Y
"RTN","RCDPRTP1",13,0)
 .S Y=$P(DATEEND,".") D DD^%DT S DATEDIS2=Y
"RTN","RCDPRTP1",14,0)
 D NOW^%DTC S Y=% D DD^%DT S RCNOW=$E(Y,1,18)
"RTN","RCDPRTP1",15,0)
 S RCDLINE=$TR($J("",80)," ","-")
"RTN","RCDPRTP1",16,0)
 S RCLINE=$TR($J("",80)," ","*")
"RTN","RCDPRTP1",17,0)
 ;
"RTN","RCDPRTP1",18,0)
 ; - main report loop
"RTN","RCDPRTP1",19,0)
 K ^TMP($J)
"RTN","RCDPRTP1",20,0)
 ;
"RTN","RCDPRTP1",21,0)
 ;
"RTN","RCDPRTP1",22,0)
 D HDR ; initial header
"RTN","RCDPRTP1",23,0)
 S RCNO=0 ; flag to indicate at least one matching claim
"RTN","RCDPRTP1",24,0)
 ;
"RTN","RCDPRTP1",25,0)
 S RCNAM="" F  S RCNAM=$O(^TMP("RCDPRTPB",$J,RCNAM)) Q:RCNAM=""!$G(RCQ)  D
"RTN","RCDPRTP1",26,0)
 .S RCBILL=0 F  S RCBILL=$O(^TMP("RCDPRTPB",$J,RCNAM,RCBILL)) Q:'RCBILL!$G(RCQ)  D
"RTN","RCDPRTP1",27,0)
 ..;
"RTN","RCDPRTP1",28,0)
 ..S RCPHIT=0 ; flag that requires patient info to print
"RTN","RCDPRTP1",29,0)
 ..D PROC ;     process a single third party bill
"RTN","RCDPRTP1",30,0)
 ..K ^TMP("IBRBT",$J),^TMP("IBRBF",$J)
"RTN","RCDPRTP1",31,0)
 ;
"RTN","RCDPRTP1",32,0)
 I $G(RCQ) G ENQ
"RTN","RCDPRTP1",33,0)
 ;
"RTN","RCDPRTP1",34,0)
 I $O(^TMP("RCDPRTPB",$J,0))="" W !!,?18,"No matching debts." Q
"RTN","RCDPRTP1",35,0)
 I 'RCNO W !!,?18,"No matching debts."
"RTN","RCDPRTP1",36,0)
ENQ ;
"RTN","RCDPRTP1",37,0)
 Q
"RTN","RCDPRTP1",38,0)
 ;
"RTN","RCDPRTP1",39,0)
 ;
"RTN","RCDPRTP1",40,0)
PROC ; Process each third party bill for a patient.
"RTN","RCDPRTP1",41,0)
 D RELBILL^IBRFN(RCBILL)
"RTN","RCDPRTP1",42,0)
 ;
"RTN","RCDPRTP1",43,0)
 ; - quit if there are no associated first party bills
"RTN","RCDPRTP1",44,0)
 I '$O(^TMP("IBRBF",$J,0)) K ^TMP("RCDPRTPB",$J,RCNAM,RCBILL) G PROCQ
"RTN","RCDPRTP1",45,0)
 ;
"RTN","RCDPRTP1",46,0)
 S (RCAMT(0),RCAMT(1))=0
"RTN","RCDPRTP1",47,0)
 ;
"RTN","RCDPRTP1",48,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:'RCTP(0)  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:'RCTP(1)  S ^TMP($J,"IBRBF",RCTP(1),RCTP(0))=""
"RTN","RCDPRTP1",49,0)
 S RCPT(0)=0 F  S RCTP(0)=$O(^TMP($J,"IBRBF",RCTP(0))) Q:'RCTP(0)  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP($J,"IBRBF",RCTP(0),RCTP(1))) Q:'RCTP(1)  D
"RTN","RCDPRTP1",50,0)
 .I RCTP(1)=RCBILL Q
"RTN","RCDPRTP1",51,0)
 .I $D(^TMP($J,"IBRBF",RCTP(0),RCBILL))!(RCTP(1)'=$O(^TMP($J,"IBRBF",RCTP(0),0))) K ^TMP("IBRBF",$J,RCTP(1),RCTP(0)),^TMP($J,"IBRBF",RCTP(0),RCTP(1)) I '$O(^TMP("IBRBF",$J,RCTP(1),0)) K ^TMP("IBRBF",$J,RCTP(1))
"RTN","RCDPRTP1",52,0)
 S RCTP(0)="" F  S RCTP(0)=$O(^TMP("IBRBT",$J,RCBILL,RCTP(0))) Q:RCTP(0)=""  D
"RTN","RCDPRTP1",53,0)
 .;if associated third party has had payment also do not list twice
"RTN","RCDPRTP1",54,0)
 .I $D(^TMP("RCDPRTPB",$J,RCNAM,RCTP(0))),(RCBILL'=RCTP(0)) S RCTP(RCTP(0))=^TMP("RCDPRTPB",$J,RCNAM,RCTP(0)) K ^(RCTP(0))
"RTN","RCDPRTP1",55,0)
 .;if no prescription coverage exclude associated rx co-pay charges
"RTN","RCDPRTP1",56,0)
 .I '$P(^TMP("IBRBT",$J,RCBILL),"^") D
"RTN","RCDPRTP1",57,0)
 ..S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:RCTP(1)=""  I $G(^TMP("IBRBF",$J,RCTP(0),RCTP(1)))["RX" K ^TMP("IBRBF",$J,RCTP(0),RCTP(1)) I '$O(^TMP("IBRBF",$J,RCTP(0),"")) K ^TMP("IBRBF",$J,RCTP(0))
"RTN","RCDPRTP1",58,0)
 .;if duplicate charges exclude them from report
"RTN","RCDPRTP1",59,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:RCTP(0)=""  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:'RCTP(1)  D
"RTN","RCDPRTP1",60,0)
 .I RCTP(0)'=RCBILL,($D(^TMP("IBRBF",$J,RCBILL,RCTP(1)))) K ^TMP("IBRBF",$J,RCTP(0),RCTP(1)) K:'$O(^TMP("IBRBF",$J,RCTP(0),0)) ^TMP("IBRBF",$J,RCTP(0))
"RTN","RCDPRTP1",61,0)
 ;exclude cancelled charges if not selected to be on report
"RTN","RCDPRTP1",62,0)
 I 'RCAN D
"RTN","RCDPRTP1",63,0)
 .S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:RCTP(0)=""  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:'RCTP(1)  D
"RTN","RCDPRTP1",64,0)
 ..I $P(^TMP("IBRBF",$J,RCTP(0),RCTP(1)),"^",3) K ^TMP("IBRBF",$J,RCTP(0),RCTP(1)) Q
"RTN","RCDPRTP1",65,0)
 ..S RCPT(2)=$O(^PRCA(430,"B",+$P(^TMP("IBRBF",$J,RCTP(0),RCTP(1)),"^",4),0)) I $P($G(^PRCA(430,+RCPT(2),0)),"^",8)=39 K ^TMP("IBRBF",$J,RCTP(0),RCTP(1))
"RTN","RCDPRTP1",66,0)
 ..I '$O(^TMP("IBRBF",$J,RCTP(0),"")) K ^TMP("IBRBF",$J,RCTP(0))
"RTN","RCDPRTP1",67,0)
 I '$O(^TMP("IBRBF",$J,RCBILL,0)) K ^TMP("RCDPRTPB",$J,RCNAM,RCBILL) G PROCQ
"RTN","RCDPRTP1",68,0)
 ;
"RTN","RCDPRTP1",69,0)
 ; - print patient detail line
"RTN","RCDPRTP1",70,0)
 I 'RCPHIT S RCPHIT=1 D PRINT3^RCDPRTP2 G:$G(RCQ) PROCQ
"RTN","RCDPRTP1",71,0)
 ;
"RTN","RCDPRTP1",72,0)
 ; - print third party bills
"RTN","RCDPRTP1",73,0)
 ;    o  print the header first; need room for the header and
"RTN","RCDPRTP1",74,0)
 ;       the bill that was paid.
"RTN","RCDPRTP1",75,0)
 ;    o  print the bill that was paid.
"RTN","RCDPRTP1",76,0)
 S RCTP=RCBILL,RCIBDAT=$G(^TMP("IBRBT",$J,RCBILL,RCBILL))
"RTN","RCDPRTP1",77,0)
 I $Y>(IOSL-7) D PAUSE^RCDPRTP2 G:$G(RCQ) PROCQ D HDR
"RTN","RCDPRTP1",78,0)
 D HDR1^RCDPRTP2,PRINT1^RCDPRTP2 G:$G(RCQ) PROCQ
"RTN","RCDPRTP1",79,0)
 ;
"RTN","RCDPRTP1",80,0)
 ; - print the other assoicated third party bills
"RTN","RCDPRTP1",81,0)
 S RCTP=0 F  S RCTP=$O(^TMP("IBRBT",$J,RCBILL,RCTP)) Q:'RCTP!$G(RCQ)  D
"RTN","RCDPRTP1",82,0)
 .I RCBILL=RCTP Q  ; don't reprint the bill that was paid.
"RTN","RCDPRTP1",83,0)
 .S RCIBDAT=$G(^TMP("IBRBT",$J,RCBILL,RCTP))
"RTN","RCDPRTP1",84,0)
 .I 'RCAN,($P(RCIBDAT,"^",3)) Q  ; exclude cancelled claims
"RTN","RCDPRTP1",85,0)
 .D PRINT1^RCDPRTP2
"RTN","RCDPRTP1",86,0)
 G:$G(RCQ) PROCQ
"RTN","RCDPRTP1",87,0)
 ;
"RTN","RCDPRTP1",88,0)
 ; - print the third party totals
"RTN","RCDPRTP1",89,0)
 ; PRCA*4.5*276 - adjusted header to make room for EEOB indicator '%'
"RTN","RCDPRTP1",90,0)
 I $Y>(IOSL-2) D PAUSE^RCDPRTP2 G:$G(RCQ) PROCQ D HDR W !
"RTN","RCDPRTP1",91,0)
 W !,?63,"----------",?75,"----------"
"RTN","RCDPRTP1",92,0)
 W !,?64,$J(RCAMT(0),9,2),?76,$J(RCAMT(1),9,2)
"RTN","RCDPRTP1",93,0)
 ;
"RTN","RCDPRTP1",94,0)
 ; - print the associated first party charges
"RTN","RCDPRTP1",95,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:'RCTP(0)!$G(RCQ)  D
"RTN","RCDPRTP1",96,0)
 .I RCTP(0)=$O(^TMP("IBRBF",$J,0)) D
"RTN","RCDPRTP1",97,0)
 ..I $Y>(IOSL-5) D PAUSE^RCDPRTP2 Q:$G(RCQ)  D HDR
"RTN","RCDPRTP1",98,0)
 ..D HDR2^RCDPRTP2
"RTN","RCDPRTP1",99,0)
 .S RCTP=0 F  S RCTP=$O(^TMP("IBRBF",$J,RCTP(0),RCTP)) Q:'RCTP!$G(RCQ)  D
"RTN","RCDPRTP1",100,0)
 ..S RCNO=1 ; set flag for at least one match
"RTN","RCDPRTP1",101,0)
 ..;
"RTN","RCDPRTP1",102,0)
 ..S RCIBDAT=$G(^TMP("IBRBF",$J,RCTP(0),RCTP))
"RTN","RCDPRTP1",103,0)
 ..;
"RTN","RCDPRTP1",104,0)
 ..; - print the header for the first charge
"RTN","RCDPRTP1",105,0)
 ..;
"RTN","RCDPRTP1",106,0)
 ..; - print the patient detail line
"RTN","RCDPRTP1",107,0)
 ..D PRINT2^RCDPRTP2
"RTN","RCDPRTP1",108,0)
 ;.
"RTN","RCDPRTP1",109,0)
PROCQ K ^TMP($J),^TMP("IBRBF"),^TMP("IBRBT") Q
"RTN","RCDPRTP1",110,0)
 ;
"RTN","RCDPRTP1",111,0)
 ;
"RTN","RCDPRTP1",112,0)
HDR ; Print the main report header.
"RTN","RCDPRTP1",113,0)
 S PG=PG+1 I PG'=1!($E(IOST,1,2)="C-") W @IOF
"RTN","RCDPRTP1",114,0)
 W !,?5,"THIRD PARTY CLAIMS W/MATCHING FIRST PARTY DEBTS  ",RCNOW," PAGE ",PG
"RTN","RCDPRTP1",115,0)
 I RCSORT'=2,(RCSORT'=4) W !,?18,"FOR THE PAYMENT DATES: ",DATEDIS1,"  TO  ",DATEDIS2
"RTN","RCDPRTP1",116,0)
 I RCSORT=4 W !,?18,"RECEIPT NUMBER ",RCPT
"RTN","RCDPRTP1",117,0)
 W !,RCDLINE
"RTN","RCDPRTP1",118,0)
 I PG=1 D
"RTN","RCDPRTP1",119,0)
 .W !!,"Remember that any actions taken to decrease the first party receivables must"
"RTN","RCDPRTP1",120,0)
 .W !,"consider any applicable deductibles or coinsurance amounts specified on the EOB."
"RTN","RCDPRTP1",121,0)
 Q
"RTN","RCDPRTP1",122,0)
 ;
"RTN","RCDPRTP2")
0^13^B14571790^B10018244
"RTN","RCDPRTP2",1,0)
RCDPRTP2 ;ALB/LDB - CLAIMS MATCHING REPORT ;1/26/01  3:16 PM
"RTN","RCDPRTP2",2,0)
 ;;4.5;Accounts Receivable;**151,276**;Mar 20, 1995;Build 87
"RTN","RCDPRTP2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPRTP2",4,0)
 ;
"RTN","RCDPRTP2",5,0)
PRINT1 ;
"RTN","RCDPRTP2",6,0)
 I $Y>(IOSL-2) D PAUSE Q:$G(RCQ)  D HDR^RCDPRTP1,HDR1
"RTN","RCDPRTP2",7,0)
 ; PRCA*4.5*276 - get EEOB indicator '%'and attach it to the bill number when applicable. Adjust report tabs to make room for EEOB indicator '%'.
"RTN","RCDPRTP2",8,0)
 N RC430 S RC430=+$O(^PRCA(430,"B",""_$P(RCIBDAT,"^",4)_"",0))
"RTN","RCDPRTP2",9,0)
 S RCEEOB=$$EEOB(RC430)
"RTN","RCDPRTP2",10,0)
 W !,$S(RCTP=RCBILL:"*",$D(RCTP(RCTP)):"*",1:" "),$G(RCEEOB)_$P(RCIBDAT,"^",4),?17,$P(RCIBDAT,"^",5),?24
"RTN","RCDPRTP2",11,0)
 W $$STAT(RCTP),?31,$$DATE(+RCIBDAT),?42,$$DATE($P(RCIBDAT,"^",2))
"RTN","RCDPRTP2",12,0)
 S Y=$S($G(RCTP(RCTP)):RCTP(RCTP),$G(^TMP("RCDPRTPB",$J,RCNAM,RCBILL)):^(RCBILL),1:"") I RCTP=RCBILL!($D(RCTP(RCTP))) W ?53,$$DATE(Y)
"RTN","RCDPRTP2",13,0)
 S RCAMT=$P($G(^PRCA(430,+RCTP,0)),"^",3),RCAMT1=$P($G(^PRCA(430,+RCTP,7)),"^",7) W ?64,$J(RCAMT,9,2)
"RTN","RCDPRTP2",14,0)
 W ?76,$J(RCAMT1,9,2) S RCAMT(0)=RCAMT(0)+RCAMT,RCAMT(1)=RCAMT(1)+RCAMT1
"RTN","RCDPRTP2",15,0)
 W ?88,$E($P(RCIBDAT,"^",7),1,25)
"RTN","RCDPRTP2",16,0)
 K RCTP(RCTP)
"RTN","RCDPRTP2",17,0)
 Q
"RTN","RCDPRTP2",18,0)
 ;
"RTN","RCDPRTP2",19,0)
PRINT2  ; Print the detail line for a first party bill.
"RTN","RCDPRTP2",20,0)
 I $Y>(IOSL-2) D PAUSE Q:$G(RCQ)  D HDR^RCDPRTP1,HDR2
"RTN","RCDPRTP2",21,0)
 W !," ",$P(RCIBDAT,"^",4),?14,$P(RCIBDAT,"^",6)
"RTN","RCDPRTP2",22,0)
 S RCIBFN=$P(RCIBDAT,"^",4) I RCIBFN S RCIBFN=$O(^PRCA(430,"B",RCIBFN,0))
"RTN","RCDPRTP2",23,0)
 ; PRCA*4.5*276 - adjust report tabs to make room for EEOB indicator '%'.
"RTN","RCDPRTP2",24,0)
 W ?36,$$STAT(RCIBFN),?42,$$DATE(+RCIBDAT),?54,$$DATE($P(RCIBDAT,"^",2))
"RTN","RCDPRTP2",25,0)
 W ?66,$J($P(RCIBDAT,"^",5),9,2),?78,$P(RCIBDAT,"^",7)
"RTN","RCDPRTP2",26,0)
 W ?87,$J($S($G(^PRCA(430,+RCIBFN,7)):+($P(^(7),"^")+$P(^(7),"^",2)+$P(^(7),"^",3)+$P(^(7),"^",4)+$P(^(7),"^",4)),1:0),9,2)
"RTN","RCDPRTP2",27,0)
 Q
"RTN","RCDPRTP2",28,0)
 ;
"RTN","RCDPRTP2",29,0)
 ;
"RTN","RCDPRTP2",30,0)
PRINT3 ; Print patient detail information.
"RTN","RCDPRTP2",31,0)
 I $Y>(IOSL-5) D PAUSE Q:$G(RCQ)  D HDR^RCDPRTP1
"RTN","RCDPRTP2",32,0)
 S RCNAM1=^TMP("RCDPRTPB",$J,RCNAM)
"RTN","RCDPRTP2",33,0)
 W !!,RCLINE
"RTN","RCDPRTP2",34,0)
 W !,"NAME: ",$P(RCNAM,"^")," (",$E($P(RCNAM1,"^",3),6,9)_")"
"RTN","RCDPRTP2",35,0)
 W !,"Prim. Elig: ",$P(RCNAM1,"^",2)
"RTN","RCDPRTP2",36,0)
 W ?44,"DOB: ",$P(RCNAM1,"^")
"RTN","RCDPRTP2",37,0)
 W ?61,"RX COVERAGE: ",$S('$G(^TMP("IBRBT",$J,RCBILL)):"NO",1:"YES")
"RTN","RCDPRTP2",38,0)
 W !,RCLINE
"RTN","RCDPRTP2",39,0)
 Q
"RTN","RCDPRTP2",40,0)
 ;
"RTN","RCDPRTP2",41,0)
HDR1    ;
"RTN","RCDPRTP2",42,0)
 W !!,"Third Party Bills: * -> bill for which payment was posted"
"RTN","RCDPRTP2",43,0)
 W !,"============================="
"RTN","RCDPRTP2",44,0)
 ; PRCA*4.5*276 - adjust report tabs to make room for EEOB indicator '%'.
"RTN","RCDPRTP2",45,0)
 W !!,"Bill #",?15,"P/S/T",?22,"Status",?30,"Bill From",?42,"Bill To",?53,"Posted",?63,"Amt Billed",?76,"Amt Paid",?88,"Payor"
"RTN","RCDPRTP2",46,0)
 W !,"-------------",?15,"-----",?22,"------",?30,"---------",?42,"--------",?53,"--------",?63,"----------",?75,"----------",?88,"-----"
"RTN","RCDPRTP2",47,0)
 Q
"RTN","RCDPRTP2",48,0)
 ;
"RTN","RCDPRTP2",49,0)
HDR2 ;
"RTN","RCDPRTP2",50,0)
 W !!,"Associated First Party Charges:"
"RTN","RCDPRTP2",51,0)
 W !,"==============================="
"RTN","RCDPRTP2",52,0)
 ; PRCA*4.5*276 - adjust report tabs to make room for EEOB indicator '%'.
"RTN","RCDPRTP2",53,0)
 W !," Bill #",?14,"Charge Type",?34,"Status",?42,"From/Fill",?54,"To/Rel",?65,"Amt Billed",?78,"On Hold",?87,"  Balance"
"RTN","RCDPRTP2",54,0)
 W !,"-----------",?14,"----------------",?34,"------",?42,"---------",?54,"---------",?65,"----------",?78,"-------",?87," ----------"
"RTN","RCDPRTP2",55,0)
 Q
"RTN","RCDPRTP2",56,0)
 ;
"RTN","RCDPRTP2",57,0)
STAT(RCIBFN) ;AR Status
"RTN","RCDPRTP2",58,0)
 I '$G(RCIBFN) Q ""
"RTN","RCDPRTP2",59,0)
 N RCSTAT
"RTN","RCDPRTP2",60,0)
 S RCSTAT=$P($G(^PRCA(430,+RCIBFN,0)),"^",8),RCSTAT=$P($G(^PRCA(430.3,+RCSTAT,0)),"^",2)
"RTN","RCDPRTP2",61,0)
 Q RCSTAT
"RTN","RCDPRTP2",62,0)
 ;
"RTN","RCDPRTP2",63,0)
DATE(X) ; Convert FileMan date to mm/dd/yy
"RTN","RCDPRTP2",64,0)
 Q $S($G(X):$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")
"RTN","RCDPRTP2",65,0)
 ;
"RTN","RCDPRTP2",66,0)
 ;
"RTN","RCDPRTP2",67,0)
PAUSE ; Page break.
"RTN","RCDPRTP2",68,0)
 I $E(IOST,1,2)'="C-" Q
"RTN","RCDPRTP2",69,0)
 N RCX,DIR,DIRUT,DUOUT,DTOUT,DIROUT,X,Y
"RTN","RCDPRTP2",70,0)
 I IOSL<100 F RCX=$Y:1:(IOSL-3) W !
"RTN","RCDPRTP2",71,0)
 S DIR(0)="E" D ^DIR I $D(DIRUT)!($D(DUOUT)) S RCQ=1
"RTN","RCDPRTP2",72,0)
 Q
"RTN","RCDPRTP2",73,0)
 ;
"RTN","RCDPRTP2",74,0)
EEOB(RCBILL) ; PRCA*4.5*276 - get EEOB indicator for a bill
"RTN","RCDPRTP2",75,0)
 ; Interaction with IB file #361.1 covered by IA #4051.
"RTN","RCDPRTP2",76,0)
 ; RCBILL is the IEN of the bill in files #399/#430 and must be valid,
"RTN","RCDPRTP2",77,0)
 ; Exclude an EOB type of MRA when getting payment information. Return
"RTN","RCDPRTP2",78,0)
 ; the EEOB indicator '%' if payment activity was found.
"RTN","RCDPRTP2",79,0)
 ;
"RTN","RCDPRTP2",80,0)
 N RCEEOB,RCVAL,Z
"RTN","RCDPRTP2",81,0)
 I $G(RCBILL)=0 Q ""
"RTN","RCDPRTP2",82,0)
 I '$O(^IBM(361.1,"B",RCBILL,0)) Q ""  ; no matching entry for bill
"RTN","RCDPRTP2",83,0)
 I $P($G(^DGCR(399,RCBILL,0)),"^",13)=1 Q ""  ;avoid 'ENTERED/NOT REVIEWED' status
"RTN","RCDPRTP2",84,0)
 ; handle both single and multiple bill entries in file #361.1
"RTN","RCDPRTP2",85,0)
 S Z=0 F  S Z=$O(^IBM(361.1,"B",RCBILL,Z)) Q:'Z  D  Q:$G(RCEEOB)="%"
"RTN","RCDPRTP2",86,0)
 . S RCVAL=$G(^IBM(361.1,Z,0))
"RTN","RCDPRTP2",87,0)
 . S RCEEOB=$S($P(RCVAL,"^",4)=1:"",$P(RCVAL,"^",4)=0:"%",1:"")
"RTN","RCDPRTP2",88,0)
 Q RCEEOB  ; EEOB indicator for 1st/3rd party payment on bill
"VER")
8.0^22.0
"^DD",344.31,344.31,.17,0)
USER WHO REMOVED EFT^P200'^VA(200,^3;1^Q
"^DD",344.31,344.31,.17,3)
User who marked the EFT deposit as a duplicate
"^DD",344.31,344.31,.17,21,0)
^^2^2^3110420^
"^DD",344.31,344.31,.17,21,1,0)
This field records the name of the person who is marking the EFT as a 
"^DD",344.31,344.31,.17,21,2,0)
duplicate.
"^DD",344.31,344.31,.17,"DT")
3110823
"^DD",344.31,344.31,.18,0)
DATE/TIME DUPLICATE REMOVED^D^^3;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",344.31,344.31,.18,1,0)
^.1
"^DD",344.31,344.31,.18,1,1,0)
344.31^E
"^DD",344.31,344.31,.18,1,1,1)
S ^RCY(344.31,"E",$E(X,1,30),DA)=""
"^DD",344.31,344.31,.18,1,1,2)
K ^RCY(344.31,"E",$E(X,1,30),DA)
"^DD",344.31,344.31,.18,1,1,"%D",0)
^^2^2^3110420^
"^DD",344.31,344.31,.18,1,1,"%D",1,0)
This cross reference is used to sort the file by the DATE/TIME RETURNED 
"^DD",344.31,344.31,.18,1,1,"%D",2,0)
field (#.18).
"^DD",344.31,344.31,.18,1,1,"DT")
3110420
"^DD",344.31,344.31,.18,3)
Date/Time duplicate EFT was marked as removed
"^DD",344.31,344.31,.18,21,0)
^^1^1^3110420^
"^DD",344.31,344.31,.18,21,1,0)
This field records the time that the EFT was marked as removed.
"^DD",344.31,344.31,.18,"DT")
3110823
"^DD",344.31,344.31,.19,0)
EFT REMOVAL REASON^RFX^^3;3^K:$L(X)>100!($L(X)<1)!($TR(X," ","")="") X
"^DD",344.31,344.31,.19,3)
The removal reason must be 1-100 characters in length.
"^DD",344.31,344.31,.19,21,0)
^^2^2^3110906^
"^DD",344.31,344.31,.19,21,1,0)
The EFT removal reason is used to record the justification for removing 
"^DD",344.31,344.31,.19,21,2,0)
this EFT.
"^DD",344.31,344.31,.19,"DT")
3110909
"^DD",344.4,344.4,.04,0)
ERA DATE^D^^0;4^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",344.4,344.4,.04,1,0)
^.1
"^DD",344.4,344.4,.04,1,1,0)
344.4^AC
"^DD",344.4,344.4,.04,1,1,1)
S ^RCY(344.4,"AC",$E(X,1,30),DA)=""
"^DD",344.4,344.4,.04,1,1,2)
K ^RCY(344.4,"AC",$E(X,1,30),DA)
"^DD",344.4,344.4,.04,1,1,3)
DO NOT DELETE
"^DD",344.4,344.4,.04,1,1,"%D",0)
^^2^2^3110929^
"^DD",344.4,344.4,.04,1,1,"%D",1,0)
This cross-reference is used by the option 'Mark ERAs Returned to Payer 
"^DD",344.4,344.4,.04,1,1,"%D",2,0)
Audit Report'.
"^DD",344.4,344.4,.04,1,1,"DT")
3110929
"^DD",344.4,344.4,.04,3)
Enter the date from the ERA record.
"^DD",344.4,344.4,.04,21,0)
^.001^1^1^3111003^^^
"^DD",344.4,344.4,.04,21,1,0)
This is the date the ERA was generated by the payer.
"^DD",344.4,344.4,.04,"DT")
3110929
"^DD",344.4,344.4,.16,0)
RETURNED BY^P200'^VA(200,^6;1^Q
"^DD",344.4,344.4,.16,3)
Name of person marking ERA returned.
"^DD",344.4,344.4,.16,21,0)
^^2^2^3110420^
"^DD",344.4,344.4,.16,21,1,0)
This field is used to record the name of the person who is marking the 
"^DD",344.4,344.4,.16,21,2,0)
ERA as returned to Payer.
"^DD",344.4,344.4,.16,"DT")
3110420
"^DD",344.4,344.4,.17,0)
RETURNED DATE^D^^6;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",344.4,344.4,.17,1,0)
^.1
"^DD",344.4,344.4,.17,1,1,0)
344.4^AD
"^DD",344.4,344.4,.17,1,1,1)
S ^RCY(344.4,"AD",$E(X,1,30),DA)=""
"^DD",344.4,344.4,.17,1,1,2)
K ^RCY(344.4,"AD",$E(X,1,30),DA)
"^DD",344.4,344.4,.17,1,1,3)
DO NOT DELETE
"^DD",344.4,344.4,.17,1,1,"%D",0)
^^2^2^3110929^
"^DD",344.4,344.4,.17,1,1,"%D",1,0)
This cross-reference is used by the option 'Mark ERAs Returned to Payer 
"^DD",344.4,344.4,.17,1,1,"%D",2,0)
Audit Report'.
"^DD",344.4,344.4,.17,1,1,"DT")
3110929
"^DD",344.4,344.4,.17,3)
Enter the Date/time the ERA was returned.
"^DD",344.4,344.4,.17,21,0)
^.001^2^2^3111003^^
"^DD",344.4,344.4,.17,21,1,0)
This field records the date/time that the ERA was marked as returned to 
"^DD",344.4,344.4,.17,21,2,0)
Payer.
"^DD",344.4,344.4,.17,"DT")
3110929
"^DD",344.4,344.4,.18,0)
RETURN REASON^RFX^^6;3^K:$L(X)>100!($L(X)<1)!($TR(X," ","")="") X
"^DD",344.4,344.4,.18,3)
Return reason must be 1-100 characters in length.
"^DD",344.4,344.4,.18,21,0)
^.001^1^1^3110909^^^
"^DD",344.4,344.4,.18,21,1,0)
The justification for marking the ERA as returned to payer.
"^DD",344.4,344.4,.18,"DT")
3110909
"^DD",344.4,344.4,7.01,0)
DATE/TIME ERA LINKED^D^^7;1^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",344.4,344.4,7.01,1,0)
^.1
"^DD",344.4,344.4,7.01,1,1,0)
344.4^AFL
"^DD",344.4,344.4,7.01,1,1,1)
S ^RCY(344.4,"AFL",$E(X,1,30),DA)=""
"^DD",344.4,344.4,7.01,1,1,2)
K ^RCY(344.4,"AFL",$E(X,1,30),DA)
"^DD",344.4,344.4,7.01,1,1,"%D",0)
^^1^1^3110324^
"^DD",344.4,344.4,7.01,1,1,"%D",1,0)
Created to find entries to include on ERA posted to Paper EOB report.
"^DD",344.4,344.4,7.01,1,1,"DT")
3110324
"^DD",344.4,344.4,7.01,3)
Enter the date/time the ERA was linked to receipt. 
"^DD",344.4,344.4,7.01,21,0)
^^1^1^3110324^
"^DD",344.4,344.4,7.01,21,1,0)
This is date/time the ERA was linked to receipt. 
"^DD",344.4,344.4,7.01,"DT")
3110324
"^DD",344.4,344.4,7.02,0)
ERA LINKED BY^P200'^VA(200,^7;2^Q
"^DD",344.4,344.4,7.02,3)
Select the person who linked the ERA to the receipt.
"^DD",344.4,344.4,7.02,21,0)
^^1^1^3110328^
"^DD",344.4,344.4,7.02,21,1,0)
This is the person who linked the ERA to the receipt.
"^DD",344.4,344.4,7.02,"DT")
3110328
"BLD",7678,6)
^250
**END**
**END**
