Released PRCA*4.5*284 SEQ #253
Extracted from mail message
**KIDS**:PRCA*4.5*284^

**INSTALL NAME**
PRCA*4.5*284
"BLD",7932,0)
PRCA*4.5*284^ACCOUNTS RECEIVABLE^0^3120315^y
"BLD",7932,1,0)
^^1^1^3120123^
"BLD",7932,1,1,0)
5010 EPAY ENHANCEMENTS
"BLD",7932,4,0)
^9.64PA^344^2
"BLD",7932,4,344,0)
344
"BLD",7932,4,344,2,0)
^9.641^344^1
"BLD",7932,4,344,2,344,0)
AR BATCH PAYMENT  (File-top level)
"BLD",7932,4,344,2,344,1,0)
^9.6411^.17^1
"BLD",7932,4,344,2,344,1,.17,0)
EFT RECORD
"BLD",7932,4,344,222)
y^n^p^^^^n^^n
"BLD",7932,4,344,224)

"BLD",7932,4,344.4,0)
344.4
"BLD",7932,4,344.4,2,0)
^9.641^344.4^1
"BLD",7932,4,344.4,2,344.4,0)
ELECTRONIC REMITTANCE ADVICE  (File-top level)
"BLD",7932,4,344.4,2,344.4,1,0)
^9.6411^.09^5
"BLD",7932,4,344.4,2,344.4,1,.09,0)
EFT MATCH STATUS
"BLD",7932,4,344.4,2,344.4,1,.14,0)
DETAIL POST STATUS
"BLD",7932,4,344.4,2,344.4,1,.16,0)
REMOVED BY
"BLD",7932,4,344.4,2,344.4,1,.17,0)
REMOVED DATE
"BLD",7932,4,344.4,2,344.4,1,.18,0)
REMOVE REASON
"BLD",7932,4,344.4,222)
y^n^p^^^^n^^n
"BLD",7932,4,344.4,224)

"BLD",7932,4,"APDD",344,344)

"BLD",7932,4,"APDD",344,344,.17)

"BLD",7932,4,"APDD",344.4,344.4)

"BLD",7932,4,"APDD",344.4,344.4,.09)

"BLD",7932,4,"APDD",344.4,344.4,.14)

"BLD",7932,4,"APDD",344.4,344.4,.16)

"BLD",7932,4,"APDD",344.4,344.4,.17)

"BLD",7932,4,"APDD",344.4,344.4,.18)

"BLD",7932,4,"B",344,344)

"BLD",7932,4,"B",344.4,344.4)

"BLD",7932,6.3)
35
"BLD",7932,"ABPKG")
n
"BLD",7932,"KRN",0)
^9.67PA^779.2^20
"BLD",7932,"KRN",.4,0)
.4
"BLD",7932,"KRN",.401,0)
.401
"BLD",7932,"KRN",.402,0)
.402
"BLD",7932,"KRN",.403,0)
.403
"BLD",7932,"KRN",.5,0)
.5
"BLD",7932,"KRN",.84,0)
.84
"BLD",7932,"KRN",3.6,0)
3.6
"BLD",7932,"KRN",3.8,0)
3.8
"BLD",7932,"KRN",9.2,0)
9.2
"BLD",7932,"KRN",9.8,0)
9.8
"BLD",7932,"KRN",9.8,"NM",0)
^9.68A^15^10
"BLD",7932,"KRN",9.8,"NM",4,0)
RCDPRTP1^^0^B33480590
"BLD",7932,"KRN",9.8,"NM",5,0)
PRCAAPR1^^0^B41639363
"BLD",7932,"KRN",9.8,"NM",6,0)
RCDPEAR1^^0^B125070101
"BLD",7932,"KRN",9.8,"NM",8,0)
RCDPEDAR^^0^B111611189
"BLD",7932,"KRN",9.8,"NM",9,0)
RCDPEAR2^^0^B61283482
"BLD",7932,"KRN",9.8,"NM",10,0)
RCDPEDA1^^0^B23249063
"BLD",7932,"KRN",9.8,"NM",12,0)
RCDPEM2^^0^B181574834
"BLD",7932,"KRN",9.8,"NM",13,0)
RCDPEM3^^0^B110558911
"BLD",7932,"KRN",9.8,"NM",14,0)
RCDPEM4^^0^B186253544
"BLD",7932,"KRN",9.8,"NM",15,0)
RCDPEM9^^0^B27056813
"BLD",7932,"KRN",9.8,"NM","B","PRCAAPR1",5)

"BLD",7932,"KRN",9.8,"NM","B","RCDPEAR1",6)

"BLD",7932,"KRN",9.8,"NM","B","RCDPEAR2",9)

"BLD",7932,"KRN",9.8,"NM","B","RCDPEDA1",10)

"BLD",7932,"KRN",9.8,"NM","B","RCDPEDAR",8)

"BLD",7932,"KRN",9.8,"NM","B","RCDPEM2",12)

"BLD",7932,"KRN",9.8,"NM","B","RCDPEM3",13)

"BLD",7932,"KRN",9.8,"NM","B","RCDPEM4",14)

"BLD",7932,"KRN",9.8,"NM","B","RCDPEM9",15)

"BLD",7932,"KRN",9.8,"NM","B","RCDPRTP1",4)

"BLD",7932,"KRN",19,0)
19
"BLD",7932,"KRN",19,"NM",0)
^9.68A^10^6
"BLD",7932,"KRN",19,"NM",5,0)
RCDPE EDI LOCKBOX MENU^^2
"BLD",7932,"KRN",19,"NM",6,0)
RCDPE EDI LOCKBOX REPORTS MENU^^2
"BLD",7932,"KRN",19,"NM",7,0)
RCDPE ERA RETURNED TO PAYER^^1^
"BLD",7932,"KRN",19,"NM",8,0)
RCDPE RETURNED ERA AUDIT^^1^
"BLD",7932,"KRN",19,"NM",9,0)
RCDPE REMOVE ERA FROM WORKLIST^^0
"BLD",7932,"KRN",19,"NM",10,0)
RCDPE REMOVED ERA AUDIT^^0
"BLD",7932,"KRN",19,"NM","B","RCDPE EDI LOCKBOX MENU",5)

"BLD",7932,"KRN",19,"NM","B","RCDPE EDI LOCKBOX REPORTS MENU",6)

"BLD",7932,"KRN",19,"NM","B","RCDPE ERA RETURNED TO PAYER",7)

"BLD",7932,"KRN",19,"NM","B","RCDPE REMOVE ERA FROM WORKLIST",9)

"BLD",7932,"KRN",19,"NM","B","RCDPE REMOVED ERA AUDIT",10)

"BLD",7932,"KRN",19,"NM","B","RCDPE RETURNED ERA AUDIT",8)

"BLD",7932,"KRN",19.1,0)
19.1
"BLD",7932,"KRN",101,0)
101
"BLD",7932,"KRN",409.61,0)
409.61
"BLD",7932,"KRN",771,0)
771
"BLD",7932,"KRN",779.2,0)
779.2
"BLD",7932,"KRN",870,0)
870
"BLD",7932,"KRN",8989.51,0)
8989.51
"BLD",7932,"KRN",8989.52,0)
8989.52
"BLD",7932,"KRN",8994,0)
8994
"BLD",7932,"KRN","B",.4,.4)

"BLD",7932,"KRN","B",.401,.401)

"BLD",7932,"KRN","B",.402,.402)

"BLD",7932,"KRN","B",.403,.403)

"BLD",7932,"KRN","B",.5,.5)

"BLD",7932,"KRN","B",.84,.84)

"BLD",7932,"KRN","B",3.6,3.6)

"BLD",7932,"KRN","B",3.8,3.8)

"BLD",7932,"KRN","B",9.2,9.2)

"BLD",7932,"KRN","B",9.8,9.8)

"BLD",7932,"KRN","B",19,19)

"BLD",7932,"KRN","B",19.1,19.1)

"BLD",7932,"KRN","B",101,101)

"BLD",7932,"KRN","B",409.61,409.61)

"BLD",7932,"KRN","B",771,771)

"BLD",7932,"KRN","B",779.2,779.2)

"BLD",7932,"KRN","B",870,870)

"BLD",7932,"KRN","B",8989.51,8989.51)

"BLD",7932,"KRN","B",8989.52,8989.52)

"BLD",7932,"KRN","B",8994,8994)

"BLD",7932,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",7932,"QUES",0)
^9.62^^
"BLD",7932,"REQB",0)
^9.611^1^1
"BLD",7932,"REQB",1,0)
PRCA*4.5*276^2
"BLD",7932,"REQB","B","PRCA*4.5*276",1)

"FIA",344)
AR BATCH PAYMENT
"FIA",344,0)
^RCY(344,
"FIA",344,0,0)
344I
"FIA",344,0,1)
y^n^p^^^^n^^n
"FIA",344,0,10)

"FIA",344,0,11)

"FIA",344,0,"RLRO")

"FIA",344,0,"VR")
4.5^PRCA
"FIA",344,344)
1
"FIA",344,344,.17)

"FIA",344.4)
ELECTRONIC REMITTANCE ADVICE
"FIA",344.4,0)
^RCY(344.4,
"FIA",344.4,0,0)
344.4I
"FIA",344.4,0,1)
y^n^p^^^^n^^n
"FIA",344.4,0,10)

"FIA",344.4,0,11)

"FIA",344.4,0,"RLRO")

"FIA",344.4,0,"VR")
4.5^PRCA
"FIA",344.4,344.4)
1
"FIA",344.4,344.4,.09)

"FIA",344.4,344.4,.14)

"FIA",344.4,344.4,.16)

"FIA",344.4,344.4,.17)

"FIA",344.4,344.4,.18)

"KRN",19,2927821,-1)
2^5
"KRN",19,2927821,0)
RCDPE EDI LOCKBOX MENU^EDI Lockbox^^M^66481^^^^^^^
"KRN",19,2927821,10,0)
^19.01IP^15^12
"KRN",19,2927821,10,7,0)
2927824^REP
"KRN",19,2927821,10,7,"^")
RCDPE EDI LOCKBOX REPORTS MENU
"KRN",19,2927821,10,13,0)
2928165^REM
"KRN",19,2927821,10,13,"^")
RCDPE REMOVE ERA FROM WORKLIST
"KRN",19,2927821,"U")
EDI LOCKBOX
"KRN",19,2927824,-1)
2^6
"KRN",19,2927824,0)
RCDPE EDI LOCKBOX REPORTS MENU^EDI Lockbox Reports Menu^^M^66481^^^^^^^
"KRN",19,2927824,10,0)
^19.01IP^12^11
"KRN",19,2927824,10,9,0)
2929254^REMR^
"KRN",19,2927824,10,9,"^")
RCDPE REMOVED ERA AUDIT
"KRN",19,2927824,"U")
EDI LOCKBOX REPORTS MENU
"KRN",19,2928165,-1)
0^9
"KRN",19,2928165,0)
RCDPE REMOVE ERA FROM WORKLIST^Remove ERA from Active Worklist^^R^^^^^^^^ACCOUNTS RECEIVABLE
"KRN",19,2928165,1,0)
^^7^7^3120125^
"KRN",19,2928165,1,1,0)
This option allows you to remove an ERA from the active worklist.
"KRN",19,2928165,1,2,0)
You may only select an ERA that is unmatched to paper check and that is 
"KRN",19,2928165,1,3,0)
UNPOSTED. Use this option only if a receipt number is not available; 
"KRN",19,2928165,1,4,0)
otherwise, use the 'Update an ERA posted using paper EOB' option.
"KRN",19,2928165,1,5,0)
This marks the POSTED status of the ERA as NOT POSTED-REMOVED
"KRN",19,2928165,1,6,0)
and the EFT MATCH STATUS to MATCHED. Option is locked with RCDPE MARK ERA 
"KRN",19,2928165,1,7,0)
key.
"KRN",19,2928165,25)
RETN^RCDPEM2
"KRN",19,2928165,"U")
REMOVE ERA FROM ACTIVE WORKLIS
"KRN",19,2929254,-1)
0^10
"KRN",19,2929254,0)
RCDPE REMOVED ERA AUDIT^Remove ERA from Active Worklist Audit Report^^R^^^^^^^^ACCOUNTS RECEIVABLE^^
"KRN",19,2929254,1,0)
^19.06^2^2^3120117^^
"KRN",19,2929254,1,1,0)
This report lists ERAs that have been removed from the active worklist.
"KRN",19,2929254,1,2,0)
It can be filtered by Station/Division and by date range.
"KRN",19,2929254,10.1)

"KRN",19,2929254,20)

"KRN",19,2929254,25)
EN^RCDPEM3
"KRN",19,2929254,"U")
REMOVE ERA FROM ACTIVE WORKLIS
"KRN",19,2929353,-1)
1^7
"KRN",19,2929353,0)
RCDPE ERA RETURNED TO PAYER
"KRN",19,2929354,-1)
1^8
"KRN",19,2929354,0)
RCDPE RETURNED ERA AUDIT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",158,-1)
1^1
"PKG",158,0)
ACCOUNTS RECEIVABLE^PRCA^FMS
"PKG",158,20,0)
^9.402P^1^1
"PKG",158,20,1,0)
2^^PRCAMRG
"PKG",158,20,1,1)

"PKG",158,20,"B",2,1)

"PKG",158,22,0)
^9.49I^1^1
"PKG",158,22,1,0)
4.5^2950320^2960423
"PKG",158,22,1,"PAH",1,0)
284^3120315
"PKG",158,22,1,"PAH",1,1,0)
^^1^1^3120315
"PKG",158,22,1,"PAH",1,1,1,0)
5010 EPAY ENHANCEMENTS
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","PRCAAPR1")
0^5^B41639363^B43589285
"RTN","PRCAAPR1",1,0)
PRCAAPR1 ;WASH-ISC@ALTOONA,PA/RGY - PATIENT ACCOUNT PROFILE ;2/12/97  11:48 AM
"RTN","PRCAAPR1",2,0)
 ;;4.5;Accounts Receivable;**34,45,108,143,141,206,192,218,276,275,284**;Mar 20, 1995;Build 35
"RTN","PRCAAPR1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCAAPR1",4,0)
HDR ;Head for Account profile
"RTN","PRCAAPR1",5,0)
 S X="",$P(X,"=",23)="" W @IOF,!,X,"   A c c o u n t   P r o f i l e   ",X
"RTN","PRCAAPR1",6,0)
HDR1 N DMC,IBRX,RSN,TOP4,TOP6,DPTFLG,ACCTNUM,RCCV
"RTN","PRCAAPR1",7,0)
 S IBRX=0,DPTFLG=0
"RTN","PRCAAPR1",8,0)
 ;
"RTN","PRCAAPR1",9,0)
 ;Display new 'Statement Account Number" (Patch 206)
"RTN","PRCAAPR1",10,0)
 I PRCADB["DPT(" S DPTFLG=1,ACCTNUM=$$ACCT(PRCADB)
"RTN","PRCAAPR1",11,0)
 ;
"RTN","PRCAAPR1",12,0)
 W !,$P(DEBT,"^",2) I DPTFLG!(PRCADB["VA(200,") S X=$S(PRCADB["DPT(":$P(^DPT(+PRCADB,0),"^",9),1:$P($G(^VA(200,+PRCADB,1)),"^",9)) W " (",$E(X,1,3),"-",$E(X,4,5),"-",$E(X,6,9),")"
"RTN","PRCAAPR1",13,0)
 W ?53,"Statement Day: ",$S($$PST^RCAMFN01(+DEBT)>0:$$PST^RCAMFN01(+DEBT),1:"N/A")
"RTN","PRCAAPR1",14,0)
 K Y S X("ADD")=$$DADD^RCAMADD(PRCADB)
"RTN","PRCAAPR1",15,0)
 ;
"RTN","PRCAAPR1",16,0)
 ;Display new 'Statement Account Number" (Patch 206)
"RTN","PRCAAPR1",17,0)
 I DPTFLG W !,"Statement Account #: ",ACCTNUM,?52,"Last Statement: "
"RTN","PRCAAPR1",18,0)
 E  W !?52,"Last Statement: "
"RTN","PRCAAPR1",19,0)
 ;
"RTN","PRCAAPR1",20,0)
 S Y=+$$LST^RCFN01(PRCADB,2)
"RTN","PRCAAPR1",21,0)
 I Y>0 S Y("CCPC")=$$FPS^RCCPCFN(+DEBT) S:Y("CCPC") Y=+$P(Y("CCPC"),"^")
"RTN","PRCAAPR1",22,0)
 W $S(Y=-1:"N/A",1:$$SLH^RCFN01(Y))
"RTN","PRCAAPR1",23,0)
 W !,$P(X("ADD"),"^")
"RTN","PRCAAPR1",24,0)
 W:+$G(Y("CCPC")) ?52,"Activity as of: ",$$SLH^RCFN01($$ASOF^RCCPCFN($P(Y("CCPC"),"^",2)))
"RTN","PRCAAPR1",25,0)
 W:$P(X("ADD"),"^",2)]"" !,$P(X("ADD"),"^",2) W:$P(X("ADD"),"^",3)]"" !,$P(X("ADD"),"^",3)
"RTN","PRCAAPR1",26,0)
 W ! W:$P(X("ADD"),"^",4)]"" $P(X("ADD"),"^",4),", ",$P(X("ADD"),"^",5),"  ",$S($P(X("ADD"),"^",6):$P(X("ADD"),"^",6),1:$P(X("ADD"),"^",8))
"RTN","PRCAAPR1",27,0)
 W ?55,"Amount Owed: ",?69,$J(+$G(^TMP("PRCAAPR",$J,"C")),9,2)
"RTN","PRCAAPR1",28,0)
 W !,"Phone #: ",$S($P(X("ADD"),"^",7)]"":$P(X("ADD"),"^",7),1:"N/A")
"RTN","PRCAAPR1",29,0)
 I PRCADB["DPT(" W ?51,"RX Copay Exempt: " S IBRX=$$RXST^IBARXEU(+PRCADB,DT) W $S($P(IBRX,U)=1:"YES",$P(IBRX,U)=0:"NO",1:"N/A")
"RTN","PRCAAPR1",30,0)
 I PRCADB["DPT(" W !?57,"CV Status: " S RCCV=$$CVEDT^DGCV(+PRCADB,DT) W $S($P(RCCV,U,3)>0:"YES",1:"NO") I $P(RCCV,U,2) W !?52,"CV Status Ends: ",$$SLH^RCFN01($P(RCCV,U,2))
"RTN","PRCAAPR1",31,0)
 ; *108 add exemption reason/dmc info
"RTN","PRCAAPR1",32,0)
 I IBRX>0,($P(IBRX,U)=1) S DIC="^IBE(354.2,",DIC(0)="M",X=+$P(IBRX,"^",3) D ^DIC I Y>0 W !,?54,"(",$P(Y,"^",2),")"
"RTN","PRCAAPR1",33,0)
 I $D(^RCD(340,"DMC",1,+DEBT)) S DMC=$G(^RCD(340,+DEBT,3)) D
"RTN","PRCAAPR1",34,0)
 .I $P(DMC,"^",2) W !,"** Account forwarded to DMC: ",$$SLH^RCFN01($P(DMC,"^",2)),?50,"Total DMC Amount: ",?69,$J($P(DMC,"^",5),9,2)
"RTN","PRCAAPR1",35,0)
 .I $P(DMC,"^",9)'="" W !,?49,"Lesser Amt to DMC: ",?69,$J($P(DMC,"^",9),9,2)
"RTN","PRCAAPR1",36,0)
 .Q
"RTN","PRCAAPR1",37,0)
 I $D(^RCD(340,"TOP",+DEBT)) S TOP4=$G(^RCD(340,+DEBT,4)),TOP6=$G(^(6)) D
"RTN","PRCAAPR1",38,0)
 .I +TOP6 W !,"** Account forwarded to TOP: ",$$SLH^RCFN01($P(TOP6,"^")),?45,"Total TOP Amount: ",?65,$J($P(TOP4,"^",3),13,2)
"RTN","PRCAAPR1",39,0)
 .I $P(TOP6,"^",6) W !,?45,"TOP HOLD DATE: ",$$SLH^RCFN01($P(TOP6,"^",6))
"RTN","PRCAAPR1",40,0)
 .Q
"RTN","PRCAAPR1",41,0)
 I $O(^RCD(340,+DEBT,2,0)) D
"RTN","PRCAAPR1",42,0)
 .S Y=0 F X=0:0 S X=$O(^RCD(340,+DEBT,2,X)) Q:'X  W:'Y ! W !,$G(^(X,0)) S Y=Y+1 W:Y=3&$O(^RCD(340,+DEBT,2,X)) "..." Q:Y=3
"RTN","PRCAAPR1",43,0)
 .Q
"RTN","PRCAAPR1",44,0)
 Q
"RTN","PRCAAPR1",45,0)
 ; PRCA*4.5*276 - moved headers right to add EOB indicator to bill #, adjusted at tag BLN accordingly
"RTN","PRCAAPR1",46,0)
 ; PRCA*4.5*275 - moved headers to line up with column changes
"RTN","PRCAAPR1",47,0)
HDR2 W !!,"#",?5,"Bill #",?20,"Est",?31,"Type",?43,"Paid",?52,"Prin",?58,"Int",?64,"Adm",?72,"Balance"
"RTN","PRCAAPR1",48,0)
 Q
"RTN","PRCAAPR1",49,0)
DIS ;Display bill line items
"RTN","PRCAAPR1",50,0)
 NEW STAT1
"RTN","PRCAAPR1",51,0)
 I '$O(^TMP("PRCAAPR",$J,"C",0)) S X="",$P(X,"*",22)="" W !!,X,"  NO ACCOUNT INFORMATION AVAILABLE  ",X G Q1
"RTN","PRCAAPR1",52,0)
 F STAT1=0:0 S STAT1=$O(^TMP("PRCAAPR",$J,"C",STAT1)) Q:'STAT1!$D(OUT)  D BHDR S BILL=0 F  S BILL=$O(^TMP("PRCAAPR",$J,"C",STAT1,BILL)) Q:BILL=""!$D(OUT)  D BLN
"RTN","PRCAAPR1",53,0)
 I '$D(OUT) D READ
"RTN","PRCAAPR1",54,0)
Q1 Q
"RTN","PRCAAPR1",55,0)
BHDR ;Display status line
"RTN","PRCAAPR1",56,0)
 S X=$S(+$P(^TMP("PRCAAPR",$J,"C",STAT1),"^",2)=99:"PAYMENTS",1:$P($G(^PRCA(430.3,+$O(^PRCA(430.3,"AC",+$P(^TMP("PRCAAPR",$J,"C",STAT1),"^",2),0)),0)),"^"))
"RTN","PRCAAPR1",57,0)
 S Y=" "_X_" ("_$J(+^TMP("PRCAAPR",$J,"C",STAT1),0,2)_") " W ! F X=1:1:80-$L(Y)/2 W "-"
"RTN","PRCAAPR1",58,0)
 W Y F X=1:1:IOM-$X-1 W "-"
"RTN","PRCAAPR1",59,0)
 Q
"RTN","PRCAAPR1",60,0)
BLN ;
"RTN","PRCAAPR1",61,0)
 N PRCOUT
"RTN","PRCAAPR1",62,0)
 I $Y+5>IOSL,COUNT D READ G:$D(OUT) Q2 D HDR,HDR2,BHDR
"RTN","PRCAAPR1",63,0)
 ; PRCA*4.5*276, attach EOB indicator '%' to bill # when applicable
"RTN","PRCAAPR1",64,0)
 S PRCOUT=$$COMP3^PRCAAPR(BILL)
"RTN","PRCAAPR1",65,0)
 I STAT1'=99,PRCOUT'="%" S PRCOUT=$$IBEEOBCK(BILL)
"RTN","PRCAAPR1",66,0)
 S:STAT1'=99 COUNT=COUNT+1,^TMP("PRCAAPR",$J,"O",COUNT)=BILL S X=$S(STAT1=99:BILL,1:$G(PRCOUT)_$G(^PRCA(430,BILL,0)))
"RTN","PRCAAPR1",67,0)
 W !,$S(STAT1'=99:COUNT,1:"*"),?4,$P(X,"^") W:STAT1'=99 ?20,$$SLH^RCFN01($P(X,"^",10))
"RTN","PRCAAPR1",68,0)
 W:STAT1'=99 ?31,$S($P(X,"^",2)=31:"TRIC PT",1:$E($P($G(^PRCA(430.2,$S($O(^PRCA(430.2,"AC",24,0))=$P(X,"^",2):+$P(X,"^",16),1:+$P(X,"^",2)),0)),"^"),1,7))  ; PRCA*4.5*192 changed CHMP PT to TRIC PT
"RTN","PRCAAPR1",69,0)
 W:STAT1=99 ?31,"PAYMENT"
"RTN","PRCAAPR1",70,0)
 S X=$S(STAT1=99:"^^^^^^"_^TMP("PRCAAPR",$J,"C",STAT1,BILL),1:$G(^PRCA(430,BILL,7))) W ?39 W:STAT1=99 "-" W $J($P(X,"^",7)+$P(X,"^",8)+$P(X,"^",9)+$P(X,"^",10)+$P(X,"^",11),8,2)
"RTN","PRCAAPR1",71,0)
 W ?48 W:STAT1=99 " " W:STAT1'=99 $S($P(^PRCA(430,BILL,0),"^",2)=$O(^PRCA(430.2,"AC",33,0)):"-",1:" ")
"RTN","PRCAAPR1",72,0)
 W $J($P(X,"^"),7,2),?57,$J($P(X,"^",2),5,2),?63,$J($P(X,"^",3),5,2),?69,$S(STAT1=99:"-",$P(^PRCA(430,BILL,0),"^",2)=$O(^PRCA(430.2,"AC",33,0)):"-",1:" ")
"RTN","PRCAAPR1",73,0)
 W $S(STAT1=99:$J(^TMP("PRCAAPR",$J,"C",STAT1,BILL),9,2),1:$J($P(X,"^")+$P(X,"^",2)+$P(X,"^",3)+$P(X,"^",4)+$P(X,"^",5),9,2))
"RTN","PRCAAPR1",74,0)
 K ^TMP("PRCAAPR",$J,"C",STAT1,BILL) K:$O(^TMP("PRCAAPR",$J,"C",STAT1,""))="" ^TMP("PRCAAPR",$J,"C",STAT1)
"RTN","PRCAAPR1",75,0)
Q2 Q
"RTN","PRCAAPR1",76,0)
READ ;Read bill number
"RTN","PRCAAPR1",77,0)
 W !!,"Select 1-",COUNT W:$O(^TMP("PRCAAPR",$J,"C","")) " or return to continue" R ": ",X:DTIME I X["^"!'$T S:'$T DTOUT=1 S OUT=1 G Q3
"RTN","PRCAAPR1",78,0)
 I X["?" W !!,"To see detailed information for a bill number, enter the corresponding '#'",!,"next to the bill.  (Ex: 1 or 1,3)" G READ
"RTN","PRCAAPR1",79,0)
 I X="",'$O(^TMP("PRCAAPR",$J,"C","")) S OUT=1 G Q3
"RTN","PRCAAPR1",80,0)
 G:X="" Q3 S SEL=X
"RTN","PRCAAPR1",81,0)
 F X=1:1:$L(SEL,",") S Y=$P(SEL,",",X) I Y'?1N.N!'$D(^TMP("PRCAAPR",$J,"O",+Y)) W *7," ??" G READ
"RTN","PRCAAPR1",82,0)
 S OUT=1 F X=1:1:$L(SEL,",") S Y=$P(SEL,",",X) D EN1^PRCAATR($G(^TMP("PRCAAPR",$J,"O",+Y)))
"RTN","PRCAAPR1",83,0)
Q3 Q
"RTN","PRCAAPR1",84,0)
 ;
"RTN","PRCAAPR1",85,0)
ACCT(DFN) ;Get account number. Join station with DFN (Patch 206)
"RTN","PRCAAPR1",86,0)
 N SITE,ACCT,ACCT1,LEN
"RTN","PRCAAPR1",87,0)
 S DFN=+DFN
"RTN","PRCAAPR1",88,0)
 S LEN=$L(DFN)-1
"RTN","PRCAAPR1",89,0)
 S SITE=$$SITE^RCMSITE                          ;station number
"RTN","PRCAAPR1",90,0)
 S ACCT=$$RJ^XLFSTR(DFN,13,0)                   ;add leading zeroes
"RTN","PRCAAPR1",91,0)
 S ACCT1=SITE_"-"_$E(ACCT,1,$L(ACCT)-$L(DFN))   ;add hyphen
"RTN","PRCAAPR1",92,0)
 S ACCT1=ACCT1_"-"_$E(ACCT,$L(ACCT)-LEN,99)     ;add hyphen
"RTN","PRCAAPR1",93,0)
 S ACCT1=ACCT1_"-"_$E($P($P(DEBT,U,2),","),1,5) ;add last name
"RTN","PRCAAPR1",94,0)
 Q ACCT1
"RTN","PRCAAPR1",95,0)
 ;
"RTN","PRCAAPR1",96,0)
 ; PRCA*4.5*276 -  Use Event Date to find an associated 3rd Party bill with an associated EEOB
"RTN","PRCAAPR1",97,0)
IBEEOBCK(PRCAAR) ; Passed AR Bill
"RTN","PRCAAPR1",98,0)
 ; Function will quit as soon as a 3rd party bill is located that has an associated EEOB
"RTN","PRCAAPR1",99,0)
 ;
"RTN","PRCAAPR1",100,0)
 ; Find 3rd Party Bills with an Event Date
"RTN","PRCAAPR1",101,0)
 N PRCAREF,PRCAEEOB,PRCADT,DFN,DBTR,X1
"RTN","PRCAAPR1",102,0)
 ; Get DFN
"RTN","PRCAAPR1",103,0)
 S DBTR=+$P($G(^PRCA(430,PRCAAR,0)),U,9)
"RTN","PRCAAPR1",104,0)
 S X1=$P($G(^RCD(340,DBTR,0)),U) I X1'["DPT" Q ""
"RTN","PRCAAPR1",105,0)
 S DFN=+X1
"RTN","PRCAAPR1",106,0)
 S PRCAEEOB=""
"RTN","PRCAAPR1",107,0)
 ; Loop through Xref of ARbill (#430) to Action file (#350)
"RTN","PRCAAPR1",108,0)
 I +$G(PRCAAR) S PRCAREF=0 F  S PRCAREF=$O(^IB("ABIL",$P($G(^PRCA(430,PRCAAR,0)),"^"),PRCAREF)) Q:'PRCAREF  D  Q:PRCAEEOB="%"
"RTN","PRCAAPR1",109,0)
 . S PRCADT=$P($G(^IB(PRCAREF,0)),"^",17) ;Get event Date
"RTN","PRCAAPR1",110,0)
 . I PRCADT S PRCAEEOB=$$TPEVDT(DFN,PRCADT) Q:PRCAEEOB="%"
"RTN","PRCAAPR1",111,0)
 . I PRCADT S PRCAEEOB=$$TPOPV(DFN,PRCADT)
"RTN","PRCAAPR1",112,0)
 ;
"RTN","PRCAAPR1",113,0)
 Q PRCAEEOB
"RTN","PRCAAPR1",114,0)
 ;
"RTN","PRCAAPR1",115,0)
 ; PRCA*4.5*276 - Traverse all THIRD PARTY bills for a patient with a specific Event Date (399,.03)
"RTN","PRCAAPR1",116,0)
TPEVDT(DFN,EVDT) ;
"RTN","PRCAAPR1",117,0)
 ; Function will quit as soon as a 3rd party bill is located that has an associated EEOB
"RTN","PRCAAPR1",118,0)
 ; PRCA*4.5*284 - Use the 399,"APDT" (by patient) index instead of the 399,"D" index for efficiency
"RTN","PRCAAPR1",119,0)
 I '$G(DFN)!'$G(EVDT) Q ""
"RTN","PRCAAPR1",120,0)
 N PRCAIFN,PRCAEEOB
"RTN","PRCAAPR1",121,0)
 S PRCAEEOB="",PRCAIFN=""
"RTN","PRCAAPR1",122,0)
 F  S PRCAIFN=$O(^DGCR(399,"APDT",DFN,PRCAIFN),-1) Q:'PRCAIFN  D  Q:PRCAEEOB="%"
"RTN","PRCAAPR1",123,0)
 . I $D(^DGCR(399,"APDT",DFN,PRCAIFN,9999999-EVDT)) S PRCAEEOB=$$COMP3^PRCAAPR(PRCAIFN)
"RTN","PRCAAPR1",124,0)
 Q PRCAEEOB
"RTN","PRCAAPR1",125,0)
 ;
"RTN","PRCAAPR1",126,0)
 ; PRCA*4.5*276 - Traverse all THIRD PARTY bills for a patient with any Opt Visit Dates same as Event Date (399,43)
"RTN","PRCAAPR1",127,0)
TPOPV(DFN,EVDT) ;
"RTN","PRCAAPR1",128,0)
 ; Function will quit as soon as a 3rd party bill is located that has an associated EEOB
"RTN","PRCAAPR1",129,0)
 N PRCAIFN,PRCAEEOB
"RTN","PRCAAPR1",130,0)
 S PRCAEEOB=""
"RTN","PRCAAPR1",131,0)
 I +$G(DFN),+$G(EVDT) S PRCAIFN=0 F  S PRCAIFN=$O(^DGCR(399,"AOPV",DFN,EVDT,PRCAIFN)) Q:'PRCAIFN  D  Q:PRCAEEOB="%"
"RTN","PRCAAPR1",132,0)
 . ; attach EOB indicator '%' to bill # when applicable
"RTN","PRCAAPR1",133,0)
 . S PRCAEEOB=$$COMP3^PRCAAPR(PRCAIFN)
"RTN","PRCAAPR1",134,0)
 Q PRCAEEOB
"RTN","RCDPEAR1")
0^6^B125070101^B109842855
"RTN","RCDPEAR1",1,0)
RCDPEAR1 ;ALB/TMK/PJH - ELECTRONIC ERA AGING REPORT - FILE 344.4 ;31-OCT-02
"RTN","RCDPEAR1",2,0)
 ;;4.5;Accounts Receivable;**173,269,276,284**;Mar 20, 1995;Build 35
"RTN","RCDPEAR1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEAR1",4,0)
 Q
"RTN","RCDPEAR1",5,0)
 ;
"RTN","RCDPEAR1",6,0)
EN1 ; Entry from option - run on the fly
"RTN","RCDPEAR1",7,0)
 N RCIND,RCDISPTY,RCEND,RCRANGE,RCNP,RCJOB,RCSTART,RCJOB1
"RTN","RCDPEAR1",8,0)
 N %ZIS,ZTSK,ZTSTOP,ZTDESC,ZTSAVE,ZTQUEUED,ZTRTN,POP,VAUTD,RCBAL,RCNP1
"RTN","RCDPEAR1",9,0)
 S RCIND=1
"RTN","RCDPEAR1",10,0)
 D DIVISION^VAUTOMA
"RTN","RCDPEAR1",11,0)
 I 'VAUTD&($D(VAUTD)'=11) G EN1Q
"RTN","RCDPEAR1",12,0)
 S RCRANGE=$$DTRNG^RCDPEM4()
"RTN","RCDPEAR1",13,0)
 I RCRANGE=0 G EN1Q
"RTN","RCDPEAR1",14,0)
 I $P(RCRANGE,U,1) S RCSTART=$P(RCRANGE,U,2),RCEND=$P(RCRANGE,U,3)
"RTN","RCDPEAR1",15,0)
 ;Get insurance company to be used as filter
"RTN","RCDPEAR1",16,0)
 ; PRCA*4.5*284 - RCDPEM9 now return a stack in RCNP (Type of Response(1=Range,2=All,3=Specific)^From Range^Thru Range)
"RTN","RCDPEAR1",17,0)
 S RCNP=$$GETPAY^RCDPEM9(344.4)
"RTN","RCDPEAR1",18,0)
 I +RCNP=-1 G EN1Q
"RTN","RCDPEAR1",19,0)
 ; Get Zero Balance Filter
"RTN","RCDPEAR1",20,0)
 S RCBAL=$$RCBAL() I RCBAL=-1 G EN1Q
"RTN","RCDPEAR1",21,0)
 S RCDISPTY=$$DISPTY^RCDPEM3() I RCDISPTY=-1 G EN1Q
"RTN","RCDPEAR1",22,0)
 I RCDISPTY D INFO^RCDPEM6
"RTN","RCDPEAR1",23,0)
 S:$D(VAUTD)=11&(VAUTD'=1) RCIND=RCIND+1
"RTN","RCDPEAR1",24,0)
 S:$P($G(RCRANGE),U)>0 RCIND=RCIND+3
"RTN","RCDPEAR1",25,0)
 S:$D(^TMP("RCSELPAY",$J))&(+RCNP=1) RCIND=RCIND+5
"RTN","RCDPEAR1",26,0)
 I $D(DUOUT)!$D(DTOUT) G EN1Q
"RTN","RCDPEAR1",27,0)
 S RCJOB=$J
"RTN","RCDPEAR1",28,0)
 ; Ask device
"RTN","RCDPEAR1",29,0)
 S %ZIS="QM" D ^%ZIS G:POP EN1Q
"RTN","RCDPEAR1",30,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPEAR1",31,0)
 .S ZTRTN="RPTOUT^RCDPEAR1",ZTDESC="AR - EDI LOCKBOX ERA AGING REPORT"
"RTN","RCDPEAR1",32,0)
 .S ZTSAVE("*")=""
"RTN","RCDPEAR1",33,0)
 .; PRCA*4.5*284 - Because TMP global may be on another server, save off specific payers in local
"RTN","RCDPEAR1",34,0)
 .I +RCNP=3 M RCNP1=^TMP("RCSELPAY",$J)
"RTN","RCDPEAR1",35,0)
 .D ^%ZTLOAD
"RTN","RCDPEAR1",36,0)
 .W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this $J.")
"RTN","RCDPEAR1",37,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEAR1",38,0)
 U IO
"RTN","RCDPEAR1",39,0)
 D RPTOUT
"RTN","RCDPEAR1",40,0)
EN1Q K ^TMP("RCSELPAY",$J),^TMP("RCPAYER",$J)
"RTN","RCDPEAR1",41,0)
 Q
"RTN","RCDPEAR1",42,0)
 ;
"RTN","RCDPEAR1",43,0)
RPTOUT(RCPRT) ; Entrypoint for queued job, nightly job
"RTN","RCDPEAR1",44,0)
 ; RCPRT = name of the subscript for ^TMP to use to return all lines
"RTN","RCDPEAR1",45,0)
 ;        (for bulletin).  If undefined or null, output is printed
"RTN","RCDPEAR1",46,0)
 ; Return global if RCPRT not null: ^TMP($J,RCPRT,line#)=line text
"RTN","RCDPEAR1",47,0)
 N ERAIEN,RCCT,RCPG,RCSTOP,RCNT,RCDATA,RCOUT,RCEDT,RC0,RC7,RCZ,RCZ0,RCZ1,RC00,RCTOT,Z,Z0,RCPAY
"RTN","RCDPEAR1",48,0)
 N STA,STNUM,STNAM
"RTN","RCDPEAR1",49,0)
 S RCPRT=$G(RCPRT),(RCCT,RCSTOP,RCPG,RCNT,RCTOT)=0
"RTN","RCDPEAR1",50,0)
 K ^TMP($J,"RCERA_AGED"),^TMP($J,"RCERA_ADJ")
"RTN","RCDPEAR1",51,0)
 ; PRCA*4.5*284 - Queued job needs to reload payer selection list
"RTN","RCDPEAR1",52,0)
 I $G(RCJOB)'="",RCJOB'=$J D
"RTN","RCDPEAR1",53,0)
 . K ^TMP("RCSELPAY",$J)
"RTN","RCDPEAR1",54,0)
 . D RLOAD(344.4)
"RTN","RCDPEAR1",55,0)
 . S RCJOB=$J
"RTN","RCDPEAR1",56,0)
 S RCNP=+RCNP
"RTN","RCDPEAR1",57,0)
 I RCPRT'="" K ^TMP($J,RCPRT)
"RTN","RCDPEAR1",58,0)
 S RCZ0=0 F  S RCZ0=$O(^RCY(344.4,"AMATCH",0,RCZ0)) Q:'RCZ0  D
"RTN","RCDPEAR1",59,0)
 .S RC7=$P($G(^RCY(344.4,RCZ0,0)),U,7)\1  ; era file date/time
"RTN","RCDPEAR1",60,0)
 .; Check Station/Division
"RTN","RCDPEAR1",61,0)
 .;I '$$CHKDIV^RCDPEDAR(RCZ0,1,.VAUTD) Q
"RTN","RCDPEAR1",62,0)
 . I 'VAUTD D ERASTA^RCDPEM4(RCZ0,.STA,.STNUM,.STNAM) I '$D(VAUTD(STA)) Q
"RTN","RCDPEAR1",63,0)
 .; Check for payer match
"RTN","RCDPEAR1",64,0)
 .I '$$CHKPYR^RCDPEDAR(RCZ0,1,RCJOB) Q
"RTN","RCDPEAR1",65,0)
 .; Check date range
"RTN","RCDPEAR1",66,0)
 .I $P(RCRANGE,U,1) D  Q:'ERAIEN
"RTN","RCDPEAR1",67,0)
 ..S ERAIEN=$P($G(^RCY(344.4,RCZ0,0)),U,7)\1
"RTN","RCDPEAR1",68,0)
 .I $P(RCRANGE,U,1) Q:(RCSTART>RC7)!(RC7>RCEND)
"RTN","RCDPEAR1",69,0)
 .; Check for Zero Bal
"RTN","RCDPEAR1",70,0)
 . I 'RCBAL,'+$P($G(^RCY(344.4,RCZ0,0)),U,5) Q
"RTN","RCDPEAR1",71,0)
 .;  - include on report
"RTN","RCDPEAR1",72,0)
 .S ^TMP($J,"RCERA_AGED",$$FMDIFF^XLFDT(RC7,DT),RCZ0)=0,RCNT=RCNT+1
"RTN","RCDPEAR1",73,0)
 ;
"RTN","RCDPEAR1",74,0)
 ; build local payer array here
"RTN","RCDPEAR1",75,0)
 D SELPAY(RCNP,RCJOB,.RCPAY)
"RTN","RCDPEAR1",76,0)
 ; Calculate total amount for ERA
"RTN","RCDPEAR1",77,0)
 ;
"RTN","RCDPEAR1",78,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCERA_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCERA_AGED",RCZ,RCZ0)) Q:'RCZ0  D
"RTN","RCDPEAR1",79,0)
 .S RC0=$G(^RCY(344.4,RCZ0,0)),RCTOT=RCTOT+$P(RC0,U,5)
"RTN","RCDPEAR1",80,0)
 I RCDISPTY  D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.VAUTD,.RCPAY),EXCEL Q  ; prca 276  
"RTN","RCDPEAR1",81,0)
 ;
"RTN","RCDPEAR1",82,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCERA_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCERA_AGED",RCZ,RCZ0)) Q:'RCZ0  D  G:RCSTOP PRTQ
"RTN","RCDPEAR1",83,0)
 .I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W:RCPRT="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR1",84,0)
 .I RCPG D SETLINE(" ",.RCCT,.RCPRT) ; On detail list, skip line
"RTN","RCDPEAR1",85,0)
 .I 'RCPG!(($Y+5)>IOSL) D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.VAUTD,.RCPAY) Q:RCSTOP
"RTN","RCDPEAR1",86,0)
 .S RC0=$G(^RCY(344.4,RCZ0,0)),RCTOT=RCTOT+$P(RC0,U,5)
"RTN","RCDPEAR1",87,0)
 .S Z=$$SETSTR^VALM1($J(-RCZ,4),"",1,4)
"RTN","RCDPEAR1",88,0)
 .S Z=$$SETSTR^VALM1("  "_$P(RC0,U,2),Z,5,50)
"RTN","RCDPEAR1",89,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",90,0)
 .S Z=$$SETSTR^VALM1($P(RC0,U,6)_"/"_$P(RC0,U,3),"",11,69)
"RTN","RCDPEAR1",91,0)
 .S Z=$$SETSTR^VALM1("  "_$$FMTE^XLFDT($P(RC0,U,4),2),Z,70,10)
"RTN","RCDPEAR1",92,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",93,0)
 .S Z=$$SETSTR^VALM1($J("",16)_$S($P(RC0,U,7):$$FMTE^XLFDT($P(RC0,U,7)\1,2),1:""),"",1,25)
"RTN","RCDPEAR1",94,0)
 .S Z=$$SETSTR^VALM1("  "_$J($P(RC0,U,5),15,2),Z,26,17)
"RTN","RCDPEAR1",95,0)
 .S Z=$$SETSTR^VALM1("  "_+$P(RC0,U,11),Z,43,11)
"RTN","RCDPEAR1",96,0)
 .S Z=$$SETSTR^VALM1("  "_$P(RC0,U),Z_$S('$$HACERA^RCDPEU(RCZ0):"",1:" (HAC ERA)"),54,26)
"RTN","RCDPEAR1",97,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",98,0)
 .I "23"[$$ADJ^RCDPEU(RCZ0) D SETLINE($J("",9)_"** CLAIM LEVEL ADJUSTMENTS EXIST FOR THIS ERA ***",.RCCT,RCPRT)
"RTN","RCDPEAR1",99,0)
 .I $O(^RCY(344.4,RCZ0,2,0)) D  ; ERA level adjustments exist
"RTN","RCDPEAR1",100,0)
 ..N Q
"RTN","RCDPEAR1",101,0)
 ..D DISPADJ^RCDPESR8(RCZ0,"^TMP("_$J_",""RCERA_ADJ"")")
"RTN","RCDPEAR1",102,0)
 ..I $O(^TMP($J,"RCERA_ADJ",0)) D SETLINE($J("",9)_"** GENERAL ADJUSTMENT DATA EXISTS FOR ERA **",.RCCT,RCPRT)
"RTN","RCDPEAR1",103,0)
 ..S Q=0 F  S Q=$O(^TMP($J,"RCERA_ADJ",Q)) Q:'Q  D SETLINE($J("",9)_$G(^TMP($J,"RCERA_ADJ",Q)),.RCCT,RCPRT)
"RTN","RCDPEAR1",104,0)
 .;
"RTN","RCDPEAR1",105,0)
 .S RCZ1=0 F  S RCZ1=$O(^RCY(344.4,RCZ0,1,RCZ1)) Q:'RCZ1  S RC00=$G(^(RCZ1,0)) D  Q:RCSTOP
"RTN","RCDPEAR1",106,0)
 ..N D
"RTN","RCDPEAR1",107,0)
 ..K RCDATA,RCOUT
"RTN","RCDPEAR1",108,0)
 ..I ($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.VAUTD,.RCPAY) Q:RCSTOP
"RTN","RCDPEAR1",109,0)
 ..S D=$J("",7)_" EEOB Seq #: "_$P(RC00,U)_$S($D(^RCY(344.4,RCZ0,1,"ATB",1,RCZ1)):" (REVERSAL)",1:"")_"  EEOB "
"RTN","RCDPEAR1",110,0)
 ..S D=D_$S('$P(RC00,U,2):"not on file",1:"on file for "_$P($G(^DGCR(399,+$G(^IBM(361.1,+$P(RC00,U,2),0)),0)),U))_"  "_$J(+$P(RC00,U,3),"",2)
"RTN","RCDPEAR1",111,0)
 ..D SETLINE(D,.RCCT,RCPRT)
"RTN","RCDPEAR1",112,0)
 ..Q:$P(RC00,U,2)
"RTN","RCDPEAR1",113,0)
 ..D DISP^RCDPESR0("^RCY(344.4,"_RCZ0_",1,"_RCZ1_",1)","RCDATA",1,"RCOUT",68,1)
"RTN","RCDPEAR1",114,0)
 ..I '$O(RCOUT(0)) D SETLINE($J("",9)_" NO DETAIL FOUND",.RCCT,RCPRT) Q
"RTN","RCDPEAR1",115,0)
 ..S Z=0 F  S Z=$O(RCOUT(Z)) Q:'Z  D  Q:RCSTOP
"RTN","RCDPEAR1",116,0)
 ... I ($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.VAUTD,.RCPAY) Q:RCSTOP
"RTN","RCDPEAR1",117,0)
 ... D SETLINE($J("",9)_"*"_RCOUT(Z),.RCCT,RCPRT)
"RTN","RCDPEAR1",118,0)
 ;
"RTN","RCDPEAR1",119,0)
 F Z0=1:1:2 D SETLINE(" ",.RCCT,RCPRT)
"RTN","RCDPEAR1",120,0)
 I ($Y+7)>IOSL!'RCPG D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.VAUTD,.RCPAY)
"RTN","RCDPEAR1",121,0)
 ;
"RTN","RCDPEAR1",122,0)
 W !,"******** END OF REPORT ********",!
"RTN","RCDPEAR1",123,0)
PRTQ I '$D(ZTQUEUED),'RCSTOP,RCPG,RCPRT="" D ASK()
"RTN","RCDPEAR1",124,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAR1",125,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAR1",126,0)
 K ^TMP($J,"RCERA_AGED"),^TMP("RCSELPAY",$J)
"RTN","RCDPEAR1",127,0)
 Q
"RTN","RCDPEAR1",128,0)
 ;
"RTN","RCDPEAR1",129,0)
HDR(RCCT,RCPG,RCSTOP,RCPRT,RCRANGE,VAUTD,RCPAY) ;Prints report heading
"RTN","RCDPEAR1",130,0)
 ; Function returns RCPG = current page # and RCCT = running line count
"RTN","RCDPEAR1",131,0)
 ;   and RCSTOP = 1 if user aborted print 
"RTN","RCDPEAR1",132,0)
 ; Parameters must be passed by reference
"RTN","RCDPEAR1",133,0)
 ; RCPRT = name of the subscript for ^TMP to use to return all lines
"RTN","RCDPEAR1",134,0)
 ;        (for bulletin).  If undefined or null, output is printed
"RTN","RCDPEAR1",135,0)
 ; RCRANGE - date range filter value to be printed as part of the header
"RTN","RCDPEAR1",136,0)
 ; VAUTD (required/pass-by-ref) - Division filter value(s)
"RTN","RCDPEAR1",137,0)
 ; RCPAY (required/pass-by-ref) - Payer filter value(s)
"RTN","RCDPEAR1",138,0)
 ;
"RTN","RCDPEAR1",139,0)
 N Z,Z0,START,END,SUB,%,CNT
"RTN","RCDPEAR1",140,0)
 Q:$G(RCSTOP)
"RTN","RCDPEAR1",141,0)
 I RCPG!($E(IOST,1,2)="C-") D  Q:$G(RCSTOP)
"RTN","RCDPEAR1",142,0)
 .I RCPG&($E(IOST,1,2)="C-")&(RCPRT="") D ASK(.RCSTOP) Q:RCSTOP
"RTN","RCDPEAR1",143,0)
 .I RCPRT="" W @IOF,*13 Q  ; Write form feed for report
"RTN","RCDPEAR1",144,0)
 S RCPG=RCPG+1,Z0="ERA UNMATCHED AGING REPORT"
"RTN","RCDPEAR1",145,0)
 S Z=$$SETSTR^VALM1($J("",80-$L(Z0)\2)_Z0,"",1,79)
"RTN","RCDPEAR1",146,0)
 S:'RCDISPTY Z=$$SETSTR^VALM1("Page: "_RCPG,Z,64,17)
"RTN","RCDPEAR1",147,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",148,0)
 D NOW^%DTC
"RTN","RCDPEAR1",149,0)
 S Z="RUN DATE/TIME: "_$$FMTE^XLFDT(%,2),Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",150,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",151,0)
 S END=$P(RCRANGE,U,3)
"RTN","RCDPEAR1",152,0)
 ; divisions
"RTN","RCDPEAR1",153,0)
 S Z="DIVISIONS: "
"RTN","RCDPEAR1",154,0)
 I $D(VAUTD)=1 D
"RTN","RCDPEAR1",155,0)
 .S Z=Z_"ALL",Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",156,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",157,0)
 .S Z=""
"RTN","RCDPEAR1",158,0)
 I $D(VAUTD)>1,'VAUTD D
"RTN","RCDPEAR1",159,0)
 .S SUB=VAUTD
"RTN","RCDPEAR1",160,0)
 .F  S SUB=$O(VAUTD(SUB)) Q:'SUB  D
"RTN","RCDPEAR1",161,0)
 ..I Z="DIVISIONS: " S Z=Z_VAUTD(SUB) Q
"RTN","RCDPEAR1",162,0)
 ..S Z=Z_$S(Z]"":",",1:"")_VAUTD(SUB)
"RTN","RCDPEAR1",163,0)
 ..I $L(Z)>50 D
"RTN","RCDPEAR1",164,0)
 ...S Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",165,0)
 ...D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",166,0)
 ...S Z=""
"RTN","RCDPEAR1",167,0)
 I Z]"" D
"RTN","RCDPEAR1",168,0)
 .S Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",169,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",170,0)
 ;
"RTN","RCDPEAR1",171,0)
 ; Payers
"RTN","RCDPEAR1",172,0)
 S Z="PAYERS: "
"RTN","RCDPEAR1",173,0)
 I $D(RCPAY)=1 S Z=Z_RCPAY
"RTN","RCDPEAR1",174,0)
 I $D(RCPAY)=10 D
"RTN","RCDPEAR1",175,0)
 .S CNT=0
"RTN","RCDPEAR1",176,0)
 .F  S CNT=$O(RCPAY(CNT)) Q:'CNT  D
"RTN","RCDPEAR1",177,0)
 ..I Z="PAYERS: " S Z=Z_RCPAY(CNT) Q
"RTN","RCDPEAR1",178,0)
 ..S Z=Z_$S(Z]"":",",1:"")_RCPAY(CNT)
"RTN","RCDPEAR1",179,0)
 ..I $L(Z)>50 D
"RTN","RCDPEAR1",180,0)
 ...S Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",181,0)
 ...D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",182,0)
 ...S Z=""
"RTN","RCDPEAR1",183,0)
 I Z]"" D
"RTN","RCDPEAR1",184,0)
 .S Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",185,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",186,0)
 S START=$P(RCRANGE,U,2)
"RTN","RCDPEAR1",187,0)
 S Z="DATE RANGE: "_$P($$FMTE^XLFDT(START,2),"@")_" - "_$P($$FMTE^XLFDT(END,2),"@")_" (ERA FILE DATE)",Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR1",188,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",189,0)
 Q:RCDISPTY  ; prca 276 - do not print column headers for excel format
"RTN","RCDPEAR1",190,0)
 D SETLINE(" ",.RCCT,RCPRT)
"RTN","RCDPEAR1",191,0)
 D SETLINE("AGED",.RCCT,RCPRT)
"RTN","RCDPEAR1",192,0)
 S Z=$$SETSTR^VALM1("DAYS"_$J("",2)_"TRACE #","",1,79)
"RTN","RCDPEAR1",193,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",194,0)
 S Z=$$SETSTR^VALM1($J("",10)_"PAYMENT FROM/ID"_$J("",46)_"ERA DATE","",1,79)
"RTN","RCDPEAR1",195,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",196,0)
 S Z=$$SETSTR^VALM1($J("",16)_"FILE DATE"_$J("",6)_"AMOUNT PAID"_$J("",2)_"EEOB CNT "_$J("",2)_"ERA #",Z,1,79)
"RTN","RCDPEAR1",197,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",198,0)
 D SETLINE($TR($J("",IOM-1)," ","="),.RCCT,RCPRT)
"RTN","RCDPEAR1",199,0)
 I RCPG=1 D
"RTN","RCDPEAR1",200,0)
 .D SETLINE("TOTALS:",.RCCT,RCPRT)
"RTN","RCDPEAR1",201,0)
 .S Z=$$SETSTR^VALM1(" NUMBER AGED ELECTRONIC ERA MESSAGES FOUND: "_RCNT,"",1,79)
"RTN","RCDPEAR1",202,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",203,0)
 .S Z=$$SETSTR^VALM1(" AMOUNT AGED ELECTRONIC ERA MESSAGES FOUND: $"_$FN(+RCTOT,",",2),"",1,79)
"RTN","RCDPEAR1",204,0)
 .D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR1",205,0)
 .D SETLINE($TR($J("",IOM-1)," ","="),.RCCT,RCPRT)
"RTN","RCDPEAR1",206,0)
 Q
"RTN","RCDPEAR1",207,0)
 ;
"RTN","RCDPEAR1",208,0)
EXCEL ; Print report to screen, one record per line for export to MS Excel.
"RTN","RCDPEAR1",209,0)
 N RCLFLG,RCZ,RCZ0,RC00,Z,D,RCZ1,RZ,RZ1
"RTN","RCDPEAR1",210,0)
 W !!,"Aged Days^Trace #^Payment From/ID^ERA Date^File Date^Amount Paid^EEOB Cnt^ERA #^EEOB Detail"
"RTN","RCDPEAR1",211,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCERA_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCERA_AGED",RCZ,RCZ0)) Q:'RCZ0  D  G:RCSTOP PRTQ2
"RTN","RCDPEAR1",212,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W:RCPRT="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR1",213,0)
 . S RC0=$G(^RCY(344.4,RCZ0,0))
"RTN","RCDPEAR1",214,0)
 . S Z=$J(-RCZ,4)_U_$P(RC0,U,2)_U_$P(RC0,U,6)_"/"_$P(RC0,U,3)_U_$$FMTE^XLFDT($P(RC0,U,4),2)_U_$$FMTE^XLFDT($P(RC0,U,7),2)_U
"RTN","RCDPEAR1",215,0)
 . S Z=Z_$P(RC0,U,5)_U_$P(RC0,U,11)_U_$P(RC0,U)
"RTN","RCDPEAR1",216,0)
 . W !,Z
"RTN","RCDPEAR1",217,0)
 . S RZ=Z,RZ1=0
"RTN","RCDPEAR1",218,0)
 . K Z
"RTN","RCDPEAR1",219,0)
 .;;;
"RTN","RCDPEAR1",220,0)
 . I "23"[$$ADJ^RCDPEU(RCZ0) D EXCEL1 W "^** CLAIM LEVEL ADJUSTMENTS EXIST FOR THIS ERA ***"
"RTN","RCDPEAR1",221,0)
 . I $O(^RCY(344.4,RCZ0,2,0)) D  ; ERA level adjustments exist
"RTN","RCDPEAR1",222,0)
 . . N Q
"RTN","RCDPEAR1",223,0)
 . . D DISPADJ^RCDPESR8(RCZ0,"^TMP("_$J_",""RCERA_ADJ"")")
"RTN","RCDPEAR1",224,0)
 . . I $O(^TMP($J,"RCERA_ADJ",0)) D EXCEL1 W "^** GENERAL ADJUSTMENT DATA EXISTS FOR ERA **"
"RTN","RCDPEAR1",225,0)
 . . S Q=0 F  S Q=$O(^TMP($J,"RCERA_ADJ",Q)) Q:'Q  D EXCEL1 W "^"_$G(^TMP($J,"RCERA_ADJ",Q))
"RTN","RCDPEAR1",226,0)
 .;
"RTN","RCDPEAR1",227,0)
 . S RCZ1=0 F  S RCZ1=$O(^RCY(344.4,RCZ0,1,RCZ1)) Q:'RCZ1  S RC00=$G(^(RCZ1,0)) D  Q:RCSTOP
"RTN","RCDPEAR1",228,0)
 . . N D
"RTN","RCDPEAR1",229,0)
 . . K RCDATA,RCOUT
"RTN","RCDPEAR1",230,0)
 . . S D=" EEOB Seq #: "_$P(RC00,U)_$S($D(^RCY(344.4,RCZ0,1,"ATB",1,RCZ1)):" (REVERSAL)",1:"")_"  EEOB "
"RTN","RCDPEAR1",231,0)
 . . S D=D_$S('$P(RC00,U,2):"not on file",1:"on file for "_$P($G(^DGCR(399,+$G(^IBM(361.1,+$P(RC00,U,2),0)),0)),U))_"  "_$J(+$P(RC00,U,3),"",2)
"RTN","RCDPEAR1",232,0)
 . . D EXCEL1 W "^",D
"RTN","RCDPEAR1",233,0)
 . . Q:$P(RC00,U,2)
"RTN","RCDPEAR1",234,0)
 . . D DISP^RCDPESR0("^RCY(344.4,"_RCZ0_",1,"_RCZ1_",1)","RCDATA",1,"RCOUT",68,1)
"RTN","RCDPEAR1",235,0)
 . . I '$O(RCOUT(0)) D EXCEL1 W "^NO DETAIL FOUND" Q
"RTN","RCDPEAR1",236,0)
 . . S Z=0 F  S Z=$O(RCOUT(Z)) Q:'Z  D  Q:RCSTOP
"RTN","RCDPEAR1",237,0)
 . . . D EXCEL1 W "^*"_RCOUT(Z)
"RTN","RCDPEAR1",238,0)
 W !,"******** END OF REPORT ********",!
"RTN","RCDPEAR1",239,0)
 Q
"RTN","RCDPEAR1",240,0)
 ;
"RTN","RCDPEAR1",241,0)
EXCEL1 ; Display repeat info line before each EEOB detail section.
"RTN","RCDPEAR1",242,0)
 ; First detail line does not need it
"RTN","RCDPEAR1",243,0)
 I RZ1 W !,RZ Q
"RTN","RCDPEAR1",244,0)
 S RZ1=1 Q
"RTN","RCDPEAR1",245,0)
 ;
"RTN","RCDPEAR1",246,0)
PRTQ2 I '$D(ZTQUEUED),'RCSTOP,RCPG,RCPRT="" D ASK()
"RTN","RCDPEAR1",247,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAR1",248,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAR1",249,0)
 K ^TMP($J,"RCEFT_AGED")
"RTN","RCDPEAR1",250,0)
 Q
"RTN","RCDPEAR1",251,0)
 ;
"RTN","RCDPEAR1",252,0)
TEXT ; Filtered by messages
"RTN","RCDPEAR1",253,0)
 ;;No Filters Applied
"RTN","RCDPEAR1",254,0)
 ;;Station/Division
"RTN","RCDPEAR1",255,0)
 ;;
"RTN","RCDPEAR1",256,0)
 ;;Date Range
"RTN","RCDPEAR1",257,0)
 ;;Station/Division, Date Range
"RTN","RCDPEAR1",258,0)
 ;;Payer
"RTN","RCDPEAR1",259,0)
 ;;Station/Division, Payer
"RTN","RCDPEAR1",260,0)
 ;;
"RTN","RCDPEAR1",261,0)
 ;;Date Range, Payer
"RTN","RCDPEAR1",262,0)
 ;;Station/Division, Date Range, Payer
"RTN","RCDPEAR1",263,0)
 Q
"RTN","RCDPEAR1",264,0)
 ;
"RTN","RCDPEAR1",265,0)
SETLINE(Z,RCCT,RCPRT) ; Sets line into print global or writes line
"RTN","RCDPEAR1",266,0)
 ; Z = txt to output
"RTN","RCDPEAR1",267,0)
 ; RCCT = if defined = line counter
"RTN","RCDPEAR1",268,0)
 ; RCPRT = if defined = flag if 1, indicates output to global, no writes 
"RTN","RCDPEAR1",269,0)
 I $G(RCPRT)="" W !,Z Q
"RTN","RCDPEAR1",270,0)
 S RCCT=RCCT+1
"RTN","RCDPEAR1",271,0)
 S ^TMP($J,RCPRT,RCCT)=Z
"RTN","RCDPEAR1",272,0)
 Q
"RTN","RCDPEAR1",273,0)
 ;
"RTN","RCDPEAR1",274,0)
ASK(RCSTOP) ; Ask to continue
"RTN","RCDPEAR1",275,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEAR1",276,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEAR1",277,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEAR1",278,0)
 S DIR(0)="E" W ! D ^DIR K DIR
"RTN","RCDPEAR1",279,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEAR1",280,0)
 Q
"RTN","RCDPEAR1",281,0)
 ;
"RTN","RCDPEAR1",282,0)
SELPAY(RCNP,RCJOB,RCPAY) ;localize the payer filters for header display
"RTN","RCDPEAR1",283,0)
 ; Input:
"RTN","RCDPEAR1",284,0)
 ;   RCNP (pass-by-val/required) - payer filter response indicator (2=ALL, 3=SPECIFIC)
"RTN","RCDPEAR1",285,0)
 ;   RCJOB - job number to access the populated temporary global array in case report was tasked to run
"RTN","RCDPEAR1",286,0)
 ; Output:
"RTN","RCDPEAR1",287,0)
 ;   RCPAY (pass-by-ref/required) - local array of payers e.g. RCPAY="ALL", RCPAY(1)="Aetna",
"RTN","RCDPEAR1",288,0)
 ;                                  or RCPAY="start payer = end payer"
"RTN","RCDPEAR1",289,0)
 ;
"RTN","RCDPEAR1",290,0)
 N CNT,I
"RTN","RCDPEAR1",291,0)
 I RCNP=2 S RCPAY="ALL" Q
"RTN","RCDPEAR1",292,0)
 S:RCJOB="" RCJOB=$J   ; RCJOB should not be null
"RTN","RCDPEAR1",293,0)
 I RCNP=3 D  Q
"RTN","RCDPEAR1",294,0)
 .S CNT=0
"RTN","RCDPEAR1",295,0)
 .F  S CNT=$O(^TMP("RCSELPAY",RCJOB,CNT)) Q:'CNT  D
"RTN","RCDPEAR1",296,0)
 ..S RCPAY(CNT)=^TMP("RCSELPAY",RCJOB,CNT)
"RTN","RCDPEAR1",297,0)
 ;RCNP indicates a range of payers
"RTN","RCDPEAR1",298,0)
 S I=$O(^TMP("RCSELPAY",RCJOB,"")),RCPAY=^(I)_" - "
"RTN","RCDPEAR1",299,0)
 S I=$O(^TMP("RCSELPAY",RCJOB,""),-1),RCPAY=RCPAY_^(I)
"RTN","RCDPEAR1",300,0)
 Q
"RTN","RCDPEAR1",301,0)
RCBAL() ; Get Zero Payment Filter
"RTN","RCDPEAR1",302,0)
 ; INPUTS   : User input from keyboard
"RTN","RCDPEAR1",303,0)
 ; RETURNS  : Output destination (0=Display; 1=MS Excel)
"RTN","RCDPEAR1",304,0)
 ; LOCAL VARIABLES :
"RTN","RCDPEAR1",305,0)
 ; DIR,DUOUT - Standard FileMan variables
"RTN","RCDPEAR1",306,0)
 ; Y         - User input
"RTN","RCDPEAR1",307,0)
 N DIR,DUOUT,Y
"RTN","RCDPEAR1",308,0)
 S DIR(0)="Y"
"RTN","RCDPEAR1",309,0)
 S DIR("A")="INCLUDE ZERO PAYMENT AMOUNTS (Y/N): "
"RTN","RCDPEAR1",310,0)
 S DIR("B")="Y"
"RTN","RCDPEAR1",311,0)
 D ^DIR K DIR
"RTN","RCDPEAR1",312,0)
 I $D(DUOUT)!$D(DIRUT) S Y=-1
"RTN","RCDPEAR1",313,0)
 Q Y
"RTN","RCDPEAR1",314,0)
 ;
"RTN","RCDPEAR1",315,0)
RLOAD(FILE) ; PRCA*4.5*284 - Load Payer temp global AFTER queued job starts
"RTN","RCDPEAR1",316,0)
 ; Load Selected payers from local saved
"RTN","RCDPEAR1",317,0)
 I +RCNP=3 M ^TMP("RCSELPAY",$J)=RCNP1 Q
"RTN","RCDPEAR1",318,0)
 N CNT,RCPAY,RCINSF,RCINST,NUM,INDX
"RTN","RCDPEAR1",319,0)
 ;
"RTN","RCDPEAR1",320,0)
 ; Load ALL payers
"RTN","RCDPEAR1",321,0)
 I +RCNP=2 D  Q
"RTN","RCDPEAR1",322,0)
 .S CNT=0,RCPAY="" F  S RCPAY=$O(^RCY(FILE,"C",RCPAY)) Q:RCPAY=""  S CNT=CNT+1,^TMP("RCSELPAY",$J,CNT)=RCPAY
"RTN","RCDPEAR1",323,0)
 ;
"RTN","RCDPEAR1",324,0)
 ; Range of Payers
"RTN","RCDPEAR1",325,0)
 ; Build list of available stations
"RTN","RCDPEAR1",326,0)
 ; Clear workfile
"RTN","RCDPEAR1",327,0)
 K ^TMP("RCPAYER",$J)
"RTN","RCDPEAR1",328,0)
 S CNT=0,RCPAY=""
"RTN","RCDPEAR1",329,0)
 F  S RCPAY=$O(^RCY(FILE,"C",RCPAY)) Q:RCPAY=""  S CNT=CNT+1,^TMP("RCPAYER",$J,CNT)=RCPAY,^TMP("RCPAYER",$J,"B",RCPAY,CNT)=""
"RTN","RCDPEAR1",330,0)
 ;
"RTN","RCDPEAR1",331,0)
 S RCINSF=$P(RCNP,"^",2),RCINST=$P(RCNP,"^",3),INDX=1
"RTN","RCDPEAR1",332,0)
 F  S RCINSF=$O(^TMP("RCPAYER",$J,"B",RCINSF)) Q:RCINSF=""  Q:RCINSF]RCINST  D
"RTN","RCDPEAR1",333,0)
 . S NUM=$O(^TMP("RCPAYER",$J,"B",RCINSF,""))
"RTN","RCDPEAR1",334,0)
 . S ^TMP("RCSELPAY",$J,INDX)=$G(^TMP("RCPAYER",$J,NUM)),INDX=INDX+1
"RTN","RCDPEAR1",335,0)
 Q
"RTN","RCDPEAR2")
0^9^B61283482^B60443432
"RTN","RCDPEAR2",1,0)
RCDPEAR2 ;ALB/TMK/PJH - EFT Unmatched Aging Report - FILE 344.3 ;04-NOV-02
"RTN","RCDPEAR2",2,0)
 ;;4.5;Accounts Receivable;**173,269,276,284**;Mar 20, 1995;Build 35
"RTN","RCDPEAR2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEAR2",4,0)
 Q
"RTN","RCDPEAR2",5,0)
 ;
"RTN","RCDPEAR2",6,0)
EN1 ; Entry from option - run on the fly
"RTN","RCDPEAR2",7,0)
 N DIR,Y,%ZIS,ZTRTN,ZTSAVE,ZTDESC,POP,X,RCNP,RCJOB,RCJOB1
"RTN","RCDPEAR2",8,0)
 N RCRANGE,RCDISPTY,RCSTART,ZTSTOP,RCEND,DIC,RCIND,RCNP1
"RTN","RCDPEAR2",9,0)
 S RCIND=1
"RTN","RCDPEAR2",10,0)
 S RCRANGE=$$DTRNG^RCDPEM4()
"RTN","RCDPEAR2",11,0)
 I RCRANGE=0 G EN1Q
"RTN","RCDPEAR2",12,0)
 I $P(RCRANGE,U,1) D
"RTN","RCDPEAR2",13,0)
 . S RCSTART=$P(RCRANGE,U,2)-1
"RTN","RCDPEAR2",14,0)
 . S RCEND=$P(RCRANGE,U,3)
"RTN","RCDPEAR2",15,0)
 ;Get insurance company to be used as filter
"RTN","RCDPEAR2",16,0)
 ; PRCA*4.5*284 - RCDPEM9 now return a stack in RCNP (Type of Response(1=Range,2=All,3=Specific)^From Range^Thru Range)
"RTN","RCDPEAR2",17,0)
 S RCNP=$$GETPAY^RCDPEM9(344.31) I +RCNP=-1 G EN1Q
"RTN","RCDPEAR2",18,0)
 ;Get display type
"RTN","RCDPEAR2",19,0)
 S RCDISPTY=$$DISPTY^RCDPEM3() Q:RCDISPTY=-1
"RTN","RCDPEAR2",20,0)
 I $D(DUOUT)!$D(DTOUT) G EN1Q
"RTN","RCDPEAR2",21,0)
 I RCDISPTY D INFO^RCDPEM6
"RTN","RCDPEAR2",22,0)
 S:$P($G(RCRANGE),U)>0 RCIND=RCIND+3
"RTN","RCDPEAR2",23,0)
 S:$D(^TMP("RCSELPAY",$J))&(+RCNP=1) RCIND=RCIND+5
"RTN","RCDPEAR2",24,0)
 S RCJOB=$J
"RTN","RCDPEAR2",25,0)
 ; Ask device
"RTN","RCDPEAR2",26,0)
 S %ZIS="QM" D ^%ZIS G:POP EN1Q
"RTN","RCDPEAR2",27,0)
 I $D(IO("Q")) D  G EN1Q
"RTN","RCDPEAR2",28,0)
 . S ZTRTN="RPTOUT^RCDPEAR2",ZTDESC="EFT AGING REPORT"
"RTN","RCDPEAR2",29,0)
 . S ZTSAVE("*")=""
"RTN","RCDPEAR2",30,0)
 . ; PRCA*4.5*284 - Because TMP global may be on another server, save off specific payers in local
"RTN","RCDPEAR2",31,0)
 . I +RCNP=3 M RCNP1=^TMP("RCSELPAY",$J)
"RTN","RCDPEAR2",32,0)
 . D ^%ZTLOAD
"RTN","RCDPEAR2",33,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEAR2",34,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEAR2",35,0)
 U IO
"RTN","RCDPEAR2",36,0)
 D RPTOUT
"RTN","RCDPEAR2",37,0)
EN1Q Q
"RTN","RCDPEAR2",38,0)
 ;
"RTN","RCDPEAR2",39,0)
RPTOUT(RCPRT) ; Entrypoint for queued job, nightly job
"RTN","RCDPEAR2",40,0)
 ; RCPRT = name of the subscript for ^TMP to use to return all lines
"RTN","RCDPEAR2",41,0)
 ;        (for bulletin).  If undefined or null, output is printed
"RTN","RCDPEAR2",42,0)
 ; Return global if RCPRT not null: ^TMP($J,RCPRT,line#)=line text
"RTN","RCDPEAR2",43,0)
 N RCCT,RCPG,RCPGS,RCSTOP,RCNT,RCTOT,RCOUT,RC0,RC13,RCZ,RCZ0,RC00,Z,Z0,DIC,DUOUT,X,RCPAY,RCRUNDT
"RTN","RCDPEAR2",44,0)
 S RCPRT=$G(RCPRT)
"RTN","RCDPEAR2",45,0)
 S (RCCT,RCSTOP,RCPG,RCNT,RCTOT,RCPGS)=0,RCRUNDT=$$NOW^RCDPEM6
"RTN","RCDPEAR2",46,0)
 S RCPGS=1
"RTN","RCDPEAR2",47,0)
 K ^TMP($J,"RCERA_AGED"),^TMP($J,"RCERA_ADJ")
"RTN","RCDPEAR2",48,0)
 ; PRCA*4.5*284 - Queued job needs to reload payer selection list
"RTN","RCDPEAR2",49,0)
 I $G(RCJOB)'="",RCJOB'=$J D
"RTN","RCDPEAR2",50,0)
 . K ^TMP("RCSELPAY",$J)
"RTN","RCDPEAR2",51,0)
 . D RLOAD^RCDPEAR1(344.31)
"RTN","RCDPEAR2",52,0)
 . S RCJOB=$J
"RTN","RCDPEAR2",53,0)
 ; build local payer array here
"RTN","RCDPEAR2",54,0)
 S RCNP=+RCNP
"RTN","RCDPEAR2",55,0)
 D SELPAY^RCDPEAR1(RCNP,RCJOB,.RCPAY)
"RTN","RCDPEAR2",56,0)
 I RCPRT'="" K ^TMP($J,RCPRT)
"RTN","RCDPEAR2",57,0)
 S RCZ0=0 F  S RCZ0=$O(^RCY(344.31,"AMATCH",0,RCZ0)) Q:'RCZ0  D
"RTN","RCDPEAR2",58,0)
 .Q:$P($G(^RCY(344.31,RCZ0,3)),U)
"RTN","RCDPEAR2",59,0)
 .Q:$P($G(^RCY(344.31,RCZ0,0)),U,7)=0
"RTN","RCDPEAR2",60,0)
 .S RC13=$P($G(^RCY(344.31,RCZ0,0)),U,13)  ;date received
"RTN","RCDPEAR2",61,0)
 .; Check for payer match
"RTN","RCDPEAR2",62,0)
 .I '$$CHKPYR^RCDPEDAR(RCZ0,0,RCJOB) Q
"RTN","RCDPEAR2",63,0)
 .; Check date range
"RTN","RCDPEAR2",64,0)
 .I $P(RCRANGE,U,1) Q:(RCSTART>RC13)!(RC13>RCEND)
"RTN","RCDPEAR2",65,0)
 .; Passed all the filters - include on report
"RTN","RCDPEAR2",66,0)
 .S ^TMP($J,"RCEFT_AGED",$$FMDIFF^XLFDT(RC13,DT),RCZ0)=0,RCNT=RCNT+1
"RTN","RCDPEAR2",67,0)
 I RCDISPTY D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.RCPAY,RCRUNDT),EXCEL Q
"RTN","RCDPEAR2",68,0)
 ;
"RTN","RCDPEAR2",69,0)
 ; Find total amount of EFTs
"RTN","RCDPEAR2",70,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCEFT_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCEFT_AGED",RCZ,RCZ0)) Q:'RCZ0  D  G:RCSTOP PRTQ
"RTN","RCDPEAR2",71,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W:RCPRT="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR2",72,0)
 . S RC0=$G(^RCY(344.31,RCZ0,0)),RC00=$G(^RCY(344.3,+RC0,0))
"RTN","RCDPEAR2",73,0)
 . S RCTOT=RCTOT+$P(RC0,U,7)
"RTN","RCDPEAR2",74,0)
 ;
"RTN","RCDPEAR2",75,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCEFT_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCEFT_AGED",RCZ,RCZ0)) Q:'RCZ0  D  G:RCSTOP PRTQ
"RTN","RCDPEAR2",76,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W:RCPRT="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR2",77,0)
 . I RCPG D SETLINE(" ",.RCCT,.RCPRT) ; On detail list, skip line
"RTN","RCDPEAR2",78,0)
 . I 'RCPG!(($Y+5)>IOSL) S RCPGS=RCPGS+1 D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.RCPAY,RCRUNDT) Q:RCSTOP
"RTN","RCDPEAR2",79,0)
 . S RC0=$G(^RCY(344.31,RCZ0,0)),RC00=$G(^RCY(344.3,+RC0,0))
"RTN","RCDPEAR2",80,0)
 . S RCTOT=RCTOT+$P(RC0,U,7)
"RTN","RCDPEAR2",81,0)
 . S Z=$$SETSTR^VALM1($J(-RCZ,4),"",1,4)
"RTN","RCDPEAR2",82,0)
 . S Z=$$SETSTR^VALM1("  "_$P(RC0,U,4),Z,5,75)
"RTN","RCDPEAR2",83,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",84,0)
 . S Z=$$SETSTR^VALM1($P(RC0,U,2)_"/"_$P(RC0,U,3),"",11,69)
"RTN","RCDPEAR2",85,0)
 . S Z=$$SETSTR^VALM1("  "_$$FMTE^XLFDT($P(RC0,U,12),2),Z,70,10)
"RTN","RCDPEAR2",86,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",87,0)
 . S Z=$$SETSTR^VALM1($J("",6)_$S($P(RC0,U,13):$$FMTE^XLFDT($P(RC0,U,13),2),1:""),"",1,17)
"RTN","RCDPEAR2",88,0)
 . S Z=$$SETSTR^VALM1("  "_$J($P(RC0,U,7),15,2),Z,18,17)
"RTN","RCDPEAR2",89,0)
 . S Z=$$SETSTR^VALM1("  "_$P(RC00,U,6),Z,35,8)
"RTN","RCDPEAR2",90,0)
 . S Z=$$SETSTR^VALM1("  "_$S($P(RC00,U,12):"",1:"NOT ")_"POSTED TO 8NZZ"_$S($P(RC00,U,12):" ON "_$$FMTE^XLFDT($P(RC00,U,11),2),1:""),Z,44,36)
"RTN","RCDPEAR2",91,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",92,0)
 . ;
"RTN","RCDPEAR2",93,0)
 . K RCOUT
"RTN","RCDPEAR2",94,0)
 . D GETS^DIQ(344.31,RCZ0_",",2,"E","RCOUT")
"RTN","RCDPEAR2",95,0)
 . Q:'$O(RCOUT(344.31,RCZ0_",",2,0))
"RTN","RCDPEAR2",96,0)
 . D SETLINE($J("",8)_"--EXCEPTION NOTES--",.RCCT,RCPRT)
"RTN","RCDPEAR2",97,0)
 . S Z=0 F  S Z=$O(RCOUT(344.31,RCZ0_",",2,Z)) Q:'Z  D  Q:RCSTOP
"RTN","RCDPEAR2",98,0)
 .. I ($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.RCPAY,RCRUNDT) Q:RCSTOP
"RTN","RCDPEAR2",99,0)
 .. D SETLINE($J("",8)_" "_RCOUT(344.31,RCZ0_",",2,Z),.RCCT,RCPRT)
"RTN","RCDPEAR2",100,0)
 ;
"RTN","RCDPEAR2",101,0)
 F Z0=1:1:2 D SETLINE(" ",.RCCT,RCPRT)
"RTN","RCDPEAR2",102,0)
 I ($Y+7)>IOSL!'RCPG D HDR(.RCCT,.RCPG,.RCSTOP,RCPRT,RCRANGE,.RCPAY,RCRUNDT)
"RTN","RCDPEAR2",103,0)
 S Z=$$SETSTR^VALM1("TOTALS:","",1,79)
"RTN","RCDPEAR2",104,0)
 ;
"RTN","RCDPEAR2",105,0)
 W !,"*** END OF REPORT ***",!
"RTN","RCDPEAR2",106,0)
PRTQ I '$D(ZTQUEUED),'RCSTOP,RCPG,RCPRT="" D ASK()
"RTN","RCDPEAR2",107,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAR2",108,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAR2",109,0)
 K ^TMP($J,"RCEFT_AGED"),ZTQUEUED
"RTN","RCDPEAR2",110,0)
 Q
"RTN","RCDPEAR2",111,0)
 ;
"RTN","RCDPEAR2",112,0)
HDR(RCCT,RCPG,RCSTOP,RCPRT,RCRANGE,RCPAY,RCRUNDT) ;Prints report heading
"RTN","RCDPEAR2",113,0)
 ; Function returns RCPG = current page # and RCCT = running line count
"RTN","RCDPEAR2",114,0)
 ;   and RCSTOP = 1 if user aborted print 
"RTN","RCDPEAR2",115,0)
 ; Above parameters must be passed by reference
"RTN","RCDPEAR2",116,0)
 ; RCPRT = name of the subscript for ^TMP to use to return all lines
"RTN","RCDPEAR2",117,0)
 ;        (for bulletin).  If undefined or null, output is printed
"RTN","RCDPEAR2",118,0)
 ; RCRANGE - date range filter value to be printed as part of the header
"RTN","RCDPEAR2",119,0)
 ; RCPAY (required/pass-by-ref) - Payer filter value(s)
"RTN","RCDPEAR2",120,0)
 ;
"RTN","RCDPEAR2",121,0)
 N CNT,END,START,Z,Z0
"RTN","RCDPEAR2",122,0)
 I RCPG!($E(IOST,1,2)="C-") D
"RTN","RCDPEAR2",123,0)
 . I RCPG&($E(IOST,1,2)="C-")&(RCPRT="") D ASK(.RCSTOP) Q:RCSTOP
"RTN","RCDPEAR2",124,0)
 . I RCPRT="" W @IOF,*13 Q  ; Write form feed for report
"RTN","RCDPEAR2",125,0)
 Q:$G(RCSTOP)
"RTN","RCDPEAR2",126,0)
 S RCPG=RCPG+1
"RTN","RCDPEAR2",127,0)
 S Z0="EFT UNMATCHED AGING REPORT"
"RTN","RCDPEAR2",128,0)
 S Z=$$SETSTR^VALM1($J("",80-$L(Z0)\2)_Z0,"",1,79)
"RTN","RCDPEAR2",129,0)
 S:'RCDISPTY Z=$$SETSTR^VALM1("Page: "_RCPG,Z,64,17)
"RTN","RCDPEAR2",130,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",131,0)
 S Z0="RUN DATE: "_RCRUNDT,Z0=$J("",80-$L(Z0)\2)_Z0
"RTN","RCDPEAR2",132,0)
 S Z=$$SETSTR^VALM1(Z0,"",1,79)
"RTN","RCDPEAR2",133,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",134,0)
 ; Payer(s)
"RTN","RCDPEAR2",135,0)
 S Z="PAYERS: "
"RTN","RCDPEAR2",136,0)
 I $D(RCPAY)=1 S Z=Z_RCPAY
"RTN","RCDPEAR2",137,0)
 I $D(RCPAY)=10 D
"RTN","RCDPEAR2",138,0)
 . S CNT=0
"RTN","RCDPEAR2",139,0)
 . F  S CNT=$O(RCPAY(CNT)) Q:'CNT  D
"RTN","RCDPEAR2",140,0)
 .. I Z="PAYERS: " S Z=Z_RCPAY(CNT) Q
"RTN","RCDPEAR2",141,0)
 .. S Z=Z_$S(Z]"":",",1:"")_RCPAY(CNT)
"RTN","RCDPEAR2",142,0)
 .. I $L(Z)>60 D
"RTN","RCDPEAR2",143,0)
 ... S Z=$J("",88-$L(Z)\2)_Z
"RTN","RCDPEAR2",144,0)
 ... D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",145,0)
 ... S Z=""
"RTN","RCDPEAR2",146,0)
 I Z]"" D
"RTN","RCDPEAR2",147,0)
 . S Z=$J("",88-$L(Z)\2)_Z
"RTN","RCDPEAR2",148,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",149,0)
 ; Date Range
"RTN","RCDPEAR2",150,0)
 S END=$P(RCRANGE,U,3)
"RTN","RCDPEAR2",151,0)
 S START=$P(RCRANGE,U,2)
"RTN","RCDPEAR2",152,0)
 S Z="DATE RANGE: "_$P($$FMTE^XLFDT(START,2),"@")_" - "_$P($$FMTE^XLFDT(END,2),"@")_" (DATE EFT FILED)",Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEAR2",153,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",154,0)
 Q:RCDISPTY
"RTN","RCDPEAR2",155,0)
 D SETLINE("AGED",.RCCT,RCPRT)
"RTN","RCDPEAR2",156,0)
 S Z=$$SETSTR^VALM1("DAYS"_$J("",2)_"TRACE #","",1,79)
"RTN","RCDPEAR2",157,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",158,0)
 S Z=$$SETSTR^VALM1($J("",10)_"DEPOSIT FROM/ID"_$J("",46)_"DEP DATE","",1,79)
"RTN","RCDPEAR2",159,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",160,0)
 S Z=$$SETSTR^VALM1($J("",6)_"FILE DATE"_$J("",5)_"DEPOSIT AMOUNT"_$J("",2)_"DEP #  "_$J("",2)_"DEPOSIT POST STATUS",Z,1,79)
"RTN","RCDPEAR2",161,0)
 D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",162,0)
 D SETLINE($TR($J("",IOM-1)," ","="),.RCCT,RCPRT)
"RTN","RCDPEAR2",163,0)
 I RCPG=1 D
"RTN","RCDPEAR2",164,0)
 . S Z=$$SETSTR^VALM1("TOTALS:","",1,79)
"RTN","RCDPEAR2",165,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",166,0)
 . S Z=$$SETSTR^VALM1(" NUMBER AGED ELECTRONIC EFT MESSAGES FOUND: "_RCNT,"",1,79)
"RTN","RCDPEAR2",167,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",168,0)
 . S Z=$$SETSTR^VALM1(" AMOUNT AGED ELECTRONIC EFT MESSAGES FOUND: $"_$FN(+RCTOT,",",2),"",1,79)
"RTN","RCDPEAR2",169,0)
 . D SETLINE(Z,.RCCT,RCPRT)
"RTN","RCDPEAR2",170,0)
 . D SETLINE($TR($J("",IOM-1)," ","="),.RCCT,RCPRT)
"RTN","RCDPEAR2",171,0)
 Q
"RTN","RCDPEAR2",172,0)
 ;
"RTN","RCDPEAR2",173,0)
SETLINE(Z,RCCT,RCPRT) ; Sets line into print global or writes line
"RTN","RCDPEAR2",174,0)
 ; Z = txt to output
"RTN","RCDPEAR2",175,0)
 ; RCCT = line counter
"RTN","RCDPEAR2",176,0)
 ; RCPRT = flag if 1, indicates output to global, no writes 
"RTN","RCDPEAR2",177,0)
 S RCCT=RCCT+1
"RTN","RCDPEAR2",178,0)
 I RCPRT="" W !,Z Q
"RTN","RCDPEAR2",179,0)
 S ^TMP($J,RCPRT,RCCT)=Z
"RTN","RCDPEAR2",180,0)
 Q
"RTN","RCDPEAR2",181,0)
 ;
"RTN","RCDPEAR2",182,0)
ASK(RCSTOP) ; Ask to continue
"RTN","RCDPEAR2",183,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEAR2",184,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEAR2",185,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEAR2",186,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEAR2",187,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEAR2",188,0)
 Q
"RTN","RCDPEAR2",189,0)
 ;
"RTN","RCDPEAR2",190,0)
EXCEL ; Print report to screen, one record per line for export to MS Excel.
"RTN","RCDPEAR2",191,0)
 W !!,"Aged Days^Trace #^Deposit From/ID^File Date^Deposit Amount^Deposit #^Deposit Post Status^Deposit Date"
"RTN","RCDPEAR2",192,0)
 S RCZ="" F  S RCZ=$O(^TMP($J,"RCEFT_AGED",RCZ)) Q:RCZ=""  S RCZ0=0 F  S RCZ0=$O(^TMP($J,"RCEFT_AGED",RCZ,RCZ0)) Q:'RCZ0  D  G:RCSTOP PRTQ2
"RTN","RCDPEAR2",193,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ I +$G(RCPG) W:RCPRT="" !!,"***TASK STOPPED BY USER***" Q
"RTN","RCDPEAR2",194,0)
 . S RC0=$G(^RCY(344.31,RCZ0,0)),RC00=$G(^RCY(344.3,+RC0,0))
"RTN","RCDPEAR2",195,0)
 . S Z=$J(-RCZ,4)_"^"_$P(RC0,U,4)_"^"_$P(RC0,U,2)_"/"_$P(RC0,U,3)_"^"_$S($P(RC0,U,13):$$FMTE^XLFDT($P(RC0,U,13),2),1:"")_"^"
"RTN","RCDPEAR2",196,0)
 . S Z=Z_$P(RC0,U,7)_"^"_$P(RC00,U,6)_"^"_$S($P(RC00,U,12):"",1:"NOT ")_"POSTED TO 8NZZ"_$S($P(RC00,U,12):"^"_$$FMTE^XLFDT($P(RC0,U,12),2),1:"")
"RTN","RCDPEAR2",197,0)
 . W !,Z
"RTN","RCDPEAR2",198,0)
 W !!,"*** END OF REPORT ***",!
"RTN","RCDPEAR2",199,0)
 ;
"RTN","RCDPEAR2",200,0)
PRTQ2 ;
"RTN","RCDPEAR2",201,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEAR2",202,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEAR2",203,0)
 K ^TMP($J,"RCEFT_AGED"),^TMP("RCSELPAY",$J),^TMP("RCPAYER",$J),^TMP($J,"RCERA_ADJ")
"RTN","RCDPEAR2",204,0)
 Q
"RTN","RCDPEDA1")
0^10^B23249063^B22465629
"RTN","RCDPEDA1",1,0)
RCDPEDA1 ;ALB/TMK/PJH - ACTIVITY REPORT HEADER ;04-NOV-02
"RTN","RCDPEDA1",2,0)
 ;;4.5;Accounts Receivable;**173,269,276,284**;Mar 20, 1995;Build 35
"RTN","RCDPEDA1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEDA1",4,0)
 Q
"RTN","RCDPEDA1",5,0)
 ;
"RTN","RCDPEDA1",6,0)
HDR(RCCT,RCPG,RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) ;Prints report heading
"RTN","RCDPEDA1",7,0)
 ; Function returns RCPG = current page # and RCCT = running line count
"RTN","RCDPEDA1",8,0)
 ;   and RCSTOP = 1 if user aborted print
"RTN","RCDPEDA1",9,0)
 ; Parameters RCCT,RCPG,RCSTOP must be passed by reference
"RTN","RCDPEDA1",10,0)
 ; RCDT1,RCDT2 = from,to date
"RTN","RCDPEDA1",11,0)
 ; RCDET = flag = 1 if detail is desired
"RTN","RCDPEDA1",12,0)
 N Z,Z0,Z1,X,Y
"RTN","RCDPEDA1",13,0)
 Q:RCNITE&(RCPG)
"RTN","RCDPEDA1",14,0)
 I RCPG!($E(IOST,1,2)="C-") D
"RTN","RCDPEDA1",15,0)
 . Q:$G(RCNITE)
"RTN","RCDPEDA1",16,0)
 . I RCPG&($E(IOST,1,2)="C-") D ASK(.RCSTOP) Q:RCSTOP
"RTN","RCDPEDA1",17,0)
 . W @IOF,*13 ; Write form feed
"RTN","RCDPEDA1",18,0)
 Q:RCSTOP
"RTN","RCDPEDA1",19,0)
 S RCPG=RCPG+1
"RTN","RCDPEDA1",20,0)
 I '$D(RCNP) N RCNP S RCNP=2  ; PRCA276 if coming from nightly job need to define payer selection variable
"RTN","RCDPEDA1",21,0)
 I '$D(VAUTD) N VAUTD S VAUTD=1  ; PRCA276 if coming from nightly job need to define division selection variable
"RTN","RCDPEDA1",22,0)
 S Z0="EDI LOCKBOX DAILY ACTIVITY "_$S($G(RCDET):"DETAIL",1:"SUMMARY")_" REPORT"
"RTN","RCDPEDA1",23,0)
 S Z=$$SETSTR^VALM1($J("",80-$L(Z0)\2)_Z0,"",1,79)
"RTN","RCDPEDA1",24,0)
 S Z=$$SETSTR^VALM1("Page: "_RCPG,Z,70,10)
"RTN","RCDPEDA1",25,0)
 D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",26,0)
 S Z="RUN DATE: "_$$FMTE^XLFDT($$NOW^XLFDT(),2),Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA1",27,0)
 D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",28,0)
 ;prca276 add divisions to header
"RTN","RCDPEDA1",29,0)
 S Z1="" I 'VAUTD S Z0=0 F  S Z0=$O(VAUTD(Z0)) Q:'Z0  S Z1=Z1_VAUTD(Z0)_", "
"RTN","RCDPEDA1",30,0)
 S Z="DIVISIONS: "_$S(VAUTD:"ALL",1:$E(Z1,1,$L(Z1)-2)),Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA1",31,0)
 D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",32,0)
 ; prca 276 add payer selection list to header
"RTN","RCDPEDA1",33,0)
 S Z1="" I RCNP'=2 S Z0=0 F  S Z0=$O(^TMP("RCSELPAY",$J,Z0)) Q:'Z0  S Z1=Z1_^TMP("RCSELPAY",$J,Z0)_", "
"RTN","RCDPEDA1",34,0)
 S Z="PAYERS: "_$S(RCNP=2:"ALL",1:$E(Z1,1,$L(Z1)-2)),Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA1",35,0)
 D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",36,0)
 ;prca 276  add date filter to header
"RTN","RCDPEDA1",37,0)
 S Z="DATE RANGE: "_$$FMTE^XLFDT(RCDT1,2)_" - "_$$FMTE^XLFDT(RCDT2,2)_" (Date Deposit Added)",Z=$J("",80-$L(Z)\2)_Z
"RTN","RCDPEDA1",38,0)
 D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",39,0)
 D SETLINE^RCDPEDAR(RCNITE," ",.RCCT)
"RTN","RCDPEDA1",40,0)
 I $G(RCDET) D
"RTN","RCDPEDA1",41,0)
 . S Z=$$SETSTR^VALM1("DEP #   DEPOSIT DT  "_$J("",22)_"DEP AMOUNT          FMS DEPOSIT STAT","",1,80)
"RTN","RCDPEDA1",42,0)
 . D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",43,0)
 . D SETLINE^RCDPEDAR(RCNITE," ",.RCCT)
"RTN","RCDPEDA1",44,0)
 . ; PRCA*4.5*284, Move Match Status to left 3 space to allow for 10 digit ERA #'s
"RTN","RCDPEDA1",45,0)
 . S Z=$$SETSTR^VALM1($J("",3)_"EFT #"_$J("",23)_"DATE PD   PAYMENT AMOUNT  ERA MATCH STATUS","",1,80)
"RTN","RCDPEDA1",46,0)
 . D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",47,0)
 . S Z=$$SETSTR^VALM1($J("",10)_"EFT PAYER TRACE #","",1,30)
"RTN","RCDPEDA1",48,0)
 . D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",49,0)
 . S Z=$$SETSTR^VALM1($J("",14)_"PAYMENT FROM","",1,30)
"RTN","RCDPEDA1",50,0)
 . D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",51,0)
 . S Z=$$SETSTR^VALM1($J("",45)_"DEP RECEIPT #","",1,60)
"RTN","RCDPEDA1",52,0)
 . S Z=$$SETSTR^VALM1("DEP RECEIPT STATUS",Z,61,19)
"RTN","RCDPEDA1",53,0)
 . D SETLINE^RCDPEDAR(RCNITE,Z,.RCCT)
"RTN","RCDPEDA1",54,0)
 D SETLINE^RCDPEDAR(RCNITE,$TR($J("",IOM-1)," ","="),.RCCT)
"RTN","RCDPEDA1",55,0)
 Q
"RTN","RCDPEDA1",56,0)
 ;
"RTN","RCDPEDA1",57,0)
ASK(RCSTOP) ; Ask to continue
"RTN","RCDPEDA1",58,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEDA1",59,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEDA1",60,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEDA1",61,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEDA1",62,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEDA1",63,0)
 Q
"RTN","RCDPEDA1",64,0)
 ;
"RTN","RCDPEDA1",65,0)
EFTDET(Z2,Z3,RCCT,RCPG,RCSTOP,RCDT1,RCDT2,RCDET,RCFMS1,RCNITE) ; Display EFT Detail
"RTN","RCDPEDA1",66,0)
 N DATA,X
"RTN","RCDPEDA1",67,0)
 S X=$$SETSTR^VALM1($P(Z3,U),"",4,6)
"RTN","RCDPEDA1",68,0)
 S X=$$SETSTR^VALM1($$FMTE^XLFDT($P(Z3,U,12)\1,2),X,32,8)
"RTN","RCDPEDA1",69,0)
 S X=$$SETSTR^VALM1($J($P(Z3,U,7),"",2),X,42,18)
"RTN","RCDPEDA1",70,0)
 ; PRCA*4.5*284, Move to left 3 space (61 to 58) to allow for 10 digit ERA #'s
"RTN","RCDPEDA1",71,0)
 S X=$$SETSTR^VALM1($$EXTERNAL^DILFD(344.31,.08,"",+$P(Z3,U,8))_$S($P(Z3,U,8)=1:"/ERA #"_$P(Z3,U,10),1:""),X,58,20)
"RTN","RCDPEDA1",72,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDA1",73,0)
 D SETLINE^RCDPEDAR(RCNITE,X,.RCCT)
"RTN","RCDPEDA1",74,0)
 S X=$$SETSTR^VALM1($P(Z3,U,4),"",11,61)
"RTN","RCDPEDA1",75,0)
 D SETLINE^RCDPEDAR(RCNITE,X,.RCCT)
"RTN","RCDPEDA1",76,0)
 S X=$$SETSTR^VALM1($P(Z3,U,2)_"/"_$P(Z3,U,3),"",15,65)
"RTN","RCDPEDA1",77,0)
 D SETLINE^RCDPEDAR(RCNITE,X,.RCCT)
"RTN","RCDPEDA1",78,0)
 S X=""
"RTN","RCDPEDA1",79,0)
 I $P(Z3,U,9) S X=$$SETSTR^VALM1($P($G(^RCY(344,+$P(Z3,U,9),0)),U),X,46,10)
"RTN","RCDPEDA1",80,0)
 S X=$$SETSTR^VALM1($G(RCFMS1(Z2)),X,61,19)
"RTN","RCDPEDA1",81,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDA1",82,0)
 D SETLINE^RCDPEDAR(RCNITE,X,.RCCT)
"RTN","RCDPEDA1",83,0)
 I $O(^RCY(344.31,Z2,2,0)) D  Q:RCSTOP
"RTN","RCDPEDA1",84,0)
 . N V
"RTN","RCDPEDA1",85,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDA1",86,0)
 . D SETLINE^RCDPEDAR(RCNITE,$J("",10)_"ERROR MESSAGES FOR EFT DETAIL:",.RCCT)
"RTN","RCDPEDA1",87,0)
 . S V=0 F  S V=$O(^RCY(344.31,Z2,2,V)) Q:'V  D  Q:RCSTOP
"RTN","RCDPEDA1",88,0)
 .. I '$G(RCNITE),($Y+5)>IOSL D HDR(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDA1",89,0)
 .. D SETLINE^RCDPEDAR(RCNITE,$J("",12)_$G(^RCY(344.31,Z2,2,V,0)),.RCCT)
"RTN","RCDPEDA1",90,0)
 I $D(^RCY(344.31,Z2,3)) D
"RTN","RCDPEDA1",91,0)
 .S DATA=$G(^RCY(344.31,Z2,3))
"RTN","RCDPEDA1",92,0)
 .S X="   MARKED AS DUPLICATE: "_$$FMTE^XLFDT($P(DATA,U,2),5)_" "_$$EXTERNAL^DILFD(344.31,.17,,$P(DATA,U))
"RTN","RCDPEDA1",93,0)
 .D SETLINE^RCDPEDAR(RCNITE,X,.RCCT)
"RTN","RCDPEDA1",94,0)
 .D SETLINE^RCDPEDAR(RCNITE,"",.RCCT)
"RTN","RCDPEDA1",95,0)
 .Q
"RTN","RCDPEDA1",96,0)
 Q
"RTN","RCDPEDA1",97,0)
 ;
"RTN","RCDPEDA1",98,0)
 ; *** Begin PRCA*4.5*276 - RBN ***
"RTN","RCDPEDA1",99,0)
TEXT ; Filtered by messages
"RTN","RCDPEDA1",100,0)
 ;;No Filters Applied
"RTN","RCDPEDA1",101,0)
 ;;Station/Division
"RTN","RCDPEDA1",102,0)
 ;;
"RTN","RCDPEDA1",103,0)
 ;;Date Range
"RTN","RCDPEDA1",104,0)
 ;;Station/Division, Date Range
"RTN","RCDPEDA1",105,0)
 ;;Payer
"RTN","RCDPEDA1",106,0)
 ;;Station/Division, Payer
"RTN","RCDPEDA1",107,0)
 ;;
"RTN","RCDPEDA1",108,0)
 ;;Date Range, Payer
"RTN","RCDPEDA1",109,0)
 ;;Station/Division, Date Range, Payer
"RTN","RCDPEDA1",110,0)
 Q
"RTN","RCDPEDA1",111,0)
 ;
"RTN","RCDPEDA1",112,0)
 ; *** End PRCA*4.5*276 ***
"RTN","RCDPEDAR")
0^8^B111611189^B105086845
"RTN","RCDPEDAR",1,0)
RCDPEDAR ;ALB/TMK - ACTIVITY REPORT ;04-NOV-02
"RTN","RCDPEDAR",2,0)
 ;;4.5;Accounts Receivable;**173,276,284**;Mar 20, 1995;Build 35
"RTN","RCDPEDAR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEDAR",4,0)
 Q
"RTN","RCDPEDAR",5,0)
 ;
"RTN","RCDPEDAR",6,0)
RPT ; Daily Activity Rpt On Demand
"RTN","RCDPEDAR",7,0)
 N DUOUT,DTOUT,DIR,X,Y,RCDT1,RCDT2,RCDET,ZTRTN,ZTSK,ZTDESC,ZTSTOP,%ZIS,POP
"RTN","RCDPEDAR",8,0)
 N RCDIV,RCINC,VAUTD,RCRANGE,RCNP,RCJOB,RCNP1
"RTN","RCDPEDAR",9,0)
 ; Get division/station
"RTN","RCDPEDAR",10,0)
 D DIVISION^VAUTOMA
"RTN","RCDPEDAR",11,0)
 I 'VAUTD&($D(VAUTD)'=11) G RPTQ
"RTN","RCDPEDAR",12,0)
 S DIR("A")="(S)UMMARY OR (D)ETAIL?: ",DIR(0)="SA^S:SUMMARY TOTALS ONLY;D:DETAIL AND TOTALS"
"RTN","RCDPEDAR",13,0)
 S DIR("B")="D" D ^DIR K DIR
"RTN","RCDPEDAR",14,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") G RPTQ
"RTN","RCDPEDAR",15,0)
 S RCDET=(Y="D")
"RTN","RCDPEDAR",16,0)
 S DIR("?")="ENTER THE EARLIEST DATE OF RECEIPT OF DEPOSIT TO INCLUDE ON THE REPORT"
"RTN","RCDPEDAR",17,0)
 S DIR(0)="DAO^:"_DT_":APE",DIR("A")="START DATE: " D ^DIR K DIR
"RTN","RCDPEDAR",18,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") G RPTQ
"RTN","RCDPEDAR",19,0)
 S RCDT1=Y
"RTN","RCDPEDAR",20,0)
 S DIR("?")="ENTER THE LATEST DATE OF RECEIPT OF DEPOSIT TO INCLUDE ON THE REPORT"
"RTN","RCDPEDAR",21,0)
 S DIR("B")=Y(0)
"RTN","RCDPEDAR",22,0)
 S DIR(0)="DAO^"_RCDT1_":"_DT_":APE",DIR("A")="END DATE: " D ^DIR K DIR
"RTN","RCDPEDAR",23,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") G RPTQ
"RTN","RCDPEDAR",24,0)
 S RCDT2=Y
"RTN","RCDPEDAR",25,0)
 ;Get insurance company to be used as filter
"RTN","RCDPEDAR",26,0)
 ; PRCA*4.5*284 - RCDPEM9 now return a stack in RCNP (Type of Response(1=Range,2=All,3=Specific)^From Range^Thru Range)
"RTN","RCDPEDAR",27,0)
 S RCNP=$$GETPAY^RCDPEM9(344.31) I +RCNP=-1 G RPTQ
"RTN","RCDPEDAR",28,0)
 S RCJOB=$J
"RTN","RCDPEDAR",29,0)
 ; Ask device
"RTN","RCDPEDAR",30,0)
 S %ZIS="QM" D ^%ZIS G:POP RPTQ
"RTN","RCDPEDAR",31,0)
 I $D(IO("Q")) D  G RPTQ
"RTN","RCDPEDAR",32,0)
 . S ZTRTN="EN^RCDPEDAR("_RCDET_","_RCDT1_","_RCDT2_")",ZTDESC="AR - EDI LOCKBOX DAILY ACTIVITY REPORT"
"RTN","RCDPEDAR",33,0)
 . S ZTSAVE("*")=""
"RTN","RCDPEDAR",34,0)
 . ; PRCA*4.5*284 - Because TMP global may be on another server, save off specific payers in local
"RTN","RCDPEDAR",35,0)
 . I +RCNP=3 M RCNP1=^TMP("RCSELPAY",$J)
"RTN","RCDPEDAR",36,0)
 . D ^%ZTLOAD
"RTN","RCDPEDAR",37,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEDAR",38,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEDAR",39,0)
 U IO
"RTN","RCDPEDAR",40,0)
 D EN(RCDET,RCDT1,RCDT2)
"RTN","RCDPEDAR",41,0)
RPTQ Q
"RTN","RCDPEDAR",42,0)
 ;
"RTN","RCDPEDAR",43,0)
EN(RCDET,RCDT1,RCDT2) ; Entry point for queued job
"RTN","RCDPEDAR",44,0)
 ; RCDET = 1 to include detail, 0 for totals only
"RTN","RCDPEDAR",45,0)
 ; RCDT1,RCDT2 = date from,to
"RTN","RCDPEDAR",46,0)
 N Z,Z0,RC,RCT,DATA,RCSTOP,RCPG,RCIEN,STATION,RCFLG
"RTN","RCDPEDAR",47,0)
 ; PRCA*4.5*284 - Quueed job needs to reload payer selection list
"RTN","RCDPEDAR",48,0)
 I $G(RCJOB)'="",RCJOB'=$J D
"RTN","RCDPEDAR",49,0)
 . K ^TMP("RCSELPAY",$J)
"RTN","RCDPEDAR",50,0)
 . D RLOAD^RCDPEAR1(344.31)
"RTN","RCDPEDAR",51,0)
 . S RCJOB=$J
"RTN","RCDPEDAR",52,0)
 S RCNP=+RCNP
"RTN","RCDPEDAR",53,0)
 K ^TMP("RCDAILYACT",$J)
"RTN","RCDPEDAR",54,0)
 S Z=RCDT1-.0001,(RCSTOP,RCT)=0
"RTN","RCDPEDAR",55,0)
 F  S Z=$O(^RCY(344.3,"ARECDT",Z)) Q:'Z!(Z>(RCDT2_".9999"))!RCSTOP  D
"RTN","RCDPEDAR",56,0)
 .S Z0=0 F  S Z0=$O(^RCY(344.3,"ARECDT",Z,Z0)) Q:'Z0!RCSTOP  D
"RTN","RCDPEDAR",57,0)
 ..S DATA=$G(^RCY(344.3,Z0,0)),RCFLG=0
"RTN","RCDPEDAR",58,0)
 ..S RCIEN="" F  S RCIEN=$O(^RCY(344.31,"B",Z0,RCIEN)) Q:RCIEN=""  D
"RTN","RCDPEDAR",59,0)
 ...; check payer
"RTN","RCDPEDAR",60,0)
 ...I '$$CHKPYR(RCIEN,0,RCJOB) Q
"RTN","RCDPEDAR",61,0)
 ...; check station/division
"RTN","RCDPEDAR",62,0)
 ...I '$$CHKDIV(RCIEN,0,.VAUTD) Q
"RTN","RCDPEDAR",63,0)
 ...S RCFLG=1,^TMP("RCDAILYACT",$J,Z\1,Z0,"EFT",RCIEN)=""
"RTN","RCDPEDAR",64,0)
 ...Q
"RTN","RCDPEDAR",65,0)
 ..I RCFLG S ^TMP("RCDAILYACT",$J,Z\1,Z0)=DATA
"RTN","RCDPEDAR",66,0)
 ..S RCT=RCT+1 I '(RCT#100),$D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ Q  ; Check for user stopped every 100 records
"RTN","RCDPEDAR",67,0)
 ..Q
"RTN","RCDPEDAR",68,0)
 .Q
"RTN","RCDPEDAR",69,0)
 D:'RCSTOP RPT1(0,RCDET,RCDT1,RCDT2,.RCSTOP,.RCPG)
"RTN","RCDPEDAR",70,0)
 D ENQ(RCSTOP,$G(RCPG))
"RTN","RCDPEDAR",71,0)
 Q
"RTN","RCDPEDAR",72,0)
 ;
"RTN","RCDPEDAR",73,0)
RPT1(RCNITE,RCDET,RCDT1,RCDT2,RCSTOP,RCPG) ; Entrypoint for nightly job
"RTN","RCDPEDAR",74,0)
 ; RCNITE = 1 if called from nightly job, 0 if called from on demand
"RTN","RCDPEDAR",75,0)
 ; RCDET = 1 to include detail, 0 for totals only
"RTN","RCDPEDAR",76,0)
 ; RCDT1,RCDT2 = date from,to
"RTN","RCDPEDAR",77,0)
 ; RCSTOP = returned = 1 if user elected to quit job
"RTN","RCDPEDAR",78,0)
 ; RCPG = the last page # printed, returned if passed by reference
"RTN","RCDPEDAR",79,0)
 ;
"RTN","RCDPEDAR",80,0)
 N X,Q,Q0,Z,Z0,Z1,Z2,Z3,ZCT,RCCT,RCDEP,RCDEPA,RCDEPAP,RCFMS,RCFMS1,RCD1,RCFMSTOT,RCEFT,RCMATCH,RCDEPREC,RCDT
"RTN","RCDPEDAR",81,0)
 N D,DIC,I,RCIEN,RCPAY
"RTN","RCDPEDAR",82,0)
 S (RCSTOP,RCPG,ZCT,RCCT,RCDEP,RCDEPA,RCDEPAP,RCDEPREC,Z)=0,RCD1=1
"RTN","RCDPEDAR",83,0)
 S RCNITE=+$G(RCNITE)
"RTN","RCDPEDAR",84,0)
 F  S Z=$O(^TMP("RCDAILYACT",$J,Z)) Q:'Z  D  G:RCSTOP RPT1Q ; Z = date
"RTN","RCDPEDAR",85,0)
 . I 'RCPG!$S('$G(RCNITE):($Y+5)>IOSL,1:0) D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) S RCDT=1 Q:RCSTOP
"RTN","RCDPEDAR",86,0)
 . S Q="DATE EFT DEPOSIT RECEIVED: "_$$FMTE^XLFDT(Z,2),Q=$J("",80-$L(Q)\2)_Q ; Center it
"RTN","RCDPEDAR",87,0)
 . I 'RCD1,$G(RCDET) D SETLINE(RCNITE,"",.RCCT) ; Skip line if >1 dt on pg
"RTN","RCDPEDAR",88,0)
 . S RCDT=0
"RTN","RCDPEDAR",89,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",90,0)
 . I $G(RCDET) D
"RTN","RCDPEDAR",91,0)
 .. D SETLINE(RCNITE,Q,.RCCT)
"RTN","RCDPEDAR",92,0)
 .. D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",93,0)
 . ; Z0 = ien of entry in file 344.3
"RTN","RCDPEDAR",94,0)
 . K RCEFT("D"),RCMATCH("D"),RCFMS("D")
"RTN","RCDPEDAR",95,0)
 . S Z0=0 F  S Z0=$O(^TMP("RCDAILYACT",$J,Z,Z0)) Q:'Z0  D  Q:RCSTOP
"RTN","RCDPEDAR",96,0)
 .. S Z1=$G(^TMP("RCDAILYACT",$J,Z,Z0))
"RTN","RCDPEDAR",97,0)
 .. S RCDEPREC=+$O(^RCY(344,"AD",+$P(Z1,U,3),0)),RCDEP(Z)=$G(RCDEP(Z))+1,RCDEPA(Z)=$G(RCDEPA(Z))+$P(Z1,U,8)
"RTN","RCDPEDAR",98,0)
 .. I $P($G(^RCY(344,RCDEPREC,2)),U)="" S RCFMS("D",-1)=$G(RCFMS("D",-1))+$P(Z1,U,8),RCFMS="NO FMS DOC"
"RTN","RCDPEDAR",99,0)
 .. I $P($G(^RCY(344,RCDEPREC,2)),U)'="" D
"RTN","RCDPEDAR",100,0)
 ... S X=$$STATUS^GECSSGET($P(^RCY(344,RCDEPREC,2),U))
"RTN","RCDPEDAR",101,0)
 ... I X=-1 S RCFMS("D",-1)=$G(RCFMS("D",-1))+$P(Z1,U,8) Q
"RTN","RCDPEDAR",102,0)
 ... S RCFMS=$E($P(X," "),1,10),Q=$E(X),Q=$S(Q="E"!(Q="R"):0,Q="Q":2,1:1),RCFMS("D",Q)=$G(RCFMS("D",Q))+$P(Z1,U,8)
"RTN","RCDPEDAR",103,0)
 ... ;
"RTN","RCDPEDAR",104,0)
 .. I $G(RCDET) D  Q:RCSTOP
"RTN","RCDPEDAR",105,0)
 ... S X=$$SETSTR^VALM1($P(Z1,U,6),"",1,6)
"RTN","RCDPEDAR",106,0)
 ... S X=$$SETSTR^VALM1($$FMTE^XLFDT($P(Z1,U,7)\1,2),X,9,10)
"RTN","RCDPEDAR",107,0)
 ... S X=$$SETSTR^VALM1("",X,21,10)
"RTN","RCDPEDAR",108,0)
 ... S X=$$SETSTR^VALM1("",X,32,10)
"RTN","RCDPEDAR",109,0)
 ... S X=$$SETSTR^VALM1($E($J($P(Z1,U,8),"",2)_$J("",20),1,20)_RCFMS,X,43,37)
"RTN","RCDPEDAR",110,0)
 ... I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",111,0)
 ... D SETLINE(RCNITE,X,.RCCT)
"RTN","RCDPEDAR",112,0)
 .. S RCFMSTOT=0,RCFMS1="NO FMS DOC"
"RTN","RCDPEDAR",113,0)
 .. I $O(^RCY(344.3,Z0,2,0)) D  Q:RCSTOP
"RTN","RCDPEDAR",114,0)
 ... N V
"RTN","RCDPEDAR",115,0)
 ... I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",116,0)
 ... D SETLINE(RCNITE,$J("",10)_"ERROR MESSAGES FOR EFT:",.RCCT)
"RTN","RCDPEDAR",117,0)
 ... S V=0 F  S V=$O(^RCY(344.3,Z0,2,V)) Q:'V  D  Q:RCSTOP
"RTN","RCDPEDAR",118,0)
 .... I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",119,0)
 .... D SETLINE(RCNITE,$J("",12)_$G(^RCY(344.3,Z0,2,V,0)),.RCCT)
"RTN","RCDPEDAR",120,0)
 .. S Z2=0 F  S Z2=$O(^TMP("RCDAILYACT",$J,Z,Z0,"EFT",Z2)) Q:'Z2  S Z3=$G(^RCY(344.31,Z2,0)) D  Q:RCSTOP
"RTN","RCDPEDAR",121,0)
 ... S RCEFT("D")=$G(RCEFT("D"))+1
"RTN","RCDPEDAR",122,0)
 ... S X=$S($P($G(^RCY(344,+$P(Z3,U,9),2)),U)'="":$$STATUS^GECSSGET($P(^RCY(344,+$P(Z3,U,9),2),U)),1:"")
"RTN","RCDPEDAR",123,0)
 ... I X'="",X'=-1,$E(X)'="R",$E(X)'="E" S RCFMSTOT=RCFMSTOT+$P(Z3,U,7),RCFMS1=$S($E(X)="Q":"QUEUED TO POST",1:"POSTED")
"RTN","RCDPEDAR",124,0)
 ... S RCFMS1(Z2)=$S(X="":"",X=-1:"NO FMS DOC",1:$E($P(X," "),1,10))
"RTN","RCDPEDAR",125,0)
 ... I $P(Z3,U,8) S RCMATCH("D")=$G(RCMATCH("D"))+1
"RTN","RCDPEDAR",126,0)
 ... I $G(RCDET) D EFTDET^RCDPEDA1(Z2,Z3,.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,.RCFMS1,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",127,0)
 .. ;
"RTN","RCDPEDAR",128,0)
 .. Q:RCSTOP
"RTN","RCDPEDAR",129,0)
 .. I RCDET D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",130,0)
 . ;
"RTN","RCDPEDAR",131,0)
 . Q:RCSTOP
"RTN","RCDPEDAR",132,0)
 . S RCDEPA=RCDEPA+$G(RCDEPA(Z)),RCDEP=RCDEP+$G(RCDEP(Z)),RCDEPAP=RCDEPAP+$G(RCDEPAP(Z)),RCFMSTOT("D")=$G(RCFMSTOT("D"))+$G(RCFMSTOT),RCEFT("T")=$G(RCEFT("T"))+$G(RCEFT("D")),RCMATCH("T")=$G(RCMATCH("T"))+$G(RCMATCH("D"))
"RTN","RCDPEDAR",133,0)
 . F Q=-1,0,1,2 S RCFMS("T",Q)=$G(RCFMS("T",Q))+$G(RCFMS("D",Q))
"RTN","RCDPEDAR",134,0)
 . D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",135,0)
 . I $S('$G(RCNITE):($Y+5)>IOSL,1:0)!'RCPG D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",136,0)
 . D SETLINE(RCNITE,$E("**TOTALS FOR DATE: "_$$FMTE^XLFDT(Z\1,2)_$J("",30),1,30)_"   # OF DEPOSIT TICKETS RECEIVED: "_+$G(RCDEP(Z))_$J("",5),.RCCT)
"RTN","RCDPEDAR",137,0)
 . D SETLINE(RCNITE,$J("",29)_"TOTAL AMOUNT OF DEPOSITS RECEIVED: $"_$J(+$G(RCDEPA(Z)),"",2),.RCCT)
"RTN","RCDPEDAR",138,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",139,0)
 . D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",140,0)
 . D SETLINE(RCNITE,$J("",20)_"DEPOSIT AMOUNTS SENT TO FMS:",.RCCT)
"RTN","RCDPEDAR",141,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",142,0)
 . D SETLINE(RCNITE,$J("",39)_"ACCEPTED: $"_$J(+$G(RCFMS("D",1)),"",2),.RCCT)
"RTN","RCDPEDAR",143,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",144,0)
 . D SETLINE(RCNITE,$J("",41)_"QUEUED: $"_$J(+$G(RCFMS("D",2)),"",2),.RCCT)
"RTN","RCDPEDAR",145,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",146,0)
 . D SETLINE(RCNITE,$J("",35)_"ERROR/REJECT: $"_$J(+$G(RCFMS("D",0)),"",2),.RCCT)
"RTN","RCDPEDAR",147,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",148,0)
 . D SETLINE(RCNITE,$J("",37)_"NOT IN FMS: $"_$J(+$G(RCFMS("D",-1)),"",2),.RCCT)
"RTN","RCDPEDAR",149,0)
 . D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",150,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",151,0)
 . D SETLINE(RCNITE,$J("",26)_"# EFT PAYMENT RECORDS: "_+$G(RCEFT("D")),.RCCT)
"RTN","RCDPEDAR",152,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",153,0)
 . D SETLINE(RCNITE,$J("",25)_"# EFT PAYMENTS MATCHED: "_+$G(RCMATCH("D")),.RCCT)
"RTN","RCDPEDAR",154,0)
 . I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) Q:RCSTOP
"RTN","RCDPEDAR",155,0)
 . D SETLINE(RCNITE,$J("",18)_"MATCHED PAYMENT AMOUNT POSTED: $"_$J(+$G(RCDEPAP(Z)),"",2),.RCCT)
"RTN","RCDPEDAR",156,0)
 . D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",157,0)
 I '$O(^TMP("RCDAILYACT",$J,0)) D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE)
"RTN","RCDPEDAR",158,0)
 G:RCSTOP!RCNITE RPT1Q
"RTN","RCDPEDAR",159,0)
 D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",160,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",161,0)
 D SETLINE(RCNITE,$E("**** TOTALS FOR DATE RANGE:"_$J("",30),1,30)_"   # OF DEPOSIT TICKETS RECEIVED: "_+$G(RCDEP)_$J("",5),.RCCT)
"RTN","RCDPEDAR",162,0)
 D SETLINE(RCNITE,$J("",29)_"TOTAL AMOUNT OF DEPOSITS RECEIVED: $"_$J(+$G(RCDEPA),"",2),.RCCT)
"RTN","RCDPEDAR",163,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",164,0)
 D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",165,0)
 D SETLINE(RCNITE,$J("",20)_"DEPOSIT AMOUNTS SENT TO FMS:",.RCCT)
"RTN","RCDPEDAR",166,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",167,0)
 D SETLINE(RCNITE,$J("",39)_"ACCEPTED: $"_+$G(RCFMS("T",1)),.RCCT)
"RTN","RCDPEDAR",168,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",169,0)
 D SETLINE(RCNITE,$J("",41)_"QUEUED: $"_+$G(RCFMS("T",2)),.RCCT)
"RTN","RCDPEDAR",170,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",171,0)
 D SETLINE(RCNITE,$J("",35)_"ERROR/REJECT: $"_+$G(RCFMS("T",0)),.RCCT)
"RTN","RCDPEDAR",172,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",173,0)
 D SETLINE(RCNITE,$J("",37)_"NOT IN FMS: $"_$J(+$G(RCFMS("T",-1)),"",2),.RCCT)
"RTN","RCDPEDAR",174,0)
 D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",175,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",176,0)
 D SETLINE(RCNITE,$J("",26)_"# EFT PAYMENT RECORDS: "_+$G(RCEFT("T")),.RCCT)
"RTN","RCDPEDAR",177,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",178,0)
 D SETLINE(RCNITE,$J("",25)_"# EFT PAYMENTS MATCHED: "_+$G(RCMATCH("T")),.RCCT)
"RTN","RCDPEDAR",179,0)
 I '$G(RCNITE),($Y+5)>IOSL D HDR^RCDPEDA1(.RCCT,.RCPG,.RCSTOP,RCDT1,RCDT2,RCDET,RCNITE) G:RCSTOP RPT1Q
"RTN","RCDPEDAR",180,0)
 D SETLINE(RCNITE,$J("",18)_"MATCHED PAYMENT AMOUNT POSTED: $"_$J(+$G(RCDEPAP),"",2),.RCCT)
"RTN","RCDPEDAR",181,0)
 D SETLINE(RCNITE,"",.RCCT)
"RTN","RCDPEDAR",182,0)
 ;
"RTN","RCDPEDAR",183,0)
 W !,"******** END OF REPORT ********",!
"RTN","RCDPEDAR",184,0)
RPT1Q K ^TMP("RCDAILYACT",$J)
"RTN","RCDPEDAR",185,0)
 Q
"RTN","RCDPEDAR",186,0)
 ;
"RTN","RCDPEDAR",187,0)
ENQ(RCSTOP,RCPG) ; Clean up
"RTN","RCDPEDAR",188,0)
 I '$D(ZTQUEUED) D ^%ZISC I 'RCSTOP,RCPG D ASK^RCDPEDA1()
"RTN","RCDPEDAR",189,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEDAR",190,0)
 Q
"RTN","RCDPEDAR",191,0)
 ;
"RTN","RCDPEDAR",192,0)
SETLINE(RCNITE,Z,RCCT) ; Writes line
"RTN","RCDPEDAR",193,0)
 ; RCNITE = 1 to set array,  0 to write line
"RTN","RCDPEDAR",194,0)
 ; Z = txt to output
"RTN","RCDPEDAR",195,0)
 ; RCCT = line counter
"RTN","RCDPEDAR",196,0)
 S RCCT=RCCT+1
"RTN","RCDPEDAR",197,0)
 I $G(RCNITE) S ^TMP($J,"RCDPE_DAR",RCCT)=Z Q
"RTN","RCDPEDAR",198,0)
 W !,Z
"RTN","RCDPEDAR",199,0)
 Q
"RTN","RCDPEDAR",200,0)
 ;
"RTN","RCDPEDAR",201,0)
EFTDET(Z2,Z3,RCCT,RCPG,RCSTOP,RCDT1,RCDT2,RCDET,RCFMS1,RCNITE) ; Display EFT Detail
"RTN","RCDPEDAR",202,0)
 N X
"RTN","RCDPEDAR",203,0)
 I RCFLG W !,"^^^^^"
"RTN","RCDPEDAR",204,0)
 S RCFLG=1
"RTN","RCDPEDAR",205,0)
 W $P(Z3,U,1)_U
"RTN","RCDPEDAR",206,0)
 W $$FMTE^XLFDT($P(Z3,U,12)\1,2)_U
"RTN","RCDPEDAR",207,0)
 W $P(Z3,U,7)_U
"RTN","RCDPEDAR",208,0)
 W $$EXTERNAL^DILFD(344.31,.08,"",+$P(Z3,U,8))_$S($P(Z3,U,8)=1:":"_$P(Z3,U,10),1:"")_U
"RTN","RCDPEDAR",209,0)
 W $P(Z3,U,4)_U
"RTN","RCDPEDAR",210,0)
 W $P(Z3,U,2)_"/"_$P(Z3,U,3)_U
"RTN","RCDPEDAR",211,0)
 I $P(Z3,U,9) W $P($G(^RCY(344,+$P(Z3,U,9),0)),U)_U
"RTN","RCDPEDAR",212,0)
 I '$P(Z3,U,9) W U
"RTN","RCDPEDAR",213,0)
 W $G(RCFMS1(Z2))_U
"RTN","RCDPEDAR",214,0)
 I $O(^RCY(344.31,Z2,2,0)) D  W U Q:RCSTOP
"RTN","RCDPEDAR",215,0)
 . N V
"RTN","RCDPEDAR",216,0)
 . S V=0 F  S V=$O(^RCY(344.31,Z2,2,V)) Q:'V  D  Q:RCSTOP
"RTN","RCDPEDAR",217,0)
 .. W $G(^RCY(344.31,Z2,2,V,0))_";"
"RTN","RCDPEDAR",218,0)
 I $D(^RCY(344.31,Z2,3)) D WP^RCDPEM6($P(^RCY(344.31,Z2,3),U,3)) Q
"RTN","RCDPEDAR",219,0)
 W $P($G(^RCY(344.31,Z2,3)),U,3)
"RTN","RCDPEDAR",220,0)
 Q
"RTN","RCDPEDAR",221,0)
 ;
"RTN","RCDPEDAR",222,0)
CHKPYR(IEN,FLG,RCJOB) ;
"RTN","RCDPEDAR",223,0)
 ; IEN - ien in file 344.31 or 344.4
"RTN","RCDPEDAR",224,0)
 ; FLG - 0 if IEN contains ien in file 344.31, 1 if IEN contains ien in file 344.4
"RTN","RCDPEDAR",225,0)
 ; RCJOB - need to pass in the job number to access the previously populated temporary global array ^TMP("RCSELPAY",RCJOB) when rpt is queued to run
"RTN","RCDPEDAR",226,0)
 ; returns 1 if payer in 344.31/.02 or 344.4/.06 is in the list of selected payers ^TMP("RCSELPAY",RCJOB)
"RTN","RCDPEDAR",227,0)
 ; returns 0 otherwise
"RTN","RCDPEDAR",228,0)
 ;
"RTN","RCDPEDAR",229,0)
 N RCPAY,RES,Z
"RTN","RCDPEDAR",230,0)
 S RES=0
"RTN","RCDPEDAR",231,0)
 S:$G(RCJOB)="" RCJOB=$J
"RTN","RCDPEDAR",232,0)
 S RCPAY="" I IEN S RCPAY=$S(FLG:$P($G(^RCY(344.4,IEN,0)),U,6),1:$P($G(^RCY(344.31,IEN,0)),U,2))
"RTN","RCDPEDAR",233,0)
 I RCPAY'="" S (RCFLG,Z)=0 F  S Z=$O(^TMP("RCSELPAY",RCJOB,Z)) Q:Z=""  S:$E(RCPAY,1,30)=$G(^TMP("RCSELPAY",RCJOB,Z)) RES=1 I RES Q
"RTN","RCDPEDAR",234,0)
 Q RES
"RTN","RCDPEDAR",235,0)
 ;
"RTN","RCDPEDAR",236,0)
CHKDIV(IEN,FLG,VAUTD) ;
"RTN","RCDPEDAR",237,0)
 ; IEN - ien in file 344.31 or 344.4
"RTN","RCDPEDAR",238,0)
 ; FLG - 0 if IEN contains ien in file 344.31, 1 if IEN contains ien in file 344.4
"RTN","RCDPEDAR",239,0)
 ; VAUTD - array of selected divisions from DIVISION^VAUTOMA API call
"RTN","RCDPEDAR",240,0)
 ; returns 1 if division associated with an entry in 344.31 is on the list in VAUTD
"RTN","RCDPEDAR",241,0)
 ; returns 0 otherwise
"RTN","RCDPEDAR",242,0)
 N ERA,I,NAME,RCSTA,RES
"RTN","RCDPEDAR",243,0)
 S RES=0
"RTN","RCDPEDAR",244,0)
 I VAUTD=1 S RES=1 G CHKDIVX
"RTN","RCDPEDAR",245,0)
 I 'IEN G CHKDIVX
"RTN","RCDPEDAR",246,0)
 S ERA=$S(FLG:IEN,1:$P($G(^RCY(344.31,IEN,0)),U,10))
"RTN","RCDPEDAR",247,0)
 S RCSTA=$$ERASTA^RCDPEM3(ERA),NAME=$P(RCSTA,U)
"RTN","RCDPEDAR",248,0)
 I NAME="UNKNOWN" G CHKDIVX
"RTN","RCDPEDAR",249,0)
 S I=0 I 'VAUTD F  S I=$O(VAUTD(I)) Q:'I!RES  I NAME=VAUTD(I) S RES=1
"RTN","RCDPEDAR",250,0)
CHKDIVX ;
"RTN","RCDPEDAR",251,0)
 Q RES
"RTN","RCDPEM2")
0^12^B181574834^B171488766
"RTN","RCDPEM2",1,0)
RCDPEM2 ;ALB/TMK/PJH - MANUAL ERA AND EFT MATCHING ;05-NOV-02
"RTN","RCDPEM2",2,0)
 ;;4.5;Accounts Receivable;**173,208,276,284**;Mar 20, 1995;Build 35
"RTN","RCDPEM2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM2",4,0)
 Q
"RTN","RCDPEM2",5,0)
MATCH1 ; Manually 'match' an ERA to an EFT
"RTN","RCDPEM2",6,0)
 N DA,DR,DIE,DIC,DIR,X,Y,RCEFT,RCERA,RCNAME,RCMATCH,RCQUIT,DUOUT,DTOUT
"RTN","RCDPEM2",7,0)
 W !,"THIS OPTION WILL ALLOW YOU TO MANUALLY MATCH AN EFT DETAIL RECORD",!,"WITH AN ERA RECORD"
"RTN","RCDPEM2",8,0)
M1 S DIR("A")="SELECT THE UNMATCHED EFT TO MATCH TO AN ERA: "
"RTN","RCDPEM2",9,0)
 S DIR(0)="PAO^RCY(344.31,:AEMQ",DIR("S")="I '$P(^(0),U,8)"
"RTN","RCDPEM2",10,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",11,0)
 I $D(DUOUT)!$D(DTOUT)!(Y<0) G M1Q
"RTN","RCDPEM2",12,0)
 S RCEFT=+Y,RCEFT(0)=$G(^RCY(344.31,+Y,0))
"RTN","RCDPEM2",13,0)
 W !
"RTN","RCDPEM2",14,0)
 S DIC="^RCY(344.31,",DR="0",DA=RCEFT D EN^DIQ
"RTN","RCDPEM2",15,0)
 W !
"RTN","RCDPEM2",16,0)
 S DIR("A")="ARE YOU SURE THIS IS THE EFT YOU WANT TO MATCH?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",17,0)
 I $D(DUOUT)!$D(DTOUT) G M1Q
"RTN","RCDPEM2",18,0)
 I Y'=1 G M1
"RTN","RCDPEM2",19,0)
M12 S DIR("A")="SELECT THE UNMATCHED ERA TO MATCH TO EFT #"_RCEFT_": "
"RTN","RCDPEM2",20,0)
 S DIR(0)="PAO^RCY(344.4,:AEMQ",DIR("S")="I '$P(^(0),U,9),'$P(^(0),U,8)"
"RTN","RCDPEM2",21,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",22,0)
 I $D(DUOUT)!$D(DTOUT)!(Y<0) G M1Q
"RTN","RCDPEM2",23,0)
 S RCERA=+Y,RCERA(0)=$G(^RCY(344.4,+Y,0))
"RTN","RCDPEM2",24,0)
 W !
"RTN","RCDPEM2",25,0)
 S DIC="^RCY(344.4,",DR="0",DA=RCERA D EN^DIQ
"RTN","RCDPEM2",26,0)
 W !
"RTN","RCDPEM2",27,0)
 S DIR("A")="ARE YOU SURE THIS IS THE CORRECT ERA TO MATCH TO?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",28,0)
 I $D(DUOUT)!$D(DTOUT) G M1Q
"RTN","RCDPEM2",29,0)
 I Y'=1 G M12
"RTN","RCDPEM2",30,0)
 S RCMATCH=(+$P(RCERA(0),U,5)=+$P(RCEFT(0),U,7))
"RTN","RCDPEM2",31,0)
 S RCNAME=($P(RCERA(0),U,6)=$P(RCEFT(0),U,2))
"RTN","RCDPEM2",32,0)
 I 'RCMATCH!'RCNAME D  G:RCQUIT M1Q
"RTN","RCDPEM2",33,0)
 . N Z
"RTN","RCDPEM2",34,0)
 . S RCQUIT=0,Z=1
"RTN","RCDPEM2",35,0)
 . S DIR("A",1)="***WARNING***"
"RTN","RCDPEM2",36,0)
 . I 'RCNAME S Z=Z+1,DIR("A",Z)=$J("",3)_"> The payer names on these two records do not agree"
"RTN","RCDPEM2",37,0)
 . I 'RCMATCH S Z=Z+1,DIR("A",Z)=$J("",3)_"> The amount of payment on these two records do not agree"
"RTN","RCDPEM2",38,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("A")="ARE YOU SURE YOU WANT TO MATCH THESE 2 RECORDS?: " W ! D ^DIR K DIR
"RTN","RCDPEM2",39,0)
 . I $S($D(DUOUT)!$D(DTOUT):1,Y'=1:1,1:0) S RCQUIT=1 Q
"RTN","RCDPEM2",40,0)
 S DIE="^RCY(344.4,",DR=".09////1",DA=RCERA D ^DIE
"RTN","RCDPEM2",41,0)
 I '$D(Y) S DIE="^RCY(344.31,",DR=".08////1;.1////"_RCERA,DA=RCEFT D ^DIE
"RTN","RCDPEM2",42,0)
 S DIR(0)="EA",DIR("A",1)="EFT #"_RCEFT_" WAS "_$S('$D(Y):"SUCCESSFULLY",1:"NOT")_" MATCHED TO ERA #"_RCERA,DIR("A")="PRESS RETURN TO CONTINUE: " D ^DIR K DIR
"RTN","RCDPEM2",43,0)
M1Q Q
"RTN","RCDPEM2",44,0)
 ;
"RTN","RCDPEM2",45,0)
MATCH2 ; Manually 'match' a 0-balance EFT to a paper EOB
"RTN","RCDPEM2",46,0)
 N DUOUT,DTOUT,DA,DR,DIE,DIC,DIR,X,Y,RCEFT,RCRCPT
"RTN","RCDPEM2",47,0)
 W !,"THIS OPTION WILL ALLOW YOU TO MANUALLY MARK A 0-BALANCE EFT DETAIL RECORD",!,"AS MATCHED TO A PAPER EOB"
"RTN","RCDPEM2",48,0)
M2 S DIR("A")="SELECT THE UNMATCHED 0-BALANCE EFT TO MARK AS MATCHED TO PAPER EOB: "
"RTN","RCDPEM2",49,0)
 S DIR(0)="PAO^RCY(344.31,:AEMQ",DIR("S")="I '$P(^(0),U,8),'$P(^(0),U,7)"
"RTN","RCDPEM2",50,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",51,0)
 I $D(DUOUT)!$D(DTOUT)!(Y'>0) G M2Q
"RTN","RCDPEM2",52,0)
 S RCEFT=+Y
"RTN","RCDPEM2",53,0)
 W !
"RTN","RCDPEM2",54,0)
 S DIC="^RCY(344.31,",DR="0",DA=RCEFT D EN^DIQ
"RTN","RCDPEM2",55,0)
 W !
"RTN","RCDPEM2",56,0)
 S DIR("A")="ARE YOU SURE THIS IS THE EFT YOU WANT TO MARK AS MATCHED?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",57,0)
 I $D(DUOUT)!$D(DTOUT) G M2Q
"RTN","RCDPEM2",58,0)
 I Y'=1 G M2
"RTN","RCDPEM2",59,0)
 S DIE="^RCY(344.31,",DR=".08////2",DA=RCEFT D ^DIE
"RTN","RCDPEM2",60,0)
 S DIR(0)="EA",DIR("A")="EFT #"_RCEFT_" WAS "_$S('$D(Y):"SUCCESSFULLY",1:"NOT")_" MARKED AS MATCHED TO PAPER EOB" D ^DIR K DIR
"RTN","RCDPEM2",61,0)
M2Q Q
"RTN","RCDPEM2",62,0)
 ;
"RTN","RCDPEM2",63,0)
MANTR ; Mark an EFT detail record as 'TR' posted manually
"RTN","RCDPEM2",64,0)
 N DA,DR,DIC,DIE,DIR,X,Y,RCEFT,DUOUT,DTOUT,RCZ0,RCTR,RCHOW
"RTN","RCDPEM2",65,0)
 ; EFT detail cannot be associated with a receipt or TR document
"RTN","RCDPEM2",66,0)
 ;
"RTN","RCDPEM2",67,0)
 W !,"*****",!," YOU SHOULD ONLY USE THIS OPTION IF YOU HAVE AN EFT DETAIL RECORD ON YOUR",!," UNAPPLIED DEPOSIT REPORT WHOSE DETAIL WAS ENTERED ON LINE VIA A TR DOCUMENT",!,"*****",!
"RTN","RCDPEM2",68,0)
 S DIC(0)="AEMQ",DIC("S")="I $P(^(0),U,16)="""",$P(^(0),U,11)",DIC("A")="SELECT THE EFT DETAIL WHOSE 'TR' DOC WAS MANUALLY ENTERED ON LINE: ",DIC="^RCY(344.31,"
"RTN","RCDPEM2",69,0)
 W ! D ^DIC K DIC
"RTN","RCDPEM2",70,0)
 I Y'>0 G MANTRQ
"RTN","RCDPEM2",71,0)
 S RCEFT=+Y,RCZ0=$G(^RCY(344.31,RCEFT,0))
"RTN","RCDPEM2",72,0)
 S DIR(0)="FA^2:30^K:X'?1""TR"".E X",DIR("A")="ENTER THE TR DOC # THAT WAS ENTERED ON-LINE FOR THE EFT DETAIL: "
"RTN","RCDPEM2",73,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",74,0)
 I $D(DTOUT)!$D(DUOUT) G MANTRQ
"RTN","RCDPEM2",75,0)
 S RCTR=Y,DR=""
"RTN","RCDPEM2",76,0)
 ;
"RTN","RCDPEM2",77,0)
 I '$P(RCZ0,U,8) D  G:RCQUIT MANTRQ  ;Unmatched
"RTN","RCDPEM2",78,0)
 . S DIR(0)="SA^E:ELECTRONIC ERA;P:PAPER EOB",DIR("A")="WAS THE EFT DETAIL RECEIVED BY (E)RA or (P)APER EOB?: " W ! D ^DIR K DIR
"RTN","RCDPEM2",79,0)
 . I $D(DTOUT)!$D(DUOUT) S RCQUIT=1 Q
"RTN","RCDPEM2",80,0)
 . S RCHOW=Y,DR=""
"RTN","RCDPEM2",81,0)
 . I RCHOW="E" D
"RTN","RCDPEM2",82,0)
 .. S DR=";.09R;.08////1"
"RTN","RCDPEM2",83,0)
 . I RCHOW="P" D
"RTN","RCDPEM2",84,0)
 .. S DR=";.08////2"
"RTN","RCDPEM2",85,0)
 ;
"RTN","RCDPEM2",86,0)
 S DIR(0)="YA",DIR("B")="NO",DIR("A",1)="THIS WILL MARK EFT DETAIL #: "_RCEFT_" AS MANUALLY POSTED",DIR("A",2)="  USING TR DOC: "_RCTR
"RTN","RCDPEM2",87,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: " W ! D ^DIR K DIR
"RTN","RCDPEM2",88,0)
 I Y'=1 D  G MANTRQ
"RTN","RCDPEM2",89,0)
 . S DIR(0)="EA",DIR("A")="EFT NOT UPDATED - PRESS RETURN TO CONTINUE: " W ! D ^DIR K DIR
"RTN","RCDPEM2",90,0)
 S DIE="^RCY(344.31,",DA=RCEFT,DR=".16R"_DR D ^DIE
"RTN","RCDPEM2",91,0)
 I $D(Y) D
"RTN","RCDPEM2",92,0)
 . S DIE="^RCY(344.31,",DA=RCEFT,DR=".16///@;.08///"_$S($P(RCZ0,U,8)'="":$P(RCZ0,U,8),1:"@") D ^DIE
"RTN","RCDPEM2",93,0)
 . S DIR("A")="EFT NOT UPDATED - PRESS RETURN TO CONTINUE"
"RTN","RCDPEM2",94,0)
 E  D
"RTN","RCDPEM2",95,0)
 . S DIR("A")="STATUS UPDATED FOR EFT DETAIL #: "_RCEFT_" - PRESS RETURN TO CONTINUE: "
"RTN","RCDPEM2",96,0)
 S DIR(0)="EA"
"RTN","RCDPEM2",97,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",98,0)
 ;
"RTN","RCDPEM2",99,0)
MANTRQ Q
"RTN","RCDPEM2",100,0)
 ;
"RTN","RCDPEM2",101,0)
CHK() ; Function returns the ien of CHECK/MO payment type
"RTN","RCDPEM2",102,0)
 Q +$O(^RC(341.1,"AC",4,0))
"RTN","RCDPEM2",103,0)
 ;
"RTN","RCDPEM2",104,0)
 ;; Begin PRCA*4.5*276 - PJH
"RTN","RCDPEM2",105,0)
POSTED ;
"RTN","RCDPEM2",106,0)
 N DIR,X,Y
"RTN","RCDPEM2",107,0)
 S DIR("A")="Select type of receipt to ERA link"
"RTN","RCDPEM2",108,0)
 S DIR("B")="M"
"RTN","RCDPEM2",109,0)
 S DIR(0)="S^M:Manually select receipt to post;"
"RTN","RCDPEM2",110,0)
 S DIR(0)=DIR(0)_"A:Automatic search for receipt to post"
"RTN","RCDPEM2",111,0)
 D ^DIR K DIR
"RTN","RCDPEM2",112,0)
 I Y="M" D MANUAL Q
"RTN","RCDPEM2",113,0)
 I Y="A" D AUTO
"RTN","RCDPEM2",114,0)
 Q
"RTN","RCDPEM2",115,0)
 ;
"RTN","RCDPEM2",116,0)
MANUAL ; Mark an ERA as posted when the data was previously posted using
"RTN","RCDPEM2",117,0)
 ; paper EOB information
"RTN","RCDPEM2",118,0)
 N DIC,DIE,DIR,DA,DR,ERA,RCPT,X,Y,%
"RTN","RCDPEM2",119,0)
 ; Must be unmatched or matched to paper check, must be accepted by FMS, must not be posted yet
"RTN","RCDPEM2",120,0)
 W !!,"THIS OPTION IS USED WHEN YOU HAVE POSTED AN ERA PAID WITH A PAPER CHECK",!,"BY USING THE PAPER EOB AND YOU DID NOT REFERENCE THE ERA IN THE RECEIPT",!!
"RTN","RCDPEM2",121,0)
MAN1 S DIC("S")="I ""02""[+$P(^(0),U,9),$P(^(0),U,14)=0",DIC="^RCY(344.4,",DIC(0)="AEMQ"
"RTN","RCDPEM2",122,0)
 D ^DIC K DIC
"RTN","RCDPEM2",123,0)
 ;
"RTN","RCDPEM2",124,0)
 I Y'>0 G MANUALQ
"RTN","RCDPEM2",125,0)
 ;
"RTN","RCDPEM2",126,0)
 ;Check if ERA is already linked to a receipt
"RTN","RCDPEM2",127,0)
 I $$RCHECK(+Y) G MAN1
"RTN","RCDPEM2",128,0)
 S ERA=+Y
"RTN","RCDPEM2",129,0)
 ;
"RTN","RCDPEM2",130,0)
 S DIC="^RCY(344,",DIC(0)="AEMQ",DIC("A")="RECEIPT: ",DIC("S")="I $$FMS^RCDPEM2(Y,0)"
"RTN","RCDPEM2",131,0)
 D ^DIC K DIC
"RTN","RCDPEM2",132,0)
 I Y'>0 G MANUALQ
"RTN","RCDPEM2",133,0)
 S RCPT=+Y
"RTN","RCDPEM2",134,0)
 ;
"RTN","RCDPEM2",135,0)
 D NOW^%DTC
"RTN","RCDPEM2",136,0)
 ;Update Receipt #, EFT Match Status, Detail Post Status and Paper EOB
"RTN","RCDPEM2",137,0)
 S DIE="^RCY(344.4,",DR=".08////"_RCPT_";.09////2;.14////2;20.03////1",DA=ERA
"RTN","RCDPEM2",138,0)
 ;Update Date/Time Posted and User fields
"RTN","RCDPEM2",139,0)
 S DR=DR_";7.01///"_%_";7.02///"_DUZ
"RTN","RCDPEM2",140,0)
 D ^DIE
"RTN","RCDPEM2",141,0)
 I '$D(Y) D
"RTN","RCDPEM2",142,0)
 . S DIR(0)="EA",DIR("A",1)="ERA HAS BEEN MARKED AS POSTED USING PAPER EOB",DIR("A")="PRESS RETURN TO CONTINUE " D ^DIR K DIR
"RTN","RCDPEM2",143,0)
 ;
"RTN","RCDPEM2",144,0)
MANUALQ Q
"RTN","RCDPEM2",145,0)
 ;
"RTN","RCDPEM2",146,0)
 ;VISN 15 software - created by Karen Flores
"RTN","RCDPEM2",147,0)
 ;
"RTN","RCDPEM2",148,0)
AUTO ;Select ERA's for linking to receipt
"RTN","RCDPEM2",149,0)
 N EXIT
"RTN","RCDPEM2",150,0)
 S EXIT=0 F  D LNKERA Q:EXIT
"RTN","RCDPEM2",151,0)
 Q
"RTN","RCDPEM2",152,0)
 ;
"RTN","RCDPEM2",153,0)
RCHECK(RCSCR) ;Check if already linked to a receipt
"RTN","RCDPEM2",154,0)
 N REC,RNUM,RNAM,AMT
"RTN","RCDPEM2",155,0)
 S REC=$G(^RCY(344.4,RCSCR,0)),RNUM=$P(REC,U,8)
"RTN","RCDPEM2",156,0)
 ;Ignore check if zero amount ERA
"RTN","RCDPEM2",157,0)
 Q:'$P(REC,U,5) 0
"RTN","RCDPEM2",158,0)
 ;Check if already linked to a different receipt
"RTN","RCDPEM2",159,0)
 Q:'RNUM 0
"RTN","RCDPEM2",160,0)
 S RNAM=$P($G(^RCY(344,RNUM,0)),U)
"RTN","RCDPEM2",161,0)
 W !!,"ERA ",RCSCR," is already linked to receipt ",RNAM,!
"RTN","RCDPEM2",162,0)
 Q 1
"RTN","RCDPEM2",163,0)
 ;
"RTN","RCDPEM2",164,0)
LNKERA ;Select ERA
"RTN","RCDPEM2",165,0)
 N ABORT,DIC,DUOUT,DTOUT,REC,RCSCR,X,Y
"RTN","RCDPEM2",166,0)
 ;Must be unposted and either unmatched or matched to paper check
"RTN","RCDPEM2",167,0)
 S DIC("S")="I ""02""[+$P(^(0),U,9),$P(^(0),U,14)=0"
"RTN","RCDPEM2",168,0)
 S DIC="^RCY(344.4,",DIC(0)="AEMQ" W ! D ^DIC K DIC
"RTN","RCDPEM2",169,0)
 S RCSCR=+Y I RCSCR'>0 S EXIT=1 Q
"RTN","RCDPEM2",170,0)
 ;Check if already linked to a different receipt
"RTN","RCDPEM2",171,0)
 Q:$$RCHECK(RCSCR)
"RTN","RCDPEM2",172,0)
 ;
"RTN","RCDPEM2",173,0)
 ;Finds receipt automatically from AR TRANSACTION file #433 
"RTN","RCDPEM2",174,0)
 N AMT,ART,ARTND1,ATTY,BILL,EOB,EOBND,FOUND,RCND,RCSCR1,RECEPT,TAMT
"RTN","RCDPEM2",175,0)
 N TRACE
"RTN","RCDPEM2",176,0)
 ;Trace# from ERA
"RTN","RCDPEM2",177,0)
 S TRACE=$P($G(^RCY(344.4,RCSCR,0)),U,2)
"RTN","RCDPEM2",178,0)
 ;Clear workfile
"RTN","RCDPEM2",179,0)
 K ^TMP("RCDPEM2",$J)
"RTN","RCDPEM2",180,0)
 ;
"RTN","RCDPEM2",181,0)
 S (FOUND,ABORT,RCSCR1)=0
"RTN","RCDPEM2",182,0)
 ;Scan claim lines in ERA for non zero bills
"RTN","RCDPEM2",183,0)
 F  S RCSCR1=$O(^RCY(344.4,RCSCR,1,RCSCR1)) Q:+RCSCR1=0!(FOUND)  D
"RTN","RCDPEM2",184,0)
 .S RCND=$G(^RCY(344.4,RCSCR,1,RCSCR1,0))
"RTN","RCDPEM2",185,0)
 .;Ignore bill if AMOUNT PAID is zero
"RTN","RCDPEM2",186,0)
 .S AMT=$P(RCND,"^",3) Q:+AMT=0
"RTN","RCDPEM2",187,0)
 .;Ignore if EOB has no EOB detail record
"RTN","RCDPEM2",188,0)
 .S EOB=+$P(RCND,"^",2) Q:'EOB
"RTN","RCDPEM2",189,0)
 .;Get EOB detail record
"RTN","RCDPEM2",190,0)
 .S EOBND=$G(^IBM(361.1,EOB,0))
"RTN","RCDPEM2",191,0)
 .;Extract Bill number from EOB detail
"RTN","RCDPEM2",192,0)
 .S BILL=$P(EOBND,"^",1) Q:BILL=""
"RTN","RCDPEM2",193,0)
 .;Ignore duplicate bills on ERA
"RTN","RCDPEM2",194,0)
 .Q:$D(^TMP("RCDPEM2",$J,BILL))
"RTN","RCDPEM2",195,0)
 .S ^TMP("RCDPEM2",$J,BILL)=""
"RTN","RCDPEM2",196,0)
 .;Search AR TRANSACTION file #433 for the bill - newest first
"RTN","RCDPEM2",197,0)
 .S ART=""
"RTN","RCDPEM2",198,0)
 .F  S ART=$O(^PRCA(433,"C",BILL,ART),-1) Q:+ART=0!(FOUND)  D
"RTN","RCDPEM2",199,0)
 ..S ARTND1=$G(^PRCA(433,ART,1))
"RTN","RCDPEM2",200,0)
 ..;Get transaction type
"RTN","RCDPEM2",201,0)
 ..S ATTY=$P(ARTND1,"^",2) Q:'ATTY
"RTN","RCDPEM2",202,0)
 ..;Ignore if not a payment
"RTN","RCDPEM2",203,0)
 ..S ATTY=$P($G(^PRCA(430.3,ATTY,0)),"^",1) Q:ATTY'["PAYMENT"
"RTN","RCDPEM2",204,0)
 ..;Get receipt number
"RTN","RCDPEM2",205,0)
 ..S RECEPT=$P(ARTND1,"^",3) Q:RECEPT=""
"RTN","RCDPEM2",206,0)
 ..;Ignore receipt if status is not 'ACCEPTED BY FMS'
"RTN","RCDPEM2",207,0)
 ..Q:'$$FMS(RECEPT,1)
"RTN","RCDPEM2",208,0)
 ..W !!,"PATIENT: "_$$PNM4^RCDPEWL1(RCSCR,RCSCR1)
"RTN","RCDPEM2",209,0)
 ..W !,"Bill number: ",$P($G(^DGCR(399,BILL,0)),U)
"RTN","RCDPEM2",210,0)
 ..W !,"Check #: ",$$CHQ(RECEPT,BILL)
"RTN","RCDPEM2",211,0)
 ..W !,"Trace #: ",TRACE
"RTN","RCDPEM2",212,0)
 ..W !,"DOS: ",$$FMTE^XLFDT($P($G(^DGCR(399,BILL,0)),U,3))
"RTN","RCDPEM2",213,0)
 ..S TAMT=+$P(ARTND1,"^",5)
"RTN","RCDPEM2",214,0)
 ..W !,"AR Transaction amount: ",TAMT
"RTN","RCDPEM2",215,0)
 ..W !,"RECEIPT#: ",RECEPT
"RTN","RCDPEM2",216,0)
 ..W !,"Date of Receipt: ",$$FMTE^XLFDT($$DATE(RECEPT))
"RTN","RCDPEM2",217,0)
 ..W !,"Total Receipt AMOUNT: ",$J($$AMT(RECEPT),2,2),!
"RTN","RCDPEM2",218,0)
 .. ; PRCA*4.5*284 Change default response from YES to NO
"RTN","RCDPEM2",219,0)
 ..S DIR(0)="Y",DIR("B")="NO"
"RTN","RCDPEM2",220,0)
 ..S DIR("A")="Link to update Remittance entry # "_RCSCR
"RTN","RCDPEM2",221,0)
 ..S DIR("A")=DIR("A")_" with receipt "_RECEPT
"RTN","RCDPEM2",222,0)
 ..D ^DIR K DIR
"RTN","RCDPEM2",223,0)
 ..;Aborted
"RTN","RCDPEM2",224,0)
 ..I $D(DUOUT)!$D(DTOUT) S ABORT=1,FOUND=1 Q
"RTN","RCDPEM2",225,0)
 ..;Attempt to update ERA - finish if successful
"RTN","RCDPEM2",226,0)
 ..I +Y>0 D UPDERA(RCSCR,RECEPT,.FOUND)
"RTN","RCDPEM2",227,0)
 ;Update failed
"RTN","RCDPEM2",228,0)
 I FOUND=0 W !!,"No matching payment transactions found for this ERA"
"RTN","RCDPEM2",229,0)
 ;Clear workfile
"RTN","RCDPEM2",230,0)
 K ^TMP("RCDPEM2",$J)
"RTN","RCDPEM2",231,0)
 Q
"RTN","RCDPEM2",232,0)
 ;
"RTN","RCDPEM2",233,0)
UPDERA(DA,RECEPT,FOUND) ;Mark ERA as posted to paper EOB
"RTN","RCDPEM2",234,0)
 N Y,X,DR,DIE,%
"RTN","RCDPEM2",235,0)
 D NOW^%DTC
"RTN","RCDPEM2",236,0)
 S DIE="^RCY(344.4,",FOUND=0
"RTN","RCDPEM2",237,0)
 ;Update Receipt #, EFT Match Status, Detail Post Status and Paper EOB
"RTN","RCDPEM2",238,0)
 S DR=".08///"_RECEPT_";.09///2;.14///2;20.03///1"
"RTN","RCDPEM2",239,0)
 ;Update Date/Time Posted and User fields
"RTN","RCDPEM2",240,0)
 S DR=DR_";7.01///"_%_";7.02///"_DUZ
"RTN","RCDPEM2",241,0)
 D ^DIE
"RTN","RCDPEM2",242,0)
 I '$D(Y) D
"RTN","RCDPEM2",243,0)
 .K DIR
"RTN","RCDPEM2",244,0)
 .S DIR(0)="EA"
"RTN","RCDPEM2",245,0)
 .S DIR("A",1)="ERA HAS BEEN MARKED AS POSTED USING PAPER EOB"
"RTN","RCDPEM2",246,0)
 .S DIR("A")="PRESS RETURN TO CONTINUE " W ! D ^DIR K DIR
"RTN","RCDPEM2",247,0)
 .S FOUND=1
"RTN","RCDPEM2",248,0)
 E  W !,"Unable to update ERA for receipt "_RECEPT,!
"RTN","RCDPEM2",249,0)
 Q FOUND
"RTN","RCDPEM2",250,0)
 ;
"RTN","RCDPEM2",251,0)
 ;Check FMS status
"RTN","RCDPEM2",252,0)
FMS(RECEPT,FLG) ;
"RTN","RCDPEM2",253,0)
 ; FLG = 1 if RECEPT contains receipt number
"RTN","RCDPEM2",254,0)
 ; FLG = 0 if RECEPT contains ien of the receipt
"RTN","RCDPEM2",255,0)
 N FMSDOCNO,RCRECTDA,RES
"RTN","RCDPEM2",256,0)
 S RES=0 I $G(RECEPT)="" G FMSX
"RTN","RCDPEM2",257,0)
 ;Get receipt IEN
"RTN","RCDPEM2",258,0)
 I 'FLG S RCRECTDA=RECEPT
"RTN","RCDPEM2",259,0)
 I FLG S RCRECTDA=$O(^RCY(344,"B",RECEPT,0))
"RTN","RCDPEM2",260,0)
 I 'RCRECTDA G FMSX
"RTN","RCDPEM2",261,0)
 ;Get FMS document number
"RTN","RCDPEM2",262,0)
 S FMSDOCNO=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPEM2",263,0)
 ;Ignore if not accepted
"RTN","RCDPEM2",264,0)
 I $P(FMSDOCNO,U,2)'="ACCEPTED BY FMS" G FMSX
"RTN","RCDPEM2",265,0)
 ;Otherwise can be linked
"RTN","RCDPEM2",266,0)
 S RES=1
"RTN","RCDPEM2",267,0)
FMSX ;
"RTN","RCDPEM2",268,0)
 Q RES
"RTN","RCDPEM2",269,0)
 ;
"RTN","RCDPEM2",270,0)
DATE(RECEPT) ;
"RTN","RCDPEM2",271,0)
 N RCRECTDA
"RTN","RCDPEM2",272,0)
 ;Get receipt IEN
"RTN","RCDPEM2",273,0)
 S RCRECTDA=$O(^RCY(344,"B",RECEPT,0)) Q:'RCRECTDA 0
"RTN","RCDPEM2",274,0)
 ;Return Receipt date
"RTN","RCDPEM2",275,0)
 Q $P($G(^RCY(344,RCRECTDA,0)),U,3)
"RTN","RCDPEM2",276,0)
 ;
"RTN","RCDPEM2",277,0)
AMT(RECEPT) ;Total Receipt amount
"RTN","RCDPEM2",278,0)
 N RCRECTDA,RCTRAN,RCTOT
"RTN","RCDPEM2",279,0)
 ;Get receipt IEN
"RTN","RCDPEM2",280,0)
 S RCRECTDA=$O(^RCY(344,"B",RECEPT,0)) Q:'RCRECTDA 0
"RTN","RCDPEM2",281,0)
 ;Total the Receipt transactions
"RTN","RCDPEM2",282,0)
 S RCTRAN=0,RCTOT=0
"RTN","RCDPEM2",283,0)
 F  S RCTRAN=$O(^RCY(344,RCRECTDA,1,RCTRAN)) Q:'RCTRAN  D
"RTN","RCDPEM2",284,0)
 .S RCTOT=RCTOT+$P($G(^RCY(344,RCRECTDA,1,RCTRAN,0)),U,4)
"RTN","RCDPEM2",285,0)
 Q RCTOT
"RTN","RCDPEM2",286,0)
 ;
"RTN","RCDPEM2",287,0)
CHQ(RECEPT,BILL) ;Get check number for this bill
"RTN","RCDPEM2",288,0)
 N RCRECTDA,RCTRAN,RCCHK,PATBILL
"RTN","RCDPEM2",289,0)
 ;Get receipt IEN
"RTN","RCDPEM2",290,0)
 S RCRECTDA=$O(^RCY(344,"B",RECEPT,0)) Q:'RCRECTDA ""
"RTN","RCDPEM2",291,0)
 ;Scan Receipt looking for this bill IEN
"RTN","RCDPEM2",292,0)
 S RCTRAN=0,RCCHK=""
"RTN","RCDPEM2",293,0)
 F  S RCTRAN=$O(^RCY(344,RCRECTDA,1,RCTRAN)) Q:'RCTRAN  D  Q:RCCHK]""
"RTN","RCDPEM2",294,0)
 .;Check for match on bill IEN
"RTN","RCDPEM2",295,0)
 .S PATBILL=$P($G(^RCY(344,RCRECTDA,1,RCTRAN,0)),U,3)
"RTN","RCDPEM2",296,0)
 .;Ignore Patient pointers or null field
"RTN","RCDPEM2",297,0)
 .Q:$P(PATBILL,";",2)'="PRCA(430,"
"RTN","RCDPEM2",298,0)
 .;Compare bill IEN399 to IEN430
"RTN","RCDPEM2",299,0)
 .Q:$P(PATBILL,";")'=BILL
"RTN","RCDPEM2",300,0)
 .;Get check number for this line
"RTN","RCDPEM2",301,0)
 .S RCCHK=$P($G(^RCY(344,RCRECTDA,1,RCTRAN,0)),U,7)
"RTN","RCDPEM2",302,0)
 Q RCCHK
"RTN","RCDPEM2",303,0)
 ;
"RTN","RCDPEM2",304,0)
 ;; End PRCA*4.5*276 - PJH
"RTN","RCDPEM2",305,0)
 ;
"RTN","RCDPEM2",306,0)
MATCH3 ; Manually 'match' a 0-balance ERA that has no check or EFT
"RTN","RCDPEM2",307,0)
 N DUOUT,DTOUT,DA,DR,DIE,DIC,DIR,X,Y,RCERA,RCRCPT
"RTN","RCDPEM2",308,0)
 W !,"THIS OPTION WILL ALLOW YOU TO MANUALLY MARK A 0-BALANCE ERA WITH NO",!,"CHECK OR EFT AS 'MATCH-0 PAYMENT' TO REMOVE IT FROM THE ERA AGING REPORT"
"RTN","RCDPEM2",309,0)
M3 S DIR("A")="SELECT THE UNMATCHED 0-BALANCE ERA TO MARK AS MATCHED: "
"RTN","RCDPEM2",310,0)
 S DIR(0)="PAO^RCY(344.4,:AEMQ",DIR("S")="I '$P(^(0),U,9),'$P(^(0),U,5)"
"RTN","RCDPEM2",311,0)
 W ! D ^DIR K DIR
"RTN","RCDPEM2",312,0)
 I $D(DUOUT)!$D(DTOUT)!(Y'>0) G M3Q
"RTN","RCDPEM2",313,0)
 S RCERA=+Y
"RTN","RCDPEM2",314,0)
 W !
"RTN","RCDPEM2",315,0)
 S DIC="^RCY(344.4,",DR="0",DA=RCERA D EN^DIQ
"RTN","RCDPEM2",316,0)
 W !
"RTN","RCDPEM2",317,0)
 S DIR("A")="ARE YOU SURE THIS IS THE ERA YOU WANT TO MARK AS MATCH-0 PAYMENT?: ",DIR(0)="YA",DIR("B")="YES" D ^DIR K DIR
"RTN","RCDPEM2",318,0)
 I $D(DUOUT)!$D(DTOUT) G M3Q
"RTN","RCDPEM2",319,0)
 I Y'=1 G M3
"RTN","RCDPEM2",320,0)
 S DIE="^RCY(344.4,",DR=".09////3",DA=RCERA D ^DIE
"RTN","RCDPEM2",321,0)
 S DIR(0)="EA",DIR("A")="ERA #"_RCERA_" WAS "_$S('$D(Y):"SUCCESSFULLY",1:"NOT")_" MARKED AS MATCH-0 PAYMENT" D ^DIR K DIR
"RTN","RCDPEM2",322,0)
M3Q Q
"RTN","RCDPEM2",323,0)
 ;
"RTN","RCDPEM2",324,0)
UNMATCH ; Used to 'unmatch' an ERA matched in error
"RTN","RCDPEM2",325,0)
 N X,Y,DIR,DIC,DIE,DIK,DA,DR,RCWL,RCEFT,RCQUIT
"RTN","RCDPEM2",326,0)
 S DIC(0)="AEMQ",DIC="^RCY(344.4,",DIC("S")="I '$P(^(0),U,8),$S('$P(^(0),U,14):1,1:$P(^(0),U,9)=3),$P(^(0),U,9)" D ^DIC K DIC
"RTN","RCDPEM2",327,0)
 Q:Y'>0
"RTN","RCDPEM2",328,0)
 S RCWL=+Y,RCQUIT=0
"RTN","RCDPEM2",329,0)
 I $D(^RCY(344.49,RCWL,0)) D  Q:RCQUIT
"RTN","RCDPEM2",330,0)
 . S DIR(0)="YA",DIR("A",1)="THIS ERA ALREADY HAS A WORKLIST ENTRY AND MUST BE DELETED BEFORE IT CAN BE UNMATCHED",DIR("A")="DO YOU WANT TO DELETE THE WORKLIST ENTRY FOR THIS ERA NOW?: "
"RTN","RCDPEM2",331,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEM2",332,0)
 . I Y'=1 S RCQUIT=1 Q
"RTN","RCDPEM2",333,0)
 . S DIK="^RCY(344.49,",DA=RCWL D ^DIK
"RTN","RCDPEM2",334,0)
 I $O(^RCY(344.31,"AERA",RCWL,0)) S RCEFT=+$O(^(0)) D  Q:RCQUIT
"RTN","RCDPEM2",335,0)
 . S DIR("A",1)="THIS ERA IS MATCHED TO EFT #"_RCEFT,DIR("A")="ARE YOU SURE YOU WANT TO UNMATCH THEM?: ",DIR(0)="YA"
"RTN","RCDPEM2",336,0)
 . W ! D ^DIR K DIR
"RTN","RCDPEM2",337,0)
 . I Y'=1 S RCQUIT=1 Q
"RTN","RCDPEM2",338,0)
 . S DIE="^RCY(344.31,",DR=".1///@;.08////0",DA=RCEFT D ^DIE
"RTN","RCDPEM2",339,0)
 . W !,"EFT #"_RCEFT_" IS NOW UNMATCHED",!
"RTN","RCDPEM2",340,0)
 S DIE="^RCY(344.4,",DR=".09////0;.13///@;.14////0",DA=RCWL D ^DIE
"RTN","RCDPEM2",341,0)
 S DIR("A")="ERA HAS BEEN SUCCESSFULLY UNMATCHED - PRESS RETURN TO CONTINUE "
"RTN","RCDPEM2",342,0)
 S DIR(0)="EA" W ! D ^DIR K DIR
"RTN","RCDPEM2",343,0)
 Q
"RTN","RCDPEM2",344,0)
 ;
"RTN","RCDPEM2",345,0)
 ;
"RTN","RCDPEM2",346,0)
 ; PRCA*4.5*284 - Changed option name from 'Mark ERA Return to Payer' to 'Remove ERA from Active Worklist'
"RTN","RCDPEM2",347,0)
RETN ; Entrypoint for Remove ERA from Active Worklist
"RTN","RCDPEM2",348,0)
 N DIR,X,Y,DTOUT,DUOUT,DIC,RCY,DIE,DA,DR,MSG,%
"RTN","RCDPEM2",349,0)
 D OWNSKEY^XUSRB(.MSG,"RCDPE MARK ERA",DUZ)
"RTN","RCDPEM2",350,0)
 I 'MSG(0) W !!,"SORRY, YOU ARE NOT AUTHORIZED TO USE THIS OPTION",!,"This option is locked with RCDPE MARK ERA key.",! S DIR(0)="E" D ^DIR K DIR Q
"RTN","RCDPEM2",351,0)
 ; PRCA*4.5*284 - Changed description
"RTN","RCDPEM2",352,0)
 W !!,"Use this option to remove an ERA from the EEOB Worklist that should not have"
"RTN","RCDPEM2",353,0)
 W !,"been sent to your site by the payer; or the ERA cannot be removed off the"
"RTN","RCDPEM2",354,0)
 W !,"Worklist using the 'Update ERA Posted Using Paper EOB' option."
"RTN","RCDPEM2",355,0)
 W !!,"This option is only to be used if the paper check has been sent back to the"
"RTN","RCDPEM2",356,0)
 W !,"payer without being deposited.  Once removed, the ERA can no longer be"
"RTN","RCDPEM2",357,0)
 W !,"accessed for processing, but can be viewed under the posted Worklist. For"
"RTN","RCDPEM2",358,0)
 W !,"auditing purposes, this option requires the user to enter a reason for"
"RTN","RCDPEM2",359,0)
 W !,"removing the ERA.",!
"RTN","RCDPEM2",360,0)
 S DIC="^RCY(344.4,",DIC(0)="AEMQ",DIC("S")="I '$P(^(0),U,9),'$P(^(0),U,14)" D ^DIC K DIC
"RTN","RCDPEM2",361,0)
 Q:Y'>0
"RTN","RCDPEM2",362,0)
 S RCY=+Y
"RTN","RCDPEM2",363,0)
 S DIR(0)="YA",DIR("A",1)="THIS WILL REMOVE THE ERA # "_+Y_" FROM THE ACTIVE WORKLIST",DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE? " W ! D ^DIR K DIR
"RTN","RCDPEM2",364,0)
 W !
"RTN","RCDPEM2",365,0)
 I $D(DUOUT)!$D(DTOUT)!(Y=0) D NOCHNG Q
"RTN","RCDPEM2",366,0)
 S DIE="^RCY(344.4,",DA=RCY,DR=".18" D ^DIE
"RTN","RCDPEM2",367,0)
 I $D(Y) D NOCHNG Q
"RTN","RCDPEM2",368,0)
 ; PRCA*4.5*284 Set EFT MATCH STATUS (#344.4,.09) as '4' FOR REMOVED rather than '2' FOR MATCHED TO PAPER CHECK
"RTN","RCDPEM2",369,0)
 D NOW^%DTC S DR=".14////4;.09////4;.16////"_DUZ_";.17////"_% D ^DIE
"RTN","RCDPEM2",370,0)
 S DIR(0)="EA",DIR("A")="PRESS RETURN TO CONTINUE"
"RTN","RCDPEM2",371,0)
 W ! D ^DIR
"RTN","RCDPEM2",372,0)
 Q
"RTN","RCDPEM2",373,0)
 ;
"RTN","RCDPEM2",374,0)
NOCHNG ;
"RTN","RCDPEM2",375,0)
 N DIR,X,Y,DTOUT,DUOUT
"RTN","RCDPEM2",376,0)
 D EN^DDIOL("NO CHANGES HAVE BEEN MADE.","","!")
"RTN","RCDPEM2",377,0)
 S DIR(0)="EA",DIR("A")="PRESS RETURN TO CONTINUE: "
"RTN","RCDPEM2",378,0)
 W !! D ^DIR
"RTN","RCDPEM2",379,0)
 Q
"RTN","RCDPEM3")
0^13^B110558911^B109331342
"RTN","RCDPEM3",1,0)
RCDPEM3 ;OIFO-BAYPINES/RBN - ERA AUDIT REPORT and return EFT function ;8/15/11 11:26am
"RTN","RCDPEM3",2,0)
 ;;4.5;Accounts Receivable;**276,284**;Mar 20, 1995;Build 35
"RTN","RCDPEM3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM3",4,0)
 ;
"RTN","RCDPEM3",5,0)
 ; General read access of IB EOB file #361.1 is allowed from AR (IA 4051)
"RTN","RCDPEM3",6,0)
 Q
"RTN","RCDPEM3",7,0)
 ;
"RTN","RCDPEM3",8,0)
 ; PRCA*4.5*284 - Changed report name from 'Mark ERA returned to Payer' to 'Remove ERA from active worklist'
"RTN","RCDPEM3",9,0)
 ;
"RTN","RCDPEM3",10,0)
 ; DESCRIPTION : The following generates an audit report that displays all ERAs
"RTN","RCDPEM3",11,0)
 ;               that have been removed from the worklist.  The user can select
"RTN","RCDPEM3",12,0)
 ;               several filters with which to limit the number of ERAs displayed:
"RTN","RCDPEM3",13,0)
 ;                 * Station/Division - the default is all.
"RTN","RCDPEM3",14,0)
 ;                 * Date Range       - the default is all.
"RTN","RCDPEM3",15,0)
 ;                 * Start Date       - no default, P:Date removed from worklistr;R:Date ERA Received;B:Both Dates.
"RTN","RCDPEM3",16,0)
 ;                 
"RTN","RCDPEM3",17,0)
 ; INPUTS      : The user is prompted for the Station/Division.
"RTN","RCDPEM3",18,0)
 ;               The user is prompted for the Date/Time range
"RTN","RCDPEM3",19,0)
 ;               The user is prompted for the Start Date.
"RTN","RCDPEM3",20,0)
 ;
"RTN","RCDPEM3",21,0)
 ; OUTPUTS     : A report which displays returned ERAs.  The report has the following
"RTN","RCDPEM3",22,0)
 ;               headings:
"RTN","RCDPEM3",23,0)
 ;                 * User name - The name of the user who performed the transaction.
"RTN","RCDPEM3",24,0)
 ;                 * Date/Time ERA received from the payer.
"RTN","RCDPEM3",25,0)
 ;                 * Date/Time ERA removed from worklist.
"RTN","RCDPEM3",26,0)
 ;                 * Freetext justification for returning the ERA to payer.
"RTN","RCDPEM3",27,0)
 ;                 * ERA number.
"RTN","RCDPEM3",28,0)
 ;                 * Trace number.
"RTN","RCDPEM3",29,0)
 ;                 * Dollar amount of ERA.
"RTN","RCDPEM3",30,0)
 ;                 * Payer name.
"RTN","RCDPEM3",31,0)
 ;
"RTN","RCDPEM3",32,0)
 ; LOCAL VARIABLES: RCNAME   - Name of user who performed transaction.
"RTN","RCDPEM3",33,0)
 ;                  RCDTRV   - Date/time ERA was received from payer.
"RTN","RCDPEM3",34,0)
 ;                  RCDTMK   - Date/time ERA was marked as removed
"RTN","RCDPEM3",35,0)
 ;                  RCJUST   - Justification for removal of ERA from EEOB worklist (free text).
"RTN","RCDPEM3",36,0)
 ;                  RCERA    - The ERA number.
"RTN","RCDPEM3",37,0)
 ;                  RCTRACE  - The ERA trace number.
"RTN","RCDPEM3",38,0)
 ;                  RCTOT    - Total dollar amount of the ERA.
"RTN","RCDPEM3",39,0)
 ;                  RCPNAM   - Payer name of the ERA.
"RTN","RCDPEM3",40,0)
 ;                  RCSTDIV  - Station/Division.
"RTN","RCDPEM3",41,0)
 ;                  RCDTRNG  - Date/Time range of report (an array: range_flag^start_date^end_date).
"RTN","RCDPEM3",42,0)
 ;                  RCDISP   - Display/print/Excel flag.
"RTN","RCDPEM3",43,0)
 ;                  RCPAGE   - Current page number of the report.
"RTN","RCDPEM3",44,0)
 ;                  RCPRB    - Selected Start Date (W:Date Removed from Worklsit;R:Date ERA Received;B:Both Dates).
"RTN","RCDPEM3",45,0)
 ;                  FileMan  - Several standard FileMan variables (v.gr. DIR,DIC,etc..
"RTN","RCDPEM3",46,0)
 ;                  Misc.    - X, Y, I and other used for counters and temp values.
"RTN","RCDPEM3",47,0)
 ;
"RTN","RCDPEM3",48,0)
 ; GLOBALS        : ^RCY(344.4 - ELECTRONIC REMITTANCE ADVICE file (#344.4).
"RTN","RCDPEM3",49,0)
 ;                  ^TMP($J,"RCDPEM3",LINE #) - Report data (body of report).  Data structure:
"RTN","RCDPEM3",50,0)
 ;      
"RTN","RCDPEM3",51,0)
 ; STATION NAME^STATION #^TRACE #^PAYER^DEPOSIT #^DATE REMOVED^USER^REMOVE REASON^ERA #^ERA DATE^T0TAL AMOUNT
"RTN","RCDPEM3",52,0)
 ;
"RTN","RCDPEM3",53,0)
EN ; Main entry point for ERA Audit Report
"RTN","RCDPEM3",54,0)
 N RCDTRNG,RCRANGE,RCDIV,RCSTA,RCDISP,RCPAGE,STANUM,STANAM,RCSTART,RCEND,RCSTOP,RCPG,RCIND,I,RCSTN,RCPRB
"RTN","RCDPEM3",55,0)
 N %ZIS,POP,VAUTD,ZTDESC,ZTRTN,ZTSAVE
"RTN","RCDPEM3",56,0)
 ;
"RTN","RCDPEM3",57,0)
 S (RCSTART,RCEND,RCSTOP,RCPG,RCPRB)=0
"RTN","RCDPEM3",58,0)
 S RCRANGE="0^^"
"RTN","RCDPEM3",59,0)
 S RCDTRNG=0
"RTN","RCDPEM3",60,0)
 S RCPAGE=0
"RTN","RCDPEM3",61,0)
 S RCIND=1
"RTN","RCDPEM3",62,0)
 ; PRCA*4.5*276 - Modify Header display
"RTN","RCDPEM3",63,0)
 S RCDIV="ALL"
"RTN","RCDPEM3",64,0)
 S RCPRB=$$DTPRB^RCDPEM4()
"RTN","RCDPEM3",65,0)
 I RCPRB=0 G EXIT
"RTN","RCDPEM3",66,0)
 S RCRANGE=$$DTRNG^RCDPEM4()
"RTN","RCDPEM3",67,0)
 I RCRANGE=0 G EXIT
"RTN","RCDPEM3",68,0)
 S RCSTART=$P(RCRANGE,U,2),RCEND=$P(RCRANGE,U,3)
"RTN","RCDPEM3",69,0)
 D DIVISION^VAUTOMA Q:Y=-1
"RTN","RCDPEM3",70,0)
 I 'VAUTD&($D(VAUTD)'=11) G EXIT
"RTN","RCDPEM3",71,0)
 I VAUTD=0 D
"RTN","RCDPEM3",72,0)
 .S (I,RCDIV)="" F  S I=$O(VAUTD(I)) Q:'I  S RCDIV=RCDIV_", "_VAUTD(I)
"RTN","RCDPEM3",73,0)
 .S RCDIV=$E(RCDIV,3,$L(RCDIV))
"RTN","RCDPEM3",74,0)
 .Q
"RTN","RCDPEM3",75,0)
 S RCDISP=$$DISPTY() G:+RCDISP=-1 EXIT
"RTN","RCDPEM3",76,0)
 I $D(DUOUT)!$D(DTOUT) G EXIT
"RTN","RCDPEM3",77,0)
 I RCDISP D INFO^RCDPEM6
"RTN","RCDPEM3",78,0)
 S:'VAUTD RCIND=RCIND+1
"RTN","RCDPEM3",79,0)
 S:$P($G(RCRANGE),U)>0 RCIND=RCIND+3
"RTN","RCDPEM3",80,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPEM3",81,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPEM3",82,0)
 . S ZTRTN="ENRPT^RCDPEM3"
"RTN","RCDPEM3",83,0)
 . S ZTDESC="ERA's Removed from Active Worklist Audit Report"
"RTN","RCDPEM3",84,0)
 . S ZTSAVE("RC*")="",ZTSAVE("VAUTD")=""
"RTN","RCDPEM3",85,0)
 . D ^%ZTLOAD
"RTN","RCDPEM3",86,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEM3",87,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEM3",88,0)
 U IO
"RTN","RCDPEM3",89,0)
 ;
"RTN","RCDPEM3",90,0)
ENRPT ;
"RTN","RCDPEM3",91,0)
 D REPRT
"RTN","RCDPEM3",92,0)
 D DISP(RCDISP)
"RTN","RCDPEM3",93,0)
 D EXIT
"RTN","RCDPEM3",94,0)
 Q
"RTN","RCDPEM3",95,0)
 ;
"RTN","RCDPEM3",96,0)
DISPTY() ; Get display/output type
"RTN","RCDPEM3",97,0)
 ; INPUTS   : User input from keyboard
"RTN","RCDPEM3",98,0)
 ; RETURNS  : Output destination (0=Display; 1=MS Excel)
"RTN","RCDPEM3",99,0)
 ; LOCAL VARIABLES :
"RTN","RCDPEM3",100,0)
 ; DIR,DUOUT - Standard FileMan variables
"RTN","RCDPEM3",101,0)
 ; Y         - User input
"RTN","RCDPEM3",102,0)
 N DIR,DUOUT,Y
"RTN","RCDPEM3",103,0)
 S DIR(0)="Y"
"RTN","RCDPEM3",104,0)
 S DIR("A")="EXPORT THE REPORT TO Microsoft Excel (Y/N): "
"RTN","RCDPEM3",105,0)
 S DIR("B")="NO"
"RTN","RCDPEM3",106,0)
 D ^DIR K DIR
"RTN","RCDPEM3",107,0)
 I $D(DUOUT)!$D(DIRUT) S Y=-1
"RTN","RCDPEM3",108,0)
 Q Y
"RTN","RCDPEM3",109,0)
 ;
"RTN","RCDPEM3",110,0)
ERASTA(ERAIEN) ; Get the station for this ERA (ERAIEN = ien of the ERA in question)
"RTN","RCDPEM3",111,0)
 ; INPUTS :  ERAIEN - ien of the ERA in question.
"RTN","RCDPEM3",112,0)
 ; LOCAL VARIABLES:
"RTN","RCDPEM3",113,0)
 ; ERAEOB  - EOB corresponding to the ERA
"RTN","RCDPEM3",114,0)
 ; ERABILL - Bill corresponding to the ERA
"RTN","RCDPEM3",115,0)
 ; STA     - IEN of the Station of the ERA, or -1 if not found
"RTN","RCDPEM3",116,0)
 N ERAEOB,ERABILL,STA,STNAM,STNUM
"RTN","RCDPEM3",117,0)
 S (ERAEOB,ERABILL,STA,STNAM,STNUM)=""
"RTN","RCDPEM3",118,0)
 S STA=-1,STNUM=""
"RTN","RCDPEM3",119,0)
 I ERAIEN D
"RTN","RCDPEM3",120,0)
 . S ERAEOB=$P($G(^RCY(344.4,ERAIEN,1,1,0)),U,2) Q:'ERAEOB
"RTN","RCDPEM3",121,0)
 . S ERABILL=$P($G(^IBM(361.1,ERAEOB,0)),U,1) Q:'ERABILL
"RTN","RCDPEM3",122,0)
 . S STA=$P(^DGCR(399,ERABILL,0),U,22) Q:'STA
"RTN","RCDPEM3",123,0)
 . S STNAM=$$EXTERNAL^DILFD(399,.22,,STA)
"RTN","RCDPEM3",124,0)
 . S STNUM=$P($G(^DG(40.8,STA,0)),U,2) ;IA 417
"RTN","RCDPEM3",125,0)
 S:$G(STNAM)="" STNAM="UNKNOWN",STNUM="UNKNOWN"
"RTN","RCDPEM3",126,0)
 S STNAM=STNAM_"^"_STNUM
"RTN","RCDPEM3",127,0)
 Q STNAM
"RTN","RCDPEM3",128,0)
 ;
"RTN","RCDPEM3",129,0)
REPRT ; Generate the report ^TMP array
"RTN","RCDPEM3",130,0)
 ; INPUTS : None
"RTN","RCDPEM3",131,0)
 ; LOCAL VARIABLES:
"RTN","RCDPEM3",132,0)
 ; DTIEN  - IEN of ERA from "E" index (date/time)
"RTN","RCDPEM3",133,0)
 ; DTERA  - Date ERA received
"RTN","RCDPEM3",134,0)
 ; START  - Start date of report date range
"RTN","RCDPEM3",135,0)
 ; END    - End date of report date range
"RTN","RCDPEM3",136,0)
 ; ERAIEN - IEN of ERA
"RTN","RCDPEM3",137,0)
 ; STANAM - Name of Station/Division
"RTN","RCDPEM3",138,0)
 ; STANUM - Station/Division number
"RTN","RCDPEM3",139,0)
 ; RCPRB  - Start date (W:Date Removed from Worklist;R:Date ERA Received;B:Both Dates)
"RTN","RCDPEM3",140,0)
 N DTIEN,START,END,ERAIEN,X1,X2,X,DTERA
"RTN","RCDPEM3",141,0)
 K ^TMP($J,"RCDPEM3")
"RTN","RCDPEM3",142,0)
 S (DTIEN,ERAIEN)=""
"RTN","RCDPEM3",143,0)
 ; If user picked W:Date Removed from Worklist OR B:Both Dates, use index "AD"
"RTN","RCDPEM3",144,0)
 I (RCPRB="W")!(RCPRB="B") D
"RTN","RCDPEM3",145,0)
 . S DTIEN=$P(RCRANGE,U,1)
"RTN","RCDPEM3",146,0)
 . S END=$P(RCRANGE,U,3)
"RTN","RCDPEM3",147,0)
 . S START=$P(RCRANGE,U,2)
"RTN","RCDPEM3",148,0)
 . F  S DTIEN=$O(^RCY(344.4,"AD",DTIEN)) Q:'DTIEN!(DTIEN\1>END)  D
"RTN","RCDPEM3",149,0)
 . . F  S ERAIEN=$O(^RCY(344.4,"AD",DTIEN,ERAIEN)) Q:'ERAIEN  D
"RTN","RCDPEM3",150,0)
 . . . Q:'$D(^RCY(344.4,ERAIEN,6))
"RTN","RCDPEM3",151,0)
 . . . I (START'>DTIEN\1)&(DTIEN\1'>END) D PROC(ERAIEN)
"RTN","RCDPEM3",152,0)
 ; If user picked R:Date ERA Received OR B:Both Dates, use index "AC"
"RTN","RCDPEM3",153,0)
 S (DTIEN,ERAIEN)=""
"RTN","RCDPEM3",154,0)
 I (RCPRB="R")!(RCPRB="B") D
"RTN","RCDPEM3",155,0)
 . S END=$P(RCRANGE,U,3)
"RTN","RCDPEM3",156,0)
 . S START=$P(RCRANGE,U,2)
"RTN","RCDPEM3",157,0)
 . F  S DTIEN=$O(^RCY(344.4,"AC",DTIEN)) Q:'DTIEN  D
"RTN","RCDPEM3",158,0)
 . . F  S ERAIEN=$O(^RCY(344.4,"AC",DTIEN,ERAIEN)) Q:'ERAIEN  D
"RTN","RCDPEM3",159,0)
 . . . Q:'$D(^RCY(344.4,ERAIEN,6))
"RTN","RCDPEM3",160,0)
 . . . Q:$D(^TMP($J,"RCDPEM3",$P(^RCY(344.4,ERAIEN,0),U,1)))  ;data is in ^TMP global
"RTN","RCDPEM3",161,0)
 . . . S DTERA=$P($G(^RCY(344.4,ERAIEN,0)),U,4)\1 Q:'DTERA 
"RTN","RCDPEM3",162,0)
 . . . I START>DTERA Q
"RTN","RCDPEM3",163,0)
 . . . I END<DTERA Q
"RTN","RCDPEM3",164,0)
 . . . D PROC(ERAIEN)
"RTN","RCDPEM3",165,0)
 Q
"RTN","RCDPEM3",166,0)
 ;
"RTN","RCDPEM3",167,0)
DISP(RCDISP) ; Format the display for screen/printer or MS Excel
"RTN","RCDPEM3",168,0)
 ; INPUTS  : RCDISP -  Display/print/Excel flag.
"RTN","RCDPEM3",169,0)
 ; RETURNS : Nothing - builds the actual report
"RTN","RCDPEM3",170,0)
 ; LOCAL VARIABLES: IEN - line number of the data in ^TMP (see above)
"RTN","RCDPEM3",171,0)
 N IEN,LEN,RCNAM
"RTN","RCDPEM3",172,0)
 D HDR(RCDISP)
"RTN","RCDPEM3",173,0)
 S IEN=0
"RTN","RCDPEM3",174,0)
 ; PRCA*4.5*276 - Modify Display
"RTN","RCDPEM3",175,0)
 F  S IEN=$O(^TMP($J,"RCDPEM3",IEN)) Q:'IEN!RCSTOP  D
"RTN","RCDPEM3",176,0)
 . I 'RCDISP D
"RTN","RCDPEM3",177,0)
 . . W !
"RTN","RCDPEM3",178,0)
 . . I $Y>(IOSL-5) D HDR(RCDISP) Q:RCSTOP
"RTN","RCDPEM3",179,0)
 . . ; W $P(^TMP($J,"RCDPEM3",IEN),U,2),! Trace#
"RTN","RCDPEM3",180,0)
 . . W $P(^TMP($J,"RCDPEM3",IEN),U,3) ;ERA
"RTN","RCDPEM3",181,0)
 . . W ?15,$P(^TMP($J,"RCDPEM3",IEN),U,2),! ; Payer Name
"RTN","RCDPEM3",182,0)
 . . W ?5,$P(^TMP($J,"RCDPEM3",IEN),U,4)
"RTN","RCDPEM3",183,0)
 . . W ?29,$P(^TMP($J,"RCDPEM3",IEN),U,5) ; Date Time Removed
"RTN","RCDPEM3",184,0)
 . . W ?46,$P(^TMP($J,"RCDPEM3",IEN),U,6) ; ERA Rec
"RTN","RCDPEM3",185,0)
 . . S RCNAM=$P(^TMP($J,"RCDPEM3",IEN),U,7) ; Tot Paid
"RTN","RCDPEM3",186,0)
 . . W ?58,$E(RCNAM,1,19),! ; User who removed
"RTN","RCDPEM3",187,0)
 . . S A=$P(^TMP($J,"RCDPEM3",IEN),U,8)
"RTN","RCDPEM3",188,0)
 . . D WP(A)
"RTN","RCDPEM3",189,0)
 . I RCDISP D
"RTN","RCDPEM3",190,0)
 . . W !,^TMP($J,"RCDPEM3",IEN)
"RTN","RCDPEM3",191,0)
 W !
"RTN","RCDPEM3",192,0)
 W !,"******** END OF REPORT ********",!
"RTN","RCDPEM3",193,0)
 Q
"RTN","RCDPEM3",194,0)
 ;
"RTN","RCDPEM3",195,0)
PROC(ERAIEN) ;  Put the actual data into the ^TMP global based on filters.
"RTN","RCDPEM3",196,0)
 ; INPUTS : ERAIEN  - ERAIEN = ien of the ERA in question
"RTN","RCDPEM3",197,0)
 ; RETURNS: Nothing - Builds each entry in the ^TMP global
"RTN","RCDPEM3",198,0)
 ; LOCAL VARIABLES :
"RTN","RCDPEM3",199,0)
 ; ERAEOB - EOB corresponding to this ERA
"RTN","RCDPEM3",200,0)
 ; RCDIV  - Name of station
"RTN","RCDPEM3",201,0)
 ; STNUM  - Station number
"RTN","RCDPEM3",202,0)
 ; DTERA  - Date of ERA
"RTN","RCDPEM3",203,0)
 ; DTRTN  - Date ERA removed from worklist
"RTN","RCDPEM3",204,0)
 ; JUST   - Justification for removal of ERA
"RTN","RCDPEM3",205,0)
 ; TRACE  - Trace number of the ERA
"RTN","RCDPEM3",206,0)
 ; AMT    - Total amount of the ERA
"RTN","RCDPEM3",207,0)
 ; PAYER  - ERA payer
"RTN","RCDPEM3",208,0)
 ; USER   - User who completed the removal of the ERA from the worklist
"RTN","RCDPEM3",209,0)
 ; Y      - Used for time conversion
"RTN","RCDPEM3",210,0)
 ; DEPO   - Amount of ERA deposit
"RTN","RCDPEM3",211,0)
 N STATION,ERAEOB,DTERA,DTRTN,JUST,TRACE,AMT,PAYER,USER,Y,DEPO,ERA,RCLOCDV,PAYER
"RTN","RCDPEM3",212,0)
 S RCSTA=$$ERASTA(ERAIEN)
"RTN","RCDPEM3",213,0)
 I $P(RCSTA,U)=-1 S RCSTA="UNKNOWN",RCSTN="UNKNOWN"
"RTN","RCDPEM3",214,0)
 E  S RCSTN=$P(RCSTA,U,2),RCSTA=$P(RCSTA,U,1)
"RTN","RCDPEM3",215,0)
 ; PRCA*4.5*276 - Modify Display
"RTN","RCDPEM3",216,0)
 Q:RCDIV'[RCSTA&(RCDIV'="ALL")
"RTN","RCDPEM3",217,0)
 S ERAEOB=$P($G(^RCY(344.4,ERAIEN,1,1,0)),U,2)
"RTN","RCDPEM3",218,0)
 S Y=$P(^RCY(344.4,ERAIEN,0),U,4)
"RTN","RCDPEM3",219,0)
 S DTERA=$$FMTE^XLFDT(Y,"2D")
"RTN","RCDPEM3",220,0)
 S USER=$P(^RCY(344.4,ERAIEN,6),U,1)
"RTN","RCDPEM3",221,0)
 S USER=$$NAME^XUSER(USER,"F")
"RTN","RCDPEM3",222,0)
 S Y=$P(^RCY(344.4,ERAIEN,6),U,2)
"RTN","RCDPEM3",223,0)
 ; D DD^%DT
"RTN","RCDPEM3",224,0)
 S DTRTN=$$FMTE^XLFDT(Y,2)
"RTN","RCDPEM3",225,0)
 S JUST=$P(^RCY(344.4,ERAIEN,6),U,3)
"RTN","RCDPEM3",226,0)
 S ERA=$P(^RCY(344.4,ERAIEN,0),U,1)
"RTN","RCDPEM3",227,0)
 S TRACE=$P(^RCY(344.4,ERAIEN,0),U,2)
"RTN","RCDPEM3",228,0)
 S AMT=$P(^RCY(344.4,ERAIEN,0),U,5)
"RTN","RCDPEM3",229,0)
 S PAYER=""
"RTN","RCDPEM3",230,0)
 S:ERAEOB PAYER=$P($G(^IBM(361.1,ERAEOB,0)),U,2)
"RTN","RCDPEM3",231,0)
 S:ERAEOB&($G(PAYER)) PAYER=$$EXTERNAL^DILFD(361.1,.02,,PAYER)
"RTN","RCDPEM3",232,0)
 I '$D(PAYER)!(PAYER="") S PAYER="UNKNOWN"
"RTN","RCDPEM3",233,0)
 S DEPO=$P($G(^RCY(344.1,ERAIEN,0)),U,8)
"RTN","RCDPEM3",234,0)
 S:DEPO DEPO=$P($G(^RCY(344,DEPO,0)),U,6)
"RTN","RCDPEM3",235,0)
 S:DEPO DEPO=$P($G(^RCY(344.1,DEPO,0)),U,1)
"RTN","RCDPEM3",236,0)
 S:'$G(DEPO) DEPO="UNKNOWN"
"RTN","RCDPEM3",237,0)
 ; PRCA*4.5*276 - Remove Trace# from Excel
"RTN","RCDPEM3",238,0)
 S ^TMP($J,"RCDPEM3",ERA)=RCSTA_"^"_PAYER_"^"_ERA_"^"_DTRTN_"^"_DTERA_"^"_AMT_"^"_USER_"^"_JUST
"RTN","RCDPEM3",239,0)
 Q
"RTN","RCDPEM3",240,0)
 ;
"RTN","RCDPEM3",241,0)
HDR(RCDISP) ; Print the report header
"RTN","RCDPEM3",242,0)
 ; INPUTS   : RCDISP - Display/print/Excel flag
"RTN","RCDPEM3",243,0)
 ; RETURNS  : Nothing - Displays the report header to the screen formatted for type of output selected
"RTN","RCDPEM3",244,0)
 ; LOCAL VARIABLES :
"RTN","RCDPEM3",245,0)
 ; MSG  - Array containing the header data.
"RTN","RCDPEM3",246,0)
 ; DATE - The date of the report
"RTN","RCDPEM3",247,0)
 ; Y,%  - Used for date conversion
"RTN","RCDPEM3",248,0)
 N MSG,DATE,Y,%,Z,END,START
"RTN","RCDPEM3",249,0)
 S END=$P(RCRANGE,U,3)
"RTN","RCDPEM3",250,0)
 S START=$P(RCRANGE,U,2)
"RTN","RCDPEM3",251,0)
 ; PRCA*4.5*284 - Modify headers
"RTN","RCDPEM3",252,0)
 I 'RCDISP D
"RTN","RCDPEM3",253,0)
 . I RCPAGE D ASK(.RCSTOP,0) Q:RCSTOP
"RTN","RCDPEM3",254,0)
 . S RCPAGE=RCPAGE+1
"RTN","RCDPEM3",255,0)
 . D NOW^%DTC
"RTN","RCDPEM3",256,0)
 . S Y=%
"RTN","RCDPEM3",257,0)
 . S DATE=$$FMTE^XLFDT(Y,2)
"RTN","RCDPEM3",258,0)
 . W @IOF
"RTN","RCDPEM3",259,0)
 . W "                                                                                "
"RTN","RCDPEM3",260,0)
 . S Z="             ERAs Removed from Active Worklist - Audit Report            Page "_RCPAGE
"RTN","RCDPEM3",261,0)
 . W $J("",80-$L(Z)\2),Z,!
"RTN","RCDPEM3",262,0)
 . S Z="DIVISIONS: "_RCDIV W $J("",80-$L(Z)\2),Z,!
"RTN","RCDPEM3",263,0)
 . S Z="Run Date/Time:  "_DATE W $J("",80-$L(Z)\2),Z,!
"RTN","RCDPEM3",264,0)
 . S Z="DATE RANGE: "_$P($$FMTE^XLFDT(START,2),"@")_" - "_$P($$FMTE^XLFDT(END,2),"@")
"RTN","RCDPEM3",265,0)
 . S Z=Z_" ("_$S(RCPRB="B":"Received & Removed",RCPRB="W":"Date Removed from Worklist",1:"Date ERA Received")_")"
"RTN","RCDPEM3",266,0)
 . W $J("",80-$L(Z)\2),Z,!
"RTN","RCDPEM3",267,0)
 . W !
"RTN","RCDPEM3",268,0)
 . W "ERA#           Payer Name",!
"RTN","RCDPEM3",269,0)
 . W "    Date/Time                Date ERA         Total Amt   User Who",!
"RTN","RCDPEM3",270,0)
 . W "    Removed                  Received         Paid        Removed",!
"RTN","RCDPEM3",271,0)
 . W "================================================================================"
"RTN","RCDPEM3",272,0)
 I RCDISP D
"RTN","RCDPEM3",273,0)
 . W "STATION NAME^PAYER^ERA NUMBER^DATE REMOVED^DATE RECEIVED^AMOUNT^USER^REMOVED REASON"
"RTN","RCDPEM3",274,0)
 Q
"RTN","RCDPEM3",275,0)
 ;
"RTN","RCDPEM3",276,0)
PAUSE ;  Pause the display until the user presses enter/return
"RTN","RCDPEM3",277,0)
 ; Straight FileMan call and variables - See FileMan documentation
"RTN","RCDPEM3",278,0)
 N DIR,DUOUT
"RTN","RCDPEM3",279,0)
 S DIR(0)="E"
"RTN","RCDPEM3",280,0)
 D ^DIR K DIR
"RTN","RCDPEM3",281,0)
 I $D(DUOUT) G EXIT
"RTN","RCDPEM3",282,0)
 Q
"RTN","RCDPEM3",283,0)
 ;
"RTN","RCDPEM3",284,0)
EXIT ; Gracefully exit
"RTN","RCDPEM3",285,0)
 ; Kills off any remaining variables and resets output device
"RTN","RCDPEM3",286,0)
 ;
"RTN","RCDPEM3",287,0)
 D ^%ZISC
"RTN","RCDPEM3",288,0)
 K X,STNAM,STNUM,^TMP($J,"RCDPEM3")
"RTN","RCDPEM3",289,0)
 Q
"RTN","RCDPEM3",290,0)
 ;
"RTN","RCDPEM3",291,0)
WP(A,T) ; Pretty print the justification comments
"RTN","RCDPEM3",292,0)
 ; INPUTS   : A - Justification text
"RTN","RCDPEM3",293,0)
 ; RETURNS  : Nothing - Displays the justification comments on display nicely formatted
"RTN","RCDPEM3",294,0)
 ;
"RTN","RCDPEM3",295,0)
 K ^UTILITY($J,"W")
"RTN","RCDPEM3",296,0)
 N JUST,X,DIWL,DIWR,DIWF
"RTN","RCDPEM3",297,0)
 S JUST=A
"RTN","RCDPEM3",298,0)
 ; PRCA*4.5*284- Change 'Justification Comments' to 'Removed Reason'
"RTN","RCDPEM3",299,0)
 ;
"RTN","RCDPEM3",300,0)
 W "Removed Reason:  "
"RTN","RCDPEM3",301,0)
 I $L(JUST)<62 W JUST,!
"RTN","RCDPEM3",302,0)
 E  D
"RTN","RCDPEM3",303,0)
 . S X=JUST,DIWL=18,DIWR=78,DIWF="W"
"RTN","RCDPEM3",304,0)
 . D ^DIWP,^DIWW
"RTN","RCDPEM3",305,0)
 Q
"RTN","RCDPEM3",306,0)
 ;
"RTN","RCDPEM3",307,0)
RETN ; Entry point for remove EFT
"RTN","RCDPEM3",308,0)
 N DIR,X,Y,DTOUT,DIC,RCY,DIE,DA,DR,MSG,%,RCYDISP
"RTN","RCDPEM3",309,0)
 D OWNSKEY^XUSRB(.MSG,"RCDPE REMOVE DUPLICATES",DUZ)
"RTN","RCDPEM3",310,0)
 I 'MSG(0) W !,"SORRY, YOU ARE NOT AUTHORIZED TO USE THIS OPTION",! S DIR(0)="E" D ^DIR K DIR Q
"RTN","RCDPEM3",311,0)
 W !!,"          WARNING: REMOVING AN EFT IS **NOT** REVERSIBLE"
"RTN","RCDPEM3",312,0)
 W !,"  USE THIS OPTION ONLY IF YOU ARE SURE YOU WANT TO REMOVE THIS EFT."
"RTN","RCDPEM3",313,0)
 W !,"PLEASE BE AWARE THAT ONCE AN EFT IS REMOVED --- IT CANNOT BE RESTORED.",!!
"RTN","RCDPEM3",314,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RCDPEM3",315,0)
 S DIR("A")="Are you sure you want to continue"
"RTN","RCDPEM3",316,0)
 D ^DIR K DIR
"RTN","RCDPEM3",317,0)
 I $D(DUOUT)!$D(DTOUT)!'Y Q
"RTN","RCDPEM3",318,0)
 S DIC="^RCY(344.31,"
"RTN","RCDPEM3",319,0)
 S DIC(0)="AEMQ",DIC("S")="I '$P(^(0),U,8)"
"RTN","RCDPEM3",320,0)
 D ^DIC K DIC
"RTN","RCDPEM3",321,0)
 S RCY=+Y
"RTN","RCDPEM3",322,0)
 Q:RCY=-1
"RTN","RCDPEM3",323,0)
 S RCYDISP=$P(^RCY(344.31,RCY,0),U) ; Get the actual EFT number
"RTN","RCDPEM3",324,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","RCDPEM3",325,0)
 S DIR("A",1)="THIS WILL MARK THE EFT # "_+RCYDISP_" AS REMOVED"
"RTN","RCDPEM3",326,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: "
"RTN","RCDPEM3",327,0)
 W !
"RTN","RCDPEM3",328,0)
 D ^DIR K DIR
"RTN","RCDPEM3",329,0)
 I $D(DUOUT)!$D(DTOUT)!(Y=0) D NOCHNG Q
"RTN","RCDPEM3",330,0)
 S DIE="^RCY(344.31,",DA=RCY,DR=".19" D ^DIE
"RTN","RCDPEM3",331,0)
 I $D(Y) D NOCHNG Q
"RTN","RCDPEM3",332,0)
 D NOW^%DTC S DR=".08////1;.17////"_DUZ_";.18////"_% D ^DIE
"RTN","RCDPEM3",333,0)
 W !!
"RTN","RCDPEM3",334,0)
 S DIR(0)="EA"
"RTN","RCDPEM3",335,0)
 S DIR("A")="PRESS RETURN TO CONTINUE"
"RTN","RCDPEM3",336,0)
 S DIR("A",1)="EFT # "_RCYDISP_" HAS BEEN MARKED AS REMOVED"
"RTN","RCDPEM3",337,0)
 D ^DIR
"RTN","RCDPEM3",338,0)
 Q
"RTN","RCDPEM3",339,0)
 ;
"RTN","RCDPEM3",340,0)
ASK(STOP,MODE) ; Ask to continue
"RTN","RCDPEM3",341,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEM3",342,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEM3",343,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEM3",344,0)
 S:MODE DIR("A")="Enter RETURN to finish"
"RTN","RCDPEM3",345,0)
 S DIR(0)="E" W ! D ^DIR K DIR
"RTN","RCDPEM3",346,0)
 I ($D(DIRUT))!($D(DUOUT)) S STOP=1 Q
"RTN","RCDPEM3",347,0)
 Q
"RTN","RCDPEM3",348,0)
 ;
"RTN","RCDPEM3",349,0)
TEXT ; Filtered by messages
"RTN","RCDPEM3",350,0)
 ;;No Filters Applied
"RTN","RCDPEM3",351,0)
 ;;Station/Division
"RTN","RCDPEM3",352,0)
 ;;
"RTN","RCDPEM3",353,0)
 ;;Date Range
"RTN","RCDPEM3",354,0)
 ;;Station/Division, Date Range
"RTN","RCDPEM3",355,0)
 ;;Payer
"RTN","RCDPEM3",356,0)
 ;;Station/Division, Payer
"RTN","RCDPEM3",357,0)
 ;;
"RTN","RCDPEM3",358,0)
 ;;Date Range, Payer
"RTN","RCDPEM3",359,0)
 ;;Station/Division, Date Range, Payer
"RTN","RCDPEM3",360,0)
 Q
"RTN","RCDPEM3",361,0)
 ;
"RTN","RCDPEM3",362,0)
NOCHNG ;
"RTN","RCDPEM3",363,0)
 N DIR,X,Y,DTOUT,DUOUT
"RTN","RCDPEM3",364,0)
 S DIR(0)="EA"
"RTN","RCDPEM3",365,0)
 S DIR("A")="PRESS RETURN TO CONTINUE: "
"RTN","RCDPEM3",366,0)
 S DIR("A",1)="***  This EFT was NOT Removed."
"RTN","RCDPEM3",367,0)
 W !! D ^DIR
"RTN","RCDPEM3",368,0)
 Q
"RTN","RCDPEM4")
0^14^B186253544^B186028415
"RTN","RCDPEM4",1,0)
RCDPEM4 ;OIFO-BAYPINES/PJH - EPAYMENTS AUDIT REPORTS ;9/8/11 3:33pm
"RTN","RCDPEM4",2,0)
 ;;4.5;Accounts Receivable;**276,284**;Mar 20, 1995;Build 35
"RTN","RCDPEM4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM4",4,0)
 ;
"RTN","RCDPEM4",5,0)
EOB ; Main entry point for EOB Move/Copy Report
"RTN","RCDPEM4",6,0)
 N RTYPE
"RTN","RCDPEM4",7,0)
 S RTYPE="EOB"
"RTN","RCDPEM4",8,0)
 D EN1
"RTN","RCDPEM4",9,0)
 Q
"RTN","RCDPEM4",10,0)
 ;
"RTN","RCDPEM4",11,0)
POST ; Main entry point for ERA Posted with Paper EOB Report
"RTN","RCDPEM4",12,0)
 N RTYPE
"RTN","RCDPEM4",13,0)
 S RTYPE="ERA"
"RTN","RCDPEM4",14,0)
 D EN1
"RTN","RCDPEM4",15,0)
 Q
"RTN","RCDPEM4",16,0)
 ;
"RTN","RCDPEM4",17,0)
EN1 ;collect filter and device options
"RTN","RCDPEM4",18,0)
 N RCDTRNG,RCRANGE,RCDIV,RCSTA,RCDISP,RCPAGE,STANUM,STANAM,X,Y
"RTN","RCDPEM4",19,0)
 N %ZIS,ZTSK,ZTDESC,ZTSAVE,ZTQUEUED,ZTRTN,POP,RCPROG,VAUTD
"RTN","RCDPEM4",20,0)
 ;Initialize page and start point
"RTN","RCDPEM4",21,0)
 S (RCDTRNG,RCPAGE)=0,RCPROG="RCDPEM4"
"RTN","RCDPEM4",22,0)
 ;Select Date Range for Report
"RTN","RCDPEM4",23,0)
 S RCRANGE=$$DTRNG() Q:RCRANGE=0
"RTN","RCDPEM4",24,0)
 ;Select Filter/Sort by Division
"RTN","RCDPEM4",25,0)
 D STADIV Q:RCDIV=0
"RTN","RCDPEM4",26,0)
 ;Select Display Type
"RTN","RCDPEM4",27,0)
 S RCDISP=$$DISPTY() Q:RCDISP=-1
"RTN","RCDPEM4",28,0)
 ;Display capture information for Excel
"RTN","RCDPEM4",29,0)
 I RCDISP D INFO^RCDPEM6
"RTN","RCDPEM4",30,0)
 ;Select output device
"RTN","RCDPEM4",31,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPEM4",32,0)
 ;Option to queue
"RTN","RCDPEM4",33,0)
 I 'RCDISP,$D(IO("Q")) D  Q
"RTN","RCDPEM4",34,0)
 .S ZTRTN="REPORT^RCDPEM4"
"RTN","RCDPEM4",35,0)
 .S ZTDESC="EDI LOCKBOX PAPER EOB AUDIT REPORT"
"RTN","RCDPEM4",36,0)
 .S ZTSAVE("RC*")="",ZTSAVE("RTYPE")="",ZTSAVE("VAUTD")=""
"RTN","RCDPEM4",37,0)
 .D ^%ZTLOAD
"RTN","RCDPEM4",38,0)
 .I $D(ZTSK) W !!,"Your task number "_ZTSK_" has been queued."
"RTN","RCDPEM4",39,0)
 .E  W !!,"Unable to queue this job."
"RTN","RCDPEM4",40,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEM4",41,0)
 ;
"RTN","RCDPEM4",42,0)
 ;Compile and Print Report
"RTN","RCDPEM4",43,0)
 D REPORT
"RTN","RCDPEM4",44,0)
 Q
"RTN","RCDPEM4",45,0)
 ;
"RTN","RCDPEM4",46,0)
REPORT ;Compile and print report
"RTN","RCDPEM4",47,0)
 K ^TMP(RCPROG,$J)
"RTN","RCDPEM4",48,0)
 ;Scan ERA file for entries in date range
"RTN","RCDPEM4",49,0)
 I RTYPE="ERA" D COMPILE
"RTN","RCDPEM4",50,0)
 ;Scan EOB file for entries in date range
"RTN","RCDPEM4",51,0)
 I RTYPE="EOB" D COMPILE1
"RTN","RCDPEM4",52,0)
 ;Display Report
"RTN","RCDPEM4",53,0)
 D DISP
"RTN","RCDPEM4",54,0)
 ;Clear workfile
"RTN","RCDPEM4",55,0)
 K ^TMP(RCPROG,$J)
"RTN","RCDPEM4",56,0)
 Q
"RTN","RCDPEM4",57,0)
 ;
"RTN","RCDPEM4",58,0)
COMPILE ;Generate the ERA posted with paper EOB report ^TMP array
"RTN","RCDPEM4",59,0)
 N START,END,ERAIEN,STA,STNAM,STNUM
"RTN","RCDPEM4",60,0)
 ;Date Range
"RTN","RCDPEM4",61,0)
 S START=0,END="9999999",SUB=0
"RTN","RCDPEM4",62,0)
 S:$P(RCRANGE,U) START=$P(RCRANGE,U,2),END=$P(RCRANGE,U,3)
"RTN","RCDPEM4",63,0)
 ;Selected division or All
"RTN","RCDPEM4",64,0)
 ;Scan AFL index for ERA within date range
"RTN","RCDPEM4",65,0)
 F  S START=$O(^RCY(344.4,"AFL",START)) Q:'START  Q:(START\1)>END  D
"RTN","RCDPEM4",66,0)
 .S ERAIEN=""
"RTN","RCDPEM4",67,0)
 .F  S ERAIEN=$O(^RCY(344.4,"AFL",START,ERAIEN)) Q:'ERAIEN  D
"RTN","RCDPEM4",68,0)
 ..;Ignore if not posted with paper EOB
"RTN","RCDPEM4",69,0)
 ..Q:'$D(^RCY(344.4,ERAIEN,7))
"RTN","RCDPEM4",70,0)
 ..;Check division
"RTN","RCDPEM4",71,0)
 ..D ERASTA(ERAIEN,.STA,.STNUM,.STNAM)
"RTN","RCDPEM4",72,0)
 ..I RCDIV=2,'$D(VAUTD(STA)) Q
"RTN","RCDPEM4",73,0)
 ..;Save to workfile
"RTN","RCDPEM4",74,0)
 ..D SAVE(ERAIEN,STA,STNUM,STNAM)
"RTN","RCDPEM4",75,0)
 ;
"RTN","RCDPEM4",76,0)
 Q
"RTN","RCDPEM4",77,0)
 ;
"RTN","RCDPEM4",78,0)
SAVE(ERAIEN,STA,STNUM,STNAM) ;Put the data into the ^TMP global
"RTN","RCDPEM4",79,0)
 ; INPUTS: ERAIEN = ien of the ERA
"RTN","RCDPEM4",80,0)
 ;         STNUM= station IEN
"RTN","RCDPEM4",81,0)
 ; RETURNS  : Builds each entry in the ^TMP global
"RTN","RCDPEM4",82,0)
 ;
"RTN","RCDPEM4",83,0)
 N SUB,GLOB,CNT,USER,DATE,Y,DEPO,ERA,REC0,REC7,MATCH,POST
"RTN","RCDPEM4",84,0)
 S REC0=$G(^RCY(344.4,ERAIEN,0))
"RTN","RCDPEM4",85,0)
 S REC7=$G(^RCY(344.4,ERAIEN,7))
"RTN","RCDPEM4",86,0)
 ;User marked ERA as posted to paper EOB
"RTN","RCDPEM4",87,0)
 S USER=$P(REC7,U,2)
"RTN","RCDPEM4",88,0)
 S USER=$$NAME^XUSER(USER,"F")
"RTN","RCDPEM4",89,0)
 ;Date/Time ERA was marked posted 
"RTN","RCDPEM4",90,0)
 S DATE=$$FMTE^XLFDT($P(REC7,U),"2S")
"RTN","RCDPEM4",91,0)
 ;ERA number
"RTN","RCDPEM4",92,0)
 S ERA=$P(REC0,U)
"RTN","RCDPEM4",93,0)
 ;Deposit
"RTN","RCDPEM4",94,0)
 S DEPO=$P(REC0,U,8),DEPO=$$EXTERNAL^DILFD(344.4,.08,,DEPO)
"RTN","RCDPEM4",95,0)
 ;EFT Match Status
"RTN","RCDPEM4",96,0)
 S MATCH=$P(REC0,U,9),MATCH=$$EXTERNAL^DILFD(344.4,.09,,MATCH)
"RTN","RCDPEM4",97,0)
 ;Detail Post Status
"RTN","RCDPEM4",98,0)
 S POST=$P(REC0,U,14),POST=$$EXTERNAL^DILFD(344.4,.14,,POST)
"RTN","RCDPEM4",99,0)
 ;Update workfile
"RTN","RCDPEM4",100,0)
 S SUB=$S(RCDIV=2:"DIV",1:"ALL"),GLOB=$NA(^TMP(RCPROG,$J))
"RTN","RCDPEM4",101,0)
 ;sorting is done in EXCEL - else use STA as subscript
"RTN","RCDPEM4",102,0)
 S CNT=$G(@GLOB@(SUB))+1,@GLOB@(SUB)=CNT
"RTN","RCDPEM4",103,0)
 S @GLOB@(SUB,CNT)=STNAM_U_STNUM_U_DATE_U_USER_U_ERA_U_DEPO_U_MATCH_U_POST
"RTN","RCDPEM4",104,0)
 Q
"RTN","RCDPEM4",105,0)
 ;
"RTN","RCDPEM4",106,0)
COMPILE1 ;Generate the EOB Moved/Copy report ^TMP array
"RTN","RCDPEM4",107,0)
 N DTSUB,START,END,EOBIEN,IEN101,STA,STNAM,STNUM
"RTN","RCDPEM4",108,0)
 ;Date Range
"RTN","RCDPEM4",109,0)
 S START=0,END="9999999"
"RTN","RCDPEM4",110,0)
 S:$P(RCRANGE,U) START=$P(RCRANGE,U,2),END=$P(RCRANGE,U,3)
"RTN","RCDPEM4",111,0)
 ;Selected division or All
"RTN","RCDPEM4",112,0)
 ;Scan AEOB index for EOB within date range
"RTN","RCDPEM4",113,0)
 F  S START=$O(^IBM(361.1,"AEOB",START)) Q:'START  Q:(START\1)>END  D
"RTN","RCDPEM4",114,0)
 .S EOBIEN=""
"RTN","RCDPEM4",115,0)
 .F  S EOBIEN=$O(^IBM(361.1,"AEOB",START,EOBIEN)) Q:'EOBIEN  D
"RTN","RCDPEM4",116,0)
 ..;Ignore if not MOVED/COPIED
"RTN","RCDPEM4",117,0)
 ..S IEN101=$O(^IBM(361.1,"AEOB",START,EOBIEN,"")) Q:'IEN101
"RTN","RCDPEM4",118,0)
 ..;Check division
"RTN","RCDPEM4",119,0)
 ..D EOBSTA(EOBIEN,.STA,.STNUM,.STNAM)
"RTN","RCDPEM4",120,0)
 ..I RCDIV=2,'$D(VAUTD(STA)) Q
"RTN","RCDPEM4",121,0)
 ..;Save to workfile
"RTN","RCDPEM4",122,0)
 ..D SAVE1(EOBIEN,IEN101,STA,STNUM,STNAM)
"RTN","RCDPEM4",123,0)
 Q
"RTN","RCDPEM4",124,0)
 ;
"RTN","RCDPEM4",125,0)
 ;
"RTN","RCDPEM4",126,0)
SAVE1(EOBIEN,IEN101,STA,STNUM,STNAM) ;Put the data into the ^TMP global
"RTN","RCDPEM4",127,0)
 ; INPUTS: EOBIEN = ien of the EOB
"RTN","RCDPEM4",128,0)
 ;         STNUM= station ien
"RTN","RCDPEM4",129,0)
 ; RETURNS  : Builds each entry in the ^TMP global
"RTN","RCDPEM4",130,0)
 ;
"RTN","RCDPEM4",131,0)
 N GLOB,CNT,SUB
"RTN","RCDPEM4",132,0)
 N USER,DATE,Y,DEPO,REC101,JUST,ORIG,TRACE,ERA,PAYAMT,OTHER,NBILL,X,ACTION
"RTN","RCDPEM4",133,0)
 S REC101=$G(^IBM(361.1,EOBIEN,101,IEN101,0))
"RTN","RCDPEM4",134,0)
 ;User who did MOVE/COPY
"RTN","RCDPEM4",135,0)
 S USER=$P(REC101,U,2)
"RTN","RCDPEM4",136,0)
 S USER=$$NAME^XUSER(USER,"F")
"RTN","RCDPEM4",137,0)
 ;Date/Time ERA was marked posted 
"RTN","RCDPEM4",138,0)
 S DATE=$$FMTE^XLFDT($P(REC101,U),"2S")
"RTN","RCDPEM4",139,0)
 ;Justification comment
"RTN","RCDPEM4",140,0)
 S JUST=$P(REC101,U,3)
"RTN","RCDPEM4",141,0)
 ;Moved or Copied
"RTN","RCDPEM4",142,0)
 S ACTION=$S($P(REC101,U,5)="C":"COPIED",$P(REC101,U,5)="M":"MOVED",1:"")
"RTN","RCDPEM4",143,0)
 ;Original bill pointer
"RTN","RCDPEM4",144,0)
 S ORIG=$P(REC101,U,4)
"RTN","RCDPEM4",145,0)
 ;Ignore if original bill is null (this is EOB copied from)
"RTN","RCDPEM4",146,0)
 Q:'ORIG
"RTN","RCDPEM4",147,0)
 ;Get claim number from pointer
"RTN","RCDPEM4",148,0)
 S ORIG=$$EXTERNAL^DILFD(361.1,.01,,ORIG)
"RTN","RCDPEM4",149,0)
 S X=$O(^PRCA(430,"D",ORIG,""))
"RTN","RCDPEM4",150,0)
 I $G(X) S X=$P($G(^PRCA(430,X,0)),U) I X'="" S ORIG=$TR(X,"-","")
"RTN","RCDPEM4",151,0)
 ;New Bill (only displayed for a move)
"RTN","RCDPEM4",152,0)
 S NBILL=$$EXTERNAL^DILFD(361.1,.01,,$P($G(^IBM(361.1,EOBIEN,0)),U))
"RTN","RCDPEM4",153,0)
 ;Paid Amount
"RTN","RCDPEM4",154,0)
 S PAYAMT=$P($G(^IBM(361.1,EOBIEN,1)),U)
"RTN","RCDPEM4",155,0)
 ;Trace Number
"RTN","RCDPEM4",156,0)
 S TRACE=$P($G(^IBM(361.1,EOBIEN,0)),U,7),ERA=""
"RTN","RCDPEM4",157,0)
 ;ERA number
"RTN","RCDPEM4",158,0)
 S:TRACE]"" ERA=$O(^RCY(344.4,"D",TRACE,""))
"RTN","RCDPEM4",159,0)
 ;Other bill numbers
"RTN","RCDPEM4",160,0)
 S OTHER=$$OTHER(EOBIEN,IEN101)
"RTN","RCDPEM4",161,0)
 ;
"RTN","RCDPEM4",162,0)
 ;Update workfile
"RTN","RCDPEM4",163,0)
 S SUB=$S(RCDIV=2:"DIV",1:"ALL"),GLOB=$NA(^TMP(RCPROG,$J))
"RTN","RCDPEM4",164,0)
 ;sorting is done in EXCEL - else use STA as subscript
"RTN","RCDPEM4",165,0)
 S CNT=$G(@GLOB@(SUB))+1,@GLOB@(SUB)=CNT
"RTN","RCDPEM4",166,0)
 S @GLOB@(SUB,CNT)=STNAM_U_STNUM_U_DATE_U_USER_U_ORIG_U_NBILL_U_ERA
"RTN","RCDPEM4",167,0)
 S @GLOB@(SUB,CNT)=@GLOB@(SUB,CNT)_U_TRACE_U_PAYAMT_U_JUST_U_OTHER_U_ACTION
"RTN","RCDPEM4",168,0)
 Q
"RTN","RCDPEM4",169,0)
 ;
"RTN","RCDPEM4",170,0)
OTHER(EOBIEN,IEN101) ;Build list of bill numbers
"RTN","RCDPEM4",171,0)
 N SUB,NBILL,STR,FOUND
"RTN","RCDPEM4",172,0)
 S SUB=0,FOUND=0,STR=""
"RTN","RCDPEM4",173,0)
 F  S SUB=$O(^IBM(361.1,EOBIEN,101,IEN101,1,SUB)) Q:'SUB  D
"RTN","RCDPEM4",174,0)
 .S NBILL=$G(^IBM(361.1,EOBIEN,101,IEN101,1,SUB,0)) Q:'NBILL
"RTN","RCDPEM4",175,0)
 .S NBILL=$$EXTERNAL^DILFD(361.1,.01,,NBILL)
"RTN","RCDPEM4",176,0)
 .I FOUND S STR=STR_", "
"RTN","RCDPEM4",177,0)
 .S STR=STR_NBILL,FOUND=1
"RTN","RCDPEM4",178,0)
 S:'FOUND STR=STR_"NONE"
"RTN","RCDPEM4",179,0)
 Q STR
"RTN","RCDPEM4",180,0)
 ;
"RTN","RCDPEM4",181,0)
DISP ; Format the display for screen/printer or MS Excel
"RTN","RCDPEM4",182,0)
 N FILTER,IEN,RCSTOP,SUB
"RTN","RCDPEM4",183,0)
 ;
"RTN","RCDPEM4",184,0)
 ;Open device
"RTN","RCDPEM4",185,0)
 U IO
"RTN","RCDPEM4",186,0)
 ;
"RTN","RCDPEM4",187,0)
 ;Report by division or 'ALL'
"RTN","RCDPEM4",188,0)
 ;Format Division Filter
"RTN","RCDPEM4",189,0)
 S FILTER=$S(RTYPE="EOB":"ALL STATIONS/DIVISIONS",1:"ALL") I RCDIV=2 S FILTER=$$LINE(.VAUTD)
"RTN","RCDPEM4",190,0)
 S SUB="",RCSTOP=0
"RTN","RCDPEM4",191,0)
 F  S SUB=$O(^TMP(RCPROG,$J,SUB)) Q:SUB=""  D  Q:RCSTOP
"RTN","RCDPEM4",192,0)
 .;Display Header
"RTN","RCDPEM4",193,0)
 .D HDR(RCDISP,RTYPE,.VAUTD)
"RTN","RCDPEM4",194,0)
 .;
"RTN","RCDPEM4",195,0)
 .S IEN=""
"RTN","RCDPEM4",196,0)
 .F  S IEN=$O(^TMP(RCPROG,$J,SUB,IEN)) Q:'IEN  D  Q:RCSTOP
"RTN","RCDPEM4",197,0)
 ..I 'RCDISP D  Q:RCSTOP
"RTN","RCDPEM4",198,0)
 ...;ERA posted with paper EOB
"RTN","RCDPEM4",199,0)
 ...I RTYPE="ERA" D
"RTN","RCDPEM4",200,0)
 ....I $Y>(IOSL-3) D HDR(RCDISP,RTYPE,.VAUTD) Q:RCSTOP
"RTN","RCDPEM4",201,0)
 ....W !,$P(^TMP(RCPROG,$J,SUB,IEN),U,5) ;ERA#
"RTN","RCDPEM4",202,0)
 ....W ?11,$P(^TMP(RCPROG,$J,SUB,IEN),U,6) ;RECEIPT#
"RTN","RCDPEM4",203,0)
 ....W ?23,$P(^TMP(RCPROG,$J,SUB,IEN),U,3) ;DATE/TIME
"RTN","RCDPEM4",204,0)
 ....W ?41,$P(^TMP(RCPROG,$J,SUB,IEN),U,4) ;USER LASTNAME,FIRSTNAME
"RTN","RCDPEM4",205,0)
 ....W ?57,$P(^TMP(RCPROG,$J,SUB,IEN),U,7) ;MATCH STATUS
"RTN","RCDPEM4",206,0)
 ....W !,?61,$P(^TMP(RCPROG,$J,SUB,IEN),U,8) ;POST STATUS
"RTN","RCDPEM4",207,0)
 ...;EOB Moved/Copied
"RTN","RCDPEM4",208,0)
 ...I RTYPE="EOB" D
"RTN","RCDPEM4",209,0)
 ....I $Y>(IOSL-6) D HDR(RCDISP,RTYPE,.VAUTD) Q:RCSTOP
"RTN","RCDPEM4",210,0)
 ....W !,$P(^TMP(RCPROG,$J,SUB,IEN),U,5) ;ORIGINAL BILL
"RTN","RCDPEM4",211,0)
 ....W ?20,$P(^TMP(RCPROG,$J,SUB,IEN),U,8) ;TRACE
"RTN","RCDPEM4",212,0)
 ....W !?6,$P(^TMP(RCPROG,$J,SUB,IEN),U,7) ;ERA
"RTN","RCDPEM4",213,0)
 ....W ?15,$P(^TMP(RCPROG,$J,SUB,IEN),U,3) ;DATE/TIME
"RTN","RCDPEM4",214,0)
 ....W ?35,$P(^TMP(RCPROG,$J,SUB,IEN),U,12) ;MOVED/COPIED
"RTN","RCDPEM4",215,0)
 ....W ?50,$P(^TMP(RCPROG,$J,SUB,IEN),U,9) ;PAYMENT AMOUNT
"RTN","RCDPEM4",216,0)
 ....W ?61,$P(^TMP(RCPROG,$J,SUB,IEN),U,4) ; USER LASTNAME,FIRSTNAME
"RTN","RCDPEM4",217,0)
 ....W !,"New Bill: ",$P(^TMP(RCPROG,$J,SUB,IEN),U,6) ;NEW BILL
"RTN","RCDPEM4",218,0)
 ....W ?25,"Other Bill Number(s): "
"RTN","RCDPEM4",219,0)
 ....W $P(^TMP(RCPROG,$J,SUB,IEN),U,11) ;OTHER BILLS
"RTN","RCDPEM4",220,0)
 ....N JUST,DIWL,DIWR,DIWF,X
"RTN","RCDPEM4",221,0)
 ....K ^UTILITY($J,"W")
"RTN","RCDPEM4",222,0)
 ....S JUST=$P(^TMP(RCPROG,$J,SUB,IEN),U,10)
"RTN","RCDPEM4",223,0)
 ....W !,"Justification Comments:  "
"RTN","RCDPEM4",224,0)
 ....I $L(JUST)<54 W JUST,!
"RTN","RCDPEM4",225,0)
 ....E  D
"RTN","RCDPEM4",226,0)
 .....S X=JUST,DIWL=26,DIWR=78,DIWF="W"
"RTN","RCDPEM4",227,0)
 .....D ^DIWP,^DIWW
"RTN","RCDPEM4",228,0)
 ..I RCDISP D
"RTN","RCDPEM4",229,0)
 ...W !,^TMP(RCPROG,$J,SUB,IEN)
"RTN","RCDPEM4",230,0)
 .;
"RTN","RCDPEM4",231,0)
 .I 'RCSTOP W !,"******** END OF REPORT ********",!
"RTN","RCDPEM4",232,0)
 ;
"RTN","RCDPEM4",233,0)
 I '$D(^TMP(RCPROG,$J))&(RTYPE="EOB")&('RCDISP) D
"RTN","RCDPEM4",234,0)
 .D HDR(0,RTYPE,.VAUTD)
"RTN","RCDPEM4",235,0)
 .W !!!!,?26,"*** NO RECORDS TO PRINT ***"
"RTN","RCDPEM4",236,0)
 ;
"RTN","RCDPEM4",237,0)
 I '$D(^TMP(RCPROG,$J))&(RTYPE="ERA")&('RCDISP) D
"RTN","RCDPEM4",238,0)
 .D HDR(0,RTYPE,.VAUTD)
"RTN","RCDPEM4",239,0)
 .W !!!!,?26,"*** NO RECORDS TO PRINT ***"
"RTN","RCDPEM4",240,0)
 ;Close device
"RTN","RCDPEM4",241,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEM4",242,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCDPEM4",243,0)
 Q
"RTN","RCDPEM4",244,0)
 ;
"RTN","RCDPEM4",245,0)
LINE(VAUTD) ;List selected stations
"RTN","RCDPEM4",246,0)
 N LINE,SUB
"RTN","RCDPEM4",247,0)
 S LINE="",SUB=""
"RTN","RCDPEM4",248,0)
 F  S SUB=$O(VAUTD(SUB)) Q:'SUB  D
"RTN","RCDPEM4",249,0)
 .S LINE=LINE_$G(VAUTD(SUB))_", "
"RTN","RCDPEM4",250,0)
 Q $E(LINE,1,$L(LINE)-2)
"RTN","RCDPEM4",251,0)
 ;
"RTN","RCDPEM4",252,0)
SELDIV(VAUTD,Z) ;Devisions are orginized as Z(1)="DIV1,DIV2,..., Z(2)="DIVN,DIVN+1,... etc.
"RTN","RCDPEM4",253,0)
 ; Input:
"RTN","RCDPEM4",254,0)
 ;   VAUTD (required/pass-by-ref) - Division(s) array; result of call to DIVISION^VAUTOMA
"RTN","RCDPEM4",255,0)
 ; Output:
"RTN","RCDPEM4",256,0)
 ;   Z (required/pass-by-ref) - reformatted array of divisions
"RTN","RCDPEM4",257,0)
 ;
"RTN","RCDPEM4",258,0)
 N SUB,CNT
"RTN","RCDPEM4",259,0)
 S CNT=1,Z(CNT)="DIVISIONS: "
"RTN","RCDPEM4",260,0)
 I $D(VAUTD)=1 D  Q
"RTN","RCDPEM4",261,0)
 . S Z(CNT)=Z(CNT)_"ALL"
"RTN","RCDPEM4",262,0)
 . S Z(CNT)=$J("",80-$L(Z(CNT))\2)_Z(CNT)
"RTN","RCDPEM4",263,0)
 I $D(VAUTD)>1,'VAUTD D
"RTN","RCDPEM4",264,0)
 . S SUB=VAUTD
"RTN","RCDPEM4",265,0)
 . F  S SUB=$O(VAUTD(SUB)) Q:'SUB  D
"RTN","RCDPEM4",266,0)
 . . I Z(CNT)="DIVISIONS: " S Z(CNT)=Z(CNT)_VAUTD(SUB) Q
"RTN","RCDPEM4",267,0)
 . . S Z(CNT)=Z(CNT)_$S(Z(CNT)]"":",",1:"")_VAUTD(SUB)
"RTN","RCDPEM4",268,0)
 . . I $L(Z(CNT))>50 D
"RTN","RCDPEM4",269,0)
 . . . S Z(CNT)=$J("",80-$L(Z(CNT))\2)_Z(CNT)
"RTN","RCDPEM4",270,0)
 . . . S CNT=CNT+1,Z(CNT)=""
"RTN","RCDPEM4",271,0)
 I Z(CNT)]"" D
"RTN","RCDPEM4",272,0)
 . S Z(CNT)=$J("",80-$L(Z(CNT))\2)_Z(CNT)
"RTN","RCDPEM4",273,0)
 I Z(CNT)="" K Z(CNT)
"RTN","RCDPEM4",274,0)
 Q
"RTN","RCDPEM4",275,0)
 ;
"RTN","RCDPEM4",276,0)
HDR(RCDISP,TYPE,VAUTD) ; Print the report header
"RTN","RCDPEM4",277,0)
 ; INPUTS: RCDISP - Display/print/Excel flag
"RTN","RCDPEM4",278,0)
 ;         TYPE - Report Type (EOB or ERA)
"RTN","RCDPEM4",279,0)
 N START,END,MSG,DATE,Y,%,DIV,SUB,Z0
"RTN","RCDPEM4",280,0)
 S START=$$FMTE^XLFDT($P(RCRANGE,U,2),2)
"RTN","RCDPEM4",281,0)
 S END=$$FMTE^XLFDT($P(RCRANGE,U,3),2)
"RTN","RCDPEM4",282,0)
 ;
"RTN","RCDPEM4",283,0)
 I 'RCDISP D
"RTN","RCDPEM4",284,0)
 .I RCPAGE D ASK(.RCSTOP,0) Q:RCSTOP
"RTN","RCDPEM4",285,0)
 .S RCPAGE=RCPAGE+1
"RTN","RCDPEM4",286,0)
 .D NOW^%DTC
"RTN","RCDPEM4",287,0)
 .S DATE=$$FMTE^XLFDT(%,"2S")
"RTN","RCDPEM4",288,0)
 .W @IOF
"RTN","RCDPEM4",289,0)
 .I TYPE="ERA" D
"RTN","RCDPEM4",290,0)
 ..S SUB=1
"RTN","RCDPEM4",291,0)
 ..S MSG(SUB)="ERAs Posted with Paper EOB - Audit Report",MSG(SUB)=$J("",80-$L(MSG(SUB))\2)_MSG(SUB)
"RTN","RCDPEM4",292,0)
 ..S MSG(SUB)=MSG(SUB)_"      Page: "_RCPAGE
"RTN","RCDPEM4",293,0)
 ..S SUB=SUB+1
"RTN","RCDPEM4",294,0)
 ..S MSG(SUB)="Run Date: "_DATE,MSG(SUB)=$J("",80-$L(MSG(SUB))\2)_MSG(SUB)
"RTN","RCDPEM4",295,0)
 ..D SELDIV(.VAUTD,.DIV)
"RTN","RCDPEM4",296,0)
 ..S DIV=0
"RTN","RCDPEM4",297,0)
 ..F  S DIV=$O(DIV(DIV)) Q:'DIV  D
"RTN","RCDPEM4",298,0)
 ...S SUB=SUB+1
"RTN","RCDPEM4",299,0)
 ...S MSG(SUB)=DIV(DIV)
"RTN","RCDPEM4",300,0)
 ..S SUB=SUB+1
"RTN","RCDPEM4",301,0)
 ..S MSG(SUB)="Date Range: "_START_" - "_END_" (DATE ERA UPDATED)",MSG(SUB)=$J("",80-$L(MSG(SUB))\2)_MSG(SUB)
"RTN","RCDPEM4",302,0)
 ..S SUB=SUB+1
"RTN","RCDPEM4",303,0)
 ..S MSG(SUB)=" ",SUB=SUB+1
"RTN","RCDPEM4",304,0)
 ..S MSG(SUB)="                       Date/Time         User Who        EFT Match Status"
"RTN","RCDPEM4",305,0)
 ..S SUB=SUB+1
"RTN","RCDPEM4",306,0)
 ..S MSG(SUB)="ERA #      Receipt #   ERA Updated       Updated             Detail Post Status"
"RTN","RCDPEM4",307,0)
 ..S SUB=SUB+1
"RTN","RCDPEM4",308,0)
 ..S MSG(SUB)="==============================================================================="
"RTN","RCDPEM4",309,0)
 .I TYPE="EOB" D
"RTN","RCDPEM4",310,0)
 ..S MSG(1)="                         EEOB Move/Copy - Audit Report "
"RTN","RCDPEM4",311,0)
 ..S MSG(1)=MSG(1)_"        Page: "_RCPAGE
"RTN","RCDPEM4",312,0)
 ..S MSG(2)="                        Run Date/Time: "_DATE
"RTN","RCDPEM4",313,0)
 ..S Z0=FILTER S:VAUTD=1 Z0="ALL" S Z0="DIVISIONS: "_Z0
"RTN","RCDPEM4",314,0)
 ..S MSG(3)=$S($L(Z0)<75:$J("",75-$L(Z0)\2),1:"")_Z0
"RTN","RCDPEM4",315,0)
 ..S MSG(4)="           Date Range: "_START_" - "_END_" (Date EEOB was Moved/Copied)"
"RTN","RCDPEM4",316,0)
 ..S MSG(5)=" "
"RTN","RCDPEM4",317,0)
 ..S MSG(6)="Orig Bill#          Trace #"
"RTN","RCDPEM4",318,0)
 ..S MSG(7)="                                                  Total Amt  User Who"
"RTN","RCDPEM4",319,0)
 ..S MSG(8)="     ERA #     Date/Time       Moved/Copied       Paid       Moved/Copied"
"RTN","RCDPEM4",320,0)
 ..S MSG(9)="=============================================================================="
"RTN","RCDPEM4",321,0)
 .D EN^DDIOL(.MSG)
"RTN","RCDPEM4",322,0)
 I RCDISP,TYPE="ERA" D
"RTN","RCDPEM4",323,0)
 .W !,"STATION^STATION NUMBER^DATE/TIME^USER^ERA^RECEIPT^MATCH STATUS^POSTED STATUS"
"RTN","RCDPEM4",324,0)
 I RCDISP,TYPE="EOB" D
"RTN","RCDPEM4",325,0)
 .W !,"STATION^STATION NUMBER^DATE/TIME^USER^ORIGINAL BILL^NEW BILL^ERA#^TRACE#^PAYMENT AMOUNT^JUSTIFICATION^OTHER BILLS^MOVED/COPIED"
"RTN","RCDPEM4",326,0)
 Q
"RTN","RCDPEM4",327,0)
 ;
"RTN","RCDPEM4",328,0)
ASK(STOP,MODE) ; Ask to continue
"RTN","RCDPEM4",329,0)
 ; If passed by reference ,RCSTOP is returned as 1 if print is aborted
"RTN","RCDPEM4",330,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEM4",331,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEM4",332,0)
 S:MODE=1 DIR("A")="Enter RETURN to finish"
"RTN","RCDPEM4",333,0)
 S DIR(0)="E" D ^DIR
"RTN","RCDPEM4",334,0)
 I ($D(DIRUT))!($D(DUOUT)) S STOP=1
"RTN","RCDPEM4",335,0)
 Q
"RTN","RCDPEM4",336,0)
 ;
"RTN","RCDPEM4",337,0)
INFO ;Useful Info for Excel capture
"RTN","RCDPEM4",338,0)
 W !!!,?10
"RTN","RCDPEM4",339,0)
 W "Before continuing, please set up your terminal to capture the"
"RTN","RCDPEM4",340,0)
 W !,?10
"RTN","RCDPEM4",341,0)
 W "detail report data. On some terminals, this can  be  done  by"
"RTN","RCDPEM4",342,0)
 W !,?10
"RTN","RCDPEM4",343,0)
 W "clicking  on the 'Tools' menu above, then click  on  'Capture"
"RTN","RCDPEM4",344,0)
 w !,?10
"RTN","RCDPEM4",345,0)
 W "Incoming  Data' to save to  Desktop. This  report  may take a"
"RTN","RCDPEM4",346,0)
 W !,?10
"RTN","RCDPEM4",347,0)
 W "while to run."
"RTN","RCDPEM4",348,0)
 W !!,?10
"RTN","RCDPEM4",349,0)
 W "Note: To avoid  undesired  wrapping of the data  saved to the"
"RTN","RCDPEM4",350,0)
 W !,?10
"RTN","RCDPEM4",351,0)
 W "      file, please enter '0;256;999' at the 'DEVICE:' prompt."
"RTN","RCDPEM4",352,0)
 W !!,?10
"RTN","RCDPEM4",353,0)
 W "      Also, set the terminal display width to 256 characters."
"RTN","RCDPEM4",354,0)
 W !,?10
"RTN","RCDPEM4",355,0)
 W "      On some terminals, this can be done by  clicking on the"
"RTN","RCDPEM4",356,0)
 W !,?10
"RTN","RCDPEM4",357,0)
 W "      'Setup' menu above, then click on  'Display' to  change"
"RTN","RCDPEM4",358,0)
 W !,?10
"RTN","RCDPEM4",359,0)
 W "      width to 256 characters"
"RTN","RCDPEM4",360,0)
 W !!
"RTN","RCDPEM4",361,0)
 Q
"RTN","RCDPEM4",362,0)
 ;
"RTN","RCDPEM4",363,0)
DTRNG() ; Get the date range for the report
"RTN","RCDPEM4",364,0)
 N DIR,DUOUT,RNGFLG,X,Y,RCSTART,RCEND
"RTN","RCDPEM4",365,0)
 D DATES(.RCSTART,.RCEND)
"RTN","RCDPEM4",366,0)
 Q:RCSTART=-1 0
"RTN","RCDPEM4",367,0)
 Q:RCSTART "1^"_RCSTART_"^"_RCEND
"RTN","RCDPEM4",368,0)
 Q:'RCSTART "0^^"
"RTN","RCDPEM4",369,0)
 Q 0
"RTN","RCDPEM4",370,0)
 ;
"RTN","RCDPEM4",371,0)
DATES(BDATE,EDATE) ;Get a date range.
"RTN","RCDPEM4",372,0)
 S (BDATE,EDATE)=0
"RTN","RCDPEM4",373,0)
 S DIR("?")="ENTER THE EARLIEST DATE OF RECEIPT OF DEPOSIT TO INCLUDE ON THE REPORT"
"RTN","RCDPEM4",374,0)
 S DIR(0)="DAO^:"_DT_":APE",DIR("A")="START DATE: " D ^DIR K DIR
"RTN","RCDPEM4",375,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") S BDATE=-1 Q
"RTN","RCDPEM4",376,0)
 S BDATE=Y
"RTN","RCDPEM4",377,0)
 S DIR("?")="ENTER THE LATEST DATE OF RECEIPT OF DEPOSIT TO INCLUDE ON THE REPORT"
"RTN","RCDPEM4",378,0)
 S DIR("B")=Y(0)
"RTN","RCDPEM4",379,0)
 S DIR(0)="DAO^"_BDATE_":"_DT_":APE",DIR("A")="END DATE: " D ^DIR K DIR
"RTN","RCDPEM4",380,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") S BDATE=-1 Q
"RTN","RCDPEM4",381,0)
 S EDATE=Y
"RTN","RCDPEM4",382,0)
 Q
"RTN","RCDPEM4",383,0)
 ;
"RTN","RCDPEM4",384,0)
STADIV ;Division/Station Filter/Sort
"RTN","RCDPEM4",385,0)
 ;
"RTN","RCDPEM4",386,0)
 ;Sort selection
"RTN","RCDPEM4",387,0)
 N DIR,DUOUT,Y
"RTN","RCDPEM4",388,0)
 S RCDIV=0
"RTN","RCDPEM4",389,0)
 ;
"RTN","RCDPEM4",390,0)
 ;Division selection - IA 664
"RTN","RCDPEM4",391,0)
 ;RETURNS Y=-1 (quit), Y=0 (for all),Y=1 (selected divisions in VAUTD)
"RTN","RCDPEM4",392,0)
 D DIVISION^VAUTOMA Q:Y<0
"RTN","RCDPEM4",393,0)
 ;
"RTN","RCDPEM4",394,0)
 ;If ALL selected
"RTN","RCDPEM4",395,0)
 I Y=0 S RCDIV=1 Q
"RTN","RCDPEM4",396,0)
 ;If some DIVISIONS selected
"RTN","RCDPEM4",397,0)
 S RCDIV=2
"RTN","RCDPEM4",398,0)
 Q
"RTN","RCDPEM4",399,0)
 ;
"RTN","RCDPEM4",400,0)
DISPTY() ; Get display/output type
"RTN","RCDPEM4",401,0)
 N DIR,DUOUT,Y
"RTN","RCDPEM4",402,0)
 S DIR(0)="Y"
"RTN","RCDPEM4",403,0)
 S DIR("A")="Export the report to Microsoft Excel"
"RTN","RCDPEM4",404,0)
 S DIR("B")="NO"
"RTN","RCDPEM4",405,0)
 D ^DIR I $G(DUOUT) Q -1
"RTN","RCDPEM4",406,0)
 Q Y
"RTN","RCDPEM4",407,0)
 ;
"RTN","RCDPEM4",408,0)
ERASTA(ERAIEN,STA,STNUM,STNAM) ; Get the station for this ERA
"RTN","RCDPEM4",409,0)
 ;Allowed read on 399 via IA 3820
"RTN","RCDPEM4",410,0)
 N ERAEOB,ERABILL,STAIEN
"RTN","RCDPEM4",411,0)
 S (ERAEOB,ERABILL)=""
"RTN","RCDPEM4",412,0)
 S (STA,STNUM,STNAM)="UNKNOWN"
"RTN","RCDPEM4",413,0)
 D
"RTN","RCDPEM4",414,0)
 .S ERAEOB=$P(^RCY(344.4,ERAIEN,1,1,0),U,2) Q:'ERAEOB
"RTN","RCDPEM4",415,0)
 .S ERABILL=$P(^IBM(361.1,ERAEOB,0),U,1) Q:'ERABILL
"RTN","RCDPEM4",416,0)
 .S STAIEN=$P(^DGCR(399,ERABILL,0),U,22) Q:'STAIEN
"RTN","RCDPEM4",417,0)
 .S STA=STAIEN
"RTN","RCDPEM4",418,0)
 .S STNAM=$$EXTERNAL^DILFD(399,.22,,STA)
"RTN","RCDPEM4",419,0)
 .S STNUM=$P($G(^DG(40.8,STAIEN,0)),U,2) ;IA 417
"RTN","RCDPEM4",420,0)
 Q
"RTN","RCDPEM4",421,0)
 ;
"RTN","RCDPEM4",422,0)
EOBSTA(EOBIEN,STA,STNUM,STNAM) ; Get the station for this EOB
"RTN","RCDPEM4",423,0)
 ;Allowed read on 399 via IA 3820
"RTN","RCDPEM4",424,0)
 N BILL,STAIEN
"RTN","RCDPEM4",425,0)
 S (BILL)=""
"RTN","RCDPEM4",426,0)
 S (STA,STNUM,STNAM)="UNKNOWN"
"RTN","RCDPEM4",427,0)
 D
"RTN","RCDPEM4",428,0)
 .S BILL=$P(^IBM(361.1,EOBIEN,0),U,1) Q:'BILL
"RTN","RCDPEM4",429,0)
 .S STAIEN=$P($G(^DGCR(399,BILL,0)),U,22) Q:'STAIEN
"RTN","RCDPEM4",430,0)
 .S STA=STAIEN
"RTN","RCDPEM4",431,0)
 .S STNAM=$$EXTERNAL^DILFD(399,.22,,STA)
"RTN","RCDPEM4",432,0)
 .S STNUM=$P($G(^DG(40.8,STAIEN,0)),U,2) ;IA 417
"RTN","RCDPEM4",433,0)
 Q
"RTN","RCDPEM4",434,0)
 ;
"RTN","RCDPEM4",435,0)
DTPRB() ; Get the Start Date type
"RTN","RCDPEM4",436,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","RCDPEM4",437,0)
 S DIR(0)="SBO^W:Date Removed from Worklist;R:Date ERA Received;B:Both Dates"
"RTN","RCDPEM4",438,0)
 S DIR("A")="Select Start Date"
"RTN","RCDPEM4",439,0)
 D ^DIR K DIR
"RTN","RCDPEM4",440,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") S Y=0
"RTN","RCDPEM4",441,0)
 Q Y
"RTN","RCDPEM9")
0^15^B27056813^B25446642
"RTN","RCDPEM9",1,0)
RCDPEM9 ;OIFO-BAYPINES/PJH - PAYER SELECTION ;10/18/11 6:17pm
"RTN","RCDPEM9",2,0)
 ;;4.5;Accounts Receivable;**276,284**;Mar 20, 1995;Build 35
"RTN","RCDPEM9",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPEM9",4,0)
 ;
"RTN","RCDPEM9",5,0)
GETPAY(FILE) ; Let user select payer for filter
"RTN","RCDPEM9",6,0)
 ;
"RTN","RCDPEM9",7,0)
 ; Returned RTNFLG value
"RTN","RCDPEM9",8,0)
 ;
"RTN","RCDPEM9",9,0)
 ; PRCA*4.5*284 - Added pieces 2 & 3 to provide background jobs information to re-calculate payer list.
"RTN","RCDPEM9",10,0)
 ;
"RTN","RCDPEM9",11,0)
 ; Piece 1: -1 = none selected
"RTN","RCDPEM9",12,0)
 ;           1 = range of payers
"RTN","RCDPEM9",13,0)
 ;           2 = all payers selected
"RTN","RCDPEM9",14,0)
 ;           3 = specific payers
"RTN","RCDPEM9",15,0)
 ; Piece 2: From Range (When a from/thru range is selected by user)
"RTN","RCDPEM9",16,0)
 ; Piece 3: Thru Range (When a from/thru range is selected by user)
"RTN","RCDPEM9",17,0)
 ;
"RTN","RCDPEM9",18,0)
 ; Payers selected are returned in ^TMP("RCSELPAY",$J
"RTN","RCDPEM9",19,0)
 ;
"RTN","RCDPEM9",20,0)
 N RCPAY,RCINC,CNT,RTNFLG,I,RCANS,INDX,X,RCANS2,DIR,Y,DTOUT,DUOUT,RCINSF,RCINST,RNG1,RNG2
"RTN","RCDPEM9",21,0)
 ;
"RTN","RCDPEM9",22,0)
 S RTNFLG=0,INDX=1,RNG1="",RNG2=""
"RTN","RCDPEM9",23,0)
 ;
"RTN","RCDPEM9",24,0)
 ;Clear list of selected payers
"RTN","RCDPEM9",25,0)
 K ^TMP("RCSELPAY",$J)
"RTN","RCDPEM9",26,0)
 ;
"RTN","RCDPEM9",27,0)
 ;Select option required (All, Selected or Range)
"RTN","RCDPEM9",28,0)
 S DIR(0)="SA^A:ALL;S:SPECIFIC;R:RANGE",DIR("A")="RUN REPORT FOR (A)LL, (S)PECIFIC, OR (R)ANGE OF INSURANCE COMPANIES?: ",DIR("B")="ALL" W ! D ^DIR K DIR
"RTN","RCDPEM9",29,0)
 ;Abort on ^ exit or timeout
"RTN","RCDPEM9",30,0)
 I $D(DTOUT)!$D(DUOUT) S RTNFLG=-1 Q RTNFLG
"RTN","RCDPEM9",31,0)
 ;
"RTN","RCDPEM9",32,0)
 ;ALL payers
"RTN","RCDPEM9",33,0)
 I Y="A" D
"RTN","RCDPEM9",34,0)
 .; Build list of ALL stations
"RTN","RCDPEM9",35,0)
 .S CNT=0,RCPAY="",RTNFLG=2
"RTN","RCDPEM9",36,0)
 .F  S RCPAY=$O(^RCY(FILE,"C",RCPAY)) Q:RCPAY=""  D
"RTN","RCDPEM9",37,0)
 ..S CNT=CNT+1,^TMP("RCSELPAY",$J,CNT)=RCPAY
"RTN","RCDPEM9",38,0)
 ;
"RTN","RCDPEM9",39,0)
 ;Selected Payers
"RTN","RCDPEM9",40,0)
 I Y="S" D
"RTN","RCDPEM9",41,0)
 .D GLIST(FILE),GETPAYS(CNT)
"RTN","RCDPEM9",42,0)
 ;
"RTN","RCDPEM9",43,0)
 ;Range of Payers
"RTN","RCDPEM9",44,0)
 I Y="R" D
"RTN","RCDPEM9",45,0)
 .D GLIST(FILE),GETPAYR
"RTN","RCDPEM9",46,0)
 ;
"RTN","RCDPEM9",47,0)
 ;Clear list of all payers
"RTN","RCDPEM9",48,0)
 K:RTNFLG'=2 ^TMP("RCPAYER",$J)
"RTN","RCDPEM9",49,0)
 ;If aborting also clear any selected payers
"RTN","RCDPEM9",50,0)
 K:RTNFLG=-1 ^TMP("RCSELPAY",$J)
"RTN","RCDPEM9",51,0)
 ;
"RTN","RCDPEM9",52,0)
 ;Return value
"RTN","RCDPEM9",53,0)
 ; PRCA*4.5*284 - Update return value to include from/thru range. See above for documentation
"RTN","RCDPEM9",54,0)
 Q RTNFLG_"^"_RNG1_"^"_RNG2
"RTN","RCDPEM9",55,0)
 ;
"RTN","RCDPEM9",56,0)
GLIST(FILE) ;Build list for this file
"RTN","RCDPEM9",57,0)
 ;
"RTN","RCDPEM9",58,0)
 ;Clear workfile
"RTN","RCDPEM9",59,0)
 K ^TMP("RCPAYER",$J)
"RTN","RCDPEM9",60,0)
 ;
"RTN","RCDPEM9",61,0)
 ; Build list of available stations
"RTN","RCDPEM9",62,0)
 S CNT=0,RCPAY=""
"RTN","RCDPEM9",63,0)
 F  S RCPAY=$O(^RCY(FILE,"C",RCPAY)) Q:RCPAY=""  D
"RTN","RCDPEM9",64,0)
 .S CNT=CNT+1
"RTN","RCDPEM9",65,0)
 .S ^TMP("RCPAYER",$J,CNT)=RCPAY
"RTN","RCDPEM9",66,0)
 .S ^TMP("RCPAYER",$J,"B",RCPAY,CNT)=""
"RTN","RCDPEM9",67,0)
 ;
"RTN","RCDPEM9",68,0)
 Q
"RTN","RCDPEM9",69,0)
 ;
"RTN","RCDPEM9",70,0)
GETPAYS(CNT) ;select payer for filter, specific
"RTN","RCDPEM9",71,0)
 ;
"RTN","RCDPEM9",72,0)
 N PNAME
"RTN","RCDPEM9",73,0)
 ;
"RTN","RCDPEM9",74,0)
 K ^TMP("RCDPEM9",$J)
"RTN","RCDPEM9",75,0)
 ;
"RTN","RCDPEM9",76,0)
 F  Q:RTNFLG'=0  D
"RTN","RCDPEM9",77,0)
 .N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","RCDPEM9",78,0)
 .S DIR("A")="SELECT INSURANCE COMPANY"
"RTN","RCDPEM9",79,0)
 .S DIR(0)="FO^1:30"
"RTN","RCDPEM9",80,0)
 .S DIR("?")="ENTER THE NAME OF THE PAYER OR '??' TO LIST PAYERS"
"RTN","RCDPEM9",81,0)
 .S DIR("??")="^D LIST^RCDPEM9(CNT)"
"RTN","RCDPEM9",82,0)
 .D ^DIR K DIR
"RTN","RCDPEM9",83,0)
 .;User pressed ENTER
"RTN","RCDPEM9",84,0)
 .I Y="",'$D(DTOUT) S RTNFLG=$S($D(^TMP("RCSELPAY")):3,1:-1) Q
"RTN","RCDPEM9",85,0)
 .;First check for exits
"RTN","RCDPEM9",86,0)
 .I $D(DUOUT)!$D(DTOUT)!$D(DIRUT)!$D(DIROUT) S RTNFLG=-1 Q
"RTN","RCDPEM9",87,0)
 .;Check for  help
"RTN","RCDPEM9",88,0)
 .S (RCANS,RCANS2)=""
"RTN","RCDPEM9",89,0)
 .S RCANS=Y
"RTN","RCDPEM9",90,0)
 .; Now check for exotic user input
"RTN","RCDPEM9",91,0)
 .I '(RCANS?.N) S RCANS2=$O(^TMP("RCPAYER",$J,"B",RCANS,RCANS2)) D:'RCANS2 PART Q:'$G(RCANS2)
"RTN","RCDPEM9",92,0)
 .S:$G(RCANS2) RCANS=RCANS2 I RCANS="" W "  ??" Q
"RTN","RCDPEM9",93,0)
 .I RCANS?.N&((+RCANS<1)!(+RCANS>CNT)) W "  ??" Q
"RTN","RCDPEM9",94,0)
 .I RCANS'?.N W "  ??" Q
"RTN","RCDPEM9",95,0)
 .I $D(^TMP("RCDPEM9",$J,RCANS)) W "  ?? PAYER ALREADY SELECTED" Q
"RTN","RCDPEM9",96,0)
 .S ^TMP("RCDPEM9",$J,RCANS)=""
"RTN","RCDPEM9",97,0)
 .S PNAME=$G(^TMP("RCPAYER",$J,RCANS))
"RTN","RCDPEM9",98,0)
 .W "  "_PNAME
"RTN","RCDPEM9",99,0)
 .S ^TMP("RCSELPAY",$J,INDX)=$G(^TMP("RCPAYER",$J,RCANS))
"RTN","RCDPEM9",100,0)
 .S INDX=INDX+1
"RTN","RCDPEM9",101,0)
 ;
"RTN","RCDPEM9",102,0)
 K ^TMP("RCDPEM9",$J)
"RTN","RCDPEM9",103,0)
 Q
"RTN","RCDPEM9",104,0)
 ;
"RTN","RCDPEM9",105,0)
LIST(CNT) ;
"RTN","RCDPEM9",106,0)
 ; Prompt users for stations to be used for filtering
"RTN","RCDPEM9",107,0)
 N I
"RTN","RCDPEM9",108,0)
 F I=1:1:CNT D
"RTN","RCDPEM9",109,0)
 .W !,I,".",?5,$G(^TMP("RCPAYER",$J,I))
"RTN","RCDPEM9",110,0)
 Q
"RTN","RCDPEM9",111,0)
 ;
"RTN","RCDPEM9",112,0)
PART ;
"RTN","RCDPEM9",113,0)
 N RCPAR,CNT,IEN
"RTN","RCDPEM9",114,0)
 S RCPAR=0,CNT=0
"RTN","RCDPEM9",115,0)
 F  S RCPAR=$O(^TMP("RCPAYER",$J,"B",RCPAR)) Q:RCPAR=""  D
"RTN","RCDPEM9",116,0)
 .S IEN=$O(^TMP("RCPAYER",$J,"B",RCPAR,""))
"RTN","RCDPEM9",117,0)
 .I $E(RCPAR,1,$L(RCANS))[RCANS W !,?10,IEN,".",^TMP("RCPAYER",$J,IEN) S CNT=1
"RTN","RCDPEM9",118,0)
 I 'CNT W "  ??"
"RTN","RCDPEM9",119,0)
 Q
"RTN","RCDPEM9",120,0)
 ;
"RTN","RCDPEM9",121,0)
GETPAYR ;select payer for filter, range
"RTN","RCDPEM9",122,0)
 ; called from ^RCDPEAR1
"RTN","RCDPEM9",123,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,INDX,X,Y,RCINSF,RCINST,NUM
"RTN","RCDPEM9",124,0)
 S DIR("?")="ENTER THE NAME OF THE PAYER OR '??' TO LIST PAYERS"
"RTN","RCDPEM9",125,0)
 S DIR("??")="^D LIST^RCDPEM9(CNT)"
"RTN","RCDPEM9",126,0)
 S DIR(0)="FA^1:30^K:X'?1.U.E X",DIR("A")="START WITH INSURANCE COMPANY NAME: ",DIR("B")=$E($O(^TMP("RCPAYER",$J,"B","")),1,30)
"RTN","RCDPEM9",127,0)
 D ^DIR K DIR
"RTN","RCDPEM9",128,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!(Y="") S RTNFLG=-1 Q
"RTN","RCDPEM9",129,0)
 S RCINSF=Y
"RTN","RCDPEM9",130,0)
 S DIR("?")="ENTER THE NAME OF THE PAYER OR '??' TO LIST PAYERS"
"RTN","RCDPEM9",131,0)
 S DIR("??")="^D LIST^RCDPEM9(CNT)"
"RTN","RCDPEM9",132,0)
 S DIR(0)="FA^1:30^K:X'?1.U.E X",DIR("A")="GO TO INSURANCE COMPANY NAME: ",DIR("B")=$E($O(^TMP("RCPAYER",$J,"B",""),-1),1,30)
"RTN","RCDPEM9",133,0)
 F  W ! D ^DIR Q:$S($D(DTOUT)!$D(DUOUT):1,1:RCINSF']Y)  W !,"'GO TO' NAME MUST COME AFTER 'START WITH' NAME"
"RTN","RCDPEM9",134,0)
 K DIR
"RTN","RCDPEM9",135,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!(Y="") S RTNFLG=-1 Q
"RTN","RCDPEM9",136,0)
 S RCINST=Y_"Z"  ;entry of "ABC" will pick up "ABC INSURANCE" if "Z" is appended
"RTN","RCDPEM9",137,0)
 ;If the first name is an exact match, back up to the previous entry
"RTN","RCDPEM9",138,0)
 I $D(^TMP("RCPAYER",$J,"B",RCINSF)) S RCINSF=$O(^TMP("RCPAYER",$J,"B",RCINSF),-1)
"RTN","RCDPEM9",139,0)
 ; PRCA*4.5*284 - Save from/thru user responses in RNG1 & RNG2 to rebuild after report is queued. Will be returned to the calling program.
"RTN","RCDPEM9",140,0)
 S RNG1=RCINSF,RNG2=RCINST
"RTN","RCDPEM9",141,0)
 S INDX=1 F  S RCINSF=$O(^TMP("RCPAYER",$J,"B",RCINSF)) Q:RCINSF=""  Q:RCINSF]RCINST  D
"RTN","RCDPEM9",142,0)
 . S NUM=$O(^TMP("RCPAYER",$J,"B",RCINSF,""))
"RTN","RCDPEM9",143,0)
 . S ^TMP("RCSELPAY",$J,INDX)=$G(^TMP("RCPAYER",$J,NUM))
"RTN","RCDPEM9",144,0)
 . S INDX=INDX+1
"RTN","RCDPEM9",145,0)
 ;Set return value
"RTN","RCDPEM9",146,0)
 I INDX=1 S RTNFLG=-1 Q  ; no entries in selected range
"RTN","RCDPEM9",147,0)
 S RTNFLG=1
"RTN","RCDPEM9",148,0)
 Q
"RTN","RCDPRTP1")
0^4^B33480590^B33114320
"RTN","RCDPRTP1",1,0)
RCDPRTP1 ;ALB/LDB - CLAIMS MATCHING REPORT (PRINT) ;1/26/01  2:56 PM
"RTN","RCDPRTP1",2,0)
 ;;4.5;Accounts Receivable;**151,169,276,284**;Mar 20, 1995;Build 35
"RTN","RCDPRTP1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RCDPRTP1",4,0)
 ;
"RTN","RCDPRTP1",5,0)
EN ; Entry point to print the Claims Matching Report.
"RTN","RCDPRTP1",6,0)
 N %,DATEDIS1,DATEDIS2,NOW,PG,RCBILL,RCAMT,RCAMT1,RCIBDAT,RCIBFN,RCNAM,RCNAM1,RCNO,RCNOW,RCDLINE,RCLINE,RCPHIT
"RTN","RCDPRTP1",7,0)
 ; PRCA*4.5*284 - Remove RCPT 'new' as this is the receipt # from user entry
"RTN","RCDPRTP1",8,0)
 N RCQ,RCSSN,RCSTAT,RCTP,X,Y
"RTN","RCDPRTP1",9,0)
 ;
"RTN","RCDPRTP1",10,0)
 ; - initialize report header variables
"RTN","RCDPRTP1",11,0)
 S PG=0
"RTN","RCDPRTP1",12,0)
 I RCSORT'=2,(RCSORT'=4) D
"RTN","RCDPRTP1",13,0)
 .S Y=$P(DATESTRT,".") D DD^%DT S DATEDIS1=Y
"RTN","RCDPRTP1",14,0)
 .S Y=$P(DATEEND,".") D DD^%DT S DATEDIS2=Y
"RTN","RCDPRTP1",15,0)
 D NOW^%DTC S Y=% D DD^%DT S RCNOW=$E(Y,1,18)
"RTN","RCDPRTP1",16,0)
 S RCDLINE=$TR($J("",80)," ","-")
"RTN","RCDPRTP1",17,0)
 S RCLINE=$TR($J("",80)," ","*")
"RTN","RCDPRTP1",18,0)
 ;
"RTN","RCDPRTP1",19,0)
 ; - main report loop
"RTN","RCDPRTP1",20,0)
 K ^TMP($J)
"RTN","RCDPRTP1",21,0)
 ;
"RTN","RCDPRTP1",22,0)
 ;
"RTN","RCDPRTP1",23,0)
 D HDR ; initial header
"RTN","RCDPRTP1",24,0)
 S RCNO=0 ; flag to indicate at least one matching claim
"RTN","RCDPRTP1",25,0)
 ;
"RTN","RCDPRTP1",26,0)
 S RCNAM="" F  S RCNAM=$O(^TMP("RCDPRTPB",$J,RCNAM)) Q:RCNAM=""!$G(RCQ)  D
"RTN","RCDPRTP1",27,0)
 .S RCBILL=0 F  S RCBILL=$O(^TMP("RCDPRTPB",$J,RCNAM,RCBILL)) Q:'RCBILL!$G(RCQ)  D
"RTN","RCDPRTP1",28,0)
 ..;
"RTN","RCDPRTP1",29,0)
 ..S RCPHIT=0 ; flag that requires patient info to print
"RTN","RCDPRTP1",30,0)
 ..D PROC ;     process a single third party bill
"RTN","RCDPRTP1",31,0)
 ..K ^TMP("IBRBT",$J),^TMP("IBRBF",$J)
"RTN","RCDPRTP1",32,0)
 ;
"RTN","RCDPRTP1",33,0)
 I $G(RCQ) G ENQ
"RTN","RCDPRTP1",34,0)
 ;
"RTN","RCDPRTP1",35,0)
 I $O(^TMP("RCDPRTPB",$J,0))="" W !!,?18,"No matching debts." Q
"RTN","RCDPRTP1",36,0)
 I 'RCNO W !!,?18,"No matching debts."
"RTN","RCDPRTP1",37,0)
ENQ ;
"RTN","RCDPRTP1",38,0)
 Q
"RTN","RCDPRTP1",39,0)
 ;
"RTN","RCDPRTP1",40,0)
 ;
"RTN","RCDPRTP1",41,0)
PROC ; Process each third party bill for a patient.
"RTN","RCDPRTP1",42,0)
 D RELBILL^IBRFN(RCBILL)
"RTN","RCDPRTP1",43,0)
 ;
"RTN","RCDPRTP1",44,0)
 ; - quit if there are no associated first party bills
"RTN","RCDPRTP1",45,0)
 I '$O(^TMP("IBRBF",$J,0)) K ^TMP("RCDPRTPB",$J,RCNAM,RCBILL) G PROCQ
"RTN","RCDPRTP1",46,0)
 ;
"RTN","RCDPRTP1",47,0)
 S (RCAMT(0),RCAMT(1))=0
"RTN","RCDPRTP1",48,0)
 ;
"RTN","RCDPRTP1",49,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:'RCTP(0)  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:'RCTP(1)  S ^TMP($J,"IBRBF",RCTP(1),RCTP(0))=""
"RTN","RCDPRTP1",50,0)
 ; PRCA*4.5*284 - Change typo of RCPT(0)=0 to RCTP(0)=0
"RTN","RCDPRTP1",51,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP($J,"IBRBF",RCTP(0))) Q:'RCTP(0)  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP($J,"IBRBF",RCTP(0),RCTP(1))) Q:'RCTP(1)  D
"RTN","RCDPRTP1",52,0)
 .I RCTP(1)=RCBILL Q
"RTN","RCDPRTP1",53,0)
 .I $D(^TMP($J,"IBRBF",RCTP(0),RCBILL))!(RCTP(1)'=$O(^TMP($J,"IBRBF",RCTP(0),0))) K ^TMP("IBRBF",$J,RCTP(1),RCTP(0)),^TMP($J,"IBRBF",RCTP(0),RCTP(1)) I '$O(^TMP("IBRBF",$J,RCTP(1),0)) K ^TMP("IBRBF",$J,RCTP(1))
"RTN","RCDPRTP1",54,0)
 S RCTP(0)="" F  S RCTP(0)=$O(^TMP("IBRBT",$J,RCBILL,RCTP(0))) Q:RCTP(0)=""  D
"RTN","RCDPRTP1",55,0)
 .;if associated third party has had payment also do not list twice
"RTN","RCDPRTP1",56,0)
 .I $D(^TMP("RCDPRTPB",$J,RCNAM,RCTP(0))),(RCBILL'=RCTP(0)) S RCTP(RCTP(0))=^TMP("RCDPRTPB",$J,RCNAM,RCTP(0)) K ^(RCTP(0))
"RTN","RCDPRTP1",57,0)
 .;if no prescription coverage exclude associated rx co-pay charges
"RTN","RCDPRTP1",58,0)
 .I '$P(^TMP("IBRBT",$J,RCBILL),"^") D
"RTN","RCDPRTP1",59,0)
 ..S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:RCTP(1)=""  I $G(^TMP("IBRBF",$J,RCTP(0),RCTP(1)))["RX" K ^TMP("IBRBF",$J,RCTP(0),RCTP(1)) I '$O(^TMP("IBRBF",$J,RCTP(0),"")) K ^TMP("IBRBF",$J,RCTP(0))
"RTN","RCDPRTP1",60,0)
 .;if duplicate charges exclude them from report
"RTN","RCDPRTP1",61,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:RCTP(0)=""  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:'RCTP(1)  D
"RTN","RCDPRTP1",62,0)
 .I RCTP(0)'=RCBILL,($D(^TMP("IBRBF",$J,RCBILL,RCTP(1)))) K ^TMP("IBRBF",$J,RCTP(0),RCTP(1)) K:'$O(^TMP("IBRBF",$J,RCTP(0),0)) ^TMP("IBRBF",$J,RCTP(0))
"RTN","RCDPRTP1",63,0)
 ;exclude cancelled charges if not selected to be on report
"RTN","RCDPRTP1",64,0)
 I 'RCAN D
"RTN","RCDPRTP1",65,0)
 .S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:RCTP(0)=""  S RCTP(1)=0 F  S RCTP(1)=$O(^TMP("IBRBF",$J,RCTP(0),RCTP(1))) Q:'RCTP(1)  D
"RTN","RCDPRTP1",66,0)
 ..I $P(^TMP("IBRBF",$J,RCTP(0),RCTP(1)),"^",3) K ^TMP("IBRBF",$J,RCTP(0),RCTP(1)) Q
"RTN","RCDPRTP1",67,0)
 ..S RCPT(2)=$O(^PRCA(430,"B",+$P(^TMP("IBRBF",$J,RCTP(0),RCTP(1)),"^",4),0)) I $P($G(^PRCA(430,+RCPT(2),0)),"^",8)=39 K ^TMP("IBRBF",$J,RCTP(0),RCTP(1))
"RTN","RCDPRTP1",68,0)
 ..I '$O(^TMP("IBRBF",$J,RCTP(0),"")) K ^TMP("IBRBF",$J,RCTP(0))
"RTN","RCDPRTP1",69,0)
 I '$O(^TMP("IBRBF",$J,RCBILL,0)) K ^TMP("RCDPRTPB",$J,RCNAM,RCBILL) G PROCQ
"RTN","RCDPRTP1",70,0)
 ;
"RTN","RCDPRTP1",71,0)
 ; - print patient detail line
"RTN","RCDPRTP1",72,0)
 I 'RCPHIT S RCPHIT=1 D PRINT3^RCDPRTP2 G:$G(RCQ) PROCQ
"RTN","RCDPRTP1",73,0)
 ;
"RTN","RCDPRTP1",74,0)
 ; - print third party bills
"RTN","RCDPRTP1",75,0)
 ;    o  print the header first; need room for the header and
"RTN","RCDPRTP1",76,0)
 ;       the bill that was paid.
"RTN","RCDPRTP1",77,0)
 ;    o  print the bill that was paid.
"RTN","RCDPRTP1",78,0)
 S RCTP=RCBILL,RCIBDAT=$G(^TMP("IBRBT",$J,RCBILL,RCBILL))
"RTN","RCDPRTP1",79,0)
 I $Y>(IOSL-7) D PAUSE^RCDPRTP2 G:$G(RCQ) PROCQ D HDR
"RTN","RCDPRTP1",80,0)
 D HDR1^RCDPRTP2,PRINT1^RCDPRTP2 G:$G(RCQ) PROCQ
"RTN","RCDPRTP1",81,0)
 ;
"RTN","RCDPRTP1",82,0)
 ; PRCA*4.5*284, corrected typo of 'assoicated' to 'associated'
"RTN","RCDPRTP1",83,0)
 ; - print the other associated third party bills
"RTN","RCDPRTP1",84,0)
 S RCTP=0 F  S RCTP=$O(^TMP("IBRBT",$J,RCBILL,RCTP)) Q:'RCTP!$G(RCQ)  D
"RTN","RCDPRTP1",85,0)
 .I RCBILL=RCTP Q  ; don't reprint the bill that was paid.
"RTN","RCDPRTP1",86,0)
 .S RCIBDAT=$G(^TMP("IBRBT",$J,RCBILL,RCTP))
"RTN","RCDPRTP1",87,0)
 .I 'RCAN,($P(RCIBDAT,"^",3)) Q  ; exclude cancelled claims
"RTN","RCDPRTP1",88,0)
 .D PRINT1^RCDPRTP2
"RTN","RCDPRTP1",89,0)
 G:$G(RCQ) PROCQ
"RTN","RCDPRTP1",90,0)
 ;
"RTN","RCDPRTP1",91,0)
 ; - print the third party totals
"RTN","RCDPRTP1",92,0)
 ; PRCA*4.5*276 - adjusted header to make room for EEOB indicator '%'
"RTN","RCDPRTP1",93,0)
 I $Y>(IOSL-2) D PAUSE^RCDPRTP2 G:$G(RCQ) PROCQ D HDR W !
"RTN","RCDPRTP1",94,0)
 W !,?63,"----------",?75,"----------"
"RTN","RCDPRTP1",95,0)
 W !,?64,$J(RCAMT(0),9,2),?76,$J(RCAMT(1),9,2)
"RTN","RCDPRTP1",96,0)
 ;
"RTN","RCDPRTP1",97,0)
 ; - print the associated first party charges
"RTN","RCDPRTP1",98,0)
 S RCTP(0)=0 F  S RCTP(0)=$O(^TMP("IBRBF",$J,RCTP(0))) Q:'RCTP(0)!$G(RCQ)  D
"RTN","RCDPRTP1",99,0)
 .I RCTP(0)=$O(^TMP("IBRBF",$J,0)) D
"RTN","RCDPRTP1",100,0)
 ..I $Y>(IOSL-5) D PAUSE^RCDPRTP2 Q:$G(RCQ)  D HDR
"RTN","RCDPRTP1",101,0)
 ..D HDR2^RCDPRTP2
"RTN","RCDPRTP1",102,0)
 .S RCTP=0 F  S RCTP=$O(^TMP("IBRBF",$J,RCTP(0),RCTP)) Q:'RCTP!$G(RCQ)  D
"RTN","RCDPRTP1",103,0)
 ..S RCNO=1 ; set flag for at least one match
"RTN","RCDPRTP1",104,0)
 ..;
"RTN","RCDPRTP1",105,0)
 ..S RCIBDAT=$G(^TMP("IBRBF",$J,RCTP(0),RCTP))
"RTN","RCDPRTP1",106,0)
 ..;
"RTN","RCDPRTP1",107,0)
 ..; - print the header for the first charge
"RTN","RCDPRTP1",108,0)
 ..;
"RTN","RCDPRTP1",109,0)
 ..; - print the patient detail line
"RTN","RCDPRTP1",110,0)
 ..D PRINT2^RCDPRTP2
"RTN","RCDPRTP1",111,0)
 ;.
"RTN","RCDPRTP1",112,0)
 ; PRCA*4.5*284, cleanup ^TMP($J) only
"RTN","RCDPRTP1",113,0)
PROCQ K ^TMP($J) Q
"RTN","RCDPRTP1",114,0)
 ;
"RTN","RCDPRTP1",115,0)
 ;
"RTN","RCDPRTP1",116,0)
HDR ; Print the main report header.
"RTN","RCDPRTP1",117,0)
 S PG=PG+1 I PG'=1!($E(IOST,1,2)="C-") W @IOF
"RTN","RCDPRTP1",118,0)
 W !,?5,"THIRD PARTY CLAIMS W/MATCHING FIRST PARTY DEBTS  ",RCNOW," PAGE ",PG
"RTN","RCDPRTP1",119,0)
 I RCSORT'=2,(RCSORT'=4) W !,?18,"FOR THE PAYMENT DATES: ",DATEDIS1,"  TO  ",DATEDIS2
"RTN","RCDPRTP1",120,0)
 I RCSORT=4 W !,?18,"RECEIPT NUMBER ",RCPT
"RTN","RCDPRTP1",121,0)
 W !,RCDLINE
"RTN","RCDPRTP1",122,0)
 I PG=1 D
"RTN","RCDPRTP1",123,0)
 .W !!,"Remember that any actions taken to decrease the first party receivables must"
"RTN","RCDPRTP1",124,0)
 .W !,"consider any applicable deductibles or coinsurance amounts specified on the EOB."
"RTN","RCDPRTP1",125,0)
 Q
"RTN","RCDPRTP1",126,0)
 ;
"VER")
8.0^22.0
"^DD",344,344,.17,0)
EFT RECORD^R*P344.31'^RCY(344.31,^0;17^S DIC("S")="I $S('$O(^RCY(344,""AEFT"",+Y,0)):1,1:$O(^(0))=DA),$P($G(^RCY(344.31,+Y,0)),U,8)=0" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",344,344,.17,1,0)
^.1
"^DD",344,344,.17,1,1,0)
344^AEFT
"^DD",344,344,.17,1,1,1)
S ^RCY(344,"AEFT",$E(X,1,30),DA)=""
"^DD",344,344,.17,1,1,2)
K ^RCY(344,"AEFT",$E(X,1,30),DA)
"^DD",344,344,.17,1,1,3)
Do not delete
"^DD",344,344,.17,1,1,"DT")
3030228
"^DD",344,344,.17,3)
Enter the EFT from which this receipt detail record was generated
"^DD",344,344,.17,5,1,0)
344^.04^2
"^DD",344,344,.17,12)
1. An EFT record can only be associated with 1 EDI Lockbox type receipt.  2. Selection of a matched EFT cannot occur.  
"^DD",344,344,.17,12.1)
S DIC("S")="I $S('$O(^RCY(344,""AEFT"",+Y,0)):1,1:$O(^(0))=DA),$P($G(^RCY(344.31,+Y,0)),U,8)=0"
"^DD",344,344,.17,21,0)
^^2^2^3030228^
"^DD",344,344,.17,21,1,0)
If this is the detail receipt for a payment made via an EFT, this is the
"^DD",344,344,.17,21,2,0)
pointer to the individual EFT that was received.
"^DD",344,344,.17,"DT")
3120307
"^DD",344.4,344.4,.09,0)
EFT MATCH STATUS^S^0:UNMATCHED;-1:MATCHED WITH ERRORS;1:MATCHED;2:MATCHED TO PAPER CHECK;3:MATCH-0 PAYMENT;4:REMOVED FROM WORKLIST;^0;9^Q
"^DD",344.4,344.4,.09,1,0)
^.1
"^DD",344.4,344.4,.09,1,1,0)
344.4^AMATCH
"^DD",344.4,344.4,.09,1,1,1)
S ^RCY(344.4,"AMATCH",$E(X,1,30),DA)=""
"^DD",344.4,344.4,.09,1,1,2)
K ^RCY(344.4,"AMATCH",$E(X,1,30),DA)
"^DD",344.4,344.4,.09,1,1,3)
Do not delete
"^DD",344.4,344.4,.09,1,1,"%D",0)
^^1^1^3021022^
"^DD",344.4,344.4,.09,1,1,"%D",1,0)
This xref allows easy access to unmatched or mismatched ERA records.
"^DD",344.4,344.4,.09,1,1,"DT")
3021022
"^DD",344.4,344.4,.09,3)
Enter the status to indicate if the ERA has been matched
"^DD",344.4,344.4,.09,21,0)
^^7^7^3120208^
"^DD",344.4,344.4,.09,21,1,0)
This is the status that indicates whether or not the ERA has been
"^DD",344.4,344.4,.09,21,2,0)
matched to an electronic EFT record.  If the total amt of the EFT payment
"^DD",344.4,344.4,.09,21,3,0)
does not equal the total amount of the ERA payment, the status will be
"^DD",344.4,344.4,.09,21,4,0)
-1 (MATCHED WITH ERRORS).  If the ERA has a 0-payment and no EFT or check,
"^DD",344.4,344.4,.09,21,5,0)
the status will be 3 (MATCH-0 PAYMENT) and if matched to a paper check,
"^DD",344.4,344.4,.09,21,6,0)
the status will be 2 (MATCHED TO PAPER CHECK).  If the ERA has been 
"^DD",344.4,344.4,.09,21,7,0)
removed from the worklist the status will be 4 (REMOVED FROM WORKLIST).
"^DD",344.4,344.4,.09,"DT")
3120208
"^DD",344.4,344.4,.14,0)
DETAIL POST STATUS^S^0:NOT POSTED;1:POSTED;2:MANUALLY POSTED;3:POSTING NOT NEEDED;4:NOT POSTED-REMOVED;^0;14^Q
"^DD",344.4,344.4,.14,3)
Enter the code that corresponds to whether or not the ERA detail was posted and if so, if it was manually posted.
"^DD",344.4,344.4,.14,5,1,0)
344.4^.01^2
"^DD",344.4,344.4,.14,21,0)
^.001^3^3^3040429^^^
"^DD",344.4,344.4,.14,21,1,0)
This is a flag that indicates whether or not the receipt for the ERA has 
"^DD",344.4,344.4,.14,21,2,0)
been posted.  It is used to limit the choices when selecting ERAs for the 
"^DD",344.4,344.4,.14,21,3,0)
worklist function.
"^DD",344.4,344.4,.14,"DT")
3120117
"^DD",344.4,344.4,.16,0)
REMOVED BY^P200'^VA(200,^6;1^Q
"^DD",344.4,344.4,.16,3)
Select the person who removed the ERA from the EEOB worklist.
"^DD",344.4,344.4,.16,21,0)
^^2^2^3120124^^
"^DD",344.4,344.4,.16,21,1,0)
This field is used to record the person who removed the 
"^DD",344.4,344.4,.16,21,2,0)
ERA from the EEOB worklist.
"^DD",344.4,344.4,.16,"DT")
3120124
"^DD",344.4,344.4,.17,0)
REMOVED DATE^D^^6;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",344.4,344.4,.17,1,0)
^.1
"^DD",344.4,344.4,.17,1,1,0)
344.4^AD
"^DD",344.4,344.4,.17,1,1,1)
S ^RCY(344.4,"AD",$E(X,1,30),DA)=""
"^DD",344.4,344.4,.17,1,1,2)
K ^RCY(344.4,"AD",$E(X,1,30),DA)
"^DD",344.4,344.4,.17,1,1,3)
DO NOT DELETE
"^DD",344.4,344.4,.17,1,1,"%D",0)
^^2^2^3110929^
"^DD",344.4,344.4,.17,1,1,"%D",1,0)
This cross-reference is used by the option 'Mark ERAs Returned to Payer 
"^DD",344.4,344.4,.17,1,1,"%D",2,0)
Audit Report'.
"^DD",344.4,344.4,.17,1,1,"DT")
3110929
"^DD",344.4,344.4,.17,3)
Enter the Date/time the ERA was removed.
"^DD",344.4,344.4,.17,21,0)
^^2^2^3120117^
"^DD",344.4,344.4,.17,21,1,0)
This field records the date/time that the ERA was removed from the EEOB 
"^DD",344.4,344.4,.17,21,2,0)
worklist.
"^DD",344.4,344.4,.17,"DT")
3120117
"^DD",344.4,344.4,.18,0)
REMOVE REASON^RFX^^6;3^K:$L(X)>100!($L(X)<1)!($TR(X," ","")="") X
"^DD",344.4,344.4,.18,3)
Enter the reason the ERA was removed from the EEOB worklist (1-100 characters).
"^DD",344.4,344.4,.18,21,0)
^^1^1^3120110^^
"^DD",344.4,344.4,.18,21,1,0)
The justification for removing the ERA from the EEOB worklist.
"^DD",344.4,344.4,.18,"DT")
3120124
"BLD",7932,6)
^253
**END**
**END**
