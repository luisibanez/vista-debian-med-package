Released TIU*1*256 SEQ #252
Extracted from mail message
**KIDS**:TIU*1.0*256^

**INSTALL NAME**
TIU*1.0*256
"BLD",8440,0)
TIU*1.0*256^TEXT INTEGRATION UTILITIES^0^3120813^y
"BLD",8440,1,0)
^^15^15^3111017^
"BLD",8440,1,1,0)
When a Nurse Intraoperative Report (NIR) or Anesthesia report is entered 
"BLD",8440,1,2,0)
and signed in the Surgery package, a note is created in Text Integration 
"BLD",8440,1,3,0)
Utility (TIU).  The note is created in file TIU DOCUMENT (8925).  If the 
"BLD",8440,1,4,0)
note is entered and signed mistakenly in the Surgery Package there is no
"BLD",8440,1,5,0)
way to delete the note in either Surgery or TIU.
"BLD",8440,1,6,0)
 
"BLD",8440,1,7,0)
This patch will allow Privacy Act Officers or MIS/HIM Chiefs to
"BLD",8440,1,8,0)
delete/retract Nurse Intraoperative reports (NIR) or Anesthesia 
"BLD",8440,1,9,0)
reports (AR) from CPRS GUI - Surgery tab or in VistA through the 
"BLD",8440,1,10,0)
following options:
"BLD",8440,1,11,0)
 
"BLD",8440,1,12,0)
TIU BROWSE DOCUMENT MGR
"BLD",8440,1,13,0)
TIU BROWSE DOCUMENT MRT
"BLD",8440,1,14,0)
TIU SEARCH LIST MGR
"BLD",8440,1,15,0)
TIU REVIEW SCREEN MIS MANAGER
"BLD",8440,4,0)
^9.64PA^^
"BLD",8440,6.3)
11
"BLD",8440,"ABPKG")
n
"BLD",8440,"KRN",0)
^9.67PA^779.2^20
"BLD",8440,"KRN",.4,0)
.4
"BLD",8440,"KRN",.401,0)
.401
"BLD",8440,"KRN",.402,0)
.402
"BLD",8440,"KRN",.403,0)
.403
"BLD",8440,"KRN",.5,0)
.5
"BLD",8440,"KRN",.84,0)
.84
"BLD",8440,"KRN",3.6,0)
3.6
"BLD",8440,"KRN",3.8,0)
3.8
"BLD",8440,"KRN",9.2,0)
9.2
"BLD",8440,"KRN",9.8,0)
9.8
"BLD",8440,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",8440,"KRN",9.8,"NM",1,0)
TIULP3^^0^B6517608
"BLD",8440,"KRN",9.8,"NM",2,0)
TIULP^^0^B55451451
"BLD",8440,"KRN",9.8,"NM","B","TIULP",2)

"BLD",8440,"KRN",9.8,"NM","B","TIULP3",1)

"BLD",8440,"KRN",19,0)
19
"BLD",8440,"KRN",19.1,0)
19.1
"BLD",8440,"KRN",101,0)
101
"BLD",8440,"KRN",409.61,0)
409.61
"BLD",8440,"KRN",771,0)
771
"BLD",8440,"KRN",779.2,0)
779.2
"BLD",8440,"KRN",870,0)
870
"BLD",8440,"KRN",8989.51,0)
8989.51
"BLD",8440,"KRN",8989.52,0)
8989.52
"BLD",8440,"KRN",8994,0)
8994
"BLD",8440,"KRN","B",.4,.4)

"BLD",8440,"KRN","B",.401,.401)

"BLD",8440,"KRN","B",.402,.402)

"BLD",8440,"KRN","B",.403,.403)

"BLD",8440,"KRN","B",.5,.5)

"BLD",8440,"KRN","B",.84,.84)

"BLD",8440,"KRN","B",3.6,3.6)

"BLD",8440,"KRN","B",3.8,3.8)

"BLD",8440,"KRN","B",9.2,9.2)

"BLD",8440,"KRN","B",9.8,9.8)

"BLD",8440,"KRN","B",19,19)

"BLD",8440,"KRN","B",19.1,19.1)

"BLD",8440,"KRN","B",101,101)

"BLD",8440,"KRN","B",409.61,409.61)

"BLD",8440,"KRN","B",771,771)

"BLD",8440,"KRN","B",779.2,779.2)

"BLD",8440,"KRN","B",870,870)

"BLD",8440,"KRN","B",8989.51,8989.51)

"BLD",8440,"KRN","B",8989.52,8989.52)

"BLD",8440,"KRN","B",8994,8994)

"BLD",8440,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",8440,"QUES",0)
^9.62^^
"BLD",8440,"REQB",0)
^9.611^1^1
"BLD",8440,"REQB",1,0)
TIU*1.0*241^1
"BLD",8440,"REQB","B","TIU*1.0*241",1)

"MBREQ")
0
"PKG",470,-1)
1^1
"PKG",470,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",470,20,0)
^9.402P^^
"PKG",470,22,0)
^9.49I^1^1
"PKG",470,22,1,0)
1.0^3010801^3010806^66481
"PKG",470,22,1,"PAH",1,0)
256^3120813
"PKG",470,22,1,"PAH",1,1,0)
^^15^15^3120813
"PKG",470,22,1,"PAH",1,1,1,0)
When a Nurse Intraoperative Report (NIR) or Anesthesia report is entered 
"PKG",470,22,1,"PAH",1,1,2,0)
and signed in the Surgery package, a note is created in Text Integration 
"PKG",470,22,1,"PAH",1,1,3,0)
Utility (TIU).  The note is created in file TIU DOCUMENT (8925).  If the 
"PKG",470,22,1,"PAH",1,1,4,0)
note is entered and signed mistakenly in the Surgery Package there is no
"PKG",470,22,1,"PAH",1,1,5,0)
way to delete the note in either Surgery or TIU.
"PKG",470,22,1,"PAH",1,1,6,0)
 
"PKG",470,22,1,"PAH",1,1,7,0)
This patch will allow Privacy Act Officers or MIS/HIM Chiefs to
"PKG",470,22,1,"PAH",1,1,8,0)
delete/retract Nurse Intraoperative reports (NIR) or Anesthesia 
"PKG",470,22,1,"PAH",1,1,9,0)
reports (AR) from CPRS GUI - Surgery tab or in VistA through the 
"PKG",470,22,1,"PAH",1,1,10,0)
following options:
"PKG",470,22,1,"PAH",1,1,11,0)
 
"PKG",470,22,1,"PAH",1,1,12,0)
TIU BROWSE DOCUMENT MGR
"PKG",470,22,1,"PAH",1,1,13,0)
TIU BROWSE DOCUMENT MRT
"PKG",470,22,1,"PAH",1,1,14,0)
TIU SEARCH LIST MGR
"PKG",470,22,1,"PAH",1,1,15,0)
TIU REVIEW SCREEN MIS MANAGER
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIULP")
0^2^B55451451^B51642995
"RTN","TIULP",1,0)
TIULP ; SLC/JER - Functions determining privilege ; 3/7/12 4:20pm
"RTN","TIULP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**98,100,116,109,138,152,175,157,182,184,217,236,234,232,241,256**;Jun 20, 1997;Build 11
"RTN","TIULP",3,0)
 ; CANDO^USRLA: ICA 2325, ISA^USRLM: ICA 2324
"RTN","TIULP",4,0)
 ; 8930.1,2,8: IACS 3129,3128,3104 
"RTN","TIULP",5,0)
CANDO(TIUDA,TIUACT,PERSON) ; Can PERSON perform action now
"RTN","TIULP",6,0)
 ; Receives: TIUDA=Record number in file 8925
"RTN","TIULP",7,0)
 ;           TIUACT=Name of user action in 8930.8 (USR ACTION)
"RTN","TIULP",8,0)
 ;           PERSON=New Person file IFN.
"RTN","TIULP",9,0)
 ;                  Assumed to be DUZ if not received.
"RTN","TIULP",10,0)
 ;                  New **100** ID param, backward compatible.
"RTN","TIULP",11,0)
 ;  Returns:   TIUY=1:yes,0:no_"^"_why not message
"RTN","TIULP",12,0)
 N TIUI,TIUTYP,TIUROLE,STATUS,TIUY,TIUATYP,MSG,WHO,MODIFIER,TIUD0,TIUACTW
"RTN","TIULP",13,0)
 S TIUY=0 I '$G(PERSON) S PERSON=DUZ
"RTN","TIULP",14,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)) I 'TIUD0 G CANDOX
"RTN","TIULP",15,0)
 I $$ISPRFDOC^TIUPRF(TIUDA),((TIUACT="ATTACH ID ENTRY")!(TIUACT="ATTACH TO ID NOTE")) S TIUY="0^Patient Record Flag notes may not be used as Interdisciplinary notes." G CANDOX
"RTN","TIULP",16,0)
 S TIUACTW=$G(TIUACT)
"RTN","TIULP",17,0)
 ;VMP/AM P256 Only Hims/Mis Chiefs and Privacy Act Officers are allowed to delete NIRs and ARs
"RTN","TIULP",18,0)
 I (($G(XQY0)["OR CPRS GUI CHART")!($G(XQY0)["TIU ")),$$ISSURG^TIULP3(+TIUDA),$G(TIUACTW)["DELETE ",'$$AUTHUSR^TIULP3(PERSON) D  G CANDOX
"RTN","TIULP",19,0)
 .  S TIUY="0^ Only Privacy Act Officers or MIS/HIMS Chiefs may DELETE this Document."
"RTN","TIULP",20,0)
 ;**100** was I +TIUACT'>0 S TIUACT etc.
"RTN","TIULP",21,0)
 S TIUACT=$$USREVNT(TIUACT) I +TIUACT'>0 G CANDOX
"RTN","TIULP",22,0)
 ; -- Historical Procedures - Prohibit actions detailed in
"RTN","TIULP",23,0)
 ;    HPCAN^TIUCP: P182
"RTN","TIULP",24,0)
 N HPCAN I $$ISHISTCP^TIUCP(+TIUD0) S HPCAN=$$HPCAN^TIUCP(+TIUACT) I 'HPCAN S TIUY=HPCAN G CANDOX
"RTN","TIULP",25,0)
 ; **152 Get status
"RTN","TIULP",26,0)
 S STATUS=+$P(TIUD0,U,5)
"RTN","TIULP",27,0)
 ; **152[234] prevents editing or sending back a completed or uncosigned document.
"RTN","TIULP",28,0)
 I STATUS>5,(+TIUACT=9)!(+TIUACT=17) D  G CANDOX
"RTN","TIULP",29,0)
 . ; **152[234] Displays message to user
"RTN","TIULP",30,0)
 . I +TIUACT=9 S TIUY="0^ You may not edit uncosigned or completed documents."
"RTN","TIULP",31,0)
 . I +TIUACT=17 S TIUY="0^You may not send back uncosigned or completed documents."
"RTN","TIULP",32,0)
 ; -- In case business rules have changed, & children already existed:
"RTN","TIULP",33,0)
 I +TIUACT=24,$D(^TIU(8925,"GDAD",TIUDA)) D  G CANDOX
"RTN","TIULP",34,0)
 . S TIUY="0^ This note cannot be attached; it has its own children."
"RTN","TIULP",35,0)
 I +TIUACT=25,+$G(^TIU(8925,TIUDA,21)) D  G CANDOX
"RTN","TIULP",36,0)
 . S TIUY="0^ This note cannot receive interdisciplinary children; it is itself a child."
"RTN","TIULP",37,0)
 ;VMP/AM P241 If note is administratively closed, then bypass check for blank characters
"RTN","TIULP",38,0)
 I $P($G(^TIU(8925,+TIUDA,16)),U,13)'="S",+TIUACT=4!(+TIUACT=5),+$$BLANK^TIULC(TIUDA) D  G CANDOX ;Sets TIUPRM1
"RTN","TIULP",39,0)
 . S TIUY="0^ Contains blanks ("_$P(TIUPRM1,U,6)_") which must be filled before "_$P(TIUACT,U,2)_"ATURE."
"RTN","TIULP",40,0)
 S TIUROLE=$$USRROLE(TIUDA,PERSON)
"RTN","TIULP",41,0)
 S TIUTYP=+TIUD0
"RTN","TIULP",42,0)
 I $$ISADDNDM^TIULC1(+TIUDA) S TIUATYP=TIUTYP,TIUTYP=+$G(^TIU(8925,+$P(TIUD0,U,6),0))
"RTN","TIULP",43,0)
 I TIUROLE']"" S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,PERSON)
"RTN","TIULP",44,0)
 F TIUI=1:1:($L(TIUROLE,U)-1) D  Q:+$G(TIUY)>0
"RTN","TIULP",45,0)
 . S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,PERSON,$P(TIUROLE,U,TIUI))
"RTN","TIULP",46,0)
 I +$G(TIUATYP) S TIUTYP=+$G(TIUATYP)
"RTN","TIULP",47,0)
 ;VMP/AM P256 Hims/Mis Chiefs and Privacy Act Officers are allowed to delete NIRs and ARs regardless of business rules
"RTN","TIULP",48,0)
 I ($$ISSURG^TIULP3(+TIUDA)&$$AUTHUSR^TIULP3(PERSON)),$G(TIUACTW)["DELETE" S TIUY=1
"RTN","TIULP",49,0)
 ;**100** update for PERSON param; update for verb modifier:
"RTN","TIULP",50,0)
 I +TIUY'>0 D  G CANDOX
"RTN","TIULP",51,0)
 . S WHO=" You"
"RTN","TIULP",52,0)
 . ;I PERSON'=DUZ S WHO=$P(^VA(200,PERSON,0),U),WHO=$$NAME^TIULS(WHO,"FIRST LAST")
"RTN","TIULP",53,0)
 . I PERSON'=DUZ S WHO=$$NAME^TIULS($$GET1^DIQ(200,PERSON,.01),"FIRST LAST") ;P182
"RTN","TIULP",54,0)
 . S MODIFIER=$P(TIUACT,U,3) I $L(MODIFIER) S MODIFIER=" "_MODIFIER
"RTN","TIULP",55,0)
 . ;e.g. "You may not ATTACH this UNSIGNED TELEPHONE NOTE TO AN ID NOTE."
"RTN","TIULP",56,0)
 . S MSG=WHO_" may not "_$P(TIUACT,U,2)_" this "_$P($G(^TIU(8925.6,+STATUS,0)),U)_" "_$$PNAME^TIULC1(TIUTYP)_MODIFIER_"."
"RTN","TIULP",57,0)
 . S TIUY=TIUY_U_MSG
"RTN","TIULP",58,0)
 I +TIUACT=15,$$HASIMG^TIURB2(+TIUDA) D  G CANDOX
"RTN","TIULP",59,0)
 . S TIUY="0^ This document contains linked images. You must ""delete"" the Images using the Imaging package before proceeding."
"RTN","TIULP",60,0)
 ;VMP/ELR P217. Do not allow deletion of a parent with child
"RTN","TIULP",61,0)
 I $G(TIUACTW)["DELETE RECORD",$$HASIDKID^TIUGBR(+TIUDA) D  G CANDOX
"RTN","TIULP",62,0)
 . ;VMP/ELR P232. Create new error msg.
"RTN","TIULP",63,0)
 . NEW TIUMSG D IDMSG^TIULP3(.TIUMSG) S TIUY="0^"_TIUMSG
"RTN","TIULP",64,0)
 ;VMP/ELR P232 do not allow edit, delete or addendum on NIR and Anesthesia report  IA3356 FOR XQY0
"RTN","TIULP",65,0)
 ;VMP/AM P256 Only Hims/Mis Chiefs and Privacy Act Officers are allowed to delete NIRs and ARs
"RTN","TIULP",66,0)
 I (($G(XQY0)["OR CPRS GUI CHART")!($G(XQY0)["TIU ")),$$ACTION^TIULP3($G(TIUACTW)),$$ISSURG^TIULP3(+TIUDA) D  G CANDOX
"RTN","TIULP",67,0)
 . S TIUY="0^ "_$$SURMSG^TIULP3($G(TIUACTW))
"RTN","TIULP",68,0)
CANDOX Q TIUY
"RTN","TIULP",69,0)
 ;
"RTN","TIULP",70,0)
CANLINK(TIUTYP) ; Can user (DUZ) link (attach) a document of a particular type
"RTN","TIULP",71,0)
 ;to an ID note.
"RTN","TIULP",72,0)
 ; For use in ADD NEW ID NOTE, where docmt is not entered yet.
"RTN","TIULP",73,0)
 ; Assume most favorable circumstances (user will complete
"RTN","TIULP",74,0)
 ;the note, so if user still can't attach, can tell them no,
"RTN","TIULP",75,0)
 ;when they first select title for the new entry.
"RTN","TIULP",76,0)
 ; Rule out if TIUTYP can be an ID parent, since ID parent
"RTN","TIULP",77,0)
 ;and ID kid function as mutually exclusive, (regardless of
"RTN","TIULP",78,0)
 ;business rules).
"RTN","TIULP",79,0)
 N TIUACT,STATUS,USRROLE,TIUY
"RTN","TIULP",80,0)
 S TIUACT=$$USREVNT("ATTACH TO ID NOTE"),STATUS=7 ; complete
"RTN","TIULP",81,0)
 S USRROLE=+$O(^USR(8930.2,"B","COMPLETER",0))
"RTN","TIULP",82,0)
 S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,DUZ,USRROLE)
"RTN","TIULP",83,0)
 I '$G(TIUY) S TIUY="0^ You may not use this title for interdisciplinary child entries." Q TIUY
"RTN","TIULP",84,0)
 ; -- If user can attach a certain note, but note can also receive
"RTN","TIULP",85,0)
 ;    ID entries, don't let user attach it. --
"RTN","TIULP",86,0)
 I $$POSSPRNT^TIULP(TIUTYP) S TIUY="0^ This interdisciplinary PARENT title cannot be used for CHILD entries."
"RTN","TIULP",87,0)
 ; -- If selected type is a CWAD, don't let user attach it: --
"RTN","TIULP",88,0)
 I $$ISCWAD^TIULX(TIUTYP) S TIUY="0^ CWAD titles cannot be used for interdisciplinary entries."
"RTN","TIULP",89,0)
 ; -- If selected type is a PRF, don't let user attach it: --
"RTN","TIULP",90,0)
 I $$ISPFTTL^TIUPRFL(TIUTYP) S TIUY="0^ Patient Record Flag titles cannot be used for interdisciplinary entries."
"RTN","TIULP",91,0)
 ; -- If selected type is a consult, don't let user attach it: --
"RTN","TIULP",92,0)
 I $$ISA^TIULX(TIUTYP,+$$CLASS^TIUCNSLT) S TIUY="0^ Consult titles cannot be used for interdisciplinary entries."
"RTN","TIULP",93,0)
 Q TIUY
"RTN","TIULP",94,0)
 ;
"RTN","TIULP",95,0)
POSSPRNT(TIUTYP) ; Is a docmt intended as a possible ID parent?
"RTN","TIULP",96,0)
 ;Returns 1^WHYCAN'TATTACH if there are business rules permitting ANYONE
"RTN","TIULP",97,0)
 ;to attach ID entries to notes of type TIUTYP.
"RTN","TIULP",98,0)
 ;Else returns 0.
"RTN","TIULP",99,0)
 N TIUACT,STATUS,TIUY,DADTYP
"RTN","TIULP",100,0)
 S TIUY=0,TIUACT=+$$USREVNT("ATTACH ID ENTRY")
"RTN","TIULP",101,0)
 F STATUS=6,7,8 D  G:TIUY POSSX
"RTN","TIULP",102,0)
 . I $O(^USR(8930.1,"AR",TIUTYP,STATUS,TIUACT,0)) S TIUY=1 Q
"RTN","TIULP",103,0)
 . I $O(^USR(8930.1,"AC",TIUTYP,STATUS,TIUACT,0)) S TIUY=1
"RTN","TIULP",104,0)
 ; -- If no rules for TIUTYP, try its parent: --
"RTN","TIULP",105,0)
 S DADTYP=$O(^TIU(8925.1,"AD",TIUTYP,0)) G:DADTYP'>0 POSSX
"RTN","TIULP",106,0)
 S TIUY=$$POSSPRNT(DADTYP)
"RTN","TIULP",107,0)
POSSX I TIUY S TIUY="1^ Interdisciplinary PARENT notes cannot be attached as CHILD entries."
"RTN","TIULP",108,0)
 Q TIUY
"RTN","TIULP",109,0)
 ;
"RTN","TIULP",110,0)
CANENTR(TIUTYP) ; Evaluate privilege to enter a document of a particular type
"RTN","TIULP",111,0)
 N TIUACT,STATUS,USRROLE,TIUY
"RTN","TIULP",112,0)
 S TIUACT=$$USREVNT("ENTRY"),STATUS=2 ; untranscribed
"RTN","TIULP",113,0)
 S USRROLE=3 ; transcriber
"RTN","TIULP",114,0)
 S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,DUZ,USRROLE)
"RTN","TIULP",115,0)
 Q TIUY
"RTN","TIULP",116,0)
USRROLE(TIUDA,PERSON) ; Identify the user's role with respect to the document
"RTN","TIULP",117,0)
 ; 3/20/00 **100** Added role COMPLETER
"RTN","TIULP",118,0)
 ; 3/20/00 **100** Added PERSON param
"RTN","TIULP",119,0)
 N TIU0,TIU12,TIU13,TIUY,TIU15,COMPLTR,STATUS
"RTN","TIULP",120,0)
 S PERSON=$G(PERSON,DUZ)
"RTN","TIULP",121,0)
 S TIU0=$G(^TIU(8925,+TIUDA,0)),STATUS=$P(TIU0,U,5)
"RTN","TIULP",122,0)
 S TIU12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIULP",123,0)
 S TIU13=$G(^TIU(8925,+TIUDA,13)),TIU15=$G(^TIU(8925,+TIUDA,15))
"RTN","TIULP",124,0)
 I PERSON=+$P(TIU13,U,2) S TIUY=+$O(^USR(8930.2,"B","TRANSCRIBER",0))_U
"RTN","TIULP",125,0)
 I PERSON=+$P(TIU12,U,2) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","AUTHOR/DICTATOR",0))_U
"RTN","TIULP",126,0)
 I PERSON=+$P(TIU12,U,9) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","ATTENDING PHYSICIAN",0))_U
"RTN","TIULP",127,0)
 I PERSON=+$P(TIU12,U,4) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","EXPECTED SIGNER",0))_U
"RTN","TIULP",128,0)
 I PERSON=+$P(TIU12,U,8) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","EXPECTED COSIGNER",0))_U
"RTN","TIULP",129,0)
 I $$ASURG^TIUADSIG(TIUDA) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","SURROGATE",0))_U ;P157
"RTN","TIULP",130,0)
 ;Check if the person can be an Interpreter for this document via a Consult API
"RTN","TIULP",131,0)
 I $$CPINTERP^GMRCCP(+TIUDA,PERSON) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","INTERPRETER",0))_U
"RTN","TIULP",132,0)
 I STATUS>6 D  I COMPLTR S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","COMPLETER",0))_U
"RTN","TIULP",133,0)
 . S COMPLTR=0
"RTN","TIULP",134,0)
 . I PERSON=+$P(TIU15,U,8) S COMPLTR=1 Q
"RTN","TIULP",135,0)
 . I '$P(TIU15,U,8),PERSON=+$P(TIU15,U,2) S COMPLTR=1
"RTN","TIULP",136,0)
 I +$O(^TIU(8925.7,"AE",+TIUDA,+PERSON,0)) D
"RTN","TIULP",137,0)
 . N TIUXTRA S TIUXTRA=+$O(^TIU(8925.7,"AE",+TIUDA,+PERSON,0))
"RTN","TIULP",138,0)
 . I +$P($G(^TIU(8925.7,+TIUXTRA,0)),U,4) Q
"RTN","TIULP",139,0)
 . S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","ADDITIONAL SIGNER",0))_U
"RTN","TIULP",140,0)
 Q $G(TIUY)
"RTN","TIULP",141,0)
USREVNT(EVENT) ; Given event name, return:
"RTN","TIULP",142,0)
 ;EVENT = event pointer^user verb^verb modifier
"RTN","TIULP",143,0)
 ; **100** added verb modifier piece (.07)
"RTN","TIULP",144,0)
 N TIUY,TIUDA,NODE0
"RTN","TIULP",145,0)
 S TIUDA=+$O(^USR(8930.8,"B",EVENT,0))
"RTN","TIULP",146,0)
 S NODE0=$G(^USR(8930.8,TIUDA,0))
"RTN","TIULP",147,0)
 S TIUY=TIUDA_U_$P(NODE0,U,5)_U_$P(NODE0,U,7)
"RTN","TIULP",148,0)
 Q TIUY
"RTN","TIULP",149,0)
CANPICK(TIUTYP) ; Screens selection of title by title status and
"RTN","TIULP",150,0)
 ;(for status TEST), by owner.
"RTN","TIULP",151,0)
 N TIUPOWN,TIUCOWN,TIUT0,TIUTSTAT,TIUY S TIUY=0
"RTN","TIULP",152,0)
 S TIUT0=$G(^TIU(8925.1,+TIUTYP,0)),TIUTSTAT=$P(TIUT0,U,7)
"RTN","TIULP",153,0)
 I TIUTSTAT']"" S TIUY=0 G CANPIX
"RTN","TIULP",154,0)
 I TIUTSTAT=13 S TIUY=0 G CANPIX
"RTN","TIULP",155,0)
 I TIUTSTAT=11 S TIUY=1 G CANPIX
"RTN","TIULP",156,0)
 S TIUPOWN=$P(TIUT0,U,5),TIUCOWN=+$P(TIUT0,U,6)
"RTN","TIULP",157,0)
 I TIUTSTAT=10 S TIUY=$S(TIUPOWN=DUZ:1,+$$ISA^USRLM(DUZ,TIUCOWN):1,1:0)
"RTN","TIULP",158,0)
CANPIX Q +$G(TIUY)
"RTN","TIULP",159,0)
REQCOSIG(TIUTYP,TIUDA,USER,TIUDT) ; Evaluate whether user requires cosignature
"RTN","TIULP",160,0)
 N TIUI,TIUY,TIUDPRM S USER=$S(+$G(USER):+$G(USER),1:+$G(DUZ))
"RTN","TIULP",161,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,+$G(TIUDA))
"RTN","TIULP",162,0)
 I $G(TIUDPRM(5))="" G REQCOSX
"RTN","TIULP",163,0)
 I +$G(TIUDT)'>0 S TIUDT=+$P($P(+$G(^TIU(8925,+$G(TIUDA),13)),U),".")
"RTN","TIULP",164,0)
 F TIUI=1:1:$L(TIUDPRM(5),U) D  Q:+TIUY>0
"RTN","TIULP",165,0)
 . S TIUY=+$$ISA^USRLM(+USER,+$P(TIUDPRM(5),U,TIUI),,+$G(TIUDT))
"RTN","TIULP",166,0)
REQCOSX Q +$G(TIUY)
"RTN","TIULP",167,0)
 ;
"RTN","TIULP",168,0)
REQCPF(TIUCDA) ;Check if clinical procedure fields are required
"RTN","TIULP",169,0)
 ; Input  -- TIUCDA   Request/Consult File (#123) IEN
"RTN","TIULP",170,0)
 ; Output -- 1=Required and 0=Not Required
"RTN","TIULP",171,0)
 N TIUCPACT,REQF
"RTN","TIULP",172,0)
 I '$G(TIUCDA) G REQCPFQ
"RTN","TIULP",173,0)
 S TIUCPACT=$$CPACTM^GMRCCP(TIUCDA)
"RTN","TIULP",174,0)
 I TIUCPACT=1!(TIUCPACT=3) S REQF=1
"RTN","TIULP",175,0)
REQCPFQ Q +$G(REQF)
"RTN","TIULP3")
0^1^B6517608^B5635029
"RTN","TIULP3",1,0)
TIULP3 ;BAY PINES/ELR - Functions determining privilege continued ; 3/7/12 10:52am
"RTN","TIULP3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**232,256**;Jun 20, 1997;Build 11
"RTN","TIULP3",3,0)
 ;;ISA^USRLM: ICA 2324
"RTN","TIULP3",4,0)
ISSURG(TIUDA) ;
"RTN","TIULP3",5,0)
 NEW TIUY
"RTN","TIULP3",6,0)
 I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA=+$P($G(^TIU(8925,TIUDA,0)),U,6)
"RTN","TIULP3",7,0)
 D ISSURG^TIUSROI(.TIUY,+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIULP3",8,0)
 G SURGEX:TIUY'>0
"RTN","TIULP3",9,0)
 ;SEE IF IT IS AN NIR OR AR
"RTN","TIULP3",10,0)
 N TIUS0,TIUSNAME
"RTN","TIULP3",11,0)
 S TIUY=0
"RTN","TIULP3",12,0)
 G SURGEX:'$L(TIUDA)
"RTN","TIULP3",13,0)
 G SURGEX:'$D(^TIU(8925,+TIUDA,0))
"RTN","TIULP3",14,0)
 S TIUS0=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIULP3",15,0)
 G SURGEX:'$L(TIUS0)
"RTN","TIULP3",16,0)
 S TIUSNAME=$$PNAME^TIULC1(+TIUS0)
"RTN","TIULP3",17,0)
 G SURGEX:'$L(TIUSNAME)
"RTN","TIULP3",18,0)
 I TIUSNAME="NURSE INTRAOPERATIVE REPORT" S TIUY=1 G SURGEX
"RTN","TIULP3",19,0)
 I TIUSNAME="ANESTHESIA REPORT" S TIUY=1 G SURGEX
"RTN","TIULP3",20,0)
SURGEX Q TIUY
"RTN","TIULP3",21,0)
ACTION(TIUACTW) ;CHECK ACTION
"RTN","TIULP3",22,0)
 NEW TIUY S TIUY=0
"RTN","TIULP3",23,0)
 I (($G(TIUACTW)["EDIT RECORD")!($G(TIUACTW)["ADDEND")) S TIUY=1 G ACTEX
"RTN","TIULP3",24,0)
ACTEX Q TIUY
"RTN","TIULP3",25,0)
AUTHUSR(PERSON) ;Check to see if user is Privacy Act Officer or Chief Mis/Hims
"RTN","TIULP3",26,0)
 N TIUY S TIUY=0
"RTN","TIULP3",27,0)
 I ($$ISA^USRLM(PERSON,"PRIVACY ACT OFFICER"))!($$ISA^USRLM(PERSON,"CHIEF, MIS"))!($$ISA^USRLM(PERSON,"CHIEF, HIMS")) S TIUY=1 G USREX
"RTN","TIULP3",28,0)
USREX Q TIUY
"RTN","TIULP3",29,0)
SURMSG(TIUACTW) ;SET SURGERY ERROR MSG
"RTN","TIULP3",30,0)
 NEW TIUY,TIUDOC S TIUDOC=""
"RTN","TIULP3",31,0)
 I TIUACTW["EDIT" S TIUDOC="EDIT"
"RTN","TIULP3",32,0)
 I TIUACTW["ADDEND" S TIUDOC="CREATE AN ADDENDUM FOR"
"RTN","TIULP3",33,0)
 I TIUACTW["AMENDMENT" S TIUDOC="AMEND"
"RTN","TIULP3",34,0)
 S TIUY="You must use the Surgery Package to "_TIUDOC_" this Document"
"RTN","TIULP3",35,0)
 Q TIUY
"RTN","TIULP3",36,0)
IDMSG(TIUMSG) ;SET DELETE ID MSG
"RTN","TIULP3",37,0)
 S TIUMSG="You may NOT delete this parent ID note.  It has child ID notes attached. "
"RTN","TIULP3",38,0)
 S TIUMSG=TIUMSG_"If you need to delete this note you must first detach the child from the parent note."
"RTN","TIULP3",39,0)
 I $G(XQY0)["OR CPRS GUI CHART" D                 ;DBIA 3356
"RTN","TIULP3",40,0)
 . S TIUMSG=TIUMSG_" Select Action/Detach from Interdisciplinary Note to accomplish this."
"RTN","TIULP3",41,0)
 E  S TIUMSG=TIUMSG_"  Select the child note from the LM screen, then select Interdisciplinary Note."
"RTN","TIULP3",42,0)
 Q
"VER")
8.0^22.0
"BLD",8440,6)
^252
**END**
**END**
