Released DVBA*2.7*168 SEQ #153
Extracted from mail message
**KIDS**:DVBA*2.7*168^

**INSTALL NAME**
DVBA*2.7*168
"BLD",7951,0)
DVBA*2.7*168^AUTOMATED MED INFO EXCHANGE^0^3110524^y
"BLD",7951,1,0)
^^1^1^3110505^
"BLD",7951,1,1,0)
Refer to patch description on Forum for details of this build.
"BLD",7951,4,0)
^9.64PA^396.2^1
"BLD",7951,4,396.2,0)
396.2
"BLD",7951,4,396.2,2,0)
^9.641^396.2^1
"BLD",7951,4,396.2,2,396.2,0)
AMIE REPORT  (File-top level)
"BLD",7951,4,396.2,2,396.2,1,0)
^9.6411^3.5^1
"BLD",7951,4,396.2,2,396.2,1,3.5,0)
7132 ROUTING LOCATION
"BLD",7951,4,396.2,222)
y^n^p^^^^n^^n
"BLD",7951,4,396.2,224)

"BLD",7951,4,"APDD",396.2,396.2)

"BLD",7951,4,"APDD",396.2,396.2,3.5)

"BLD",7951,4,"B",396.2,396.2)

"BLD",7951,6.3)
3
"BLD",7951,"ABPKG")
n
"BLD",7951,"KRN",0)
^9.67PA^779.2^20
"BLD",7951,"KRN",.4,0)
.4
"BLD",7951,"KRN",.401,0)
.401
"BLD",7951,"KRN",.402,0)
.402
"BLD",7951,"KRN",.403,0)
.403
"BLD",7951,"KRN",.5,0)
.5
"BLD",7951,"KRN",.84,0)
.84
"BLD",7951,"KRN",3.6,0)
3.6
"BLD",7951,"KRN",3.8,0)
3.8
"BLD",7951,"KRN",9.2,0)
9.2
"BLD",7951,"KRN",9.8,0)
9.8
"BLD",7951,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",7951,"KRN",9.8,"NM",1,0)
DVBASPD2^^0^B48576328
"BLD",7951,"KRN",9.8,"NM",2,0)
DVBAUTIL^^0^B26857986
"BLD",7951,"KRN",9.8,"NM",3,0)
DVBAB6^^0^B30141617
"BLD",7951,"KRN",9.8,"NM",4,0)
DVBCPND1^^0^B23119648
"BLD",7951,"KRN",9.8,"NM",5,0)
DVBCUTL2^^0^B27251229
"BLD",7951,"KRN",9.8,"NM",6,0)
DVBABURL^^0^B2300547
"BLD",7951,"KRN",9.8,"NM","B","DVBAB6",3)

"BLD",7951,"KRN",9.8,"NM","B","DVBABURL",6)

"BLD",7951,"KRN",9.8,"NM","B","DVBASPD2",1)

"BLD",7951,"KRN",9.8,"NM","B","DVBAUTIL",2)

"BLD",7951,"KRN",9.8,"NM","B","DVBCPND1",4)

"BLD",7951,"KRN",9.8,"NM","B","DVBCUTL2",5)

"BLD",7951,"KRN",19,0)
19
"BLD",7951,"KRN",19,"NM",0)
^9.68A^^
"BLD",7951,"KRN",19.1,0)
19.1
"BLD",7951,"KRN",101,0)
101
"BLD",7951,"KRN",409.61,0)
409.61
"BLD",7951,"KRN",771,0)
771
"BLD",7951,"KRN",779.2,0)
779.2
"BLD",7951,"KRN",870,0)
870
"BLD",7951,"KRN",8989.51,0)
8989.51
"BLD",7951,"KRN",8989.52,0)
8989.52
"BLD",7951,"KRN",8994,0)
8994
"BLD",7951,"KRN","B",.4,.4)

"BLD",7951,"KRN","B",.401,.401)

"BLD",7951,"KRN","B",.402,.402)

"BLD",7951,"KRN","B",.403,.403)

"BLD",7951,"KRN","B",.5,.5)

"BLD",7951,"KRN","B",.84,.84)

"BLD",7951,"KRN","B",3.6,3.6)

"BLD",7951,"KRN","B",3.8,3.8)

"BLD",7951,"KRN","B",9.2,9.2)

"BLD",7951,"KRN","B",9.8,9.8)

"BLD",7951,"KRN","B",19,19)

"BLD",7951,"KRN","B",19.1,19.1)

"BLD",7951,"KRN","B",101,101)

"BLD",7951,"KRN","B",409.61,409.61)

"BLD",7951,"KRN","B",771,771)

"BLD",7951,"KRN","B",779.2,779.2)

"BLD",7951,"KRN","B",870,870)

"BLD",7951,"KRN","B",8989.51,8989.51)

"BLD",7951,"KRN","B",8989.52,8989.52)

"BLD",7951,"KRN","B",8994,8994)

"BLD",7951,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7951,"QUES",0)
^9.62^^
"BLD",7951,"REQB",0)
^9.611^2^2
"BLD",7951,"REQB",1,0)
DVBA*2.7*32^2
"BLD",7951,"REQB",2,0)
DVBA*2.7*149^2
"BLD",7951,"REQB","B","DVBA*2.7*149",2)

"BLD",7951,"REQB","B","DVBA*2.7*32",1)

"FIA",396.2)
AMIE REPORT
"FIA",396.2,0)
^DVB(396.2,
"FIA",396.2,0,0)
396.2IP
"FIA",396.2,0,1)
y^n^p^^^^n^^n
"FIA",396.2,0,10)

"FIA",396.2,0,11)

"FIA",396.2,0,"RLRO")

"FIA",396.2,0,"VR")
2.7^DVBA
"FIA",396.2,396.2)
1
"FIA",396.2,396.2,3.5)

"MBREQ")
0
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^3010328
"PKG",223,22,1,"PAH",1,0)
168^3110524
"PKG",223,22,1,"PAH",1,1,0)
^^1^1^3110524
"PKG",223,22,1,"PAH",1,1,1,0)
Refer to patch description on Forum for details of this build.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","DVBAB6")
0^3^B30141617^B29419198
"RTN","DVBAB6",1,0)
DVBAB6 ;ALB/KLB,SBW - CAPRI PENDING 2507 REQUEST ; 5/MAR/2011
"RTN","DVBAB6",2,0)
 ;;2.7;AMIE;**35,90,108,168**;Apr 10, 1995;Build 3
"RTN","DVBAB6",3,0)
 ;
"RTN","DVBAB6",4,0)
STRT(MSG,DVBCSORT,RSTAT,ERDAYS,OLDAYS,ADIVNUM,ELTYP) ;
"RTN","DVBAB6",5,0)
 I ADIVNUM'="" S X=$O(^DG(40.8,"C",ADIVNUM,"")) S:X]"" ADIVNUM=X
"RTN","DVBAB6",6,0)
SETUP K ^TMP($J),^TMP("CAPRI")
"RTN","DVBAB6",7,0)
 S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ"),PG=1,DVBCCNT=0,DONE="NO",MSGCNT=1
"RTN","DVBAB6",8,0)
 S DVBCHDR="Sorted by "_$S(DVBCSORT="V":"VETERAN NAME",DVBCSORT="R":"Routing location",DVBCSORT="S":"Status",DVBCSORT="A":"Age of request",1:"Unknown")
"RTN","DVBAB6",9,0)
HEAD S HEAD="Pending 2507 Requests for "_$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Unknown site"),HEAD2="",PROCDT="Processed on: "_DVBCDT(0),NODATA=0
"RTN","DVBAB6",10,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",11,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD2_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",12,0)
 S ^TMP("CAPRI",MSGCNT)=PROCDT_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",13,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",14,0)
 S $P(^TMP("CAPRI",MSGCNT),"=",75)="=^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",15,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",16,0)
 S ^TMP("CAPRI",MSGCNT)="",MSGCNT=MSGCNT+1
"RTN","DVBAB6",17,0)
DATA S DFN="" F  S DFN=$O(^DVB(396.3,"B",DFN)) Q:DFN=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",DFN,REQDA)) Q:REQDA=""  D SORT^DVBAB5
"RTN","DVBAB6",18,0)
 I DVBCSORT="V" S PNAM="" F  S PNAM=$O(^TMP($J,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,PNAM,DFN)) Q:'DFN  F DA(1)=0:0 S DA(1)=$O(^TMP($J,PNAM,DFN,DA(1))) Q:'DA(1)  D PRINT I $D(OUT) S DA(1)=999999999,PNAM="ZZZ",DONE="YES" Q
"RTN","DVBAB6",19,0)
 I DVBCSORT="R"!(DVBCSORT="A")!(DVBCSORT="S") D
"RTN","DVBAB6",20,0)
 . S JX="" F  S JX=$O(^TMP($J,JX)) Q:JX=""  D
"RTN","DVBAB6",21,0)
 .. S PNAM="" F  S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  D
"RTN","DVBAB6",22,0)
 ... F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:'DFN  D NXT
"RTN","DVBAB6",23,0)
 I DVBCCNT>0 S ^TMP("CAPRI",MSGCNT)="Total pending: "_DVBCCNT,DONE="YES"
"RTN","DVBAB6",24,0)
 ;
"RTN","DVBAB6",25,0)
EXIT I NODATA=0 S ^TMP("CAPRI",MSGCNT)="No pending request found for select parameters.",MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",26,0)
 I DONE="YES" S MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",27,0)
 K ^TMP($J),ADIV,CNUM,NODATA,STATUS,TST,TSTA1,STSAT,KKMSGCNT,PG,PRTNM,RDATE,RDATE1,REQDA,SSN,RONAME,JX
"RTN","DVBAB6",28,0)
 K PROCDT,REQSTR,TSTAT,DA,DFN,DONE,DVBCCNT,DVBCDT,DVBCHDR,X,XX,ZS,ZZZ,HEAD,HEAD2,OUT,OWNDOM,EDAYS,PNAM
"RTN","DVBAB6",29,0)
 Q
"RTN","DVBAB6",30,0)
 ;
"RTN","DVBAB6",31,0)
PRINT S ADIV=$S($D(^DVB(396.3,DA(1),1)):$P(^(1),U,4),1:"") Q:ADIV'=ADIVNUM&(DVBCSORT="R")  I ADIV]"" S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBAB6",32,0)
 S RDATE1=$P(^DVB(396.3,DA(1),0),U,2),RDATE=$P(^(0),U,5)
"RTN","DVBAB6",33,0)
 S SSN=$P($G(^DPT(DFN,0)),U,9) S:SSN="" SSN="Unknown"
"RTN","DVBAB6",34,0)
 S CNUM=$P($G(^DPT(DFN,.31)),U,3) S:CNUM="" CNUM="Unknown"
"RTN","DVBAB6",35,0)
 D ELAPSED^DVBAB5
"RTN","DVBAB6",36,0)
 S STATUS="Unknown",^TMP("CAPRI",MSGCNT)="Division: "_ADIV_"^",MSGCNT=MSGCNT+1,XX=$P(^DVB(396.3,DA(1),0),U,18),STATUS=$S(XX="N":"New",XX="P":"Pending, reported",XX="S":"Pending, scheduled",XX="R":"Released to RO, not printed",1:"")
"RTN","DVBAB6",37,0)
 I STATUS="",$D(XX) S STATUS=$S(XX="C":"Completed, printed by RO",XX="X":"Cancelled by RO",XX="T":"Transcribed",XX="NT":"New,Transferred in",XX="CT":"Completed, Transferred out",1:"Unknown")
"RTN","DVBAB6",38,0)
 S ^TMP("CAPRI",MSGCNT)="Status: "_STATUS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",39,0)
 S ^TMP("CAPRI",MSGCNT)=PNAM_" ^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="SSN: "_SSN_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="Claim no: "_CNUM_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",40,0)
 S ^TMP("CAPRI",MSGCNT)="Request Date: "_$$FMTE^XLFDT(RDATE1,"5DZ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",41,0)
 S ^TMP("CAPRI",MSGCNT)="Elapsed days: "_EDAYS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",42,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",43,0)
 S X=$S($D(^DVB(396.3,DA(1),4)):^(4),1:"")
"RTN","DVBAB6",44,0)
 S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" S ^TMP("CAPRI",MSGCNT)="Transferred in from "_$S($D(^DIC(4.2,+OWNDOM,0)):$P(^(0),U,1),1:"Unknown Site")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",45,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",46,0)
 S ^TMP("CAPRI",MSGCNT)="Exams requested:"_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",47,0)
 ;
"RTN","DVBAB6",48,0)
ITEMS D TST S NODATA=1,REQSTR=+$P(^DVB(396.3,DA(1),0),U,4)
"RTN","DVBAB6",49,0)
 S ZZZ="Requested by: "_$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")_" at "
"RTN","DVBAB6",50,0)
 S RONAME=$P(^DVB(396.3,DA(1),0),U,3),RONAME=$S(RONAME]"":$P(^DIC(4,+RONAME,0),U,1),1:"")
"RTN","DVBAB6",51,0)
 S ^TMP("CAPRI",MSGCNT)="^"_ZZZ_$S(RONAME]"":RONAME,1:" (Not specified) ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",52,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",53,0)
 S $P(^TMP("CAPRI",MSGCNT),"-",75)="-^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",54,0)
 S DVBCCNT=DVBCCNT+1,MSGCNT=MSGCNT+1
"RTN","DVBAB6",55,0)
 Q
"RTN","DVBAB6",56,0)
NXT F DA(1)=0:0 S DA(1)=$O(^TMP($J,JX,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZZ",JX=$S($A(JX)>57:PNAM,1:9999999),DONE="YES"
"RTN","DVBAB6",57,0)
 Q
"RTN","DVBAB6",58,0)
TST F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  K PRINT S TSTAT=$P(^DVB(396.4,DA,0),U,4),TST=$P(^DVB(396.4,DA,0),U,3),PRTNM=$S($D(^DVB(396.6,TST,0)):$P(^(0),U,2),1:"") D TST1
"RTN","DVBAB6",59,0)
 Q
"RTN","DVBAB6",60,0)
TST1 S TSTA1=""
"RTN","DVBAB6",61,0)
 I $D(^DVB(396.4,DA,"CAN")) S TSTA1=$P(^DVB(396.4,DA,"CAN"),U,3)
"RTN","DVBAB6",62,0)
 I $D(^DVB(396.4,DA,"TRAN")) S X=$P(^DVB(396.4,DA,"TRAN"),U,3)
"RTN","DVBAB6",63,0)
 S:TSTA1]"" TSTA1=$P(^DVB(396.5,TSTA1,0),U,1)
"RTN","DVBAB6",64,0)
 S ^TMP("CAPRI",MSGCNT)=$S(PRTNM]"":PRTNM,1:"Missing exam name")
"RTN","DVBAB6",65,0)
 S ^TMP("CAPRI",MSGCNT)=^TMP("CAPRI",MSGCNT)_$S(TSTA1]"":" - cancelled ("_TSTA1_")",TSTAT="T":" - Transferred",TSTAT]"":" - "_$$EXTERNAL^DILFD(396.4,.04,,TSTAT),TSTAT="":" (Unknown status)",1:"")_"^"
"RTN","DVBAB6",66,0)
 S MSGCNT=MSGCNT+1
"RTN","DVBAB6",67,0)
 I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") S ^TMP("CAPRI",MSGCNT)=" to "_$P(X,".",1),MSGCNT=MSGCNT+1
"RTN","DVBAB6",68,0)
 Q
"RTN","DVBABURL")
0^6^B2300547^B2397510
"RTN","DVBABURL",1,0)
DVBABURL ;ALB/SPH - CAPRI URL ;24/MAR/2011
"RTN","DVBABURL",2,0)
 ;;2.7;AMIE;**104,136,143,149,168**;Apr 10, 1995;Build 3
"RTN","DVBABURL",3,0)
 ;
"RTN","DVBABURL",4,0)
URL(Y,WHICH) ; 
"RTN","DVBABURL",5,0)
 S Y=""
"RTN","DVBABURL",6,0)
 ; 1=VBA's AMIE Worksheet Website
"RTN","DVBABURL",7,0)
 ; 2=CAPRI training website
"RTN","DVBABURL",8,0)
 ; 3=VistAWeb website
"RTN","DVBABURL",9,0)
 ; 5=HIA download website
"RTN","DVBABURL",10,0)
 ; 999=Debug/Test Code
"RTN","DVBABURL",11,0)
 I WHICH=1 S Y="http://152.124.238.193/bl/21/rating/Medical/exams/index.htm"
"RTN","DVBABURL",12,0)
 I WHICH=2 S Y="http://vaww.demo.va.gov/"
"RTN","DVBABURL",13,0)
 I WHICH=3 D
"RTN","DVBABURL",14,0)
 . I '$$PROD^XUPROD S Y="-1^VistAWeb disabled for non-production systems." Q
"RTN","DVBABURL",15,0)
 . S Y="https://vistaweb.med.va.gov/CapriPage.aspx"
"RTN","DVBABURL",16,0)
 I WHICH=4 S Y="M21-1, Part VI, Rating Board Procedures^http://152.124.238.193/bl/21/Publicat/Manuals/Part6/601.htm#Exam"
"RTN","DVBABURL",17,0)
 I WHICH=5 S Y=$$GET^XPAR("PKG","DVBAB CAPRI HIA UPDATE URL",1,"Q")
"RTN","DVBABURL",18,0)
 I WHICH=999 S Y="http://vhaannweb2.v11.med.va.gov/VwDesktop/CapriPage.aspx"
"RTN","DVBABURL",19,0)
 Q 
"RTN","DVBABURL",20,0)
 ;
"RTN","DVBASPD2")
0^1^B48576328^B47508013
"RTN","DVBASPD2",1,0)
DVBASPD2 ;ALB/GTS-557/THM,SBW-AMIE SPECIAL REPORT ; 3/MAY/2011
"RTN","DVBASPD2",2,0)
 ;;2.7;AMIE;**3,57,149,168**;Apr 10, 1995;Build 3
"RTN","DVBASPD2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DVBASPD2",4,0)
 ;
"RTN","DVBASPD2",5,0)
 K ^TMP($J) G TERM
"RTN","DVBASPD2",6,0)
SET Q:'$D(^DPT(DA,0))  S DFN=DA D RCV^DVBAVDPT Q:RCVPEN'=1&(REP="P")  Q:RCVAA'=1&(REP="A")  Q:CFLOC'=RONUM&(RO="Y")&(CFLOC'=0)&(CFLOC'=376)
"RTN","DVBASPD2",7,0)
 S DCHPTR=$P(^DGPM(MB,0),U,17),TDIS=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U,18),1:"")
"RTN","DVBASPD2",8,0)
 I +TDIS,'$D(^TMP("DVBA",$J,"DUP",+TDIS)) Q
"RTN","DVBASPD2",9,0)
 S TDIS=$S($P($G(^DG(405.2,+TDIS,0)),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBASPD2",10,0)
 S ^TMP($J,XCN,CFLOC,MB,DA)=MA_U_RCVAA_U_RCVPEN_U_CNUM_U_TDIS
"RTN","DVBASPD2",11,0)
 Q
"RTN","DVBASPD2",12,0)
 ;
"RTN","DVBASPD2",13,0)
PRINTB W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBASPD2",14,0)
 W !!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBASPD2",15,0)
 W ?10,REP(0),?26,PNAM,!!,?14,REP(1),?26,CNUM,!,?6,REP(2),?26,XCFLOC,!,?9,REP(3),?26,SSN,!,?8,REP(4),?26,ADMDT,!,?3,REP(5),?26,DIAG,!
"RTN","DVBASPD2",16,0)
 W ?8,REP(6),?26,DCHGDT,! W:DCHGDT]"" ?5,REP(7),?26,$$DIS,!
"RTN","DVBASPD2",17,0)
 W ?11,REP(8),?26,BEDSEC,!,?13,REP(9),?26,$$RAA,!
"RTN","DVBASPD2",18,0)
 W ?14,REP(10),?26,$$PEN,! D ELIG^DVBAVDPT
"RTN","DVBASPD2",19,0)
 I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) QUIT=1 I '$T S DVBAQUIT=1 I '$T S DVBAQUIT=1
"RTN","DVBASPD2",20,0)
 S DVBAON2=""
"RTN","DVBASPD2",21,0)
 Q
"RTN","DVBASPD2",22,0)
RAA() Q $S(RCVAA=0:"NO",RCVAA=1:"YES",1:"Not specified")
"RTN","DVBASPD2",23,0)
PEN() Q $S(RCVPEN=0:"NO",RCVPEN=1:"YES",1:"Not specified")
"RTN","DVBASPD2",24,0)
DIS() Q TDIS_$S(TO]"":" TO "_$S($D(^DIC(4,+TO,0)):$P(^(0),U,1),1:""),1:"")
"RTN","DVBASPD2",25,0)
SP(N,M) S $P(M," ",N-1)=" " Q M  ;pass one arg, 2nd for local use
"RTN","DVBASPD2",26,0)
PRINTC F J=0:1:7 S ^TMP("DVBSPCRP",$J,DVBC+J)=DVBS(J) ;NakedRefs = ^TMP("DVBSPCRP",$J,DVBC+J)
"RTN","DVBASPD2",27,0)
 S DVBC=DVBC+6,^TMP("DVBSPCRP",$J,DVBC)=$$SP(10)_REP(0)_PNAM
"RTN","DVBASPD2",28,0)
 S ^(DVBC+2)=$$SP(14)_REP(1)_CNUM
"RTN","DVBASPD2",29,0)
 S ^(DVBC+3)=$$SP(6)_REP(2)_XCFLOC
"RTN","DVBASPD2",30,0)
 S ^(DVBC+4)=$$SP(9)_REP(3)_SSN
"RTN","DVBASPD2",31,0)
 S ^(DVBC+5)=$$SP(8)_REP(4)_ADMDT
"RTN","DVBASPD2",32,0)
 S ^(DVBC+6)=$$SP(3)_REP(5)_DIAG
"RTN","DVBASPD2",33,0)
 S DVBC=DVBC+7,^(DVBC)=$$SP(8)_REP(6)_DCHGDT
"RTN","DVBASPD2",34,0)
 I DCHGDT]"" D
"RTN","DVBASPD2",35,0)
 .S DVBC=DVBC+1,^(DVBC)=$$SP(5)_REP(7)_$$DIS
"RTN","DVBASPD2",36,0)
 S ^(DVBC+1)=$$SP(11)_REP(8)_BEDSEC
"RTN","DVBASPD2",37,0)
 S ^(DVBC+2)=$$SP(13)_REP(9)_$$RAA
"RTN","DVBASPD2",38,0)
 S DVBC=DVBC+3,^(DVBC)=$$SP(14)_REP(10)_$$PEN
"RTN","DVBASPD2",39,0)
 D ELIG^DVBAVDPT
"RTN","DVBASPD2",40,0)
 Q
"RTN","DVBASPD2",41,0)
 ;
"RTN","DVBASPD2",42,0)
PRINTD ;print delimited special report
"RTN","DVBASPD2",43,0)
 N ELIG,INCMP,DVBADATA,DVBABRKER
"RTN","DVBASPD2",44,0)
 S DVBABRKER=$$BROKER^XWBLIB
"RTN","DVBASPD2",45,0)
 S ELIG=DVBAELIG,INCMP=""
"RTN","DVBASPD2",46,0)
 I ELIG]"" S ELIG=ELIG_" ("_$S(DVBAELST="P":"Pend Ver",DVBAELST="R":"Pend Re-verif",DVBAELST="V":"Verified",1:"Not Verified")_")"
"RTN","DVBASPD2",47,0)
 I $D(^DPT(DA,.29)) S INCMP=$S($P(^(.29),U,12)=1:"Incompetent",1:"")
"RTN","DVBASPD2",48,0)
 I INCMP]"",ELIG]"" S ELIG=ELIG_", "_INCMP
"RTN","DVBASPD2",49,0)
 D:('DVBADHDR) COLHDR
"RTN","DVBASPD2",50,0)
 S DVBADATA=PNAM_DVBADLMTR_CNUM_DVBADLMTR_XCFLOC_DVBADLMTR
"RTN","DVBASPD2",51,0)
 S DVBADATA=DVBADATA_SSN_DVBADLMTR_ADMDT_DVBADLMTR_DIAG_DVBADLMTR_DCHGDT_DVBADLMTR
"RTN","DVBASPD2",52,0)
 S DVBADATA=DVBADATA_$S(DCHGDT]"":$$DIS,1:"")_DVBADLMTR_BEDSEC_DVBADLMTR
"RTN","DVBASPD2",53,0)
 S DVBADATA=DVBADATA_$$RAA_DVBADLMTR_$$PEN_DVBADLMTR_ELIG
"RTN","DVBASPD2",54,0)
 D:DVBABRKER
"RTN","DVBASPD2",55,0)
 .S ^TMP("DVBSPCRP",$J,DVBC)=DVBADATA,DVBC=DVBC+1
"RTN","DVBASPD2",56,0)
 D:('DVBABRKER)
"RTN","DVBASPD2",57,0)
 .W !,DVBADATA
"RTN","DVBASPD2",58,0)
 Q
"RTN","DVBASPD2",59,0)
 ;
"RTN","DVBASPD2",60,0)
PRINT S QUIT="",XCN=""
"RTN","DVBASPD2",61,0)
 F  S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S XCFLOC="" F  S XCFLOC=$O(^TMP($J,XCN,XCFLOC)) Q:XCFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBASPD2",62,0)
 Q
"RTN","DVBASPD2",63,0)
PRINT1 S ADM="" F  S ADM=$O(^TMP($J,XCN,XCFLOC,ADM)) Q:ADM=""!(QUIT=1)  D
"RTN","DVBASPD2",64,0)
 .S DA="" F  S DA=$O(^TMP($J,XCN,XCFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  D
"RTN","DVBASPD2",65,0)
 ..S DATA=^(DA),MA=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3)
"RTN","DVBASPD2",66,0)
 ..S CNUM=$P(DATA,U,4),TDIS=$P(DATA,U,5),DFN=DA,TO="",QUIT1=1
"RTN","DVBASPD2",67,0)
 ..D ADM^DVBAVDPT
"RTN","DVBASPD2",68,0)
 ..S:ADMDT]"" ADMDT=$E(ADMDT,4,5)_"/"_$E(ADMDT,6,7)_"/"_$E(ADMDT,2,3)
"RTN","DVBASPD2",69,0)
 ..S:DCHGDT]"" DCHGDT=$E(DCHGDT,4,5)_"/"_$E(DCHGDT,6,7)_"/"_$E(DCHGDT,2,3)
"RTN","DVBASPD2",70,0)
 ..I $$BROKER^XWBLIB D @$S(($G(DVBADLMTR)=""):"PRINTC",1:"PRINTD") Q
"RTN","DVBASPD2",71,0)
 ..D @$S(($G(DVBADLMTR)=""):"PRINTB",1:"PRINTD")
"RTN","DVBASPD2",72,0)
 Q
"RTN","DVBASPD2",73,0)
SETUP S RPT="VARO REPORT"_$S(REP="A":" FOR A & A",1:" FOR PENSION"),DTAR=^DVB(396.1,1,0),FDT(0)=$E(DT,4,5)_"-"_$E(DT,6,7)_"-"_$E(DT,2,3)
"RTN","DVBASPD2",74,0)
 S HEAD="SPECIAL "_$S(REP="A":"A & A",1:"PENSION")_" REPORT",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBASPD2",75,0)
 S Y=$P(DTAR,U,9) X ^DD("DD") S REP("LRUN")="Last report was run on "_Y
"RTN","DVBASPD2",76,0)
 S REP(0)="Patient Name:",REP(1)="Claim No:"
"RTN","DVBASPD2",77,0)
 S REP(2)="Claim Folder Loc:",REP(3)="Social Sec No:"
"RTN","DVBASPD2",78,0)
 S REP(4)="Admission Date:",REP(5)="Admitting Diagnosis:"
"RTN","DVBASPD2",79,0)
 S REP(6)="Discharge Date:",REP(7)="Type of Discharge:"
"RTN","DVBASPD2",80,0)
 S REP(8)="Bed Service:",REP(9)="Recv A&A?:",REP(10)="Pension?:"
"RTN","DVBASPD2",81,0)
 Q
"RTN","DVBASPD2",82,0)
TERM D HOME^%ZIS,SETUP K NOASK
"RTN","DVBASPD2",83,0)
 W @IOF,!,RPT,!,HEAD1
"RTN","DVBASPD2",84,0)
 ;
"RTN","DVBASPD2",85,0)
EN1 W !!,"Please enter dates for search, oldest date first, most recent date last.",!!,REP("LRUN"),!!
"RTN","DVBASPD2",86,0)
 D DATE^DVBAUTIL
"RTN","DVBASPD2",87,0)
 G:X=""!(Y<0) KILL
"RTN","DVBASPD2",88,0)
 S %ZIS="Q" D ^%ZIS K %ZIS G:POP KILL^DVBAUTIL
"RTN","DVBASPD2",89,0)
 ;
"RTN","DVBASPD2",90,0)
QUEUE I $D(IO("Q")) S ZTRTN="DEQUE^DVBASPD2",ZTIO=ION,NOASK=1,ZTDESC="AMIE PENSION/A&A REPORT" F I="^TMP(""DVBA"",$J,""DUP"",","DVBATYPS","REP","FDT(0)","HEAD","HEAD1","BDATE","EDATE","TYPE","RO","RONUM","NOASK" S ZTSAVE(I)=""
"RTN","DVBASPD2",91,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",!! G KILL
"RTN","DVBASPD2",92,0)
 ;
"RTN","DVBASPD2",93,0)
GO S MA=BDATE F  S MA=$O(^DGPM("AMV1",MA)) Q:$P(MA,".")>EDATE!(MA="")  W:'$D(NOASK) "." F DA=0:0 S DA=$O(^DGPM("AMV1",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV1",MA,DA,MB)) Q:MB=""  D SET
"RTN","DVBASPD2",94,0)
 S:'$D(^TMP($J)) ER="No data found for parameters entered."
"RTN","DVBASPD2",95,0)
 G:$$BROKER^XWBLIB BROKER
"RTN","DVBASPD2",96,0)
 U IO I $D(ER) W !!,*7,ER,!! G KILL
"RTN","DVBASPD2",97,0)
 D PRINT
"RTN","DVBASPD2",98,0)
 I $D(DVBAQUIT) D:$D(ZTQUEUED) KILL^%ZTLOAD K ER,DVBAON2 G KILL^DVBAUTIL
"RTN","DVBASPD2",99,0)
 ;
"RTN","DVBASPD2",100,0)
KILL D ^%ZISC D:$D(ZTQUEUED) KILL^%ZTLOAD S X=9 K ER,DVBAON2 G FINAL^DVBAUTIL
"RTN","DVBASPD2",101,0)
 ;
"RTN","DVBASPD2",102,0)
INIT ;add header info to report
"RTN","DVBASPD2",103,0)
 I ($G(DVBADLMTR)'="") D  Q  ;no header info for delimited report
"RTN","DVBASPD2",104,0)
 .S DVBC=1
"RTN","DVBASPD2",105,0)
 F J=0,2,5,6,7 S DVBS(J)=" "
"RTN","DVBASPD2",106,0)
 S $P(DVBS(1),"-",70)="-",DVBS(3)=$$SP(70-$L(HEAD)\2)_HEAD,DVBS(4)=$$SP(70-$L(HEAD1)\2)_HEAD1
"RTN","DVBASPD2",107,0)
 S ^TMP("DVBSPCRP",$J,1)=" ",^(2)=RPT,^(3)=HEAD1,^(4)=" ",^(5)=REP("LRUN"),DVBC=6
"RTN","DVBASPD2",108,0)
 F J=0:1:10 S REP(J)=REP(J)_"    "
"RTN","DVBASPD2",109,0)
 Q
"RTN","DVBASPD2",110,0)
BROKER I $D(ER) K ^TMP("DVBSPCRP",$J) S ^($J,1)=ER
"RTN","DVBASPD2",111,0)
 E  D INIT,PRINT
"RTN","DVBASPD2",112,0)
 S X=9 G FINAL^DVBAUTIL
"RTN","DVBASPD2",113,0)
 ;
"RTN","DVBASPD2",114,0)
 ;Input: DVBADLMTR - Indicates if report should be delimited (Optional)
"RTN","DVBASPD2",115,0)
SPECRPT(ZMSG,DCTYPES,BDATE,EDATE,RONUM,REP,DVBADLMTR)      ;
"RTN","DVBASPD2",116,0)
 N I,J,REQ,DVBC,DVBACEPT,DVBS,ER,DVBADHDR
"RTN","DVBASPD2",117,0)
 S DVBADLMTR=$S('+$G(DVBADLMTR):"",1:"^"),DVBADHDR=0
"RTN","DVBASPD2",118,0)
 ; If RONUM not passed set value to "0" (zero) in order to include data
"RTN","DVBASPD2",119,0)
 ; for all regional offices
"RTN","DVBASPD2",120,0)
 I $G(RONUM)']"" S RONUM=0
"RTN","DVBASPD2",121,0)
 S ZMSG=$NA(^TMP("DVBSPCRP",$J)),REQ=" IS REQUIRED"
"RTN","DVBASPD2",122,0)
 S MB=" MUST BE ",TYPE="REPORT TYPE",BDT="BEGINNING DATE",EDT="ENDING DATE"
"RTN","DVBASPD2",123,0)
 I $G(BDATE)="" S ER=BDT_REQ
"RTN","DVBASPD2",124,0)
 I $G(EDATE)="" S ER=EDT_REQ
"RTN","DVBASPD2",125,0)
 I EDATE<BDATE S ER=BDT_MB_"BEFORE THE "_EDT
"RTN","DVBASPD2",126,0)
 I $G(REP)="" S ER=TYPE_REQ
"RTN","DVBASPD2",127,0)
 I "^A^P"'[REP S ER=TYPE_MB_"'A' OR 'P'"
"RTN","DVBASPD2",128,0)
 ;Only validate RONUM to be valid Station Number if it isn't zero
"RTN","DVBASPD2",129,0)
 I RONUM'="0"&(RONUM'?3N.4AN) S ER="REGIONAL OFFICE"_MB_"3 NUMBERS + OPTIONAL 1 TO 4 MODIFIER (MAX 7 CHARACTERS)"
"RTN","DVBASPD2",130,0)
 K ^TMP("DVBSPCRP",$J) I $D(ER) S ^($J,1)=ER,X=9 G FINAL^DVBAUTIL
"RTN","DVBASPD2",131,0)
 ;If RONUM = 0 then RO set to "N" to include data for all ROs
"RTN","DVBASPD2",132,0)
 ;If RONUM passed then RO set to "Y" to include data for only passed RO
"RTN","DVBASPD2",133,0)
 S (NOASK,DVBACEPT)=1,RO=$S(RONUM=0:"N",1:"Y")
"RTN","DVBASPD2",134,0)
 F J=0:0 S J=$O(DCTYPES(J)) Q:'J  S ^TMP("DVBA",$J,"DUP",DCTYPES(J))=""
"RTN","DVBASPD2",135,0)
 D SETUP
"RTN","DVBASPD2",136,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBASPD2",137,0)
 ;
"RTN","DVBASPD2",138,0)
COLHDR ;Column header for delimited report
"RTN","DVBASPD2",139,0)
 N DVBACHDR,DVBABRKER
"RTN","DVBASPD2",140,0)
 S DVBABRKER=$$BROKER^XWBLIB
"RTN","DVBASPD2",141,0)
 S DVBACHDR="Patient Name"_DVBADLMTR_"Claim No"_DVBADLMTR_"Claim Folder Loc"_DVBADLMTR
"RTN","DVBASPD2",142,0)
 S DVBACHDR=DVBACHDR_"Social Sec No"_DVBADLMTR_"Admission Date"_DVBADLMTR_"Admitting Diagnosis"_DVBADLMTR
"RTN","DVBASPD2",143,0)
 S DVBACHDR=DVBACHDR_"Discharge Date"_DVBADLMTR_"Type of Discharge"_DVBADLMTR_"Bed Service"_DVBADLMTR
"RTN","DVBASPD2",144,0)
 S DVBACHDR=DVBACHDR_"Recv A&A?"_DVBADLMTR_"Pension?"_DVBADLMTR_"Eligibility Data"
"RTN","DVBASPD2",145,0)
 S:DVBABRKER ^TMP("DVBSPCRP",$J,DVBC)=DVBACHDR,DVBC=DVBC+1
"RTN","DVBASPD2",146,0)
 D:('DVBABRKER)
"RTN","DVBASPD2",147,0)
 .W !,DVBACHDR
"RTN","DVBASPD2",148,0)
 S DVBADHDR=1  ;set so header info only printed once
"RTN","DVBASPD2",149,0)
 Q
"RTN","DVBAUTIL")
0^2^B26857986^B26516388
"RTN","DVBAUTIL",1,0)
DVBAUTIL ;ALB ISC/THM,SBW-AMIE UTILITIES ; 3/MAY/2011
"RTN","DVBAUTIL",2,0)
 ;;2.7;AMIE;**17,32,168**;Apr 10, 1995;Build 3
"RTN","DVBAUTIL",3,0)
 ;
"RTN","DVBAUTIL",4,0)
SORT W !!,"Sort by Regional Office number" S %=1 D YN^DICN I $D(DTOUT)!(%<0) K DTOUT S Y=-1 Q
"RTN","DVBAUTIL",5,0)
 I $D(%Y) I %Y["?" W !!,*7,"Enter Y to sort by the Regional Office number you",!,"select or enter N to get ALL Regional Offices reported." G SORT
"RTN","DVBAUTIL",6,0)
 I %'=1 S RO="N",RONUM=0 Q
"RTN","DVBAUTIL",7,0)
 I %=1 S RO="Y" G RONUM
"RTN","DVBAUTIL",8,0)
 W !,*7,"Invalid response.",!! G SORT
"RTN","DVBAUTIL",9,0)
 ;
"RTN","DVBAUTIL",10,0)
RONUM W !,"Regional Office number: " R RONUM:DTIME G:RONUM["^" SORT I '$T!(RONUM="") W *7 S Y=-1 Q
"RTN","DVBAUTIL",11,0)
 I RONUM'?3N.4AN W *7,"     Must be 3 numbers plus optional 1 to 4 alphanumeric modifier",!! G RONUM
"RTN","DVBAUTIL",12,0)
 Q
"RTN","DVBAUTIL",13,0)
 ;
"RTN","DVBAUTIL",14,0)
KILL ;kill all variables and exit selected program
"RTN","DVBAUTIL",15,0)
 D ^%ZISC
"RTN","DVBAUTIL",16,0)
KILL1 K %DT,%ZIS,ANS,BDATE,CNUM,EDATE,L,MA,DA,NODTA,PNAM,Q,QQ,RDATE,SSN,XY,VER,J,LN,POP,FINALDTE,ADMDT,BEDSEC,CFLOC,DIAG,DCHGDT,HEAD,HEAD1,MB,RCVAA,RCVPEN,A,TYPE,C,ADMNUM,DIPGM,DIS,HNAME,DVBAQUIT,DSRP
"RTN","DVBAUTIL",17,0)
 K WARD,NOASK,^TMP($J),DTOUT,ZTSK,IO("C"),I,RO,RONUM,LADM,K,RADM,%X,%Y,%XX,%YY,X,Y,ICDAT2,ICDAT,LOS,TDIS,DIC,POP,DVBATYPS,TO,NUMSEL,REP,DVBAFIND,DVBATP,DVBAPRNT,SITE,LINE,OPER,PG,HD,HD1,HEAD2,DVBADD
"RTN","DVBAUTIL",18,0)
 K ZTIO,ZTDESC,ZTRTN,DATA,SC,LDCH,FDT(0),NAME,DIE,DR,ZX,ZI,XDA,XADMDT,DLAYGO,HD,D,DIC,Y,Z,ZTYPE,D0,D1,DI,DQ,CNM,CFLC,XDTA,MC,MD,PROCDT,ADMDATE,EDAYS,CNT,XLOC,TEMP,TEMPDA,%ZIS,%IS,DIVHD,XDIV,DVBADIV,ADIV,BDT,EDT
"RTN","DVBAUTIL",19,0)
 K ZTYPE,DO,DTAR,X,Y,HEAD,HEAD1,ADTYPE,NDCH,DOCTYPE,ELIG,INCMP,LG,OUT,LADMDT,NONE,BDATE1,XDA2,ADM,DFN,DISCH,XCN,LCN,HOSP,NODE,T,TRN,ZTSAVE,ZDT,ZDT1,ZDA,IO("Q"),IOP,BDIV,EDIV,BDT1,EDT1,NEWREQ,BED,STAT,DVBADIC,ADMNUM
"RTN","DVBAUTIL",20,0)
 K X2,DHD,DIWF,DIWL,DIWR,DVBASC,DVBAELIG,FNLDT,CFLC,HIST,DVBAELST,OLDY,PDATE,ZTDTH,DTA,VAINDT,VAIN,WWHO,SDATE,%,DVBAQUIT,NODE,NOFINAL,^TMP("ADMIT",$J),LOC,AA,DVBASTAT,OLDY,ADMDT,ANS1,CURADMDT,DVBADT,DVBAH,DVBAQ
"RTN","DVBAUTIL",21,0)
 K DVBAI,DVBAT,HEADDT,HOSPDAYS,LBEDSEC,LDCHGDT,LDIAG,LLADM,LTDIS,MSG,MSG1,VX,VY,X1,XLINE,ZJ,ZY,ZZ,LOC,QUIT,QUIT1,^UTILITY($J),^TMP("DVBA",$J),^TMP("DVBA","PEN"),^TMP("DVBA","A&A"),DVBACEPT,DCHPTR,DVBA
"RTN","DVBAUTIL",22,0)
 Q
"RTN","DVBAUTIL",23,0)
 ;
"RTN","DVBAUTIL",24,0)
LOS ;compute length of stay for discharge report
"RTN","DVBAUTIL",25,0)
 S %DT="T" S X=ADMDT D ^%DT S X2=Y
"RTN","DVBAUTIL",26,0)
 S X=DCHGDT D ^%DT S X1=Y K Y
"RTN","DVBAUTIL",27,0)
 D ^%DTC S LOS=X I LOS=0 S LOS=""
"RTN","DVBAUTIL",28,0)
 Q
"RTN","DVBAUTIL",29,0)
DATE W !,?5,"The entry of future dates is NOT allowed.",!
"RTN","DVBAUTIL",30,0)
 S %DT(0)=-DT
"RTN","DVBAUTIL",31,0)
 S %DT("A")="BEGINNING date: ",%DT="AET" D ^%DT W:X="^"!(Y=-1) !! Q:X=""!(Y=-1)  S BDATE=Y
"RTN","DVBAUTIL",32,0)
 S %DT("A")="   ENDING date: ",%DT="AET" D ^%DT S EDATE=Y Q:X="^"
"RTN","DVBAUTIL",33,0)
 I EDATE<BDATE W !!,*7,"Invalid date sequence.  Beginning date must be before the ending date.",!! H 2 G DATE
"RTN","DVBAUTIL",34,0)
 S BDATE=BDATE-.5,EDATE=EDATE+.5
"RTN","DVBAUTIL",35,0)
 D SORT K %DT(0) Q
"RTN","DVBAUTIL",36,0)
 ;
"RTN","DVBAUTIL",37,0)
DICW S DVBADIC(0,"W")="S ZX=$P(^DVB(396,+Y,0),U,4) W:$X>40 ! W ""  Admission date: "",$$FMTE^XLFDT(ZX,""5DZ"") W ""  "",$S($P(^(1),U,12)'="""":""Finalized"",1:""Open"")"
"RTN","DVBAUTIL",38,0)
 ;
"RTN","DVBAUTIL",39,0)
DICW1 S DVBADIC(1,"W")="S ZX=$P(^DVB(396,+Y,0),U,4) W:$X>40 ! W ""  Activity date: "",$$FMTE^XLFDT(ZX,""5DZ"") W ""  "",$S($P(^(1),U,12)'="""":""Finalized"",1:""Open"")"
"RTN","DVBAUTIL",40,0)
 ;
"RTN","DVBAUTIL",41,0)
DICW2 S DIC("W")="S ZTYPE=$S($D(^DVB(396,+Y,2)):$P(^(2),U,10),1:""A"") X $S(ZTYPE=""L"":DVBADIC(1,""W""),1:DVBADIC(0,""W""))"
"RTN","DVBAUTIL",42,0)
 Q
"RTN","DVBAUTIL",43,0)
 ;
"RTN","DVBAUTIL",44,0)
FINAL ;
"RTN","DVBAUTIL",45,0)
 S $P(^DVB(396.1,1,0),"^",X)=DT ;x is the corresponding date field
"RTN","DVBAUTIL",46,0)
 G KILL1
"RTN","DVBAUTIL",47,0)
 ;
"RTN","DVBAUTIL",48,0)
DUZ2 K DVBAQUIT
"RTN","DVBAUTIL",49,0)
 I $G(DUZ(2))="" W *7,!!,"You have no division code.  Please contact the site manager.",!! H 3 S DVBAQUIT=1 Q
"RTN","DVBAUTIL",50,0)
 S DVBAD2=$S($D(^DIC(4,+DUZ(2),99)):$P(^(99),U,1),1:0)
"RTN","DVBAUTIL",51,0)
 I DVBAD2=0 W *7,!!,"Your division code is invalid.",!! H 3 S DVBAQUIT=1
"RTN","DVBAUTIL",52,0)
 ; Flag if the division has no station # in the INSITUTION file.
"RTN","DVBAUTIL",53,0)
 I $G(DVBAD2)="" W *7,!!,"Your division has no station number defined in the INSTITUTION file.",!,"Please consult IRM to request a unique station number for your division.",!! H 3 S DVBAQUIT=1
"RTN","DVBAUTIL",54,0)
 Q
"RTN","DVBAUTIL",55,0)
S ;
"RTN","DVBAUTIL",56,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",57,0)
 ;of AMIE.
"RTN","DVBAUTIL",58,0)
 Q
"RTN","DVBAUTIL",59,0)
S1 ;
"RTN","DVBAUTIL",60,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",61,0)
 ;of AMIE.
"RTN","DVBAUTIL",62,0)
 Q
"RTN","DVBAUTIL",63,0)
K ;
"RTN","DVBAUTIL",64,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",65,0)
 ;of AMIE.
"RTN","DVBAUTIL",66,0)
 Q
"RTN","DVBAUTIL",67,0)
K1 ;
"RTN","DVBAUTIL",68,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",69,0)
 ;of AMIE.
"RTN","DVBAUTIL",70,0)
 Q
"RTN","DVBAUTIL",71,0)
 ;
"RTN","DVBAUTIL",72,0)
EXIT ;called from the DVBAREG1 routine, kills off variables at end.
"RTN","DVBAUTIL",73,0)
 S VAR(1,0)="0,0,0,0:2,1^"
"RTN","DVBAUTIL",74,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAUTIL",75,0)
 K VAR,ADM,ADMDT,ANS,CNUM,DA,DFN,DIC,DIE,DR,PNAM,SSN,ZA,OPER,X,Y,POP,LOC,%,ZI,ONFILE,REOPEN,DVBADIV,STAT,ZX,HD,I,NAME,HNAME,DTAR,DTOUT,%Y,DOCTYPE,%Y1,DQ,DVBADIC,OUT,ZTYPE,A,ADMNUM,ANS1,OLDY,DVBASTAT,DVBAENTR,DVBAEDT
"RTN","DVBAUTIL",76,0)
 K DVBAD2,DVBAX,DVBCSSNO,AROWOUT,DVBADM,DVBANL,DVBAPT,DVBAQUIT,DVBBDT,DVBCHK,DVBDISP,DVBEDT,DVBSPCOD,DVBVAR,DVBCNT,DVBAY,DVBDOC,DVBAIFN,DVBANS
"RTN","DVBAUTIL",77,0)
 K ^TMP("DVBA",$J),^UTILITY("DIQ1",$J)
"RTN","DVBAUTIL",78,0)
 Q
"RTN","DVBAUTIL",79,0)
 ;
"RTN","DVBCPND1")
0^4^B23119648^B22927581
"RTN","DVBCPND1",1,0)
DVBCPND1 ;ALB/GTS-557/THM,SBW-2507 PENDING REQUESTS, PART 2 ; 3/MAY/2011
"RTN","DVBCPND1",2,0)
 ;;2.7;AMIE;**17,168**;Apr 10, 1995;Build 3
"RTN","DVBCPND1",3,0)
 ;
"RTN","DVBCPND1",4,0)
NXT F DA(1)=0:0 S DA(1)=$O(^TMP($J,JX,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZZ",JX=$S($A(JX)>57:PNAM,1:999999)
"RTN","DVBCPND1",5,0)
 Q
"RTN","DVBCPND1",6,0)
 ;
"RTN","DVBCPND1",7,0)
SORT S STAT=$P(^DVB(396.3,REQDA,0),U,18) Q:"^R^X^RX^C^CT^"[(U_STAT_U)  I DVBCSORT="S" Q:STAT'=RSTAT&(RSTAT'="A")
"RTN","DVBCPND1",8,0)
 S PNAM=$S($D(^DPT(DFN,0)):$P(^(0),U,1),1:"Unknown"),ROUT=$S($D(^DVB(396.3,REQDA,1)):$P(^(1),U,4),1:0),RDATE=$P(^(0),U,5)
"RTN","DVBCPND1",9,0)
 I DVBCSORT="V" S ^TMP($J,PNAM,DFN,REQDA)="" Q
"RTN","DVBCPND1",10,0)
 I DVBCSORT="S" S ^TMP($J,STAT,PNAM,DFN,REQDA)="" Q
"RTN","DVBCPND1",11,0)
 I DVBCSORT="R",$D(ADIVNUM),ROUT=ADIVNUM S ^TMP($J,ROUT,PNAM,DFN,REQDA)="" Q
"RTN","DVBCPND1",12,0)
 I DVBCSORT="A" D ELAPSED I EDAYS'<ERDAYS,EDAYS'>OLDAYS S ^TMP($J,EDAYS,PNAM,DFN,REQDA)=""
"RTN","DVBCPND1",13,0)
 Q
"RTN","DVBCPND1",14,0)
 ;
"RTN","DVBCPND1",15,0)
SETUP K ^TMP($J) S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ"),PG=0
"RTN","DVBCPND1",16,0)
 S HEAD="Pending 2507 Requests for "_$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Unknown site"),HEAD2="",PROCDT="Processed on: "_DVBCDT(0),NODATA=0 U IO D HEADER
"RTN","DVBCPND1",17,0)
 ;
"RTN","DVBCPND1",18,0)
DATA S DFN="" F J=0:0 S DFN=$O(^DVB(396.3,"B",DFN)) Q:DFN=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",DFN,REQDA)) Q:REQDA=""  D SORT
"RTN","DVBCPND1",19,0)
 I DVBCSORT="V" S PNAM="" F I=0:0 S PNAM=$O(^TMP($J,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,PNAM,DFN)) Q:DFN=""  F DA(1)=0:0 S DA(1)=$O(^TMP($J,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZ" Q
"RTN","DVBCPND1",20,0)
 I DVBCSORT="R"!(DVBCSORT="A") S PNAM="" F JX=-1:0 S JX=$O(^TMP($J,JX)) Q:JX=""  F I=0:0 S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:DFN=""  D NXT
"RTN","DVBCPND1",21,0)
 I DVBCSORT="S" S (PNAM,JX)="" F ZX=0:0 S JX=$O(^TMP($J,JX)) Q:JX=""  F I=0:0 S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:DFN=""  D NXT
"RTN","DVBCPND1",22,0)
 D:$Y>60 HEADER I DVBCCNT>0 W !!,"Total pending: ",DVBCCNT,!
"RTN","DVBCPND1",23,0)
 I IOST?1"C-".E W !!,"Press RETURN  " R ANS:DTIME
"RTN","DVBCPND1",24,0)
 ;
"RTN","DVBCPND1",25,0)
EXIT I NODATA=0 U IO W *7,!!!!!,"No pending requests found for selected parameters.",!! H 2
"RTN","DVBCPND1",26,0)
 ;
"RTN","DVBCPND1",27,0)
KILL D:$D(ZTQUEUED) KILL^%ZTLOAD K ANS,JX,DVBCHDR,^TMP($J) G KILL^DVBCUTIL
"RTN","DVBCPND1",28,0)
 ;
"RTN","DVBCPND1",29,0)
PRINT S ADIV=$S($D(^DVB(396.3,DA(1),1)):$P(^(1),U,4),1:"") Q:ADIV'=ADIVNUM&(DVBCSORT="R")  I ADIV]"" S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBCPND1",30,0)
 S RDATE1=$P(^DVB(396.3,DA(1),0),U,2),RDATE=$P(^(0),U,5),SSN=$P(^DPT(DFN,0),U,9),CNUM=$S($D(^(.31)):$P(^(.31),U,3),1:"Unknown") D ELAPSED
"RTN","DVBCPND1",31,0)
 S STATUS="Unknown" W !?10,"Division: "_ADIV,!?12,"Status: " S XX=$P(^DVB(396.3,DA(1),0),U,18),STATUS=$S(XX="N":"New",XX="P":"Pending, reported",XX="S":"Pending, scheduled",XX="R":"Released to RO, not printed",1:"")
"RTN","DVBCPND1",32,0)
 I STATUS="",$D(XX) S STATUS=$S(XX="C":"Completed, printed by RO",XX="X":"Cancelled by MAS",XX="RX":"Cancelled by RO",XX="T":"Transcribed",XX="NT":"New,Transferred in",XX="CT":"Completed, Transferred out",1:"Unknown")
"RTN","DVBCPND1",33,0)
 W STATUS,!!,PNAM,?49,"SSN: ",SSN,!?44,"Claim no: ",CNUM,!?40,"Request date: ",$$FMTE^XLFDT(RDATE1,"5DZ"),!?40,"Elapsed days: ",EDAYS,!!
"RTN","DVBCPND1",34,0)
 S X=$S($D(^DVB(396.3,DA(1),4)):^(4),1:"")
"RTN","DVBCPND1",35,0)
 S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" W "Transferred in from ",$S($D(^DIC(4.2,+OWNDOM,0)):$P(^(0),U,1),1:"Unknown site"),!
"RTN","DVBCPND1",36,0)
 W !?5,"Exams requested:",!!
"RTN","DVBCPND1",37,0)
 ;
"RTN","DVBCPND1",38,0)
ITEMS ;
"RTN","DVBCPND1",39,0)
 N DVBPALL
"RTN","DVBCPND1",40,0)
 S DVBPALL=1
"RTN","DVBCPND1",41,0)
 D TST^DVBCUTL2 S NODATA=1,REQSTR=+$P(^DVB(396.3,DA(1),0),U,4)
"RTN","DVBCPND1",42,0)
 W !!,"Requested by: ",$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")," at "
"RTN","DVBCPND1",43,0)
 S RONAME=$P(^DVB(396.3,DA(1),0),U,3),RONAME=$S(RONAME]"":$P(^DIC(4,+RONAME,0),U,1),1:"") W $S(RONAME]"":RONAME,1:" (Not specified) "),! F L=1:1:79 W "-"
"RTN","DVBCPND1",44,0)
 S DVBCCNT=DVBCCNT+1 I IOST?1"C-".E K OUT W !!!,"Press RETURN to continue or ""^"" exit  " R ANS:DTIME S:'$T!(ANS=U) OUT=1 Q:$D(OUT)  D HEADER Q
"RTN","DVBCPND1",45,0)
 W ! I $Y>45 D HEADER
"RTN","DVBCPND1",46,0)
 Q
"RTN","DVBCPND1",47,0)
 ;
"RTN","DVBCPND1",48,0)
HEADER S PG=PG+1 W @IOF,!!
"RTN","DVBCPND1",49,0)
 W ?(80-$L(HEAD)\2),HEAD,?71,"Page: ",PG,!?(80-$L(DVBCHDR)\2),DVBCHDR,!! I HEAD2]"" W ?(80-$L(HEAD2)\2),HEAD2,!
"RTN","DVBCPND1",50,0)
 W ?(80-$L(PROCDT)\2),PROCDT,!?(80-$L(HEAD3)\2),HEAD3,! F LN=1:1:80 W "="
"RTN","DVBCPND1",51,0)
 W !!
"RTN","DVBCPND1",52,0)
 Q
"RTN","DVBCPND1",53,0)
 ;
"RTN","DVBCPND1",54,0)
ELAPSED K EDAYS,X1,X2,X S X1=DT,(X2,X)=RDATE D:ELTYP="C" ^%DTC D:ELTYP="W" ^XUWORKDY S EDAYS=X
"RTN","DVBCUTL2")
0^5^B27251229^B26372352
"RTN","DVBCUTL2",1,0)
DVBCUTL2 ;ALB/GTS-557/THM,SBW-DVBCUTIL, CONTINUED ; 3/MAY/2011
"RTN","DVBCUTL2",2,0)
 ;;2.7;AMIE;**168***;Apr 10, 1995;Build 3
"RTN","DVBCUTL2",3,0)
 ;
"RTN","DVBCUTL2",4,0)
KILL K %ZIS,BY,COLUMN,DVBCDT(0),EXAM,EXAMNM,HIST,FF,LABEL,LEVEL,LOC,MA,MB,NFINAL,NODE,OLDEXAM,OUT,PDATE,PDTA,PIECE,REAS,STAT1,TYPE,X1,X2,XDR,XST,JIJ,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK,ZW,JJY,VX,ADIV,ADIVNUM,DVBCDD,EDAYS,HEAD,HEAD2,ULINE,IO("Q")
"RTN","DVBCUTL2",5,0)
 K EXHD,XMTEXT,ZTDTH,OUT,CANC,DOTS,L,MG,REASON,SEND,XEXAM,XMDUZ,XMSUB,XMY,%X,%Y,JFLD,JX,JDR,DTREL,DTREQ,DTRQCMP,DTSCHEDC,DTTRANS,EDATE,ER,EXDATE,EXSTAT,RQSTAT,SBULL,TOT,XDT,XMDISPI,XMKK,XMLOC,XMLOCK,XMQF,XMR,XMT,XMTYP,XMZ,%H,K,NODATA,PNAM
"RTN","DVBCUTL2",6,0)
 K ANS,BDATE,PROCDT,QQ,RDATE,REQSTR,SADIV,OLDY,RQDT,RQDT2,PGM,SDATE,SDATE1,SDATE2,EDATE,EDATE1,EDATE2,CMPDIV,BY1,DAYS,FAX,PRTDIV,XMMG,ADEQ,EXMNM,PRTDATE,RUNDATE,RPTSITE,FEXAM,XSTAT,JZ,ZPR,REQDA,DVBCDT,FDT,RN,XIX,DVBCZ,EXDT,AGE
"RTN","DVBCUTL2",7,0)
 K COMP,DTOUT,DTSCH,DTSCH2,LNE,PG,PHYS,EXDA,DVBCDIV,%W,PRTNM,DIVNM,AW,AX,AY,BDATE1,CANDT,COL,DVBCJ,DVBCSEQ,DVBCSITE,ELTYP,EXPTR,EXSTAT,HD3,HEAD3,JJZ,JK,LVL,LX,NAME,OLDDA1,ORVP,PG,PRBY,RELBY,SEQNUM,TOTAL,TXT,TYP,DVBCXJI,PNM,PREF,NARR
"RTN","DVBCUTL2",8,0)
 G KILL^DVBCUTL3
"RTN","DVBCUTL2",9,0)
 ;
"RTN","DVBCUTL2",10,0)
DDIS1 ;display rated disabilities
"RTN","DVBCUTL2",11,0)
 W ?2,DX,?37,$J(PCT,3,0)," %",?50,$S(SC=1:"Yes",1:"No"),?58,DXCOD,!
"RTN","DVBCUTL2",12,0)
 Q
"RTN","DVBCUTL2",13,0)
 ;
"RTN","DVBCUTL2",14,0)
DDIS I '$D(^DPT(DFN,.372)) W !!,"No rated disabilities on file",!! Q
"RTN","DVBCUTL2",15,0)
 W !?2,"Rated Disability",?37,"Percent",?50,"SC ?",?58,"Dx Code",! W ?2 F LINE=1:1:63 W "-"
"RTN","DVBCUTL2",16,0)
 W !! F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:I=""  S DXNUM=$P(^DPT(DFN,.372,I,0),U,1),PCT=$P(^(0),U,2),SC=$P(^(0),U,3),DX=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,1),1:"Unknown"),DXCOD=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,3),1:"Unknown") D DDIS1
"RTN","DVBCUTL2",17,0)
 W !! Q
"RTN","DVBCUTL2",18,0)
 ;
"RTN","DVBCUTL2",19,0)
HDR2 W @IOF,!,"C&P Final Report",?71,"Page: ",PG,!!,"Name: ",PNAM,?38,"SSN: ",SSN,?60,"C-number: ",CNUM,!,EXHD,!
"RTN","DVBCUTL2",20,0)
 F ZI=1:1:80 W "="
"RTN","DVBCUTL2",21,0)
 W !
"RTN","DVBCUTL2",22,0)
 Q
"RTN","DVBCUTL2",23,0)
 ;
"RTN","DVBCUTL2",24,0)
HDR3 W @IOF,!,"C&P Reprint of Final Report",?71,"Page: ",PG,!!,"Name: ",PNAM,?38,"SSN: ",SSN,?60,"C-number: ",CNUM,!,EXHD,!
"RTN","DVBCUTL2",25,0)
 F ZI=1:1:80 W "="
"RTN","DVBCUTL2",26,0)
 W !
"RTN","DVBCUTL2",27,0)
 Q
"RTN","DVBCUTL2",28,0)
 ;
"RTN","DVBCUTL2",29,0)
DUZ2 ;select station number
"RTN","DVBCUTL2",30,0)
 S DVBCD2=$S($D(^DIC(4,DUZ(2),99)):$P(^(99),U,1),1:0)
"RTN","DVBCUTL2",31,0)
 Q
"RTN","DVBCUTL2",32,0)
 ;
"RTN","DVBCUTL2",33,0)
TST W ?3
"RTN","DVBCUTL2",34,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  K PRINT S TSTAT=$P(^DVB(396.4,DA,0),U,4),TST=$P(^DVB(396.4,DA,0),U,3),PRTNM=$S($D(^DVB(396.6,TST,0)):$P(^(0),U,2),1:"") D TST1
"RTN","DVBCUTL2",35,0)
 Q
"RTN","DVBCUTL2",36,0)
TST1 S TSTA1=""
"RTN","DVBCUTL2",37,0)
 I $D(^DVB(396.4,DA,"CAN")) S TSTA1=$P(^DVB(396.4,DA,"CAN"),U,3)
"RTN","DVBCUTL2",38,0)
 I $D(^DVB(396.4,DA,"TRAN")) S X=$P(^DVB(396.4,DA,"TRAN"),U,3)
"RTN","DVBCUTL2",39,0)
 S:TSTA1]"" TSTA1=$P(^DVB(396.5,TSTA1,0),U,1) ;tsta1=cancellation reason
"RTN","DVBCUTL2",40,0)
 W:($L(PRTNM)+$L(TSTA1)+$X)>55 !?3
"RTN","DVBCUTL2",41,0)
 ;Updated to print Open and Completed Status if DVBPALL is > 0
"RTN","DVBCUTL2",42,0)
 ;Want this to print when called from DVBCPND1 but not from DVBCENQ1
"RTN","DVBCUTL2",43,0)
 W $S(PRTNM]"":PRTNM,1:"Missing exam name")_$S(TSTA1]"":" - cancelled ("_TSTA1_")",TSTAT="T":" - Transferred",TSTAT]""&($G(DVBPALL)>0):" - "_$$EXTERNAL^DILFD(396.4,.04,,TSTAT),TSTAT="":" (Unknown status)",1:"")
"RTN","DVBCUTL2",44,0)
 I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") W " to ",$P(X,".",1)
"RTN","DVBCUTL2",45,0)
 W "; "
"RTN","DVBCUTL2",46,0)
 Q
"RTN","DVBCUTL2",47,0)
 ;
"RTN","DVBCUTL2",48,0)
RQCODE ; ** Cancel an entire 2507 request after cancellation of last exam **
"RTN","DVBCUTL2",49,0)
 N LASTTME
"RTN","DVBCUTL2",50,0)
 S LASTTME=$O(^TMP("DVBA",$J,""))
"RTN","DVBCUTL2",51,0)
 S CCODE=^TMP("DVBA",$J,LASTTME)
"RTN","DVBCUTL2",52,0)
 D BULL^DVBCCNC1
"RTN","DVBCUTL2",53,0)
 Q
"RTN","DVBCUTL2",54,0)
 ;
"RTN","DVBCUTL2",55,0)
PROCDAY(REQDA) ; ** Calculate processing time for REQDA (v2.7 - Enhc 13)
"RTN","DVBCUTL2",56,0)
 ;** NOTICE: This tag is part of an implementation of a Nationally
"RTN","DVBCUTL2",57,0)
 ;**         Controlled Procedure.  Local modifications to this routine
"RTN","DVBCUTL2",58,0)
 ;**         are prohibited per VHA Directive 10-93-142
"RTN","DVBCUTL2",59,0)
 ;
"RTN","DVBCUTL2",60,0)
 ;**  PROCDAY receives the variable REQDA as the IEN of the 2507
"RTN","DVBCUTL2",61,0)
 ;**   request to calculate the processing time for
"RTN","DVBCUTL2",62,0)
 ;**  Processing time returned to calling routine via PROCTME
"RTN","DVBCUTL2",63,0)
 ;
"RTN","DVBCUTL2",64,0)
 N STOPDT,STARTDT,LSORVTRS,PRESTRT,DAY30CUT,PROCTME,ADJTME
"RTN","DVBCUTL2",65,0)
 N LPDT,LPDA,FSDTVTRS,LINKNODE
"RTN","DVBCUTL2",66,0)
 S (STOPDT,STARTDT,LSORVTRS,PRESTRT,FSDTVTRS)=0
"RTN","DVBCUTL2",67,0)
 ;
"RTN","DVBCUTL2",68,0)
 ;** FSDTVTRS is earliest date on 396.95 rec of
"RTN","DVBCUTL2",69,0)
 ;**  Current and Vet Resch dates
"RTN","DVBCUTL2",70,0)
 ;** Find FSDTVTRS for each 396.95 rec, PRESTRT is latest FSDTVTRS of
"RTN","DVBCUTL2",71,0)
 ;**  all 396.95 recs for request
"RTN","DVBCUTL2",72,0)
 S LPDT=""
"RTN","DVBCUTL2",73,0)
 F  S LPDT=$O(^DVB(396.95,"ARO",REQDA,LPDT)) Q:LPDT=""  DO
"RTN","DVBCUTL2",74,0)
 .F LPDA=0:0 S LPDA=$O(^DVB(396.95,"ARO",REQDA,LPDT,LPDA)) Q:LPDA=""  DO
"RTN","DVBCUTL2",75,0)
 ..S STOPDT=LPDT ;**Find the last original appt date (equals Stop Date)
"RTN","DVBCUTL2",76,0)
 ..S LINKNODE=^DVB(396.95,LPDA,0)
"RTN","DVBCUTL2",77,0)
 ..I +$P(LINKNODE,U,4)=1 DO  ;**FSDTVTRS=earliest of fields .03 and .05
"RTN","DVBCUTL2",78,0)
 ...S LSORVTRS=$P(LINKNODE,U,2) ;**'ARO' - Original; Vet rsch date latest
"RTN","DVBCUTL2",79,0)
 ...I $P(LINKNODE,U,3)<$P(LINKNODE,U,5) S FSDTVTRS=$P(LINKNODE,U,3)
"RTN","DVBCUTL2",80,0)
 ...I $P(LINKNODE,U,3)'<$P(LINKNODE,U,5) S FSDTVTRS=$P(LINKNODE,U,5)
"RTN","DVBCUTL2",81,0)
 ...S:FSDTVTRS>PRESTRT PRESTRT=FSDTVTRS ;**PRESTRT=latest FSDTVTRS
"RTN","DVBCUTL2",82,0)
 ;
"RTN","DVBCUTL2",83,0)
 ;** Calculate the Start Date
"RTN","DVBCUTL2",84,0)
 S PRESTRT=PRESTRT\1
"RTN","DVBCUTL2",85,0)
 S LSORVTRS=LSORVTRS\1
"RTN","DVBCUTL2",86,0)
 S STOPDT=STOPDT\1
"RTN","DVBCUTL2",87,0)
 S X1=LSORVTRS S X2=30 D C^%DTC S DAY30CUT=X K X,X1,X2 ;**30 day cut off
"RTN","DVBCUTL2",88,0)
 ;
"RTN","DVBCUTL2",89,0)
 ;** Find clock start date
"RTN","DVBCUTL2",90,0)
 ;** (Start can't be >30 days from latest original date on an
"RTN","DVBCUTL2",91,0)
 ;     appt reschd by vet)
"RTN","DVBCUTL2",92,0)
 S:DAY30CUT<PRESTRT STARTDT=DAY30CUT
"RTN","DVBCUTL2",93,0)
 S:DAY30CUT'<PRESTRT STARTDT=PRESTRT
"RTN","DVBCUTL2",94,0)
 S:STARTDT>$P(^DVB(396.3,REQDA,0),U,14)\1 STARTDT=$P(^DVB(396.3,REQDA,0),U,14)\1
"RTN","DVBCUTL2",95,0)
 S X1=STARTDT,X2=STOPDT D ^%DTC S ADJTME=X K X,X1,X2 ;**Days to subtract
"RTN","DVBCUTL2",96,0)
 S X2=($P(^DVB(396.3,REQDA,0),U,5)\1)
"RTN","DVBCUTL2",97,0)
 S X1=($P(^DVB(396.3,REQDA,0),U,14)\1)
"RTN","DVBCUTL2",98,0)
 D ^%DTC S PROCTME=X S:+ADJTME>0 PROCTME=PROCTME-ADJTME
"RTN","DVBCUTL2",99,0)
 K X,X1,X2
"RTN","DVBCUTL2",100,0)
 Q PROCTME
"VER")
8.0^22.0
"^DD",396.2,396.2,3.5,0)
7132 ROUTING LOCATION^F^^0;7^K:$L(X)>7!($L(X)<3)!'(X?3N.AN) X
"^DD",396.2,396.2,3.5,3)
This field contains the patient's claim folder location (i.e. station number).
"^DD",396.2,396.2,3.5,21,0)
^.001^2^2^3110505^^^^
"^DD",396.2,396.2,3.5,21,1,0)
Holds the Patient File Claim Folder Location from which a Notice of 
"^DD",396.2,396.2,3.5,21,2,0)
Discharge was generated for the patient.
"^DD",396.2,396.2,3.5,23,0)
^.001^2^2^3110505^^^^
"^DD",396.2,396.2,3.5,23,1,0)
This field value must match the user's Station Number from the Institution
"^DD",396.2,396.2,3.5,23,2,0)
file for the user to be able to print the Notice of Discharge.
"^DD",396.2,396.2,3.5,"DT")
3110503
"BLD",7951,6)
^153
**END**
**END**
