KIDS Distribution saved on Aug 02, 2011@10:15:15
VBEC*1*27 and LR*5.2*412 combined build 08 02 11
**KIDS**:VBEC*1.0*27^LR*5.2*412^

**INSTALL NAME**
VBEC*1.0*27
"BLD",7415,0)
VBEC*1.0*27^VBECS^0^3110802^y
"BLD",7415,4,0)
^9.64PA^^
"BLD",7415,6.3)
1
"BLD",7415,"INID")
^y
"BLD",7415,"INIT")
VBECP27
"BLD",7415,"KRN",0)
^9.67PA^779.2^20
"BLD",7415,"KRN",.4,0)
.4
"BLD",7415,"KRN",.401,0)
.401
"BLD",7415,"KRN",.402,0)
.402
"BLD",7415,"KRN",.403,0)
.403
"BLD",7415,"KRN",.5,0)
.5
"BLD",7415,"KRN",.84,0)
.84
"BLD",7415,"KRN",3.6,0)
3.6
"BLD",7415,"KRN",3.8,0)
3.8
"BLD",7415,"KRN",9.2,0)
9.2
"BLD",7415,"KRN",9.8,0)
9.8
"BLD",7415,"KRN",9.8,"NM",0)
^9.68A^5^3
"BLD",7415,"KRN",9.8,"NM",1,0)
VBECDSS^^0^B15027740
"BLD",7415,"KRN",9.8,"NM",4,0)
VBECP27^^0^B3181798
"BLD",7415,"KRN",9.8,"NM",5,0)
VBECA3C^^0^B17448242
"BLD",7415,"KRN",9.8,"NM","B","VBECA3C",5)

"BLD",7415,"KRN",9.8,"NM","B","VBECDSS",1)

"BLD",7415,"KRN",9.8,"NM","B","VBECP27",4)

"BLD",7415,"KRN",19,0)
19
"BLD",7415,"KRN",19.1,0)
19.1
"BLD",7415,"KRN",101,0)
101
"BLD",7415,"KRN",409.61,0)
409.61
"BLD",7415,"KRN",771,0)
771
"BLD",7415,"KRN",779.2,0)
779.2
"BLD",7415,"KRN",870,0)
870
"BLD",7415,"KRN",8989.51,0)
8989.51
"BLD",7415,"KRN",8989.52,0)
8989.52
"BLD",7415,"KRN",8994,0)
8994
"BLD",7415,"KRN","B",.4,.4)

"BLD",7415,"KRN","B",.401,.401)

"BLD",7415,"KRN","B",.402,.402)

"BLD",7415,"KRN","B",.403,.403)

"BLD",7415,"KRN","B",.5,.5)

"BLD",7415,"KRN","B",.84,.84)

"BLD",7415,"KRN","B",3.6,3.6)

"BLD",7415,"KRN","B",3.8,3.8)

"BLD",7415,"KRN","B",9.2,9.2)

"BLD",7415,"KRN","B",9.8,9.8)

"BLD",7415,"KRN","B",19,19)

"BLD",7415,"KRN","B",19.1,19.1)

"BLD",7415,"KRN","B",101,101)

"BLD",7415,"KRN","B",409.61,409.61)

"BLD",7415,"KRN","B",771,771)

"BLD",7415,"KRN","B",779.2,779.2)

"BLD",7415,"KRN","B",870,870)

"BLD",7415,"KRN","B",8989.51,8989.51)

"BLD",7415,"KRN","B",8989.52,8989.52)

"BLD",7415,"KRN","B",8994,8994)

"BLD",7415,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7415,"QUES",0)
^9.62^^
"BLD",7415,"REQB",0)
^9.611^3^3
"BLD",7415,"REQB",1,0)
VBEC*1.0*1^2
"BLD",7415,"REQB",2,0)
LR*5.2*401^2
"BLD",7415,"REQB",3,0)
LR*5.2*387^2
"BLD",7415,"REQB","B","LR*5.2*387",3)

"BLD",7415,"REQB","B","LR*5.2*401",2)

"BLD",7415,"REQB","B","VBEC*1.0*1",1)

"INIT")
VBECP27
"MBREQ")
0
"PKG",649,-1)
1^1
"PKG",649,0)
VBECS^VBEC^VistA Blood Establishment Computer System
"PKG",649,20,0)
^9.402P^^
"PKG",649,22,0)
^9.49I^1^1
"PKG",649,22,1,0)
1.0^3090423^3080103^1
"PKG",649,22,1,"PAH",1,0)
27^3110802
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","VBECA3C")
0^5^B17448242
"RTN","VBECA3C",1,0)
VBECA3C ;HIOFO/BNT - VBECS Utility to parse XML for CPRS ;12/19/2003  01:00
"RTN","VBECA3C",2,0)
 ;;1.0;VBECS;**27**;Apr 14, 2005;Build 1
"RTN","VBECA3C",3,0)
 ;
"RTN","VBECA3C",4,0)
 ; Note: This routine supports data exchange with an FDA registered
"RTN","VBECA3C",5,0)
 ; medical device. As such, it may not be changed in any way without
"RTN","VBECA3C",6,0)
 ; prior written approval from the medical device manufacturer.
"RTN","VBECA3C",7,0)
 ; 
"RTN","VBECA3C",8,0)
 ; Integration Agreements:
"RTN","VBECA3C",9,0)
 ; Reference DBIA 4149 - M XML Parser
"RTN","VBECA3C",10,0)
 ; Reference to EN^MXMLPRSE supported by IA #4149
"RTN","VBECA3C",11,0)
 ; Reference to CHKNAME^XQ5 supported by IA #????
"RTN","VBECA3C",12,0)
 ; 
"RTN","VBECA3C",13,0)
 ;
"RTN","VBECA3C",14,0)
 QUIT
"RTN","VBECA3C",15,0)
 ;
"RTN","VBECA3C",16,0)
EN(ARR,DOC) ;
"RTN","VBECA3C",17,0)
 N CBK,CNT
"RTN","VBECA3C",18,0)
 ;W !!!,"Invoking XML Parser...",!!!
"RTN","VBECA3C",19,0)
 S OPTION=""
"RTN","VBECA3C",20,0)
 S VBECRES=$NA(^TMP("VBEC_OE_DATA",$J))
"RTN","VBECA3C",21,0)
 K @VBECRES
"RTN","VBECA3C",22,0)
 S (VBECTRHC,VBECTREQ,VBECABHC,VBECTSTC,VBECMSBC,VBECSRC)=0
"RTN","VBECA3C",23,0)
 ; Unit Type counters
"RTN","VBECA3C",24,0)
 SET (VBECUNC,VBECUNS,VBECUNA,VBECUND)=0
"RTN","VBECA3C",25,0)
 D SET(.CBK)
"RTN","VBECA3C",26,0)
 D EN^MXMLPRSE(DOC,.CBK,.OPTION)
"RTN","VBECA3C",27,0)
 M ARR=@VBECRES
"RTN","VBECA3C",28,0)
 ;S CNT=""
"RTN","VBECA3C",29,0)
 ;W !!!,"Parser Summary:",!!
"RTN","VBECA3C",30,0)
 ;F  S CNT=$O(CNT(CNT)) Q:CNT=""  W CNT,":",?25,CNT(CNT),!
"RTN","VBECA3C",31,0)
 Q
"RTN","VBECA3C",32,0)
 ; Direct entry of XML text from keyboard
"RTN","VBECA3C",33,0)
 ; Terminate text entry with a solitary '^'
"RTN","VBECA3C",34,0)
PASTE(OPTION) ;
"RTN","VBECA3C",35,0)
 N X,Y,GBL
"RTN","VBECA3C",36,0)
 S GBL=$NA(^TMP("VBEC_OE_XML",$J))
"RTN","VBECA3C",37,0)
 K @GBL
"RTN","VBECA3C",38,0)
 F X=1:1 D  Q:Y="^"
"RTN","VBECA3C",39,0)
 .W X,"> "
"RTN","VBECA3C",40,0)
 .R Y:$G(DTIME,600),!
"RTN","VBECA3C",41,0)
 .E  S Y="^"
"RTN","VBECA3C",42,0)
 .S:Y'="^" @GBL@(X)=Y
"RTN","VBECA3C",43,0)
 D EN(GBL,.OPTION)
"RTN","VBECA3C",44,0)
 K @GBL
"RTN","VBECA3C",45,0)
 Q
"RTN","VBECA3C",46,0)
 ; Set the event interface entry points
"RTN","VBECA3C",47,0)
SET(CBK) ;
"RTN","VBECA3C",48,0)
 K CBK
"RTN","VBECA3C",49,0)
 ;F X=0:1 S Y=$P($T(SETX+X),";;",2) Q:Y=""  D
"RTN","VBECA3C",50,0)
 ;.S CBK(Y)=$E(Y,1,8)_"^VBECA3C"
"RTN","VBECA3C",51,0)
 S CBK("STARTELEMENT")="STELE^VBECA3C"
"RTN","VBECA3C",52,0)
 S CBK("ENDELEMENT")="ENELE^VBECA3C"
"RTN","VBECA3C",53,0)
 S CBK("CHARACTERS")="CHAR^VBECA3C"
"RTN","VBECA3C",54,0)
 Q
"RTN","VBECA3C",55,0)
 ;
"RTN","VBECA3C",56,0)
STELE(ELE,ATR) ; -- element start event handler
"RTN","VBECA3C",57,0)
 SET VBECELE=ELE
"RTN","VBECA3C",58,0)
 IF ELE="Patient" DO
"RTN","VBECA3C",59,0)
 . SET @VBECRES@("PATIENT")=$G(ATR("dfn"))_"^"_$G(ATR("firstName"))_"^"_$G(ATR("lastName"))_"^"_$G(ATR("ssn"))
"RTN","VBECA3C",60,0)
 . SET @VBECRES@("ABORH")=$G(ATR("abo"))_"^"_$G(ATR("rh"))
"RTN","VBECA3C",61,0)
 . QUIT
"RTN","VBECA3C",62,0)
 IF ELE="TransfusionReaction" DO
"RTN","VBECA3C",63,0)
 . SET VBECTRHC=VBECTRHC+1
"RTN","VBECA3C",64,0)
 . SET @VBECRES@("TRHX",VBECTRHC)=$G(ATR("type"))_"^"_$G(ATR("date"))
"RTN","VBECA3C",65,0)
 . QUIT
"RTN","VBECA3C",66,0)
 IF ELE="TransfusionRequirement" DO
"RTN","VBECA3C",67,0)
 . SET VBECTREQ=VBECTREQ+1
"RTN","VBECA3C",68,0)
 . SET @VBECRES@("TRREQ",VBECTREQ)=$G(ATR("modifier"))
"RTN","VBECA3C",69,0)
 . QUIT
"RTN","VBECA3C",70,0)
 IF ELE="Antibody" DO
"RTN","VBECA3C",71,0)
 . SET VBECABHC=VBECABHC+1
"RTN","VBECA3C",72,0)
 . SET @VBECRES@("ABHIS",VBECABHC)=$G(ATR("name"))
"RTN","VBECA3C",73,0)
 . QUIT
"RTN","VBECA3C",74,0)
 IF ELE="Unit" DO
"RTN","VBECA3C",75,0)
 . IF $G(ATR("status"))="C" DO
"RTN","VBECA3C",76,0)
 . . SET VBECUNC=VBECUNC+1
"RTN","VBECA3C",77,0)
 . . SET @VBECRES@("UNIT","C",VBECUNC)=$G(ATR("id"))_"^"_$G(ATR("product"))_"^"_$G(ATR("location"))_"^"_$G(ATR("expDate"))
"RTN","VBECA3C",78,0)
 . IF $G(ATR("status"))="S" DO
"RTN","VBECA3C",79,0)
 . . SET VBECUNS=VBECUNS+1
"RTN","VBECA3C",80,0)
 . . SET @VBECRES@("UNIT","S",VBECUNS)=$G(ATR("id"))_"^"_$G(ATR("product"))_"^"_$G(ATR("location"))_"^"_$G(ATR("expDate"))
"RTN","VBECA3C",81,0)
 . IF $G(ATR("status"))="A" DO
"RTN","VBECA3C",82,0)
 . . SET VBECUNA=VBECUNA+1
"RTN","VBECA3C",83,0)
 . . SET @VBECRES@("UNIT","A",VBECUNA)=$G(ATR("id"))_"^"_$G(ATR("product"))_"^"_$G(ATR("location"))_"^"_$G(ATR("expDate"))
"RTN","VBECA3C",84,0)
 . IF $G(ATR("status"))="D" DO
"RTN","VBECA3C",85,0)
 . . SET VBECUND=VBECUND+1
"RTN","VBECA3C",86,0)
 . . SET @VBECRES@("UNIT","D",VBECUND)=$G(ATR("id"))_"^"_$G(ATR("product"))_"^"_$G(ATR("location"))_"^"_$G(ATR("expDate"))
"RTN","VBECA3C",87,0)
 . QUIT
"RTN","VBECA3C",88,0)
 IF ELE="Specimen" DO
"RTN","VBECA3C",89,0)
 . SET @VBECRES@("SPECIMEN")=$G(ATR("expDate"))_"^"_$G(ATR("uid"))
"RTN","VBECA3C",90,0)
 . QUIT
"RTN","VBECA3C",91,0)
 IF ELE="Component" DO
"RTN","VBECA3C",92,0)
 . SET VBECOMP=$G(ATR("id"))
"RTN","VBECA3C",93,0)
 . SET VBECMSBC=0
"RTN","VBECA3C",94,0)
 . SET @VBECRES@(VBECOMP,"SPECIMEN")=$G(ATR("specimen"))
"RTN","VBECA3C",95,0)
 . QUIT
"RTN","VBECA3C",96,0)
 IF ELE="LabTest" DO
"RTN","VBECA3C",97,0)
 . SET VBECTSTC=VBECTSTC+1
"RTN","VBECA3C",98,0)
 . SET @VBECRES@(VBECOMP,"TEST",VBECTSTC)=$G(ATR("id"))_"^"_$G(ATR("name"))
"RTN","VBECA3C",99,0)
 . QUIT
"RTN","VBECA3C",100,0)
 IF ELE="Msbos" DO
"RTN","VBECA3C",101,0)
 . SET VBECMSBC=VBECMSBC+1
"RTN","VBECA3C",102,0)
 . SET @VBECRES@(VBECOMP,"MSBOS",VBECMSBC)=$G(ATR("name"))_"^"_$G(ATR("threshold"))
"RTN","VBECA3C",103,0)
 . QUIT
"RTN","VBECA3C",104,0)
 IF ELE="Surgery" DO
"RTN","VBECA3C",105,0)
 . SET VBECSRC=VBECSRC+1
"RTN","VBECA3C",106,0)
 . SET @VBECRES@("SURGERY",VBECSRC)=$G(ATR("name"))_"^"_$G(ATR("noBloodRequiredIndicator"))
"RTN","VBECA3C",107,0)
 QUIT
"RTN","VBECA3C",108,0)
ENELE(ELE) ; -- element end event handler
"RTN","VBECA3C",109,0)
 KILL VBECNT
"RTN","VBECA3C",110,0)
 QUIT
"RTN","VBECA3C",111,0)
 ;
"RTN","VBECA3C",112,0)
CHAR(TEXT) ;
"RTN","VBECA3C",113,0)
 Q
"RTN","VBECDSS")
0^1^B15027740
"RTN","VBECDSS",1,0)
VBECDSS ;;HOIFO/BNT-VBECS DSS Extract ;December 05, 2006
"RTN","VBECDSS",2,0)
 ;;1.0;VBECS;**1,27**;June 1, 2007;Build 1
"RTN","VBECDSS",3,0)
 ;
"RTN","VBECDSS",4,0)
 ; Note: This routine supports data exchange with an FDA registered
"RTN","VBECDSS",5,0)
 ; medical device. As such, it may not be changed in any way without
"RTN","VBECDSS",6,0)
 ; prior written approval from the medical device manufacturer.
"RTN","VBECDSS",7,0)
 ; 
"RTN","VBECDSS",8,0)
 QUIT
"RTN","VBECDSS",9,0)
 ;
"RTN","VBECDSS",10,0)
EN(RESULT,PARAMS) ; Main Entry point for RPC
"RTN","VBECDSS",11,0)
 ; -- RPC:   VBECS DSS EXTRACT
"RTN","VBECDSS",12,0)
 ; -- INPUT: PARAMS Array containing values to be inserted or updated
"RTN","VBECDSS",13,0)
 ; --        in the VBECS DSS EXTRACT File (#6002.03).
"RTN","VBECDSS",14,0)
 ; 
"RTN","VBECDSS",15,0)
 N I,X,Y,VBECRSLT,VBECLINE,FDA,VBERR
"RTN","VBECDSS",16,0)
 I '$D(DT) D DT^DICRW
"RTN","VBECDSS",17,0)
 S VBECRSLT="^TMP(""VBEC_DSS_EXTRACT"",$J)",VBECLINE=0,RESULT=$NA(@VBECRSLT)
"RTN","VBECDSS",18,0)
 K @RESULT
"RTN","VBECDSS",19,0)
 I '$D(PARAMS("TRANSACTION ID")) D RESULT(0) Q
"RTN","VBECDSS",20,0)
 S VBECON=$$FIND1^DIC(6002.03,,,PARAMS("TRANSACTION ID"),,.ERROR)
"RTN","VBECDSS",21,0)
 S VBECIEN=$S(VBECON:VBECON_",",1:"+1,")
"RTN","VBECDSS",22,0)
 S FDA(1,6002.03,VBECIEN,.01)=PARAMS("TRANSACTION ID")
"RTN","VBECDSS",23,0)
 I $D(PARAMS("DFN")),PARAMS("DFN") S FDA(1,6002.03,VBECIEN,1)=$G(PARAMS("DFN"))
"RTN","VBECDSS",24,0)
 I $D(PARAMS("ORDERING LOCATION")) S FDA(1,6002.03,VBECIEN,2)=$G(PARAMS("ORDERING LOCATION"))
"RTN","VBECDSS",25,0)
 I $D(PARAMS("TRANSFUSION LOCATION")) S FDA(1,6002.03,VBECIEN,3)=$G(PARAMS("TRANSFUSION LOCATION"))
"RTN","VBECDSS",26,0)
 ;I $D(PARAMS("FACILITY")) S VBFAC=$$TSTRIP($G(PARAMS("FACILITY"))),VBFAC=$$FIND1^DIC(4,,"MX",VBFAC,,,"VBERR") D
"RTN","VBECDSS",27,0)
 ;. S FDA(1,6002.03,VBECIEN,3)=VBFAC
"RTN","VBECDSS",28,0)
 I $D(PARAMS("PHYSICIAN")) S FDA(1,6002.03,VBECIEN,4)=$G(PARAMS("PHYSICIAN"))
"RTN","VBECDSS",29,0)
 I $D(PARAMS("ORDERING PROVIDER")) S FDA(1,6002.03,VBECIEN,5)=$G(PARAMS("ORDERING PROVIDER"))
"RTN","VBECDSS",30,0)
 I $D(PARAMS("PRODUCT NAME")) S FDA(1,6002.03,VBECIEN,6)=$G(PARAMS("PRODUCT NAME"))
"RTN","VBECDSS",31,0)
 I $D(PARAMS("COMPONENT ABBREVIATION")) S FDA(1,6002.03,VBECIEN,7)=$G(PARAMS("COMPONENT ABBREVIATION"))
"RTN","VBECDSS",32,0)
 I $D(PARAMS("NUMBER OF UNITS")) S FDA(1,6002.03,VBECIEN,8)=$G(PARAMS("NUMBER OF UNITS"))
"RTN","VBECDSS",33,0)
 I $D(PARAMS("TRANSFUSION DATE")) S FDA(1,6002.03,VBECIEN,9)=+$G(PARAMS("TRANSFUSION DATE"))
"RTN","VBECDSS",34,0)
 S FDA(1,6002.03,VBECIEN,10)=$$NOW^XLFDT
"RTN","VBECDSS",35,0)
 I $D(PARAMS("VOLUME")) S FDA(1,6002.03,VBECIEN,11)=$G(PARAMS("VOLUME"))
"RTN","VBECDSS",36,0)
 I $D(PARAMS("REACTION TYPE")) S FDA(1,6002.03,VBECIEN,12)=$E($G(PARAMS("REACTION TYPE")),1,10) ;Limit input per conversation with David on 1/19
"RTN","VBECDSS",37,0)
 I $D(PARAMS("UNIT MODIFICATION")) S FDA(1,6002.03,VBECIEN,13)=$E($G(PARAMS("UNIT MODIFICATION")),1,6) ;Limit input per conversation with David on 1/19
"RTN","VBECDSS",38,0)
 I $D(PARAMS("REACTION")) S FDA(1,6002.03,VBECIEN,14)=$S($G(PARAMS("REACTION"))="True":"1",$G(PARAMS("REACTION"))="False":"",1:"") ;Leave room for a False code if necessary.
"RTN","VBECDSS",39,0)
 I 'VBECON D UPDATE^DIE("","FDA(1)",,"VBERR") ;W !,"NEW" ;For new record
"RTN","VBECDSS",40,0)
 I VBECON S:$G(FDA(1,6002.03,VBECIEN,1)) FDA(1,6002.03,VBECIEN,1)="`"_FDA(1,6002.03,VBECIEN,1) D FILE^DIE("E","FDA(1)","VBERR") ;W !,"UPDATE" zw  ;To update existing record
"RTN","VBECDSS",41,0)
 D RESULT(1)
"RTN","VBECDSS",42,0)
 Q
"RTN","VBECDSS",43,0)
 ;
"RTN","VBECDSS",44,0)
TEST ; Test the update
"RTN","VBECDSS",45,0)
 ;36785EB0-8BCF-4407-A6C8-0002329A4ABF
"RTN","VBECDSS",46,0)
 ;1375FB52-EC30-453D-8FC7-00026DA1229A
"RTN","VBECDSS",47,0)
 ;8EE67641-0BA6-4A0C-84B4-0003E3F95011
"RTN","VBECDSS",48,0)
 ;AD082B9A-6EC8-4EA9-9B99-0005AA8FFBD7
"RTN","VBECDSS",49,0)
 ;09F8325B-0E93-4EB8-A315-000615AF3F9C
"RTN","VBECDSS",50,0)
 ;C6F51B1E-11B7-49F9-B919-000AA5E3EC82
"RTN","VBECDSS",51,0)
 ;5B8CC626-C32D-4AE2-B13D-000A65A3C04E
"RTN","VBECDSS",52,0)
 ;411AF601-822E-4F38-A0CE-001661042A6E
"RTN","VBECDSS",53,0)
 ;E66DD96E-AA27-4F12-96F6-00171F5D13EE
"RTN","VBECDSS",54,0)
 S PARAMS("TRANSACTION ID")="E66DD96E-AA27-4F12-96F6-00171F5D13EE"
"RTN","VBECDSS",55,0)
 S PARAMS("DFN")=51
"RTN","VBECDSS",56,0)
 ;S PARAMS("NAME")="BILLYFRED"
"RTN","VBECDSS",57,0)
 S PARAMS("FACILITY")="589   "
"RTN","VBECDSS",58,0)
 S PARAMS("PHYSICIAN")="DOC,ONE"
"RTN","VBECDSS",59,0)
 S PARAMS("ORDERING PROVIDER")=53296
"RTN","VBECDSS",60,0)
 S PARAMS("PRODUCT NAME")="RED BLOOD CELLS"
"RTN","VBECDSS",61,0)
 S PARAMS("COMPONENT ABBREVIATION")="RBC"
"RTN","VBECDSS",62,0)
 S PARAMS("NUMBER OF UNITS")=6
"RTN","VBECDSS",63,0)
 S PARAMS("TRANSFUSION DATE")=DT
"RTN","VBECDSS",64,0)
 S PARAMS("VOLUME")="500"
"RTN","VBECDSS",65,0)
 S PARAMS("REACTION TYPE")="FEBRILE"
"RTN","VBECDSS",66,0)
 S PARAMS("UNIT MODIFICATION")="IWG"
"RTN","VBECDSS",67,0)
 S PARAMS("REACTION")="True"
"RTN","VBECDSS",68,0)
 Q
"RTN","VBECDSS",69,0)
 ;
"RTN","VBECDSS",70,0)
RESULT(VALUE) ; -- Add return value
"RTN","VBECDSS",71,0)
 SET VBECLINE=VBECLINE+1
"RTN","VBECDSS",72,0)
 SET @VBECRSLT@(VBECLINE)="<ReturnValue><SuccessIndicator>"_VALUE_"</SuccessIndicator></ReturnValue>"
"RTN","VBECDSS",73,0)
 QUIT
"RTN","VBECDSS",74,0)
TSTRIP(X) ;Strip trailing spaces
"RTN","VBECDSS",75,0)
 F  Q:X'?.E1" "  S X=$E(X,1,$L(X)-1)
"RTN","VBECDSS",76,0)
 Q X
"RTN","VBECP27")
0^4^B3174749
"RTN","VBECP27",1,0)
VBECP27 ;HIOFO;RLM VBECS PATCH 27 Post Install Routine ; 04/30/09 14:40
"RTN","VBECP27",2,0)
 ;;1.0;VBECS;**27**;Apr 14, 2005;Build 1
"RTN","VBECP27",3,0)
 ;
"RTN","VBECP27",4,0)
 ; Note: This routine supports data exchange with an FDA registered
"RTN","VBECP27",5,0)
 ; medical device. As such, it may not be changed in any way without
"RTN","VBECP27",6,0)
 ; prior written approval from the medical device manufacturer.
"RTN","VBECP27",7,0)
 ; 
"RTN","VBECP27",8,0)
 ; Integration Agreements:
"RTN","VBECP27",9,0)
 ; Reference to FILESEC^DDMOD supported by DBIA #2916
"RTN","VBECP27",10,0)
 ; Reference to ^XMD supported by DBIA #10113
"RTN","VBECP27",11,0)
 ; Reference to ^XPDUTL supported by DBIA #10141
"RTN","VBECP27",12,0)
 ; Reference to $$GET1^DIQ supported by DBIA #2056
"RTN","VBECP27",13,0)
 ; Reference to $$SITE^VASITE supported by DBIA #10112
"RTN","VBECP27",14,0)
ENV ; Environment Check
"RTN","VBECP27",15,0)
 ;Send a message showing successful installation.
"RTN","VBECP27",16,0)
 K ^TMP("VBEC",$J)
"RTN","VBECP27",17,0)
 s ^TMP("VBEC",$J,1,0)="Patch VBEC*1.0*27 has been installed by "_$$GET1^DIQ(200,DUZ_",",".01","E","VBECN","ERR")_" at "_$P($$SITE^VASITE,"^",2)
"RTN","VBECP27",18,0)
 s XMSUB="VBEC*1.0*27 Patch Installation verification",XMTEXT="^TMP(""VBEC"",$J)",XMDUN="VBECS Patch Monitor"
"RTN","VBECP27",19,0)
 d PATCH
"RTN","VBECP27",20,0)
 s XMY("G.VBEC@DOMAIN.EXT")=""
"RTN","VBECP27",21,0)
 d SENDMSG^XMXAPI(DUZ,XMSUB,XMTEXT,.XMY)
"RTN","VBECP27",22,0)
 k ^TMP("VBEC",$J),XMY,XMSUB
"RTN","VBECP27",23,0)
 q
"RTN","VBECP27",24,0)
PATCH ;
"RTN","VBECP27",25,0)
 s ^TMP("VBEC",$J,3,0)=" ",^TMP("VBEC",$J,4,0)=" ",^TMP("VBEC",$J,5,0)="Previous Patches:"
"RTN","VBECP27",26,0)
 ;Update the loop in this line to reflect all released patches
"RTN","VBECP27",27,0)
 f VBECI=1:1:9999 s VBECA=$$PATCH^XPDUTL("VBEC*1.0*"_VBECI) i VBECA s ^TMP("VBEC",$J,(VBECI+6),0)="Patch VBEC*1.0*"_VBECI_" has been installed."
"RTN","VBECP27",28,0)
 q
"RTN","VBECP27",29,0)
EOR ;VBECP27
"VER")
8.0^22.0
**INSTALL NAME**
LR*5.2*412
"BLD",7437,0)
LR*5.2*412^LAB SERVICE^0^3110802^y
"BLD",7437,1,0)
^^2^2^3110802^
"BLD",7437,1,1,0)
This patch is being released in conjunction with VBEC*1*27. Install patch 
"BLD",7437,1,2,0)
VBEC*1*27 to install the routines associated with this patch.
"BLD",7437,4,0)
^9.64PA^^
"BLD",7437,6.3)
1
"BLD",7437,"KRN",0)
^9.67PA^779.2^20
"BLD",7437,"KRN",.4,0)
.4
"BLD",7437,"KRN",.401,0)
.401
"BLD",7437,"KRN",.402,0)
.402
"BLD",7437,"KRN",.403,0)
.403
"BLD",7437,"KRN",.5,0)
.5
"BLD",7437,"KRN",.84,0)
.84
"BLD",7437,"KRN",3.6,0)
3.6
"BLD",7437,"KRN",3.8,0)
3.8
"BLD",7437,"KRN",9.2,0)
9.2
"BLD",7437,"KRN",9.8,0)
9.8
"BLD",7437,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7437,"KRN",9.8,"NM",1,0)
LR7OSBR1^^0^B47659527
"BLD",7437,"KRN",9.8,"NM",2,0)
LRCAPBV^^0^B56161594
"BLD",7437,"KRN",9.8,"NM","B","LR7OSBR1",1)

"BLD",7437,"KRN",9.8,"NM","B","LRCAPBV",2)

"BLD",7437,"KRN",19,0)
19
"BLD",7437,"KRN",19.1,0)
19.1
"BLD",7437,"KRN",101,0)
101
"BLD",7437,"KRN",409.61,0)
409.61
"BLD",7437,"KRN",771,0)
771
"BLD",7437,"KRN",779.2,0)
779.2
"BLD",7437,"KRN",870,0)
870
"BLD",7437,"KRN",8989.51,0)
8989.51
"BLD",7437,"KRN",8989.52,0)
8989.52
"BLD",7437,"KRN",8994,0)
8994
"BLD",7437,"KRN","B",.4,.4)

"BLD",7437,"KRN","B",.401,.401)

"BLD",7437,"KRN","B",.402,.402)

"BLD",7437,"KRN","B",.403,.403)

"BLD",7437,"KRN","B",.5,.5)

"BLD",7437,"KRN","B",.84,.84)

"BLD",7437,"KRN","B",3.6,3.6)

"BLD",7437,"KRN","B",3.8,3.8)

"BLD",7437,"KRN","B",9.2,9.2)

"BLD",7437,"KRN","B",9.8,9.8)

"BLD",7437,"KRN","B",19,19)

"BLD",7437,"KRN","B",19.1,19.1)

"BLD",7437,"KRN","B",101,101)

"BLD",7437,"KRN","B",409.61,409.61)

"BLD",7437,"KRN","B",771,771)

"BLD",7437,"KRN","B",779.2,779.2)

"BLD",7437,"KRN","B",870,870)

"BLD",7437,"KRN","B",8989.51,8989.51)

"BLD",7437,"KRN","B",8989.52,8989.52)

"BLD",7437,"KRN","B",8994,8994)

"BLD",7437,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7437,"QUES",0)
^9.62^^
"BLD",7437,"REQB",0)
^9.611^2^2
"BLD",7437,"REQB",1,0)
LR*5.2*387^2
"BLD",7437,"REQB",2,0)
LR*5.2*401^2
"BLD",7437,"REQB","B","LR*5.2*387",1)

"BLD",7437,"REQB","B","LR*5.2*401",2)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
412^3110802
"PKG",26,22,1,"PAH",1,1,0)
^^2^2^3110802
"PKG",26,22,1,"PAH",1,1,1,0)
This patch is being released in conjunction with VBEC*1*27. Install patch 
"PKG",26,22,1,"PAH",1,1,2,0)
VBEC*1*27 to install the routines associated with this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","LR7OSBR1")
0^1^B47659527
"RTN","LR7OSBR1",1,0)
LR7OSBR1 ;slc/dcm - Silent BB rpt cont. ;8/11/97
"RTN","LR7OSBR1",2,0)
 ;;5.2;LAB SERVICE;**121,201,228,230,292,387,412**;Sep 27, 1994;Build 1
"RTN","LR7OSBR1",3,0)
 ;from LRBLPBR
"RTN","LR7OSBR1",4,0)
 ;Reference to GETS^DIQ supported by IA #2056
"RTN","LR7OSBR1",5,0)
EN ;
"RTN","LR7OSBR1",6,0)
 N A,B,J,LRMD,LRI,X,X0
"RTN","LR7OSBR1",7,0)
 S LR(2)=0,LRMD=$P(LR,"^",5)
"RTN","LR7OSBR1",8,0)
 D H
"RTN","LR7OSBR1",9,0)
 S LR("F")=1
"RTN","LR7OSBR1",10,0)
 I $D(^LR(LRDFN,1.7)) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(4,CCNT,"Antibodies identified: ") F LR(9)=0:0 S LR(9)=$O(^LR(LRDFN,1.7,LR(9))) Q:'LR(9)  D
"RTN","LR7OSBR1",11,0)
 . I CCNT>(GIOM-15) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"   ")
"RTN","LR7OSBR1",12,0)
 . S ^TMP("LRC",$J,GCNT,0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(CCNT,CCNT,$P(^LAB(61.3,LR(9),0),"^")_"; ")
"RTN","LR7OSBR1",13,0)
 I $O(^LR("AB",LRDFN,0)) D
"RTN","LR7OSBR1",14,0)
 . D LINE^LR7OSUM4
"RTN","LR7OSBR1",15,0)
 . S J=0
"RTN","LR7OSBR1",16,0)
 . F  S J=$O(^LR("AB",LRDFN,J)) Q:'J  S A=0 F  S A=$O(^LR("AB",LRDFN,J,A)) Q:'A  D
"RTN","LR7OSBR1",17,0)
 .. S LR(1.9)=$G(^LR(LRDFN,1.6,A,0))
"RTN","LR7OSBR1",18,0)
 .. I LR(1.9)="" K ^LR("AB",LRDFN,J,A) Q
"RTN","LR7OSBR1",19,0)
 .. S Y=+LR(1.9)
"RTN","LR7OSBR1",20,0)
 .. D D^LRU
"RTN","LR7OSBR1",21,0)
 .. D LN
"RTN","LR7OSBR1",22,0)
 .. S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(0,CCNT,"TRANSFUSION REACTIONS WITH UNIT IDENTIFIED")_$$S^LR7OS(51,CCNT,"UNIT ID")_$$S^LR7OS(66,CCNT,"COMPONENT")
"RTN","LR7OSBR1",23,0)
 .. D LN
"RTN","LR7OSBR1",24,0)
 .. S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(0,CCNT,Y)_$$S^LR7OS(21,CCNT,$P($G(^LAB(65.4,J,0)),U))_$$S^LR7OS(51,CCNT,$P(LR(1.9),U,3))_$$S^LR7OS(69,CCNT,$P($G(^LAB(66,+$P(LR(1.9),U,2),0)),U,2))
"RTN","LR7OSBR1",25,0)
 .. F B(1)=0:0 S B(1)=$O(^LR(LRDFN,1.6,A,1,B(1))) Q:'B(1)  S B(2)=^(B(1),0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(0,CCNT,B(2))
"RTN","LR7OSBR1",26,0)
 I $O(^LR(LRDFN,1.9,0)) D
"RTN","LR7OSBR1",27,0)
 . D LINE^LR7OSUM4
"RTN","LR7OSBR1",28,0)
 . S A=0
"RTN","LR7OSBR1",29,0)
 . F B=0:1 S A=$O(^LR(LRDFN,1.9,A)) Q:'A  S LR(1.9)=^(A,0) D
"RTN","LR7OSBR1",30,0)
 .. I 'B D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(0,CCNT,"TRANSFUSION REACTIONS WITHOUT UNIT IDENTIFIED:")
"RTN","LR7OSBR1",31,0)
 .. S Y=+LR(1.9)
"RTN","LR7OSBR1",32,0)
 .. D D^LRU
"RTN","LR7OSBR1",33,0)
 .. D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(0,CCNT,Y)_$$S^LR7OS(21,CCNT,$P($G(^LAB(65.4,+$P(LR(1.9),U,2),0)),U))
"RTN","LR7OSBR1",34,0)
 .. F B=0:0 S B=$O(^LR(LRDFN,1.9,A,1,B)) Q:'B  S X0=^(B,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(0,CCNT,X0)
"RTN","LR7OSBR1",35,0)
 D LINE^LR7OSUM4
"RTN","LR7OSBR1",36,0)
 I $D(LRN(2)) D C
"RTN","LR7OSBR1",37,0)
 D DT
"RTN","LR7OSBR1",38,0)
 S LRI=LRIN
"RTN","LR7OSBR1",39,0)
 F A=1:1 S LRI=$O(^LR(LRDFN,LRSS,LRI)) Q:'LRI!(CT1>COUNT)!(LRI>LROUT)  S LR(5)=^(LRI,0) I $P(LR(5),"^",3) D
"RTN","LR7OSBR1",40,0)
 . S T=+LR(5),CT1=CT1+1
"RTN","LR7OSBR1",41,0)
 . D T,LN
"RTN","LR7OSBR1",42,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(4,CCNT,T)
"RTN","LR7OSBR1",43,0)
 . D W
"RTN","LR7OSBR1",44,0)
 Q
"RTN","LR7OSBR1",45,0)
W ;
"RTN","LR7OSBR1",46,0)
 S X=$G(^LR(LRDFN,LRSS,LRI,10)),LRN(10.3,3)=$P(X,"^",3)
"RTN","LR7OSBR1",47,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(21,CCNT,$J($P(X,"^"),2))
"RTN","LR7OSBR1",48,0)
 S X=$G(^LR(LRDFN,LRSS,LRI,11)),LRN(11.3,3)=$P(X,"^",3),^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(24,CCNT,$P(X,"^"))
"RTN","LR7OSBR1",49,0)
 S X=$G(^LR(LRDFN,LRSS,LRI,2)),LRN(2.91,3)=$P(X,"^",10)
"RTN","LR7OSBR1",50,0)
 F H=1,4,6,9 S Y=$P(X,"^",H) S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS((30+$S(H=4:5,H=6:10,H=9:15,1:0)),CCNT,$S(Y="N":"Neg",Y="P":"Pos",H=9&(Y="I"):"Invalid",1:Y))
"RTN","LR7OSBR1",51,0)
 S X=$G(^LR(LRDFN,LRSS,LRI,6)),Y=$P(X,"^"),^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(62,CCNT,$S(Y="N":"Neg",Y="P":"Pos",1:Y))
"RTN","LR7OSBR1",52,0)
 F X=10.3,11.3,2.91 I LRN(X,3)]"" D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LRN(X)_":"_LRN(X,3))
"RTN","LR7OSBR1",53,0)
 S J=0 F  S J=$O(^LR(LRDFN,LRSS,LRI,"EA",J)) Q:'J  D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"ELUATE ANTIBODY: "_$S($D(^LAB(61.3,J,0)):$P(^(0),"^"),1:J))
"RTN","LR7OSBR1",54,0)
 S J=0 F  S J=$O(^LR(LRDFN,LRSS,LRI,5,J)) Q:'J  D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"SERUM ANTIBODY IDENTIFIED: "_$S($D(^LAB(61.3,J,0)):$P(^(0),"^"),1:J))
"RTN","LR7OSBR1",55,0)
 S J=0 F  S J=$O(^LR(LRDFN,LRSS,LRI,4,J)) Q:'J  S J(1)=^(J,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LRN(8)_":"_J(1))
"RTN","LR7OSBR1",56,0)
 S J=0 F  S J=$O(^LR(LRDFN,LRSS,LRI,99,J)) Q:'J  S J(1)=^(J,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(8,CCNT,J(1))
"RTN","LR7OSBR1",57,0)
 Q
"RTN","LR7OSBR1",58,0)
T ;
"RTN","LR7OSBR1",59,0)
 ;S T=T_"000",T=$$FMTE^XLFDT($P(T,"."),"5Z")_$S(T[".":" "_$E(T,9,10)_":"_$E(T,11,12),1:"")
"RTN","LR7OSBR1",60,0)
 S T=$$FMTE^XLFDT(T,"5Z")
"RTN","LR7OSBR1",61,0)
 Q
"RTN","LR7OSBR1",62,0)
C ;
"RTN","LR7OSBR1",63,0)
 S A=0 F B=1:1 S A=$O(^LRD(65,"AP",LRDFN,A)) Q:'A  D N
"RTN","LR7OSBR1",64,0)
 I B=1 D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"No UNITS assigned/xmatched")
"RTN","LR7OSBR1",65,0)
 D LINE^LR7OSUM4
"RTN","LR7OSBR1",66,0)
 S A=0 F B=0:1 S A=$O(^LR(LRDFN,1.8,A)) Q:'A  S F=^(A,0) I $P(F,"^",3)>(9999999-LROUT),$P(F,"^",3)<(9999999-LRIN) D:'B R D L
"RTN","LR7OSBR1",67,0)
 I 'B D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"No component requests")
"RTN","LR7OSBR1",68,0)
 Q
"RTN","LR7OSBR1",69,0)
N ;
"RTN","LR7OSBR1",70,0)
 I B=1 D LINE^LR7OSUM4,LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(6,CCNT,"Unit assigned/xmatched:")_$$S^LR7OS(46,CCNT,"Exp date")_$$S^LR7OS(64,CCNT,"Loc")
"RTN","LR7OSBR1",71,0)
 I '$D(^LRD(65,A,0)) K ^LRD(65,"AP",LRDFN,A) Q
"RTN","LR7OSBR1",72,0)
 S F=^LRD(65,A,0),L=$O(^(3,0)) I L S L=$P(^(L,0),"^",4)
"RTN","LR7OSBR1",73,0)
 E  D LOCAT
"RTN","LR7OSBR1",74,0)
 I $P(F,"^",5)<(9999999-LROUT)!($P(F,"^",5)>(9999999-LRIN)) Q
"RTN","LR7OSBR1",75,0)
 S M=^LAB(66,$P(F,"^",4),0)
"RTN","LR7OSBR1",76,0)
 D LN
"RTN","LR7OSBR1",77,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,$J(B,2)_")")_$$S^LR7OS(6,CCNT,$P(F,"^"))_$$S^LR7OS(17,CCNT,$E($P(M,"^"),1,19))_$$S^LR7OS(38,CCNT,$P(F,"^",7)_" "_$P(F,"^",8))
"RTN","LR7OSBR1",78,0)
 S Y=$P(F,"^",6)
"RTN","LR7OSBR1",79,0)
 D D^LRU
"RTN","LR7OSBR1",80,0)
 D:'(L]"") LOCAT
"RTN","LR7OSBR1",81,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(45,CCNT,Y)_$$S^LR7OS(64,CCNT,L)
"RTN","LR7OSBR1",82,0)
 Q
"RTN","LR7OSBR1",83,0)
LOCAT ;Determine the Institution (file 4) where the unit resides if no
"RTN","LR7OSBR1",84,0)
 ;location is listed in 65.03,.04
"RTN","LR7OSBR1",85,0)
 S L=$P(^LRD(65,A,0),"^",16)
"RTN","LR7OSBR1",86,0)
 I L]"" K LERROR D GETS^DIQ(4,L,.01,,"L","LERROR") D
"RTN","LR7OSBR1",87,0)
  . I L]"",L'=-1 S L="BB-"_$G(L(4,L_",",.01))
"RTN","LR7OSBR1",88,0)
  . K L(4) Q
"RTN","LR7OSBR1",89,0)
 ;S L=$P(^DIC(4,L,0),"^") ;Convert to FileMan reference
"RTN","LR7OSBR1",90,0)
 I L=""!((L=-1)!($D(LERROR))) S L="???????????"
"RTN","LR7OSBR1",91,0)
 Q
"RTN","LR7OSBR1",92,0)
L ;
"RTN","LR7OSBR1",93,0)
 I '$D(^LAB(66,+F,0)) L +^LR(LRDFN,1.8):360 G:'$T L K ^LR(LRDFN,1.8,+F) S X=^LR(LRDFN,1.8,0),X(1)=$O(^LR(LRDFN,1.8,0)),^LR(LRDFN,1.8,0)=$P(X,"^",1,2)_"^"_X(1)_"^"_$S(X(1)="":"",1:($P(X,"^",4)-1)) L -^LR(LRDFN,1.8) Q
"RTN","LR7OSBR1",94,0)
 S T=$P(F,"^",3)
"RTN","LR7OSBR1",95,0)
 D T,LN
"RTN","LR7OSBR1",96,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,$E($P(^LAB(66,+F,0),"^"),1,25))_$$S^LR7OS(26,CCNT,$J($P(F,"^",4),3))_$$S^LR7OS(32,CCNT,T)
"RTN","LR7OSBR1",97,0)
 S T=$P(F,"^",5)
"RTN","LR7OSBR1",98,0)
 D T
"RTN","LR7OSBR1",99,0)
 S ^TMP("LRC",$J,GCNT,0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(49,CCNT,T)_$$S^LR7OS(65,CCNT,$E($P(F,"^",9),1,10))_$$S^LR7OS(77,CCNT,$S($P(F,"^",8)="":"",$D(^VA(200,$P(F,"^",8),0)):$P(^(0),"^",2),1:$P(F,"^",8)))
"RTN","LR7OSBR1",100,0)
 Q
"RTN","LR7OSBR1",101,0)
H ;
"RTN","LR7OSBR1",102,0)
 D LN
"RTN","LR7OSBR1",103,0)
 S X=GIOM/2-(10/2+5),^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(X,CCNT,"---- BLOOD BANK ----")
"RTN","LR7OSBR1",104,0)
 S:'$D(^TMP("LRH",$J,"BLOOD BANK")) ^("BLOOD BANK")=GCNT
"RTN","LR7OSBR1",105,0)
 D LN
"RTN","LR7OSBR1",106,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"ABO Rh: "_$J($P(LR,"^",3),2)_" "_$P(LR,"^",4))
"RTN","LR7OSBR1",107,0)
 Q
"RTN","LR7OSBR1",108,0)
DT ;
"RTN","LR7OSBR1",109,0)
 D LINE^LR7OSUM4,LN
"RTN","LR7OSBR1",110,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(30,CCNT,"|---")_$$S^LR7OS(39,CCNT,"AHG(direct)")_$$S^LR7OS(55,CCNT,"---|")_$$S^LR7OS(62,CCNT,"|-AHG(indirect)-|")
"RTN","LR7OSBR1",111,0)
 D LN
"RTN","LR7OSBR1",112,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(4,CCNT,"Date/time")_$$S^LR7OS(20,CCNT,"ABO")_$$S^LR7OS(24,CCNT,"Rh")_$$S^LR7OS(30,CCNT,"POLY")_$$S^LR7OS(35,CCNT,"IgG")_$$S^LR7OS(40,CCNT,"C3")
"RTN","LR7OSBR1",113,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(45,CCNT,"Interpretation")_$$S^LR7OS(62,CCNT,"(Antibody screen)")
"RTN","LR7OSBR1",114,0)
 D LN
"RTN","LR7OSBR1",115,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(4,CCNT,"---------")_$$S^LR7OS(20,CCNT,"---")_$$S^LR7OS(24,CCNT,"--")_$$S^LR7OS(30,CCNT,"----")_$$S^LR7OS(35,CCNT,"---")
"RTN","LR7OSBR1",116,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(40,CCNT,"---")_$$S^LR7OS(45,CCNT,"--------------")_$$S^LR7OS(62,CCNT,"-----------------")
"RTN","LR7OSBR1",117,0)
 Q
"RTN","LR7OSBR1",118,0)
H3 ;
"RTN","LR7OSBR1",119,0)
 D H,LINE^LR7OSUM4,LN
"RTN","LR7OSBR1",120,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(6,CCNT,"Unit assigned/xmatched:")_$$S^LR7OS(46,CCNT,"Exp date")_$$S^LR7OS(64,CCNT,"Loc")
"RTN","LR7OSBR1",121,0)
 Q
"RTN","LR7OSBR1",122,0)
R ;
"RTN","LR7OSBR1",123,0)
 D LN
"RTN","LR7OSBR1",124,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Component requests")_$$S^LR7OS(26,CCNT,"Units")_$$S^LR7OS(32,CCNT,"Request date")_$$S^LR7OS(49,CCNT,"Date wanted")_$$S^LR7OS(65,CCNT,"Requestor")_$$S^LR7OS(77,CCNT,"By")
"RTN","LR7OSBR1",125,0)
 Q
"RTN","LR7OSBR1",126,0)
LN ;
"RTN","LR7OSBR1",127,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","LR7OSBR1",128,0)
 Q
"RTN","LRCAPBV")
0^2^B56161594
"RTN","LRCAPBV",1,0)
LRCAPBV ;DALOI/FHS - PROCESS VBECS WORKLOAD API ; 4/17/07 3:53am
"RTN","LRCAPBV",2,0)
 ;;5.2;LAB SERVICE;**325,401,412**;Sep 27, 1994;Build 1
"RTN","LRCAPBV",3,0)
 ;Reference to $$FIND1^DIC supported by IA #2051
"RTN","LRCAPBV",4,0)
 ;Reference to FILE^DID supported by IA #2052
"RTN","LRCAPBV",5,0)
 ;Reference to FILE^DIE supported by IA #2053
"RTN","LRCAPBV",6,0)
 ;Reference to GETS^DIQ supported by IA #2056
"RTN","LRCAPBV",7,0)
 ;Reference to $$GET^XUA4A72 supported by IA #1625
"RTN","LRCAPBV",8,0)
 ;Reference to $$WKLDCAP^VBECA7 supported by IA #4767
"RTN","LRCAPBV",9,0)
 ;Reference to UPDTWKLD^VBECA7 supported by IA #4767
"RTN","LRCAPBV",10,0)
EN ;Will only run if VBECS BUNDLE 1.0 is installed.
"RTN","LRCAPBV",11,0)
 Q:'($D(^VBEC(6002.01,0)))
"RTN","LRCAPBV",12,0)
BBLOOK ;
"RTN","LRCAPBV",13,0)
LOCK ;
"RTN","LRCAPBV",14,0)
 L +^VBEC(6000,1,"WKLD"):10 G:'$T LOCK
"RTN","LRCAPBV",15,0)
 Q:$G(^VBEC(6000,1,"WKLD"))=+$H  S ^VBEC(6000,1,"WKLD")=+$H
"RTN","LRCAPBV",16,0)
 ;L +^XTMP("BVEC WKLD"):10 G:'$T LOCK
"RTN","LRCAPBV",17,0)
 ;Q:$G(^XTMP("BVEC WKLD",0))=+$H  S ^XTMP("BVEC WKLD",0)=+$H
"RTN","LRCAPBV",18,0)
 N ANS,ANX
"RTN","LRCAPBV",19,0)
 N D1,D2,DFN,ERR,FILE,IEN,LRAA,LRACC,LRADT,LRAN,LRACPABV,LRCC
"RTN","LRCAPBV",20,0)
 N LRCDT,LRCNT,LRCTM,LRD65,LRDAA,LRDFN,LRDIV,LRDLOC,LRDPRO,LRDSUF
"RTN","LRCAPBV",21,0)
 N LRE655,LREDT,LRERR,LRESCPT,LRFDA,LRFILE,LRFNUM,LRIDT
"RTN","LRCAPBV",22,0)
 N LRII,LRIN,LRLD,LRLOG,LRLSS,LRMA,LRNLT,LROA,LROAD,LROAD1,LROAD2
"RTN","LRCAPBV",23,0)
 N LROL,LRPKG,LRREC,LRRRL,LRRRL1,LRRRL3,LRRRL4,LRSUF,LRTEC,LRTS
"RTN","LRCAPBV",24,0)
 N LRTST,LRTSTP,LRTYPE,LRUG,LRUID,LRUNIT,LRWA,LRWKLAA,LRZCNT,X,Y
"RTN","LRCAPBV",25,0)
 N LRCAPBV,LRDPF,LRNP,LRUA,LRRRL2,LRSN,LRSPEC,LRSTATUS,LRVSITN
"RTN","LRCAPBV",26,0)
 N LRTSTU,LRTSQA,LRTSTD
"RTN","LRCAPBV",27,0)
GET ;Call VBECS 6002.01 data populating API
"RTN","LRCAPBV",28,0)
 S ANS=$$WKLDCAP^VBECA7
"RTN","LRCAPBV",29,0)
 G:ANS'=1 END
"RTN","LRCAPBV",30,0)
 S LRCAPBV=1,LRESCPT=0
"RTN","LRCAPBV",31,0)
DLOC ;Get default location and provider
"RTN","LRCAPBV",32,0)
 D GETS^DIQ(69.9,"1,",".8;617","I","ANS","ERR")
"RTN","LRCAPBV",33,0)
 S LRDLOC=$G(ANS(69.9,"1,",.8,"I"))
"RTN","LRCAPBV",34,0)
 S LRDPRO=$G(ANS(69.9,"1,",617,"I"))
"RTN","LRCAPBV",35,0)
 I $$GET^XUA4A72(LRDPRO)<1 G END
"RTN","LRCAPBV",36,0)
 S:'$G(LRIEN) LRIEN=0
"RTN","LRCAPBV",37,0)
LK1 ;Set default values
"RTN","LRCAPBV",38,0)
 S LRPKG=$$FIND1^DIC(9.4,"","O","LAB SERVICE","B","","ANS")
"RTN","LRCAPBV",39,0)
 I LRPKG<1 S ERR=9.4
"RTN","LRCAPBV",40,0)
 S LRDAA=$$FIND1^DIC(68,"","O","BLOOD BANK","B","","ANS")
"RTN","LRCAPBV",41,0)
 S:'LRDAA LRDAA=29
"RTN","LRCAPBV",42,0)
 S LRD65=$$FIND1^DIC(65,"","B","VBECS1","B","","ANS")
"RTN","LRCAPBV",43,0)
 S LRDSUF=$$FIND1^DIC(64.2,"","O","GENERIC","B","","ANS")
"RTN","LRCAPBV",44,0)
 I '$G(LRD65) S LRSTATUS="LRD(65 missing",LRERR="Failed lookup" D  G END
"RTN","LRCAPBV",45,0)
 . S ERR=65 D EUPDATE
"RTN","LRCAPBV",46,0)
TST ;Get default tests names
"RTN","LRCAPBV",47,0)
 S LRTSTQA=$$FIND1^DIC(60,,"B","VBEC QA/QC","B",,"ANS")
"RTN","LRCAPBV",48,0)
 S LRTSTU=$$FIND1^DIC(60,,"B","VBEC UNIT PROCESSING","B",,"ANS")
"RTN","LRCAPBV",49,0)
 S LRTSTD=$$FIND1^DIC(60,,"B","VBEC DONOR","B",,"ANS")
"RTN","LRCAPBV",50,0)
 I $S('LRTSTQA:1,'LRTSTU:1,'LRTSTD:1,1:0) D  G END
"RTN","LRCAPBV",51,0)
 . S ERR=$S('LRTSTQA:"VBEC QA/QC ",'LRTSTU:"VBEC UNIT PROCESSING",1:"VBEC DONOR") D EUPDATE
"RTN","LRCAPBV",52,0)
 Q:$G(LRDBUG)
"RTN","LRCAPBV",53,0)
DPROV ;Set default PCE Provider
"RTN","LRCAPBV",54,0)
LOOP ;Find entries with the status of pending.
"RTN","LRCAPBV",55,0)
 F  S LRIEN=$O(^VBEC(6002.01,"AC","P",LRIEN)) Q:LRIEN<1  D BBDIQ
"RTN","LRCAPBV",56,0)
 Q:$G(LRDBUG)
"RTN","LRCAPBV",57,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","LRCAPBV",58,0)
END ;
"RTN","LRCAPBV",59,0)
 L -^XTMP("BVEC WKLD")
"RTN","LRCAPBV",60,0)
 ;Call VBECS update API
"RTN","LRCAPBV",61,0)
 D UPDTWKLD^VBECA7
"RTN","LRCAPBV",62,0)
 K LRIEN
"RTN","LRCAPBV",63,0)
 Q
"RTN","LRCAPBV",64,0)
BBDIQ ;Gather entry info
"RTN","LRCAPBV",65,0)
 I $G(LRDBUG) W !,LRIEN
"RTN","LRCAPBV",66,0)
 K ANS,ANX,ERR,FILE,LRFDA
"RTN","LRCAPBV",67,0)
 K ^VBEC(6002.01,LRIEN,"ERR")
"RTN","LRCAPBV",68,0)
 S FILE=6002.01,IEN=LRIEN_","
"RTN","LRCAPBV",69,0)
 D GETS^DIQ(FILE,IEN,"**","IN","ANS","ERR")
"RTN","LRCAPBV",70,0)
 D ERR Q:$G(ERR)
"RTN","LRCAPBV",71,0)
 S LRFDA(6002.01,LRIEN_",",5)="I"
"RTN","LRCAPBV",72,0)
 D FILE^DIE("S","LRFDA","ERR")
"RTN","LRCAPBV",73,0)
 D LRAA
"RTN","LRCAPBV",74,0)
 Q:$G(ERR)
"RTN","LRCAPBV",75,0)
 S:$G(LRWKLAA) (LRMA,LRWA,LRLSS)=LRWKLAA
"RTN","LRCAPBV",76,0)
 S LRCDT=$P(ANS(6002.01,LRIEN_",",3,"I"),".")
"RTN","LRCAPBV",77,0)
 S LRCTM=$P(ANS(6002.01,LRIEN_",",3,"I"),".",2)
"RTN","LRCAPBV",78,0)
 D ^LRCAPV3
"RTN","LRCAPBV",79,0)
 K LRFDA S LRFDA(6002.01,LRIEN_",",5)="S"
"RTN","LRCAPBV",80,0)
 S LRFDA(6002.01,LRIEN_",",4)=$$NOW^XLFDT
"RTN","LRCAPBV",81,0)
 D FILE^DIE("S","LRFDA","ERR")
"RTN","LRCAPBV",82,0)
PCEFILE ;File PCE if outpatient location
"RTN","LRCAPBV",83,0)
 Q:$S(LRRRL4="W":0,LRRRL4="O":0,1:1)
"RTN","LRCAPBV",84,0)
 I $G(DFN) D
"RTN","LRCAPBV",85,0)
 . D EN^LRCAPBV1(LRADT,LRTEC,LRTST,LRDSSLOC,LRDSSID,LRIN,DFN,LRPRO,LRCNT)
"RTN","LRCAPBV",86,0)
 Q
"RTN","LRCAPBV",87,0)
ERR ;Check entry for critical data
"RTN","LRCAPBV",88,0)
 I $G(ERR) S LRERR="Failed lookup",LRSTATUS="E" D EUPDATE Q
"RTN","LRCAPBV",89,0)
 D INIT^LRCAPBB S LRLD="CP"
"RTN","LRCAPBV",90,0)
 S ERR=0
"RTN","LRCAPBV",91,0)
TYPE S LRTYPE=$G(ANS(6002.01,IEN,1,"I")) D  Q:$G(ERR)
"RTN","LRCAPBV",92,0)
 . I '$L(LRTYPE) S ERR=1 D EUPDATE
"RTN","LRCAPBV",93,0)
DIV S LRDIV=$G(ANS(6002.01,IEN,2,"I")) D  Q:$G(ERR)  ;RLM 120809
"RTN","LRCAPBV",94,0)
 . I '$D(^DIC(4,+LRDIV,0)) S ERR=2 D EUPDATE
"RTN","LRCAPBV",95,0)
 . S LRIN=LRDIV
"RTN","LRCAPBV",96,0)
ADT S (LRADT,LREDT)=$G(ANS(6002.01,IEN,3,"I")) D  Q:$G(ERR)
"RTN","LRCAPBV",97,0)
 . I LRADT'?7N1"."1N.E S ERR=3 D EUPDATE
"RTN","LRCAPBV",98,0)
 . S LRCDT=$P(LRADT,"."),LRCTM=$P(LRADT,".",2)
"RTN","LRCAPBV",99,0)
NLT S LRNLT=$G(ANS(6002.01,IEN,6,"I")) D
"RTN","LRCAPBV",100,0)
 . D GETS^DIQ(64,LRNLT,1,"IN","ANX","ERX")
"RTN","LRCAPBV",101,0)
 . S LRNLT1=$g(ANX("64",LRNLT_",",1,"I")) ;RLM 6-4-10
"RTN","LRCAPBV",102,0)
SUF S LRSUF1=$G(ANS(6002.01,IEN,7,"I")) D  Q:$G(ERR)
"RTN","LRCAPBV",103,0)
 . S:'LRSUF1 LRSUF1=LRDSUF
"RTN","LRCAPBV",104,0)
 . D GETS^DIQ(64.2,LRSUF1,1,"IN","ANX","ERX") S LRSUF=$g(ANX("64.2",LRSUF1_",",1,"I")) ;RLM 6-4-10
"RTN","LRCAPBV",105,0)
 . I LRNLT1?1.N1"."1.N S LRCC=$O(^LAM("E",LRNLT1,0)) ;RLM 6-4-10
"RTN","LRCAPBV",106,0)
 . I LRNLT1'["." S LRCC=$O(^LAM("E",LRNLT1_LRSUF,0)) ;RLM 6-4-10
"RTN","LRCAPBV",107,0)
 . I LRCC="" S LRCC=$$NLT^LRCAPBV1(LRNLT,LRSUF) ;Lookup or create NLT code ;RLM 6-3-10 ADDED - I LRCC=""
"RTN","LRCAPBV",108,0)
 . D GETS^DIQ(64.2,LRSUF_",",1,"I","ANS","ERR")
"RTN","LRCAPBV",109,0)
 . S LRSUF=$P($G(ANX(64.2,LRSUF1_",",1,"I")),".",2)
"RTN","LRCAPBV",110,0)
 S LRCNT=$G(ANS(6002.01,IEN,8,"I")) I 'LRCNT S LRCNT=1
"RTN","LRCAPBV",111,0)
DFN S DFN=$G(ANS(6002.01,IEN,9,"I")) D  I $G(ERR) D EUPDATE Q
"RTN","LRCAPBV",112,0)
 . S LRDFN=""
"RTN","LRCAPBV",113,0)
 . Q:LRTYPE'="P"
"RTN","LRCAPBV",114,0)
 . S LRDFN=$G(^DPT(+DFN,"LR"))
"RTN","LRCAPBV",115,0)
 . ;I 'LRDFN S ERR=9 ;RLM 6/12/08 This isn't always an error and the data is evaluated in VBECS prior to transmission
"RTN","LRCAPBV",116,0)
FILE I LRTYPE="U"!(LRTYPE="M") S LRFILE=LRD65_";LRD(65,"
"RTN","LRCAPBV",117,0)
 I LRTYPE="D" S LRFILE=LRE655_";LRE("
"RTN","LRCAPBV",118,0)
 I LRTYPE="P" S LRFILE=DFN_";DPT("
"RTN","LRCAPBV",119,0)
TEC S LRTEC=$G(ANS(6002.01,IEN,10,"I")) D  Q:$G(ERR)
"RTN","LRCAPBV",120,0)
 . I '$g(LRTEC) S LRTEC=.5 ;RLM 6/1/2010
"RTN","LRCAPBV",121,0)
 . I LRTEC,'$D(^VA(200,LRTEC,0)) S LRTEC=.5 ;RLM 12 03 09
"RTN","LRCAPBV",122,0)
 S LRAA=$S($G(LRDAA):LRDAA,1:29),LRAN=""
"RTN","LRCAPBV",123,0)
UID S LRUID=$G(ANS(6002.01,IEN,11,"I")) D  Q:$G(ERR)
"RTN","LRCAPBV",124,0)
 . I '$L(LRUID) Q
"RTN","LRCAPBV",125,0)
 . S LRAA=+$O(^LRO(68,"C",LRUID,0)) Q:LRAA<1
"RTN","LRCAPBV",126,0)
 . S LRCDT=$O(^LRO(68,"C",LRUID,LRAA,0))
"RTN","LRCAPBV",127,0)
 . S LRAN=$O(^LRO(68,"C",LRUID,LRAA,LRCDT,0))
"RTN","LRCAPBV",128,0)
 . S ERR=$S('LRAA:11,'LRAA:11,'LRAN:11,'$D(^LRO(68,LRAA,1,LRCDT,1,LRAN,0)):11,1:0)
"RTN","LRCAPBV",129,0)
 . I ERR D EUPDATE
"RTN","LRCAPBV",130,0)
TS K LRTS,LRTST,LRTSTP S LRTS=0
"RTN","LRCAPBV",131,0)
 I $G(ANS(6002.01,IEN,12,"I")) S (LRTS,LRTST,LRTSTP)=+$G(ANS(6002.01,IEN,12,"I"))
"RTN","LRCAPBV",132,0)
 I 'LRTS D
"RTN","LRCAPBV",133,0)
 . I LRTYPE="U" S (LRTS,LRTST,LRTSTP)=LRTSTU
"RTN","LRCAPBV",134,0)
 . I LRTYPE="M" S (LRTS,LRTST,LRTSTP)=LRTSTQA
"RTN","LRCAPBV",135,0)
 . I LRTYPE="D" S (LRTS,LRTST,LRTSTP)=LRTSTD
"RTN","LRCAPBV",136,0)
 ; I 'LRTS,$G(LRAA),$G(LRCDT),$G(LRAN) S (LRTS,LRTST,LRTSTP)=$O(^LRO(68,LRAA,1,LRCDT,1,LRAN,4,0))
"RTN","LRCAPBV",137,0)
 D  Q:$G(ERR)
"RTN","LRCAPBV",138,0)
 . S ERR=0
"RTN","LRCAPBV",139,0)
 . ;I '$D(^LAB(60,LRTS,0)) S ERR=12 D EUPDATE ;;RLM 6/12/08 This isn't always an error and the data is evaluated in VBECS prior to transmission
"RTN","LRCAPBV",140,0)
UNIT S LRUNIT=$G(ANS(6002.01,IEN,13,"I")) D  Q:ERR
"RTN","LRCAPBV",141,0)
 . I LRTYPE="U" S LRFILE=LRD65_";LRD(65," I '$L(LRUNIT) S ERR=13 D EUPDATE
"RTN","LRCAPBV",142,0)
LRDAA S LRWKLAA=$G(ANS(6002.01,IEN,14,"I"))
"RTN","LRCAPBV",143,0)
 Q
"RTN","LRCAPBV",144,0)
EUPDATE ;Set error codes into entry
"RTN","LRCAPBV",145,0)
 I $D(LRDBUG) W !,ERR
"RTN","LRCAPBV",146,0)
 K LRFDA(1)
"RTN","LRCAPBV",147,0)
 S:'$G(LRIEN) LRIEN=$O(^VBEC(6002.01,0))
"RTN","LRCAPBV",148,0)
 S LRFDA(1,6002.01,LRIEN_",",5)="E"
"RTN","LRCAPBV",149,0)
 I $G(ERR) S LRFDA(1,6002.01,LRIEN_",",20)="Field "_ERR_" has an error"
"RTN","LRCAPBV",150,0)
 I '$G(ERR) S LRFDA(1,6002.01,LRIEN_",",20)=ERR_" Error"
"RTN","LRCAPBV",151,0)
 D FILE^DIE("S","LRFDA(1)","ERRX")
"RTN","LRCAPBV",152,0)
 Q
"RTN","LRCAPBV",153,0)
LRAA ;Get accession data
"RTN","LRCAPBV",154,0)
 S LRAA=$G(ANS(6002.01,LRIEN_",",14,"I"))
"RTN","LRCAPBV",155,0)
 S LRAA=$S($G(LRAA):LRAA,1:LRDAA)
"RTN","LRCAPBV",156,0)
 K ANX,ERX
"RTN","LRCAPBV",157,0)
 D GETS^DIQ(68,LRAA_",",.19,"I","ANX","ERR")
"RTN","LRCAPBV",158,0)
 S LRLD=$G(ANX(68,LRAA_",",.19,"I"))
"RTN","LRCAPBV",159,0)
AA ;Accession Area Information
"RTN","LRCAPBV",160,0)
 S (LRMA,LRWA,LRLSS)=LRAA,LRUG=9
"RTN","LRCAPBV",161,0)
 I $G(LRAN),$G(LRCDT),$G(LRAA) D
"RTN","LRCAPBV",162,0)
 . Q:'$D(^LRO(68,LRAA,1,LRCDT,1,LRAN,0))
"RTN","LRCAPBV",163,0)
 . S IEN=LRAN_","_LRCDT_","_LRAA_","
"RTN","LRCAPBV",164,0)
 . D GETS^DIQ(68,LRAA_",",.8,"I","ANX","ERX")
"RTN","LRCAPBV",165,0)
 . S LRDSSLOC=$G(ANX(68,LRAA_",",.8,"I"))
"RTN","LRCAPBV",166,0)
 . S:'LRDSSLOC LRDSSLOC=LRDLOC
"RTN","LRCAPBV",167,0)
 . D GETS^DIQ(44,LRDSSLOC_",",8,"I","ANX","ERX")
"RTN","LRCAPBV",168,0)
 . S LRDSSID=$G(ANX(44,LRDSSLOC_",",8,"I"))
"RTN","LRCAPBV",169,0)
 . S FLD=".01;.02;2;3;4;6;6.5;6.6;6.7;13.5;15;92;94"
"RTN","LRCAPBV",170,0)
 . D GETS^DIQ(68.02,IEN,FLD,"IN","ANX","ERX")
"RTN","LRCAPBV",171,0)
 . D GETS^DIQ(68.05,1_","_IEN,.01,"IN","ANX","ERX")
"RTN","LRCAPBV",172,0)
 . D GETS^DIQ(68.04,LRTS_","_IEN,1,"IN","ANX","ERX")
"RTN","LRCAPBV",173,0)
LRAA1 . ;Parse variables
"RTN","LRCAPBV",174,0)
 . S LRFILE=$P($G(^LRO(68,LRAA,1,LRCDT,1,LRAN,0)),U,2)
"RTN","LRCAPBV",175,0)
 . S LRDFN=$G(ANX(68.02,IEN,.01,"I"))
"RTN","LRCAPBV",176,0)
 . D GETS^DIQ(63,LRDFN_",",".02;.03","I","ANX","ERX")
"RTN","LRCAPBV",177,0)
DPF . S LRDPF=$G(ANX(63,LRDFN_",",.02,"I"))
"RTN","LRCAPBV",178,0)
 . S DFN=$G(ANX(63,LRDFN_",",.03,"I"))
"RTN","LRCAPBV",179,0)
 . D FILE^DID(LRFILE,"","GLOBAL NAME","ANX","ERX")
"RTN","LRCAPBV",180,0)
 . I $G(LRDFN),$G(DFN) S LRFILE=DFN_";"_$P(ANX("GLOBAL NAME"),U,2)
"RTN","LRCAPBV",181,0)
ACCES . S LROAD=$G(ANX(68.02,IEN,2,"I"))
"RTN","LRCAPBV",182,0)
 . S LROAD1=$G(ANX(68.02,IEN,3,"I"))
"RTN","LRCAPBV",183,0)
 . S (LRSN,LROAD2)=$G(ANX(68.02,IEN,4,"I"))
"RTN","LRCAPBV",184,0)
 . S LRSPEC=$G(ANX(68.05,1_","_IEN,.01,"I"))
"RTN","LRCAPBV",185,0)
 . S LRRRL=$G(ANX(68.02,IEN,6,"I"))
"RTN","LRCAPBV",186,0)
 . S (LRPRO,LRRRL1)=$G(ANX(68.02,IEN,6.5,"I"))
"RTN","LRCAPBV",187,0)
 . S LRRRL3=$G(ANX(68.02,IEN,6.7,"I"))
"RTN","LRCAPBV",188,0)
 . S LRACC=$G(ANX(68.02,IEN,15,"I"))
"RTN","LRCAPBV",189,0)
 . S LROL=$G(ANX(68.02,IEN,94,"I"))
"RTN","LRCAPBV",190,0)
 . D GETS^DIQ(44,LROL_",","2;9.5","IN","ANX","ERX")
"RTN","LRCAPBV",191,0)
 . S LRRRL2=$G(ANX(44,LROL_",",9.5,"I"))
"RTN","LRCAPBV",192,0)
 . S LRRRL4=$G(ANX(44,LROL_",",2,"I"))
"RTN","LRCAPBV",193,0)
 . S LRIDT=$G(ANX(68.02,IEN,13.5,"I"))
"RTN","LRCAPBV",194,0)
URG . S LRUG=$G(ANX(68.04,LRTS_","_IEN,1,"I"))
"RTN","LRCAPBV",195,0)
 Q
"VER")
8.0^22.0
**END**
**END**
