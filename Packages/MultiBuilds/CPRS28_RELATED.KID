KIDS Distribution saved on Feb 10, 2011@12:37:10
CPRS28 RELATED PATCHES   RELEASED
**KIDS**:CPRS28 RELATED 1.0^GMRC*3.0*64^GMTS*2.7*90^OR*3.0*337^

**INSTALL NAME**
CPRS28 RELATED 1.0
"BLD",19530,0)
CPRS28 RELATED 1.0^^1^3110210^y
"BLD",19530,6.3)
3
"BLD",19530,10,0)
^9.63^2^3
"BLD",19530,10,1,0)
GMRC*3.0*64^1
"BLD",19530,10,2,0)
GMTS*2.7*90^1
"BLD",19530,10,3,0)
OR*3.0*337^1
"BLD",19530,10,"B","GMRC*3.0*64",1)

"BLD",19530,10,"B","GMTS*2.7*90",2)

"BLD",19530,10,"B","OR*3.0*337",3)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
GMRC*3.0*64
"BLD",19531,0)
GMRC*3.0*64^CONSULT/REQUEST TRACKING^0^3110210^y
"BLD",19531,1,0)
^^7^7^3101118^^^^
"BLD",19531,1,1,0)
This patch stores and provides an audit of the PREVIOUS ATTENTION TO 
"BLD",19531,1,2,0)
field.  The value is displayed in the Details section of the Consult
"BLD",19531,1,3,0)
order.  In Vista, the patch prompts the user with the current ATTENTION 
"BLD",19531,1,4,0)
value which they are then allowed to change, if needed.  This patch also
"BLD",19531,1,5,0)
prevents consults in a status of "PR" and consults with unsigned or
"BLD",19531,1,6,0)
uncosigned notes from being forwarded to a new service.  The patch also 
"BLD",19531,1,7,0)
corrects the lock in GMRCGUIA which was missing a time out value.
"BLD",19531,4,0)
^9.64PA^123^1
"BLD",19531,4,123,0)
123
"BLD",19531,4,123,2,0)
^9.641^123.02^1
"BLD",19531,4,123,2,123.02,0)
REQUEST PROCESSING ACTIVITY  (sub-file)
"BLD",19531,4,123,2,123.02,1,0)
^9.6411^7^1
"BLD",19531,4,123,2,123.02,1,7,0)
PREVIOUSLY ASSIGNED TO
"BLD",19531,4,123,222)
y^y^p^^^^n^^n
"BLD",19531,4,123,224)

"BLD",19531,4,"APDD",123,123.02)

"BLD",19531,4,"APDD",123,123.02,7)

"BLD",19531,4,"B",123,123)

"BLD",19531,6)
6^
"BLD",19531,6.3)
20
"BLD",19531,"ABPKG")
n
"BLD",19531,"KRN",0)
^9.67PA^8989.52^19
"BLD",19531,"KRN",.4,0)
.4
"BLD",19531,"KRN",.4,"NM",0)
^9.68A^^
"BLD",19531,"KRN",.401,0)
.401
"BLD",19531,"KRN",.401,"NM",0)
^9.68A^^
"BLD",19531,"KRN",.402,0)
.402
"BLD",19531,"KRN",.402,"NM",0)
^9.68A^^
"BLD",19531,"KRN",.403,0)
.403
"BLD",19531,"KRN",.403,"NM",0)
^9.68A^^
"BLD",19531,"KRN",.5,0)
.5
"BLD",19531,"KRN",.5,"NM",0)
^9.68A^^
"BLD",19531,"KRN",.84,0)
.84
"BLD",19531,"KRN",.84,"NM",0)
^9.68A^^
"BLD",19531,"KRN",3.6,0)
3.6
"BLD",19531,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",19531,"KRN",3.8,0)
3.8
"BLD",19531,"KRN",9.2,0)
9.2
"BLD",19531,"KRN",9.8,0)
9.8
"BLD",19531,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",19531,"KRN",9.8,"NM",1,0)
GMRCAFRD^^0^B53980720
"BLD",19531,"KRN",9.8,"NM",2,0)
GMRCGUIB^^0^B44471877
"BLD",19531,"KRN",9.8,"NM",3,0)
GMRCGUIA^^0^B63812781
"BLD",19531,"KRN",9.8,"NM",4,0)
GMRCSLM4^^0^B39443452
"BLD",19531,"KRN",9.8,"NM","B","GMRCAFRD",1)

"BLD",19531,"KRN",9.8,"NM","B","GMRCGUIA",3)

"BLD",19531,"KRN",9.8,"NM","B","GMRCGUIB",2)

"BLD",19531,"KRN",9.8,"NM","B","GMRCSLM4",4)

"BLD",19531,"KRN",19,0)
19
"BLD",19531,"KRN",19.1,0)
19.1
"BLD",19531,"KRN",101,0)
101
"BLD",19531,"KRN",409.61,0)
409.61
"BLD",19531,"KRN",771,0)
771
"BLD",19531,"KRN",870,0)
870
"BLD",19531,"KRN",8989.51,0)
8989.51
"BLD",19531,"KRN",8989.52,0)
8989.52
"BLD",19531,"KRN",8994,0)
8994
"BLD",19531,"KRN","B",.4,.4)

"BLD",19531,"KRN","B",.401,.401)

"BLD",19531,"KRN","B",.402,.402)

"BLD",19531,"KRN","B",.403,.403)

"BLD",19531,"KRN","B",.5,.5)

"BLD",19531,"KRN","B",.84,.84)

"BLD",19531,"KRN","B",3.6,3.6)

"BLD",19531,"KRN","B",3.8,3.8)

"BLD",19531,"KRN","B",9.2,9.2)

"BLD",19531,"KRN","B",9.8,9.8)

"BLD",19531,"KRN","B",19,19)

"BLD",19531,"KRN","B",19.1,19.1)

"BLD",19531,"KRN","B",101,101)

"BLD",19531,"KRN","B",409.61,409.61)

"BLD",19531,"KRN","B",771,771)

"BLD",19531,"KRN","B",870,870)

"BLD",19531,"KRN","B",8989.51,8989.51)

"BLD",19531,"KRN","B",8989.52,8989.52)

"BLD",19531,"KRN","B",8994,8994)

"BLD",19531,"QUES",0)
^9.62^^
"BLD",19531,"REQB",0)
^9.611^3^3
"BLD",19531,"REQB",1,0)
GMRC*3.0*39^2
"BLD",19531,"REQB",2,0)
GMRC*3.0*50^2
"BLD",19531,"REQB",3,0)
GMRC*3.0*55^2
"BLD",19531,"REQB","B","GMRC*3.0*39",1)

"BLD",19531,"REQB","B","GMRC*3.0*50",2)

"BLD",19531,"REQB","B","GMRC*3.0*55",3)

"FIA",123)
REQUEST/CONSULTATION
"FIA",123,0)
^GMR(123,
"FIA",123,0,0)
123DI
"FIA",123,0,1)
y^y^p^^^^n^^n
"FIA",123,0,10)

"FIA",123,0,11)

"FIA",123,0,"RLRO")

"FIA",123,0,"VR")
3.0^GMRC
"FIA",123,123)
1
"FIA",123,123.02)
1
"FIA",123,123.02,7)

"MBREQ")
1
"PKG",66,-1)
1^1
"PKG",66,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",66,20,0)
^9.402P^^
"PKG",66,22,0)
^9.49I^1^1
"PKG",66,22,1,0)
3.0^2980101^2980204^64
"PKG",66,22,1,"PAH",1,0)
64^3110210^1392
"PKG",66,22,1,"PAH",1,1,0)
^^7^7^3110210
"PKG",66,22,1,"PAH",1,1,1,0)
This patch stores and provides an audit of the PREVIOUS ATTENTION TO 
"PKG",66,22,1,"PAH",1,1,2,0)
field.  The value is displayed in the Details section of the Consult
"PKG",66,22,1,"PAH",1,1,3,0)
order.  In Vista, the patch prompts the user with the current ATTENTION 
"PKG",66,22,1,"PAH",1,1,4,0)
value which they are then allowed to change, if needed.  This patch also
"PKG",66,22,1,"PAH",1,1,5,0)
prevents consults in a status of "PR" and consults with unsigned or
"PKG",66,22,1,"PAH",1,1,6,0)
uncosigned notes from being forwarded to a new service.  The patch also 
"PKG",66,22,1,"PAH",1,1,7,0)
corrects the lock in GMRCGUIA which was missing a time out value.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","GMRCAFRD")
0^1^B53980720
"RTN","GMRCAFRD",1,0)
GMRCAFRD ;SLC/DLT,DCM,JFR - LM FORWARD ACTION ;7/11/03 14:02
"RTN","GMRCAFRD",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,10,12,15,22,35,39,64**;DEC 27, 1997;Build 20
"RTN","GMRCAFRD",3,0)
 ;
"RTN","GMRCAFRD",4,0)
 ; This routine invokes IA #2395
"RTN","GMRCAFRD",5,0)
 ;
"RTN","GMRCAFRD",6,0)
FR(GMRCO) ;Forward Request to a new service
"RTN","GMRCAFRD",7,0)
 N ORVP,GMRCLCK,DFN,GMRCACT,GMRCSEQ,GMRCDOC
"RTN","GMRCAFRD",8,0)
 W !!,"Forward Request To Another Service For Action."
"RTN","GMRCAFRD",9,0)
 W !,"Select the service to send the consult to.",!
"RTN","GMRCAFRD",10,0)
 S:$D(GMRCSS) GMRCSSS=GMRCSS
"RTN","GMRCAFRD",11,0)
 N GMRCPL,GMRCPR,GMRCURG,GMRCDG,GMRCFF,GMRCORNP,GMRCAD,GMRCTO,GMRCADUZ,GMRCATTN,NEWATTN,GMRCPA
"RTN","GMRCAFRD",12,0)
 K GMRCQUT,GMRCSEL,GMRCSSS
"RTN","GMRCAFRD",13,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCAFRD",14,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",15,0)
 I $P($G(^GMR(123,GMRCO,12)),U,5)="P" D  Q
"RTN","GMRCAFRD",16,0)
 . N DIR
"RTN","GMRCAFRD",17,0)
 . W !,"The requesting facility may not take this action on an "
"RTN","GMRCAFRD",18,0)
 . W "inter-facility consult."
"RTN","GMRCAFRD",19,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMRCAFRD",20,0)
 . D END
"RTN","GMRCAFRD",21,0)
 . S GMRCQUT=1
"RTN","GMRCAFRD",22,0)
 I '$$LOCK^GMRCA1(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",23,0)
 S GMRCLCK=1
"RTN","GMRCAFRD",24,0)
 ;
"RTN","GMRCAFRD",25,0)
 I $P(^GMR(123,GMRCO,0),"^",12)<3 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Completed Or Discontinued." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",26,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=13 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Cancelled." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",27,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=9 D  Q:+$G(GMRCQUT)
"RTN","GMRCAFRD",28,0)
 .S GMRCMSG="Invalid action. This consult has partial results."
"RTN","GMRCAFRD",29,0)
 .S GMRCMSG(1)="Remove the associated results before forwarding."
"RTN","GMRCAFRD",30,0)
 .D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",31,0)
 S GMRCSEQ=0,GMRCDOC="" F  S GMRCSEQ=$O(^GMR(123,+GMRCO,50,GMRCSEQ)) Q:GMRCSEQ=""  D  Q:+$G(GMRCQUT)
"RTN","GMRCAFRD",32,0)
 . I $P($G(^GMR(123,+GMRCO,50,GMRCSEQ,0)),";",2)="TIU(8925," S GMRCDOC=$P(^GMR(123,+GMRCO,50,GMRCSEQ,0),";",1)
"RTN","GMRCAFRD",33,0)
 . I $G(GMRCDOC)="" Q
"RTN","GMRCAFRD",34,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=5 D
"RTN","GMRCAFRD",35,0)
 . . S GMRCMSG="Invalid Action. This consult has an unsigned note."
"RTN","GMRCAFRD",36,0)
 . . D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",37,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=6 D
"RTN","GMRCAFRD",38,0)
 . . S GMRCMSG="Invalid Action. This consult has an uncosigned note."
"RTN","GMRCAFRD",39,0)
 . . D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",40,0)
 Q:+$G(GMRCQUT)  S GMRCSEQ=0,GMRCDOC="" F  S GMRCSEQ=$O(^GMR(123,+GMRCO,40,GMRCSEQ)) Q:GMRCSEQ=""  D  Q:+$G(GMRCQUT)
"RTN","GMRCAFRD",41,0)
 . I $P($P($G(^GMR(123,+GMRCO,40,GMRCSEQ,0)),U,9),";",2)="TIU(8925," S GMRCDOC=$P($P($G(^GMR(123,+GMRCO,40,GMRCSEQ,0)),U,9),";",1)
"RTN","GMRCAFRD",42,0)
 . I $G(GMRCDOC)="" Q
"RTN","GMRCAFRD",43,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=5 D
"RTN","GMRCAFRD",44,0)
 . . S GMRCMSG="Invalid Action. This consult has an unsigned note."
"RTN","GMRCAFRD",45,0)
 . . D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",46,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=6 D
"RTN","GMRCAFRD",47,0)
 . . S GMRCMSG="Invalid Action. This consult has an uncosigned note."
"RTN","GMRCAFRD",48,0)
 . . D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",49,0)
 Q:+$G(GMRCQUT)
"RTN","GMRCAFRD",50,0)
 ;
"RTN","GMRCAFRD",51,0)
 I $D(IOBM),$D(IOTM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCAFRD",52,0)
 I $P(^GMR(123,GMRCO,0),"^",16) W !!,"This is a SERVICE ENTERED order stub.  Please send the written consult to the",!,"Service, in addition to the automated forwarding!"
"RTN","GMRCAFRD",53,0)
 S DFN=+$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCAFRD",54,0)
 S GMRCTO=1,GMRCASV="Forward Consult To Which Service/Specialty: "
"RTN","GMRCAFRD",55,0)
 D ASRV^GMRCASV K GMRCASV I $S($D(DTOUT):1,$D(DIROUT):1,$D(GMRCQUT):1,1:0) D END Q
"RTN","GMRCAFRD",56,0)
 I 'GMRCDG S GMRCMSG="No Service Was Selected. Consult Was Not Forwarded To Any Service!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",57,0)
 S GMRCFF=$P(^GMR(123,GMRCO,0),"^",5) I GMRCFF=+GMRCDG S GMRCMSG="The Forwarding Service Cannot Forward A Consult To Itself!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",58,0)
 S GMRCATTN=$P($G(^GMR(123,GMRCO,0)),"^",11)
"RTN","GMRCAFRD",59,0)
 N DIE,DR
"RTN","GMRCAFRD",60,0)
 S DIE="^GMR(123,",DA=GMRCO,DR="7//"_$S($G(GMRCATTN)'="":GMRCATTN,1:"")
"RTN","GMRCAFRD",61,0)
 D ^DIE
"RTN","GMRCAFRD",62,0)
 S NEWATTN=$P($G(^GMR(123,+GMRCO,0)),"^",11)
"RTN","GMRCAFRD",63,0)
 I NEWATTN'=GMRCATTN S GMRCPA=$G(GMRCATTN)
"RTN","GMRCAFRD",64,0)
 S GETPROV="Who is responsible for Forwarding the Consult?"
"RTN","GMRCAFRD",65,0)
FRGTPRV D GETPROV^GMRCAU I '$D(GMRCORNP) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",66,0)
 S GMRCACT=$$PROVIDER^XUSER(GMRCORNP) I $P(GMRCACT,U)'=1 D  G FRGTPRV
"RTN","GMRCAFRD",67,0)
 .W !!,"***User account is TERMINATED please choose another responsible user.***"
"RTN","GMRCAFRD",68,0)
 S GMRCAD=$$GETDT^GMRCUTL1 I GMRCAD="^" D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",69,0)
 I '$G(GMRCAD) S GMRCAD=$$NOW^XLFDT
"RTN","GMRCAFRD",70,0)
 N GMRCSS,GMRCSSNM,GMRCA,GMRCMSG,GMRCIROL,GMRCINM,GMRCIROU,ORSTS
"RTN","GMRCAFRD",71,0)
 D DEFAULT
"RTN","GMRCAFRD",72,0)
 S GMRCSS=+GMRCDG
"RTN","GMRCAFRD",73,0)
 I +GMRCSS,'$D(^GMR(123.5,+GMRCSS,0)) S GMRCMSG="Error in Service Chosen - SERVICE Does Not Exist!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",74,0)
 S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSS,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSS,0)),U,1))
"RTN","GMRCAFRD",75,0)
 D URG I $D(GMRCEND),GMRCEND D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",76,0)
 S GMRCA=17,DR=""
"RTN","GMRCAFRD",77,0)
 I $D(^GMR(123.5,+GMRCSS,"IFC")) D  ; if fwd to IFC serv, get extra flds
"RTN","GMRCAFRD",78,0)
 . S GMRCIROU=$P(^GMR(123.5,+GMRCSS,"IFC"),U) Q:GMRCIROU=""  ;no rout fac
"RTN","GMRCAFRD",79,0)
 . S GMRCINM=$P(^GMR(123.5,+GMRCSS,"IFC"),U,2) Q:GMRCINM=""  ;no serv nm
"RTN","GMRCAFRD",80,0)
 . S GMRCA=25,GMRCIROL="P"
"RTN","GMRCAFRD",81,0)
 . S DR=".07////^S X=GMRCIROU;.125////^S X=GMRCIROL;.131///^S X=GMRCINM;"
"RTN","GMRCAFRD",82,0)
 S DIE="^GMR(123,",DA=GMRCO,ORSTS=5
"RTN","GMRCAFRD",83,0)
 S DR=DR_"1////^S X=GMRCSS;5////^S X=GMRCURGI;8////^S X=ORSTS;9////^S X=GMRCA;.1///@"
"RTN","GMRCAFRD",84,0)
 L +^GMR(123,GMRCO):2 I '$T K DIE,DA,DR S GMRCMSG="Another User Is Accessing This Record. UPDATE WAS UNSUCCESSFUL.",GMRCMSG(1)="Try Again Later." D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",85,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCAFRD",86,0)
 S GMRCOM=1 D AUDIT^GMRCP ;GMRCORNP is the responsible provider here
"RTN","GMRCAFRD",87,0)
 ;
"RTN","GMRCAFRD",88,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(GMRCO) ;unlk before FWD changes order #
"RTN","GMRCAFRD",89,0)
 ;
"RTN","GMRCAFRD",90,0)
FRMSG ; Common logic used by GUI and List Manager to process the HL7 message
"RTN","GMRCAFRD",91,0)
 ; to update the order in OE/RR and then forward an alert to recipients
"RTN","GMRCAFRD",92,0)
 ; is passed in as the DUZ instead of the responsible provider
"RTN","GMRCAFRD",93,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),"XX^FORWARD",$G(DUZ),$G(VISIT),.GMRCOM,,$G(GMRCAD))
"RTN","GMRCAFRD",94,0)
 S GMRCADUZ=""
"RTN","GMRCAFRD",95,0)
 S GMRCORNP=$P(^GMR(123,GMRCO,0),"^",14) ;This is the original provider that ordered the consult
"RTN","GMRCAFRD",96,0)
 I +$G(GMRCORNP) S GMRCADUZ(+GMRCORNP)="" ;alert original provider of forward
"RTN","GMRCAFRD",97,0)
 S GMRCORTX="Forwarded consult "_$$ORTX^GMRCAU(+GMRCO)_" ("_GMRCURG_")"
"RTN","GMRCAFRD",98,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,1) ;GMRCO=IEN of consult from file 123; 27 is notification entry from file ORD(100.9
"RTN","GMRCAFRD",99,0)
 K GMRCOM
"RTN","GMRCAFRD",100,0)
 S GMRCDEV=$P($G(^GMR(123.5,GMRCSS,123)),"^",9)
"RTN","GMRCAFRD",101,0)
 I GMRCDEV D PRNT^GMRCUTL1(GMRCSS,+GMRCO)
"RTN","GMRCAFRD",102,0)
 D END
"RTN","GMRCAFRD",103,0)
 Q
"RTN","GMRCAFRD",104,0)
URG ;Get the default urgency
"RTN","GMRCAFRD",105,0)
 N X,Y,XQORM,DIROUT,DTOUT,DIRUT,DUOUT
"RTN","GMRCAFRD",106,0)
 I $P(^GMR(123,+GMRCO,0),"^",18)["I" D
"RTN","GMRCAFRD",107,0)
 .I GMRCTYPE="GMRCOR CONSULT" S X="GMRCURGENCYM CSLT - INPATIENT"
"RTN","GMRCAFRD",108,0)
 .S X="GMRCURGENCYM REQ - INPATIENT"
"RTN","GMRCAFRD",109,0)
 E  S X="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCAFRD",110,0)
 I '$D(GMRCURG) S GMRCURGI=$O(^ORD(101,"B","GMRCURGENCY - ROUTINE","")) S:+GMRCURGI GMRCURG=$P($G(^ORD(101,+GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",111,0)
 S Y=$O(^ORD(101,"B",X,""))
"RTN","GMRCAFRD",112,0)
 S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Urgency: ",XQORM("NO^^")=""
"RTN","GMRCAFRD",113,0)
 S:$L(GMRCURG) XQORM("B")=GMRCURG D EN^XQORM I X="^"!($D(DIROUT)) K XQORM S GMRCEND=1 Q
"RTN","GMRCAFRD",114,0)
 K XQORM(0),XQORM("A"),XQORM("B"),XQORM("NO^^") S XQORM=""
"RTN","GMRCAFRD",115,0)
 I '$D(Y) S GMRCEND=1 Q
"RTN","GMRCAFRD",116,0)
 I $D(Y(1)) S GMRCURG=$P(Y(1),"^",3),GMRCURGI=$P(Y(1),"^",2)
"RTN","GMRCAFRD",117,0)
 Q
"RTN","GMRCAFRD",118,0)
DEFAULT ;Set up defaults for editing to be equal to the existing data.
"RTN","GMRCAFRD",119,0)
 D DEM^GMRCU
"RTN","GMRCAFRD",120,0)
 N GMRC,GMRCDIC,GMRCPLI,GMRCPRI
"RTN","GMRCAFRD",121,0)
 Q:'$D(GMRCO)  S (GMRCSS,GMRCSSNM,GMRCPL,GMRCPR,GMRCPRI,GMRCURG)=""
"RTN","GMRCAFRD",122,0)
 S GMRCOM=0,GMRC(0)=$S($D(^GMR(123,+GMRCO,0)):^(0),1:"")
"RTN","GMRCAFRD",123,0)
 S GMRCSS=$P(GMRC(0),"^",5) I +GMRCSS,$D(^GMR(123.5,+GMRCSS,0)) S GMRCSSNM=$S($L($P($G(^GMR(123.5,+GMRCSS,0)),U,1)):$P(^(0),U,1),1:"")
"RTN","GMRCAFRD",124,0)
 S GMRCPLI=$P(GMRC(0),"^",10) I GMRCPLI S GMRCPL=$P($G(^ORD(101,GMRCPLI,0)),"^",2)
"RTN","GMRCAFRD",125,0)
 S GMRCURGI=$P(GMRC(0),"^",9) I GMRCURGI S GMRCURG=$P($G(^ORD(101,GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",126,0)
 S GMRCPRI=$P(GMRC(0),"^",8) I GMRCPRI["ORD(101" D
"RTN","GMRCAFRD",127,0)
 . S GMRCPR=$$GET1^DIQ(101,+GMRCPRI,1)
"RTN","GMRCAFRD",128,0)
 I $L(GMRCPRI),GMRCPRI'["ORD(101" D  ;ZPROC
"RTN","GMRCAFRD",129,0)
 . S GMRCPR=$$GET1^DIQ(123.3,+GMRCPRI,.01)
"RTN","GMRCAFRD",130,0)
TYPE ;This entry point is used when the only default needed is the GMRCTYPE
"RTN","GMRCAFRD",131,0)
 ;Called by GMRCGUIA to get variables ready for FRMSG call.
"RTN","GMRCAFRD",132,0)
 S GMRCTYPE=$$GET1^DIQ(123,+GMRCO,13,"I") ;ZPROC (P or C)
"RTN","GMRCAFRD",133,0)
 Q
"RTN","GMRCAFRD",134,0)
END ;Kill off variables and exit
"RTN","GMRCAFRD",135,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(GMRCO)
"RTN","GMRCAFRD",136,0)
 K GETPROV,GMRCDG,GMRCDEV,GMRCEND,GMRCFF,GMRCOM,GMRCIFN,GMRCO,GMRCORNP
"RTN","GMRCAFRD",137,0)
 K GMRCTYPE,GMRCORTX,GMRCPL,GMRCPR,GMRCSEL,GMRCURG,GMRCADUZ,Y
"RTN","GMRCAFRD",138,0)
 K DTOUT,DIROUT,DUOUT,GMRCURGI
"RTN","GMRCAFRD",139,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCAFRD",140,0)
 Q
"RTN","GMRCGUIA")
0^3^B63812781
"RTN","GMRCGUIA",1,0)
GMRCGUIA ;SLC/DCM,JFR - File Consult actions from GUI ;7/8/03 07:36
"RTN","GMRCGUIA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12,15,22,35,64**;DEC 27, 1997;Build 20
"RTN","GMRCGUIA",3,0)
 ;
"RTN","GMRCGUIA",4,0)
 ; This routine invokes IA #2638,#2926
"RTN","GMRCGUIA",5,0)
 ;
"RTN","GMRCGUIA",6,0)
NEW(DFN,GMRCDA,GMRCLOC,GMRCTYPE,GMRCSVC,GMRCPROV,GMRCURG,GMRCPLI,GMRCNP,GMRCATN,GMRCINOT,GMRCDIAG,GMRCRFQ) ;Add a new consult for a patient.
"RTN","GMRCGUIA",7,0)
 ;DFN=Patient ^DPT( file number
"RTN","GMRCGUIA",8,0)
 ;GMRCRFQ=Reason For Request, why the consult is being ordered. Passed in as
"RTN","GMRCGUIA",9,0)
 ;    an array
"RTN","GMRCGUIA",10,0)
 ;GMRCDIAG=Povisional diagnosis; what is suspected to be the problem
"RTN","GMRCGUIA",11,0)
 ;GMRCTYPE=Request type -Consult or Procedure
"RTN","GMRCGUIA",12,0)
 ;GMRCLOC=Patient location.
"RTN","GMRCGUIA",13,0)
 ;GMRCDA=Date Time of Request
"RTN","GMRCGUIA",14,0)
 ;GMRCSVC=To Service; consulting service
"RTN","GMRCGUIA",15,0)
 ;GMRCLOC=Hospital Location ordering consult
"RTN","GMRCGUIA",16,0)
 ;GMRCPR=If a procedure, the procedure ordered (pointer to file 101)
"RTN","GMRCGUIA",17,0)
 ;GMRCURG=Urgency of request (stat, routine, etc) from file 101
"RTN","GMRCGUIA",18,0)
 ;GMRCPLI=Place of consultation (bedside, consultants choice, etc.) from file 101
"RTN","GMRCGUIA",19,0)
 ;GMRCPROV=Sending Provider
"RTN","GMRCGUIA",20,0)
 ;GMRCATN=if consult is to go to a specific provider, this provider is identified here.
"RTN","GMRCGUIA",21,0)
 ;GMRCINOT=Service provided as Inpatient or Outpatient
"RTN","GMRCGUIA",22,0)
 N DIC,DLAYGO,Y,DIE,GMRCADUZ,X,GMRCO,DR
"RTN","GMRCGUIA",23,0)
 S DIC="^GMR(123,",DIC(0)="L",X="""N""",DLAYGO=123 D ^DIC K DLAYGO
"RTN","GMRCGUIA",24,0)
 S (DA,GMRCO)=+Y,GMRCSTS=5,GMRCA=1,DIE=DIC
"RTN","GMRCGUIA",25,0)
 L +^GMR(123,GMRCO):$S($G(DILOCKTM)>0:DILOCKTM,1:5)
"RTN","GMRCGUIA",26,0)
 S DR=".02////^S X=DFN;.04////^S X=GMRCLOC;1////^S X=GMRCSVC;3////^S X=GMRCDA;4////^S X=GMRCPR;5////^S X=GMRCURG;6////^S X=GMRCPLI"_$S(GMRCATN]"":"7////^S X=GMRCATN",1:"")
"RTN","GMRCGUIA",27,0)
 D ^DIE
"RTN","GMRCGUIA",28,0)
 S DR="8////^S X=GMRCSTS;9////^S X=GMRCA;10////^S X=GMRCPROV;11////^S X=GMRCATN;13////^S X=GMRCTYPE;14////^S X=GMRCINOT"_$S($D(GMRCDIAG):"30:////^S X=GMRCDIAG",1:"")
"RTN","GMRCGUIA",29,0)
 D ^DIE L -^GMR(123,GMRCO)
"RTN","GMRCGUIA",30,0)
 I $O(GMRCRFQ(0)) D REASON^GMRCGUIB(GMRCO,GMRCRFQ,GMRCDA)
"RTN","GMRCGUIA",31,0)
 D EN^GMRCHL7(DFN,GMRCDA,GMRCTYPE,$G(GMRCRB),"NW",DUZ,$G(VISIT),"")
"RTN","GMRCGUIA",32,0)
 D EXIT
"RTN","GMRCGUIA",33,0)
 Q
"RTN","GMRCGUIA",34,0)
 ;
"RTN","GMRCGUIA",35,0)
RC(GMRCO,GMRCORNP,GMRCAD,GMRCMT,GMRCDUZ) ;Receive consult into service
"RTN","GMRCGUIA",36,0)
 ;
"RTN","GMRCGUIA",37,0)
 ;Input variables:
"RTN","GMRCGUIA",38,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIA",39,0)
 ;GMRCORNP - Name of the person who actually 'Received'the consult 
"RTN","GMRCGUIA",40,0)
 ;GMRCDUZ - DUZ of person entering the consult as being 'RECEIVED'.
"RTN","GMRCGUIA",41,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIA",42,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIA",43,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIA",44,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIA",45,0)
 ;GMRCDUZ - DUZ of person entering the consult as being 'RECEIVED'
"RTN","GMRCGUIA",46,0)
 ;
"RTN","GMRCGUIA",47,0)
 ;Output:
"RTN","GMRCGUIA",48,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIA",49,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",50,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",51,0)
 ;
"RTN","GMRCGUIA",52,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIA",53,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",54,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",55,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIA",56,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",57,0)
 S GMRCSTS=6,GMRCA=21
"RTN","GMRCGUIA",58,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",59,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIA",60,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIA",61,0)
 . S DA=$$SETDA^GMRCGUIB
"RTN","GMRCGUIA",62,0)
 . D SETCOM^GMRCGUIB(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIA",63,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","")
"RTN","GMRCGUIA",64,0)
 D EXIT
"RTN","GMRCGUIA",65,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",66,0)
 ;
"RTN","GMRCGUIA",67,0)
DC(GMRCO,GMRCORNP,GMRCAD,GMRCACTM,GMRCOM) ;Discontinue or Deny a consult
"RTN","GMRCGUIA",68,0)
 ;
"RTN","GMRCGUIA",69,0)
 ;Input variables:
"RTN","GMRCGUIA",70,0)
 ;GMRCO - Internal file number of consult from File 123
"RTN","GMRCGUIA",71,0)
 ;GMRCORNP - Provider who Discontinued or Denied consult
"RTN","GMRCGUIA",72,0)
 ;GMRCAD - FM date/time of actual activity.
"RTN","GMRCGUIA",73,0)
 ;GMRCACTM - set to "DY" if 'CANCELLED'(old DENY)
"RTN","GMRCGUIA",74,0)
 ;           set to "DC" if consult is Discontinued 
"RTN","GMRCGUIA",75,0)
 ;GMRCOM - Comment array containing explanation of action
"RTN","GMRCGUIA",76,0)
 ;    Passed by reference in the following form :
"RTN","GMRCGUIA",77,0)
 ;     ARRAY(1)="xxx xxx xxx"
"RTN","GMRCGUIA",78,0)
 ;     ARRAY(2)="XXX XXX"
"RTN","GMRCGUIA",79,0)
 ;     ARRAY(3)="XXX XXX xx", etc.
"RTN","GMRCGUIA",80,0)
 ;  Comment is a required field when consult is denied or discontinued.
"RTN","GMRCGUIA",81,0)
 ;
"RTN","GMRCGUIA",82,0)
 ;Output:
"RTN","GMRCGUIA",83,0)
 ;GMRCERR=Error Flag: 0 if no error, 1 if error occurred 
"RTN","GMRCGUIA",84,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",85,0)
 ; returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",86,0)
 ;
"RTN","GMRCGUIA",87,0)
 N GMRCDUZ,DFN,GMRCNOW,GMRCSTS,GMRCERR,GMRCERMS,GMRCADUZ,GMRCTRLC
"RTN","GMRCGUIA",88,0)
 S GMRCERR=0,GMRCERMS=""
"RTN","GMRCGUIA",89,0)
 S GMRCDUZ=DUZ,GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",90,0)
 K GMRCQUT
"RTN","GMRCGUIA",91,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",92,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",93,0)
 I '$D(GMRCOM) S GMRCERR=1,GMRCERMS="Comments are required for this action." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",94,0)
 S GMRCSTS=$P(^ORD(100.01,$P(^GMR(123,GMRCO,0),"^",12),0),U,2)
"RTN","GMRCGUIA",95,0)
 I GMRCSTS="dc" S GMRCERR=1,GMRCERMS="Order Has Already Been Discontinued." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",96,0)
 I GMRCSTS="ca" S GMRCERR=1,GMRCERMS="Order Has Already Been Cancelled." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",97,0)
 I GMRCSTS="comp" S GMRCERR=1,GMRCERMS="Order Has Already Been Completed." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",98,0)
 S GMRCA=$S(GMRCACTM="DC":6,1:19),GMRCSTS=$S(GMRCA=6:1,1:13)
"RTN","GMRCGUIA",99,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",100,0)
 I GMRCACTM="DC",$$DCPRNT^GMRCUTL1(GMRCO,DUZ) D PRNT^GMRCUTL1("",GMRCO)
"RTN","GMRCGUIA",101,0)
 S DA=$$SETDA^GMRCGUIB D SETCOM^GMRCGUIB(.GMRCOM)
"RTN","GMRCGUIA",102,0)
 S GMRCOM(0)=DA
"RTN","GMRCGUIA",103,0)
 S GMRCTRLC=$S(GMRCACTM="DC":"OD",1:"OC")
"RTN","GMRCGUIA",104,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),GMRCTRLC,GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIA",105,0)
 S GMRCORTX=$S(GMRCACTM="DY":"Cancelled",1:"Discontinued")_" consult "
"RTN","GMRCGUIA",106,0)
 S GMRCORTX=GMRCORTX_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIA",107,0)
 S GMRCADUZ="",GMRCFL=0
"RTN","GMRCGUIA",108,0)
 I GMRCACTM="DC" D
"RTN","GMRCGUIA",109,0)
 . S GMRCFL=$$DCNOTE^GMRCADC(GMRCO,DUZ) ;NOTIFY SERVICE ON DC ?
"RTN","GMRCGUIA",110,0)
 I +$P($G(^GMR(123,+GMRCO,0)),"^",14),$P(^(0),"^",14)'=DUZ D
"RTN","GMRCGUIA",111,0)
 . S GMRCADUZ($P(^(0),"^",14))=""
"RTN","GMRCGUIA",112,0)
 ;send notification
"RTN","GMRCGUIA",113,0)
 N NOTYPE S NOTYPE=$S(GMRCA=6:23,1:30)
"RTN","GMRCGUIA",114,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,NOTYPE,.GMRCADUZ,GMRCFL)
"RTN","GMRCGUIA",115,0)
 D EXIT
"RTN","GMRCGUIA",116,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",117,0)
 ;
"RTN","GMRCGUIA",118,0)
FR(GMRCO,GMRCSS,GMRCORNP,GMRCATTN,GMRCURGI,GMRCOM,GMRCAD) ;FWD consult
"RTN","GMRCGUIA",119,0)
 ;to another service
"RTN","GMRCGUIA",120,0)
 ;
"RTN","GMRCGUIA",121,0)
 ;Input variables:
"RTN","GMRCGUIA",122,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIA",123,0)
 ;GMRCSS=service being forwarded to; ptr to REQUEST SERVICES (#123.5)
"RTN","GMRCGUIA",124,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIA",125,0)
 ;GMRCATTN=NEW PERSON to whose attention action should be directed
"RTN","GMRCGUIA",126,0)
 ;GMRCURGI=urgency from PROTOCOL(#101) file
"RTN","GMRCGUIA",127,0)
 ;GMRCOM=Comment array containing explanation of action
"RTN","GMRCGUIA",128,0)
 ;    Passed by reference in the following form :
"RTN","GMRCGUIA",129,0)
 ;     ARRAY(1)="xxx xxx xxx"
"RTN","GMRCGUIA",130,0)
 ;     ARRAY(2)="XXX XXX"
"RTN","GMRCGUIA",131,0)
 ;     ARRAY(3)="XXX XXX xx", etc.
"RTN","GMRCGUIA",132,0)
 ;GMRCAD=FM date/time of actual activity
"RTN","GMRCGUIA",133,0)
 ;
"RTN","GMRCGUIA",134,0)
 ;Output:
"RTN","GMRCGUIA",135,0)
 ;  GMRCERR=Error Flag: 0 if no error, 1 if error occurred 
"RTN","GMRCGUIA",136,0)
 ;  GMRCERMS - Error message or null
"RTN","GMRCGUIA",137,0)
 ;     returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",138,0)
 ;
"RTN","GMRCGUIA",139,0)
 N DR,GMRCDUZ,GMRCNOW,GMRCFF,GMRCFR,GMRCADUZ,GMRCURG,GMRCPA,GMRCSEQ,GMRCDOC
"RTN","GMRCGUIA",140,0)
 N GMRCERR,GMRCERMS,GMRCIROL,GMRCINM,GMRCIROU
"RTN","GMRCGUIA",141,0)
 S GMRCERR=0,GMRCERMS=""
"RTN","GMRCGUIA",142,0)
 I $P(^GMR(123,+GMRCO,0),U,12)=9 S GMRCERR=1,GMRCERMS="Invalid action. This consult has partial results."
"RTN","GMRCGUIA",143,0)
 S GMRCSEQ=0,GMRCDOC="" F  S GMRCSEQ=$O(^GMR(123,+GMRCO,50,GMRCSEQ)) Q:GMRCSEQ=""  D  Q:+$G(GMRCERR)
"RTN","GMRCGUIA",144,0)
 . I $P($G(^GMR(123,+GMRCO,50,GMRCSEQ,0)),";",2)="TIU(8925," S GMRCDOC=$P(^GMR(123,+GMRCO,50,GMRCSEQ,0),";",1)
"RTN","GMRCGUIA",145,0)
 . I $G(GMRCDOC)="" Q
"RTN","GMRCGUIA",146,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=5 D
"RTN","GMRCGUIA",147,0)
 . . S GMRCERMS="Invalid Action. This consult has an unsigned note.",GMRCERR=1
"RTN","GMRCGUIA",148,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=6 D
"RTN","GMRCGUIA",149,0)
 . . S GMRCERMS="Invalid Action. This consult has an uncosigned note.",GMRCERR=1
"RTN","GMRCGUIA",150,0)
 S GMRCSEQ=0,GMRCDOC="" F  S GMRCSEQ=$O(^GMR(123,+GMRCO,40,GMRCSEQ)) Q:GMRCSEQ=""  D  Q:+$G(GMRCERR)
"RTN","GMRCGUIA",151,0)
 . I $P($P($G(^GMR(123,+GMRCO,40,GMRCSEQ,0)),U,9),";",2)="TIU(8925," S GMRCDOC=$P($P($G(^GMR(123,+GMRCO,40,GMRCSEQ,0)),U,9),";",1)
"RTN","GMRCGUIA",152,0)
 . I $G(GMRCDOC)="" Q
"RTN","GMRCGUIA",153,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=5 D
"RTN","GMRCGUIA",154,0)
 . . S GMRCERMS="Invalid Action. This consult has an unsigned note.",GMRCERR=1
"RTN","GMRCGUIA",155,0)
 . I $P($G(^TIU(8925,GMRCDOC,0)),U,5)=6 D
"RTN","GMRCGUIA",156,0)
 . . S GMRCERMS="Invalid Action. This consult has an uncosigned note.",GMRCERR=1
"RTN","GMRCGUIA",157,0)
 I GMRCERR=1 D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",158,0)
 S DFN=$P(^GMR(123,+GMRCO,0),U,2)
"RTN","GMRCGUIA",159,0)
 S GMRCDUZ=DUZ,GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",160,0)
 S:'$G(GMRCAD) GMRCAD=GMRCNOW  ;Actual FM date/time consult was FWD'd 
"RTN","GMRCGUIA",161,0)
 S:'$G(GMRCURGI) GMRCURGI=$P(^GMR(123,GMRCO,0),U,9)
"RTN","GMRCGUIA",162,0)
 S GMRCA=17,GMRCSTS=5
"RTN","GMRCGUIA",163,0)
 S GMRCFF=$P($G(^GMR(123.5,+GMRCSS,123)),U,9) ;printed to new serv
"RTN","GMRCGUIA",164,0)
 S GMRCFR=$P($G(^GMR(123,+GMRCO,0)),"^",5) ;Get current service
"RTN","GMRCGUIA",165,0)
 S GMRCPA=$P($G(^GMR(123,+GMRCO,0)),"^",11) ;get current attention 
"RTN","GMRCGUIA",166,0)
 S DIE="^GMR(123,",DA=GMRCO,DR=""
"RTN","GMRCGUIA",167,0)
 I $D(^GMR(123.5,+GMRCSS,"IFC")) D  ; if fwd to IFC serv, get extra flds
"RTN","GMRCGUIA",168,0)
 . S GMRCIROU=$P(^GMR(123.5,+GMRCSS,"IFC"),U) Q:GMRCIROU=""  ;no rout fac
"RTN","GMRCGUIA",169,0)
 . S GMRCINM=$P(^GMR(123.5,+GMRCSS,"IFC"),U,2) Q:GMRCINM=""  ;no serv nm
"RTN","GMRCGUIA",170,0)
 . S GMRCA=25,GMRCIROL="P"
"RTN","GMRCGUIA",171,0)
 . S DR=".07////^S X=GMRCIROU;.125////^S X=GMRCIROL;.131///^S X=GMRCINM;"
"RTN","GMRCGUIA",172,0)
 S DR=DR_"1////^S X=$G(GMRCSS);5////^S X=$G(GMRCURGI);8////^S X=$G(GMRCSTS);9////^S X=$G(GMRCA);.1///@"_$S($L($G(GMRCATTN)):";7////^S X=GMRCATTN",1:";7///@")
"RTN","GMRCGUIA",173,0)
 L +^GMR(123,GMRCO):3 I '$T K DIE,DA,DR S GMRCERR=1,GMRCERMS="Data Not Filed - File In Use By Another User." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",174,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCGUIA",175,0)
 S DA=$$SETDA^GMRCGUIB D SETCOM^GMRCGUIB(.GMRCOM)
"RTN","GMRCGUIA",176,0)
 S GMRCURG=$P($G(^ORD(101,+GMRCURGI,0)),"^",2)
"RTN","GMRCGUIA",177,0)
 D DEM^GMRCU ;sets GMRCRB and other variables
"RTN","GMRCGUIA",178,0)
 D TYPE^GMRCAFRD ;sets GMRCTYPE
"RTN","GMRCGUIA",179,0)
 D FRMSG^GMRCAFRD ;create XX HL7 message for OE/RR and send alert 
"RTN","GMRCGUIA",180,0)
 D EXIT
"RTN","GMRCGUIA",181,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",182,0)
 ;
"RTN","GMRCGUIA",183,0)
RT(GMRCO,TMPGLOB) ;Set ^TMP("GMRCR",$J,"DT", with results from med and TIU
"RTN","GMRCGUIA",184,0)
 ;GMRCO=IEN of consult from file 123
"RTN","GMRCGUIA",185,0)
 ;Set TMPGLOB to a ^TMP global other than ^TMP("GMRCR",$J,"MCAR", or ^TMP("GMRCR",$J,"RES", i.e., S TMPGLOB="^TMP(""GMRCR"",$J,""RT"")"'
"RTN","GMRCGUIA",186,0)
 Q:'$G(GMRCO)
"RTN","GMRCGUIA",187,0)
 K @TMPGLOB
"RTN","GMRCGUIA",188,0)
 S GMRCDVL="",$P(GMRCDVL,"-",41)=""
"RTN","GMRCGUIA",189,0)
 S GMRCSR=$P(^GMR(123,+GMRCO,0),"^",15),GMRCTUFN=$P(^(0),"^",20)
"RTN","GMRCGUIA",190,0)
 S GMRCRTFL=$S('+GMRCSR&('GMRCTUFN):1,1:0)
"RTN","GMRCGUIA",191,0)
 ;
"RTN","GMRCGUIA",192,0)
 D GETRSLT^GMRCART(TMPGLOB)
"RTN","GMRCGUIA",193,0)
 ;
"RTN","GMRCGUIA",194,0)
 D EXIT
"RTN","GMRCGUIA",195,0)
 Q
"RTN","GMRCGUIA",196,0)
EXIT ;kill off variables for exit from actions
"RTN","GMRCGUIA",197,0)
 K GMRCA,GMRCDVL,GMRCSR,GMRCRTFL,GMRCFL,GMRCORNP,GMRCQUT,GMRCSTS,GMRCTUFN
"RTN","GMRCGUIA",198,0)
 K GMRCRTFL,GMRCADUZ,GMRCORTX
"RTN","GMRCGUIA",199,0)
 Q
"RTN","GMRCGUIB")
0^2^B44471877
"RTN","GMRCGUIB",1,0)
GMRCGUIB ;SLC/DCM,JFR,MA - GUI actions for consults ;8/19/03 07:31
"RTN","GMRCGUIB",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,18,20,17,22,29,30,35,45,53,55,64**;DEC 27, 1997;Build 20
"RTN","GMRCGUIB",3,0)
 ; This routine invokes IA #2980
"RTN","GMRCGUIB",4,0)
 ;
"RTN","GMRCGUIB",5,0)
SETDA() ;set DA of where audit actions are to be filed
"RTN","GMRCGUIB",6,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCGUIB",7,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCGUIB",8,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCGUIB",9,0)
 Q DA
"RTN","GMRCGUIB",10,0)
REASON(GMRCFN,GMRCRQ,GMRCDT) ;Load the reason for the request into ^GMR(123,GMRCO,20
"RTN","GMRCGUIB",11,0)
 ;GMRCFN=File 123 IFN; GMRCRQ=Array containing Reason For Request
"RTN","GMRCGUIB",12,0)
 ;GMRCDT=Date time of entry
"RTN","GMRCGUIB",13,0)
 S ^GMR(123,GMRCFN,20,0)="^^^"_GMRCDT_"^"
"RTN","GMRCGUIB",14,0)
 S L=0,LN=1 F  S L=$O(GMRCRQ(L)) Q:L=""  S ^GMR(123,GMRCFN,20,LN,0)=GMRCRQ(L),LN=LN+1
"RTN","GMRCGUIB",15,0)
 S LN=LN-1,$P(^GMR(123,GMRCFN,20,0),"^",3)=LN
"RTN","GMRCGUIB",16,0)
 K LN,L
"RTN","GMRCGUIB",17,0)
 Q
"RTN","GMRCGUIB",18,0)
SETCOM(COMMENT,WHO) ;Set comment array into tracking actions
"RTN","GMRCGUIB",19,0)
 N GMRCNOW,DR,DIE
"RTN","GMRCGUIB",20,0)
 S GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",21,0)
 I $P($G(^GMR(123,+GMRCO,0)),"^",11)=$G(GMRCPA) S GMRCPA=""
"RTN","GMRCGUIB",22,0)
 S DIE="^GMR(123,GMRCO,40,",DA(1)=GMRCO,DR=".01////^S X=GMRCNOW;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=$G(GMRCORNP);4////^S X=$S($G(WHO):WHO,1:DUZ);6////^S X=$G(GMRCFR);8////^S X=$G(GMRCFF);7////^S X=$G(GMRCPA)"
"RTN","GMRCGUIB",23,0)
 D ^DIE
"RTN","GMRCGUIB",24,0)
 S ^GMR(123,GMRCO,40,DA,1,0)="^^^^"_GMRCAD_"^"
"RTN","GMRCGUIB",25,0)
 S (GMRCND,GMRCND1)=0 F  S GMRCND1=$O(COMMENT(GMRCND1)) Q:GMRCND1=""  S GMRCND=GMRCND+1,^GMR(123,GMRCO,40,DA,1,GMRCND,0)=COMMENT(GMRCND)
"RTN","GMRCGUIB",26,0)
 S $P(^GMR(123,GMRCO,40,DA,1,0),"^",3)=GMRCND,$P(^(0),"^",4)=GMRCND,^GMR(123,GMRCO,40,"B",GMRCNOW,DA)=""
"RTN","GMRCGUIB",27,0)
 ;
"RTN","GMRCGUIB",28,0)
 ; if an IFC, call event handler to generate a msg to remote site
"RTN","GMRCGUIB",29,0)
 I $D(^GMR(123,+GMRCO,12)),$D(^(40,DA)) D TRIGR^GMRCIEVT(GMRCO,DA)
"RTN","GMRCGUIB",30,0)
 ;
"RTN","GMRCGUIB",31,0)
 K GMRCND,GMRCND1
"RTN","GMRCGUIB",32,0)
 Q
"RTN","GMRCGUIB",33,0)
CMT(GMRCO,GMRCOM,GMRCADUZ,GMRCWHN,GMRCWHO) ;add comment to consult 
"RTN","GMRCGUIB",34,0)
 ; GMRCO = IEN from file 123
"RTN","GMRCGUIB",35,0)
 ; GMRCOM = array of comments in format GMRCOM(1)="xxxx", GMRCOM(2)="xxx"
"RTN","GMRCGUIB",36,0)
 ; GMRCADUZ = array of alert recipients as GMRCADUZ(DUZ)="" (optional)
"RTN","GMRCGUIB",37,0)
 ; GMRCWHO = IEN from file 200 who's responsible activity (optional)
"RTN","GMRCGUIB",38,0)
 ; GMRCWHN = date time of activity in FM format
"RTN","GMRCGUIB",39,0)
 ;
"RTN","GMRCGUIB",40,0)
 N DA,GMRCA,GMRCAD,GMRCORTX,GMRCDFN,GMRCTM,GMRCRP,GMRCUPD
"RTN","GMRCGUIB",41,0)
 S DA=$$SETDA ; get next activity tracking entry
"RTN","GMRCGUIB",42,0)
 S GMRCA=20,GMRCAD=GMRCWHN S:$G(GMRCWHO) GMRCORNP=GMRCWHO
"RTN","GMRCGUIB",43,0)
 D SETCOM(.GMRCOM,$G(GMRCWHO))
"RTN","GMRCGUIB",44,0)
 D  ;update LAST ACTION field even though no status change
"RTN","GMRCGUIB",45,0)
 . N GMRCDR,GMRCSTS
"RTN","GMRCGUIB",46,0)
 . S GMRCSTS="",GMRCDR="9////20"
"RTN","GMRCGUIB",47,0)
 . D STATUS^GMRCP
"RTN","GMRCGUIB",48,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCGUIB",49,0)
 S GMRCORTX="Comment Added to Consult "
"RTN","GMRCGUIB",50,0)
 I $P($G(^GMR(123,GMRCO,12)),U,5)="P" D
"RTN","GMRCGUIB",51,0)
 . S GMRCORTX="Comment Added to remote consult "
"RTN","GMRCGUIB",52,0)
 S GMRCORTX=GMRCORTX_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIB",53,0)
 S GMRCRP=+$P(^GMR(123,GMRCO,0),U,14)
"RTN","GMRCGUIB",54,0)
 S GMRCUPD=$$VALID^GMRCAU($P(^GMR(123,+GMRCO,0),U,5),GMRCO,DUZ)
"RTN","GMRCGUIB",55,0)
 I GMRCRP=DUZ D  ;alert team if ord. prov. takes the action
"RTN","GMRCGUIB",56,0)
 . S GMRCTM=1
"RTN","GMRCGUIB",57,0)
 I GMRCUPD>1,GMRCRP'=DUZ D  ; alert ord. prov if update users takes action
"RTN","GMRCGUIB",58,0)
 . S GMRCADUZ(GMRCRP)=""
"RTN","GMRCGUIB",59,0)
 I '$G(GMRCTM),GMRCUPD<2 D  ;alert both if not ord. prov or update user
"RTN","GMRCGUIB",60,0)
 . S GMRCTM=1,GMRCADUZ(GMRCRP)=""
"RTN","GMRCGUIB",61,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,63,.GMRCADUZ,$G(GMRCTM))
"RTN","GMRCGUIB",62,0)
 Q
"RTN","GMRCGUIB",63,0)
SFILE(GMRCO,GMRCA,GMRCSF,GMRCORNP,GMRCDUZ,GMRCOM,GMRCALF,GMRCATO,GMRCAD) ;Process various file update functions from the GUI for a consult
"RTN","GMRCGUIB",64,0)
 ; ADMIN COMPLETE or SIGNIFICANT FINDINGS
"RTN","GMRCGUIB",65,0)
 ;Input variables:
"RTN","GMRCGUIB",66,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIB",67,0)
 ;GMRCA=pointer to REQUEST ACTION TYPES (#123.1) 10=complete, 4=Sig find.
"RTN","GMRCGUIB",68,0)
 ;GMRCSF=Significant Findings flag: 'Y'= significant finding
"RTN","GMRCGUIB",69,0)
 ;                                : 'N'= no significant finding
"RTN","GMRCGUIB",70,0)
 ;                                : 'U'=unknown significant finding
"RTN","GMRCGUIB",71,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIB",72,0)
 ;GMRCDUZ=Person actually doing the action
"RTN","GMRCGUIB",73,0)
 ;GMRCOM=An array of comments by reference ARRAY(1)="xxx",ARRAY(2)="xxx"
"RTN","GMRCGUIB",74,0)
 ;GMRCALF=Flag to signal that alerts are to be sent; 'N'=NO, 'Y'=YES
"RTN","GMRCGUIB",75,0)
 ;GMRCATO=Who alerts are to be sent to; a comma delimited string of DUZ's
"RTN","GMRCGUIB",76,0)
 ;GMRCAD =FM date/time of activity
"RTN","GMRCGUIB",77,0)
 ;
"RTN","GMRCGUIB",78,0)
 ;Output:
"RTN","GMRCGUIB",79,0)
 ; GMRCERR=Error Flag: 0 if no error, 1 if error occurred
"RTN","GMRCGUIB",80,0)
 ; GMRCERMS - Error message or null
"RTN","GMRCGUIB",81,0)
 ;    returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",82,0)
 ;
"RTN","GMRCGUIB",83,0)
 N GMRCERR,GMRCERMS
"RTN","GMRCGUIB",84,0)
 L +^GMR(123,GMRCO):5 I '$T S GMRCERR=1,GMRCERMS="Record Locked. File Update Not Accomplished." Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",85,0)
 S GMRCERR=0,GMRCERMS="",DR="",GMRCORTX=""
"RTN","GMRCGUIB",86,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCGUIB",87,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCSTS=$P(^GMR(123,+GMRCO,0),"^",12),GMRCDFN=$P(^(0),"^",2)
"RTN","GMRCGUIB",88,0)
 I '$G(GMRCDUZ) S GMRCDUZ=DUZ
"RTN","GMRCGUIB",89,0)
 I '$G(GMRCAD) S GMRCAD=GMRCNOW
"RTN","GMRCGUIB",90,0)
 ;Insure comment array contains text for Complete action.
"RTN","GMRCGUIB",91,0)
 I GMRCA=10 D  I GMRCERR=1 S GMRCERMS="Comment field must contain a text value!" Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",92,0)
 . S GMRCERR=1
"RTN","GMRCGUIB",93,0)
 . I '$D(GMRCOM) Q
"RTN","GMRCGUIB",94,0)
 . N GMRCOM1 S GMRCOM1=""
"RTN","GMRCGUIB",95,0)
 . F  S GMRCOM1=$O(GMRCOM(GMRCOM1)) Q:(GMRCOM1=""!(GMRCERR=0))  D
"RTN","GMRCGUIB",96,0)
 .. I $TR($G(GMRCOM(GMRCOM1))," ","")'="" S GMRCERR=0 Q
"RTN","GMRCGUIB",97,0)
 I +$G(GMRCA),GMRCA=10 D
"RTN","GMRCGUIB",98,0)
 .S GMRCSF=$G(GMRCSF,"")
"RTN","GMRCGUIB",99,0)
 .S GMRCSTS=2
"RTN","GMRCGUIB",100,0)
 .S DR="8////^S X=GMRCSTS;9////^S X=GMRCA;15////^S X=GMRCSF"
"RTN","GMRCGUIB",101,0)
 .S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(+GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCGUIB",102,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",103,0)
 .Q
"RTN","GMRCGUIB",104,0)
 I $G(GMRCALF)=1 D
"RTN","GMRCGUIB",105,0)
 .N I
"RTN","GMRCGUIB",106,0)
 .F I=1:1  S X=$P(GMRCATO,";",I) Q:X=""  S GMRCADUZ(X)=""
"RTN","GMRCGUIB",107,0)
 .Q
"RTN","GMRCGUIB",108,0)
 I $L(GMRCA),GMRCA=4 S DR=DR_$S($L(DR):";",1:"")_"9////^S X=GMRCA;15////^S X=GMRCSF" D
"RTN","GMRCGUIB",109,0)
 .S GMRCORTX=$S(GMRCSF="Y":"Sig Findings ",GMRCSF="N":"No Sig Findings ",1:"Unknown Sig Findings ")_"for consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",110,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",111,0)
 .Q
"RTN","GMRCGUIB",112,0)
 I $L(DR) S DIE="^GMR(123,",DA=GMRCO D ^DIE K DIE,DR
"RTN","GMRCGUIB",113,0)
 I '$O(GMRCOM(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",114,0)
 I $D(GMRCOM),$O(GMRCOM(0)) D
"RTN","GMRCGUIB",115,0)
 .N DA
"RTN","GMRCGUIB",116,0)
 .S DA=$$SETDA()
"RTN","GMRCGUIB",117,0)
 .D SETCOM(.GMRCOM,GMRCDUZ)
"RTN","GMRCGUIB",118,0)
 .Q
"RTN","GMRCGUIB",119,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCGUIB",120,0)
 ;
"RTN","GMRCGUIB",121,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,$S(GMRCA=20:63,1:23),.GMRCADUZ,0)
"RTN","GMRCGUIB",122,0)
 ;
"RTN","GMRCGUIB",123,0)
 I $S(GMRCA=10:1,(GMRCA=4&($P(^GMR(123,GMRCO,0),U,12)=2)):1,1:0) D
"RTN","GMRCGUIB",124,0)
 . D EN^GMRCHL7($P(^GMR(123,GMRCO,0),"^",2),GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIB",125,0)
 K DIE,DR,DA,GMRCDT,GMRCNOW,GMRCAD,GMRCORNP,GMRCDUZ,GMRCRSLT,GMRCSTS,GMRCADUZ,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",126,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",127,0)
 ;
"RTN","GMRCGUIB",128,0)
SCH(GMRCO,GMRCORNP,GMRCAD,GMRCADUZ,GMRCMT) ;schedule a consult API
"RTN","GMRCGUIB",129,0)
 ; Input variables:
"RTN","GMRCGUIB",130,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIB",131,0)
 ;GMRCORNP - Name of the person who actually 'Received' the consult 
"RTN","GMRCGUIB",132,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIB",133,0)
 ;GMRCADUZ - array of alert recipients as chosen by user (by reference)
"RTN","GMRCGUIB",134,0)
 ;   ARRAY(DUZ)="" 
"RTN","GMRCGUIB",135,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIB",136,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIB",137,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIB",138,0)
 ;
"RTN","GMRCGUIB",139,0)
 ;Output:
"RTN","GMRCGUIB",140,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIB",141,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIB",142,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",143,0)
        ;
"RTN","GMRCGUIB",144,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIB",145,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",146,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIB",147,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIB",148,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" D  Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",149,0)
 . S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found."
"RTN","GMRCGUIB",150,0)
 . D EXIT^GMRCGUIA
"RTN","GMRCGUIB",151,0)
 S GMRCSTS=8,GMRCA=8
"RTN","GMRCGUIB",152,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT^GMRCGUIA Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",153,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",154,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIB",155,0)
 . S DA=$$SETDA
"RTN","GMRCGUIB",156,0)
 . D SETCOM(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIB",157,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","","",GMRCAD)
"RTN","GMRCGUIB",158,0)
 D  ;send alerts
"RTN","GMRCGUIB",159,0)
 . N TXT
"RTN","GMRCGUIB",160,0)
 . S TXT="Scheduled Consult: "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",161,0)
 . I $P(^GMR(123,+GMRCO,0),U,14) S GMRCADUZ($P(^(0),U,14))=""
"RTN","GMRCGUIB",162,0)
 . D MSG^GMRCP(DFN,TXT,GMRCO,63,.GMRCADUZ,0)
"RTN","GMRCGUIB",163,0)
 D EXIT^GMRCGUIA
"RTN","GMRCGUIB",164,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",165,0)
DOCLIST(GMRCAR,GMRCDA,GMRCMED)  ;return list of linked results
"RTN","GMRCGUIB",166,0)
 ; Input:
"RTN","GMRCGUIB",167,0)
 ;  GMRCAR - array to return list, passed by reference
"RTN","GMRCGUIB",168,0)
 ;  GMRCDA - ien from file 123
"RTN","GMRCGUIB",169,0)
 ;  GMRCMED- 1 = include med results; 0 = only TIU docs
"RTN","GMRCGUIB",170,0)
 ;
"RTN","GMRCGUIB",171,0)
 ; Output:
"RTN","GMRCGUIB",172,0)
 ;  GMRCAR - array in format
"RTN","GMRCGUIB",173,0)
 ;       GMRCAR(0)=zero node of record
"RTN","GMRCGUIB",174,0)
 ;       GMRCAR(50,1)="ien;global ref," e.g. 5;TIU(8925, or 3;MCAR(691,
"RTN","GMRCGUIB",175,0)
 ;       GMRCAR(50,2)="ien;global ref,"
"RTN","GMRCGUIB",176,0)
 ;
"RTN","GMRCGUIB",177,0)
 I '$D(^GMR(123,GMRCDA,0)) Q
"RTN","GMRCGUIB",178,0)
 S GMRCAR(0)=^GMR(123,GMRCDA,0),$P(GMRCAR(0),U,20)=""
"RTN","GMRCGUIB",179,0)
 N RES,CNT S RES="",CNT=1
"RTN","GMRCGUIB",180,0)
 F  S RES=$O(^GMR(123,GMRCDA,50,"B",RES)) Q:RES=""  D
"RTN","GMRCGUIB",181,0)
 . I '$G(GMRCMED) Q:RES'["TIU(8925"
"RTN","GMRCGUIB",182,0)
 . S GMRCAR(50,CNT)=RES
"RTN","GMRCGUIB",183,0)
 . I RES["MCAR" D
"RTN","GMRCGUIB",184,0)
 .. N ARR,STR
"RTN","GMRCGUIB",185,0)
 .. D MEDLKUP^MCARUTL3(.ARR,+$P(RES,"MCAR(",2),+RES)
"RTN","GMRCGUIB",186,0)
 .. I '+ARR K GMRCAR(50,CNT) Q
"RTN","GMRCGUIB",187,0)
 .. S STR=$P(ARR,U,9)_U_$P(ARR,U,6)_$S($P(ARR,U,10):"^^^^^^^^1",1:"")
"RTN","GMRCGUIB",188,0)
 .. S GMRCAR(50,CNT)=GMRCAR(50,CNT)_U_STR
"RTN","GMRCGUIB",189,0)
 . S CNT=CNT+1
"RTN","GMRCGUIB",190,0)
 Q
"RTN","GMRCSLM4")
0^4^B39443452
"RTN","GMRCSLM4",1,0)
GMRCSLM4 ;SLC/DCM - List Manager routine - Activity Log Detailed Display ;1/28/99 10:30
"RTN","GMRCSLM4",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,15,22,50,64**;DEC 27,1997;Build 20
"RTN","GMRCSLM4",3,0)
 ;
"RTN","GMRCSLM4",4,0)
 ; This routine invokes IA #3138
"RTN","GMRCSLM4",5,0)
 ;
"RTN","GMRCSLM4",6,0)
ACTLOG(GMRCO) ;Print activity log
"RTN","GMRCSLM4",7,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",8,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Facility",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",9,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=" Activity"_$E(TAB,1,16)_"Date/Time/Zone"_$E(TAB,1,6)_"Responsible Person"_$E(TAB,1,2)_"Entered By",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",10,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$$REPEAT^XLFSTR("-",79),GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",11,0)
 N GMRCD,GMRCDA
"RTN","GMRCSLM4",12,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDA="" F  S GMRCDA=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDA)) Q:'GMRCDA  D BLDALN(GMRCO,GMRCDA)
"RTN","GMRCSLM4",13,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",14,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Note: TIME ZONE is local if not indicated",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",15,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",16,0)
 Q
"RTN","GMRCSLM4",17,0)
 ;
"RTN","GMRCSLM4",18,0)
BLDALN(GMRCO,GMRCDA) ;Build Activity Log Lines for an activity
"RTN","GMRCSLM4",19,0)
 ; GMRCO=  consult internal entry number
"RTN","GMRCSLM4",20,0)
 ; GMRCDA= activity internal entry number
"RTN","GMRCSLM4",21,0)
 N GMRCACT,GMRCSLN,XDT1,XDT2,FLG,LN,LINE,DASH,X,GMRCX,GMRCDEV,GMRCISIT,GMRC3LN
"RTN","GMRCSLM4",22,0)
 S GMRCDA(0)=^GMR(123,+GMRCO,40,GMRCDA,0)
"RTN","GMRCSLM4",23,0)
 S GMRCACT=$P(GMRCDA(0),"^",2)
"RTN","GMRCSLM4",24,0)
 S GMRCDA(2)=$G(^GMR(123,+GMRCO,40,GMRCDA,2))
"RTN","GMRCSLM4",25,0)
 S GMRCDA(3)=$G(^GMR(123,+GMRCO,40,GMRCDA,3))
"RTN","GMRCSLM4",26,0)
 I $D(^GMR(123,GMRCO,40,GMRCDA,2)) D
"RTN","GMRCSLM4",27,0)
 . S GMRCISIT=$P(^GMR(123,GMRCO,0),U,23) Q:'GMRCISIT
"RTN","GMRCSLM4",28,0)
 . S GMRCISIT=$$GET1^DIQ(4,GMRCISIT,.01)
"RTN","GMRCSLM4",29,0)
 D BLDLN1
"RTN","GMRCSLM4",30,0)
 D BLDLN2
"RTN","GMRCSLM4",31,0)
 D BLDCMTS
"RTN","GMRCSLM4",32,0)
 Q
"RTN","GMRCSLM4",33,0)
 ;
"RTN","GMRCSLM4",34,0)
BLDLN1 ;Build the first line for the activity
"RTN","GMRCSLM4",35,0)
 ;GMRCX is scratch pad variable
"RTN","GMRCSLM4",36,0)
 I $L($G(GMRCISIT)) D
"RTN","GMRCSLM4",37,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCISIT
"RTN","GMRCSLM4",38,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",39,0)
 S GMRCX=$P($G(^GMR(123.1,+GMRCACT,0)),"^",1)
"RTN","GMRCSLM4",40,0)
 S:'$L(GMRCX) GMRCX=GMRCACT_" action?"
"RTN","GMRCSLM4",41,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=" "_GMRCX
"RTN","GMRCSLM4",42,0)
 ;
"RTN","GMRCSLM4",43,0)
 ;Add to line for Printed to (action 22) when device name <13 characters
"RTN","GMRCSLM4",44,0)
 I GMRCACT=22 D
"RTN","GMRCSLM4",45,0)
 . S GMRCDEV=$$GET1^DIQ(3.5,+$P(GMRCDA(0),"^",8),.01)
"RTN","GMRCSLM4",46,0)
 . I '$L(GMRCDEV) S GMRCDEV=$P(GMRCDA(0),"^",8)
"RTN","GMRCSLM4",47,0)
 . I $L(GMRCDEV)<13 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_" "_GMRCDEV K GMRCDEV
"RTN","GMRCSLM4",48,0)
 ;
"RTN","GMRCSLM4",49,0)
 ;Add on generic fields that apply to every activity
"RTN","GMRCSLM4",50,0)
 ;Date/time of Actual Activity, Who's Responsible for Activity,
"RTN","GMRCSLM4",51,0)
 ;and Who entered activity
"RTN","GMRCSLM4",52,0)
 S X=$P(GMRCDA(0),"^",3) D REGDTM^GMRCU S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$S($D(^TMP("GMRCR",$J,"DT",GMRCCT,0)):^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,25-$L(^(0)))_X,1:X)_$E(TAB)_$S($P(GMRCDA(2),"^",3)]"":$P(GMRCDA(2),"^",3),1:$E(TAB,1,3))
"RTN","GMRCSLM4",53,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,45-$L(^(0)))_$S($P(GMRCDA(2),"^",2)]"":$E($P(GMRCDA(2),"^",2),1,17),$P(GMRCDA(0),"^",4):$E($P($G(^VA(200,$P(GMRCDA(0),"^",4),0)),"^"),1,17),1:$E(TAB,1,18))
"RTN","GMRCSLM4",54,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,65-$L(^(0)))_$S($P(GMRCDA(2),"^")]"":$E($P(GMRCDA(2),"^"),1,17),$P(GMRCDA(0),"^",5):$E($P($G(^VA(200,$P(GMRCDA(0),"^",5),0)),"^"),1,17),1:$E(TAB,1,17))
"RTN","GMRCSLM4",55,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",56,0)
 Q
"RTN","GMRCSLM4",57,0)
 ;
"RTN","GMRCSLM4",58,0)
BLDLN2 ;SECOND line for activity
"RTN","GMRCSLM4",59,0)
 N GMRCSLN S GMRCSLN="" ;saved SECOND line
"RTN","GMRCSLM4",60,0)
 ;
"RTN","GMRCSLM4",61,0)
 ; Check if the entry date and specified actual date are different
"RTN","GMRCSLM4",62,0)
 S XDT1=$P(GMRCDA(0),"^",1),XDT2=$P(GMRCDA(0),"^",3),GMRCX=0
"RTN","GMRCSLM4",63,0)
 S:XDT2>XDT1 X=XDT1,XDT1=XDT2,XDT2=X
"RTN","GMRCSLM4",64,0)
 S GMRCDIF=$$FMDIFF^XLFDT(XDT1,XDT2,3)
"RTN","GMRCSLM4",65,0)
 I $L(GMRCDIF) D
"RTN","GMRCSLM4",66,0)
 . I +$P(GMRCDIF," ",1)>0 S GMRCX=1 Q  ;Check Days
"RTN","GMRCSLM4",67,0)
 . S GMRCDIF=$P(GMRCDIF," ",2)
"RTN","GMRCSLM4",68,0)
 . I +$P(GMRCDIF,":",1)>0 S GMRCX=1 Q  ;Check Hours
"RTN","GMRCSLM4",69,0)
 . I +$P(GMRCDIF,":",2)>1 S GMRCX=1 Q  ;Check Minutes
"RTN","GMRCSLM4",70,0)
 . Q
"RTN","GMRCSLM4",71,0)
 I GMRCX D
"RTN","GMRCSLM4",72,0)
 . S X=$P(GMRCDA(0),"^",1) D REGDTM^GMRCU
"RTN","GMRCSLM4",73,0)
 . ;S GMRCSLN=$E(GMRCSLN_TAB,1,15)_"(entered) "_X_$E(TAB)_$S($P(GMRCDA(2),"^",3)]"":$P(GMRCDA(2),"^",3),1:$E(TAB,1,3))
"RTN","GMRCSLM4",74,0)
 . S GMRCSLN=$E(GMRCSLN_TAB,1,15)_"(entered) "_X_$E(TAB,1,4)
"RTN","GMRCSLM4",75,0)
 . Q
"RTN","GMRCSLM4",76,0)
 ;
"RTN","GMRCSLM4",77,0)
 I $G(GMRCSLN) D  S GMRCSLN=""
"RTN","GMRCSLM4",78,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCSLN
"RTN","GMRCSLM4",79,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",80,0)
 . Q
"RTN","GMRCSLM4",81,0)
 ;
"RTN","GMRCSLM4",82,0)
 ;Get local Incomplete Report and Complete result # for second line of action
"RTN","GMRCSLM4",83,0)
 I +$P(GMRCDA(0),"^",9) D
"RTN","GMRCSLM4",84,0)
 . I $P($P(GMRCDA(0),"^",9),";",2)["TIU" D  Q
"RTN","GMRCSLM4",85,0)
 .. S GMRCSLN=$E(TAB,1,5)_"Note# "_+$P(GMRCDA(0),"^",9)
"RTN","GMRCSLM4",86,0)
 . I $P($P(GMRCDA(0),"^",9),";",2)["MCAR" D  Q
"RTN","GMRCSLM4",87,0)
 .. N MCFILE S MCFILE=+$P($P(GMRCDA(0),"^",9),"MCAR(",2) Q:'MCFILE
"RTN","GMRCSLM4",88,0)
 .. N MCPRDT S MCPRDT=$$GET1^DIQ(MCFILE,+$P(GMRCDA(0),"^",9),.01)
"RTN","GMRCSLM4",89,0)
 .. Q:'$L(MCPRDT)
"RTN","GMRCSLM4",90,0)
 .. S GMRCSLN=$E(TAB,1,5)_"Medicine Procedure performed: "_MCPRDT
"RTN","GMRCSLM4",91,0)
 ;
"RTN","GMRCSLM4",92,0)
 ;Get remote Incomplete Report and Complete result # for second line of action
"RTN","GMRCSLM4",93,0)
 I +$P(GMRCDA(2),"^",4) D
"RTN","GMRCSLM4",94,0)
 . N GMRCRR S GMRCRR=$P(GMRCDA(2),"^",4)
"RTN","GMRCSLM4",95,0)
 . S GMRCSLN=$E(TAB,1,5)_"Remote "_$P(GMRCRR,";",3)_" #"_+$P(GMRCRR,";")_" from "_$P($G(^DIC(4,+$P(GMRCRR,";",4),0)),"^")
"RTN","GMRCSLM4",96,0)
 ;
"RTN","GMRCSLM4",97,0)
 ;If GMRCDEV is defined, then print the device name on the second line
"RTN","GMRCSLM4",98,0)
 I GMRCACT=22,$D(GMRCDEV) D
"RTN","GMRCSLM4",99,0)
 . S GMRCSLN=$E(TAB,1,5)_$E(GMRCDEV,1,17) K GMRCDEV
"RTN","GMRCSLM4",100,0)
 ;
"RTN","GMRCSLM4",101,0)
 ;Build line for forwarded to (action 17)
"RTN","GMRCSLM4",102,0)
 I GMRCACT=17 D
"RTN","GMRCSLM4",103,0)
 . S GMRCX=$S(+$P(GMRCDA(0),"^",6):$P($G(^GMR(123.5,+$P(GMRCDA(0),"^",6),0)),"^"),$P(GMRCDA(3),"^")]"":$P(GMRCDA(3),"^"),1:" ??")
"RTN","GMRCSLM4",104,0)
 . S GMRCSLN=$E(TAB,1,5)_GMRCX
"RTN","GMRCSLM4",105,0)
 . I $P(GMRCDA(0),"^",7)'="" S GMRC3LN="Previous Attention:  "_$P($G(^VA(200,$P(GMRCDA(0),"^",7),0)),"^")
"RTN","GMRCSLM4",106,0)
 I GMRCACT=25 D
"RTN","GMRCSLM4",107,0)
 . S GMRCX=""
"RTN","GMRCSLM4",108,0)
 . I $P(^GMR(123,+GMRCO,12),U,5)="F" D
"RTN","GMRCSLM4",109,0)
 .. S GMRCX="Previous remote service name: "
"RTN","GMRCSLM4",110,0)
 . S GMRCX=GMRCX_$S(+$P(GMRCDA(0),"^",6):$P($G(^GMR(123.5,+$P(GMRCDA(0),"^",6),0)),"^"),$P(GMRCDA(3),"^")]"":$P(GMRCDA(3),"^"),1:" ??")
"RTN","GMRCSLM4",111,0)
 . S GMRCSLN=$E(TAB,1,5)_GMRCX
"RTN","GMRCSLM4",112,0)
 . I $P(GMRCDA(0),"^",7)'="" S GMRC3LN="Previous Attention:  "_$P($G(^VA(200,$P(GMRCDA(0),"^",7),0)),"^")
"RTN","GMRCSLM4",113,0)
 I $G(GMRCSLN) D
"RTN","GMRCSLM4",114,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCSLN
"RTN","GMRCSLM4",115,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",116,0)
 . Q
"RTN","GMRCSLM4",117,0)
 I $D(GMRC3LN) D
"RTN","GMRCSLM4",118,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRC3LN
"RTN","GMRCSLM4",119,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",120,0)
 . Q
"RTN","GMRCSLM4",121,0)
 ;
"RTN","GMRCSLM4",122,0)
 Q
"RTN","GMRCSLM4",123,0)
 ;
"RTN","GMRCSLM4",124,0)
BLDCMTS ;Build lines for Comment activity.
"RTN","GMRCSLM4",125,0)
 I GMRCACT=11 D BLDCMT Q
"RTN","GMRCSLM4",126,0)
 ;
"RTN","GMRCSLM4",127,0)
 ;Build lines for general comments on any activity
"RTN","GMRCSLM4",128,0)
 I $D(^GMR(123,+GMRCO,40,+GMRCDA,1)) D  Q
"RTN","GMRCSLM4",129,0)
 . S LN=$O(^GMR(123,+GMRCO,40,+GMRCDA,1,0)) Q:'+LN
"RTN","GMRCSLM4",130,0)
 . ;Check for edited fields generated text with lines <75 characters
"RTN","GMRCSLM4",131,0)
 . I $G(^GMR(123,+GMRCO,40,+GMRCDA,1,LN,0))["EDITED FIELDS" D BLDCMT Q
"RTN","GMRCSLM4",132,0)
 . D BLDCMT
"RTN","GMRCSLM4",133,0)
 . Q
"RTN","GMRCSLM4",134,0)
 . I $L($G(^GMR(123,+GMRCO,40,+GMRCDA,1,LN,0)))'>75 D BLDCMT Q
"RTN","GMRCSLM4",135,0)
 . ;Use utilities for long line formating
"RTN","GMRCSLM4",136,0)
 . S FLG=1,LINE="     "
"RTN","GMRCSLM4",137,0)
 . D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDA,1)","^TMP(""GMRCR"",$J,""DT"")",LINE,.GMRCCT,TAB,FLG)
"RTN","GMRCSLM4",138,0)
 . D BLDASH
"RTN","GMRCSLM4",139,0)
 . Q
"RTN","GMRCSLM4",140,0)
 Q
"RTN","GMRCSLM4",141,0)
 ;
"RTN","GMRCSLM4",142,0)
BLDCMT ;Build comment lines
"RTN","GMRCSLM4",143,0)
 ;DASH is 1 or "" for print dash line after comment
"RTN","GMRCSLM4",144,0)
 S LN=0
"RTN","GMRCSLM4",145,0)
 F  S LN=$O(^GMR(123,+GMRCO,40,+GMRCDA,1,LN)) Q:'+LN  D
"RTN","GMRCSLM4",146,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^GMR(123,+GMRCO,40,GMRCDA,1,LN,0) ;$P(^GMR(123,+GMRCO,40,GMRCDA,1,LN,0),"^",1)
"RTN","GMRCSLM4",147,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",148,0)
 . Q
"RTN","GMRCSLM4",149,0)
 ;D BLDASH
"RTN","GMRCSLM4",150,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",151,0)
 Q
"RTN","GMRCSLM4",152,0)
 ;
"RTN","GMRCSLM4",153,0)
BLDASH ;Build separater line with dashes
"RTN","GMRCSLM4",154,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",155,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",156,0)
 Q
"UP",123,123.02,-1)
123^40
"UP",123,123.02,0)
123.02
"VER")
8.0^22.0
"^DD",123,123.02,7,0)
PREVIOUSLY ASSIGNED TO^P200'^VA(200,^0;7^Q
"^DD",123,123.02,7,3)
Enter the name of the provider who was the previous attention value assigned on this consult.
"^DD",123,123.02,7,21,0)
^^2^2^3100519^
"^DD",123,123.02,7,21,1,0)
This is the provider who was previously identified in the ATTENTION (#7) 
"^DD",123,123.02,7,21,2,0)
field of the REQUEST/CONSULTATION (#123) file.
"^DD",123,123.02,7,"DT")
3100519
**INSTALL NAME**
GMTS*2.7*90
"BLD",19532,0)
GMTS*2.7*90^HEALTH SUMMARY^0^3110210^y
"BLD",19532,4,0)
^9.64PA^^
"BLD",19532,6)
2^
"BLD",19532,6.3)
4
"BLD",19532,"KRN",0)
^9.67PA^779.2^20
"BLD",19532,"KRN",.4,0)
.4
"BLD",19532,"KRN",.401,0)
.401
"BLD",19532,"KRN",.402,0)
.402
"BLD",19532,"KRN",.403,0)
.403
"BLD",19532,"KRN",.5,0)
.5
"BLD",19532,"KRN",.84,0)
.84
"BLD",19532,"KRN",3.6,0)
3.6
"BLD",19532,"KRN",3.8,0)
3.8
"BLD",19532,"KRN",9.2,0)
9.2
"BLD",19532,"KRN",9.8,0)
9.8
"BLD",19532,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",19532,"KRN",9.8,"NM",1,0)
GMTSCNB^^0^B49040445
"BLD",19532,"KRN",9.8,"NM","B","GMTSCNB",1)

"BLD",19532,"KRN",19,0)
19
"BLD",19532,"KRN",19.1,0)
19.1
"BLD",19532,"KRN",101,0)
101
"BLD",19532,"KRN",409.61,0)
409.61
"BLD",19532,"KRN",771,0)
771
"BLD",19532,"KRN",779.2,0)
779.2
"BLD",19532,"KRN",870,0)
870
"BLD",19532,"KRN",8989.51,0)
8989.51
"BLD",19532,"KRN",8989.52,0)
8989.52
"BLD",19532,"KRN",8994,0)
8994
"BLD",19532,"KRN","B",.4,.4)

"BLD",19532,"KRN","B",.401,.401)

"BLD",19532,"KRN","B",.402,.402)

"BLD",19532,"KRN","B",.403,.403)

"BLD",19532,"KRN","B",.5,.5)

"BLD",19532,"KRN","B",.84,.84)

"BLD",19532,"KRN","B",3.6,3.6)

"BLD",19532,"KRN","B",3.8,3.8)

"BLD",19532,"KRN","B",9.2,9.2)

"BLD",19532,"KRN","B",9.8,9.8)

"BLD",19532,"KRN","B",19,19)

"BLD",19532,"KRN","B",19.1,19.1)

"BLD",19532,"KRN","B",101,101)

"BLD",19532,"KRN","B",409.61,409.61)

"BLD",19532,"KRN","B",771,771)

"BLD",19532,"KRN","B",779.2,779.2)

"BLD",19532,"KRN","B",870,870)

"BLD",19532,"KRN","B",8989.51,8989.51)

"BLD",19532,"KRN","B",8989.52,8989.52)

"BLD",19532,"KRN","B",8994,8994)

"BLD",19532,"QUES",0)
^9.62^^
"BLD",19532,"REQB",0)
^9.611^^
"MBREQ")
1
"PKG",56,-1)
1^1
"PKG",56,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",56,22,0)
^9.49I^1^1
"PKG",56,22,1,0)
2.7^2951020^2960605
"PKG",56,22,1,"PAH",1,0)
90^3110210^1392
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","GMTSCNB")
0^1^B49040445
"RTN","GMTSCNB",1,0)
GMTSCNB ; SLC/KER - Consults Components Brief          ;05/14/09  17:36
"RTN","GMTSCNB",2,0)
 ;;2.7;Health Summary;**46,47,58,90**;Oct 20, 1995;Build 4
"RTN","GMTSCNB",3,0)
 ;
"RTN","GMTSCNB",4,0)
 ; External References
"RTN","GMTSCNB",5,0)
 ;   DBIA  3358  ^GMR(123,
"RTN","GMTSCNB",6,0)
 ;   DBIA 10040  ^SC(
"RTN","GMTSCNB",7,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSCNB",8,0)
 ;   DBIA  2056  $$GET1^DIQ     (file 123.1, 44)
"RTN","GMTSCNB",9,0)
 ;   DBIA  2056  GETS^DIQ       (file 123)
"RTN","GMTSCNB",10,0)
 ;   DBIA  2051  LIST^DIC       (file 123.02)
"RTN","GMTSCNB",11,0)
 ;
"RTN","GMTSCNB",12,0)
 ; Delete this line: test of perforce/eclipse
"RTN","GMTSCNB",13,0)
 ;
"RTN","GMTSCNB",14,0)
 Q
"RTN","GMTSCNB",15,0)
MAIN ; Consults - Brief
"RTN","GMTSCNB",16,0)
 K ^TMP("GMTSCN")
"RTN","GMTSCNB",17,0)
 N GMTSMAX,GMTSNMC,GMTSI,GMTSDFN S GMTSDFN=+($G(DFN))
"RTN","GMTSCNB",18,0)
 S:'$L($G(GMTS1)) GMTS1=6666666 S:'$L($G(GMTS2)) GMTS2=9999999
"RTN","GMTSCNB",19,0)
 S GMTS1=+($G(GMTS1)),GMTS2=+($G(GMTS2)),GMTSMAX=+($G(GMTSNDM)) S:GMTSMAX'>0 GMTSMAX=999999999
"RTN","GMTSCNB",20,0)
 S GMTSDFN=+($G(GMTSDFN)) Q:GMTSDFN=0  Q:'$D(^GMR(123,"AD",GMTSDFN))
"RTN","GMTSCNB",21,0)
 S:GMTS2>GMTS1 GMTSI=GMTS1,GMTS1=GMTS2,GMTS2=GMTSI S GMTSI=GMTS2-.00000001
"RTN","GMTSCNB",22,0)
 F  S GMTSI=$O(^GMR(123,"AD",GMTSDFN,GMTSI)) Q:+GMTSI=0!(GMTSI>GMTS1)  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",23,0)
 . S GMTSIEN=0 F  S GMTSIEN=$O(^GMR(123,"AD",GMTSDFN,GMTSI,GMTSIEN)) Q:+GMTSIEN=0  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",24,0)
 . . Q:+($G(GMTSNMC))>+($G(GMTSMAX))  K ^TMP("GMTSCN",$J)
"RTN","GMTSCNB",25,0)
 . . D EXT(GMTSIEN,GMTSI) Q:$D(GMTSQIT)  D BCD Q:$D(GMTSQIT)
"RTN","GMTSCNB",26,0)
 Q
"RTN","GMTSCNB",27,0)
BCD ;   Brief Consults Display
"RTN","GMTSCNB",28,0)
 Q:'$D(^TMP("GMTSCN",$J))  S GMTSNMC=+($G(GMTSNMC))+1
"RTN","GMTSCNB",29,0)
 D:GMTSNMC=1 BHDR Q:$D(GMTSQIT)
"RTN","GMTSCNB",30,0)
 N GMTSID,GMTSFI,GMTSIE S GMTSID=0
"RTN","GMTSCNB",31,0)
 F  S GMTSID=$O(^TMP("GMTSCN",$J,GMTSID)) Q:+GMTSID=0  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",32,0)
 . S GMTSFI=123,GMTSIE="" F  S GMTSIE=$O(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE)) Q:GMTSIE=""  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",33,0)
 . . N GMTSNB,GMTSRD,GMTSTO,GMTSVC,GMTSFM,GMTSLA,GMTSAD,GMTSED
"RTN","GMTSCNB",34,0)
 . . S GMTSNB=+($G(GMTSIE)) S:+GMTSNB=0 GMTSNB="?"
"RTN","GMTSCNB",35,0)
 . . S GMTSRD=$G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,3,"I"))
"RTN","GMTSCNB",36,0)
 . . S GMTSRD=$$UP^XLFSTR($S(+GMTSRD>0:$$ED^GMTSU(+GMTSRD),1:"UNKNOWN"))
"RTN","GMTSCNB",37,0)
 . . S GMTSFM=$$UP^XLFSTR($G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,2,"E")))
"RTN","GMTSCNB",38,0)
 . . S GMTSED=$G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,17,"I"))
"RTN","GMTSCNB",39,0)
    . . S GMTSED=$$UP^XLFSTR($S(+GMTSED>0:$$ED^GMTSU(+GMTSED),1:"UNKNOWN"))
"RTN","GMTSCNB",40,0)
 . . S GMTSTO=$$UP^XLFSTR($G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,1,"E")))
"RTN","GMTSCNB",41,0)
 . . S GMTSLA=$$UP^XLFSTR($G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,40,1,1,"E")))
"RTN","GMTSCNB",42,0)
 . . S GMTSLD=$G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,40,1,2,"I"))
"RTN","GMTSCNB",43,0)
 . . S GMTSLD=$$UP^XLFSTR($S(+GMTSLD>0:$$ED^GMTSU(+GMTSLD),1:"UNKNOWN"))
"RTN","GMTSCNB",44,0)
 . . D WRT
"RTN","GMTSCNB",45,0)
 Q
"RTN","GMTSCNB",46,0)
BHDR ;   Brief Header
"RTN","GMTSCNB",47,0)
 N GMTSL S $P(GMTSL,"-",79)=""
"RTN","GMTSCNB",48,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Request Date/",?15,"Request From",?52,"Earliest Date"
"RTN","GMTSCNB",49,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Number",?15,"Request To",?52,"Last Action",?67,"Action Date"
"RTN","GMTSCNB",50,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSL
"RTN","GMTSCNB",51,0)
 Q
"RTN","GMTSCNB",52,0)
WRT ;   Write Brief Consult
"RTN","GMTSCNB",53,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$E(GMTSRD,1,10),?15,GMTSFM,?52,$E(GMTSED,1,10)
"RTN","GMTSCNB",54,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSNB,?15,GMTSTO,?52,GMTSLA,?67,GMTSLD
"RTN","GMTSCNB",55,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSCNB",56,0)
 Q
"RTN","GMTSCNB",57,0)
EXT(X,Y) ; Extract Consults
"RTN","GMTSCNB",58,0)
 K ^TMP("GMTSCN",$J),^UTILITY("DIQ1",$J) N DIC,DIQ,DR,GMTSFM,GMTSI
"RTN","GMTSCNB",59,0)
 N GMTSIEN,GMTSIENS,GMTSLA,GMTSRT,GMTSTY,GMTSVC
"RTN","GMTSCNB",60,0)
 S GMTSIEN=+($G(X)) Q:GMTSIEN=0  S GMTSI=+($G(Y))
"RTN","GMTSCNB",61,0)
 S DIC=123,GMTSIENS=+($G(GMTSIEN))_","
"RTN","GMTSCNB",62,0)
 S GMTSRT="^TMP(""GMTSCN"","_$J_","_GMTSI_")"
"RTN","GMTSCNB",63,0)
 S DIQ(0)="IE",DR=".01;1;2;3;9;17" D GETS^DIQ(123,GMTSIENS,DR,"EI",GMTSRT,"MSG")
"RTN","GMTSCNB",64,0)
 S GMTSFM=+($G(^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"I"))) S:+GMTSFM=0 GMTSFM=""
"RTN","GMTSCNB",65,0)
 S GMTSVC="" S:+GMTSFM>0 GMTSVC=$$GET1^DIQ(44,GMTSFM,9,"E") S:$G(GMTSVC)="NONE" GMTSVC=""
"RTN","GMTSCNB",66,0)
 S:$L(GMTSVC) ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"SVC")=GMTSVC
"RTN","GMTSCNB",67,0)
 S GMTSTY="" S:+GMTSFM>0 GMTSTY=$$GET1^DIQ(44,GMTSFM,2,"E")
"RTN","GMTSCNB",68,0)
 S GMTSFM=$$FM(($G(^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"E"))_"^"_GMTSTY_"^"_GMTSVC))
"RTN","GMTSCNB",69,0)
 S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"E")=GMTSFM
"RTN","GMTSCNB",70,0)
 S GMTSLA=+($G(^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,9,"I")))
"RTN","GMTSCNB",71,0)
 S:+GMTSLA'>9 ^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,9,"E")=""
"RTN","GMTSCNB",72,0)
 I +GMTSLA>0 D
"RTN","GMTSCNB",73,0)
 . S GMTSLA=$$GET1^DIQ(123.1,GMTSLA,7,"E")
"RTN","GMTSCNB",74,0)
 . S ^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,9,"E")=GMTSLA
"RTN","GMTSCNB",75,0)
 S ^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,0)=(9999999-GMTSI)_"^"_$S(GMTSI>0:$$EDT^GMTSU((9999999-GMTSI)),1:"")
"RTN","GMTSCNB",76,0)
 D ACT
"RTN","GMTSCNB",77,0)
 Q
"RTN","GMTSCNB",78,0)
FM(X) ; From Service/Ward
"RTN","GMTSCNB",79,0)
 S X=$G(X) N GMTSTY,GMTSV S GMTSTY=$P(X,"^",2),GMTSV=$P(X,"^",3),X=$P(X,"^",1)
"RTN","GMTSCNB",80,0)
 I $L(X) S:+X>0&(GMTSTY="WARD")&(X'["WARD") X="WARD "_X S:+X'>0&(GMTSTY="WARD")&(X'["WARD") X=X_" WARD"
"RTN","GMTSCNB",81,0)
 S:($L(X)+$L(GMTSV)+3)'>30&($L(GMTSV))&(X'[GMTSV) X=X_" ("_GMTSV_")"
"RTN","GMTSCNB",82,0)
 S X=$$UP^XLFSTR(X)
"RTN","GMTSCNB",83,0)
 Q X
"RTN","GMTSCNB",84,0)
ACT ; Activity
"RTN","GMTSCNB",85,0)
 N GMTSL,GMTSFL,GMTSFLA,GMTSFLD,GMTSLA,GMTSLD,GMTSLR,GMTSAM,GMTSLM,GMTSC,GMTSDI,Y,DR,GMTSIENL,GMTSIENS,GMTSMSG K ^TMP("DILIST",$J)
"RTN","GMTSCNB",86,0)
 S GMTSIENS=+GMTSIEN_",",GMTSIENL=","_GMTSIENS,DR="1I;2I;9;10"
"RTN","GMTSCNB",87,0)
 D LIST^DIC(123.02,GMTSIENL,DR,,"*",,,,,,.GMTSDI,"GMTSMSG")
"RTN","GMTSCNB",88,0)
 K:+($G(^TMP("DILIST",$J,0)))=0 ^TMP("DILIST",$J) Q:+($G(^TMP("DILIST",$J,0)))=0
"RTN","GMTSCNB",89,0)
 S GMTSLA="",GMTSLD=0,GMTSLR="",GMTSAM="",GMTSC=0
"RTN","GMTSCNB",90,0)
 S GMTSL=0
"RTN","GMTSCNB",91,0)
 F  S GMTSL=$O(^TMP("DILIST",$J,"ID",GMTSL)) Q:+GMTSL=0  D
"RTN","GMTSCNB",92,0)
 . I +($G(^TMP("DILIST",$J,"ID",GMTSL,2)))'<GMTSLD,+($G(^TMP("DILIST",$J,"ID",GMTSL,2)))>0 D
"RTN","GMTSCNB",93,0)
 . . S GMTSLA=+($G(^TMP("DILIST",$J,"ID",GMTSL,1)))
"RTN","GMTSCNB",94,0)
 . . S GMTSLD=+($G(^TMP("DILIST",$J,"ID",GMTSL,2)))
"RTN","GMTSCNB",95,0)
 . . S GMTSLR=$G(^TMP("DILIST",$J,"ID",GMTSL,9))
"RTN","GMTSCNB",96,0)
 . . S GMTSLM=$G(^TMP("DILIST",$J,"ID",GMTSL,10))
"RTN","GMTSCNB",97,0)
 I +($G(GMTSFLA))>0,+($G(GMTSFLD))>0,+($G(GMTSFL))>0,+($G(GMTSR))'>0 S GMTSC=0,GMTSLA=GMTSFLA,GMTSLD=GMTSFLA D AAC
"RTN","GMTSCNB",98,0)
 I GMTSLA>0,GMTSLD>0 S GMTSC=1 D AAC
"RTN","GMTSCNB",99,0)
 K ^TMP("DILIST",$J)
"RTN","GMTSCNB",100,0)
 Q
"RTN","GMTSCNB",101,0)
AAC ;   Add Activity
"RTN","GMTSCNB",102,0)
 N GMTSEA,GMTSEP,GMTSEL,GMTSOR,GMTSW,I S GMTSC=+($G(GMTSC))
"RTN","GMTSCNB",103,0)
 S GMTSOR=$$UP^XLFSTR($$GET1^DIQ(123.1,GMTSLA,1,"I"))
"RTN","GMTSCNB",104,0)
 S GMTSEP=$$UP^XLFSTR($$GET1^DIQ(123.1,GMTSLA,7,"E"))
"RTN","GMTSCNB",105,0)
 S GMTSEA=$$UP^XLFSTR($$GET1^DIQ(123.1,GMTSLA,.01,"E"))
"RTN","GMTSCNB",106,0)
 S GMTSEL=$$AL(GMTSEA,GMTSEP) Q:'$L(GMTSEL)
"RTN","GMTSCNB",107,0)
 S GMTSEA=$$AN(GMTSEA,GMTSEP) Q:'$L(GMTSEA)
"RTN","GMTSCNB",108,0)
 I GMTSC>0 D
"RTN","GMTSCNB",109,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,1,"I")=GMTSLA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,1,"E")=GMTSEA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,1,"L")=GMTSEL
"RTN","GMTSCNB",110,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,2,"I")=GMTSLD,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,2,"E")=$$EDT^GMTSU(GMTSLD)
"RTN","GMTSCNB",111,0)
 I GMTSC'>0 D
"RTN","GMTSCNB",112,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LA","I")=GMTSLA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LA","E")=GMTSEA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LA","L")=GMTSEL
"RTN","GMTSCNB",113,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LD","I")=GMTSLD,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LD","E")=$$EDT^GMTSU(GMTSLD)
"RTN","GMTSCNB",114,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"WR","E")=$G(^TMP("DILIST",$J,"ID",GMTSFL,3))
"RTN","GMTSCNB",115,0)
 Q
"RTN","GMTSCNB",116,0)
AN(X,Y) ;   Activity Name
"RTN","GMTSCNB",117,0)
 N GMTSW,GMTSP,GMTSA S GMTSA=$G(X),GMTSP=$G(Y) S X=$$SN((GMTSA_" "_GMTSP)) S X=$E(X,1,11) Q X
"RTN","GMTSCNB",118,0)
AL(X,Y) ;   Activity Name
"RTN","GMTSCNB",119,0)
 N GMTSP,GMTSA S GMTSA=$G(X),GMTSP=$G(Y) S:GMTSA["RECEIVE" (GMTSA,GMTSP)="RECEIVED"
"RTN","GMTSCNB",120,0)
 S:GMTSA="ENTERED IN CPRS"!(GMTSA["CPRS RELEASED") (GMTSA,GMTSP)="DATA ENTRY" S:GMTSA="EDIT BEFORE RELEASE" (GMTSA,GMTSP)="EDITED"
"RTN","GMTSCNB",121,0)
 S X="" S:$L(GMTSA)&($L(GMTSP)) X=$S($L(GMTSP)>$L(GMTSA):GMTSP,1:GMTSA) S:'$L(GMTSA)!('$L(GMTSP)) X=$S('$L(GMTSP)&($L(GMTSA)):GMTSA,$L(GMTSP)&('$L(GMTSA)):GMTSP,1:"")
"RTN","GMTSCNB",122,0)
 Q X
"RTN","GMTSCNB",123,0)
SN(X) ;
"RTN","GMTSCNB",124,0)
 S X=$G(X) Q:X="" "UNKNOWN" Q:X["ENTERED"!(X["RELEASED") "ENTERED" Q:X["STATUS" "STAT CHG"
"RTN","GMTSCNB",125,0)
 Q:X["SIGNIF" "SIG FIND" Q:X["DISCONT" "DISCONT'D" Q:X["SCHEDUL" "SCHEDULED" Q:X["INCOMPL" "INCOMPLETE" Q:X["COMPLET" "COMPLETE"
"RTN","GMTSCNB",126,0)
 Q:X["EDIT" "EDITED" Q:X["DISASSO" "DISASSOC'D" Q:X["ADDENDUM" "ADDENDUM" Q:X["NEW NOTE" "NEW NOTE"
"RTN","GMTSCNB",127,0)
 Q:X["SERVICE" "SVC ENTER" Q:X["FORWARD" "FORWARDED" Q:X["CANCELLED" "CANCELLED" Q:X["COMMENT" "COMMENT" Q:X["RECEIVED" "RECEIVED" Q:X["PRINTED" "PRINTED"
"RTN","GMTSCNB",128,0)
 Q "UNKNOWN"
"VER")
8.0^22.0
**INSTALL NAME**
OR*3.0*337
"BLD",19529,0)
OR*3.0*337^ORDER ENTRY/RESULTS REPORTING^0^3110210^y
"BLD",19529,1,0)
^^2^2^3100208^^
"BLD",19529,1,1,0)
The description of this patch may be found in the National Patch Module
"BLD",19529,1,2,0)
under OR*3*280.
"BLD",19529,4,0)
^9.64PA^^0
"BLD",19529,6)
5^
"BLD",19529,6.3)
84
"BLD",19529,"ABNS",0)
^9.66A^^
"BLD",19529,"ABPKG")
n^n
"BLD",19529,"INI")

"BLD",19529,"INID")
n^n^n
"BLD",19529,"INIT")

"BLD",19529,"KRN",0)
^9.67PA^779.2^20
"BLD",19529,"KRN",.4,0)
.4
"BLD",19529,"KRN",.401,0)
.401
"BLD",19529,"KRN",.402,0)
.402
"BLD",19529,"KRN",.403,0)
.403
"BLD",19529,"KRN",.5,0)
.5
"BLD",19529,"KRN",.84,0)
.84
"BLD",19529,"KRN",.84,"NM",0)
^9.68A^^
"BLD",19529,"KRN",3.6,0)
3.6
"BLD",19529,"KRN",3.6,"NM",0)
^9.68A^^0
"BLD",19529,"KRN",3.8,0)
3.8
"BLD",19529,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",19529,"KRN",9.2,0)
9.2
"BLD",19529,"KRN",9.8,0)
9.8
"BLD",19529,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",19529,"KRN",9.8,"NM",1,0)
ORINQIV^^0^B231323971
"BLD",19529,"KRN",9.8,"NM",2,0)
ORADDFQT^^0^B30048700
"BLD",19529,"KRN",9.8,"NM",3,0)
ORCDPS1^^0^B78578103
"BLD",19529,"KRN",9.8,"NM","B","ORADDFQT",2)

"BLD",19529,"KRN",9.8,"NM","B","ORCDPS1",3)

"BLD",19529,"KRN",9.8,"NM","B","ORINQIV",1)

"BLD",19529,"KRN",19,0)
19
"BLD",19529,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",19529,"KRN",19,"NM",1,0)
ORCM MGMT^^2
"BLD",19529,"KRN",19,"NM",2,0)
OR IV ADD FREQ UTILITY^^0
"BLD",19529,"KRN",19,"NM","B","OR IV ADD FREQ UTILITY",2)

"BLD",19529,"KRN",19,"NM","B","ORCM MGMT",1)

"BLD",19529,"KRN",19.1,0)
19.1
"BLD",19529,"KRN",101,0)
101
"BLD",19529,"KRN",101,"NM",0)
^9.68A^^0
"BLD",19529,"KRN",409.61,0)
409.61
"BLD",19529,"KRN",771,0)
771
"BLD",19529,"KRN",779.2,0)
779.2
"BLD",19529,"KRN",870,0)
870
"BLD",19529,"KRN",8989.51,0)
8989.51
"BLD",19529,"KRN",8989.51,"NM",0)
^9.68A^^0
"BLD",19529,"KRN",8989.52,0)
8989.52
"BLD",19529,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",19529,"KRN",8994,0)
8994
"BLD",19529,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",19529,"KRN","B",.4,.4)

"BLD",19529,"KRN","B",.401,.401)

"BLD",19529,"KRN","B",.402,.402)

"BLD",19529,"KRN","B",.403,.403)

"BLD",19529,"KRN","B",.5,.5)

"BLD",19529,"KRN","B",.84,.84)

"BLD",19529,"KRN","B",3.6,3.6)

"BLD",19529,"KRN","B",3.8,3.8)

"BLD",19529,"KRN","B",9.2,9.2)

"BLD",19529,"KRN","B",9.8,9.8)

"BLD",19529,"KRN","B",19,19)

"BLD",19529,"KRN","B",19.1,19.1)

"BLD",19529,"KRN","B",101,101)

"BLD",19529,"KRN","B",409.61,409.61)

"BLD",19529,"KRN","B",771,771)

"BLD",19529,"KRN","B",779.2,779.2)

"BLD",19529,"KRN","B",870,870)

"BLD",19529,"KRN","B",8989.51,8989.51)

"BLD",19529,"KRN","B",8989.52,8989.52)

"BLD",19529,"KRN","B",8994,8994)

"BLD",19529,"PRE")

"BLD",19529,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",19529,"QUES",0)
^9.62^^
"BLD",19529,"REQB",0)
^9.611^2^1
"BLD",19529,"REQB",2,0)
OR*3.0*280^2
"BLD",19529,"REQB","B","OR*3.0*280",2)

"KRN",19,9988,-1)
2^1
"KRN",19,9988,0)
ORCM MGMT^Order Menu Management^^M^4550^^^^^^^22
"KRN",19,9988,10,0)
^19.01IP^17^17
"KRN",19,9988,10,17,0)
13006^FR
"KRN",19,9988,10,17,"^")
OR IV ADD FREQ UTILITY
"KRN",19,9988,"U")
ORDER MENU MANAGEMENT
"KRN",19,13006,-1)
0^2
"KRN",19,13006,0)
OR IV ADD FREQ UTILITY^IV Additive Frequency Utility^^A^^^^^^^^ORDER ENTRY/RESULTS REPORTING^^1
"KRN",19,13006,1,0)
^19.06^2^2^3100901^^^
"KRN",19,13006,1,1,0)
This option allows user the ability to add an additive frequency to 
"KRN",19,13006,1,2,0)
existing Continuous IV Quick Orders.
"KRN",19,13006,20)
D EN^ORADDFQT
"KRN",19,13006,"U")
IV ADDITIVE FREQUENCY UTILITY
"MBREQ")
1
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",22,-1)
1^1
"PKG",22,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",22,20,0)
^9.402P^^
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
3.0^2971217^2980204^64
"PKG",22,22,1,"PAH",1,0)
337^3110210^1392
"PKG",22,22,1,"PAH",1,1,0)
^^2^2^3110210
"PKG",22,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module
"PKG",22,22,1,"PAH",1,1,2,0)
under OR*3*280.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ORADDFQT")
0^2^B30048700
"RTN","ORADDFQT",1,0)
ORADDFQT ; SLC/AGP - Utility report for Order Dialogs ; 10/15/10
"RTN","ORADDFQT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**337**;DEC 17, 1997;Build 84
"RTN","ORADDFQT",3,0)
 ;
"RTN","ORADDFQT",4,0)
 ; DBIA 5133: reading ^PXRMD file #801.41
"RTN","ORADDFQT",5,0)
 ; 
"RTN","ORADDFQT",6,0)
 Q
"RTN","ORADDFQT",7,0)
 ;
"RTN","ORADDFQT",8,0)
EDIT(IEN,PERQOAR) ;
"RTN","ORADDFQT",9,0)
 N ASKADD,CNT,CONF,DA,DIE,DIK,DR,DRPSIVDG,DUR,EXIT,ERR,ERROR,FDA,FDAIEN
"RTN","ORADDFQT",10,0)
 N IVTYPE,LOC,NAME,NODE,OUTPUT,PSIVDG,PSNODE,TERMIN,USER
"RTN","ORADDFQT",11,0)
 N ADD,ADDIEN,ADDF,ADDFIEN,ADDNAME,ADDV,ORDIALOG,STR
"RTN","ORADDFQT",12,0)
 S EXIT=0,ERROR=0
"RTN","ORADDFQT",13,0)
 N OI,OINAME,PTR,UPDADD,UPDDSG
"RTN","ORADDFQT",14,0)
 S USER=$$ISPERQO^ORINQIV(IEN) I USER>0 D  Q EXIT
"RTN","ORADDFQT",15,0)
 .S NODE=$G(^ORD(101.41,IEN,0))
"RTN","ORADDFQT",16,0)
 .D GETS^DIQ(200,USER_",",".01;9.2","EI","OUTPUT","ERR")
"RTN","ORADDFQT",17,0)
 .I $D(ERR) D AWRITE^ORINQIV(ERR) Q
"RTN","ORADDFQT",18,0)
 .S TERMIN=$G(OUTPUT(200,USER_",",9.2,"I"))
"RTN","ORADDFQT",19,0)
 .I TERMIN>0,TERMIN<DT Q
"RTN","ORADDFQT",20,0)
 .S PERQOAR(OUTPUT(200,USER_",",.01,"E"),$P(NODE,U))=$P(NODE,U,2)
"RTN","ORADDFQT",21,0)
 K ^TMP($J,"OR DESC")
"RTN","ORADDFQT",22,0)
 S UPDDSG="N",UPDADD="N"
"RTN","ORADDFQT",23,0)
 S DA=IEN
"RTN","ORADDFQT",24,0)
 D EN^ORORDDSC(IEN,"OR DESC")
"RTN","ORADDFQT",25,0)
 S CNT=0 F  S CNT=$O(^TMP($J,"OR DESC",IEN,CNT)) Q:CNT'>0  D
"RTN","ORADDFQT",26,0)
 .W !,^TMP($J,"OR DESC",IEN,CNT)
"RTN","ORADDFQT",27,0)
 ;
"RTN","ORADDFQT",28,0)
CONVERT ;
"RTN","ORADDFQT",29,0)
 W !!,"Add additive frequency to the above Quick Order?"
"RTN","ORADDFQT",30,0)
 S UPDDSG=$$ASK^ORINQIV("Add additive fequency?","Y:YES;N:NO",1,"")
"RTN","ORADDFQT",31,0)
 I UPDDSG="Q"!(UPDDSG=U)!(UPDDSG="^^") S EXIT=1 G EDITX
"RTN","ORADDFQT",32,0)
 I UPDDSG'="Y" G EDITX
"RTN","ORADDFQT",33,0)
 ;buidl ORDIALOG array
"RTN","ORADDFQT",34,0)
 D GETQDLG^ORCD(IEN)
"RTN","ORADDFQT",35,0)
 ;find additive
"RTN","ORADDFQT",36,0)
 S ADDIEN=+$P($G(ORDIALOG("B","ADDITIVE")),U,2)
"RTN","ORADDFQT",37,0)
 S CNT=0
"RTN","ORADDFQT",38,0)
 F  S CNT=$O(ORDIALOG(ADDIEN,CNT)) Q:CNT=""  D
"RTN","ORADDFQT",39,0)
 .I +CNT=0 Q
"RTN","ORADDFQT",40,0)
 .S ADD(CNT)=ORDIALOG(ADDIEN,CNT)
"RTN","ORADDFQT",41,0)
 ;
"RTN","ORADDFQT",42,0)
FREQ ;
"RTN","ORADDFQT",43,0)
 N ANS,DEFAULT,EXIT,ORIVTYPE
"RTN","ORADDFQT",44,0)
 S ORIVTYPE="C"
"RTN","ORADDFQT",45,0)
 S CNT=0,EXIT=0 F  S CNT=$O(ADD(CNT)) Q:CNT'>0!(EXIT=1)  D
"RTN","ORADDFQT",46,0)
 .S ADDV=ADD(CNT) Q:ADDV'>0
"RTN","ORADDFQT",47,0)
 .S ADDNAME=$P($G(^ORD(101.43,ADDV,0)),U)
"RTN","ORADDFQT",48,0)
 .W !,"Additive: "_ADDNAME
"RTN","ORADDFQT",49,0)
 .S DEFAULT=$$ADDFRD^ORCDPSIV(.ORDIALOG,CNT,"ADDFREQ")
"RTN","ORADDFQT",50,0)
 .S STR="A:ALL Bags;1:1 Bag/Day;S:See Comments"
"RTN","ORADDFQT",51,0)
 .W !,"Default value: "_DEFAULT
"RTN","ORADDFQT",52,0)
 .S ANS=$$ASK^ORINQIV("Select Additive Frequency",STR,9,DEFAULT)
"RTN","ORADDFQT",53,0)
 .I ANS=U S EXIT=1 Q
"RTN","ORADDFQT",54,0)
 .I ANS="^^"!(ANS="Q") S EXIT=1 Q
"RTN","ORADDFQT",55,0)
 .I ANS="K"!(ANS="N") S EXIT=1 Q
"RTN","ORADDFQT",56,0)
 .S ADDF(CNT)=$S(ANS="A":"ALL Bags",ANS=1:"1 Bag/Day",ANS="S":"See Comments")
"RTN","ORADDFQT",57,0)
 I ANS=U G FREQ
"RTN","ORADDFQT",58,0)
 I ANS="^^"!(ANS="Q") G EDITX
"RTN","ORADDFQT",59,0)
 I ANS="K"!(ANS="N") G EDITX
"RTN","ORADDFQT",60,0)
 ;
"RTN","ORADDFQT",61,0)
CONFIRM ;
"RTN","ORADDFQT",62,0)
 W !!,"Please confirm the selected changes below."
"RTN","ORADDFQT",63,0)
 W !,"If these changes are accepted, the Quick Order will be updated"
"RTN","ORADDFQT",64,0)
 S CNT=0 F  S CNT=$O(ADD(CNT)) Q:CNT=""  D
"RTN","ORADDFQT",65,0)
 .S ADDV=ADD(CNT) Q:ADDV'>0
"RTN","ORADDFQT",66,0)
 .S ADDNAME=$P($G(^ORD(101.43,ADDV,0)),U)
"RTN","ORADDFQT",67,0)
 .W !,"Additive: "_ADDNAME
"RTN","ORADDFQT",68,0)
 .W !,"Additive Frequency: "_$G(ADDF(CNT))
"RTN","ORADDFQT",69,0)
 .W !
"RTN","ORADDFQT",70,0)
 S CONF=$$ASK^ORINQIV("Confirm Changes?","Y:YES;N:NO",4,"")
"RTN","ORADDFQT",71,0)
 I CONF=U G FREQ
"RTN","ORADDFQT",72,0)
 I CONF="^^"!(CONF="Q") S EXIT=1 G EDITX
"RTN","ORADDFQT",73,0)
 I CONF="S"!(CONF="N") G EDITX
"RTN","ORADDFQT",74,0)
 ;
"RTN","ORADDFQT",75,0)
UPDATES ;Do updates
"RTN","ORADDFQT",76,0)
 W !
"RTN","ORADDFQT",77,0)
 N FDA,IENS
"RTN","ORADDFQT",78,0)
 N UPD,INT,VALUE
"RTN","ORADDFQT",79,0)
 S UPD=3,INT=0
"RTN","ORADDFQT",80,0)
 S PTR=$$PTR^ORMBLDPS("ADDITIVE FREQUENCY") Q:PTR'>0
"RTN","ORADDFQT",81,0)
 S CNT=0 F  S CNT=$O(ADDF(CNT)) Q:CNT=""  D
"RTN","ORADDFQT",82,0)
 .S UPD=UPD+1,INT=INT+1
"RTN","ORADDFQT",83,0)
 .S VALUE=ADDF(CNT) Q:VALUE=""
"RTN","ORADDFQT",84,0)
 .S IENS="?+"_UPD_","_IEN_","
"RTN","ORADDFQT",85,0)
 .S FDA(101.416,IENS,.01)=40
"RTN","ORADDFQT",86,0)
 .S FDA(101.416,IENS,.02)=PTR
"RTN","ORADDFQT",87,0)
 .S FDA(101.416,IENS,.03)=INT
"RTN","ORADDFQT",88,0)
 .S FDA(101.416,IENS,1)=VALUE
"RTN","ORADDFQT",89,0)
 .D UPDATE^DIE("","FDA","FDAIEN","ERR")
"RTN","ORADDFQT",90,0)
 .I $D(ERR) D AWRITE^ORINQIV("ERR") S ERROR=1
"RTN","ORADDFQT",91,0)
 I ERROR=1 W !,"Due to the errors in conversion please valiate the quick order in the editor."
"RTN","ORADDFQT",92,0)
 ;
"RTN","ORADDFQT",93,0)
 ;Call the QO editor
"RTN","ORADDFQT",94,0)
 W !
"RTN","ORADDFQT",95,0)
 D QCK0^ORCMEDT1(IEN)
"RTN","ORADDFQT",96,0)
EDITX ;
"RTN","ORADDFQT",97,0)
 K ^TMP($J,"OR DESC")
"RTN","ORADDFQT",98,0)
 Q EXIT
"RTN","ORADDFQT",99,0)
 ;
"RTN","ORADDFQT",100,0)
EN ;
"RTN","ORADDFQT",101,0)
 K ^TMP($J,"OR REMMDLG")
"RTN","ORADDFQT",102,0)
 N DIR,DSGPAR,DSGRP,EXIT,NANSC,ODIEN,PERQOAR,QOIEN,Y
"RTN","ORADDFQT",103,0)
 ;
"RTN","ORADDFQT",104,0)
 D HELP^ORINQIV(7)
"RTN","ORADDFQT",105,0)
 ;Build a list of Display Groups that contains the default dialog of
"RTN","ORADDFQT",106,0)
 ;PSJI OR PAT FLUID OE
"RTN","ORADDFQT",107,0)
 S ODIEN=$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE","")) Q:ODIEN=""
"RTN","ORADDFQT",108,0)
 S DSGRP=0 F  S DSGRP=$O(^ORD(100.98,DSGRP)) Q:DSGRP'>0  D
"RTN","ORADDFQT",109,0)
 .I $P(^ORD(100.98,DSGRP,0),U,4)=ODIEN S DSGPAR(DSGRP)=""
"RTN","ORADDFQT",110,0)
 ;
"RTN","ORADDFQT",111,0)
 S DIR(0)="S^A:QO ASSIGNED TO ORDER MENUS, ORDER SETS, OR REMINDER DIALOGS;N:QO NOT ASSIGNED TO ANY OF THESE ITEMS;S:SPECIFIC QUICK ORDER;Q:QUIT THE UPDATE UTILITY"
"RTN","ORADDFQT",112,0)
 S DIR("A")="Which QO to convert?"
"RTN","ORADDFQT",113,0)
 S DIR("??")="^D HELP^ORINQIV(5)"
"RTN","ORADDFQT",114,0)
 D ^DIR
"RTN","ORADDFQT",115,0)
 I Y=U!(Y="^^")!(Y="Q") Q
"RTN","ORADDFQT",116,0)
 I Y="S" D IND(.DSGPAR) Q
"RTN","ORADDFQT",117,0)
 S NANSC=Y
"RTN","ORADDFQT",118,0)
 D FQOIRDLG^ORINQIV
"RTN","ORADDFQT",119,0)
 ;
"RTN","ORADDFQT",120,0)
 S OIIEN=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM","")) Q:OIIEN'>0
"RTN","ORADDFQT",121,0)
 S EXIT=0
"RTN","ORADDFQT",122,0)
 S QOIEN=0 F  S QOIEN=$O(^ORD(101.41,QOIEN)) Q:QOIEN'>0!(EXIT=1)  D
"RTN","ORADDFQT",123,0)
 .I $$ISVALID(QOIEN,NANSC,.DSGPAR)=0 Q
"RTN","ORADDFQT",124,0)
 .S EXIT=$$EDIT(QOIEN,.PERQOAR)
"RTN","ORADDFQT",125,0)
UTLEXIT ;
"RTN","ORADDFQT",126,0)
 I $D(PERQOAR) D BLDMSG^ORINQIV(.PERQOAR)
"RTN","ORADDFQT",127,0)
 K ^TMP($J,"OR REMDLG")
"RTN","ORADDFQT",128,0)
 Q
"RTN","ORADDFQT",129,0)
 ;
"RTN","ORADDFQT",130,0)
IND(DSGPAR) ;
"RTN","ORADDFQT",131,0)
 N DIC,DIR,EXIT,PERQOAR
"RTN","ORADDFQT",132,0)
 S DIC="^ORD(101.41,",DIC(0)="AEMQZ"
"RTN","ORADDFQT",133,0)
 S DIC("S")="I $$ISVALID^ORADDFQT(Y,""S"",.DSGPAR)=1"
"RTN","ORADDFQT",134,0)
 D ^DIC
"RTN","ORADDFQT",135,0)
 I +$P(Y,U)'>0 Q
"RTN","ORADDFQT",136,0)
 S EXIT=$$EDIT($P(Y,U),.PERQOAR)
"RTN","ORADDFQT",137,0)
 I EXIT=1 Q
"RTN","ORADDFQT",138,0)
 W !
"RTN","ORADDFQT",139,0)
 S DIR(0)="Y"
"RTN","ORADDFQT",140,0)
 S DIR("A")="Convert another Quick Order?"
"RTN","ORADDFQT",141,0)
 D ^DIR
"RTN","ORADDFQT",142,0)
 I Y=1 D IND(.DSGPAR)
"RTN","ORADDFQT",143,0)
 I $D(PERQOAR) D BLDMSG^ORINQIV(.PERQOAR)
"RTN","ORADDFQT",144,0)
 Q
"RTN","ORADDFQT",145,0)
 ;
"RTN","ORADDFQT",146,0)
ISVALID(IEN,NANSC,DSGPAR) ;
"RTN","ORADDFQT",147,0)
 N CONT,NODE,QODSG,PSNODE,RESULT
"RTN","ORADDFQT",148,0)
 S NODE=$G(^ORD(101.41,IEN,0))
"RTN","ORADDFQT",149,0)
 ;Quit if not a quick order
"RTN","ORADDFQT",150,0)
 I $P(NODE,U,4)'="Q" Q 0
"RTN","ORADDFQT",151,0)
 ;Disregard order dialog entry does not contain a valid display group
"RTN","ORADDFQT",152,0)
 S QODSG=$P(NODE,U,5) I QODSG="" Q 0
"RTN","ORADDFQT",153,0)
 I '$D(DSGPAR(QODSG)) Q 0
"RTN","ORADDFQT",154,0)
 ;
"RTN","ORADDFQT",155,0)
 S CONT=$S($O(^ORD(101.41,"AD",IEN,0)):1,$D(^TMP($J,"OR REMDLG",IEN)):1,1:0)
"RTN","ORADDFQT",156,0)
 ;
"RTN","ORADDFQT",157,0)
 ;S CONT=$$ISCONT^ORINQIV(IEN)
"RTN","ORADDFQT",158,0)
 I NANSC="A",CONT=0 Q 0
"RTN","ORADDFQT",159,0)
 I NANSC="N",CONT=1 Q 0
"RTN","ORADDFQT",160,0)
 N TYPE,ORDIALOG
"RTN","ORADDFQT",161,0)
 S ORTYPE="Z"
"RTN","ORADDFQT",162,0)
 D GETQDLG^ORCD(IEN)
"RTN","ORADDFQT",163,0)
 ; determine if a continuous IV Order
"RTN","ORADDFQT",164,0)
 S TYPE=+$P($G(ORDIALOG("B","TYPE")),U,2) I TYPE'>0 Q 0
"RTN","ORADDFQT",165,0)
 I $G(ORDIALOG(TYPE,1))'="C" Q 0
"RTN","ORADDFQT",166,0)
 I $$IVADFCHK^ORWDXM3(.ORDIALOG)=0 Q 1
"RTN","ORADDFQT",167,0)
 Q 0
"RTN","ORADDFQT",168,0)
 ;
"RTN","ORCDPS1")
0^3^B78578103
"RTN","ORCDPS1",1,0)
ORCDPS1 ;SLC/MKB-Pharmacy dialog utilities ; 12/9/2010
"RTN","ORCDPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,117,141,149,195,215,243,280,337**;Dec 17, 1997;Build 84
"RTN","ORCDPS1",3,0)
 ;
"RTN","ORCDPS1",4,0)
 ; DBIA 2418   START^PSSJORDF   ^TMP("PSJMR",$J)
"RTN","ORCDPS1",5,0)
 ; DBIA 3166   EN^PSSDIN        ^TMP("PSSDIN",$J)
"RTN","ORCDPS1",6,0)
 ; 
"RTN","ORCDPS1",7,0)
EN(TYPE) ; -- entry action for Meds dialogs
"RTN","ORCDPS1",8,0)
 S ORINPT=$$INPT^ORCD,ORCAT=$G(TYPE)
"RTN","ORCDPS1",9,0)
 I 'ORINPT,ORCAT="I" D IMOLOC^ORIMO(.ORINPT,+ORL,+ORVP) S:ORINPT<0 ORINPT=0 ;allow inpt meds at this location?
"RTN","ORCDPS1",10,0)
 I ORCAT="" D
"RTN","ORCDPS1",11,0)
 . I $G(ORENEW)!$G(OREWRITE)!$D(OREDIT),$L($P($G(OR0),U,12)) S ORCAT=$P(OR0,U,12) Q  ;use value from order, via ORCACT4
"RTN","ORCDPS1",12,0)
 . S ORCAT=$S(ORINPT:"I",1:"O")
"RTN","ORCDPS1",13,0)
 S ORDG=+$O(^ORD(100.98,"B",$S(ORCAT="I":"UD RX",1:"O RX"),0))
"RTN","ORCDPS1",14,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",15,0)
 I $G(ORENEW)!$G(OREWRITE)!$G(OREDIT)!$G(ORXFER) D  Q:$G(ORQUIT)
"RTN","ORCDPS1",16,0)
 . I 'ORINPT,ORCAT="I" D  Q:$G(ORQUIT)
"RTN","ORCDPS1",17,0)
 .. N OI S OI=+$O(^OR(100,+$G(ORIFN),.1,"B",0)) Q:OI<1
"RTN","ORCDPS1",18,0)
 .. I '$O(^ORD(101.43,OI,9,"B","IVM RX",0)) S ORQUIT=1 W $C(7),!!,"This order may not be placed at this location!" Q
"RTN","ORCDPS1",19,0)
 . K ORDIALOG($$PTR("START DATE/TIME"),1)
"RTN","ORCDPS1",20,0)
 . K ORDIALOG($$PTR("NOW"),1) Q:ORCAT'="O"
"RTN","ORCDPS1",21,0)
 . N WP S WP=$$PTR("WORD PROCESSING 1")
"RTN","ORCDPS1",22,0)
 . I '$G(ORXFER),'$$DRAFT^ORWDX2($G(ORIFN)) K ORDIALOG(WP,1),^TMP("ORWORD",$J,WP)
"RTN","ORCDPS1",23,0)
 . I $G(OREDIT),'$O(ORDIALOG($$PTR^ORCD("OR GTX INSTRUCTIONS"),0)) K ^TMP("ORWORD",$J)
"RTN","ORCDPS1",24,0)
 I ORINPT,ORCAT="O" W $C(7),!!,"NOTE: This will create an outpatient prescription for an inpatient!",!
"RTN","ORCDPS1",25,0)
 Q
"RTN","ORCDPS1",26,0)
 ;
"RTN","ORCDPS1",27,0)
EN1 ; -- setup Meds dialog for quick order editor using ORDG
"RTN","ORCDPS1",28,0)
 N DG S DG=$P($G(^ORD(100.98,+$G(ORDG),0)),U,3)
"RTN","ORCDPS1",29,0)
 I $P(DG," ")="O"!(DG="SPLY") S ORINPT=0,ORCAT="O"
"RTN","ORCDPS1",30,0)
 E  S ORINPT=1,ORCAT="I"
"RTN","ORCDPS1",31,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",32,0)
 Q
"RTN","ORCDPS1",33,0)
 ;
"RTN","ORCDPS1",34,0)
ENOI ; -- setup OI prompt
"RTN","ORCDPS1",35,0)
 N D S D=$G(ORDIALOG(PROMPT,"D"))
"RTN","ORCDPS1",36,0)
 S:D="S.RX" ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.UD RX",1:"S.O RX")
"RTN","ORCDPS1",37,0)
 I ORCAT="I",'ORINPT,D="S.UD RX" D  ;limit to IV meds for outpt's
"RTN","ORCDPS1",38,0)
 . S ORDIALOG(PROMPT,"D")="S.IVM RX" ;ORDG=+$O(^ORD(100.98,"B","O RX",0))
"RTN","ORCDPS1",39,0)
 . S ORDIALOG(PROMPT,"?")="Enter the IV medication you wish to order for this patient."
"RTN","ORCDPS1",40,0)
 Q
"RTN","ORCDPS1",41,0)
 ;
"RTN","ORCDPS1",42,0)
DEA ; -- ck DEA# of ordering provider if SchedII drug
"RTN","ORCDPS1",43,0)
 Q:$G(ORTYPE)="Z"  N DEAFLG,PSOI
"RTN","ORCDPS1",44,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(Y),0)),U,2) Q:PSOI'>0
"RTN","ORCDPS1",45,0)
 S DEAFLG=$$OIDEA^PSSUTLA1(PSOI,ORCAT) Q:DEAFLG'>0  ;ok
"RTN","ORCDPS1",46,0)
 I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" K DONE Q
"RTN","ORCDPS1",47,0)
 I DEAFLG=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPS1",48,0)
 Q
"RTN","ORCDPS1",49,0)
 ;
"RTN","ORCDPS1",50,0)
CHANGED(X) ; -- Kill dependent values when prompt X changes
"RTN","ORCDPS1",51,0)
 N PROMPTS,NAME,PTR,P,I
"RTN","ORCDPS1",52,0)
 S PROMPTS=X I X="OI" D
"RTN","ORCDPS1",53,0)
 . S PROMPTS="INSTRUCTIONS^ROUTE^SCHEDULE^START DATE/TIME^DURATION^AND/THEN^DOSE^DISPENSE DRUG^SIG^PATIENT INSTRUCTIONS^DAYS SUPPLY^QUANTITY^REFILLS^SERVICE CONNECTED"
"RTN","ORCDPS1",54,0)
 . K ORDRUG,ORDOSE,OROUTE,ORSCH,ORSD,ORDSUP,ORQTY,ORQTYUNT,OREFILLS,ORCOPAY
"RTN","ORCDPS1",55,0)
 . K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",56,0)
 I X="DS" S PROMPTS="QUANTITY^REFILLS" K OREFILLS
"RTN","ORCDPS1",57,0)
 F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P) D
"RTN","ORCDPS1",58,0)
 . S PTR=$$PTR(NAME) Q:'PTR
"RTN","ORCDPS1",59,0)
 . S I=0 F  S I=$O(ORDIALOG(PTR,I)) Q:I'>0  K ORDIALOG(PTR,I)
"RTN","ORCDPS1",60,0)
 . K ORDIALOG(PTR,"LIST"),^TMP("ORWORD",$J,PTR)
"RTN","ORCDPS1",61,0)
 Q
"RTN","ORCDPS1",62,0)
 ;
"RTN","ORCDPS1",63,0)
ORDITM(OI) ; -- Check OI, get dependent info
"RTN","ORCDPS1",64,0)
 Q:OI'>0  ;quit - no value
"RTN","ORCDPS1",65,0)
 N ORPS,ORPSOI S ORPS=$G(^ORD(101.43,+OI,"PS")),ORPSOI=+$P($G(^(0)),U,2)
"RTN","ORCDPS1",66,0)
 S ORIV=$S($P(ORPS,U)=2:1,1:0)
"RTN","ORCDPS1",67,0)
 I $G(ORCAT)="O",'$P(ORPS,U,2) W $C(7),!,"This drug may not be used in an outpatient order." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",68,0)
 I $G(ORCAT)="I" D  Q:$G(ORQUIT)
"RTN","ORCDPS1",69,0)
 . I $G(ORINPT),'$P(ORPS,U) W $C(7),!,"This drug may not be used in an inpatient order." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",70,0)
 . I '$G(ORINPT),'ORIV W $C(7),!,"This drug may not be ordered for an outpatient." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",71,0)
 I $G(ORTYPE)="Q" D  I $G(ORQUIT) D WAIT Q
"RTN","ORCDPS1",72,0)
 . N DEAFLG S DEAFLG=$$OIDEA^PSSUTLA1(ORPSOI,ORCAT) Q:DEAFLG'>0  ;ok
"RTN","ORCDPS1",73,0)
 . I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" S ORQUIT=1 Q
"RTN","ORCDPS1",74,0)
 . I DEAFLG=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPS1",75,0)
OI1 ; -ck NF status
"RTN","ORCDPS1",76,0)
 I $P(ORPS,U,6),'$G(ORENEW) D  ;alternative
"RTN","ORCDPS1",77,0)
 . W !!,"*** This medication is not in the formulary! ***"
"RTN","ORCDPS1",78,0)
 . N PSX,CNT,ORX,DIR,X,Y,DTOUT,DUOUT
"RTN","ORCDPS1",79,0)
 . D EN1^PSSUTIL1(.ORPSOI,ORCAT) I '$O(ORPSOI(0)) D  Q
"RTN","ORCDPS1",80,0)
 .. W !,"    There are no formulary alternatives entered for this item."
"RTN","ORCDPS1",81,0)
 .. W !,"    Please consult with your pharmacy before ordering it."
"RTN","ORCDPS1",82,0)
 . S PSX=0,CNT=0 F  S PSX=$O(ORPSOI(PSX)) Q:PSX'>0  D
"RTN","ORCDPS1",83,0)
 .. S ORX=+$O(^ORD(101.43,"ID",PSX_";99PSP",0)) Q:ORX'>0
"RTN","ORCDPS1",84,0)
 .. S CNT=CNT+1,ORPSOI("OI",CNT)=ORX_U_PSX
"RTN","ORCDPS1",85,0)
 .. S DIR("A",CNT)=$J(CNT,3)_" "_$P($G(^ORD(101.43,ORX,0)),U)
"RTN","ORCDPS1",86,0)
 . S DIR(0)="NAO^1:"_CNT,DIR("A")="Select alternative (or <return> to continue): "
"RTN","ORCDPS1",87,0)
 . S DIR("?")="The medication selected is not in the formulary; you may select one of the above listed alternatives instead, or press <return> to continue processing this order."
"RTN","ORCDPS1",88,0)
 . Q:CNT'>0  W !,"    Formulary alternatives:" D ^DIR
"RTN","ORCDPS1",89,0)
 . I Y'>0 S:$D(DTOUT)!$D(DUOUT) ORQUIT=1 Q
"RTN","ORCDPS1",90,0)
 . D:OI'=+ORPSOI("OI",+Y) CHANGED("OI") ;reset parameters if different
"RTN","ORCDPS1",91,0)
 . S OI=+ORPSOI("OI",+Y),ORDIALOG(PROMPT,INST)=OI,OROI=OI
"RTN","ORCDPS1",92,0)
 . S ORPSOI=+$P(ORPSOI("OI",+Y),U,2)
"RTN","ORCDPS1",93,0)
OI2 ; -get routes, doses [also called from NF^ORCDPS]
"RTN","ORCDPS1",94,0)
 D:'$D(^TMP("PSJMR",$J)) START^PSSJORDF(ORPSOI,$G(ORCAT))  ;DBIA 2418
"RTN","ORCDPS1",95,0)
 I '$D(ORDOSE) D
"RTN","ORCDPS1",96,0)
 . D DOSE^PSSORUTL(.ORDOSE,ORPSOI,$S($G(ORCAT)="I":"U",1:"O"),+ORVP)
"RTN","ORCDPS1",97,0)
 . K:$G(ORDOSE(1))=-1 ORDOSE
"RTN","ORCDPS1",98,0)
 Q
"RTN","ORCDPS1",99,0)
 ;
"RTN","ORCDPS1",100,0)
NFI(OI) ; -- Show NFI restrictions, if exist
"RTN","ORCDPS1",101,0)
 N PSOI,I,J,LCNT,MAX,X,STOP
"RTN","ORCDPS1",102,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORCDPS1",103,0)
 D EN^PSSDIN(PSOI,"") Q:'$D(^TMP("PSSDIN",$J,"OI",PSOI))  ;DBIA 3166
"RTN","ORCDPS1",104,0)
 S I=0,LCNT=0,MAX=$S($G(IOBM)&$G(IOTM):IOBM-IOTM+1,1:24) W !
"RTN","ORCDPS1",105,0)
 F  S I=$O(^TMP("PSSDIN",$J,"OI",PSOI,I)) Q:I'>0  D
"RTN","ORCDPS1",106,0)
 . S J=0 F  S J=$O(^TMP("PSSDIN",$J,"OI",PSOI,I,J)) Q:J'>0  S X=$G(^(J)) D  Q:$G(STOP)
"RTN","ORCDPS1",107,0)
 .. S LCNT=LCNT+1 I LCNT'<MAX S:'$$CONT STOP=1 Q:$G(STOP)  S LCNT=1
"RTN","ORCDPS1",108,0)
 .. W !,X
"RTN","ORCDPS1",109,0)
 W ! K ^TMP("PSSDIN",$J,"OI",PSOI)
"RTN","ORCDPS1",110,0)
 Q
"RTN","ORCDPS1",111,0)
 ;
"RTN","ORCDPS1",112,0)
CONT() ; -- Cont or stop?
"RTN","ORCDPS1",113,0)
 N X,Y,DIR,DUOUT,DTOUT,DIRUT,DIROUT S DIR(0)="EA"
"RTN","ORCDPS1",114,0)
 S DIR("A")="Press <return> to continue or ^ to stop ..."
"RTN","ORCDPS1",115,0)
 D ^DIR S:$D(DUOUT)!$D(DTOUT) Y=""
"RTN","ORCDPS1",116,0)
 Q +Y
"RTN","ORCDPS1",117,0)
 ;
"RTN","ORCDPS1",118,0)
WAIT ; -- Wait for user
"RTN","ORCDPS1",119,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCDPS1",120,0)
 Q
"RTN","ORCDPS1",121,0)
 ;
"RTN","ORCDPS1",122,0)
ROUTES ; -- Get med routes
"RTN","ORCDPS1",123,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  N I,X,CNT S (I,CNT)=0
"RTN","ORCDPS1",124,0)
 F  S I=$O(^TMP("PSJMR",$J,I)) Q:I'>0  S X=^(I),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=$P(X,U,3)_U_$P(X,U,1,2),ORDIALOG(PROMPT,"LIST","B",$P(X,U))=$P(X,U,3)
"RTN","ORCDPS1",125,0)
 S:$G(CNT) ORDIALOG(PROMPT,"LIST")=CNT
"RTN","ORCDPS1",126,0)
 S:$G(ORTYPE)'="Z" REQD=$S(ORCAT="I":1,$P($G(^ORD(101.43,+$G(OROI),"PS")),U,5):0,1:1)
"RTN","ORCDPS1",127,0)
 Q
"RTN","ORCDPS1",128,0)
 ;
"RTN","ORCDPS1",129,0)
DEFRTE ; -- Get default route
"RTN","ORCDPS1",130,0)
 N INST1 S INST1=$O(ORDIALOG(PROMPT,0)) S:INST1'>0 INST1=INST
"RTN","ORCDPS1",131,0)
 I INST1=INST S Y=+$P($G(^TMP("PSJMR",$J,1)),U,3) K:Y'>0 Y Q
"RTN","ORCDPS1",132,0)
 S Y=+$G(ORDIALOG(PROMPT,INST1)) K:Y'>0 Y S:$G(Y) EDITONLY=1
"RTN","ORCDPS1",133,0)
 Q
"RTN","ORCDPS1",134,0)
 ;
"RTN","ORCDPS1",135,0)
CKSCH ; -- validate schedule [Called from P-S Action]
"RTN","ORCDPS1",136,0)
 N ORX S ORX=ORDIALOG(PROMPT,ORI) Q:ORX=$G(ORESET)  K ORSD
"RTN","ORCDPS1",137,0)
 D EN^PSSGS0(.ORX,$G(ORCAT))
"RTN","ORCDPS1",138,0)
 I $D(ORX) S ORDIALOG(PROMPT,ORI)=ORX D CHANGED("QUANTITY") Q  ;ok
"RTN","ORCDPS1",139,0)
 W $C(7),!,"Enter a standard schedule for administering this medication"
"RTN","ORCDPS1",140,0)
 K DONE I $G(ORCAT)="I" W ".",! Q
"RTN","ORCDPS1",141,0)
 W " or one of your own,",!,"up to 20 characters.",!
"RTN","ORCDPS1",142,0)
 Q
"RTN","ORCDPS1",143,0)
 ;
"RTN","ORCDPS1",144,0)
DEFCONJ ; -- Set default conjuction for previous instance [P-S Action]
"RTN","ORCDPS1",145,0)
 N LAST,DUR,CONJ
"RTN","ORCDPS1",146,0)
 S LAST=$O(ORDIALOG(PROMPT,ORI),-1) Q:LAST'>0  ;first instance
"RTN","ORCDPS1",147,0)
 S CONJ=$$PTR("AND/THEN") Q:$L($G(ORDIALOG(CONJ,LAST)))
"RTN","ORCDPS1",148,0)
 S DUR=$G(ORDIALOG($$PTR("DURATION"),LAST))
"RTN","ORCDPS1",149,0)
 S ORDIALOG(CONJ,LAST)=$S(+DUR'>0:"A",1:"T")
"RTN","ORCDPS1",150,0)
 Q
"RTN","ORCDPS1",151,0)
 ;
"RTN","ORCDPS1",152,0)
ENCONJ ; -- Get allowable values, if req'd for INST
"RTN","ORCDPS1",153,0)
 N P S P=$$PTR("INSTRUCTIONS")
"RTN","ORCDPS1",154,0)
 S REQD=$S($O(ORDIALOG(P,INST)):1,1:0)
"RTN","ORCDPS1",155,0)
 S ORDIALOG(PROMPT,"A")="And/then"_$S(ORCAT="O":"/except: ",1:": ")
"RTN","ORCDPS1",156,0)
 S $P(ORDIALOG(PROMPT,0),U,2)="A:AND;T:THEN;"_$S(ORCAT="O":"X:EXCEPT;",1:"")
"RTN","ORCDPS1",157,0)
 Q
"RTN","ORCDPS1",158,0)
 ;
"RTN","ORCDPS1",159,0)
INPCONJ ;
"RTN","ORCDPS1",160,0)
 N LETTER,DUR
"RTN","ORCDPS1",161,0)
 I $G(X)="" Q
"RTN","ORCDPS1",162,0)
 S LETTER=$$UP^XLFSTR($E(X,1))
"RTN","ORCDPS1",163,0)
 I LETTER'="T" Q
"RTN","ORCDPS1",164,0)
 S DUR=$$PTR("DURATION") I '$L($G(ORDIALOG(DUR,INST))) D
"RTN","ORCDPS1",165,0)
 .W !,"A duration is required when using a 'Then' conjunction."
"RTN","ORCDPS1",166,0)
 .K X
"RTN","ORCDPS1",167,0)
 Q
"RTN","ORCDPS1",168,0)
 ;
"RTN","ORCDPS1",169,0)
DSUP ; -- Get max/default days supply
"RTN","ORCDPS1",170,0)
 N ORX,Y
"RTN","ORCDPS1",171,0)
 S ORX("PATIENT")=+$G(ORVP),ORX("DRUG")=+$G(ORDRUG)
"RTN","ORCDPS1",172,0)
 D DSUP^PSOSIGDS(.ORX) S Y=+$G(ORX("DAYS SUPPLY")) S:Y'>0 Y=90
"RTN","ORCDPS1",173,0)
 ;S $P(ORDIALOG(PROMPT,0),U,2)="1:"_Y ;max allowed
"RTN","ORCDPS1",174,0)
 I '$G(ORDIALOG(PROMPT,1)),$G(ORTYPE)'="Z" S ORDIALOG(PROMPT,1)=Y
"RTN","ORCDPS1",175,0)
 Q
"RTN","ORCDPS1",176,0)
 ;
"RTN","ORCDPS1",177,0)
QTY() ; -- Return default quantity [Expects ORDSUP]
"RTN","ORCDPS1",178,0)
 N INSTR,DOSE,DUR,SCH,I,ORX,X,Y
"RTN","ORCDPS1",179,0)
 S Y="" I $G(ORDSUP)'>0!'$G(ORDRUG) G QTYQ ;need days supply, disp drug
"RTN","ORCDPS1",180,0)
 S INSTR=$$PTR("INSTRUCTIONS")
"RTN","ORCDPS1",181,0)
 S DOSE=$$PTR("DOSE"),CONJ=$$PTR("AND/THEN")
"RTN","ORCDPS1",182,0)
 S DUR=$$PTR("DURATION"),SCH=$$PTR("SCHEDULE")
"RTN","ORCDPS1",183,0)
 S I=0 F  S I=$O(ORDIALOG(INSTR,I)) Q:I'>0  D  Q:'$D(ORX)
"RTN","ORCDPS1",184,0)
 . S X=$P($G(ORDIALOG(DOSE,I)),"&",3) I X'>0 K ORX Q
"RTN","ORCDPS1",185,0)
 . S ORX("DOSE ORDERED",I)=X,ORX("SCHEDULE",I)=$G(ORDIALOG(SCH,I))
"RTN","ORCDPS1",186,0)
 . S X=$G(ORDIALOG(DUR,I)),ORX("DURATION",I)=$$HL7DUR^ORMBLDPS
"RTN","ORCDPS1",187,0)
 . S ORX("CONJUNCTION",I)=$G(ORDIALOG(CONJ,I))
"RTN","ORCDPS1",188,0)
 G:'$D(ORX) QTYQ ;no doses
"RTN","ORCDPS1",189,0)
 S ORX("PATIENT")=+$G(ORVP),ORX("DRUG")=+$G(ORDRUG)
"RTN","ORCDPS1",190,0)
 S ORX("DAYS SUPPLY")=+$G(ORDSUP)
"RTN","ORCDPS1",191,0)
 D QTYX^PSOSIG(.ORX) S Y=$G(ORX("QTY"))
"RTN","ORCDPS1",192,0)
QTYQ Q Y
"RTN","ORCDPS1",193,0)
 ;
"RTN","ORCDPS1",194,0)
MAXREFS ; -- Get max refills allowed [Entry Action]
"RTN","ORCDPS1",195,0)
 Q:$G(ORCAT)'="O"  N ORX,X
"RTN","ORCDPS1",196,0)
 S ORX("ITEM")=+$P($G(^ORD(101.43,+$G(OROI),0)),U,2)
"RTN","ORCDPS1",197,0)
 S ORX("DRUG")=+$G(ORDRUG),ORX("PATIENT")=+$G(ORVP)
"RTN","ORCDPS1",198,0)
 I $G(OREVENT),$$TYPE^OREVNTX(OREVENT)="D" S ORX("DISCHARGE")=1
"RTN","ORCDPS1",199,0)
 S ORX("DAYS SUPPLY")=$G(ORDSUP) D MAX^PSOSIGDS(.ORX)
"RTN","ORCDPS1",200,0)
 S OREFILLS=$G(ORX("MAX")),X=$G(ORDIALOG(PROMPT,INST))
"RTN","ORCDPS1",201,0)
 I OREFILLS'>0 S ORDIALOG(PROMPT,INST)=0 W !,"No refills allowed." Q
"RTN","ORCDPS1",202,0)
 S $P(ORDIALOG(PROMPT,0),U,2)="0:"_OREFILLS
"RTN","ORCDPS1",203,0)
 S ORDIALOG(PROMPT,"A")="Refills (0-"_OREFILLS_"): "
"RTN","ORCDPS1",204,0)
 I X,X>OREFILLS S ORDIALOG(PROMPT,INST)=OREFILLS
"RTN","ORCDPS1",205,0)
 Q
"RTN","ORCDPS1",206,0)
 ;
"RTN","ORCDPS1",207,0)
ASKSC() ; -- Return 1 or 0, if SC prompt should be asked
"RTN","ORCDPS1",208,0)
 I $$SC^PSOCP(+ORVP,+$G(ORDRUG)) Q 0
"RTN","ORCDPS1",209,0)
 ;I $$RXST^IBARXEU(+ORVP)>0 Q 0 ;exempt from copay
"RTN","ORCDPS1",210,0)
 Q 1
"RTN","ORCDPS1",211,0)
 ;
"RTN","ORCDPS1",212,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORCDPS1",213,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORCDPS1",214,0)
 ;
"RTN","ORCDPS1",215,0)
EXIT ; -- exit action for Meds
"RTN","ORCDPS1",216,0)
 S:$G(ORXNP) ORNP=ORXNP
"RTN","ORCDPS1",217,0)
 K ORXNP,ORINPT,ORCAT,ORPKG,OROI,ORIV,ORDRUG,ORDOSE,OROUTE,ORSCH,ORSD,ORDSUP,OREFILLS,ORQTY,ORQTYUNT,ORCOPAY,PSJNOPC,ORCOMPLX
"RTN","ORCDPS1",218,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",219,0)
 Q
"RTN","ORINQIV")
0^1^B231323971
"RTN","ORINQIV",1,0)
ORINQIV ; SLC/AGP - Utility report for Order Dialogs ; 12/6/10
"RTN","ORINQIV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**301,296,337**;DEC 17, 1997;Build 84
"RTN","ORINQIV",3,0)
 ;
"RTN","ORINQIV",4,0)
 ; DBIA 5133: reading ^PXRMD file #801.41
"RTN","ORINQIV",5,0)
 ; 
"RTN","ORINQIV",6,0)
 Q
"RTN","ORINQIV",7,0)
 ;
"RTN","ORINQIV",8,0)
ASK(PROMPT,QUEST,HELP,DEFAULT) ;
"RTN","ORINQIV",9,0)
 N DIR,STR,Y
"RTN","ORINQIV",10,0)
 S STR=QUEST_";K:SKIP THIS QUICK ORDER;Q:QUIT THE CONVERSION UTILITY"
"RTN","ORINQIV",11,0)
 S DIR("A")=PROMPT
"RTN","ORINQIV",12,0)
 I DEFAULT'="" S DIR("B")=DEFAULT
"RTN","ORINQIV",13,0)
 S DIR(0)="S^"_STR
"RTN","ORINQIV",14,0)
 S DIR("??")="^D HELP^ORINQIV("_HELP_")"
"RTN","ORINQIV",15,0)
 D ^DIR
"RTN","ORINQIV",16,0)
 Q Y
"RTN","ORINQIV",17,0)
 ;
"RTN","ORINQIV",18,0)
AWRITE(REF) ;Write all the descendants of the array reference.
"RTN","ORINQIV",19,0)
 ;REF is the starting array reference, for example A or ^TMP("OR",$J).
"RTN","ORINQIV",20,0)
 N DONE,IND,LEN,PROOT,ROOT,START,TEMP
"RTN","ORINQIV",21,0)
 I REF="" Q
"RTN","ORINQIV",22,0)
 S PROOT=$P(REF,")",1)
"RTN","ORINQIV",23,0)
 ;Build the root so we can tell when we are done.
"RTN","ORINQIV",24,0)
 S TEMP=$NA(@REF)
"RTN","ORINQIV",25,0)
 S ROOT=$P(TEMP,")",1)
"RTN","ORINQIV",26,0)
 S REF=$Q(@REF)
"RTN","ORINQIV",27,0)
 I REF'[ROOT Q
"RTN","ORINQIV",28,0)
 S DONE=0
"RTN","ORINQIV",29,0)
 F  Q:(REF="")!(DONE)  D
"RTN","ORINQIV",30,0)
 . S START=$F(REF,ROOT)
"RTN","ORINQIV",31,0)
 . S LEN=$L(REF)
"RTN","ORINQIV",32,0)
 . S IND=$E(REF,START,LEN)
"RTN","ORINQIV",33,0)
 . W !,PROOT_IND,"=",@REF
"RTN","ORINQIV",34,0)
 . S REF=$Q(@REF)
"RTN","ORINQIV",35,0)
 . I REF'[ROOT S DONE=1
"RTN","ORINQIV",36,0)
 Q
"RTN","ORINQIV",37,0)
 ;
"RTN","ORINQIV",38,0)
BLDMSG(ARRAY) ;
"RTN","ORINQIV",39,0)
 N CNT,LC,NAME,PQO,SPACE,SUCCESS,TEMP,TEXT,USER,XMSUB,Y
"RTN","ORINQIV",40,0)
 W !
"RTN","ORINQIV",41,0)
 S CNT=1,TEXT(CNT)="Below is a list of personal QO that can be converted to the Infusion format."
"RTN","ORINQIV",42,0)
 S CNT=CNT+1,TEXT(CNT)="These items should not be converted unless the quick order is remove from"
"RTN","ORINQIV",43,0)
 S CNT=CNT+1,TEXT(CNT)="the user personal quick order menu."
"RTN","ORINQIV",44,0)
 S NAME="" F  S NAME=$O(ARRAY(NAME)) Q:NAME=""  D
"RTN","ORINQIV",45,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",46,0)
 .S CNT=CNT+1,TEXT(CNT)=NAME,CNT=CNT+1,TEXT(CNT)="_"
"RTN","ORINQIV",47,0)
 .F SPACE=1:1:78 S TEXT(CNT)=TEXT(CNT)_"_"
"RTN","ORINQIV",48,0)
 .S PQO="" F  S PQO=$O(ARRAY(NAME,PQO)) Q:PQO=""  D
"RTN","ORINQIV",49,0)
 ..S CNT=CNT+1,TEXT(CNT)=$G(ARRAY(NAME,PQO))
"RTN","ORINQIV",50,0)
 S CNT=0 F  S CNT=$O(TEXT(CNT)) Q:CNT'>0  W !,TEXT(CNT)
"RTN","ORINQIV",51,0)
 ;
"RTN","ORINQIV",52,0)
 S DIR(0)="Y"
"RTN","ORINQIV",53,0)
 S DIR("A")="Send this information in a mailman message"
"RTN","ORINQIV",54,0)
 D ^DIR
"RTN","ORINQIV",55,0)
 I Y'=1 Q
"RTN","ORINQIV",56,0)
 S XMSUB="List of personal QO that can be converted to Infusion format"
"RTN","ORINQIV",57,0)
 S TEMP=$$SUBCHK^XMGAPI0(XMSUB,0)
"RTN","ORINQIV",58,0)
 I $P(TEMP,U)'="" S XMSUB=$E(XMSUB,1,65)
"RTN","ORINQIV",59,0)
RETRY ;
"RTN","ORINQIV",60,0)
 D XMZ^XMA2
"RTN","ORINQIV",61,0)
 I XMZ<1 G RETRY
"RTN","ORINQIV",62,0)
 S SUCCESS("XMZ")=XMZ
"RTN","ORINQIV",63,0)
 S SUCCESS("SUB")=XMSUB
"RTN","ORINQIV",64,0)
 S CNT=0,LC=0 F  S CNT=$O(TEXT(CNT)) Q:CNT'>0  D
"RTN","ORINQIV",65,0)
 .S LC=LC+1,^XMB(3.9,XMZ,2,LC,0)=TEXT(CNT)
"RTN","ORINQIV",66,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92^"_LC_"^"_LC_"^"_DT
"RTN","ORINQIV",67,0)
 ;S $P(^XMB(3.9,XMZ,0),U,12)="Y"
"RTN","ORINQIV",68,0)
 D ENT2^XMD
"RTN","ORINQIV",69,0)
 Q
"RTN","ORINQIV",70,0)
 ;
"RTN","ORINQIV",71,0)
EDIT(IEN,PERQOAR) ;
"RTN","ORINQIV",72,0)
 N ASKADD,CNT,CONF,DA,DIE,DIK,DR,DRPSIVDG,DUR,EXIT,ERR,ERROR,FDA,FDAIEN
"RTN","ORINQIV",73,0)
 N IVTYPE,LOC,NAME,NODE,OUTPUT,PSIVDG,PSNODE,TERMIN,USER
"RTN","ORINQIV",74,0)
 S EXIT=0,ERROR=0
"RTN","ORINQIV",75,0)
 N OI,OINAME,PTR,UPDADD,UPDDSG
"RTN","ORINQIV",76,0)
 S USER=$$ISPERQO(IEN) I USER>0 D  Q EXIT
"RTN","ORINQIV",77,0)
 .S NODE=$G(^ORD(101.41,IEN,0))
"RTN","ORINQIV",78,0)
 .D GETS^DIQ(200,USER_",",".01;9.2","EI","OUTPUT","ERR")
"RTN","ORINQIV",79,0)
 .I $D(ERR) D AWRITE(ERR) Q
"RTN","ORINQIV",80,0)
 .S TERMIN=$G(OUTPUT(200,USER_",",9.2,"I"))
"RTN","ORINQIV",81,0)
 .I TERMIN>0,TERMIN<DT Q
"RTN","ORINQIV",82,0)
 .S PERQOAR(OUTPUT(200,USER_",",.01,"E"),$P(NODE,U))=$P(NODE,U,2)
"RTN","ORINQIV",83,0)
 K ^TMP($J,"OR DESC")
"RTN","ORINQIV",84,0)
 S UPDDSG="N",UPDADD="N"
"RTN","ORINQIV",85,0)
 S OI=$$GETOI(IEN) I OI="" Q 0
"RTN","ORINQIV",86,0)
 S OINAME=$P($G(^ORD(101.43,OI,0)),U) I OINAME="" Q 0
"RTN","ORINQIV",87,0)
 S PSNODE=$G(^ORD(101.43,OI,"PS"))
"RTN","ORINQIV",88,0)
 S ASKADD=$S($P(PSNODE,U,4)=1:1,1:0)
"RTN","ORINQIV",89,0)
 S DA=IEN
"RTN","ORINQIV",90,0)
 D EN^ORORDDSC(IEN,"OR DESC")
"RTN","ORINQIV",91,0)
 S CNT=0 F  S CNT=$O(^TMP($J,"OR DESC",IEN,CNT)) Q:CNT'>0  D
"RTN","ORINQIV",92,0)
 .W !,^TMP($J,"OR DESC",IEN,CNT)
"RTN","ORINQIV",93,0)
 ;
"RTN","ORINQIV",94,0)
CONVERT ;
"RTN","ORINQIV",95,0)
 W !!,"Convert the above Quick Order to an Infusion Quick Order?"
"RTN","ORINQIV",96,0)
 S UPDDSG=$$ASK("Convert?","Y:YES;N:NO",1,"")
"RTN","ORINQIV",97,0)
 I UPDDSG="Q"!(UPDDSG=U)!(UPDDSG="^^") S EXIT=1 G EDITX
"RTN","ORINQIV",98,0)
 I UPDDSG'="Y" G EDITX
"RTN","ORINQIV",99,0)
IVTYPE ;
"RTN","ORINQIV",100,0)
 W !!,"Select the IV Type for this Quick Order."
"RTN","ORINQIV",101,0)
 S IVTYPE=$$ASK("IV TYPE","C:CONTINUOUS;I:INTERMITTENT",2,"")
"RTN","ORINQIV",102,0)
 I IVTYPE=U G CONVERT
"RTN","ORINQIV",103,0)
 I IVTYPE="^^"!(IVTYPE="Q") S EXIT=1 G EDITX
"RTN","ORINQIV",104,0)
 I IVTYPE="K" G EDITX
"RTN","ORINQIV",105,0)
 ;
"RTN","ORINQIV",106,0)
ADDIT ;
"RTN","ORINQIV",107,0)
 I ASKADD=1 D
"RTN","ORINQIV",108,0)
 .I $P(PSNODE,U,3)=0 D  Q
"RTN","ORINQIV",109,0)
 ..S UPDADD="Y"
"RTN","ORINQIV",110,0)
 ..W !,"Orderable item "_OINAME_"  is not marked as a solution."
"RTN","ORINQIV",111,0)
 ..W !,"This orderable item will be moved to the additive value."
"RTN","ORINQIV",112,0)
 .W !!,"Change orderable item "_OINAME_" to an additive?"
"RTN","ORINQIV",113,0)
 .S UPDADD=$$ASK("Convert to Additive?","Y:YES;N:NO",3,"")
"RTN","ORINQIV",114,0)
 .I UPDADD=U G IVTYPE
"RTN","ORINQIV",115,0)
 .I UPDADD="^^"!(UPDADD="Q") S EXIT=1 G EDITX
"RTN","ORINQIV",116,0)
 .I UPDADD="K" G EDITX
"RTN","ORINQIV",117,0)
 ;
"RTN","ORINQIV",118,0)
CONFIRM ;
"RTN","ORINQIV",119,0)
 W !!,"Please confirm the selected changes below."
"RTN","ORINQIV",120,0)
 W !,"If these changes are accepted, the Quick Order will be converted to an"
"RTN","ORINQIV",121,0)
 W !,"Infusion Quick Order. This Quick Order will not be able to be converted back to"
"RTN","ORINQIV",122,0)
 W !,"an Inpatient Quick Order."
"RTN","ORINQIV",123,0)
 W !!,"Convert to Infusion Quick Order: YES"
"RTN","ORINQIV",124,0)
 W !,"IV TYPE: "_$S(IVTYPE="I":"Intermittent",1:"Continuous")
"RTN","ORINQIV",125,0)
 I UPDADD="Y" W !,"Change orderable item "_OINAME_" to an additive: YES"
"RTN","ORINQIV",126,0)
 S CONF=$$ASK("Confirm Changes?","Y:YES;N:NO",4,"")
"RTN","ORINQIV",127,0)
 I CONF=U G:ASKADD=1 ADDIT I ASKADD=0 G IVTYPE
"RTN","ORINQIV",128,0)
 I CONF="^^"!(CONF="Q") S EXIT=1 G EDITX
"RTN","ORINQIV",129,0)
 I CONF="K"!(CONF="N") G EDITX
"RTN","ORINQIV",130,0)
 ;
"RTN","ORINQIV",131,0)
UPDATES ;Do updates
"RTN","ORINQIV",132,0)
 W !
"RTN","ORINQIV",133,0)
 S DIE="^ORD(101.41,"
"RTN","ORINQIV",134,0)
 S PSIVDG=$O(^ORD(100.98,"B","IV MEDICATIONS","")) Q:PSIVDG'>0
"RTN","ORINQIV",135,0)
 S DR="5///^S X=PSIVDG"
"RTN","ORINQIV",136,0)
 D ^DIE
"RTN","ORINQIV",137,0)
 S PTR=$$PTR^ORMBLDPS("IV TYPE") Q:PTR'>0
"RTN","ORINQIV",138,0)
 S IENS="?+3,"_IEN_","
"RTN","ORINQIV",139,0)
 S FDA(101.416,IENS,.01)=35
"RTN","ORINQIV",140,0)
 S FDA(101.416,IENS,.02)=PTR
"RTN","ORINQIV",141,0)
 S FDA(101.416,IENS,.03)=1
"RTN","ORINQIV",142,0)
 S FDA(101.416,IENS,1)=IVTYPE
"RTN","ORINQIV",143,0)
 D UPDATE^DIE("","FDA","FDAIEN","ERR")
"RTN","ORINQIV",144,0)
 I $D(ERR) D AWRITE("ERR") S ERROR=1
"RTN","ORINQIV",145,0)
 I UPDADD="Y" D
"RTN","ORINQIV",146,0)
 .S PTR=$$PTR^ORMBLDPS("ADDITIVE") Q:PTR'>0
"RTN","ORINQIV",147,0)
 .N FDA,IENS
"RTN","ORINQIV",148,0)
 .S IENS="?+2,"_IEN_","
"RTN","ORINQIV",149,0)
 .S FDA(101.416,IENS,.01)=30
"RTN","ORINQIV",150,0)
 .S FDA(101.416,IENS,.02)=PTR
"RTN","ORINQIV",151,0)
 .S FDA(101.416,IENS,.03)=1
"RTN","ORINQIV",152,0)
 .S FDA(101.416,IENS,1)=OI
"RTN","ORINQIV",153,0)
 .D UPDATE^DIE("","FDA","FDAIEN","ERR")
"RTN","ORINQIV",154,0)
 .I $D(ERR) D AWRITE("ERR") S ERROR=1
"RTN","ORINQIV",155,0)
 .I '$D(ERR) W !!,"**CHECK THE STRENGTH ASSOCIATED WITH THE ADDITIVE VALUE IN THE EDITOR." H 1
"RTN","ORINQIV",156,0)
 .S PTR=$$PTR^ORMBLDPS("ORDERABLE ITEM") Q:PTR'>0
"RTN","ORINQIV",157,0)
 .S LOC=$O(^ORD(101.41,IEN,6,"D",PTR,"")) Q:LOC'>0
"RTN","ORINQIV",158,0)
 .S DA(1)=IEN,DA=LOC
"RTN","ORINQIV",159,0)
 .S DIK="^ORD(101.41,"_DA(1)_",6," D ^DIK
"RTN","ORINQIV",160,0)
 ;Check for duration
"RTN","ORINQIV",161,0)
 I IVTYPE="C" D
"RTN","ORINQIV",162,0)
 .S PTR=$$PTR^ORMBLDPS("SCHEDULE") Q:PTR'>0
"RTN","ORINQIV",163,0)
 .S LOC=$O(^ORD(101.41,IEN,6,"D",PTR,"")) Q:LOC'>0
"RTN","ORINQIV",164,0)
 .S DA(1)=IEN,DA=LOC
"RTN","ORINQIV",165,0)
 .S DIK="^ORD(101.41,"_DA(1)_",6," D ^DIK
"RTN","ORINQIV",166,0)
 S DUR=$$PTR^ORMBLDPS("DURATION")
"RTN","ORINQIV",167,0)
 I DUR>0,$D(^ORD(101.41,IEN,6,"D",DUR))>0 D
"RTN","ORINQIV",168,0)
 .W !!,"**CHECK THE LIMITATION VALUE ASSIGNED TO THE QUICK ORDER IN THE EDITOR." H 1
"RTN","ORINQIV",169,0)
 I ERROR=1 W !,"Due to the errors in conversion please valiate the quick order in the editor."
"RTN","ORINQIV",170,0)
 ;
"RTN","ORINQIV",171,0)
 ;Call the QO editor
"RTN","ORINQIV",172,0)
 W !
"RTN","ORINQIV",173,0)
 D QCK0^ORCMEDT1(IEN)
"RTN","ORINQIV",174,0)
EDITX ;
"RTN","ORINQIV",175,0)
 K ^TMP($J,"OR DESC")
"RTN","ORINQIV",176,0)
 Q EXIT
"RTN","ORINQIV",177,0)
 ;
"RTN","ORINQIV",178,0)
EN ;
"RTN","ORINQIV",179,0)
 K ^TMP($J,"OR REMMDLG")
"RTN","ORINQIV",180,0)
 N DIR,DSGPAR,DSGRP,EXIT,NANSC,ODIEN,PERQOAR,QOIEN,Y
"RTN","ORINQIV",181,0)
 ;
"RTN","ORINQIV",182,0)
 D HELP(6)
"RTN","ORINQIV",183,0)
 ;Build a list of Display Groups that contains the default dialog of
"RTN","ORINQIV",184,0)
 ;PSJ OR PAT OE
"RTN","ORINQIV",185,0)
 S ODIEN=$O(^ORD(101.41,"AB","PSJ OR PAT OE","")) Q:ODIEN=""
"RTN","ORINQIV",186,0)
 S DSGRP=0 F  S DSGRP=$O(^ORD(100.98,DSGRP)) Q:DSGRP'>0  D
"RTN","ORINQIV",187,0)
 .I $P(^ORD(100.98,DSGRP,0),U,4)=ODIEN S DSGPAR(DSGRP)=""
"RTN","ORINQIV",188,0)
 ;
"RTN","ORINQIV",189,0)
 S DIR(0)="S^A:QO ASSIGNED TO ORDER MENUS, ORDER SETS, OR REMINDER DIALOGS;N:QO NOT ASSIGNED TO ANY OF THESE ITEMS;S:SPECIFIC QUICK ORDER;Q:QUIT THE CONVERSION UTILITY"
"RTN","ORINQIV",190,0)
 S DIR("A")="Which QO to convert?"
"RTN","ORINQIV",191,0)
 S DIR("??")="^D HELP^ORINQIV(5)"
"RTN","ORINQIV",192,0)
 D ^DIR
"RTN","ORINQIV",193,0)
 I Y=U!(Y="^^")!(Y="Q") Q
"RTN","ORINQIV",194,0)
 I Y="S" D IND^ORINQIV(.DSGPAR) Q
"RTN","ORINQIV",195,0)
 S NANSC=Y
"RTN","ORINQIV",196,0)
 I NANSC="A" D FQOIRDLG
"RTN","ORINQIV",197,0)
 ;
"RTN","ORINQIV",198,0)
 S OIIEN=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM","")) Q:OIIEN'>0
"RTN","ORINQIV",199,0)
 S EXIT=0
"RTN","ORINQIV",200,0)
 S QOIEN=0 F  S QOIEN=$O(^ORD(101.41,QOIEN)) Q:QOIEN'>0!(EXIT=1)  D
"RTN","ORINQIV",201,0)
 .I $$ISVALID(QOIEN,NANSC,.DSGPAR)=0 Q
"RTN","ORINQIV",202,0)
 .S EXIT=$$EDIT(QOIEN,.PERQOAR)
"RTN","ORINQIV",203,0)
UTLEXIT ;
"RTN","ORINQIV",204,0)
 I $D(PERQOAR) D BLDMSG(.PERQOAR)
"RTN","ORINQIV",205,0)
 K ^TMP($J,"OR REMDLG")
"RTN","ORINQIV",206,0)
 Q
"RTN","ORINQIV",207,0)
 ;
"RTN","ORINQIV",208,0)
GETOI(IEN) ;
"RTN","ORINQIV",209,0)
 N OIIEN,OROI,POS
"RTN","ORINQIV",210,0)
 N OIIEN,OROI,POS
"RTN","ORINQIV",211,0)
 S OIIEN=$O(^ORD(101.41,"B","OR GTX ORDERABLE ITEM","")) Q:OIIEN'>0 ""
"RTN","ORINQIV",212,0)
 S POS=$O(^ORD(101.41,IEN,6,"D",OIIEN,"")) Q:POS'>0 ""
"RTN","ORINQIV",213,0)
 S OROI=+$G(^ORD(101.41,IEN,6,POS,1)) Q:OROI'>0 ""
"RTN","ORINQIV",214,0)
 Q OROI
"RTN","ORINQIV",215,0)
 ;
"RTN","ORINQIV",216,0)
FQOIRDLG ;
"RTN","ORINQIV",217,0)
 N AFIND,DIEN,PTEXT,TYPE
"RTN","ORINQIV",218,0)
 F TYPE="G","E" S DIEN="" D
"RTN","ORINQIV",219,0)
 . F  S DIEN=$O(^PXRMD(801.41,"TYPE",TYPE,DIEN)) Q:DIEN'>0  D  ;DBIA 5133
"RTN","ORINQIV",220,0)
 .. ; PTEXT is 'FINDING ITEM' where 101.41 refers to ^ORD(101.41)
"RTN","ORINQIV",221,0)
 .. S PTEXT=$P($G(^PXRMD(801.41,DIEN,1)),U,5),AFIND=""
"RTN","ORINQIV",222,0)
 .. I PTEXT[101.41 S ^TMP($J,"OR REMDLG",$P(PTEXT,";"))=DIEN
"RTN","ORINQIV",223,0)
 .. F  S AFIND=$O(^PXRMD(801.41,DIEN,3,"B",AFIND)) Q:AFIND=""  D
"RTN","ORINQIV",224,0)
 ... I AFIND[101.41 S ^TMP($J,"OR REMDLG",$P(AFIND,";"))=DIEN
"RTN","ORINQIV",225,0)
 Q
"RTN","ORINQIV",226,0)
 ;
"RTN","ORINQIV",227,0)
IND(DSGPAR) ;
"RTN","ORINQIV",228,0)
 N DIC,DIR,EXIT,PERQOAR
"RTN","ORINQIV",229,0)
 S DIC="^ORD(101.41,",DIC(0)="AEMQZ"
"RTN","ORINQIV",230,0)
 S DIC("S")="I $$ISVALID^ORINQIV(Y,""S"",.DSGPAR)=1"
"RTN","ORINQIV",231,0)
 D ^DIC
"RTN","ORINQIV",232,0)
 I +$P(Y,U)'>0 Q
"RTN","ORINQIV",233,0)
 S EXIT=$$EDIT($P(Y,U),.PERQOAR)
"RTN","ORINQIV",234,0)
 I EXIT=1 Q
"RTN","ORINQIV",235,0)
 W !
"RTN","ORINQIV",236,0)
 S DIR(0)="Y"
"RTN","ORINQIV",237,0)
 S DIR("A")="Convert another Quick Order?"
"RTN","ORINQIV",238,0)
 D ^DIR
"RTN","ORINQIV",239,0)
 I Y=1 D IND(.DSGPAR)
"RTN","ORINQIV",240,0)
 I $D(PERQOAR) D BLDMSG(.PERQOAR)
"RTN","ORINQIV",241,0)
 Q
"RTN","ORINQIV",242,0)
 ;
"RTN","ORINQIV",243,0)
ISCONT(IEN) ;
"RTN","ORINQIV",244,0)
 ;This is use to determine if the Entry from file 101.41 is used in an
"RTN","ORINQIV",245,0)
 ;another entry from file 101.41 or in a reminder dialog.
"RTN","ORINQIV",246,0)
 I $O(^ORD(101.41,"AD",IEN,0)) Q 1
"RTN","ORINQIV",247,0)
 I $D(^TMP($J,"OR REMDLG",IEN))>0 Q 1
"RTN","ORINQIV",248,0)
 Q 0
"RTN","ORINQIV",249,0)
 ;
"RTN","ORINQIV",250,0)
ISIV(IEN) ;
"RTN","ORINQIV",251,0)
 ;This is use to determine if orderable item is marked as a solution or
"RTN","ORINQIV",252,0)
 ;an additive
"RTN","ORINQIV",253,0)
 N PSNODE
"RTN","ORINQIV",254,0)
 S PSNODE=$G(^ORD(101.43,IEN,"PS"))
"RTN","ORINQIV",255,0)
 I $P(PSNODE,U,3)=1 Q 1
"RTN","ORINQIV",256,0)
 I $P(PSNODE,U,4)=1 Q 1
"RTN","ORINQIV",257,0)
 Q 0
"RTN","ORINQIV",258,0)
 ;
"RTN","ORINQIV",259,0)
ISPERQO(IEN) ;
"RTN","ORINQIV",260,0)
 N NUM,RESULT,USER
"RTN","ORINQIV",261,0)
 I $D(^ORD(101.44,"C",IEN)) D  Q RESULT
"RTN","ORINQIV",262,0)
 .S NUM=$O(^ORD(101.44,"C",IEN,"")) Q:NUM'>0
"RTN","ORINQIV",263,0)
 .S USER=$P($G(^ORD(101.44,NUM,0)),U)
"RTN","ORINQIV",264,0)
 .S USER=$P(USER,"USR",2)
"RTN","ORINQIV",265,0)
 .S RESULT=+$P(USER," ")
"RTN","ORINQIV",266,0)
 Q 0
"RTN","ORINQIV",267,0)
 ;
"RTN","ORINQIV",268,0)
ISVALID(IEN,NANSC,DSGPAR) ;
"RTN","ORINQIV",269,0)
 N CONT,NODE,QODSG,PSNODE,RESULT
"RTN","ORINQIV",270,0)
 S NODE=$G(^ORD(101.41,IEN,0))
"RTN","ORINQIV",271,0)
 ;Quit if not a quick order
"RTN","ORINQIV",272,0)
 I $P(NODE,U,4)'="Q" Q 0
"RTN","ORINQIV",273,0)
 ;Disregard order dialog entry does not contain a valid display group
"RTN","ORINQIV",274,0)
 S QODSG=$P(NODE,U,5) I QODSG="" Q 1
"RTN","ORINQIV",275,0)
 I '$D(DSGPAR(QODSG)) Q 0
"RTN","ORINQIV",276,0)
 ;
"RTN","ORINQIV",277,0)
 S CONT=$S($O(^ORD(101.41,"AD",IEN,0)):1,$D(^TMP($J,"OR REMDLG",IEN)):1,1:0)
"RTN","ORINQIV",278,0)
 ;
"RTN","ORINQIV",279,0)
 ;S CONT=$$ISCONT(IEN)
"RTN","ORINQIV",280,0)
 I NANSC="A",CONT=0 Q 0
"RTN","ORINQIV",281,0)
 I NANSC="N",CONT=1 Q 0
"RTN","ORINQIV",282,0)
 S OROI=$$GETOI(IEN) I OROI="" Q 0
"RTN","ORINQIV",283,0)
 S PSNODE=$G(^ORD(101.43,OROI,"PS"))
"RTN","ORINQIV",284,0)
 I $P(PSNODE,U,3)=1 Q 1
"RTN","ORINQIV",285,0)
 I $P(PSNODE,U,4)=1 Q 1
"RTN","ORINQIV",286,0)
 Q 0
"RTN","ORINQIV",287,0)
 ;
"RTN","ORINQIV",288,0)
HELP(NUM) ;
"RTN","ORINQIV",289,0)
 N CNT,TAB,TEXT
"RTN","ORINQIV",290,0)
 S CNT=0,TAB="     "
"RTN","ORINQIV",291,0)
 I NUM=1 D
"RTN","ORINQIV",292,0)
 .S CNT=CNT+1,TEXT(CNT)="By selecting YES this quick order will be converted to a Infusion QO."
"RTN","ORINQIV",293,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",294,0)
 .S CNT=CNT+1,TEXT(CNT)="This quick order will not be able to be converted back to a unit dose quick"
"RTN","ORINQIV",295,0)
 .S CNT=CNT+1,TEXT(CNT)="order. However, you can edit the specific fields of the Infusion quick order in the"
"RTN","ORINQIV",296,0)
 .S CNT=CNT+1,TEXT(CNT)="quick order editor."
"RTN","ORINQIV",297,0)
 I NUM=2 D
"RTN","ORINQIV",298,0)
 .S CNT=CNT+1,TEXT(CNT)="This value defines the type of Infusion quick order that is being setup."
"RTN","ORINQIV",299,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",300,0)
 .S CNT=CNT+1,TEXT(CNT)=TAB_"Select INTERMITTENT to set-up a quick order that should be administered at"
"RTN","ORINQIV",301,0)
 .S CNT=CNT+1,TEXT(CNT)=TAB_"scheduled intervals (Q4H, QDay) or One-Time only, ""over a specified time"
"RTN","ORINQIV",302,0)
 .S CNT=CNT+1,TEXT(CNT)=TAB_"period"" (e.g. ""Infuse over 30 min."")."
"RTN","ORINQIV",303,0)
 .S CNT=CNT+1,TEXT(CNT)=TAB_TAB_"An example is an a IVP/IVPB order."
"RTN","ORINQIV",304,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",305,0)
 .S CNT=CNT+1,TEXT(CNT)=TAB_"Select CONTINUOUS to set-up a quick order that run at a specified ""Rate"""
"RTN","ORINQIV",306,0)
 .S CNT=CNT+1,TEXT(CNT)=TAB_"(_ml/hr, _mcg/kg/min, etc)"
"RTN","ORINQIV",307,0)
 .S CNT=CNT+1,TEXT(CNT)=TAB_TAB_"An example is an a Infusion/drip quick order."
"RTN","ORINQIV",308,0)
 I NUM=3 D
"RTN","ORINQIV",309,0)
 .S CNT=CNT+1,TEXT(CNT)="Select Yes to switch the orderable item from the solution to the additive value in the quick order."
"RTN","ORINQIV",310,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",311,0)
 .S CNT=CNT+1,TEXT(CNT)="Select No to leave the orderable item as the solution in the quick order."
"RTN","ORINQIV",312,0)
 I NUM=4 D
"RTN","ORINQIV",313,0)
 .S CNT=CNT+1,TEXT(CNT)="Select Yes to convert the quick order to an infusion quick order with the"
"RTN","ORINQIV",314,0)
 .S CNT=CNT+1,TEXT(CNT)="selected change. When the conversion is complete you will be drop into the"
"RTN","ORINQIV",315,0)
 .S CNT=CNT+1,TEXT(CNT)="quick order editor to make any changes to the quick order."
"RTN","ORINQIV",316,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",317,0)
 .S CNT=CNT+1,TEXT(CNT)="Select No to stop the conversion process for this quick order."
"RTN","ORINQIV",318,0)
 I NUM<5 D
"RTN","ORINQIV",319,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",320,0)
 .S CNT=CNT+1,TEXT(CNT)="Select SKIP THIS QUICK ORDER to leave the current quick order as an"
"RTN","ORINQIV",321,0)
 .S CNT=CNT+1,TEXT(CNT)="Inpatient quick order and select another quick order to convert."
"RTN","ORINQIV",322,0)
 I NUM=5 D
"RTN","ORINQIV",323,0)
 .S CNT=CNT+1,TEXT(CNT)="Select QO ASSIGNED TO ORDER MENUS, ORDER SETS, OR REMINDER DIALOGS to convert"
"RTN","ORINQIV",324,0)
 .S CNT=CNT+1,TEXT(CNT)="quick orders that are used in one of the following: Order Menus, Order Sets,"
"RTN","ORINQIV",325,0)
 .S CNT=CNT+1,TEXT(CNT)="or Reminder Dialogs."
"RTN","ORINQIV",326,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",327,0)
 .S CNT=CNT+1,TEXT(CNT)="Select QO NOT ASSIGNED TO ANY OF THESE ITEMS to convert quick orders that are"
"RTN","ORINQIV",328,0)
 .S CNT=CNT+1,TEXT(CNT)="not use in the following: Order Menus, Order Sets, or Reminder Dialogs."
"RTN","ORINQIV",329,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",330,0)
 .S CNT=CNT+1,TEXT(CNT)="Select SPECIFIC QUICK ORDER to convert an individual quick order."
"RTN","ORINQIV",331,0)
 I NUM=6 D
"RTN","ORINQIV",332,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",333,0)
 .S CNT=CNT+1,TEXT(CNT)="This conversion utility enables users to convert IV quick orders set-up as"
"RTN","ORINQIV",334,0)
 .S CNT=CNT+1,TEXT(CNT)="Inpatient quick orders to Infusion quick orders. For each quick order,"
"RTN","ORINQIV",335,0)
 .S CNT=CNT+1,TEXT(CNT)="the conversion utility asks a series of questions to populate the minimum"
"RTN","ORINQIV",336,0)
 .S CNT=CNT+1,TEXT(CNT)="prompts needed to convert the quick order. Once the conversion is"
"RTN","ORINQIV",337,0)
 .S CNT=CNT+1,TEXT(CNT)="done, the user is placed into the Infusion quick order editor to add any"
"RTN","ORINQIV",338,0)
 .S CNT=CNT+1,TEXT(CNT)="values to the additional fields in the Infusion quick order, if needed."
"RTN","ORINQIV",339,0)
 .S CNT=CNT+1,TEXT(CNT)="Possible conflicts at the time of conversion will be displayed before entering"
"RTN","ORINQIV",340,0)
 .S CNT=CNT+1,TEXT(CNT)="the editor. An example of a conflict may be that the user should review the"
"RTN","ORINQIV",341,0)
 .S CNT=CNT+1,TEXT(CNT)="strength associated with the additive in the editor."
"RTN","ORINQIV",342,0)
 I NUM=7 D
"RTN","ORINQIV",343,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",344,0)
 .S CNT=CNT+1,TEXT(CNT)="This conversion utility enables users to edit an existing Continuous IV quick"
"RTN","ORINQIV",345,0)
 .S CNT=CNT+1,TEXT(CNT)="order's Additive Frequency field. This utility will display the additive and the"
"RTN","ORINQIV",346,0)
 .S CNT=CNT+1,TEXT(CNT)="possible additive frequency values. The default value for the additive"
"RTN","ORINQIV",347,0)
 .S CNT=CNT+1,TEXT(CNT)="frequency prompt is loaded from the pharmacy package."
"RTN","ORINQIV",348,0)
 I NUM=8 D
"RTN","ORINQIV",349,0)
 .S CNT=CNT+1,TEXT(CNT)="Select YES add Additive Frequency values to the quick order"
"RTN","ORINQIV",350,0)
 I NUM=9 D
"RTN","ORINQIV",351,0)
 .S CNT=CNT+1,TEXT(CNT)="The default value for this prompt is provided from "
"RTN","ORINQIV",352,0)
 .S CNT=CNT+1,TEXT(CNT)="the pharmacy package. However, you can select one of the three"
"RTN","ORINQIV",353,0)
 .S CNT=CNT+1,TEXT(CNT)="possible values for an additive frequency"
"RTN","ORINQIV",354,0)
 I NUM=10 D
"RTN","ORINQIV",355,0)
 .S CNT=CNT+1,TEXT(CNT)="Select Yes to update the quick order with the additive frequency values."
"RTN","ORINQIV",356,0)
 .S CNT=CNT+1,TEXT(CNT)="When the update is complete you will be drop into the"
"RTN","ORINQIV",357,0)
 .S CNT=CNT+1,TEXT(CNT)="quick order editor to make any changes to the quick order."
"RTN","ORINQIV",358,0)
 .S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",359,0)
 .S CNT=CNT+1,TEXT(CNT)="Select No to stop the conversion process for this quick order."
"RTN","ORINQIV",360,0)
 S CNT=CNT+1,TEXT(CNT)=" "
"RTN","ORINQIV",361,0)
 I NUM<6!(NUM>7) S CNT=CNT+1,TEXT(CNT)="Select QUIT THE CONVERSION UTILITY to exit this utility."
"RTN","ORINQIV",362,0)
 S CNT=0 F  S CNT=$O(TEXT(CNT)) Q:CNT'>0  W !,TEXT(CNT)
"RTN","ORINQIV",363,0)
 Q
"RTN","ORINQIV",364,0)
 ;
"VER")
8.0^22.0
**END**
**END**
