KIDS Distribution saved on Dec 08, 2010@10:20:11
Patch PSJ*5*235 and OR*3*333
**KIDS**:PSJ*5.0*235^OR*3.0*333^

**INSTALL NAME**
PSJ*5.0*235
"BLD",8316,0)
PSJ*5.0*235^INPATIENT MEDICATIONS^0^3101208^y
"BLD",8316,1,0)
^^6^6^3100603^
"BLD",8316,1,1,0)
 HD0000000349678 - PSPO#1521 QOD (every other day) schedule not working
"BLD",8316,1,2,0)
 (d)HD000000350458 - 1 Problem with start time of order
"BLD",8316,1,3,0)
 
"BLD",8316,1,4,0)
 This patch will correct an issue in which the Expected First Dose line 
"BLD",8316,1,5,0)
 in CPRS, as well as the REQUESTED START DATE line in inpatient order 
"BLD",8316,1,6,0)
 entry were not displaying the correct date.
"BLD",8316,4,0)
^9.64PA^^
"BLD",8316,6.3)
4
"BLD",8316,"ABPKG")
n
"BLD",8316,"KRN",0)
^9.67PA^779.2^20
"BLD",8316,"KRN",.4,0)
.4
"BLD",8316,"KRN",.401,0)
.401
"BLD",8316,"KRN",.402,0)
.402
"BLD",8316,"KRN",.403,0)
.403
"BLD",8316,"KRN",.5,0)
.5
"BLD",8316,"KRN",.84,0)
.84
"BLD",8316,"KRN",3.6,0)
3.6
"BLD",8316,"KRN",3.8,0)
3.8
"BLD",8316,"KRN",9.2,0)
9.2
"BLD",8316,"KRN",9.8,0)
9.8
"BLD",8316,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8316,"KRN",9.8,"NM",1,0)
PSJORPOE^^0^B37607736
"BLD",8316,"KRN",9.8,"NM","B","PSJORPOE",1)

"BLD",8316,"KRN",19,0)
19
"BLD",8316,"KRN",19.1,0)
19.1
"BLD",8316,"KRN",101,0)
101
"BLD",8316,"KRN",409.61,0)
409.61
"BLD",8316,"KRN",771,0)
771
"BLD",8316,"KRN",779.2,0)
779.2
"BLD",8316,"KRN",870,0)
870
"BLD",8316,"KRN",8989.51,0)
8989.51
"BLD",8316,"KRN",8989.52,0)
8989.52
"BLD",8316,"KRN",8994,0)
8994
"BLD",8316,"KRN","B",.4,.4)

"BLD",8316,"KRN","B",.401,.401)

"BLD",8316,"KRN","B",.402,.402)

"BLD",8316,"KRN","B",.403,.403)

"BLD",8316,"KRN","B",.5,.5)

"BLD",8316,"KRN","B",.84,.84)

"BLD",8316,"KRN","B",3.6,3.6)

"BLD",8316,"KRN","B",3.8,3.8)

"BLD",8316,"KRN","B",9.2,9.2)

"BLD",8316,"KRN","B",9.8,9.8)

"BLD",8316,"KRN","B",19,19)

"BLD",8316,"KRN","B",19.1,19.1)

"BLD",8316,"KRN","B",101,101)

"BLD",8316,"KRN","B",409.61,409.61)

"BLD",8316,"KRN","B",771,771)

"BLD",8316,"KRN","B",779.2,779.2)

"BLD",8316,"KRN","B",870,870)

"BLD",8316,"KRN","B",8989.51,8989.51)

"BLD",8316,"KRN","B",8989.52,8989.52)

"BLD",8316,"KRN","B",8994,8994)

"BLD",8316,"QUES",0)
^9.62^^
"BLD",8316,"REQB",0)
^9.611^1^1
"BLD",8316,"REQB",1,0)
PSJ*5.0*113^2
"BLD",8316,"REQB","B","PSJ*5.0*113",1)

"MBREQ")
0
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,20,0)
^9.402P^^
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
235^3101208^15000040
"PKG",203,22,1,"PAH",1,1,0)
^^6^6^3101208
"PKG",203,22,1,"PAH",1,1,1,0)
 HD0000000349678 - PSPO#1521 QOD (every other day) schedule not working
"PKG",203,22,1,"PAH",1,1,2,0)
 (d)HD000000350458 - 1 Problem with start time of order
"PKG",203,22,1,"PAH",1,1,3,0)
 
"PKG",203,22,1,"PAH",1,1,4,0)
 This patch will correct an issue in which the Expected First Dose line 
"PKG",203,22,1,"PAH",1,1,5,0)
 in CPRS, as well as the REQUESTED START DATE line in inpatient order 
"PKG",203,22,1,"PAH",1,1,6,0)
 entry were not displaying the correct date.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJORPOE")
0^1^B37607736
"RTN","PSJORPOE",1,0)
PSJORPOE ;BIR/MLM,LDT-MISC. PROCEDURE CALLS FOR OE/RR 3.0 ; 6/14/10 12:22pm
"RTN","PSJORPOE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,56,92,80,110,127,133,134,113,235**;16 DEC 97;Build 4
"RTN","PSJORPOE",3,0)
 ;
"RTN","PSJORPOE",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJORPOE",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJORPOE",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJORPOE",7,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJORPOE",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJORPOE",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJORPOE",10,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJORPOE",11,0)
 ;
"RTN","PSJORPOE",12,0)
STARTSTP(PSGP,SCH,OI,PSJPWD,PSGORD,PSJADM,STARTDT) ;*235 add STARTDT
"RTN","PSJORPOE",13,0)
 ; PSGP=Patient IEN
"RTN","PSJORPOE",14,0)
 ; SCH=Schedule
"RTN","PSJORPOE",15,0)
 ; OI=Orderable Item        
"RTN","PSJORPOE",16,0)
 ; PSJPWD=Ward Location (Optional)
"RTN","PSJORPOE",17,0)
 ; PSGORD=Pharmacy Order Number if the order being placed is a Renewal (Optional)
"RTN","PSJORPOE",18,0)
 ; STARTDT=Calculate based on this date (instead of always using now) (Optional)
"RTN","PSJORPOE",19,0)
 ;
"RTN","PSJORPOE",20,0)
 Q:+PSGP'>0 ""
"RTN","PSJORPOE",21,0)
 Q:SCH']"" ""
"RTN","PSJORPOE",22,0)
 Q:+OI'>0 ""
"RTN","PSJORPOE",23,0)
 I SCH?.E1L.E S SCH=$$ENLU^PSGMI(SCH)
"RTN","PSJORPOE",24,0)
 K DFN,PSGNEFDO,PSGNEFD,PSGST,PSGSCH,PSGNEDFD,PSGNESD,PSJSYSW,PSJSYSW0 N RESULT
"RTN","PSJORPOE",25,0)
 S:'$D(PSGS0XT) PSGS0XT="" S:'$D(PSGS0Y) PSGSOY=""
"RTN","PSJORPOE",26,0)
 I $G(PSJPWD)']"" S DFN=PSGP D IN5^VADPT S:VAIP(5)]"" PSJPWD=+VAIP(5)
"RTN","PSJORPOE",27,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD)]"" S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJORPOE",28,0)
 S RESULT=$S($P(PSJSYSW0,"^",5)=0:"CLOSEST",$P(PSJSYSW0,"^",5)=1:"NEXT",1:"NOW")
"RTN","PSJORPOE",29,0)
 I OI]"" S PSGST=$S($P($G(^PS(50.7,OI,0)),"^",7)]"":$P($G(^PS(50.7,OI,0)),"^",7),1:"C")
"RTN","PSJORPOE",30,0)
 ;*235 Use STARTDT if it is sent in, Otherwise default to now.
"RTN","PSJORPOE",31,0)
 N %,PSGXSCH D NOW^%DTC S PSGDT=$S($G(STARTDT):STARTDT,1:%),DFN=PSGP,(PSGSCH,PSGXSCH)=SCH
"RTN","PSJORPOE",32,0)
 S X=PSGSCH,PSGS0Y="" D ADMIN
"RTN","PSJORPOE",33,0)
 I $G(PSGORD)]"" D
"RTN","PSJORPOE",34,0)
 .S PSGNESD=$$DSTART^PSJDCU(PSGP,PSGORD) I PSGNESD]"" S $P(RESULT,"^",2)=PSGNESD Q
"RTN","PSJORPOE",35,0)
 .S ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,2)),1:$G(^PS(55,PSGP,"IV",+PSGORD,0)))
"RTN","PSJORPOE",36,0)
 .N PSJADM,PSJSTRT S PSJADM=$S(PSGORD["U":$P(ND,"^",5),1:$P(ND,"^",11)),PSJSTRT=$P(ND,"^",2),PSJREN=1
"RTN","PSJORPOE",37,0)
 S SCH=PSGXSCH
"RTN","PSJORPOE",38,0)
 ;*235 Remove foced use of NEXT ward param
"RTN","PSJORPOE",39,0)
 ;N PSJTMPW0 S PSJTMPW0=PSJSYSW0 S $P(PSJSYSW0,"^",5)=1
"RTN","PSJORPOE",40,0)
 I $G(PSGNESD)="" S RESULT=RESULT_"^"_$$ENSD^PSGNE3(PSGSCH,$S($G(PSJADM)]"":$G(PSJADM),1:PSGS0Y),PSGDT,$S($G(PSJSTRT)]"":$G(PSJSTRT),1:PSGDT))
"RTN","PSJORPOE",41,0)
 ;S PSJSYSW0=PSJTMPW0
"RTN","PSJORPOE",42,0)
 S PSGNESD=$P(RESULT,"^",2)
"RTN","PSJORPOE",43,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",OI)
"RTN","PSJORPOE",44,0)
 K PSGODF,PSGOES,PSJREN
"RTN","PSJORPOE",45,0)
 S SCH=PSGXSCH
"RTN","PSJORPOE",46,0)
 D ENFD^PSGNE3(PSGDT) S RESULT=RESULT_"^"_$G(PSGNEFD) ;_"^"_$G(PSGNEFDO)
"RTN","PSJORPOE",47,0)
 N DATE S DATE=$$FMDIFF^XLFDT($P(RESULT,"^",3),$P(RESULT,"^",2),3)
"RTN","PSJORPOE",48,0)
 S $P(RESULT,"^",3)=$S($G(PSGST)="O":0,+DATE>0:+DATE_"D",$P($P(DATE," ",2),":")>0:$P($P(DATE," ",2),":")_"H",1:0)
"RTN","PSJORPOE",49,0)
 N STRING S STRING=PSGNESD_U_PSGNEFD_U_$G(PSGSCH)_U_$G(PSGST)_U_$G(OI) I ($P($G(ZZND),U,2)]"")&($P($G(ZZND),"^")=$G(PSGSCH)) S STRING=STRING_U_$P(ZZND,U,2)
"RTN","PSJORPOE",50,0)
 I $G(PSGSCH)]"" I $$DOW^PSIVUTL(PSGSCH) S:$G(PSGS0Y) $P(STRING,"^",6)=PSGS0Y
"RTN","PSJORPOE",51,0)
 I $G(PSJADM) S $P(STRING,"^",6)=PSJADM
"RTN","PSJORPOE",52,0)
 S RESULT=RESULT_"^"_$$ENQ^PSJORP2(PSGP,STRING) I ($G(PSGSCH)]"") I $$DOW^PSIVUTL(PSGSCH),(PSGSCH'["@"),'$G(PSGS0Y) S $P(RESULT,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",53,0)
 I ($G(PSGSCH)]"") I $$PRNOK^PSGS0(PSGSCH) S $P(RESULT,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",54,0)
 D KVAR^VADPT K LYN,ND,PSGDT,PSGNEDFD,PSGNEFD,PSGNEFDO,PSGNESD,PSGS0Y,PSGSCH,PSGST,PSJSYSW,PSJSYSW0,ZZ
"RTN","PSJORPOE",55,0)
 ;RESULT=WARD PARAMETER^DEFAULT START DATE/TIME^#_D(NUMBER OF DAYS ORDER LASTS) OR #_H(NUMBER OF HOURS ORDER LASTS)^EXPECTED FIRST DOSE
"RTN","PSJORPOE",56,0)
 Q RESULT
"RTN","PSJORPOE",57,0)
 ;
"RTN","PSJORPOE",58,0)
RESOLVE(PSGP,SCH,OI,PCH,PSJPWD,PSJADM) ;
"RTN","PSJORPOE",59,0)
 ; PSGP=Patient IEN
"RTN","PSJORPOE",60,0)
 ; SCH=Schedule
"RTN","PSJORPOE",61,0)
 ; OI=Orderable Item
"RTN","PSJORPOE",62,0)
 ; PCH=Providers Choice
"RTN","PSJORPOE",63,0)
 ; PSJPWD=Ward Location (Optional)
"RTN","PSJORPOE",64,0)
 ; PSJADM=Admin Times (Optional)
"RTN","PSJORPOE",65,0)
 ;
"RTN","PSJORPOE",66,0)
 N PSJSYSW0,PSJSYSW,PSGSCH,PSGOES,PSGS0Y,DFN,RESULT1
"RTN","PSJORPOE",67,0)
 I $G(PSJPWD)']"" S DFN=PSGP D IN5^VADPT S:VAIP(5)]"" PSJPWD=+VAIP(5)
"RTN","PSJORPOE",68,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD)]"" S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJORPOE",69,0)
 S $P(PSJSYSW0,"^",5)=$S($$ONE(SCH):2,PCH="NEXT":1,1:0)
"RTN","PSJORPOE",70,0)
 S RESULT1=$S($P(PSJSYSW0,"^",5)=0:"CLOSEST",$P(PSJSYSW0,"^",5)=1:"NEXT",1:"NOW")
"RTN","PSJORPOE",71,0)
 I OI]"" S PSGST=$S($P($G(^PS(50.7,OI,0)),"^",7)]"":$P($G(^PS(50.7,OI,0)),"^",7),1:"C")
"RTN","PSJORPOE",72,0)
 N % D NOW^%DTC S PSGDT=%,DFN=PSGP,PSGSCH=SCH
"RTN","PSJORPOE",73,0)
 S X=PSGSCH,PSGS0Y="" I $D(^PS(51.1,"AC","PSJ",X)) D ADMIN
"RTN","PSJORPOE",74,0)
 S:$G(PSJADM) PSGS0Y=PSJADM
"RTN","PSJORPOE",75,0)
 S RESULT1=RESULT1_"^"_$$ENSD^PSGNE3(SCH,PSGS0Y,PSGDT,PSGDT)
"RTN","PSJORPOE",76,0)
 I $G(PSGSCH)]"" I $$DOW^PSIVUTL(PSGSCH),(PSGSCH'["@"),'$G(PSGS0Y) S $P(RESULT,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",77,0)
 I $G(PSGSCH)]"" I $$PRNOK^PSGS0(PSGSCH) S $P(RESULT1,"^",4)=$P(RESULT,"^",2)
"RTN","PSJORPOE",78,0)
 D KVAR^VADPT K LYN,PSGDT,PSGNEDFD,PSGNEFD,PSGNEFDO,PSGNESD,PSGS0Y,PSGSCH,PSGST,PSJSYSW,PSJSYSW0,ZZ,PSGS0XT,PSGS0Y
"RTN","PSJORPOE",79,0)
 Q RESULT1
"RTN","PSJORPOE",80,0)
 ;
"RTN","PSJORPOE",81,0)
SCHREQ(MR,OI,DD)  ;
"RTN","PSJORPOE",82,0)
 ; MR=Medication Route from 51.2 (Required)
"RTN","PSJORPOE",83,0)
 ; OI=Orderable Item from 50.7 (Optional)
"RTN","PSJORPOE",84,0)
 ; DD=Dispense Drug from 50 (Optional)
"RTN","PSJORPOE",85,0)
 N ADDITIVE,SOLUTION,REQ S REQ=0,(SOLUTION,ADDITIVE)=""
"RTN","PSJORPOE",86,0)
 I '+$G(MR) S REQ=1 Q REQ
"RTN","PSJORPOE",87,0)
 I '+$G(OI),'+$G(DD) S REQ=1 Q REQ
"RTN","PSJORPOE",88,0)
 I +$G(DD) S:$P($G(^PSDRUG(+DD,2)),U,3)["U" REQ=1 Q REQ
"RTN","PSJORPOE",89,0)
 I '$D(PS(51.2,+MR,0)) S REQ=1 Q REQ
"RTN","PSJORPOE",90,0)
 I $P($G(^PS(51.2,+MR,0)),"^",6)=1 D
"RTN","PSJORPOE",91,0)
 .I +$G(OI) D
"RTN","PSJORPOE",92,0)
 ..I '$D(^PS(50.7,+OI,0)) S REQ=1 Q
"RTN","PSJORPOE",93,0)
 ..F  S SOLUTION=$O(^PS(52.7,"AOI",+OI,SOLUTION)) Q:'SOLUTION  Q:REQ=1  S:$P(^PSDRUG(+$P(^PS(52.7,SOLUTION,0),U,2),2),U,3)["U" REQ=1
"RTN","PSJORPOE",94,0)
 ..F  S ADDITIVE=$O(^PS(52.6,"AOI",+OI,ADDITIVE)) Q:'ADDITIVE  Q:REQ=1  S:$P(^PSDRUG(+$P(^PS(52.6,ADDITIVE,0),U,2),2),U,3)["U" REQ=1
"RTN","PSJORPOE",95,0)
 Q REQ
"RTN","PSJORPOE",96,0)
 ;
"RTN","PSJORPOE",97,0)
ADMIN ; Get admin times associated with schedule
"RTN","PSJORPOE",98,0)
 S PSGS0Y="",ZZ=0
"RTN","PSJORPOE",99,0)
 I $$DOW^PSIVUTL($P(X,"@")),'$D(^PS(51.1,"AC","PSJ",X)) S PSGST="C" D  Q:$G(PSGS0Y)
"RTN","PSJORPOE",100,0)
 .I $P(X,"@",2) N PSJADBAD D  Q
"RTN","PSJORPOE",101,0)
 ..S PSGS0Y=$S($G(PSJADBAD):"",1:$P(X,"@",2))
"RTN","PSJORPOE",102,0)
 ..N ADMIN,TIME,II S ADMIN=$P(X,"@",2) F II=1:1:$L(ADMIN,"-") S TIME=$P(ADMIN,"-",II) I TIME'?2N&(TIME'?4N) S PSJADBAD=1
"RTN","PSJORPOE",103,0)
 .I $P(X,"@",2)]"",$D(^PS(51.1,"APPSJ",$P(X,"@",2))) S X=$P(X,"@",2)
"RTN","PSJORPOE",104,0)
 D FIND^DIC(51.1,,,,X,,"APPSJ",,,"LYN")
"RTN","PSJORPOE",105,0)
 S ZZ=$O(LYN("DILIST",2,ZZ)) I ZZ S ZZ=+LYN("DILIST",2,ZZ) I ZZ S ZZND=$G(^PS(51.1,ZZ,0)) S PSGST=$P(ZZND,U,5),PSGS0XT=$P(ZZND,U,3) S:$G(PSGSFLG) PSGSCIEN=$G(LYN("DILIST",2,ZZ)) I $G(PSJPWD) D
"RTN","PSJORPOE",106,0)
 . N ZZNDW S ZZNDW=$G(^PS(51.1,ZZ,1,PSJPWD,0)) I $P(ZZNDW,"^",2)]"" S PSGS0Y=$P(ZZNDW,"^",2),$P(ZZND,"^",2)=PSGS0Y I $G(PSGSFLG) S PSGSCIEN=$G(LYN("DILIST",2,ZZ))
"RTN","PSJORPOE",107,0)
 S ZZ=0 F  S ZZ=$O(LYN("DILIST",1,ZZ)) Q:'ZZ  I $G(LYN("DILIST",1,ZZ))'=X K LYN("DILIST",1,ZZ),LYN("DILIST",2,ZZ),LYN("DILIST","ID",ZZ,1)
"RTN","PSJORPOE",108,0)
 I $D(PSJPWD) S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ!$G(PSGS0Y)  I $P($G(^PS(51.1,+LYN("DILIST",2,ZZ),1,+PSJPWD,0)),U,2)]"" S PSGS0Y=$P($G(^(0)),U,2) I $G(PSGSFLG) S PSGSCIEN=$G(LYN("DILIST",2,ZZ))
"RTN","PSJORPOE",109,0)
 Q:PSGS0Y]""  S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ!$G(PSGS0Y)  I $G(LYN("DILIST","ID",ZZ,1))]"" S PSGS0Y=$G(LYN("DILIST","ID",ZZ,1))
"RTN","PSJORPOE",110,0)
 Q
"RTN","PSJORPOE",111,0)
 ;
"RTN","PSJORPOE",112,0)
ONE(SCH) ;
"RTN","PSJORPOE",113,0)
 ; SCH=Admin Schedule
"RTN","PSJORPOE",114,0)
 ; Returns 0 = (zero) Not a one time schedule.
"RTN","PSJORPOE",115,0)
 ;         1 =  One time schedule. 
"RTN","PSJORPOE",116,0)
 Q:$G(SCH)="" 0
"RTN","PSJORPOE",117,0)
 N X
"RTN","PSJORPOE",118,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="O":1,1:0)
"RTN","PSJORPOE",119,0)
 Q 0
"VER")
8.0^22.0
**INSTALL NAME**
OR*3.0*333
"BLD",8466,0)
OR*3.0*333^ORDER ENTRY/RESULTS REPORTING^0^3101208^y
"BLD",8466,1,0)
^^5^5^3100603^
"BLD",8466,1,1,0)
 This patch will correct an issue with complex orders entered through
"BLD",8466,1,2,0)
 CPRS. If the complex order uses a THEN conjunction and the admin time of 
"BLD",8466,1,3,0)
 a single section of the order is before the current time, that
"BLD",8466,1,4,0)
 administration was being dropped off. This would only happen on a section
"BLD",8466,1,5,0)
 of the complex order other than the first section.
"BLD",8466,4,0)
^9.64PA^^
"BLD",8466,6.3)
3
"BLD",8466,"ABPKG")
n
"BLD",8466,"KRN",0)
^9.67PA^779.2^20
"BLD",8466,"KRN",.4,0)
.4
"BLD",8466,"KRN",.401,0)
.401
"BLD",8466,"KRN",.402,0)
.402
"BLD",8466,"KRN",.403,0)
.403
"BLD",8466,"KRN",.5,0)
.5
"BLD",8466,"KRN",.84,0)
.84
"BLD",8466,"KRN",3.6,0)
3.6
"BLD",8466,"KRN",3.8,0)
3.8
"BLD",8466,"KRN",9.2,0)
9.2
"BLD",8466,"KRN",9.8,0)
9.8
"BLD",8466,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8466,"KRN",9.8,"NM",1,0)
ORCSEND1^^0^B67360308
"BLD",8466,"KRN",9.8,"NM","B","ORCSEND1",1)

"BLD",8466,"KRN",19,0)
19
"BLD",8466,"KRN",19.1,0)
19.1
"BLD",8466,"KRN",101,0)
101
"BLD",8466,"KRN",409.61,0)
409.61
"BLD",8466,"KRN",771,0)
771
"BLD",8466,"KRN",779.2,0)
779.2
"BLD",8466,"KRN",870,0)
870
"BLD",8466,"KRN",8989.51,0)
8989.51
"BLD",8466,"KRN",8989.52,0)
8989.52
"BLD",8466,"KRN",8994,0)
8994
"BLD",8466,"KRN","B",.4,.4)

"BLD",8466,"KRN","B",.401,.401)

"BLD",8466,"KRN","B",.402,.402)

"BLD",8466,"KRN","B",.403,.403)

"BLD",8466,"KRN","B",.5,.5)

"BLD",8466,"KRN","B",.84,.84)

"BLD",8466,"KRN","B",3.6,3.6)

"BLD",8466,"KRN","B",3.8,3.8)

"BLD",8466,"KRN","B",9.2,9.2)

"BLD",8466,"KRN","B",9.8,9.8)

"BLD",8466,"KRN","B",19,19)

"BLD",8466,"KRN","B",19.1,19.1)

"BLD",8466,"KRN","B",101,101)

"BLD",8466,"KRN","B",409.61,409.61)

"BLD",8466,"KRN","B",771,771)

"BLD",8466,"KRN","B",779.2,779.2)

"BLD",8466,"KRN","B",870,870)

"BLD",8466,"KRN","B",8989.51,8989.51)

"BLD",8466,"KRN","B",8989.52,8989.52)

"BLD",8466,"KRN","B",8994,8994)

"BLD",8466,"QUES",0)
^9.62^^
"BLD",8466,"REQB",0)
^9.611^1^1
"BLD",8466,"REQB",1,0)
OR*3.0*323^2
"BLD",8466,"REQB","B","OR*3.0*323",1)

"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2971217^2980417^1271
"PKG",167,22,1,"PAH",1,0)
333^3101208^15000040
"PKG",167,22,1,"PAH",1,1,0)
^^5^5^3101208
"PKG",167,22,1,"PAH",1,1,1,0)
 This patch will correct an issue with complex orders entered through
"PKG",167,22,1,"PAH",1,1,2,0)
 CPRS. If the complex order uses a THEN conjunction and the admin time of 
"PKG",167,22,1,"PAH",1,1,3,0)
 a single section of the order is before the current time, that
"PKG",167,22,1,"PAH",1,1,4,0)
 administration was being dropped off. This would only happen on a section
"PKG",167,22,1,"PAH",1,1,5,0)
 of the complex order other than the first section.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORCSEND1")
0^1^B67360308
"RTN","ORCSEND1",1,0)
ORCSEND1 ;SLC/MKB-Release cont ; 12/8/10 10:17am
"RTN","ORCSEND1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,29,45,61,79,94,116,138,158,149,187,215,243,282,323,333**;Dec 17, 1997;Build 3
"RTN","ORCSEND1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORCSEND1",4,0)
 ;
"RTN","ORCSEND1",5,0)
 ;Reference to PSJEEU supported by IA #486
"RTN","ORCSEND1",6,0)
 ;Reference to PSJORPOE supported by IA #3167
"RTN","ORCSEND1",7,0)
 ;
"RTN","ORCSEND1",8,0)
PKGSTUFF(PKG) ; Package code
"RTN","ORCSEND1",9,0)
 S PKG=$$GET1^DIQ(9.4,+PKG_",",1) Q:'$L(PKG)
"RTN","ORCSEND1",10,0)
 D:$L($T(@PKG)) @PKG
"RTN","ORCSEND1",11,0)
 Q
"RTN","ORCSEND1",12,0)
LR ; Spawn child orders if continuous schedule
"RTN","ORCSEND1",13,0)
 N ORSTRT,ORPARENT,OR0,ORNP,ORDIALOG,ORL,ORX,ORTIME,ORPITEM,ORPSAMP,ORPSPEC,ORPURG,ORPCOMM,ORPTYPE,ORPCOLL,ORS1,ORS2,P,ORCHLD,ORDG,ORLAST,ORDUZ,ORLOG,ORCOLLCT,STS
"RTN","ORCSEND1",14,0)
 S ORPARENT=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),ORL=$P(OR0,U,10)
"RTN","ORCSEND1",15,0)
 D SCHEDULE(ORIFN,"LR",.ORSTRT) I ORSTRT'>1 D  Q
"RTN","ORCSEND1",16,0)
 . N START S START=$O(ORSTRT(0)) Q:START=$P($G(^OR(100,+ORIFN,0)),U,8)
"RTN","ORCSEND1",17,0)
 . D DATES^ORCSAVE2(+ORIFN,START) ;update start date from schedule
"RTN","ORCSEND1",18,0)
 S ORNP=+$P(OR0,U,4),ORDIALOG=+$P(OR0,U,5),ORDUZ=+$P(OR0,U,6),ORLOG=$P(OR0,U,7),ORDG=+$P(OR0,U,11)
"RTN","ORCSEND1",19,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER(ORIFN),GETIMES^ORCDLR1
"RTN","ORCSEND1",20,0)
 K ORDIALOG($$PTR^ORCD("OR GTX ADMIN SCHEDULE"),1),ORDIALOG($$PTR^ORCD("OR GTX DURATION"),1)
"RTN","ORCSEND1",21,0)
 S ORPITEM=$$PTR^ORCD("OR GTX ORDERABLE ITEM")
"RTN","ORCSEND1",22,0)
 S ORPSAMP=$$PTR^ORCD("OR GTX COLLECTION SAMPLE")
"RTN","ORCSEND1",23,0)
 S ORPSPEC=$$PTR^ORCD("OR GTX SPECIMEN")
"RTN","ORCSEND1",24,0)
 S ORPURG=$$PTR^ORCD("OR GTX LAB URGENCY")
"RTN","ORCSEND1",25,0)
 S ORPCOMM=$$PTR^ORCD("OR GTX WORD PROCESSING 1")
"RTN","ORCSEND1",26,0)
 S ORPTYPE=$$PTR^ORCD("OR GTX COLLECTION TYPE")
"RTN","ORCSEND1",27,0)
 S ORPCOLL=$$PTR^ORCD("OR GTX START DATE/TIME")
"RTN","ORCSEND1",28,0)
LR1 N ORLASTC  S ORS1=0 F  S ORS1=$O(ORX(ORS1)) Q:ORS1'>0  D
"RTN","ORCSEND1",29,0)
 . N ORL S ORL=$P(OR0,U,10) ;protect ORL from calling routine ;DJE/VM *323
"RTN","ORCSEND1",30,0)
 . F P=ORPITEM,ORPSAMP,ORPSPEC,ORPURG,ORPCOMM,ORPTYPE S ORDIALOG(P,1)=$G(ORX(ORS1,P)) ;set values to next instance
"RTN","ORCSEND1",31,0)
 . S ORCOLLCT=$G(ORDIALOG(ORPTYPE,1))
"RTN","ORCSEND1",32,0)
 . S ORS2=0 F  S ORS2=$O(ORSTRT(ORS2)) Q:ORS2'>0  D
"RTN","ORCSEND1",33,0)
 .. S ORDIALOG(ORPCOLL,1)=ORS2 ;,ORDUZ=DUZ,ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSEND1",34,0)
 .. I ORCOLLCT="LC" S ORDIALOG(ORPTYPE,1)=$S($$LABCOLL^ORCDLR1(ORS2):"LC",1:"WC")
"RTN","ORCSEND1",35,0)
 .. I ORCOLLCT="I" S ORDIALOG(ORPTYPE,1)=$S($$IMMCOLL^ORCDLR1(ORS2):"I",1:"WC")
"RTN","ORCSEND1",36,0)
 .. D CHILD^ORCSEND3()
"RTN","ORCSEND1",37,0)
 .. S ORLASTC=$P(^OR(100,ORIFN,0),"^",8)
"RTN","ORCSEND1",38,0)
 . D DATES^ORCSAVE2(ORPARENT,,ORLASTC) S $P(^OR(100,ORPARENT,3),"^",8)=1
"RTN","ORCSEND1",39,0)
 S:$G(ORCHLD) ^OR(100,ORPARENT,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCSEND1",40,0)
 S ORIFN=ORPARENT,ORQUIT=1,STS=$P(^OR(100,ORIFN,3),U,3)
"RTN","ORCSEND1",41,0)
 I (STS=1)!(STS=13)!(STS=11) S ORERR="1^Unable to release orders"
"RTN","ORCSEND1",42,0)
 D RELEASE^ORCSAVE2(ORPARENT,1,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND1",43,0)
 Q
"RTN","ORCSEND1",44,0)
SCHEDULE(IFN,PKG,ORY,STRT) ; Returns list of start time(s) from schedule
"RTN","ORCSEND1",45,0)
 N I,X,PSJSD,PSJFD,PSJW,PSJNE,PSJPP,PSJX,PSJAT,PSJM,PSJTS,PSJY,PSJAX,PSJSCH,PSJOSD,PSJOFD,PSJC,ORDUR
"RTN","ORCSEND1",46,0)
 S PSJSD=$S(+$G(STRT):STRT,1:$P($G(^OR(100,+IFN,0)),U,8)) I 'PSJSD S ORY=-1 Q
"RTN","ORCSEND1",47,0)
 S ORY=1,ORY(PSJSD)="" ;1st occurrance
"RTN","ORCSEND1",48,0)
 S I=$O(^OR(100,+IFN,4.5,"ID","SCHEDULE",0)) Q:'I  Q:'$L($G(PKG))
"RTN","ORCSEND1",49,0)
 S X=$G(^OR(100,+IFN,4.5,I,1)),PSJX=$S(X:$$GET1^DIQ(51.1,+X_",",.01),1:X)
"RTN","ORCSEND1",50,0)
 S PSJW=+$G(ORL),PSJNE="",PSJPP=PKG D ENSV^PSJEEU Q:'$L($G(PSJX))
"RTN","ORCSEND1",51,0)
 I $G(PSJTS)'="C",$G(PSJTS)'="D" Q  ;not continuous or day-of-week
"RTN","ORCSEND1",52,0)
 S PSJSCH=PSJX,I=$O(^OR(100,+IFN,4.5,"ID","DAYS",0)) Q:'I
"RTN","ORCSEND1",53,0)
 S ORDUR=$G(^OR(100,+IFN,4.5,+I,1))
"RTN","ORCSEND1",54,0)
 S:ORDUR PSJFD=$$FMADD^XLFDT(PSJSD,+ORDUR,,-1)
"RTN","ORCSEND1",55,0)
 I 'ORDUR S X=+$E(ORDUR,2,9) D
"RTN","ORCSEND1",56,0)
 . I PSJM S PSJFD=$$FMADD^XLFDT(PSJSD,,,(PSJM*X)-1) ;X_#times
"RTN","ORCSEND1",57,0)
 . E  D  ;no freq in minutes --> day of week
"RTN","ORCSEND1",58,0)
 .. N DAYS,LOCMX,SCHMX
"RTN","ORCSEND1",59,0)
 .. S LOCMX=$$GET^XPAR("ALL^LOC.`"_+ORL,"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORCSEND1",60,0)
 .. K ^TMP($J,"ORCSEND1 SCHEDULE")
"RTN","ORCSEND1",61,0)
 .. D ZERO^PSS51P1(PSJY,,,,"ORCSEND1 SCHEDULE")
"RTN","ORCSEND1",62,0)
 .. S SCHMX=+$G(^TMP($J,"ORCSEND1 SCHEDULE",PSJY,2.5))
"RTN","ORCSEND1",63,0)
 .. K ^TMP($J,"ORCSEND1 SCHEDULE")
"RTN","ORCSEND1",64,0)
 .. ;S SCHMX=$P(^PS(51.1,PSJY,0),U,7)
"RTN","ORCSEND1",65,0)
 .. S DAYS=$S('SCHMX:LOCMX,LOCMX<SCHMX:LOCMX,1:SCHMX)
"RTN","ORCSEND1",66,0)
 .. S PSJFD=$$FMADD^XLFDT(PSJSD,DAYS,,-1)
"RTN","ORCSEND1",67,0)
 D ENSPU^PSJEEU K ORY
"RTN","ORCSEND1",68,0)
 I ORDUR M ORY=PSJC Q
"RTN","ORCSEND1",69,0)
 S ORY=$S(PSJC<$E(ORDUR,2,9):PSJC,1:$E(ORDUR,2,9))
"RTN","ORCSEND1",70,0)
 N NXT
"RTN","ORCSEND1",71,0)
 S NXT=0 F I=1:1:ORY S NXT=$O(PSJC(NXT)) Q:'NXT  S ORY(NXT)=PSJC(NXT)
"RTN","ORCSEND1",72,0)
 Q
"RTN","ORCSEND1",73,0)
GETORDER(IFN) ; Set ORX(Inst,Ptr)=Value
"RTN","ORCSEND1",74,0)
 N I,X,Y,PTR,INST,TYPE
"RTN","ORCSEND1",75,0)
 S I=0 F  S I=$O(^OR(100,IFN,4.5,I)) Q:I'>0  S X=$G(^(I,0)),Y=$G(^(1)) D
"RTN","ORCSEND1",76,0)
 . S PTR=+$P(X,U,2),INST=+$P(X,U,3),TYPE=$P($G(^ORD(101.41,PTR,1)),U)
"RTN","ORCSEND1",77,0)
 . I TYPE'="W" S ORX(INST,PTR)=Y Q
"RTN","ORCSEND1",78,0)
 . S ORX(INST,PTR)="^OR(100,"_IFN_",4.5,"_I_",2)"
"RTN","ORCSEND1",79,0)
 Q
"RTN","ORCSEND1",80,0)
PTR(X) ; Returns ptr of prompt X in Order Dialog file
"RTN","ORCSEND1",81,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORCSEND1",82,0)
PS ; spawn child orders if multiple doses
"RTN","ORCSEND1",83,0)
PSJ ; (Inpt only)
"RTN","ORCSEND1",84,0)
PSS ;
"RTN","ORCSEND1",85,0)
 N ORPARENT,OR0,ORNP,ORDIALOG,ORDUZ,ORLOG,ORL,ORDG,ORCAT,ORX,ORP,ORI,STS
"RTN","ORCSEND1",86,0)
 N ORDOSE,ORT,ORSCH,ORDUR,ORSTRT,ORFRST,ORCONJ,ORID,ORDD,ORSTR,ORDGNM
"RTN","ORCSEND1",87,0)
 N ORSTART,ORCHLD,ORLAST,ORSIG,OROI,ID,OR3,ORIG,CODE,ORPKG,ORENEW,I,ORADMIN
"RTN","ORCSEND1",88,0)
 S ORPARENT=+ORIFN,OR0=$G(^OR(100,ORPARENT,0)),OR3=$G(^(3))
"RTN","ORCSEND1",89,0)
 Q:$P(OR0,U,12)'="I"  S ORCAT="I",ORNP=+$P(OR0,U,4)
"RTN","ORCSEND1",90,0)
 S ORDIALOG=+$P(OR0,U,5),ORDUZ=+$P(OR0,U,6),ORLOG=$P(OR0,U,7)
"RTN","ORCSEND1",91,0)
 S ORL=$P(OR0,U,10),ORDG=+$P(OR0,U,11),ORPKG=+$P(OR0,U,14)
"RTN","ORCSEND1",92,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER(ORPARENT)
"RTN","ORCSEND1",93,0)
 S ORDOSE=$$PTR("INSTRUCTIONS"),ORT=$$PTR("ROUTE")
"RTN","ORCSEND1",94,0)
 S ORSCH=$$PTR("SCHEDULE"),ORDUR=$$PTR("DURATION")
"RTN","ORCSEND1",95,0)
 S ORCONJ=$$PTR("AND/THEN") D STRT S ORSTART=$G(ORSTRT("BEG"))
"RTN","ORCSEND1",96,0)
 S ORADMIN=$$PTR("ADMIN TIMES")
"RTN","ORCSEND1",97,0)
 D DATES^ORCSAVE2(ORPARENT,ORSTART) Q:$$DOSES(ORPARENT)'>1
"RTN","ORCSEND1",98,0)
 S ORFRST=$$PTR("NOW"),ORSIG=$$PTR("SIG")
"RTN","ORCSEND1",99,0)
 S ORID=$$PTR("DOSE"),ORDD=$$PTR("DISPENSE DRUG")
"RTN","ORCSEND1",100,0)
 S ORSTR=$$PTR("STRENGTH"),ORDGNM=$$PTR("DRUG NAME")
"RTN","ORCSEND1",101,0)
 I $P(OR3,U,11)=2,$O(^OR(100,+$P(OR3,U,5),2,0)) D
"RTN","ORCSEND1",102,0)
 . S ORENEW=+$P(OR3,U,5),I=0
"RTN","ORCSEND1",103,0)
 . I $$VALUE^ORX8(ORENEW,"NOW") S I=$O(^OR(100,ORENEW,2,0))
"RTN","ORCSEND1",104,0)
 . F  S I=$O(^OR(100,ORENEW,2,I)) Q:I<1  S ORENEW(I)=""
"RTN","ORCSEND1",105,0)
PS1 F ORP="ORDERABLE ITEM","URGENCY","WORD PROCESSING 1" D
"RTN","ORCSEND1",106,0)
 . N PTR S PTR=$$PTR(ORP) Q:PTR'>0  Q:'$D(ORX(1,PTR))
"RTN","ORCSEND1",107,0)
 . S ORDIALOG(PTR,1)=ORX(1,PTR) S:$E(ORP)="O" OROI=ORX(1,PTR)
"RTN","ORCSEND1",108,0)
 S ORI=$$FRSTDOSE I $G(ORX(1,ORFRST)) D
"RTN","ORCSEND1",109,0)
 . F ORP=ORDOSE,ORT,ORID S:$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)=ORX(ORI,ORP)
"RTN","ORCSEND1",110,0)
 . S ID=$G(ORX(ORI,ORID)) S:$P(ID,"&",6) ORDIALOG(ORDD,1)=$P(ID,"&",6)
"RTN","ORCSEND1",111,0)
 . S ORDIALOG(ORSCH,1)="NOW",ORSTART=$$NOW^XLFDT
"RTN","ORCSEND1",112,0)
 . D SIG,CHILD^ORCSEND3(ORSTART)
"RTN","ORCSEND1",113,0)
 F  D  S ORI=$O(ORX(ORI)) Q:ORI'>0
"RTN","ORCSEND1",114,0)
 . F ORP=ORDOSE,ORT,ORSCH,ORDUR,ORID,ORADMIN S:$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)=ORX(ORI,ORP) K:'$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)
"RTN","ORCSEND1",115,0)
 . K ORDIALOG(ORDD,1) S ID=$G(ORX(ORI,ORID))
"RTN","ORCSEND1",116,0)
 . S:$P(ID,"&",6) ORDIALOG(ORDD,1)=$P(ID,"&",6)
"RTN","ORCSEND1",117,0)
 . S ORSTART=$G(ORSTRT(ORI))
"RTN","ORCSEND1",118,0)
 . D SIG,CHILD^ORCSEND3(ORSTART)
"RTN","ORCSEND1",119,0)
 S:$G(ORCHLD) ^OR(100,ORPARENT,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCSEND1",120,0)
 S ORIFN=ORPARENT,ORQUIT=1,OR3=$G(^OR(100,ORIFN,3)),STS=$P(OR3,U,3)
"RTN","ORCSEND1",121,0)
 I (STS=1)!(STS=13)!(STS=11) S ORERR="1^Unable to release orders"
"RTN","ORCSEND1",122,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORNOW,DUZ,$G(NATURE)) K ^TMP("ORWORD",$J)
"RTN","ORCSEND1",123,0)
 S $P(^OR(100,ORIFN,3),U,8)=1 ;veil parent order - set stop date/time?
"RTN","ORCSEND1",124,0)
 Q:(STS=1)!(STS=13)!(STS=11)  ;unsuccessful
"RTN","ORCSEND1",125,0)
PS2 ; ck if parent is unsigned or edit
"RTN","ORCSEND1",126,0)
 I $P($G(^OR(100,ORIFN,8,1,0)),U,4)=2 S $P(^(0),U,4)="" K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,1) ;clear ES
"RTN","ORCSEND1",127,0)
 Q:$P(OR3,U,11)'=1  S ORIG=$P(OR3,U,5) Q:ORIG'>0
"RTN","ORCSEND1",128,0)
 S CODE=$S($P($G(^OR(100,ORIG,3)),U,3)=5:"CA",1:"DC")
"RTN","ORCSEND1",129,0)
 D MSG^ORMBLD(ORIG,CODE) I "^1^13^"[(U_$P($G(^OR(100,ORIG,3)),U,3)_U) D
"RTN","ORCSEND1",130,0)
 . N NATR S NATR=+$O(^ORD(100.02,"C","C",0))
"RTN","ORCSEND1",131,0)
 . S $P(^OR(100,ORIG,3),U,3)=12,$P(^(3),U,7)=0,^(6)=NATR_U_DUZ_U_ORNOW
"RTN","ORCSEND1",132,0)
 . D CANCEL^ORCSEND(ORIG) ;ck for unrel actions
"RTN","ORCSEND1",133,0)
 Q
"RTN","ORCSEND1",134,0)
DOSES(IFN) ; count number of doses in order
"RTN","ORCSEND1",135,0)
 N I,CNT S CNT=0
"RTN","ORCSEND1",136,0)
 S I=0 F  S I=$O(^OR(100,+$G(IFN),4.5,"ID","INSTR",I)) Q:I'>0  I $L($G(^OR(100,+$G(IFN),4.5,I,1))) S CNT=CNT+1
"RTN","ORCSEND1",137,0)
 S I=+$O(^OR(100,+$G(IFN),4.5,"ID","NOW",0)) I I,$G(^OR(100,+$G(IFN),4.5,I,1)) S CNT=CNT+1
"RTN","ORCSEND1",138,0)
 Q CNT
"RTN","ORCSEND1",139,0)
FRSTDOSE() ; Return instance of first dose
"RTN","ORCSEND1",140,0)
 N I,Y S I=0,Y=1
"RTN","ORCSEND1",141,0)
 F  S I=$O(ORX(I)) Q:I'>0  I $D(ORX(I,ORDOSE)) S Y=I Q
"RTN","ORCSEND1",142,0)
 Q Y
"RTN","ORCSEND1",143,0)
SIG ; Build text of instructions
"RTN","ORCSEND1",144,0)
 N ORDRUG,ID,DOSE,ORI,ORX K ^TMP("ORWORD",$J,ORSIG,1)
"RTN","ORCSEND1",145,0)
 S ORDRUG=$G(ORDIALOG(ORDD,1)),ID=$G(ORDIALOG(ORID,1))
"RTN","ORCSEND1",146,0)
 S DOSE=$G(ORDIALOG(ORDOSE,1)),ORI=1
"RTN","ORCSEND1",147,0)
 S ORX=$$DOSE^ORCDPS2_$$RTE^ORCDPS2_$$SCH^ORCDPS2_$$DUR^ORCDPS2
"RTN","ORCSEND1",148,0)
 S ^TMP("ORWORD",$J,ORSIG,1,0)="^^1^1^"_DT_U,^(1,0)=ORX
"RTN","ORCSEND1",149,0)
 S ORDIALOG(ORSIG,1)=$NA(^TMP("ORWORD",$J,ORSIG,1))
"RTN","ORCSEND1",150,0)
 S ORDIALOG(ORDOSE,"FORMAT")="@"
"RTN","ORCSEND1",151,0)
 K ORDIALOG(ORSTR,1),ORDIALOG(ORDGNM,1)
"RTN","ORCSEND1",152,0)
 I ORDRUG,'ID D  ;set strength or drug name
"RTN","ORCSEND1",153,0)
 . N STR,ITM S STR=$P(ID,"&",7)_$P(ID,"&",8)
"RTN","ORCSEND1",154,0)
 . I STR'>0 S ORDIALOG(ORDGNM,1)=$$GET1^DIQ(50,+ORDRUG_",",.01) Q
"RTN","ORCSEND1",155,0)
 . S ITM=$P($G(^ORD(101.43,+$G(OROI),0)),U)
"RTN","ORCSEND1",156,0)
 . S:ITM'[STR ORDIALOG(ORSTR,1)=STR
"RTN","ORCSEND1",157,0)
 Q
"RTN","ORCSEND1",158,0)
STRT ; Build ORSTRT(inst)=date.time array of start times by dose
"RTN","ORCSEND1",159,0)
 N OI,PSOI,XD,XH,XM,XS,ORWD,ORI,SCH,ORSD,X,ORD,TMPDT K ORSTRT
"RTN","ORCSEND1",160,0)
 S OI=$G(ORX(1,$$PTR^ORCD("OR GTX ORDERABLE ITEM")))
"RTN","ORCSEND1",161,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2),(XD,XH,XM,XS)=0
"RTN","ORCSEND1",162,0)
 S ORWD=+$G(^SC(+$G(ORL),42)) ;ward
"RTN","ORCSEND1",163,0)
 S ORI=0 F  S ORI=$O(ORX(ORI)) Q:ORI<1  D
"RTN","ORCSEND1",164,0)
 . S SCH=$G(ORX(ORI,ORSCH)),ORSD="" S:'$L(SCH) X=$$NOW^XLFDT
"RTN","ORCSEND1",165,0)
 .;*333 add use of TMPDT
"RTN","ORCSEND1",166,0)
 . S:$L(SCH) ORSD=$$STARTSTP^PSJORPOE(+ORVP,SCH,PSOI,ORWD,"","",$G(TMPDT)),X=$P(ORSD,U,4)
"RTN","ORCSEND1",167,0)
 . S ORSTRT(ORI)=$$FMADD^XLFDT(X,XD,XH,XM,XS),TMPDT=ORSTRT(ORI) ;START+OFFSET
"RTN","ORCSEND1",168,0)
 . S (XD,XH,XM,XS)=0 ;*333 Reset offset for each section.
"RTN","ORCSEND1",169,0)
  . ; update OFFSET for next THEN dose
"RTN","ORCSEND1",170,0)
 . D DUR(ORI) I $G(ORX(ORI,ORCONJ))="T" D
"RTN","ORCSEND1",171,0)
 .. I $G(ORD("XD"))<1,$G(ORD("XH"))<1,$G(ORD("XM"))<1,$G(ORD("XS"))<1 S ORD("XD")=+$P(ORSD,U,3) ;default duration
"RTN","ORCSEND1",172,0)
 .. N I,Y F I="XD","XH","XM","XS" S Y=@I,@I=Y+$G(ORD(I))
"RTN","ORCSEND1",173,0)
 .. K ORD
"RTN","ORCSEND1",174,0)
 ; find beginning date.time for parent
"RTN","ORCSEND1",175,0)
 S ORI=0,X=9999999 F  S ORI=$O(ORSTRT(ORI)) Q:ORI<1  I ORSTRT(ORI)<X S X=ORSTRT(ORI)
"RTN","ORCSEND1",176,0)
 S ORSTRT("BEG")=X
"RTN","ORCSEND1",177,0)
 Q
"RTN","ORCSEND1",178,0)
DUR(I) ; Accumulate duration in ORD("Xt") for offsetting next THEN dose
"RTN","ORCSEND1",179,0)
 N X,Y S X=$$FMDUR^ORCDPS3($G(ORX(I,ORDUR)))
"RTN","ORCSEND1",180,0)
 I X["S",+X>$G(ORD("XS")) S ORD("XS")=+X
"RTN","ORCSEND1",181,0)
 I X["'",+X>$G(ORD("XM")) S ORD("XM")=+X
"RTN","ORCSEND1",182,0)
 I X["H",+X>$G(ORD("XH")) S ORD("XH")=+X
"RTN","ORCSEND1",183,0)
 S Y=$S(X["D":+X,X["W":+X*7,X["M":+X*30,1:0)
"RTN","ORCSEND1",184,0)
 I Y,Y>$G(ORD("XD")) S ORD("XD")=Y
"RTN","ORCSEND1",185,0)
 Q
"RTN","ORCSEND1",186,0)
VBEC ; Spawn VBECS children
"RTN","ORCSEND1",187,0)
 D:$L($T(EN^ORCSEND2)) EN^ORCSEND2
"RTN","ORCSEND1",188,0)
 Q
"VER")
8.0^22.0
**END**
**END**
