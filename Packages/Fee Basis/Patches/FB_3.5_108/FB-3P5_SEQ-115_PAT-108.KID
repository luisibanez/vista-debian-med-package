Released FB*3.5*108 SEQ #115
Extracted from mail message
**KIDS**:FB*3.5*108^

**INSTALL NAME**
FB*3.5*108
"BLD",8586,0)
FB*3.5*108^FEE BASIS^0^3120511^y
"BLD",8586,1,0)
^^10^10^3111005^^
"BLD",8586,1,1,0)
This patch will enhance Fee Basis to capture additional data associated 
"BLD",8586,1,2,0)
with non-VA care.  Contracts can be specified for Medical Fee and Civil
"BLD",8586,1,3,0)
Hospital authorizations and payments.  Civil hospital invoices will allow 
"BLD",8586,1,4,0)
entry of larger dollar amounts, additional diagnosis codes, present on
"BLD",8586,1,5,0)
admission indicators for diagnosis codes, the admitting diagnosis code,
"BLD",8586,1,6,0)
and additional procedure codes.  The existing transmissions to NVH Pricer
"BLD",8586,1,7,0)
and Central Fee will be modified to include additional data elements.  The
"BLD",8586,1,8,0)
transmission of these additional data elements will make it possible to
"BLD",8586,1,9,0)
comply with inpatient pricing requirements and improve the ability of the
"BLD",8586,1,10,0)
VA to review and report on purchased care.
"BLD",8586,4,0)
^9.64PA^161.94^8
"BLD",8586,4,161,0)
161
"BLD",8586,4,161,2,0)
^9.641^161.01^1
"BLD",8586,4,161,2,161.01,0)
AUTHORIZATION  (sub-file)
"BLD",8586,4,161,2,161.01,1,0)
^9.6411^105^1
"BLD",8586,4,161,2,161.01,1,105,0)
CONTRACT
"BLD",8586,4,161,222)
y^y^p^^^^n^^n
"BLD",8586,4,161,224)

"BLD",8586,4,161.4,0)
161.4
"BLD",8586,4,161.4,2,0)
^9.641^161.4^1
"BLD",8586,4,161.4,2,161.4,0)
FEE BASIS SITE PARAMETERS  (File-top level)
"BLD",8586,4,161.4,2,161.4,1,0)
^9.6411^17^3
"BLD",8586,4,161.4,2,161.4,1,17,0)
MAX # PAYMENT LINE ITEMS
"BLD",8586,4,161.4,2,161.4,1,17.1,0)
MAX # CH PAYMENT LINES
"BLD",8586,4,161.4,2,161.4,1,17.2,0)
MAX # CNH PAYMENT LINES
"BLD",8586,4,161.4,222)
y^y^p^^^^n^^n
"BLD",8586,4,161.4,224)

"BLD",8586,4,161.43,0)
161.43
"BLD",8586,4,161.43,222)
y^y^f^^^^n
"BLD",8586,4,161.94,0)
161.94
"BLD",8586,4,161.94,222)
y^y^f^^n^^y^o^n
"BLD",8586,4,162,0)
162
"BLD",8586,4,162,2,0)
^9.641^162.03^1
"BLD",8586,4,162,2,162.03,0)
SERVICE PROVIDED  (sub-file)
"BLD",8586,4,162,2,162.03,1,0)
^9.6411^54^1
"BLD",8586,4,162,2,162.03,1,54,0)
CONTRACT
"BLD",8586,4,162,222)
y^y^p^^^^n^^n
"BLD",8586,4,162,224)

"BLD",8586,4,162.4,0)
162.4
"BLD",8586,4,162.4,2,0)
^9.641^162.4^1
"BLD",8586,4,162.4,2,162.4,0)
VA FORM 10-7078  (File-top level)
"BLD",8586,4,162.4,2,162.4,1,0)
^9.6411^6^1
"BLD",8586,4,162.4,2,162.4,1,6,0)
ESTIMATED AMOUNT
"BLD",8586,4,162.4,222)
y^y^p^^^^n^^n
"BLD",8586,4,162.4,224)

"BLD",8586,4,162.5,0)
162.5
"BLD",8586,4,162.5,2,0)
^9.641^162.579^3
"BLD",8586,4,162.5,2,162.5,0)
FEE BASIS INVOICE  (File-top level)
"BLD",8586,4,162.5,2,162.5,1,0)
^9.6411^60^72
"BLD",8586,4,162.5,2,162.5,1,6.6,0)
BILLED CHARGES
"BLD",8586,4,162.5,2,162.5,1,7,0)
AMOUNT CLAIMED
"BLD",8586,4,162.5,2,162.5,1,8,0)
AMOUNT PAID
"BLD",8586,4,162.5,2,162.5,1,9,0)
AMOUNT SUSPENDED
"BLD",8586,4,162.5,2,162.5,1,26,0)
NVH PRICER AMOUNT
"BLD",8586,4,162.5,2,162.5,1,30.02,0)
POA1
"BLD",8586,4,162.5,2,162.5,1,31.02,0)
POA2
"BLD",8586,4,162.5,2,162.5,1,32.02,0)
POA3
"BLD",8586,4,162.5,2,162.5,1,33.02,0)
POA4
"BLD",8586,4,162.5,2,162.5,1,34.02,0)
POA5
"BLD",8586,4,162.5,2,162.5,1,35,0)
ICD6
"BLD",8586,4,162.5,2,162.5,1,35.02,0)
POA6
"BLD",8586,4,162.5,2,162.5,1,35.1,0)
ICD7
"BLD",8586,4,162.5,2,162.5,1,35.12,0)
POA7
"BLD",8586,4,162.5,2,162.5,1,35.2,0)
ICD8
"BLD",8586,4,162.5,2,162.5,1,35.22,0)
POA8
"BLD",8586,4,162.5,2,162.5,1,35.3,0)
ICD9
"BLD",8586,4,162.5,2,162.5,1,35.32,0)
POA9
"BLD",8586,4,162.5,2,162.5,1,35.4,0)
ICD10
"BLD",8586,4,162.5,2,162.5,1,35.42,0)
POA10
"BLD",8586,4,162.5,2,162.5,1,35.5,0)
ICD11
"BLD",8586,4,162.5,2,162.5,1,35.52,0)
POA11
"BLD",8586,4,162.5,2,162.5,1,35.6,0)
ICD12
"BLD",8586,4,162.5,2,162.5,1,35.62,0)
POA12
"BLD",8586,4,162.5,2,162.5,1,35.7,0)
ICD13
"BLD",8586,4,162.5,2,162.5,1,35.72,0)
POA13
"BLD",8586,4,162.5,2,162.5,1,35.8,0)
ICD14
"BLD",8586,4,162.5,2,162.5,1,35.82,0)
POA14
"BLD",8586,4,162.5,2,162.5,1,35.9,0)
ICD15
"BLD",8586,4,162.5,2,162.5,1,35.92,0)
POA15
"BLD",8586,4,162.5,2,162.5,1,36,0)
ICD16
"BLD",8586,4,162.5,2,162.5,1,36.02,0)
POA16
"BLD",8586,4,162.5,2,162.5,1,36.1,0)
ICD17
"BLD",8586,4,162.5,2,162.5,1,36.12,0)
POA17
"BLD",8586,4,162.5,2,162.5,1,36.2,0)
ICD18
"BLD",8586,4,162.5,2,162.5,1,36.22,0)
POA18
"BLD",8586,4,162.5,2,162.5,1,36.3,0)
ICD19
"BLD",8586,4,162.5,2,162.5,1,36.32,0)
POA19
"BLD",8586,4,162.5,2,162.5,1,36.4,0)
ICD20
"BLD",8586,4,162.5,2,162.5,1,36.42,0)
POA20
"BLD",8586,4,162.5,2,162.5,1,36.5,0)
ICD21
"BLD",8586,4,162.5,2,162.5,1,36.52,0)
POA21
"BLD",8586,4,162.5,2,162.5,1,36.6,0)
ICD22
"BLD",8586,4,162.5,2,162.5,1,36.62,0)
POA22
"BLD",8586,4,162.5,2,162.5,1,36.7,0)
ICD23
"BLD",8586,4,162.5,2,162.5,1,36.72,0)
POA23
"BLD",8586,4,162.5,2,162.5,1,36.8,0)
ICD24
"BLD",8586,4,162.5,2,162.5,1,36.82,0)
POA24
"BLD",8586,4,162.5,2,162.5,1,36.9,0)
ICD25
"BLD",8586,4,162.5,2,162.5,1,36.92,0)
POA25
"BLD",8586,4,162.5,2,162.5,1,39,0)
ADMITTING DIAGNOSIS
"BLD",8586,4,162.5,2,162.5,1,44.06,0)
PROC6
"BLD",8586,4,162.5,2,162.5,1,44.07,0)
PROC7
"BLD",8586,4,162.5,2,162.5,1,44.08,0)
PROC8
"BLD",8586,4,162.5,2,162.5,1,44.09,0)
PROC9
"BLD",8586,4,162.5,2,162.5,1,44.1,0)
PROC10
"BLD",8586,4,162.5,2,162.5,1,44.11,0)
PROC11
"BLD",8586,4,162.5,2,162.5,1,44.12,0)
PROC12
"BLD",8586,4,162.5,2,162.5,1,44.13,0)
PROC13
"BLD",8586,4,162.5,2,162.5,1,44.14,0)
PROC14
"BLD",8586,4,162.5,2,162.5,1,44.15,0)
PROC15
"BLD",8586,4,162.5,2,162.5,1,44.16,0)
PROC16
"BLD",8586,4,162.5,2,162.5,1,44.17,0)
PROC17
"BLD",8586,4,162.5,2,162.5,1,44.18,0)
PROC18
"BLD",8586,4,162.5,2,162.5,1,44.19,0)
PROC19
"BLD",8586,4,162.5,2,162.5,1,44.2,0)
PROC20
"BLD",8586,4,162.5,2,162.5,1,44.21,0)
PROC21
"BLD",8586,4,162.5,2,162.5,1,44.22,0)
PROC22
"BLD",8586,4,162.5,2,162.5,1,44.23,0)
PROC23
"BLD",8586,4,162.5,2,162.5,1,44.24,0)
PROC24
"BLD",8586,4,162.5,2,162.5,1,44.25,0)
PROC25
"BLD",8586,4,162.5,2,162.5,1,60,0)
CONTRACT
"BLD",8586,4,162.5,2,162.558,0)
ADJUSTMENT  (sub-file)
"BLD",8586,4,162.5,2,162.558,1,0)
^9.6411^2^1
"BLD",8586,4,162.5,2,162.558,1,2,0)
ADJUSTMENT AMOUNT
"BLD",8586,4,162.5,2,162.579,0)
LINE ITEM RENDERING PROV  (sub-file)
"BLD",8586,4,162.5,2,162.579,1,0)
^9.6411^.01^1
"BLD",8586,4,162.5,2,162.579,1,.01,0)
LINE ITEM NUMBER
"BLD",8586,4,162.5,222)
y^y^p^^^^n^^n
"BLD",8586,4,162.5,224)

"BLD",8586,4,162.7,0)
162.7
"BLD",8586,4,162.7,2,0)
^9.641^162.7^1
"BLD",8586,4,162.7,2,162.7,0)
FEE BASIS UNAUTHORIZED CLAIMS  (File-top level)
"BLD",8586,4,162.7,2,162.7,1,0)
^9.6411^14^2
"BLD",8586,4,162.7,2,162.7,1,8,0)
AMOUNT CLAIMED
"BLD",8586,4,162.7,2,162.7,1,14,0)
AMOUNT APPROVED
"BLD",8586,4,162.7,222)
y^y^p^^^^n^^n
"BLD",8586,4,162.7,224)

"BLD",8586,4,"APDD",161,161.01)

"BLD",8586,4,"APDD",161,161.01,105)

"BLD",8586,4,"APDD",161.4,161.4)

"BLD",8586,4,"APDD",161.4,161.4,17)

"BLD",8586,4,"APDD",161.4,161.4,17.1)

"BLD",8586,4,"APDD",161.4,161.4,17.2)

"BLD",8586,4,"APDD",162,162.03)

"BLD",8586,4,"APDD",162,162.03,54)

"BLD",8586,4,"APDD",162.4,162.4)

"BLD",8586,4,"APDD",162.4,162.4,6)

"BLD",8586,4,"APDD",162.5,162.5)

"BLD",8586,4,"APDD",162.5,162.5,6.6)

"BLD",8586,4,"APDD",162.5,162.5,7)

"BLD",8586,4,"APDD",162.5,162.5,8)

"BLD",8586,4,"APDD",162.5,162.5,9)

"BLD",8586,4,"APDD",162.5,162.5,26)

"BLD",8586,4,"APDD",162.5,162.5,30.02)

"BLD",8586,4,"APDD",162.5,162.5,31.02)

"BLD",8586,4,"APDD",162.5,162.5,32.02)

"BLD",8586,4,"APDD",162.5,162.5,33.02)

"BLD",8586,4,"APDD",162.5,162.5,34.02)

"BLD",8586,4,"APDD",162.5,162.5,35)

"BLD",8586,4,"APDD",162.5,162.5,35.02)

"BLD",8586,4,"APDD",162.5,162.5,35.1)

"BLD",8586,4,"APDD",162.5,162.5,35.12)

"BLD",8586,4,"APDD",162.5,162.5,35.2)

"BLD",8586,4,"APDD",162.5,162.5,35.22)

"BLD",8586,4,"APDD",162.5,162.5,35.3)

"BLD",8586,4,"APDD",162.5,162.5,35.32)

"BLD",8586,4,"APDD",162.5,162.5,35.4)

"BLD",8586,4,"APDD",162.5,162.5,35.42)

"BLD",8586,4,"APDD",162.5,162.5,35.5)

"BLD",8586,4,"APDD",162.5,162.5,35.52)

"BLD",8586,4,"APDD",162.5,162.5,35.6)

"BLD",8586,4,"APDD",162.5,162.5,35.62)

"BLD",8586,4,"APDD",162.5,162.5,35.7)

"BLD",8586,4,"APDD",162.5,162.5,35.72)

"BLD",8586,4,"APDD",162.5,162.5,35.8)

"BLD",8586,4,"APDD",162.5,162.5,35.82)

"BLD",8586,4,"APDD",162.5,162.5,35.9)

"BLD",8586,4,"APDD",162.5,162.5,35.92)

"BLD",8586,4,"APDD",162.5,162.5,36)

"BLD",8586,4,"APDD",162.5,162.5,36.02)

"BLD",8586,4,"APDD",162.5,162.5,36.1)

"BLD",8586,4,"APDD",162.5,162.5,36.12)

"BLD",8586,4,"APDD",162.5,162.5,36.2)

"BLD",8586,4,"APDD",162.5,162.5,36.22)

"BLD",8586,4,"APDD",162.5,162.5,36.3)

"BLD",8586,4,"APDD",162.5,162.5,36.32)

"BLD",8586,4,"APDD",162.5,162.5,36.4)

"BLD",8586,4,"APDD",162.5,162.5,36.42)

"BLD",8586,4,"APDD",162.5,162.5,36.5)

"BLD",8586,4,"APDD",162.5,162.5,36.52)

"BLD",8586,4,"APDD",162.5,162.5,36.6)

"BLD",8586,4,"APDD",162.5,162.5,36.62)

"BLD",8586,4,"APDD",162.5,162.5,36.7)

"BLD",8586,4,"APDD",162.5,162.5,36.72)

"BLD",8586,4,"APDD",162.5,162.5,36.8)

"BLD",8586,4,"APDD",162.5,162.5,36.82)

"BLD",8586,4,"APDD",162.5,162.5,36.9)

"BLD",8586,4,"APDD",162.5,162.5,36.92)

"BLD",8586,4,"APDD",162.5,162.5,39)

"BLD",8586,4,"APDD",162.5,162.5,44.06)

"BLD",8586,4,"APDD",162.5,162.5,44.07)

"BLD",8586,4,"APDD",162.5,162.5,44.08)

"BLD",8586,4,"APDD",162.5,162.5,44.09)

"BLD",8586,4,"APDD",162.5,162.5,44.1)

"BLD",8586,4,"APDD",162.5,162.5,44.11)

"BLD",8586,4,"APDD",162.5,162.5,44.12)

"BLD",8586,4,"APDD",162.5,162.5,44.13)

"BLD",8586,4,"APDD",162.5,162.5,44.14)

"BLD",8586,4,"APDD",162.5,162.5,44.15)

"BLD",8586,4,"APDD",162.5,162.5,44.16)

"BLD",8586,4,"APDD",162.5,162.5,44.17)

"BLD",8586,4,"APDD",162.5,162.5,44.18)

"BLD",8586,4,"APDD",162.5,162.5,44.19)

"BLD",8586,4,"APDD",162.5,162.5,44.2)

"BLD",8586,4,"APDD",162.5,162.5,44.21)

"BLD",8586,4,"APDD",162.5,162.5,44.22)

"BLD",8586,4,"APDD",162.5,162.5,44.23)

"BLD",8586,4,"APDD",162.5,162.5,44.24)

"BLD",8586,4,"APDD",162.5,162.5,44.25)

"BLD",8586,4,"APDD",162.5,162.5,60)

"BLD",8586,4,"APDD",162.5,162.558)

"BLD",8586,4,"APDD",162.5,162.558,2)

"BLD",8586,4,"APDD",162.5,162.579)

"BLD",8586,4,"APDD",162.5,162.579,.01)

"BLD",8586,4,"APDD",162.7,162.7)

"BLD",8586,4,"APDD",162.7,162.7,8)

"BLD",8586,4,"APDD",162.7,162.7,14)

"BLD",8586,4,"B",161,161)

"BLD",8586,4,"B",161.4,161.4)

"BLD",8586,4,"B",161.43,161.43)

"BLD",8586,4,"B",161.94,161.94)

"BLD",8586,4,"B",162,162)

"BLD",8586,4,"B",162.4,162.4)

"BLD",8586,4,"B",162.5,162.5)

"BLD",8586,4,"B",162.7,162.7)

"BLD",8586,6)
15^
"BLD",8586,6.3)
115
"BLD",8586,"ABPKG")
n
"BLD",8586,"INI")
PR^FBXIP108
"BLD",8586,"INID")
^y
"BLD",8586,"INIT")
PS^FBXIP108
"BLD",8586,"KRN",0)
^9.67PA^779.2^20
"BLD",8586,"KRN",.4,0)
.4
"BLD",8586,"KRN",.401,0)
.401
"BLD",8586,"KRN",.402,0)
.402
"BLD",8586,"KRN",.402,"NM",0)
^9.68A^3^3
"BLD",8586,"KRN",.402,"NM",1,0)
FBAA AUTHORIZATION    FILE #161^161^0
"BLD",8586,"KRN",.402,"NM",2,0)
FBCH ENTER PAYMENT    FILE #162.5^162.5^0
"BLD",8586,"KRN",.402,"NM",3,0)
FBCH EDIT PAYMENT    FILE #162.5^162.5^0
"BLD",8586,"KRN",.402,"NM","B","FBAA AUTHORIZATION    FILE #161",1)

"BLD",8586,"KRN",.402,"NM","B","FBCH EDIT PAYMENT    FILE #162.5",3)

"BLD",8586,"KRN",.402,"NM","B","FBCH ENTER PAYMENT    FILE #162.5",2)

"BLD",8586,"KRN",.403,0)
.403
"BLD",8586,"KRN",.5,0)
.5
"BLD",8586,"KRN",.84,0)
.84
"BLD",8586,"KRN",3.6,0)
3.6
"BLD",8586,"KRN",3.8,0)
3.8
"BLD",8586,"KRN",9.2,0)
9.2
"BLD",8586,"KRN",9.8,0)
9.8
"BLD",8586,"KRN",9.8,"NM",0)
^9.68A^49^46
"BLD",8586,"KRN",9.8,"NM",1,0)
FBXIP108^^0^B13213914
"BLD",8586,"KRN",9.8,"NM",2,0)
FBUTL7^^0^B17958373
"BLD",8586,"KRN",9.8,"NM",3,0)
FBCH78^^0^B39732551
"BLD",8586,"KRN",9.8,"NM",4,0)
FBCHCD^^0^B20874782
"BLD",8586,"KRN",9.8,"NM",5,0)
FBCHEP^^0^B33211512
"BLD",8586,"KRN",9.8,"NM",6,0)
FBCHEP1^^0^B33647893
"BLD",8586,"KRN",9.8,"NM",7,0)
FBPRICE^^0^B22445892
"BLD",8586,"KRN",9.8,"NM",8,0)
FBPRICE1^^0^B12291028
"BLD",8586,"KRN",9.8,"NM",9,0)
FBAAV6^^0^B23733544
"BLD",8586,"KRN",9.8,"NM",10,0)
FBAAV2^^0^B14009472
"BLD",8586,"KRN",9.8,"NM",11,0)
FBAAV0^^0^B43916106
"BLD",8586,"KRN",9.8,"NM",12,0)
FBAAV01^^0^B12667626
"BLD",8586,"KRN",9.8,"NM",13,0)
FBNHEP2^^0^B25872550
"BLD",8586,"KRN",9.8,"NM",14,0)
FBNHEP^^0^B33126997
"BLD",8586,"KRN",9.8,"NM",15,0)
FBAAV5^^0^B71438715
"BLD",8586,"KRN",9.8,"NM",16,0)
FBAADEM1^^0^B14338880
"BLD",8586,"KRN",9.8,"NM",18,0)
FBAA79^^0^B22692839
"BLD",8586,"KRN",9.8,"NM",19,0)
FBAACO^^0^B29088561
"BLD",8586,"KRN",9.8,"NM",20,0)
FBAAODP0^^0^B4472268
"BLD",8586,"KRN",9.8,"NM",21,0)
FBAAPM^^0^B5082140
"BLD",8586,"KRN",9.8,"NM",22,0)
FBAAPIE1^^0^B15539047
"BLD",8586,"KRN",9.8,"NM",23,0)
FBNHEA^^0^B9476317
"BLD",8586,"KRN",9.8,"NM",24,0)
FBNHED^^0^B10924946
"BLD",8586,"KRN",9.8,"NM",25,0)
FBNHEDAT^^0^B13901461
"BLD",8586,"KRN",9.8,"NM",26,0)
FBNHET^^0^B9055754
"BLD",8586,"KRN",9.8,"NM",27,0)
FBNHRC^^0^B13819457
"BLD",8586,"KRN",9.8,"NM",28,0)
FBSHAUT^^0^B73848186
"BLD",8586,"KRN",9.8,"NM",29,0)
FBAACO1^^0^B42250975
"BLD",8586,"KRN",9.8,"NM",30,0)
FBAACO2^^0^B14357578
"BLD",8586,"KRN",9.8,"NM",31,0)
FBAACO3^^0^B50591838
"BLD",8586,"KRN",9.8,"NM",32,0)
FBAAPET^^0^B39436624
"BLD",8586,"KRN",9.8,"NM",33,0)
FBCHPET^^0^B36398874
"BLD",8586,"KRN",9.8,"NM",34,0)
FBAACP^^0^B46974663
"BLD",8586,"KRN",9.8,"NM",35,0)
FBAAMP^^0^B64599378
"BLD",8586,"KRN",9.8,"NM",36,0)
FBCHRR^^0^B12984210
"BLD",8586,"KRN",9.8,"NM",37,0)
FBAACCB1^^0^B28490763
"BLD",8586,"KRN",9.8,"NM",38,0)
FBCHVH^^0^B31027719
"BLD",8586,"KRN",9.8,"NM",39,0)
FBAAPIN^^0^B34775282
"BLD",8586,"KRN",9.8,"NM",40,0)
FBPAY67^^0^B41443321
"BLD",8586,"KRN",9.8,"NM",42,0)
FBPCR67^^0^B27748859
"BLD",8586,"KRN",9.8,"NM",43,0)
FBPAY671^^0^B38061313
"BLD",8586,"KRN",9.8,"NM",44,0)
FBPCR671^^0^B46739204
"BLD",8586,"KRN",9.8,"NM",46,0)
FBAACFE^^0^B1826171
"BLD",8586,"KRN",9.8,"NM",47,0)
FBAACP1^^0^B6956346
"BLD",8586,"KRN",9.8,"NM",48,0)
FBAAUTL^^0^B24039594
"BLD",8586,"KRN",9.8,"NM",49,0)
FBAAUTL1^^0^B21242092
"BLD",8586,"KRN",9.8,"NM","B","FBAA79",18)

"BLD",8586,"KRN",9.8,"NM","B","FBAACCB1",37)

"BLD",8586,"KRN",9.8,"NM","B","FBAACFE",46)

"BLD",8586,"KRN",9.8,"NM","B","FBAACO",19)

"BLD",8586,"KRN",9.8,"NM","B","FBAACO1",29)

"BLD",8586,"KRN",9.8,"NM","B","FBAACO2",30)

"BLD",8586,"KRN",9.8,"NM","B","FBAACO3",31)

"BLD",8586,"KRN",9.8,"NM","B","FBAACP",34)

"BLD",8586,"KRN",9.8,"NM","B","FBAACP1",47)

"BLD",8586,"KRN",9.8,"NM","B","FBAADEM1",16)

"BLD",8586,"KRN",9.8,"NM","B","FBAAMP",35)

"BLD",8586,"KRN",9.8,"NM","B","FBAAODP0",20)

"BLD",8586,"KRN",9.8,"NM","B","FBAAPET",32)

"BLD",8586,"KRN",9.8,"NM","B","FBAAPIE1",22)

"BLD",8586,"KRN",9.8,"NM","B","FBAAPIN",39)

"BLD",8586,"KRN",9.8,"NM","B","FBAAPM",21)

"BLD",8586,"KRN",9.8,"NM","B","FBAAUTL",48)

"BLD",8586,"KRN",9.8,"NM","B","FBAAUTL1",49)

"BLD",8586,"KRN",9.8,"NM","B","FBAAV0",11)

"BLD",8586,"KRN",9.8,"NM","B","FBAAV01",12)

"BLD",8586,"KRN",9.8,"NM","B","FBAAV2",10)

"BLD",8586,"KRN",9.8,"NM","B","FBAAV5",15)

"BLD",8586,"KRN",9.8,"NM","B","FBAAV6",9)

"BLD",8586,"KRN",9.8,"NM","B","FBCH78",3)

"BLD",8586,"KRN",9.8,"NM","B","FBCHCD",4)

"BLD",8586,"KRN",9.8,"NM","B","FBCHEP",5)

"BLD",8586,"KRN",9.8,"NM","B","FBCHEP1",6)

"BLD",8586,"KRN",9.8,"NM","B","FBCHPET",33)

"BLD",8586,"KRN",9.8,"NM","B","FBCHRR",36)

"BLD",8586,"KRN",9.8,"NM","B","FBCHVH",38)

"BLD",8586,"KRN",9.8,"NM","B","FBNHEA",23)

"BLD",8586,"KRN",9.8,"NM","B","FBNHED",24)

"BLD",8586,"KRN",9.8,"NM","B","FBNHEDAT",25)

"BLD",8586,"KRN",9.8,"NM","B","FBNHEP",14)

"BLD",8586,"KRN",9.8,"NM","B","FBNHEP2",13)

"BLD",8586,"KRN",9.8,"NM","B","FBNHET",26)

"BLD",8586,"KRN",9.8,"NM","B","FBNHRC",27)

"BLD",8586,"KRN",9.8,"NM","B","FBPAY67",40)

"BLD",8586,"KRN",9.8,"NM","B","FBPAY671",43)

"BLD",8586,"KRN",9.8,"NM","B","FBPCR67",42)

"BLD",8586,"KRN",9.8,"NM","B","FBPCR671",44)

"BLD",8586,"KRN",9.8,"NM","B","FBPRICE",7)

"BLD",8586,"KRN",9.8,"NM","B","FBPRICE1",8)

"BLD",8586,"KRN",9.8,"NM","B","FBSHAUT",28)

"BLD",8586,"KRN",9.8,"NM","B","FBUTL7",2)

"BLD",8586,"KRN",9.8,"NM","B","FBXIP108",1)

"BLD",8586,"KRN",19,0)
19
"BLD",8586,"KRN",19,"NM",0)
^9.68A^8^7
"BLD",8586,"KRN",19,"NM",2,0)
FBAA SUPERVISOR OPTIONS^^2
"BLD",8586,"KRN",19,"NM",3,0)
FBUC FILE MENU^^0
"BLD",8586,"KRN",19,"NM",4,0)
FBUC DISPOSITIONS FILE^^4^
"BLD",8586,"KRN",19,"NM",5,0)
FBUC ADD NEW PERSON^^4^
"BLD",8586,"KRN",19,"NM",6,0)
FBUC DISAPPROVAL REASONS FILE^^4^
"BLD",8586,"KRN",19,"NM",7,0)
FBUC REQUEST INFO FILE^^4^
"BLD",8586,"KRN",19,"NM",8,0)
FBAA CONTRACT FILE^^0
"BLD",8586,"KRN",19,"NM","B","FBAA CONTRACT FILE",8)

"BLD",8586,"KRN",19,"NM","B","FBAA SUPERVISOR OPTIONS",2)

"BLD",8586,"KRN",19,"NM","B","FBUC ADD NEW PERSON",5)

"BLD",8586,"KRN",19,"NM","B","FBUC DISAPPROVAL REASONS FILE",6)

"BLD",8586,"KRN",19,"NM","B","FBUC DISPOSITIONS FILE",4)

"BLD",8586,"KRN",19,"NM","B","FBUC FILE MENU",3)

"BLD",8586,"KRN",19,"NM","B","FBUC REQUEST INFO FILE",7)

"BLD",8586,"KRN",19.1,0)
19.1
"BLD",8586,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",8586,"KRN",101,0)
101
"BLD",8586,"KRN",101,"NM",0)
^9.68A^^
"BLD",8586,"KRN",409.61,0)
409.61
"BLD",8586,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",8586,"KRN",771,0)
771
"BLD",8586,"KRN",779.2,0)
779.2
"BLD",8586,"KRN",870,0)
870
"BLD",8586,"KRN",8989.51,0)
8989.51
"BLD",8586,"KRN",8989.52,0)
8989.52
"BLD",8586,"KRN",8994,0)
8994
"BLD",8586,"KRN","B",.4,.4)

"BLD",8586,"KRN","B",.401,.401)

"BLD",8586,"KRN","B",.402,.402)

"BLD",8586,"KRN","B",.403,.403)

"BLD",8586,"KRN","B",.5,.5)

"BLD",8586,"KRN","B",.84,.84)

"BLD",8586,"KRN","B",3.6,3.6)

"BLD",8586,"KRN","B",3.8,3.8)

"BLD",8586,"KRN","B",9.2,9.2)

"BLD",8586,"KRN","B",9.8,9.8)

"BLD",8586,"KRN","B",19,19)

"BLD",8586,"KRN","B",19.1,19.1)

"BLD",8586,"KRN","B",101,101)

"BLD",8586,"KRN","B",409.61,409.61)

"BLD",8586,"KRN","B",771,771)

"BLD",8586,"KRN","B",779.2,779.2)

"BLD",8586,"KRN","B",870,870)

"BLD",8586,"KRN","B",8989.51,8989.51)

"BLD",8586,"KRN","B",8989.52,8989.52)

"BLD",8586,"KRN","B",8994,8994)

"BLD",8586,"QDEF")
^^^^NO^^^^YES^^NO
"BLD",8586,"QUES",0)
^9.62^^
"BLD",8586,"REQB",0)
^9.611^8^8
"BLD",8586,"REQB",1,0)
FB*3.5*25^2
"BLD",8586,"REQB",2,0)
FB*3.5*67^2
"BLD",8586,"REQB",3,0)
FB*3.5*68^2
"BLD",8586,"REQB",4,0)
FB*3.5*79^2
"BLD",8586,"REQB",5,0)
FB*3.5*82^2
"BLD",8586,"REQB",6,0)
FB*3.5*98^2
"BLD",8586,"REQB",7,0)
FB*3.5*103^2
"BLD",8586,"REQB",8,0)
FB*3.5*116^2
"BLD",8586,"REQB","B","FB*3.5*103",7)

"BLD",8586,"REQB","B","FB*3.5*116",8)

"BLD",8586,"REQB","B","FB*3.5*25",1)

"BLD",8586,"REQB","B","FB*3.5*67",2)

"BLD",8586,"REQB","B","FB*3.5*68",3)

"BLD",8586,"REQB","B","FB*3.5*79",4)

"BLD",8586,"REQB","B","FB*3.5*82",5)

"BLD",8586,"REQB","B","FB*3.5*98",6)

"DATA",161.94,1,0)
Y^Diagnosis was present at time of inpatient admission.
"DATA",161.94,1,1,0)
^^1^1^3081120^
"DATA",161.94,1,1,1,0)
Diagnosis was present at time of inpatient admission.
"DATA",161.94,2,0)
N^Diagnosis was not present at time of inpatient admission.
"DATA",161.94,2,1,0)
^^1^1^3081120^
"DATA",161.94,2,1,1,0)
Diagnosis was not present at time of inpatient admission.
"DATA",161.94,3,0)
U^Documentation insufficient to determine.
"DATA",161.94,3,1,0)
^161.942^2^2^3081120^^
"DATA",161.94,3,1,1,0)
Documentation insufficient to determine if the condition was present at 
"DATA",161.94,3,1,2,0)
the time of inpatient admission.
"DATA",161.94,4,0)
W^Provider unable to clinically determine.
"DATA",161.94,4,1,0)
^161.942^2^2^3081120^^
"DATA",161.94,4,1,1,0)
Clinically undetermined.  Provider unable to clinically determine whether 
"DATA",161.94,4,1,2,0)
the condition was present at the time of inpatient admission.
"DATA",161.94,5,0)
1^Unreported/Not used.  Exempt from POA reporting.
"DATA",161.94,5,1,0)
^^3^3^3081120^
"DATA",161.94,5,1,1,0)
Unreported/Not used.  Exempt from POA reporting.  This code is equivalent 
"DATA",161.94,5,1,2,0)
to a blank on the UB-04, however; it was determined that blanks are 
"DATA",161.94,5,1,3,0)
undesirable when submitting this data via the 4010A.
"FIA",161)
FEE BASIS PATIENT
"FIA",161,0)
^FBAAA(
"FIA",161,0,0)
161P
"FIA",161,0,1)
y^y^p^^^^n^^n
"FIA",161,0,10)

"FIA",161,0,11)

"FIA",161,0,"RLRO")

"FIA",161,0,"VR")
3.5^FB
"FIA",161,161)
1
"FIA",161,161.01)
1
"FIA",161,161.01,105)

"FIA",161.4)
FEE BASIS SITE PARAMETERS
"FIA",161.4,0)
^FBAA(161.4,
"FIA",161.4,0,0)
161.4
"FIA",161.4,0,1)
y^y^p^^^^n^^n
"FIA",161.4,0,10)

"FIA",161.4,0,11)

"FIA",161.4,0,"RLRO")

"FIA",161.4,0,"VR")
3.5^FB
"FIA",161.4,161.4)
1
"FIA",161.4,161.4,17)

"FIA",161.4,161.4,17.1)

"FIA",161.4,161.4,17.2)

"FIA",161.43)
FEE BASIS CONTRACT
"FIA",161.43,0)
^FBAA(161.43,
"FIA",161.43,0,0)
161.43I
"FIA",161.43,0,1)
y^y^f^^^^n
"FIA",161.43,0,10)

"FIA",161.43,0,11)

"FIA",161.43,0,"RLRO")

"FIA",161.43,0,"VR")
3.5^FB
"FIA",161.43,161.43)
0
"FIA",161.43,161.433)
0
"FIA",161.94)
PRESENT ON ADMISSION
"FIA",161.94,0)
^FB(161.94,
"FIA",161.94,0,0)
161.94I
"FIA",161.94,0,1)
y^y^f^^n^^y^o^n
"FIA",161.94,0,10)

"FIA",161.94,0,11)

"FIA",161.94,0,"RLRO")

"FIA",161.94,0,"VR")
3.5^FB
"FIA",161.94,161.94)
0
"FIA",161.94,161.942)
0
"FIA",162)
FEE BASIS PAYMENT
"FIA",162,0)
^FBAAC(
"FIA",162,0,0)
162P
"FIA",162,0,1)
y^y^p^^^^n^^n
"FIA",162,0,10)

"FIA",162,0,11)

"FIA",162,0,"RLRO")

"FIA",162,0,"VR")
3.5^FB
"FIA",162,162)
1
"FIA",162,162.03)
1
"FIA",162,162.03,54)

"FIA",162.4)
VA FORM 10-7078
"FIA",162.4,0)
^FB7078(
"FIA",162.4,0,0)
162.4I
"FIA",162.4,0,1)
y^y^p^^^^n^^n
"FIA",162.4,0,10)

"FIA",162.4,0,11)

"FIA",162.4,0,"RLRO")

"FIA",162.4,0,"VR")
3.5^FB
"FIA",162.4,162.4)
1
"FIA",162.4,162.4,6)

"FIA",162.5)
FEE BASIS INVOICE
"FIA",162.5,0)
^FBAAI(
"FIA",162.5,0,0)
162.5
"FIA",162.5,0,1)
y^y^p^^^^n^^n
"FIA",162.5,0,10)

"FIA",162.5,0,11)

"FIA",162.5,0,"RLRO")

"FIA",162.5,0,"VR")
3.5^FB
"FIA",162.5,162.5)
1
"FIA",162.5,162.5,6.6)

"FIA",162.5,162.5,7)

"FIA",162.5,162.5,8)

"FIA",162.5,162.5,9)

"FIA",162.5,162.5,26)

"FIA",162.5,162.5,30.02)

"FIA",162.5,162.5,31.02)

"FIA",162.5,162.5,32.02)

"FIA",162.5,162.5,33.02)

"FIA",162.5,162.5,34.02)

"FIA",162.5,162.5,35)

"FIA",162.5,162.5,35.02)

"FIA",162.5,162.5,35.1)

"FIA",162.5,162.5,35.12)

"FIA",162.5,162.5,35.2)

"FIA",162.5,162.5,35.22)

"FIA",162.5,162.5,35.3)

"FIA",162.5,162.5,35.32)

"FIA",162.5,162.5,35.4)

"FIA",162.5,162.5,35.42)

"FIA",162.5,162.5,35.5)

"FIA",162.5,162.5,35.52)

"FIA",162.5,162.5,35.6)

"FIA",162.5,162.5,35.62)

"FIA",162.5,162.5,35.7)

"FIA",162.5,162.5,35.72)

"FIA",162.5,162.5,35.8)

"FIA",162.5,162.5,35.82)

"FIA",162.5,162.5,35.9)

"FIA",162.5,162.5,35.92)

"FIA",162.5,162.5,36)

"FIA",162.5,162.5,36.02)

"FIA",162.5,162.5,36.1)

"FIA",162.5,162.5,36.12)

"FIA",162.5,162.5,36.2)

"FIA",162.5,162.5,36.22)

"FIA",162.5,162.5,36.3)

"FIA",162.5,162.5,36.32)

"FIA",162.5,162.5,36.4)

"FIA",162.5,162.5,36.42)

"FIA",162.5,162.5,36.5)

"FIA",162.5,162.5,36.52)

"FIA",162.5,162.5,36.6)

"FIA",162.5,162.5,36.62)

"FIA",162.5,162.5,36.7)

"FIA",162.5,162.5,36.72)

"FIA",162.5,162.5,36.8)

"FIA",162.5,162.5,36.82)

"FIA",162.5,162.5,36.9)

"FIA",162.5,162.5,36.92)

"FIA",162.5,162.5,39)

"FIA",162.5,162.5,44.06)

"FIA",162.5,162.5,44.07)

"FIA",162.5,162.5,44.08)

"FIA",162.5,162.5,44.09)

"FIA",162.5,162.5,44.1)

"FIA",162.5,162.5,44.11)

"FIA",162.5,162.5,44.12)

"FIA",162.5,162.5,44.13)

"FIA",162.5,162.5,44.14)

"FIA",162.5,162.5,44.15)

"FIA",162.5,162.5,44.16)

"FIA",162.5,162.5,44.17)

"FIA",162.5,162.5,44.18)

"FIA",162.5,162.5,44.19)

"FIA",162.5,162.5,44.2)

"FIA",162.5,162.5,44.21)

"FIA",162.5,162.5,44.22)

"FIA",162.5,162.5,44.23)

"FIA",162.5,162.5,44.24)

"FIA",162.5,162.5,44.25)

"FIA",162.5,162.5,60)

"FIA",162.5,162.5,79)

"FIA",162.5,162.558)
1
"FIA",162.5,162.558,2)

"FIA",162.5,162.579)
1
"FIA",162.5,162.579,.01)

"FIA",162.7)
FEE BASIS UNAUTHORIZED CLAIMS
"FIA",162.7,0)
^FB583(
"FIA",162.7,0,0)
162.7ID
"FIA",162.7,0,1)
y^y^p^^^^n^^n
"FIA",162.7,0,10)

"FIA",162.7,0,11)

"FIA",162.7,0,"RLRO")

"FIA",162.7,0,"VR")
3.5^FB
"FIA",162.7,162.7)
1
"FIA",162.7,162.7,8)

"FIA",162.7,162.7,14)

"INI")
PR^FBXIP108
"INIT")
PS^FBXIP108
"IX",161,161,"ACN",0)
161^ACN^Index of contracts.^R^^F^IR^W^161.01^^^^^S
"IX",161,161,"ACN",.1,0)
^^3^3^3090522^
"IX",161,161,"ACN",.1,1,0)
This is an index of contracts entered for fee authorizations. The index
"IX",161,161,"ACN",.1,2,0)
will be used to prevent deletion of entries from the FEE BASIS CONTRACT
"IX",161,161,"ACN",.1,3,0)
file that are referenced (pointed to) by an authorization.
"IX",161,161,"ACN",1)
S ^FBAAA("ACN",X,DA(1),DA)=""
"IX",161,161,"ACN",2)
K ^FBAAA("ACN",X,DA(1),DA)
"IX",161,161,"ACN",2.5)
K ^FBAAA("ACN")
"IX",161,161,"ACN",11.1,0)
^.114IA^1^1
"IX",161,161,"ACN",11.1,1,0)
1^F^161.01^105^^1^F
"IX",161.43,161.43,"AV",0)
161.43^AV^Vendor whole file cross-reference.^R^^F^IR^W^161.433^^^^^S
"IX",161.43,161.43,"AV",.1,0)
^^1^1^3090527^
"IX",161.43,161.43,"AV",.1,1,0)
This is a while file cross-reference of vendors.
"IX",161.43,161.43,"AV",1)
S ^FBAA(161.43,"AV",X,DA(1),DA)=""
"IX",161.43,161.43,"AV",2)
K ^FBAA(161.43,"AV",X,DA(1),DA)
"IX",161.43,161.43,"AV",2.5)
K ^FBAA(161.43,"AV")
"IX",161.43,161.43,"AV",11.1,0)
^.114IA^1^1
"IX",161.43,161.43,"AV",11.1,1,0)
1^F^161.433^.01^^1^F
"KRN",.402,342,-1)
0^1
"KRN",.402,342,0)
FBAA AUTHORIZATION^3090602.172^^161^^^3120104
"KRN",.402,342,"%D",0)
^^1^1^2951204^^
"KRN",.402,342,"%D",1,0)
This template is used for creating new authorizations for Fee Basis.
"KRN",.402,342,"DIAB",2,1,161.01,3)
101;T
"KRN",.402,342,"DR",1,161)
S FBPRG="";1;I '$D(FBAATT) S Y="";I FBAATT'=3 S Y="";Q;S HID=$S($D(^FBAAA(DA,4)):$P(^(4),"^"),1:"");.5;Q;S NID=X;.6//^S X="TODAY";S Y=$S(HID="":"",HID=NID:"",NID="":.65,1:.7);.65;.7;S NIDR=X;
"KRN",.402,342,"DR",2,161.01)
S FBAOLD=^FBAAA(DA(1),1,DA,0),FBAALT=$S($P(FBAOLD,"^",13)=2:"Y",$P(FBAOLD,"^",13)=3:"Y",1:""),FBPRG=$P(FBAOLD,"^",3);I FBPRG,FBPRG'=2 W !!,*7,"You are only allowed to edit an outpatient authorization using this option.",!! S Y="";
"KRN",.402,342,"DR",2,161.01,1)
@1;.01;S FBTODT=X;I $P(FBAOLD,U,2)']"" S Y="@2";I X'>$P(FBAOLD,U,2) S Y="@2";.01////^S X=+FBAOLD;W !,*7,"From Date cannot be later than the To Date!";S Y="@1";@2;
"KRN",.402,342,"DR",2,161.01,2)
S:'$D(FBAADDYS) FBAADDYS=0 S X1=FBTODT,X2=FBAADDYS D C^%DTC S FBAAX=X;S FBD1=DA;.02//^S X=$E(FBAAX,4,5)_"-"_$E(FBAAX,6,7)_"-"_($E(FBAAX,1,3)+1700);I $P(^FBAAA(DA(1),1,DA,0),"^",7)]"" K DIE("NO^");.03////^S X=$S(FBPRG:FBPRG,1:2);
"KRN",.402,342,"DR",2,161.01,3)
S FBTYPE=$S(FBPRG:FBPRG,1:2);101T~;104;I $G(X) W !,"REFERRING PROVIDER NPI: ",$$REFNPI^FBCH78(X);@4;.07;S:$$EXTPV^FBAAUTL5(X)'=55 Y="@5";S:$P($$GETSTAT^DGMSTAPI(DA(1)),U,2)="Y" Y="@5";S DIE("NO^")="";
"KRN",.402,342,"DR",2,161.01,4)
W !,$C(7),"MST POV can't be selected because veteran's MST status is not YES.";S Y="@4";@5;.065;.095;S FBAATT=X;S FBAALT=$S(X=2:"Y",X=3:"Y",1:"");K DIE("NO^");.08;S:X="" Y=.021;.085;S:X="" Y=.021;.086;.021;2;
"KRN",.402,342,"DR",2,161.01,5)
S:'$D(FBAAASKV) FBAAASKV="N";S:FBAAASKV'="y" Y=100;.04;Q;S FBEDCNTR=$$EDCNTRA^FBUTL7(DA(1),DA);S:'$P(FBEDCNTR,"^") Y="@11";105;S Y="@12";@11;W:$P(FBEDCNTR,"^",2)]"" !,$P(FBEDCNTR,"^",2);@12;K FBEDCNTR;100////^S X=DUZ;W !!;.096;
"KRN",.402,342,"DR",2,161.01,6)
.097//^S X="NO";1//^S X="YES";S FBAAP79=$S(X["Y":"Y",1:"");I X["Y" S Y="";1///^S X="@";
"KRN",.402,342,"ROU")
^FBCTAU
"KRN",.402,342,"ROUOLD")
FBCTAU
"KRN",.402,362,-1)
0^2
"KRN",.402,362,0)
FBCH ENTER PAYMENT^3120228.1138^^162.5^^^3120228
"KRN",.402,362,"DIAB",2,0,162.5,4)
31.02;REQ
"KRN",.402,362,"DIAB",2,0,162.5,5)
34.02;REQ
"KRN",.402,362,"DIAB",2,0,162.5,6)
35.22;REQ
"KRN",.402,362,"DIAB",2,0,162.5,7)
35.52;REQ
"KRN",.402,362,"DIAB",2,0,162.5,8)
35.82;REQ
"KRN",.402,362,"DIAB",2,0,162.5,9)
36.12;REQ
"KRN",.402,362,"DIAB",2,0,162.5,10)
36.42;REQ
"KRN",.402,362,"DIAB",2,0,162.5,11)
36.72;REQ
"KRN",.402,362,"DIAB",7,0,162.5,4)
32.02;REQ
"KRN",.402,362,"DIAB",7,0,162.5,5)
35.02;REQ
"KRN",.402,362,"DIAB",7,0,162.5,6)
35.32;REQ
"KRN",.402,362,"DIAB",7,0,162.5,7)
35.62;REQ
"KRN",.402,362,"DIAB",7,0,162.5,8)
35.92;REQ
"KRN",.402,362,"DIAB",7,0,162.5,9)
36.22;REQ
"KRN",.402,362,"DIAB",7,0,162.5,10)
36.52;REQ
"KRN",.402,362,"DIAB",7,0,162.5,11)
36.82;REQ
"KRN",.402,362,"DIAB",12,0,162.5,4)
33.02;REQ
"KRN",.402,362,"DIAB",12,0,162.5,5)
35.12;REQ
"KRN",.402,362,"DIAB",12,0,162.5,6)
35.42;REQ
"KRN",.402,362,"DIAB",12,0,162.5,7)
35.72;REQ
"KRN",.402,362,"DIAB",12,0,162.5,8)
36.02;REQ
"KRN",.402,362,"DIAB",12,0,162.5,9)
36.32;REQ
"KRN",.402,362,"DIAB",12,0,162.5,10)
36.62;REQ
"KRN",.402,362,"DIAB",12,0,162.5,11)
36.92;REQ
"KRN",.402,362,"DIAB",24,0,162.5,3)
30.02;REQ
"KRN",.402,362,"DR",1,162.5)
1////^S X=FBAAID;46////^S X=FBAAVID;55///^S X=FBCSID;56///^S X=$G(FBFPPSC);57///^S X=$G(FBFPPSL);47////^S X=FBAAMM1;2////^S X=FBVEN;3////^S X=FBVET;60////^S X=$G(FBCNTRP);4////^S X=FBI7078;5////^S X=FBAABDT;6////^S X=FBAAEDT;
"KRN",.402,362,"DR",1,162.5,1)
23////^S X=FBPSA;21////^S X=FBPOV;22////^S X=FBPT;11////^S X=FBTYPE;12////^S X=FBAAPTC;20////^S X=FBAABE;W !;6.5;54//^S X=$G(FBCDAYS);6.6;I 1;7;S FBAMTC=X;I $G(FBEXMPT)'="Y" S Y="@25";S:FBI7078'["FB583" Y=8;
"KRN",.402,362,"DR",1,162.5,2)
S:'$P($G(^FB583(+FBI7078,0)),U,28) Y=8;W !?2,"**Payment is for emergency treatment under 38 U.S.C. 1725.";8;S FBAMTP=X;I FBAMTC=FBAMTP S Y="@25";S FBX=$$ADJ^FBUTL2(FBAMTC-FBAMTP,.FBADJ,1,,,1);@20;I $G(FBEXMPT)="Y" S Y="@25";@26;24;
"KRN",.402,362,"DR",1,162.5,3)
I $$INPICD^FBCSV1(X,$G(DA),FBAABDT) S Y="@26";@25;6.7;I 1;64;65;66;67;68;69;70;71;72;73;80;81;82;83;74;75;@30;30;I $$INPICD9^FBCSV1(X,$G(DA),FBAABDT) S Y="@30";30.02R~;@31;31;S:X="" Y="@57";
"KRN",.402,362,"DR",1,162.5,4)
I $$INPICD9^FBCSV1(X,$G(DA),FBAABDT) S Y="@31";31.02R~;@32;32;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA),FBAABDT) S Y="@32";32.02R~;@33;33;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA),FBAABDT) S Y="@33";33.02R~;@34;34;S:X="" Y="@57";
"KRN",.402,362,"DR",1,162.5,5)
I $$INPICD9^FBCSV1(X,$G(DA),FBAABDT) S Y="@34";34.02R~;@35;35;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@35";35.02R~;@36;35.1;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@36";35.12R~;@37;35.2;S:X="" Y="@57";
"KRN",.402,362,"DR",1,162.5,6)
I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@37";35.22R~;@38;35.3;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@38";35.32R~;@39;35.4;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@39";35.42R~;@40;35.5;S:X="" Y="@57";
"KRN",.402,362,"DR",1,162.5,7)
I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@40";35.52R~;@41;35.6;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@41";35.62R~;@42;35.7;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@42";35.72R~;@43;35.8;S:X="" Y="@57";
"KRN",.402,362,"DR",1,162.5,8)
I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@43";35.82R~;@44;35.9;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@44";35.92R~;@45;36;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@45";36.02R~;@46;36.1;S:X="" Y="@57";
"KRN",.402,362,"DR",1,162.5,9)
I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@46";36.12R~;@47;36.2;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@47";36.22R~;@48;36.3;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@48";36.32R~;@49;36.4;S:X="" Y="@57";
"KRN",.402,362,"DR",1,162.5,10)
I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@49";36.42R~;@50;36.5;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@50";36.52R~;@51;36.6;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@51";36.62R~;@52;36.7;S:X="" Y="@57";
"KRN",.402,362,"DR",1,162.5,11)
I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@52";36.72R~;@53;36.8;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@53";36.82R~;@54;36.9;S:X="" Y="@57";I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@54";36.92R~;@57;39;
"KRN",.402,362,"DR",1,162.5,12)
S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@57";@60;40;S:X="" Y="@99";I $$INPICD0^FBCSV1(X,$G(DA),FBAABDT) S Y="@60";@61;41;S:X="" Y="@99";I $$INPICD0^FBCSV1(X,$G(DA),FBAABDT) S Y="@61";@62;42;S:X="" Y="@99";
"KRN",.402,362,"DR",1,162.5,13)
I $$INPICD0^FBCSV1(X,$G(DA),FBAABDT) S Y="@62";@63;43;S:X="" Y="@99";I $$INPICD0^FBCSV1(X,$G(DA),FBAABDT) S Y="@63";@64;44;S:X="" Y="@99";I $$INPICD0^FBCSV1(X,$G(DA),FBAABDT) S Y="@64";@65;44.06;S:X="" Y="@99";
"KRN",.402,362,"DR",1,162.5,14)
S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@65";@66;44.07;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@66";@67;44.08;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@67";@68;44.09;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@68";@69;
"KRN",.402,362,"DR",1,162.5,15)
44.1;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@69";@70;44.11;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@70";@71;44.12;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@71";@72;44.13;S:X="" Y="@99";
"KRN",.402,362,"DR",1,162.5,16)
S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@72";@73;44.14;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@73";@74;44.15;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@74";@75;44.16;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@75";@76;
"KRN",.402,362,"DR",1,162.5,17)
44.17;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@76";@77;44.18;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@77";@78;44.19;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@78";@79;44.2;S:X="" Y="@99";
"KRN",.402,362,"DR",1,162.5,18)
S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@79";@80;44.21;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@80";@81;44.22;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@81";@82;44.23;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@82";@83;
"KRN",.402,362,"DR",1,162.5,19)
44.24;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@83";@84;44.25;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@84";@99;I $D(^FBAAI(DA,"DX")),$P(^("DX"),U)="" W !!,*7,"The 'ICD1' field is a manditory field!",! S Y="@30";
"KRN",.402,362,"DR",1,162.5,20)
S FBX=$$RPROV^FBUTL8(.FBPROV,.FBPROVD);I $G(FBEXMPT)'="Y" S Y="@992";S FBX=$$RR^FBUTL4(.FBRRMK,2);@992;25////^S X=FBRESUB;
"KRN",.402,363,-1)
0^3
"KRN",.402,363,0)
FBCH EDIT PAYMENT^3120215.1152^^162.5^^^3120310
"KRN",.402,363,"DIAB",2,0,162.5,4)
24.5;REQ
"KRN",.402,363,"DIAB",2,0,162.5,9)
35.32;REQ
"KRN",.402,363,"DIAB",2,0,162.5,11)
35.62;REQ
"KRN",.402,363,"DIAB",2,0,162.5,13)
35.92;REQ
"KRN",.402,363,"DIAB",2,0,162.5,15)
36.22;REQ
"KRN",.402,363,"DIAB",2,0,162.5,17)
36.52;REQ
"KRN",.402,363,"DIAB",2,0,162.5,19)
36.82;REQ
"KRN",.402,363,"DIAB",3,0,162.5,7)
35.02;REQ
"KRN",.402,363,"DIAB",6,0,162.5,4)
30.02;REQ
"KRN",.402,363,"DIAB",6,0,162.5,5)
32.02;REQ
"KRN",.402,363,"DIAB",7,0,162.5,10)
35.52;REQ
"KRN",.402,363,"DIAB",7,0,162.5,12)
35.82;REQ
"KRN",.402,363,"DIAB",7,0,162.5,14)
36.12;REQ
"KRN",.402,363,"DIAB",7,0,162.5,16)
36.42;REQ
"KRN",.402,363,"DIAB",7,0,162.5,18)
36.72;REQ
"KRN",.402,363,"DIAB",9,0,162.5,8)
35.22;REQ
"KRN",.402,363,"DIAB",10,0,162.5,3)
24;REQ
"KRN",.402,363,"DIAB",10,0,162.5,6)
34.02;REQ
"KRN",.402,363,"DIAB",11,0,162.5,4)
31.02;REQ
"KRN",.402,363,"DIAB",12,0,162.5,9)
35.42;REQ
"KRN",.402,363,"DIAB",12,0,162.5,11)
35.72;REQ
"KRN",.402,363,"DIAB",12,0,162.5,13)
36.02;REQ
"KRN",.402,363,"DIAB",12,0,162.5,15)
36.32;REQ
"KRN",.402,363,"DIAB",12,0,162.5,17)
36.62;REQ
"KRN",.402,363,"DIAB",12,0,162.5,19)
36.92;REQ
"KRN",.402,363,"DIAB",13,0,162.5,7)
35.12;REQ
"KRN",.402,363,"DIAB",16,0,162.5,5)
33.02;REQ
"KRN",.402,363,"DR",1,162.5)
1;I 1;46;55;S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="" Y="@10";56///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL,1);S:FBX=-1 Y=0;57///^S X=FBX;S FBFPPSL=X;S Y="@14";@10;56///@;S FBFPPSC="";57///@;S FBFPPSL="";@14;
"KRN",.402,363,"DR",1,162.5,1)
S FBV=$P($G(^FBAAI(DA,0)),U,3);S FBAAMM=$S($G(FBAAPTC)="R":"",$D(FB583):"",1:1);D PPT^FBAACO1($G(FBAAMM1),$G(FBCNTRP));47////@;47///^S X=FBAAMM1;60///@;60////^S X=$G(FBCNTRP);6.5;54;6.6;I 1;6.7;64;65;66;67;68;69;70;71;72;73;80;81;
"KRN",.402,363,"DR",1,162.5,2)
82;83;74;75;S DIE("NO^")="NO QUIT";7;S:$D(FBPRICE) Y="@20";S FBJJ=X;I $G(FBEXMPT)="Y" S Y="@16";26;S FBPAMT=X;@16;W:FB1725 !?2,"**Payment is for emergency treatment under 38 U.S.C. 1725.";
"KRN",.402,363,"DR",1,162.5,3)
W:FB1725&($G(FBPAMT)>0) !?2,"  70% of Pricer Amount = "_$J(.7*FBPAMT,0,2);8;S FBKK=X;K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(FBJJ-FBKK,.FBADJ,1,,.FBADJD,1);K FBADJD;I $G(FBEXMPT)="Y" S Y=30;@18;24R~;
"KRN",.402,363,"DR",1,162.5,4)
I $$INPICD^FBCSV1(X,$G(DA)) S Y="@18";24.5R~;@20;30;S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@20";30.02R~;@22;31;S:X="" Y="@23";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@22";31.02R~;S:$G(LASTDX)<2 LASTDX=2;S Y="@24";@23;31.02///@;
"KRN",.402,363,"DR",1,162.5,5)
S:$G(LASTDX)'>2 Y="@70";@24;32;S:X="" Y="@25";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@24";32.02R~;S:$G(LASTDX)<3 LASTDX=3;S Y="@26";@25;32.02///@;S:$G(LASTDX)'>3 Y="@70";@26;33;S:X="" Y="@27";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@26";33.02R~;
"KRN",.402,363,"DR",1,162.5,6)
S:$G(LASTDX)<4 LASTDX=4;S Y="@28";@27;33.02///@;S:$G(LASTDX)'>4 Y="@70";@28;34;S:X="" Y="@29";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@28";34.02R~;S:$G(LASTDX)<5 LASTDX=5;S Y="@30";@29;34.02///@;S:$G(LASTDX)'>5 Y="@70";@30;35;
"KRN",.402,363,"DR",1,162.5,7)
S:X="" Y="@31";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@30";35.02R~;S:$G(LASTDX)<6 LASTDX=6;S Y="@32";@31;35.02///@;S:$G(LASTDX)'>6 Y="@70";@32;35.1;S:X="" Y="@33";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@32";35.12R~;S:$G(LASTDX)<7 LASTDX=7;
"KRN",.402,363,"DR",1,162.5,8)
S Y="@34";@33;35.12///@;S:$G(LASTDX)'>7 Y="@70";@34;35.2;S:X="" Y="@35";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@34";35.22R~;S:$G(LASTDX)<8 LASTDX=8;S Y="@36";@35;35.22///@;S:$G(LASTDX)'>8 Y="@70";@36;35.3;S:X="" Y="@37";
"KRN",.402,363,"DR",1,162.5,9)
S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@36";35.32R~;S:$G(LASTDX)<9 LASTDX=9;S Y="@38";@37;35.32///@;S:$G(LASTDX)'>9 Y="@70";@38;35.4;S:X="" Y="@39";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@38";35.42R~;S:$G(LASTDX)<10 LASTDX=10;S Y="@40";@39;
"KRN",.402,363,"DR",1,162.5,10)
35.42///@;S:$G(LASTDX)'>10 Y="@70";@40;35.5;S:X="" Y="@41";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@40";35.52R~;S:$G(LASTDX)<11 LASTDX=11;S Y="@42";@41;35.52///@;S:$G(LASTDX)'>11 Y="@70";@42;35.6;S:X="" Y="@43";
"KRN",.402,363,"DR",1,162.5,11)
S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@42";35.62R~;S:$G(LASTDX)<12 LASTDX=12;S Y="@44";@43;35.62///@;S:$G(LASTDX)'>12 Y="@70";@44;35.7;S:X="" Y="@45";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@44";35.72R~;S:$G(LASTDX)<13 LASTDX=13;S Y="@46";@45;
"KRN",.402,363,"DR",1,162.5,12)
35.72///@;S:$G(LASTDX)'>13 Y="@70";@46;35.8;S:X="" Y="@47";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@46";35.82R~;S:$G(LASTDX)<14 LASTDX=14;S Y="@48";@47;35.82///@;S:$G(LASTDX)'>14 Y="@70";@48;35.9;S:X="" Y="@49";
"KRN",.402,363,"DR",1,162.5,13)
S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@48";35.92R~;S:$G(LASTDX)<15 LASTDX=15;S Y="@50";@49;35.92///@;S:$G(LASTDX)'>15 Y="@70";@50;36;S:X="" Y="@51";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@50";36.02R~;S:$G(LASTDX)<16 LASTDX=16;S Y="@52";@51;
"KRN",.402,363,"DR",1,162.5,14)
36.02///@;S:$G(LASTDX)'>16 Y="@70";@52;36.1;S:X="" Y="@53";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@52";36.12R~;S:$G(LASTDX)<17 LASTDX=17;S Y="@54";@53;36.12///@;S:$G(LASTDX)'>17 Y="@70";@54;36.2;S:X="" Y="@55";
"KRN",.402,363,"DR",1,162.5,15)
S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@54";36.22R~;S:$G(LASTDX)<18 LASTDX=18;S Y="@56";@55;36.22///@;S:$G(LASTDX)'>18 Y="@70";@56;36.3;S:X="" Y="@57";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@56";36.32R~;S:$G(LASTDX)<19 LASTDX=19;S Y="@58";@57;
"KRN",.402,363,"DR",1,162.5,16)
36.32///@;S:$G(LASTDX)'>19 Y="@70";@58;36.4;S:X="" Y="@59";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@58";36.42R~;S:$G(LASTDX)<20 LASTDX=20;S Y="@60";@59;36.42///@;S:$G(LASTDX)'>20 Y="@70";@60;36.5;S:X="" Y="@61";
"KRN",.402,363,"DR",1,162.5,17)
S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@60";36.52R~;S:$G(LASTDX)<21 LASTDX=21;S Y="@62";@61;36.52///@;S:$G(LASTDX)'>21 Y="@70";@62;36.6;S:X="" Y="@63";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@62";36.62R~;S:$G(LASTDX)<22 LASTDX=22;S Y="@64";@63;
"KRN",.402,363,"DR",1,162.5,18)
36.62///@;S:$G(LASTDX)'>22 Y="@70";@64;36.7;S:X="" Y="@65";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@64";36.72R~;S:$G(LASTDX)<23 LASTDX=23;S Y="@66";@65;36.72///@;S:$G(LASTDX)'>23 Y="@70";@66;36.8;S:X="" Y="@67";
"KRN",.402,363,"DR",1,162.5,19)
S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@66";36.82R~;S:$G(LASTDX)<24 LASTDX=24;S Y="@68";@67;36.82///@;S:$G(LASTDX)'>24 Y="@70";@68;36.9;S:X="" Y="@69";S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@68";36.92R~;S:$G(LASTDX)<25 LASTDX=25;S Y="@70";@69;
"KRN",.402,363,"DR",1,162.5,20)
36.92///@;@70;39;S:$$INPICD9^FBCSV1(X,$G(DA)) Y="@70";@71;40;S:X="" Y=$S($G(LASTPROC)>1:"@72",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@71";S:$G(LASTPROC)<1 LASTPROC=1;@72;41;S:X="" Y=$S($G(LASTPROC)>2:"@73",1:"@99");
"KRN",.402,363,"DR",1,162.5,21)
S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@72";S:$G(LASTPROC)<2 LASTPROC=2;@73;42;S:X="" Y=$S($G(LASTPROC)>3:"@74",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@73";S:$G(LASTPROC)<3 LASTPROC=3;@74;43;S:X="" Y=$S($G(LASTPROC)>4:"@75",1:"@99");
"KRN",.402,363,"DR",1,162.5,22)
S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@74";S:$G(LASTPROC)<4 LASTPROC=4;@75;44;S:X="" Y=$S($G(LASTPROC)>5:"@76",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@75";S:$G(LASTPROC)<5 LASTPROC=5;@76;44.06;S:X="" Y=$S($G(LASTPROC)>6:"@77",1:"@99");
"KRN",.402,363,"DR",1,162.5,23)
S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@76";S:$G(LASTPROC)<6 LASTPROC=6;@77;44.07;S:X="" Y=$S($G(LASTPROC)>7:"@78",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@77";S:$G(LASTPROC)<7 LASTPROC=7;@78;44.08;
"KRN",.402,363,"DR",1,162.5,24)
S:X="" Y=$S($G(LASTPROC)>8:"@79",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@78";S:$G(LASTPROC)<8 LASTPROC=8;@79;44.09;S:X="" Y=$S($G(LASTPROC)>9:"@80",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@79";S:$G(LASTPROC)<9 LASTPROC=9;@80;
"KRN",.402,363,"DR",1,162.5,25)
44.1;S:X="" Y=$S($G(LASTPROC)>10:"@81",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@80";S:$G(LASTPROC)<10 LASTPROC=10;@81;44.11;S:X="" Y=$S($G(LASTPROC)>11:"@82",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@81";
"KRN",.402,363,"DR",1,162.5,26)
S:$G(LASTPROC)<11 LASTPROC=11;@82;44.12;S:X="" Y=$S($G(LASTPROC)>12:"@83",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@82";S:$G(LASTPROC)<12 LASTPROC=12;@83;44.13;S:X="" Y=$S($G(LASTPROC)>13:"@84",1:"@99");
"KRN",.402,363,"DR",1,162.5,27)
S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@83";S:$G(LASTPROC)<13 LASTPROC=13;@84;44.14;S:X="" Y=$S($G(LASTPROC)>14:"@85",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@84";S:$G(LASTPROC)<14 LASTPROC=14;@85;44.15;
"KRN",.402,363,"DR",1,162.5,28)
S:X="" Y=$S($G(LASTPROC)>15:"@86",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@85";S:$G(LASTPROC)<15 LASTPROC=15;@86;44.16;S:X="" Y=$S($G(LASTPROC)>16:"@87",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@86";S:$G(LASTPROC)<16 LASTPROC=16;
"KRN",.402,363,"DR",1,162.5,29)
@87;44.17;S:X="" Y=$S($G(LASTPROC)>17:"@88",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@87";S:$G(LASTPROC)<17 LASTPROC=17;@88;44.18;S:X="" Y=$S($G(LASTPROC)>18:"@89",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@88";
"KRN",.402,363,"DR",1,162.5,30)
S:$G(LASTPROC)<18 LASTPROC=18;@89;44.19;S:X="" Y=$S($G(LASTPROC)>19:"@90",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@89";S:$G(LASTPROC)<19 LASTPROC=19;@90;44.2;S:X="" Y=$S($G(LASTPROC)>20:"@91",1:"@99");
"KRN",.402,363,"DR",1,162.5,31)
S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@90";S:$G(LASTPROC)<20 LASTPROC=20;@91;44.21;S:X="" Y=$S($G(LASTPROC)>21:"@92",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@91";S:$G(LASTPROC)<21 LASTPROC=21;@92;44.22;
"KRN",.402,363,"DR",1,162.5,32)
S:X="" Y=$S($G(LASTPROC)>22:"@93",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@92";S:$G(LASTPROC)<22 LASTPROC=22;@93;44.23;S:X="" Y=$S($G(LASTPROC)>23:"@94",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@93";S:$G(LASTPROC)<23 LASTPROC=23;
"KRN",.402,363,"DR",1,162.5,33)
@94;44.24;S:X="" Y=$S($G(LASTPROC)>24:"@95",1:"@99");S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@94";S:$G(LASTPROC)<24 LASTPROC=24;@95;44.25;S:X="" Y="@99";S:$$INPICD0^FBCSV1(X,$G(DA)) Y="@95";S:$G(LASTPROC)<25 LASTPROC=25;@99;K FBPROVD;
"KRN",.402,363,"DR",1,162.5,34)
M FBPROVD=FBPROV;S FBX=$$RPROV^FBUTL8(.FBPROV,.FBPROVD);K FBPROVD;S:$D(FBPRICE) Y="@992";K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD);K FBRRMKD;@992;K FBJJ,FBKK,DIE("NO^"),FBX;
"KRN",19,441,-1)
2^2
"KRN",19,441,0)
FBAA SUPERVISOR OPTIONS^Supervisor Main Menu^^M^.5^FBAASUPERVISOR^^^^^^
"KRN",19,441,10,0)
^19.01IP^31^31
"KRN",19,441,10,30,0)
13620
"KRN",19,441,10,30,"^")
FBUC FILE MENU
"KRN",19,441,10,31,0)
13619
"KRN",19,441,10,31,"^")
FBAA CONTRACT FILE
"KRN",19,441,"U")
SUPERVISOR MAIN MENU
"KRN",19,4033,-1)
4^7
"KRN",19,4033,0)
FBUC REQUEST INFO FILE
"KRN",19,4073,-1)
4^5
"KRN",19,4073,0)
FBUC ADD NEW PERSON
"KRN",19,10806,-1)
4^6
"KRN",19,10806,0)
FBUC DISAPPROVAL REASONS FILE
"KRN",19,10811,-1)
4^4
"KRN",19,10811,0)
FBUC DISPOSITIONS FILE
"KRN",19,13619,-1)
0^8
"KRN",19,13619,0)
FBAA CONTRACT FILE^Contract File Enter/Edit^^R^^FBAASUPERVISOR^^^^^^FEE BASIS^^^
"KRN",19,13619,1,0)
^19.06^7^7^3120127^^^^
"KRN",19,13619,1,1,0)
Enter/Edit data in the FEE BASIS CONTRACT (#161.43) file.  This file 
"KRN",19,13619,1,2,0)
contains a list of contracts.  New outpatient and civil hospital
"KRN",19,13619,1,3,0)
authorizations and payments can be linked to an active contract.  The
"KRN",19,13619,1,4,0)
contract number will be included with associated payments that are
"KRN",19,13619,1,5,0)
transmitted to Central Fee.  Note that contracts for community nursing 
"KRN",19,13619,1,6,0)
home rates are stored in a different file and are updated using a
"KRN",19,13619,1,7,0)
different option.
"KRN",19,13619,15)

"KRN",19,13619,20)

"KRN",19,13619,22)

"KRN",19,13619,25)
FBAACFE
"KRN",19,13619,99.1)
62406,82303
"KRN",19,13619,"U")
CONTRACT FILE ENTER/EDIT
"KRN",19,13620,-1)
0^3
"KRN",19,13620,0)
FBUC FILE MENU^Unauthorized Claims File Menu^^M^^^^^^^^FEE BASIS
"KRN",19,13620,1,0)
^^2^2^3090130^
"KRN",19,13620,1,1,0)
This menu contains options used to update files for the unauthorized 
"KRN",19,13620,1,2,0)
claims module.
"KRN",19,13620,10,0)
^19.01IP^4^4
"KRN",19,13620,10,1,0)
4073
"KRN",19,13620,10,1,"^")
FBUC ADD NEW PERSON
"KRN",19,13620,10,2,0)
10806
"KRN",19,13620,10,2,"^")
FBUC DISAPPROVAL REASONS FILE
"KRN",19,13620,10,3,0)
10811
"KRN",19,13620,10,3,"^")
FBUC DISPOSITIONS FILE
"KRN",19,13620,10,4,0)
4033
"KRN",19,13620,10,4,"^")
FBUC REQUEST INFO FILE
"KRN",19,13620,99)
62515,27895
"KRN",19,13620,"U")
UNAUTHORIZED CLAIMS FILE MENU
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
108^3120511^123457118
"PKG",60,22,1,"PAH",1,1,0)
^^10^10^3120511
"PKG",60,22,1,"PAH",1,1,1,0)
This patch will enhance Fee Basis to capture additional data associated 
"PKG",60,22,1,"PAH",1,1,2,0)
with non-VA care.  Contracts can be specified for Medical Fee and Civil
"PKG",60,22,1,"PAH",1,1,3,0)
Hospital authorizations and payments.  Civil hospital invoices will allow 
"PKG",60,22,1,"PAH",1,1,4,0)
entry of larger dollar amounts, additional diagnosis codes, present on
"PKG",60,22,1,"PAH",1,1,5,0)
admission indicators for diagnosis codes, the admitting diagnosis code,
"PKG",60,22,1,"PAH",1,1,6,0)
and additional procedure codes.  The existing transmissions to NVH Pricer
"PKG",60,22,1,"PAH",1,1,7,0)
and Central Fee will be modified to include additional data elements.  The
"PKG",60,22,1,"PAH",1,1,8,0)
transmission of these additional data elements will make it possible to
"PKG",60,22,1,"PAH",1,1,9,0)
comply with inpatient pricing requirements and improve the ability of the
"PKG",60,22,1,"PAH",1,1,10,0)
VA to review and report on purchased care.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
46
"RTN","FBAA79")
0^18^B22692839^B22492731
"RTN","FBAA79",1,0)
FBAA79 ;AISC/GRR - PRINT FORM 7079 REQUEST FOR OUTPATIENT MEDICAL SERVICES ;6/5/2009
"RTN","FBAA79",2,0)
 ;;3.5;FEE BASIS;**12,23,101,103,108**;JAN 30, 1995;Build 115
"RTN","FBAA79",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAA79",4,0)
 W !,"Print 7079's for: " D DT^DICRW,DATE^FBAAUTL G:FBPOP END D SITEP^FBAAUTL G:FBPOP END
"RTN","FBAA79",5,0)
 I '$D(^FBAAA("AF",2)) W !!,*7,"There are no 7079's to be printed!",! G END
"RTN","FBAA79",6,0)
 S FBAASCR=""
"RTN","FBAA79",7,0)
RDHOW W ! S DIR("A")="Want only those that have not yet been printed",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G END:$D(DIRUT) S:Y FBAASCR="Y"
"RTN","FBAA79",8,0)
 D OUTPUT^FBAAS79
"RTN","FBAA79",9,0)
 S VAR="BEGDATE^ENDDATE^FBAASCR",VAL=BEGDATE_"^"_ENDDATE_"^"_FBAASCR,PGM="START^FBAA79",IOP="Q" D ZIS^FBAAUTL G:FBPOP END
"RTN","FBAA79",10,0)
START D SITEP^FBAAUTL G END:FBPOP
"RTN","FBAA79",11,0)
 S UL="",ULL="----------",FBPG=0 F Z=1:1:12 S UL=UL_ULL
"RTN","FBAA79",12,0)
 U IO S FBAASCR=$S(FBAASCR="":"I 1",FBAASCR="Y":"I $S('$D(^FBAAA(DFN,1,FBK,1)):1,$P(^FBAAA(DFN,1,FBK,1),""^"",2)']"""":1,1:0)",1:"I 1")
"RTN","FBAA79",13,0)
 S FBJ=BEGDATE-.001,(DFN,FBK)=0 F ZZ=0:0 S FBJ=$O(^FBAAA("AF",2,FBJ)) Q:FBJ'>0!(FBJ>ENDDATE)  F  S DFN=$O(^FBAAA("AF",2,FBJ,DFN)) Q:DFN'>0  F  S FBK=$O(^FBAAA("AF",2,FBJ,DFN,FBK)) Q:FBK'>0  X FBAASCR I  D GOT
"RTN","FBAA79",14,0)
END K FBJ,FBK,DFN,Z,FBS,V,FBI,FBPATT,FBPG,FBSITE,UL,ULL,POV,NOV,POS,CC,PSTCD,SSTCD,VSTCD,BEGDATE,ENDDATE,PIDC,REF,VDX,CODE,STATCD,D,FBAASCR,FBDX,FBIDC,FBOUT,FBPDX,FBREM,FBRR,NAME,PGM,POW,VAL,VAR,VFN,VFROM,VTO,YOB,ZZ
"RTN","FBAA79",15,0)
 K FB7078,FBAABDT,FBAAEDT,FBASSOC,FBLOC,FBPOV,FBPSA,FBPT,FBTT,FBTYPE,FBVEN,FTP,CNT,FBAAOUT,FBAUT,FBPROG,I,J,M,PI,Q,SEX,SSN,TA,DATE,S,Y,DA,DIC
"RTN","FBAA79",16,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBAA79",17,0)
 D CLOSE^FBAAUTL Q
"RTN","FBAA79",18,0)
 Q
"RTN","FBAA79",19,0)
 ;
"RTN","FBAA79",20,0)
 ; Utilize new API for Name Standardization
"RTN","FBAA79",21,0)
 ;
"RTN","FBAA79",22,0)
GOT Q:'$D(^DPT(DFN,0))
"RTN","FBAA79",23,0)
 S Y(0)=^DPT(DFN,0)
"RTN","FBAA79",24,0)
 D
"RTN","FBAA79",25,0)
 .N FBNAMES
"RTN","FBAA79",26,0)
 .S FBNAMES("FILE")=2,FBNAMES("IENS")=DFN_",",FBNAMES("FIELD")=.01
"RTN","FBAA79",27,0)
 .S NAME=$$NAMEFMT^XLFNAME(.FBNAMES)
"RTN","FBAA79",28,0)
 S SEX=$P(Y(0),U,2)
"RTN","FBAA79",29,0)
 S SSN=$TR($$SSNL4^FBAAUTL($$SSN^FBAAUTL(DFN)),"-",""),YOB=$S($P(Y(0),U,3)]"":$E($P(Y(0),U,3),1,3)+1700,1:""),POS=$S($D(^DPT(DFN,.32)):$P(^(.32),"^",3),1:""),POS=$S(POS]"":$P(^DIC(21,POS,0),"^",3),1:"")
"RTN","FBAA79",30,0)
 F I=1:1:7 S FBI(I)=""
"RTN","FBAA79",31,0)
 I $D(^DPT(DFN,.11)) F I=1:1:7 S FBI(I)=$P(^(.11),"^",I)
"RTN","FBAA79",32,0)
 S POW=$P($G(^DPT(DFN,.52)),"^",5)
"RTN","FBAA79",33,0)
 Q:'$D(^FBAAA(DFN,1,FBK))  S Y(0)=^(FBK,0),VFROM=$P(Y(0),"^",1),VTO=$P(Y(0),"^",2),VFN=$P(Y(0),"^",4) I $S($P(Y(0),"^",3)=6:1,$P(Y(0),"^",3)=7:1,1:"") Q
"RTN","FBAA79",34,0)
 S VDX=$P(Y(0),"^",8),FBPATT=$P(Y(0),"^",18),POV=$$EXTPV^FBAAUTL5($P(Y(0),"^",7)),CODE=$P(Y(0),"^",13),PIDC=$P(Y(0),"^",12),REF=$P(Y(0),"^",21)
"RTN","FBAA79",35,0)
 S NOV=$P($G(^FBAAA(DFN,1,FBK,1)),"^")
"RTN","FBAA79",36,0)
 S FBDX=$G(^FBAAA(DFN,1,FBK,3))
"RTN","FBAA79",37,0)
 S FBIDC=$P($G(^FBAAA(DFN,4)),"^")
"RTN","FBAA79",38,0)
 S STATCD=FBI(5),CC=FBI(7) F V=1:1:14 S V(V)=""
"RTN","FBAA79",39,0)
 S CC=$S(CC']"":"",$D(^DIC(5,+STATCD,1,CC,0)):$P(^(0),"^",3),1:"")
"RTN","FBAA79",40,0)
 S Y(0)=$S(VFN']"":"",'$D(^FBAAV(VFN,0)):"",$D(^FBAAV(VFN,0)):^(0),1:"") G:$S(VFN']"":1,'$D(^FBAAV(VFN,0)):1,1:0) OVR
"RTN","FBAA79",41,0)
 F V=2,1,3,14,4,5,6,10 S V(V)=$P(Y(0),"^",V)
"RTN","FBAA79",42,0)
OVR F S=1:1:9 S FBS(S)=$P(FBSITE(0),"^",S)
"RTN","FBAA79",43,0)
 S VSTCD=$S(V(5)']"":"  ",$D(^DIC(5,V(5),0)):$P(^(0),"^",2),1:"  "),SSTCD=$S(FBS(5)']"":"  ",$D(^DIC(5,+FBS(5),0)):$P(^(0),"^",2),1:"  "),PSTCD=$S(FBI(5)']"":"  ",$D(^DIC(5,+FBI(5),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAA79",44,0)
 W:FBPG @IOF W UL,!,?46,"Department of Veterans Affairs",?100,"ID Card Number: ",FBIDC,!,?35,"R E Q U E S T   F O R   O U T P A T I E N T   S E R V I C E S",!,UL S FBREM=0,FBOUT=0
"RTN","FBAA79",45,0)
 ;
"RTN","FBAA79",46,0)
 W !,"(1) Veterans Name",?31,"|(2) ID Number | Period of Validity",!,?31,"|",?46,"|"
"RTN","FBAA79",47,0)
 W !,NAME,?31,"|",?32,SSN,?46,"|"," FROM: ",$$FMTE^XLFDT(VFROM),"   TO: ",$$FMTE^XLFDT(VTO),!,UL
"RTN","FBAA79",48,0)
 W !,"(3) ADDRESS",?31,"|DATE OF ISSUE",?46,"| CONDITIONS FOR WHICH SERVICES ARE REQUESTED (DESCRIPTION OF DISABILITY)",!,?31,"|",?46,"|"
"RTN","FBAA79",49,0)
 W !,FBI(1),?31,"|",?33,$$FMTE^XLFDT(FBJ),?46,"|","  ",VDX S FBPDX=0
"RTN","FBAA79",50,0)
 I FBI(2)]"" W !,FBI(2),?31,"|",?46,"|","  " S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",51,0)
 I FBI(3)]"" W !,FBI(3),?31,"|",?46,"|","  " S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",52,0)
 W !,FBI(4)," ",PSTCD," ",FBI(6),?31,"|",?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX),!,$E(UL,1,45),?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",53,0)
 W !,"Name and Address of Fee Participant",?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",54,0)
 W !,?46,"|",!,V(1),?46,"|",!,V(3),?46,"|" W:V(14)]"" !,V(14),?46,"|"
"RTN","FBAA79",55,0)
 ; PRXM/KJH - Patch 103. Add Referring Provider and NPI to the display.
"RTN","FBAA79",56,0)
 W !,V(4)," ",VSTCD," ",V(6),?46,"|","REFERRING PROVIDER: "
"RTN","FBAA79",57,0)
 I REF'="" W $$GET1^DIQ(200,REF,.01)
"RTN","FBAA79",58,0)
 W !,V(2),?46,"|","NPI: ",$$REFNPI^FBCH78(REF,"",1)
"RTN","FBAA79",59,0)
 W !,?46,"|","AUTHORIZATION #: ",DFN,"-",FBK,!,UL,!
"RTN","FBAA79",60,0)
 W ?49,"AUTHORIZATION REMARKS",!,?49,$E(UL,1,21)
"RTN","FBAA79",61,0)
 D ^FBAA79A S $P(^FBAAA(DFN,1,FBK,1),"^",2)=DT,FBPG=1 Q
"RTN","FBAACCB1")
0^37^B28490763^B24359201
"RTN","FBAACCB1",1,0)
FBAACCB1 ;AISC/GRR-CLERK CLOSE BATCH CONTINUED ; 11/24/10 10:27am
"RTN","FBAACCB1",2,0)
 ;;3.5;FEE BASIS;**55,61,116,108**;JAN 30, 1995;Build 115
"RTN","FBAACCB1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAACCB1",4,0)
PHARM ;ENTRY FOR PHARMACY BATCH CALCULATE TOTAL DOLLARS AND LINE COUNT
"RTN","FBAACCB1",5,0)
 ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAACCB1",6,0)
 F A=0:0 S A=$O(^FBAA(162.1,"AE",B,A)) Q:A'>0  F B2=0:0 S B2=$O(^FBAA(162.1,"AE",B,A,B2)) Q:B2'>0  I $D(^FBAA(162.1,A,"RX",B2,0)) S Z(0)=^(0) D MOREP
"RTN","FBAACCB1",7,0)
 G FIN^FBAACCB
"RTN","FBAACCB1",8,0)
MOREP S T=T+$P(Z(0),"^",16),C=C+1 Q
"RTN","FBAACCB1",9,0)
 ;
"RTN","FBAACCB1",10,0)
TRAV ;ENTRY FOR TRAVEL BATCH CALCULATE TOTAL DOLLARS AND LINE COUNT
"RTN","FBAACCB1",11,0)
 ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAACCB1",12,0)
 F J=0:0 S J=$O(^FBAAC("AD",B,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("AD",B,J,K)) Q:K'>0  I $D(^FBAAC(J,3,K,0)) S Z(0)=^(0) D MORET
"RTN","FBAACCB1",13,0)
 G FIN^FBAACCB
"RTN","FBAACCB1",14,0)
 ;
"RTN","FBAACCB1",15,0)
MORET S T=T+$P(Z(0),"^",3),C=C+1 Q
"RTN","FBAACCB1",16,0)
LISTC S Q="",$P(Q,"=",80)="=",(FBAAOUT,FBLISTC)=0,IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBAACCB1",17,0)
PRTC D HEDC
"RTN","FBAACCB1",18,0)
 F I=0:0 S I=$O(^FBAAI("AC",B,I)) Q:I'>0!(FBAAOUT)  I $D(^FBAAI(I,0)) S Z(0)=^(0) D CMORE
"RTN","FBAACCB1",19,0)
 Q
"RTN","FBAACCB1",20,0)
CMORE N FBADJLR,FBFPPSC,FBFPPSL,FBX,FBY3,FBDX,FBPOA,FBADMTDX
"RTN","FBAACCB1",21,0)
 S K=$P(Z(0),"^",3),J=$P(Z(0),"^",4) D ENV^FBAACCB0 S N=$$NAME^FBCHREQ2(J),S=$$SSN^FBAAUTL(J),FBIN=I,FBAC=$P(Z(0),"^",8)+.0001,FBAP=$P(Z(0),"^",9)+.0001,FBVP=$P(Z(0),"^",14),ZS=$P(Z(0),"^",13)
"RTN","FBAACCB1",22,0)
 S FBAC=$P(FBAC,".",1)_"."_$E($P(FBAC,".",2),1,2),FBAP=$P(FBAP,".",1)_"."_$E($P(FBAP,".",2),1,2)
"RTN","FBAACCB1",23,0)
 S FBSC=$P(Z(0),"^",11),FBSC=$S(FBSC="":"",$D(^FBAA(161.27,FBSC,0)):$P(^(0),"^",1),1:""),FBFD=$P(Z(0),"^",6),FBTD=$P(Z(0),"^",7) S FBPDT=FBFD D CDAT S FBFD=FBPDT,FBPDT=FBTD D CDAT S FBTD=FBPDT
"RTN","FBAACCB1",24,0)
 S FBY3=$G(^FBAAI(I,3))
"RTN","FBAACCB1",25,0)
 S FBFPPSC=$P(FBY3,U)
"RTN","FBAACCB1",26,0)
 S FBFPPSL=$P(FBY3,U,2)
"RTN","FBAACCB1",27,0)
 S FBX=$$ADJLRA^FBCHFA(I_",")
"RTN","FBAACCB1",28,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAACCB1",29,0)
 D FBCKI(I)
"RTN","FBAACCB1",30,0)
 S B(1617)=$S(B="":"",$D(^FBAA(161.7,B,0)):$P(^(0),"^"),1:"")
"RTN","FBAACCB1",31,0)
 S FBIN(1)=$P(Z(0),"^",2)
"RTN","FBAACCB1",32,0)
 D WRITC
"RTN","FBAACCB1",33,0)
 Q
"RTN","FBAACCB1",34,0)
WRITC I $Y+7>IOSL D ASKH^FBAACCB0:$E(IOST,1,2)["C-" Q:FBAAOUT  W @IOF D HEDC
"RTN","FBAACCB1",35,0)
 W !!,$S('$D(ZS):"",ZS="R":"*",1:"")
"RTN","FBAACCB1",36,0)
 W N,?35,S,?60,B(1617)
"RTN","FBAACCB1",37,0)
 W !,?3,V,?45,VID,?58,FBIN,?70,$$DATX^FBAAUTL($E(FBIN(1),1,7))
"RTN","FBAACCB1",38,0)
 I FBFPPSC]"" W !,?4,"FPPS Claim ID: ",FBFPPSC,"   FPPS Line: ",FBFPPSL
"RTN","FBAACCB1",39,0)
 W !,$S($D(QQ):QQ_")",1:""),FBVP,$S(FBCAN]"":"+",1:""),?4,FBFD,?13,FBTD,?22,$J(FBAC,6),?32,$J(FBAP,6),?45,$S(FBADJLR]"":FBADJLR,1:FBSC)
"RTN","FBAACCB1",40,0)
 W:$P(Z(0),"^",24) ?56,"Discharge ",$$ICD^FBCSV1(+$P(Z(0),"^",24),$P(Z(0),"^",6)) W ! ;CSV
"RTN","FBAACCB1",41,0)
 ; write admitting diagnosis
"RTN","FBAACCB1",42,0)
 N P7,P8
"RTN","FBAACCB1",43,0)
 S P7=$G(^FBAAI(I,5))
"RTN","FBAACCB1",44,0)
 S FBADMTDX=$P(P7,"^",9)
"RTN","FBAACCB1",45,0)
 S P8=$$ICD9^FBCSV1(FBADMTDX,$P($G(Z(0)),"^",6))
"RTN","FBAACCB1",46,0)
 I P8'="" W !,?4,"Admit Dx: ",P8
"RTN","FBAACCB1",47,0)
 ; set diagnosis code and present on admission code
"RTN","FBAACCB1",48,0)
 N P1,P2
"RTN","FBAACCB1",49,0)
 S P1=$G(^FBAAI(I,"DX"))
"RTN","FBAACCB1",50,0)
 S P2=$G(^FBAAI(I,"POA"))
"RTN","FBAACCB1",51,0)
 F FBK=1:1:25 D WRTDX
"RTN","FBAACCB1",52,0)
 ; set procedure code
"RTN","FBAACCB1",53,0)
 N P5
"RTN","FBAACCB1",54,0)
 S P5=$G(^FBAAI(I,"PROC"))
"RTN","FBAACCB1",55,0)
 F FBL=1:1:25 D WRTPC
"RTN","FBAACCB1",56,0)
 S A2=FBAP D PMNT^FBAACCB2 K A2
"RTN","FBAACCB1",57,0)
 Q
"RTN","FBAACCB1",58,0)
CDAT S FBPDT=$E(FBPDT,4,5)_"/"_$S($E(FBPDT,6,7)="00":$E(FBPDT,2,3),1:$E(FBPDT,6,7)_"/"_$E(FBPDT,2,3))
"RTN","FBAACCB1",59,0)
 Q
"RTN","FBAACCB1",60,0)
HEDC W "Patient Name",?20,"('*' Reimbursement to Veteran   '+' Cancellation Activity)",!,?13,"('#' Voided Payment)",?60,"Batch Number"
"RTN","FBAACCB1",61,0)
 W !,?3,"Vendor Name",?45,"Vendor ID",?57,"Invoice #",?68,"Dt Inv Rec'd",!,?3,"FR DATE",?14,"TO DATE  CLAIMED   PAID",?41,"ADJ CODE",!,Q,!
"RTN","FBAACCB1",62,0)
 Q
"RTN","FBAACCB1",63,0)
CHNH ; FB*3.5*116
"RTN","FBAACCB1",64,0)
 S (J,FZ("CNT"))=0 F  S J=$O(^FBAAI("AC",B,J)) Q:J'>0  I $D(^FBAAI(J,0)) S Z(0)=^(0) D MORECH D:$P(FZ,U,15)'="Y" INVCNT
"RTN","FBAACCB1",65,0)
 S:$G(FZ("CNT")) $P(FZ,U,10)=FZ("CNT") K FZ("CNT")  ; CNH batch
"RTN","FBAACCB1",66,0)
 G FIN^FBAACCB
"RTN","FBAACCB1",67,0)
 ;
"RTN","FBAACCB1",68,0)
MORECH ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAACCB1",69,0)
 S T=T+$P(Z(0),"^",9),C=C+1
"RTN","FBAACCB1",70,0)
 ; FB*3.5*116 - build array of invoices
"RTN","FBAACCB1",71,0)
 ;do not build array for CH batches not exempt from the pricer
"RTN","FBAACCB1",72,0)
 Q:($P(FZ,"^",18)'="Y")&($P(FZ,"^",15)="Y") 
"RTN","FBAACCB1",73,0)
 S FBARY($P(Z(0),"^"))=+$P(Z(0),"^",9)
"RTN","FBAACCB1",74,0)
 Q
"RTN","FBAACCB1",75,0)
 ;
"RTN","FBAACCB1",76,0)
WRTDX ; write diagnosis code and present on admission code
"RTN","FBAACCB1",77,0)
 N P3,P4
"RTN","FBAACCB1",78,0)
 S FBDX=$P(P1,"^",FBK)
"RTN","FBAACCB1",79,0)
 S FBPOA=$P(P2,"^",FBK)
"RTN","FBAACCB1",80,0)
 Q:FBDX=""
"RTN","FBAACCB1",81,0)
 S P3=$$ICD9^FBCSV1(FBDX,$P($G(Z(0)),"^",6))_"/"
"RTN","FBAACCB1",82,0)
 S P4=P3_$S(FBPOA:$P($G(^FB(161.94,FBPOA,0)),"^"),1:"")
"RTN","FBAACCB1",83,0)
 I FBK=1!($X+$L(P4)+2>IOM) W !,?4,"DX/POA: "
"RTN","FBAACCB1",84,0)
 W P4," "
"RTN","FBAACCB1",85,0)
 Q
"RTN","FBAACCB1",86,0)
 ;
"RTN","FBAACCB1",87,0)
WRTPC ; write procedure code (if present)
"RTN","FBAACCB1",88,0)
 N P6
"RTN","FBAACCB1",89,0)
 S FBPROC=$P(P5,"^",FBL)
"RTN","FBAACCB1",90,0)
 Q:FBPROC=""
"RTN","FBAACCB1",91,0)
 S P6=$$ICD0^FBCSV1(FBPROC,$P($G(Z(0)),"^",6))
"RTN","FBAACCB1",92,0)
 I FBL=1!($X+$L(P6)+2>IOM) W !,?4,"PROC: "
"RTN","FBAACCB1",93,0)
 W P6," "
"RTN","FBAACCB1",94,0)
 Q
"RTN","FBAACCB1",95,0)
MORE ;
"RTN","FBAACCB1",96,0)
 N FBADJLA,FBADJLR,FBFPPSC,FBFPPSL,FBX,TAMT
"RTN","FBAACCB1",97,0)
 S J=$P(Z(0),"^",5),D=$P(Z(0),"^",3),FBAACPT=$P(Z(0),"^",1),N=$S($D(^DPT(J,0)):$P(^(0),"^",1),1:""),S=$S(N]"":$P(^DPT(J,0),"^",9),1:""),FBIN=A,CPTDESC=$P(Z(0),"^",2)
"RTN","FBAACCB1",98,0)
 S Y="",$P(Y,"^",2)=$P(Z(0),"^",4),$P(Y,"^",3)=$P(Z(0),"^",16),$P(Y,"^",12)=0,T=$P(Z(0),"^",8),T=$S(T="":"",$D(^FBAA(161.27,T,0)):^(0),1:""),$P(Y,"^",9)=$P(Z(0),"^",1),ZS=$P(Z(0),"^",20),FBPV=""
"RTN","FBAACCB1",99,0)
 ;
"RTN","FBAACCB1",100,0)
 S FBFPPSC=$P($G(^FBAA(162.1,A,0)),U,13)
"RTN","FBAACCB1",101,0)
 S FBFPPSL=$P($G(^FBAA(162.1,A,"RX",B2,3)),U)
"RTN","FBAACCB1",102,0)
 S FBX=$$ADJLRA^FBRXFA(B2_","_A_",")
"RTN","FBAACCB1",103,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAACCB1",104,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAACCB1",105,0)
 S TAMT=$FN($P(Z(0),"^",7),"",2)
"RTN","FBAACCB1",106,0)
 ;
"RTN","FBAACCB1",107,0)
 D FBCKP(A,B2)
"RTN","FBAACCB1",108,0)
 S FBIN(1)=$P($G(^FBAA(162.1,+A,0)),"^",2)
"RTN","FBAACCB1",109,0)
 G GO^FBAACCB
"RTN","FBAACCB1",110,0)
INVCNT ;set invoice count for cnh batch
"RTN","FBAACCB1",111,0)
 S FZ("CNT")=FZ("CNT")+1
"RTN","FBAACCB1",112,0)
 Q
"RTN","FBAACCB1",113,0)
FBCKI(FBI) ;set inpatient check variables
"RTN","FBAACCB1",114,0)
 ;fbi=DA
"RTN","FBAACCB1",115,0)
 I '$G(FBI) S (FBCKDT,FBCK,FBCANDT,FBCANR,FBCAN,FBDIS,FBCKINT)="" Q
"RTN","FBAACCB1",116,0)
 S FBCKIN=$G(^FBAAI(FBI,2))
"RTN","FBAACCB1",117,0)
 S U="^",FBCKDT=+FBCKIN,FBCK=$P(FBCKIN,U,4),FBCANDT=$P(FBCKIN,U,5),FBCANR=$P(FBCKIN,U,6),FBCAN=$P(FBCKIN,U,7),FBDIS=$P(FBCKIN,U,8),FBCKINT=$P(FBCKIN,U,9) K FBCKIN
"RTN","FBAACCB1",118,0)
 Q
"RTN","FBAACCB1",119,0)
FBCKP(J,K) ;set pharmacy check variables
"RTN","FBAACCB1",120,0)
 ;j,k required input variables to = da(1) and da respectively (162.1)
"RTN","FBAACCB1",121,0)
 I '$G(J)!('$G(K)) Q
"RTN","FBAACCB1",122,0)
 S FBCKIN=$G(^FBAA(162.1,J,"RX",K,2))
"RTN","FBAACCB1",123,0)
 S U="^",FBCKDT=$P(FBCKIN,U,8),FBCK=$P(FBCKIN,U,10),FBCANDT=$P(FBCKIN,U,11),FBCANR=$P(FBCKIN,U,12),FBCAN=$P(FBCKIN,U,13),FBDIS=$P(FBCKIN,U,14),FBCKINT=$P(FBCKIN,U,15) K FBCKIN
"RTN","FBAACCB1",124,0)
 Q
"RTN","FBAACFE")
0^46^B1826171^n/a
"RTN","FBAACFE",1,0)
FBAACFE ;WOIFO/SAB - CONTRACT FILE ENTER/EDIT ;9/24/2009
"RTN","FBAACFE",2,0)
 ;;3.5;FEE BASIS;**108**;JAN 30, 1995;Build 115
"RTN","FBAACFE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAACFE",4,0)
 N DA,DIC,DIDEL,DR,DLAYGO,DTOUT,DUOUT,X,Y
"RTN","FBAACFE",5,0)
 N FBCNTRN,FBDA,FBNEW,FBX
"RTN","FBAACFE",6,0)
 ;
"RTN","FBAACFE",7,0)
SEL ; add/select
"RTN","FBAACFE",8,0)
 S DIC="^FBAA(161.43,",DIC(0)="AQELM",DLAYGO=161.43
"RTN","FBAACFE",9,0)
 S DIC("A")="Select FEE BASIS CONTRACT NUMBER: "
"RTN","FBAACFE",10,0)
 D ^DIC K DIC
"RTN","FBAACFE",11,0)
 I Y<0 G END
"RTN","FBAACFE",12,0)
 S (DA,FBDA)=+Y
"RTN","FBAACFE",13,0)
 S FBCNTRN=$P(Y,"^",2)
"RTN","FBAACFE",14,0)
 S FBNEW=+$P(Y,"^",3)
"RTN","FBAACFE",15,0)
 ;
"RTN","FBAACFE",16,0)
 ; lock
"RTN","FBAACFE",17,0)
 L +^FBAA(161.43,FBDA):$S($D(DILOCKTM):DILOCKTM,1:5) I '$T D  G SEL
"RTN","FBAACFE",18,0)
 . W $C(7),!,"Record being edited by someone else. Try later.",!
"RTN","FBAACFE",19,0)
 ;
"RTN","FBAACFE",20,0)
 ; edit
"RTN","FBAACFE",21,0)
 S DIE="^FBAA(161.43,"
"RTN","FBAACFE",22,0)
 I 'FBNEW,$$CNTRPTR^FBUTL7(DA) D
"RTN","FBAACFE",23,0)
 . S FBX="CONTRACT NUMBER: "_FBCNTRN_" (referenced, no editing)"
"RTN","FBAACFE",24,0)
 . S DR="W !,FBX;1:3"
"RTN","FBAACFE",25,0)
 E  S DR=".01:3"
"RTN","FBAACFE",26,0)
 S DIDEL=161.43
"RTN","FBAACFE",27,0)
 S DIE("NO^")="BACK"
"RTN","FBAACFE",28,0)
 D ^DIE K DIE,DIDEL,DR
"RTN","FBAACFE",29,0)
 I $D(DTOUT) G END
"RTN","FBAACFE",30,0)
 ;
"RTN","FBAACFE",31,0)
 ; unlock
"RTN","FBAACFE",32,0)
 L -^FBAA(161.43,FBDA)
"RTN","FBAACFE",33,0)
 ;
"RTN","FBAACFE",34,0)
 ; repeat
"RTN","FBAACFE",35,0)
 W !
"RTN","FBAACFE",36,0)
 G SEL
"RTN","FBAACFE",37,0)
 ;
"RTN","FBAACFE",38,0)
END ; exit
"RTN","FBAACFE",39,0)
 Q
"RTN","FBAACO")
0^19^B29088561^B28861560
"RTN","FBAACO",1,0)
FBAACO ;AISC/GRR-ENTER MEDICAL PAYMENT ;7/13/2003
"RTN","FBAACO",2,0)
 ;;3.5;FEE BASIS;**4,61,79,116,122,133,108**;JAN 30, 1995;Build 115
"RTN","FBAACO",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACO",4,0)
EN583 ;driver for opt payments (entry point for uc)
"RTN","FBAACO",5,0)
 K FBAAOUT,FBPOP
"RTN","FBAACO",6,0)
 D SITE G Q:$G(FBPOP) D BT G Q:$G(FBAAOUT)
"RTN","FBAACO",7,0)
1 K FBAAID,FBAAVID,FBAAOUT,FBDL,FBAAMM D SITE G Q:$G(FBPOP) S FBINTOT=0 W !!
"RTN","FBAACO",8,0)
 I '$D(FB583) K FBDL,FBAR D GETVET^FBAAUTL1 G EN583:'DFN K FBAAOUT,FBDMRA D GETAUTH^FBAAUTL1 G 1:FTP']""
"RTN","FBAACO",9,0)
 K FBAAOUT
"RTN","FBAACO",10,0)
 I $G(FBCHCO) S FB7078=$S($G(FB7078):FB7078_";FB7078(",$D(FB583):FB583_";FB583(",1:"")
"RTN","FBAACO",11,0)
 D:FBAAPTC="R" ^FBAACO0
"RTN","FBAACO",12,0)
 D ^FBAAEAR:$P(FBSITE(1),"^",4)="Y"
"RTN","FBAACO",13,0)
 D PAT,GETVEN1^FBAACO1:$D(FB583),GETVEN^FBAACO1:'$D(FB583) I $G(FBAAOUT) G Q:$D(FB583),1
"RTN","FBAACO",14,0)
 W !! D FILEV^FBAACO5(DFN,FBV) I $G(FBAAOUT) G Q:$D(FB583),1
"RTN","FBAACO",15,0)
 ;check for payments against all linked vendors
"RTN","FBAACO",16,0)
 S DA=+Y D CHK^FBAACO4 K FBAACK1,FBAAOUT,DA,X,Y
"RTN","FBAACO",17,0)
 K FBAAID,FBAAVID D GETINV^FBAACO1 I $G(FBAAOUT) Q:$D(FBCHCO)  G Q:$D(FB583),1
"RTN","FBAACO",18,0)
 I '$D(FBAAID)!('$D(FBAAVID)) D GETINDT^FBAACO1 I $G(FBAAOUT) D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q
"RTN","FBAACO",19,0)
 ; ask patient account number
"RTN","FBAACO",20,0)
 S FBCSID=$$ASKPAN^FBUTL5() I FBCSID="^" K FBCSID S FBAAOUT=1 D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q
"RTN","FBAACO",21,0)
 ; if U/C then get FPPS Claim ID else ask user
"RTN","FBAACO",22,0)
 I $D(FB583) S FBFPPSC=$P($G(^FB583(FB583,5)),U) W !,"FPPS CLAIM ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBAACO",23,0)
 E  S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 K FBFPPSC S FBAAOUT=1 D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q
"RTN","FBAACO",24,0)
 G 1^FBAAMP:$G(FBMP) D MM G Q:$G(FBAAOUT)
"RTN","FBAACO",25,0)
SVDT K FBAAOUT,HOLDY W !! D GETSVDT^FBAACO5(DFN,FBV,FBASSOC,1) I $G(FBAAOUT) K FBAADT,FBX,FBAACP W:FBINTOT>0 !!,"Invoice: "_FBAAIN_" Totals $ "_$J(FBINTOT,1,2) G Q:$D(FB583)!($G(FBCHCO)),1
"RTN","FBAACO",26,0)
 D SETO^FBAACO3,DISPINV^FBAACO1
"RTN","FBAACO",27,0)
 W ! D ASKZIP^FBAAFS($G(FBV),$G(FBAADT))
"RTN","FBAACO",28,0)
 I $G(FBAAOUT)!(FBZIP']"") D DEL^FBAACO3 G SVDT
"RTN","FBAACO",29,0)
CPT K FBAAOUT W !
"RTN","FBAACO",30,0)
 D CPTM^FBAALU($G(FBAADT),$G(DFN)) I 'FBGOT D DEL^FBAACO3 G SVDT
"RTN","FBAACO",31,0)
 D CHK2^FBAACO4 I FBJ']"" G SVPR
"RTN","FBAACO",32,0)
CHKE ;determines what action to take on duplicate services entered
"RTN","FBAACO",33,0)
 K FBAAOUT W !!,*7,"Service selected for that date already in system."
"RTN","FBAACO",34,0)
 S DIR(0)="Y",DIR("A")="Do you want to add another service for the SAME DATE",DIR("B")="No" D ^DIR K DIR G Q:$D(DIRUT),SVPR:Y
"RTN","FBAACO",35,0)
 I FBJ]"",FBJ'=FBV W !!,*7,"You must use the 'EDIT PAYMENT' option to edit the service previously",!,"entered for that date." D DEL^FBAACO3 G SVDT
"RTN","FBAACO",36,0)
 S DIR(0)="Y",DIR("A")="Want to edit it",DIR("B")="No" D ^DIR K DIR G Q:$D(DIRUT) I Y D DOEDIT^FBAACO3 G SVDT:'$D(FBDL)!($G(FBAAOUT)),Q:$D(FB583),1
"RTN","FBAACO",37,0)
 D ^FBAACO2 G CPT:'$G(FBDEN)
"RTN","FBAACO",38,0)
SVPR K FBAAOUT
"RTN","FBAACO",39,0)
 I $$ANES^FBAAFS($$CPT^FBAAUTL4($G(FBAACP))) D ASKTIME^FBAAFS I $G(FBAAOUT)!'$G(FBTIME) G CPT
"RTN","FBAACO",40,0)
 D SVCPR^FBAACO1 G CPT:$G(FBAAOUT)
"RTN","FBAACO",41,0)
 S FBAMTPD=0 D FILE^FBAACO2 I $D(FBAAOUT) G Q:$D(FB583),1:$D(FBDL),Q ;FB*3.5*133 removed provider field save
"RTN","FBAACO",42,0)
 D OUT^FBAACO3 W:Z1>(FBAAMPI-20) !,*7,"Warning, you can only enter ",(FBAAMPI-Z1)," more line(s)!" G CPT:Z1'>(FBAAMPI-1) D WARN^FBAACO3 G EN583
"RTN","FBAACO",43,0)
 G 1
"RTN","FBAACO",44,0)
 ;
"RTN","FBAACO",45,0)
Q ;exit point for outpatient payment routines
"RTN","FBAACO",46,0)
 K FBAAPTC,DIC,Y,A,I,DFN,BO,DA,DI,DQ,DR,E,FBAABDT,FBAABE,FBFY,FBDL,FBAAID,FBAAIN,FBAAMPI,FBAAOPA,FBAAPN,FBCONT,FBDX,FBGOT,FBPOV,FBPT,DLAYGO,FBPSA,FBASSOC,FBZBN,FBZBS,FBDEN,FBV,FBSDI,FBAACPI,FBAACP,FBX,FBLOCK
"RTN","FBAACO",47,0)
 K FBSP,FBTPD,FBTT,FBTYPE,FTP,FBDEL,FY,FBINTOT,G,H,MAJN,NO,PI,Q,R,SUB,SUBN,TA,TP,UL,W,X1,Z,Z1,ZZ,FBAADT,K,L,J,FBTOV,FBPARCD,FBT,FEEO,Z2,FBSITE,FBAUT,T,FBLOC,FBSSN,FBVEN,FBD1,Z0,FB583
"RTN","FBAACO",48,0)
 K A1,A2,B1,B2,DAT,DIE,FBAACPT,FBAMTPD,FBAAEDT,FBAAOUT,FBAAPD,FBI,FBIN,FBPROG,FBRR,FBXX,PTYPE,S,VAL,X,V,ZS,FB7078,FBFDC,FBCOUNTY,FBMST,FBTTYPE,FBTV,HY,FBDMRA,DIRUT,FBPOP,FBJ,FBAACK1,FBAR,FBDA,FBST
"RTN","FBAACO",49,0)
 K FBMP,FBK,FBAAAS,%DT,FBDT,FBMAX,FBAMFS,FBAASC,FBHCFA,FBSI,FBCNP,FBAAAMT,FBAAVID,FBAAMM,FBAAMM1,VAPA,FBZX,FBTST,HOLDY,FBAOT
"RTN","FBAACO",50,0)
 K FBCSID,FBFPPSC,FBFPPSL,FBADJ,FBADJD,FBADJL,FBRRMK,FBRRMKD,FBRRMKL,FBUNITS,FBCNTRP
"RTN","FBAACO",51,0)
AUTHQ K DIC,DFN,CNT,FB7078,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBAUT,FBPOV,FBPROG,FBPSA,FBPT,FBTT,FBTYPE,FBVEN,FBTP,PI,TA,FBMOD,FBMODA,FBZIP,FBTIME,FBFSAMT,FBFSUSD
"RTN","FBAACO",52,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBAACO",53,0)
 Q
"RTN","FBAACO",54,0)
 ;
"RTN","FBAACO",55,0)
SITE ;set up site variables
"RTN","FBAACO",56,0)
 D:'$D(FBSITE(0)) SITEP^FBAAUTL Q:$G(FBPOP)  I '$G(FBPROG) D
"RTN","FBAACO",57,0)
 .I $G(FBCHCO) S FBPROG="I ($P(^(0),""^"",3)=6!($P(^(0),""^"",3)=7))&($P(^(0),U,9)'[""FB583"")" Q
"RTN","FBAACO",58,0)
 .S FBPROG=$S($P(FBSITE(1),"^",6)="":"I $P(^(0),""^"",9)'[""FB583""",1:"I $P(^(0),""^"",3)=2,($P(^(0),""^"",9)'[""FB583"")")
"RTN","FBAACO",59,0)
 S:'$D(FBAAPTC) FBAAPTC="V"
"RTN","FBAACO",60,0)
 S FBAAMPI=$P($G(^FBAA(161.4,1,"FBNUM")),"^",3),FBAAMPI=$S(FBAAMPI]"":FBAAMPI,1:100)
"RTN","FBAACO",61,0)
 Q
"RTN","FBAACO",62,0)
 ;
"RTN","FBAACO",63,0)
BT ;select batch
"RTN","FBAACO",64,0)
 S DIC="^FBAA(161.7,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,3)=""B3""&($G(^(""ST""))=""O"")&(($P(^(0),U,5)=DUZ)!($D(^XUSEC(""FBAASUPERVISOR"",DUZ))))",DIC("W")="W !,""  Obligation #: "",$P(^(0),U,2)" W !! D ^DIC K DIC I X["^"!(X="") S FBAAOUT=1 Q
"RTN","FBAACO",65,0)
 G BT:Y<0 S (DA,FBAABE)=+Y,Y(0)=^FBAA(161.7,DA,0)
"RTN","FBAACO",66,0)
 I $P(Y(0),"^",11)>(FBAAMPI-1) W !!,"This Batch already has the maximum number of Payments!" G BT
"RTN","FBAACO",67,0)
 S Z1=$P(Y(0),"^",11),FB7078="",BO=$P(^FBAA(161.7,DA,0),"^",2)
"RTN","FBAACO",68,0)
 Q
"RTN","FBAACO",69,0)
PAT ;set up patient in patient file
"RTN","FBAACO",70,0)
 ;required input variable DFN
"RTN","FBAACO",71,0)
 I '$D(^FBAAC(DFN,0)) K DD,DO S (X,DINUM)=DFN,DIC(0)="L",DLAYGO=162,DIC="^FBAAC(" D FILE^DICN K DLAYGO,DIC,DINUM,DD,DO,DA
"RTN","FBAACO",72,0)
 Q
"RTN","FBAACO",73,0)
MM ;check for money management of entire invoice
"RTN","FBAACO",74,0)
 ; fb*3.5*116
"RTN","FBAACO",75,0)
 ;I FBAAPTC="R" S FBAAMM="" Q
"RTN","FBAACO",76,0)
 ;W ! S DIR(0)="Y",DIR("A")="Will any line items in this invoice be for contracted services",DIR("B")="No",DIR("?")="Answering no indicates interest will not be paid for any line items." D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACO",77,0)
 ;S FBAAMM=$S(Y=1:1,1:"")
"RTN","FBAACO",78,0)
 D MMPPT^FBAACP
"RTN","FBAACO",79,0)
 Q
"RTN","FBAACO",80,0)
OUT K FBAADT,FBX,FBAACP W:FBINTOT>0 !!,"Invoice: "_FBAAIN_" Totals $ "_$J(FBINTOT,1,2) Q
"RTN","FBAACO1")
0^29^B42250975^B27913240
"RTN","FBAACO1",1,0)
FBAACO1 ;AISC/GRR - ENTER PAYMENT CONTINUED ;6/25/2009
"RTN","FBAACO1",2,0)
 ;;3.5;FEE BASIS;**4,61,77,108**;JAN 30, 1995;Build 115
"RTN","FBAACO1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAACO1",4,0)
SVCPR ;set up service provided multiple
"RTN","FBAACO1",5,0)
 I '$D(^FBAAC(DFN,1,FBV,1,FBSDI,1,0)) S ^FBAAC(DFN,1,FBV,1,FBSDI,1,0)="^162.03A^0^0"
"RTN","FBAACO1",6,0)
 W ! S DLAYGO=162,DIC="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",DIC(0)=$S($G(FBCNP):"QL",1:"EQL"),X=""""_FBX_"""",DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI
"RTN","FBAACO1",7,0)
 D
"RTN","FBAACO1",8,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBAACO1",9,0)
 K DIC,DLAYGO,DA I Y<0 S FBAAOUT=1 Q
"RTN","FBAACO1",10,0)
 S (FBAACPI,DA)=+Y
"RTN","FBAACO1",11,0)
 ;
"RTN","FBAACO1",12,0)
 ; update zip code and anesthesia time
"RTN","FBAACO1",13,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO1",14,0)
 K DA S DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI,DA=FBAACPI
"RTN","FBAACO1",15,0)
 S DR="42////^S X=$G(FBZIP);43////^S X=$G(FBTIME)"
"RTN","FBAACO1",16,0)
 D ^DIE K DIE,DA,DR
"RTN","FBAACO1",17,0)
 ;
"RTN","FBAACO1",18,0)
 ; create CPT MODIFIER entries from data in array FBMODA
"RTN","FBAACO1",19,0)
 D REPMOD^FBAAUTL4(DFN,FBV,FBSDI,FBAACPI)
"RTN","FBAACO1",20,0)
 ;
"RTN","FBAACO1",21,0)
 Q
"RTN","FBAACO1",22,0)
 ;
"RTN","FBAACO1",23,0)
PPT(FBDEF,FBDEFC,FB162) ;establishes prompt pay type and contract for entry
"RTN","FBAACO1",24,0)
 ; input
"RTN","FBAACO1",25,0)
 ;   FBDEF  = (optional) default for DIR prompt: =1 for yes, else no
"RTN","FBAACO1",26,0)
 ;   FBDEFC = (optional) default for the contract prompt
"RTN","FBAACO1",27,0)
 ;   FBAAMM = ppt if 1 ask for each line item; if 0 don't ask
"RTN","FBAACO1",28,0)
 ;   FBV    = vendor (ien) being paid
"RTN","FBAACO1",29,0)
 ;   FBVEN  = vendor (ien) from authorization
"RTN","FBAACO1",30,0)
 ;   FBCNTRA= contract (ien) from authorization
"RTN","FBAACO1",31,0)
 ;   FB583  = (optional) $D(FB583) true if unauthorized claim
"RTN","FBAACO1",32,0)
 ;   FB162  = (optional) = 1 if payment line item in sub-file 162.03 is being edited.  FBDEF and FBDEFC must be current values.
"RTN","FBAACO1",33,0)
 ; output
"RTN","FBAACO1",34,0)
 ;   FBAAMM1 = the ppt for the line item
"RTN","FBAACO1",35,0)
 ;   FBCNTRP = contract ien for the line item
"RTN","FBAACO1",36,0)
 N Y
"RTN","FBAACO1",37,0)
 S (FBAAMM1,FBCNTRP)=""
"RTN","FBAACO1",38,0)
 I FBAAMM="" Q
"RTN","FBAACO1",39,0)
 S:'$D(FBV) FBV=$G(FBVEN)  ;SOMETIMES FBV DOES NOT EXIST BUT FBVEN IS SET EQUAL TO THE VENDOR IN FBCH ENTER PAYMENT
"RTN","FBAACO1",40,0)
 I FBAAMM=1,'$D(FB583),$$UCFA^FBUTL7($G(FBV),$G(FBVEN),$G(FBCNTRA)) D  Q
"RTN","FBAACO1",41,0)
 . W !,"Contract is ",$P($G(^FBAA(161.43,FBCNTRA,0)),U)," from the authorization."
"RTN","FBAACO1",42,0)
 . S FBAAMM1=1
"RTN","FBAACO1",43,0)
 . S FBCNTRP=FBCNTRA
"RTN","FBAACO1",44,0)
 I FBAAMM=1 D
"RTN","FBAACO1",45,0)
 . ;if editing line in file 162 contracted services can't be changed
"RTN","FBAACO1",46,0)
 . I $G(FB162)=1 D
"RTN","FBAACO1",47,0)
 .. W !,"Invoice ",$S(FBDEF=1:"is",1:"is not")," for contracted services."
"RTN","FBAACO1",48,0)
 .. S Y=$S(FBDEF=1:1,1:0)
"RTN","FBAACO1",49,0)
 . ;if not editing line in file 162 contracted services can be changed
"RTN","FBAACO1",50,0)
 . I $G(FB162)'=1 F  D  Q:Y]""
"RTN","FBAACO1",51,0)
 . . S DIR(0)="Y",DIR("A")="Is this line item for a contracted service"
"RTN","FBAACO1",52,0)
 . . S DIR("B")=$S($G(FBDEF)=1:"Yes",1:"No")
"RTN","FBAACO1",53,0)
 . . S DIR("?")="Answering no indicates that interest will not be paid for this line item."
"RTN","FBAACO1",54,0)
 . . D ^DIR K DIR I $D(DIRUT) W !,$C(7),"Required Response!" S Y=""
"RTN","FBAACO1",55,0)
 . S FBAAMM1=$S(Y=1:1,1:"")
"RTN","FBAACO1",56,0)
 . Q:FBAAMM1=""
"RTN","FBAACO1",57,0)
 . ;
"RTN","FBAACO1",58,0)
 . S DIR(0)="PO^161.43:AQEM"
"RTN","FBAACO1",59,0)
 . S DIR("A")="CONTRACT"
"RTN","FBAACO1",60,0)
 . S DIR("?",1)="If the line item is under a contract then select it."
"RTN","FBAACO1",61,0)
 . S DIR("?")="Contract must be active and applicable for the vendor."
"RTN","FBAACO1",62,0)
 . S DIR("S")="I $P($G(^(0)),""^"",2)'=""I"",$$VCNTR^FBUTL7($G(FBV),+Y)"
"RTN","FBAACO1",63,0)
 . S:$G(FBDEFC) DIR("B")=$P($G(^FBAA(161.43,FBDEFC,0)),U)
"RTN","FBAACO1",64,0)
 . D ^DIR K DIR
"RTN","FBAACO1",65,0)
 . ; if time-out or '^' and has default value (i.e. edit payment)
"RTN","FBAACO1",66,0)
 . ;   return default so existing payment is not altered
"RTN","FBAACO1",67,0)
 . I $D(DTOUT)!$D(DUOUT),$G(FBDEFC)>0 S FBCNTRP=FBDEFC Q
"RTN","FBAACO1",68,0)
 . I Y>0 S FBCNTRP=+Y
"RTN","FBAACO1",69,0)
 Q
"RTN","FBAACO1",70,0)
 ;
"RTN","FBAACO1",71,0)
Q K FBAADT,FBX,FBAACP W:FBINTOT>0 !!,"Invoice: "_FBAAIN_"  Totals $ "_$J(FBINTOT,1,2) G Q^FBAACO:$D(FB583),1^FBAACO:'$D(FBCHCO) Q
"RTN","FBAACO1",72,0)
 ;
"RTN","FBAACO1",73,0)
POS ; prompt for place of service
"RTN","FBAACO1",74,0)
 ; output
"RTN","FBAACO1",75,0)
 ;   FBHCFA(30) = place of service (internal)
"RTN","FBAACO1",76,0)
 N Y
"RTN","FBAACO1",77,0)
 S FBHCFA(30)=""
"RTN","FBAACO1",78,0)
 S DIR(0)="P^353.1:EMZ"
"RTN","FBAACO1",79,0)
 D ^DIR K DIR I $D(DIRUT) Q
"RTN","FBAACO1",80,0)
 S FBHCFA(30)=$P(Y,U)
"RTN","FBAACO1",81,0)
 Q
"RTN","FBAACO1",82,0)
 ;
"RTN","FBAACO1",83,0)
GETVEN ;select vendor from vendor file
"RTN","FBAACO1",84,0)
 W !! S DLAYGO=161.2,DIC="^FBAAV(",DIC(0)="AEQLM" D ^DIC K DLAYGO I X="^"!(X="") S FBAAOUT=1 Q
"RTN","FBAACO1",85,0)
 ;if new vendor, call in to new vendor setup routine
"RTN","FBAACO1",86,0)
 G GETVEN:Y<0 S DA=+Y,DIE=DIC D:$P(Y,"^",3)=1 NEW^FBAAVD K DIE,DIC,DR,X,DLAYGO
"RTN","FBAACO1",87,0)
GETVEN1 I $D(FB583) S DA=FBVEN
"RTN","FBAACO1",88,0)
 I $D(^FBAAV(DA,0)),$P($G(^("ADEL")),U)="Y" W !!,$C(7),"Vendor has been flagged for Austin deletion!" G GETVEN:'$D(FB583) S FBAAOUT=1 Q
"RTN","FBAACO1",89,0)
 D:$P(FBSITE(0),"^",11)="Y" EN1^FBAAVD
"RTN","FBAACO1",90,0)
GETVEN2 I $P(FBSITE(0),"^",11)="Y",$D(^XUSEC("FBAA ESTABLISH VENDOR",DUZ)) S DIR(0)="Y",DIR("A")="Want to Edit data",DIR("B")="NO" D ^DIR K DIR S:$D(DIRUT) FBAAOUT=1 Q:$D(DIRUT)  D:Y EDITV^FBAAVD
"RTN","FBAACO1",91,0)
 I $P(FBSITE(0),"^",11)'="Y"!('$D(^XUSEC("FBAA ESTABLISH VENDOR",DUZ))) S DIR(0)="E" D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACO1",92,0)
 S FBV=DA,FBAR(DA)="" D ^FBAACO4
"RTN","FBAACO1",93,0)
 Q
"RTN","FBAACO1",94,0)
 ;
"RTN","FBAACO1",95,0)
GETINV ;assign invoice number or select existing invoice number
"RTN","FBAACO1",96,0)
 K FBAAOUT S FBINTOT=0 S DIR(0)="Y",DIR("A")="Want a new Invoice number assigned",DIR("B")="YES" D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACO1",97,0)
 I Y D GETNXI^FBAAUTL W !!,"Invoice # ",FBAAIN," assigned to this Invoice" Q
"RTN","FBAACO1",98,0)
GETINV1 ;selects existing invoice if user does not choose to assign new number
"RTN","FBAACO1",99,0)
 S DIR(0)="N",DIR("A")="Select Invoice number",DIR("?")="Select one of the previously entered Invoice #'s" D ^DIR K DIR I $D(DIRUT)!(X="") G GETINV:'$G(FB583) S FBAAOUT=1 Q
"RTN","FBAACO1",100,0)
 D CHK1^FBAACO4 G GETINV1:'$G(FBAACK1) K FBAACK1
"RTN","FBAACO1",101,0)
 I '$D(^FBAAC("AJ",FBAABE,X)) D  G GETINV1
"RTN","FBAACO1",102,0)
 . W !,$C(7),"Only previously entered invoices in the same batch may be selected!"
"RTN","FBAACO1",103,0)
 S FBAAIN=X D CALC^FBAACO3 W:FBINTOT>0 ?33,"Current Total: $ "_$J(FBINTOT,1,2)
"RTN","FBAACO1",104,0)
 Q
"RTN","FBAACO1",105,0)
 ;
"RTN","FBAACO1",106,0)
GETINDT ;get invoice dates
"RTN","FBAACO1",107,0)
 ;input requires FBAABDT (authorization from date)
"RTN","FBAACO1",108,0)
 K FBAAOUT W !,"Enter Date Correct Invoice Received or Last Date of Service" S %DT("A")="(whichever is later): " S:$G(FBAAID) %DT("B")=$$DATX^FBAAUTL(FBAAID) I $G(FBCNH) S %DT(0)=$G(FBENDDT)
"RTN","FBAACO1",109,0)
 S %DT="AEXP" D ^%DT K %DT I X="^"!(X="") S FBAAOUT=1 Q
"RTN","FBAACO1",110,0)
 S FBAAID=Y I '$G(FBCNP) I FBAAID<FBAABDT W !!,$C(7),"Invoice date is earlier than Patient's Authorization date!!" K FBAAID G GETINDT
"RTN","FBAACO1",111,0)
GETIND1 W ! S %DT("A")="Enter Vendor Invoice Date: ",%DT="AEXP" S:$G(FBAAVID) %DT("B")=$$DATX^FBAAUTL(FBAAVID) D ^%DT K %DT G GETINDT:X="" I X="^" S FBAAOUT=1 Q
"RTN","FBAACO1",112,0)
 S FBAAVID=Y I FBAAVID>FBAAID W !!,$C(7),"Vendor's invoice date is later than the date you received it!!" K FBAAVID G GETIND1
"RTN","FBAACO1",113,0)
 Q
"RTN","FBAACO1",114,0)
 ;
"RTN","FBAACO1",115,0)
DISPINV ;display invoice totals
"RTN","FBAACO1",116,0)
 ;required inputs FBAADT (auth dt),DFN
"RTN","FBAACO1",117,0)
 S H=$E(FBAADT,1,5)_"00",R=9999999.9999-H,S=$E(FBAADT,1,5)_31,S=9999999.9999-S,G=+$E(FBAADT,4,5)_+$E(FBAADT,2,3) D CKMAX^FBAACO3
"RTN","FBAACO1",118,0)
 S FBTPD=0 I $D(^FBAAC(DFN,3,"AB",FBAADT)) S FBZX=$O(^FBAAC(DFN,3,"AB",FBAADT,0)) I $D(^FBAAC(DFN,3,FBZX,0)) W !!,"$ ",$P(^(0),"^",3)," for travel already entered for this date of service" S FBTPD=1
"RTN","FBAACO1",119,0)
 W:'$D(FBCHCO) !!,"Total already paid on ID Card for month:   $ ",A,"   Maximum allowed: $ ",$P(FBSITE(1),"^",9),!,"Total already paid on All/Other for month: $ ",FBAOT
"RTN","FBAACO1",120,0)
 Q
"RTN","FBAACO2")
0^30^B14357578^B14116879
"RTN","FBAACO2",1,0)
FBAACO2 ;AISC/GRR-PAYMENT PROCESS FOR DUPLICATE ;7/13/2003
"RTN","FBAACO2",2,0)
 ;;3.5;FEE BASIS;**4,55,61,77,116,122,133,108**;JAN 30, 1995;Build 115
"RTN","FBAACO2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACO2",4,0)
RD S DIR(0)="Y",DIR("A")="Want this payment stored as a Medical Denial",DIR("B")="YES",DIR("?")="Enter 'Yes' to store payment entry as a denial and send a Suspension letter.  Enter 'No' to have nothing happen." D ^DIR K DIR Q:$D(DIRUT)!('Y)
"RTN","FBAACO2",5,0)
 S FBDEN=1 Q
"RTN","FBAACO2",6,0)
FILE ;files sp multiple entry
"RTN","FBAACO2",7,0)
 K DR S TP="" I $G(FBDEN) S FBAMTPD=0
"RTN","FBAACO2",8,0)
 S DR="49///^S X=$G(FBCSID);50///^S X=$G(FBFPPSC);I $G(FBDEN) S Y=1;48;47//1;S FBUNITS=X;S:$G(FBFPPSC)="""" Y=""@11"";S FBX=$$FPPSL^FBUTL5();S:FBX=-1 Y=0;51///^S X=FBX;@11"
"RTN","FBAACO2",9,0)
 ; fb*3.5*116 do not enable different interest indicator values at line item level; interest indicator set at invoice level
"RTN","FBAACO2",10,0)
 ;S DR(1,162.03,1)="D PPT^FBAACO1();34///^S X=$G(FBAAMM1);D POS^FBAACO1;S:'$G(FBHCFA(30)) Y=0;1;S J=X;I $G(FBDEN) S Y=2;D FEE^FBAACO0;44////^S X=FBFSAMT;45///^S X=FBFSUSD;2///^S X=FBAMTPD;S K=X"
"RTN","FBAACO2",11,0)
 S DR(1,162.03,1)="34///^S X=$G(FBAAMM);D POS^FBAACO1;S:'$G(FBHCFA(30)) Y=0;1;S J=X;I $G(FBDEN) S Y=2;D FEE^FBAACO0;44////^S X=FBFSAMT;45///^S X=FBFSUSD;2///^S X=FBAMTPD;S K=X"
"RTN","FBAACO2",12,0)
 ;S DR(1,162.03,2)="S:J-K=0 Y=6;3//^S X=$S(J-K:J-K,1:"""");S:'X Y=6;3.5///^S X=DT;@4;4;I X']"""" D SC^FBAACO3;S:X'=4 Y=6;22;6////^S X=DUZ"
"RTN","FBAACO2",13,0)
 S DR(1,162.03,2)="S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2);S:FBX=0 Y=0;6////^S X=DUZ"
"RTN","FBAACO2",14,0)
 S DR(1,162.03,3)="7////^S X=FBAABE;8////^S X=BO;13///^S X=FBAAID;14///^S X=FBAAIN;33///^S X=FBAAVID;I $G(FBDEN) S FBTST=1"
"RTN","FBAACO2",15,0)
 I '$G(FBDEN) D
"RTN","FBAACO2",16,0)
 .N FBCSVSTR S FBCSVSTR="I X]"""" S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@1"";"
"RTN","FBAACO2",17,0)
 .S DR(1,162.03,4)="S:$$EXTPV^FBAAUTL5(FBPOV)=""01"" Y=""@1"";S:FB7078]""""!($D(FB583)) Y=30;@5;28R;S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@5"";30////^S X=FBHCFA(30);31;32R;S Y=15;@1;28;"_FBCSVSTR_"30////^S X=FBHCFA(30);31"
"RTN","FBAACO2",18,0)
 .S DR(1,162.03,5)="15///^S X=FBPT;S FBX=$$RR^FBUTL4(.FBRRMK,2);S:FBX=0 Y=0"
"RTN","FBAACO2",19,0)
 .S DR(1,162.03,6)="16////^S X=FBPOV;17///^S X=FBTT;18///^S X=FBAAPTC;23////^S X=FBTYPE;26////^S X=FBPSA;S:$D(FBV583) Y=""@2"";27////^S X=FB7078;S Y=""@99"";@2;27////^S X=FBV583;@99;S FBTST=1;54////^S X=FBCNTRP"
"RTN","FBAACO2",20,0)
 .S DR(1,162.03,7)="73;74;75;58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69" ;FB*3.5*122 Line Item Provider information ;FB*3.5*133 Provider Information
"RTN","FBAACO2",21,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO2",22,0)
 S DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI,DA=FBAACPI
"RTN","FBAACO2",23,0)
 D LOCK^FBUCUTL("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",FBAACPI,1)
"RTN","FBAACO2",24,0)
 D
"RTN","FBAACO2",25,0)
 . N ICDVDT S ICDVDT=$G(FBAADT) D ^DIE
"RTN","FBAACO2",26,0)
 I '$D(DTOUT),$G(FBTST) D
"RTN","FBAACO2",27,0)
 . D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO2",28,0)
 . D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO2",29,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI)
"RTN","FBAACO2",30,0)
 I $D(DTOUT) D KILL Q
"RTN","FBAACO2",31,0)
 I '$G(FBTST),$G(DA) S DIR(0)="YA",DIR("A")="Entering an '^' will delete "_$S($G(FBDEN):"denial",1:"payment")_".  Are you sure you want to delete? ",DIR("B")="No" D ^DIR K DIR G FILE:'$D(DIRUT)&('Y) D KILL Q
"RTN","FBAACO2",32,0)
 K FBTST,FBDEN,DIE,DR,DA,FBX
"RTN","FBAACO2",33,0)
 I $D(FBDL) S FBAAOUT=1 Q
"RTN","FBAACO2",34,0)
 Q
"RTN","FBAACO2",35,0)
KILL S DIK=DIE D ^DIK K DIE,DIK I '$G(FBCNP) D Q^FBAACO S FBAAOUT=1
"RTN","FBAACO2",36,0)
 W !,"Deleted" Q
"RTN","FBAACO3")
0^31^B50591838^B48919280
"RTN","FBAACO3",1,0)
FBAACO3 ;AISC/GRR-ENTER PAYMENT CONTINUED ;7/7/2003
"RTN","FBAACO3",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,116,122,133,108**;JAN 30, 1995;Build 115
"RTN","FBAACO3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACO3",4,0)
DOEDIT ;
"RTN","FBAACO3",5,0)
 N FB1725,FBFPPSC
"RTN","FBAACO3",6,0)
 W ! S FBAACP(0)=FBAACP
"RTN","FBAACO3",7,0)
 S DIC="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO3",8,0)
 S DIC(0)="EQMZ",DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI
"RTN","FBAACO3",9,0)
 S X=$$CPT^FBAAUTL4(FBAACP)
"RTN","FBAACO3",10,0)
 D ^DIC I Y<0 S FBAAOUT=1 Q
"RTN","FBAACO3",11,0)
 S (DA,FBAACPI)=+Y,K=$P(Y(0),U,3),FBZBN=$P(Y(0),U,8),FBZBS=$S(FBZBN]"":$P($G(^FBAA(161.7,FBZBN,"ST")),U),1:""),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBAACO3",12,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBAACO3",13,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBAACO3",14,0)
 S FBAAMM1=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,2)),U,2)
"RTN","FBAACO3",15,0)
 S FBCNTRP=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U,8)
"RTN","FBAACO3",16,0)
 S FBFSAMT(0)=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,2)),U,12)
"RTN","FBAACO3",17,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBAACO3",18,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBAACO3",19,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"_FBAACPI_",""M"")")
"RTN","FBAACO3",20,0)
 ; load current adjustment data
"RTN","FBAACO3",21,0)
 D LOADADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO3",22,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAACO3",23,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAACO3",24,0)
 ; load current remittance remark data
"RTN","FBAACO3",25,0)
 D LOADRR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO3",26,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAACO3",27,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAACO3",28,0)
 ; load FPPS data
"RTN","FBAACO3",29,0)
 S FBFPPSC=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U)
"RTN","FBAACO3",30,0)
 S FBFPPSL=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U,2)
"RTN","FBAACO3",31,0)
 I FBZBS=""!(FBZBS="V") D NOGO S FBAAOUT=1 Q
"RTN","FBAACO3",32,0)
 ; first edit CPT code and modifiers
"RTN","FBAACO3",33,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) S FBAAOUT=1 Q
"RTN","FBAACO3",34,0)
 ; if CPT was changed then update file
"RTN","FBAACO3",35,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" S FBAAOUT=1 Q
"RTN","FBAACO3",36,0)
 . N FBIENS,FBFDA
"RTN","FBAACO3",37,0)
 . S FBIENS=FBAACPI_","_FBSDI_","_FBV_","_DFN_","
"RTN","FBAACO3",38,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBAACO3",39,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAACO3",40,0)
 ; if modifiers changed then update file
"RTN","FBAACO3",41,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(DFN,FBV,FBSDI,FBAACPI)
"RTN","FBAACO3",42,0)
 ; now edit remaining fields
"RTN","FBAACO3",43,0)
 D SETO K DR
"RTN","FBAACO3",44,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBAACO3",45,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only
"RTN","FBAACO3",46,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1,FBCNTRP,1);34///@;34////^S X=FBAAMM1;54///@;54////^S X=FBCNTRP;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAACO3",47,0)
 ;S DR(1,162.03,1)="30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAACO3",48,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;D CHKIT^FBAACO3;S K=X"
"RTN","FBAACO3",49,0)
 ;S DR(1,162.03,3)="3//^S X=$S(J-K:J-K,1:"""");4;S:X'=4 Y=6;22;6////^S X=DUZ;13;33"
"RTN","FBAACO3",50,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBAACO3",51,0)
 S DR(1,162.03,4)="S:FBFPPSC="""" Y=13;W !,""FPPS CLAIM ID: ""_FBFPPSC;S FBX=$$FPPSL^FBUTL5(FBFPPSL,,1);51///^S X=FBX;S FBFPPSL=X;13;33"
"RTN","FBAACO3",52,0)
 S DR(1,162.03,5)="S:$$EXTPV^FBAAUTL5(FBPOV)=""01"" Y=""@1"";S Y=$S('$D(FB7078):28,FB7078]"""":31,1:28);@5;28R;S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@5"";31;32R;S Y=""@7"";@1;28;I X]"""" S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@1"";31"
"RTN","FBAACO3",53,0)
 S DR(1,162.03,6)="@7;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBAACO3",54,0)
 S DR(1,162.03,7)="73;74;75;58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69"
"RTN","FBAACO3",55,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",DIE("NO^")="",FBOT=1
"RTN","FBAACO3",56,0)
 D LOCK^FBUCUTL("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",FBAACPI) I 'FBLOCK S FBAAOUT=1 Q
"RTN","FBAACO3",57,0)
 D ^DIE
"RTN","FBAACO3",58,0)
 ; if adjustment data changed then file
"RTN","FBAACO3",59,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO3",60,0)
 ; if remit remark data changed then file
"RTN","FBAACO3",61,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO3",62,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI) K FBOT,DIE,DR,DA
"RTN","FBAACO3",63,0)
 Q:$D(FBDL)
"RTN","FBAACO3",64,0)
 I $G(FBAAIN) S FBINTOT=0 D CALC
"RTN","FBAACO3",65,0)
 Q
"RTN","FBAACO3",66,0)
SETO S FY=$E(FBAADT,1,3)+1700+$S($E(FBAADT,4,5)>9:1,1:0)
"RTN","FBAACO3",67,0)
 Q
"RTN","FBAACO3",68,0)
OUT ;
"RTN","FBAACO3",69,0)
 ; FB*3.5*116 count line items that have 0.00 amount paid
"RTN","FBAACO3",70,0)
 ;I K>0 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1,FBINTOT=FBINTOT+K
"RTN","FBAACO3",71,0)
 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1,FBINTOT=FBINTOT+K
"RTN","FBAACO3",72,0)
 Q
"RTN","FBAACO3",73,0)
CKMAX S (FBAOT,A)=0,O="" F Z=S-.1:0 S Z=$O(^FBAAC(DFN,"AB",Z)) Q:Z'>0!(Z>R)  F Q=0:0 S Q=$O(^FBAAC(DFN,"AB",Z,Q)) Q:Q'>0  S W=$O(^FBAAC(DFN,"AB",Z,Q,0)) I $D(^FBAAC(DFN,1,Q,1,W,0)) D SMORE
"RTN","FBAACO3",74,0)
 I A>$P(FBSITE(1),"^",9) G NO
"RTN","FBAACO3",75,0)
 Q
"RTN","FBAACO3",76,0)
SMORE N FBA,FBB S FBB=$P($G(^FBAAC(+DFN,1,+Q,1,+W,0)),U,4),E=0
"RTN","FBAACO3",77,0)
 F  S E=$O(^FBAAC(DFN,1,Q,1,W,1,E)) Q:'E  S FBA=$G(^(E,0)) I $P(FBA,"^",9)=2,$P(FBA,"^",18)'=1 D
"RTN","FBAACO3",78,0)
 .I $$IDCHK^FBAAUTL3(DFN,FBB) S A=A+$P(FBA,"^",3) Q
"RTN","FBAACO3",79,0)
 .S FBAOT=FBAOT+$P(FBA,U,3)
"RTN","FBAACO3",80,0)
 Q
"RTN","FBAACO3",81,0)
NO W !!,*7,"Warning Patient already at maximum allowed for month of service",! Q
"RTN","FBAACO3",82,0)
WARN W !!,*7,"You have reached the maximum number of payments for a Batch!",!,"You must select another Batch for entering Payments!"
"RTN","FBAACO3",83,0)
CALC ;Calculate Current Invoice Total
"RTN","FBAACO3",84,0)
 F J=0:0 S J=$O(^FBAAC("C",FBAAIN,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("C",FBAAIN,J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("C",FBAAIN,J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("C",FBAAIN,J,K,L,M)) Q:M'>0  D CALC1
"RTN","FBAACO3",85,0)
 K J,K,L,M,FZNODE Q
"RTN","FBAACO3",86,0)
CALC1 S FZNODE=^FBAAC(J,1,K,1,L,1,M,0),A2=$P(FZNODE,"^",3),FBINTOT=FBINTOT+A2,FBAAID=$P(FZNODE,"^",15),FBAAVID=$P($G(^FBAAC(J,1,K,1,L,1,M,2)),"^")
"RTN","FBAACO3",87,0)
 Q
"RTN","FBAACO3",88,0)
FEEDT ;
"RTN","FBAACO3",89,0)
 ; input FB1725 - true (=1) when edited payment is for a Mill Bill claim
"RTN","FBAACO3",90,0)
 N FBX
"RTN","FBAACO3",91,0)
 D SETO:'$G(FY) S FBFY=FY-1
"RTN","FBAACO3",92,0)
 S (FBFSAMT,FBFSUSD)="",FBAMTPD=$G(FBAMTPD)
"RTN","FBAACO3",93,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBAADT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME))
"RTN","FBAACO3",94,0)
 I '$G(FBAAMM1) D
"RTN","FBAACO3",95,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAACO3",96,0)
 E  D
"RTN","FBAACO3",97,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAACO3",98,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAACO3",99,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAACO3",100,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAACO3",101,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAACO3",102,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAACO3",103,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAACO3",104,0)
 ;
"RTN","FBAACO3",105,0)
 I FB1725 D
"RTN","FBAACO3",106,0)
 . W !!?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAACO3",107,0)
 . I FBFSAMT D
"RTN","FBAACO3",108,0)
 . . S FBFSAMT=$J(FBFSAMT*.7,0,2)
"RTN","FBAACO3",109,0)
 . . W !?2,"  Therefore, fee schedule amount reduced to $",FBFSAMT," (70%)."
"RTN","FBAACO3",110,0)
 ;
"RTN","FBAACO3",111,0)
 I $G(FBUNITS)>1 D
"RTN","FBAACO3",112,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAACO3",113,0)
 . Q:FBFSAMT'>0
"RTN","FBAACO3",114,0)
 . N FBFSUNIT
"RTN","FBAACO3",115,0)
 . ; determine if fee schedule can be multipled by units
"RTN","FBAACO3",116,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBAADT>3040930):1,1:0)
"RTN","FBAACO3",117,0)
 . I FBFSUNIT D
"RTN","FBAACO3",118,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAACO3",119,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAACO3",120,0)
 . E  D
"RTN","FBAACO3",121,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAACO3",122,0)
 ;
"RTN","FBAACO3",123,0)
 I '$G(FBAAMM1) D
"RTN","FBAACO3",124,0)
 . ; set default amount paid to lesser of amt claimed (J) or fee sched.
"RTN","FBAACO3",125,0)
 . S FBAMTPD=$S(FBFSAMT'>0:J,FBFSAMT>J:J,1:FBFSAMT)
"RTN","FBAACO3",126,0)
 W !
"RTN","FBAACO3",127,0)
 Q
"RTN","FBAACO3",128,0)
CHKIT I X>FBAMTPD&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,"You must be a holder of the 'FBAASUPERVISOR' security key in order to",!,"exceed the Fee Schedule.",! S $P(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,0),"^",3)=K,Y=2 Q
"RTN","FBAACO3",129,0)
 Q
"RTN","FBAACO3",130,0)
NOGO W !!,*7,"This payment CANNOT be edited.  The batch the payment is in",!,"has been Vouchered.  You may void the payment with the Void Payment option.",!
"RTN","FBAACO3",131,0)
 Q
"RTN","FBAACO3",132,0)
 ;
"RTN","FBAACO3",133,0)
SC W *7,!?4,"Suspense code is required!",! S Y="@4" Q
"RTN","FBAACO3",134,0)
 ;
"RTN","FBAACO3",135,0)
DEL ;delete date of service if no service provided entered
"RTN","FBAACO3",136,0)
 I '$O(^FBAAC(DFN,1,FBV,1,FBSDI,1,0)) D
"RTN","FBAACO3",137,0)
 .S DIK="^FBAAC(DFN,1,FBV,1,",DA(2)=DFN,DA(1)=FBV,DA=FBSDI D ^DIK W !!?5,*7,"Incomplete payment entry deleted.",!
"RTN","FBAACO3",138,0)
 K DIK,DA Q
"RTN","FBAACP")
0^34^B46974663^B33766747
"RTN","FBAACP",1,0)
FBAACP ;AISC/CMR - C&P PAYMENT DRIVER ;6/22/2009
"RTN","FBAACP",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,77,108**;JAN 30, 1995;Build 115
"RTN","FBAACP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAACP",4,0)
 K FBAAOUT,FBPOP S FBCNP=1 ;C&P flag
"RTN","FBAACP",5,0)
 D SITE^FBAACO G Q:$G(FBPOP) D BT^FBAACO G Q:$G(FBAAOUT)
"RTN","FBAACP",6,0)
1 K FBAR,FBAAOUT,FBDL,FBAAMM D GETVEN1^FBAACO1:$D(FB583),GETVEN^FBAACO1:'$D(FB583) G CLN:$G(FBAAOUT)
"RTN","FBAACP",7,0)
 D GETINV^FBAACO1 G CLN:$G(FBAAOUT)
"RTN","FBAACP",8,0)
 D GETINDT^FBAACO1 G CLN:$G(FBAAOUT)
"RTN","FBAACP",9,0)
 D MMPPT^FBAACP G CLN:$G(FBAAOUT)
"RTN","FBAACP",10,0)
SVDT W !! S %DT="AEXP",%DT("A")="Date of Service: " D ^%DT I X="^" G CLN
"RTN","FBAACP",11,0)
 I Y<0!(Y>FBAAID) W *7,!!,"Enter the date the Vendor provided the service to the Patient.",!,"The date must be prior to the date the invoice is received.",! G SVDT
"RTN","FBAACP",12,0)
 S FBAADT=Y D SETO^FBAACO3,CPTM^FBAALU(FBAADT) I 'FBGOT G CLN
"RTN","FBAACP",13,0)
 ; prompt revenue code
"RTN","FBAACP",14,0)
 S FBAARC=$$ASKREVC^FBUTL5() I FBAARC="^" S FBAAOUT=1 G CLN
"RTN","FBAACP",15,0)
 ; prompt units paid
"RTN","FBAACP",16,0)
 S FBUNITS=$$ASKUNITS^FBUTL5() I FBUNITS="^" S FBAAOUT=1 G CLN
"RTN","FBAACP",17,0)
 D ASKZIP^FBAAFS($G(FBV),$G(FBAADT)) I $G(FBAAOUT)!($G(FBZIP)']"") G CLN
"RTN","FBAACP",18,0)
 I $$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) D ASKTIME^FBAAFS I $G(FBAAOUT)!('$G(FBTIME)) G CLN
"RTN","FBAACP",19,0)
 D HCFA G CLN:$G(FBAAOUT)
"RTN","FBAACP",20,0)
 S FBAAAMT=0 D AMTPD I $G(FBAAOUT)!('$G(FBAAAMT)) G CLN
"RTN","FBAACP",21,0)
 ; prompt for remittance remarks
"RTN","FBAACP",22,0)
 I $$RR^FBUTL4(.FBRRMK,2)=0 S FBAAOUT=1 G CLN
"RTN","FBAACP",23,0)
MULT ;begin unique patient entry
"RTN","FBAACP",24,0)
 W:FBINTOT>0 !,"Invoice: "_FBAAIN_" Totals: $ "_FBINTOT
"RTN","FBAACP",25,0)
 K FBAAOUT,FBDL S (DFN,FTP)="" D SITE^FBAACO G Q:$G(FBPOP) W !!
"RTN","FBAACP",26,0)
 I '$D(FB583) K FBDL D GETVET^FBAAUTL1 G CLN:'DFN K FBDMRA D GETAUTH^FBAAUTL1 G MULT:FTP']""
"RTN","FBAACP",27,0)
 ; check contract
"RTN","FBAACP",28,0)
 I $G(FBAAPTC)'="R",'$D(FB583),$$UCFA^FBUTL7($G(FBV),$G(FBVEN),$G(FBCNTRA)),FBCNTRP'=FBCNTRA D  G MULT
"RTN","FBAACP",29,0)
 . W !,"ERROR: Contract specified for payments (",$S(FBCNTRP:$P($G(^FBAA(161.43,FBCNTRP,0)),U),1:""),") doesn't"
"RTN","FBAACP",30,0)
 . W !,"match contract specified by this authorization (",$S(FBCNTRA:$P($G(^FBAA(161.43,FBCNTRA,0)),U),1:""),")."
"RTN","FBAACP",31,0)
 K FBAAOUT D  G Q:$G(FBAAOUT)
"RTN","FBAACP",32,0)
 . N ICDVDT S ICDVDT=$G(FBAADT)
"RTN","FBAACP",33,0)
 . F  D  Q:$G(FBAAOUT)  Q:($$INPICD9^FBCSV1(+$G(Y),"",$G(FBAADT))=0)
"RTN","FBAACP",34,0)
 . . S I=28,DIR(0)="PO^80:EMQZ",DIR("A")="PRIMARY DIAGNOSIS" D DIR
"RTN","FBAACP",35,0)
 D PAT^FBAACO W !! D FILEV^FBAACO5(DFN,FBV) I $G(FBAAOUT) G Q:$D(FB583),CLN
"RTN","FBAACP",36,0)
 ;check for payments against all linked vendors
"RTN","FBAACP",37,0)
 S DA=+Y D CHK^FBAACO4 K FBAACK1,FBAAOUT,DA,X,Y
"RTN","FBAACP",38,0)
 W !! D GETSVDT^FBAACO5(DFN,FBV,FBASSOC,0,FBAADT) I $G(FBAAOUT) D AUTHQ^FBAACO G MULT
"RTN","FBAACP",39,0)
 D SETO^FBAACO3,CHK2^FBAACO4 I FBJ']"" G SVPR
"RTN","FBAACP",40,0)
CHKE ;determines what action to take on duplicate services entered
"RTN","FBAACP",41,0)
 K FBAAOUT W !!,*7,"Service selected for that date already in system."
"RTN","FBAACP",42,0)
 S DIR(0)="Y",DIR("A")="Do you want to add another service for the SAME DATE",DIR("B")="No" D ^DIR K DIR G SVPR:Y I $D(DIRUT) D DEL^FBAACO3 G Q
"RTN","FBAACP",43,0)
 W !!,*7,"You must use the 'EDIT PAYMENT' option to edit the service previously",!,"entered for that date." D DEL^FBAACO3
"RTN","FBAACP",44,0)
 G MULT
"RTN","FBAACP",45,0)
SVPR K FBAAOUT D SVCPR^FBAACO1 G CHKE:$G(FBAAOUT)
"RTN","FBAACP",46,0)
 D FILE^FBAACP1 I Z1>(FBAAMPI-1) W !!,*7,"You have reached the maximum number of payments for a batch!",!,"You must select another Batch for entering Payments!" G CLN
"RTN","FBAACP",47,0)
 G MULT
"RTN","FBAACP",48,0)
Q ;kill variables and exit
"RTN","FBAACP",49,0)
 D Q^FBAACO
"RTN","FBAACP",50,0)
 Q
"RTN","FBAACP",51,0)
AMTPD ;get amount paid
"RTN","FBAACP",52,0)
 N FBX
"RTN","FBAACP",53,0)
 S FBFY=FY-1
"RTN","FBAACP",54,0)
 S (FBAMTPD,FBFSAMT,FBFSUSD)=""
"RTN","FBAACP",55,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBAADT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME))
"RTN","FBAACP",56,0)
 ;
"RTN","FBAACP",57,0)
 I '$G(FBAAMM1) D
"RTN","FBAACP",58,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAACP",59,0)
 E  D
"RTN","FBAACP",60,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAACP",61,0)
 ;
"RTN","FBAACP",62,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAACP",63,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAACP",64,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAACP",65,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAACP",66,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAACP",67,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAACP",68,0)
 ;
"RTN","FBAACP",69,0)
 I $G(FBUNITS)>1 D
"RTN","FBAACP",70,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAACP",71,0)
 . Q:FBFSAMT'>0
"RTN","FBAACP",72,0)
 . N FBFSUNIT
"RTN","FBAACP",73,0)
 . ; determine if fee schedule can be multipled by units
"RTN","FBAACP",74,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBAADT>3040930):1,1:0)
"RTN","FBAACP",75,0)
 . I FBFSUNIT D
"RTN","FBAACP",76,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAACP",77,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAACP",78,0)
 . E  D
"RTN","FBAACP",79,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAACP",80,0)
 ;
"RTN","FBAACP",81,0)
 I '$G(FBAAMM1) S FBAMTPD=FBFSAMT
"RTN","FBAACP",82,0)
 ;
"RTN","FBAACP",83,0)
 I FBAMTPD=0 D  Q:$G(FBAAOUT)
"RTN","FBAACP",84,0)
 . ;if fee schedule = 0 write message and quit
"RTN","FBAACP",85,0)
 . W !,"You must use the Enter Payment option for CPT codes that have a",!,"Fee Schedule set equal to zero."
"RTN","FBAACP",86,0)
 . S FBAAOUT=1
"RTN","FBAACP",87,0)
 W !
"RTN","FBAACP",88,0)
 S DIR(0)="162.03,1",DIR("A")="Enter Amount Paid:  $",DIR("?")="Enter a dollar amount that does not exceed the FEE Schedule" S:FBAMTPD'="" DIR("B")=FBAMTPD D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACP",89,0)
 I $G(FBAMTPD),+Y>FBAMTPD&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"You must be a holder of the 'FBAASUPERVISOR' security key to",!,"exceed the FEE Schedule.  Enter an '^' to quit or accept the default.",! G AMTPD
"RTN","FBAACP",90,0)
 S FBAAAMT=+Y
"RTN","FBAACP",91,0)
 Q
"RTN","FBAACP",92,0)
HCFA ;get HCFA fields
"RTN","FBAACP",93,0)
 F I=28,30,31 S FBHCFA(I)=""
"RTN","FBAACP",94,0)
 W ! F I=30,31 S DIR(0)="P"_$S(I=30:"^353.1",I=31:"O^353.2")_":EMQZ" D DIR Q:$G(FBAAOUT)
"RTN","FBAACP",95,0)
 K DIR Q
"RTN","FBAACP",96,0)
DIR ;generic DIR call for HCFA
"RTN","FBAACP",97,0)
 D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S FBAAOUT=1 Q
"RTN","FBAACP",98,0)
 S:Y'=-1 FBHCFA(I)=$P(Y,"^")
"RTN","FBAACP",99,0)
 Q
"RTN","FBAACP",100,0)
CLN G Q:$D(FB583)
"RTN","FBAACP",101,0)
 D Q G FBAACP
"RTN","FBAACP",102,0)
 Q
"RTN","FBAACP",103,0)
MMPPT ;money management/prompt pay type for multiple payment entry
"RTN","FBAACP",104,0)
 ; input
"RTN","FBAACP",105,0)
 ;   FBAAPTC = payment type code, "R" when patient reimbursement
"RTN","FBAACP",106,0)
 ;   FBV     = vendor being paid (ien)
"RTN","FBAACP",107,0)
 ;   when called from FBAAMP additional variables will be available
"RTN","FBAACP",108,0)
 ;     FBCNTRA = contract ien from authorization
"RTN","FBAACP",109,0)
 ;     FBVEN   = vendor from authorization
"RTN","FBAACP",110,0)
 ;     FB583   = defined when unauthorized claim
"RTN","FBAACP",111,0)
 ; output
"RTN","FBAACP",112,0)
 ;   FBAAMM  = prompt payment, =1 to ask
"RTN","FBAACP",113,0)
 ;   FBAAMM1 = prompt payment type for line
"RTN","FBAACP",114,0)
 ;   FBAAOUT = (optional), = 1 to quit
"RTN","FBAACP",115,0)
 ;   FBCNTRP = contract for line item (ien)
"RTN","FBAACP",116,0)
 ;
"RTN","FBAACP",117,0)
 S (FBAAMM,FBAAMM1,FBCNTRP)=""
"RTN","FBAACP",118,0)
 I $G(FBAAPTC)'="R",'$D(FB583) D
"RTN","FBAACP",119,0)
 . ;
"RTN","FBAACP",120,0)
 . ; check if contract required by authorization
"RTN","FBAACP",121,0)
 . I '$D(FB583),$$UCFA^FBUTL7($G(FBV),$G(FBVEN),$G(FBCNTRA)) D  Q
"RTN","FBAACP",122,0)
 . . W !,"All lines items on this invoice will be considered as contracted services"
"RTN","FBAACP",123,0)
 . . W !,"under Contract ",$P($G(^FBAA(161.43,FBCNTRA,0)),U)," from the authorization."
"RTN","FBAACP",124,0)
 . . S (FBAAMM,FBAAMM1)=1
"RTN","FBAACP",125,0)
 . . S FBCNTRP=FBCNTRA
"RTN","FBAACP",126,0)
 . ;
"RTN","FBAACP",127,0)
 . ; when not forced by authorization ask if contracted service
"RTN","FBAACP",128,0)
 . W !,"The answer to the following will apply to all payments entered via this option."
"RTN","FBAACP",129,0)
 . S DIR(0)="Y"
"RTN","FBAACP",130,0)
 . S DIR("A")="Are payments for contracted services"
"RTN","FBAACP",131,0)
 . S DIR("B")="No"
"RTN","FBAACP",132,0)
 . S DIR("?",1)="Answering no indicates interest will not be paid for any line items."
"RTN","FBAACP",133,0)
 . S DIR("?",2)="Answering yes indicates interest will be paid."
"RTN","FBAACP",134,0)
 . S DIR("?",3)="A fee schedule is not used for contracted services."
"RTN","FBAACP",135,0)
 . S DIR("?")="Enter either 'Y' or 'N'."
"RTN","FBAACP",136,0)
 . D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACP",137,0)
 . S (FBAAMM,FBAAMM1)=$S(Y:1,1:"")
"RTN","FBAACP",138,0)
 . Q:FBAAMM1=""
"RTN","FBAACP",139,0)
 . ;
"RTN","FBAACP",140,0)
 . ; if contracted service, ask contract
"RTN","FBAACP",141,0)
 . S DIR(0)="PO^161.43:AQEM"
"RTN","FBAACP",142,0)
 . S DIR("A")="CONTRACT"
"RTN","FBAACP",143,0)
 . S DIR("?",1)="If the line item is under a contract then select it."
"RTN","FBAACP",144,0)
 . S DIR("?")="Contract must be active and applicable for the vendor."
"RTN","FBAACP",145,0)
 . S DIR("S")="I $P($G(^(0)),""^"",2)'=""I"",$$VCNTR^FBUTL7($G(FBV),+Y)"
"RTN","FBAACP",146,0)
 . D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S FBAAOUT=1 Q
"RTN","FBAACP",147,0)
 . S:Y>0 FBCNTRP=+Y
"RTN","FBAACP",148,0)
 Q
"RTN","FBAACP1")
0^47^B6956346^B6699484
"RTN","FBAACP1",1,0)
FBAACP1 ;AISC/CMR-C&P PAYMENT DRIVER ;7/17/2003
"RTN","FBAACP1",2,0)
 ;;3.5;FEE BASIS;**4,61,116,108**;JAN 30, 1995;Build 115
"RTN","FBAACP1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACP1",4,0)
 ;
"RTN","FBAACP1",5,0)
FILE ;files sp multiple entry
"RTN","FBAACP1",6,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI,DA=FBAACPI
"RTN","FBAACP1",7,0)
 S TP="",DR="1///^S X=FBAAAMT;Q;2///^S X="_$S($G(FBDEN):0,1:FBAAAMT)_";I '$G(FBDEN) S Y=6;3//^S X=FBAAAMT;3.5///^S X=DT;@4;4;I X']"""" D SC^FBAACO3;S:X'=4 Y=6;22;6////^S X=DUZ;7////^S X=FBAABE"
"RTN","FBAACP1",8,0)
 S DR=DR_";8////^S X=BO;13///^S X=FBAAID;14///^S X=FBAAIN;15///^S X=FBPT;23////^S X=2;33///^S X=FBAAVID;16////^S X=FBPOV;17///^S X=FBTT;18///^S X=FBAAPTC;26////^S X=FBPSA"
"RTN","FBAACP1",9,0)
 S DR(1,162.03,1)="34///^S X=$G(FBAAMM1);28////^S X=FBHCFA(28);30///^S X=FBHCFA(30);31////^S X=FBHCFA(31);44///^S X=FBFSAMT;45////^S X=FBFSUSD;48///^S X=FBAARC;47///^S X=FBUNITS;54////^S X=FBCNTRP;S FBTST=1"
"RTN","FBAACP1",10,0)
 D LOCK^FBUCUTL("^FBAAC(",DFN,1)
"RTN","FBAACP1",11,0)
 D ^DIE
"RTN","FBAACP1",12,0)
 I $G(FBTST) D
"RTN","FBAACP1",13,0)
 . D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACP1",14,0)
 L -^FBAAC(DFN)
"RTN","FBAACP1",15,0)
 I '$G(FBTST),$G(DA) S DIR(0)="YA",DIR("A")="Entering an '^' will delete "_$S($G(FBDEN):"denial",1:"payment")_".  Are you sure you want to delete? ",DIR("B")="No" D ^DIR K DIR G FILE:'$D(DIRUT)&('Y) D KILL^FBAACO2 Q
"RTN","FBAACP1",16,0)
 S FBINTOT=FBINTOT+FBAAAMT
"RTN","FBAACP1",17,0)
 ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAACP1",18,0)
 ;I FBAAAMT>0 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1
"RTN","FBAACP1",19,0)
 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1
"RTN","FBAACP1",20,0)
 W !,$S($G(FBDEN):"Denial",1:"Payment")," Data Entered for Patient"
"RTN","FBAACP1",21,0)
 K FBDEN,FBAAMM1,FBTST,DIE,DR,DA
"RTN","FBAACP1",22,0)
 Q
"RTN","FBAACP1",23,0)
 ;
"RTN","FBAACP1",24,0)
PAID ;called from fbaacp to reset fee schedule if user opts to edit
"RTN","FBAACP1",25,0)
 ;a service.  If fee schedule of new cpt_modifier=0 tell user
"RTN","FBAACP1",26,0)
 ;not allowed in this option and refer to edit payment option.
"RTN","FBAACP1",27,0)
 ;
"RTN","FBAADEM1")
0^16^B14338880^B13894268
"RTN","FBAADEM1",1,0)
FBAADEM1 ;AISC/DMK - DISPLAY PATIENT DEMOGRAPHICS ;6/5/2009
"RTN","FBAADEM1",2,0)
 ;;3.5;FEE BASIS;**13,51,103,108**;JAN 30, 1995;Build 115
"RTN","FBAADEM1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAADEM1",4,0)
EN N FBDX,FBFDT,FBI,FBRR,FBT,FBTYPE,FBV,FBZ,PSA
"RTN","FBAADEM1",5,0)
 S:'$D(FBPROG) FBPROG="I 1"
"RTN","FBAADEM1",6,0)
 ;
"RTN","FBAADEM1",7,0)
 S Y=$G(^FBAAA(DFN,4)) W:$P(Y,"^")]"" !,"Fee ID Card #: ",$P(Y,"^"),?40,"Fee Card Issue Date: " S Y=$P(Y,"^",2) D PDF W Y,!
"RTN","FBAADEM1",8,0)
 ;
"RTN","FBAADEM1",9,0)
 I $O(^FBAAA(DFN,1,0)) D  Q:FBAAOUT
"RTN","FBAADEM1",10,0)
 . D HANG:$Y+5>IOSL Q:FBAAOUT
"RTN","FBAADEM1",11,0)
 . W !,"Patient Name: ",VADM(1),?55,"Pt.ID: ",$P(VADM(2),"^",2)
"RTN","FBAADEM1",12,0)
 . W !!,"AUTHORIZATIONS:",!
"RTN","FBAADEM1",13,0)
 . K FBAUT
"RTN","FBAADEM1",14,0)
 . S FBZ=0,FBFDT="9999999"
"RTN","FBAADEM1",15,0)
 . F  S FBFDT=$O(^FBAAA(DFN,1,"B",FBFDT),-1) Q:'FBFDT  D  Q:FBAAOUT
"RTN","FBAADEM1",16,0)
 . . S FBI=0 F  S FBI=$O(^FBAAA(DFN,1,"B",FBFDT,FBI)) Q:'FBI  I $D(^FBAAA(DFN,1,FBI,0)) X FBPROG I  S FBZ=FBZ+1,X=^(0) D  Q:FBAAOUT
"RTN","FBAADEM1",17,0)
 . . . S Y=+X,PSA=$P(X,"^",5),FBT=$P(X,"^",13),FBV=+$P(X,"^",4) D PDF
"RTN","FBAADEM1",18,0)
 . . . W ?3,"(",FBZ,")",?7,"FR: ",Y,?25,"VENDOR: ",$S($D(^FBAAV(FBV,0)):$P(^(0),"^")_" - "_$P(^(0),"^",2),1:"Not Specified")
"RTN","FBAADEM1",19,0)
 . . . S FBDX=$G(^FBAAA(DFN,1,FBI,3))
"RTN","FBAADEM1",20,0)
 . . . W !?7,"TO: " S Y=$P(X,"^",2) D PDF W Y
"RTN","FBAADEM1",21,0)
 . . . W:$P(X,"^",22) ?25,"Contract: ",$P($G(^FBAA(161.43,$P(X,"^",22),0)),"^")
"RTN","FBAADEM1",22,0)
 . . . W !?25,"Authorization Type: " D
"RTN","FBAADEM1",23,0)
 . . . . S FBTYPE=$P(X,"^",3),FBTYPE=$S(FBTYPE=2:"Outpatient - "_$S(FBT=1:"Short Term",FBT=2:"Home Health",FBT=3:"ID Card",1:""),$D(^FBAA(161.8,+FBTYPE,0)):$P(^(0),"^"),1:"Unknown")
"RTN","FBAADEM1",24,0)
 . . . W FBTYPE W:$P(X,"^",7) !,?11,"Purpose of Visit: ",$P($G(^FBAA(161.82,$P(X,"^",7),0)),"^") I $P(X,"^",9)["FB583(" W !?25,">> Unauthorized Claim <<"
"RTN","FBAADEM1",25,0)
 . . . ; PRXM/KJH - Patch 103. Add Referring Provider and NPI to the display.
"RTN","FBAADEM1",26,0)
 . . . W !?11,"DX: ",$P(X,"^",8) W ?40,"REF: "
"RTN","FBAADEM1",27,0)
 . . . I $P(X,"^",21)'="" W $$GET1^DIQ(200,$P(X,"^",21),.01)
"RTN","FBAADEM1",28,0)
 . . . W !?11,"REF NPI: ",$$REFNPI^FBCH78($P(X,"^",21)),!
"RTN","FBAADEM1",29,0)
 . . . W:$P(FBDX,"^")]"" !?15,$P(FBDX,"^")
"RTN","FBAADEM1",30,0)
 . . . W:$P(FBDX,"^",2)]"" !?15,$P(FBDX,"^",2)
"RTN","FBAADEM1",31,0)
 . . . S FBAUT($P(X,"^"))=$P(X,"^",2)
"RTN","FBAADEM1",32,0)
 . . . W !?7,"County: ",FBCOUNTY,?40,"PSA: ",$S($D(^DIC(4,+PSA,0)):$P(^(0),"^"),1:"Unknown"),!
"RTN","FBAADEM1",33,0)
 . . . S FBDEL=$G(^FBAAA(DFN,1,FBI,"ADEL")) I FBDEL]"" S Y=$P(FBDEL,"^",2) D PDF W ?12,">> DELETE MRA SENT TO AUSTIN ON - ",Y," >>",!
"RTN","FBAADEM1",34,0)
 . . . I $D(^FBAAA(DFN,1,FBI,2,0)) K ^UTILITY($J,"W") S DIWL=15,DIWR=70,DIWF="W" D HANG:$Y+6>IOSL Q:FBAAOUT  W !?11,"REMARKS:" D
"RTN","FBAADEM1",35,0)
 . . . . S FBRR=0 F  S FBRR=$O(^FBAAA(DFN,1,FBI,2,FBRR)) Q:'FBRR  S (FBXX,X)=^(FBRR,0) D ^DIWP
"RTN","FBAADEM1",36,0)
 . . . D ^DIWW:$D(FBXX) K FBXX W !
"RTN","FBAADEM1",37,0)
 . . . K X,FBDX,FBT,FBTYPE,FBV,PSA D HANG:$Y+5>IOSL
"RTN","FBAADEM1",38,0)
 ;
"RTN","FBAADEM1",39,0)
 D HANG:$Y+5>IOSL Q:FBAAOUT
"RTN","FBAADEM1",40,0)
 ;
"RTN","FBAADEM1",41,0)
 I $O(^FBAAA(DFN,2,0))>0 D  Q:FBAAOUT
"RTN","FBAADEM1",42,0)
 . W !,"VENDOR CONTACTS:"
"RTN","FBAADEM1",43,0)
 . S (FBZ,FBI)=0
"RTN","FBAADEM1",44,0)
 . F  S FBI=$O(^FBAAA(DFN,2,FBI)) Q:'FBI!(FBAAOUT)  S FBZ=FBZ+1,X=$G(^(FBI,0)),Y=+X D PDF D
"RTN","FBAADEM1",45,0)
 . . W !?3,"(",FBZ,")",?7,"DATE: ",Y,?25,"VENDOR: ",$P(X,"^",2),?55,"PHONE: ",$S($P(X,"^",3)]"":$P(X,"^",3),1:"Not Found")
"RTN","FBAADEM1",46,0)
 . . I $D(^FBAAA(DFN,2,FBI,1,0)) K ^UTILITY($J,"W") S DIWL=20,DIWR=70,DIWF="W" D HANG:$Y+5>IOSL Q:FBAAOUT  W !?11,"NARRATIVE:",! D
"RTN","FBAADEM1",47,0)
 . . . S FBRR=0 F  S FBRR=$O(^FBAAA(DFN,2,FBI,1,FBRR)) Q:'FBRR  S FBXX=^(FBRR,0) D HANG:$Y+5>IOSL Q:FBAAOUT  S X=FBXX D ^DIWP
"RTN","FBAADEM1",48,0)
 . . D ^DIWW:$D(FBXX) K FBXX W !
"RTN","FBAADEM1",49,0)
 Q
"RTN","FBAADEM1",50,0)
 ;
"RTN","FBAADEM1",51,0)
HANG I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1
"RTN","FBAADEM1",52,0)
 W @IOF I 'FBAAOUT W !,"Patient Name: ",VADM(1),?55,"Pt.ID: ",$P(VADM(2),"^",2),!
"RTN","FBAADEM1",53,0)
 Q
"RTN","FBAADEM1",54,0)
 ;
"RTN","FBAADEM1",55,0)
PDF S:Y Y=$$FMTE^XLFDT(Y,5)  ; TRANSLATE TO DISPLAY DATE
"RTN","FBAADEM1",56,0)
 Q
"RTN","FBAAMP")
0^35^B64599378^B64408896
"RTN","FBAAMP",1,0)
FBAAMP ;AISC/CMR-MULTIPLE PAYMENT ENTRY ;9/29/2003
"RTN","FBAAMP",2,0)
 ;;3.5;FEE BASIS;**4,21,38,55,61,67,116,108**;JAN 30, 1995;Build 115
"RTN","FBAAMP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAMP",4,0)
 S FBMP=1 ;multiple payment flag
"RTN","FBAAMP",5,0)
 G ^FBAACO
"RTN","FBAAMP",6,0)
1 ;return from FBAACO
"RTN","FBAAMP",7,0)
 D MMPPT^FBAACP G:$G(FBAAOUT) Q1
"RTN","FBAAMP",8,0)
 D MPDT I 'FBMPDT G Q1
"RTN","FBAAMP",9,0)
 K FBAAOUT W ! D CPTM^FBAALU(FBMPDT,DFN) I 'FBGOT G Q1
"RTN","FBAAMP",10,0)
 ; prompt revenue code
"RTN","FBAAMP",11,0)
 S FBAARC=$$ASKREVC^FBUTL5() I FBAARC="^" S FBAAOUT=1 G Q1
"RTN","FBAAMP",12,0)
 ; prompt units paid
"RTN","FBAAMP",13,0)
 S FBUNITS=$$ASKUNITS^FBUTL5() I FBUNITS="^" S FBAAOUT=1 G Q1
"RTN","FBAAMP",14,0)
 S FY=$E(DT,1,3)+1700+$S($E(DT,4,5)>9:1,1:0)
"RTN","FBAAMP",15,0)
 D ASKZIP^FBAAFS($G(FBV)) I $G(FBAAOUT)!($G(FBZIP)']"") G Q1
"RTN","FBAAMP",16,0)
 I $$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) D ASKTIME^FBAAFS I $G(FBAAOUT)!('$G(FBTIME)) G Q1
"RTN","FBAAMP",17,0)
 D HCFA^FBAAMP1 G Q1:$G(FBAAOUT)
"RTN","FBAAMP",18,0)
AMTCL S DIR(0)="162.03,1",DIR("A")="Amount Claimed:  $",DIR("?")="Enter the amount being claimed by the vendor" D ^DIR K DIR G Q:$D(DIRUT) S FBJ=+Y
"RTN","FBAAMP",19,0)
 W ! S DIR("A")="Is $"_FBJ_" correct for Amount Claimed",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G Q:$D(DIRUT),AMTCL:'Y
"RTN","FBAAMP",20,0)
RDAP D FEE G Q:$G(FBAAOUT) S FBK=FBAMTPD W ! S DIR("A")="Is $"_FBK_" correct for Amount Paid",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G Q:$D(DIRUT),RDAP:'Y
"RTN","FBAAMP",21,0)
 S FBAAAS=0 K FBADJ I FBJ-FBK D SUSP^FBAAMP1 I $G(FBAAOUT) G Q:$D(DUOUT),Q1
"RTN","FBAAMP",22,0)
 S FBJ=+FBJ,FBK=+FBK,FBAAAS=+FBAAAS
"RTN","FBAAMP",23,0)
 ; prompt for remittance remarks
"RTN","FBAAMP",24,0)
 I $$RR^FBUTL4(.FBRRMK,2)=0 S FBAAOUT=1 G Q1
"RTN","FBAAMP",25,0)
MULT W:FBINTOT>0 !,"Invoice: "_FBAAIN_" Totals: $ "_FBINTOT
"RTN","FBAAMP",26,0)
 W !! S %DT("A")="Date of Service: ",%DT="AEPX" D ^%DT G Q1:X=""!(X="^")
"RTN","FBAAMP",27,0)
 D DATCK^FBAAUTL G MULT:'$D(X)!(Y<0)
"RTN","FBAAMP",28,0)
 S FBDT=Y
"RTN","FBAAMP",29,0)
 I '$$CHKCPT() W !,$C(7),"Invalid Date of Service." G MULT
"RTN","FBAAMP",30,0)
 I $$CHKICD9^FBCSV1(+$G(FBHCFA(28)),$G(FBDT))="" G MULT
"RTN","FBAAMP",31,0)
 I '$G(FBAAMM1),'$$CHKFS() W !,$C(7),"Invalid Date of Service." G MULT
"RTN","FBAAMP",32,0)
 S DIR(0)="Y",DIR("A")="Is "_($$DATX^FBAAUTL(FBDT))_" correct",DIR("B")="Yes" D ^DIR K DIR G MULT:$D(DIRUT)!('Y)
"RTN","FBAAMP",33,0)
 S FBAADT=FBDT
"RTN","FBAAMP",34,0)
 S FBMODL=$$MODL^FBAAUTL4("FBMODA","I")
"RTN","FBAAMP",35,0)
 I $D(^FBAAC("AE",DFN,FBV,FBAADT,FBAACP_$S($G(FBMODL)]"":"-"_FBMODL,1:""))) S DIR(0)="Y",DIR("A")="Code already exists for that date!  Want to add another service for the SAME DATE",DIR("B")="No" D ^DIR K DIR G MULT:$D(DIRUT)!('Y)
"RTN","FBAAMP",36,0)
 I FBFPPSC]"" S FBFPPSL=$$FPPSL^FBUTL5() I FBFPPSL=-1 G Q1
"RTN","FBAAMP",37,0)
 W !! D GETSVDT^FBAACO5(DFN,FBV,FBASSOC,0,FBAADT) G Q:$G(FBAAOUT)
"RTN","FBAAMP",38,0)
 D SETO^FBAACO3,SVCPR^FBAACO1 G Q:$G(FBAAOUT)
"RTN","FBAAMP",39,0)
FILE S TP="",DR="1///^S X=FBJ;Q;2///^S X=FBK;47///^S X=FBUNITS"
"RTN","FBAAMP",40,0)
 I FBCSID]"" S DR=DR_";49///^S X=FBCSID"
"RTN","FBAAMP",41,0)
 I FBFPPSC]"" S DR=DR_";50///^S X=FBFPPSC;51///^S X=FBFPPSL"
"RTN","FBAAMP",42,0)
 I FBAARC]"" S DR=DR_";48////^S X=FBAARC"
"RTN","FBAAMP",43,0)
 ;S DR=DR_$S(FBJ-FBK:";3///^S X=FBAAAS;3.5////^S X=DT;4////^S X=FBAASC;D DESC^FBAAMP1",1:"")
"RTN","FBAAMP",44,0)
 S DR(1,162.03,1)="6////^S X=DUZ;7////^S X=FBAABE;8////^S X=BO;13///^S X=FBAAID;14///^S X=FBAAIN;15///^S X=FBPT;16////^S X=FBPOV;17///^S X=FBTT;18///^S X=FBAAPTC;23////^S X=2;26////^S X=FBPSA"
"RTN","FBAAMP",45,0)
 S DR(1,162.03,2)="34///^S X=$G(FBAAMM1);54////^S X=$G(FBCNTRP);28////^S X=FBHCFA(28);30////^S X=FBHCFA(30);31////^S X=FBHCFA(31);32////^S X=FBHCFA(32);33///^S X=FBAAVID;44///^S X=FBFSAMT;45////^S X=FBFSUSD"
"RTN","FBAAMP",46,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAAMP",47,0)
 S DA=FBAACPI,DA(1)=FBSDI,DA(2)=FBV,DA(3)=DFN
"RTN","FBAAMP",48,0)
 D LOCK^FBUCUTL(DIE,FBAACPI,1)
"RTN","FBAAMP",49,0)
 D ^DIE
"RTN","FBAAMP",50,0)
 D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAAMP",51,0)
 D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAAMP",52,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI)
"RTN","FBAAMP",53,0)
 S FBINTOT=FBINTOT+FBK
"RTN","FBAAMP",54,0)
 W " ....OK, DONE...."
"RTN","FBAAMP",55,0)
 ; HIPAA 5010 - count line items that have 0.00 amount paid
"RTN","FBAAMP",56,0)
 ;I FBK>0 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1
"RTN","FBAAMP",57,0)
 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1
"RTN","FBAAMP",58,0)
 W:Z1>(FBAAMPI-20) !,*7,"Warning, you can only enter ",(FBAAMPI-Z1)," more line items!" I Z1>(FBAAMPI-1) D  S FBMAX=1 G Q1
"RTN","FBAAMP",59,0)
 .W !!,*7,"You have reached the maximum number of payments for a Batch!",!,"You must select another Batch for entering Payments!"
"RTN","FBAAMP",60,0)
 G MULT
"RTN","FBAAMP",61,0)
Q1 K FBADJ,FBAADT,FBX,FBAACP,DIC,DIE,X,Y,DIRUT,DUOUT,DTOUT,FBOUT,FBSI,FBMPDT G ^FBAACO:$D(FBMAX),1^FBAACO
"RTN","FBAAMP",62,0)
 ;
"RTN","FBAAMP",63,0)
Q ;kill variables and exit
"RTN","FBAAMP",64,0)
 D Q^FBAACO
"RTN","FBAAMP",65,0)
 Q
"RTN","FBAAMP",66,0)
 ;
"RTN","FBAAMP",67,0)
MPDT ;
"RTN","FBAAMP",68,0)
 S FBMPDT=""
"RTN","FBAAMP",69,0)
 S DIR(0)="D^::EX"
"RTN","FBAAMP",70,0)
 S DIR("A")="Enter date to use for CPT/ICD checks and fee schedule calc"
"RTN","FBAAMP",71,0)
 S DIR("B")="TODAY"
"RTN","FBAAMP",72,0)
 S DIR("?",1)="Enter a date. This date will be used when checking for"
"RTN","FBAAMP",73,0)
 S DIR("?",2)="an active CPT/Modifier/ICD code. Also, the fee schedule"
"RTN","FBAAMP",74,0)
 S DIR("?",3)="amount will be computed based on this date."
"RTN","FBAAMP",75,0)
 S DIR("?")="Enter '^' to exit."
"RTN","FBAAMP",76,0)
 W !
"RTN","FBAAMP",77,0)
 D ^DIR K DIR S:'$D(DIRUT) FBMPDT=Y
"RTN","FBAAMP",78,0)
 Q
"RTN","FBAAMP",79,0)
 ;
"RTN","FBAAMP",80,0)
FEE N FBX,FB1725
"RTN","FBAAMP",81,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",82,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",83,0)
 S FBFY=FY-1
"RTN","FBAAMP",84,0)
 S (FBFSAMT,FBFSUSD,FBAMFS)=""
"RTN","FBAAMP",85,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBMPDT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME))
"RTN","FBAAMP",86,0)
 ;
"RTN","FBAAMP",87,0)
 I '$G(FBAAMM1) D
"RTN","FBAAMP",88,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAAMP",89,0)
 E  D
"RTN","FBAAMP",90,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAAMP",91,0)
 ;
"RTN","FBAAMP",92,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAAMP",93,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAAMP",94,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAAMP",95,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAAMP",96,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAAMP",97,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAAMP",98,0)
 ;
"RTN","FBAAMP",99,0)
 I FB1725 D
"RTN","FBAAMP",100,0)
 . W !!?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAAMP",101,0)
 . I FBFSAMT D
"RTN","FBAAMP",102,0)
 . . S FBFSAMT=$J(FBFSAMT*.7,0,2)
"RTN","FBAAMP",103,0)
 . . W !?2,"  Therefore, fee schedule amount reduced to $",FBFSAMT," (70%)."
"RTN","FBAAMP",104,0)
 ;
"RTN","FBAAMP",105,0)
 I $G(FBUNITS)>1 D
"RTN","FBAAMP",106,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAAMP",107,0)
 . Q:FBFSAMT'>0
"RTN","FBAAMP",108,0)
 . N FBFSUNIT
"RTN","FBAAMP",109,0)
 . ; determine if fee schedule can be multipled by units
"RTN","FBAAMP",110,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBMPDT>3040930):1,1:0)
"RTN","FBAAMP",111,0)
 . I FBFSUNIT D
"RTN","FBAAMP",112,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAAMP",113,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAAMP",114,0)
 . E  D
"RTN","FBAAMP",115,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAAMP",116,0)
 ;
"RTN","FBAAMP",117,0)
 I '$G(FBAAMM1) D
"RTN","FBAAMP",118,0)
 . ; set default amount paid to lesser of amt claimed (J) or fee sched.
"RTN","FBAAMP",119,0)
 . S FBAMFS=$S(FBFSAMT>$G(FBJ):$G(FBJ),1:FBFSAMT)
"RTN","FBAAMP",120,0)
 ;
"RTN","FBAAMP",121,0)
 W !
"RTN","FBAAMP",122,0)
 ;
"RTN","FBAAMP",123,0)
AMTPD S DIR(0)="162.5,9",DIR("A")="Amount Paid: $",DIR("B")=$G(FBAMFS),DIR("?")="^D HELP1^FBAAMP" K:$G(FBAMFS)="" DIR("B") D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAAMP",124,0)
 I +Y>FBJ W !!,*7,"Amount paid cannot be greater than the amount claimed." G AMTPD
"RTN","FBAAMP",125,0)
 I FBAMFS]"" I +Y>FBAMFS&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"You must be a holder of the 'FBAASUPERVISOR' key in order to",!,"exceed the Fee Schedule.",! G AMTPD
"RTN","FBAAMP",126,0)
 S FBAMTPD=+Y K FBAMFS Q
"RTN","FBAAMP",127,0)
HELP1 W !!,"Enter a dollar amount that does not exceed the amount claimed.",!
"RTN","FBAAMP",128,0)
 I FBAMFS>0 W "Only the holder of the 'FBAASUPERVISOR' key may exceed the",!,"Fee Schedule.",!
"RTN","FBAAMP",129,0)
 Q
"RTN","FBAAMP",130,0)
 ;
"RTN","FBAAMP",131,0)
CHKCPT() ; check if CPT/Modifer active on date of service
"RTN","FBAAMP",132,0)
 N FBCPTX,FBI,FBMOD,FBMODX,FBRET
"RTN","FBAAMP",133,0)
 S FBRET=1
"RTN","FBAAMP",134,0)
 S FBCPTX=$$CPT^ICPTCOD(FBAACP,FBDT,1)
"RTN","FBAAMP",135,0)
 I '$P(FBCPTX,U,7) S FBRET=0 W !,"  CPT Code ",$P(FBCPTX,U,2)," inactive on date of service."
"RTN","FBAAMP",136,0)
 I $O(FBMODA(0)) D
"RTN","FBAAMP",137,0)
 . S FBI=0 F  S FBI=$O(FBMODA(FBI)) Q:'FBI  D
"RTN","FBAAMP",138,0)
 . . S FBMODX=$$MOD^ICPTMOD(FBMODA(FBI),"I",FBDT,1)
"RTN","FBAAMP",139,0)
 . . I '$P(FBMODX,U,7) S FBRET=0 W !,"  CPT Modifier ",$P(FBMODX,U,2)," inactive on date of service."
"RTN","FBAAMP",140,0)
 Q FBRET
"RTN","FBAAMP",141,0)
 ;
"RTN","FBAAMP",142,0)
CHKFS() ; check if fee schedule amount is different on date of service
"RTN","FBAAMP",143,0)
 N FBX,FBRET,FB1725
"RTN","FBAAMP",144,0)
 S FBRET=1 ; return value - true if date of service allowed
"RTN","FBAAMP",145,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",146,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",147,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBDT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME))
"RTN","FBAAMP",148,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAAMP",149,0)
 S FB1725=$S($G(FB583):+$P($G(^FB583(+FB583,0)),U,28),1:0)
"RTN","FBAAMP",150,0)
 ; adjust amount if mill bill
"RTN","FBAAMP",151,0)
 I FB1725 S $P(FBX,U)=$J($P(FBX,U)*.7,0,2)
"RTN","FBAAMP",152,0)
 ; adjust amount if units > 1
"RTN","FBAAMP",153,0)
 I $G(FBUNITS) D
"RTN","FBAAMP",154,0)
 . N FBFSUNIT
"RTN","FBAAMP",155,0)
 . ; determine if fee schedule can be multipled by units
"RTN","FBAAMP",156,0)
 . S FBFSUNIT=$S($P(FBX,U,2)="R":1,$P(FBX,U,2)="F"&(FBDT>3040930):1,1:0)
"RTN","FBAAMP",157,0)
 . I FBFSUNIT S $P(FBX,U)=$J($P(FBX,U)*FBUNITS,0,2)
"RTN","FBAAMP",158,0)
 ; issue warning if lesser of claim and fee schedule amount different
"RTN","FBAAMP",159,0)
 I +$S($P(FBX,U)>$G(FBJ):$G(FBJ),1:$P(FBX,U))'=+$S(FBFSAMT>$G(FBJ):$G(FBJ),1:FBFSAMT) D
"RTN","FBAAMP",160,0)
 . W !,"  Warning: The fee schedule amount (",$P(FBX,U),") for this date of service "
"RTN","FBAAMP",161,0)
 . W !,"  differs from the initial fee schedule amount (",FBFSAMT,")."
"RTN","FBAAMP",162,0)
 . I $P(FBX,U)>0,FBK>$P(FBX,U) D
"RTN","FBAAMP",163,0)
 . . W !,"  Amount paid (",FBK,") exceeds the fee schedule amount."
"RTN","FBAAMP",164,0)
 . . I '$D(^XUSEC("FBAASUPERVISOR",DUZ)) D
"RTN","FBAAMP",165,0)
 . . . W !,"  You must be a holder of the 'FBAASUPERVISOR' key in order"
"RTN","FBAAMP",166,0)
 . . . W !,"  to exceed the Fee Schedule."
"RTN","FBAAMP",167,0)
 . . . S FBRET=0
"RTN","FBAAMP",168,0)
 . W:FBRET !,"  You may want to separately process this date of service."
"RTN","FBAAMP",169,0)
 Q FBRET
"RTN","FBAAMP",170,0)
 ;
"RTN","FBAAMP",171,0)
ANCIL ;ENTRY POINT FOR mutiple ancillary payment option
"RTN","FBAAMP",172,0)
 S FBCHCO=1 D ^FBAAMP
"RTN","FBAAMP",173,0)
 K FBCHCO Q
"RTN","FBAAODP0")
0^20^B4472268^B4441197
"RTN","FBAAODP0",1,0)
FBAAODP0 ;AISC/GRR - DELETE PAYMENT ;6/5/2009
"RTN","FBAAODP0",2,0)
 ;;3.5;FEE BASIS;**108**;JAN 30, 1995;Build 115
"RTN","FBAAODP0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAODP0",4,0)
 D DT^DICRW
"RTN","FBAAODP0",5,0)
BT S DIC="^FBAA(161.7,",DIC("S")=$S($D(^XUSEC("FBAASUPERVISOR",DUZ)):"I $G(^(""ST""))=""O"",$P(^(0),U,3)=""B3""",1:"I $P(^(0),U,5)=DUZ,$P(^(0),U,3)=""B3"",$G(^(""ST""))=""O""")
"RTN","FBAAODP0",6,0)
 S DIC(0)="AEQM",DIC("W")="W ""  Obligation #: "",$P(^(0),U,2)" W !! D ^DIC K DIC("W"),DIC("S")
"RTN","FBAAODP0",7,0)
 G Q:X["^"!(X="") I Y>0 S (DA,FBAABE)=+Y
"RTN","FBAAODP0",8,0)
 S FBAABO=$P(^FBAA(161.7,DA,0),"^",2)
"RTN","FBAAODP0",9,0)
1 I '$D(FBPROG) D SITEP^FBAAUTL S FBPROG=$S($P(FBSITE(1),"^",6)="":"I 1",1:"I $P(^(0),U,3)=2")
"RTN","FBAAODP0",10,0)
 D GETVET^FBAAUTL1 G BT:'DFN
"RTN","FBAAODP0",11,0)
 D GETAUTH^FBAAUTL1 G 1:FTP']""
"RTN","FBAAODP0",12,0)
 D ^FBAAODP G 1
"RTN","FBAAODP0",13,0)
Q K DIC,CNT,Y,X,X1,I,DIC,D0,DFN,A1,A2,B1,B2,DA,DR,F,FBI,FBPROG,FBRR,FBXX,PTYPE,FBAABDT,FBAABE,FBAABO,FBAACPT,FBAAEDT,FBAAPD,FBAATA,FBDX,FBGOT,FBIN,FBPOV,FBPT,FBTT,FBTYPE,FY,H,HDA,HOLDDA,MAJN,PI,Q,SUB,SUBN,UL,Z,ZS,ZZ
"RTN","FBAAODP0",14,0)
 K A,TA,FBAAOUT,FBAUT,L,K,V,FBVEN,FTP,FBSITE,FBLOC,FBASSOC,FB7078,FBPSA,FBAADT,FBAAOBN,FBAAODUZ,FBAAOPA,FBPOP,FBST,FBV,FBAOT,FBVCHDT,FB583
"RTN","FBAAODP0",15,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBAAODP0",16,0)
 Q
"RTN","FBAAPET")
0^32^B39436624^B35047442
"RTN","FBAAPET",1,0)
FBAAPET ;AISC/DMK-EDIT PAYMENT ;7/13/2003
"RTN","FBAAPET",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,77,116,122,133,108**;JAN 30, 1995;Build 115
"RTN","FBAAPET",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAPET",4,0)
 S FBOT=1
"RTN","FBAAPET",5,0)
GETPT I $G(BAT) D
"RTN","FBAAPET",6,0)
 .I '$D(^FBAAC("AC",+BAT)) F I=9,10,11 S $P(^FBAA(161.7,+BAT,0),U,I)=""
"RTN","FBAAPET",7,0)
 .I $D(^FBAAC("AC",+BAT)) D  S $P(^FBAA(161.7,+BAT,0),U,11)=I,$P(^(0),U,9)=$G(FBTOT) K I,FBTOT
"RTN","FBAAPET",8,0)
 ..N J,K,L,M S (I,J,K,L,M,FBTOT)=0
"RTN","FBAAPET",9,0)
 ..F  S J=$O(^FBAAC("AC",+BAT,J)) Q:'J  F  S K=$O(^FBAAC("AC",+BAT,J,K)) Q:'K  F  S L=$O(^FBAAC("AC",+BAT,J,K,L)) Q:'L  F  S M=$O(^FBAAC("AC",+BAT,J,K,L,M)) Q:'M  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S I=I+1,FBTOT=FBTOT+$P(^(0),U,3)
"RTN","FBAAPET",10,0)
 W !! S DIC="^FBAAC(",DIC(0)="AEQM" D ^DIC G END:X="^"!(X=""),GETPT:Y<0 S (DFN,FBDA(3))=+Y
"RTN","FBAAPET",11,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBAAPET",12,0)
 S DIC=DIC_DFN_",1,"
"RTN","FBAAPET",13,0)
GETVD W !! S DIC(0)="AEQM" D ^DIC G GETPT:X="^"!(X=""),GETVD:Y<0 S (FBV,FBVD,FBDA(2))=+Y
"RTN","FBAAPET",14,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,0)) ^FBAAC(DFN,1,FBDA(2),1,0)="^162.02DA^0^0"
"RTN","FBAAPET",15,0)
 S DIC=DIC_FBVD_",1,"
"RTN","FBAAPET",16,0)
GETDT S DIC(0)="AEQM",DIC("A")="Date of Service: " D ^DIC K DIC("A") G GETPT:X="^"!(X=""),GETDT:Y<0 S (FBSD,FBSDI,FBDA(1))=+Y,FBAADT=$P(Y,U,2)
"RTN","FBAAPET",17,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)) ^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)="^162.03A^0^0"
"RTN","FBAAPET",18,0)
 S FBZ=DIC_FBSD_",1,"
"RTN","FBAAPET",19,0)
SERV S DA(3)=FBDA(3),DA(2)=FBDA(2),DA(1)=FBDA(1)
"RTN","FBAAPET",20,0)
 S DIC("W")="N FBX S FBX=$$MODL^FBAAUTL4(""^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,+Y,""""M"""")"",""E"") W:FBX]"""" ""    CPT Modifier(s): "",FBX Q"
"RTN","FBAAPET",21,0)
 S DIC=FBZ,DIC(0)="AEQMZ"
"RTN","FBAAPET",22,0)
 D
"RTN","FBAAPET",23,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBAAPET",24,0)
 G GETPT:X="^"!(X=""),SERV:Y<0 S (FBSV,FBAACPI,FBDA)=+Y,BAT=$P(Y(0),U,8),FBDUZ=$P(Y(0),U,7),(FBAACP,FBAACP(0))=$P(Y,U,2),K=$P(Y(0),U,3),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBAAPET",25,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBAAPET",26,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBAAPET",27,0)
 I FBDUZ'=DUZ&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"Sorry,only the clerk who entered the payment ",!," or a supervisor can edit this payment." G GETPT
"RTN","FBAAPET",28,0)
 ;S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBAAPET",29,0)
 S FBFSAMT(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,12)
"RTN","FBAAPET",30,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBAAPET",31,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBAAPET",32,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"_FBDA(1)_",1,"_FBDA_",""M"")")
"RTN","FBAAPET",33,0)
 ; load current adjustment data
"RTN","FBAAPET",34,0)
 D LOADADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",35,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAAPET",36,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAAPET",37,0)
 ; load current remittance remark data
"RTN","FBAAPET",38,0)
 D LOADRR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",39,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAAPET",40,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAAPET",41,0)
 ; save FPPS data prior to edit session
"RTN","FBAAPET",42,0)
 S FBFPPSC(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U)
"RTN","FBAAPET",43,0)
 S FBFPPSC=FBFPPSC(0)
"RTN","FBAAPET",44,0)
 S FBFPPSL(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,2)
"RTN","FBAAPET",45,0)
 S FBFPPSL=FBFPPSL(0)
"RTN","FBAAPET",46,0)
 G:BAT']"" EDIT
"RTN","FBAAPET",47,0)
 I $G(^FBAA(161.7,BAT,"ST"))]"",$P(^FBAA(161.7,BAT,"ST"),"^")="S"!($P(^FBAA(161.7,BAT,"ST"),"^")="T")&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"Sorry, only the Supervisor can edit a payment once the batch has been released." G GETPT
"RTN","FBAAPET",48,0)
 I $G(^FBAA(161.7,BAT,"ST"))]"",$P(^FBAA(161.7,BAT,"ST"),"^")="V" W !!,*7,"Sorry,you cannot edit a payment once the batch has been Finalized." G GETPT
"RTN","FBAAPET",49,0)
EDIT S DA=FBSV
"RTN","FBAAPET",50,0)
 ;
"RTN","FBAAPET",51,0)
 ; first edit CPT code and modifiers
"RTN","FBAAPET",52,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) G GETPT
"RTN","FBAAPET",53,0)
 ; if CPT was changed then update file
"RTN","FBAAPET",54,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" G GETPT
"RTN","FBAAPET",55,0)
 . N FBIENS,FBFDA
"RTN","FBAAPET",56,0)
 . S FBIENS=FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_","
"RTN","FBAAPET",57,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBAAPET",58,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAAPET",59,0)
 ; if modifiers changed then update file
"RTN","FBAAPET",60,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(FBDA(3),FBDA(2),FBDA(1),FBDA)
"RTN","FBAAPET",61,0)
 ;
"RTN","FBAAPET",62,0)
 ; now edit remaining fields
"RTN","FBAAPET",63,0)
 S DIE("NO^")=""
"RTN","FBAAPET",64,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBAAPET",65,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only; 
"RTN","FBAAPET",66,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1,FBCNTRP,1);54///@;54////^S X=FBCNTRP;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAAPET",67,0)
 ;S DR(1,162.03,1)="30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAAPET",68,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;D CHKIT^FBAACO3;S K=X"
"RTN","FBAAPET",69,0)
 ;S DR(1,162.03,3)="3////^S X=$S(J-K:J-K,1:"""");I X S Y=""@11"";4////@;S Y=""@5"";@11;3R;4R;S:X'=4 Y=""@5"";22"
"RTN","FBAAPET",70,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBAAPET",71,0)
 S DR(1,162.03,4)="S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@5"";50///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;51///^S X=FBX;S FBFPPCL=X;S Y=""@55"";@5;50///@;S FBFPPSC="""";51///@;S FBFPPSL="""";@55"
"RTN","FBAAPET",72,0)
 S DR(1,162.03,5)="K DIE(""NO^"");W !,""Exit ('^') allowed now"";26;S PRC(""SITE"")=X;8;13;Q;33;49"
"RTN","FBAAPET",73,0)
 S DR(1,162.03,6)="15;17;16;S:X=1 Y=""@1"";@6;28R;S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@6"";31;32R;S Y=""@7"";@1;28;I X]"""" S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@1"";31"
"RTN","FBAAPET",74,0)
 S DR(1,162.03,7)="@7;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBAAPET",75,0)
 S DR(1,162.03,8)="73;74;75;58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69" ;FB*3.5*122,FB*3.5*133 edit line item provider fields
"RTN","FBAAPET",76,0)
 S DIE=FBZ
"RTN","FBAAPET",77,0)
 D
"RTN","FBAAPET",78,0)
 . N ICPTVDT,ICDVDT,FB583,FBAAMM,FBAAMM1,FBCNTRA,FBCNTRP,FBVEN,FTP
"RTN","FBAAPET",79,0)
 . S (ICPTVDT,ICDVDT)=$G(FBAADT)
"RTN","FBAAPET",80,0)
 . ; set variables for call to PPT^FBAACO1
"RTN","FBAAPET",81,0)
 . S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBAAPET",82,0)
 . S FBCNTRP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,8)
"RTN","FBAAPET",83,0)
 . S X=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,0)),U,13)
"RTN","FBAAPET",84,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBAAPET",85,0)
 . S FTP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),0)),U,4)
"RTN","FBAAPET",86,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBAAPET",87,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBAAPET",88,0)
 . D ^DIE
"RTN","FBAAPET",89,0)
 ; if adjustment data changed then file
"RTN","FBAAPET",90,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",91,0)
 ; if remit remark data changed then file
"RTN","FBAAPET",92,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",93,0)
 ; if FPPS CLAIM ID changed, update other line items on invoice
"RTN","FBAAPET",94,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBAAPET",95,0)
 . N FBAAIN
"RTN","FBAAPET",96,0)
 . S FBAAIN=$$GET1^DIQ(162.03,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",14)
"RTN","FBAAPET",97,0)
 . D CKINVEDI^FBAAPET1(FBFPPSC(0),FBFPPSC,FBAAIN,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",")
"RTN","FBAAPET",98,0)
 K FBSV W !! G SERV
"RTN","FBAAPET",99,0)
END K DR,DIC,DIE,X,DFN,FBOT,FBVD,FBSD,BAT,FBAADT,FBSV,DA,FBDA,FBZ,FBDUZ,FBAACP,FBFY,FY,FBAMTPD,J,K,Y,ZZ,PRC,FBHOLDX,FBV,FBSDI,FBAACPI
"RTN","FBAAPET",100,0)
 K FBFSAMT,FBFSUSD,FBMODA,FBZIP,FBTIME,FBHCFA(30),FBAAPTC,FB1725,FBADJ,FBADJD,FBADJL(0),FBRRMK,FBRRMKD,FBRRMKL(0),FBX,FBUNITS
"RTN","FBAAPET",101,0)
 Q
"RTN","FBAAPIE1")
0^22^B15539047^B15392299
"RTN","FBAAPIE1",1,0)
FBAAPIE1 ;AISC/GRR - ENTER FEE PHARMACY INVOICE ;6/5/2009
"RTN","FBAAPIE1",2,0)
 ;;3.5;FEE BASIS;**68,108**;JAN 30, 1995;Build 115
"RTN","FBAAPIE1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAPIE1",4,0)
LISTLI I '$D(^FBAA(162.1,DA,"RX","AB")) W !,"No prescriptions currently in this invoice.",! Q
"RTN","FBAAPIE1",5,0)
 D HOME^%ZIS S FSW=1
"RTN","FBAAPIE1",6,0)
 S FBAAOUT=0 F J=0:0 S J=$O(^FBAA(162.1,DA,"RX",J)) Q:J'>0  I $D(^FBAA(162.1,DA,"RX",J,0)) S Y(0)=^(0) D GETIT Q:FBAAOUT
"RTN","FBAAPIE1",7,0)
 Q
"RTN","FBAAPIE1",8,0)
Q K DIE,DIC,STAT,IN,VIN,DA,LCNT,AC,TAC,DATEF,DR,X,%DT,INVDATE,CNT,DAT,FBAABDT,FBAAEDT,FBAAIN,FBAAOUT,FBAAPN,FBAAPTC,FBBATCH,FBDRUG,FBDX,FBI,FBINTOT,FBINVN,FBMDF,FBPD,FBPOV,FBPT,FBSITE,FBRBC,FBREIM,PSRX,Y,Z,FBFDC,FBMST,FBTTYPE,FBPOP
"RTN","FBAAPIE1",9,0)
 K FBRR,FBT,FBTOV,FBTT,FBTV,FBTYPE,FEEO,FTP,FY,I,J,K,N,NAME,S,SSN,VAL,VAR,VID,VNAM,Z1,Z2,ZZ,D,F,FBAC,FBAP,FBFD,FBPROG,FBRX,FBXX,FSW,PI,POP,PTYPE,T,TA,DFN,D0,FBDEL,FBAUT,FBPSA,A1,A2,CHN,DOB,FBPV,FBQTY,FBSTR,FBSUSP,FID,L,PSA,Q,X1
"RTN","FBAAPIE1",10,0)
 K FB7078,FBASSOC,FBD1,FBLOC,FBVEN,DIRUT,FBAR,FBDA,FBJ,FBID,FBPARCD,FBTOUT,FBVINVDT,FBFPPSC
"RTN","FBAAPIE1",11,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBAAPIE1",12,0)
 Q
"RTN","FBAAPIE1",13,0)
GETIT S FBRX=$P(Y(0),"^"),FBFD=$P(Y(0),"^",3),FBAC=$P(Y(0),"^",4),DFN=+$P(Y(0),"^",5)
"RTN","FBAAPIE1",14,0)
 S SSN=$$SSN^FBAAUTL(DFN),VID=+$P($G(^FBAA(162.1,DA,0)),"^",4),VNAM=$P($G(^FBAAV(VID,0)),"^")
"RTN","FBAAPIE1",15,0)
 I FSW S FSW=0 D HED
"RTN","FBAAPIE1",16,0)
 I $Y+5>IOSL S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1 Q:FBAAOUT   D HED
"RTN","FBAAPIE1",17,0)
 W !,SSN,?19,$E(FBFD,4,5),"-",$E(FBFD,6,7),"-",$E(FBFD,2,3),?31,FBRX,?44,FBAC
"RTN","FBAAPIE1",18,0)
 Q
"RTN","FBAAPIE1",19,0)
HED W @IOF,"Invoice #: ",DA,?25,"Vendor Name: ",VNAM,!!,"Patient  I.D.",?18,"Fill Date",?30," RX  #",?40,"Amt Claimed",!
"RTN","FBAAPIE1",20,0)
 Q
"RTN","FBAAPIE1",21,0)
CHKK W !!,*7,"There already is a prescription number entered, from this vendor, ",!,"for that fill date. The invoice number is ",$O(^FBAA(162.1,"AL",VIN,PSRX,DATEF,""))_" ."
"RTN","FBAAPIE1",22,0)
 G RDD^FBAAPIE
"RTN","FBAAPIE1",23,0)
CALC ;Calculate Invoice Total
"RTN","FBAAPIE1",24,0)
 S FBINTOT=0 I $D(^FBAA(162.1,IN,"RX")) F I=0:0 S I=$O(^FBAA(162.1,IN,"RX",I)) Q:I'>0  I $D(^(I,0)) S FBINTOT=FBINTOT+$P(^FBAA(162.1,IN,"RX",I,0),"^",16)
"RTN","FBAAPIE1",25,0)
 K I Q
"RTN","FBAAPIE1",26,0)
RDM W ! S DIR("A")="Do you want to continue a previously entered Invoice",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR G Q:$D(DIRUT)!('Y)
"RTN","FBAAPIE1",27,0)
RD2 W !! S DIC="^FBAA(162.1,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,5)'=4" D ^DIC G Q:X="^"!(X=""),RD2:Y<0 S (DA,DA(1),IN)=+Y,VIN=$P(^(0),"^",4)
"RTN","FBAAPIE1",28,0)
 D CALC W:FBINTOT>0 !,?30,"Current Total: $ "_$J(FBINTOT,1,2)
"RTN","FBAAPIE1",29,0)
RD3 W ! S DIR("A")="Want to list previously entered line items",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR G Q:$D(DIRUT) D:Y LISTLI
"RTN","FBAAPIE1",30,0)
 S LCNT=+$P(^FBAA(162.1,IN,0),"^",9),TAC=+$P(^(0),"^",6),STAT=+$P(^(0),"^",5),STAT(STAT)="",FBFPPSC=$P(^FBAA(162.1,IN,0),"^",13) G RDP^FBAAPIE
"RTN","FBAAPIE1",31,0)
 Q
"RTN","FBAAPIE1",32,0)
RX2 W !!,*7,"This prescription number already exsists in this invoice.",!
"RTN","FBAAPIE1",33,0)
 W ! S DIR("A")="Do you wish to enter this prescription again",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR G CHK^FBAAPIE:$D(DIRUT),RDRX^FBAAPIE:'Y,RXADD^FBAAPIE
"RTN","FBAAPIE1",34,0)
 Q
"RTN","FBAAPIE1",35,0)
PROB W !!,"You do not have access to the Fee Invoice File, contact your IRM Service.",! G Q
"RTN","FBAAPIE1",36,0)
CHK2 ;Checks for duplicate payments on all linked vendors.
"RTN","FBAAPIE1",37,0)
 S FBJ=0 F  S FBJ=$O(FBAR(FBJ)) Q:$S('FBJ:1,$D(^FBAA(162.1,"AL",FBJ,PSRX,DATEF)):1,1:0)
"RTN","FBAAPIE1",38,0)
 Q
"RTN","FBAAPIN")
0^39^B34775282^B33741138
"RTN","FBAAPIN",1,0)
FBAAPIN ;AISC/GRR-INVOICE DISPLAY ;7/17/2003
"RTN","FBAAPIN",2,0)
 ;;3.5;FEE BASIS;**4,61,122,133,108**;JAN 30, 1995;Build 115
"RTN","FBAAPIN",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAPIN",4,0)
 D DT^DICRW
"RTN","FBAAPIN",5,0)
RD1 W ! S (FBHDONE,FBAAOUT,FBINTOT)=0,FBSW=0 K FBHED S DIR(0)="NO",DIR("A")="Select Invoice Number",DIR("?")="^D HELP^FBAAPIN1" D ^DIR K DIR G Q:$D(DIRUT)!'Y
"RTN","FBAAPIN",6,0)
 I '$D(^FBAAC("C",X)) W !,*7,"Invalid selection.",! G RD1
"RTN","FBAAPIN",7,0)
 S HX=X,FBAAIN=X D LIST S X=HX G RD1
"RTN","FBAAPIN",8,0)
LIST S Q="",$P(Q,"=",80)="="
"RTN","FBAAPIN",9,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBAAPIN",10,0)
 F J=0:0 S J=$O(^FBAAC("C",FBAAIN,J)) Q:J'>0!(FBAAOUT)  D MMORE
"RTN","FBAAPIN",11,0)
 Q
"RTN","FBAAPIN",12,0)
SET S FBFILE="^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",1,",D=$P($G(^FBAAC(J,1,K,1,L,0)),"^",1),FBYY=$G(^FBAAC(J,1,K,1,L,1,M,0)),FBYY("REJ")=$S($D(^FBAAC(J,1,K,1,L,1,M,"FBREJ")):^("FBREJ"),1:""),FBY=$G(^FBAAC(J,1,K,1,L,1,M,2))
"RTN","FBAAPIN",13,0)
 S FBY3=$G(^FBAAC(J,1,K,1,L,1,M,3))
"RTN","FBAAPIN",14,0)
 S FBAARCE=$$GET1^DIQ(162.03,M_","_L_","_K_","_J_",",48)
"RTN","FBAAPIN",15,0)
 D SET2
"RTN","FBAAPIN",16,0)
 Q
"RTN","FBAAPIN",17,0)
SET2 ;
"RTN","FBAAPIN",18,0)
 N FBX
"RTN","FBAAPIN",19,0)
 S N=$S($D(^DPT(J,0)):$P(^(0),"^",1),1:""),S=$S(N]"":$P(^DPT(J,0),"^",9),1:""),V=$S($D(^FBAAV(K,0)):$P(^FBAAV(K,0),"^",1),1:"")
"RTN","FBAAPIN",20,0)
 S T=$P(FBYY,"^",5),D2=$P(FBYY,"^",6),ZS=$P(FBYY,"^",20),VP=$P(FBYY,"^",21)
"RTN","FBAAPIN",21,0)
 S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBAAPIN",22,0)
 S TAMT=$FN($P(FBYY,U,4),"",2)
"RTN","FBAAPIN",23,0)
 S FBAACPT=$P(FBYY,"^",1) I FBAACPT]"" S FBAACPT=$$CPT^FBAAUTL4(FBAACPT)
"RTN","FBAAPIN",24,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBAAPIN",25,0)
 S FBUNITS=$P(FBY,U,14)
"RTN","FBAAPIN",26,0)
 S FBFPPSL=$P(FBY3,U,2)
"RTN","FBAAPIN",27,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBAAPIN",28,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAAPIN",29,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAAPIN",30,0)
 S FBRRMKL=$$RRL^FBAAFR(M_","_L_","_K_","_J_",")
"RTN","FBAAPIN",31,0)
 S FBCNTRN=$S($P(FBY3,U,8):$P($G(^FBAA(161.43,$P(FBY3,U,8),0)),U),1:"")
"RTN","FBAAPIN",32,0)
 S A1=$P(FBYY,"^",2)+.0001,A2=$P(FBYY,"^",3)+.0001,A3=$P(FBYY,"^",12)+.0001,A1=$P(A1,".",1)_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".",1)_"."_$E($P(A2,".",2),1,2),A3=$P(A3,".",1)_"."_$E($P(A3,".",2),1,2),FBINTOT=FBINTOT+A2+.0001
"RTN","FBAAPIN",33,0)
 S FBINTOT=$P(FBINTOT,".")_"."_$E($P(FBINTOT,".",2),1,2)
"RTN","FBAAPIN",34,0)
 S FBBN=$S($P(FBYY,"^",8)]"":$S($D(^FBAA(161.7,$P(FBYY,"^",8),0)):$P(^(0),"^",1),1:""),$P(FBYY("REJ"),"^",3)]"":$S($D(^FBAA(161.7,$P(FBYY("REJ"),"^",3),0)):$P(^(0),"^",1),1:""),1:"")
"RTN","FBAAPIN",35,0)
 D FBCKO^FBAACCB2(J,K,L,M)
"RTN","FBAAPIN",36,0)
 I $D(^FBAAC(J,1,K,1,L,1,M,4))!($D(^FBAAC(J,1,K,1,L,1,M,5))) D PROV
"RTN","FBAAPIN",37,0)
 I '$D(FBHED) D HED
"RTN","FBAAPIN",38,0)
 D WRT S FBHED=1
"RTN","FBAAPIN",39,0)
 Q
"RTN","FBAAPIN",40,0)
WRT I ($Y+5)>IOSL S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1 Q:FBAAOUT  D HED
"RTN","FBAAPIN",41,0)
 W !!,N,?33,$$DATX^FBAAUTL(D),?43,FBAACPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:"")
"RTN","FBAAPIN",42,0)
 I FBAARCE]"" W ?51,"/",FBAARCE
"RTN","FBAAPIN",43,0)
 W ?57,FBBN,?67,$S(FBYY("REJ")]"":"Rejected",1:$$DATX^FBAAUTL(D2))
"RTN","FBAAPIN",44,0)
 I $P($G(FBMODLE),",",2)]"" D  Q:FBAAOUT
"RTN","FBAAPIN",45,0)
 . N FBI
"RTN","FBAAPIN",46,0)
 . F FBI=2:1 S FBMOD=$P(FBMODLE,",",FBI) Q:FBMOD=""  D  Q:FBAAOUT
"RTN","FBAAPIN",47,0)
 . . I $Y+5>IOSL D  Q:FBAAOUT  W !,"(continued)"
"RTN","FBAAPIN",48,0)
 . . . S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1 Q:FBAAOUT  D HED
"RTN","FBAAPIN",49,0)
 . . W !,?48,"-",FBMOD
"RTN","FBAAPIN",50,0)
 W !,$S(ZS="R":"*",1:""),$S(VP="VP":"#",1:""),$S($G(FBCAN)]"":"+",1:"")
"RTN","FBAAPIN",51,0)
 W ?3,FBFPPSL,?14,"$",$J(A1,8),?26,"$",$J(A2,8),?37,FBUNITS
"RTN","FBAAPIN",52,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBAAPIN",53,0)
 W ?43,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBAAPIN",54,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBAAPIN",55,0)
 W ?53,"$",$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBAAPIN",56,0)
 W ?69,FBRRMKL
"RTN","FBAAPIN",57,0)
 ; if adjustment reasons null and suspend code = other then write desc.
"RTN","FBAAPIN",58,0)
 I FBADJLR="",T=4 D ^FBAAPIN1
"RTN","FBAAPIN",59,0)
 I FBCNTRN]"" W !!,?2,"Contract Number: ",FBCNTRN
"RTN","FBAAPIN",60,0)
 D PMNT^FBAACCB2
"RTN","FBAAPIN",61,0)
 Q
"RTN","FBAAPIN",62,0)
HED W @IOF,!,"Invoice Number: ",FBAAIN,?30,"Vendor Name: ",V,!,?2,"Date Received: ",FBINDAT
"RTN","FBAAPIN",63,0)
 I +$G(FBY) W ?33,"Invoice Date: ",$$DATX^FBAAUTL(+FBY)
"RTN","FBAAPIN",64,0)
 W !?2,"FPPS Claim ID: ",$S(FBFPPSC]"":FBFPPSC,1:"N/A")
"RTN","FBAAPIN",65,0)
 W ?33,"Patient Account #: ",FBCSID
"RTN","FBAAPIN",66,0)
 W !?10,"('*' Reimb. to Patient  '+' Cancel. Activity  '#' Voided Payment)"
"RTN","FBAAPIN",67,0)
 ;W !,"SVC DATE"," CPT-MOD ","   AMT CLAIMED",?35,"AMT PAID",?47,"CODE",?57,"BATCH NO.",?67,"VOUCHER DATE",!,?5,"Other Suspension Description",!,$$REPEAT^XLFSTR("=",79),!
"RTN","FBAAPIN",68,0)
 W !,"PATIENT",?33,"SVC DATE",?43,"CPT-MOD",?51,"/REV",?57,"BATCH NO.",?67,"VOUCHER DATE"
"RTN","FBAAPIN",69,0)
 W !,?3,"FPPS LINE",?14,"AMT CLAIMED",?26,"AMT PAID",?36,"UNITS",?43,"ADJ CODE",?53,"ADJ AMT",?69,"REMIT RMK"
"RTN","FBAAPIN",70,0)
 W !,$$REPEAT^XLFSTR("=",79)
"RTN","FBAAPIN",71,0)
 Q
"RTN","FBAAPIN",72,0)
Q K D,N,V,D2,J,K,L,M,DIC,T,FBYY,Q,I,A1,A2,A3,C,DIYS,FBAACPT,FBAAIN,FBAAOUT,FBBN,FBINTOT,FBINDAT,FBSW,FBHDONE,HX,S,VP,Z,ZS,FBHED,FBFILE,DIRUT,FBY,FBMOD
"RTN","FBAAPIN",73,0)
 K FBMODLE,FBY3,FBCNTRN
"RTN","FBAAPIN",74,0)
 K FBAARCE,FBADJLA,FBADJLR,FBCSID,FBFPPSC,FBFPPSL,FBRRMKL,FBUNITS,TAMT
"RTN","FBAAPIN",75,0)
 Q
"RTN","FBAAPIN",76,0)
ERR W !,*7,"Please enter a whole number! Alpha characters and puctuation are invalid" G RD1
"RTN","FBAAPIN",77,0)
SETHD S V=$S($D(^FBAAV(K,0)):$P(^(0),"^",1),1:"") D INDAT:FBSW S FBHDONE=1 Q
"RTN","FBAAPIN",78,0)
MMORE S FBSW=1 F K=0:0 S K=$O(^FBAAC("C",FBAAIN,J,K)) Q:K=""!(FBAAOUT)  D SETHD F L=0:0 S L=$O(^FBAAC("C",FBAAIN,J,K,L)) Q:L=""!(FBAAOUT)  F M=0:0 S M=$O(^FBAAC("C",FBAAIN,J,K,L,M)) Q:M'>0  D SET Q:FBAAOUT
"RTN","FBAAPIN",79,0)
 Q
"RTN","FBAAPIN",80,0)
INDAT S L=$O(^FBAAC("C",FBAAIN,J,K,"")),M=$O(^FBAAC("C",FBAAIN,J,K,L,""))
"RTN","FBAAPIN",81,0)
 S FBINDAT=$P($G(^FBAAC(J,1,K,1,L,1,M,0)),"^",15)
"RTN","FBAAPIN",82,0)
 S FBINDAT=$S(FBINDAT="":"Unknown",1:$E(FBINDAT,4,5)_"/"_$E(FBINDAT,6,7)_"/"_$E(FBINDAT,2,3))
"RTN","FBAAPIN",83,0)
 S FBFPPSC=$P($G(^FBAAC(J,1,K,1,L,1,M,3)),U,1)
"RTN","FBAAPIN",84,0)
 S FBCSID=$P($G(^FBAAC(J,1,K,1,L,1,M,2)),U,16)
"RTN","FBAAPIN",85,0)
 S FBSW=0 K L,M Q
"RTN","FBAAPIN",86,0)
 Q
"RTN","FBAAPIN",87,0)
PROV ;Display Invoice Provider information before invoice details FB*3.5*122
"RTN","FBAAPIN",88,0)
 N FBPRI,FBSRVF S FBPRI=$G(^FBAAC(J,1,K,1,L,1,M,4)),FBSRVF=$G(^FBAAC(J,1,K,1,L,1,M,5)),$P(FBSRVF,U,3)=$$GET1^DIQ(5,$P(FBSRVF,U,3)_",",1)
"RTN","FBAAPIN",89,0)
 W @IOF,!?30,"INVOICE DISPLAY",!?30,"===============",!?28,"PROVIDER INFORMATION",!
"RTN","FBAAPIN",90,0)
 I $L($P(FBPRI,U,1,3))>3 W !?3,"ATTENDING PROV NAME: "_$P(FBPRI,U),!?3,"ATTENDING PROV NPI: "_$P(FBPRI,U,2),?35,"ATTENDING PROV TAXONOMY CODE: "_$P(FBPRI,U,3)
"RTN","FBAAPIN",91,0)
 I $L($P(FBPRI,U,4,5))>2 W !!?3,"OPERATING PROV NAME: "_$P(FBPRI,U,4),!?3,"OPERATING PROV NPI: "_$P(FBPRI,U,5)
"RTN","FBAAPIN",92,0)
 I $L($P(FBPRI,U,6,8))>3 W !!?3,"RENDERING PROV NAME: "_$P(FBPRI,U,6),!?3,"RENDERING PROV NPI: "_$P(FBPRI,U,7),?35,"RENDERING PROV TAXONOMY CODE: "_$P(FBPRI,U,8)
"RTN","FBAAPIN",93,0)
 I $L($P(FBPRI,U,9,10))>2 W !!?3,"SERVICING PROV NAME: "_$P(FBPRI,U,9),!?3,"SERVICING PROV NPI: "_$P(FBPRI,U,10)
"RTN","FBAAPIN",94,0)
 I $L($P(FBSRVF,U,1,4))>4 W !?3,"SERVICING FACILITY ADDRESS: ",!?5,$P(FBSRVF,U),!?5,$P(FBSRVF,U,2) I $P(FBSRVF,U,2)'="" W ", "
"RTN","FBAAPIN",95,0)
 W $P(FBSRVF,U,3)_" "_$P(FBSRVF,U,4)
"RTN","FBAAPIN",96,0)
 I $L($P(FBPRI,U,11,12))>2 W !!?3,"REFERRING PROV NAME: "_$P(FBPRI,U,11),!?3,"REFERRING PROV NPI: "_$P(FBPRI,U,12),!!
"RTN","FBAAPIN",97,0)
 I '$D(FBHED) S DIR(0)="E" D ^DIR
"RTN","FBAAPIN",98,0)
 Q
"RTN","FBAAPM")
0^21^B5082140^B5041332
"RTN","FBAAPM",1,0)
FBAAPM ;AISC/DMK,GRR - CREATE PATIENT MRA TRANSACTION ;6/5/2009
"RTN","FBAAPM",2,0)
 ;;3.5;FEE BASIS;**13,108**;JAN 30, 1995;Build 115
"RTN","FBAAPM",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAPM",4,0)
1 Q:'$D(FBMTYPE)
"RTN","FBAAPM",5,0)
 D GETVET^FBAAUTL1 G END:'DFN
"RTN","FBAAPM",6,0)
 D GETAUTH^FBAAUTL1 G 1:FTP']""
"RTN","FBAAPM",7,0)
 S FBD1=+FTP
"RTN","FBAAPM",8,0)
3 W ! S DIR("A")="Are you sure you want to create a '"_$S(FBMTYPE="A":"Add",FBMTYPE="D":"Delete",FBMTYPE="C":"Change",FBMTYPE="R":"Reinstate",1:"")_"' type MRA for this patient",DIR("B")="Yes",DIR(0)="Y"
"RTN","FBAAPM",9,0)
 D ^DIR K DIR G 1:$D(DIRUT)!('Y)
"RTN","FBAAPM",10,0)
 S FBMST=$S($P(^FBAAA(DFN,1,FBD1,0),"^",13)=1:"Y",1:"")
"RTN","FBAAPM",11,0)
 S DIC="^FBAA(161.26,",DIC(0)="L",DLAYGO=161.26,X=DFN
"RTN","FBAAPM",12,0)
 S DR="1////^S X=""P"";2////^S X=FBD1;S Y=$S(FBMST="""":3,1:6);6////^S X=FBMST;3////^S X=FBMTYPE"
"RTN","FBAAPM",13,0)
 ; for Change MRA (expect State Home) ask if From Date was changed
"RTN","FBAAPM",14,0)
 I FBMTYPE="C",$P($G(^FBAAA(DFN,1,FBD1,0)),U,13)'=4 S DR=DR_";5"
"RTN","FBAAPM",15,0)
 S DIE=DIC K DD,DO D FILE^DICN K DLAYGO G:Y<0 END S DA=+Y
"RTN","FBAAPM",16,0)
 D ^DIE I $D(Y)>0 S DIK=DIE D ^DIK W !,*7,"MRA deleted.",! G 1
"RTN","FBAAPM",17,0)
 W !!,"Transaction Created!"
"RTN","FBAAPM",18,0)
 I FBMTYPE="D" S $P(^FBAAA(DFN,1,FBD1,"ADEL"),"^",1,2)="Y^"_DT
"RTN","FBAAPM",19,0)
 I FBMTYPE="R"!(FBMTYPE="A") S:$D(^FBAAA(DFN,1,FBD1,"ADEL")) ^("ADEL")=""
"RTN","FBAAPM",20,0)
 G 1
"RTN","FBAAPM",21,0)
END K DIC,CNT,Y,X,I,DIC,D0,DFN,F,C,FBD1,DA,DAT,DI,DIE,DQ,DR,PE,FBMST,FBMTYPE,FBVEN,FTP,FBPSA,FBLOC,FBASSOC,FB7078,FBAABDT,FBAAEDT,FBAAOUT,FBAUT,FBPOV,FBPROG,FBPT,FBTT,FBTYPE,PI,TA,Z,FBDMRA
"RTN","FBAAPM",22,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBAAPM",23,0)
 Q
"RTN","FBAAUTL")
0^48^B24039594^B23591801
"RTN","FBAAUTL",1,0)
FBAAUTL ;AISC/GRR,SBW-Fee Basis Utility Routine ; 4/23/10 3:06pm
"RTN","FBAAUTL",2,0)
 ;;3.5;FEE BASIS;**101,114,108**;JAN 30, 1995;Build 115
"RTN","FBAAUTL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAUTL",4,0)
DATE N FBDT S FBPOP=0 K BEGDATE,ENDDATE K:$G(%DT)'["A" %DT W !!,"**** Date Range Selection ****"
"RTN","FBAAUTL",5,0)
 S FBDT=$S($D(%DT):1,1:0) W ! S %DT=$S(FBDT:%DT,1:"APEX"),%DT("A")="   Beginning DATE : " D ^%DT S:Y<0 FBPOP=1 Q:Y<0  S (%DT(0),BEGDATE)=Y
"RTN","FBAAUTL",6,0)
 W ! S %DT=$S(FBDT:%DT,1:"AEX"),%DT("A")="   Ending    DATE : " D ^%DT K %DT S:Y<0 FBPOP=1 Q:Y<0  W ! S ENDDATE=Y
"RTN","FBAAUTL",7,0)
 Q
"RTN","FBAAUTL",8,0)
 ;
"RTN","FBAAUTL",9,0)
ZIS S ZTRTN=PGM,ZTSAVE="",FBPOP=0 F I=1:1 Q:$P(VAR,"^",I)']""  S ZTSAVE($P(VAR,"^",I))=""
"RTN","FBAAUTL",10,0)
 I '$D(ZTDESC) S ZTDESC=$S($D(PGM):PGM,1:"UNKNOWN OPTION")
"RTN","FBAAUTL",11,0)
 W ! S %ZIS="QMP" D ^%ZIS S:POP FBPOP=1 Q:POP  I $D(IO("Q")) K IO("Q"),ZTIO D ^%ZTLOAD W:$D(ZTSK) !,*7,"REQUEST QUEUED",!,"Task #: ",$G(ZTSK) K I,ZTSK,ZTIO,ZTSAVE,ZTRTN D HOME^%ZIS S FBPOP=1 Q
"RTN","FBAAUTL",12,0)
 Q
"RTN","FBAAUTL",13,0)
 ;
"RTN","FBAAUTL",14,0)
CLOSE I '$D(ZTQUEUED) D ^%ZISC
"RTN","FBAAUTL",15,0)
 K IOP,ZTDESC,ZTRTN,ZTSAVE,ZTDTH,VAR,VAL,PGM,FBPOP,POP Q
"RTN","FBAAUTL",16,0)
 ;
"RTN","FBAAUTL",17,0)
D S Y=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(Y,4,5))_" "_$S(Y#100:$J(Y#100\1,2)_",",1:"")_(Y\10000+1700)_$S(Y#1:"  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),1:"") Q
"RTN","FBAAUTL",18,0)
SITEP ;SET FBSITE(0),FBSITE(1) VARIABLE TO FEE SITE PARAMETERS
"RTN","FBAAUTL",19,0)
 S FBPOP=0,FBSITE(0)=$G(^FBAA(161.4,1,0)) S:FBSITE(0)']"" FBPOP=1
"RTN","FBAAUTL",20,0)
 S FBSITE(1)=$G(^FBAA(161.4,1,1)) S:FBSITE(1)']"" FBPOP=1
"RTN","FBAAUTL",21,0)
 S FBSITE("FBNUM")=$G(^FBAA(161.4,1,"FBNUM")) S:FBSITE("FBNUM")']"" FBPOP=1
"RTN","FBAAUTL",22,0)
 W:FBPOP !,*7,"Fee Basis Site Parameters must be entered to proceed",!
"RTN","FBAAUTL",23,0)
 Q
"RTN","FBAAUTL",24,0)
TM S X=$E($P(X,".",2)_"0000",1,4),%=X>1159 S:X>1259 X=X-1200 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M" Q
"RTN","FBAAUTL",25,0)
PDF S:Y Y=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3) Q
"RTN","FBAAUTL",26,0)
GETNXB ;GET NEXT AVAILABLE BATCH NUMBER
"RTN","FBAAUTL",27,0)
 L +^FBAA(161.4):$G(DILOCKTM,3) I '$T D  G GETNXB
"RTN","FBAAUTL",28,0)
 .W !,"Another user is opening a batch.  Trying again.",!
"RTN","FBAAUTL",29,0)
 I '$D(^FBAA(161.4,1,"FBNUM")) S ^FBAA(161.4,1,"FBNUM")="1^1"
"RTN","FBAAUTL",30,0)
 I '$P($G(^FBAA(161.4,1,"FBNUM")),"^") S $P(^("FBNUM"),"^")=1
"RTN","FBAAUTL",31,0)
 S FBBN=$P(^FBAA(161.4,1,"FBNUM"),"^")
"RTN","FBAAUTL",32,0)
 ;I FBBN>99899,$S('$D(^FBAA(161.4,1,"PURGE")):1,$P(^FBAA(161.4,1,"PURGE"),"^",1)'>0:1,1:"") D WARNBT
"RTN","FBAAUTL",33,0)
 I $P(^FBAA(161.7,0),U,4)>99899 D WARNBT ;*114
"RTN","FBAAUTL",34,0)
 S $P(^FBAA(161.4,1,"FBNUM"),"^",1)=$S(FBBN+1>99999:1,1:FBBN+1) I '$$CHKBI^FBAAUTL4(FBBN,1) L -^FBAA(161.4) G GETNXB
"RTN","FBAAUTL",35,0)
 L -^FBAA(161.4) Q
"RTN","FBAAUTL",36,0)
WARNBT W !,*7,"There are ",99999-FBBN," batches left before the BATCH PURGE routine",!,"needs to be run. Contact your IRM Service!",!!
"RTN","FBAAUTL",37,0)
 Q
"RTN","FBAAUTL",38,0)
GETNXI ;GET NEXT AVAILABLE INVOICE NUMBER 
"RTN","FBAAUTL",39,0)
 L +^FBAA(161.4):$G(DILOCKTM,3) I '$T D  G GETNXI
"RTN","FBAAUTL",40,0)
 .W !,"Another user is obtaining an invoice number.  Trying again.",!
"RTN","FBAAUTL",41,0)
 I '$D(^FBAA(161.4,1,"FBNUM")) S ^FBAA(161.4,1,"FBNUM")="1^1"
"RTN","FBAAUTL",42,0)
 I '$P($G(^FBAA(161.4,1,"FBNUM")),U,2) S $P(^("FBNUM"),U,2)=1
"RTN","FBAAUTL",43,0)
 S FBAAIN=$P(^FBAA(161.4,1,"FBNUM"),"^",2),$P(^("FBNUM"),"^",2)=$S(FBAAIN+1>9999999:1,1:FBAAIN+1) I '$$CHKBI^FBAAUTL4(FBAAIN) L -^FBAA(161.4) G GETNXI
"RTN","FBAAUTL",44,0)
 L -^FBAA(161.4) Q
"RTN","FBAAUTL",45,0)
PDATE S FBPDT=$P("January^February^March^April^May^June^July^August^September^October^November^December","^",$E(Y,4,5))_" "_$S(Y#100:$J(Y#100\1,2)_", ",1:"")_(Y\10000+1700)_$S(Y#1:"  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),1:"") Q
"RTN","FBAAUTL",46,0)
DATCK S HOLDY=Y,HOLDY=$S($P(HOLDY,"^",2):$P(HOLDY,"^",2),1:HOLDY)
"RTN","FBAAUTL",47,0)
 I $D(FBAAID),Y>FBAAID W !!,*7,"Date of Service cannot be later than Invoice Date!" K X Q
"RTN","FBAAUTL",48,0)
 I $D(FBAABDT),$D(FBAAEDT),(Y<FBAABDT!(Y>FBAAEDT)) W !!,*7,"Date of Service ",$S(Y<FBAABDT:"prior to ",1:"later than "),"Authorization period.",! K X
"RTN","FBAAUTL",49,0)
 S Y=HOLDY Q
"RTN","FBAAUTL",50,0)
 ;
"RTN","FBAAUTL",51,0)
DATX(X) ;external output function for date format
"RTN","FBAAUTL",52,0)
 ;INPUT = FM internal date format (time optional)
"RTN","FBAAUTL",53,0)
 ;OUTPUT = date/time with slashes
"RTN","FBAAUTL",54,0)
 Q $$FMTE^XLFDT(X,2)
"RTN","FBAAUTL",55,0)
 ;
"RTN","FBAAUTL",56,0)
STATION ;GET STATION NUMBER FROM INSTITUTION FILE
"RTN","FBAAUTL",57,0)
 I '$D(FBSITE(1)) D SITEP
"RTN","FBAAUTL",58,0)
 I $S('$D(FBSITE(1)):1,$P(FBSITE(1),"^",3)="":1,'$D(^DIC(4,$P(FBSITE(1),"^",3),0)):1,'$D(^DIC(4,$P(FBSITE(1),"^",3),99)):1,'+$P(^DIC(4,$P(FBSITE(1),"^",3),99),"^"):1,1:0) G NOSTA
"RTN","FBAAUTL",59,0)
 S (FBSN,FBAASN)=$S($D(^DIC(4,$P(FBSITE(1),"^",3),99)):$E(^(99),1,3),1:999)
"RTN","FBAAUTL",60,0)
 Q
"RTN","FBAAUTL",61,0)
NOSTA S FB("ERROR")=1 I '$D(ZTQUEUED) W !!,*7,"Unable to determine Station Number. Check Fee Site Parameters or Station Number in the Institution File.",!!
"RTN","FBAAUTL",62,0)
 Q
"RTN","FBAAUTL",63,0)
 ;
"RTN","FBAAUTL",64,0)
HD ;set transmission header
"RTN","FBAAUTL",65,0)
 I '$D(FBSITE(1)) S FBSITE(1)=$G(^FBAA(161.4,1,1))
"RTN","FBAAUTL",66,0)
 S FBHD=$$HDR^FBAAUTL3() I FBHD']"" S FB("ERROR")=1 W !,"Transmission header must exist in FEE BASIS SITE PARAMETER file",!,"before you can proceed.",*7,!
"RTN","FBAAUTL",67,0)
 Q
"RTN","FBAAUTL",68,0)
 ;
"RTN","FBAAUTL",69,0)
SSN(PID,BID,DOD) ;
"RTN","FBAAUTL",70,0)
 ;PID = DFN of Patient. If this is all that is past,
"RTN","FBAAUTL",71,0)
 ;full Pt.ID (000-00-0000) will be returned.
"RTN","FBAAUTL",72,0)
 ;If BID = 1 the call will return last 4 of Pt.ID only.
"RTN","FBAAUTL",73,0)
 ;If DOD is defined to internal entry # of eligibility the appropriate
"RTN","FBAAUTL",74,0)
 ;Pt.ID will be returned.
"RTN","FBAAUTL",75,0)
 N DFN,FBSSN
"RTN","FBAAUTL",76,0)
 S DFN=PID
"RTN","FBAAUTL",77,0)
 I 'DFN Q "Unknown"
"RTN","FBAAUTL",78,0)
 S:'$D(BID) BID="" S:$D(DOD) VAPTYP=DOD
"RTN","FBAAUTL",79,0)
 D PID^VADPT6 I VAERR K VAERR Q "Unknown"
"RTN","FBAAUTL",80,0)
 S FBSSN=$S(BID:VA("BID"),1:VA("PID"))
"RTN","FBAAUTL",81,0)
 K VA("BID"),VA("PID"),VAERR,VAPTYP
"RTN","FBAAUTL",82,0)
 Q FBSSN
"RTN","FBAAUTL",83,0)
 ;
"RTN","FBAAUTL",84,0)
SSNL4(SSN) ;Convert 1st 5 digits of SSN to X (Only print last 4 digits of SSN)
"RTN","FBAAUTL",85,0)
 ;Input:
"RTN","FBAAUTL",86,0)
 ;   SSN - SSN in 9 digit or ###-##-#### format
"RTN","FBAAUTL",87,0)
 ;     Pseudo SSN is also allowed as input
"RTN","FBAAUTL",88,0)
 ;Output
"RTN","FBAAUTL",89,0)
 ;   SSN - SSN in XXXXX#### or XXX-XX-#### format
"RTN","FBAAUTL",90,0)
 ;     Pseudo SSN will be changed as above with passed "P" at end
"RTN","FBAAUTL",91,0)
 ; X represent actual X and # represent digit
"RTN","FBAAUTL",92,0)
 ;
"RTN","FBAAUTL",93,0)
 S SSN=$G(SSN)
"RTN","FBAAUTL",94,0)
 ;Change SSN ######### to XXXXX####
"RTN","FBAAUTL",95,0)
 S:SSN?9N0.1"P" $E(SSN,1,5)="XXXXX"
"RTN","FBAAUTL",96,0)
 ;Change SSN ###-##-#### to XXX-XX-####
"RTN","FBAAUTL",97,0)
 S:SSN?3N1"-"2N1"-"4N0.1"P" $E(SSN,1,7)="XXX-XX-"
"RTN","FBAAUTL",98,0)
 Q SSN
"RTN","FBAAUTL1")
0^49^B21242092^B20594708
"RTN","FBAAUTL1",1,0)
FBAAUTL1 ;AISC/GRR - Fee Basis Utility Routine ;6/16/2009
"RTN","FBAAUTL1",2,0)
 ;;3.5;FEE BASIS;**3,12,13,108**;JAN 30, 1995;Build 115
"RTN","FBAAUTL1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAUTL1",4,0)
PLUSOB ;ENTRY POINT TO INCREASE OBLIGATION ADJUSTMENT
"RTN","FBAAUTL1",5,0)
 S FBAAMT="-"_FBAARA
"RTN","FBAAUTL1",6,0)
 D ADD Q
"RTN","FBAAUTL1",7,0)
 ;D NOW^%DTC S X=FBAAOB_"^"_%_"^^"_FBAAMT_"^"_FBAAB_"^"_FBCOMM,PRCS("TYPE")="FB" D EN2^PRCS58 I +Y=0 W !!,*7,Y,! S FBERR=1 Q
"RTN","FBAAUTL1",8,0)
 Q
"RTN","FBAAUTL1",9,0)
VALCK ;DETERMINE VALIDITY OF RESPONSE
"RTN","FBAAUTL1",10,0)
 S VAL=0 I $E(X)="?"!("YyNn"'[$E(X,1)) D HELPYN Q
"RTN","FBAAUTL1",11,0)
 S VAL=1
"RTN","FBAAUTL1",12,0)
 Q
"RTN","FBAAUTL1",13,0)
HELPYN ;DISPLAY HELP TEXT FOR YES OR NO
"RTN","FBAAUTL1",14,0)
 W !!,"Please enter 'Yes' or 'No'."
"RTN","FBAAUTL1",15,0)
 Q
"RTN","FBAAUTL1",16,0)
GETVET D DT^DICRW S DFN="",U="^" W !! S DIC="^FBAAA(",DIC(0)="AEMQZ",DIC("A")="Select Patient: " D ^DIC K DIC("A"),DIC("S") Q:Y<0  S (D0,DFN)=+Y
"RTN","FBAAUTL1",17,0)
 Q
"RTN","FBAAUTL1",18,0)
GETAUTH S CNT=0,FTP="" N FB,FBFDT
"RTN","FBAAUTL1",19,0)
 I '$D(^FBAAA(DFN,1)) W !!,"PATIENT HAS NO AUTHORIZATIONS " Q
"RTN","FBAAUTL1",20,0)
 S FBPROG=$S($D(FBPROG):FBPROG,1:"I 1")
"RTN","FBAAUTL1",21,0)
 S FBFDT=9999999 F  S FBFDT=$O(^FBAAA(DFN,1,"B",FBFDT),-1) Q:'FBFDT  D
"RTN","FBAAUTL1",22,0)
 . S I=0 F  S I=$O(^FBAAA(DFN,1,"B",FBFDT,I)) Q:'I  I $D(^FBAAA(DFN,1,I,0)) X FBPROG I  S CNT=CNT+1,CNT(CNT)=I
"RTN","FBAAUTL1",23,0)
 S PI="" D HOME^%ZIS D ^FBAADEM
"RTN","FBAAUTL1",24,0)
 I CNT<1 W !!,"Veteran does NOT have an Authorization for the Fee Program being used !!" G Q
"RTN","FBAAUTL1",25,0)
RD I CNT=1 S DIR(0)="Y",DIR("A")="Is this the correct Authorization period (Y/N)",DIR("B")="Yes" D ^DIR K DIR G:Y=0!($D(DIRUT)) NOAUTH S X=1 G 2
"RTN","FBAAUTL1",26,0)
CHOOS W !! S DIR(0)="N^1:"_CNT D ^DIR K DIR S X=+Y Q:$D(DUOUT)  G H^XUS:$D(DTOUT)
"RTN","FBAAUTL1",27,0)
2 S (FTP,X)=CNT(X),FB=$G(^FBAAA(DFN,1,X,0)),FBAABDT=$P(FB,"^"),FBAAEDT=$P(FB,"^",2),FBTYPE=$P(FB,"^",3),TA=$P(FB,"^",11),FBTT=$P(FB,"^",13),FBPOV=$P(FB,"^",7),FBPT=$P(FB,"^",18),FBPSA=$P(FB,"^",5),FBVEN=$P(FB,"^",4),FB7078=""
"RTN","FBAAUTL1",28,0)
 I $P(FB,"^",9)[";FB7078(" S FB7078=+$P(FB,"^",9)
"RTN","FBAAUTL1",29,0)
 I $P(FB,"^",9)[";FB583(" S FB583=+$P(FB,"^",9)
"RTN","FBAAUTL1",30,0)
 S FBDMRA=$G(^FBAAA(DFN,1,X,"ADEL")) I FBDMRA']"" K FBDMRA
"RTN","FBAAUTL1",31,0)
 S FBASSOC=X
"RTN","FBAAUTL1",32,0)
 I FB7078]"" S FBVEN=+$P($G(^FB7078(+FB7078,0)),U,2)
"RTN","FBAAUTL1",33,0)
 S FBCNTRA=$P(FB,"^",22)
"RTN","FBAAUTL1",34,0)
Q Q
"RTN","FBAAUTL1",35,0)
GETAUTHK ; kill new authorization variables output from GETAUTH
"RTN","FBAAUTL1",36,0)
 K FBCNTRA
"RTN","FBAAUTL1",37,0)
 Q
"RTN","FBAAUTL1",38,0)
DAYS ;CALCULATES THE NUMBER OF DAYS IN MONTH
"RTN","FBAAUTL1",39,0)
 S X1=X,X=+$E(X,4,5),X=$S("^1^3^5^7^8^10^12^"[("^"_X_"^"):31,X=2:28,1:30)
"RTN","FBAAUTL1",40,0)
 I X=28 D
"RTN","FBAAUTL1",41,0)
 . N YEAR
"RTN","FBAAUTL1",42,0)
 . S YEAR=$E(X1,1,3)+1700
"RTN","FBAAUTL1",43,0)
 . I $S(YEAR#400=0:1,YEAR#4=0&'(YEAR#100=0):1,1:0) S X=29
"RTN","FBAAUTL1",44,0)
 Q
"RTN","FBAAUTL1",45,0)
DATCK2 I $D(FBAABDT),$D(FBAAEDT),Y<FBAABDT!(Y\1>FBAAEDT) W !!,*7,"Date ",$S(Y<FBAABDT:"prior to ",1:"later than "),"Authorization period",! K X Q
"RTN","FBAAUTL1",46,0)
 I $D(FBTRT),$D(FBLTD),(9999999.999999-Y)'<FBLTD W !,*7,"There is already an existing admission for this authorization!",! K X
"RTN","FBAAUTL1",47,0)
 Q
"RTN","FBAAUTL1",48,0)
DATCK3 I $D(FBLTTYP),FBLTTYP]"",FBLTTYP<4,(X-3)'=FBLTTYP W !!,*7,"That transfer type NOT consistent with last transfer type!",! K X
"RTN","FBAAUTL1",49,0)
 I $D(FBLTT),FBLTT="A",X>3 W !!,*7,"A 'Transfer From' type transaction can only follow a 'Transfer To' type!",! K X
"RTN","FBAAUTL1",50,0)
 Q
"RTN","FBAAUTL1",51,0)
WRONGT ;WRONG TYPE OF AUTHORIZATION SELECTED
"RTN","FBAAUTL1",52,0)
 W !!,"Authorization type selected inconsistent with option being used" Q
"RTN","FBAAUTL1",53,0)
GETVEN ;LOOKUP VENDOR
"RTN","FBAAUTL1",54,0)
 W ! S DIC=161.2,DIC(0)="AEQM",IFN="" D ^DIC Q:Y<0  S IFN=+Y Q
"RTN","FBAAUTL1",55,0)
HANG ;IF $E(IOST,1,2)["C-" ASK TO CONTINUE
"RTN","FBAAUTL1",56,0)
 S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1 Q
"RTN","FBAAUTL1",57,0)
CKOB D STATION^FBAAUTL I $D(FB("ERROR")) K FB("ERROR"),X Q
"RTN","FBAAUTL1",58,0)
 S PRC("SITE")=$S($D(PRC("SITE")):PRC("SITE"),1:FBSN) K FBSN,FBAASN
"RTN","FBAAUTL1",59,0)
 I '$D(^PRC(442,"B",PRC("SITE")_"-"_X)) W !,"This Obligation number does not exist in the IFCAP file!",! K PRC,X
"RTN","FBAAUTL1",60,0)
 Q
"RTN","FBAAUTL1",61,0)
CK1358 ;CHECK TO SEE IF 1358 AVAILABLE
"RTN","FBAAUTL1",62,0)
 ;FBAAOB=FULL OBLIGATION NUMBER (STA-CXXXXX)
"RTN","FBAAUTL1",63,0)
 ;RETURNS Y=1 IF OK
"RTN","FBAAUTL1",64,0)
 S PRCS("X")=FBAAOB,PRCS("TYPE")="FB" D EN3^PRCS58 I Y=-1 W !!,*7,"1358 not available for posting!",! S FBERR=1 Q
"RTN","FBAAUTL1",65,0)
 Q
"RTN","FBAAUTL1",66,0)
NOAUTH S (FTP,X)="" Q
"RTN","FBAAUTL1",67,0)
LOCK W !!,*7,"Queueing has been initiated by another user and is now in progress!",!! Q
"RTN","FBAAUTL1",68,0)
 ;
"RTN","FBAAUTL1",69,0)
XSET ;SET X-REF IN FILE 161.27 FOR LOOK-UP BY SHORT DESCRIPTION
"RTN","FBAAUTL1",70,0)
 S ZZ=^FBAA(161.27,DA,2) D TRANS S ^FBAA(161.27,"C",$E(ZZ,1,30),DA)=""
"RTN","FBAAUTL1",71,0)
 K ZZ Q
"RTN","FBAAUTL1",72,0)
XKILL ;
"RTN","FBAAUTL1",73,0)
 S ZZ=^FBAA(161.27,DA,2) D TRANS K ^FBAA(161.27,"C",$E(ZZ,1,30),DA)
"RTN","FBAAUTL1",74,0)
 K ZZ Q
"RTN","FBAAUTL1",75,0)
 ;
"RTN","FBAAUTL1",76,0)
TRANS ;
"RTN","FBAAUTL1",77,0)
 S ZZ=$TR(ZZ,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","FBAAUTL1",78,0)
 Q
"RTN","FBAAUTL1",79,0)
 ;
"RTN","FBAAUTL1",80,0)
VER() ;no parameters passed
"RTN","FBAAUTL1",81,0)
 ;returns 1 if site is running version 4 of IFCAP
"RTN","FBAAUTL1",82,0)
 ;S X=$G(^DIC(9.4,+$O(^DIC(9.4,"C","PRC",0)),"VERSION"))
"RTN","FBAAUTL1",83,0)
 N X
"RTN","FBAAUTL1",84,0)
 S X=$$VERSION^XPDUTL("PRC")
"RTN","FBAAUTL1",85,0)
 Q $S(+X=4:1,1:0)
"RTN","FBAAUTL1",86,0)
 ;
"RTN","FBAAUTL1",87,0)
ADD ;call to add money back into 1358 when version of IFCAP>3.6
"RTN","FBAAUTL1",88,0)
 ;uses interface ID look-up to get internal entry number
"RTN","FBAAUTL1",89,0)
 ;interface ID = IEN of batch from 161.7
"RTN","FBAAUTL1",90,0)
 ;find ien to 424 by $O(^PRC(424,"E",FBN,0))
"RTN","FBAAUTL1",91,0)
 ;call NOT used for civil hospital/cnh
"RTN","FBAAUTL1",92,0)
 S PRCS("X")=FBAAOB,PRCS("TYPE")="FB" D EN3^PRCS58 I Y=-1 W !!,*7,"1358 not available for posting!",! S FBERR=1 Q
"RTN","FBAAUTL1",93,0)
 N FBADDX S FBADDX=$O(^PRC(424,"E",+$G(FBN),0)) I 'FBADDX S FBERR=1 Q
"RTN","FBAAUTL1",94,0)
 D NOW^%DTC
"RTN","FBAAUTL1",95,0)
 S PRCSX=FBADDX_"^"_%_"^"_FBAAMT_"^"_FBCOMM_"^"_1
"RTN","FBAAUTL1",96,0)
 D ^PRCS58CC I Y'=1 W !!,*7,$P(Y,U,2),! S FBERR=1
"RTN","FBAAUTL1",97,0)
 Q
"RTN","FBAAV0")
0^11^B43916106^B39796273
"RTN","FBAAV0",1,0)
FBAAV0 ;AISC/GRR-ELECTRONICALLY TRANSMIT FEE DATA ;11 Apr 2006  2:51 PM
"RTN","FBAAV0",2,0)
 ;;3.5;FEE BASIS;**3,4,55,89,98,116,108**;JAN 30, 1995;Build 115
"RTN","FBAAV0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAV0",4,0)
 K ^TMP($J,"FBAABATCH"),^TMP($J,"FBVADAT") D DT^DICRW
"RTN","FBAAV0",5,0)
 I '$D(^FBAA(161.7,"AC","S")),'$D(^FBAA(161.7,"AC","R")),'$D(^FBAA(161.25,"AE")),$S('$D(^FBAA(161.26,"AC","P")):1,$O(^FBAA(161.26,"AC","P",0))'>0:1,1:0) W !,*7,"There are no transactions requiring transmission",*7 Q
"RTN","FBAAV0",6,0)
 W !!,"This option will transmit all Batches and MRA's ready to be transmitted",!,"to Austin"
"RTN","FBAAV0",7,0)
RD W !! S DIR(0)="Y",DIR("A")="Are you sure you want to continue",DIR("B")="No" D ^DIR K DIR G END:'Y
"RTN","FBAAV0",8,0)
 L +^FBAA(161.7,"AC"):0 G:'$T LOCK^FBAAUTL1
"RTN","FBAAV0",9,0)
 W !!,"The following Batches will be transmitted: " F FBSTAT="S","R" F J=0:0 S J=$O(^FBAA(161.7,"AC",FBSTAT,J)) Q:J'>0  S FBATCH=$G(^FBAA(161.7,J,0)) D
"RTN","FBAAV0",10,0)
 .Q:'+FBATCH
"RTN","FBAAV0",11,0)
 .I (FBSTAT="S"&($P(FBATCH,U,15)="Y"))!(+$P(FBATCH,U,9)) S ^TMP($J,"FBAABATCH",J)="" W !,+FBATCH
"RTN","FBAAV0",12,0)
RTRAN ;Entry from Re-transmit MRA routine
"RTN","FBAAV0",13,0)
 D ADDRESS^FBAAV01 G END:VATERR K VAT
"RTN","FBAAV0",14,0)
 D WAIT^DICD,STATION^FBAAUTL,HD^FBAAUTL I $D(FB("ERROR")) G END
"RTN","FBAAV0",15,0)
 S TOTSTR=0,$P(PAD," ",200)=" "
"RTN","FBAAV0",16,0)
 D ^FBAAV1:$D(^FBAA(161.25,"AE"))
"RTN","FBAAV0",17,0)
 D ^FBAAV4:$D(^FBAA(161.26,"AC","P"))
"RTN","FBAAV0",18,0)
 F J=0:0 S J=$O(^TMP($J,"FBAABATCH",J)) Q:J'>0  I $D(^FBAA(161.7,J,0)) S Y(0)=^(0) D SET1,DET:FBAABT="B3",DETP^FBAAV2:FBAABT="B5",DETT^FBAAV3:FBAABT="B2",^FBAAV5:FBAABT="B9"
"RTN","FBAAV0",19,0)
END L -^FBAA(161.7,"AC") D KILL^FBAAV1 Q
"RTN","FBAAV0",20,0)
SET1 ; build the payment batch header string (used by all four formats)
"RTN","FBAAV0",21,0)
 S FBAABN=$P(Y(0),"^",1),FBAABN=$E("00000",$L(FBAABN)+1,5)_FBAABN
"RTN","FBAAV0",22,0)
 S FBAAON=$E($P(Y(0),"^",2),3,6)
"RTN","FBAAV0",23,0)
 S FBAACD=$$AUSDT^FBAAV3(DT)
"RTN","FBAAV0",24,0)
 S FBAACP=$E($P(Y(0),"^",2),1,2)
"RTN","FBAAV0",25,0)
 S FBAABT=$P(Y(0),"^",3)
"RTN","FBAAV0",26,0)
 S FBAAAP=$$AUSAMT^FBAAV3($P(Y(0),"^",9),11)
"RTN","FBAAV0",27,0)
 S FBSTAT=$P(^FBAA(161.7,J,"ST"),"^")
"RTN","FBAAV0",28,0)
 S FBCHB=$P(Y(0),"^",15)
"RTN","FBAAV0",29,0)
 S FBEXMPT=$P(Y(0),"^",18)
"RTN","FBAAV0",30,0)
 S X=$$SUB^FBAAUTL5(+$P(Y(0),U,8)_"-"_$P(Y(0),U,2))
"RTN","FBAAV0",31,0)
 S FBAASN=$$LJ^XLFSTR($S(X]"":X,1:FBAASN),6," ")
"RTN","FBAAV0",32,0)
 I FBSTAT="R"!(FBSTAT="S"&(FBCHB'["Y"))!(FBSTAT="S"&($G(FBEXMPT)="Y")) S FBSTR=FBHD_$S(FBAABT="B2":"BT",1:FBAABT)_FBAACD_FBAASN_FBAABN_" "_FBAAAP_FBAACP_" $"
"RTN","FBAAV0",33,0)
 Q
"RTN","FBAAV0",34,0)
DET ;entry point to process B3 (outpatient/ancillary) batch
"RTN","FBAAV0",35,0)
 ; input (partial list)
"RTN","FBAAV0",36,0)
 ;   J      - Batch IEN in file 161.7
"RTN","FBAAV0",37,0)
 ;   FBAAON - last 4 of obligation number
"RTN","FBAAV0",38,0)
 ;   FBAASN - station number (formatted)
"RTN","FBAAV0",39,0)
 S FBTXT=0
"RTN","FBAAV0",40,0)
 D CKB3V^FBAAV01 I $G(FBERR) K FBERR Q
"RTN","FBAAV0",41,0)
 ; HIPAA 5010 - line items that have 0.00 amount paid are now required to go to Central Fee
"RTN","FBAAV0",42,0)
 ;F K=0:0 S K=$O(^FBAAC("AC",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AC",J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AC",J,K,L,M)) Q:M'>0  F N=0:0 S N=$O(^FBAAC("AC",J,K,L,M,N)) Q:N'>0  S Y(0)=$G(^FBAAC(K,1,L,1,M,1,N,0)) I Y(0)]"",+$P(Y(0),U,3) D
"RTN","FBAAV0",43,0)
 F K=0:0 S K=$O(^FBAAC("AC",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AC",J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AC",J,K,L,M)) Q:M'>0  F N=0:0 S N=$O(^FBAAC("AC",J,K,L,M,N)) Q:N'>0  S Y(0)=$G(^FBAAC(K,1,L,1,M,1,N,0)) I Y(0)]"" D
"RTN","FBAAV0",44,0)
 .N FBDTSR1,FBPICN
"RTN","FBAAV0",45,0)
 .S FBDTSR1=+$G(^FBAAC(K,1,L,1,M,0))
"RTN","FBAAV0",46,0)
 .S FBPICN=K_U_L_U_M_U_N
"RTN","FBAAV0",47,0)
 .S FBY=$G(^FBAAC(K,1,L,1,M,1,N,2))
"RTN","FBAAV0",48,0)
 .S FBY3=$G(^FBAAC(K,1,L,1,M,1,N,3))
"RTN","FBAAV0",49,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD
"RTN","FBAAV0",50,0)
 .D GOT
"RTN","FBAAV0",51,0)
 ;
"RTN","FBAAV0",52,0)
 D:FBTXT XMIT^FBAAV01
"RTN","FBAAV0",53,0)
 Q
"RTN","FBAAV0",54,0)
 ;
"RTN","FBAAV0",55,0)
GOT ; process a B3 line item
"RTN","FBAAV0",56,0)
 ;
"RTN","FBAAV0",57,0)
 N DFN,FBADJ,FBADJA1,FBADJA2,FBADJR1,FBADJR2,FBADMIT,FBAUTHF,FBIENS
"RTN","FBAAV0",58,0)
 N FBMOD1,FBMOD2,FBMOD3,FBMOD4,FBPNAMX,FBUNITS,FBX,FBNPI
"RTN","FBAAV0",59,0)
 N FBCSID,FBEDIF,FBCNTRN
"RTN","FBAAV0",60,0)
 ;
"RTN","FBAAV0",61,0)
 S FBIENS=N_","_M_","_L_","_K_","
"RTN","FBAAV0",62,0)
 ;
"RTN","FBAAV0",63,0)
 S FBEDIF=$S($P($G(^FBAAC(K,1,L,1,M,1,N,3)),"^")]"":"Y",1:" ") ;EDI flag
"RTN","FBAAV0",64,0)
 ; get CPT modifiers
"RTN","FBAAV0",65,0)
 D
"RTN","FBAAV0",66,0)
 . N FBMODA,FBMODL
"RTN","FBAAV0",67,0)
 . D MODDATA^FBAAUTL4(K,L,M,N)
"RTN","FBAAV0",68,0)
 . S FBMODL=$$MODL^FBAAUTL4("FBMODA","E")
"RTN","FBAAV0",69,0)
 . S FBMOD1=$$RJ^XLFSTR($P(FBMODL,",",1),5," ")
"RTN","FBAAV0",70,0)
 . S FBMOD2=$$RJ^XLFSTR($P(FBMODL,",",2),5," ")
"RTN","FBAAV0",71,0)
 . S FBMOD3=$$RJ^XLFSTR($P(FBMODL,",",3),5," ")
"RTN","FBAAV0",72,0)
 . S FBMOD4=$$RJ^XLFSTR($P(FBMODL,",",4),5," ")
"RTN","FBAAV0",73,0)
 ;
"RTN","FBAAV0",74,0)
 S FBPAYT=$P(Y(0),"^",20),FBPAYT=$S(FBPAYT]"":FBPAYT,1:"V")
"RTN","FBAAV0",75,0)
 ;
"RTN","FBAAV0",76,0)
 S FBVID=$P($G(^FBAAV(L,0)),U,2)
"RTN","FBAAV0",77,0)
 S FBVID=FBVID_$E(PAD,$L(FBVID)+1,11)
"RTN","FBAAV0",78,0)
 S:FBPAYT="R" FBVID=$E(PAD,1,11)
"RTN","FBAAV0",79,0)
 S FBNPI=$$EN^FBNPILK(L)  ;SET THE NPI TO BE PASSED TO FBAAV01,FBAAV2,FBAAV5
"RTN","FBAAV0",80,0)
 ;
"RTN","FBAAV0",81,0)
 D POV^FBAAUTL2
"RTN","FBAAV0",82,0)
 S POV=$S(POV']"":"",POV="A":6,POV="B":7,POV="C":8,POV="D":9,POV="E":10,1:POV)
"RTN","FBAAV0",83,0)
 S POV=$S(POV']"":99,$D(^FBAA(161.82,POV,0)):$P(^(0),"^",3),1:99)
"RTN","FBAAV0",84,0)
 S FBPOV=POV
"RTN","FBAAV0",85,0)
 S FBTT=$S(FBTT]"":FBTT,1:1)
"RTN","FBAAV0",86,0)
 S FBCPT=$$CPT^FBAAUTL4($P(Y(0),"^")),FBCPT=$S($L(FBCPT)=5:FBCPT,1:"     ")
"RTN","FBAAV0",87,0)
 S FBPSA=$$PSA^FBAAV5(+$P(Y(0),U,12),+FBAASN) I $L(+FBPSA)'=3 S FBPSA=999
"RTN","FBAAV0",88,0)
 S FBPATT=$P(Y(0),"^",17),FBPATT=$S(FBPATT]"":FBPATT,1:10)
"RTN","FBAAV0",89,0)
 S FBTD=$$AUSDT^FBAAV3(FBDTSR1) ; formatted treatment date
"RTN","FBAAV0",90,0)
 S FBSUSP=$P(Y(0),"^",5),FBSUSP=$S(FBSUSP]"":FBSUSP,1:" ")
"RTN","FBAAV0",91,0)
 S FBSUSP=$S(FBSUSP=" ":" ",$D(^FBAA(161.27,+FBSUSP,0)):$P(^(0),"^"),1:" ")
"RTN","FBAAV0",92,0)
 S FBAP=$$AUSAMT^FBAAV3($P(Y(0),"^",3),8) ; amount paid
"RTN","FBAAV0",93,0)
 S FBPOS=+$P(Y(0),"^",25),FBPOS=$S(FBPOS:$P(^IBE(353.1,FBPOS,0),"^"),1:"  ")
"RTN","FBAAV0",94,0)
 S FBHCFA=+$P(Y(0),"^",26),FBHCFA=$S(FBHCFA:$P(^IBE(353.2,FBHCFA,0),"^"),1:""),FBHCFA=$E(PAD,$L(FBHCFA)+1,2)_FBHCFA
"RTN","FBAAV0",95,0)
 S FBVTOS=+$P(Y(0),"^",24),FBVTOS=$S(FBVTOS:$P(^FBAA(163.85,FBVTOS,0),"^",2),1:"  ")
"RTN","FBAAV0",96,0)
 S FBPD=+$P(Y(0),"^",23),FBPD=$S(FBPD:$$ICD9^FBCSV1(FBPD,$G(FBDTSR1)),1:""),FBPD=$E(PAD,$L(FBPD)+1,7)_FBPD
"RTN","FBAAV0",97,0)
 S FBINVN=$P(Y(0),"^",16)
"RTN","FBAAV0",98,0)
 S FBINVN=$E("000000000",$L(FBINVN)+1,9)_FBINVN
"RTN","FBAAV0",99,0)
 S FBAUTHF=$S($P(Y(0),U,13)["FB583":"U",1:"A") ; auth/unauth flag
"RTN","FBAAV0",100,0)
 S FBDIN=$$AUSDT^FBAAV3($P(Y(0),"^",15)) ; invoice date rec'd
"RTN","FBAAV0",101,0)
 S FBADMIT=$$AUSDT^FBAAV3($$B3ADMIT(FBIENS)) ; formatted admission date
"RTN","FBAAV0",102,0)
 ;
"RTN","FBAAV0",103,0)
 S VAPA("P")=""
"RTN","FBAAV0",104,0)
 S DFN=K
"RTN","FBAAV0",105,0)
 ; Note - before this point Y(0) was the 0 node of subfile #162.03
"RTN","FBAAV0",106,0)
 ;      - after this point Y(0) will be the 0 node of file #2
"RTN","FBAAV0",107,0)
 S Y(0)=$G(^DPT(+K,0)) Q:Y(0)']""
"RTN","FBAAV0",108,0)
 D PAT^FBAAUTL2
"RTN","FBAAV0",109,0)
 ; obtain date of birth, must follow call to PAT^FBAAUTL2 to overwrite 
"RTN","FBAAV0",110,0)
 ; the value returned from it
"RTN","FBAAV0",111,0)
 S FBDOB=$$AUSDT^FBAAV3($P(Y(0),"^",3)) ; date of birth
"RTN","FBAAV0",112,0)
 D ADD^VADPT
"RTN","FBAAV0",113,0)
 S FBPNAMX=$$HL7NAME^FBAAV2(DFN) ; patient name
"RTN","FBAAV0",114,0)
 S FBUNITS=$P(FBY,U,14)
"RTN","FBAAV0",115,0)
 S:FBUNITS<1 FBUNITS=1
"RTN","FBAAV0",116,0)
 S FBUNITS=$$RJ^XLFSTR(FBUNITS,5,0) ; volume indicator (units paid)
"RTN","FBAAV0",117,0)
 S FBCSID=$$LJ^XLFSTR($P(FBY,"^",16),20," ") ; patient acct #
"RTN","FBAAV0",118,0)
 D
"RTN","FBAAV0",119,0)
 . N FBCNTRP
"RTN","FBAAV0",120,0)
 . S FBCNTRP=$P(FBY3,"^",8)
"RTN","FBAAV0",121,0)
 . S FBCNTRN=$S(FBCNTRP:$P($G(^FBAA(161.43,FBCNTRP,0)),"^"),1:"")
"RTN","FBAAV0",122,0)
 . S FBCNTRN=$$LJ^XLFSTR(FBCNTRN,20," ") ; contract number
"RTN","FBAAV0",123,0)
 ;
"RTN","FBAAV0",124,0)
 ; get and format adjustment reason codes and amounts (if any)
"RTN","FBAAV0",125,0)
 D LOADADJ^FBAAFA(FBIENS,.FBADJ)
"RTN","FBAAV0",126,0)
 S FBX=$$ADJL^FBUTL2(.FBADJ)
"RTN","FBAAV0",127,0)
 S FBADJR1=$$RJ^XLFSTR($P(FBX,U,1),5," ")
"RTN","FBAAV0",128,0)
 S FBADJA1=$$AUSAMT^FBAAV3($P(FBX,U,3),9,1)
"RTN","FBAAV0",129,0)
 S FBADJR2=$$RJ^XLFSTR($P(FBX,U,4),5," ")
"RTN","FBAAV0",130,0)
 S FBADJA2=$$AUSAMT^FBAAV3($P(FBX,U,6),9,1)
"RTN","FBAAV0",131,0)
 K FBADJ,FBX
"RTN","FBAAV0",132,0)
 ;
"RTN","FBAAV0",133,0)
 S FBST=$S($P(VAPA(5),"^")="":"  ",$D(^DIC(5,$P(VAPA(5),"^"),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV0",134,0)
 I $L(FBST)>2 S FBST="**"
"RTN","FBAAV0",135,0)
 S:$L(FBST)'=2 FBST=$E(PAD,$L(FBST)+1,2)_FBST
"RTN","FBAAV0",136,0)
 S FBCTY=$S($P(VAPA(7),"^",1)="":"   ",FBST="  ":"   ",$D(^DIC(5,$P(VAPA(5),"^"),1,$P(VAPA(7),"^"),0)):$P(^(0),"^",3),1:"   ")
"RTN","FBAAV0",137,0)
 I $L(FBCTY)'=3 S FBCTY=$E("000",$L(FBCTY)+1,3)_FBCTY
"RTN","FBAAV0",138,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),U),1:VAPA(6)),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV0",139,0)
 D STRING^FBAAV01
"RTN","FBAAV0",140,0)
 Q
"RTN","FBAAV0",141,0)
 ;
"RTN","FBAAV0",142,0)
UPD ; update the batch file
"RTN","FBAAV0",143,0)
 N Y
"RTN","FBAAV0",144,0)
 S DA=J,(DIC,DIE)="^FBAA(161.7,"
"RTN","FBAAV0",145,0)
 S DR="11////^S X=""T"";12////^S X=DT"
"RTN","FBAAV0",146,0)
 D ^DIE
"RTN","FBAAV0",147,0)
 Q
"RTN","FBAAV0",148,0)
 ;
"RTN","FBAAV0",149,0)
STORE D STORE^FBAAV01 Q
"RTN","FBAAV0",150,0)
 ;
"RTN","FBAAV0",151,0)
B3ADMIT(FBIENS) ; Determine Admission Date for a B3 payment line item
"RTN","FBAAV0",152,0)
 ; input
"RTN","FBAAV0",153,0)
 ;   FBIENS - IENS (FileMan format) for subfile 162.03 entry
"RTN","FBAAV0",154,0)
 ; returns admission date in internal FileMan format or null value
"RTN","FBAAV0",155,0)
 ;
"RTN","FBAAV0",156,0)
 N FB7078,FBRET
"RTN","FBAAV0",157,0)
 S FBRET=""
"RTN","FBAAV0",158,0)
 S FB7078=$$GET1^DIQ(162.03,FBIENS,27,"I") ; associated 7078/583
"RTN","FBAAV0",159,0)
 ; (the unauthorized ancillary claims will have the treatment date
"RTN","FBAAV0",160,0)
 ;  instead of the inpatient admission date so nothing is sent to
"RTN","FBAAV0",161,0)
 ;  Austin for them)
"RTN","FBAAV0",162,0)
 ;
"RTN","FBAAV0",163,0)
 ; if line items points to a 7078 authorization then return a date
"RTN","FBAAV0",164,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV0",165,0)
 . N FBY
"RTN","FBAAV0",166,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV0",167,0)
 . ; if fee program is civil hospital then return 7078 date of admission
"RTN","FBAAV0",168,0)
 . I $P(FBY,U,11)=6 S FBRET=$P(FBY,U,15)
"RTN","FBAAV0",169,0)
 . ; if fee program is CNH then return 7078 authorized from date
"RTN","FBAAV0",170,0)
 . I $P(FBY,U,11)=7 S FBRET=$P(FBY,U,4)
"RTN","FBAAV0",171,0)
 ;
"RTN","FBAAV0",172,0)
 Q FBRET
"RTN","FBAAV01")
0^12^B12667626^B12040541
"RTN","FBAAV01",1,0)
FBAAV01 ;AISC/GRR - ELECTRONICALLY TRANSMIT FEE DATA CONTINUED ;6/15/2009
"RTN","FBAAV01",2,0)
 ;;3.5;FEE BASIS;**89,98,108**,JAN 30, 1995;;Build 115
"RTN","FBAAV01",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAV01",4,0)
NEWMSG ;get new message number, reset line counter
"RTN","FBAAV01",5,0)
 ;FBLN=line counter, FBFEE=FEE message counter, FBNVP=NVP message counter
"RTN","FBAAV01",6,0)
 ;FBOKTX=1 if message pending, 0 otherwise
"RTN","FBAAV01",7,0)
 S FBXMZ=0,FBJ=$G(J),FBK=$G(K) S:'$D(FBFEE) FBFEE=1 S:'$D(FBNVP) FBNVP=1
"RTN","FBAAV01",8,0)
 S XMSUB=$S('$D(FBFLAG):"FEE BASIS MESSAGE # "_FBFEE,1:"FEE NON-VA HOSP TO PRICER MESSAGE # "_FBNVP),XMDUZ=DUZ
"RTN","FBAAV01",9,0)
 S FBOKTX=0
"RTN","FBAAV01",10,0)
 D XMZ^XMA2
"RTN","FBAAV01",11,0)
 I '$D(XMZ)!(XMZ'>0) G NEWMSG
"RTN","FBAAV01",12,0)
 S FBXMZ=XMZ,FBLN=0,FBOKTX=1,J=FBJ,K=FBK K XMZ
"RTN","FBAAV01",13,0)
 Q
"RTN","FBAAV01",14,0)
 ;
"RTN","FBAAV01",15,0)
XMIT ;send message, increment message counter
"RTN","FBAAV01",16,0)
 ;FBLN=line counter, FBFEE=FEE message counter, FBNVP=NVP message counter
"RTN","FBAAV01",17,0)
 ;FBXMFEE(=FEE recipient array, FBXMNVP(=NVP recipient array
"RTN","FBAAV01",18,0)
 S FBJ=J,FBK=K K XMY D ROUT
"RTN","FBAAV01",19,0)
 S XMZ=FBXMZ,^XMB(3.9,XMZ,2,0)="^3.92A^"_FBLN_"^"_FBLN_"^"_DT
"RTN","FBAAV01",20,0)
 S XMDUN=$P(^VA(200,DUZ,0),U) D ENT1^XMD
"RTN","FBAAV01",21,0)
 S FBLN=0,FBOKTX=0
"RTN","FBAAV01",22,0)
 D INCRM ;increment message counter
"RTN","FBAAV01",23,0)
 S J=FBJ,K=FBK
"RTN","FBAAV01",24,0)
 Q
"RTN","FBAAV01",25,0)
 ;
"RTN","FBAAV01",26,0)
ROUT ;set up recipients for message
"RTN","FBAAV01",27,0)
 I $D(FBFLAG) S FBI=0 F  S FBI=$O(FBXMNVP(FBI)) Q:'FBI  S X=FBXMNVP(FBI),XMN=0,XMDF="" D INST^XMA21 K XMN,XMDF
"RTN","FBAAV01",28,0)
 I '$D(FBFLAG) S FBI=0 F  S FBI=$O(FBXMFEE(FBI)) Q:'FBI  S X=FBXMFEE(FBI),XMN=0,XMDF="" D INST^XMA21 K XMN,XMDF
"RTN","FBAAV01",29,0)
 S XMY(DUZ)="",XMDUZ=DUZ Q
"RTN","FBAAV01",30,0)
 ;
"RTN","FBAAV01",31,0)
INCRM ;increment message counter
"RTN","FBAAV01",32,0)
 I $D(FBFLAG) S FBNVP=FBNVP+1
"RTN","FBAAV01",33,0)
 E  S FBFEE=FBFEE+1
"RTN","FBAAV01",34,0)
 Q
"RTN","FBAAV01",35,0)
 ;
"RTN","FBAAV01",36,0)
INCRL ;increment line counter
"RTN","FBAAV01",37,0)
 S FBLN=FBLN+1 Q
"RTN","FBAAV01",38,0)
 ;
"RTN","FBAAV01",39,0)
STORE ;set message string
"RTN","FBAAV01",40,0)
 D INCRL S ^XMB(3.9,FBXMZ,2,FBLN,0)=FBSTR
"RTN","FBAAV01",41,0)
 Q
"RTN","FBAAV01",42,0)
 ;
"RTN","FBAAV01",43,0)
ADDRESS ;set up recipient array, FBXMFEE( for FEE router, FBXMNVP( for NVP router
"RTN","FBAAV01",44,0)
 F VATNAME="FEE","NVP" D ^VATRAN G:VATERR ADDQ S FBI=0 F  S FBI=$O(VAT(FBI)) Q:'FBI  S FBVAR="FBXM"_VATNAME_"("_FBI_")" S @FBVAR=VAT(FBI)
"RTN","FBAAV01",45,0)
ADDQ Q
"RTN","FBAAV01",46,0)
 ;Following checks for Austin Name Field in Vendor file in order to continue transmitting that batch.
"RTN","FBAAV01",47,0)
CKB3V F FB1=0:0 S FB1=$O(^FBAAC("AC",J,FB1)) Q:'FB1!($G(FBERR))  F FB2=0:0 S FB2=$O(^FBAAC("AC",J,FB1,FB2)) Q:FB2'>0!($G(FBERR))  D CHKV
"RTN","FBAAV01",48,0)
 Q
"RTN","FBAAV01",49,0)
CKB5V F FB1=0:0 S FB1=$O(^FBAA(162.1,"AE",J,FB1)) Q:'FB1!($G(FBERR))  I $G(^FBAA(162.1,FB1,0)) S FB2=+$P(^(0),"^",4) D CHKV
"RTN","FBAAV01",50,0)
 Q
"RTN","FBAAV01",51,0)
CKB9V F FB1=0:0 S FB1=$O(^FBAAI("AC",J,FB1)) Q:'FB1!($G(FBERR))  I $G(^FBAAI(FB1,0)) S FB2=+$P(^(0),"^",3) D CHKV
"RTN","FBAAV01",52,0)
 Q
"RTN","FBAAV01",53,0)
CHKV I $$CKVEN^FBAADV(FB2) W !!,*7,"VENDOR: ",$$VNAME^FBNHEXP(FB2)," Not approved in Austin yet.",!,"Batch # ",FBAABN," CANNOT BE TRANSMITTED!!!" S FBERR=1
"RTN","FBAAV01",54,0)
 Q
"RTN","FBAAV01",55,0)
 ;
"RTN","FBAAV01",56,0)
STRING ;called from FBAAV0 to build 'B3' payment record
"RTN","FBAAV01",57,0)
 ;
"RTN","FBAAV01",58,0)
 S FBPICN=$$PADZ(FBPICN,30)
"RTN","FBAAV01",59,0)
 ;
"RTN","FBAAV01",60,0)
 ; build 1st line
"RTN","FBAAV01",61,0)
 S FBSTR=3_FBAASN_FBSSN_FBPAYT_FBPNAMX_FBVID_"  "_FBAP_FBAAON_FBSUSP
"RTN","FBAAV01",62,0)
 S FBSTR=FBSTR_FBPOV_FBPATT_FBTD_FBTT_FBDIN_FBINVN
"RTN","FBAAV01",63,0)
 S FBSTR=FBSTR_$E(PAD,1,33)_FBST_FBCTY_FBZIP ; reserved for foreign addr
"RTN","FBAAV01",64,0)
 S FBSTR=FBSTR_$E(FBPSA,1,3)_FBCPT_FBPOS_FBHCFA_FBVTOS_FBPD
"RTN","FBAAV01",65,0)
 S FBSTR=FBSTR_+$P($G(FBY),U,2)_$E(PAD,1,8)_FBPICN
"RTN","FBAAV01",66,0)
 S FBSTR=FBSTR_$S(+FBY:$$AUSDT^FBAAV3(+FBY),1:FBDIN)_FBADMIT_FBDOB_"~"
"RTN","FBAAV01",67,0)
 D STORE
"RTN","FBAAV01",68,0)
 ;
"RTN","FBAAV01",69,0)
 ; build 2nd line
"RTN","FBAAV01",70,0)
 S FBSTR=FBUNITS_FBAUTHF_FBMOD1_FBMOD2_FBMOD3_FBMOD4_FBADJR1_FBADJR2
"RTN","FBAAV01",71,0)
 S FBSTR=FBSTR_FBADJA1_FBADJA2_FBNPI_FBCSID_FBEDIF_FBCNTRN
"RTN","FBAAV01",72,0)
 S FBSTR=FBSTR_$E(PAD,1,32)_"~$" ; reserved for IPAC data
"RTN","FBAAV01",73,0)
 D STORE
"RTN","FBAAV01",74,0)
 ;
"RTN","FBAAV01",75,0)
 K FBPICN,FBY
"RTN","FBAAV01",76,0)
 Q
"RTN","FBAAV01",77,0)
 ;
"RTN","FBAAV01",78,0)
PADZ(X,Y) ;call to pad 'X' with leading zeros' to a field length of 'Y'
"RTN","FBAAV01",79,0)
 ;
"RTN","FBAAV01",80,0)
 I $S('$L(X):1,'Y:1,Y<$L(X):1,1:0) Q ""
"RTN","FBAAV01",81,0)
 N Z S Z=0,$P(Z,0,Y)=0
"RTN","FBAAV01",82,0)
 Q $E(Z,$L(X)+1,Y)_X
"RTN","FBAAV2")
0^10^B14009472^B11664283
"RTN","FBAAV2",1,0)
FBAAV2 ;AISC/GRR-ELECTRONICALLY TRANSMIT PHARMACY PAYMENTS ;11 Apr 2006  2:52 PM
"RTN","FBAAV2",2,0)
 ;;3.5;FEE BASIS;**3,89,98,116,108**;JAN 30, 1995;Build 115
"RTN","FBAAV2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAV2",4,0)
DETP ; ENTRY FROM FBAAV0
"RTN","FBAAV2",5,0)
 S FBTXT=0
"RTN","FBAAV2",6,0)
 D CKB5V^FBAAV01 I $G(FBERR) K FBERR Q
"RTN","FBAAV2",7,0)
 ; HIPAA 5010 - line items that have 0.00 amount paid are now required togo to Central Fee
"RTN","FBAAV2",8,0)
 ;F K=0:0 S K=$O(^FBAA(162.1,"AE",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAA(162.1,"AE",J,K,L)) Q:L'>0  S Y(0)=$G(^FBAA(162.1,K,"RX",L,0)),Y(2)=$G(^(2)),Y=$G(^FBAA(162.1,K,0)) I Y(0)]"",Y]"",+$P(Y(0),U,16) D
"RTN","FBAAV2",9,0)
 F K=0:0 S K=$O(^FBAA(162.1,"AE",J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAA(162.1,"AE",J,K,L)) Q:L'>0  S Y(0)=$G(^FBAA(162.1,K,"RX",L,0)),Y(2)=$G(^(2)),Y=$G(^FBAA(162.1,K,0)) I Y(0)]"",Y]"" D
"RTN","FBAAV2",10,0)
 .N FBPICN,FBY
"RTN","FBAAV2",11,0)
 .S FBPICN=K_U_L
"RTN","FBAAV2",12,0)
 .S FBY=$S($P(Y,U,12):$P(Y,U,12),1:$P(Y,U,2))_U_+$P(Y(2),U,9)
"RTN","FBAAV2",13,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD^FBAAV0
"RTN","FBAAV2",14,0)
 .D GOTP
"RTN","FBAAV2",15,0)
 D:FBTXT XMIT^FBAAV01
"RTN","FBAAV2",16,0)
 Q
"RTN","FBAAV2",17,0)
 ;
"RTN","FBAAV2",18,0)
GOTP ; process a B5 line item
"RTN","FBAAV2",19,0)
 N DFN,FBADJ,FBADJA1,FBADJA2,FBADJR1,FBADJR2,FBIENS,FBPNAMX,FBVY0,FBX
"RTN","FBAAV2",20,0)
 N FBNPI,FBEDIF
"RTN","FBAAV2",21,0)
 ;
"RTN","FBAAV2",22,0)
 S FBIENS=$P(FBPICN,U,2)_","_$P(FBPICN,U,1)_","
"RTN","FBAAV2",23,0)
 S FBPAYT=$P(Y(0),"^",20),FBPAYT=$S(FBPAYT]"":FBPAYT,1:"V")
"RTN","FBAAV2",24,0)
 S FBINVN=$P(Y,"^"),FBINVN=$E("000000000",$L(FBINVN)+1,9)_FBINVN
"RTN","FBAAV2",25,0)
 S FBEDIF=$S($P(Y,"^",13)]"":"Y",1:" ") ; EDI flag
"RTN","FBAAV2",26,0)
 S FBDIN=$$AUSDT^FBAAV3($P(Y,"^",2))
"RTN","FBAAV2",27,0)
 ;
"RTN","FBAAV2",28,0)
 S FBVFN=$P(Y,"^",4)
"RTN","FBAAV2",29,0)
 S FBNPI=$$EN^FBNPILK(FBVFN)
"RTN","FBAAV2",30,0)
 S FBVY0=$G(^FBAAV(FBVFN,0)) ; vendor 0 node
"RTN","FBAAV2",31,0)
 S FBVID=$P(FBVY0,U,2),FBVID=$E(FBVID,1,9)_$E(PAD,$L(FBVID)+1,9)
"RTN","FBAAV2",32,0)
 S FBCSN=$S($P(FBVY0,U,2)]"":$P(FBVY0,U,10),1:"")
"RTN","FBAAV2",33,0)
 S FBCSN=$E("0000",$L(FBCSN)+1,4)_FBCSN
"RTN","FBAAV2",34,0)
 I FBPAYT="R" S FBVID=$E(PAD,1,9),FBCSN=$E(PAD,1,4)
"RTN","FBAAV2",35,0)
 K FBVY0
"RTN","FBAAV2",36,0)
 ;
"RTN","FBAAV2",37,0)
 S FBRX=$P(Y(0),"^",1),FBRX=$E("00000000",$L(FBRX)+1,8)_FBRX
"RTN","FBAAV2",38,0)
 I '$L($G(FBAASN)) D STATION^FBAAUTL
"RTN","FBAAV2",39,0)
 S FBPSA=$$PSA^FBAAV5(+$P(Y(2),U,5),+FBAASN) I $L(+FBPSA)'=3 S FBPSA=999
"RTN","FBAAV2",40,0)
 S FBTD=$$AUSDT^FBAAV3($P(Y(0),"^",3))
"RTN","FBAAV2",41,0)
 S FBSUSP=$P(Y(0),"^",8),FBSUSP=$S(FBSUSP="":" ",$D(^FBAA(161.27,+FBSUSP,0)):$P(^(0),"^"),1:" ")
"RTN","FBAAV2",42,0)
 S FBAC=$$AUSAMT^FBAAV3($P(Y(0),"^",4),8)
"RTN","FBAAV2",43,0)
 S FBAP=$$AUSAMT^FBAAV3($P(Y(0),"^",16),8)
"RTN","FBAAV2",44,0)
 I FBAC=FBAP S FBAP="        "
"RTN","FBAAV2",45,0)
 S DFN=$P(Y(0),"^",5)
"RTN","FBAAV2",46,0)
 Q:'DFN
"RTN","FBAAV2",47,0)
 Q:'$D(^DPT(DFN,0))
"RTN","FBAAV2",48,0)
 ; Note: Prior to the following line Y(0) = the 0 node of subfile 161.11
"RTN","FBAAV2",49,0)
 ;After the line Y(0) will be the 0 node of file #2
"RTN","FBAAV2",50,0)
 S VAPA("P")="",Y(0)=^DPT(DFN,0) D PAT^FBAAUTL2,ADD^VADPT
"RTN","FBAAV2",51,0)
 S FBPNAMX=$$HL7NAME^FBAAV2(DFN)
"RTN","FBAAV2",52,0)
 S FBST=$S($P(VAPA(5),"^")="":"  ",$D(^DIC(5,$P(VAPA(5),"^"),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV2",53,0)
 I $L(FBST)>2 S FBST="**"
"RTN","FBAAV2",54,0)
 S:$L(FBST)'=2 FBST=$E(PAD,$L(FBST)+1,2)_FBST
"RTN","FBAAV2",55,0)
 S FBCTY=$S($P(VAPA(7),"^")="":"   ",FBST="  ":"   ",$D(^DIC(5,$P(VAPA(5),"^"),1,$P(VAPA(7),"^"),0)):$P(^(0),"^",3),1:"   ")
"RTN","FBAAV2",56,0)
 I $L(FBCTY)'=3 S FBCTY=$E("000",$L(FBCTY)+1,3)_FBCTY
"RTN","FBAAV2",57,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),U),1:VAPA(6)),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV2",58,0)
 ;
"RTN","FBAAV2",59,0)
 ; get and format adjustment reason codes and amounts (if any)
"RTN","FBAAV2",60,0)
 D LOADADJ^FBRXFA(FBIENS,.FBADJ)
"RTN","FBAAV2",61,0)
 S FBX=$$ADJL^FBUTL2(.FBADJ)
"RTN","FBAAV2",62,0)
 S FBADJR1=$$RJ^XLFSTR($P(FBX,U,1),5," ")
"RTN","FBAAV2",63,0)
 S FBADJA1=$$AUSAMT^FBAAV3($P(FBX,U,3),9,1)
"RTN","FBAAV2",64,0)
 S FBADJR2=$$RJ^XLFSTR($P(FBX,U,4),5," ")
"RTN","FBAAV2",65,0)
 S FBADJA2=$$AUSAMT^FBAAV3($P(FBX,U,6),9,1)
"RTN","FBAAV2",66,0)
 K FBADJ,FBX
"RTN","FBAAV2",67,0)
 ;
"RTN","FBAAV2",68,0)
 ; build 1st line
"RTN","FBAAV2",69,0)
 S FBSTR=5_FBAASN_FBSSN_FBPAYT_FBPNAMX_FBVID_FBCSN_FBAC_FBAP_FBAAON
"RTN","FBAAV2",70,0)
 S FBSTR=FBSTR_FBSUSP_FBTD_FBRX_FBDIN_FBINVN
"RTN","FBAAV2",71,0)
 S FBSTR=FBSTR_$E(PAD,1,33)_FBST_FBCTY_FBZIP ; reserved for foreign addr
"RTN","FBAAV2",72,0)
 S FBSTR=FBSTR_$E(FBPSA,1,3)_$P(FBY,U,2)_$E(PAD,1,8)
"RTN","FBAAV2",73,0)
 S FBSTR=FBSTR_$$PADZ^FBAAV01(FBPICN,30)_$$AUSDT^FBAAV3(+FBY)_"~"
"RTN","FBAAV2",74,0)
 D STORE^FBAAV01
"RTN","FBAAV2",75,0)
 ;
"RTN","FBAAV2",76,0)
 ; build 2nd line
"RTN","FBAAV2",77,0)
 S FBSTR=FBADJR1_FBADJR2_FBADJA1_FBADJA2_FBNPI_FBEDIF
"RTN","FBAAV2",78,0)
 S FBSTR=FBSTR_$E(PAD,1,32)_"~$" ; reserved for IPAC data
"RTN","FBAAV2",79,0)
 D STORE^FBAAV01
"RTN","FBAAV2",80,0)
 Q
"RTN","FBAAV2",81,0)
 ;
"RTN","FBAAV2",82,0)
HL7NAME(FBDFN) ; return patient name formatted in a 35 character length string
"RTN","FBAAV2",83,0)
 N FBAR,FBNM
"RTN","FBAAV2",84,0)
 S FBAR("FILE")=2,FBAR("IENS")=FBDFN,FBAR("FIELD")=.01
"RTN","FBAAV2",85,0)
 S FBNM=$$HLNAME^XLFNAME(.FBAR,"L35","|")
"RTN","FBAAV2",86,0)
 Q $$LRJ^FBAAV4(FBNM,35)
"RTN","FBAAV5")
0^15^B71438715^B48447360
"RTN","FBAAV5",1,0)
FBAAV5 ;AISC/GRR-CREATE TRANSACTIONS FOR CH/CNH PAYMENTS ;11 Apr 2006  2:54 PM
"RTN","FBAAV5",2,0)
 ;;3.5;FEE BASIS;**3,55,89,98,116,108**;JAN 30, 1995;Build 115
"RTN","FBAAV5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAV5",4,0)
 D CKB9V^FBAAV01 I $G(FBERR) K FBERR Q
"RTN","FBAAV5",5,0)
 G:FBSTAT="S"&(FBCHB="Y")&($P(Y(0),"^",18)'="Y") ^FBAAV6
"RTN","FBAAV5",6,0)
DETCH S FBTXT=0
"RTN","FBAAV5",7,0)
 ; HIPAA 5010 - line items that have 0.00 amount paid are now required to go to Central Fee
"RTN","FBAAV5",8,0)
 ;F K=0:0 S K=$O(^FBAAI("AC",J,K)) Q:K'>0  S Y(0)=$G(^FBAAI(K,0)),Y(2)=$G(^(2)) I Y(0)]"",+$P(Y(0),U,9) D
"RTN","FBAAV5",9,0)
 F K=0:0 S K=$O(^FBAAI("AC",J,K)) Q:K'>0  S Y(0)=$G(^FBAAI(K,0)),Y(2)=$G(^(2)),Y(5)=$G(^(5)) I Y(0)]"" D
"RTN","FBAAV5",10,0)
 .N FBPICN,FBY
"RTN","FBAAV5",11,0)
 .S FBPICN=K
"RTN","FBAAV5",12,0)
 .S FBY=$S($P(Y(2),U,2):$P(Y(2),U,2),1:$P(Y(0),U,2))_U_+$P(Y(2),U,3)
"RTN","FBAAV5",13,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01,STORE^FBAAV01,UPD^FBAAV0
"RTN","FBAAV5",14,0)
 .D GOT
"RTN","FBAAV5",15,0)
 D:FBTXT XMIT^FBAAV01 Q
"RTN","FBAAV5",16,0)
GOT ; process an inpatient invoice
"RTN","FBAAV5",17,0)
 N DFN,FBADJ,FBADJA,FBADJR,FBADMIT,FBAUTHF,FBCDAYS,FBDISDT,FBDISTY,FBNPI
"RTN","FBAAV5",18,0)
 N FBDRG,FBIENS,FBPA,FBPNAMX,FBVMID,FBX
"RTN","FBAAV5",19,0)
 N FB4LN,FBADMTDX,FBCSVDT,FBCSID,FBEDIF,FBCNTRN
"RTN","FBAAV5",20,0)
 S FBIENS=K_","
"RTN","FBAAV5",21,0)
 S FBCSVDT=$$FRDTINV^FBCSV1(K)
"RTN","FBAAV5",22,0)
 I '$L($G(FBAASN)) D STATION^FBAAUTL
"RTN","FBAAV5",23,0)
 S FBPSA=$$PSA(+$P(Y(0),U,20),+$G(FBAASN)) I $L(+FBPSA)'=3 S FBPSA=999
"RTN","FBAAV5",24,0)
 S FBPAYT=$P(Y(0),"^",13),FBPAYT=$S(FBPAYT]"":FBPAYT,1:"V")
"RTN","FBAAV5",25,0)
 S L=$P(Y(0),"^",3)
"RTN","FBAAV5",26,0)
 S FBVID=$S($D(^FBAAV(L,0)):$P(^(0),"^",2),1:"")
"RTN","FBAAV5",27,0)
 S FBNPI=$$EN^FBNPILK(L)
"RTN","FBAAV5",28,0)
 S FBVID=FBVID_$E(PAD,$L(FBVID)+1,11)
"RTN","FBAAV5",29,0)
 S:FBPAYT="R" FBVID=$E(PAD,1,11)
"RTN","FBAAV5",30,0)
 S FBVMID=$S($D(^FBAAV(L,0)):$P(^(0),"^",17),1:"")
"RTN","FBAAV5",31,0)
 S FBVMID=$E(PAD,$L(FBVMID)+1,6)_FBVMID
"RTN","FBAAV5",32,0)
 S POV=$P(Y(0),"^",18)
"RTN","FBAAV5",33,0)
 S POV=$S(POV']"":"",POV="A":6,POV="B":7,POV="C":8,POV="D":9,POV="E":10,1:POV),POV=$S(POV']"":40,$D(^FBAA(161.82,POV,0)):$P(^(0),"^",3),1:40),FBPOV=POV
"RTN","FBAAV5",34,0)
 S FBPATT=$P(Y(0),"^",19),FBPATT=$S(FBPATT]"":FBPATT,1:10)
"RTN","FBAAV5",35,0)
 S FBFTD=$$AUSDT^FBAAV3($P(Y(0),"^",6)) ; from treatment date
"RTN","FBAAV5",36,0)
 S FBTTD=$$AUSDT^FBAAV3($P(Y(0),"^",7)) ; to treatment date
"RTN","FBAAV5",37,0)
 S FBSUSP=$P(Y(0),"^",11),FBSUSP=$S(FBSUSP="":" ",$D(^FBAA(161.27,FBSUSP,0)):$P(^(0),"^",1),1:" ")
"RTN","FBAAV5",38,0)
 S FBINVN=$P(Y(0),"^",1)
"RTN","FBAAV5",39,0)
 S FBINVN=$E("000000000",$L(FBINVN)+1,9)_FBINVN
"RTN","FBAAV5",40,0)
 S FBDIN=$$AUSDT^FBAAV3($P(Y(0),"^",2)) ; invoice date rec'd
"RTN","FBAAV5",41,0)
 S FBAP=$$AUSAMT^FBAAV3($P(Y(0),"^",9),9)
"RTN","FBAAV5",42,0)
 S FBAC=$$AUSAMT^FBAAV3($P(Y(0),"^",8),9)
"RTN","FBAAV5",43,0)
 S FBPA=$$AUSAMT^FBAAV3($P(Y(0),"^",26),9)
"RTN","FBAAV5",44,0)
 S FBDRG=$P(Y(0),"^",24),FBDRG=$E(PAD,$L(FBDRG)+1,4)_FBDRG
"RTN","FBAAV5",45,0)
 S FBAUTHF=$S($P(Y(0),U,5)["FB583":"U",1:"A") ; auth/unauth flag
"RTN","FBAAV5",46,0)
 S FBCSID=$$LJ^XLFSTR($P(Y(2),"^",11),20," ") ; patient acct #
"RTN","FBAAV5",47,0)
 S FBADMTDX=$P(Y(5),"^",9) ; admitting Dx pointer
"RTN","FBAAV5",48,0)
 D
"RTN","FBAAV5",49,0)
 . N FBCNTRP
"RTN","FBAAV5",50,0)
 . S FBCNTRP=$P(Y(5),"^",8)
"RTN","FBAAV5",51,0)
 . S FBCNTRN=$S(FBCNTRP:$P($G(^FBAA(161.43,FBCNTRP,0)),"^"),1:"")
"RTN","FBAAV5",52,0)
 . S FBCNTRN=$$LJ^XLFSTR(FBCNTRN,20," ") ; contract number
"RTN","FBAAV5",53,0)
 S FBEDIF=$S($P($G(^FBAAI(K,3)),"^")]"":"Y",1:" ") ;EDI flag
"RTN","FBAAV5",54,0)
 ;
"RTN","FBAAV5",55,0)
 K FBDX
"RTN","FBAAV5",56,0)
 S FBDX(0)="       " ; initialize admitting Dx transmitted value to 7 spaces
"RTN","FBAAV5",57,0)
 F M=1:1:25 S FBDX(M)="        "  ;8 spaces
"RTN","FBAAV5",58,0)
 I FBADMTDX D
"RTN","FBAAV5",59,0)
 . N FBX
"RTN","FBAAV5",60,0)
 . S FBX=$$ICD9^FBCSV1(FBADMTDX,FBCSVDT)
"RTN","FBAAV5",61,0)
 . Q:FBX=""
"RTN","FBAAV5",62,0)
 . S FBDX(0)=FBX_$E("       ",$L(FBX)+1,7)
"RTN","FBAAV5",63,0)
 S FBYDX=$G(^FBAAI(K,"DX")),FBYPOA=$G(^FBAAI(K,"POA"))
"RTN","FBAAV5",64,0)
 F M=1:1:25 Q:$P(FBYDX,"^",M)=""  D
"RTN","FBAAV5",65,0)
 . S FBDX(M)=$$DX($P(FBYDX,"^",M),FBCSVDT,$P(FBYPOA,"^",M))
"RTN","FBAAV5",66,0)
 K FBYDX,FBYPOA
"RTN","FBAAV5",67,0)
 ;
"RTN","FBAAV5",68,0)
 K FBPRC
"RTN","FBAAV5",69,0)
 F M=1:1:25 S FBPRC(M)="       "  ;7 SPACES
"RTN","FBAAV5",70,0)
 S FBYPROC=$G(^FBAAI(K,"PROC"))
"RTN","FBAAV5",71,0)
 F M=1:1:25 Q:$P(FBYPROC,"^",M)=""  D
"RTN","FBAAV5",72,0)
 . S FBPRC(M)=$$PROC($P(FBYPROC,"^",M),FBCSVDT)
"RTN","FBAAV5",73,0)
 K FBYPROC
"RTN","FBAAV5",74,0)
 ;
"RTN","FBAAV5",75,0)
 S DFN=$P(Y(0),"^",4)
"RTN","FBAAV5",76,0)
 ; Note: Prior to the following line Y(0) = the 0 node of file 162.5
"RTN","FBAAV5",77,0)
 ;After the line Y(0) will equal the 0 node of file #2
"RTN","FBAAV5",78,0)
 S VAPA("P")="",Y(0)=$S($D(^DPT(DFN,0)):^(0),1:"")
"RTN","FBAAV5",79,0)
 D PAT^FBAAUTL2
"RTN","FBAAV5",80,0)
 ; obtain date of birth, must follow call to PAT^FBAAUTL2 to overwrite 
"RTN","FBAAV5",81,0)
 ; the value returned from it
"RTN","FBAAV5",82,0)
 S FBDOB=$$AUSDT^FBAAV3($P(Y(0),"^",3))
"RTN","FBAAV5",83,0)
 D ADD^VADPT
"RTN","FBAAV5",84,0)
 S FBPNAMX=$$HL7NAME^FBAAV2(DFN) ; patient name
"RTN","FBAAV5",85,0)
 S FBST=$S($P(VAPA(5),"^",1)="":"  ",$D(^DIC(5,$P(VAPA(5),"^",1),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAAV5",86,0)
 I $L(FBST)>2 S FBST="**"
"RTN","FBAAV5",87,0)
 S:$L(FBST)'=2 FBST=$E(PAD,$L(FBST)+1,2)_FBST
"RTN","FBAAV5",88,0)
 S FBCTY=$S($P(VAPA(7),"^",1)="":"   ",FBST="  ":"   ",$D(^DIC(5,$P(VAPA(5),"^",1),1,$P(VAPA(7),"^",1),0)):$P(^(0),"^",3),1:"   ")
"RTN","FBAAV5",89,0)
 I $L(FBCTY)'=3 S FBCTY=$E("000",$L(FBCTY)+1,3)_FBCTY
"RTN","FBAAV5",90,0)
 S FBZIP=$S('+$G(VAPA(11)):VAPA(6),+VAPA(11):$P(VAPA(11),U),1:VAPA(6)),FBZIP=$TR(FBZIP,"-","")_$E("000000000",$L(FBZIP)+1,9)
"RTN","FBAAV5",91,0)
 S FBADMIT=$$AUSDT^FBAAV3($P($$B9ADMIT(FBIENS),".")) ; admission date
"RTN","FBAAV5",92,0)
 ; get and format discharge date and type
"RTN","FBAAV5",93,0)
 S FBX=$$B9DISCHG(FBIENS)
"RTN","FBAAV5",94,0)
 S FBDISDT=$$AUSDT^FBAAV3($P($P(FBX,U),".")) ; discharge date
"RTN","FBAAV5",95,0)
 S FBDISTY=$$RJ^XLFSTR($P(FBX,U,2),3,0) ; discharge type
"RTN","FBAAV5",96,0)
 K FBX
"RTN","FBAAV5",97,0)
 ; get volume indicator (covered days)
"RTN","FBAAV5",98,0)
 S FBCDAYS=$$RJ^XLFSTR($$GET1^DIQ(162.5,FBIENS,54),5,"0")
"RTN","FBAAV5",99,0)
 ; obtain and format the adjustment codes and amounts
"RTN","FBAAV5",100,0)
 ; get and format adjustment reason codes and amounts (if any)
"RTN","FBAAV5",101,0)
 D LOADADJ^FBCHFA(FBIENS,.FBADJ)
"RTN","FBAAV5",102,0)
 S FBX=$$ADJL^FBUTL2(.FBADJ)
"RTN","FBAAV5",103,0)
 S FBADJR=$$RJ^XLFSTR($P(FBX,U,1),5," ")
"RTN","FBAAV5",104,0)
 S FBADJA=$$AUSAMT^FBAAV3($P(FBX,U,3),10,1)
"RTN","FBAAV5",105,0)
 K FBADJ,FBX
"RTN","FBAAV5",106,0)
 ;
"RTN","FBAAV5",107,0)
 ; determine if 4th line needed (set FB4LN =1 when true)
"RTN","FBAAV5",108,0)
 S FB4LN=1 I FBDX(11)="        ",FBPRC(11)="       " S FB4LN=0
"RTN","FBAAV5",109,0)
 ;
"RTN","FBAAV5",110,0)
 ; build 1st line
"RTN","FBAAV5",111,0)
 S FBSTR=9_FBAASN_FBSSN_FBPAYT_FBPNAMX_FBVID_"  "_FBAP_FBAAON_FBSUSP
"RTN","FBAAV5",112,0)
 S FBSTR=FBSTR_FBPOV_FBPATT_FBFTD_FBTTD_FBDIN_FBINVN_FBVMID
"RTN","FBAAV5",113,0)
 S FBSTR=FBSTR_$E(PAD,1,33)_FBST_FBCTY_FBZIP ; reserved for foreign addr
"RTN","FBAAV5",114,0)
 S FBSTR=FBSTR_FBPSA_$P(FBY,U,2)_$E(PAD,1,14)
"RTN","FBAAV5",115,0)
 F I=1:1:5 S FBSTR=FBSTR_FBDX(I)
"RTN","FBAAV5",116,0)
 S FBSTR=FBSTR_"~"
"RTN","FBAAV5",117,0)
 D STORE^FBAAV01
"RTN","FBAAV5",118,0)
 ;
"RTN","FBAAV5",119,0)
 ; build 2nd line
"RTN","FBAAV5",120,0)
 S FBSTR=$$PADZ^FBAAV01(FBPICN,23)_$$AUSDT^FBAAV3(+FBY)
"RTN","FBAAV5",121,0)
 F I=1:1:5 S FBSTR=FBSTR_FBPRC(I)
"RTN","FBAAV5",122,0)
 S FBSTR=FBSTR_FBAC_FBPA_FBDRG_" "_FBADMIT_FBDISDT_FBDOB_FBDISTY_FBCDAYS_FBAUTHF_FBADJR_FBADJA_FBNPI_FBDX(0)_FBCSID_FBEDIF_FBCNTRN
"RTN","FBAAV5",123,0)
 S FBSTR=FBSTR_$E(PAD,1,32)_"~" ; reserved for IPAC data
"RTN","FBAAV5",124,0)
 D STORE^FBAAV01
"RTN","FBAAV5",125,0)
 ;
"RTN","FBAAV5",126,0)
 ; build 3rd line
"RTN","FBAAV5",127,0)
 S FBSTR=""
"RTN","FBAAV5",128,0)
 F I=6:1:10 S FBSTR=FBSTR_FBDX(I)
"RTN","FBAAV5",129,0)
 F I=6:1:10 S FBSTR=FBSTR_FBPRC(I)
"RTN","FBAAV5",130,0)
 S FBSTR=FBSTR_"~"
"RTN","FBAAV5",131,0)
 S:'FB4LN FBSTR=FBSTR_"$"
"RTN","FBAAV5",132,0)
 D STORE^FBAAV01
"RTN","FBAAV5",133,0)
 ;
"RTN","FBAAV5",134,0)
 ; build 4th line (if needed)
"RTN","FBAAV5",135,0)
 I FB4LN D
"RTN","FBAAV5",136,0)
 . S FBSTR=""
"RTN","FBAAV5",137,0)
 . F I=11:1:25 S FBSTR=FBSTR_FBDX(I)
"RTN","FBAAV5",138,0)
 . F I=11:1:25 S FBSTR=FBSTR_FBPRC(I)
"RTN","FBAAV5",139,0)
 . S FBSTR=FBSTR_"~$"
"RTN","FBAAV5",140,0)
 . D STORE^FBAAV01
"RTN","FBAAV5",141,0)
 Q
"RTN","FBAAV5",142,0)
 ;
"RTN","FBAAV5",143,0)
PSA(X,Y) ;call to set default Primary Service Area (PSA)
"RTN","FBAAV5",144,0)
 ;to send to Austin.
"RTN","FBAAV5",145,0)
 ;X = pointer to the institution file
"RTN","FBAAV5",146,0)
 ;Y = default if unable to determine station number in file 4
"RTN","FBAAV5",147,0)
 ;call returns the 3 digit station number only
"RTN","FBAAV5",148,0)
 ;if Y undef return '0'
"RTN","FBAAV5",149,0)
 I '$G(Y) S Y=0
"RTN","FBAAV5",150,0)
 Q $S('X:+Y,$E($P($G(^DIC(4,+X,99)),U),1,3)'?3N:+Y,1:$E($P($G(^(99)),U),1,3))
"RTN","FBAAV5",151,0)
 ;
"RTN","FBAAV5",152,0)
B9ADMIT(FBIENS) ; Determine Admission Date for a B9 payment
"RTN","FBAAV5",153,0)
 ; input
"RTN","FBAAV5",154,0)
 ;   FBIENS
"RTN","FBAAV5",155,0)
 ; returns admission date in internal FileMan format or null value
"RTN","FBAAV5",156,0)
 N FB7078,FBRET
"RTN","FBAAV5",157,0)
 S FBRET=""  ;NULL
"RTN","FBAAV5",158,0)
 ;
"RTN","FBAAV5",159,0)
 S FB7078=$$GET1^DIQ(162.5,FBIENS,4,"I") ; associated 7078/583
"RTN","FBAAV5",160,0)
 ;
"RTN","FBAAV5",161,0)
 ; if invoice points to a 7078 authorization then get date from the 7078
"RTN","FBAAV5",162,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV5",163,0)
 . N FBY
"RTN","FBAAV5",164,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV5",165,0)
 . ; if fee program is civil hospital then return 7078 date of admission
"RTN","FBAAV5",166,0)
 . I $P(FBY,U,11)=6 S FBRET=$P(FBY,U,15)
"RTN","FBAAV5",167,0)
 . ; if fee program is CNH then return 7078 authorized from date
"RTN","FBAAV5",168,0)
 . I $P(FBY,U,11)=7 S FBRET=$P(FBY,U,4)
"RTN","FBAAV5",169,0)
 ;
"RTN","FBAAV5",170,0)
 ; if invoice points to an unauthorized claim then use the treatment from
"RTN","FBAAV5",171,0)
 ;   date on the unauthorized claim
"RTN","FBAAV5",172,0)
 I $P(FB7078,";",2)="FB583(" D
"RTN","FBAAV5",173,0)
 . N FBY
"RTN","FBAAV5",174,0)
 . S FBY=$G(^FB583(+FB7078,0))
"RTN","FBAAV5",175,0)
 . S FBRET=$P(FBY,U,5)
"RTN","FBAAV5",176,0)
 ;
"RTN","FBAAV5",177,0)
 ; return the result
"RTN","FBAAV5",178,0)
 Q FBRET
"RTN","FBAAV5",179,0)
 ;
"RTN","FBAAV5",180,0)
B9DISCHG(FBIENS) ; Determine Discharge Date and Type for a B9 payment
"RTN","FBAAV5",181,0)
 ; input
"RTN","FBAAV5",182,0)
 ;   FBIENS - Invoice IEN (file 162.5) with trailing comma
"RTN","FBAAV5",183,0)
 ; returns discharge date in internal FileMan format or null value and
"RTN","FBAAV5",184,0)
 ; discharge type or null value
"RTN","FBAAV5",185,0)
 N FB7078,FBDISDT,FBDISTY
"RTN","FBAAV5",186,0)
 S (FBDISDT,FBDISTY)=""
"RTN","FBAAV5",187,0)
 ;
"RTN","FBAAV5",188,0)
 S FB7078=$$GET1^DIQ(162.5,FBIENS,4,"I") ; associated 7078/583
"RTN","FBAAV5",189,0)
 ;
"RTN","FBAAV5",190,0)
 ; if invoice points to an unauthorized claim then use the treatment to
"RTN","FBAAV5",191,0)
 ;   date on the unauthorized claim
"RTN","FBAAV5",192,0)
 I $P(FB7078,";",2)="FB583(" D
"RTN","FBAAV5",193,0)
 . N FBY
"RTN","FBAAV5",194,0)
 . S FBY=$G(^FB583(+FB7078,0))
"RTN","FBAAV5",195,0)
 . S FBDISDT=$P(FBY,U,6)
"RTN","FBAAV5",196,0)
 . S FBDISTY=$$GET1^DIQ(162.5,FBIENS,"6.5:1") ; discharge type
"RTN","FBAAV5",197,0)
 ;
"RTN","FBAAV5",198,0)
 ; if invoice points to a 7078 authorization then get date from the 7078
"RTN","FBAAV5",199,0)
 I $P(FB7078,";",2)="FB7078(" D
"RTN","FBAAV5",200,0)
 . N FBY
"RTN","FBAAV5",201,0)
 . S FBY=$G(^FB7078(+FB7078,0))
"RTN","FBAAV5",202,0)
 . ;
"RTN","FBAAV5",203,0)
 . ; if fee program is civil hospital then return 7078 date of discharge
"RTN","FBAAV5",204,0)
 . I $P(FBY,U,11)=6 D
"RTN","FBAAV5",205,0)
 . . S FBDISDT=$P(FBY,U,16) ; discharge date
"RTN","FBAAV5",206,0)
 . . S FBDISTY=$$GET1^DIQ(162.5,FBIENS,"6.5:1") ; discharge type
"RTN","FBAAV5",207,0)
 . ;
"RTN","FBAAV5",208,0)
 . ; if fee program is CNH then get date & type from CNH activity file
"RTN","FBAAV5",209,0)
 . I $P(FBY,U,11)=7 D
"RTN","FBAAV5",210,0)
 . . N DFN,FBADMIT,FBADMITR,FBACTA,FBAUTHP,FBDA,FBDTR
"RTN","FBAAV5",211,0)
 . . S DFN=$P(FBY,U,3) ; patient IEN
"RTN","FBAAV5",212,0)
 . . S FBADMIT=$P($P(FBY,U,4),".") ; CNH admission date
"RTN","FBAAV5",213,0)
 . . S FBAUTHP=+$O(^FBAAA("AG",FB7078,DFN,0)) ; authorization 'pointer'
"RTN","FBAAV5",214,0)
 . . ;
"RTN","FBAAV5",215,0)
 . . ; find the admission entry in CNH ACTIVITY file   
"RTN","FBAAV5",216,0)
 . . S FBACTA=0 ; init the admission activity ien
"RTN","FBAAV5",217,0)
 . . S FBADMITR=9999999-FBADMIT ; reverse admission date
"RTN","FBAAV5",218,0)
 . . S FBDTR=9999999-$$FMADD^XLFDT(FBADMIT,1) ; start loop
"RTN","FBAAV5",219,0)
 . . F  S FBDTR=$O(^FBAACNH("AF",DFN,FBDTR)) Q:'FBDTR!($P(FBDTR,".")>FBADMITR)  D  Q:FBACTA
"RTN","FBAAV5",220,0)
 . . . S FBDA=0 F  S FBDA=$O(^FBAACNH("AF",DFN,FBDTR,FBDA)) Q:'FBDA  D
"RTN","FBAAV5",221,0)
 . . . . S FBY=$G(^FBAACNH(FBDA,0))
"RTN","FBAAV5",222,0)
 . . . . I $P(FBY,U,3)="A",$P(FBY,U,10)=FBAUTHP S FBACTA=FBDA ; found it
"RTN","FBAAV5",223,0)
 . . Q:'FBACTA  ; could not find the admission activity
"RTN","FBAAV5",224,0)
 . . ;
"RTN","FBAAV5",225,0)
 . . ; get date from associated discharge (if any) in CNH ACTIVITY file
"RTN","FBAAV5",226,0)
 . . S FBDA=" "
"RTN","FBAAV5",227,0)
 . . F  S FBDA=$O(^FBAACNH("AC",FBACTA,FBDA),-1) Q:FBDA'>0  D  Q:FBDISDT
"RTN","FBAAV5",228,0)
 . . . S FBY=$G(^FBAACNH(FBDA,0))
"RTN","FBAAV5",229,0)
 . . . I $P(FBY,U,3)="D" D
"RTN","FBAAV5",230,0)
 . . . . S FBDISDT=$P($P(FBY,U),".")
"RTN","FBAAV5",231,0)
 . . . . S FBDISTY=$P(FBY,U,8)
"RTN","FBAAV5",232,0)
 . . . . I FBDISTY'="" S FBDISTY=FBDISTY+100
"RTN","FBAAV5",233,0)
 ;
"RTN","FBAAV5",234,0)
 ; return the result
"RTN","FBAAV5",235,0)
 Q FBDISDT_"^"_FBDISTY
"RTN","FBAAV5",236,0)
 ;
"RTN","FBAAV5",237,0)
DX(FBDX,FBDATE,FBPOA) ; format diagnosis & POA for B9
"RTN","FBAAV5",238,0)
 ; Input
"RTN","FBAAV5",239,0)
 ;   FBDX   = pointer to file 80 (ICD diagnosis)
"RTN","FBAAV5",240,0)
 ;   FBDATE = fileman date
"RTN","FBAAV5",241,0)
 ;   FBPOA  = (optional) poiner to file 161.94 (present on admission)
"RTN","FBAAV5",242,0)
 ; Returns formatted string of 8 characters
"RTN","FBAAV5",243,0)
 N FBRET,FBX,FBX2
"RTN","FBAAV5",244,0)
 S FBRET="        "
"RTN","FBAAV5",245,0)
 I FBDX D
"RTN","FBAAV5",246,0)
 . S FBX=$$ICD9^FBCSV1(FBDX,FBDATE)
"RTN","FBAAV5",247,0)
 . Q:FBX=""
"RTN","FBAAV5",248,0)
 . S FBX=FBX_$E("       ",$L(FBX)+1,7)
"RTN","FBAAV5",249,0)
 . S FBX2=$S($G(FBPOA):$P($G(^FB(161.94,FBPOA,0)),"^"),1:"")
"RTN","FBAAV5",250,0)
 . S:FBX2="" FBX2=" "
"RTN","FBAAV5",251,0)
 . S FBRET=FBX_FBX2
"RTN","FBAAV5",252,0)
 Q FBRET
"RTN","FBAAV5",253,0)
 ;
"RTN","FBAAV5",254,0)
PROC(FBPROC,FBDATE) ; format procedure for B9
"RTN","FBAAV5",255,0)
 ; Input
"RTN","FBAAV5",256,0)
 ;   FBPROC = pointer to file 80.1 (ICD operation/procedure)
"RTN","FBAAV5",257,0)
 ;   FBDATE = fileman date
"RTN","FBAAV5",258,0)
 ; Returns formatted string of 7 characters
"RTN","FBAAV5",259,0)
 N FBRET,FBX
"RTN","FBAAV5",260,0)
 S FBRET="       "
"RTN","FBAAV5",261,0)
 I FBPROC D
"RTN","FBAAV5",262,0)
 . S FBX=$$ICD0^FBCSV1(FBPROC,FBDATE)
"RTN","FBAAV5",263,0)
 . Q:FBX=""
"RTN","FBAAV5",264,0)
 . S FBX=FBX_$E("       ",$L(FBX)+1,7)
"RTN","FBAAV5",265,0)
 . S FBRET=FBX
"RTN","FBAAV5",266,0)
 Q FBRET
"RTN","FBAAV5",267,0)
 ;
"RTN","FBAAV5",268,0)
 ;FBAAV5
"RTN","FBAAV6")
0^9^B23733544^B18680215
"RTN","FBAAV6",1,0)
FBAAV6 ;AISC/GRR,WOIFO/SAB - CREATE TRANSACTIONS TO SEND TO PRICER ;9/14/2009
"RTN","FBAAV6",2,0)
 ;;3.5;FEE BASIS;**55,108**;JAN 30, 1995;Build 115
"RTN","FBAAV6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAV6",4,0)
 S FBFLAG=1,FBTXT=0
"RTN","FBAAV6",5,0)
 S FBSTAT="P",FBJ=J D UPDT^FBAAUTL2 S J=FBJ F K=0:0 S K=$O(^FBAAI("AC",J,K)) Q:K'>0  S Y(0)=$G(^FBAAI(K,0)),Y(5)=$G(^FBAAI(K,5)) I Y(0)]"" D
"RTN","FBAAV6",6,0)
 .I 'FBTXT S FBTXT=1 D NEWMSG^FBAAV01
"RTN","FBAAV6",7,0)
 .D GOT
"RTN","FBAAV6",8,0)
 D:FBTXT XMIT^FBAAV01 K FBFLAG Q
"RTN","FBAAV6",9,0)
 ;
"RTN","FBAAV6",10,0)
GOT N FBCDCNT,FBCSVDT,FBI,FBLNCNT,FBTL
"RTN","FBAAV6",11,0)
 S FBCSVDT=$$FRDTINV^FBCSV1(K) ; code set version date
"RTN","FBAAV6",12,0)
 S FBPAYT=$P(Y(0),"^",13),FBPAYT=$S(FBPAYT]"":$S(FBPAYT="R":"P",1:FBPAYT),1:"V"),FBVID=$P(Y(0),"^",3),FBVEN=FBVID I FBVID]"" S FBVID=$S($D(^FBAAV(FBVID,0)):$P(^(0),"^",17),1:$E(PAD,1,6))
"RTN","FBAAV6",13,0)
 S:FBVID']"" FBVID=$E(PAD,1,6)
"RTN","FBAAV6",14,0)
 S FB7078=$P(Y(0),"^",5) I FB7078]"" D
"RTN","FBAAV6",15,0)
 .I FB7078["FB7078(",$D(^FB7078(+FB7078,0)) S FBFNY=^FB7078(+FB7078,0),FBFDT=$S($P(FBFNY,"^",15):$P(FBFNY,"^",15),1:$P(FBFNY,"^",4)),FBTDT=$S($P(FBFNY,"^",16):$P(FBFNY,"^",16),1:$P(FBFNY,"^",5))
"RTN","FBAAV6",16,0)
 .I FB7078["FB583(",$D(^FB583(+FB7078,0)) S FBFNY=^FB583(+FB7078,0),FBFDT=$S($P(FBFNY,"^",5)]"":$P(FBFNY,"^",5),1:$P(FBFNY,"^",13)),FBTDT=$S($P(FBFNY,"^",6)]"":$P(FBFNY,"^",6),1:$P(FBFNY,"^",14))
"RTN","FBAAV6",17,0)
 S X1=FBTDT,X2=FBFDT D ^%DTC S FBLOS=$S(X<1:1,1:X),FBFDT=$E(FBFDT,4,7)_($E(FBFDT,1,3)+1700)
"RTN","FBAAV6",18,0)
 S FBTDT=$E(FBTDT,4,7)_($E(FBTDT,1,3)+1700),FBLOS=$E("000",$L(FBLOS)+1,3)_FBLOS,FBRESUB=+$P(Y(0),"^",25)
"RTN","FBAAV6",19,0)
 S:+FBLOS>999 FBLOS="***"
"RTN","FBAAV6",20,0)
 ;S:$L(FBLOS)>3 FBLOS="***" ; >999 not supported, *** to cause reject
"RTN","FBAAV6",21,0)
 S FBDISP=$P(Y(0),"^",21) I FBDISP]"" S FBDISP=$S($D(^FBAA(162.6,FBDISP,0)):$P(^(0),"^",2),1:"00")
"RTN","FBAAV6",22,0)
 S FBDISP=$E("00",$L(FBDISP)+1,2)_FBDISP,FBBILL=$P(Y(0),"^",22)+.00001,FBBILL=$P(FBBILL,".",1)_$E($P(FBBILL,".",2),1,2),FBBILL=$E("000000000",$L(FBBILL)+1,9)_FBBILL
"RTN","FBAAV6",23,0)
 S FBCLAIM=$P(Y(0),"^",8)+.00001,FBCLAIM=$P(FBCLAIM,".",1)_$E($P(FBCLAIM,".",2),1,2),FBCLAIM=$E("000000000",$L(FBCLAIM)+1,9)_FBCLAIM
"RTN","FBAAV6",24,0)
 S FBSTAT=$S(FBVEN']"":"",$D(^FBAAV(FBVEN,0)):$P(^(0),"^",5),1:"")
"RTN","FBAAV6",25,0)
 S FBSTABR=$S(FBSTAT']"":"  ",$D(^DIC(5,FBSTAT,0)):$P(^(0),"^",2),1:"  "),FBSTABR=$E("  ",$L(FBSTABR)+1,2)_FBSTABR,FBAUTH=""
"RTN","FBAAV6",26,0)
 I $L(FBSTABR)>2 S FBSTABR="**" ; ** to cause reject of invalid state
"RTN","FBAAV6",27,0)
 I FB7078]"" S FBAUTH=$S(FB7078["FB583(":" ",$D(^FB7078(+FB7078,0)):$P(^(0),"^",6),1:" ")
"RTN","FBAAV6",28,0)
 S FBAUTH=$$AUTH(FBAUTH)
"RTN","FBAAV6",29,0)
 S DFN=+$P(Y(0),"^",4),FBMED=$P(Y(0),"^",23),FBMED=$S(FBMED="":"N",1:FBMED),Y(0)=$G(^DPT(DFN,0)) D PAT^FBAAUTL2 S FBLNAM=$E(FBFLNAM,1,12),FBSSN=$E(FBSSN,10)_$E(FBSSN,1,9)_" "
"RTN","FBAAV6",30,0)
 ;
"RTN","FBAAV6",31,0)
 S FBLNCNT=0 ; init invoice line counter
"RTN","FBAAV6",32,0)
 D NEWLN
"RTN","FBAAV6",33,0)
 ; compute total lines needed (2-5)
"RTN","FBAAV6",34,0)
 S FBTL=($$LAST^FBCHEP1(K,"DX")+$$LAST^FBCHEP1(K,"PROC"))\13+2
"RTN","FBAAV6",35,0)
 ; add rest of data for line 1
"RTN","FBAAV6",36,0)
 S FBSTR=FBSTR_FBTL_FBLNAM_FBFI_FBMI_FBSEX_FBDOB_FBLOS
"RTN","FBAAV6",37,0)
 S FBSTR=FBSTR_FBDISP_FBBILL_FBCLAIM_FBAUTH_FBPAYT_FBAACP_FBAAON_"Y"
"RTN","FBAAV6",38,0)
 S FBSTR=FBSTR_FBVID_FBMED_$E(PAD,1,29)_FBTDT_FBSTABR_"  "
"RTN","FBAAV6",39,0)
 D STORE
"RTN","FBAAV6",40,0)
 ;
"RTN","FBAAV6",41,0)
 S FBYDX=$G(^FBAAI(K,"DX"))
"RTN","FBAAV6",42,0)
 S FBYPOA=$G(^FBAAI(K,"POA"))
"RTN","FBAAV6",43,0)
 D NEWLN
"RTN","FBAAV6",44,0)
 ; admitting Dx
"RTN","FBAAV6",45,0)
 S FBADMTDX=$P($G(^FBAAI(K,5)),"^",9)
"RTN","FBAAV6",46,0)
 ; NVH Pricer requested sending primary Dx if admit Dx not known
"RTN","FBAAV6",47,0)
 I 'FBADMTDX S FBADMTDX=$P(FBYDX,"^")
"RTN","FBAAV6",48,0)
 S FBCDCNT=1 ; count of codes for line
"RTN","FBAAV6",49,0)
 S FBSTR=FBSTR_$$DX(FBADMTDX,FBCSVDT,"")
"RTN","FBAAV6",50,0)
 ;
"RTN","FBAAV6",51,0)
 ; loop thru Dx
"RTN","FBAAV6",52,0)
 F FBI=1:1:25 Q:$P(FBYDX,"^",FBI)=""  D
"RTN","FBAAV6",53,0)
 . S FBCDCNT=FBCDCNT+1
"RTN","FBAAV6",54,0)
 . I FBCDCNT=14 D
"RTN","FBAAV6",55,0)
 . . D STORE
"RTN","FBAAV6",56,0)
 . . D NEWLN
"RTN","FBAAV6",57,0)
 . . S FBCDCNT=1
"RTN","FBAAV6",58,0)
 . S FBSTR=FBSTR_$$DX($P(FBYDX,"^",FBI),FBCSVDT,$P(FBYPOA,"^",FBI))
"RTN","FBAAV6",59,0)
 K FBADMTDX,FBYDX,FBYPOA
"RTN","FBAAV6",60,0)
 ;
"RTN","FBAAV6",61,0)
 ; loop thru Proc
"RTN","FBAAV6",62,0)
 S FBYPROC=$G(^FBAAI(K,"PROC"))
"RTN","FBAAV6",63,0)
 F FBI=1:1:25 Q:$P(FBYPROC,"^",FBI)=""  D
"RTN","FBAAV6",64,0)
 . S FBCDCNT=FBCDCNT+1
"RTN","FBAAV6",65,0)
 . I FBCDCNT=14 D
"RTN","FBAAV6",66,0)
 . . D STORE
"RTN","FBAAV6",67,0)
 . . D NEWLN
"RTN","FBAAV6",68,0)
 . . S FBCDCNT=1
"RTN","FBAAV6",69,0)
 . S FBSTR=FBSTR_$$PROC($P(FBYPROC,"^",FBI),FBCSVDT)
"RTN","FBAAV6",70,0)
 K FBYPROC
"RTN","FBAAV6",71,0)
 ;
"RTN","FBAAV6",72,0)
 ; pad remainder of the invoice last line with spaces
"RTN","FBAAV6",73,0)
 S FBSTR=$$LJ^XLFSTR(FBSTR,131," ")
"RTN","FBAAV6",74,0)
 D STORE
"RTN","FBAAV6",75,0)
 Q
"RTN","FBAAV6",76,0)
 ;
"RTN","FBAAV6",77,0)
AUTH(X) ;Function call to provide the Admitting Regulation.
"RTN","FBAAV6",78,0)
 ;X is equal to the internal entry number of the VA Admitting Reg file
"RTN","FBAAV6",79,0)
 ;User is returned with an alpha dependent on the Admitting Reg chosen
"RTN","FBAAV6",80,0)
 N CFR,FBCFR
"RTN","FBAAV6",81,0)
 S CFR=$P($G(^DIC(43.4,+X,0)),"^",3) I '$G(CFR) Q "A"
"RTN","FBAAV6",82,0)
 S FBCFR=$S(CFR="17.50b(a)(1)(i)":"A",CFR="17.50b(a)(1)(iii)":"B",CFR="17.50b(a)(1)(iv)":"C",CFR="17.50b(a)(3)":"H",CFR="17.50b(a)(4)":"D",CFR="17.50b(a)(5)":"E",CFR="17.50b(a)(6)":"F",CFR="17.50b(a)(8)":"G",1:"")
"RTN","FBAAV6",83,0)
 I FBCFR="" S FBCFR=$S(CFR="17.50b(a)(9)":"I",CFR="17.80(a)(i)":"L",CFR="17.80(a)(iii)":"J",1:"A")
"RTN","FBAAV6",84,0)
 Q FBCFR
"RTN","FBAAV6",85,0)
 ;
"RTN","FBAAV6",86,0)
NEWLN ; New Line
"RTN","FBAAV6",87,0)
 S FBLNCNT=FBLNCNT+1 ; increment invoice line count
"RTN","FBAAV6",88,0)
 S FBSTR=FBSSN_FBFDT_FBAASN_FBRESUB_FBLNCNT ; data at start of each line
"RTN","FBAAV6",89,0)
 Q
"RTN","FBAAV6",90,0)
 ;
"RTN","FBAAV6",91,0)
STORE D STORE^FBAAV01
"RTN","FBAAV6",92,0)
 Q
"RTN","FBAAV6",93,0)
 ;
"RTN","FBAAV6",94,0)
DX(FBDX,FBDATE,FBPOA) ; format diagnosis & POA for NVH Pricer
"RTN","FBAAV6",95,0)
 ; Input
"RTN","FBAAV6",96,0)
 ;   FBDX   = pointer to file 80 (ICD diagnosis)
"RTN","FBAAV6",97,0)
 ;   FBDATE = fileman date
"RTN","FBAAV6",98,0)
 ;   FBPOA  = (optional) poiner to file 161.94 (present on admission)
"RTN","FBAAV6",99,0)
 ; Returns formatted string of 8 characters
"RTN","FBAAV6",100,0)
 N FBRET,FBX,FBX2
"RTN","FBAAV6",101,0)
 S FBRET="        "
"RTN","FBAAV6",102,0)
 I FBDX D
"RTN","FBAAV6",103,0)
 . S FBX=$$ICD9^FBCSV1(FBDX,FBDATE)
"RTN","FBAAV6",104,0)
 . S:FBX["." FBX=$P(FBX,".",1)_$P(FBX,".",2)
"RTN","FBAAV6",105,0)
 . Q:FBX=""
"RTN","FBAAV6",106,0)
 . S FBX=FBX_$E("       ",$L(FBX)+1,7)
"RTN","FBAAV6",107,0)
 . S FBX2=$S($G(FBPOA):$P($G(^FB(161.94,FBPOA,0)),"^"),1:"")
"RTN","FBAAV6",108,0)
 . S:FBX2="" FBX2=" "
"RTN","FBAAV6",109,0)
 . S FBRET=FBX_FBX2
"RTN","FBAAV6",110,0)
 Q FBRET
"RTN","FBAAV6",111,0)
 ;
"RTN","FBAAV6",112,0)
PROC(FBPROC,FBDATE) ; format procedure for NVH Pricer
"RTN","FBAAV6",113,0)
 ; Input
"RTN","FBAAV6",114,0)
 ;   FBPROC = pointer to file 80.1 (ICD operation/procedure)
"RTN","FBAAV6",115,0)
 ;   FBDATE = fileman date
"RTN","FBAAV6",116,0)
 ; Returns formatted string of 8 characters
"RTN","FBAAV6",117,0)
 N FBRET,FBX
"RTN","FBAAV6",118,0)
 S FBRET="        "
"RTN","FBAAV6",119,0)
 I FBPROC D
"RTN","FBAAV6",120,0)
 . S FBX=$$ICD0^FBCSV1(FBPROC,FBDATE)
"RTN","FBAAV6",121,0)
 . S:FBX["." FBX=$P(FBX,".",1)_$P(FBX,".",2)
"RTN","FBAAV6",122,0)
 . Q:FBX=""
"RTN","FBAAV6",123,0)
 . S FBX=FBX_$E("       ",$L(FBX)+1,7)
"RTN","FBAAV6",124,0)
 . S FBRET=FBX_"*"
"RTN","FBAAV6",125,0)
 Q FBRET
"RTN","FBCH78")
0^3^B39732551^B31111171
"RTN","FBCH78",1,0)
FBCH78 ;AISC/DMK - SETS UP 7078/AUTHORIZATION FOR CONTRACT HOSPITAL ;7/14/2009
"RTN","FBCH78",2,0)
 ;;3.5;FEE BASIS;**43,103,108**;JAN 30, 1995;Build 115
"RTN","FBCH78",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCH78",4,0)
 S DIC("S")="I $P(^(0),U,15)=3&($P(^(0),U,12)=""Y"")" D ASKV^FBCHREQ G END:$E(X)="^"!($E(X)="")!('$D(FBDA))
"RTN","FBCH78",5,0)
 I $P(^FBAA(162.2,FBDA,0),"^",17)]"" W !!,*7,"There already is a 7078 set up for this request.",!,"The number is ",$P(^FB7078($P(^FBAA(162.2,FBDA,0),"^",17),0),"^")," .",! G END
"RTN","FBCH78",6,0)
EN S FBVEN=$P(^FBAA(162.2,FBDA,0),"^",2)_";FBAAV(",FBVET=$P(^(0),"^",4),FBFRDT=$P(^(0),"^",5),FBFRDT=FBFRDT\1,FBDOA=$S($P(^(0),"^",19):$P(^(0),"^",19)\1,1:""),FBDXS=$P(^(0),"^",6)
"RTN","FBCH78",7,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",8,0)
 S FBRP=$P($G(^FBAA(162.2,FBDA,2)),"^") K DA
"RTN","FBCH78",9,0)
 W !! S %DT="APEX",%DT("A")="AUTHORIZATION TO DATE: " D ^%DT K %DT G END:X="^" S FBTODT=$S(X="":"",1:Y)
"RTN","FBCH78",10,0)
 I FBTODT]"",FBFRDT>FBTODT W !!,*7,?5,"Authorization To Date must be after Authorization From Date!",! G EN
"RTN","FBCH78",11,0)
 W !! S %DT="APEX",%DT("A")="DATE OF DISCHARGE: ",%DT("B")=$$DATX^FBAAUTL(FBTODT) D ^%DT K %DT G END:X="^" S FBDOD=$S(X="":"",1:Y)
"RTN","FBCH78",12,0)
 I FBDOD]"",FBTODT>FBDOD W !!,*7,?5,"Date of Discharge must not be earlier than the Authorization To Date!",! G EN
"RTN","FBCH78",13,0)
 S DIR(0)="162.4,5",DIR("A")="ADMITTING AUTHORITY" D ^DIR K DIR
"RTN","FBCH78",14,0)
 G END:$D(DIRUT) S FBADMIT=+Y
"RTN","FBCH78",15,0)
 S DIR(0)="162.4,6" D ^DIR K DIR
"RTN","FBCH78",16,0)
 G END:$D(DIRUT) S FBEST=+Y
"RTN","FBCH78",17,0)
FBPDIS I FBTODT="" S DIR(0)="162.4,12" D ^DIR K DIR G END:$D(DUOUT),END:$D(DTOUT),NULL^FBCH780:X="" S FBPDIS=+Y
"RTN","FBCH78",18,0)
 ;
"RTN","FBCH78",19,0)
ASKPT I FBTODT]"" S DIR(0)="SAO^00:SURGICAL;10:MEDICAL;86:PSYCHIATRY",DIR("A")="BEDSECTION/TREATING SPECIALTY: ",DIR("?")="^D HELP^FBCH780" D ^DIR K DIR D NOUP^FBCHCD:$D(DIRUT) G ASKPT:$D(DIRUT) S FBPT=Y
"RTN","FBCH78",20,0)
7078 S PRCS("A")="Select Obligation Number: ",PRCS("TYPE")="FB" D EN1^PRCS58 G:Y=-1 NOGOOD S (X,FBCHOB)=$P(Y,"^",2) K PRCS("A") S PRCS("TYPE")="FB" D EN1^PRCSUT31 G:Y="" NOGOOD S FB7078=$P(FBCHOB,"-",2)_"."_Y S FBSEQ=Y
"RTN","FBCH78",21,0)
 S DIC="^FB7078(",DIC(0)="LQ",DLAYGO=162.4,X=""""_FB7078_"""" D ^DIC G:Y<0 PROB S (DA,FBAA78)=+Y
"RTN","FBCH78",22,0)
 S DIE="^FBAA(162.2,",DA=FBDA,DR="16////^S X=FBAA78" D ^DIE K DIE,DIC,DA,DR
"RTN","FBCH78",23,0)
SET78 S DIE="^FB7078(",DA=FBAA78,DR="[FBCH ENTER 7078]" D ^DIE K DIC,DIE,DR,DA
"RTN","FBCH78",24,0)
 D ^FBCH780 I $G(FBOUT) W !!,*7,"...deleting 7078." D DEL G END
"RTN","FBCH78",25,0)
 I +Y=0 W !!,*7,Y,!,"...deleting 7078.  Use 'Set-up a 7078' after adjusting 1358.",! D DEL G END
"RTN","FBCH78",26,0)
 K DIE,DIC,DA
"RTN","FBCH78",27,0)
 I $G(FBVET) S:'$G(DFN) DFN=FBVET D PTF^FBCH780
"RTN","FBCH78",28,0)
 G SHOW:FBTODT=""
"RTN","FBCH78",29,0)
AUTH D HOME^%ZIS
"RTN","FBCH78",30,0)
 D:'$D(FBSITE(1)) SITEP^FBAAUTL Q:FBPOP  S FBPSA=$S($P(FBSITE(1),"^",3)="":"",$D(^DIC(4,$P(FBSITE(1),"^",3),0)):$P(^(0),"^"),1:"")
"RTN","FBCH78",31,0)
 S FBVEN=$P(FBVEN,";")
"RTN","FBCH78",32,0)
 I '$D(^FBAAA(FBVET,0)) D  G:Y<0 END
"RTN","FBCH78",33,0)
 . N DINUM
"RTN","FBCH78",34,0)
 . S Y=-1
"RTN","FBCH78",35,0)
 . L +^FBAAA(FBVET):$S($D(DILOCKTM):DILOCKTM,1:5) I $T D
"RTN","FBCH78",36,0)
 . . K DD,DO S (X,DINUM)=FBVET,DIC="^FBAAA(",DIC(0)="LM",DLAYGO=161
"RTN","FBCH78",37,0)
 . . D FILE^DICN
"RTN","FBCH78",38,0)
 . . L -^FBAAA(FBVET)
"RTN","FBCH78",39,0)
 . I Y<0 W !,"ERROR: Unable to create entry in FEE BASIS PATIENT file."
"RTN","FBCH78",40,0)
 K DE,DQ,DR,DIE,DLAYGO
"RTN","FBCH78",41,0)
 ;FB*3.5*108 ask Contract
"RTN","FBCH78",42,0)
 D  G:$D(DTOUT)!$D(DUOUT) END
"RTN","FBCH78",43,0)
 . S FBCNTRA=""
"RTN","FBCH78",44,0)
 . N DIR
"RTN","FBCH78",45,0)
 . S DIR(0)="PO^161.43:AQEM"
"RTN","FBCH78",46,0)
 . S DIR("A")="CONTRACT"
"RTN","FBCH78",47,0)
 . S DIR("?",1)="If the authorization is under a contract then select it."
"RTN","FBCH78",48,0)
 . S DIR("?")="Contract must be active and applicable for the authorized vendor."
"RTN","FBCH78",49,0)
 . S DIR("S")="I $P($G(^(0)),""^"",2)'=""I"",$$VCNTR^FBUTL7(FBVEN,+Y)"
"RTN","FBCH78",50,0)
 . D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","FBCH78",51,0)
 . I Y>0 S FBCNTRA=+Y
"RTN","FBCH78",52,0)
FBDCHG S DIR(0)="161.01,.06" D ^DIR K DIR G END:$D(DTOUT),END:$D(DUOUT) D NULL1^FBCH780:X="" G FBDCHG:X="" S FBDCHG=+Y
"RTN","FBCH78",53,0)
FBPUR S FBTYPE=6,DIR(0)="161.01,.07" D ^DIR K DIR S FBPUR=+Y
"RTN","FBCH78",54,0)
 G END:$D(DTOUT),END:$D(DUOUT)
"RTN","FBCH78",55,0)
FBPSA S DIR(0)="161.01,101" D ^DIR K DIR G END:$D(DTOUT),END:$D(DUOUT) D NULL1^FBCH780:X="" G FBPSA:X="" S FBPSA=+Y
"RTN","FBCH78",56,0)
 ;file entry in authorization multiple of file 161
"RTN","FBCH78",57,0)
 S DIC="^FBAAA("_FBVET_",1,",DIC(0)="LM",DLAYGO=161,DA(1)=FBVET,X=FBFRDT K DD,DO D FILE^DICN G:Y<0 END S DA=+Y,DIE("NO^")="" ;DA(1)=FBVET
"RTN","FBCH78",58,0)
 S FB78=FBAA78_";FB7078("
"RTN","FBCH78",59,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",60,0)
 S DIE=DIC,DR=".02////^S X=FBTODT;.03////^S X=6;100////^S X=DUZ;1////^S X=""YES"";.055////^S X=FB78;.06////^S X=FBDCHG;S FBTYPE=6;.04////^S X=FBVEN;.065////^S X=FBPT;101////^S X=FBPSA"
"RTN","FBCH78",61,0)
 S:$G(FBRP)]"" DR=DR_";104////^S X=FBRP"
"RTN","FBCH78",62,0)
 S DR=DR_";.095////^S X=1"
"RTN","FBCH78",63,0)
 S DR(1,161.01,1)="I $D(^FB7078(FBAA78,1,0)) S ^FBAAA(DA(1),1,DA,2,0)=^(0) F FBI=1:1 Q:'$D(^FB7078(FBAA78,1,FBI,0))  I $D(^(0)) S ^FBAAA(DA(1),1,DA,2,FBI,0)=^(0);.07////^S X=FBPUR;.08///^S X=FBDXS;.096;.097//^S X=""N"""
"RTN","FBCH78",64,0)
 I $G(FBCNTRA)]"" S DR(1,161.01,2)="105////^S X=FBCNTRA"
"RTN","FBCH78",65,0)
 D ^DIE K DIE,DR
"RTN","FBCH78",66,0)
 S (DIC,DIE)="^FB7078(",DA=FBAA78,DR="9///^S X=""C"";12///^S X=""@""" D ^DIE K DR,DIE,DA,X
"RTN","FBCH78",67,0)
SHOW W !! S DA=FBAA78,DR="0;1",DIC="^FB7078(" D EN^DIQ
"RTN","FBCH78",68,0)
 S X=$$CN7078(FBAA78) I X]"" W ?2,"CONTRACT: ",$P(X,U,2)
"RTN","FBCH78",69,0)
 ;
"RTN","FBCH78",70,0)
 ;FB*3.5*103 ;added FBRP
"RTN","FBCH78",71,0)
END K D,DA,DIC,DIE,DIR,DLAYGO,DR,FBDA,FB7078,FBAA78,FBPT,FBTYPE,FBVEN,FBZ,FBVET,FBFRDT,FBTODT,J,S,POP,X,Y,DFN,FBCHOB,FBCOMM,FBDFN,FBEST,FBI,FBLENT,FBMENT,FBNAME,FBSEQ,FBSSN,FBSW,I,K,PRC,VAL,FB,FBFLG,ZZ,FBPSA,FBSITE,FB78,FBOUT
"RTN","FBCH78",72,0)
 K FBDCHG,FBPUR,FBPDIS,FBADMIT,FBDXS,A,D0,D1,X1,DIRUT,DTOUT,DUOUT,FBDOA,FBDOD,FBPOP,FBZZ,ZZZ,PRCSCPAN,FBRP,FBCNTRA,PRCS
"RTN","FBCH78",73,0)
 Q
"RTN","FBCH78",74,0)
PROB W !!,"The reference number did not get set up with the",!,"IFCAP software. Contact your package coordinator." G END
"RTN","FBCH78",75,0)
NOGOOD S DIR(0)="Y",DIR("A")="Obligation number selected is invalid or you are not a control point user in the IFCAP package!  Try again",DIR("B")="YES" D ^DIR K DIR G END:$D(DIRUT)!'Y,7078
"RTN","FBCH78",76,0)
 ;
"RTN","FBCH78",77,0)
OUTP ;ENTRY TO DISPLAY A 7078
"RTN","FBCH78",78,0)
 ;FB*3.5*103 ; Display the 0 node fields with computed REFERRING PROVIDER NPI, then 1 node fields
"RTN","FBCH78",79,0)
 S DIC="^FB7078(",DIC(0)="AEQM",D="D",DIC("A")="Select Patient: " D IX^DIC
"RTN","FBCH78",80,0)
 G END:X=""!(X="^")
"RTN","FBCH78",81,0)
 S (DA,FBDA)=+Y,DR="0",DIQ(0)="C" W !! D EN^DIQ K DIQ(0)
"RTN","FBCH78",82,0)
 S DA=FBDA,DR="1" D EN^DIQ
"RTN","FBCH78",83,0)
 S X=$$CN7078(FBDA) I X]"" W ?2,"CONTRACT: ",$P(X,U,2),!
"RTN","FBCH78",84,0)
 I $$DISCH^FBCH780(FBDA)]"" W ?2,"DISCHARGE TYPE: ",$$DISCH^FBCH780(FBDA),!
"RTN","FBCH78",85,0)
 G OUTP
"RTN","FBCH78",86,0)
 ;
"RTN","FBCH78",87,0)
REFNPI(IEN200,IEN162P4,CHKAUTH) ;FB*3.5*103
"RTN","FBCH78",88,0)
 ; a new function that returns the REFERRING PROVIDER NPI if it is Active and the provider has authorized use of the NPI
"RTN","FBCH78",89,0)
 ; If is used in both a Fileman function and in other FB routines.
"RTN","FBCH78",90,0)
 ;
"RTN","FBCH78",91,0)
 ; Input
"RTN","FBCH78",92,0)
 ; IEN200 - IEN to file 200 if known
"RTN","FBCH78",93,0)
 ; IEN162P4 (optional) - IEN to File 162.4 (if ref prov is not known)
"RTN","FBCH78",94,0)
 ; CHKAUTH (optional) - Flag on whether to Chek Authorization in file 200
"RTN","FBCH78",95,0)
 ;
"RTN","FBCH78",96,0)
 ; Output
"RTN","FBCH78",97,0)
 ; A valid/active NPI if one can be determined.  Otherwise, nada.
"RTN","FBCH78",98,0)
 ;
"RTN","FBCH78",99,0)
 ; If neither IEN is passed in, there is no NPI coming out
"RTN","FBCH78",100,0)
 I $G(IEN200)<1,$G(IEN162P4)<1 Q ""
"RTN","FBCH78",101,0)
 ;
"RTN","FBCH78",102,0)
 ; If there is no referrring provider IEN passed in, try getting it from the IEN from 162.4 (VA FORM 10-7078)
"RTN","FBCH78",103,0)
 ; return nothing if you can't
"RTN","FBCH78",104,0)
 I $G(IEN200)<1 S IEN200=$$GET1^DIQ(162.4,IEN162P4_",",15,"I") Q:$G(IEN200)<1 ""
"RTN","FBCH78",105,0)
 ;
"RTN","FBCH78",106,0)
 ; Now that we have an IEN to 200 see if we need authorization and have to display/print NPI
"RTN","FBCH78",107,0)
 ; If the return value is less than 1, then we don't have permission or it was not a valid IEN.
"RTN","FBCH78",108,0)
 ; IA#5070
"RTN","FBCH78",109,0)
 I $G(CHKAUTH) Q:+$$GETRLNPI^XUSNPI(IEN200)<1 ""
"RTN","FBCH78",110,0)
 ;
"RTN","FBCH78",111,0)
 ; Go get the NPI for this IEN
"RTN","FBCH78",112,0)
 N NPI S NPI=$$NPI^XUSNPI("Individual_ID",IEN200)
"RTN","FBCH78",113,0)
 ;
"RTN","FBCH78",114,0)
 ; Make sure it is a valid/Active NPI
"RTN","FBCH78",115,0)
 I +NPI<1!($P(NPI,U,3)="Inactive") Q ""
"RTN","FBCH78",116,0)
 Q +NPI
"RTN","FBCH78",117,0)
 ;
"RTN","FBCH78",118,0)
DEL S DA=FBAA78,DIK="^FB7078(" D ^DIK K DIK S DA=$O(^FBAA(162.2,"AM",+FBAA78,0)) I DA S DIE="^FBAA(162.2,",DR="16///@" D ^DIE
"RTN","FBCH78",119,0)
 Q
"RTN","FBCH78",120,0)
CN7078(FBDA) ; VA FORM 10-7078 Contract
"RTN","FBCH78",121,0)
 ; input FBDA = ien of entry in file 162.4
"RTN","FBCH78",122,0)
 ; returns contract ien^contract number for the 7078 or null
"RTN","FBCH78",123,0)
 N DFN,FBAU,FBCNTRA,FBRET
"RTN","FBCH78",124,0)
 S FBRET=""
"RTN","FBCH78",125,0)
 I $G(FBDA) D
"RTN","FBCH78",126,0)
 . S DFN=$P($G(^FB7078(FBDA,0)),U,3)
"RTN","FBCH78",127,0)
 . Q:'DFN
"RTN","FBCH78",128,0)
 . S FBAU=$O(^FBAAA("AG",FBDA_";FB7078(",DFN,0))
"RTN","FBCH78",129,0)
 . Q:'FBAU
"RTN","FBCH78",130,0)
 . S FBCNTRA=$P($G(^FBAAA(DFN,1,FBAU,0)),U,22)
"RTN","FBCH78",131,0)
 . Q:'FBCNTRA
"RTN","FBCH78",132,0)
 . S FBRET=FBCNTRA_U_$P($G(^FBAA(161.43,FBCNTRA,0)),U)
"RTN","FBCH78",133,0)
 Q FBRET
"RTN","FBCHCD")
0^4^B20874782^B20886446
"RTN","FBCHCD",1,0)
FBCHCD ;AISC/DMK - COMPLETE DISPOSITION ;6/16/2009
"RTN","FBCHCD",2,0)
 ;;3.5;FEE BASIS;**108**;JAN 30, 1995;Build 115
"RTN","FBCHCD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCHCD",4,0)
ASK S DIC="^FB7078(",DIC(0)="AEQMZ",D="D",DIC("A")="Select Veteran: ",DIC("S")="I $P(^(0),U,9)=""I""" D IX^DIC G END:$E(X)="^"!(X=""),ASK:Y<0 S (DA,FBAA78)=+Y,FBTYPE=6,FB(0)=Y(0),FBDXS="",FBFRDT=$P(FB(0),"^",4) K DIC("S"),D
"RTN","FBCHCD",5,0)
EN S DIR(0)="162.4,4",DIR("A")="AUTHORIZATION TO DATE" D ^DIR
"RTN","FBCHCD",6,0)
 G END:$D(DUOUT),END:+Y'>0,H^XUS:$D(DTOUT) S FBTODT=+Y K DIR,X,Y
"RTN","FBCHCD",7,0)
 I FBTODT]"",FBFRDT>FBTODT W !!,*7,?5,"Authorization To Date must be after Authorization From Date!",! G EN
"RTN","FBCHCD",8,0)
 S DIR(0)="162.4,4.5",DIR("A")="DATE OF DISCHARGE" D ^DIR K DIR
"RTN","FBCHCD",9,0)
 G END:$D(DUOUT),END:+Y'>0,H^XUS:$D(DTOUT) S FBDOD=+Y K X,Y
"RTN","FBCHCD",10,0)
 I FBDOD]"",FBTODT>FBDOD W !!,*7,?5,"Date of Discharge must not be earlier than the Authorization To Date!",! G EN
"RTN","FBCHCD",11,0)
 S FBVEN=$P(FB(0),"^",2),FBVET=$P(FB(0),"^",3),DIE=DIC,DR="4////^S X=FBTODT;S:X="""" (Y,FBTODT)="""";S FBTODT=X;4.5////^S X=FBDOD" D ^DIE G END:FBTODT=""
"RTN","FBCHCD",12,0)
ASKPT W ! S DIR(0)="SAO^00:SURGICAL;10:MEDICAL;86:PSYCHIATRY",DIR("A")="BEDSECTION/TREATING: ",DIR("?")="^D HELP^FBCH780" D ^DIR D NOUP:$D(DIRUT) G ASKPT:$D(DIRUT) S FBPT=Y K X,Y,DIRUT,DIR G AUTH^FBCH78
"RTN","FBCHCD",13,0)
EDIT ;ENTRY TO EDIT A COMPLETED DISPOSITION
"RTN","FBCHCD",14,0)
 S FBEDAT=0
"RTN","FBCHCD",15,0)
 S DIC="^FB7078(",DIC(0)="AEMQZ",D="D",DIC("A")="Select Patient: ",DIC("S")="I $P(^(0),U,9)=""C""&($P(^(0),U,11)=6)" D IX^DIC G END:X="^"!(X=""),EDIT:Y<0 S FB7078=+Y,FBVET=$P(Y(0),"^",3),FBHTDT=$P(Y(0),"^",5),FBHFDT=$P(Y(0),"^",4)
"RTN","FBCHCD",16,0)
 G END:'$D(^FBAAA("AG",FB7078_";FB7078("))
"RTN","FBCHCD",17,0)
 I $D(^FBAAI("E",FB7078_";FB7078(")) S FBEDAT=1 W !!,*7,"Payment already exists for this disposition, editing of dates not allowed!",!
"RTN","FBCHCD",18,0)
 I 'FBEDAT S DA=$O(^FBAA(162.2,"AM",+FB7078,0)) I DA]"" S DIE="^FBAA(162.2,",DR="4;S FBFRDT=(X\1)",DIE("NO^")="" D ^DIE K DIE,DR
"RTN","FBCHCD",19,0)
 I 'FBEDAT,(DA']"") G END
"RTN","FBCHCD",20,0)
 I 'FBEDAT,$G(FBFRDT) S DIE="^FB7078(",DA=+FB7078,DR=$S(FBHFDT'=FBFRDT:"3///^S X=FBFRDT;I 1;",1:"")_"4;S FBTODT=X",DIE("NO^")="" D ^DIE K DIE,DR
"RTN","FBCHCD",21,0)
 G END:+$G(FBTODT)'>0,END:'$G(FBFRDT)
"RTN","FBCHCD",22,0)
 I 'FBEDAT,(FBHTDT'=FBTODT),(FBTODT>$P(^FB7078(+FB7078,0),"^",16)) W !!,*7,"Date of Discharge must now be edited to be equal to or later than",!,"the Authorization To Date.",! S FBDR="4.5////^S X=FBTODT;I 1;"
"RTN","FBCHCD",23,0)
 I 'FBEDAT S FBDR=$G(FBDR)_"4.5;"
"RTN","FBCHCD",24,0)
 S FBTYPE=6,DIE="^FB7078(",DA=+FB7078,DR=$S($G(FBDR):FBDR,1:"")_"7///^S X=""@"";5ADMITTING AUTHORITY~",DIE("NO^")="" D ^DIE K DIC,DIE,D,DR,DA,FBDR
"RTN","FBCHCD",25,0)
 S DA(1)=FBVET,DIC="^FBAAA("_FBVET_",1,",DIC(0)="EQM",DA=$O(^FBAAA("AG",FB7078_";FB7078(",FBVET,0))
"RTN","FBCHCD",26,0)
 S DR=$S(FBEDAT'=1:".01////^S X=FBFRDT;",1:"")_$S(FBEDAT'=1:".02////^S X=FBTODT;",1:"")
"RTN","FBCHCD",27,0)
 ; FB*3.5*108 edit contract
"RTN","FBCHCD",28,0)
 I $$EDCNTRA^FBUTL7(DA(1),DA) S DR=DR_"105;"
"RTN","FBCHCD",29,0)
 S DR=DR_".06;D DEFPTC^FBCHCD;.065///^S X=FBPT;.07;.021;.096;.097//^S X=""NO"""
"RTN","FBCHCD",30,0)
 S DR(1,161.01,1)="I $D(^FBAAA(FBVET,1,DA,2,0)) S ^FB7078(FB7078,1,0)=^(0) F FBI=1:1 Q:'$D(^FBAAA(FBVET,1,DA,2,FBI,0))  I $D(^(0)) S ^FB7078(FB7078,1,FBI,0)=^(0);101",DIE=DIC,DIE("NO^")="" W ! D ^DIE K DIE,DR,DIC
"RTN","FBCHCD",31,0)
 W !! G EDIT
"RTN","FBCHCD",32,0)
END K DIC,DIE,DA,DR,FB,FBPROG,FBAAOUT,FBSW,FBVET,FB7078,FBHTDT,FBTODT,FBTYPE,FBAA78,FBFRDT,FBVEN,K,PTYPE,X,Y,Z,FBDEF,FBPT,FBI,FBHFDT,J,FBZZ,FBDA,FBDFN,FBDXS,FBNAME,FBSSN,FBZZ,ZZZ,FBDOD,FBEDAT
"RTN","FBCHCD",33,0)
 Q
"RTN","FBCHCD",34,0)
DEFPTC S FBDEF=$P(^FBAAA(FBVET,1,DA,0),U,18),FBDEF=$S(FBDEF="00":"SURGICAL",FBDEF=10:"MEDICAL",FBDEF=86:"PSYCHIATRY",1:"")
"RTN","FBCHCD",35,0)
 N X,DP,Y,DQ S DIR(0)="SA^00:SURGICAL;10:MEDICAL;86:PSYCHIATRY",DIR("A")="BEDSECTION/TREATING SPECIALTY: ",DIR("?")="^D HELP^FBCH780",DIR("B")=FBDEF D ^DIR D NOUP:$D(DUOUT) G DEFPTC:$D(DIRUT) S FBPT=Y K DIR,DIRUT Q
"RTN","FBCHCD",36,0)
NOUP W !!,*7,?5,"This is a mandatory response. Entering an '^' is not allowed!",! D HELP^FBCH780 Q
"RTN","FBCHEP")
0^5^B33211512^B30542505
"RTN","FBCHEP",1,0)
FBCHEP ;AISC/DMK-ENTER PAYMENT FOR CONTRACT HOSPITAL ;8/18/2004
"RTN","FBCHEP",2,0)
 ;;3.5;FEE BASIS;**4,61,77,82,122,108**;JAN 30, 1995;Build 115
"RTN","FBCHEP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHEP",4,0)
 S FBAAPTC="V",FBAAOUT=0
"RTN","FBCHEP",5,0)
RD K FBAAID,FBAAVID S FBRESUB="" D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBCHEP",6,0)
 S FBPROG="I $P(^(0),U,3)=6,($P(^(0),U,9)'[""FB583"")" D GETAUTH^FBAAUTL1 G RD:$D(DUOUT),RD:FTP']""
"RTN","FBCHEP",7,0)
 ;W !!,?25,"<  ASSOCIATED 7078  >",!!
"RTN","FBCHEP",8,0)
 ;S DIC="^FB7078(",DA=FB7078,DR="0;1" D EN^DIQ
"RTN","FBCHEP",9,0)
 I FB7078="" W !,*7,"No 7078 on file for this authorization." G RD
"RTN","FBCHEP",10,0)
 S FBI7078=FB7078_";FB7078("
"RTN","FBCHEP",11,0)
 I $D(^FBAAI("E",FBI7078)) S FBAAIN=$O(^FBAAI("E",FBI7078,0)) G OUT
"RTN","FBCHEP",12,0)
SETINV S FBZ(0)=^FB7078(FB7078,0),FBVET=$P(FBZ(0),"^",3),FBVEN=$P(FBZ(0),"^",2),FBVEN=$P(FBVEN,";",1)
"RTN","FBCHEP",13,0)
 ;
"RTN","FBCHEP",14,0)
EN583 ;Entry from 583 enter payment
"RTN","FBCHEP",15,0)
 I FBAAPTC="R" D ^FBAACO0
"RTN","FBCHEP",16,0)
 S DA=FBVEN D EN1^FBAAVD
"RTN","FBCHEP",17,0)
 I $P($G(^FBAAV(FBVEN,"ADEL")),U)="Y" W !!,*7,"Vendor is flagged for Austin deletion!" G Q
"RTN","FBCHEP",18,0)
 D SITEP^FBAAUTL G Q:FBPOP
"RTN","FBCHEP",19,0)
 S FBAAMPI=$P(FBSITE("FBNUM"),U,4)
"RTN","FBCHEP",20,0)
 ;
"RTN","FBCHEP",21,0)
RDV S FBVE="" S:$D(^FBAAV(FBVEN,"AMS")) FBVE=$P(^("AMS"),"^",2) S:$G(FBVE)'="Y" FBVE="N"
"RTN","FBCHEP",22,0)
 I FBVE="Y" W *7,!!,"Vendor is listed as 'exempt from the pricer'." S DIR(0)="Y",DIR("A")="Do you wish to keep this invoice exempt from the pricer",DIR("B")="Yes" D ^DIR K DIR G Q:$D(DIRUT) S FBVE=$S(Y=1:"Y",1:"N")
"RTN","FBCHEP",23,0)
 I $G(FBVE)'="Y",($P($G(^FBAAV(FBVEN,0)),"^",17)']"") W !!,*7,"Medicare ID Number is needed for this Vendor!" S DIE="^FBAAV(",DR=22 D ^DIE K DIE G Q:$D(DTOUT)!('$L(X))
"RTN","FBCHEP",24,0)
 ;
"RTN","FBCHEP",25,0)
BAT S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,3)=""B9""&($P(^(0),U,5)=DUZ)&($P(^(0),U,15)=""Y"")&($G(^(""ST""))=""O"")&(FBAAMPI>$P(^(0),U,10))" W ! D ^DIC K DIC
"RTN","FBCHEP",26,0)
 G Q:X="^"!(X=""),BAT:Y<0 S FBAABE=+Y,FBY(0)=Y(0),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2),FBEXMPT=$P(FBY(0),"^",18) S FBAAOUT=0 D CHK I FBAAOUT K Y,Y(0),FBAABE G BAT
"RTN","FBCHEP",27,0)
 I FBI7078["FB7078(",BO'=$P($P(FBZ(0),U),".") W !,*7,"Obligation number on batch does not match 1358.",!,"Obligation number on batch must be ",$P($P(FBZ(0),U),"."),".",! G BAT
"RTN","FBCHEP",28,0)
 S FBINC=$S($P(FBY(0),"^",10)="":0,1:$P(FBY(0),"^",10)),FBLN=$S($P(FBY(0),"^",11)="":0,1:$P(FBY(0),"^",11))
"RTN","FBCHEP",29,0)
GETNXI D GETNXI^FBAAUTL
"RTN","FBCHEP",30,0)
 W !!,"Invoice # ",FBAAIN," assigned to this Invoice"
"RTN","FBCHEP",31,0)
RIN D GETINDT^FBAACO1 G Q:$G(FBAAOUT)
"RTN","FBCHEP",32,0)
 ; ask patient control number
"RTN","FBCHEP",33,0)
 S FBCSID=$$ASKPCN^FBUTL5() I FBCSID="^" G Q
"RTN","FBCHEP",34,0)
 ; if U/C then get FPPS Claim ID else ask user
"RTN","FBCHEP",35,0)
 I $D(FB583) S FBFPPSC=$P($G(^FB583(FB583,5)),U) W !,"FPPS CLAIM ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBCHEP",36,0)
 E  S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 G Q
"RTN","FBCHEP",37,0)
 ; if EDI claim then ask FPPS line item
"RTN","FBCHEP",38,0)
 I FBFPPSC]"" S FBFPPSL=$$FPPSL^FBUTL5(,1) I FBFPPSL=-1 G Q
"RTN","FBCHEP",39,0)
 ; compute default Covered Days
"RTN","FBCHEP",40,0)
 S FBCDAYS=$$FMDIFF^XLFDT(FBAAEDT,FBAABDT)
"RTN","FBCHEP",41,0)
 I FBCDAYS=0 S FBCDAYS=1
"RTN","FBCHEP",42,0)
 S FBAAMM=$S(FBAAPTC="R":"",$D(FB583):"",1:1) D PPT^FBAACO1()
"RTN","FBCHEP",43,0)
DIC S DIC="^FBAAI(",DIC(0)="LQ",DLAYGO=162.5,X=FBAAIN D ^DIC G Q:Y<0
"RTN","FBCHEP",44,0)
 S DA=+Y,DIE=DIC,DR="[FBCH ENTER PAYMENT]",DIE("NO^")=""
"RTN","FBCHEP",45,0)
 D
"RTN","FBCHEP",46,0)
 . N ICDVDT S ICDVDT=$G(FBAABDT) D ^DIE
"RTN","FBCHEP",47,0)
 ; file adjustment reasons
"RTN","FBCHEP",48,0)
 D FILEADJ^FBCHFA(DA_",",.FBADJ)
"RTN","FBCHEP",49,0)
 ; file remittance remarks
"RTN","FBCHEP",50,0)
 D FILERR^FBCHFR(DA_",",.FBRRMK)
"RTN","FBCHEP",51,0)
 ; file Line Item Rendering providers
"RTN","FBCHEP",52,0)
 D FILERP^FBUTL8(DA_",",.FBPROV) ;FB*3.5*122
"RTN","FBCHEP",53,0)
 K DIE,DIC,D,DA,DR
"RTN","FBCHEP",54,0)
 S $P(FBY(0),"^",10)=FBINC+1,$P(FBY(0),"^",11)=FBLN+1,$P(FBY(0),"^",18)=FBEXMPT,^FBAA(161.7,FBAABE,0)=FBY(0) ;D:'$D(FBNOPTF) PTF G Q:$D(FB583),RD
"RTN","FBCHEP",55,0)
 D
"RTN","FBCHEP",56,0)
 . N FBX
"RTN","FBCHEP",57,0)
 . S FBX=FBAAMPI-(FBINC+1)
"RTN","FBCHEP",58,0)
 . I FBX<6 W !,$C(7),"Warning, you can only enter ",FBX," more invoices in this batch!",!
"RTN","FBCHEP",59,0)
 D:'$D(FBNOPTF) PTF
"RTN","FBCHEP",60,0)
 G Q:$D(FB583),RD
"RTN","FBCHEP",61,0)
OUT W !!,*7,?3,"Invoice number ",FBAAIN," has already been entered for this authorization.",!,?3,"Use the Contract Hospital 'Invoice Edit' option if needed.",!
"RTN","FBCHEP",62,0)
 ;check if user wants to add a second invoice for this 7078
"RTN","FBCHEP",63,0)
 W ! S DIR("A")="Want to add another invoice for this episode of care",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR I Y S (FBNOPTF,FBRESUB)=1 G SETINV
"RTN","FBCHEP",64,0)
Q K BO,CNT,D,DA,DAT,DIC,DIE,DLAYGO,DR,FB7078,FBAABDT,FBAABE,FBAAEDT,FBAAID,FBAAIN,FBAAOUT,FBAAPTC,FBDX,FBTT,FBTYPE,FBVEN,FBVET,FBXX,FTP,I,J,FBK,PI,FBPOP,PTYPE,S,FBZ,Z1,FBI,FBPROG,FBRR,FBSW,FBPOV,FBPT,FBY,T,Y,Z1,Z2,ZZ,FBPSA,A,FBI7078
"RTN","FBCHEP",65,0)
 K FBCHOB,FBAUT,FBSEQ,X,FBSITE,F,FBSTN,FBASSOC,FBLOC,DUOUT,PSA,FBCOUNTY,DFN,FBNOPTF,DIRUT,FBVE,FBAAOUT,FBEXMPT,FBAAPN,FBAMTC,FBDEL,FBINC,FBLN,FBRESUB
"RTN","FBCHEP",66,0)
 K FBD1,FBFDC,FBMST,FBTTYPE,FB583
"RTN","FBCHEP",67,0)
 K FBCSID,FBFPPSC,FBFPPSL,FBCDAYS,FBAMTP,FBADJ,FBRRMK,FBAAMPI,FBV
"RTN","FBCHEP",68,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBCHEP",69,0)
 Q
"RTN","FBCHEP",70,0)
PTF I $G(FBVET),$G(FBI7078)["FB583" S:'$G(DFN) DFN=FBVET D PTFC^FBUTL6(DFN,$P(FBZ(0),"^",4))
"RTN","FBCHEP",71,0)
 Q
"RTN","FBCHEP",72,0)
PRBT ;Entry point for patient reimbursement option
"RTN","FBCHEP",73,0)
 ;
"RTN","FBCHEP",74,0)
 S FBAAPTC="R"
"RTN","FBCHEP",75,0)
 G RD
"RTN","FBCHEP",76,0)
CHK ;Check for vendor and batch being exempt from pricer
"RTN","FBCHEP",77,0)
 I $G(FBVE)'="Y"&($G(FBVE)'="N") S FBVE="N"
"RTN","FBCHEP",78,0)
 I $G(FBEXMPT)="Y" Q:FBVE="Y"  G OPEN:FBVE="N"
"RTN","FBCHEP",79,0)
 I $G(FBEXMPT)="N" Q:FBVE="N"  G OPEN:FBVE="Y"
"RTN","FBCHEP",80,0)
 I '$G(FBEXMPT)&($G(Z2)'>0) S FBEXMPT=FBVE Q
"RTN","FBCHEP",81,0)
 I '$G(FBEXMPT)&($G(Z2)>0) S $P(^FBAA(161.7,FBAABE,0),"^",18)="N",FBEXMPT="N" G CHK
"RTN","FBCHEP",82,0)
 Q
"RTN","FBCHEP",83,0)
OPEN W *7,!!,"This Invoice may not be added to Batch # ",+FBY(0),".",!,"***You may not add a ",$S(FBVE="Y":"pricer exempt",1:"non-exempt")," invoice to a ",$S(FBVE="Y":"non-exempt",1:"pricer exempt")," batch.***"
"RTN","FBCHEP",84,0)
 S DIR(0)="Y",DIR("A")="Do you want to open a new batch at this time",DIR("B")="Y" D ^DIR K DIR S:$D(DIRUT)!('Y) FBAAOUT=1 Q:FBAAOUT  D RCHOP^FBAAOB S FBEXMPT=FBVE D
"RTN","FBCHEP",85,0)
 .S FBY(0)=$G(^FBAA(161.7,FBAABE,0)),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2)
"RTN","FBCHEP",86,0)
 Q
"RTN","FBCHEP",87,0)
IPAC ;
"RTN","FBCHEP1")
0^6^B33647893^B11600569
"RTN","FBCHEP1",1,0)
FBCHEP1 ;AISC/DMK-EDIT PAYMENT FOR CONTRACT HOSPITAL ;7/8/2003
"RTN","FBCHEP1",2,0)
 ;;3.5;FEE BASIS;**38,61,122,133,108**;JAN 30, 1995;Build 115
"RTN","FBCHEP1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHEP1",4,0)
EDIT ;ENTRY POINT TO EDIT PAYMENT
"RTN","FBCHEP1",5,0)
 N LASTDX,LASTPROC
"RTN","FBCHEP1",6,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBCHEP1",7,0)
BT W ! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,3)=""B9""&($P(^(0),U,15)=""Y"")",DIC("S")=$S($D(^XUSEC("FBAASUPERVISOR",DUZ)):DIC("S"),1:DIC("S")_"&($P(^(0),U,5)=DUZ)") D ^DIC
"RTN","FBCHEP1",8,0)
 G END:X=""!(X="^"),BT:Y<0 S FBN=+Y,FBN(0)=Y(0)
"RTN","FBCHEP1",9,0)
 S FBEXMPT=$P(FBN(0),"^",18)
"RTN","FBCHEP1",10,0)
 S FBSTAT=^FBAA(161.7,FBN,"ST"),FBBAMT=$S($P(FBN(0),"^",9)="":0,1:$P(FBN(0),"^",9))
"RTN","FBCHEP1",11,0)
 I FBSTAT="C"&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,?3,"You must Reopen the batch prior to editting the invoice.",! G END
"RTN","FBCHEP1",12,0)
 I FBSTAT="S"!(FBSTAT="P")!(FBSTAT="R")&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,?3,"You must be a holder of the 'FBAASUPERVISOR' security key",!,?3,"to edit this invoice.",! G END
"RTN","FBCHEP1",13,0)
 I FBSTAT="T"!(FBSTAT="V") W !!,?3,"Batch has already been sent to Austin for payment.",! G END
"RTN","FBCHEP1",14,0)
INV W ! S DIC="^FBAAI(",DIC(0)="AEQZ",DIC("S")="I $P(^(0),U,17)=FBN" D ^DIC K DIC("S") G BT:X=""!(X="^"),INV:Y<0 S FBI=+Y
"RTN","FBCHEP1",15,0)
 S FBK=$S($P(^FBAAI(FBI,0),"^",9)="":0,1:$P(^(0),"^",9))
"RTN","FBCHEP1",16,0)
 S FBLISTC="",FBAAI=FBI W @IOF D START^FBCHDI2 S FBI=FBAAI I $P(^FBAAI(FBI,0),"^",9)="" S FBPRICE=""
"RTN","FBCHEP1",17,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBCHEP1",18,0)
 D
"RTN","FBCHEP1",19,0)
 . N FBY
"RTN","FBCHEP1",20,0)
 . S FBY=$G(^FBAAI(FBI,0))
"RTN","FBCHEP1",21,0)
 . S FB1725=$S($P(FBY,U,5)["FB583":+$P($G(^FB583(+$P(FBY,U,5),0)),U,28),1:0)
"RTN","FBCHEP1",22,0)
 ; get values of FPPS Claim ID and Line Item
"RTN","FBCHEP1",23,0)
 S FBFPPSC=$P($G(^FBAAI(FBI,3)),U)
"RTN","FBCHEP1",24,0)
 S FBFPPSL=$P($G(^FBAAI(FBI,3)),U,2)
"RTN","FBCHEP1",25,0)
 ; load current adjustment data
"RTN","FBCHEP1",26,0)
 D LOADADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHEP1",27,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBCHEP1",28,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBCHEP1",29,0)
 ; load current remittance remark data
"RTN","FBCHEP1",30,0)
 D LOADRR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHEP1",31,0)
 ; load Item level Rendering provider data
"RTN","FBCHEP1",32,0)
 D LOADRP^FBUTL8(FBI_",",.FBPROV) ;FB*3.5*122
"RTN","FBCHEP1",33,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBCHEP1",34,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBCHEP1",35,0)
 S LASTDX=$$LAST(FBI,"DX"),LASTPROC=$$LAST(FBI,"PROC")
"RTN","FBCHEP1",36,0)
 S (DIE,DIC)="^FBAAI(",DIC(0)="AEQM",DA=FBI,DR="[FBCH EDIT PAYMENT]" W !
"RTN","FBCHEP1",37,0)
 D
"RTN","FBCHEP1",38,0)
 . N ICDVDT,DFN,FB583,FBAAMM1,FBAAPTC,FBCNTRA,FBCNTRP,FBV,FBVEN,FTP
"RTN","FBCHEP1",39,0)
 . S ICDVDT=$$FRDTINV^FBCSV1(DA) ;date for files 80 and 80.1 identifier
"RTN","FBCHEP1",40,0)
 . ;get variables for cal to PPT^FBAACO1
"RTN","FBCHEP1",41,0)
 . S FBAAMM1=$P($G(^FBAAI(DA,2)),U,3)
"RTN","FBCHEP1",42,0)
 . S FBCNTRP=$P($G(^FBAAI(DA,5)),U,8)
"RTN","FBCHEP1",43,0)
 . S FBV=$P($G(^FBAAI(DA,0)),U,3)
"RTN","FBCHEP1",44,0)
 . S DFN=$P($G(^FBAAI(DA,0)),U,4)
"RTN","FBCHEP1",45,0)
 . S FBAAPTC=$P($G(^FBAAI(DA,0)),U,13)
"RTN","FBCHEP1",46,0)
 . S X=$P($G(^FBAAI(DA,0)),U,5)
"RTN","FBCHEP1",47,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBCHEP1",48,0)
 . S FTP=$S(X]"":+$O(^FBAAA("AG",X,DFN,0)),1:"")
"RTN","FBCHEP1",49,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBCHEP1",50,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBCHEP1",51,0)
 . D ^DIE
"RTN","FBCHEP1",52,0)
 ; if adjustment data changed then file
"RTN","FBCHEP1",53,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHEP1",54,0)
 ; if remit remark data changed then file
"RTN","FBCHEP1",55,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHEP1",56,0)
 ; remove any gaps in codes
"RTN","FBCHEP1",57,0)
 D RMVGAP(FBI,1)
"RTN","FBCHEP1",58,0)
 ; if line item rendering providers exist then file FB*3.5*133
"RTN","FBCHEP1",59,0)
 I $D(FBPROV) D FILERP^FBUTL8(FBI_",",.FBPROV)
"RTN","FBCHEP1",60,0)
 K FBAAMM,FBAAMM1
"RTN","FBCHEP1",61,0)
 S FBNK=$P(^FBAAI(FBI,0),"^",9)
"RTN","FBCHEP1",62,0)
 I FBNK-FBK S $P(^FBAA(161.7,FBN,0),"^",9)=FBBAMT+(FBNK-FBK)
"RTN","FBCHEP1",63,0)
END K DA,DFN,DIC,DIE,DR,FBAAOUT,FBDX,FBI,FBIN,FBLISTC,FBN,FBPROC,FBSTAT,FBVEN,FBVID,J,K,L,POP,Q,VA,VADM,X,FBIFN,Y,FBPRICE,FBK,FBNK,FB583,FBAAPN,FBASSOC,FBDEL,FBLOC,DAT
"RTN","FBCHEP1",64,0)
 K CNT,D0,FB7078,FBAABDT,FBAAEDT,FBASSOC,FBAUT,FBLOC,FBPROG,FBPSA,FBPT,FBRR,FBTT,FBTYPE,FBXX,FTP,PI,PTYPE,T,Z,ZZ,F,FBPOV,I,TA,VAL,DUOUT,FBVET,FBBAMT,FBAAI,FBEXMPT,FB1725,FBPAMT
"RTN","FBCHEP1",65,0)
 K FBFPPSC,FBFPPSL,FBADJ,FBADJD,FBRRMK,FBRRMKD
"RTN","FBCHEP1",66,0)
 D END^FBCHDI
"RTN","FBCHEP1",67,0)
 Q
"RTN","FBCHEP1",68,0)
LAST(FBDA,FBNODE) ; Returns number (0-25) of last code in node for invoice
"RTN","FBCHEP1",69,0)
 D RMVGAP(FBDA,0)  ;Insure that gaps were not created outside normal processes
"RTN","FBCHEP1",70,0)
 N FBI,FBRET,FBX
"RTN","FBCHEP1",71,0)
 S FBRET=0
"RTN","FBCHEP1",72,0)
 I FBDA,"^DX^PROC^"[(U_FBNODE_U) D
"RTN","FBCHEP1",73,0)
 . S FBX=$G(^FBAAI(FBDA,FBNODE))
"RTN","FBCHEP1",74,0)
 . F FBI=25:-1:1 I $P(FBX,"^",FBI)'="" S FBRET=FBI Q
"RTN","FBCHEP1",75,0)
 Q FBRET
"RTN","FBCHEP1",76,0)
 ;
"RTN","FBCHEP1",77,0)
RMVGAP(FBDA,FBWRT) ;  Remove gaps in ICD diagnosis and procedure codes
"RTN","FBCHEP1",78,0)
 ; input
"RTN","FBCHEP1",79,0)
 ;   FBDA  IEN of invoice
"RTN","FBCHEP1",80,0)
 ;   FBWRT (optional) =1 if messages can be written to the screen
"RTN","FBCHEP1",81,0)
 ; remove any gaps
"RTN","FBCHEP1",82,0)
 N DXFLD,FBDX,FBFDA,FBI,FBMOVED,FBN,FBPOA,FBPROC,POAFLD,PROCFLD
"RTN","FBCHEP1",83,0)
 D FLDLIST ; get list of field numbers
"RTN","FBCHEP1",84,0)
 ; check diagnosis and POA codes
"RTN","FBCHEP1",85,0)
 S FBDX=$G(^FBAAI(FBDA,"DX"))
"RTN","FBCHEP1",86,0)
 S FBPOA=$G(^FBAAI(FBDA,"POA"))
"RTN","FBCHEP1",87,0)
 S FBMOVED=0
"RTN","FBCHEP1",88,0)
 S FBN=0
"RTN","FBCHEP1",89,0)
 F FBI=1:1:25 D
"RTN","FBCHEP1",90,0)
 . Q:$P(FBDX,U,FBI)=""
"RTN","FBCHEP1",91,0)
 . S FBN=FBN+1 ; increment number of diagnosis codes
"RTN","FBCHEP1",92,0)
 . Q:FBI=FBN  ; no gap
"RTN","FBCHEP1",93,0)
 . ; move diagnosis and POA from slot FBI to slot FBN
"RTN","FBCHEP1",94,0)
 . S FBMOVED=1 ; set flag for message
"RTN","FBCHEP1",95,0)
 . K FBFDA
"RTN","FBCHEP1",96,0)
 . S FBFDA(162.5,FBDA_",",$P(DXFLD,U,FBN))=$P(FBDX,U,FBI)
"RTN","FBCHEP1",97,0)
 . S FBFDA(162.5,FBDA_",",$P(POAFLD,U,FBN))=$P(FBPOA,U,FBI)
"RTN","FBCHEP1",98,0)
 . S FBFDA(162.5,FBDA_",",$P(DXFLD,U,FBI))="@"
"RTN","FBCHEP1",99,0)
 . S FBFDA(162.5,FBDA_",",$P(POAFLD,U,FBI))="@"
"RTN","FBCHEP1",100,0)
 . D FILE^DIE("","FBFDA") D:$G(FBWRT) MSG^DIALOG()
"RTN","FBCHEP1",101,0)
 . S $P(FBDX,U,FBN)=$P(FBDX,U,FBI)
"RTN","FBCHEP1",102,0)
 . S $P(FBPOA,U,FBN)=$P(FBPOA,U,FBI)
"RTN","FBCHEP1",103,0)
 . S $P(FBDX,U,FBI)=""
"RTN","FBCHEP1",104,0)
 . S $P(FBPOA,U,FBI)=""
"RTN","FBCHEP1",105,0)
 I $G(FBWRT),FBMOVED W !,"Diagnosis codes were moved to remove gaps"
"RTN","FBCHEP1",106,0)
 ;
"RTN","FBCHEP1",107,0)
 S FBPROC=$G(^FBAAI(FBDA,"PROC"))
"RTN","FBCHEP1",108,0)
 S FBMOVED=0
"RTN","FBCHEP1",109,0)
 S FBN=0
"RTN","FBCHEP1",110,0)
 F FBI=1:1:25 D
"RTN","FBCHEP1",111,0)
 . Q:$P(FBPROC,U,FBI)=""
"RTN","FBCHEP1",112,0)
 . S FBN=FBN+1 ; increment number of procedure codes
"RTN","FBCHEP1",113,0)
 . Q:FBI=FBN  ; no gap
"RTN","FBCHEP1",114,0)
 . ; move procedure from slot FBI to slot FBN
"RTN","FBCHEP1",115,0)
 . S FBMOVED=1
"RTN","FBCHEP1",116,0)
 . K FBFDA
"RTN","FBCHEP1",117,0)
 . S FBFDA(162.5,FBDA_",",$P(PROCFLD,U,FBN))=$P(FBPROC,U,FBI)
"RTN","FBCHEP1",118,0)
 . S FBFDA(162.5,FBDA_",",$P(PROCFLD,U,FBI))="@"
"RTN","FBCHEP1",119,0)
 . D FILE^DIE("","FBFDA") D:$G(FBWRT) MSG^DIALOG()
"RTN","FBCHEP1",120,0)
 . S $P(FBPROC,U,FBN)=$P(FBPROC,U,FBI)
"RTN","FBCHEP1",121,0)
 . S $P(FBPROC,U,FBI)=""
"RTN","FBCHEP1",122,0)
 I $G(FBWRT),FBMOVED W !,"Procedure codes were moved to remove gaps"
"RTN","FBCHEP1",123,0)
 Q
"RTN","FBCHEP1",124,0)
 ;
"RTN","FBCHEP1",125,0)
FLDLIST ; Provide list of fields for diagnosis, POA, and prodedures
"RTN","FBCHEP1",126,0)
 S DXFLD="30^31^32^33^34^35^35.1^35.2^35.3^35.4^35.5^35.6^35.7^35.8^35.9^36^36.1^36.2^36.3^36.4^36.5^36.6^36.7^36.8^36.9"
"RTN","FBCHEP1",127,0)
 S POAFLD="30.02^31.02^32.02^33.02^34.02^35.02^35.12^35.22^35.32^35.42^35.52^35.62^35.72^35.82^35.92^36.02^36.12^36.22^36.32^36.42^36.52^36.62^36.72^26.82^36.92"
"RTN","FBCHEP1",128,0)
 S PROCFLD="40^41^42^43^44^44.06^44.07^44.08^44.09^44.1^44.11^44.12^44.13^44.14^44.15^44.16^44.17^44.18^44.19^44.2^44.21^44.22^44.23^44.24^44.25"
"RTN","FBCHEP1",129,0)
 Q
"RTN","FBCHPET")
0^33^B36398874^B31374746
"RTN","FBCHPET",1,0)
FBCHPET ;AISC/DMK-EDIT ANCILLARY PAYMENT ;7/13/2003
"RTN","FBCHPET",2,0)
 ;;3.5;FEE BASIS;**4,38,61,77,116,108**;JAN 30, 1995;Build 115
"RTN","FBCHPET",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCHPET",4,0)
 S FY=$E(DT,1,3)+1700+$S($E(4,5)>9:1,1:0)
"RTN","FBCHPET",5,0)
GETPT I $G(BAT) D
"RTN","FBCHPET",6,0)
 .I '$D(^FBAAC("AC",+BAT)) F I=9,10,11 S $P(^FBAA(161.7,+BAT,0),U,I)=""
"RTN","FBCHPET",7,0)
 .I $D(^FBAAC("AC",+BAT)) D  S $P(^FBAA(161.7,+BAT,0),U,11)=I,$P(^(0),U,9)=$G(FBTOT) K I,FBTOT
"RTN","FBCHPET",8,0)
 ..N J,K,L,M S (I,J,K,L,M,FBTOT)=0
"RTN","FBCHPET",9,0)
 ..F  S J=$O(^FBAAC("AC",+BAT,J)) Q:'J  F  S K=$O(^FBAAC("AC",+BAT,J,K)) Q:'K  F  S L=$O(^FBAAC("AC",+BAT,J,K,L)) Q:'L  F  S M=$O(^FBAAC("AC",+BAT,J,K,L,M)) Q:'M  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S I=I+1,FBTOT=FBTOT+$P(^(0),U,3)
"RTN","FBCHPET",10,0)
 W !! S DIC="^FBAAC(",DIC(0)="AEQM" D ^DIC G END:X="^"!(X=""),GETPT:Y<0 S (DFN,FBDA(3))=+Y
"RTN","FBCHPET",11,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBCHPET",12,0)
 S DIC=DIC_DFN_",1,"
"RTN","FBCHPET",13,0)
GETVD W !! S DIC(0)="AEQM" D ^DIC G GETPT:X="^"!(X=""),GETVD:Y<0 S (FBV,FBVD,FBDA(2))=+Y
"RTN","FBCHPET",14,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,0)) ^FBAAC(DFN,1,FBDA(2),1,0)="^162.02DA^0^0"
"RTN","FBCHPET",15,0)
 S DIC=DIC_FBVD_",1,"
"RTN","FBCHPET",16,0)
GETDT S DIC(0)="AEQM",DIC("A")="Date of Service: " D ^DIC K DIC("A") G GETPT:X="^"!(X=""),GETDT:Y<0 S (FBSD,FBSDI,FBDA(1))=+Y,FBAADT=$P(Y,U,2) S:'$D(^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)) ^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)="^162.03A^0^0"
"RTN","FBCHPET",17,0)
 S FBZ=DIC_FBSD_",1,"
"RTN","FBCHPET",18,0)
SERV S DA(3)=FBDA(3),DA(2)=FBDA(2),DA(1)=FBDA(1)
"RTN","FBCHPET",19,0)
 S DIC("W")="N FBX S FBX=$$MODL^FBAAUTL4(""^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,+Y,""""M"""")"",""E"") W:FBX]"""" ""    CPT Modifier(s): "",FBX Q"
"RTN","FBCHPET",20,0)
 S DIC=FBZ,DIC(0)="AEQMZ"
"RTN","FBCHPET",21,0)
 D
"RTN","FBCHPET",22,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBCHPET",23,0)
 G GETPT:X="^"!(X=""),SERV:Y<0 S (FBSV,FBAACPI,FBDA)=+Y,BAT=$P(Y(0),U,8),FBDUZ=$P(Y(0),U,7),(FBAACP,FBAACP(0))=$P(Y,U,2),K=$P(Y(0),U,3),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBCHPET",24,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBCHPET",25,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBCHPET",26,0)
 I FBDUZ'=DUZ&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"Sorry,only the clerk who entered the payment ",!," or a supervisor can edit this payment." G GETPT
"RTN","FBCHPET",27,0)
 ;S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBCHPET",28,0)
 S FBFSAMT(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,12)
"RTN","FBCHPET",29,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBCHPET",30,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBCHPET",31,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"_FBDA(1)_",1,"_FBDA_",""M"")")
"RTN","FBCHPET",32,0)
 ; load current adjustment data
"RTN","FBCHPET",33,0)
 D LOADADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBCHPET",34,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBCHPET",35,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBCHPET",36,0)
 ; load current remittance remark data
"RTN","FBCHPET",37,0)
 D LOADRR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBCHPET",38,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBCHPET",39,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBCHPET",40,0)
 S FBFPPSC(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U)
"RTN","FBCHPET",41,0)
 S FBFPPSC=FBFPPSC(0)
"RTN","FBCHPET",42,0)
 S FBFPPSL(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,2)
"RTN","FBCHPET",43,0)
 S FBFPPSL=FBFPPSL(0)
"RTN","FBCHPET",44,0)
 G:BAT']"" EDIT
"RTN","FBCHPET",45,0)
 I $P($G(^FBAA(161.7,BAT,"ST")),"^",1)="S"!($P($G(^FBAA(161.7,BAT,"ST")),"^",1)="T")&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"Sorry, only the Supervisor can edit a payment once the batch has been released." G GETPT
"RTN","FBCHPET",46,0)
 I $P($G(^FBAA(161.7,BAT,"ST")),"^",1)="V" W !!,*7,"Sorry,you cannot edit a payment once the batch has been Finalized." G GETPT
"RTN","FBCHPET",47,0)
EDIT S DA=FBSV
"RTN","FBCHPET",48,0)
 ;
"RTN","FBCHPET",49,0)
 ; first edit CPT code and modifiers
"RTN","FBCHPET",50,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) G GETPT
"RTN","FBCHPET",51,0)
 ; if CPT was changed then update file
"RTN","FBCHPET",52,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" G GETPT
"RTN","FBCHPET",53,0)
 . N FBIENS,FBFDA
"RTN","FBCHPET",54,0)
 . S FBIENS=FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_","
"RTN","FBCHPET",55,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBCHPET",56,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBCHPET",57,0)
 ; if modifiers changed then update file
"RTN","FBCHPET",58,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(FBDA(3),FBDA(2),FBDA(1),FBDA)
"RTN","FBCHPET",59,0)
 ;
"RTN","FBCHPET",60,0)
 ; now edit remaining fields
"RTN","FBCHPET",61,0)
 S DIE("NO^")=""
"RTN","FBCHPET",62,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBCHPET",63,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only;
"RTN","FBCHPET",64,0)
 ;S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1);30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBCHPET",65,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",$D(FB583):"""",1:1);D PPT^FBAACO1(FBAAMM1,FBCNTRP,1);54///@;54////^S X=$G(FBCNTRP);30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBCHPET",66,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;D CHKIT^FBAACO3;S K=X"
"RTN","FBCHPET",67,0)
 ;S DR(1,162.03,3)="3////^S X=$S(J-K:J-K,1:"""");I X S Y=""@11"";4////@;S Y=""@5"";@11;3R;4R;S:X'=4 Y=""@5"";22;K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBCHPET",68,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBCHPET",69,0)
 S DR(1,162.03,4)="S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@5"";50///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;51///^S X=FBX;S FBFPPCL=X;S Y=""@55"";@5;50///@;S FBFPPSC="""";51///@;S FBFPPCL="""";@55"
"RTN","FBCHPET",70,0)
 S DR(1,162.03,5)="@5;K DIE(""NO^"");W !,""Exit ('^') allowed now"";26;S PRC(""SITE"")=X;8;13;Q;33;49"
"RTN","FBCHPET",71,0)
 S DR(1,162.03,6)="15;16;17////^S X=1"
"RTN","FBCHPET",72,0)
 S DR(1,162.03,7)="@7;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBCHPET",73,0)
 S DIE=FBZ
"RTN","FBCHPET",74,0)
 D
"RTN","FBCHPET",75,0)
 . N ICPTVDT,ICDVDT,FB583,FBAAMM,FBAAMM1,FBCNTRA,FBCNTRP,FBVEN,FTP
"RTN","FBCHPET",76,0)
 . S (ICPTVDT,ICDVDT)=$G(FBAADT)
"RTN","FBCHPET",77,0)
 . ; set variables for call to PPT^FBAACO1
"RTN","FBCHPET",78,0)
 . S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBCHPET",79,0)
 . S FBCNTRP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,8)
"RTN","FBCHPET",80,0)
 . S X=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,0)),U,13)
"RTN","FBCHPET",81,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBCHPET",82,0)
 . S FTP=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),0)),U,4)
"RTN","FBCHPET",83,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBCHPET",84,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBCHPET",85,0)
 . D ^DIE
"RTN","FBCHPET",86,0)
 ; if adjustment data changed then file
"RTN","FBCHPET",87,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBCHPET",88,0)
 ; if remit remark data changed then file
"RTN","FBCHPET",89,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBCHPET",90,0)
 ; if FPPS CLAIM ID changed, update other line items on invoice
"RTN","FBCHPET",91,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBCHPET",92,0)
 . N FBAAIN
"RTN","FBCHPET",93,0)
 . S FBAAIN=$$GET1^DIQ(162.03,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",14)
"RTN","FBCHPET",94,0)
 . D CKINVEDI^FBAAPET1(FBFPPSC(0),FBFPPSC,FBAAIN,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",")
"RTN","FBCHPET",95,0)
 K FBSV W !! G SERV
"RTN","FBCHPET",96,0)
END K DR,DIC,DIE,X,DFN,FBVD,FBSD,BAT,FBSV,DA,FBDA,FBZ,FBDUZ,FBAACP,FBFY,FY,FBAMTPD,J,K,Y,PRC,FBHOLDX,ZZ,FBAADT,FBV,FBSDI,FBAACPI
"RTN","FBCHPET",97,0)
 K FBAAMM,FBAAMM1,FBFSAMT,FBFSUSD,FBMODA,FBZIP,FBTIME,FBHCFA(30)
"RTN","FBCHPET",98,0)
 K FBAAPTC,FB1725
"RTN","FBCHPET",99,0)
 K FBADJ,FBADJD,FBADJL,FBRRMK,FBRRMKD,FBRRMKL,FBX,FBUNITS
"RTN","FBCHPET",100,0)
 Q
"RTN","FBCHRR")
0^36^B12984210^B9913941
"RTN","FBCHRR",1,0)
FBCHRR ;AISC/DMK - RE-INITIATE REJECTS FROM PRICER ;6/30/2009
"RTN","FBCHRR",2,0)
 ;;3.5;FEE BASIS;**61,108**;JAN 30, 1995;Build 115
"RTN","FBCHRR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCHRR",4,0)
DIC S FBTYPE="B9"
"RTN","FBCHRR",5,0)
 W ! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,15)=""Y""&($P(^(0),U,17)]"""")"_$S($D(^XUSEC("FBAASUPERVISOR",DUZ)):"",1:"&($P(^(0),U,5)=DUZ)"),DIC("A")="Select Batch with Pricer Rejects: " D ^DIC
"RTN","FBCHRR",6,0)
 G END:X="^"!(X=""),DIC:Y<0 S FBN=+Y,FBN(0)=Y(0)
"RTN","FBCHRR",7,0)
 I '$D(^FBAAI("AH",FBN)) W !!,*7,"No items rejected for this batch!",! G DIC
"RTN","FBCHRR",8,0)
DIC1 W !! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("A")="Select New Batch Number: ",DIC("S")="I $P(^(0),U,3)=FBTYPE&($P(^(0),U,5)=DUZ)&($P(^(0),U,15)=""Y"")&($G(^(""ST""))=""O"")&($P(^(0),U,18)'[""Y"")"
"RTN","FBCHRR",9,0)
 D ^DIC K DIC G DIC:$E(X)="^"!(X=""),DIC1:Y<0 S FBNB=+Y,FBNB(0)=Y(0)
"RTN","FBCHRR",10,0)
DIC2 W ! S DIC="^FBAAI(",DIC(0)="AEQMZ",DIC("A")="Select Patient: ",D="D",DIC("S")="I $D(^(""FBREJ"")),$P(^(""FBREJ""),U,3)=FBN" D IX^DIC G DIC:$E(X)="^"!(X=""),DIC2:Y<0 S FBI=+Y,FBI(0)=Y(0) G END:'$D(^FBAAI(FBI,0))
"RTN","FBCHRR",11,0)
 S FBLISTC="" D HOME^%ZIS,START^FBCHDI2
"RTN","FBCHRR",12,0)
ASK S DIR(0)="Y",DIR("A")="Want to re-initiate this payment",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT),DIC:'Y
"RTN","FBCHRR",13,0)
 S (DIC,DIE)="^FBAAI(",DIC(0)="AEQM",DA=FBI,DR="20////^S X=FBNB" D ^DIE
"RTN","FBCHRR",14,0)
 K ^FBAAI(FBI,"FBREJ"),^FBAAI("AH",FBN,FBI) S $P(FBNB(0),"^",10)=$P(FBNB(0),"^",10)+1,$P(FBNB(0),"^",11)=$P(FBNB(0),"^",11)+1,$P(FBNB(0),"^",18)="N",^FBAA(161.7,FBNB,0)=FBNB(0)
"RTN","FBCHRR",15,0)
 I '$D(^FBAAI("AH",FBN)) S $P(FBN(0),"^",17)="",^FBAA(161.7,FBN,0)=FBN(0)
"RTN","FBCHRR",16,0)
 I $D(^FBAAI("AH",FBN)) G DIC2
"RTN","FBCHRR",17,0)
EDIT S DIR(0)="Y",DIR("A")="Want to edit payment now",DIR("B")="YES" D ^DIR K DIR G END:$D(DIRUT)!'Y
"RTN","FBCHRR",18,0)
 S FBPRICE=""
"RTN","FBCHRR",19,0)
 ; get values of FPPS Claim ID and Line Item
"RTN","FBCHRR",20,0)
 S FBFPPSC=$P($G(^FBAAI(FBI,3)),U)
"RTN","FBCHRR",21,0)
 S FBFPPSL=$P($G(^FBAAI(FBI,3)),U,2)
"RTN","FBCHRR",22,0)
 ; load current adjustment data
"RTN","FBCHRR",23,0)
 D LOADADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHRR",24,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBCHRR",25,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBCHRR",26,0)
 ; load current remittance remark data
"RTN","FBCHRR",27,0)
 D LOADRR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHRR",28,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBCHRR",29,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBCHRR",30,0)
 S LASTDX=$$LAST^FBCHEP1(FBI,"DX"),LASTPROC=$$LAST^FBCHEP1(FBI,"PROC")
"RTN","FBCHRR",31,0)
 S (DIC,DIE)="^FBAAI(",DA=FBI,DR="[FBCH EDIT PAYMENT]"
"RTN","FBCHRR",32,0)
 D  G H^XUS:$D(DTOUT)
"RTN","FBCHRR",33,0)
 . N ICDVDT,DFN,FB583,FBAAMM1,FBAAPTC,FBCNTRA,FBCNTRP,FBV,FBVEN,FTP
"RTN","FBCHRR",34,0)
 . S ICDVDT=$$FRDTINV^FBCSV1(DA) ; date for files 80 and 80.1 identifier
"RTN","FBCHRR",35,0)
 . ; get variables for call to PPT^FBAACO1
"RTN","FBCHRR",36,0)
 . S FBAAMM1=$P($G(^FBAAI(DA,2)),U,3)
"RTN","FBCHRR",37,0)
 . S FBCNTRP=$P($G(^FBAAI(DA,5)),U,8)
"RTN","FBCHRR",38,0)
 . S FBV=$P($G(^FBAAI(DA,0)),U,3)
"RTN","FBCHRR",39,0)
 . S DFN=$P($G(^FBAAI(DA,0)),U,4)
"RTN","FBCHRR",40,0)
 . S FBAAPTC=$P($G(^FBAAI(DA,0)),U,13)
"RTN","FBCHRR",41,0)
 . S X=$P($G(^FBAAI(DA,0)),U,5)
"RTN","FBCHRR",42,0)
 . S:X[";FB583(" FB583=+X
"RTN","FBCHRR",43,0)
 . S FTP=$S(X]"":+$O(^FBAAA("AG",X,DFN,0)),1:"")
"RTN","FBCHRR",44,0)
 . S FBVEN=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,4),1:"")
"RTN","FBCHRR",45,0)
 . S FBCNTRA=$S(FTP:$P($G(^FBAAA(DFN,1,FTP,0)),U,22),1:"")
"RTN","FBCHRR",46,0)
 . D ^DIE
"RTN","FBCHRR",47,0)
 ; if adjustment data changed then file
"RTN","FBCHRR",48,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHRR",49,0)
 ; if remit remark data changed then file
"RTN","FBCHRR",50,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHRR",51,0)
 ; remove any gaps in codes
"RTN","FBCHRR",52,0)
 D RMVGAP^FBCHEP1(FBI,1)
"RTN","FBCHRR",53,0)
END K DIC,D,DA,DIRUT,DR,DTOUT,DUOUT,FBPRICE,VAL,DIE,FBI,FBN,FBNB,FBTYPE,I,POP,X,Y,FBLISTC
"RTN","FBCHRR",54,0)
 K FBFPPSC,FBFPPSL,FBADJ,FBADJL,FBRRMK,FBRRMKL
"RTN","FBCHRR",55,0)
 K LASTDX,LASTPROC
"RTN","FBCHRR",56,0)
 D END^FBCHDI
"RTN","FBCHRR",57,0)
 Q
"RTN","FBCHVH")
0^38^B31027719^B25718092
"RTN","FBCHVH",1,0)
FBCHVH ;AISC/DMK-VENDOR PAYMENT HISTORY ;7/17/2003
"RTN","FBCHVH",2,0)
 ;;3.5;FEE BASIS;**55,61,122,108**;JAN 30, 1995;Build 115
"RTN","FBCHVH",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHVH",4,0)
GETVEN K FBAANQ D GETVEN^FBAAUTL1 G END:IFN']""
"RTN","FBCHVH",5,0)
 D DATE^FBAAUTL G:FBPOP GETVEN S ZZ=9999999.9999,FBBEG=ZZ-ENDDATE,FBEND=ZZ-BEGDATE
"RTN","FBCHVH",6,0)
 I '$D(^FBAAI("AF",IFN)) W !,*7,"No invoices on line for this vendor." G GETVEN
"RTN","FBCHVH",7,0)
 S VAR="IFN^FBBEG^FBEND^BEGDATE^ENDDATE"_$S($D(FBPROG):"^FBPROG",1:""),VAL=IFN_"^"_FBBEG_"^"_FBEND_"^"_BEGDATE_"^"_ENDDATE_$S($D(FBPROG):"^"_FBPROG,1:""),PGM="START^FBCHVH" D ZIS^FBAAUTL G:FBPOP END S:IO=IO(0) FBAANQ=1
"RTN","FBCHVH",8,0)
START S:'$D(FBPROG) FBPROG=6 S FBHEAD="VENDOR",Q="",$P(Q,"=",80)="=",FBAAOUT=0 U IO D GETDAT S:$E(IOST,1,2)'["C-" FBPG=1 D HEDC
"RTN","FBCHVH",9,0)
 F FBM=FBBEG-.1:0 S FBM=$O(^FBAAI("AF",IFN,FBM)) Q:FBM'>0!(FBM>FBEND)  F FBI=0:0 S FBI=$O(^FBAAI("AF",IFN,FBM,FBI)) Q:FBI'>0!(FBAAOUT)  I $D(^FBAAI(FBI,0)),$P(^(0),"^",12)=FBPROG,'$D(^("FBREJ")) D GETINV
"RTN","FBCHVH",10,0)
 G:$D(FBAANQ) GETVEN
"RTN","FBCHVH",11,0)
END K DA,DFN,BEGDATE,ENDDATE,FBBEG,FBEND,DIC,FBAANQ,FBAAOUT,FBDX,FBI,FBIN,FBPROC,FBVEN,FBVID,IFN,J,K,L,PGM,Q,VADM,VAERR,VAL,VAR,X,Y,VA,ZZ,FBM,FBHEAD,FBPROG,FBPG,FBVINDT
"RTN","FBCHVH",12,0)
 D CLOSE^FBAAUTL Q
"RTN","FBCHVH",13,0)
GETINV ;
"RTN","FBCHVH",14,0)
 N FBADJLA,FBADJLR,FBCDAYS,FBCSID,FBFPPSC,FBFPPSL,FBRRMKL,FBY2,FBY3,FBY5,FBADMTDX,FBPOA,FBCNTRN,B
"RTN","FBCHVH",15,0)
 S FBIN=^FBAAI(FBI,0)
"RTN","FBCHVH",16,0)
 S FBY2=$G(^FBAAI(FBI,2))
"RTN","FBCHVH",17,0)
 S FBY3=$G(^FBAAI(FBI,3))
"RTN","FBCHVH",18,0)
 S FBY5=$G(^FBAAI(FBI,5))
"RTN","FBCHVH",19,0)
 F J=1,2,3,4,6,7,8,9,10,11,13,14 S FBIN(J)=$P(FBIN,"^",J)
"RTN","FBCHVH",20,0)
 S FBVINDT=$P(FBY2,"^",2) D FBCKI^FBAACCB1(FBI)
"RTN","FBCHVH",21,0)
 S FBVEN=$S($D(^FBAAV(+FBIN(3),0)):$P(^(0),"^",1),1:"") I FBVEN]"" S FBVID=$P(^(0),"^",2)
"RTN","FBCHVH",22,0)
 S DFN=FBIN(4) Q:'DFN  D DEM^VADPT
"RTN","FBCHVH",23,0)
 S Y=FBIN(2) D CDAT S FBIN(2)=Y
"RTN","FBCHVH",24,0)
 S Y=FBIN(6) D CDAT S FBIN(6)=Y,Y=FBIN(7) D CDAT S FBIN(7)=Y
"RTN","FBCHVH",25,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBCHVH",26,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBCHVH",27,0)
 S FBFPPSC=$P(FBY3,U) ; fpps claim id
"RTN","FBCHVH",28,0)
 S FBFPPSL=$P(FBY3,U,2) ; fpps line item
"RTN","FBCHVH",29,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBCHVH",30,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBCHVH",31,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBCHVH",32,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",")
"RTN","FBCHVH",33,0)
WRT I $Y+6>IOSL D HANG^FBAAUTL1:$E(IOST,1,2)["C-" Q:FBAAOUT  I $D(^FBAAI(FBI,4)) D HEDC
"RTN","FBCHVH",34,0)
 W !,$S('$D(FBIN(13)):"",FBIN(13)="R":"*",1:""),$S($G(FBCAN)]"":"+",1:"")
"RTN","FBCHVH",35,0)
 W VADM(1)_"  "_$P(VADM(2),"^",2),?48,FBCSID
"RTN","FBCHVH",36,0)
 W !,?4,FBVEN,?45,FBVID,?62,FBIN(1)
"RTN","FBCHVH",37,0)
 W !,$S(FBIN(13)["R":"*",1:""),$S(FBIN(14)]"":"#",1:"")
"RTN","FBCHVH",38,0)
 W ?4,FBFPPSC,?18,FBFPPSL,?35,FBIN(2),?46,$$DATX^FBAAUTL(FBVINDT),?57,FBIN(6),?68,FBIN(7)
"RTN","FBCHVH",39,0)
 W !?4,$J(FBIN(8),1,2),?17,$J(FBIN(9),1,2),?29,FBCDAYS
"RTN","FBCHVH",40,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBCHVH",41,0)
 W ?39,$S(FBADJLR]"":FBADJLR,1:FBIN(11))
"RTN","FBCHVH",42,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBCHVH",43,0)
 W ?49,$S(FBADJLA]"":FBADJLA,1:$J(FBIN(10),1,2))
"RTN","FBCHVH",44,0)
 W ?64,FBRRMKL
"RTN","FBCHVH",45,0)
 ;write admitting diagnosis
"RTN","FBCHVH",46,0)
 S FBADMTDX=$P(FBY5,"^",9) I FBADMTDX]"" W !?2,"Admit Dx: ",$$ICD9^FBCSV1((FBADMTDX),$P($G(FBIN),"^",6))
"RTN","FBCHVH",47,0)
 ;write contract number
"RTN","FBCHVH",48,0)
 S FBCNTRN=$S($P(FBY5,U,8):$P($G(^FBAA(161.43,$P(FBY5,U,8),0)),U),1:"")
"RTN","FBCHVH",49,0)
 I FBCNTRN]"" W ?25,"Contract Number: ",FBCNTRN
"RTN","FBCHVH",50,0)
 ;set diagnosis code and present on admission code
"RTN","FBCHVH",51,0)
 N P1,P2
"RTN","FBCHVH",52,0)
 S P1=$G(^FBAAI(FBI,"DX"))
"RTN","FBCHVH",53,0)
 S P2=$G(^FBAAI(FBI,"POA"))
"RTN","FBCHVH",54,0)
 F K=1:1:25 D WRTDX
"RTN","FBCHVH",55,0)
 ;set procedure code
"RTN","FBCHVH",56,0)
 N P5
"RTN","FBCHVH",57,0)
 S P5=$G(^FBAAI(FBI,"PROC"))
"RTN","FBCHVH",58,0)
 F L=1:1:25 D WRTPC
"RTN","FBCHVH",59,0)
 N A2 S A2=FBIN(9) D PMNT^FBAACCB2
"RTN","FBCHVH",60,0)
 Q
"RTN","FBCHVH",61,0)
WRTDX ;write dianosis code and present on admission code
"RTN","FBCHVH",62,0)
 N P3,P4
"RTN","FBCHVH",63,0)
 S FBDX=$P(P1,"^",K)
"RTN","FBCHVH",64,0)
 S FBPOA=$P(P2,"^",K)
"RTN","FBCHVH",65,0)
 Q:FBDX=""
"RTN","FBCHVH",66,0)
 S P3=$$ICD9^FBCSV1((FBDX),$P($G(FBIN),"^",6))_"/"
"RTN","FBCHVH",67,0)
 S P4=P3_$S(FBPOA:$P($G(^FB(161.94,FBPOA,0)),"^"),1:"")_" "
"RTN","FBCHVH",68,0)
 I K=1!($X+$L(P4)+2>IOM) W !,?4,"DX/POA: "
"RTN","FBCHVH",69,0)
 W P4,""
"RTN","FBCHVH",70,0)
 Q
"RTN","FBCHVH",71,0)
WRTPC ;write procedure code (if present)
"RTN","FBCHVH",72,0)
 N P6
"RTN","FBCHVH",73,0)
 S FBPROC=$P(P5,"^",L)
"RTN","FBCHVH",74,0)
 Q:FBPROC=""
"RTN","FBCHVH",75,0)
 S P6=$$ICD0^FBCSV1((FBPROC),$P($G(FBIN),"^",6))_" "
"RTN","FBCHVH",76,0)
 I L=1!($X+$L(P6)+2>IOM) W !,?4,"PROC: "
"RTN","FBCHVH",77,0)
 W P6,""
"RTN","FBCHVH",78,0)
 Q
"RTN","FBCHVH",79,0)
HEDC I $D(FBHEAD) W:'$G(FBPG) @IOF K:$G(FBPG) FBPG W ?25,FBHEAD_" PAYMENT HISTORY",!,?24,$E(Q,1,24),!?48,"Date Range: ",BEGDATE_" to "_ENDDATE
"RTN","FBCHVH",80,0)
 I '$D(FBHEAD) W:'$G(FBPG) @IOF K:$G(FBPG) FBPG W !?32,"INVOICE DISPLAY",!,?31,$E(Q,1,17),!
"RTN","FBCHVH",81,0)
 W !,"Veteran's Name",?48,"Patient Control Number"
"RTN","FBCHVH",82,0)
 W !,"('*'Reimbursement to Veteran   '+' Cancellation Activity)   '#' Voided Payment)"
"RTN","FBCHVH",83,0)
 W !,?4,"Vendor Name",?45,"Vendor ID",?59,"Invoice #"
"RTN","FBCHVH",84,0)
 ;W !,?3,"Fr Date",?14,"To Date  Claimed   Paid",?41,"Sus Code",?59,"Dt. Rec.",?69,"Inv. Date"
"RTN","FBCHVH",85,0)
 W !,?4,"FPPS Claim ID",?18,"FPPS Line Item",?35,"Date Rec.",?46,"Inv. Date",?57,"Fr Date",?68,"To Date"
"RTN","FBCHVH",86,0)
 W !,?4,"Amt Claimed",?17,"Amt Paid",?29,"Cov.Days",?39,"Adj Code",?49,"Adj Amount",?64,"Remit Remark"
"RTN","FBCHVH",87,0)
 W !,Q,!
"RTN","FBCHVH",88,0)
 Q
"RTN","FBCHVH",89,0)
CDAT S Y=$E(Y,4,5)_"/"_$S($E(Y,6,7)="00":$E(Y,2,3),1:$E(Y,6,7)_"/"_$E(Y,2,3)) Q
"RTN","FBCHVH",90,0)
GETDAT S Y=BEGDATE D PDF^FBAAUTL S BEGDATE=Y,Y=ENDDATE D PDF^FBAAUTL S ENDDATE=Y
"RTN","FBCHVH",91,0)
 Q
"RTN","FBCHVH",92,0)
PRVD ;DISPLAY PROVIDER INFORMATION BEFORE INVOICE DISPLAY FB*3.5*122
"RTN","FBCHVH",93,0)
 N FBPRI,FBSRVF,FBST
"RTN","FBCHVH",94,0)
 S FBPRI=$G(^FBAAI(FBI,4)),FBSRVF=$G(^FBAAI(FBI,5)),$P(FBSRVF,U,3)=$$GET1^DIQ(5,$P(FBSRVF,U,3)_",",1)
"RTN","FBCHVH",95,0)
 W @IOF,!?30,"INVOICE DISPLAY",!?30,"===============",!?28,"PROVIDER INFORMATION",!
"RTN","FBCHVH",96,0)
 I $L($P(FBPRI,U,1,3))>3 W !?3,"ATTENDING PROV NAME: "_$P(FBPRI,U),!?3,"ATTENDING PROV NPI: "_$P(FBPRI,U,2),?35,"ATTENDING PROV TAXONOMY CODE: "_$P(FBPRI,U,3)
"RTN","FBCHVH",97,0)
 I $L($P(FBPRI,U,4,5))>2 W !!?3,"OPERATING PROV NAME: "_$P(FBPRI,U,4),!?3,"OPERATING PROV NPI: "_$P(FBPRI,U,5)
"RTN","FBCHVH",98,0)
 I $L($P(FBPRI,U,6,8))>3 W !!?3,"RENDERING PROV NAME: "_$P(FBPRI,U,6),!?3,"RENDERING PROV NPI: "_$P(FBPRI,U,7),?35,"RENDERING PROV TAXONOMY CODE: "_$P(FBPRI,U,8)
"RTN","FBCHVH",99,0)
 I $L($P(FBPRI,U,9,10))>2 W !!?3,"SERVICING PROV NAME: "_$P(FBPRI,U,9),!?3,"SERVICING PROV NPI: "_$P(FBPRI,U,10)
"RTN","FBCHVH",100,0)
 I $L($P(FBSRVF,U,1,4))>4 W !?3,"SERVICING FACILITY ADDRESS: ",!?5,$P(FBSRVF,U),!?5,$P(FBSRVF,U,2) I $P(FBSRVF,U,2)'="" W ", "
"RTN","FBCHVH",101,0)
 W $P(FBSRVF,U,3)_" "_$P(FBSRVF,U,4)
"RTN","FBCHVH",102,0)
 I $L($P(FBPRI,U,11,12))>2 W !!?3,"REFERRING PROV NAME: "_$P(FBPRI,U,11),!?3,"REFERRING PROV NPI: "_$P(FBPRI,U,12),!!
"RTN","FBCHVH",103,0)
 S DIR(0)="E" D ^DIR
"RTN","FBCHVH",104,0)
 Q
"RTN","FBNHEA")
0^23^B9476317^B9786847
"RTN","FBNHEA",1,0)
FBNHEA ;AISC/GRR - ENTER ADMISSION TO NURSING HOME ;6/5/2009
"RTN","FBNHEA",2,0)
 ;;3.5;FEE BASIS;**82,108**;JAN 30, 1995;Build 115
"RTN","FBNHEA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBNHEA",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHEA",5,0)
 I $D(^FBAACNH("AD",DFN)) G CKVEIW
"RTN","FBNHEA",6,0)
RD0 S FBPROG="I $P(^(0),U,3)=7" D GETAUTH^FBAAUTL1 G RD1:FTP']"",RD1:$D(DUOUT),H^XUS:$D(DTOUT) I FBTYPE'=7 D WRONGT^FBAAUTL1 G RD0
"RTN","FBNHEA",7,0)
RD2 I $D(^FBAACNH("AD",DFN)) G CKVEIW
"RTN","FBNHEA",8,0)
 S FBLTD=$O(^FBAACNH("AF",DFN,0)) K:FBLTD<1 FBLTD S FBTRT="A",DIR(0)="DA^"_FBAABDT_".000001:"_FBAABDT_".999999:EXR",DIR("A")="Enter Admission Date/Time:  ",DIR("?")="Enter date pt. admitted to CNH facility (time is required)"
"RTN","FBNHEA",9,0)
 D ^DIR K DIR G:$D(DIRUT)!'Y Q S FBY=+Y D DATCK2^FBAAUTL1 G:'$D(X) RD2
"RTN","FBNHEA",10,0)
 S DIR(0)="S^1:AFTER RE-HOSPITALIZATION >15 DAYS;2:TRANSFER FROM OTHER CNH;3:FROM ASIH <15 DAYS;4:ALL OTHER",DIR("A")="Enter Admission Type" D ^DIR K DIR G:$D(DIRUT) Q S FBZ=+Y
"RTN","FBNHEA",11,0)
 K DD,DO S X=FBY,DIC="^FBAACNH(",DIE=DIC,DIC(0)="LM",DLAYGO=162.3 D FILE^DICN G RD1:$D(DUOUT)!($D(DTOUT)),RD2:Y<0 S DA=+Y K DIC,DLAYGO
"RTN","FBNHEA",12,0)
 S DR="8////^S X=FBVEN;Q;9////^S X=FTP;1////^S X=DFN;2////^S X=""A"";3////^S X=""Y"";4////^S X=DA;5////^S X=FBZ" D ^DIE I '$D(DTOUT) D PTFC^FBUTL6(DFN,FBY) I '$G(FBRCHK) G RD1
"RTN","FBNHEA",13,0)
Q K DIC,DIE,DR,DA,DFN,FBTYPE,FTP,Y,X,FBPROG,FBVEN,CNT,DAT,F,FB7078,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBAUT,FBDX,FBI,FBLOC,FBPOV,FBPSA,FBPT,I,FBRR,FBTT,PI,PTYPE,T,TA,Z,ZZ,CNT,FBAUT,TA,DIRUT,DUOUT,DTOUT,FBY,FBLTD,FBTRT
"RTN","FBNHEA",14,0)
 K FBZ,FBRCHK
"RTN","FBNHEA",15,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBNHEA",16,0)
 Q
"RTN","FBNHEA",17,0)
CKVEIW W !!,*7,"Veteran already has an active admission, you may use the edit option to edit it.",!
"RTN","FBNHEA",18,0)
 S DIR(0)="Y",DIR("A")="Want data related to active admission displayed",DIR("B")="NO" D ^DIR K DIR I Y S IFN=$O(^FBAACNH("AD",DFN,0)) D ^FBNHDEC
"RTN","FBNHEA",19,0)
 I '$G(FBRCHK) G RD1
"RTN","FBNHEA",20,0)
 Q
"RTN","FBNHED")
0^24^B10924946^B11080982
"RTN","FBNHED",1,0)
FBNHED ;AISC/GRR - ENTER DISCHARGE FROM NURSING HOME ;6/5/2009
"RTN","FBNHED",2,0)
 ;;3.5;FEE BASIS;**108**;JAN 30, 1995;Build 115
"RTN","FBNHED",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBNHED",4,0)
RD1 D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHED",5,0)
 I '$D(^FBAACNH("AD",DFN)) W !!,*7,"Veteran does NOT have an active admission!" G RD1
"RTN","FBNHED",6,0)
RD0 S FBPROG="I $P(^(0),U,3)=7" D GETAUTH^FBAAUTL1 G RD1:FTP']"",RD1:$D(DUOUT),H^XUS:$D(DTOUT) I FBTYPE'=7 D WRONGT^FBAAUTL1 G RD0
"RTN","FBNHED",7,0)
 S IFN=+$O(^FBAACNH("AD",DFN,0)),FBTRT="D",FB(0)=$G(^FBAACNH(IFN,0)),FBLAD=$P(FB(0),"^",1),FBLTD=$O(^FBAACNH("AF",DFN,0)) D ^FBNHDEC
"RTN","FBNHED",8,0)
RD2 S DIR(0)="DA^::EXR",DIR("A")="Enter Discharge Date/Time:  ",DIR("?")="Enter date of discharge (time is required)" D ^DIR K DIR G:$D(DIRUT)!'Y Q S FBY=+Y D DATCK2^FBAAUTL1 G:'$D(X) RD2
"RTN","FBNHED",9,0)
 ;check to see if enough rate info to date of discharge
"RTN","FBNHED",10,0)
 D DRIV^FBNHRAT(DFN,IFN,.FB,$P(FBY,".")) I $D(FBUNR) D  D Q G RD1
"RTN","FBNHED",11,0)
 .W !!,*7,"Unable to establish rates for the following timeframes:"
"RTN","FBNHED",12,0)
 .S J=0 F  S J=$O(FBUNR(J)) Q:'J  W !?5,$$DATX^FBAAUTL(J)," through ",$$DATX^FBAAUTL($O(FBUNR(J,0)))
"RTN","FBNHED",13,0)
 .W !!,*7,"You can not discharge this patient without sufficient rate information.",!,"Check your contract!"
"RTN","FBNHED",14,0)
 S FBJ=0 F  S FBJ=$O(^FBAACNH("AF",DFN,FBJ)) Q:'FBJ  S FBK=$O(^FBAACNH("AF",DFN,FBJ,0)) I $P($G(^FBAACNH(FBK,0)),"^",5)=IFN D  Q
"RTN","FBNHED",15,0)
 .I $P(^FBAACNH(FBK,0),"^",7)=3 S FBASIH=1
"RTN","FBNHED",16,0)
 S DIR(0)=$S($G(FBASIH):"S^4:ASIH;5:DEATH WHILE ASIH",1:"S^1:REGULAR;2:DEATH;3:TRANSFER TO OTHER CNH;6:REGULAR - PRIVATE PAY"),DIR("A")="Enter Discharge Type:  " D ^DIR K DIR G:$D(DIRUT) Q S FBZ=+Y
"RTN","FBNHED",17,0)
 K DD,DO S X=FBY,DIC="^FBAACNH(",DIE=DIC,DIC(0)="LM",DLAYGO=162.3 D FILE^DICN G RD1:$D(DUOUT)!($D(DTOUT)),RD2:Y<0 S DA=+Y K DIC,DLAYGO
"RTN","FBNHED",18,0)
 S DR="8////^S X=FBVEN;1////^S X=DFN;2////^S X=""D"";4////^S X=IFN;7////^S X=FBZ" D ^DIE K DIE
"RTN","FBNHED",19,0)
 S DIE="^FBAACNH(",DA=IFN,DR="3///@" D ^DIE
"RTN","FBNHED",20,0)
 D UPDT
"RTN","FBNHED",21,0)
 G RD1
"RTN","FBNHED",22,0)
Q K FBTRT,FBTYPE,FBLAD,FTP,FBPROG,CNT,DAT,DIC,FBAUT,F,FBAAOUT,FBDX,FBI,FBRR,FBXX,I,PI,PTYPE,T,X,Y,Z,ZZ,FBY,FB7078,FBAAAD,FBAABDT,FBAAEDT,FBASSOC,FBAT,FBLOC,FBLTD,FBPDT,FBPOV,FBY1,FBNHED,FBUNR,DFN,IFN,FBASIH,FBJ,FBK
"RTN","FBNHED",23,0)
 K FBPSA,FBPT,FBTT,FBVEN D Q^FBNHRAT D GETAUTHK^FBAAUTL1 Q
"RTN","FBNHED",24,0)
UPDT S DA(1)=DFN,FBY1=$P(FBY,".")
"RTN","FBNHED",25,0)
 S DIE="^FBAAA("_DA(1)_",1,",DR=".02////^S X=FBY1",DA=FTP D ^DIE K DIE,DR
"RTN","FBNHED",26,0)
 K DA S DIE="^FB7078(",DR="4////^S X=FBY1",DA=FB7078 D ^DIE K DIE,DR
"RTN","FBNHED",27,0)
 ;update rate sensitive file since To Date of authorization is changed
"RTN","FBNHED",28,0)
 Q:FBY1>FBAAEDT
"RTN","FBNHED",29,0)
 S (FBO,FBAA(1))=FBAABDT,FB1=FBAAEDT,FBAA(2)=FBY1
"RTN","FBNHED",30,0)
 D UPDATE^FBNHEDA1
"RTN","FBNHED",31,0)
 K FBO,FBAA,FB1,FBZ
"RTN","FBNHED",32,0)
 Q
"RTN","FBNHEDAT")
0^25^B13901461^B13820385
"RTN","FBNHEDAT",1,0)
FBNHEDAT ;AISC/GRR - ENTER/EDIT AUTHORIZATION ;6/5/2009
"RTN","FBNHEDAT",2,0)
 ;;3.5;FEE BASIS;**103,108**;JAN 30, 1995;Build 115
"RTN","FBNHEDAT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBNHEDAT",4,0)
 D SITEP^FBAAUTL
"RTN","FBNHEDAT",5,0)
RD1 S U="^" D GETVET^FBAAUTL1 G:DFN="" END
"RTN","FBNHEDAT",6,0)
 S FBPROG="I $P(^(0),U,3)=7" D GETAUTH^FBAAUTL1 G RD1:'CNT!(FTP']"")!($D(DIRUT)) S (FBOLD,FBNEW,FBERR)=""
"RTN","FBNHEDAT",7,0)
 K FBAUT,CNT S (DA(1),D0)=DFN,FBOLD=^FBAAA(DFN,1,FTP,0),DA=FTP,FBAAADA=DA,DIE="^FBAAA("_DFN_",1,",FBO=$P(FBOLD,"^"),(FB1,FBAA(2))=$P(FBOLD,"^",2)
"RTN","FBNHEDAT",8,0)
 S FBPROG=7 D DATES^FBAAUTL2 S FBAA(1)=$S($G(FBBEGDT):FBBEGDT,1:FBO),FBAA(2)=$S($G(FBENDDT):FBENDDT,1:FB1)
"RTN","FBNHEDAT",9,0)
DR S DR=".01////^S X=FBAA(1);.02////^S X=FBAA(2)"
"RTN","FBNHEDAT",10,0)
 ; fb*3.5*103  add REFERRING PROVIDER (161.01,104) to DR string
"RTN","FBNHEDAT",11,0)
 S DR(1,161.01,1)="@2;.065;.07;.021;.08;S:X="""" Y=101;.085;S:X="""" Y=101;.086;101;104;.097" D ^DIE
"RTN","FBNHEDAT",12,0)
 S FBNEW=$S('$D(DA):"",'$D(^FBAAA(DFN,1,DA,0)):"",1:^(0)) K DR
"RTN","FBNHEDAT",13,0)
 I $D(Y)>0,FBNEW=""!(FBNEW=FBOLD) G RD1
"RTN","FBNHEDAT",14,0)
 I FBNEW'=FBOLD,$P(FBNEW,"^")>$P(FBNEW,"^",2) S DR=".01////^S X=FBO;.02////^S X=FB1" D ^DIE K DR D ER G DR
"RTN","FBNHEDAT",15,0)
 ;
"RTN","FBNHEDAT",16,0)
 S FBAA78=FB7078 D ^FBNHEDA1 K FBAA78 I FBERR S DA(1)=DFN,DA=FTP,DIE="^FBAAA("_DA(1)_",1,",DR=".01////^S X=FBO;.02////^S X=FB1" D ^DIE G END
"RTN","FBNHEDAT",17,0)
 ; fb*3.5*103  add the REFERRING PROVIDER (162.4,15) to the DR string; stuff with the value stored at 161.01,104
"RTN","FBNHEDAT",18,0)
 S DIE="^FB7078(",DA=FB7078,FBAA78=DA,DR="5;6;15////^S X=$$GET1^DIQ(161.01,FBAAADA_"",""_DFN,104,""I"")" I 'DA W !!,*7,"No 7078 on file!",! G END
"RTN","FBNHEDAT",19,0)
 D:FBOLD'=FBNEW CHANGED
"RTN","FBNHEDAT",20,0)
GO D ^DIE
"RTN","FBNHEDAT",21,0)
 I $O(^FBAAA(DFN,1,FBAAADA,2,0))>0 K ^FB7078(FBAA78,1) S ^FB7078(FBAA78,1,0)=^FBAAA(DFN,1,FBAAADA,2,0) F Z=0:0 S Z=$O(^FBAAA(DFN,1,FBAAADA,2,Z)) Q:Z'>0  S ^FB7078(FBAA78,1,Z,0)=^FBAAA(DFN,1,FBAAADA,2,Z,0)
"RTN","FBNHEDAT",22,0)
RD2 S DIR(0)="Y",DIR("A")="Want to Queue 7078 for printing",DIR("B")=$S(FBOLD=FBNEW:"No",1:"Yes") D ^DIR K DIR G:Y'>0 RD1
"RTN","FBNHEDAT",23,0)
CHEKP78 S FBNUM=$P(FBSITE(1),"^",5),FBO=$P(FBSITE(1),"^",7),FBT=$P(FBSITE(1),"^",8) D FBO^FBCHP78 G END:$D(DIRUT) S IOP="Q",%ZIS("B")="",FB7078=FBAA78,FB("SITE")=$P(FBSITE(1),"^",3) W !
"RTN","FBNHEDAT",24,0)
 S VAR="FB7078^FBNUM^FBO^FBT^FB(""SITE"")",VAL=FB7078_"^"_FBNUM_"^"_FBO_"^"_FBT_"^"_FB("SITE"),PGM="START^FBCHP78" W ! D ZIS^FBAAUTL
"RTN","FBNHEDAT",25,0)
 ;
"RTN","FBNHEDAT",26,0)
END K D0,DA,FBAASKV,FBAADDYS,FBAALT,FBAAP79,FBAATT,FBNUM,FBDEV,FBO,FBT,FB7078,FBAA78,FBCOUNTY,FBDX,FBI,FBRR,FBVEN,FBTYPE,FBXX,I,J,K,PI,FBOLD,FBNEW,FBPSADF,FBAADA,FB1,FBERR,FBOUT,FBIFN,FBZ,FBBEGDT,FBENDDT,FBAUT
"RTN","FBNHEDAT",27,0)
 K DIE,DIR,FBAAADA,FTP,PGM,VAL,VAR,X,Y,Z,DIC,A,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBLOC,FBPOV,FBPROG,FBPSA,FBPT,FBSITE,FBTT,PTYPE,T,ZZ,FB("SITE"),FBPOP,FBAA,FBBDT,FBTDAYS,HOLDX
"RTN","FBNHEDAT",28,0)
 D END^FBNHEAU1
"RTN","FBNHEDAT",29,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBNHEDAT",30,0)
 D CLOSE^FBAAUTL
"RTN","FBNHEDAT",31,0)
 Q
"RTN","FBNHEDAT",32,0)
 ;
"RTN","FBNHEDAT",33,0)
CHANGED S:$P(FBOLD,"^",1)'=$P(FBNEW,"^",1) DR="3////^S X=$P(FBNEW,U,1);"_DR
"RTN","FBNHEDAT",34,0)
 S:$P(FBOLD,"^",2)'=$P(FBNEW,"^",2) DR="4////^S X=$P(FBNEW,U,2);"_DR
"RTN","FBNHEDAT",35,0)
 Q
"RTN","FBNHEDAT",36,0)
 ;
"RTN","FBNHEDAT",37,0)
ER W !,*7,"From Date cannot be greater than the To Date.",!
"RTN","FBNHEDAT",38,0)
 Q
"RTN","FBNHEDAT",39,0)
 ;
"RTN","FBNHEDAT",40,0)
ER1 W !,*7,"This patient has movements after the authorization to date.  You must",!,"edit the patient's movements first.",!
"RTN","FBNHEDAT",41,0)
 Q
"RTN","FBNHEP")
0^14^B33126997^B30246134
"RTN","FBNHEP",1,0)
FBNHEP ;AISC/GRR - ENTER NURSING HOME PAYMENT ;12/18/2000
"RTN","FBNHEP",2,0)
 ;;3.5;FEE BASIS;**25,108**;JAN 30, 1995;Build 115
"RTN","FBNHEP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBNHEP",4,0)
 I '$D(^FBAA(161.7,"AB","O",DUZ)) G NOBAT^FBNHEP2
"RTN","FBNHEP",5,0)
 S FBOUT=1 F I=0:0 S I=$O(^FBAA(161.7,"AB","O",DUZ,I)) Q:I'>0  I $D(^FBAA(161.7,I,0)),$P(^(0),"^",3)="B9",$P(^(0),"^",15)="" S FBOUT=0 Q
"RTN","FBNHEP",6,0)
 G:FBOUT NOBAT^FBNHEP2
"RTN","FBNHEP",7,0)
 D GETBAT^FBNHEP2 G Q:FBOUT!('$D(FBBAT)) W !
"RTN","FBNHEP",8,0)
 ;
"RTN","FBNHEP",9,0)
RD S FBAAPTC="V",FBER=0,%DT="AEPMX",%DT("A")="Payments for which Month/Year: " D ^%DT G:X="^"!(X="") Q
"RTN","FBNHEP",10,0)
 S FBPAYDT=$E(+Y,1,5)_"00",FBMM=$E(+Y,4,5),FBYY=$E(+Y,2,3),X=+Y S FBDAYS=$$DAYS^FBNHEP1(X),(FBENDDT,FBPAYEDT)=$E(+Y,1,5)_FBDAYS
"RTN","FBNHEP",11,0)
 ;
"RTN","FBNHEP",12,0)
GETVET K FB,FB7078,FBAABDT,FBAAEDT,FBASSOC,FBAT,FBAUT,FBBEG,FBDEFP,FBEND,FBHI,FBPDT,FBPOV,FBPREV,FBPROG,FBPRTR,FBPSA,FBPT,FBRIFN,FBTRDYS,FBTT,FBTYPE,FBVEN,FBZ,FTP,IFN,FBAAID,FBAAVID
"RTN","FBNHEP",13,0)
 ; check batch for room before next patient added
"RTN","FBNHEP",14,0)
 S FBX=FBAAMPI-$$B9INVC^FBNHEP2(FBBAT)
"RTN","FBNHEP",15,0)
 I FBX'>0 D  G Q
"RTN","FBNHEP",16,0)
 . W !!,"This Batch already has the maximum number of Payments!"
"RTN","FBNHEP",17,0)
 I FBX'>5 D
"RTN","FBNHEP",18,0)
 . W !,$C(7),"Warning, you can only enter ",FBX," more invoices in this batch!",!
"RTN","FBNHEP",19,0)
 K FBX
"RTN","FBNHEP",20,0)
 ;
"RTN","FBNHEP",21,0)
 S FBENDDT=$E(+FBENDDT,1,5)_$$DAYS^FBNHEP1(FBENDDT) D GETVET^FBAAUTL1 G:DFN']"" Q S FBPROG="I $P(^(0),U,3)=7,($P(^(0),U,9)'[""FB583"")" D GETAUTH^FBAAUTL1 G GETVET:FTP']"",GETVET:$D(DIRUT) K FBAAOUT
"RTN","FBNHEP",22,0)
 I $E(FBPAYDT,1,5)<$E(FBAABDT,1,5)!($E(FBPAYDT,1,5)>$E(FBAAEDT,1,5)) W !!,*7,"Payment Period is NOT within the veterans authorized dates!" G GETVET
"RTN","FBNHEP",23,0)
 ;
"RTN","FBNHEP",24,0)
GETVEN S FBERR=0,IFN=$G(FBVEN) D:'IFN GETVEN^FBAAUTL1 G:IFN'>0 Q S FBENDFLG=$S(FBAAEDT'>FBENDDT:1,1:""),FBENDDT=$S(FBENDDT>FBAAEDT:FBAAEDT,1:FBENDDT)
"RTN","FBNHEP",25,0)
 I $P($G(^FBAAV(+IFN,"ADEL")),U)="Y" W !!,*7,"Vendor is flagged for Austin deletion!",! G Q
"RTN","FBNHEP",26,0)
 K FB D CKRAT^FBNHEP2 G:FBERR GETVET
"RTN","FBNHEP",27,0)
 I $D(^FBAAI("AA",IFN,DFN,$E(FBPAYDT,1,5))) S FBINA=$O(^FBAAI("AA",IFN,DFN,$E(FBPAYDT,1,5),0)) W !!,*7,"Invoice (# ",FBINA,") already exists for treatment provided in the",!,"month and year selected.",! G CHKAHD
"RTN","FBNHEP",28,0)
 ;
"RTN","FBNHEP",29,0)
LETSGO D GETACT G:FBERR GETVET
"RTN","FBNHEP",30,0)
 D:$D(FBNOAC) CALC^FBNHEP2 G:FBERR GETVET
"RTN","FBNHEP",31,0)
 ;
"RTN","FBNHEP",32,0)
ADDMOR I '$D(FBNOAC) D DAYS^FBNHEP2,CALC1^FBNHEP2
"RTN","FBNHEP",33,0)
 I FBTRDYS>0 W !!!,"Amount based on ",FBTRDYS," days of care."
"RTN","FBNHEP",34,0)
 W !!,"    Total Amount calculated is: $",$J(FBDEFP,7,2),!
"RTN","FBNHEP",35,0)
 ;
"RTN","FBNHEP",36,0)
RD3 S DIR(0)="Y",DIR("A")="Want to Continue with Payment Entry",DIR("B")="YES" D ^DIR K DIR G ^FBNHEP1:Y,GETVET
"RTN","FBNHEP",37,0)
 ;
"RTN","FBNHEP",38,0)
GETACT D HED^FBNHDEC S (FBTRDYS,FBTRDYS(2))=0,FBPRTR="",FBNAC=$O(^FBAACNH("AG",DFN,FBVEN,$S(FBAABDT>(FBPAYDT+1):FBAABDT,1:FBPAYDT))) G:FBNAC'>0!($P(FBNAC,".")>FBENDDT) NOAC
"RTN","FBNHEP",39,0)
 ;
"RTN","FBNHEP",40,0)
 S FBRIFN=$O(^FBAACNH("AG",DFN,FBVEN,FBNAC,0)),Z=$G(^FBAACNH(FBRIFN,0)) Q:Z=""
"RTN","FBNHEP",41,0)
 I '$D(FBPNAC),$P(Z,"^",3)="T"&($P(Z,"^",7)<4) D
"RTN","FBNHEP",42,0)
 .S FBHZ=Z D GETPRV S Z=FBPRTR Q:Z=""  D DISPAC S Z=FBHZ,FBPNAC=FBPAYDT+1 D
"RTN","FBNHEP",43,0)
 ..S FBTRDYS=FBTRDYS+(($P(FBNAC,".")-FBPNAC)),FBTRDYS=$S(FBTRDYS>0:FBTRDYS,((FBAABDT<FBAAEDT)&(+$E(FBAAEDT,6,7)=1)):0,1:1)
"RTN","FBNHEP",44,0)
 S FBPNAC=FBNAC,FBCOUNT=$S($P(Z,"^",3)="A":1,$P(Z,"^",3)="T":$S($P(Z,"^",7)>3:1,1:0),1:0) S FBLTT=$P(Z,"^",3) D:FBLTT'="D" DISPAC G:$P(Z,"^",3)'="D" CONT
"RTN","FBNHEP",45,0)
 S FBHZ=Z D GETPRV S Z=FBPRTR G:FBPRTR="" GETVET D DISPAC S Z=FBHZ D DISPAC I $P(FBPRTR,"^",3)="T"&($P(FBPRTR,"^",7)<4) G SKIPC
"RTN","FBNHEP",46,0)
 S FBTRDYS=FBTRDYS+($P(FBNAC,".",1)-FBPAYDT)-1,FBTRDYS=$S(FBTRDYS>0:FBTRDYS,((FBAABDT<FBAAEDT)&(+$E(FBAAEDT,6,7)=1)):0,1:1)
"RTN","FBNHEP",47,0)
 ;
"RTN","FBNHEP",48,0)
SKIPC S FBCOUNT=0
"RTN","FBNHEP",49,0)
 ;
"RTN","FBNHEP",50,0)
CONT F I=0:0 S FBNAC=$O(^FBAACNH("AG",DFN,FBVEN,FBNAC)) Q:FBNAC'>0!($P(FBNAC,".")>FBENDDT)  S FBRIFN=$O(^FBAACNH("AG",DFN,FBVEN,FBNAC,0)) I $D(^FBAACNH(FBRIFN,0)) S Z=^(0),FBLTT=$P(Z,"^",3) D MORE
"RTN","FBNHEP",51,0)
 I FBCOUNT S FBTRDYS=FBTRDYS+(FBENDDT-$P(FBPNAC,".",1))+$S(FBLTT="D":0,FBLTT="T":$S($P(Z,"^",7)<4:0,1:1),1:1),FBTRDYS=$S(FBTRDYS>0:FBTRDYS,((FBAABDT<FBAAEDT)&(+$E(FBAAEDT,6,7)=1)):0,1:1)
"RTN","FBNHEP",52,0)
 G ENDACT
"RTN","FBNHEP",53,0)
 ;
"RTN","FBNHEP",54,0)
MORE D DISPAC S FBTRDYS=FBTRDYS+($P(FBNAC,".",1)-$P(FBPNAC,".",1)+$S(FBLTT="D":0,FBLTT="T":$S($P(Z,"^",7)<4:0,1:1),1:1)),FBTRDYS=$S(FBTRDYS>0:FBTRDYS,((FBAABDT<FBAAEDT)&(+$E(FBAAEDT,6,7)=1)):0,1:1)
"RTN","FBNHEP",55,0)
AHEAD S FBPNAC=FBNAC,FBLTT=$P(Z,"^",3),FBCOUNT=$S(FBLTT="A":1,FBLTT="T":$S($P(Z,"^",7)>3:1,1:0),1:0)
"RTN","FBNHEP",56,0)
 Q
"RTN","FBNHEP",57,0)
ENDACT K FBCOUNT,FBNAC,FBPNAC,FBLTT Q
"RTN","FBNHEP",58,0)
 ;
"RTN","FBNHEP",59,0)
GETPRV S FBPRTR="",FBPREV=$O(^FBAACNH("AF",DFN,(9999999-FBPAYDT))) G:FBPREV'>0 PROB^FBNHEP1 S (FBPIFN,FBRIFN)=$O(^(FBPREV,0)),FBPRTR=$G(^FBAACNH(FBPIFN,0))
"RTN","FBNHEP",60,0)
 Q
"RTN","FBNHEP",61,0)
 ;
"RTN","FBNHEP",62,0)
NOAC D GETPRV G:FBPRTR="" ENDACT S Z=FBPRTR,FBNOAC=1
"RTN","FBNHEP",63,0)
 W !!,"No movements during payment period. Last transaction prior was:",! D DISPAC
"RTN","FBNHEP",64,0)
 I $P(Z,"^",3)="D" W !,*7,"Veteran not provided care during Payment Period!" G ENDACT
"RTN","FBNHEP",65,0)
 I $P(Z,"^",3)="T"&($P(Z,"^",7)<4) W !,*7,"Veteran has not been in Nursing Home during Payment Period" G ENDACT
"RTN","FBNHEP",66,0)
 S FBTRDYS=$E(FBENDDT,6,7)-$G(FBENDFLG) G ENDACT
"RTN","FBNHEP",67,0)
 ;
"RTN","FBNHEP",68,0)
DISPAC S Y=$P(Z,"^"),FBTYPE=$P(Z,"^",3) D PDATE^FBAAUTL,ADD^FBNHDEC:FBTYPE="A",TRAN^FBNHDEC:FBTYPE="T",DIS^FBNHDEC:FBTYPE="D"
"RTN","FBNHEP",69,0)
 S FBZ(FBRIFN)=$P($P(Z,"^"),".")_"^"_$S($P(Z,U,3)="A":1,$P(Z,U,3)="T":$S($P(Z,U,7)>3:1,1:0),1:0)
"RTN","FBNHEP",70,0)
 Q
"RTN","FBNHEP",71,0)
 ;
"RTN","FBNHEP",72,0)
Q K %DT,FBAAAD,FBAT,FBBDT,FBIFN,FBPDT,FBTDAYS,FBPAYEDT,PSA,DIRUT,DUOUT,DTOUT,FBNOAC,FB,FBZ,FBZZ,FBDEFP,FBBEG,FBEND,FBHI,FBX1,FBAMTP,FBNHAC,DFN,FB583,FBENDFLG
"RTN","FBNHEP",73,0)
 K FBAAMPI
"RTN","FBNHEP",74,0)
 G Q^FBNHEP2
"RTN","FBNHEP",75,0)
 ;
"RTN","FBNHEP",76,0)
CHKAHD S DIR(0)="Y",DIR("A")="Do you want to continue entering this payment",DIR("B")="No" D ^DIR K DIR G GETVET:Y=0,GETVET:$D(DIRUT),LETSGO
"RTN","FBNHEP",77,0)
 Q
"RTN","FBNHEP2")
0^13^B25872550^B22842182
"RTN","FBNHEP2",1,0)
FBNHEP2 ;AISC/GRR - ENTER NURSING HOME PAYMENT ;7/1/2009
"RTN","FBNHEP2",2,0)
 ;;3.5;FEE BASIS;**108**;JAN 30, 1995;Build 115
"RTN","FBNHEP2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBNHEP2",4,0)
NOBAT W !!,*7,"You do not have an open CNH Batch.  You must have an open",!,"CNH type Batch before you can enter a payment!",!
"RTN","FBNHEP2",5,0)
 D Q
"RTN","FBNHEP2",6,0)
 Q
"RTN","FBNHEP2",7,0)
 ;
"RTN","FBNHEP2",8,0)
GETBAT ;
"RTN","FBNHEP2",9,0)
 S FBAAMPI=$P($G(^FBAA(161.4,1,"FBNUM")),"^",5) ; max lines CNH batch
"RTN","FBNHEP2",10,0)
 I FBAAMPI'>0 S FBAAMPI=61
"RTN","FBNHEP2",11,0)
 S FBOUT=0,DIC="^FBAA(161.7,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,3)=""B9""&($P(^(0),U,5)=DUZ)&($P(^(0),U,15)="""")&($G(^(""ST""))=""O"")" W ! D ^DIC K DIC
"RTN","FBNHEP2",12,0)
 I X=""!(X="^") S FBOUT=1 Q
"RTN","FBNHEP2",13,0)
 G GETBAT:Y<0
"RTN","FBNHEP2",14,0)
 I $$B9INVC(+Y)>(FBAAMPI-1) D  G GETBAT
"RTN","FBNHEP2",15,0)
 . W !!,"This Batch already has the maximum number of Payments!"
"RTN","FBNHEP2",16,0)
 S FBBAT=+Y,FBCNH=1
"RTN","FBNHEP2",17,0)
 Q
"RTN","FBNHEP2",18,0)
Q K FBYY,FBMM,FBDAYS,FBPAYDT,FBENDDT,Z,Y,DIC,FBRIFN,CNT,%DT,FBAABDT,FBAAEDT,FBAAPTC,FBDEFP,FBER,FBERR,FBHZ,FBINA,FBIRAT,FBPIFN,FBPREV,FBPROG,FBPRTR,FBSRAT,FBTRDYS,FBTYPE,FBVCAR,I,IFN,VAL,X,DA,DIE,DR,FBAAID,FBAAIN,FBNL,FBI7078,FBBAT,FBOUT
"RTN","FBNHEP2",19,0)
 K DAT,F,FBAUT,FBDX,FBEDT,FBI,FBMULT,FBRR,FBTDT,FBXX,FTP,PI,PTYPE,T,ZZ,FB7078,FBAAOUT,FBASSOC,FBLOC,FBPOV,FBPSA,FBPT,FBTT,FBVEN,TA,FBCNH
"RTN","FBNHEP2",20,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBNHEP2",21,0)
 Q
"RTN","FBNHEP2",22,0)
 ;
"RTN","FBNHEP2",23,0)
CKRAT ;check rates and fill gaps if needed
"RTN","FBNHEP2",24,0)
 K FB S FBERR=0 N I,J,FBVIEN,FBCHFDT,FBCHTDT,FBCIEN,FBCNUM,FBDDT,FBEXDT,FBEXNDT,FBFND,FBRFDT,FBRTDT,FBRT,FBUNR S I=0
"RTN","FBNHEP2",25,0)
 F  S I=$O(^FBAA(161.23,"AC",FB7078,I)) Q:'I  I $D(^FBAA(161.23,I,0)) S J=^(0) D
"RTN","FBNHEP2",26,0)
 .S FBRT($P(J,U))=$P(J,U,5)_"^"_$P(J,U,2)
"RTN","FBNHEP2",27,0)
 S FBRFDT=0,FBCHFDT=$S(FBAABDT<FBPAYDT:$E(FBPAYDT,1,5)_"01",1:FBAABDT),(FBCHTDT,FBDDT)=FBENDDT,I=DFN,FBVIEN=IFN
"RTN","FBNHEP2",28,0)
 D GETRAT^FBNHRAT,CKFRDT^FBNHRAT
"RTN","FBNHEP2",29,0)
 I $D(FBUNR) S FBERR=1 D ERR K FB Q
"RTN","FBNHEP2",30,0)
 D GETRAT
"RTN","FBNHEP2",31,0)
 Q
"RTN","FBNHEP2",32,0)
GETRAT N I,J,FBCK S I=0
"RTN","FBNHEP2",33,0)
 F  S I=$O(^FBAA(161.23,"AC",FB7078,I)) Q:'I  I $D(^FBAA(161.23,I,0)) S J=^(0) D
"RTN","FBNHEP2",34,0)
 .S FB($P(J,U,2))=$P(J,U,5)_"^"_$P(J,U)
"RTN","FBNHEP2",35,0)
 I $O(FB(FBPAYDT+.9))="" S FBERR=1 D ERR Q
"RTN","FBNHEP2",36,0)
 Q
"RTN","FBNHEP2",37,0)
 ;
"RTN","FBNHEP2",38,0)
CALC ;get dollar amount to pay when no movements in month.
"RTN","FBNHEP2",39,0)
 ;FBPAYS=# of days in month
"RTN","FBNHEP2",40,0)
 ;FBTRDYS=# of treatment days
"RTN","FBNHEP2",41,0)
 ;FBPAYDT=month of payment
"RTN","FBNHEP2",42,0)
 ;FBENDDT=last day of payment month or last day of authorization
"RTN","FBNHEP2",43,0)
 S FBDEFP=0 N FBCT S FBCT=0
"RTN","FBNHEP2",44,0)
 I $G(FBDAYS) S FBTRDYS=$S(FBTRDYS>FBDAYS:FBDAYS,1:FBTRDYS)
"RTN","FBNHEP2",45,0)
 S X=$S(FBAABDT>(FBPAYDT):FBAABDT-1,1:FBPAYDT)
"RTN","FBNHEP2",46,0)
 S Y=$O(FB(X)) I FBENDDT'>Y S FBDEFP=FBTRDYS*+FB(Y) Q
"RTN","FBNHEP2",47,0)
RATE S X1=$O(FB(X)),FBCT=FBCT+1 I 'X1 S FBERR=1 Q
"RTN","FBNHEP2",48,0)
 S FBX1=($S(X1>(FBENDDT-$G(FBENDFLG)):(FBENDDT-$G(FBENDFLG)),1:X1)-X) S:FBCT'>0 FBX1=FBX1+1 S FBDEFP=FBDEFP+(FBX1*$P(FB(X1),U)) S X=X1
"RTN","FBNHEP2",49,0)
 I FBENDDT>X G RATE
"RTN","FBNHEP2",50,0)
 Q
"RTN","FBNHEP2",51,0)
 ;
"RTN","FBNHEP2",52,0)
ERR W !,"Insufficient Authorization Rate data on file for patient: ",$$NAME^FBCHREQ2(DFN) ;,!,"Use the Edit Authorization option prior to entering payment.",!!
"RTN","FBNHEP2",53,0)
 W !,"Take the appropriate action prior to entering a payment:"
"RTN","FBNHEP2",54,0)
 W !?3,"Use the Edit Authorization option to modify the authorization period or",!?3,"assure a contract with valid rates exists for the payment period before",!?8,"continuing with this payment entry.",!!
"RTN","FBNHEP2",55,0)
 Q
"RTN","FBNHEP2",56,0)
 ;calculate dollars when at least one movement in month.
"RTN","FBNHEP2",57,0)
CALC1 S (I,J,Z,FBDEFP)=0
"RTN","FBNHEP2",58,0)
 F  S J=$O(FBZZ(J)) Q:'J  D
"RTN","FBNHEP2",59,0)
 .S I=$O(FBZZ(0)) Q:'I  D
"RTN","FBNHEP2",60,0)
 ..F  Q:'$D(FBZZ(I))  S X=$P(FBZZ(I),"^"),Y=$O(FB(X-.1)),X1=$O(FB(X-.1)) Q:'Y  D
"RTN","FBNHEP2",61,0)
 ...I $P(FBZZ(I),"^",2)>Y S Z=1 D DEFP S Z=0 S $P(FBZZ(I),"^")=Y+1 Q
"RTN","FBNHEP2",62,0)
 ...S Y=$P(FBZZ(I),"^",2) D DEFP K FBZZ(I)
"RTN","FBNHEP2",63,0)
 K I,J,X,Y,X1 Q
"RTN","FBNHEP2",64,0)
 ;
"RTN","FBNHEP2",65,0)
DEFP S FBDEFP=FBDEFP+(($S(FBAABDT=FBAAEDT:1,1:Y-X)+$P(FBZZ(I),"^",3)+Z)*+FB(X1))
"RTN","FBNHEP2",66,0)
 Q
"RTN","FBNHEP2",67,0)
 ;
"RTN","FBNHEP2",68,0)
DAYS S (I,FBTRDYS)=0 K FBPREV,FBHI
"RTN","FBNHEP2",69,0)
 S FBBEG=FBPAYDT+1
"RTN","FBNHEP2",70,0)
 F  S I=$O(FBZ(I)) Q:'I  D
"RTN","FBNHEP2",71,0)
 .I '$D(FBPREV),$P(FBZ(I),U,2) S FBBEG=$S($P(FBZ(I),U)>FBPAYDT:$P(FBZ(I),U),1:FBPAYDT),FBPREV=1
"RTN","FBNHEP2",72,0)
 .I '$P(FBZ(I),U,2),$S('$D(FBHI):1,1:$P(FBZ(+FBHI),U,2)) S FBEND=$P(FBZ(I),U),FBTRDYS=FBTRDYS+($S(FBEND-FBBEG:FBEND-FBBEG,((FBAABDT<FBAAEDT)&(+$E(FBAAEDT,6,7)=1)):0,1:1))+$P(FBZ(I),U,2) S FBZZ(I)=FBBEG_"^"_FBEND
"RTN","FBNHEP2",73,0)
 .I $D(FBHI),$P(FBZ(I),U,2) S FBBEG=$P(FBZ(I),U)
"RTN","FBNHEP2",74,0)
 .S FBHI=I
"RTN","FBNHEP2",75,0)
 I FBENDDT>$P(FBZ(FBHI),U),$P(FBZ(FBHI),U,2) S FBTRDYS=FBTRDYS+($S(FBENDDT-FBBEG:FBENDDT-FBBEG,1:1))+1,$P(FBZZ(FBHI),U,3)=1 I '+FBZZ(FBHI) S $P(FBZZ(FBHI),"^",1,2)=FBBEG_"^"_FBENDDT
"RTN","FBNHEP2",76,0)
 I FBENDDT=$P(FBZ(FBHI),U),$P(FBZ(FBHI),U,2) S FBTRDYS=FBTRDYS+1 I '+$G(FBZZ(FBHI)) S $P(FBZZ(FBHI),"^",1,2)=FBBEG_"^"_FBENDDT
"RTN","FBNHEP2",77,0)
 Q
"RTN","FBNHEP2",78,0)
CHECK N FBCK,FBCK1
"RTN","FBNHEP2",79,0)
 S FBCK=$S(FBABD<FBPAYDT:($E(FBPAYDT,1,5)_"01"),1:FBABD),FBCK1=$O(FB(FBCK-.1)) I $P(FB(FBCK1),"^",2)>FBCK S FBERR=1 D ERR Q
"RTN","FBNHEP2",80,0)
 Q
"RTN","FBNHEP2",81,0)
B9INVC(FBBAT) ; B9 Batch Invoice Count
"RTN","FBNHEP2",82,0)
 ; Input
"RTN","FBNHEP2",83,0)
 ;   FBBAT = IEN of B9 type batch in file 161.7
"RTN","FBNHEP2",84,0)
 ; Returns count of invoices in batch
"RTN","FBNHEP2",85,0)
 N FBCNT,FBDA
"RTN","FBNHEP2",86,0)
 S FBCNT=0
"RTN","FBNHEP2",87,0)
 I $G(FBBAT) D
"RTN","FBNHEP2",88,0)
 . S FBDA=0
"RTN","FBNHEP2",89,0)
 . F  S FBDA=$O(^FBAAI("AC",FBBAT,FBDA)) Q:'FBDA  S:$D(^FBAAI(FBDA,0)) FBCNT=FBCNT+1
"RTN","FBNHEP2",90,0)
 Q FBCNT
"RTN","FBNHET")
0^26^B9055754^B9172247
"RTN","FBNHET",1,0)
FBNHET ;AISC/GRR - ENTER TRANSFER FOR NURSING HOME ;6/16/2009
"RTN","FBNHET",2,0)
 ;;3.5;FEE BASIS;**108**;JAN 30, 1995;Build 115
"RTN","FBNHET",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBNHET",4,0)
RD1 D Q,GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBNHET",5,0)
 I '$D(^FBAACNH("AD",DFN)) W !!,*7,"Veteran does NOT have an active admission!" G RD1
"RTN","FBNHET",6,0)
RD0 S FBPROG="I $P(^(0),U,3)=7" D GETAUTH^FBAAUTL1 G RD1:FTP']"",RD1:$D(DUOUT),H^XUS:$D(DTOUT) I FBTYPE'=7 D WRONGT^FBAAUTL1 G RD0
"RTN","FBNHET",7,0)
 S IFN=$O(^FBAACNH("AD",DFN,0)),FBTRT="T",FBLTD=$O(^FBAACNH("AF",DFN,0)),FBIFN=$O(^FBAACNH("AF",DFN,FBLTD,0)),FBLTT=$P(^FBAACNH(FBIFN,0),"^",3),FBLTTYP=$S(FBLTT'="T":"",1:$P(^(0),"^",7))
"RTN","FBNHET",8,0)
 ;
"RTN","FBNHET",9,0)
RD2 D ^FBNHDEC
"RTN","FBNHET",10,0)
 W ! S DIR(0)="DA^::EXR",DIR("A")="Enter Transfer Date/Time: ",DIR("?")="Enter date of transfer (time is required)" D ^DIR K DIR G:$D(DIRUT)!('Y) RD1
"RTN","FBNHET",11,0)
 I $D(FBTRT),$D(FBLTD),(9999999.999999-Y)'<FBLTD D  G RD2:'$G(X)
"RTN","FBNHET",12,0)
 .  W !,*7,"The date/time must follow an existing movement.",! H 2
"RTN","FBNHET",13,0)
 .  K X
"RTN","FBNHET",14,0)
 S FBY=+Y
"RTN","FBNHET",15,0)
 S DIR(0)="S^1:TO AUTHORIZED ABSENCE;2:TO UN-AUTHORIZED ABSENCE;3:TO ASIH"
"RTN","FBNHET",16,0)
 S DIR(0)=$S('$G(FBLTTYP):DIR(0),FBLTTYP<4:"S^"_$P($T(TRANS+(3+FBLTTYP)),";;",2),1:DIR(0))
"RTN","FBNHET",17,0)
 S DIR("A")="Enter Transfer Type"
"RTN","FBNHET",18,0)
 I $G(FBLTTYP),FBLTTYP<4 S DIR("B")=$P($P(DIR(0),"^",2),":",2)
"RTN","FBNHET",19,0)
 D ^DIR K DIR
"RTN","FBNHET",20,0)
 G RD1:$D(DIRUT) S FBZ=+Y
"RTN","FBNHET",21,0)
 S (DIC,DIE)="^FBAACNH(",DIC(0)="L",DLAYGO=162.3,X=FBY
"RTN","FBNHET",22,0)
 K DD,DO D FILE^DICN K DLAYGO,DIC G RD1:$D(DIRUT),RD2:Y<0
"RTN","FBNHET",23,0)
 S DA=+Y
"RTN","FBNHET",24,0)
 S DR="8////^S X=FBVEN;Q;1////^S X=DFN;2////^S X=""T"";4////^S X=IFN;6////^S X=FBZ" D ^DIE K DIE I $D(Y)'=0 G DEL
"RTN","FBNHET",25,0)
 G RD1
"RTN","FBNHET",26,0)
DEL W !!,*7,"Deleting Transfer because of incomplete transaction!" S DIK="^FBAACNH(" D ^DIK K DIK G RD1
"RTN","FBNHET",27,0)
 ;
"RTN","FBNHET",28,0)
Q K FBLTT,FBLTTYP,FBINF,FBTRT,FBLTD,DFN,IFN,DIK,FBPROG,CNT,DAT,DIC,F,FBAUT,FBDX,FBEDT,FBI,FBMULT,FBRR,FBTDT,FBXX,FTP,I,PI,PTYPE,T,X,Z,ZZ,FBAAOUT,Y,FBAABDT,FB7078,FBAAEDT,FBAAOUT,FBASSOC,FBDX,FBI,FBPOV,FBY
"RTN","FBNHET",29,0)
 K FBPSA,FBPT,I,PI,PTYPE,T,TA,VAL,FBTT,FBLOC,FBAAAD,FBAT,FBIFN,FBPDT,FBTYPE,FBVEN,DA,DR,FBASIH,FBJ,FBK,FBZ
"RTN","FBNHET",30,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBNHET",31,0)
 Q
"RTN","FBNHET",32,0)
 ;
"RTN","FBNHET",33,0)
TRANS ;transfer types
"RTN","FBNHET",34,0)
 ;;1:TO AUTHORIZED ABSENCE
"RTN","FBNHET",35,0)
 ;;2:TO UNAUTHORIZED ABSENCE
"RTN","FBNHET",36,0)
 ;;3:TO ASIH
"RTN","FBNHET",37,0)
 ;;4:FROM AUTHORIZED ABSENCE
"RTN","FBNHET",38,0)
 ;;5:FROM UNAUTHORIZED ABSENCE
"RTN","FBNHET",39,0)
 ;;6:FROM ASIH < 15 DAYS
"RTN","FBNHRC")
0^27^B13819457^B13739085
"RTN","FBNHRC",1,0)
FBNHRC ;AISC/CMR - RATE CHANGE DURING AN AUTHORIZATION ;6/5/2009
"RTN","FBNHRC",2,0)
 ;;3.5;FEE BASIS;**108**;JAN 30, 1995;Build 115
"RTN","FBNHRC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBNHRC",4,0)
 S DIC="^FBAAA(",DIC(0)="AEQMZ",DIC("A")="Select Fee Basis Patient: " D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<0) END S DFN=+Y,FBNAME=Y(0,0)
"RTN","FBNHRC",5,0)
 S FBPROG="I $P(^(0),""^"",3)=7" D GETAUTH^FBAAUTL1 G END:'$G(FB7078)
"RTN","FBNHRC",6,0)
 S FBCNT=0 D SORT I FBCNT'>0 W !!,*7,"No rate information on file for this authorization." G END
"RTN","FBNHRC",7,0)
ASK W !! S DIR(0)="DA^"_FBSTART_":"_FBEND_":EX",DIR("A")="Enter effective date of rate change: ",DIR("?")="Date must fall within authorization dates" D ^DIR K DIR
"RTN","FBNHRC",8,0)
 G END:$D(DIRUT)!('Y) S FBEDT=+Y
"RTN","FBNHRC",9,0)
 ;Get rate that will be affected by change
"RTN","FBNHRC",10,0)
 S FBN=0 F  S FBN=$O(^FBAA(161.23,"AC",FB7078,FBN)) Q:'FBN  Q:(FBEDT'>$P($G(^FBAA(161.23,+FBN,0)),"^",2))&($P($G(^FBAA(161.23,+FBN,0)),"^")'>FBEDT)
"RTN","FBNHRC",11,0)
 I FBN S FBRATE=1,FBCNUM=$P(^FBAA(161.23,FBN,0),"^",6),FBVIEN=FBVEN,FBREDT=$P(^(0),"^",2),FBRBDT=$P(^(0),"^") W !! D DISPLAY^FBAAVD1 G END:'$G(FBRATE) I FBRATE'=$P(^FBAA(161.23,FBN,0),"^",5) S (DIC,DIE)="^FBAA(161.23,",DA=FBN D
"RTN","FBNHRC",12,0)
 .I FBRBDT=FBEDT S DR=".05////^S X=FBRATE" D ^DIE
"RTN","FBNHRC",13,0)
 .I FBRBDT'=FBEDT S DR=".02////^S X="_$$CDTC^FBUCUTL(FBEDT,-1) D ^DIE K DIE,DA,DD,DO S DIC(0)="L",DLAYGO=161.23,X=FBEDT,DIC("DR")=".02////^S X=FBREDT;.03////^S X=FB7078;.04////^S X=DFN;.05////^S X=FBRATE;.06////^S X=FBCNUM" D FILE^DICN
"RTN","FBNHRC",14,0)
 K DIE,DIC,DR,DA,DLAYGO
"RTN","FBNHRC",15,0)
 D SORT
"RTN","FBNHRC",16,0)
 W !! S DIR(0)="Y",DIR("A")="Do you want to change other rates associated with this Authorization",DIR("B")="No" D ^DIR K DIR G:Y ASK
"RTN","FBNHRC",17,0)
END K FBNAME,DFN,FB7078,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBAUT,FBPOV,FBPROG,FBPSA,FBPT,FBTT,FBTYPE,FBVEN,FTP,CNT,FBAR,FBCFD,FBCNT,FBCNUM,FBCTD,FBEDT,FBEND,FBN,FBN1,FBRATE,FBRBDT,FBREDT,FBSTART,FBVIEN,FBX,X,Y,Z,FBAR1
"RTN","FBNHRC",18,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBNHRC",19,0)
 Q
"RTN","FBNHRC",20,0)
SORT D HED
"RTN","FBNHRC",21,0)
 S FBN=0 F  S FBN=$O(^FBAA(161.23,"AC",FB7078,FBN)) Q:'FBN  S FBN1=^FBAA(161.23,FBN,0),FBCNUM=$P(FBN1,"^",6),FBCFD=$P(FBN1,"^"),FBCTD=$P(FBN1,"^",2),FBRATE=$P(FBN1,"^",5) I FBCFD'>FBAAEDT S FBAR(FBCFD)=FBCTD_"^"_FBCNUM_"^"_FBRATE
"RTN","FBNHRC",22,0)
 S (FBCFD,FBAAOUT)=0 F  S FBCFD=$O(FBAR(FBCFD)) Q:'FBCFD!(FBAAOUT)  S FBCNT=FBCNT+1,FBAR1=FBAR(FBCFD) D DISPLAY
"RTN","FBNHRC",23,0)
 I FBCNT'>0 Q
"RTN","FBNHRC",24,0)
 S FBEND=+FBAR1,FBSTART=$O(FBAR(0))
"RTN","FBNHRC",25,0)
 Q
"RTN","FBNHRC",26,0)
DISPLAY ;Write out rates affected by contract
"RTN","FBNHRC",27,0)
 I $Y+5>IOSL S DIR(0)="E" D ^DIR K DIR I 'Y S FBAAOUT=1 Q
"RTN","FBNHRC",28,0)
 I $Y+5>IOSL D HED
"RTN","FBNHRC",29,0)
 W !!?5,$$DATX^FBAAUTL(FBCFD),?25,$$DATX^FBAAUTL(+FBAR1),?40,"$ ",$J($FN($P(FBAR1,"^",3),",",2),8),?55,$P(FBAR1,"^",2)
"RTN","FBNHRC",30,0)
 Q
"RTN","FBNHRC",31,0)
HED W @IOF,!,?20,"CURRENT RATE INFORMATION FOR ",$$NAME^FBCHREQ2(DFN)
"RTN","FBNHRC",32,0)
 W !!!?5,"FROM DATE",?25,"TO DATE",?40,"RATE",?55,"CONTRACT #",! F I=1:1:79 W "_"
"RTN","FBNHRC",33,0)
 Q
"RTN","FBPAY67")
0^40^B41443321^B38135461
"RTN","FBPAY67",1,0)
FBPAY67 ;AISC/DMK,TET,BPOIFO/MEC - CH/CNH PAYMENT HISTORY SORT ; 9/14/09 3:00pm
"RTN","FBPAY67",2,0)
 ;;3.5;FEE BASIS;**4,32,55,69,108**;JAN 30, 1995;Build 115
"RTN","FBPAY67",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPAY67",4,0)
EN ;entry to sort
"RTN","FBPAY67",5,0)
 I FBSORT S DFN=FBIEN,FBPID=FBID,FBPNAME=FBNAME
"RTN","FBPAY67",6,0)
 I 'FBSORT S FBVI=FBIEN,FBVID=FBID,FBVNAME=$E(FBNAME,1,23)
"RTN","FBPAY67",7,0)
FBAAC ;check ^fbaac("an" (file 162)
"RTN","FBPAY67",8,0)
 S FBOUT=0 I $D(^FBAAC("AN",FBPI)) D AN  I $G(FBPIFLG) S FBPI=7 D AN S FBPI=6
"RTN","FBPAY67",9,0)
 S I=FBBEG,FBIX=$S(FBSORT:"AG",1:"AF")
"RTN","FBPAY67",10,0)
SORT ;sort programs 6 & 7 (civil hos & cnh)
"RTN","FBPAY67",11,0)
 F FBM=FBBEG-.1:0 S FBM=$O(^FBAAI(FBIX,FBIEN,FBM)) Q:FBM'>0!(FBM>FBEND)  F FBI=0:0 S FBI=$O(^FBAAI(FBIX,FBIEN,FBM,FBI)) Q:FBI'>0  I $G(^FBAAI(FBI,"FBREJ"))']"" D SET S FBPI=FBPISV
"RTN","FBPAY67",12,0)
KILL ;kill variables set in routine and in FBPAY2, sort/set sections
"RTN","FBPAY67",13,0)
 K A1,A2,A3,D,D2,FBAACPTC,FBBN,FBCNT,FBCP,FBDT,FBDT1,FBDX,FBDX1,FBI,FBIN,FBIX,FBM,FBOB,FBPDX,FBPISV,FBPROC,FBPROC1,FBSC,FBTA,FBVEN,FBVENID,FBVP,I,J,K,L,M,Y,FBDT2,FBPROA,FBPOA,FBADMTDX
"RTN","FBPAY67",14,0)
 K:FBSORT FBVNAME,FBVID K:'FBSORT FBPNAME,FBPID
"RTN","FBPAY67",15,0)
 D KILL^FBPAY2
"RTN","FBPAY67",16,0)
 Q
"RTN","FBPAY67",17,0)
SET ;set string, also called by fbchdi (fblistc or fbaanq set if called by fbchdi)
"RTN","FBPAY67",18,0)
 N FBY2,FBY3,FBY5,FBCDAYS,FBCSID,FBFPPSC,FBFPPSL,FBX,FBADJLR,FBADJLA,FBRRMKL,FBAARCE,FBX,FBADMTDX,P2,FBPOA
"RTN","FBPAY67",19,0)
 S FBPISV=$G(FBPI),FBIN=$G(^FBAAI(FBI,0)) Q:FBIN']""  S FBPI=+$P(FBIN,U,12)
"RTN","FBPAY67",20,0)
 I 'FBPROG,'$D(FBPROG(+$P(FBIN,U,12))) Q
"RTN","FBPAY67",21,0)
 I '$D(FBPIFLG) Q:+$P(FBIN,U,12)'=FBPI
"RTN","FBPAY67",22,0)
 I $D(FBPIFLG),'FBPROG Q:'$D(FBPROG(+$P(FBIN,U,12)))
"RTN","FBPAY67",23,0)
 S FBY2=$G(^FBAAI(FBI,2))
"RTN","FBPAY67",24,0)
 S FBY3=$G(^FBAAI(FBI,3))
"RTN","FBPAY67",25,0)
 S FBY5=$G(^FBAAI(FBI,5))
"RTN","FBPAY67",26,0)
 ; if user wants just mill bill or just non-mill bill then check payment
"RTN","FBPAY67",27,0)
 ;   and skip if associated with an mill bill claim
"RTN","FBPAY67",28,0)
 I "^M^N^"[(U_$G(FB1725R)_U) S FB1725=$S($P(FBIN,U,5)["FB583":+$P($G(^FB583(+$P(FBIN,U,5),0)),U,28),1:0) I $S(FB1725R="M"&'FB1725:1,FB1725R="N"&FB1725:1,1:0) Q
"RTN","FBPAY67",29,0)
 F J=1,2,3,6,7,8,9,10,11,13,14 S FBIN(J)=$P(FBIN,"^",J)
"RTN","FBPAY67",30,0)
 S:FBSORT FBIN(5)=$P(FBIN,U,5) I 'FBSORT S FBIN(4)=$P(FBIN,U,4),DFN=FBIN(4) Q:DFN']""  S FBPID=$$SSN^FBAAUTL(DFN),FBPNAME=$P($G(^DPT(+DFN,0)),U)
"RTN","FBPAY67",31,0)
 I FBSORT S FBVNAME=$G(^FBAAV(FBIN(3),0)) Q:FBVNAME']""  S FBVID=$P(FBVNAME,U,2),FBVNAME=$E($P(FBVNAME,U),1,23)
"RTN","FBPAY67",32,0)
 S FBIN(2)=$$DATX^FBAAUTL(FBIN(2)),FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPAY67",33,0)
 S FBIN(6)=$$DATX^FBAAUTL(FBIN(6)),FBIN(7)=$$DATX^FBAAUTL(FBIN(7))
"RTN","FBPAY67",34,0)
 D FBCKI^FBAACCB1(FBI)
"RTN","FBPAY67",35,0)
SETTMP S ^TMP($J,"FB",+$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI)=FBIN(2)_U_$J(FBIN(8),8,2)_U_$J(FBIN(9),8,2)_U_FBIN(11)_U_$J(FBIN(1),8)_U_FBIN(6)_U_FBIN(7)_U_FBIN(13)_U_FBIN(14)_U_FBIN(10)
"RTN","FBPAY67",36,0)
 S ^TMP($J,"FB",+$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT
"RTN","FBPAY67",37,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBPAY67",38,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBPAY67",39,0)
 S FBFPPSC=$P(FBY3,U) ; fpps claim id
"RTN","FBPAY67",40,0)
 S FBFPPSL=$P(FBY3,U,2) ; fpps line item
"RTN","FBPAY67",41,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBPAY67",42,0)
 S FBADJLR=$P(FBX,U) ;adjustment reason
"RTN","FBPAY67",43,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPAY67",44,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",") ;remittance remarks
"RTN","FBPAY67",45,0)
 S FBADMTDX=$$ICD9^FBCSV1($P(FBY5,"^",9)) ; admitting diagnosis
"RTN","FBPAY67",46,0)
 S ^TMP($J,"FB",+$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"FBINV")=FBCDAYS_"^"_FBCSID_"^"_FBFPPSC_"^"_FBFPPSL_"^"_FBADJLR_"^"_FBADJLA_"^"_FBRRMKL_"^"_FBADMTDX
"RTN","FBPAY67",47,0)
 S FBDX=$G(^FBAAI(FBI,"DX"))
"RTN","FBPAY67",48,0)
 S FBPOA=$G(^FBAAI(FBI,"POA"))
"RTN","FBPAY67",49,0)
 I FBDX]"" S FBDX1="" F I=1:1:25 D
"RTN","FBPAY67",50,0)
 .N FBPOA1
"RTN","FBPAY67",51,0)
 .Q:$P(FBDX,U,I)=""
"RTN","FBPAY67",52,0)
 .S FBPOA1=$P(FBPOA,U,I)
"RTN","FBPAY67",53,0)
 .S FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_"/"
"RTN","FBPAY67",54,0)
 .S FBDX1=FBDX1_$S(FBPOA1:$P($G(^FB(161.94,FBPOA1,0)),"^"),1:"")_U
"RTN","FBPAY67",55,0)
 .Q
"RTN","FBPAY67",56,0)
 I FBDX]"" S FBDX1=$P(FBDX1,U,1,($L(FBDX1,U)-1)),^TMP($J,"FB",$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"DX")=FBDX1
"RTN","FBPAY67",57,0)
 S FBPROC=$G(^FBAAI(FBI,"PROC")) I FBPROC]"" S FBPROC1="" F I=1:1:25 S:$P(FBPROC,U,I) FBPROC1=FBPROC1_$$ICD0^FBCSV1($P(FBPROC,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPAY67",58,0)
 I FBPROC]"" S FBPROC1=$P(FBPROC1,U,1,($L(FBPROC1,U)-1)),^TMP($J,"FB",$P(FBIN,U,12),FBVEN,FBPAT,FBM,FBI,"PROC")=FBPROC1
"RTN","FBPAY67",59,0)
 D ANC(FBM,FBI):FBSORT&($D(^TMP($J,"FB",FBPI,FBVEN,FBPAT,FBM,FBI)))
"RTN","FBPAY67",60,0)
 Q
"RTN","FBPAY67",61,0)
AN ;get data from an xref - called at tag fbaac in pay3 & pay67
"RTN","FBPAY67",62,0)
 I FBSORT G AN1
"RTN","FBPAY67",63,0)
 S FBVEN=FBVNAME_";"_FBVID,DFN=0 F  S DFN=$O(^FBAAC("AN",FBPI,DFN)) Q:'DFN  S FBPAT=$G(^DPT(DFN,0)),FBPNAME=$P(FBPAT,U),FBPID=$$SSN^FBAAUTL(DFN),FBPAT=FBPNAME_";"_DFN D OTH
"RTN","FBPAY67",64,0)
 Q
"RTN","FBPAY67",65,0)
AN1 S FBPAT=FBPNAME_";"_FBPID,FBVI=0 F  S FBVI=$O(^FBAAC("AN",FBPI,DFN,FBVI)) Q:'FBVI  S FBVNAME=$E($$VNAME^FBNHEXP(FBVI),1,23),FBVID=$$VID^FBNHEXP(FBVI),FBVEN=FBVNAME_";"_FBVID D OTH
"RTN","FBPAY67",66,0)
 Q
"RTN","FBPAY67",67,0)
OTH ;other fee programs - if 'fbsort (by vendor)
"RTN","FBPAY67",68,0)
 Q:'$O(^FBAAC("AN",FBPI,DFN,FBVI,0))
"RTN","FBPAY67",69,0)
 N J,K,L,M,Y,FBDT1 S J=DFN,K=FBVI
"RTN","FBPAY67",70,0)
 S L=0 F  S L=$O(^FBAAC("AN",FBPI,J,K,L)) Q:'L  S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]""&(FBDT1'<FBBDATE&(FBDT1'>FBEDATE)) D  S:FBOUT FBOUT=0
"RTN","FBPAY67",71,0)
 .S M=0 F  S M=$O(^FBAAC("AN",FBPI,J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPAY67",72,0)
 ..S FBOUT=0 D EN1^FBPAY2 Q:FBOUT  D EN^FBPAY21
"RTN","FBPAY67",73,0)
 ..S ^TMP($J,"FB",FBPI_"O",FBVEN,FBPAT,(9999999.9999-FBDT1),L,M)=$G(FBR)_$$DATX^FBAAUTL(FBDT1)_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB
"RTN","FBPAY67",74,0)
 ..S ^TMP($J,"FB",FBPI_"O",FBVEN,FBPAT,(9999999.9999-FBDT1),L,M,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT
"RTN","FBPAY67",75,0)
 ..S ^TMP($J,"FB",FBPI_"O",FBVEN,FBPAT,(9999999.9999-FBDT1),L,M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID_U_FBFPPSC_U_FBFPPSL_U_FBAARCE
"RTN","FBPAY67",76,0)
 Q
"RTN","FBPAY67",77,0)
ANC(FBM,FBI) ;ancillary payments - if fbsort (by patient)
"RTN","FBPAY67",78,0)
 N J,K,L,M,Y,FBDT1,FBVID
"RTN","FBPAY67",79,0)
 N FBCSID,FBADJLA,FBADJLR,FBRRMKL,FBUNITS,TAMT,T,FBADJ,FBFPPSC,FBFPPSL,FBAARCE
"RTN","FBPAY67",80,0)
 S J=FBIEN,FBCNT=0 I J,+FBIN(5),$D(^FBAAC("AM",FBIN(5),J)) D
"RTN","FBPAY67",81,0)
 .F K=0:0 S K=$O(^FBAAC("AM",FBIN(5),J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AM",FBIN(5),J,K,L)) Q:'L  D
"RTN","FBPAY67",82,0)
 ..N FBOUT
"RTN","FBPAY67",83,0)
 ..S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]"" S FBDT2=(9999999.9999-FBDT1),FBDT1=$$DATX^FBAAUTL(FBDT1)
"RTN","FBPAY67",84,0)
 ..S M=0 F  S M=$O(^FBAAC("AM",FBIN(5),J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPAY67",85,0)
 ...D EN1^FBPAY2 Q:'$D(FBAACPTC)!($G(FBOUT))  S FBCNT=FBCNT+1 D EN^FBPAY21
"RTN","FBPAY67",86,0)
 ...S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,"A",K,L,M)=$G(FBR)_FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBVNAME_U_FBVID
"RTN","FBPAY67",87,0)
 ...S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,"A",K,L,M,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT
"RTN","FBPAY67",88,0)
 ...S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,"A",K,L,M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID_U_FBFPPSC_U_FBFPPSL_U_FBAARCE
"RTN","FBPAY67",89,0)
 ...I $D(^TMP($J,"FB",FBPI_"O",FBVNAME_";"_FBVID,$P(FBPAT,";")_";"_$$SSN^FBAAUTL($P(FBPAT,";",2)),FBDT2)) K ^TMP($J,"FB",FBPI_"O",FBVNAME_";"_FBVID,$P(FBPAT,";")_";"_$$SSN^FBAAUTL($P(FBPAT,";",2)),FBDT2)
"RTN","FBPAY67",90,0)
 Q
"RTN","FBPAY671")
0^43^B38061313^B36548177
"RTN","FBPAY671",1,0)
FBPAY671 ;AISC/DMK,TET,BPOIFO/MEC - CH/CNH PAYMENT HISTORY PRINT ; 9/14/09 3:34pm
"RTN","FBPAY671",2,0)
 ;;3.5;FEE BASIS;**4,32,55,69,101,108**;JAN 30, 1995;Build 115
"RTN","FBPAY671",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPAY671",4,0)
PRINT ;print data from tmp global
"RTN","FBPAY671",5,0)
 S FBOUT=0 D:FBCRT&(FBPG) CR Q:FBOUT
"RTN","FBPAY671",6,0)
 S FBHEAD=$S(FBSORT:"VETERAN",1:"VENDOR")
"RTN","FBPAY671",7,0)
EN1 N FBI,FBINV ;entry point from fbchdi
"RTN","FBPAY671",8,0)
 D HDR S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D:FBSORT SH Q:FBOUT  S FBPT="" F  S FBPT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT)) Q:FBPT']""!(FBOUT)  D  Q:FBOUT  D CKANC Q:FBOUT
"RTN","FBPAY671",9,0)
 .D:'FBSORT SH Q:FBOUT  S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT)) Q:'FBDT!(FBOUT)  S FBI=0 F  S FBI=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI)) Q:'FBI!(FBOUT)  D  Q:FBOUT
"RTN","FBPAY671",10,0)
 ..I ($Y+5)>IOSL D PAGE Q:FBOUT
"RTN","FBPAY671",11,0)
 ..S FBDATA=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI),A2=$$EXTRL^FBMRASVR($P(FBDATA,U,3))
"RTN","FBPAY671",12,0)
 ..S FBINV=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,"FBINV")
"RTN","FBPAY671",13,0)
 ..W ! W:$P(FBDATA,U,8)["R" "*" W:$P(FBDATA,U,9)]"" "#"
"RTN","FBPAY671",14,0)
 ..W ?2,$P(FBDATA,U,1),?15,$P(FBDATA,U,5),?31,$P(FBDATA,U,6)
"RTN","FBPAY671",15,0)
 ..W ?47,$P(FBDATA,U,7),?57,$P(FBINV,U,2)
"RTN","FBPAY671",16,0)
 ..W !?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?25,$P(FBINV,U,1)
"RTN","FBPAY671",17,0)
 .. ;Print adj reasons, if null then print suspend code
"RTN","FBPAY671",18,0)
 ..W ?36,$S($P(FBINV,U,5)]"":$P(FBINV,U,5),1:$P(FBDATA,U,4))
"RTN","FBPAY671",19,0)
 ..W ?46,$S($P(FBINV,U,5)]"":$J($P(FBINV,U,6),14),1:$J($P(FBDATA,U,10),14))
"RTN","FBPAY671",20,0)
 ..W ?63,$P(FBINV,U,7)
"RTN","FBPAY671",21,0)
 .. ;If FPPS Claim ID exists then print it.
"RTN","FBPAY671",22,0)
 ..I $P(FBINV,U,3)]"" D
"RTN","FBPAY671",23,0)
 ...W !?5,"FPPS Claim ID: ",$P(FBINV,U,3),"    FPPS Line Item: ",$P(FBINV,U,4)
"RTN","FBPAY671",24,0)
 .. ; write admitting diagnosis if present
"RTN","FBPAY671",25,0)
 ..I $P(FBINV,U,8)'="" W !?6,"Admit Dx: ",$P(FBINV,U,8)
"RTN","FBPAY671",26,0)
 ..I $D(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,"DX")) S FBDATA=^("DX"),FBSL=$L(FBDATA,"^") F I=1:1:FBSL D WRTDX
"RTN","FBPAY671",27,0)
 ..I $D(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,"PROC")) S FBDATA=^("PROC"),FBSL=$L(FBDATA,"^") F I=1:1:FBSL D WRTPC
"RTN","FBPAY671",28,0)
 ..I $D(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,"FBCK")) D EFBCK^FBPAY21(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,"FBCK")) D PMNT^FBAACCB2 K A2
"RTN","FBPAY671",29,0)
 Q
"RTN","FBPAY671",30,0)
CKANC I +$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",0)) D PANC(FBI) Q:FBOUT  W !,FBDASH1
"RTN","FBPAY671",31,0)
 Q
"RTN","FBPAY671",32,0)
PANC(FBI) ;print anc data - FBI = unique number; called by fbpay3
"RTN","FBPAY671",33,0)
 S (FBOV,FBK)=0,FBSL=8,FBLOC=1_U_12_U_23_U_33_U_43_U_56_U_62_U_71 D SHA Q:FBOUT
"RTN","FBPAY671",34,0)
 F  S FBK=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK)) Q:'FBK!(FBOUT)  S FBL=0 F  S FBL=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL)) Q:'FBL!(FBOUT)  S FBM=0 F  S FBM=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM)) Q:'FBM!(FBOUT)  D
"RTN","FBPAY671",35,0)
 .S FBDATA=^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM)
"RTN","FBPAY671",36,0)
 .S FBV=$P(FBDATA,U,12)_";"_$P(FBDATA,U,13)
"RTN","FBPAY671",37,0)
 .D WRT
"RTN","FBPAY671",38,0)
 K FBK,FBL,FBM Q
"RTN","FBPAY671",39,0)
WRT ;write ancillary info
"RTN","FBPAY671",40,0)
 I ($Y+6)>IOSL D PAGE Q:FBOUT  D SHA Q:FBOUT  D SHA2 Q:FBOUT
"RTN","FBPAY671",41,0)
 D:FBOV'=FBV SHA2
"RTN","FBPAY671",42,0)
 S FBCKIN=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM,"FBCK")) D EFBCK^FBPAY21(FBCKIN)
"RTN","FBPAY671",43,0)
 S FBADJ=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM,"FBADJ"))
"RTN","FBPAY671",44,0)
 W ! W:$G(FBCAN)]"" "+"
"RTN","FBPAY671",45,0)
 W ?1,$P(FBDATA,U,1)
"RTN","FBPAY671",46,0)
 W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPAY671",47,0)
 W ?22,$P(FBADJ,U,9)
"RTN","FBPAY671",48,0)
 W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPAY671",49,0)
 W ?43,$P(FBDATA,U,6)
"RTN","FBPAY671",50,0)
 W ?54,$P(FBDATA,U,7)
"RTN","FBPAY671",51,0)
 W ?64,$P(FBDATA,U,8)
"RTN","FBPAY671",52,0)
 I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPAY671",53,0)
 . N FBI,FBMOD
"RTN","FBPAY671",54,0)
 . F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPAY671",55,0)
 . . I $Y+7>IOSL D PAGE Q:FBOUT  D SHA Q:FBOUT  D SHA2 Q:FBOUT  W !,"  (continued)"
"RTN","FBPAY671",56,0)
 . . W !?16,"-",FBMOD
"RTN","FBPAY671",57,0)
 W !,$P(FBDATA,U,3)
"RTN","FBPAY671",58,0)
 W ?13,$P(FBDATA,U,4)
"RTN","FBPAY671",59,0)
 W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPAY671",60,0)
 W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPAY671",61,0)
 W ?48,$P(FBADJ,U,5)
"RTN","FBPAY671",62,0)
 W ?60,$P(FBADJ,U,6)
"RTN","FBPAY671",63,0)
 ;If FPPS Claim ID exists then print it.
"RTN","FBPAY671",64,0)
 I $P(FBADJ,U,7)]"" D
"RTN","FBPAY671",65,0)
 .W !?5,"FPPS Claim ID: ",$P(FBADJ,U,7),"    FPPS Line Item: ",$P(FBADJ,U,8)
"RTN","FBPAY671",66,0)
 W !?4,"Primary Dx: ",$P(FBDATA,U,10),?40,"S/C Condition? ",$P(FBDATA,U,9),?66,"Obl.#: ",$P(FBDATA,U,11)
"RTN","FBPAY671",67,0)
 N A2 S A2=$$EXTRL^FBMRASVR($P(FBDATA,U,4))
"RTN","FBPAY671",68,0)
 D PMNT^FBAACCB2
"RTN","FBPAY671",69,0)
 Q
"RTN","FBPAY671",70,0)
HDR ;main header
"RTN","FBPAY671",71,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPAY671",72,0)
 S FBPG=FBPG+1
"RTN","FBPAY671",73,0)
 I $D(FBHEAD) D
"RTN","FBPAY671",74,0)
 .W !?25,FBHEAD_" PAYMENT HISTORY"
"RTN","FBPAY671",75,0)
 .I $G(FB1725R)]"",FB1725R'="A" W " ",$S(FB1725R="M":"for 38 U.S.C. 1725 Claims",1:"excluding 38 U.S.C. 1725 Claims")
"RTN","FBPAY671",76,0)
 .W !,?24,$E(FBDASH,1,24),?71,"Page: ",FBPG,!?48,"Date Range: ",$$DATX^FBAAUTL(FBBDATE)," to ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPAY671",77,0)
 I '$D(FBHEAD) W !?30,"INVOICE DISPLAY",!?29,$E(FBDASH,1,17),!
"RTN","FBPAY671",78,0)
 W ! W:FBSORT "Patient: ",FBPNAME,?41,"Patient ID: ",FBPID W:'FBSORT "Vendor: ",FBVNAME,?41,"Vendor ID: ",FBVID
"RTN","FBPAY671",79,0)
 W !?(IOM-(13+$L(FBPROG(+FBPI)))/2),"FEE PROGRAM: ",FBPROG(+FBPI)
"RTN","FBPAY671",80,0)
 W !?3,"('*' Reimb. to Patient  '+' Cancel. Activity  '#' Voided Payment)"
"RTN","FBPAY671",81,0)
 W !,?3,"(paid symbol: 'R' RBRVS  'F' 75th percentile  'C' contract  'M' Mill Bill"
"RTN","FBPAY671",82,0)
 W !,?3,"              'U' U&C)"
"RTN","FBPAY671",83,0)
 W !?1,"Invoice Date",?15,"Invoice No.",?31,"From Date",?48,"To Date",?57,"Patient Control #"
"RTN","FBPAY671",84,0)
 W !?1,"Amt Claimed",?15,"Amt Paid",?25,"Cov Days",?36,"Adj Codes",?49,"Adj Amounts",?63,"Remit Remarks",!,FBDASH
"RTN","FBPAY671",85,0)
 Q
"RTN","FBPAY671",86,0)
SH ;subheader - vendor if fbsort; patient if 'fbsort, prints when name changed
"RTN","FBPAY671",87,0)
 I ($Y+7)>IOSL D:FBCRT CR Q:FBOUT  D HDR
"RTN","FBPAY671",88,0)
 I FBSORT W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2)
"RTN","FBPAY671",89,0)
 I 'FBSORT W !!,"Patient: ",$P(FBPT,";"),?41,"Patient ID: ",$$SSNL4^FBAAUTL($$SSN^FBAAUTL($P(FBPT,";",2)))
"RTN","FBPAY671",90,0)
 Q
"RTN","FBPAY671",91,0)
SHA ;ancillary subheader
"RTN","FBPAY671",92,0)
 I ($Y+14)>IOSL D PAGE Q:FBOUT
"RTN","FBPAY671",93,0)
 W !?20,">>> ANCILLARY SERVICE PAYMENTS <<<",!
"RTN","FBPAY671",94,0)
SHA1 ;subheader for ancillary data
"RTN","FBPAY671",95,0)
 W !,?1,"Svc Date",?11,"CPT-MOD ",?21,"Rev Code",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPAY671",96,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPAY671",97,0)
 Q
"RTN","FBPAY671",98,0)
SHA2 ;subheader for vendor name
"RTN","FBPAY671",99,0)
 I ($Y+5)>IOSL D:FBCRT CR Q:FBOUT  D HDR,SH,SHA
"RTN","FBPAY671",100,0)
 I FBOV'=FBV S FBOV=FBV
"RTN","FBPAY671",101,0)
 W !!,"Vendor: ",$P(FBV,";"),?41,"Vendor ID: ",$P(FBV,";",2)
"RTN","FBPAY671",102,0)
 Q
"RTN","FBPAY671",103,0)
CR ;read for display
"RTN","FBPAY671",104,0)
 Q:'FBPG  S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPAY671",105,0)
 Q
"RTN","FBPAY671",106,0)
PAGE ;new page
"RTN","FBPAY671",107,0)
 I FBCRT D CR Q:FBOUT
"RTN","FBPAY671",108,0)
 D HDR,SH
"RTN","FBPAY671",109,0)
 Q
"RTN","FBPAY671",110,0)
WRTDX ; inputs
"RTN","FBPAY671",111,0)
 ; FBDATA contains node from ^TMP 
"RTN","FBPAY671",112,0)
 ; I contains piece to be written
"RTN","FBPAY671",113,0)
 I I=1!($X+$L($P(FBDATA,"^",I))+2>IOM) W !,?4,"DX/POA: "
"RTN","FBPAY671",114,0)
 W $P(FBDATA,"^",I)," "
"RTN","FBPAY671",115,0)
 Q
"RTN","FBPAY671",116,0)
WRTPC ; inputs
"RTN","FBPAY671",117,0)
 ; FBDATA contains node from ^TMP
"RTN","FBPAY671",118,0)
 ; I contains piece to be written
"RTN","FBPAY671",119,0)
 I I=1!($X+$L($P(FBDATA,"^",I))+2>IOM) W !,?4,"PROC: "
"RTN","FBPAY671",120,0)
 W $P(FBDATA,"^",I)," "
"RTN","FBPAY671",121,0)
 Q
"RTN","FBPAY671",122,0)
WRTSC ;write service connected
"RTN","FBPAY671",123,0)
 W !,"SERVICE CONNECTED? ",$S(+VAEL(3):"YES",1:"NO"),!
"RTN","FBPAY671",124,0)
 Q
"RTN","FBPAY671",125,0)
TRAV ;write out travel payments, (FBPAT,FBSORT) must be defined
"RTN","FBPAY671",126,0)
 S FBTRDT=0
"RTN","FBPAY671",127,0)
 F  S FBTRDT=$O(^TMP($J,"FBTR",FBPAT,FBTRDT)) Q:'FBTRDT  S FBTRX=0 F  S FBTRX=$O(^TMP($J,"FBTR",FBPAT,FBTRDT,FBTRX)) Q:'FBTRX  S FBCKIN=^(FBTRX),A2=$P(FBCKIN,"^") D TRCK Q:FBOUT  W:$G(FBTRCK) !,?5,"TRAVEL PAYMENTS: " D  K FBTRCK
"RTN","FBPAY671",128,0)
 .W ?22,$$DATX^FBAAUTL(FBTRDT),?35,A2
"RTN","FBPAY671",129,0)
 .S A2=$$EXTRL^FBMRASVR(A2) D EFBCK^FBPAY21(FBCKIN),PMNT^FBAACCB2
"RTN","FBPAY671",130,0)
 .K A2 W ! Q
"RTN","FBPAY671",131,0)
 Q
"RTN","FBPAY671",132,0)
TRCK I ($Y+5)>IOSL D:FBCRT CR Q:FBOUT  D HDR^FBPAY21
"RTN","FBPAY671",133,0)
 Q
"RTN","FBPCR67")
0^42^B27748859^B24858243
"RTN","FBPCR67",1,0)
FBPCR67 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY SORT ;07/01/2006
"RTN","FBPCR67",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,98,122,108**;JAN 30, 1995;Build 115
"RTN","FBPCR67",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR67",4,0)
EN ;entry point for sort
"RTN","FBPCR67",5,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",6,0)
SORT ;sort by date finalized, ien
"RTN","FBPCR67",7,0)
 N FBY2,FBY5,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL
"RTN","FBPCR67",8,0)
 S FBM=FBBDATE-.1 F  S FBM=$O(^FBAAI("AD",FBM)) Q:'FBM!(FBM>FBEDATE)  S FBI=0 F  S FBI=$O(^FBAAI("AD",FBM,FBI)) Q:FBI'>0  S FBIN=$G(^FBAAI(FBI,0)) I FBIN]""&($G(^FBAAI(FBI,"FBREJ"))']"") D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",9,0)
 .S (DFN,J)=+$P(FBIN,U,4) D VET^FBPCR
"RTN","FBPCR67",10,0)
 .D SET Q:FBPI'[+$P(FBIN,U,12)!('FBPSV&('$D(FBPSV(FBPSF))))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR67",11,0)
KILL ;kill variables set in this routine and in FPAY2, sort/set sections
"RTN","FBPCR67",12,0)
 K A1,A2,A3,D,D2,DFN,FBAACPTC,FBBN,FBCATC,FBCNT,FBCP,FBDOB,FBDT,FBDT1,FBDX,FBDX1,FBI,FBIN,FBINS,FBIX,FBJ,FBM,FBOB,FBPAT,FBPDX,FBPROC,FBPROC1,FBPSF,FBSC,FBTA,FBVEN,FBVENID,FBVP,I,J,K,L,M,Y,FBPOA,FBPROA,FBADMTDX
"RTN","FBPCR67",13,0)
 K FBVNAME,FBVID,FBPNAME,FBPID
"RTN","FBPCR67",14,0)
 K FBY2,FBY4,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL   ; FB*3.5*122
"RTN","FBPCR67",15,0)
 D KILL^FBPCR2
"RTN","FBPCR67",16,0)
 Q
"RTN","FBPCR67",17,0)
SET ;set variables
"RTN","FBPCR67",18,0)
 S FBY2=$G(^FBAAI(FBI,2)),FBY4=$G(^FBAAI(FBI,4)),$P(FBY4,U,20)=$P($G(^FBAAI(FBI,5)),U,1,4)  ; FB*3.5*122
"RTN","FBPCR67",19,0)
 S FBY5=$G(^FBAAI(FBI,5))
"RTN","FBPCR67",20,0)
 F FBJ=1,2,3,4,6,7,8,9,11,13,14 S FBIN(FBJ)=$P(FBIN,"^",FBJ)
"RTN","FBPCR67",21,0)
 Q:FBPI'[+$P(FBIN,U,12)  S FBPSF=+$P(FBIN,U,20)
"RTN","FBPCR67",22,0)
 Q:'FBPSV&('$D(FBPSV(FBPSF)))
"RTN","FBPCR67",23,0)
 S ^TMP($J,"FB",FBPSF)=$G(^FBAAI(FBI,5))  ; FB*3.5*122
"RTN","FBPCR67",24,0)
 D
"RTN","FBPCR67",25,0)
 . N FBCATC2
"RTN","FBPCR67",26,0)
 . S FBCATC=$$CATC^FBPCR(DFN,+$P(FBIN,U,6),+$P(FBIN,U,18))
"RTN","FBPCR67",27,0)
 . Q:FBCATC=2
"RTN","FBPCR67",28,0)
 . S FBCATC2=$$CATC^FBPCR(DFN,+$P(FBIN,U,7),+$P(FBIN,U,18))
"RTN","FBPCR67",29,0)
 . I FBCATC2=0 Q
"RTN","FBPCR67",30,0)
 . I FBCATC=0!(FBCATC=1) S FBCATC=FBCATC2 Q
"RTN","FBPCR67",31,0)
 . S:FBCATC2=2 FBCATC=2
"RTN","FBPCR67",32,0)
 ;,FBINS=$S($O(^FBAAA("AIC",FBIN(4),+$O(^FBAAA("AIC",FBIN(4),-FBIN(6))),0))="Y":1,1:0)
"RTN","FBPCR67",33,0)
 S FBINS=$S($$INSCK^FBPCR3(FBIN(6),FBIN(4),+$P(FBIN,U,12))=1:$$INSURED^FBPCR4(DFN,+$P(FBIN,U,6),+$P(FBIN,U,7)),1:0)
"RTN","FBPCR67",34,0)
 Q:'FBCATC&'FBINS
"RTN","FBPCR67",35,0)
 S FBIN(5)=$P(FBIN,U,5)
"RTN","FBPCR67",36,0)
 S FBIEN=FBIN(3),FBVNAME=$G(^FBAAV(FBIN(3),0)) Q:FBVNAME']""  S FBVID=$P(FBVNAME,U,2)_"/"_$S($P($G(^FBAAV(FBIEN,3)),U,2)]"":$P($G(^FBAAV(FBIEN,3)),U,2),1:"**********"),FBVNAME=$E($P(FBVNAME,U),1,23)
"RTN","FBPCR67",37,0)
 S FBIN(2)=$$DATX^FBAAUTL(FBIN(2)),FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR67",38,0)
 S FBIN(6)=$$DATX^FBAAUTL(FBIN(6)),FBIN(7)=$$DATX^FBAAUTL(FBIN(7))
"RTN","FBPCR67",39,0)
 Q
"RTN","FBPCR67",40,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR67",41,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",42,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI)=FBIN(2)_U_$J(FBIN(8),8,2)_U_$J(FBIN(9),8,2)_U_FBIN(11)_U_$J(FBIN(1),8)_U_FBIN(6)_U_FBIN(7)_U_$P(FBIN,U,12)_U_FBCATC_U_FBINS_U_FBIN(13)_U_FBIN(14)
"RTN","FBPCR67",43,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBPCR67",44,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBPCR67",45,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBPCR67",46,0)
 S FBADJLR=$P(FBX,U) ;adjustment reason
"RTN","FBPCR67",47,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPCR67",48,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",") ;remittance remarks
"RTN","FBPCR67",49,0)
 S FBADMTDX=$$ICD9^FBCSV1($P(FBY5,"^",9))  ; admitting diagnosis
"RTN","FBPCR67",50,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBINV")=FBCDAYS_"^"_FBCSID_"^"_FBADJLR_"^"_FBADJLA_"^"_FBRRMKL_"^"_FBADMTDX
"RTN","FBPCR67",51,0)
 ;S FBDX=$G(^FBAAI(FBI,"DX")) I FBDX]"" S FBDX1="" F I=1:1:5 S:$P(FBDX,U,I) FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",52,0)
 S FBDX=$G(^FBAAI(FBI,"DX"))
"RTN","FBPCR67",53,0)
 S FBPOA=$G(^FBAAI(FBI,"POA"))
"RTN","FBPCR67",54,0)
 I FBDX]"" S FBDX1="" F I=1:1:25 D
"RTN","FBPCR67",55,0)
 . N FBPOA1
"RTN","FBPCR67",56,0)
 . Q:$P(FBDX,U,I)=""
"RTN","FBPCR67",57,0)
 . S FBPOA1=$P(FBPOA,U,I)
"RTN","FBPCR67",58,0)
 . S FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_"/"
"RTN","FBPCR67",59,0)
 . S FBDX1=FBDX1_$S(FBPOA1:$P($G(^FB(161.94,FBPOA1,0)),"^"),1:"")_U
"RTN","FBPCR67",60,0)
 . Q
"RTN","FBPCR67",61,0)
 I FBDX]"" S FBDX1=$P(FBDX1,U,1,($L(FBDX1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"DX")=FBDX1
"RTN","FBPCR67",62,0)
 S FBPROC=$G(^FBAAI(FBI,"PROC")) I FBPROC]"" S FBPROC1="" F I=1:1:25 S:$P(FBPROC,U,I) FBPROC1=FBPROC1_$$ICD0^FBCSV1($P(FBPROC,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",63,0)
 I FBPROC]"" S FBPROC1=$P(FBPROC1,U,1,($L(FBPROC1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"PROC")=FBPROC1
"RTN","FBPCR67",64,0)
 ;*** removed conditional to get ancillary payments processed
"RTN","FBPCR67",65,0)
 ;D ANC:$D(^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI))
"RTN","FBPCR67",66,0)
 D ANC
"RTN","FBPCR67",67,0)
 K FB5010
"RTN","FBPCR67",68,0)
 ;get line item rendering provider data
"RTN","FBPCR67",69,0)
 I FBPROC]"" S I=0 F  S I=$O(^FBAAI(FBI,"RPROV",I)) Q:'I  D
"RTN","FBPCR67",70,0)
 . N X
"RTN","FBPCR67",71,0)
 . S X=$G(^FBAAI(FBI,"RPROV",I,0))
"RTN","FBPCR67",72,0)
 . I $P(X,U) S FB5010($P(X,U))=X
"RTN","FBPCR67",73,0)
 I $D(FB5010) M ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"RPROV")=FB5010 K FB5010
"RTN","FBPCR67",74,0)
 I $TR(FBY4,U)]"" S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBY4")=FBY4         ; FB*3.5*122
"RTN","FBPCR67",75,0)
 ;I FBPROC]"" K FB5010 F I=1:1:25 S:$P(FBPROC,U,I) FB5010(I)=$G(^FBAAI(FBI,"RPROV",I,0))          ; FB*3.5*122
"RTN","FBPCR67",76,0)
 ;I FBPROC]"" K FB5010 F I=1:1:25 S:$P(FBPROC,U,I) FB5010($P($G(^FBAAI(FBI,"RPROV",I,0)),U,1))=$G(^FBAAI(FBI,"RPROV",I,0))
"RTN","FBPCR67",77,0)
 ;I FBPROC]"" M ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"RPROV")=FB5010 K FB5010   ; FB*3.5*122 
"RTN","FBPCR67",78,0)
 Q
"RTN","FBPCR67",79,0)
ANC ;ancillary payments
"RTN","FBPCR67",80,0)
 N J,K,L,M,Y,FBDT1,FBVID I FBPI=67 N FBPI S FBPI=+$P(FBIN,U,12)
"RTN","FBPCR67",81,0)
 S J=DFN,FBCNT=0 I J,+FBIN(5),$D(^FBAAC("AM",FBIN(5),J)) D
"RTN","FBPCR67",82,0)
 .F K=0:0 S K=$O(^FBAAC("AM",FBIN(5),J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AM",FBIN(5),J,K,L)) Q:'L  D
"RTN","FBPCR67",83,0)
 ..S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]"" S FBDT1=$$DATX^FBAAUTL(FBDT1)
"RTN","FBPCR67",84,0)
 ..S M=0 F  S M=$O(^FBAAC("AM",FBIN(5),J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPCR67",85,0)
 ...D EN1^FBPCR2 Q:'$D(FBAACPTC)  S FBCNT=FBCNT+1
"RTN","FBPCR67",86,0)
 ...Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",87,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBVNAME_U_FBVID_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR67",88,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID
"RTN","FBPCR67",89,0)
 Q
"RTN","FBPCR671")
0^44^B46739204^B40566981
"RTN","FBPCR671",1,0)
FBPCR671 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY PRINT ;07/18/2006
"RTN","FBPCR671",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,76,98,122,108**;JAN 30, 1995;Build 115
"RTN","FBPCR671",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR671",4,0)
PRINT ;print data from tmp global
"RTN","FBPCR671",5,0)
 I FBPG>1&(($Y+12)>IOSL) D HDR Q:FBOUT
"RTN","FBPCR671",6,0)
 E  D HDR1
"RTN","FBPCR671",7,0)
 S FBPVLIST="ATTENDING PROV NAME^NPI^TAXONOMY CODE^OPERATING PROV NAME^NPI^RENDERING PROV NAME"
"RTN","FBPCR671",8,0)
 S FBPVLIST=FBPVLIST_"^NPI^TAXONOMY CODE^SERVICING PROV NAME^NPI^REFERRING PROV NAME^NPI"
"RTN","FBPCR671",9,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR671",10,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S FBI=0 F  S FBI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI)) Q:'FBI  D  Q:FBOUT
"RTN","FBPCR671",11,0)
 ..I ($Y+5)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",12,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI),FBCATC=$P(FBDATA,U,9),FBINS=$P(FBDATA,U,10)
"RTN","FBPCR671",13,0)
 ..S FBINV=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBINV")
"RTN","FBPCR671",14,0)
 ..W ! W:$P(FBDATA,U,8)["R" "*" W:$P(FBDATA,U,9)]"" "#"
"RTN","FBPCR671",15,0)
 ..W ?2,$P(FBDATA,U,1),?15,$P(FBDATA,U,5),?31,$P(FBDATA,U,6)
"RTN","FBPCR671",16,0)
 ..W ?47,$P(FBDATA,U,7),?57,$P(FBINV,U,2)
"RTN","FBPCR671",17,0)
 ..W !?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?25,$P(FBINV,U,1)
"RTN","FBPCR671",18,0)
 .. ;Print adj reasons, if null then print suspend code
"RTN","FBPCR671",19,0)
 ..W ?36,$S($P(FBINV,U,3)]"":$P(FBINV,U,3),1:$P(FBDATA,U,4))
"RTN","FBPCR671",20,0)
 ..W ?46,$S($P(FBINV,U,3)]"":$J($P(FBINV,U,4),14),1:$J($P(FBDATA,U,10),14))
"RTN","FBPCR671",21,0)
 ..W ?63,$P(FBINV,U,5)
"RTN","FBPCR671",22,0)
 ..; write admitting diagnosis if present
"RTN","FBPCR671",23,0)
 .. I $P(FBINV,U,6)'="" W !?6,"Admit Dx: ",$P(FBINV,U,6)
"RTN","FBPCR671",24,0)
 ..;F FBY="DX","PROC" I $D(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,FBY)) S FBDATA=^(FBY),FBSL=$L(FBDATA,"^") W !?2,FBY,": " F I=1:1:FBSL W $P(FBDATA,U,I),"    "
"RTN","FBPCR671",25,0)
 ..I $D(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"DX")) S FBDATA=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"DX")),FBSL=$L(FBDATA,"^") F I=1:1:FBSL D WRTDX
"RTN","FBPCR671",26,0)
 ..S FBNEWLN=1
"RTN","FBPCR671",27,0)
 ..I $D(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"PROC")) S FBDATA=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"PROC")),FBSL=$L(FBDATA,"^") F I=1:1:FBSL D WRTPC
"RTN","FBPCR671",28,0)
 ..K FBNEWLN
"RTN","FBPCR671",29,0)
 ..;I FBDATA]"" F I=1:1:FBSL I $P(FBDATA,U,I)]"" D                                                                                      ; FB*3.5*122
"RTN","FBPCR671",30,0)
 ..;.;W:FBRPROV !,?2,"PROC: " W:$G(FBRPROV)="" "    " W $P(FBDATA,U,I)                                                                         ; FB*3.5*122
"RTN","FBPCR671",31,0)
 ..;.;S FBRPROV=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"RPROV",I)) I FBRPROV="" Q                                                 ; FB*3.5*122
"RTN","FBPCR671",32,0)
 ..;.;W ?20,"RENDERING PROVIDER NAME: "_$P(FBRPROV,U,2),!,?21,"NPI: "_$P(FBRPROV,U,3),?46,"TAXONOMY CODE: "_$P(FBRPROV,U,4) S FBRPROV=1  ; FB*3.5*122
"RTN","FBPCR671",33,0)
 ..K FBRPROV
"RTN","FBPCR671",34,0)
 ..I FBCATC!FBINS D
"RTN","FBPCR671",35,0)
 ...W !?5,">>>"
"RTN","FBPCR671",36,0)
 ...I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",37,0)
 ...I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",38,0)
 ...I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",39,0)
 ...I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",40,0)
 ...I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",41,0)
 ..;
"RTN","FBPCR671",42,0)
 ..I +$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",0)) D  Q:FBOUT  W !,FBDASH1
"RTN","FBPCR671",43,0)
 ...S (FBOV,FBCNT)=0,FBSL=7 D SHA Q:FBOUT
"RTN","FBPCR671",44,0)
 ...F  S FBCNT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT)) Q:'FBCNT  S FBDATA=^(FBCNT),FBV=$P(FBDATA,U,11)_";"_$P(FBDATA,U,12) D  D WRT Q:FBOUT
"RTN","FBPCR671",45,0)
 ....N FBXX S FBXX=$O(^FBAAV("C",$P(FBDATA,U,12),"")) S $P(FBV,";",2)=$P(FBV,";",2)_"/"_$S(FBXX="":"**********",$P($G(^FBAAV(FBXX,3)),U,2)]"":$P(^FBAAV(FBXX,3),U,2),1:"**********")
"RTN","FBPCR671",46,0)
 ..D PRNT5010  ; FB*3.5*122
"RTN","FBPCR671",47,0)
 Q
"RTN","FBPCR671",48,0)
PRNT5010 ; Format and print based on data type  ; FB*3.5*122
"RTN","FBPCR671",49,0)
 N FBVDAT,FBCNT
"RTN","FBPCR671",50,0)
 I $G(FBPSF)]"",$G(FBPT)]"",$G(FBPI)]"",$G(FBVI)]"",$G(FBDT)]"",$G(FBI)]"",$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBY4"))]""
"RTN","FBPCR671",51,0)
 E  Q
"RTN","FBPCR671",52,0)
 W ! S FBVDAT=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBY4")
"RTN","FBPCR671",53,0)
 F FBCNT=1,6 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR671",54,0)
 . W !,$P(FBPVLIST,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVLIST,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR671",55,0)
 . W !,?6,$P(FBPVLIST,U,FBCNT+2)_": "_$P(FBVDAT,U,FBCNT+2)
"RTN","FBPCR671",56,0)
 F FBCNT=4,11,9 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR671",57,0)
 . W !,$P(FBPVLIST,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVLIST,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR671",58,0)
 I $P(FBVDAT,U,20)]"" D
"RTN","FBPCR671",59,0)
 . W !,"  SERVICING FACILITY ADDRESS: "_$P(FBVDAT,U,20),!,"                              "_$P(FBVDAT,U,21)_", "
"RTN","FBPCR671",60,0)
 . I $P(FBVDAT,U,22)]"" W $$GET1^DIQ(5,$P(FBVDAT,U,22)_",",.01)
"RTN","FBPCR671",61,0)
 . W " "_$P(FBVDAT,U,23)
"RTN","FBPCR671",62,0)
 W !
"RTN","FBPCR671",63,0)
 Q
"RTN","FBPCR671",64,0)
WRT ;write ancillary info
"RTN","FBPCR671",65,0)
 N FBCATC,FBINS,FBADJ I ($Y+4)>IOSL D PAGE Q:FBOUT  D SHA,SHA2
"RTN","FBPCR671",66,0)
 D:FBOV'=FBV SHA2
"RTN","FBPCR671",67,0)
 S FBADJ=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT,"FBADJ")
"RTN","FBPCR671",68,0)
 S FBCATC=$P(FBDATA,U,14),FBINS=$P(FBDATA,U,15)
"RTN","FBPCR671",69,0)
 W !
"RTN","FBPCR671",70,0)
 W ?1,$P(FBDATA,U,1)
"RTN","FBPCR671",71,0)
 W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPCR671",72,0)
 W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPCR671",73,0)
 W ?43,$P(FBDATA,U,6)
"RTN","FBPCR671",74,0)
 W ?54,$P(FBDATA,U,7)
"RTN","FBPCR671",75,0)
 W ?64,$P(FBDATA,U,8)
"RTN","FBPCR671",76,0)
 I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPCR671",77,0)
 . N FBI,FBMOD
"RTN","FBPCR671",78,0)
 . F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPCR671",79,0)
 . . I $Y+6>IOSL D PAGE Q:FBOUT  D SHA,SHA2 W !,"  (continued)"
"RTN","FBPCR671",80,0)
 . . W !,?16,"-",FBMOD
"RTN","FBPCR671",81,0)
 W !,$P(FBDATA,U,3)
"RTN","FBPCR671",82,0)
 W ?13,$P(FBDATA,U,4)
"RTN","FBPCR671",83,0)
 W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPCR671",84,0)
 W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPCR671",85,0)
 W ?48,$P(FBADJ,U,5)
"RTN","FBPCR671",86,0)
 W ?60,$P(FBADJ,U,6)
"RTN","FBPCR671",87,0)
 W !?5,"Primary Dx: ",$P(FBDATA,U,9),?40,"S/C Condition? ",$P(FBDATA,U,8),?66,"Obl.#: ",$P(FBDATA,U,10)
"RTN","FBPCR671",88,0)
 I FBCATC!FBINS D
"RTN","FBPCR671",89,0)
 .W !?5,">>>"
"RTN","FBPCR671",90,0)
 .I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",91,0)
 .I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",92,0)
 .I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",93,0)
 .I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",94,0)
 .I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",95,0)
 ;
"RTN","FBPCR671",96,0)
 Q
"RTN","FBPCR671",97,0)
HDR ;main header
"RTN","FBPCR671",98,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR671",99,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"FEE PROGRAM: ",FBXPROG
"RTN","FBPCR671",100,0)
 W !?1,"Invoice Date",?15,"Invoice No.",?31,"From Date",?48,"To Date",?57,"Patient Control #"
"RTN","FBPCR671",101,0)
 W !?1,"Amt Claimed",?15,"Amt Paid",?25,"Cov Days",?36,"Adj Codes",?49,"Adj Amounts",?63,"Remit Remarks",!,FBDASH
"RTN","FBPCR671",102,0)
 Q
"RTN","FBPCR671",103,0)
SH ;subheader - vendor, prints when name changed
"RTN","FBPCR671",104,0)
 I ($Y+7)>IOSL D HDR Q:FBOUT
"RTN","FBPCR671",105,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P($P(FBVI,";",2),"/",1)
"RTN","FBPCR671",106,0)
 W !?20,"Fee Basis Billing Provider NPI: ",$P(FBVI,"/",2)
"RTN","FBPCR671",107,0)
 Q
"RTN","FBPCR671",108,0)
SHA ;ancillary subheader
"RTN","FBPCR671",109,0)
 I ($Y+16)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",110,0)
 W !?20,">>> ANCILLARY SERVICE PAYMENTS <<<",!
"RTN","FBPCR671",111,0)
SHA1 ;subheader for ancillary data
"RTN","FBPCR671",112,0)
 W !!,?1,"Svc Date",?11,"CPT-MOD ",?19,"Travel Paid",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPCR671",113,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPCR671",114,0)
 Q
"RTN","FBPCR671",115,0)
SHA2 ;subheader for vendor name
"RTN","FBPCR671",116,0)
 I ($Y+9)>IOSL D HDR Q:FBOUT  D SH,SHA
"RTN","FBPCR671",117,0)
 I FBOV'=FBV S FBOV=FBV
"RTN","FBPCR671",118,0)
 W !!,"Vendor: ",$P(FBV,";"),?41,"Vendor ID/NPI: ",$P(FBV,";",2)
"RTN","FBPCR671",119,0)
 Q
"RTN","FBPCR671",120,0)
CR ;read for display
"RTN","FBPCR671",121,0)
 Q:'FBPG  S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR671",122,0)
 Q
"RTN","FBPCR671",123,0)
PAGE ;new page
"RTN","FBPCR671",124,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR671",125,0)
 Q
"RTN","FBPCR671",126,0)
WRTDX ;input
"RTN","FBPCR671",127,0)
 ; FBDATA contains node from ^TMP
"RTN","FBPCR671",128,0)
 ; I contains piece to be written
"RTN","FBPCR671",129,0)
 I I=1!($X+$L($P(FBDATA,"^",I))+1>IOM) W !,?4,"DX/POA: "
"RTN","FBPCR671",130,0)
 W $P(FBDATA,"^",I)," "
"RTN","FBPCR671",131,0)
 Q
"RTN","FBPCR671",132,0)
WRTPC ;input
"RTN","FBPCR671",133,0)
 ;FBDATA contains node from ^TMP
"RTN","FBPCR671",134,0)
 ;I contains piece to be written
"RTN","FBPCR671",135,0)
 ; if FBNEWLN true then force new line and label for procedure
"RTN","FBPCR671",136,0)
 N FBRPROV
"RTN","FBPCR671",137,0)
 S FBRPROV=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"RPROV",I))
"RTN","FBPCR671",138,0)
 ; start new line for procedures when appropriate
"RTN","FBPCR671",139,0)
 I FBRPROV'="" S FBNEWLN=1
"RTN","FBPCR671",140,0)
 I FBNEWLN!($X+$L($P(FBDATA,"^",I))+2>IOM) W !?4,"PROC: " S FBNEWLN=0
"RTN","FBPCR671",141,0)
 ; write procedure code
"RTN","FBPCR671",142,0)
 W $P(FBDATA,"^",I)," "
"RTN","FBPCR671",143,0)
 ; write line rendering provider data if applicable
"RTN","FBPCR671",144,0)
 I FBRPROV="" Q
"RTN","FBPCR671",145,0)
 W ?20,"RENDERING PROVIDER NAME: "_$P(FBRPROV,U,2)
"RTN","FBPCR671",146,0)
 W !?21,"NPI: "_$P(FBRPROV,U,3)
"RTN","FBPCR671",147,0)
 W ?46,"TAXONOMY CODE: "_$P(FBRPROV,U,4)
"RTN","FBPCR671",148,0)
 S FBNEWLN=1  ; force new line for next procedure
"RTN","FBPCR671",149,0)
 Q
"RTN","FBPCR671",150,0)
 ;I I=1!($X+$L($P(FBDATA,"^",I))+1>IOM) W !,?4,"PROC: "
"RTN","FBPCR671",151,0)
 ;W $P(FBDATA,"^",I)," "
"RTN","FBPCR671",152,0)
 ;Q
"RTN","FBPCR671",153,0)
 ;S FBRPROV=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"RPROV",I))                                                 ; FB*3.5*122
"RTN","FBPCR671",154,0)
 ;W !,?2,"PROC: ",$P(FBDATA,U,I) I FBRPROV="" Q                                                                       ; FB*3.5*122
"RTN","FBPCR671",155,0)
 ;W ?20,"RENDERING PROVIDER NAME: "_$P(FBRPROV,U,2),!,?21,"NPI: "_$P(FBRPROV,U,3),?46,"TAXONOMY CODE: "_$P(FBRPROV,U,4) S FBRPROV=1  ; FB*3.5*122
"RTN","FBPCR671",156,0)
 ;Q
"RTN","FBPCR671",157,0)
WRTSC ;write service connected
"RTN","FBPCR671",158,0)
 W !,"SERVICE CONNECTED? ",$S(+VAEL(3):"YES",1:"NO"),!
"RTN","FBPCR671",159,0)
 Q
"RTN","FBPRICE")
0^7^B22445892^B20572423
"RTN","FBPRICE",1,0)
FBPRICE ;AISC/DMK - GENERIC PRICER INTERFACE ;6/25/1992
"RTN","FBPRICE",2,0)
 ;;3.5;FEE BASIS;**108**;JAN 30, 1995;Build 115
"RTN","FBPRICE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPRICE",4,0)
 ;build a transaction to send to the Austin Pricer system
"RTN","FBPRICE",5,0)
 ;this data will NOT be stored anywhere. It serves only
"RTN","FBPRICE",6,0)
 ;as a tool to determine reimbursement rates.
"RTN","FBPRICE",7,0)
 S PAD="                              "
"RTN","FBPRICE",8,0)
 S FB("ERROR")="" D STATION^FBAAUTL G END:FB("ERROR") K FB("ERROR")
"RTN","FBPRICE",9,0)
 S FBAASN=FBAASN_$E(PAD,$L(FBAASN)+1,6)
"RTN","FBPRICE",10,0)
PAT ;ask patient name [this is not a look-up on file 2]
"RTN","FBPRICE",11,0)
 W ! S DIR("A")="Want to select patient from DHCP Patient File",DIR(0)="Y",DIR("B")="Yes" D ^DIR K DIR Q:$D(DIRUT)  I Y D  G END:'$D(FBSSN),VEND
"RTN","FBPRICE",12,0)
 .W ! S DIC="^DPT(",DIC(0)="AEQMZ" D ^DIC K DIC Q:X="^"!(X="")!(Y<0)
"RTN","FBPRICE",13,0)
 .D PAT^FBAAUTL2 S FBLNAM=$E(FBFLNAM,1,12),FBSSN=$E(FBSSN,10)_$E(FBSSN,1,9)_" "
"RTN","FBPRICE",14,0)
 ;
"RTN","FBPRICE",15,0)
 W ! S DIR("A")="Enter LAST NAME",DIR(0)="F^3:20^K:X'?.A X",DIR("?")="Enter last name of patient.  Answer must be 3 to 20 characters in length" D ^DIR K DIR Q:$D(DIRUT)  S FBLNAM=$E(Y,1,12)_$E(PAD,$L(Y)+1,12)
"RTN","FBPRICE",16,0)
 ;
"RTN","FBPRICE",17,0)
 S DIR("A")="Enter FIRST INITIAL",DIR(0)="F^1:1^K:X'?1A X" D ^DIR K DIR Q:$D(DIRUT)  S FBFI=Y
"RTN","FBPRICE",18,0)
 ;
"RTN","FBPRICE",19,0)
 S DIR("A")="Enter MIDDLE INITIAL",DIR(0)="FO^1:1^K:X'?1A X" D ^DIR K DIR Q:$D(DUOUT)!($D(DTOUT))  S FBMI=$S(Y]"":Y,1:" ")
"RTN","FBPRICE",20,0)
 ;
"RTN","FBPRICE",21,0)
 S FBNAME=FBLNAM_FBFI_FBMI
"RTN","FBPRICE",22,0)
SSN ;ASK SSN
"RTN","FBPRICE",23,0)
 S DIR("A")="Patient ID Number",DIR("?")="Answer must contain 9 numbers.  Pseudo-SSN not allowed",DIR(0)="F^9:9^K:X'?9N X" D ^DIR K DIR Q:$D(DIRUT)  S FBSSN=" "_Y_" "
"RTN","FBPRICE",24,0)
 ;
"RTN","FBPRICE",25,0)
DOB S DIR(0)="2,.03",DIR("A")="Date of Birth" D ^DIR K DIR Q:$D(DIRUT)  S FBDOB=$E(Y,4,7)_($E(Y,1,3)+1700)
"RTN","FBPRICE",26,0)
 ;
"RTN","FBPRICE",27,0)
SEX ;ask sex of patient
"RTN","FBPRICE",28,0)
 S DIR("A")="Sex of Patient",DIR(0)="2,.02" D ^DIR K DIR G END:$D(DIRUT) S FBSEX=Y
"RTN","FBPRICE",29,0)
VEND ;ask vendor
"RTN","FBPRICE",30,0)
 S DIR("A")="Want to select a vendor from DHCP Fee Basis Vendor file",DIR(0)="Y",DIR("B")="Yes" D ^DIR K DIR Q:$D(DIRUT)  I Y D  G END:+$G(FBOUT),VEND:'$D(FBVID),CONT
"RTN","FBPRICE",31,0)
 .W ! S DIC="^FBAAV(",DIC(0)="AEQMZ" D ^DIC K DIC S:X=""!(X="^") FBOUT=1 Q:Y<0  S FBSTABR=+$P(Y(0),"^",5),FBSTABR=$P($G(^DIC(5,FBSTABR,0)),"^",2),FBSTABR=$S('$L(FBSTABR):"  ",1:FBSTABR)
"RTN","FBPRICE",32,0)
 .S FBVID=$P(Y(0),"^",17) I FBVID="" K FBVID W !!,*7,"Vendor must have a Medicare ID number to send to the pricer.",! Q
"RTN","FBPRICE",33,0)
 W ! S DIR("A")="Select Vendor Name",DIR(0)="F^2:46" D ^DIR K DIR G END:$D(DIRUT) S FBVEN=Y
"RTN","FBPRICE",34,0)
 S DIR("A")="Enter Medicare ID Number",DIR(0)="161.2,22" D ^DIR K DIR G END:$D(DIRUT) S FBVID=Y
"RTN","FBPRICE",35,0)
 S DIR("A")="State of Vendor",DIR(0)="P^5:EQMZ" D ^DIR K DIR G END:$D(DIRUT) S FBSTABR=$S($L($P(Y(0),"^",2)):$P(Y(0),"^",2),1:"  ")
"RTN","FBPRICE",36,0)
 ;
"RTN","FBPRICE",37,0)
CONT ;
"RTN","FBPRICE",38,0)
 I $L(FBSTABR)>2 D  G VEND
"RTN","FBPRICE",39,0)
 . W !,"Error: Vendor state abbreviation (",FBSTABR,") exceeds 2 characters.",!
"RTN","FBPRICE",40,0)
 ;ask admission and treatment type information
"RTN","FBPRICE",41,0)
 W ! S DIR("A")="Admission Date: ",DIR(0)="DA^::EX",DIR("?")="^D HELP^%DTC" D ^DIR K DIR G END:$D(DIRUT) S FBFDT=Y
"RTN","FBPRICE",42,0)
 S DIR("A")="Discharge Date: ",DIR(0)="DA^"_FBFDT_"::EX",DIR("?")="^D HELP^%DTC" D ^DIR K DIR G END:$D(DIRUT) S FBTDT=Y
"RTN","FBPRICE",43,0)
 S X1=FBTDT,X2=FBFDT D ^%DTC S FBLOS=$S(X<1:1,1:X),FBLOS=$E("000",$L(FBLOS)+1,3)_FBLOS
"RTN","FBPRICE",44,0)
 I $L(FBLOS)>3 D  G CONT
"RTN","FBPRICE",45,0)
 . W !,"Error: Length of Stay (",FBLOS,") exceeds 999.",!
"RTN","FBPRICE",46,0)
 S FBCSVDT=FBTDT ; code set version date
"RTN","FBPRICE",47,0)
 F I="FBFDT","FBTDT" S @I=$E(@I,4,7)_($E(@I,1,3)+1700)
"RTN","FBPRICE",48,0)
 ;
"RTN","FBPRICE",49,0)
 S DIR(0)="P^43.4:EQM",DIR("A")="Admitting Authority" D ^DIR K DIR G END:$D(DIRUT) S Z=+Y
"RTN","FBPRICE",50,0)
 S FBAUTH=$$AUTH^FBAAV6(Z) K Z
"RTN","FBPRICE",51,0)
 ;
"RTN","FBPRICE",52,0)
 S DIR("A")="Disposition Code",DIR(0)="P^162.6:QEMZ" D ^DIR K DIR G END:$D(DIRUT) S FBDISP=$E("00",$L($P(Y(0),"^",2))+1,2)_$P(Y(0),"^",2)
"RTN","FBPRICE",53,0)
 ;
"RTN","FBPRICE",54,0)
 S DIR("A")="Is this a Patient Reimbursement",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR G END:$D(DIRUT) S FBPAYT=$S(Y:"P",1:"V")
"RTN","FBPRICE",55,0)
 ;
"RTN","FBPRICE",56,0)
 S DIR("A")="Payment by Medicare or Other Federal Agency",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR G END:$D(DIRUT) S FBMED=$S(Y:"Y",1:"N")
"RTN","FBPRICE",57,0)
 ;
"RTN","FBPRICE",58,0)
 D ^FBPRICE1
"RTN","FBPRICE",59,0)
 ;
"RTN","FBPRICE",60,0)
END K FBSTAN,FBAUTH,FBBILL,FBCLAIM,FBDISP,FBDOB,FBDX,FBFDT,FBFI,FBFLNAM,FBLNAM,FBLOS,FBMED,FBMI,FBNAME,FBOBL,FBPAYT,FBPRC,FBSEX,FBSITE,FB,FBAASN,FBFEE,FBI,FBJ,FBLN,FBNVP,FBOKTX,FBSN,FBXMZ
"RTN","FBPRICE",61,0)
 K FBSSN,FBSTR,FBSTABR,FBTDT,FBVID,PAD,POP,PRC,DUOUT,DTOUT,DIRUT,DIR,FBPART1,FBVEN,FBSDI,VAT,VATERR,VATNAME,Y,FBPOP,FBVAR,FBXMFEE,FBXMNVP,FBPOP
"RTN","FBPRICE",62,0)
 K FBADMTDX,FBCSVDT,FBOUT,FBPOA,FBRESUB,X,X1,X2
"RTN","FBPRICE",63,0)
 Q
"RTN","FBPRICE1")
0^8^B12291028^B8962799
"RTN","FBPRICE1",1,0)
FBPRICE1 ;AISC/DMK,WOIFO/SAB - GENERIC PRICER INTERFACE CON'T ;9/14/2009
"RTN","FBPRICE1",2,0)
 ;;3.5;FEE BASIS;**56,55,77,108**;JAN 30, 1995;Build 115
"RTN","FBPRICE1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPRICE1",4,0)
 ;
"RTN","FBPRICE1",5,0)
 N FBCDCNT,FBCNT,FBI,FBLNCNT,FBRT,FBTL,FBVAL,ICDVDT
"RTN","FBPRICE1",6,0)
 S ICDVDT=FBCSVDT ; date for file 80 and 80.1 identifier logic
"RTN","FBPRICE1",7,0)
 S FBCNT=0 ; count of codes
"RTN","FBPRICE1",8,0)
 ;
"RTN","FBPRICE1",9,0)
ICD ;ask Dx
"RTN","FBPRICE1",10,0)
 W !
"RTN","FBPRICE1",11,0)
 F I=1:1:25 D  Q:X=""!($D(DTOUT))!($D(DUOUT))
"RTN","FBPRICE1",12,0)
 . S DIR(0)="PO^80:EQMZ"
"RTN","FBPRICE1",13,0)
 . F  D ^DIR Q:X=""!($D(DTOUT))!($D(DUOUT))!(+Y'>0)  S FBVAL=+Y,FBRT=$$CHKICD9^FBCSV1(FBVAL,FBCSVDT) I FBRT]"" S FBDX(I)=FBVAL,FBCNT=FBCNT+1 Q
"RTN","FBPRICE1",14,0)
 . K DIR
"RTN","FBPRICE1",15,0)
 . Q:'$G(FBDX(I))
"RTN","FBPRICE1",16,0)
 . ; ask POA
"RTN","FBPRICE1",17,0)
 . S DIR(0)="P^161.94:EQM"
"RTN","FBPRICE1",18,0)
 . D ^DIR K DIR
"RTN","FBPRICE1",19,0)
 . Q:$D(DTOUT)!$D(DUOUT)
"RTN","FBPRICE1",20,0)
 . S FBPOA(I)=+Y
"RTN","FBPRICE1",21,0)
 I $D(DTOUT)!($D(DUOUT)) G END^FBPRICE
"RTN","FBPRICE1",22,0)
 I '$G(FBDX(1)) W !,*7,"Must enter at least a primary diagnosis.",! G ICD
"RTN","FBPRICE1",23,0)
 K DIR,I
"RTN","FBPRICE1",24,0)
 ;
"RTN","FBPRICE1",25,0)
ADMITDX ;ask admitting diagnosis
"RTN","FBPRICE1",26,0)
 W ! S DIR(0)="162.5,39",DIR("A")="Admitting Diagnosis"
"RTN","FBPRICE1",27,0)
 D ^DIR K DIR
"RTN","FBPRICE1",28,0)
 G END^FBPRICE:$D(DIRUT)
"RTN","FBPRICE1",29,0)
 S FBVAL=+Y
"RTN","FBPRICE1",30,0)
 S FBRT=$$CHKICD9^FBCSV1(FBVAL,FBCSVDT)
"RTN","FBPRICE1",31,0)
 I FBRT="" G ADMITDX
"RTN","FBPRICE1",32,0)
 S FBADMTDX=FBVAL
"RTN","FBPRICE1",33,0)
 S FBCNT=FBCNT+1
"RTN","FBPRICE1",34,0)
 ;
"RTN","FBPRICE1",35,0)
PROC ;ask procedure codes
"RTN","FBPRICE1",36,0)
 W !
"RTN","FBPRICE1",37,0)
 S DIR(0)="PO^80.1:EQM"
"RTN","FBPRICE1",38,0)
 F I=1:1:25 D  Q:X=""!($D(DUOUT))!($D(DTOUT))
"RTN","FBPRICE1",39,0)
 . F  D ^DIR Q:X=""!($D(DUOUT))!($D(DTOUT))!(+Y'>0)  S FBVAL=+Y,FBRT=$$CHKICD0^FBCSV1(FBVAL,FBCSVDT) I FBRT]"" S FBPRC(I)=FBVAL,FBCNT=FBCNT+1 Q
"RTN","FBPRICE1",40,0)
 I $D(DTOUT)!($D(DUOUT)) G END^FBPRICE
"RTN","FBPRICE1",41,0)
 K DIR,I
"RTN","FBPRICE1",42,0)
 ;
"RTN","FBPRICE1",43,0)
 W ! S DIR(0)="162.5,6.6",DIR("A")="Billed Charges"
"RTN","FBPRICE1",44,0)
 D ^DIR K DIR G END^FBPRICE:$D(DIRUT)
"RTN","FBPRICE1",45,0)
 S FBBILL=$FN(Y,"",2),FBBILL=$TR(FBBILL,".")
"RTN","FBPRICE1",46,0)
 S FBBILL=$E("000000000",$L(FBBILL)+1,9)_FBBILL
"RTN","FBPRICE1",47,0)
 ;
"RTN","FBPRICE1",48,0)
 S DIR(0)="162.5,6.6",DIR("A")="Amount Claimed"
"RTN","FBPRICE1",49,0)
 D ^DIR K DIR G END^FBPRICE:$D(DIRUT)
"RTN","FBPRICE1",50,0)
 S FBCLAIM=$FN(Y,"",2),FBCLAIM=$TR(FBCLAIM,".")
"RTN","FBPRICE1",51,0)
 S FBCLAIM=$E("000000000",$L(FBCLAIM)+1,9)_FBCLAIM
"RTN","FBPRICE1",52,0)
 ;
"RTN","FBPRICE1",53,0)
 S FBOBL="000000"
"RTN","FBPRICE1",54,0)
 ;
"RTN","FBPRICE1",55,0)
STRING ;set-up message text for pricer
"RTN","FBPRICE1",56,0)
 W ! D WAIT^DICD
"RTN","FBPRICE1",57,0)
 D ADDRESS^FBAAV01 Q:$G(VATERR)  K VAT
"RTN","FBPRICE1",58,0)
 S FBTL=(FBCNT-1)\13+2 ; total number of lines needed
"RTN","FBPRICE1",59,0)
 S FBFLAG=1 D NEWMSG^FBAAV01
"RTN","FBPRICE1",60,0)
 S FBRESUB=2 ; 2 identifies the message as generic pricer
"RTN","FBPRICE1",61,0)
 S FBLNCNT=0 ; init invoice line counter
"RTN","FBPRICE1",62,0)
 D NEWLN^FBAAV6
"RTN","FBPRICE1",63,0)
 S FBSTR=FBSTR_FBTL_FBLNAM_FBFI_FBMI_FBSEX_FBDOB_FBLOS
"RTN","FBPRICE1",64,0)
 S FBSTR=FBSTR_FBDISP_FBBILL_FBCLAIM_FBAUTH_FBPAYT_FBOBL_"Y"
"RTN","FBPRICE1",65,0)
 S FBSTR=FBSTR_FBVID_FBMED_$E(PAD,1,29)_FBTDT_FBSTABR_"  "
"RTN","FBPRICE1",66,0)
 D STORE^FBAAV01
"RTN","FBPRICE1",67,0)
 ;
"RTN","FBPRICE1",68,0)
 D NEWLN^FBAAV6
"RTN","FBPRICE1",69,0)
 S FBCDCNT=1 ; count of codes in the line (=1 for admit dx)
"RTN","FBPRICE1",70,0)
 S FBSTR=FBSTR_$$DX^FBAAV6(FBADMTDX,FBCSVDT,"")
"RTN","FBPRICE1",71,0)
 ; loop thru Dx
"RTN","FBPRICE1",72,0)
 F FBI=1:1:25 Q:'$G(FBDX(FBI))  D
"RTN","FBPRICE1",73,0)
 . S FBCDCNT=FBCDCNT+1
"RTN","FBPRICE1",74,0)
 . I FBCDCNT=14 D
"RTN","FBPRICE1",75,0)
 . . D STORE^FBAAV01
"RTN","FBPRICE1",76,0)
 . . D NEWLN^FBAAV6
"RTN","FBPRICE1",77,0)
 . . S FBCDCNT=1
"RTN","FBPRICE1",78,0)
 . S FBSTR=FBSTR_$$DX^FBAAV6(FBDX(FBI),FBCSVDT,FBPOA(FBI))
"RTN","FBPRICE1",79,0)
 ; loop thru proc
"RTN","FBPRICE1",80,0)
 F FBI=1:1:25 Q:'$G(FBPRC(FBI))  D
"RTN","FBPRICE1",81,0)
 . S FBCDCNT=FBCDCNT+1
"RTN","FBPRICE1",82,0)
 . I FBCDCNT=14 D
"RTN","FBPRICE1",83,0)
 . . D STORE^FBAAV01
"RTN","FBPRICE1",84,0)
 . . D NEWLN^FBAAV6
"RTN","FBPRICE1",85,0)
 . . S FBCDCNT=1
"RTN","FBPRICE1",86,0)
 . S FBSTR=FBSTR_$$PROC^FBAAV6(FBPRC(FBI),FBCSVDT)
"RTN","FBPRICE1",87,0)
 ; pad remainder of last line with spaces and save it
"RTN","FBPRICE1",88,0)
 S FBSTR=$$LJ^XLFSTR(FBSTR,131," ")
"RTN","FBPRICE1",89,0)
 D STORE^FBAAV01
"RTN","FBPRICE1",90,0)
 ;
"RTN","FBPRICE1",91,0)
 D XMIT^FBAAV01 K FBFLAG
"RTN","FBPRICE1",92,0)
 W !,"Case sent to pricer.",!
"RTN","FBPRICE1",93,0)
 Q
"RTN","FBSHAUT")
0^28^B73848186^B73464234
"RTN","FBSHAUT",1,0)
FBSHAUT ;WCIOFO/SAB - ENTER/EDIT STATE HOME AUTHORIZATION ;6/5/2009
"RTN","FBSHAUT",2,0)
 ;;3.5;FEE BASIS;**13,108**;JAN 30, 1995;Build 115
"RTN","FBSHAUT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBSHAUT",4,0)
 ;
"RTN","FBSHAUT",5,0)
ADD ; Enter new authorization
"RTN","FBSHAUT",6,0)
 ; Called from option FBSH ENTER AUTH
"RTN","FBSHAUT",7,0)
 D SETUP
"RTN","FBSHAUT",8,0)
 I 'FBPOP F  D  Q:'$G(DFN)
"RTN","FBSHAUT",9,0)
 . ; select patient
"RTN","FBSHAUT",10,0)
 . D PAT Q:'$G(DFN)
"RTN","FBSHAUT",11,0)
 . ; show patient demographics
"RTN","FBSHAUT",12,0)
 . S FBPROG(0)=FBPROG
"RTN","FBSHAUT",13,0)
 . S FBPROG="I $P(^(0),U,3)=FBPROG(0)"
"RTN","FBSHAUT",14,0)
 . D ^FBAADEM
"RTN","FBSHAUT",15,0)
 . S FBPROG=FBPROG(0)
"RTN","FBSHAUT",16,0)
 . ; get dates
"RTN","FBSHAUT",17,0)
 . D BDATES
"RTN","FBSHAUT",18,0)
 . I FBBEGDT]"" D
"RTN","FBSHAUT",19,0)
 . . ; add/edit authorization
"RTN","FBSHAUT",20,0)
 . . S DA(1)=DFN,X=FBBEGDT
"RTN","FBSHAUT",21,0)
 . . S DIC="^FBAAA("_DA(1)_",1,",DIC(0)="LQ",DLAYGO=161
"RTN","FBSHAUT",22,0)
 . . S DIC("DR")=".02////^S X=FBENDDT;.03////^S X=FBPROG;.095////4;100////^S X=DUZ;S FBTYPE=FBPROG;.07"
"RTN","FBSHAUT",23,0)
 . . S DIC("P")=$P(^DD(161,1,0),U,2)
"RTN","FBSHAUT",24,0)
 . . K DD,DO D FILE^DICN K DIC,DLAYGO
"RTN","FBSHAUT",25,0)
 . . I Y'>0 W $C(7),!,"AUTH. NOT ADDED" Q
"RTN","FBSHAUT",26,0)
 . . S (DA,FBAAADA)=+Y
"RTN","FBSHAUT",27,0)
 . . ; edit remaining fields
"RTN","FBSHAUT",28,0)
 . . S DIE="^FBAAA("_DA(1)_",1,"
"RTN","FBSHAUT",29,0)
 . . S DR=".04;.021"
"RTN","FBSHAUT",30,0)
 . . D ^DIE K DIE
"RTN","FBSHAUT",31,0)
 . . ; queue MRA
"RTN","FBSHAUT",32,0)
 . . S FBX=$$QMRA(DFN,FBAAADA,"A")
"RTN","FBSHAUT",33,0)
 . ;
"RTN","FBSHAUT",34,0)
 . ; unlock patient
"RTN","FBSHAUT",35,0)
 . L -^FBAAA(DFN,FBPROG)
"RTN","FBSHAUT",36,0)
 D WRAPUP
"RTN","FBSHAUT",37,0)
 Q
"RTN","FBSHAUT",38,0)
 ;
"RTN","FBSHAUT",39,0)
CHANGE ; Change existing authorization
"RTN","FBSHAUT",40,0)
 ; Called from option FBSH CHANGE AUTH
"RTN","FBSHAUT",41,0)
 D SETUP
"RTN","FBSHAUT",42,0)
 I 'FBPOP F  D  Q:'$G(DFN)
"RTN","FBSHAUT",43,0)
 . ; select patient
"RTN","FBSHAUT",44,0)
 . D PAT Q:'$G(DFN)
"RTN","FBSHAUT",45,0)
 . ; select existing authorization
"RTN","FBSHAUT",46,0)
 . S FBPROG(0)=FBPROG
"RTN","FBSHAUT",47,0)
 . S FBPROG="I $P(^(0),U,3)=FBPROG(0)"
"RTN","FBSHAUT",48,0)
 . D GETAUTH^FBAAUTL1 S FBPROG=FBPROG(0)
"RTN","FBSHAUT",49,0)
 . I FTP'="" D
"RTN","FBSHAUT",50,0)
 . . S (DA,FBAAADA)=FTP,DA(1)=DFN
"RTN","FBSHAUT",51,0)
 . . I $P($G(FBDMRA),U) W $C(7),!,"AUTH IS AUSTIN DELETED. USE THE REINSTATE OPTION TO CHANGE IT." Q
"RTN","FBSHAUT",52,0)
 . . ; save current data
"RTN","FBSHAUT",53,0)
 . . S FBAOLD=$G(^FBAAA(DA(1),1,DA,0)),FBANEW=""
"RTN","FBSHAUT",54,0)
 . . S FBBEGDT=$P(FBAOLD,U),FBENDDT=$P(FBAOLD,U,2)
"RTN","FBSHAUT",55,0)
 . . ; display current data
"RTN","FBSHAUT",56,0)
 . . W !!,"FROM DATE: ",$$FMTE^XLFDT(FBBEGDT)," (No Editing)"
"RTN","FBSHAUT",57,0)
 . . ; edit TO DATE and check for conflicts
"RTN","FBSHAUT",58,0)
 . . D TDATE Q:FBENDDT=""
"RTN","FBSHAUT",59,0)
 . . ; update/edit fields
"RTN","FBSHAUT",60,0)
 . . S DIE="^FBAAA("_DA(1)_",1,"
"RTN","FBSHAUT",61,0)
 . . S DR=".02////^S X=FBENDDT;100////^S X=DUZ;S FBTYPE=FBPROG;.07;.04;.021"
"RTN","FBSHAUT",62,0)
 . . D ^DIE K DIE
"RTN","FBSHAUT",63,0)
 . . ; if TO DATE or PURPOSE OF VISIT changed then queue MRA
"RTN","FBSHAUT",64,0)
 . . S FBANEW=$G(^FBAAA(DA(1),1,DA,0))
"RTN","FBSHAUT",65,0)
 . . I $P(FBANEW,U,2)'=$P(FBAOLD,U,2)!($P(FBANEW,U,7)'=$P(FBAOLD,U,7)) D
"RTN","FBSHAUT",66,0)
 . . . ; queue MRA
"RTN","FBSHAUT",67,0)
 . . . S FBX=$$QMRA(DFN,FBAAADA,"C")
"RTN","FBSHAUT",68,0)
 . ;
"RTN","FBSHAUT",69,0)
 . ; unlock patient
"RTN","FBSHAUT",70,0)
 . L -^FBAAA(DFN,FBPROG)
"RTN","FBSHAUT",71,0)
 D WRAPUP
"RTN","FBSHAUT",72,0)
 Q
"RTN","FBSHAUT",73,0)
 ;
"RTN","FBSHAUT",74,0)
DELETE ; Delete existing authorization
"RTN","FBSHAUT",75,0)
 ; Called from option FBSH DELETE AUTH
"RTN","FBSHAUT",76,0)
 D SETUP
"RTN","FBSHAUT",77,0)
 I 'FBPOP F  D  Q:'$G(DFN)
"RTN","FBSHAUT",78,0)
 . ; select patient
"RTN","FBSHAUT",79,0)
 . D PAT Q:'$G(DFN)
"RTN","FBSHAUT",80,0)
 . ; select existing authorization
"RTN","FBSHAUT",81,0)
 . S FBPROG(0)=FBPROG
"RTN","FBSHAUT",82,0)
 . S FBPROG="I $P(^(0),U,3)=FBPROG(0)"
"RTN","FBSHAUT",83,0)
 . D GETAUTH^FBAAUTL1 S FBPROG=FBPROG(0)
"RTN","FBSHAUT",84,0)
 . I FTP'="" D
"RTN","FBSHAUT",85,0)
 . . N FBY
"RTN","FBSHAUT",86,0)
 . . S (DA,FBAAADA)=FTP,DA(1)=DFN
"RTN","FBSHAUT",87,0)
 . . ; confirm
"RTN","FBSHAUT",88,0)
 . . S FBY=$G(^FBAAA(DFN,1,FTP,0))
"RTN","FBSHAUT",89,0)
 . . S DIR(0)="Y",DIR("A")="OK to DELETE the "_$$FMTE^XLFDT($P(FBY,U),2)_"-"_$$FMTE^XLFDT($P(FBY,U,2),2)_" authorization"
"RTN","FBSHAUT",90,0)
 . . D ^DIR K DIR Q:'Y
"RTN","FBSHAUT",91,0)
 . . ; queue MRA, update ADEL node
"RTN","FBSHAUT",92,0)
 . . S FBX=$$QMRA(DFN,FBAAADA,"D")
"RTN","FBSHAUT",93,0)
 . . S $P(^FBAAA(DFN,1,FBAAADA,"ADEL"),U,1,2)="1^"_DT
"RTN","FBSHAUT",94,0)
 . ;
"RTN","FBSHAUT",95,0)
 . ; unlock patient
"RTN","FBSHAUT",96,0)
 . L -^FBAAA(DFN,FBPROG)
"RTN","FBSHAUT",97,0)
 D WRAPUP
"RTN","FBSHAUT",98,0)
 Q
"RTN","FBSHAUT",99,0)
 ;
"RTN","FBSHAUT",100,0)
REINSTA ; Reinstate deleted authorization
"RTN","FBSHAUT",101,0)
 ; Called from option FBSH REINSTATE AUTH
"RTN","FBSHAUT",102,0)
 D SETUP
"RTN","FBSHAUT",103,0)
 I 'FBPOP F  D  Q:'$G(DFN)
"RTN","FBSHAUT",104,0)
 . ; select patient
"RTN","FBSHAUT",105,0)
 . D PAT Q:'$G(DFN)
"RTN","FBSHAUT",106,0)
 . ; select existing deleted authorization
"RTN","FBSHAUT",107,0)
 . S FBPROG(0)=FBPROG
"RTN","FBSHAUT",108,0)
 . S FBPROG="I $P(^(0),U,3)=FBPROG(0),$P($G(^(""ADEL"")),U)"
"RTN","FBSHAUT",109,0)
 . D GETAUTH^FBAAUTL1 S FBPROG=FBPROG(0)
"RTN","FBSHAUT",110,0)
 . I FTP'="" D
"RTN","FBSHAUT",111,0)
 . . S (DA,FBAAADA)=FTP,DA(1)=DFN
"RTN","FBSHAUT",112,0)
 . . ; confirm
"RTN","FBSHAUT",113,0)
 . . ; save current data
"RTN","FBSHAUT",114,0)
 . . S FBAOLD=$G(^FBAAA(DA(1),1,DA,0)),FBANEW=""
"RTN","FBSHAUT",115,0)
 . . S FBBEGDT=$P(FBAOLD,U),FBENDDT=$P(FBAOLD,U,2)
"RTN","FBSHAUT",116,0)
 . . ; display current data
"RTN","FBSHAUT",117,0)
 . . W !!,"FROM DATE: ",$$FMTE^XLFDT(FBBEGDT)," (No Editing)"
"RTN","FBSHAUT",118,0)
 . . ; edit TO DATE and check for conflicts
"RTN","FBSHAUT",119,0)
 . . D TDATE Q:FBENDDT=""
"RTN","FBSHAUT",120,0)
 . . ; update/edit fields
"RTN","FBSHAUT",121,0)
 . . S DIE="^FBAAA("_DA(1)_",1,"
"RTN","FBSHAUT",122,0)
 . . S DR=".02////^S X=FBENDDT;100////^S X=DUZ;S FBTYPE=FBPROG;.07;.04;.021"
"RTN","FBSHAUT",123,0)
 . . D ^DIE K DIE
"RTN","FBSHAUT",124,0)
 . . ; queue MRA, clear ADEL node
"RTN","FBSHAUT",125,0)
 . . S FBX=$$QMRA(DFN,FBAAADA,"R")
"RTN","FBSHAUT",126,0)
 . . K ^FBAAA(DFN,1,FBAAADA,"ADEL")
"RTN","FBSHAUT",127,0)
 . ;
"RTN","FBSHAUT",128,0)
 . ; unlock patient
"RTN","FBSHAUT",129,0)
 . L -^FBAAA(DFN,FBPROG)
"RTN","FBSHAUT",130,0)
 D WRAPUP
"RTN","FBSHAUT",131,0)
 Q
"RTN","FBSHAUT",132,0)
 ;
"RTN","FBSHAUT",133,0)
SETUP ; initial setup - returns FBPOP = 1 when problem
"RTN","FBSHAUT",134,0)
 D SITEP^FBAAUTL Q:FBPOP
"RTN","FBSHAUT",135,0)
 S FBAADDYS=+$P(FBSITE(0),"^",13),FBAAASKV=$P(FBSITE(1),"^",1)
"RTN","FBSHAUT",136,0)
 ;
"RTN","FBSHAUT",137,0)
 S FBPROG=$O(^FBAA(161.8,"B","STATE HOME",0))
"RTN","FBSHAUT",138,0)
 I 'FBPROG D  Q
"RTN","FBSHAUT",139,0)
 . W $C(7)
"RTN","FBSHAUT",140,0)
 . W !,"ERROR. STATE HOME not found in FEE BASIS PROGRAM (#161.8) file."
"RTN","FBSHAUT",141,0)
 . W !,"Unable to process State Home authorization. Please contact IRM."
"RTN","FBSHAUT",142,0)
 . S FBPOP=1
"RTN","FBSHAUT",143,0)
 Q
"RTN","FBSHAUT",144,0)
 ;
"RTN","FBSHAUT",145,0)
PAT ; select patient
"RTN","FBSHAUT",146,0)
 ; returns DFN as patient ien (or undef if not selected)
"RTN","FBSHAUT",147,0)
 K DFN
"RTN","FBSHAUT",148,0)
 W ! S DIC="^DPT(",DIC(0)="QEAZM" D ^DIC Q:Y'>0  S DFN=+Y
"RTN","FBSHAUT",149,0)
 I $P($G(^DPT(DFN,.361)),"^")="" W !!,"ELIGIBILITY HAS NOT BEEN DETERMINED NOR PENDING, CANNOT ENTER AN AUTHORIZATION." G PAT
"RTN","FBSHAUT",150,0)
 I $P($G(^DPT(DFN,.32)),"^",4)=2 W !!?4,"VETERAN HAS A DISHONORABLE DISCHARGE, " S X=$P($G(^(.321)),"^") W $S(X="Y":"ONLY ELIGIBLE FOR AGENT ORANGE EXAM.",1:"NOT ELIGIBLE FOR BENEFITS.")
"RTN","FBSHAUT",151,0)
 I "N"[$E(X) W ! S DIR("A")="Do you want to continue",DIR(0)="Y",DIR("B")="No" D ^DIR K DIR G PAT:$S($D(DIRUT):1,'Y:1,1:0)
"RTN","FBSHAUT",152,0)
 ; if patient not in file #161 then add
"RTN","FBSHAUT",153,0)
 I '$D(^FBAAA(DFN,0)) D   I Y'>0 W $C(7),!,"ERROR ADDING TO #161" K DFN Q
"RTN","FBSHAUT",154,0)
 . S DA=DFN
"RTN","FBSHAUT",155,0)
 . L +^FBAAA(DA):5 I '$T S Y="" Q
"RTN","FBSHAUT",156,0)
 . K DD,DO S (X,DINUM)=DA
"RTN","FBSHAUT",157,0)
 . S DIC="^FBAAA(",DIC(0)="LM",DLAYGO=161
"RTN","FBSHAUT",158,0)
 . D FILE^DICN K DIC,DINUM
"RTN","FBSHAUT",159,0)
 . L -^FBAAA(DFN)
"RTN","FBSHAUT",160,0)
 ; lock patient/program
"RTN","FBSHAUT",161,0)
 L +^FBAAA(DFN,FBPROG):5 I '$T D  G PAT
"RTN","FBSHAUT",162,0)
 . W $C(7),!,"ANOTHER USER IS EDITING THIS PATIENT & PROGRAM. PLEASE TRY AGAIN LATER."
"RTN","FBSHAUT",163,0)
 Q
"RTN","FBSHAUT",164,0)
 ;
"RTN","FBSHAUT",165,0)
WRAPUP ; clean-up
"RTN","FBSHAUT",166,0)
 K DFN,FB,FBAAADA,FBAAASKV,FBAADDYS,FBANEW,FBAOLD,FBBEGDT
"RTN","FBSHAUT",167,0)
 K FBDMRA,FBENDDT,FBOPT,FBPOP,FBPROG,FBSITE,FTP,FBTYPE,FBX
"RTN","FBSHAUT",168,0)
 K DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,X,Y
"RTN","FBSHAUT",169,0)
 D GETAUTHK^FBAAUTL1
"RTN","FBSHAUT",170,0)
 Q
"RTN","FBSHAUT",171,0)
 ;
"RTN","FBSHAUT",172,0)
BDATES ; get both from and to dates of new authorization
"RTN","FBSHAUT",173,0)
 ; input
"RTN","FBSHAUT",174,0)
 ;   DFN     patient ien in file 161
"RTN","FBSHAUT",175,0)
 ;   FBPROG  program ien in file 
"RTN","FBSHAUT",176,0)
 ; output
"RTN","FBSHAUT",177,0)
 ;   FBBEGDT From Date, FileMan format, null if dates not selected
"RTN","FBSHAUT",178,0)
 ;   FBENDDT To Date, FileMan format, null if dates not selected
"RTN","FBSHAUT",179,0)
 ;
"RTN","FBSHAUT",180,0)
 S %DT("A")="Enter FROM DATE: ",%DT="AEX"
"RTN","FBSHAUT",181,0)
 D ^%DT K %DT I Y'>0 S (FBBEGDT,FBENDDT)="" Q
"RTN","FBSHAUT",182,0)
 S FBBEGDT=Y
"RTN","FBSHAUT",183,0)
 ;
"RTN","FBSHAUT",184,0)
 S %DT("A")="Enter TO DATE: ",%DT="AEX",%DT(0)=FBBEGDT
"RTN","FBSHAUT",185,0)
 D ^%DT K %DT I Y'>0 S (FBBEGDT,FBENDDT)="" Q
"RTN","FBSHAUT",186,0)
 S FBENDDT=Y
"RTN","FBSHAUT",187,0)
 ; ensure dates do not conflict with existing authorization
"RTN","FBSHAUT",188,0)
 S FBX=$$CONFLICT(DFN,FBPROG,FBBEGDT,FBENDDT,1)
"RTN","FBSHAUT",189,0)
 I FBX D RCON(DFN,FBX) G BDATES
"RTN","FBSHAUT",190,0)
 Q
"RTN","FBSHAUT",191,0)
 ;
"RTN","FBSHAUT",192,0)
TDATE ; get to date for existing authorization
"RTN","FBSHAUT",193,0)
 ; input
"RTN","FBSHAUT",194,0)
 ;   DFN     patient ien in file 161
"RTN","FBSHAUT",195,0)
 ;   FBPROG  program ien in file
"RTN","FBSHAUT",196,0)
 ;   FBBEGDT From Date, FileMan format
"RTN","FBSHAUT",197,0)
 ;   FBENDDT (optional) current value of To Date
"RTN","FBSHAUT",198,0)
 ; output
"RTN","FBSHAUT",199,0)
 ;   FBENDDT To Date, FileMan format, null if date not selected
"RTN","FBSHAUT",200,0)
 ;
"RTN","FBSHAUT",201,0)
 S %DT("A")="Enter TO DATE: ",%DT="AEX",%DT(0)=FBBEGDT
"RTN","FBSHAUT",202,0)
 I $G(FBENDDT)]"" S %DT("B")=$$FMTE^XLFDT(FBENDDT)
"RTN","FBSHAUT",203,0)
 D ^%DT K %DT I Y'>0 S FBENDDT="" Q
"RTN","FBSHAUT",204,0)
 S FBENDDT=Y
"RTN","FBSHAUT",205,0)
 ;
"RTN","FBSHAUT",206,0)
 S FBX=$$CONFLICT(DFN,FBPROG,FBBEGDT,FBENDDT,0)
"RTN","FBSHAUT",207,0)
 I FBX D RCON(DFN,FBX) G TDATE
"RTN","FBSHAUT",208,0)
 Q
"RTN","FBSHAUT",209,0)
 ;
"RTN","FBSHAUT",210,0)
CONFLICT(DFN,PRG,FDT,TDT,NEWAUT) ; check for conflict with existing auth.
"RTN","FBSHAUT",211,0)
 ; input
"RTN","FBSHAUT",212,0)
 ;   DFN     - patient ien
"RTN","FBSHAUT",213,0)
 ;   PRG     - program ien
"RTN","FBSHAUT",214,0)
 ;   FDT     - from date in fileman format
"RTN","FBSHAUT",215,0)
 ;   TDT     - to date in fileman format
"RTN","FBSHAUT",216,0)
 ;   NEWAUT  - optional flag, true if dates for a new authorization
"RTN","FBSHAUT",217,0)
 ; returns string with value =
"RTN","FBSHAUT",218,0)
 ;   list of authorization iens (delimited by ^) that conflict OR
"RTN","FBSHAUT",219,0)
 ;   null when no conflict found
"RTN","FBSHAUT",220,0)
 ;
"RTN","FBSHAUT",221,0)
 ; A conflict exists if
"RTN","FBSHAUT",222,0)
 ;   1) the from date of a new authorization has already been used as
"RTN","FBSHAUT",223,0)
 ;      the from date for an existing authorization (including deleted)
"RTN","FBSHAUT",224,0)
 ;      for the same FEE program.
"RTN","FBSHAUT",225,0)
 ;   OR
"RTN","FBSHAUT",226,0)
 ;   2) the date range (FROM-TO) of this authorization overlaps the
"RTN","FBSHAUT",227,0)
 ;      date range of a different, active (does not include deleted)
"RTN","FBSHAUT",228,0)
 ;      authorization for the same FEE program. Note that the from date
"RTN","FBSHAUT",229,0)
 ;      of one authorization can equal the to date of a different
"RTN","FBSHAUT",230,0)
 ;      authorization and would not be in conflict.
"RTN","FBSHAUT",231,0)
 ;
"RTN","FBSHAUT",232,0)
 N FBI,FBRET,FBY
"RTN","FBSHAUT",233,0)
 S FBRET=""
"RTN","FBSHAUT",234,0)
 ; loop thru authorizations
"RTN","FBSHAUT",235,0)
 S FBI=0 F  S FBI=$O(^FBAAA(DFN,1,FBI)) Q:'FBI  D
"RTN","FBSHAUT",236,0)
 . S FBY=$G(^FBAAA(DFN,1,FBI,0))
"RTN","FBSHAUT",237,0)
 . Q:$P(FBY,U,3)'=PRG  ; not program of interest
"RTN","FBSHAUT",238,0)
 . Q:$P(FBY,U)=""!($P(FBY,U,2)="")  ; date missing - invalid
"RTN","FBSHAUT",239,0)
 . ; if same from date and not new then must be the selected auth.
"RTN","FBSHAUT",240,0)
 . ; and wouldn't conflict with self. if new then conflict found.
"RTN","FBSHAUT",241,0)
 . I $P(FBY,U)=FDT S:NEWAUT FBRET=FBRET_FBI_U Q  ; same from date
"RTN","FBSHAUT",242,0)
 . Q:$P($G(^FBAAA(DFN,1,FBI,"ADEL")),U)  ; austin deleted
"RTN","FBSHAUT",243,0)
 . I FDT<$P(FBY,U,2),TDT>$P(FBY,U) S FBRET=FBRET_FBI_U  ; conflict
"RTN","FBSHAUT",244,0)
 Q FBRET
"RTN","FBSHAUT",245,0)
 ;
"RTN","FBSHAUT",246,0)
RCON(DFN,LIST) ; Report Conflicts
"RTN","FBSHAUT",247,0)
 N CNT,FBA,FBFD,FBI,FBIEN,FBP
"RTN","FBSHAUT",248,0)
 S CNT=$L(LIST,U)-1
"RTN","FBSHAUT",249,0)
 W $C(7)
"RTN","FBSHAUT",250,0)
 W !!,"The specified dates conflict with other authorization(s)."
"RTN","FBSHAUT",251,0)
 W !,"Please specify different dates for this authorization or"
"RTN","FBSHAUT",252,0)
 W !,"remove the conflcit by first editing the other authorization(s)."
"RTN","FBSHAUT",253,0)
 W !!,"Conflict with  FROM DATE",?30,"TO DATE",?45,"PURPOSE OF VISIT"
"RTN","FBSHAUT",254,0)
 F FBP=1:1 S FBI=$P(LIST,U,FBP) Q:FBI=""  D
"RTN","FBSHAUT",255,0)
 . S FBFD=$P($G(^FBAAA(DFN,1,FBI,0)),U)
"RTN","FBSHAUT",256,0)
 . Q:FBFD=""
"RTN","FBSHAUT",257,0)
 . S FBA(FBFD)=FBI
"RTN","FBSHAUT",258,0)
 S FBFD="" F  S FBFD=$O(FBA(FBFD)) Q:FBFD=""  D
"RTN","FBSHAUT",259,0)
 . S FBI=FBA(FBFD)
"RTN","FBSHAUT",260,0)
 . S FBIEN=FBI_","_DFN_","
"RTN","FBSHAUT",261,0)
 . W !
"RTN","FBSHAUT",262,0)
 . I $P($G(^FBAAA(DFN,1,FBI,"ADEL")),U)]"" D
"RTN","FBSHAUT",263,0)
 . . W !,?2,"**Austin Deleted** - Use Reinstate to reuse this From Date"
"RTN","FBSHAUT",264,0)
 . W ?15,$$GET1^DIQ(161.01,FBIEN,.01)
"RTN","FBSHAUT",265,0)
 . W ?30,$$GET1^DIQ(161.01,FBIEN,.02)
"RTN","FBSHAUT",266,0)
 . W ?45,$$GET1^DIQ(161.01,FBIEN,.07)
"RTN","FBSHAUT",267,0)
 W !
"RTN","FBSHAUT",268,0)
 Q
"RTN","FBSHAUT",269,0)
 ;
"RTN","FBSHAUT",270,0)
QMRA(DFN,AUT,TYP) ; Queue MRA for transmission to Austin
"RTN","FBSHAUT",271,0)
 ; input
"RTN","FBSHAUT",272,0)
 ;   DFN - patient ien (file 2)
"RTN","FBSHAUT",273,0)
 ;   AUT - authorization ien (file 161.01)
"RTN","FBSHAUT",274,0)
 ;   TYP - type of MRA (A, C, D, or R)
"RTN","FBSHAUT",275,0)
 ; returns ien of MRA (file 161.26)
"RTN","FBSHAUT",276,0)
 N DD,DO,DIC,DLAYGO
"RTN","FBSHAUT",277,0)
 S DIC="^FBAA(161.26,",DIC(0)="L",DLAYGO=161.26,X=DFN
"RTN","FBSHAUT",278,0)
 S DIC("DR")="1///^S X=""P"";2///^S X=AUT;3///^S X=TYP"
"RTN","FBSHAUT",279,0)
 K DD,DO D FILE^DICN K DIC,DLAYGO
"RTN","FBSHAUT",280,0)
 Q +Y
"RTN","FBSHAUT",281,0)
 ;
"RTN","FBSHAUT",282,0)
 ;FBSHAUT
"RTN","FBUTL7")
0^2^B17958373^n/a
"RTN","FBUTL7",1,0)
FBUTL7 ;WIOFO/SAB - FEE BASIS UTILITY FOR CONTRACT ;9/24/2009
"RTN","FBUTL7",2,0)
 ;;3.5;FEE BASIS;**108**;JAN 30, 1995;Build 115
"RTN","FBUTL7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBUTL7",4,0)
 Q
"RTN","FBUTL7",5,0)
 ;
"RTN","FBUTL7",6,0)
EDCNTRA(FBDFN,FBAUTH) ; determine if CONTRACT can be edited
"RTN","FBUTL7",7,0)
 ; Input
"RTN","FBUTL7",8,0)
 ;   FBDFN   = IEN of patient in file 161 (and file 2) 
"RTN","FBUTL7",9,0)
 ;   FBAUTH  = IEN of authorization in sub-file 161.01
"RTN","FBUTL7",10,0)
 ; Returns a string value flag^message where
"RTN","FBUTL7",11,0)
 ;   flag    = 1 if contract field in sub-file 161.01 can be edited
"RTN","FBUTL7",12,0)
 ;           = 0 if it cannot be edited
"RTN","FBUTL7",13,0)
 ;   message = optional text that if present should be displayed
"RTN","FBUTL7",14,0)
 ;
"RTN","FBUTL7",15,0)
 N FBPAY,FBRET,FBY
"RTN","FBUTL7",16,0)
 S FBRET=0
"RTN","FBUTL7",17,0)
 ;
"RTN","FBUTL7",18,0)
 ; check inputs
"RTN","FBUTL7",19,0)
 I '$G(FBDFN) G EDCNTRAX ; missing patient IEN
"RTN","FBUTL7",20,0)
 I '$G(FBAUTH) G EDCNTRAX ; missing authorization IEN
"RTN","FBUTL7",21,0)
 S FBY=$G(^FBAAA(FBDFN,1,FBAUTH,0))
"RTN","FBUTL7",22,0)
 I FBY']"" G EDCNTRAX ; no authorization data
"RTN","FBUTL7",23,0)
 ;
"RTN","FBUTL7",24,0)
 ; check if contract is applicable to the authorization type
"RTN","FBUTL7",25,0)
 ;   must be outpatient or civil hospital fee program
"RTN","FBUTL7",26,0)
 I "^2^6^"'[("^"_$P(FBY,"^",3)_"^") G EDCNTRAX
"RTN","FBUTL7",27,0)
 ;   must not be an unauthorized claim
"RTN","FBUTL7",28,0)
 I $P(FBY,"^",9)["FB583" G EDCNTRAX
"RTN","FBUTL7",29,0)
 ;
"RTN","FBUTL7",30,0)
 ; check if any existing payments on file
"RTN","FBUTL7",31,0)
 S FBPAY=0
"RTN","FBUTL7",32,0)
 I $P(FBY,"^",3)=2 S FBPAY=$$OUTPA(FBDFN,FBAUTH) ; check outpatient
"RTN","FBUTL7",33,0)
 I $P(FBY,"^",9)["FB7078" S FBPAY=$$PAY^FBUCUTL(+$P(FBY,"^",9),$P($P(FBY,"^",9),";",2)) ; check using the associated 7078
"RTN","FBUTL7",34,0)
 I FBPAY=1 D  G EDCNTRAX
"RTN","FBUTL7",35,0)
 . N FBX
"RTN","FBUTL7",36,0)
 . S FBX="Can't change contract ("
"RTN","FBUTL7",37,0)
 . S FBX=FBX_$S($P(FBY,"^",22):$$GET1^DIQ(161.43,$P(FBY,"^",22)_",",.01),1:"")
"RTN","FBUTL7",38,0)
 . S FBX=FBX_") because payments exist."
"RTN","FBUTL7",39,0)
 . S $P(FBRET,"^",2)=FBX
"RTN","FBUTL7",40,0)
 ;
"RTN","FBUTL7",41,0)
 ;passed all checks - OK to edit field
"RTN","FBUTL7",42,0)
 S FBRET=1
"RTN","FBUTL7",43,0)
 ;
"RTN","FBUTL7",44,0)
EDCNTRAX ; EDCNTRA exit
"RTN","FBUTL7",45,0)
 Q FBRET
"RTN","FBUTL7",46,0)
 ;
"RTN","FBUTL7",47,0)
OUTPA(FBDFN,FBAUTH) ; Outpatient Authorization Has Payments?
"RTN","FBUTL7",48,0)
 ; input
"RTN","FBUTL7",49,0)
 ;   patient IEN
"RTN","FBUTL7",50,0)
 ;   authorization IEN
"RTN","FBUTL7",51,0)
 ; output
"RTN","FBUTL7",52,0)
 ;   FBPAY = 1 or 0, =1 if any payments on file for the authorization
"RTN","FBUTL7",53,0)
 N FBPAY,FBVEN
"RTN","FBUTL7",54,0)
 S FBPAY=0
"RTN","FBUTL7",55,0)
 ;
"RTN","FBUTL7",56,0)
 S FBVEN=+$P($G(^FBAAA(FBDFN,1,FBAUTH,0)),"^",4) ; vendor on auth
"RTN","FBUTL7",57,0)
 I FBVEN D OUTPAV
"RTN","FBUTL7",58,0)
 E  F  S FBVEN=$O(^FBAAC(FBDFN,1,FBVEN)) Q:'FBVEN  D OUTPAV  Q:FBPAY
"RTN","FBUTL7",59,0)
 Q FBPAY
"RTN","FBUTL7",60,0)
 ;
"RTN","FBUTL7",61,0)
OUTPAV ; 
"RTN","FBUTL7",62,0)
 N FBDTI
"RTN","FBUTL7",63,0)
 S FBDTI=0
"RTN","FBUTL7",64,0)
 F  S FBDTI=$O(^FBAAC(FBDFN,1,FBVEN,1,FBDTI)) Q:'FBDTI  D  Q:FBPAY
"RTN","FBUTL7",65,0)
 . Q:$P($G(^FBAAC(FBDFN,1,FBVEN,1,FBDTI,0)),"^",4)'=FBAUTH
"RTN","FBUTL7",66,0)
 . Q:'$O(^FBAAC(FBDFN,1,FBVEN,1,FBDTI,1,0))
"RTN","FBUTL7",67,0)
 . S FBPAY=1
"RTN","FBUTL7",68,0)
 Q
"RTN","FBUTL7",69,0)
CNTRPTR(FBDA) ; Contract pointed-to
"RTN","FBUTL7",70,0)
 ; input FBDA = ien of contract in file 161.43
"RTN","FBUTL7",71,0)
 ; result 0 or 1, =1 if contract is pointed-to
"RTN","FBUTL7",72,0)
 N FBRET
"RTN","FBUTL7",73,0)
 S FBRET=0
"RTN","FBUTL7",74,0)
 ; check fee basis patient (authorizations)
"RTN","FBUTL7",75,0)
 I $D(^FBAAA("ACN",FBDA)) S FBRET=1
"RTN","FBUTL7",76,0)
 ; check fee basis payment
"RTN","FBUTL7",77,0)
 I 'FBRET,$D(^FBAAC("ACN",FBDA)) S FBRET=1
"RTN","FBUTL7",78,0)
 ; check fee basis invoice
"RTN","FBUTL7",79,0)
 I 'FBRET,$D(^FBAAI("ACN",FBDA)) S FBRET=1
"RTN","FBUTL7",80,0)
 Q FBRET
"RTN","FBUTL7",81,0)
 ;
"RTN","FBUTL7",82,0)
 ;
"RTN","FBUTL7",83,0)
UCFA(FBVENI,FBVENA,FBCNTRA) ; Use Contract From Authorization
"RTN","FBUTL7",84,0)
 ; input
"RTN","FBUTL7",85,0)
 ;   FBVENI = vendor IEN for invoice/payment
"RTN","FBUTL7",86,0)
 ;   FBVENA = vendor IEN for associated authorization
"RTN","FBUTL7",87,0)
 ;   FBCNTRA = contract IEN for associated authorization
"RTN","FBUTL7",88,0)
 ; returns 0 or 1
"RTN","FBUTL7",89,0)
 ;   = 1 if invoice must have same contract as associated authorization
"RTN","FBUTL7",90,0)
 N FBAR,FBI,FBRET
"RTN","FBUTL7",91,0)
 S FBRET=0
"RTN","FBUTL7",92,0)
 ; if authorization has a contract
"RTN","FBUTL7",93,0)
 I FBCNTRA D
"RTN","FBUTL7",94,0)
 . ; does the vendor being paid match the vendor on the authorizaton
"RTN","FBUTL7",95,0)
 . I FBVENI=FBVENA S FBRET=1
"RTN","FBUTL7",96,0)
 . Q:FBRET=1
"RTN","FBUTL7",97,0)
 . ; build a list of linked vendors for the vendor being paid
"RTN","FBUTL7",98,0)
 . I FBVENI D  ; build list of linked vendors in FBAR(
"RTN","FBUTL7",99,0)
 . . N DA,FBA,FBDA,FBJ
"RTN","FBUTL7",100,0)
 . . S DA=FBVENI
"RTN","FBUTL7",101,0)
 . . S FBAR(DA)=""
"RTN","FBUTL7",102,0)
 . . D ^FBAACO4
"RTN","FBUTL7",103,0)
 . ; loop thru linked vendors to see if any match
"RTN","FBUTL7",104,0)
 . S FBI=0 F  S FBI=$O(FBAR(FBI)) Q:'FBI  D  Q:FBRET
"RTN","FBUTL7",105,0)
 . . I FBI=FBVENA S FBRET=1
"RTN","FBUTL7",106,0)
 Q FBRET
"RTN","FBUTL7",107,0)
 ;
"RTN","FBUTL7",108,0)
CNTRSCR(FBDFN,FBAUT,FBCNTRA) ; contract screen
"RTN","FBUTL7",109,0)
 ; called by 161.01 CONTRACT field screen
"RTN","FBUTL7",110,0)
 ; input
"RTN","FBUTL7",111,0)
 ;   FEE BASIS PATIENT ien
"RTN","FBUTL7",112,0)
 ;   AUTHORIZATION ien
"RTN","FBUTL7",113,0)
 ;   CONTRACT ien
"RTN","FBUTL7",114,0)
 ; return 0 or 1, =1 if contract passes screen
"RTN","FBUTL7",115,0)
 N FBRET,FBVEN
"RTN","FBUTL7",116,0)
 S FBRET=1
"RTN","FBUTL7",117,0)
 ; check status of contract
"RTN","FBUTL7",118,0)
 I $G(DIUTIL)'="VERIFY FIELDS",$P($G(^FBAA(161.43,FBCNTRA,0)),"^",2)'="A" S FBRET=0
"RTN","FBUTL7",119,0)
 ; if authorization iens provided, then screen on vendor
"RTN","FBUTL7",120,0)
 I FBRET,$G(FBDFN),$G(FBAUT) D
"RTN","FBUTL7",121,0)
 . S FBVEN=$P($G(^FBAAA(FBDFN,1,FBAUT,0)),"^",4)
"RTN","FBUTL7",122,0)
 . I FBVEN'>0 S FBRET=0 Q
"RTN","FBUTL7",123,0)
 . S FBRET=$$VCNTR(FBVEN,FBCNTRA)
"RTN","FBUTL7",124,0)
 Q FBRET
"RTN","FBUTL7",125,0)
 ;
"RTN","FBUTL7",126,0)
VCNTR(FBV,FBC) ; vendor applicable for the contract
"RTN","FBUTL7",127,0)
 ; input
"RTN","FBUTL7",128,0)
 ;   FBV = IEN of vendor (FEE BASIS VENDOR file)
"RTN","FBUTL7",129,0)
 ;   FBC = IEN on contract (FEE BASIS CONTRACT file)
"RTN","FBUTL7",130,0)
 ; returns 0 or 1
"RTN","FBUTL7",131,0)
 ;         =1 if vendor is applicable for the contract
"RTN","FBUTL7",132,0)
 N FBAR,FBI,FBRET
"RTN","FBUTL7",133,0)
 S FBRET=0
"RTN","FBUTL7",134,0)
 I $G(FBV),$G(FBC) D
"RTN","FBUTL7",135,0)
 . ; is vendor applicable?
"RTN","FBUTL7",136,0)
 . I $D(^FBAA(161.43,"AV",FBV,FBC)) S FBRET=1
"RTN","FBUTL7",137,0)
 . Q:FBRET=1
"RTN","FBUTL7",138,0)
 . ; try linked vendors (if any)
"RTN","FBUTL7",139,0)
 . D  ; build list of linked vendors in FBAR(
"RTN","FBUTL7",140,0)
 . . N DA,FBA,FBDA,FBJ
"RTN","FBUTL7",141,0)
 . . S DA=FBV
"RTN","FBUTL7",142,0)
 . . S FBAR(DA)=""
"RTN","FBUTL7",143,0)
 . . D ^FBAACO4
"RTN","FBUTL7",144,0)
 . ; loop thru linked vendors to see if any are applicable
"RTN","FBUTL7",145,0)
 . S FBI=0 F  S FBI=$O(FBAR(FBI)) Q:'FBI  D  Q:FBRET
"RTN","FBUTL7",146,0)
 . . I $D(^FBAA(161.43,"AV",FBI,FBC)) S FBRET=1
"RTN","FBUTL7",147,0)
 Q FBRET
"RTN","FBUTL7",148,0)
 ;
"RTN","FBUTL7",149,0)
 ;FBUTL7
"RTN","FBXIP108")
0^1^B13213914^n/a
"RTN","FBXIP108",1,0)
FBXIP108 ;WOIFO/SAB - PATCH INSTALL ROUTINE ;6/17/2009
"RTN","FBXIP108",2,0)
 ;;3.5;FEE BASIS;**108**;JAN 30, 1995;Build 115
"RTN","FBXIP108",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBXIP108",4,0)
 Q
"RTN","FBXIP108",5,0)
 ;
"RTN","FBXIP108",6,0)
PR ; pre-install entry point
"RTN","FBXIP108",7,0)
 ; create KIDS checkpoints with call backs
"RTN","FBXIP108",8,0)
 N FBX,Y
"RTN","FBXIP108",9,0)
 F FBX="OPT" D
"RTN","FBXIP108",10,0)
 . S Y=$$NEWCP^XPDUTL(FBX,FBX_"^FBXIP108")
"RTN","FBXIP108",11,0)
 . I 'Y D BMES^XPDUTL("ERROR Creating "_FBX_" Checkpoint.")
"RTN","FBXIP108",12,0)
 Q
"RTN","FBXIP108",13,0)
 ;
"RTN","FBXIP108",14,0)
OPT ; pre-install: remove options from supervisor menu
"RTN","FBXIP108",15,0)
 ; ICR 1157 for $$DELETE^XPDMENU()
"RTN","FBXIP108",16,0)
 N FBMENU,FBX
"RTN","FBXIP108",17,0)
 D BMES^XPDUTL("  Updating Supervisor Main Menu...")
"RTN","FBXIP108",18,0)
 S FBMENU="FBAA SUPERVISOR OPTIONS"
"RTN","FBXIP108",19,0)
 S FBX=$$DELETE^XPDMENU(FBMENU,"FBUC ADD NEW PERSON")
"RTN","FBXIP108",20,0)
 S FBX=$$DELETE^XPDMENU(FBMENU,"FBUC DISAPPROVAL REASONS FILE")
"RTN","FBXIP108",21,0)
 S FBX=$$DELETE^XPDMENU(FBMENU,"FBUC DISPOSITIONS FILE")
"RTN","FBXIP108",22,0)
 S FBX=$$DELETE^XPDMENU(FBMENU,"FBUC REQUEST INFO FILE")
"RTN","FBXIP108",23,0)
 Q
"RTN","FBXIP108",24,0)
 ;
"RTN","FBXIP108",25,0)
PS ; post-install entry point
"RTN","FBXIP108",26,0)
 ; create KIDS checkpoints with call backs
"RTN","FBXIP108",27,0)
 N FBX,Y
"RTN","FBXIP108",28,0)
 F FBX="HRO","PAR" D
"RTN","FBXIP108",29,0)
 . S Y=$$NEWCP^XPDUTL(FBX,FBX_"^FBXIP108")
"RTN","FBXIP108",30,0)
 . I 'Y D BMES^XPDUTL("ERROR Creating "_FBX_" Checkpoint.")
"RTN","FBXIP108",31,0)
 Q
"RTN","FBXIP108",32,0)
 ;
"RTN","FBXIP108",33,0)
HRO ; Add HERO contracts
"RTN","FBXIP108",34,0)
 ; ICR 2541 for $$KSP^XUPARAM
"RTN","FBXIP108",35,0)
 N FBDINST,FBVISN
"RTN","FBXIP108",36,0)
 ; get default institution ien
"RTN","FBXIP108",37,0)
 S FBDINST=$$KSP^XUPARAM("INST")
"RTN","FBXIP108",38,0)
 ; determine VISN
"RTN","FBXIP108",39,0)
 S FBVISN=$$VISN(FBDINST)
"RTN","FBXIP108",40,0)
 ; Enter HERO data if VISN is 8, 16, 20, or 23
"RTN","FBXIP108",41,0)
 I "^VISN 8^VISN 16^VISN 20^VISN 23^"[("^"_FBVISN_"^") D
"RTN","FBXIP108",42,0)
 . N FBCNTRN,FBFDA,FBV,FBVID,FBVNM
"RTN","FBXIP108",43,0)
 . ; Delta contract
"RTN","FBXIP108",44,0)
 . S FBCNTRN="VA101(049A3)-P-0269"
"RTN","FBXIP108",45,0)
 . S FBVID="942761537"
"RTN","FBXIP108",46,0)
 . S FBVNM="Delta"
"RTN","FBXIP108",47,0)
 . I $D(^FBAA(161.43,"B",FBCNTRN)) D
"RTN","FBXIP108",48,0)
 . . D BMES^XPDUTL(FBCNTRN_" is already set up as a contract.")
"RTN","FBXIP108",49,0)
 . I '$D(^FBAA(161.43,"B",FBCNTRN)) D
"RTN","FBXIP108",50,0)
 . . D BMES^XPDUTL("  Adding "_FBCNTRN_" as a contract for "_FBVNM_"...")
"RTN","FBXIP108",51,0)
 . . S FBV=$$FIND1^DIC(161.2,"","X",FBVID,"C")
"RTN","FBXIP108",52,0)
 . . I 'FBV D
"RTN","FBXIP108",53,0)
 . . . D MES^XPDUTL("    Can't find Fee Basis Vendor with ID "_FBVID)
"RTN","FBXIP108",54,0)
 . . . D MES^XPDUTL("    The contract must be manually edited to add")
"RTN","FBXIP108",55,0)
 . . . D MES^XPDUTL("    the applicable vendor.")
"RTN","FBXIP108",56,0)
 . . S FBFDA(161.43,"+1,",.01)=FBCNTRN
"RTN","FBXIP108",57,0)
 . . S FBFDA(161.43,"+1,",2)="A"
"RTN","FBXIP108",58,0)
 . . S:FBV FBFDA(161.433,"+2,+1,",.01)=FBV
"RTN","FBXIP108",59,0)
 . ; HVHS contract
"RTN","FBXIP108",60,0)
 . S FBCNTRN="VA101049A3-P-0270"
"RTN","FBXIP108",61,0)
 . S FBVID="208418853"
"RTN","FBXIP108",62,0)
 . S FBVNM="HVHS"
"RTN","FBXIP108",63,0)
 . I $D(^FBAA(161.43,"B",FBCNTRN)) D
"RTN","FBXIP108",64,0)
 . . D BMES^XPDUTL(FBCNTRN_" is already set up as a contract.")
"RTN","FBXIP108",65,0)
 . I '$D(^FBAA(161.43,"B",FBCNTRN)) D
"RTN","FBXIP108",66,0)
 . . D BMES^XPDUTL("  Adding "_FBCNTRN_" as a contract for "_FBVNM_"...")
"RTN","FBXIP108",67,0)
 . . S FBV=$$FIND1^DIC(161.2,"","X",FBVID,"C")
"RTN","FBXIP108",68,0)
 . . I 'FBV D
"RTN","FBXIP108",69,0)
 . . . D MES^XPDUTL("    Can't find Fee Basis Vendor with ID "_FBVID)
"RTN","FBXIP108",70,0)
 . . . D MES^XPDUTL("    The contract must be manually edited to add")
"RTN","FBXIP108",71,0)
 . . . D MES^XPDUTL("    the applicable vendor.")
"RTN","FBXIP108",72,0)
 . . S FBFDA(161.43,"+3,",.01)=FBCNTRN
"RTN","FBXIP108",73,0)
 . . S FBFDA(161.43,"+3,",2)="A"
"RTN","FBXIP108",74,0)
 . . S:FBV FBFDA(161.433,"+4,+3,",.01)=FBV
"RTN","FBXIP108",75,0)
 . I $D(FBFDA) D UPDATE^DIE("","FBFDA")
"RTN","FBXIP108",76,0)
 Q
"RTN","FBXIP108",77,0)
 ;
"RTN","FBXIP108",78,0)
VISN(FBSTAI) ; VISN extrinsic function
"RTN","FBXIP108",79,0)
 ; ICR 2171 for PARENT^XUAF4
"RTN","FBXIP108",80,0)
 ; input   - IEN of an entry in the INSTITUTION (#4) file
"RTN","FBXIP108",81,0)
 ; returns - the name of the parent VISN or a null value
"RTN","FBXIP108",82,0)
 N FBARR,FBRET,FBVISNI
"RTN","FBXIP108",83,0)
 S FBRET=""
"RTN","FBXIP108",84,0)
 I FBSTAI D
"RTN","FBXIP108",85,0)
 . D PARENT^XUAF4("FBARR","`"_FBSTAI,"VISN")
"RTN","FBXIP108",86,0)
 . S FBVISNI=$O(FBARR("P",""))
"RTN","FBXIP108",87,0)
 . I FBVISNI S FBRET=$P(FBARR("P",FBVISNI),"^")
"RTN","FBXIP108",88,0)
 Q FBRET
"RTN","FBXIP108",89,0)
 ;
"RTN","FBXIP108",90,0)
PAR ; Populate new parameter fields
"RTN","FBXIP108",91,0)
 N FBFDA,FBY
"RTN","FBXIP108",92,0)
 S FBY=$G(^FBAA(161.4,1,"FBNUM"))
"RTN","FBXIP108",93,0)
 I $P(FBY,"^",3)="" S FBFDA(161.4,"1,",17)=85
"RTN","FBXIP108",94,0)
 I $P(FBY,"^",3)>85 S FBFDA(161.4,"1,",17)=85
"RTN","FBXIP108",95,0)
 I $P(FBY,"^",4)="" S FBFDA(161.4,"1,",17.1)=42
"RTN","FBXIP108",96,0)
 I $P(FBY,"^",5)="" S FBFDA(161.4,"1,",17.2)=61
"RTN","FBXIP108",97,0)
 I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBXIP108",98,0)
 Q
"RTN","FBXIP108",99,0)
 ;FBXIP108
"SEC","^DIC",161.43,161.43,0,"AUDIT")
@
"SEC","^DIC",161.43,161.43,0,"DD")
@
"SEC","^DIC",161.43,161.43,0,"DEL")
@
"SEC","^DIC",161.43,161.43,0,"LAYGO")
@
"SEC","^DIC",161.43,161.43,0,"RD")

"SEC","^DIC",161.43,161.43,0,"WR")
@
"SEC","^DIC",161.94,161.94,0,"AUDIT")
@
"SEC","^DIC",161.94,161.94,0,"DD")
@
"SEC","^DIC",161.94,161.94,0,"DEL")
@
"SEC","^DIC",161.94,161.94,0,"LAYGO")
@
"SEC","^DIC",161.94,161.94,0,"WR")
@
"UP",161,161.01,-1)
161^1
"UP",161,161.01,0)
161.01
"UP",162,162.03,-3)
162^1
"UP",162,162.03,-2)
162.01^1
"UP",162,162.03,-1)
162.02^1
"UP",162,162.03,0)
162.03
"UP",162.5,162.558,-1)
162.5^8
"UP",162.5,162.558,0)
162.558
"UP",162.5,162.579,-1)
162.5^RPROV
"UP",162.5,162.579,0)
162.579
"VER")
8.0^22.0
"^DD",161,161.01,105,0)
CONTRACT^*P161.43'^FBAA(161.43,^0;22^S DIC("S")="I $$CNTRSCR^FBUTL7($G(DA(1)),$G(DA),+Y)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",161,161.01,105,3)
If the authorization is under a contract then select it.
"^DD",161,161.01,105,12)
Contract must be active and applicable for the authorized vendor.
"^DD",161,161.01,105,12.1)
S DIC("S")="I $$CNTRSCR^FBUTL7($G(DA(1)),$G(DA),+Y)"
"^DD",161,161.01,105,21,0)
^^4^4^3090522^
"^DD",161,161.01,105,21,1,0)
Contract (if any) applicable to all authorized services.  If an
"^DD",161,161.01,105,21,2,0)
authorization has a contract, the system will automatically assign that
"^DD",161,161.01,105,21,3,0)
contract to any payments associated with the authorization if the vendor
"^DD",161,161.01,105,21,4,0)
being paid matches the vendor specified on the authorization.
"^DD",161,161.01,105,"DT")
3090603
"^DD",161.4,161.4,17,0)
MAX # PAYMENT LINE ITEMS^RNJ2,0^^FBNUM;3^K:+X'=X!(X>85)!(X<1)!(X?.E1"."1.N) X
"^DD",161.4,161.4,17,3)
Type a number between 1 and 85, 0 Decimal Digits
"^DD",161.4,161.4,17,21,0)
^^4^4^3090701^
"^DD",161.4,161.4,17,21,1,0)
The maximum number of payment line items that will be allowed in a batch.
"^DD",161.4,161.4,17,21,2,0)
Any number between 1 and 85 is acceptable. This value is checked during
"^DD",161.4,161.4,17,21,3,0)
the enter payment options and will warn the clerks when they are within 20
"^DD",161.4,161.4,17,21,4,0)
of the maximum. It will prevent the clerks from exceeding this number.
"^DD",161.4,161.4,17,"DT")
3090701
"^DD",161.4,161.4,17.1,0)
MAX # CH PAYMENT LINES^RNJ2,0^^FBNUM;4^K:+X'=X!(X>42)!(X<1)!(X?.E1"."1.N) X
"^DD",161.4,161.4,17.1,3)
Type a number between 1 and 42, 0 Decimal Digits
"^DD",161.4,161.4,17.1,21,0)
^^4^4^3090701^
"^DD",161.4,161.4,17.1,21,1,0)
The maximum number of payment line items that will be allowed in a
"^DD",161.4,161.4,17.1,21,2,0)
contract hospital batch. This value is checked during the enter payment
"^DD",161.4,161.4,17.1,21,3,0)
options and will warn the clerks when they are within 5 of the maximum.
"^DD",161.4,161.4,17.1,21,4,0)
It will prevent the clerks from exceeding this number.
"^DD",161.4,161.4,17.1,"DT")
3090701
"^DD",161.4,161.4,17.2,0)
MAX # CNH PAYMENT LINES^RNJ2,0^^FBNUM;5^K:+X'=X!(X>61)!(X<1)!(X?.E1"."1.N) X
"^DD",161.4,161.4,17.2,3)
Type a number between 1 and 61, 0 Decimal Digits
"^DD",161.4,161.4,17.2,21,0)
^^4^4^3090701^
"^DD",161.4,161.4,17.2,21,1,0)
The maximum number of payment line items that will be allowed in a
"^DD",161.4,161.4,17.2,21,2,0)
community nursing home batch. This value is checked during the enter
"^DD",161.4,161.4,17.2,21,3,0)
payment options and will warn the clerks when they are within 5 of the
"^DD",161.4,161.4,17.2,21,4,0)
maximum. It will prevent the clerks from exceeding this number.
"^DD",161.4,161.4,17.2,"DT")
3090701
"^DD",161.43,161.43,0)
FIELD^^2^3
"^DD",161.43,161.43,0,"DDA")
N
"^DD",161.43,161.43,0,"DT")
3090924
"^DD",161.43,161.43,0,"IX","B",161.43,.01)

"^DD",161.43,161.43,0,"NM","FEE BASIS CONTRACT")

"^DD",161.43,161.43,0,"PT",161.01,105)

"^DD",161.43,161.43,0,"PT",162.03,54)

"^DD",161.43,161.43,0,"PT",162.5,60)

"^DD",161.43,161.43,0,"VRPK")
FB
"^DD",161.43,161.43,.01,0)
CONTRACT NUMBER^RF^^0;1^K:$L(X)>20!($L(X)<3)!'(X'?1P.E) X
"^DD",161.43,161.43,.01,1,0)
^.1
"^DD",161.43,161.43,.01,1,1,0)
161.43^B
"^DD",161.43,161.43,.01,1,1,1)
S ^FBAA(161.43,"B",$E(X,1,30),DA)=""
"^DD",161.43,161.43,.01,1,1,2)
K ^FBAA(161.43,"B",$E(X,1,30),DA)
"^DD",161.43,161.43,.01,3)
Answer must be 3-20 characters in length
"^DD",161.43,161.43,.01,21,0)
^^3^3^3090603^
"^DD",161.43,161.43,.01,21,1,0)
This field contains the contract number of the contract.  The contract 
"^DD",161.43,161.43,.01,21,2,0)
number cannot be changed if any authorization or payments point to the 
"^DD",161.43,161.43,.01,21,3,0)
contract.
"^DD",161.43,161.43,.01,"DEL",1,0)
I $$CNTRPTR^FBUTL7(DA) D EN^DDIOL("The contract is referenced by an authorization or payment and can't be deleted!","","!?5") I 1
"^DD",161.43,161.43,.01,"DT")
3090924
"^DD",161.43,161.43,2,0)
STATUS^RS^A:ACTIVE;I:INACTIVE;^0;2^Q
"^DD",161.43,161.43,2,3)
Select a status for the contract.
"^DD",161.43,161.43,2,21,0)
^^2^2^3090527^
"^DD",161.43,161.43,2,21,1,0)
Only active contracts can be selected when authorizations or payments are 
"^DD",161.43,161.43,2,21,2,0)
entered.
"^DD",161.43,161.43,2,"DT")
3090527
"^DD",161.43,161.43,3,0)
APPLICABLE VENDORS^161.433P^^3;0
"^DD",161.43,161.43,3,21,0)
^^1^1^3090522^
"^DD",161.43,161.43,3,21,1,0)
Applicable vendors for the contract.
"^DD",161.43,161.43,3,"DT")
3090522
"^DD",161.43,161.433,0)
APPLICABLE VENDORS SUB-FIELD^^.01^1
"^DD",161.43,161.433,0,"DT")
3090527
"^DD",161.43,161.433,0,"IX","B",161.433,.01)

"^DD",161.43,161.433,0,"NM","APPLICABLE VENDORS")

"^DD",161.43,161.433,0,"UP")
161.43
"^DD",161.43,161.433,.01,0)
VENDOR^MP161.2'^FBAAV(^0;1^Q
"^DD",161.43,161.433,.01,1,0)
^.1^^-1
"^DD",161.43,161.433,.01,1,1,0)
161.433^B
"^DD",161.43,161.433,.01,1,1,1)
S ^FBAA(161.43,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",161.43,161.433,.01,1,1,2)
K ^FBAA(161.43,DA(1),3,"B",$E(X,1,30),DA)
"^DD",161.43,161.433,.01,3)
Select a vendor
"^DD",161.43,161.433,.01,21,0)
^^1^1^3090522^
"^DD",161.43,161.433,.01,21,1,0)
Select vendor to which the contract is applicable.
"^DD",161.43,161.433,.01,"DT")
3090527
"^DD",161.94,161.94,0)
FIELD^^2^3
"^DD",161.94,161.94,0,"DDA")
N
"^DD",161.94,161.94,0,"DT")
3081120
"^DD",161.94,161.94,0,"ID",1)
W "   ",$P(^(0),U,2)
"^DD",161.94,161.94,0,"IX","B",161.94,.01)

"^DD",161.94,161.94,0,"NM","PRESENT ON ADMISSION")

"^DD",161.94,161.94,0,"PT",162.5,30.02)

"^DD",161.94,161.94,0,"PT",162.5,31.02)

"^DD",161.94,161.94,0,"PT",162.5,32.02)

"^DD",161.94,161.94,0,"PT",162.5,33.02)

"^DD",161.94,161.94,0,"PT",162.5,34.02)

"^DD",161.94,161.94,0,"PT",162.5,35.02)

"^DD",161.94,161.94,0,"PT",162.5,35.12)

"^DD",161.94,161.94,0,"PT",162.5,35.22)

"^DD",161.94,161.94,0,"PT",162.5,35.32)

"^DD",161.94,161.94,0,"PT",162.5,35.42)

"^DD",161.94,161.94,0,"PT",162.5,35.52)

"^DD",161.94,161.94,0,"PT",162.5,35.62)

"^DD",161.94,161.94,0,"PT",162.5,35.72)

"^DD",161.94,161.94,0,"PT",162.5,35.82)

"^DD",161.94,161.94,0,"PT",162.5,35.92)

"^DD",161.94,161.94,0,"PT",162.5,36.02)

"^DD",161.94,161.94,0,"PT",162.5,36.12)

"^DD",161.94,161.94,0,"PT",162.5,36.22)

"^DD",161.94,161.94,0,"PT",162.5,36.32)

"^DD",161.94,161.94,0,"PT",162.5,36.42)

"^DD",161.94,161.94,0,"PT",162.5,36.52)

"^DD",161.94,161.94,0,"PT",162.5,36.62)

"^DD",161.94,161.94,0,"PT",162.5,36.72)

"^DD",161.94,161.94,0,"PT",162.5,36.82)

"^DD",161.94,161.94,0,"PT",162.5,36.92)

"^DD",161.94,161.94,0,"VRPK")
FB
"^DD",161.94,161.94,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",161.94,161.94,.01,1,0)
^.1
"^DD",161.94,161.94,.01,1,1,0)
161.94^B
"^DD",161.94,161.94,.01,1,1,1)
S ^FB(161.94,"B",$E(X,1,30),DA)=""
"^DD",161.94,161.94,.01,1,1,2)
K ^FB(161.94,"B",$E(X,1,30),DA)
"^DD",161.94,161.94,.01,3)
Answer must be 1 character in length.
"^DD",161.94,161.94,.01,21,0)
^^1^1^3081120^
"^DD",161.94,161.94,.01,21,1,0)
This is the CMS defined code for the present on admission indicator.
"^DD",161.94,161.94,.01,"DT")
3081120
"^DD",161.94,161.94,1,0)
SHORT DESCRIPTION^RF^^0;2^K:$L(X)>60!($L(X)<3) X
"^DD",161.94,161.94,1,3)
Answer must be 3-60 characters in length.
"^DD",161.94,161.94,1,21,0)
^.001^1^1^3081120^^
"^DD",161.94,161.94,1,21,1,0)
This field contains a short description of the code.
"^DD",161.94,161.94,1,"DT")
3081120
"^DD",161.94,161.94,2,0)
DESCRIPTION^161.942^^1;0
"^DD",161.94,161.94,2,21,0)
^^1^1^3081120^
"^DD",161.94,161.94,2,21,1,0)
This field contains a description of the code.
"^DD",161.94,161.942,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",161.94,161.942,0,"DT")
3081120
"^DD",161.94,161.942,0,"NM","DESCRIPTION")

"^DD",161.94,161.942,0,"UP")
161.94
"^DD",161.94,161.942,.01,0)
DESCRIPTION^Wx^^0;1^Q
"^DD",161.94,161.942,.01,3)
Enter the description of the code.
"^DD",161.94,161.942,.01,21,0)
^.001^1^1^3081120^^
"^DD",161.94,161.942,.01,21,1,0)
This field contains the description of the code.
"^DD",161.94,161.942,.01,"DT")
3081120
"^DD",162,162.03,54,0)
CONTRACT^P161.43'^FBAA(161.43,^3;8^Q
"^DD",162,162.03,54,1,0)
^.1
"^DD",162,162.03,54,1,1,0)
162^ACN
"^DD",162,162.03,54,1,1,1)
S ^FBAAC("ACN",$E(X,1,30),DA(3),DA(2),DA(1),DA)=""
"^DD",162,162.03,54,1,1,2)
K ^FBAAC("ACN",$E(X,1,30),DA(3),DA(2),DA(1),DA)
"^DD",162,162.03,54,1,1,"%D",0)
^^3^3^3090528^
"^DD",162,162.03,54,1,1,"%D",1,0)
This is an index of contracts entered for outpatient and ancillary
"^DD",162,162.03,54,1,1,"%D",2,0)
payments. The index will be used to prevent deletion of entries from the
"^DD",162,162.03,54,1,1,"%D",3,0)
FEE BASIS CONTRACT file that are referenced (pointed to) by a payment.
"^DD",162,162.03,54,1,1,"DT")
3090528
"^DD",162,162.03,54,3)
If applicable, enter the contract.
"^DD",162,162.03,54,21,0)
^.001^3^3^3120208^^^
"^DD",162,162.03,54,21,1,0)
If the payment is for contracted services, the contract number can be
"^DD",162,162.03,54,21,2,0)
specified in this field.  The selected contract must be active and
"^DD",162,162.03,54,21,3,0)
applicable to the vendor being paid.
"^DD",162,162.03,54,23,0)
^.001^3^3^3120208^^^
"^DD",162,162.03,54,23,1,0)
In some cases this field will be automatically populated by the software
"^DD",162,162.03,54,23,2,0)
based on the associated authorization. In other cases, the user will be 
"^DD",162,162.03,54,23,3,0)
prompted for a value.
"^DD",162,162.03,54,"DT")
3090709
"^DD",162.4,162.4,6,0)
ESTIMATED AMOUNT^RNJ10,2^^0;7^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<.01)!(X?.E1"."3.N) X
"^DD",162.4,162.4,6,3)
Type a Dollar amount between .01 and 9999999.99, 2 Decimal Digits
"^DD",162.4,162.4,6,21,0)
^.001^3^3^3111107^^^
"^DD",162.4,162.4,6,21,1,0)
This dollar amount is the best estimate of costs that
"^DD",162.4,162.4,6,21,2,0)
will be incurred by the veteran. This dollar amount is
"^DD",162.4,162.4,6,21,3,0)
passed to IFCAP.
"^DD",162.4,162.4,6,"DT")
3081117
"^DD",162.5,162.5,6.6,0)
BILLED CHARGES^RNJ10,2^^0;22^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<.01) X
"^DD",162.5,162.5,6.6,3)
Type a Dollar Amount between .01 and 9999999.99, 2 Decimal Digits
"^DD",162.5,162.5,6.6,21,0)
^.001^2^2^3081117^^^
"^DD",162.5,162.5,6.6,21,1,0)
This field contains cost information on the amount the VA was initially
"^DD",162.5,162.5,6.6,21,2,0)
billed by the vendor for an inpatient stay.
"^DD",162.5,162.5,6.6,"DT")
3081117
"^DD",162.5,162.5,7,0)
AMOUNT CLAIMED^RNJ9,2X^^0;8^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<.01) X I $D(X),$P(^FBAAI(DA,0),U,12)=6,$P(^(0),U,22)<X K X D EN^DDIOL("Amount Claimed cannot be greater than the 'BILLED CHARGES'.")
"^DD",162.5,162.5,7,3)
Type a Dollar Amount between .01 and 9999999.99, 2 Decimal Digits
"^DD",162.5,162.5,7,21,0)
^.001^3^3^3081202^^^^
"^DD",162.5,162.5,7,21,1,0)
The portion of the billed charges that the vendor is requesting payment
"^DD",162.5,162.5,7,21,2,0)
for from the VA.  Usually the billed charges and the amount claimed
"^DD",162.5,162.5,7,21,3,0)
will be the same.
"^DD",162.5,162.5,7,"DT")
3081202
"^DD",162.5,162.5,8,0)
AMOUNT PAID^RNJ9,2X^^0;9^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<0) X I $D(X),$P(^FBAAI(DA,0),U,12)'=6,$P(^FBAAI(DA,0),U,8)<X D EN^DDIOL("Amount Paid cannot be greater than Amount Claimed!") K X
"^DD",162.5,162.5,8,1,0)
^.1^^0
"^DD",162.5,162.5,8,3)
Type a Dollar Amount between 0 and 9999999.99, 2 Decimal Digits
"^DD",162.5,162.5,8,21,0)
^.001^2^2^3081202^^^
"^DD",162.5,162.5,8,21,1,0)
The dollar amount that was actually paid to the vendor for the service
"^DD",162.5,162.5,8,21,2,0)
provided.
"^DD",162.5,162.5,8,"DT")
3081202
"^DD",162.5,162.5,9,0)
AMOUNT SUSPENDED^NJ10,2^^0;10^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<0) X
"^DD",162.5,162.5,9,3)
Type a Dollar Amount between 0 and 9999999.99, 2 Decimal Digits
"^DD",162.5,162.5,9,21,0)
^^1^1^3081119^
"^DD",162.5,162.5,9,21,1,0)
The difference between the amount claimed and the amount paid.
"^DD",162.5,162.5,9,"DT")
3081117
"^DD",162.5,162.5,26,0)
NVH PRICER AMOUNT^NJ10,2^^0;26^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<.01) X
"^DD",162.5,162.5,26,3)
Type a Dollar Amount between .01 and 9999999.99, 2 Decimal Digits
"^DD",162.5,162.5,26,21,0)
^.001^1^1^3081117^^
"^DD",162.5,162.5,26,21,1,0)
The amount for this payment as determined by the Austin Pricer.
"^DD",162.5,162.5,26,"DT")
3081117
"^DD",162.5,162.5,30.02,0)
POA1^P161.94'^FB(161.94,^POA;1^Q
"^DD",162.5,162.5,30.02,3)
Enter the present on admission indicator for the ICD1 diagnosis.
"^DD",162.5,162.5,30.02,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,30.02,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,30.02,21,2,0)
diagnosis in the ICD1 field.
"^DD",162.5,162.5,30.02,"DT")
3081120
"^DD",162.5,162.5,31.02,0)
POA2^P161.94'^FB(161.94,^POA;2^Q
"^DD",162.5,162.5,31.02,3)
Enter the present on admission indicator for the ICD2 diagnosis.
"^DD",162.5,162.5,31.02,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,31.02,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,31.02,21,2,0)
diagnosis in the ICD2 field.
"^DD",162.5,162.5,31.02,"DT")
3081120
"^DD",162.5,162.5,32.02,0)
POA3^P161.94'^FB(161.94,^POA;3^Q
"^DD",162.5,162.5,32.02,3)
Enter the present on admission indicator for the ICD3 diagnosis.
"^DD",162.5,162.5,32.02,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,32.02,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,32.02,21,2,0)
diagnosis in the ICD3 field.
"^DD",162.5,162.5,32.02,"DT")
3081120
"^DD",162.5,162.5,33.02,0)
POA4^P161.94'^FB(161.94,^POA;4^Q
"^DD",162.5,162.5,33.02,3)
Enter the present on admission indicator for the ICD4 diagnosis.
"^DD",162.5,162.5,33.02,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,33.02,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,33.02,21,2,0)
diagnosis in the ICD4 field.
"^DD",162.5,162.5,33.02,"DT")
3081120
"^DD",162.5,162.5,34.02,0)
POA5^P161.94'^FB(161.94,^POA;5^Q
"^DD",162.5,162.5,34.02,3)
Enter the present on admission indicator for the ICD5 diagnosis.
"^DD",162.5,162.5,34.02,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,34.02,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,34.02,21,2,0)
diagnosis in the ICD5 field.
"^DD",162.5,162.5,34.02,"DT")
3081120
"^DD",162.5,162.5,35,0)
ICD6^P80'^ICD9(^DX;6^Q
"^DD",162.5,162.5,35,21,0)
^^1^1^3081119^
"^DD",162.5,162.5,35,21,1,0)
The sixth valid ICD code (if one exists) associated with this payment.
"^DD",162.5,162.5,35,"DT")
3081119
"^DD",162.5,162.5,35.02,0)
POA6^P161.94'^FB(161.94,^POA;6^Q
"^DD",162.5,162.5,35.02,3)
Enter the present on admission indicator for the ICD6 diagnosis.
"^DD",162.5,162.5,35.02,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,35.02,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,35.02,21,2,0)
diagnosis in the ICD6 field.
"^DD",162.5,162.5,35.02,"DT")
3081120
"^DD",162.5,162.5,35.1,0)
ICD7^P80'^ICD9(^DX;7^Q
"^DD",162.5,162.5,35.1,21,0)
^^1^1^3081119^
"^DD",162.5,162.5,35.1,21,1,0)
The seventh valid ICD code (if one exists) associated with this payment.
"^DD",162.5,162.5,35.1,"DT")
3081119
"^DD",162.5,162.5,35.12,0)
POA7^P161.94'^FB(161.94,^POA;7^Q
"^DD",162.5,162.5,35.12,3)
Enter the present on admission indicator for the ICD7 diagnosis.
"^DD",162.5,162.5,35.12,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,35.12,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,35.12,21,2,0)
diagnosis in the ICD7 field.
"^DD",162.5,162.5,35.12,"DT")
3081120
"^DD",162.5,162.5,35.2,0)
ICD8^P80'^ICD9(^DX;8^Q
"^DD",162.5,162.5,35.2,21,0)
^^1^1^3081119^
"^DD",162.5,162.5,35.2,21,1,0)
The eighth valid ICD code (if one exists) associated with this payment.
"^DD",162.5,162.5,35.2,"DT")
3081119
"^DD",162.5,162.5,35.22,0)
POA8^P161.94'^FB(161.94,^POA;8^Q
"^DD",162.5,162.5,35.22,3)
Enter the present on admission indicator for the ICD8 diagnosis.
"^DD",162.5,162.5,35.22,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,35.22,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,35.22,21,2,0)
diagnosis in the ICD8 field.
"^DD",162.5,162.5,35.22,"DT")
3081120
"^DD",162.5,162.5,35.3,0)
ICD9^P80'^ICD9(^DX;9^Q
"^DD",162.5,162.5,35.3,21,0)
^^1^1^3081119^
"^DD",162.5,162.5,35.3,21,1,0)
The ninth valid ICD code (if one exists) associated with this payment.
"^DD",162.5,162.5,35.3,"DT")
3081119
"^DD",162.5,162.5,35.32,0)
POA9^P161.94'^FB(161.94,^POA;9^Q
"^DD",162.5,162.5,35.32,3)
Enter the present on admission indicator for the ICD9 diagnosis.
"^DD",162.5,162.5,35.32,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,35.32,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,35.32,21,2,0)
diagnosis in the ICD9 field.
"^DD",162.5,162.5,35.32,"DT")
3081120
"^DD",162.5,162.5,35.4,0)
ICD10^P80'^ICD9(^DX;10^Q
"^DD",162.5,162.5,35.4,21,0)
^^1^1^3081119^
"^DD",162.5,162.5,35.4,21,1,0)
The tenth valid ICD code (if one exists) associated with this payment.
"^DD",162.5,162.5,35.4,"DT")
3081119
"^DD",162.5,162.5,35.42,0)
POA10^P161.94'^FB(161.94,^POA;10^Q
"^DD",162.5,162.5,35.42,3)
Enter the present on admission indicator for the ICD10 diagnosis.
"^DD",162.5,162.5,35.42,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,35.42,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,35.42,21,2,0)
diagnosis in the ICD10 field.
"^DD",162.5,162.5,35.42,"DT")
3081120
"^DD",162.5,162.5,35.5,0)
ICD11^P80'^ICD9(^DX;11^Q
"^DD",162.5,162.5,35.5,21,0)
^^1^1^3081119^
"^DD",162.5,162.5,35.5,21,1,0)
The eleventh valid ICD code (if one exists) associated with this payment.
"^DD",162.5,162.5,35.5,"DT")
3081119
"^DD",162.5,162.5,35.52,0)
POA11^P161.94'^FB(161.94,^POA;11^Q
"^DD",162.5,162.5,35.52,3)
Enter the present on admission indicator for the ICD11 diagnosis.
"^DD",162.5,162.5,35.52,21,0)
^.001^2^2^3081120^^
"^DD",162.5,162.5,35.52,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,35.52,21,2,0)
diagnosis in the ICD11 field.
"^DD",162.5,162.5,35.52,"DT")
3081120
"^DD",162.5,162.5,35.6,0)
ICD12^P80'^ICD9(^DX;12^Q
"^DD",162.5,162.5,35.6,21,0)
^^1^1^3081119^
"^DD",162.5,162.5,35.6,21,1,0)
The twelfth valid ICD code (if one exists) associated with this payment.
"^DD",162.5,162.5,35.6,"DT")
3081119
"^DD",162.5,162.5,35.62,0)
POA12^P161.94'^FB(161.94,^POA;12^Q
"^DD",162.5,162.5,35.62,3)
Enter the present on admission indicator for the ICD12 diagnosis.
"^DD",162.5,162.5,35.62,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,35.62,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,35.62,21,2,0)
diagnosis in the ICD12 field.
"^DD",162.5,162.5,35.62,"DT")
3081120
"^DD",162.5,162.5,35.7,0)
ICD13^P80'^ICD9(^DX;13^Q
"^DD",162.5,162.5,35.7,21,0)
^^2^2^3081119^
"^DD",162.5,162.5,35.7,21,1,0)
The thirteenth valid ICD code (if one exists) associated with this
"^DD",162.5,162.5,35.7,21,2,0)
payment.
"^DD",162.5,162.5,35.7,"DT")
3081119
"^DD",162.5,162.5,35.72,0)
POA13^P161.94'^FB(161.94,^POA;13^Q
"^DD",162.5,162.5,35.72,3)
Enter the present on admission indicator for the ICD13 diagnosis.
"^DD",162.5,162.5,35.72,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,35.72,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,35.72,21,2,0)
diagnosis in the ICD13 field.
"^DD",162.5,162.5,35.72,"DT")
3081120
"^DD",162.5,162.5,35.8,0)
ICD14^P80'^ICD9(^DX;14^Q
"^DD",162.5,162.5,35.8,21,0)
^^2^2^3081119^
"^DD",162.5,162.5,35.8,21,1,0)
The fourteenth valid ICD code (if one exists) associated with this
"^DD",162.5,162.5,35.8,21,2,0)
payment.
"^DD",162.5,162.5,35.8,"DT")
3081119
"^DD",162.5,162.5,35.82,0)
POA14^P161.94'^FB(161.94,^POA;14^Q
"^DD",162.5,162.5,35.82,3)
Enter the present on admission indicator for the ICD14 diagnosis.
"^DD",162.5,162.5,35.82,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,35.82,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,35.82,21,2,0)
diagnosis in the ICD14 field.
"^DD",162.5,162.5,35.82,"DT")
3081120
"^DD",162.5,162.5,35.9,0)
ICD15^P80'^ICD9(^DX;15^Q
"^DD",162.5,162.5,35.9,21,0)
^^1^1^3081119^
"^DD",162.5,162.5,35.9,21,1,0)
The fifteenth valid ICD code (if one exists) associated with this payment.
"^DD",162.5,162.5,35.9,"DT")
3081119
"^DD",162.5,162.5,35.92,0)
POA15^P161.94'^FB(161.94,^POA;15^Q
"^DD",162.5,162.5,35.92,3)
Enter the present on admission indicator for the ICD15 diagnosis.
"^DD",162.5,162.5,35.92,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,35.92,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,35.92,21,2,0)
diagnosis in the ICD15 field.
"^DD",162.5,162.5,35.92,"DT")
3081120
"^DD",162.5,162.5,36,0)
ICD16^P80'^ICD9(^DX;16^Q
"^DD",162.5,162.5,36,21,0)
^^1^1^3081119^
"^DD",162.5,162.5,36,21,1,0)
The sixteenth valid ICD code (if one exists) associated with this payment.
"^DD",162.5,162.5,36,"DT")
3081119
"^DD",162.5,162.5,36.02,0)
POA16^P161.94'^FB(161.94,^POA;16^Q
"^DD",162.5,162.5,36.02,3)
Enter the present on admission indicator for the ICD16 diagnosis.
"^DD",162.5,162.5,36.02,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,36.02,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,36.02,21,2,0)
diagnosis in the ICD16 field.
"^DD",162.5,162.5,36.02,"DT")
3081120
"^DD",162.5,162.5,36.1,0)
ICD17^P80'^ICD9(^DX;17^Q
"^DD",162.5,162.5,36.1,21,0)
^^2^2^3081119^
"^DD",162.5,162.5,36.1,21,1,0)
The seventeenth valid ICD code (if one exists) associated with this
"^DD",162.5,162.5,36.1,21,2,0)
payment.
"^DD",162.5,162.5,36.1,"DT")
3081119
"^DD",162.5,162.5,36.12,0)
POA17^P161.94'^FB(161.94,^POA;17^Q
"^DD",162.5,162.5,36.12,3)
Enter the present on admission indicator for the ICD17 diagnosis.
"^DD",162.5,162.5,36.12,21,0)
^.001^2^2^3081120^^
"^DD",162.5,162.5,36.12,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,36.12,21,2,0)
diagnosis in the ICD17 field.
"^DD",162.5,162.5,36.12,"DT")
3081120
"^DD",162.5,162.5,36.2,0)
ICD18^P80'^ICD9(^DX;18^Q
"^DD",162.5,162.5,36.2,21,0)
^^2^2^3081119^
"^DD",162.5,162.5,36.2,21,1,0)
The eighteenth valid ICD code (if one exists) associated with this
"^DD",162.5,162.5,36.2,21,2,0)
payment.
"^DD",162.5,162.5,36.2,"DT")
3081119
"^DD",162.5,162.5,36.22,0)
POA18^P161.94'^FB(161.94,^POA;18^Q
"^DD",162.5,162.5,36.22,3)
Enter the present on admission indicator for the ICD18 diagnosis.
"^DD",162.5,162.5,36.22,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,36.22,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,36.22,21,2,0)
diagnosis in the ICD18 field.
"^DD",162.5,162.5,36.22,"DT")
3081120
"^DD",162.5,162.5,36.3,0)
ICD19^P80'^ICD9(^DX;19^Q
"^DD",162.5,162.5,36.3,21,0)
^^2^2^3081119^
"^DD",162.5,162.5,36.3,21,1,0)
The nineteenth valid ICD code (if one exists) associated with this
"^DD",162.5,162.5,36.3,21,2,0)
payment.
"^DD",162.5,162.5,36.3,"DT")
3081119
"^DD",162.5,162.5,36.32,0)
POA19^P161.94'^FB(161.94,^POA;19^Q
"^DD",162.5,162.5,36.32,3)
Enter the present on admission indicator for the ICD19 diagnosis.
"^DD",162.5,162.5,36.32,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,36.32,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,36.32,21,2,0)
diagnosis in the ICD19 field.
"^DD",162.5,162.5,36.32,"DT")
3081120
"^DD",162.5,162.5,36.4,0)
ICD20^P80'^ICD9(^DX;20^Q
"^DD",162.5,162.5,36.4,21,0)
^^1^1^3081119^
"^DD",162.5,162.5,36.4,21,1,0)
The twentieth valid ICD code (if one exists) associated with this payment.
"^DD",162.5,162.5,36.4,"DT")
3081119
"^DD",162.5,162.5,36.42,0)
POA20^P161.94'^FB(161.94,^POA;20^Q
"^DD",162.5,162.5,36.42,3)
Enter the present on admission indicator for the ICD20 diagnosis.
"^DD",162.5,162.5,36.42,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,36.42,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,36.42,21,2,0)
diagnosis in the ICD20 field.
"^DD",162.5,162.5,36.42,"DT")
3081120
"^DD",162.5,162.5,36.5,0)
ICD21^P80'^ICD9(^DX;21^Q
"^DD",162.5,162.5,36.5,21,0)
^^2^2^3081119^
"^DD",162.5,162.5,36.5,21,1,0)
The twenty-first valid ICD code (if one exists) associated with this
"^DD",162.5,162.5,36.5,21,2,0)
payment.
"^DD",162.5,162.5,36.5,"DT")
3081119
"^DD",162.5,162.5,36.52,0)
POA21^P161.94'^FB(161.94,^POA;21^Q
"^DD",162.5,162.5,36.52,3)
Enter the present on admission indicator for the ICD21 diagnosis.
"^DD",162.5,162.5,36.52,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,36.52,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,36.52,21,2,0)
diagnosis in the ICD21 field.
"^DD",162.5,162.5,36.52,"DT")
3081120
"^DD",162.5,162.5,36.6,0)
ICD22^P80'^ICD9(^DX;22^Q
"^DD",162.5,162.5,36.6,21,0)
^^2^2^3081119^
"^DD",162.5,162.5,36.6,21,1,0)
The twenty-second valid ICD code (if one exists) associated with this
"^DD",162.5,162.5,36.6,21,2,0)
payment.
"^DD",162.5,162.5,36.6,"DT")
3081119
"^DD",162.5,162.5,36.62,0)
POA22^P161.94'^FB(161.94,^POA;22^Q
"^DD",162.5,162.5,36.62,3)
Enter the present on admission indicator for the ICD22 diagnosis.
"^DD",162.5,162.5,36.62,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,36.62,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,36.62,21,2,0)
diagnosis in the ICD22 field.
"^DD",162.5,162.5,36.62,"DT")
3081120
"^DD",162.5,162.5,36.7,0)
ICD23^P80'^ICD9(^DX;23^Q
"^DD",162.5,162.5,36.7,21,0)
^^2^2^3081119^
"^DD",162.5,162.5,36.7,21,1,0)
The twenty-third valid ICD code (if one exists) associated with this
"^DD",162.5,162.5,36.7,21,2,0)
payment.
"^DD",162.5,162.5,36.7,"DT")
3081119
"^DD",162.5,162.5,36.72,0)
POA23^P161.94'^FB(161.94,^POA;23^Q
"^DD",162.5,162.5,36.72,3)
Enter the present on admission indicator for the ICD23 diagnosis.
"^DD",162.5,162.5,36.72,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,36.72,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,36.72,21,2,0)
diagnosis in the ICD23 field.
"^DD",162.5,162.5,36.72,"DT")
3081120
"^DD",162.5,162.5,36.8,0)
ICD24^P80'^ICD9(^DX;24^Q
"^DD",162.5,162.5,36.8,21,0)
^^2^2^3081119^
"^DD",162.5,162.5,36.8,21,1,0)
The twenty-fourth valid ICD code (if one exists) associated with this
"^DD",162.5,162.5,36.8,21,2,0)
payment.
"^DD",162.5,162.5,36.8,"DT")
3081119
"^DD",162.5,162.5,36.82,0)
POA24^P161.94'^FB(161.94,^POA;24^Q
"^DD",162.5,162.5,36.82,3)
Enter the present on admission indicator for the ICD24 diagnosis.
"^DD",162.5,162.5,36.82,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,36.82,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,36.82,21,2,0)
diagnosis in the ICD24 field.
"^DD",162.5,162.5,36.82,"DT")
3081120
"^DD",162.5,162.5,36.9,0)
ICD25^P80'^ICD9(^DX;25^Q
"^DD",162.5,162.5,36.9,21,0)
^^2^2^3081119^
"^DD",162.5,162.5,36.9,21,1,0)
The twenty-fifth valid ICD code (if one exists) associated with this
"^DD",162.5,162.5,36.9,21,2,0)
payment.
"^DD",162.5,162.5,36.9,"DT")
3081119
"^DD",162.5,162.5,36.92,0)
POA25^P161.94'^FB(161.94,^POA;25^Q
"^DD",162.5,162.5,36.92,3)
Enter the present on admission indicator for the ICD25 diagnosis.
"^DD",162.5,162.5,36.92,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,36.92,21,1,0)
This field contains the present on admission (POA) indicator for the 
"^DD",162.5,162.5,36.92,21,2,0)
diagnosis in the ICD25 field.
"^DD",162.5,162.5,36.92,"DT")
3081120
"^DD",162.5,162.5,39,0)
ADMITTING DIAGNOSIS^RP80'^ICD9(^5;9^Q
"^DD",162.5,162.5,39,3)
Enter the admitting diagnosis for this claim.
"^DD",162.5,162.5,39,21,0)
^^1^1^3081202^
"^DD",162.5,162.5,39,21,1,0)
This is the admitting diagnosis code from the claim.
"^DD",162.5,162.5,39,"DT")
3081119
"^DD",162.5,162.5,44.06,0)
PROC6^P80.1'^ICD0(^PROC;6^Q
"^DD",162.5,162.5,44.06,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.06,21,1,0)
The sixth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.06,21,2,0)
payment.
"^DD",162.5,162.5,44.06,"DT")
3081120
"^DD",162.5,162.5,44.07,0)
PROC7^P80.1'^ICD0(^PROC;7^Q
"^DD",162.5,162.5,44.07,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.07,21,1,0)
The seventh valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.07,21,2,0)
payment.
"^DD",162.5,162.5,44.07,"DT")
3081120
"^DD",162.5,162.5,44.08,0)
PROC8^P80.1'^ICD0(^PROC;8^Q
"^DD",162.5,162.5,44.08,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.08,21,1,0)
The eighth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.08,21,2,0)
payment.
"^DD",162.5,162.5,44.08,"DT")
3081120
"^DD",162.5,162.5,44.09,0)
PROC9^P80.1'^ICD0(^PROC;9^Q
"^DD",162.5,162.5,44.09,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.09,21,1,0)
The ninth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.09,21,2,0)
payment.
"^DD",162.5,162.5,44.09,"DT")
3081120
"^DD",162.5,162.5,44.1,0)
PROC10^P80.1'^ICD0(^PROC;10^Q
"^DD",162.5,162.5,44.1,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.1,21,1,0)
The tenth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.1,21,2,0)
payment.
"^DD",162.5,162.5,44.1,"DT")
3081120
"^DD",162.5,162.5,44.11,0)
PROC11^P80.1'^ICD0(^PROC;11^Q
"^DD",162.5,162.5,44.11,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.11,21,1,0)
The eleventh valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.11,21,2,0)
payment.
"^DD",162.5,162.5,44.11,"DT")
3081120
"^DD",162.5,162.5,44.12,0)
PROC12^P80.1'^ICD0(^PROC;12^Q
"^DD",162.5,162.5,44.12,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.12,21,1,0)
The twelfth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.12,21,2,0)
payment.
"^DD",162.5,162.5,44.12,"DT")
3081120
"^DD",162.5,162.5,44.13,0)
PROC13^P80.1'^ICD0(^PROC;13^Q
"^DD",162.5,162.5,44.13,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.13,21,1,0)
The thirteenth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.13,21,2,0)
payment.
"^DD",162.5,162.5,44.13,"DT")
3081120
"^DD",162.5,162.5,44.14,0)
PROC14^P80.1'^ICD0(^PROC;14^Q
"^DD",162.5,162.5,44.14,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.14,21,1,0)
The fourteenth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.14,21,2,0)
payment.
"^DD",162.5,162.5,44.14,"DT")
3081120
"^DD",162.5,162.5,44.15,0)
PROC15^P80.1'^ICD0(^PROC;15^Q
"^DD",162.5,162.5,44.15,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.15,21,1,0)
The fifteenth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.15,21,2,0)
payment.
"^DD",162.5,162.5,44.15,"DT")
3081120
"^DD",162.5,162.5,44.16,0)
PROC16^P80.1'^ICD0(^PROC;16^Q
"^DD",162.5,162.5,44.16,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.16,21,1,0)
The sixteenth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.16,21,2,0)
payment.
"^DD",162.5,162.5,44.16,"DT")
3081120
"^DD",162.5,162.5,44.17,0)
PROC17^P80.1'^ICD0(^PROC;17^Q
"^DD",162.5,162.5,44.17,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.17,21,1,0)
The seventeenth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.17,21,2,0)
payment.
"^DD",162.5,162.5,44.17,"DT")
3081120
"^DD",162.5,162.5,44.18,0)
PROC18^P80.1'^ICD0(^PROC;18^Q
"^DD",162.5,162.5,44.18,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.18,21,1,0)
The eighteenth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.18,21,2,0)
payment.
"^DD",162.5,162.5,44.18,"DT")
3081120
"^DD",162.5,162.5,44.19,0)
PROC19^P80.1'^ICD0(^PROC;19^Q
"^DD",162.5,162.5,44.19,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.19,21,1,0)
The nineteenth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.19,21,2,0)
payment.
"^DD",162.5,162.5,44.19,"DT")
3081120
"^DD",162.5,162.5,44.2,0)
PROC20^P80.1'^ICD0(^PROC;20^Q
"^DD",162.5,162.5,44.2,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.2,21,1,0)
The twentieth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.2,21,2,0)
payment.
"^DD",162.5,162.5,44.2,"DT")
3081120
"^DD",162.5,162.5,44.21,0)
PROC21^P80.1'^ICD0(^PROC;21^Q
"^DD",162.5,162.5,44.21,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.21,21,1,0)
The twenty-first valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.21,21,2,0)
payment.
"^DD",162.5,162.5,44.21,"DT")
3081120
"^DD",162.5,162.5,44.22,0)
PROC22^P80.1'^ICD0(^PROC;22^Q
"^DD",162.5,162.5,44.22,21,0)
^^2^2^3081202^
"^DD",162.5,162.5,44.22,21,1,0)
The twenty-second valid procedure code (if one exists) associated with
"^DD",162.5,162.5,44.22,21,2,0)
this payment.
"^DD",162.5,162.5,44.22,"DT")
3081120
"^DD",162.5,162.5,44.23,0)
PROC23^P80.1'^ICD0(^PROC;23^Q
"^DD",162.5,162.5,44.23,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.23,21,1,0)
The twenty-third valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.23,21,2,0)
payment.
"^DD",162.5,162.5,44.23,"DT")
3081120
"^DD",162.5,162.5,44.24,0)
PROC24^P80.1'^ICD0(^PROC;24^Q
"^DD",162.5,162.5,44.24,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.24,21,1,0)
The twenty-fourth valid procedure code (if one exists) associated with 
"^DD",162.5,162.5,44.24,21,2,0)
this payment.
"^DD",162.5,162.5,44.24,"DT")
3081120
"^DD",162.5,162.5,44.25,0)
PROC25^P80.1'^ICD0(^PROC;25^Q
"^DD",162.5,162.5,44.25,21,0)
^^2^2^3081120^
"^DD",162.5,162.5,44.25,21,1,0)
The twenty-fifth valid procedure code (if one exists) associated with this
"^DD",162.5,162.5,44.25,21,2,0)
payment.
"^DD",162.5,162.5,44.25,"DT")
3081120
"^DD",162.5,162.5,60,0)
CONTRACT^P161.43'^FBAA(161.43,^5;8^Q
"^DD",162.5,162.5,60,1,0)
^.1
"^DD",162.5,162.5,60,1,1,0)
162.5^ACN
"^DD",162.5,162.5,60,1,1,1)
S ^FBAAI("ACN",$E(X,1,30),DA)=""
"^DD",162.5,162.5,60,1,1,2)
K ^FBAAI("ACN",$E(X,1,30),DA)
"^DD",162.5,162.5,60,1,1,"%D",0)
^^3^3^3090528^
"^DD",162.5,162.5,60,1,1,"%D",1,0)
This is an index of contracts entered for invoices. The index will be used
"^DD",162.5,162.5,60,1,1,"%D",2,0)
to prevent deletion of entries from the FEE BASIS CONTRACT file that are
"^DD",162.5,162.5,60,1,1,"%D",3,0)
referenced (pointed to) by an invoice.
"^DD",162.5,162.5,60,1,1,"DT")
3090528
"^DD",162.5,162.5,60,3)
If applicable, select the contract.
"^DD",162.5,162.5,60,21,0)
^.001^3^3^3111227^^
"^DD",162.5,162.5,60,21,1,0)
If the payment is for contracted services, the contract number can be
"^DD",162.5,162.5,60,21,2,0)
specified in this field.  The selected contract must be active and
"^DD",162.5,162.5,60,21,3,0)
applicable to the vendor being paid.
"^DD",162.5,162.5,60,23,0)
^.001^3^3^3111227^^
"^DD",162.5,162.5,60,23,1,0)
In some cases this field will be automatically populated by the software
"^DD",162.5,162.5,60,23,2,0)
based on the associated authorization. In other cases, the user will be
"^DD",162.5,162.5,60,23,3,0)
prompted for a value.
"^DD",162.5,162.5,60,"DT")
3090709
"^DD",162.5,162.5,79,0)
LINE ITEM RENDERING PROV^162.579^^RPROV;0
"^DD",162.5,162.5,79,21,0)
^.001^7^7^3120215^^
"^DD",162.5,162.5,79,21,1,0)
This multiple stores Rendering Provider information that is specific 
"^DD",162.5,162.5,79,21,2,0)
to a line item on the claim. A record should only be added to this 
"^DD",162.5,162.5,79,21,3,0)
multiple if the Rendering Provider for a line item is different from the 
"^DD",162.5,162.5,79,21,4,0)
Rendering Provider at the claim level. Example, if the PROC1 code is
"^DD",162.5,162.5,79,21,5,0)
entered and has a different Rendering Provider than the claim Rendering 
"^DD",162.5,162.5,79,21,6,0)
Provider (field #70) the multiple will store the different data. Line 
"^DD",162.5,162.5,79,21,7,0)
item #1 would be referencing PROC1; Line Item #5 would reference PROC5.
"^DD",162.5,162.558,2,0)
ADJUSTMENT AMOUNT^RNJ9,2X^^0;3^S:X["$" X=$P(X,"$",2) K:X'?."-".N.1".".2N!(X>9999999.99)!(X<-9999999.99) X I $D(X) K:+X=0 X
"^DD",162.5,162.558,2,3)
Type a non-zero Dollar Amount between -9999999.99 and 9999999.99, 2 Decimal Digits
"^DD",162.5,162.558,2,21,0)
^.001^2^2^3081119^^^
"^DD",162.5,162.558,2,21,1,0)
Enter the dollar amount that is not being paid for this charge per the 
"^DD",162.5,162.558,2,21,2,0)
adjustment reason.
"^DD",162.5,162.558,2,"DT")
3081119
"^DD",162.5,162.579,0)
LINE ITEM RENDERING PROV SUB-FIELD^^.04^4
"^DD",162.5,162.579,0,"NM","LINE ITEM RENDERING PROV")

"^DD",162.5,162.579,.01,0)
LINE ITEM NUMBER^MNJ1,0X^^0;1^K:+X'=X!(X>25)!(X<0)!(X?.E1"."1N.N) X
"^DD",162.5,162.579,.01,1,0)
^.1
"^DD",162.5,162.579,.01,1,1,0)
162.579^B
"^DD",162.5,162.579,.01,1,1,1)
S ^FBAAI(DA(1),"RPROV","B",$E(X,1,30),DA)=""
"^DD",162.5,162.579,.01,1,1,2)
K ^FBAAI(DA(1),"RPROV","B",$E(X,1,30),DA)
"^DD",162.5,162.579,.01,3)
Type a number between 0 and 25, 0 decimal digits.
"^DD",162.5,162.579,.01,21,0)
^.001^4^4^3120216^^^^
"^DD",162.5,162.579,.01,21,1,0)
Enter the line item number for the associated Rendering Provider 
"^DD",162.5,162.579,.01,21,2,0)
information. Example, Line item 3 has a Rendering Provider different than 
"^DD",162.5,162.579,.01,21,3,0)
the claim level Rendering Provider. You would enter 3 to associate this 
"^DD",162.5,162.579,.01,21,4,0)
different Rendering Provider to the line item 3 of the claim.
"^DD",162.5,162.579,.01,"DT")
3120215
"^DD",162.7,162.7,8,0)
AMOUNT CLAIMED^NJ10,2^^0;9^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<0) X
"^DD",162.7,162.7,8,3)
Type a Dollar Amount between 0 and 9999999.99, 2 Decimal Digits
"^DD",162.7,162.7,8,21,0)
^.001^1^1^3090108^^
"^DD",162.7,162.7,8,21,1,0)
The dollar amount being claimed.
"^DD",162.7,162.7,8,"DT")
3090108
"^DD",162.7,162.7,14,0)
AMOUNT APPROVED^NJ10,2^^0;15^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999.99)!(X<.01) X
"^DD",162.7,162.7,14,3)
Type a Dollar Amount between .01 and 9999999.99, 2 Decimal Digits
"^DD",162.7,162.7,14,21,0)
^.001^1^1^3090108^^
"^DD",162.7,162.7,14,21,1,0)
The authorized amount for payment of an unauthorized claim.
"^DD",162.7,162.7,14,"DT")
3090108
"^DIC",161.43,161.43,0)
FEE BASIS CONTRACT^161.43
"^DIC",161.43,161.43,0,"GL")
^FBAA(161.43,
"^DIC",161.43,161.43,"%",0)
^1.005^^0
"^DIC",161.43,161.43,"%D",0)
^^6^6^3090522^
"^DIC",161.43,161.43,"%D",1,0)
This file contains a list of contracts for the local site.  New outpatient
"^DIC",161.43,161.43,"%D",2,0)
and civil hospital authorizations and payments can be linked to an active
"^DIC",161.43,161.43,"%D",3,0)
contract.  The contract number will be included with associated payments
"^DIC",161.43,161.43,"%D",4,0)
that are transmitted to Central Fee.  Note that contracts for community
"^DIC",161.43,161.43,"%D",5,0)
nursing home rates are stored in the FEE BASIS CNH CONTRACT file instead
"^DIC",161.43,161.43,"%D",6,0)
of this file.
"^DIC",161.43,"B","FEE BASIS CONTRACT",161.43)

"^DIC",161.94,161.94,0)
PRESENT ON ADMISSION^161.94
"^DIC",161.94,161.94,0,"GL")
^FB(161.94,
"^DIC",161.94,161.94,"%D",0)
^^4^4^3081120^
"^DIC",161.94,161.94,"%D",1,0)
The file contains the present on admission (POA) indicator codes.  These
"^DIC",161.94,161.94,"%D",2,0)
codes are defined by the Center for Medicare & Medicaid Services (CMS) and
"^DIC",161.94,161.94,"%D",3,0)
should not be locally modified.  The codes are used to indicate if a 
"^DIC",161.94,161.94,"%D",4,0)
diagnosis was present on admission 
"^DIC",161.94,"B","PRESENT ON ADMISSION",161.94)

"BLD",8586,6)
^115
**END**
**END**
