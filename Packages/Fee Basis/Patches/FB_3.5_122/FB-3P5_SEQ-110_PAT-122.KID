EMERGENCY Released FB*3.5*122 SEQ #110
Extracted from mail message
**KIDS**:FB*3.5*122^

**INSTALL NAME**
FB*3.5*122
"BLD",8565,0)
FB*3.5*122^FEE BASIS^0^3111027^y
"BLD",8565,4,0)
^9.64PA^162.5^2
"BLD",8565,4,162,0)
162
"BLD",8565,4,162,2,0)
^9.641^162.02^1
"BLD",8565,4,162,2,162.02,0)
INITIAL TREATMENT DATE  (sub-file)
"BLD",8565,4,162,2,162.02,1,0)
^9.6411^79^4
"BLD",8565,4,162,2,162.02,1,76,0)
SERVICING FACILITY ADDRESS
"BLD",8565,4,162,2,162.02,1,77,0)
SERVICING FACILITY CITY
"BLD",8565,4,162,2,162.02,1,78,0)
SERVICING FACILITY STATE
"BLD",8565,4,162,2,162.02,1,79,0)
SERVICING FACILITY ZIP
"BLD",8565,4,162,222)
y^y^p^^^^n^^n
"BLD",8565,4,162,224)

"BLD",8565,4,162.5,0)
162.5
"BLD",8565,4,162.5,2,0)
^9.641^162.5^1
"BLD",8565,4,162.5,2,162.5,0)
FEE BASIS INVOICE  (File-top level)
"BLD",8565,4,162.5,2,162.5,1,0)
^9.6411^83^4
"BLD",8565,4,162.5,2,162.5,1,80,0)
SERVICING FACILITY ADDRESS
"BLD",8565,4,162.5,2,162.5,1,81,0)
SERVICING FACILITY CITY
"BLD",8565,4,162.5,2,162.5,1,82,0)
SERVICING FACILITY STATE
"BLD",8565,4,162.5,2,162.5,1,83,0)
SERVICING FACILITY ZIP
"BLD",8565,4,162.5,222)
y^y^p^^^^n^^n
"BLD",8565,4,162.5,224)

"BLD",8565,4,"APDD",162,162.02)

"BLD",8565,4,"APDD",162,162.02,76)

"BLD",8565,4,"APDD",162,162.02,77)

"BLD",8565,4,"APDD",162,162.02,78)

"BLD",8565,4,"APDD",162,162.02,79)

"BLD",8565,4,"APDD",162.5,162.5)

"BLD",8565,4,"APDD",162.5,162.5,80)

"BLD",8565,4,"APDD",162.5,162.5,81)

"BLD",8565,4,"APDD",162.5,162.5,82)

"BLD",8565,4,"APDD",162.5,162.5,83)

"BLD",8565,4,"B",162,162)

"BLD",8565,4,"B",162.5,162.5)

"BLD",8565,6.3)
8
"BLD",8565,"KRN",0)
^9.67PA^779.2^20
"BLD",8565,"KRN",.4,0)
.4
"BLD",8565,"KRN",.401,0)
.401
"BLD",8565,"KRN",.402,0)
.402
"BLD",8565,"KRN",.402,"NM",0)
^9.68A^5^5
"BLD",8565,"KRN",.402,"NM",1,0)
FBCH ENTER PAYMENT    FILE #162.5^162.5^0
"BLD",8565,"KRN",.402,"NM",2,0)
FBCH EDIT PAYMENT    FILE #162.5^162.5^0
"BLD",8565,"KRN",.402,"NM",3,0)
FBAA NEW VENDOR    FILE #161.2^161.2^0
"BLD",8565,"KRN",.402,"NM",4,0)
FBAA EDIT VENDOR    FILE #161.2^161.2^0
"BLD",8565,"KRN",.402,"NM",5,0)
FBAA SITE PARAMETERS    FILE #161.4^161.4^0
"BLD",8565,"KRN",.402,"NM","B","FBAA EDIT VENDOR    FILE #161.2",4)

"BLD",8565,"KRN",.402,"NM","B","FBAA NEW VENDOR    FILE #161.2",3)

"BLD",8565,"KRN",.402,"NM","B","FBAA SITE PARAMETERS    FILE #161.4",5)

"BLD",8565,"KRN",.402,"NM","B","FBCH EDIT PAYMENT    FILE #162.5",2)

"BLD",8565,"KRN",.402,"NM","B","FBCH ENTER PAYMENT    FILE #162.5",1)

"BLD",8565,"KRN",.403,0)
.403
"BLD",8565,"KRN",.5,0)
.5
"BLD",8565,"KRN",.84,0)
.84
"BLD",8565,"KRN",3.6,0)
3.6
"BLD",8565,"KRN",3.8,0)
3.8
"BLD",8565,"KRN",9.2,0)
9.2
"BLD",8565,"KRN",9.8,0)
9.8
"BLD",8565,"KRN",9.8,"NM",0)
^9.68A^23^22
"BLD",8565,"KRN",9.8,"NM",1,0)
FBAAPET^^0^B35557510
"BLD",8565,"KRN",9.8,"NM",2,0)
FBAACO^^0^B28594326
"BLD",8565,"KRN",9.8,"NM",3,0)
FBAACO2^^0^B13323096
"BLD",8565,"KRN",9.8,"NM",4,0)
FBAAPIN^^0^B33397999
"BLD",8565,"KRN",9.8,"NM",5,0)
FBCHDI2^^0^B4376803
"BLD",8565,"KRN",9.8,"NM",6,0)
FBUTL8^^0^B31445484
"BLD",8565,"KRN",9.8,"NM",7,0)
FBCHEP^^0^B30542505
"BLD",8565,"KRN",9.8,"NM",8,0)
FBCHEP1^^0^B11345024
"BLD",8565,"KRN",9.8,"NM",9,0)
FBFHLX^^0^B58317729
"BLD",8565,"KRN",9.8,"NM",10,0)
FBFHLX1^^0^B30972593
"BLD",8565,"KRN",9.8,"NM",11,0)
FBFHLX2^^0^B5499281
"BLD",8565,"KRN",9.8,"NM",12,0)
FBCHVH^^0^B25718092
"BLD",8565,"KRN",9.8,"NM",13,0)
FBMON^^0^B36112227
"BLD",8565,"KRN",9.8,"NM",14,0)
FBFHLD3^^0^B18574752
"BLD",8565,"KRN",9.8,"NM",15,0)
FBFHLD9^^0^B11448900
"BLD",8565,"KRN",9.8,"NM",16,0)
FBFHLS^^0^B61137128
"BLD",8565,"KRN",9.8,"NM",17,0)
FBAAVD^^0^B28132185
"BLD",8565,"KRN",9.8,"NM",18,0)
FBAAVD2^^0^B33240026
"BLD",8565,"KRN",9.8,"NM",19,0)
FBAACO3^^0^B50872609
"BLD",8565,"KRN",9.8,"NM",21,0)
FBPCR2^^0^B61489051
"BLD",8565,"KRN",9.8,"NM",22,0)
FBPCR67^^0^B24858243
"BLD",8565,"KRN",9.8,"NM",23,0)
FBPCR671^^0^B40566981
"BLD",8565,"KRN",9.8,"NM","B","FBAACO",2)

"BLD",8565,"KRN",9.8,"NM","B","FBAACO2",3)

"BLD",8565,"KRN",9.8,"NM","B","FBAACO3",19)

"BLD",8565,"KRN",9.8,"NM","B","FBAAPET",1)

"BLD",8565,"KRN",9.8,"NM","B","FBAAPIN",4)

"BLD",8565,"KRN",9.8,"NM","B","FBAAVD",17)

"BLD",8565,"KRN",9.8,"NM","B","FBAAVD2",18)

"BLD",8565,"KRN",9.8,"NM","B","FBCHDI2",5)

"BLD",8565,"KRN",9.8,"NM","B","FBCHEP",7)

"BLD",8565,"KRN",9.8,"NM","B","FBCHEP1",8)

"BLD",8565,"KRN",9.8,"NM","B","FBCHVH",12)

"BLD",8565,"KRN",9.8,"NM","B","FBFHLD3",14)

"BLD",8565,"KRN",9.8,"NM","B","FBFHLD9",15)

"BLD",8565,"KRN",9.8,"NM","B","FBFHLS",16)

"BLD",8565,"KRN",9.8,"NM","B","FBFHLX",9)

"BLD",8565,"KRN",9.8,"NM","B","FBFHLX1",10)

"BLD",8565,"KRN",9.8,"NM","B","FBFHLX2",11)

"BLD",8565,"KRN",9.8,"NM","B","FBMON",13)

"BLD",8565,"KRN",9.8,"NM","B","FBPCR2",21)

"BLD",8565,"KRN",9.8,"NM","B","FBPCR67",22)

"BLD",8565,"KRN",9.8,"NM","B","FBPCR671",23)

"BLD",8565,"KRN",9.8,"NM","B","FBUTL8",6)

"BLD",8565,"KRN",19,0)
19
"BLD",8565,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",8565,"KRN",19,"NM",1,0)
FB FPPS MONITOR
"BLD",8565,"KRN",19,"NM","B","FB FPPS MONITOR",1)

"BLD",8565,"KRN",19.1,0)
19.1
"BLD",8565,"KRN",101,0)
101
"BLD",8565,"KRN",409.61,0)
409.61
"BLD",8565,"KRN",771,0)
771
"BLD",8565,"KRN",779.2,0)
779.2
"BLD",8565,"KRN",870,0)
870
"BLD",8565,"KRN",8989.51,0)
8989.51
"BLD",8565,"KRN",8989.52,0)
8989.52
"BLD",8565,"KRN",8994,0)
8994
"BLD",8565,"KRN","B",.4,.4)

"BLD",8565,"KRN","B",.401,.401)

"BLD",8565,"KRN","B",.402,.402)

"BLD",8565,"KRN","B",.403,.403)

"BLD",8565,"KRN","B",.5,.5)

"BLD",8565,"KRN","B",.84,.84)

"BLD",8565,"KRN","B",3.6,3.6)

"BLD",8565,"KRN","B",3.8,3.8)

"BLD",8565,"KRN","B",9.2,9.2)

"BLD",8565,"KRN","B",9.8,9.8)

"BLD",8565,"KRN","B",19,19)

"BLD",8565,"KRN","B",19.1,19.1)

"BLD",8565,"KRN","B",101,101)

"BLD",8565,"KRN","B",409.61,409.61)

"BLD",8565,"KRN","B",771,771)

"BLD",8565,"KRN","B",779.2,779.2)

"BLD",8565,"KRN","B",870,870)

"BLD",8565,"KRN","B",8989.51,8989.51)

"BLD",8565,"KRN","B",8989.52,8989.52)

"BLD",8565,"KRN","B",8994,8994)

"BLD",8565,"QUES",0)
^9.62^^
"BLD",8565,"REQB",0)
^9.611^5^5
"BLD",8565,"REQB",1,0)
FB*3.5*121^2
"BLD",8565,"REQB",2,0)
FB*3.5*68^2
"BLD",8565,"REQB",3,0)
FB*3.5*82^2
"BLD",8565,"REQB",4,0)
FB*3.5*111^2
"BLD",8565,"REQB",5,0)
FB*3.5*116^2
"BLD",8565,"REQB","B","FB*3.5*111",4)

"BLD",8565,"REQB","B","FB*3.5*116",5)

"BLD",8565,"REQB","B","FB*3.5*121",1)

"BLD",8565,"REQB","B","FB*3.5*68",2)

"BLD",8565,"REQB","B","FB*3.5*82",3)

"FIA",162)
FEE BASIS PAYMENT
"FIA",162,0)
^FBAAC(
"FIA",162,0,0)
162P
"FIA",162,0,1)
y^y^p^^^^n^^n
"FIA",162,0,10)

"FIA",162,0,11)

"FIA",162,0,"RLRO")

"FIA",162,0,"VR")
3.5^FB
"FIA",162,162)
1
"FIA",162,162.02)
1
"FIA",162,162.02,76)

"FIA",162,162.02,77)

"FIA",162,162.02,78)

"FIA",162,162.02,79)

"FIA",162.5)
FEE BASIS INVOICE
"FIA",162.5,0)
^FBAAI(
"FIA",162.5,0,0)
162.5
"FIA",162.5,0,1)
y^y^p^^^^n^^n
"FIA",162.5,0,10)

"FIA",162.5,0,11)

"FIA",162.5,0,"RLRO")

"FIA",162.5,0,"VR")
3.5^FB
"FIA",162.5,162.5)
1
"FIA",162.5,162.5,80)

"FIA",162.5,162.5,81)

"FIA",162.5,162.5,82)

"FIA",162.5,162.5,83)

"KRN",.402,570,-1)
0^4
"KRN",.402,570,0)
FBAA EDIT VENDOR^3110621.1419^^161.2^^^3110906
"KRN",.402,570,"DIAB",1,1,161.225,0)
ALL
"KRN",.402,570,"DIAB",2,0,161.2,1)
.05;REQ
"KRN",.402,570,"DIAB",5,0,161.2,2)
22;REQ
"KRN",.402,570,"DIAB",6,0,161.2,0)
30.06;T
"KRN",.402,570,"DR",1,161.2)
S FBTV="",FBPARCD="";.01;1;S FBID=X;W !,"Is the ID NUMBER a Tax # or SSN?";30.06T~;6;S FBTV=X;I FBTV=3&(FBID'?9N) W !!,*7,"Pharmacy Vendor ID must be 9 numerics only!!" S Y=1;24;S FBBT=X;25;S:$$VGRP^FBAAUTL6(D0) Y=24;7;S FBPARCD=X;
"KRN",.402,570,"DR",1,161.2,1)
S:FBTV'=2 Y="@3";.05R~;S Y=2;@3;.05///@;2;2.5;3;4;5;5.5;14;23;30.03////Y;30.05////B;30.04////^S X=$S(FBTV=2:"I",FBTV=10:"F",1:"C");D EN^FBAAVD4;42;S:FBPARCD=6 Y="@22";S:FBPARCD=14 Y=8;22;S:FBPARCD=5 Y=.18;S:FBTV'=3 Y="";8;S Y="";
"KRN",.402,570,"DR",1,161.2,2)
@22;30.02;S FBEXMPT=X;S:$G(FBEXMPT)="Y" Y="@23";22R~;S Y="";@23;22;K FBEXMPT S Y="";.18;18;19;20;
"KRN",.402,570,"DR",2,161.225)
.01
"KRN",.402,571,-1)
0^3
"KRN",.402,571,0)
FBAA NEW VENDOR^3110621.142^^161.2^^^3110906
"KRN",.402,571,"DIAB",1,1,161.225,0)
ALL
"KRN",.402,571,"DIAB",3,0,161.2,1)
.05;REQ
"KRN",.402,571,"DIAB",3,0,161.2,2)
22;REQ
"KRN",.402,571,"DIAB",6,0,161.2,0)
30.06;T
"KRN",.402,571,"DR",1,161.2)
S FBPARCD="";.01;1;S FBID=X;W !,"Is the ID NUMBER a Tax # or SSN?";30.06T~;6;S FBTV=X;I FBTV=3&(FBID'?9N) W !!,*7,"Pharmacy Vendor ID must be 9 numerics!" S Y=1;24;S FBBT=X;25;S:$$VGRP^FBAAUTL6(D0) Y=24;S:FBTV=3 FBPARCD=14,Y=2;7;
"KRN",.402,571,"DR",1,161.2,1)
S FBPARCD=X;S:FBTV'=2 Y=2;.05R~;2;2.5;3;4;5;5.5;14;23;30.03////Y;30.05////B;30.04////^S X=$S(FBTV=2:"I",FBTV=10:"F",1:"C");D EN^FBAAVD4;42;S:FBPARCD=6 Y="@22";S:FBPARCD=14 Y=8;22;S:FBPARCD=5 Y=.18;S:FBTV'=3 Y="";8;S Y="";@22;30.02;
"KRN",.402,571,"DR",1,161.2,2)
S FBEXMPT=X;S:FBEXMPT="Y" Y="@23";22R~;S Y="";@23;22;K FBEXMPT S Y="";.18;18;19;20;
"KRN",.402,571,"DR",2,161.225)
.01
"KRN",.402,583,-1)
0^5
"KRN",.402,583,0)
FBAA SITE PARAMETERS^3011107.0858^^161.4^^^3110906
"KRN",.402,583,"DIAB",13,0,161.4,0)
32;T
"KRN",.402,583,"DR",1,161.4)
.01;I $$VER^FBAAUTL2(161.4)=3,$D(^FBAA(161.4,1,0)) S $P(^(1),U,10)="FEE";I $D(^FBAA(161.4,1,0)),$P(^(1),U,9)="" S $P(^(1),U,9)=125;1;2;16;3:8;9;12:14;15;17:19;21:28;32T~;32.5;33;34;35;35.5;35.6;35.7;
"KRN",.402,583,"DR",2,161.428)
.01
"KRN",.402,1175,-1)
0^1
"KRN",.402,1175,0)
FBCH ENTER PAYMENT^3110623.122^^162.5^^^3110526
"KRN",.402,1175,"DR",1,162.5)
1////^S X=FBAAID;46////^S X=FBAAVID;55///^S X=FBCSID;56///^S X=$G(FBFPPSC);57///^S X=$G(FBFPPSL);47////^S X=FBAAMM1;2////^S X=FBVEN;3////^S X=FBVET;4////^S X=FBI7078;5////^S X=FBAABDT;6////^S X=FBAAEDT;23////^S X=FBPSA;
"KRN",.402,1175,"DR",1,162.5,1)
21////^S X=FBPOV;22////^S X=FBPT;11////^S X=FBTYPE;12////^S X=FBAAPTC;20////^S X=FBAABE;W !;6.5;54//^S X=$G(FBCDAYS);6.6;I 1;7;S FBAMTC=X;I $G(FBEXMPT)'="Y" S Y="@25";S:FBI7078'["FB583" Y=8;S:'$P($G(^FB583(+FBI7078,0)),U,28) Y=8;
"KRN",.402,1175,"DR",1,162.5,2)
W !?2,"**Payment is for emergency treatment under 38 U.S.C. 1725.";8;S FBAMTP=X;I FBAMTC=FBAMTP S Y="@25";S FBX=$$ADJ^FBUTL2(FBAMTC-FBAMTP,.FBADJ,1,,,1);@20;I $G(FBEXMPT)="Y" S Y="@25";@26;24;
"KRN",.402,1175,"DR",1,162.5,3)
I $$INPICD^FBCSV1(X,$G(DA),FBAABDT) S Y="@26";@25;6.7;I 1;64;65;66;67;68;69;70;71;72;73;80;81;82;83;74;75;@30;30;I $$INPICD9^FBCSV1(X,$G(DA),FBAABDT) S Y="@30";@35;31;S:X="" Y=40;I $$INPICD9^FBCSV1(X,$G(DA),FBAABDT) S Y="@35";@40;
"KRN",.402,1175,"DR",1,162.5,4)
32;S:X="" Y=40;I $$INPICD9^FBCSV1(X,$G(DA),FBAABDT) S Y="@40";@45;33;S:X="" Y=40;I $$INPICD9^FBCSV1(X,$G(DA),FBAABDT) S Y="@45";@50;34;S:X="" Y=40;I $$INPICD9^FBCSV1(X,$G(DA),FBAABDT) S Y="@50";@55;40;S:X="" Y="@99";
"KRN",.402,1175,"DR",1,162.5,5)
I $$INPICD0^FBCSV1(X,$G(DA),FBAABDT) S Y="@55";@60;41;S:X="" Y="@99";I $$INPICD0^FBCSV1(X,$G(DA),FBAABDT) S Y="@60";@65;42;S:X="" Y="@99";I $$INPICD0^FBCSV1(X,$G(DA),FBAABDT) S Y="@65";@70;43;S:X="" Y="@99";
"KRN",.402,1175,"DR",1,162.5,6)
I $$INPICD0^FBCSV1(X,$G(DA),FBAABDT) S Y="@70";@75;44;S:X="" Y="@99";I $$INPICD0^FBCSV1(X,$G(DA),FBAABDT) S Y="@75";@99;I $D(^FBAAI(DA,"DX")),$P(^("DX"),U)="" W !!,*7,"The 'ICD1' field is a manditory field!",! S Y="@30";
"KRN",.402,1175,"DR",1,162.5,7)
S FBX=$$RPROV^FBUTL8(.FBPROV,.FBPROVD);I $G(FBEXMPT)'="Y" S Y="@992";S FBX=$$RR^FBUTL4(.FBRRMK,2);@992;25////^S X=FBRESUB;
"KRN",.402,1176,-1)
0^2
"KRN",.402,1176,0)
FBCH EDIT PAYMENT^3110616.1359^^162.5^^^3110616
"KRN",.402,1176,"DIAB",5,0,162.5,3)
24;REQ
"KRN",.402,1176,"DIAB",7,0,162.5,3)
24.5;REQ
"KRN",.402,1176,"DR",1,162.5)
1;I 1;46;55;S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="" Y="@10";56///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL,1);S:FBX=-1 Y=0;57///^S X=FBX;S FBFPPSL=X;S Y="@14";@10;56///@;S FBFPPSC="";57///@;S FBFPPSL="";@14;
"KRN",.402,1176,"DR",1,162.5,1)
S FBAAMM=1;D PPT^FBAACO1();47////@;47///^S X=FBAAMM1;6.5;54;6.6;I 1;6.7;64;65;66;67;68;69;70;71;72;73;80;81;82;83;74;75;S DIE("NO^")="NO QUIT";7;S:$D(FBPRICE) Y="@25";S FBJJ=X;I $G(FBEXMPT)="Y" S Y="@20";26;S FBPAMT=X;@20;
"KRN",.402,1176,"DR",1,162.5,2)
W:FB1725 !?2,"**Payment is for emergency treatment under 38 U.S.C. 1725.";W:FB1725&($G(FBPAMT)>0) !?2,"  70% of Pricer Amount = "_$J(.7*FBPAMT,0,2);8;S FBKK=X;K FBADJD;M FBADJD=FBADJ;
"KRN",.402,1176,"DR",1,162.5,3)
S FBX=$$ADJ^FBUTL2(FBJJ-FBKK,.FBADJ,1,,.FBADJD,1);K FBADJD;I $G(FBEXMPT)="Y" S Y=30;@26;24R~;I $$INPICD^FBCSV1(X,$G(DA)) S Y="@26";24.5R~;@25;30;S:X="" Y=40;I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@25";@30;31;S:X="" Y=40;
"KRN",.402,1176,"DR",1,162.5,4)
I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@30";@35;32;S:X="" Y=40;I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@35";@40;33;S:X="" Y=40;I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@40";@45;34;S:X="" Y=40;I $$INPICD9^FBCSV1(X,$G(DA)) S Y="@45";@50;40;
"KRN",.402,1176,"DR",1,162.5,5)
S:X="" Y="@99";I $$INPICD0^FBCSV1(X,$G(DA)) S Y="@50";@55;41;S:X="" Y="@99";I $$INPICD0^FBCSV1(X,$G(DA)) S Y="@55";@60;42;S:X="" Y="@99";I $$INPICD0^FBCSV1(X,$G(DA)) S Y="@60";@65;43;S:X="" Y="@99";
"KRN",.402,1176,"DR",1,162.5,6)
I $$INPICD0^FBCSV1(X,$G(DA)) S Y="@65";@70;44;S:X="" Y="@99";I $$INPICD0^FBCSV1(X,$G(DA)) S Y="@70";@99;K FBPROVD;M FBPROVD=FBPROV;S FBX=$$RPROV^FBUTL8(.FBPROV,.FBPROVD);K FBPROVD;S:$D(FBPRICE) Y="@992";K FBRRMKD;M FBRRMKD=FBRRMK;
"KRN",.402,1176,"DR",1,162.5,7)
S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD);K FBRRMKD;@992;K FBJJ,FBKK,DIE("NO^"),FBX;
"KRN",19,14058,-1)
0^1
"KRN",19,14058,0)
FB FPPS MONITOR^Monitor status of FB FPPS TRANSMIT option^^R^^^^^^^^FEE BASIS^y
"KRN",19,14058,1,0)
^19.06^3^3^3110527^^^
"KRN",19,14058,1,1,0)
This option examines the Fee Basis Site Parameters file for FPPS Transmit 
"KRN",19,14058,1,2,0)
Start and FPPS Transmit Complete to determine if FB FPPS TRAMSMIT has 
"KRN",19,14058,1,3,0)
completed.
"KRN",19,14058,25)
EN^FBMON
"KRN",19,14058,200.9)
y
"KRN",19,14058,"U")
MONITOR STATUS OF FB FPPS TRAN
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",344,-1)
1^1
"PKG",344,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",344,20,0)
^9.402P^1^1
"PKG",344,20,1,0)
2^^FBPMRG
"PKG",344,20,1,1)

"PKG",344,20,"B",2,1)

"PKG",344,22,0)
^9.49I^1^1
"PKG",344,22,1,0)
3.5^2950130^2950329
"PKG",344,22,1,"PAH",1,0)
122^3111027^.5
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
22
"RTN","FBAACO")
0^2^B28594326^B28424330
"RTN","FBAACO",1,0)
FBAACO ;AISC/GRR-ENTER MEDICAL PAYMENT ;7/13/2003
"RTN","FBAACO",2,0)
 ;;3.5;FEE BASIS;**4,61,79,116,122**;JAN 30, 1995;Build 8
"RTN","FBAACO",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACO",4,0)
EN583 ;driver for opt payments (entry point for uc)
"RTN","FBAACO",5,0)
 K FBAAOUT,FBPOP
"RTN","FBAACO",6,0)
 D SITE G Q:$G(FBPOP) D BT G Q:$G(FBAAOUT)
"RTN","FBAACO",7,0)
1 K FBAAID,FBAAVID,FBAAOUT,FBDL,FBAAMM D SITE G Q:$G(FBPOP) S FBINTOT=0 W !!
"RTN","FBAACO",8,0)
 I '$D(FB583) K FBDL,FBAR D GETVET^FBAAUTL1 G EN583:'DFN K FBAAOUT,FBDMRA D GETAUTH^FBAAUTL1 G 1:FTP']""
"RTN","FBAACO",9,0)
 K FBAAOUT
"RTN","FBAACO",10,0)
 I $G(FBCHCO) S FB7078=$S($G(FB7078):FB7078_";FB7078(",$D(FB583):FB583_";FB583(",1:"")
"RTN","FBAACO",11,0)
 D:FBAAPTC="R" ^FBAACO0
"RTN","FBAACO",12,0)
 D ^FBAAEAR:$P(FBSITE(1),"^",4)="Y"
"RTN","FBAACO",13,0)
 D PAT,GETVEN1^FBAACO1:$D(FB583),GETVEN^FBAACO1:'$D(FB583) I $G(FBAAOUT) G Q:$D(FB583),1
"RTN","FBAACO",14,0)
 W !! D FILEV^FBAACO5(DFN,FBV) I $G(FBAAOUT) G Q:$D(FB583),1
"RTN","FBAACO",15,0)
 ;check for payments against all linked vendors
"RTN","FBAACO",16,0)
 S DA=+Y D CHK^FBAACO4 K FBAACK1,FBAAOUT,DA,X,Y
"RTN","FBAACO",17,0)
 K FBAAID,FBAAVID D GETINV^FBAACO1 I $G(FBAAOUT) Q:$D(FBCHCO)  G Q:$D(FB583),1
"RTN","FBAACO",18,0)
 I '$D(FBAAID)!('$D(FBAAVID)) D GETINDT^FBAACO1 I $G(FBAAOUT) D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q
"RTN","FBAACO",19,0)
 ; ask patient account number
"RTN","FBAACO",20,0)
 S FBCSID=$$ASKPAN^FBUTL5() I FBCSID="^" K FBCSID S FBAAOUT=1 D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q
"RTN","FBAACO",21,0)
 ; if U/C then get FPPS Claim ID else ask user
"RTN","FBAACO",22,0)
 I $D(FB583) S FBFPPSC=$P($G(^FB583(FB583,5)),U) W !,"FPPS CLAIM ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBAACO",23,0)
 E  S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 K FBFPPSC S FBAAOUT=1 D OUT G Q:$D(FB583),1:'$D(FBCHCO) Q
"RTN","FBAACO",24,0)
 G 1^FBAAMP:$G(FBMP) D MM G Q:$G(FBAAOUT)
"RTN","FBAACO",25,0)
SVDT K FBAAOUT,HOLDY W !! D GETSVDT^FBAACO5(DFN,FBV,FBASSOC,1) I $G(FBAAOUT) K FBAADT,FBX,FBAACP W:FBINTOT>0 !!,"Invoice: "_FBAAIN_" Totals $ "_$J(FBINTOT,1,2) G Q:$D(FB583)!($G(FBCHCO)),1
"RTN","FBAACO",26,0)
 D SETO^FBAACO3,DISPINV^FBAACO1
"RTN","FBAACO",27,0)
 W ! D ASKZIP^FBAAFS($G(FBV),$G(FBAADT))
"RTN","FBAACO",28,0)
 I $G(FBAAOUT)!(FBZIP']"") D DEL^FBAACO3 G SVDT
"RTN","FBAACO",29,0)
CPT K FBAAOUT W !
"RTN","FBAACO",30,0)
 D CPTM^FBAALU($G(FBAADT),$G(DFN)) I 'FBGOT D DEL^FBAACO3 G SVDT
"RTN","FBAACO",31,0)
 D CHK2^FBAACO4 I FBJ']"" G SVPR
"RTN","FBAACO",32,0)
CHKE ;determines what action to take on duplicate services entered
"RTN","FBAACO",33,0)
 K FBAAOUT W !!,*7,"Service selected for that date already in system."
"RTN","FBAACO",34,0)
 S DIR(0)="Y",DIR("A")="Do you want to add another service for the SAME DATE",DIR("B")="No" D ^DIR K DIR G Q:$D(DIRUT),SVPR:Y
"RTN","FBAACO",35,0)
 I FBJ]"",FBJ'=FBV W !!,*7,"You must use the 'EDIT PAYMENT' option to edit the service previously",!,"entered for that date." D DEL^FBAACO3 G SVDT
"RTN","FBAACO",36,0)
 S DIR(0)="Y",DIR("A")="Want to edit it",DIR("B")="No" D ^DIR K DIR G Q:$D(DIRUT) I Y D DOEDIT^FBAACO3 G SVDT:'$D(FBDL)!($G(FBAAOUT)),Q:$D(FB583),1
"RTN","FBAACO",37,0)
 D ^FBAACO2 G CPT:'$G(FBDEN)
"RTN","FBAACO",38,0)
SVPR K FBAAOUT
"RTN","FBAACO",39,0)
 I $$ANES^FBAAFS($$CPT^FBAAUTL4($G(FBAACP))) D ASKTIME^FBAAFS I $G(FBAAOUT)!'$G(FBTIME) G CPT
"RTN","FBAACO",40,0)
 D SVCPR^FBAACO1 G CPT:$G(FBAAOUT)
"RTN","FBAACO",41,0)
 S FBAMTPD=0 D FILE^FBAACO2,FILE^FBUTL8 I $D(FBAAOUT) G Q:$D(FB583),1:$D(FBDL),Q ;FB*3.5*121
"RTN","FBAACO",42,0)
 D OUT^FBAACO3 W:Z1>(FBAAMPI-20) !,*7,"Warning, you can only enter ",(FBAAMPI-Z1)," more line(s)!" G CPT:Z1'>(FBAAMPI-1) D WARN^FBAACO3 G EN583
"RTN","FBAACO",43,0)
 G 1
"RTN","FBAACO",44,0)
 ;
"RTN","FBAACO",45,0)
Q ;exit point for outpatient payment routines
"RTN","FBAACO",46,0)
 K FBAAPTC,DIC,Y,A,I,DFN,BO,DA,DI,DQ,DR,E,FBAABDT,FBAABE,FBFY,FBDL,FBAAID,FBAAIN,FBAAMPI,FBAAOPA,FBAAPN,FBCONT,FBDX,FBGOT,FBPOV,FBPT,DLAYGO,FBPSA,FBASSOC,FBZBN,FBZBS,FBDEN,FBV,FBSDI,FBAACPI,FBAACP,FBX,FBLOCK
"RTN","FBAACO",47,0)
 K FBSP,FBTPD,FBTT,FBTYPE,FTP,FBDEL,FY,FBINTOT,G,H,MAJN,NO,PI,Q,R,SUB,SUBN,TA,TP,UL,W,X1,Z,Z1,ZZ,FBAADT,K,L,J,FBTOV,FBPARCD,FBT,FEEO,Z2,FBSITE,FBAUT,T,FBLOC,FBSSN,FBVEN,FBD1,Z0,FB583
"RTN","FBAACO",48,0)
 K A1,A2,B1,B2,DAT,DIE,FBAACPT,FBAMTPD,FBAAEDT,FBAAOUT,FBAAPD,FBI,FBIN,FBPROG,FBRR,FBXX,PTYPE,S,VAL,X,V,ZS,FB7078,FBFDC,FBCOUNTY,FBMST,FBTTYPE,FBTV,HY,FBDMRA,DIRUT,FBPOP,FBJ,FBAACK1,FBAR,FBDA,FBST
"RTN","FBAACO",49,0)
 K FBMP,FBK,FBAAAS,%DT,FBDT,FBMAX,FBAMFS,FBAASC,FBHCFA,FBSI,FBCNP,FBAAAMT,FBAAVID,FBAAMM,FBAAMM1,VAPA,FBZX,FBTST,HOLDY,FBAOT
"RTN","FBAACO",50,0)
 K FBCSID,FBFPPSC,FBFPPSL,FBADJ,FBADJD,FBADJL,FBRRMK,FBRRMKD,FBRRMKL,FBUNITS
"RTN","FBAACO",51,0)
AUTHQ K DIC,DFN,CNT,FB7078,FBAABDT,FBAAEDT,FBAAOUT,FBASSOC,FBAUT,FBPOV,FBPROG,FBPSA,FBPT,FBTT,FBTYPE,FBVEN,FBTP,PI,TA,FBMOD,FBMODA,FBZIP,FBTIME,FBFSAMT,FBFSUSD
"RTN","FBAACO",52,0)
 Q
"RTN","FBAACO",53,0)
 ;
"RTN","FBAACO",54,0)
SITE ;set up site variables
"RTN","FBAACO",55,0)
 D:'$D(FBSITE(0)) SITEP^FBAAUTL Q:$G(FBPOP)  I '$G(FBPROG) D
"RTN","FBAACO",56,0)
 .I $G(FBCHCO) S FBPROG="I ($P(^(0),""^"",3)=6!($P(^(0),""^"",3)=7))&($P(^(0),U,9)'[""FB583"")" Q
"RTN","FBAACO",57,0)
 .S FBPROG=$S($P(FBSITE(1),"^",6)="":"I $P(^(0),""^"",9)'[""FB583""",1:"I $P(^(0),""^"",3)=2,($P(^(0),""^"",9)'[""FB583"")")
"RTN","FBAACO",58,0)
 S:'$D(FBAAPTC) FBAAPTC="V"
"RTN","FBAACO",59,0)
 S FBAAMPI=$P($G(^FBAA(161.4,1,"FBNUM")),"^",3),FBAAMPI=$S(FBAAMPI]"":FBAAMPI,1:100)
"RTN","FBAACO",60,0)
 Q
"RTN","FBAACO",61,0)
 ;
"RTN","FBAACO",62,0)
BT ;select batch
"RTN","FBAACO",63,0)
 S DIC="^FBAA(161.7,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,3)=""B3""&($G(^(""ST""))=""O"")&(($P(^(0),U,5)=DUZ)!($D(^XUSEC(""FBAASUPERVISOR"",DUZ))))",DIC("W")="W !,""  Obligation #: "",$P(^(0),U,2)" W !! D ^DIC K DIC I X["^"!(X="") S FBAAOUT=1 Q
"RTN","FBAACO",64,0)
 G BT:Y<0 S (DA,FBAABE)=+Y,Y(0)=^FBAA(161.7,DA,0)
"RTN","FBAACO",65,0)
 I $P(Y(0),"^",11)>(FBAAMPI-1) W !!,"This Batch already has the maximum number of Payments!" G BT
"RTN","FBAACO",66,0)
 S Z1=$P(Y(0),"^",11),FB7078="",BO=$P(^FBAA(161.7,DA,0),"^",2)
"RTN","FBAACO",67,0)
 Q
"RTN","FBAACO",68,0)
PAT ;set up patient in patient file
"RTN","FBAACO",69,0)
 ;required input variable DFN
"RTN","FBAACO",70,0)
 I '$D(^FBAAC(DFN,0)) K DD,DO S (X,DINUM)=DFN,DIC(0)="L",DLAYGO=162,DIC="^FBAAC(" D FILE^DICN K DLAYGO,DIC,DINUM,DD,DO,DA
"RTN","FBAACO",71,0)
 Q
"RTN","FBAACO",72,0)
MM ;check for money management of entire invoice
"RTN","FBAACO",73,0)
 ; fb*3.5*116
"RTN","FBAACO",74,0)
 ;I FBAAPTC="R" S FBAAMM="" Q
"RTN","FBAACO",75,0)
 ;W ! S DIR(0)="Y",DIR("A")="Will any line items in this invoice be for contracted services",DIR("B")="No",DIR("?")="Answering no indicates interest will not be paid for any line items." D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACO",76,0)
 ;S FBAAMM=$S(Y=1:1,1:"")
"RTN","FBAACO",77,0)
 D MMPPT^FBAACP
"RTN","FBAACO",78,0)
 Q
"RTN","FBAACO",79,0)
OUT K FBAADT,FBX,FBAACP W:FBINTOT>0 !!,"Invoice: "_FBAAIN_" Totals $ "_$J(FBINTOT,1,2) Q
"RTN","FBAACO2")
0^3^B13323096^B12957977
"RTN","FBAACO2",1,0)
FBAACO2 ;AISC/GRR-PAYMENT PROCESS FOR DUPLICATE ;7/13/2003
"RTN","FBAACO2",2,0)
 ;;3.5;FEE BASIS;**4,55,61,77,116,122**;JAN 30, 1995;Build 8
"RTN","FBAACO2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACO2",4,0)
RD S DIR(0)="Y",DIR("A")="Want this payment stored as a Medical Denial",DIR("B")="YES",DIR("?")="Enter 'Yes' to store payment entry as a denial and send a Suspension letter.  Enter 'No' to have nothing happen." D ^DIR K DIR Q:$D(DIRUT)!('Y)
"RTN","FBAACO2",5,0)
 S FBDEN=1 Q
"RTN","FBAACO2",6,0)
FILE ;files sp multiple entry
"RTN","FBAACO2",7,0)
 K DR S TP="" I $G(FBDEN) S FBAMTPD=0
"RTN","FBAACO2",8,0)
 S DR="49///^S X=$G(FBCSID);50///^S X=$G(FBFPPSC);I $G(FBDEN) S Y=1;48;47//1;S FBUNITS=X;S:$G(FBFPPSC)="""" Y=""@11"";S FBX=$$FPPSL^FBUTL5();S:FBX=-1 Y=0;51///^S X=FBX;@11"
"RTN","FBAACO2",9,0)
 ; fb*3.5*116 do not enable different interest indicator values at line item level; interest indicator set at invoice level
"RTN","FBAACO2",10,0)
 ;S DR(1,162.03,1)="D PPT^FBAACO1();34///^S X=$G(FBAAMM1);D POS^FBAACO1;S:'$G(FBHCFA(30)) Y=0;1;S J=X;I $G(FBDEN) S Y=2;D FEE^FBAACO0;44////^S X=FBFSAMT;45///^S X=FBFSUSD;2///^S X=FBAMTPD;S K=X"
"RTN","FBAACO2",11,0)
 S DR(1,162.03,1)="34///^S X=$G(FBAAMM);D POS^FBAACO1;S:'$G(FBHCFA(30)) Y=0;1;S J=X;I $G(FBDEN) S Y=2;D FEE^FBAACO0;44////^S X=FBFSAMT;45///^S X=FBFSUSD;2///^S X=FBAMTPD;S K=X"
"RTN","FBAACO2",12,0)
 ;S DR(1,162.03,2)="S:J-K=0 Y=6;3//^S X=$S(J-K:J-K,1:"""");S:'X Y=6;3.5///^S X=DT;@4;4;I X']"""" D SC^FBAACO3;S:X'=4 Y=6;22;6////^S X=DUZ"
"RTN","FBAACO2",13,0)
 S DR(1,162.03,2)="S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2);S:FBX=0 Y=0;6////^S X=DUZ"
"RTN","FBAACO2",14,0)
 S DR(1,162.03,3)="7////^S X=FBAABE;8////^S X=BO;13///^S X=FBAAID;14///^S X=FBAAIN;33///^S X=FBAAVID;I $G(FBDEN) S FBTST=1"
"RTN","FBAACO2",15,0)
 I '$G(FBDEN) D
"RTN","FBAACO2",16,0)
 .N FBCSVSTR S FBCSVSTR="I X]"""" S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@1"";"
"RTN","FBAACO2",17,0)
 .S DR(1,162.03,4)="S:$$EXTPV^FBAAUTL5(FBPOV)=""01"" Y=""@1"";S:FB7078]""""!($D(FB583)) Y=30;@5;28R;S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@5"";30////^S X=FBHCFA(30);31;32R;S Y=15;@1;28;"_FBCSVSTR_"30////^S X=FBHCFA(30);31"
"RTN","FBAACO2",18,0)
 .S DR(1,162.03,5)="15///^S X=FBPT;S FBX=$$RR^FBUTL4(.FBRRMK,2);S:FBX=0 Y=0"
"RTN","FBAACO2",19,0)
 .S DR(1,162.03,6)="16////^S X=FBPOV;17///^S X=FBTT;18///^S X=FBAAPTC;23////^S X=FBTYPE;26////^S X=FBPSA;S:$D(FBV583) Y=""@2"";27////^S X=FB7078;S Y=""@99"";@2;27////^S X=FBV583;@99;S FBTST=1"
"RTN","FBAACO2",20,0)
 .S DR(1,162.03,7)="73;74;75" ;FB*3.5*122 Line Item Provider information
"RTN","FBAACO2",21,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO2",22,0)
 S DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI,DA=FBAACPI
"RTN","FBAACO2",23,0)
 D LOCK^FBUCUTL("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",FBAACPI,1)
"RTN","FBAACO2",24,0)
 D
"RTN","FBAACO2",25,0)
 . N ICDVDT S ICDVDT=$G(FBAADT) D ^DIE
"RTN","FBAACO2",26,0)
 I '$D(DTOUT),$G(FBTST) D
"RTN","FBAACO2",27,0)
 . D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO2",28,0)
 . D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO2",29,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI)
"RTN","FBAACO2",30,0)
 I $D(DTOUT) D KILL Q
"RTN","FBAACO2",31,0)
 I '$G(FBTST),$G(DA) S DIR(0)="YA",DIR("A")="Entering an '^' will delete "_$S($G(FBDEN):"denial",1:"payment")_".  Are you sure you want to delete? ",DIR("B")="No" D ^DIR K DIR G FILE:'$D(DIRUT)&('Y) D KILL Q
"RTN","FBAACO2",32,0)
 K FBTST,FBDEN,FBAAMM1,DIE,DR,DA,FBX
"RTN","FBAACO2",33,0)
 I $D(FBDL) S FBAAOUT=1 Q
"RTN","FBAACO2",34,0)
 Q
"RTN","FBAACO2",35,0)
KILL S DIK=DIE D ^DIK K DIE,DIK I '$G(FBCNP) D Q^FBAACO S FBAAOUT=1
"RTN","FBAACO2",36,0)
 W !,"Deleted" Q
"RTN","FBAACO3")
0^19^B50872609^B48295702
"RTN","FBAACO3",1,0)
FBAACO3 ;AISC/GRR-ENTER PAYMENT CONTINUED ;7/7/2003
"RTN","FBAACO3",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,116,122**;JAN 30, 1995;Build 8
"RTN","FBAACO3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACO3",4,0)
DOEDIT ;
"RTN","FBAACO3",5,0)
 N FB1725,FBFPPSC
"RTN","FBAACO3",6,0)
 W ! S FBAACP(0)=FBAACP
"RTN","FBAACO3",7,0)
 S DIC="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO3",8,0)
 S DIC(0)="EQMZ",DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI
"RTN","FBAACO3",9,0)
 S X=$$CPT^FBAAUTL4(FBAACP)
"RTN","FBAACO3",10,0)
 D ^DIC I Y<0 S FBAAOUT=1 Q
"RTN","FBAACO3",11,0)
 S (DA,FBAACPI)=+Y,K=$P(Y(0),U,3),FBZBN=$P(Y(0),U,8),FBZBS=$S(FBZBN]"":$P($G(^FBAA(161.7,FBZBN,"ST")),U),1:""),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBAACO3",12,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBAACO3",13,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBAACO3",14,0)
 S FBAAMM1=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,2)),U,2)
"RTN","FBAACO3",15,0)
 S FBFSAMT(0)=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,2)),U,12)
"RTN","FBAACO3",16,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBAACO3",17,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBAACO3",18,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"_FBAACPI_",""M"")")
"RTN","FBAACO3",19,0)
 ; load current adjustment data
"RTN","FBAACO3",20,0)
 D LOADADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO3",21,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAACO3",22,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAACO3",23,0)
 ; load current remittance remark data
"RTN","FBAACO3",24,0)
 D LOADRR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO3",25,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAACO3",26,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAACO3",27,0)
 ; load FPPS data
"RTN","FBAACO3",28,0)
 S FBFPPSC=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U)
"RTN","FBAACO3",29,0)
 S FBFPPSL=$P($G(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,3)),U,2)
"RTN","FBAACO3",30,0)
 I FBZBS=""!(FBZBS="V") D NOGO S FBAAOUT=1 Q
"RTN","FBAACO3",31,0)
 ; first edit CPT code and modifiers
"RTN","FBAACO3",32,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) S FBAAOUT=1 Q
"RTN","FBAACO3",33,0)
 ; if CPT was changed then update file
"RTN","FBAACO3",34,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" S FBAAOUT=1 Q
"RTN","FBAACO3",35,0)
 . N FBIENS,FBFDA
"RTN","FBAACO3",36,0)
 . S FBIENS=FBAACPI_","_FBSDI_","_FBV_","_DFN_","
"RTN","FBAACO3",37,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBAACO3",38,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAACO3",39,0)
 ; if modifiers changed then update file
"RTN","FBAACO3",40,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(DFN,FBV,FBSDI,FBAACPI)
"RTN","FBAACO3",41,0)
 ; now edit remaining fields
"RTN","FBAACO3",42,0)
 D SETO K DR
"RTN","FBAACO3",43,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBAACO3",44,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only
"RTN","FBAACO3",45,0)
 ;S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1);34///@;34////^S X=FBAAMM1;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAACO3",46,0)
 S DR(1,162.03,1)="30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAACO3",47,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;D CHKIT^FBAACO3;S K=X"
"RTN","FBAACO3",48,0)
 ;S DR(1,162.03,3)="3//^S X=$S(J-K:J-K,1:"""");4;S:X'=4 Y=6;22;6////^S X=DUZ;13;33"
"RTN","FBAACO3",49,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBAACO3",50,0)
 S DR(1,162.03,4)="S:FBFPPSC="""" Y=13;W !,""FPPS CLAIM ID: ""_FBFPPSC;S FBX=$$FPPSL^FBUTL5(FBFPPSL,,1);51///^S X=FBX;S FBFPPSL=X;13;33"
"RTN","FBAACO3",51,0)
 S DR(1,162.03,5)="S:$$EXTPV^FBAAUTL5(FBPOV)=""01"" Y=""@1"";S Y=$S('$D(FB7078):28,FB7078]"""":31,1:28);@5;28R;S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@5"";31;32R;S Y=""@7"";@1;28;I X]"""" S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@1"";31"
"RTN","FBAACO3",52,0)
 S DR(1,162.03,6)="@7;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBAACO3",53,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",DIE("NO^")="",FBOT=1
"RTN","FBAACO3",54,0)
 D LOCK^FBUCUTL("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",FBAACPI) I 'FBLOCK S FBAAOUT=1 Q
"RTN","FBAACO3",55,0)
 D ^DIE
"RTN","FBAACO3",56,0)
 ; if adjustment data changed then file
"RTN","FBAACO3",57,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO3",58,0)
 ; if remit remark data changed then file
"RTN","FBAACO3",59,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO3",60,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI) K FBOT,DIE,DR,DA
"RTN","FBAACO3",61,0)
 D LOCK^FBUCUTL("^FBAAC("_DFN_",1,"_FBV_",1,",FBAACPI) I 'FBLOCK S FBAAOUT=1 Q
"RTN","FBAACO3",62,0)
 K DR S DR="58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69" S DIE="^FBAAC("_DFN_",1,"_FBV_",1," D ^DIE ;FB*3.5*122 edit provider fields
"RTN","FBAACO3",63,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1) K FBOT,DIE,DR,DA
"RTN","FBAACO3",64,0)
 Q:$D(FBDL)
"RTN","FBAACO3",65,0)
 I $G(FBAAIN) S FBINTOT=0 D CALC
"RTN","FBAACO3",66,0)
 Q
"RTN","FBAACO3",67,0)
SETO S FY=$E(FBAADT,1,3)+1700+$S($E(FBAADT,4,5)>9:1,1:0)
"RTN","FBAACO3",68,0)
 Q
"RTN","FBAACO3",69,0)
OUT ;
"RTN","FBAACO3",70,0)
 ; FB*3.5*116 count line items that have 0.00 amount paid
"RTN","FBAACO3",71,0)
 ;I K>0 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1,FBINTOT=FBINTOT+K
"RTN","FBAACO3",72,0)
 S Z1=$P(^FBAA(161.7,FBAABE,0),"^",11)+1,$P(^(0),"^",11)=Z1,FBINTOT=FBINTOT+K
"RTN","FBAACO3",73,0)
 Q
"RTN","FBAACO3",74,0)
CKMAX S (FBAOT,A)=0,O="" F Z=S-.1:0 S Z=$O(^FBAAC(DFN,"AB",Z)) Q:Z'>0!(Z>R)  F Q=0:0 S Q=$O(^FBAAC(DFN,"AB",Z,Q)) Q:Q'>0  S W=$O(^FBAAC(DFN,"AB",Z,Q,0)) I $D(^FBAAC(DFN,1,Q,1,W,0)) D SMORE
"RTN","FBAACO3",75,0)
 I A>$P(FBSITE(1),"^",9) G NO
"RTN","FBAACO3",76,0)
 Q
"RTN","FBAACO3",77,0)
SMORE N FBA,FBB S FBB=$P($G(^FBAAC(+DFN,1,+Q,1,+W,0)),U,4),E=0
"RTN","FBAACO3",78,0)
 F  S E=$O(^FBAAC(DFN,1,Q,1,W,1,E)) Q:'E  S FBA=$G(^(E,0)) I $P(FBA,"^",9)=2,$P(FBA,"^",18)'=1 D
"RTN","FBAACO3",79,0)
 .I $$IDCHK^FBAAUTL3(DFN,FBB) S A=A+$P(FBA,"^",3) Q
"RTN","FBAACO3",80,0)
 .S FBAOT=FBAOT+$P(FBA,U,3)
"RTN","FBAACO3",81,0)
 Q
"RTN","FBAACO3",82,0)
NO W !!,*7,"Warning Patient already at maximum allowed for month of service",! Q
"RTN","FBAACO3",83,0)
WARN W !!,*7,"You have reached the maximum number of payments for a Batch!",!,"You must select another Batch for entering Payments!"
"RTN","FBAACO3",84,0)
CALC ;Calculate Current Invoice Total
"RTN","FBAACO3",85,0)
 F J=0:0 S J=$O(^FBAAC("C",FBAAIN,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("C",FBAAIN,J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("C",FBAAIN,J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("C",FBAAIN,J,K,L,M)) Q:M'>0  D CALC1
"RTN","FBAACO3",86,0)
 K J,K,L,M,FZNODE Q
"RTN","FBAACO3",87,0)
CALC1 S FZNODE=^FBAAC(J,1,K,1,L,1,M,0),A2=$P(FZNODE,"^",3),FBINTOT=FBINTOT+A2,FBAAID=$P(FZNODE,"^",15),FBAAVID=$P($G(^FBAAC(J,1,K,1,L,1,M,2)),"^")
"RTN","FBAACO3",88,0)
 Q
"RTN","FBAACO3",89,0)
FEEDT ;
"RTN","FBAACO3",90,0)
 ; input FB1725 - true (=1) when edited payment is for a Mill Bill claim
"RTN","FBAACO3",91,0)
 N FBX
"RTN","FBAACO3",92,0)
 D SETO:'$G(FY) S FBFY=FY-1
"RTN","FBAACO3",93,0)
 S (FBFSAMT,FBFSUSD)="",FBAMTPD=$G(FBAMTPD)
"RTN","FBAACO3",94,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBAADT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME))
"RTN","FBAACO3",95,0)
 I '$G(FBAAMM1) D
"RTN","FBAACO3",96,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAACO3",97,0)
 E  D
"RTN","FBAACO3",98,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAACO3",99,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAACO3",100,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAACO3",101,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAACO3",102,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAACO3",103,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAACO3",104,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAACO3",105,0)
 ;
"RTN","FBAACO3",106,0)
 I FB1725 D
"RTN","FBAACO3",107,0)
 . W !!?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAACO3",108,0)
 . I FBFSAMT D
"RTN","FBAACO3",109,0)
 . . S FBFSAMT=$J(FBFSAMT*.7,0,2)
"RTN","FBAACO3",110,0)
 . . W !?2,"  Therefore, fee schedule amount reduced to $",FBFSAMT," (70%)."
"RTN","FBAACO3",111,0)
 ;
"RTN","FBAACO3",112,0)
 I $G(FBUNITS)>1 D
"RTN","FBAACO3",113,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAACO3",114,0)
 . Q:FBFSAMT'>0
"RTN","FBAACO3",115,0)
 . N FBFSUNIT
"RTN","FBAACO3",116,0)
 . ; determine if fee schedule can be multipled by units
"RTN","FBAACO3",117,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBAADT>3040930):1,1:0)
"RTN","FBAACO3",118,0)
 . I FBFSUNIT D
"RTN","FBAACO3",119,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAACO3",120,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAACO3",121,0)
 . E  D
"RTN","FBAACO3",122,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAACO3",123,0)
 ;
"RTN","FBAACO3",124,0)
 I '$G(FBAAMM1) D
"RTN","FBAACO3",125,0)
 . ; set default amount paid to lesser of amt claimed (J) or fee sched.
"RTN","FBAACO3",126,0)
 . S FBAMTPD=$S(FBFSAMT'>0:J,FBFSAMT>J:J,1:FBFSAMT)
"RTN","FBAACO3",127,0)
 W !
"RTN","FBAACO3",128,0)
 Q
"RTN","FBAACO3",129,0)
CHKIT I X>FBAMTPD&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,"You must be a holder of the 'FBAASUPERVISOR' security key in order to",!,"exceed the Fee Schedule.",! S $P(^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,0),"^",3)=K,Y=2 Q
"RTN","FBAACO3",130,0)
 Q
"RTN","FBAACO3",131,0)
NOGO W !!,*7,"This payment CANNOT be edited.  The batch the payment is in",!,"has been Vouchered.  You may void the payment with the Void Payment option.",!
"RTN","FBAACO3",132,0)
 Q
"RTN","FBAACO3",133,0)
 ;
"RTN","FBAACO3",134,0)
SC W *7,!?4,"Suspense code is required!",! S Y="@4" Q
"RTN","FBAACO3",135,0)
 ;
"RTN","FBAACO3",136,0)
DEL ;delete date of service if no service provided entered
"RTN","FBAACO3",137,0)
 I '$O(^FBAAC(DFN,1,FBV,1,FBSDI,1,0)) D
"RTN","FBAACO3",138,0)
 .S DIK="^FBAAC(DFN,1,FBV,1,",DA(2)=DFN,DA(1)=FBV,DA=FBSDI D ^DIK W !!?5,*7,"Incomplete payment entry deleted.",!
"RTN","FBAACO3",139,0)
 K DIK,DA Q
"RTN","FBAAPET")
0^1^B35557510^B33779075
"RTN","FBAAPET",1,0)
FBAAPET ;AISC/DMK-EDIT PAYMENT ;7/13/2003
"RTN","FBAAPET",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,77,116,122**;JAN 30, 1995;Build 8
"RTN","FBAAPET",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAPET",4,0)
 S FBOT=1
"RTN","FBAAPET",5,0)
GETPT I $G(BAT) D
"RTN","FBAAPET",6,0)
 .I '$D(^FBAAC("AC",+BAT)) F I=9,10,11 S $P(^FBAA(161.7,+BAT,0),U,I)=""
"RTN","FBAAPET",7,0)
 .I $D(^FBAAC("AC",+BAT)) D  S $P(^FBAA(161.7,+BAT,0),U,11)=I,$P(^(0),U,9)=$G(FBTOT) K I,FBTOT
"RTN","FBAAPET",8,0)
 ..N J,K,L,M S (I,J,K,L,M,FBTOT)=0
"RTN","FBAAPET",9,0)
 ..F  S J=$O(^FBAAC("AC",+BAT,J)) Q:'J  F  S K=$O(^FBAAC("AC",+BAT,J,K)) Q:'K  F  S L=$O(^FBAAC("AC",+BAT,J,K,L)) Q:'L  F  S M=$O(^FBAAC("AC",+BAT,J,K,L,M)) Q:'M  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S I=I+1,FBTOT=FBTOT+$P(^(0),U,3)
"RTN","FBAAPET",10,0)
 W !! S DIC="^FBAAC(",DIC(0)="AEQM" D ^DIC G END:X="^"!(X=""),GETPT:Y<0 S (DFN,FBDA(3))=+Y
"RTN","FBAAPET",11,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBAAPET",12,0)
 S DIC=DIC_DFN_",1,"
"RTN","FBAAPET",13,0)
GETVD W !! S DIC(0)="AEQM" D ^DIC G GETPT:X="^"!(X=""),GETVD:Y<0 S (FBV,FBVD,FBDA(2))=+Y
"RTN","FBAAPET",14,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,0)) ^FBAAC(DFN,1,FBDA(2),1,0)="^162.02DA^0^0"
"RTN","FBAAPET",15,0)
 S FBPZ=DIC_FBVD_",1,",DIC=DIC_FBVD_",1," ;FB*3.5*121
"RTN","FBAAPET",16,0)
GETDT S DIC(0)="AEQM",DIC("A")="Date of Service: " D ^DIC K DIC("A") G GETPT:X="^"!(X=""),GETDT:Y<0 S (FBSD,FBSDI,FBDA(1))=+Y,FBAADT=$P(Y,U,2)
"RTN","FBAAPET",17,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)) ^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)="^162.03A^0^0"
"RTN","FBAAPET",18,0)
 S FBZ=DIC_FBSD_",1,"
"RTN","FBAAPET",19,0)
SERV S DA(3)=FBDA(3),DA(2)=FBDA(2),DA(1)=FBDA(1)
"RTN","FBAAPET",20,0)
 S DIC("W")="N FBX S FBX=$$MODL^FBAAUTL4(""^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,+Y,""""M"""")"",""E"") W:FBX]"""" ""    CPT Modifier(s): "",FBX Q"
"RTN","FBAAPET",21,0)
 S DIC=FBZ,DIC(0)="AEQMZ"
"RTN","FBAAPET",22,0)
 D
"RTN","FBAAPET",23,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBAAPET",24,0)
 G GETPT:X="^"!(X=""),SERV:Y<0 S (FBSV,FBAACPI,FBDA)=+Y,BAT=$P(Y(0),U,8),FBDUZ=$P(Y(0),U,7),(FBAACP,FBAACP(0))=$P(Y,U,2),K=$P(Y(0),U,3),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBAAPET",25,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBAAPET",26,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBAAPET",27,0)
 I FBDUZ'=DUZ&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"Sorry,only the clerk who entered the payment ",!," or a supervisor can edit this payment." G GETPT
"RTN","FBAAPET",28,0)
 S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBAAPET",29,0)
 S FBFSAMT(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,12)
"RTN","FBAAPET",30,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBAAPET",31,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBAAPET",32,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"_FBDA(1)_",1,"_FBDA_",""M"")")
"RTN","FBAAPET",33,0)
 ; load current adjustment data
"RTN","FBAAPET",34,0)
 D LOADADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",35,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAAPET",36,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAAPET",37,0)
 ; load current remittance remark data
"RTN","FBAAPET",38,0)
 D LOADRR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",39,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAAPET",40,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAAPET",41,0)
 ; save FPPS data prior to edit session
"RTN","FBAAPET",42,0)
 S FBFPPSC(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U)
"RTN","FBAAPET",43,0)
 S FBFPPSC=FBFPPSC(0)
"RTN","FBAAPET",44,0)
 S FBFPPSL(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,2)
"RTN","FBAAPET",45,0)
 S FBFPPSL=FBFPPSL(0)
"RTN","FBAAPET",46,0)
 G:BAT']"" EDIT
"RTN","FBAAPET",47,0)
 I $G(^FBAA(161.7,BAT,"ST"))]"",$P(^FBAA(161.7,BAT,"ST"),"^")="S"!($P(^FBAA(161.7,BAT,"ST"),"^")="T")&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"Sorry, only the Supervisor can edit a payment once the batch has been released." G GETPT
"RTN","FBAAPET",48,0)
 I $G(^FBAA(161.7,BAT,"ST"))]"",$P(^FBAA(161.7,BAT,"ST"),"^")="V" W !!,*7,"Sorry,you cannot edit a payment once the batch has been Finalized." G GETPT
"RTN","FBAAPET",49,0)
EDIT S DA=FBSV
"RTN","FBAAPET",50,0)
 ;
"RTN","FBAAPET",51,0)
 ; first edit CPT code and modifiers
"RTN","FBAAPET",52,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) G GETPT
"RTN","FBAAPET",53,0)
 ; if CPT was changed then update file
"RTN","FBAAPET",54,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" G GETPT
"RTN","FBAAPET",55,0)
 . N FBIENS,FBFDA
"RTN","FBAAPET",56,0)
 . S FBIENS=FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_","
"RTN","FBAAPET",57,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBAAPET",58,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAAPET",59,0)
 ; if modifiers changed then update file
"RTN","FBAAPET",60,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(FBDA(3),FBDA(2),FBDA(1),FBDA)
"RTN","FBAAPET",61,0)
 ;
"RTN","FBAAPET",62,0)
 ; now edit remaining fields
"RTN","FBAAPET",63,0)
 S DIE("NO^")=""
"RTN","FBAAPET",64,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBAAPET",65,0)
 ; fb*3.5*116 remove edit of interest indicator (162.03,34) to prevent different interest indicator values at line item level; interest indicator set at invoice level only; 
"RTN","FBAAPET",66,0)
 ;S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1);34///@;34////^S X=FBAAMM1;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAAPET",67,0)
 S DR(1,162.03,1)="30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAAPET",68,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;D CHKIT^FBAACO3;S K=X"
"RTN","FBAAPET",69,0)
 ;S DR(1,162.03,3)="3////^S X=$S(J-K:J-K,1:"""");I X S Y=""@11"";4////@;S Y=""@5"";@11;3R;4R;S:X'=4 Y=""@5"";22"
"RTN","FBAAPET",70,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBAAPET",71,0)
 S DR(1,162.03,4)="S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@5"";50///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;51///^S X=FBX;S FBFPPCL=X;S Y=""@55"";@5;50///@;S FBFPPSC="""";51///@;S FBFPPSL="""";@55"
"RTN","FBAAPET",72,0)
 S DR(1,162.03,5)="K DIE(""NO^"");W !,""Exit ('^') allowed now"";26;S PRC(""SITE"")=X;8;13;Q;33;49"
"RTN","FBAAPET",73,0)
 S DR(1,162.03,6)="15;17;16;S:X=1 Y=""@1"";@6;28R;S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@6"";31;32R;S Y=""@7"";@1;28;I X]"""" S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@1"";31"
"RTN","FBAAPET",74,0)
 S DR(1,162.03,7)="@7;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBAAPET",75,0)
 S DR(1,162.03,8)="73;74;75" ;FB*3.5*122 edit line item provider fields
"RTN","FBAAPET",76,0)
 S DIE=FBZ
"RTN","FBAAPET",77,0)
 D
"RTN","FBAAPET",78,0)
 . N ICPTVDT,ICDVDT S (ICPTVDT,ICDVDT)=$G(FBAADT) D ^DIE
"RTN","FBAAPET",79,0)
 K DR S DR="58;59;60;61;62;63;64;65;66;76;77;78;79;67;68;69" S DIE=FBPZ D ^DIE ;FB*3.5*122 edit provider fields 
"RTN","FBAAPET",80,0)
 ; if adjustment data changed then file
"RTN","FBAAPET",81,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",82,0)
 ; if remit remark data changed then file
"RTN","FBAAPET",83,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",84,0)
 ; if FPPS CLAIM ID changed, update other line items on invoice
"RTN","FBAAPET",85,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBAAPET",86,0)
 . N FBAAIN
"RTN","FBAAPET",87,0)
 . S FBAAIN=$$GET1^DIQ(162.03,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",14)
"RTN","FBAAPET",88,0)
 . D CKINVEDI^FBAAPET1(FBFPPSC(0),FBFPPSC,FBAAIN,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",")
"RTN","FBAAPET",89,0)
 K FBSV W !! G SERV
"RTN","FBAAPET",90,0)
END K DR,DIC,DIE,X,DFN,FBOT,FBVD,FBSD,BAT,FBAADT,FBSV,DA,FBDA,FBZ,FBDUZ,FBAACP,FBFY,FY,FBAMTPD,J,K,Y,ZZ,PRC,FBHOLDX,FBV,FBSDI,FBAACPI
"RTN","FBAAPET",91,0)
 K FBFSAMT,FBFSUSD,FBMODA,FBZIP,FBTIME,FBHCFA(30),FBAAPTC,FB1725,FBADJ,FBADJD,FBADJL(0),FBRRMK,FBRRMKD,FBRRMKL(0),FBX,FBUNITS
"RTN","FBAAPET",92,0)
 Q
"RTN","FBAAPIN")
0^4^B33397999^B23332246
"RTN","FBAAPIN",1,0)
FBAAPIN ;AISC/GRR-INVOICE DISPLAY ;7/17/2003
"RTN","FBAAPIN",2,0)
 ;;3.5;FEE BASIS;**4,61,122**;JAN 30, 1995;Build 8
"RTN","FBAAPIN",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAPIN",4,0)
 D DT^DICRW
"RTN","FBAAPIN",5,0)
RD1 W ! S (FBHDONE,FBAAOUT,FBINTOT)=0,FBSW=0 K FBHED S DIR(0)="NO",DIR("A")="Select Invoice Number",DIR("?")="^D HELP^FBAAPIN1" D ^DIR K DIR G Q:$D(DIRUT)!'Y
"RTN","FBAAPIN",6,0)
 I '$D(^FBAAC("C",X)) W !,*7,"Invalid selection.",! G RD1
"RTN","FBAAPIN",7,0)
 S HX=X,FBAAIN=X D LIST S X=HX G RD1
"RTN","FBAAPIN",8,0)
LIST S Q="",$P(Q,"=",80)="="
"RTN","FBAAPIN",9,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBAAPIN",10,0)
 F J=0:0 S J=$O(^FBAAC("C",FBAAIN,J)) Q:J'>0!(FBAAOUT)  D MMORE
"RTN","FBAAPIN",11,0)
 Q
"RTN","FBAAPIN",12,0)
SET S FBFILE="^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",1,",D=$P($G(^FBAAC(J,1,K,1,L,0)),"^",1),FBYY=$G(^FBAAC(J,1,K,1,L,1,M,0)),FBYY("REJ")=$S($D(^FBAAC(J,1,K,1,L,1,M,"FBREJ")):^("FBREJ"),1:""),FBY=$G(^FBAAC(J,1,K,1,L,1,M,2))
"RTN","FBAAPIN",13,0)
 S FBY3=$G(^FBAAC(J,1,K,1,L,1,M,3))
"RTN","FBAAPIN",14,0)
 S FBAARCE=$$GET1^DIQ(162.03,M_","_L_","_K_","_J_",",48)
"RTN","FBAAPIN",15,0)
 D SET2
"RTN","FBAAPIN",16,0)
 Q
"RTN","FBAAPIN",17,0)
SET2 ;
"RTN","FBAAPIN",18,0)
 N FBX
"RTN","FBAAPIN",19,0)
 S N=$S($D(^DPT(J,0)):$P(^(0),"^",1),1:""),S=$S(N]"":$P(^DPT(J,0),"^",9),1:""),V=$S($D(^FBAAV(K,0)):$P(^FBAAV(K,0),"^",1),1:"")
"RTN","FBAAPIN",20,0)
 S T=$P(FBYY,"^",5),D2=$P(FBYY,"^",6),ZS=$P(FBYY,"^",20),VP=$P(FBYY,"^",21)
"RTN","FBAAPIN",21,0)
 S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBAAPIN",22,0)
 S TAMT=$FN($P(FBYY,U,4),"",2)
"RTN","FBAAPIN",23,0)
 S FBAACPT=$P(FBYY,"^",1) I FBAACPT]"" S FBAACPT=$$CPT^FBAAUTL4(FBAACPT)
"RTN","FBAAPIN",24,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBAAPIN",25,0)
 S FBUNITS=$P(FBY,U,14)
"RTN","FBAAPIN",26,0)
 S FBFPPSL=$P(FBY3,U,2)
"RTN","FBAAPIN",27,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBAAPIN",28,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAAPIN",29,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAAPIN",30,0)
 S FBRRMKL=$$RRL^FBAAFR(M_","_L_","_K_","_J_",")
"RTN","FBAAPIN",31,0)
 S A1=$P(FBYY,"^",2)+.0001,A2=$P(FBYY,"^",3)+.0001,A3=$P(FBYY,"^",12)+.0001,A1=$P(A1,".",1)_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".",1)_"."_$E($P(A2,".",2),1,2),A3=$P(A3,".",1)_"."_$E($P(A3,".",2),1,2),FBINTOT=FBINTOT+A2+.0001
"RTN","FBAAPIN",32,0)
 S FBINTOT=$P(FBINTOT,".")_"."_$E($P(FBINTOT,".",2),1,2)
"RTN","FBAAPIN",33,0)
 S FBBN=$S($P(FBYY,"^",8)]"":$S($D(^FBAA(161.7,$P(FBYY,"^",8),0)):$P(^(0),"^",1),1:""),$P(FBYY("REJ"),"^",3)]"":$S($D(^FBAA(161.7,$P(FBYY("REJ"),"^",3),0)):$P(^(0),"^",1),1:""),1:"")
"RTN","FBAAPIN",34,0)
 D FBCKO^FBAACCB2(J,K,L,M)
"RTN","FBAAPIN",35,0)
 I $D(^FBAAC(J,1,K,1,L,2)) D PROV
"RTN","FBAAPIN",36,0)
 I '$D(FBHED) D HED
"RTN","FBAAPIN",37,0)
 D WRT S FBHED=1
"RTN","FBAAPIN",38,0)
 Q
"RTN","FBAAPIN",39,0)
WRT I ($Y+5)>IOSL S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1 Q:FBAAOUT  D HED
"RTN","FBAAPIN",40,0)
 W !!,N,?33,$$DATX^FBAAUTL(D),?43,FBAACPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:"")
"RTN","FBAAPIN",41,0)
 I FBAARCE]"" W ?51,"/",FBAARCE
"RTN","FBAAPIN",42,0)
 W ?57,FBBN,?67,$S(FBYY("REJ")]"":"Rejected",1:$$DATX^FBAAUTL(D2))
"RTN","FBAAPIN",43,0)
 I $P($G(FBMODLE),",",2)]"" D  Q:FBAAOUT
"RTN","FBAAPIN",44,0)
 . N FBI
"RTN","FBAAPIN",45,0)
 . F FBI=2:1 S FBMOD=$P(FBMODLE,",",FBI) Q:FBMOD=""  D  Q:FBAAOUT
"RTN","FBAAPIN",46,0)
 . . I $Y+5>IOSL D  Q:FBAAOUT  W !,"(continued)"
"RTN","FBAAPIN",47,0)
 . . . S DIR(0)="E" D ^DIR K DIR S:'Y FBAAOUT=1 Q:FBAAOUT  D HED
"RTN","FBAAPIN",48,0)
 . . W !,?48,"-",FBMOD
"RTN","FBAAPIN",49,0)
 W !,$S(ZS="R":"*",1:""),$S(VP="VP":"#",1:""),$S($G(FBCAN)]"":"+",1:"")
"RTN","FBAAPIN",50,0)
 W ?3,FBFPPSL,?14,"$",$J(A1,8),?26,"$",$J(A2,8),?37,FBUNITS
"RTN","FBAAPIN",51,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBAAPIN",52,0)
 W ?43,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBAAPIN",53,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBAAPIN",54,0)
 W ?53,"$",$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBAAPIN",55,0)
 W ?69,FBRRMKL
"RTN","FBAAPIN",56,0)
 ; if adjustment reasons null and suspend code = other then write desc.
"RTN","FBAAPIN",57,0)
 I FBADJLR="",T=4 D ^FBAAPIN1
"RTN","FBAAPIN",58,0)
 D PMNT^FBAACCB2
"RTN","FBAAPIN",59,0)
 Q
"RTN","FBAAPIN",60,0)
HED W @IOF,!,"Invoice Number: ",FBAAIN,?30,"Vendor Name: ",V,!,?2,"Date Received: ",FBINDAT
"RTN","FBAAPIN",61,0)
 I +$G(FBY) W ?33,"Invoice Date: ",$$DATX^FBAAUTL(+FBY)
"RTN","FBAAPIN",62,0)
 W !?2,"FPPS Claim ID: ",$S(FBFPPSC]"":FBFPPSC,1:"N/A")
"RTN","FBAAPIN",63,0)
 W ?33,"Patient Account #: ",FBCSID
"RTN","FBAAPIN",64,0)
 W !?10,"('*' Reimb. to Patient  '+' Cancel. Activity  '#' Voided Payment)"
"RTN","FBAAPIN",65,0)
 ;W !,"SVC DATE"," CPT-MOD ","   AMT CLAIMED",?35,"AMT PAID",?47,"CODE",?57,"BATCH NO.",?67,"VOUCHER DATE",!,?5,"Other Suspension Description",!,$$REPEAT^XLFSTR("=",79),!
"RTN","FBAAPIN",66,0)
 W !,"PATIENT",?33,"SVC DATE",?43,"CPT-MOD",?51,"/REV",?57,"BATCH NO.",?67,"VOUCHER DATE"
"RTN","FBAAPIN",67,0)
 W !,?3,"FPPS LINE",?14,"AMT CLAIMED",?26,"AMT PAID",?36,"UNITS",?43,"ADJ CODE",?53,"ADJ AMT",?69,"REMIT RMK"
"RTN","FBAAPIN",68,0)
 W !,$$REPEAT^XLFSTR("=",79)
"RTN","FBAAPIN",69,0)
 Q
"RTN","FBAAPIN",70,0)
Q K D,N,V,D2,J,K,L,M,DIC,T,FBYY,Q,I,A1,A2,A3,C,DIYS,FBAACPT,FBAAIN,FBAAOUT,FBBN,FBINTOT,FBINDAT,FBSW,FBHDONE,HX,S,VP,Z,ZS,FBHED,FBFILE,DIRUT,FBY,FBMOD
"RTN","FBAAPIN",71,0)
 K FBMODLE
"RTN","FBAAPIN",72,0)
 K FBAARCE,FBADJLA,FBADJLR,FBCSID,FBFPPSC,FBFPPSL,FBRRMKL,FBUNITS,TAMT
"RTN","FBAAPIN",73,0)
 Q
"RTN","FBAAPIN",74,0)
ERR W !,*7,"Please enter a whole number! Alpha characters and puctuation are invalid" G RD1
"RTN","FBAAPIN",75,0)
SETHD S V=$S($D(^FBAAV(K,0)):$P(^(0),"^",1),1:"") D INDAT:FBSW S FBHDONE=1 Q
"RTN","FBAAPIN",76,0)
MMORE S FBSW=1 F K=0:0 S K=$O(^FBAAC("C",FBAAIN,J,K)) Q:K=""!(FBAAOUT)  D SETHD F L=0:0 S L=$O(^FBAAC("C",FBAAIN,J,K,L)) Q:L=""!(FBAAOUT)  F M=0:0 S M=$O(^FBAAC("C",FBAAIN,J,K,L,M)) Q:M'>0  D SET Q:FBAAOUT
"RTN","FBAAPIN",77,0)
 Q
"RTN","FBAAPIN",78,0)
INDAT S L=$O(^FBAAC("C",FBAAIN,J,K,"")),M=$O(^FBAAC("C",FBAAIN,J,K,L,""))
"RTN","FBAAPIN",79,0)
 S FBINDAT=$P($G(^FBAAC(J,1,K,1,L,1,M,0)),"^",15)
"RTN","FBAAPIN",80,0)
 S FBINDAT=$S(FBINDAT="":"Unknown",1:$E(FBINDAT,4,5)_"/"_$E(FBINDAT,6,7)_"/"_$E(FBINDAT,2,3))
"RTN","FBAAPIN",81,0)
 S FBFPPSC=$P($G(^FBAAC(J,1,K,1,L,1,M,3)),U,1)
"RTN","FBAAPIN",82,0)
 S FBCSID=$P($G(^FBAAC(J,1,K,1,L,1,M,2)),U,16)
"RTN","FBAAPIN",83,0)
 S FBSW=0 K L,M Q
"RTN","FBAAPIN",84,0)
 Q
"RTN","FBAAPIN",85,0)
PROV ;Display Invoice Provider information before invoice details FB*3.5*122
"RTN","FBAAPIN",86,0)
 N FBPRI,FBSRVF S FBPRI=$G(^FBAAC(J,1,K,1,L,2)),FBSRVF=$G(^FBAAC(J,1,K,1,L,4)),$P(FBSRVF,U,3)=$$GET1^DIQ(5,$P(FBSRVF,U,3)_",",1)
"RTN","FBAAPIN",87,0)
 W @IOF,!?30,"INVOICE DISPLAY",!?30,"===============",!?28,"PROVIDER INFORMATION",!
"RTN","FBAAPIN",88,0)
 I $L($P(FBPRI,U,1,3))>3 W !?3,"ATTENDING PROV NAME: "_$P(FBPRI,U),!?3,"ATTENDING PROV NPI: "_$P(FBPRI,U,2),?35,"ATTENDING PROV TAXONOMY CODE: "_$P(FBPRI,U,3)
"RTN","FBAAPIN",89,0)
 I $L($P(FBPRI,U,4,5))>2 W !!?3,"OPERATING PROV NAME: "_$P(FBPRI,U,4),!?3,"OPERATING PROV NPI: "_$P(FBPRI,U,5)
"RTN","FBAAPIN",90,0)
 I $L($P(FBPRI,U,6,8))>3 W !!?3,"RENDERING PROV NAME: "_$P(FBPRI,U,6),!?3,"RENDERING PROV NPI: "_$P(FBPRI,U,7),?35,"RENDERING PROV TAXONOMY CODE: "_$P(FBPRI,U,8)
"RTN","FBAAPIN",91,0)
 I $L($P(FBPRI,U,9,10))>2 W !!?3,"SERVICING PROV NAME: "_$P(FBPRI,U,9),!?3,"SERVICING PROV NPI: "_$P(FBPRI,U,10)
"RTN","FBAAPIN",92,0)
 I $L($P(FBSRVF,U,1,4))>4 W !?3,"SERVICING FACILITY ADDRESS: ",!?5,$P(FBSRVF,U),!?5,$P(FBSRVF,U,2) I $P(FBSRVF,U,2)'="" W ", "
"RTN","FBAAPIN",93,0)
 W $P(FBSRVF,U,3)_" "_$P(FBSRVF,U,4)
"RTN","FBAAPIN",94,0)
 I $L($P(FBPRI,U,11,12))>2 W !!?3,"REFERRING PROV NAME: "_$P(FBPRI,U,11),!?3,"REFERRING PROV NPI: "_$P(FBPRI,U,12),!!
"RTN","FBAAPIN",95,0)
 S DIR(0)="E" D ^DIR
"RTN","FBAAPIN",96,0)
 Q
"RTN","FBAAVD")
0^17^B28132185^B27538301
"RTN","FBAAVD",1,0)
FBAAVD ;AISC/DMK-DISPLAY/EDIT VENDOR DEMOGRAPHICS ; 8/28/09 12:35pm
"RTN","FBAAVD",2,0)
 ;;3.5;FEE BASIS;**9,98,111,122**;JAN 30, 1995;Build 8
"RTN","FBAAVD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAVD",4,0)
 ;FBTEMP set = 1 if called from input template
"RTN","FBAAVD",5,0)
RDV ;ask vendor
"RTN","FBAAVD",6,0)
 W ! K DFN,FBRATE S FEEO="",DIC="^FBAAV(",DIC(0)="AEQLM",DLAYGO=161.2,DIC("DR")="1;6;7;8" D ^DIC K DIC,DLAYGO G Q:$D(DTOUT)!(X="")!($D(DUOUT)),RDV:Y<0 S DA=+Y
"RTN","FBAAVD",7,0)
 D NEW:$P(Y,U,3)=1 D EN1
"RTN","FBAAVD",8,0)
 I $G(DA) W ! I $D(^XUSEC("FBAA ESTABLISH VENDOR",DUZ)) S DIR(0)="Y",DIR("B")="No",DIR("A")="Want to edit data" D ^DIR K DIR I $G(Y) D EDITV
"RTN","FBAAVD",9,0)
 Q:$G(FBTEMP)
"RTN","FBAAVD",10,0)
 G RDV
"RTN","FBAAVD",11,0)
 ;
"RTN","FBAAVD",12,0)
EN1 ;display vendor demographics
"RTN","FBAAVD",13,0)
 ;DA = IEN of vendor in file 161.2
"RTN","FBAAVD",14,0)
 ;
"RTN","FBAAVD",15,0)
 N C,I
"RTN","FBAAVD",16,0)
 Q:'$G(DA)
"RTN","FBAAVD",17,0)
 S Z=$G(^FBAAV(DA,0)),V=$G(^(1)),T=$G(^("AMS")),A=$G(^("ADEL")),FBNPI=$P($G(^(3)),U,2),FBTXC=$P($G(^(3)),U,3)
"RTN","FBAAVD",18,0)
 F X=1:1:17 S Z(X)=$P(Z,U,X)
"RTN","FBAAVD",19,0)
 S FBDEL=$S($P(A,U)="Y":1,1:0),FBAAPN=$P(V,U),FBAAFN=$P(V,U,9)
"RTN","FBAAVD",20,0)
 ;Z=zero node,V=one node,T=ams node,A=adel node
"RTN","FBAAVD",21,0)
 ;
"RTN","FBAAVD",22,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS W @IOF K IOP
"RTN","FBAAVD",23,0)
 I +$G(DFN)>0 W !,"Patient Name: ",$P($G(^DPT(DFN,0)),U),?48,"Pt.ID: ",$$SSN^FBAAUTL(DFN),!
"RTN","FBAAVD",24,0)
 W !?22,"***  VENDOR DEMOGRAPHICS  ***" D
"RTN","FBAAVD",25,0)
 .I FBDEL W !?19,"==> FLAGGED FOR DELETION <==" Q
"RTN","FBAAVD",26,0)
 .I $$CKVEN^FBAADV(DA) W !?20,"==> AWAITING AUSTIN APPROVAL <=="
"RTN","FBAAVD",27,0)
 W !!,$J("Name:",13),?15,$E(Z(1),1,30),?47,"ID Number: ",Z(2)
"RTN","FBAAVD",28,0)
 W !?40,"Billing Prov NPI: ",FBNPI
"RTN","FBAAVD",29,0)
 W !?31,"Billing Prov Taxonomy code: ",FBTXC ;FB*3.5*122
"RTN","FBAAVD",30,0)
 W !,$J("Address:",13),?15,Z(3),?47,"Specialty: ",$E($P($G(^FBAA(161.6,+Z(8),0)),U),1,20)
"RTN","FBAAVD",31,0)
 I Z(14)]"" W !,$J("Address [2]:",13),?15,Z(14)
"RTN","FBAAVD",32,0)
 W !,$J("City:",13),?15,Z(4),?52,"Type:",?58,$P($P(^DD(161.2,6,0),Z(7)_":",2),";")
"RTN","FBAAVD",33,0)
 ;
"RTN","FBAAVD",34,0)
 W !,$J("State:",13),?15,$P($G(^DIC(5,+Z(5),0)),U),?38,"Participation Code:",?58,$S($D(^FBAA(161.81,+Z(9),0)):$E($P(^(0),U),1,21),1:"UNKNOWN")
"RTN","FBAAVD",35,0)
 W !,$J("ZIP:",13),?15,Z(6),?38,"Medicare ID Number:",?59,Z(17)
"RTN","FBAAVD",36,0)
 W !,$J("County:",13),?15,$P($G(^DIC(5,+Z(5),1,+Z(13),0)),U)
"RTN","FBAAVD",37,0)
 W ?51,"Chain: ",Z(10)
"RTN","FBAAVD",38,0)
 W !,$J("Phone:",13),?15,FBAAPN,!,$J("Fax:",13),?15,FBAAFN
"RTN","FBAAVD",39,0)
 W:$P(T,U,2)="Y" ?44,"Pricer Exempt: Yes"
"RTN","FBAAVD",40,0)
 W !,$J("Type (FPDS):",13),?15,$$EXTERNAL^DILFD(161.2,24,"",$P(V,U,10))
"RTN","FBAAVD",41,0)
 S (C,I)=0 F  S I=$O(^FBAAV(DA,2,I)) Q:'I  D
"RTN","FBAAVD",42,0)
 . S X=$P($G(^FBAAV(DA,2,I,0)),U) Q:'X
"RTN","FBAAVD",43,0)
 . S X=$$GET1^DIQ(420.6,X,1) Q:X=""
"RTN","FBAAVD",44,0)
 . S C=C+1
"RTN","FBAAVD",45,0)
 . I '(C#2) W !,$J("Group (FPDS):",13),?15,$E(X,1,21)
"RTN","FBAAVD",46,0)
 . I (C#2) W ?44,"Group (FPDS):",?59,$E(X,1,21)
"RTN","FBAAVD",47,0)
 W !,$J("Austin Name:",13),?15,$P(T,U)
"RTN","FBAAVD",48,0)
 W !,$J("Last Change ",13),?43,"Last Change" I $P(A,U,5)]"" W " by ",$S($P(A,U,5)="000":"Non-Fee User",1:"Station "_$P(A,U,5))
"RTN","FBAAVD",49,0)
 W !,$J("TO Austin:",13),?15,$$DATX^FBAAUTL($P(A,U,2))
"RTN","FBAAVD",50,0)
 W ?45,"FROM Austin:  ",$$DATX^FBAAUTL($P(A,U,4))
"RTN","FBAAVD",51,0)
 ;
"RTN","FBAAVD",52,0)
 I Z(9)=5 D ^FBAAVD1
"RTN","FBAAVD",53,0)
 K A,T,V,Z,FBAAFN
"RTN","FBAAVD",54,0)
 Q
"RTN","FBAAVD",55,0)
 ;
"RTN","FBAAVD",56,0)
NEW ;called when adding a new vendor
"RTN","FBAAVD",57,0)
 Q:'$G(DA)
"RTN","FBAAVD",58,0)
 S FBT="N",DIE="^FBAAV(",DR="[FBAA NEW VENDOR]" D ^DIE S Y=$G(^FBAAV(DA,0)) S FBOVEN="" D  I +FBOVEN K FBOVEN W ! S DR="3;4;5;5.5" D ^DIE K DIE,DR D CHKVEN Q:'$G(DA)
"RTN","FBAAVD",59,0)
 .I $P(Y,U,4)']"" S FBOVEN=1
"RTN","FBAAVD",60,0)
 .I '$P(Y,U,5) S FBOVEN=$S(+FBOVEN:FBOVEN_"^"_2,1:2)
"RTN","FBAAVD",61,0)
 .I $P(Y,U,6)']"" S FBOVEN=$S(+FBOVEN:FBOVEN_"^"_3,1:3)
"RTN","FBAAVD",62,0)
 .I $P(Y,U,13)']"" S FBOVEN=$S(+FBOVEN:FBOVEN_"^"_4,1:4)
"RTN","FBAAVD",63,0)
 .I +FBOVEN D  K XX,X
"RTN","FBAAVD",64,0)
 ..W !!?9,"The following data must be entered when adding a new vendor:",!
"RTN","FBAAVD",65,0)
 ..W !?28,">>> W A R N I N G <<<",!?14,"Entering an '^' at this point will delete vendor!",!
"RTN","FBAAVD",66,0)
 ..F XX=1:1 S X=$P(FBOVEN,U,XX) Q:'X  D
"RTN","FBAAVD",67,0)
 ...W !?8,$P($T(ERROR+X),";;",2)
"RTN","FBAAVD",68,0)
 D SETGL
"RTN","FBAAVD",69,0)
 S FBVIEN=DA D CONTR^FBAAVD2 S DA=FBVIEN Q
"RTN","FBAAVD",70,0)
 ;
"RTN","FBAAVD",71,0)
EDITV ;called when editing an existing vendor
"RTN","FBAAVD",72,0)
 N FBHDA Q:'$G(DA)
"RTN","FBAAVD",73,0)
 N FBAAOUT G:$G(FBT)="N" EDITV1 I $D(^FBAA(161.25,DA,0))!($D(^FBAA(161.25,"AF",DA))) W !!?5,*7,"Current Vendor information is pending Austin processing.  Changing Vendor" D  I $G(FBAAOUT) K FBAAOUT Q
"RTN","FBAAVD",74,0)
 .W !?5,"information at this time may jeopardize the processing of the existing",!?5,"Master Record Adjustment!",! D
"RTN","FBAAVD",75,0)
 ..S DIR(0)="Y",DIR("A")="Do you wish to continue editing this Vendor",DIR("B")="No" D ^DIR K DIR S:$D(DIRUT)!('Y) FBAAOUT=1
"RTN","FBAAVD",76,0)
EDITV1 D ^FBAAVD2 K FBCIEN,FBR,FBT
"RTN","FBAAVD",77,0)
 Q
"RTN","FBAAVD",78,0)
 ;
"RTN","FBAAVD",79,0)
SETGL ;called to file an entry in 161.25 (vendor correction file)
"RTN","FBAAVD",80,0)
 I $S('$G(DA):1,$G(FBT)="C"&('$D(FBIEN1)):1,1:0) Q
"RTN","FBAAVD",81,0)
 S Z1=$G(^FBAAV(DA,0)),FBTOV=$S($P(Z1,U,7)=3:"P",1:"O")
"RTN","FBAAVD",82,0)
 I $G(FBT)="N"!($G(FBT)="R") S DIE="^FBAAV(",DR="9///@;13///@" D ^DIE K DIE
"RTN","FBAAVD",83,0)
 I '$D(^FBAA(161.25,DA,0)) F  L +^FBAA(161.25,DA):$G(DILOCKTM,3) Q:$T  W:'$D(ZTQUEUED) !,"Unable to setup SG MRA transaction.  Trying again."
"RTN","FBAAVD",84,0)
 K DD,DO S (X,DINUM)=DA,DIC="^FBAA(161.25,",DIC(0)="L",DLAYGO=161.25 D FILE^DICN K DLAYGO L -^FBAA(161.25,DA) Q:Y<0
"RTN","FBAAVD",85,0)
NEXT L +^FBAA(161.25,DA):$G(DILOCKTM,3) I '$T W:'$D(ZTQUEUED) !,"Unable to setup NEXT MRA transaction.  Trying again.",! G NEXT
"RTN","FBAAVD",86,0)
 S DIE="^FBAA(161.25,",DR="[FBAA VENDOR MRA]" D ^DIE L -^FBAA(161.25,DA)
"RTN","FBAAVD",87,0)
 K DIE,DIC,Y
"RTN","FBAAVD",88,0)
 Q
"RTN","FBAAVD",89,0)
 ;
"RTN","FBAAVD",90,0)
Q K DA,DR,DIC,DIE,DIRUT,DTOUT,DUOUT,A,D,FBX,FBOUT,X2,FY,FBAAPN,FEEO,FBDEL,FBPARCD,FBT,FBTOV,FBTV,X,Y,Z0,Z1,Z2,ZZ,FBCNUM,FBID,FBVIEN,FBLIEN,FBAAFN
"RTN","FBAAVD",91,0)
 Q
"RTN","FBAAVD",92,0)
ERROR ;edit check text when adding a new vendor
"RTN","FBAAVD",93,0)
 ;;CITY
"RTN","FBAAVD",94,0)
 ;;STATE
"RTN","FBAAVD",95,0)
 ;;ZIP CODE
"RTN","FBAAVD",96,0)
 ;;COUNTY CODE
"RTN","FBAAVD",97,0)
CHKVEN ;check if fields 3,4,5,5.5 have been answered. If not delete vendor
"RTN","FBAAVD",98,0)
 S Y=$G(^FBAAV(DA,0))
"RTN","FBAAVD",99,0)
 F X=4,5,6,13 I $P(Y,U,X)']"" D  Q
"RTN","FBAAVD",100,0)
 .S DIK="^FBAAV(" D ^DIK K DIK,DA W !?3,$C(7),".... Vendor deleted",!
"RTN","FBAAVD",101,0)
 Q
"RTN","FBAAVD2")
0^18^B33240026^B33081836
"RTN","FBAAVD2",1,0)
FBAAVD2 ;AISC/DMK-EDIT VENDOR DEMOGRAPHICS ; 8/31/09 11:36am
"RTN","FBAAVD2",2,0)
 ;;3.5;FEE BASIS;**9,10,47,65,98,111,122**;JAN 30, 1995;Build 8
"RTN","FBAAVD2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAVD2",4,0)
EDITV ;entry to edit vendor demographic data
"RTN","FBAAVD2",5,0)
 ;DA defined to IEN of vendor file (161.2)
"RTN","FBAAVD2",6,0)
 Q:'$G(DA)  N FBADT,FBDA,Z6 S FBDA=DA  L +^FBAAV(DA):$G(DILOCKTM,3) I '$T W !,"Another user is editing this vendor record. Try again later.",! Q
"RTN","FBAAVD2",7,0)
 S FBT=$S($D(FBT):FBT,1:""),FBT=$S(FBT="N":FBT,1:"C")
"RTN","FBAAVD2",8,0)
 S FEEO="",DIE="^FBAAV(",DR="[FBAA EDIT VENDOR]",DIE("NO^")="BACKOUTOK"
"RTN","FBAAVD2",9,0)
 S Z1=$G(^FBAAV(DA,0)),Z3=$G(^(1)),Z4=$G(^("AMS")),Z5=$G(^("ADEL")),Z6=$P($G(^(3)),U,2)
"RTN","FBAAVD2",10,0)
 D GETGRP^FBAAUTL6(DA)
"RTN","FBAAVD2",11,0)
 D ^DIE
"RTN","FBAAVD2",12,0)
 I $P($G(^FBAAV(DA,0)),"^",13)']"" S DR="3;4;5;5.5",DIE("NO^")="" D ^DIE
"RTN","FBAAVD2",13,0)
 K DIE
"RTN","FBAAVD2",14,0)
 L -^FBAAV(DA)
"RTN","FBAAVD2",15,0)
 ;check if data was changed
"RTN","FBAAVD2",16,0)
 I $D(^FBAAV(DA,0)),(($P(Z1,U,2,6)'=$P(^FBAAV(DA,0),U,2,6))!($P(Z1,U,8,16)'=$P(^FBAAV(DA,0),U,8,16))!($P(Z3,U,10)'=$P($G(^FBAAV(DA,1)),U,10))!$$GRPDIF^FBAAUTL6(DA)!($P($G(^FBAAV(DA,3)),U,2)'=Z6)) D
"RTN","FBAAVD2",17,0)
 .S FBVNAME=$P(^FBAAV(DA,0),U),FBIEN1=DA,FBADT=$P(Z5,U,4),FBNPI=$P($G(^FBAAV(FBIEN1,3)),U,2),FBTXC=$P($G(^(3)),U,3)
"RTN","FBAAVD2",18,0)
 .;check if date last received from austin, version 3.  If so, then did not receive in upload - send update instead of change
"RTN","FBAAVD2",19,0)
 .;fbadt = date received from austin.
"RTN","FBAAVD2",20,0)
 .I '$$CKVEN^FBAADV(DA),FBADT']"" D UPDT^FBAAAV(FBDA) Q  ;,FBADT<FBINSTAL D UPDT^FBAAAV(DA) Q
"RTN","FBAAVD2",21,0)
 .;if austin deleted is yes, send update instead of change
"RTN","FBAAVD2",22,0)
 .I $P($G(^FBAAV(FBDA,"ADEL")),"^")="Y" D UPDT^FBAAAV(FBDA) Q
"RTN","FBAAVD2",23,0)
 .;if editing a newly added vendor, send update instead of change
"RTN","FBAAVD2",24,0)
 .I FBT="N" D UPDT^FBAAAV(FBDA) Q
"RTN","FBAAVD2",25,0)
 .;if only FPDS data was changed
"RTN","FBAAVD2",26,0)
 .I $P(Z1,U,2,6)=$P(^FBAAV(DA,0),U,2,6),$P(Z1,U,8,16)=$P(^FBAAV(DA,0),U,8,16) D  Q:FBT=""
"RTN","FBAAVD2",27,0)
 ..I '$D(^FBAA(161.25,"AF",DA)),'$D(^FBAA(161.25,DA,0)) S FBT="F" Q  ; no pending actions - add "F"
"RTN","FBAAVD2",28,0)
 ..I '$D(^FBAA(161.25,"AF",DA)),$D(^FBAA(161.25,DA,0)),$P(^(0),U,5)="" S FBT="" Q  ; action pending, but not yet transmitted - will incl. FPDS data
"RTN","FBAAVD2",29,0)
 .I FBT="F" S FBIEN1=DA,FEEO="" D SETGL^FBAAVD Q  ; send FEE-ONLY
"RTN","FBAAVD2",30,0)
 .;If date from austin not null then add vendor entry for a change
"RTN","FBAAVD2",31,0)
 .K DD,DO S DIC="^FBAAV(",DIC(0)="L",DLAYGO=161.2,X=FBVNAME D FILE^DICN Q:Y<0  S FBIEN=+Y
"RTN","FBAAVD2",32,0)
 .F  L +^FBAAV(FBIEN):$G(DILOCKTM,3) Q:$T  W !,"Another user is editing this vendor record.  Trying again.  ",!
"RTN","FBAAVD2",33,0)
 .S ^FBAAV(FBIEN,0)=$G(^FBAAV(FBIEN1,0))
"RTN","FBAAVD2",34,0)
 .S ^FBAAV(FBIEN,1)=$G(^FBAAV(FBIEN1,1))
"RTN","FBAAVD2",35,0)
 .S ^FBAAV(FBIEN,"AMS")=$G(^FBAAV(FBIEN1,"AMS")),$P(^FBAAV(FBIEN,"AMS"),"^")=""
"RTN","FBAAVD2",36,0)
 .K FBFDA
"RTN","FBAAVD2",37,0)
 .S I=0 F  S I=$O(^FBAAV(FBIEN1,2,I)) Q:'I  D
"RTN","FBAAVD2",38,0)
 ..S X=$P($G(^(I,0)),U) I X]"" S FBFDA(161.225,"+"_I_","_FBIEN_",",.01)=X
"RTN","FBAAVD2",39,0)
 .I $D(FBFDA) D UPDATE^DIE("","FBFDA")
"RTN","FBAAVD2",40,0)
 .S DIK="^FBAAV(",DA=FBIEN D IX1^DIK
"RTN","FBAAVD2",41,0)
 .L -^FBAAV(FBIEN)
"RTN","FBAAVD2",42,0)
 .;restore original vendor data
"RTN","FBAAVD2",43,0)
 .F  L +^FBAAV(FBIEN1):$G(DILOCKTM,3) Q:$T  W !,"Another user is editing this vendor record.  Trying again.  ",!
"RTN","FBAAVD2",44,0)
 .S DIE="^FBAAV(",DA=FBIEN1,DR="[FB VENDOR UPDATE]" D ^DIE K DIE
"RTN","FBAAVD2",45,0)
 .D UPDGRP^FBAAUTL6(FBIEN1)
"RTN","FBAAVD2",46,0)
 .L -^FBAAV(FBIEN1)
"RTN","FBAAVD2",47,0)
 .S DA=FBIEN D SETGL^FBAAVD
"RTN","FBAAVD2",48,0)
 K FBSG,FBVNAME,FBIEN,FBIEN1,Z3,Z4,Z5
"RTN","FBAAVD2",49,0)
 ;
"RTN","FBAAVD2",50,0)
CONTR ;enter contract information for a CNH vendor
"RTN","FBAAVD2",51,0)
 Q:$S('$D(FBPARCD):1,FBPARCD'=5:1,1:0)
"RTN","FBAAVD2",52,0)
 Q:'$G(DA)  S FBVIEN=DA
"RTN","FBAAVD2",53,0)
 S FBLIEN=$P($G(^FBAA(161.25,FBVIEN,0)),"^",6) I FBLIEN]"",FBLIEN'=FBVIEN W !!,*7,"Cannot add contract information to this vendor until change has been",!,"approved by Austin." Q
"RTN","FBAAVD2",54,0)
 W ! S DIC="^FBAA(161.21,",DIC(0)="AEQLM",DLAYGO=161.21,DIC("S")="I $P(^(0),U,4)="_FBVIEN
"RTN","FBAAVD2",55,0)
 D ^DIC K DIC,DLAYGO Q:X=""!(X="^")  G CONTR:Y<0
"RTN","FBAAVD2",56,0)
 S DA=+Y,FBCNUM=$P(Y,"^",2),DIE="^FBAA(161.21,"
"RTN","FBAAVD2",57,0)
 F  L +^FBAA(161.21,DA):$G(DILOCKTM,3) Q:$T  W !,"This contract is being edited by another user, trying again.",!
"RTN","FBAAVD2",58,0)
 S ZO1=^FBAA(161.21,DA,0),DR="[FBNH ENTER CONTRACT]",DIE("NO^")="" D ^DIE K DIE,DR
"RTN","FBAAVD2",59,0)
 I '$G(DA) K ZO1 Q
"RTN","FBAAVD2",60,0)
 I $D(^FBAA(161.22,"AC",DA)) D
"RTN","FBAAVD2",61,0)
 .Q:$P(ZO1,"^",1,2)=$P(^FBAA(161.21,DA,0),"^",1,2)  W !!,*7,"You cannot change contract numbers or effective dates on",!,"a contract that has rates associated with it."
"RTN","FBAAVD2",62,0)
 .S DIE="^FBAA(161.21,",DR=".01////^S X=$P(ZO1,U);.02////^S X=$P(ZO1,U,2);.03////^S X=$P(ZO1,U,3);.04////^S X=$P(ZO1,U,4)" D ^DIE K DIE,DR W !!,"Contract information reset"
"RTN","FBAAVD2",63,0)
 L -^FBAA(161.21,DA) K ZO1
"RTN","FBAAVD2",64,0)
 Q:$D(DTOUT)
"RTN","FBAAVD2",65,0)
 I $G(FBEXNDT)<$G(FBEXDT) D URATE K FBCIEN,FBEXDT,FBEXNDT,FBURT
"RTN","FBAAVD2",66,0)
 ;create rates for a contract. Rates cannot be changed, but the
"RTN","FBAAVD2",67,0)
 ;user can enter multiple rates for a contract.
"RTN","FBAAVD2",68,0)
 ;FBCIEN=internal entry number for contract in 161.21
"RTN","FBAAVD2",69,0)
 S FBCIEN=DA K FBX
"RTN","FBAAVD2",70,0)
RATE K DA W ! S DIR(0)="161.22,.02",DIR("A")="Enter Nursing Home Rate",DIR("?")="^K FBX,FBRATE D DISPLAY^FBAAVD1 W !,""Enter an amount between .01 and 9999999.99""" D ^DIR
"RTN","FBAAVD2",71,0)
 K DIR Q:$D(DIRUT)  Q:'Y  S FBR=+Y
"RTN","FBAAVD2",72,0)
 ;I $L($$RATE^FBAAVD1($P(^FBAA(161.21,FBCIEN,0),"^",1)))+$L("^"_FBR)>510 W !,*7,"There are too many rates loaded for that contract! Please remove obsolete rates.",! Q
"RTN","FBAAVD2",73,0)
 I $D(^FBAA(161.22,"AD",FBCIEN,FBR)) K FBR W !,*7,"Rate already exists for that contract!",! G RATE
"RTN","FBAAVD2",74,0)
 S X=$P(^FBAA(161.22,0),U,3)
"RTN","FBAAVD2",75,0)
RETRY S X=X+1 G:$D(^FBAA(161.22,X)) RETRY
"RTN","FBAAVD2",76,0)
 F  L +^FBAA(161.22,X):$G(DILOCKTM,3) Q:$T  W !,"Another user is editing this rate record.  Trying again.  ",!
"RTN","FBAAVD2",77,0)
 K DD,DO S DIC="^FBAA(161.22,",DIC(0)="L",DLAYGO=161.22,DIC("DR")=".02////^S X="_FBR_";.03////^S X="_FBCIEN D FILE^DICN K DIC,DLAYGO
"RTN","FBAAVD2",78,0)
 L -^FBAA(161.22,+Y)
"RTN","FBAAVD2",79,0)
 G RATE
"RTN","FBAAVD2",80,0)
 ;
"RTN","FBAAVD2",81,0)
GETVEN K FBRATE D GETVEN^FBAAUTL1 G END:'IFN
"RTN","FBAAVD2",82,0)
 S DA=IFN K DIC,IFN
"RTN","FBAAVD2",83,0)
 S FBPARCD=$P($G(^FBAAV(DA,0)),U,9)
"RTN","FBAAVD2",84,0)
 I FBPARCD'=5 W !?5,*7,"Vendor selected is not a Community Nursing Home.",! G GETVEN
"RTN","FBAAVD2",85,0)
 D CONTR G GETVEN
"RTN","FBAAVD2",86,0)
END K DIC,DA,FBVIEN,IFN,FBPARCD,X,Y,FBLIEN
"RTN","FBAAVD2",87,0)
 Q
"RTN","FBAAVD2",88,0)
URATE ;Update rate when user backs up contract dates.
"RTN","FBAAVD2",89,0)
 N DA S (FBCIEN,FBURT)=0
"RTN","FBAAVD2",90,0)
 F  S FBURT=$O(^FBAA(161.23,"AE",FBCNUM,FBURT)) Q:'FBURT  F  S FBCIEN=$O(^FBAA(161.23,"AE",FBCNUM,FBURT,FBCIEN)) Q:'FBCIEN  I $P($G(^FBAA(161.23,FBCIEN,0)),"^",2)>FBEXNDT D
"RTN","FBAAVD2",91,0)
 .I +$G(^FBAA(161.23,FBCIEN,0))>FBEXNDT S DIK="^FBAA(161.23,",DA=FBCIEN D ^DIK K DIK Q
"RTN","FBAAVD2",92,0)
 .S DIE="^FBAA(161.23,",DA=FBCIEN,DR=".02////^S X=FBEXNDT" D ^DIE K DIE
"RTN","FBAAVD2",93,0)
 Q
"RTN","FBCHDI2")
0^5^B4376803^B4069030
"RTN","FBCHDI2",1,0)
FBCHDI2 ;AISC/DMK-DISPLAY INVOICE ;08FEB89
"RTN","FBCHDI2",2,0)
 ;;3.5;FEE BASIS;**122**;JAN 30, 1995;Build 8
"RTN","FBCHDI2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHDI2",4,0)
ASKIN K FBAANQ W !! S DIC="^FBAAI(",DIC(0)="AEQM" D ^DIC G END:X="^"!(X=""),ASKIN:Y<0 S FBI=+Y
"RTN","FBCHDI2",5,0)
 S VAR="FBI",VAL=FBI,PGM="START^FBCHDI2" D ZIS^FBAAUTL G:FBPOP END S:IO=IO(0) FBAANQ=1
"RTN","FBCHDI2",6,0)
START S Q="",$P(Q,"=",80)="=",FBAAOUT=0,FBPG=$S($E(IOST,1,2)="C-":0,1:1)
"RTN","FBCHDI2",7,0)
 U IO D PRVD^FBCHVH D HEDC^FBCHVH ; FB*3.5*122 added Provider information display
"RTN","FBCHDI2",8,0)
EN D GETINV^FBCHVH Q:FBAAOUT
"RTN","FBCHDI2",9,0)
 F J=5,16,17 S FBIN(J)=$P(FBIN,"^",J)
"RTN","FBCHDI2",10,0)
 S Y=FBIN(16) D PDF^FBAAUTL S FBIN(16)=Y S:$P(FBIN(5),";",2)="FB583(" FBIN(5)="" I FBIN(5)]"" S FBIN(5)=$S($D(^FB7078(+FBIN(5),0)):$P(^(0),"^",1),1:"")
"RTN","FBCHDI2",11,0)
 I FBIN(17)]"" S FBIN(17)=$S($D(^FBAA(161.7,FBIN(17),0)):$P(^(0),"^",1),1:"")
"RTN","FBCHDI2",12,0)
 I FBIN(5)]"" W !,?4,"Associated 7078: ",FBIN(5)
"RTN","FBCHDI2",13,0)
 W !,?4,"Batch #: ",FBIN(17),?40,"Date Finalized: ",FBIN(16),!
"RTN","FBCHDI2",14,0)
 I $D(^FBAAI(FBI,"FBREJ")),$P(^("FBREJ"),"^",1)]"" W ?4,"Rejects Pending!",?25,"Reject reason: ",$P(^("FBREJ"),"^",2),!,?4,"Old Batch #: ",$S($P(^("FBREJ"),"^",3):$S($D(^FBAA(161.7,$P(^("FBREJ"),"^",3),0)):$P(^(0),"^"),1:""),1:"")
"RTN","FBCHDI2",15,0)
 Q:$D(FBLISTC)
"RTN","FBCHDI2",16,0)
 G:$D(FBAANQ) ASKIN
"RTN","FBCHDI2",17,0)
END K VA D END^FBCHVH Q
"RTN","FBCHEP")
0^7^B30542505^B30100976
"RTN","FBCHEP",1,0)
FBCHEP ;AISC/DMK-ENTER PAYMENT FOR CONTRACT HOSPITAL ;8/18/2004
"RTN","FBCHEP",2,0)
 ;;3.5;FEE BASIS;**4,61,77,82,122**;JAN 30, 1995;Build 8
"RTN","FBCHEP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHEP",4,0)
 S FBAAPTC="V",FBAAOUT=0
"RTN","FBCHEP",5,0)
RD K FBAAID,FBAAVID S FBRESUB="" D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBCHEP",6,0)
 S FBPROG="I $P(^(0),U,3)=6,($P(^(0),U,9)'[""FB583"")" D GETAUTH^FBAAUTL1 G RD:$D(DUOUT),RD:FTP']""
"RTN","FBCHEP",7,0)
 ;W !!,?25,"<  ASSOCIATED 7078  >",!!
"RTN","FBCHEP",8,0)
 ;S DIC="^FB7078(",DA=FB7078,DR="0;1" D EN^DIQ
"RTN","FBCHEP",9,0)
 I FB7078="" W !,*7,"No 7078 on file for this authorization." G RD
"RTN","FBCHEP",10,0)
 S FBI7078=FB7078_";FB7078("
"RTN","FBCHEP",11,0)
 I $D(^FBAAI("E",FBI7078)) S FBAAIN=$O(^FBAAI("E",FBI7078,0)) G OUT
"RTN","FBCHEP",12,0)
SETINV S FBZ(0)=^FB7078(FB7078,0),FBVET=$P(FBZ(0),"^",3),FBVEN=$P(FBZ(0),"^",2),FBVEN=$P(FBVEN,";",1)
"RTN","FBCHEP",13,0)
 ;
"RTN","FBCHEP",14,0)
EN583 ;Entry from 583 enter payment
"RTN","FBCHEP",15,0)
 I FBAAPTC="R" D ^FBAACO0
"RTN","FBCHEP",16,0)
 S DA=FBVEN D EN1^FBAAVD
"RTN","FBCHEP",17,0)
 I $P($G(^FBAAV(FBVEN,"ADEL")),U)="Y" W !!,*7,"Vendor is flagged for Austin deletion!" G Q
"RTN","FBCHEP",18,0)
 D SITEP^FBAAUTL G Q:FBPOP
"RTN","FBCHEP",19,0)
 ;
"RTN","FBCHEP",20,0)
RDV S FBVE="" S:$D(^FBAAV(DA,"AMS")) FBVE=$P(^("AMS"),"^",2) S:$G(FBVE)'="Y" FBVE="N"
"RTN","FBCHEP",21,0)
 I FBVE="Y" W *7,!!,"Vendor is listed as 'exempt from the pricer'." S DIR(0)="Y",DIR("A")="Do you wish to keep this invoice exempt from the pricer",DIR("B")="Yes" D ^DIR K DIR G Q:$D(DIRUT) S FBVE=$S(Y=1:"Y",1:"N")
"RTN","FBCHEP",22,0)
 I $G(FBVE)'="Y",($P($G(^FBAAV(FBVEN,0)),"^",17)']"") W !!,*7,"Medicare ID Number is needed for this Vendor!" S DIE="^FBAAV(",DR=22 D ^DIE K DIE G Q:$D(DTOUT)!('$L(X))
"RTN","FBCHEP",23,0)
 ;
"RTN","FBCHEP",24,0)
BAT S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,3)=""B9""&($P(^(0),U,5)=DUZ)&($P(^(0),U,15)=""Y"")&($G(^(""ST""))=""O"")" W ! D ^DIC K DIC
"RTN","FBCHEP",25,0)
 G Q:X="^"!(X=""),BAT:Y<0 S FBAABE=+Y,FBY(0)=Y(0),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2),FBEXMPT=$P(FBY(0),"^",18) S FBAAOUT=0 D CHK I FBAAOUT K Y,Y(0),FBAABE G BAT
"RTN","FBCHEP",26,0)
 I FBI7078["FB7078(",BO'=$P($P(FBZ(0),U),".") W !,*7,"Obligation number on batch does not match 1358.",!,"Obligation number on batch must be ",$P($P(FBZ(0),U),"."),".",! G BAT
"RTN","FBCHEP",27,0)
 S FBINC=$S($P(FBY(0),"^",10)="":0,1:$P(FBY(0),"^",10)),FBLN=$S($P(FBY(0),"^",11)="":0,1:$P(FBY(0),"^",11))
"RTN","FBCHEP",28,0)
GETNXI D GETNXI^FBAAUTL
"RTN","FBCHEP",29,0)
 W !!,"Invoice # ",FBAAIN," assigned to this Invoice"
"RTN","FBCHEP",30,0)
RIN D GETINDT^FBAACO1 G Q:$G(FBAAOUT)
"RTN","FBCHEP",31,0)
 ; ask patient control number
"RTN","FBCHEP",32,0)
 S FBCSID=$$ASKPCN^FBUTL5() I FBCSID="^" G Q
"RTN","FBCHEP",33,0)
 ; if U/C then get FPPS Claim ID else ask user
"RTN","FBCHEP",34,0)
 I $D(FB583) S FBFPPSC=$P($G(^FB583(FB583,5)),U) W !,"FPPS CLAIM ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBCHEP",35,0)
 E  S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 G Q
"RTN","FBCHEP",36,0)
 ; if EDI claim then ask FPPS line item
"RTN","FBCHEP",37,0)
 I FBFPPSC]"" S FBFPPSL=$$FPPSL^FBUTL5(,1) I FBFPPSL=-1 G Q
"RTN","FBCHEP",38,0)
 ; compute default Covered Days
"RTN","FBCHEP",39,0)
 S FBCDAYS=$$FMDIFF^XLFDT(FBAAEDT,FBAABDT)
"RTN","FBCHEP",40,0)
 I FBCDAYS=0 S FBCDAYS=1
"RTN","FBCHEP",41,0)
 S FBAAMM=$S(FBAAPTC="R":"",1:1) D PPT^FBAACO1()
"RTN","FBCHEP",42,0)
DIC S DIC="^FBAAI(",DIC(0)="LQ",DLAYGO=162.5,X=FBAAIN D ^DIC G Q:Y<0
"RTN","FBCHEP",43,0)
 S DA=+Y,DIE=DIC,DR="[FBCH ENTER PAYMENT]",DIE("NO^")=""
"RTN","FBCHEP",44,0)
 D
"RTN","FBCHEP",45,0)
 . N ICDVDT S ICDVDT=$G(FBAABDT) D ^DIE
"RTN","FBCHEP",46,0)
 ; file adjustment reasons
"RTN","FBCHEP",47,0)
 D FILEADJ^FBCHFA(DA_",",.FBADJ)
"RTN","FBCHEP",48,0)
 ; file remittance remarks
"RTN","FBCHEP",49,0)
 D FILERR^FBCHFR(DA_",",.FBRRMK)
"RTN","FBCHEP",50,0)
 ; file Line Item Rendering providers
"RTN","FBCHEP",51,0)
 D FILERP^FBUTL8(DA_",",.FBPROV) ;FB*3.5*122
"RTN","FBCHEP",52,0)
 K DIE,DIC,D,DA,DR
"RTN","FBCHEP",53,0)
 S $P(FBY(0),"^",10)=FBINC+1,$P(FBY(0),"^",11)=FBLN+1,$P(FBY(0),"^",18)=FBEXMPT,^FBAA(161.7,FBAABE,0)=FBY(0) D:'$D(FBNOPTF) PTF G Q:$D(FB583),RD
"RTN","FBCHEP",54,0)
OUT W !!,*7,?3,"Invoice number ",FBAAIN," has already been entered for this authorization.",!,?3,"Use the Contract Hospital 'Invoice Edit' option if needed.",!
"RTN","FBCHEP",55,0)
 ;check if user wants to add a second invoice for this 7078
"RTN","FBCHEP",56,0)
 W ! S DIR("A")="Want to add another invoice for this episode of care",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR I Y S (FBNOPTF,FBRESUB)=1 G SETINV
"RTN","FBCHEP",57,0)
Q K BO,CNT,D,DA,DAT,DIC,DIE,DLAYGO,DR,FB7078,FBAABDT,FBAABE,FBAAEDT,FBAAID,FBAAIN,FBAAOUT,FBAAPTC,FBDX,FBTT,FBTYPE,FBVEN,FBVET,FBXX,FTP,I,J,FBK,PI,FBPOP,PTYPE,S,FBZ,Z1,FBI,FBPROG,FBRR,FBSW,FBPOV,FBPT,FBY,T,Y,Z1,Z2,ZZ,FBPSA,A,FBI7078
"RTN","FBCHEP",58,0)
 K FBCHOB,FBAUT,FBSEQ,X,FBSITE,F,FBSTN,FBASSOC,FBLOC,DUOUT,PSA,FBCOUNTY,DFN,FBNOPTF,DIRUT,FBVE,FBAAOUT,FBEXMPT,FBAAPN,FBAMTC,FBDEL,FBINC,FBLN,FBRESUB
"RTN","FBCHEP",59,0)
 K FBD1,FBFDC,FBMST,FBTTYPE,FB583
"RTN","FBCHEP",60,0)
 K FBCSID,FBFPPSC,FBFPPSL,FBCDAYS,FBAMTP,FBADJ,FBRRMK
"RTN","FBCHEP",61,0)
 Q
"RTN","FBCHEP",62,0)
PTF I $G(FBVET),$G(FBI7078)["FB583" S:'$G(DFN) DFN=FBVET D PTFC^FBUTL6(DFN,$P(FBZ(0),"^",4))
"RTN","FBCHEP",63,0)
 Q
"RTN","FBCHEP",64,0)
PRBT ;Entry point for patient reimbursement option
"RTN","FBCHEP",65,0)
 ;
"RTN","FBCHEP",66,0)
 S FBAAPTC="R"
"RTN","FBCHEP",67,0)
 G RD
"RTN","FBCHEP",68,0)
CHK ;Check for vendor and batch being exempt from pricer
"RTN","FBCHEP",69,0)
 I $G(FBVE)'="Y"&($G(FBVE)'="N") S FBVE="N"
"RTN","FBCHEP",70,0)
 I $G(FBEXMPT)="Y" Q:FBVE="Y"  G OPEN:FBVE="N"
"RTN","FBCHEP",71,0)
 I $G(FBEXMPT)="N" Q:FBVE="N"  G OPEN:FBVE="Y"
"RTN","FBCHEP",72,0)
 I '$G(FBEXMPT)&($G(Z2)'>0) S FBEXMPT=FBVE Q
"RTN","FBCHEP",73,0)
 I '$G(FBEXMPT)&($G(Z2)>0) S $P(^FBAA(161.7,FBAABE,0),"^",18)="N",FBEXMPT="N" G CHK
"RTN","FBCHEP",74,0)
 Q
"RTN","FBCHEP",75,0)
OPEN W *7,!!,"This Invoice may not be added to Batch # ",+FBY(0),".",!,"***You may not add a ",$S(FBVE="Y":"pricer exempt",1:"non-exempt")," invoice to a ",$S(FBVE="Y":"non-exempt",1:"pricer exempt")," batch.***"
"RTN","FBCHEP",76,0)
 S DIR(0)="Y",DIR("A")="Do you want to open a new batch at this time",DIR("B")="Y" D ^DIR K DIR S:$D(DIRUT)!('Y) FBAAOUT=1 Q:FBAAOUT  D RCHOP^FBAAOB S FBEXMPT=FBVE D
"RTN","FBCHEP",77,0)
 .S FBY(0)=$G(^FBAA(161.7,FBAABE,0)),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2)
"RTN","FBCHEP",78,0)
 Q
"RTN","FBCHEP1")
0^8^B11345024^B11099974
"RTN","FBCHEP1",1,0)
FBCHEP1 ;AISC/DMK-EDIT PAYMENT FOR CONTRACT HOSPITAL ;7/8/2003
"RTN","FBCHEP1",2,0)
 ;;3.5;FEE BASIS;**38,61,122**;JAN 30, 1995;Build 8
"RTN","FBCHEP1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHEP1",4,0)
EDIT ;ENTRY POINT TO EDIT PAYMENT
"RTN","FBCHEP1",5,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBCHEP1",6,0)
BT W ! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,3)=""B9""&($P(^(0),U,15)=""Y"")",DIC("S")=$S($D(^XUSEC("FBAASUPERVISOR",DUZ)):DIC("S"),1:DIC("S")_"&($P(^(0),U,5)=DUZ)") D ^DIC
"RTN","FBCHEP1",7,0)
 G END:X=""!(X="^"),BT:Y<0 S FBN=+Y,FBN(0)=Y(0)
"RTN","FBCHEP1",8,0)
 S FBEXMPT=$P(FBN(0),"^",18)
"RTN","FBCHEP1",9,0)
 S FBSTAT=^FBAA(161.7,FBN,"ST"),FBBAMT=$S($P(FBN(0),"^",9)="":0,1:$P(FBN(0),"^",9))
"RTN","FBCHEP1",10,0)
 I FBSTAT="C"&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,?3,"You must Reopen the batch prior to editting the invoice.",! G END
"RTN","FBCHEP1",11,0)
 I FBSTAT="S"!(FBSTAT="P")!(FBSTAT="R")&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,?3,"You must be a holder of the 'FBAASUPERVISOR' security key",!,?3,"to edit this invoice.",! G END
"RTN","FBCHEP1",12,0)
 I FBSTAT="T"!(FBSTAT="V") W !!,?3,"Batch has already been sent to Austin for payment.",! G END
"RTN","FBCHEP1",13,0)
INV W ! S DIC="^FBAAI(",DIC(0)="AEQZ",DIC("S")="I $P(^(0),U,17)=FBN" D ^DIC K DIC("S") G BT:X=""!(X="^"),INV:Y<0 S FBI=+Y
"RTN","FBCHEP1",14,0)
 S FBK=$S($P(^FBAAI(FBI,0),"^",9)="":0,1:$P(^(0),"^",9))
"RTN","FBCHEP1",15,0)
 S FBLISTC="",FBAAI=FBI W @IOF D START^FBCHDI2 S FBI=FBAAI I $P(^FBAAI(FBI,0),"^",9)="" S FBPRICE=""
"RTN","FBCHEP1",16,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBCHEP1",17,0)
 D
"RTN","FBCHEP1",18,0)
 . N FBY
"RTN","FBCHEP1",19,0)
 . S FBY=$G(^FBAAI(FBI,0))
"RTN","FBCHEP1",20,0)
 . S FB1725=$S($P(FBY,U,5)["FB583":+$P($G(^FB583(+$P(FBY,U,5),0)),U,28),1:0)
"RTN","FBCHEP1",21,0)
 ; get values of FPPS Claim ID and Line Item
"RTN","FBCHEP1",22,0)
 S FBFPPSC=$P($G(^FBAAI(FBI,3)),U)
"RTN","FBCHEP1",23,0)
 S FBFPPSL=$P($G(^FBAAI(FBI,3)),U,2)
"RTN","FBCHEP1",24,0)
 ; load current adjustment data
"RTN","FBCHEP1",25,0)
 D LOADADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHEP1",26,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBCHEP1",27,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBCHEP1",28,0)
 ; load current remittance remark data
"RTN","FBCHEP1",29,0)
 D LOADRR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHEP1",30,0)
 ; load Item level Rendering provider data
"RTN","FBCHEP1",31,0)
 D LOADRP^FBUTL8(FBI_",",.FBPROV) ;FB*3.5*122
"RTN","FBCHEP1",32,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBCHEP1",33,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBCHEP1",34,0)
 S (DIE,DIC)="^FBAAI(",DIC(0)="AEQM",DA=FBI,DR="[FBCH EDIT PAYMENT]" W ! D ^DIE
"RTN","FBCHEP1",35,0)
 ; if adjustment data changed then file
"RTN","FBCHEP1",36,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHEP1",37,0)
 ; if remit remark data changed then file
"RTN","FBCHEP1",38,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHEP1",39,0)
 K FBAAMM,FBAAMM1
"RTN","FBCHEP1",40,0)
 S FBNK=$P(^FBAAI(FBI,0),"^",9)
"RTN","FBCHEP1",41,0)
 I FBNK-FBK S $P(^FBAA(161.7,FBN,0),"^",9)=FBBAMT+(FBNK-FBK)
"RTN","FBCHEP1",42,0)
END K DA,DFN,DIC,DIE,DR,FBAAOUT,FBDX,FBI,FBIN,FBLISTC,FBN,FBPROC,FBSTAT,FBVEN,FBVID,J,K,L,POP,Q,VA,VADM,X,FBIFN,Y,FBPRICE,FBK,FBNK,FB583,FBAAPN,FBASSOC,FBDEL,FBLOC,DAT
"RTN","FBCHEP1",43,0)
 K CNT,D0,FB7078,FBAABDT,FBAAEDT,FBASSOC,FBAUT,FBLOC,FBPROG,FBPSA,FBPT,FBRR,FBTT,FBTYPE,FBXX,FTP,PI,PTYPE,T,Z,ZZ,F,FBPOV,I,TA,VAL,DUOUT,FBVET,FBBAMT,FBAAI,FBEXMPT,FB1725,FBPAMT
"RTN","FBCHEP1",44,0)
 K FBFPPSC,FBFPPSL,FBADJ,FBADJD,FBRRMK,FBRRMKD
"RTN","FBCHEP1",45,0)
 D END^FBCHDI
"RTN","FBCHEP1",46,0)
 Q
"RTN","FBCHVH")
0^12^B25718092^B17108073
"RTN","FBCHVH",1,0)
FBCHVH ;AISC/DMK-VENDOR PAYMENT HISTORY ;7/17/2003
"RTN","FBCHVH",2,0)
 ;;3.5;FEE BASIS;**55,61,122**;JAN 30, 1995;Build 8
"RTN","FBCHVH",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHVH",4,0)
GETVEN K FBAANQ D GETVEN^FBAAUTL1 G END:IFN']""
"RTN","FBCHVH",5,0)
 D DATE^FBAAUTL G:FBPOP GETVEN S ZZ=9999999.9999,FBBEG=ZZ-ENDDATE,FBEND=ZZ-BEGDATE
"RTN","FBCHVH",6,0)
 I '$D(^FBAAI("AF",IFN)) W !,*7,"No invoices on line for this vendor." G GETVEN
"RTN","FBCHVH",7,0)
 S VAR="IFN^FBBEG^FBEND^BEGDATE^ENDDATE"_$S($D(FBPROG):"^FBPROG",1:""),VAL=IFN_"^"_FBBEG_"^"_FBEND_"^"_BEGDATE_"^"_ENDDATE_$S($D(FBPROG):"^"_FBPROG,1:""),PGM="START^FBCHVH" D ZIS^FBAAUTL G:FBPOP END S:IO=IO(0) FBAANQ=1
"RTN","FBCHVH",8,0)
START S:'$D(FBPROG) FBPROG=6 S FBHEAD="VENDOR",Q="",$P(Q,"=",80)="=",FBAAOUT=0 U IO D GETDAT S:$E(IOST,1,2)'["C-" FBPG=1 D HEDC
"RTN","FBCHVH",9,0)
 F FBM=FBBEG-.1:0 S FBM=$O(^FBAAI("AF",IFN,FBM)) Q:FBM'>0!(FBM>FBEND)  F FBI=0:0 S FBI=$O(^FBAAI("AF",IFN,FBM,FBI)) Q:FBI'>0!(FBAAOUT)  I $D(^FBAAI(FBI,0)),$P(^(0),"^",12)=FBPROG,'$D(^("FBREJ")) D GETINV
"RTN","FBCHVH",10,0)
 G:$D(FBAANQ) GETVEN
"RTN","FBCHVH",11,0)
END K DA,DFN,BEGDATE,ENDDATE,FBBEG,FBEND,DIC,FBAANQ,FBAAOUT,FBDX,FBI,FBIN,FBPROC,FBVEN,FBVID,IFN,J,K,L,PGM,Q,VADM,VAERR,VAL,VAR,X,Y,VA,ZZ,FBM,FBHEAD,FBPROG,FBPG,FBVINDT
"RTN","FBCHVH",12,0)
 D CLOSE^FBAAUTL Q
"RTN","FBCHVH",13,0)
GETINV ;
"RTN","FBCHVH",14,0)
 N FBADJLA,FBADJLR,FBCDAYS,FBCSID,FBFPPSC,FBFPPSL,FBRRMKL,FBY2,FBY3
"RTN","FBCHVH",15,0)
 S FBIN=^FBAAI(FBI,0)
"RTN","FBCHVH",16,0)
 S FBY2=$G(^FBAAI(FBI,2))
"RTN","FBCHVH",17,0)
 S FBY3=$G(^FBAAI(FBI,3))
"RTN","FBCHVH",18,0)
 F J=1,2,3,4,6,7,8,9,10,11,13,14 S FBIN(J)=$P(FBIN,"^",J)
"RTN","FBCHVH",19,0)
 S FBVINDT=$P(FBY2,"^",2) D FBCKI^FBAACCB1(FBI)
"RTN","FBCHVH",20,0)
 S FBVEN=$S($D(^FBAAV(+FBIN(3),0)):$P(^(0),"^",1),1:"") I FBVEN]"" S FBVID=$P(^(0),"^",2)
"RTN","FBCHVH",21,0)
 S DFN=FBIN(4) Q:'DFN  D DEM^VADPT
"RTN","FBCHVH",22,0)
 S Y=FBIN(2) D CDAT S FBIN(2)=Y
"RTN","FBCHVH",23,0)
 S Y=FBIN(6) D CDAT S FBIN(6)=Y,Y=FBIN(7) D CDAT S FBIN(7)=Y
"RTN","FBCHVH",24,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBCHVH",25,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBCHVH",26,0)
 S FBFPPSC=$P(FBY3,U) ; fpps claim id
"RTN","FBCHVH",27,0)
 S FBFPPSL=$P(FBY3,U,2) ; fpps line item
"RTN","FBCHVH",28,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBCHVH",29,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBCHVH",30,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBCHVH",31,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",")
"RTN","FBCHVH",32,0)
WRT I $Y+6>IOSL D HANG^FBAAUTL1:$E(IOST,1,2)["C-" Q:FBAAOUT  I $D(^FBAAI(FBI,4)) D HEDC
"RTN","FBCHVH",33,0)
 W !,$S('$D(FBIN(13)):"",FBIN(13)="R":"*",1:""),$S($G(FBCAN)]"":"+",1:"")
"RTN","FBCHVH",34,0)
 W VADM(1)_"  "_$P(VADM(2),"^",2),?48,FBCSID
"RTN","FBCHVH",35,0)
 W !,?4,FBVEN,?45,FBVID,?62,FBIN(1)
"RTN","FBCHVH",36,0)
 W !,$S(FBIN(13)["R":"*",1:""),$S(FBIN(14)]"":"#",1:"")
"RTN","FBCHVH",37,0)
 W ?4,FBFPPSC,?18,FBFPPSL,?35,FBIN(2),?46,$$DATX^FBAAUTL(FBVINDT),?57,FBIN(6),?68,FBIN(7)
"RTN","FBCHVH",38,0)
 W !?4,$J(FBIN(8),1,2),?17,$J(FBIN(9),1,2),?29,FBCDAYS
"RTN","FBCHVH",39,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBCHVH",40,0)
 W ?39,$S(FBADJLR]"":FBADJLR,1:FBIN(11))
"RTN","FBCHVH",41,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBCHVH",42,0)
 W ?49,$S(FBADJLA]"":FBADJLA,1:$J(FBIN(10),1,2))
"RTN","FBCHVH",43,0)
 W ?64,FBRRMKL
"RTN","FBCHVH",44,0)
 W !
"RTN","FBCHVH",45,0)
 I $D(^FBAAI(FBI,"DX")) S FBDX=^("DX") F K=1:1:5 D WRTDX
"RTN","FBCHVH",46,0)
 I $D(^FBAAI(FBI,"PROC")) S FBPROC=^("PROC") W ! F L=1:1:5 D WRTPC
"RTN","FBCHVH",47,0)
 N A2 S A2=FBIN(9) D PMNT^FBAACCB2
"RTN","FBCHVH",48,0)
 Q
"RTN","FBCHVH",49,0)
WRTDX I $P(FBDX,"^",K)]"" W ?4,"Dx: ",$$ICD9^FBCSV1(+$P(FBDX,"^",K),$P($G(FBIN),"^",6)),"  " Q
"RTN","FBCHVH",50,0)
 Q
"RTN","FBCHVH",51,0)
WRTPC I $P(FBPROC,"^",L)]"" W ?4,"Proc: ",$$ICD0^FBCSV1(+$P(FBPROC,"^",L),$P($G(FBIN),"^",6)),"   " Q
"RTN","FBCHVH",52,0)
 Q
"RTN","FBCHVH",53,0)
HEDC I $D(FBHEAD) W:'$G(FBPG) @IOF K:$G(FBPG) FBPG W ?25,FBHEAD_" PAYMENT HISTORY",!,?24,$E(Q,1,24),!?48,"Date Range: ",BEGDATE_" to "_ENDDATE
"RTN","FBCHVH",54,0)
 I '$D(FBHEAD) W:'$G(FBPG) @IOF K:$G(FBPG) FBPG W !?32,"INVOICE DISPLAY",!,?31,$E(Q,1,17),!
"RTN","FBCHVH",55,0)
 W !,"Veteran's Name",?48,"Patient Control Number"
"RTN","FBCHVH",56,0)
 W !,"('*'Reimbursement to Veteran   '+' Cancellation Activity)   '#' Voided Payment)"
"RTN","FBCHVH",57,0)
 W !,?4,"Vendor Name",?45,"Vendor ID",?59,"Invoice #"
"RTN","FBCHVH",58,0)
 ;W !,?3,"Fr Date",?14,"To Date  Claimed   Paid",?41,"Sus Code",?59,"Dt. Rec.",?69,"Inv. Date"
"RTN","FBCHVH",59,0)
 W !,?4,"FPPS Claim ID",?18,"FPPS Line Item",?35,"Date Rec.",?46,"Inv. Date",?57,"Fr Date",?68,"To Date"
"RTN","FBCHVH",60,0)
 W !,?4,"Amt Claimed",?17,"Amt Paid",?29,"Cov.Days",?39,"Adj Code",?49,"Adj Amount",?64,"Remit Remark"
"RTN","FBCHVH",61,0)
 W !,Q,!
"RTN","FBCHVH",62,0)
 Q
"RTN","FBCHVH",63,0)
CDAT S Y=$E(Y,4,5)_"/"_$S($E(Y,6,7)="00":$E(Y,2,3),1:$E(Y,6,7)_"/"_$E(Y,2,3)) Q
"RTN","FBCHVH",64,0)
GETDAT S Y=BEGDATE D PDF^FBAAUTL S BEGDATE=Y,Y=ENDDATE D PDF^FBAAUTL S ENDDATE=Y
"RTN","FBCHVH",65,0)
 Q
"RTN","FBCHVH",66,0)
PRVD ;DISPLAY PROVIDER INFORMATION BEFORE INVOICE DISPLAY FB*3.5*122
"RTN","FBCHVH",67,0)
 N FBPRI,FBSRVF,FBST
"RTN","FBCHVH",68,0)
 S FBPRI=$G(^FBAAI(FBI,4)),FBSRVF=$G(^FBAAI(FBI,5)),$P(FBSRVF,U,3)=$$GET1^DIQ(5,$P(FBSRVF,U,3)_",",1)
"RTN","FBCHVH",69,0)
 W @IOF,!?30,"INVOICE DISPLAY",!?30,"===============",!?28,"PROVIDER INFORMATION",!
"RTN","FBCHVH",70,0)
 I $L($P(FBPRI,U,1,3))>3 W !?3,"ATTENDING PROV NAME: "_$P(FBPRI,U),!?3,"ATTENDING PROV NPI: "_$P(FBPRI,U,2),?35,"ATTENDING PROV TAXONOMY CODE: "_$P(FBPRI,U,3)
"RTN","FBCHVH",71,0)
 I $L($P(FBPRI,U,4,5))>2 W !!?3,"OPERATING PROV NAME: "_$P(FBPRI,U,4),!?3,"OPERATING PROV NPI: "_$P(FBPRI,U,5)
"RTN","FBCHVH",72,0)
 I $L($P(FBPRI,U,6,8))>3 W !!?3,"RENDERING PROV NAME: "_$P(FBPRI,U,6),!?3,"RENDERING PROV NPI: "_$P(FBPRI,U,7),?35,"RENDERING PROV TAXONOMY CODE: "_$P(FBPRI,U,8)
"RTN","FBCHVH",73,0)
 I $L($P(FBPRI,U,9,10))>2 W !!?3,"SERVICING PROV NAME: "_$P(FBPRI,U,9),!?3,"SERVICING PROV NPI: "_$P(FBPRI,U,10)
"RTN","FBCHVH",74,0)
 I $L($P(FBSRVF,U,1,4))>4 W !?3,"SERVICING FACILITY ADDRESS: ",!?5,$P(FBSRVF,U),!?5,$P(FBSRVF,U,2) I $P(FBSRVF,U,2)'="" W ", "
"RTN","FBCHVH",75,0)
 W $P(FBSRVF,U,3)_" "_$P(FBSRVF,U,4)
"RTN","FBCHVH",76,0)
 I $L($P(FBPRI,U,11,12))>2 W !!?3,"REFERRING PROV NAME: "_$P(FBPRI,U,11),!?3,"REFERRING PROV NPI: "_$P(FBPRI,U,12),!!
"RTN","FBCHVH",77,0)
 S DIR(0)="E" D ^DIR
"RTN","FBCHVH",78,0)
 Q
"RTN","FBFHLD3")
0^14^B18574752^B16935419
"RTN","FBFHLD3",1,0)
FBFHLD3 ;OIFO/SAB-GET DATA FOR OUT/ANC INVOICE ;9/9/2003
"RTN","FBFHLD3",2,0)
 ;;3.5;FEE BASIS;**61,122**;JUNE 6, 2011;Build 8
"RTN","FBFHLD3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBFHLD3",4,0)
 Q
"RTN","FBFHLD3",5,0)
 ;
"RTN","FBFHLD3",6,0)
EN ;
"RTN","FBFHLD3",7,0)
 ; input
"RTN","FBFHLD3",8,0)
 ;   FBAAIN - invoice number
"RTN","FBFHLD3",9,0)
 ; output
"RTN","FBFHLD3",10,0)
 ;   If transaction type = "X" then only * items are output
"RTN","FBFHLD3",11,0)
 ;   Claim Level Data
"RTN","FBFHLD3",12,0)
 ;   FBD(0,"AMT") = Amount Disbursed^Amount Interest 
"RTN","FBFHLD3",13,0)
 ;  *FBD(0,"CAN") = Cancel Date^Cancel Reason^Cancel Activity
"RTN","FBFHLD3",14,0)
 ;   FBD(0,"DT") = Invoice Date
"RTN","FBFHLD3",15,0)
 ;  *FBD(0,"FPPS") = FPPS Claim ID
"RTN","FBFHLD3",16,0)
 ;  *FBD(0,"INV") = Invoice #^Transaction Type^Station #
"RTN","FBFHLD3",17,0)
 ;
"RTN","FBFHLD3",18,0)
 ;   Line Level Data (# is a sequential number)
"RTN","FBFHLD3",19,0)
 ;   FBD(#,"ADJ") = AdjReason1^AdjGrp1^AdjAmt1^AdjReason2^AdjGrp2^AdjAmt2
"RTN","FBFHLD3",20,0)
 ;   FBD(#,"AMT") = Amount Claimed^Amount Paid
"RTN","FBFHLD3",21,0)
 ;   FBD(#,"CK") = Check Number^Check Date^Payment Method
"RTN","FBFHLD3",22,0)
 ;   FBD(#,"835") = Routing Number^Financial Institution^^Account Number    ; FB*3.5*122
"RTN","FBFHLD3",23,0)
 ;   FBD(#,"DT") = Date of Service
"RTN","FBFHLD3",24,0)
 ;   FBD(#,"FPPS") = FPPS Line Item
"RTN","FBFHLD3",25,0)
 ;   FBD(#,"RMK") = Remittance Remark1,Remittance Remark2
"RTN","FBFHLD3",26,0)
 ;   FBD(#,"SVC") = Service Code^Qualifier^Mod1,Mod2,Mod3,Mod4^Units
"RTN","FBFHLD3",27,0)
 ;
"RTN","FBFHLD3",28,0)
 ;   If exceptions for invoice
"RTN","FBFHLD3",29,0)
 ;   ^TMP($J,"FBE",FBAAIN,seq number)=message
"RTN","FBFHLD3",30,0)
 ;   If warnings for invoice
"RTN","FBFHLD3",31,0)
 ;   ^TMP($J,"FBW",FBAAIN,seq number)=message
"RTN","FBFHLD3",32,0)
 ;
"RTN","FBFHLD3",33,0)
 ; initialize variables
"RTN","FBFHLD3",34,0)
 N DA,FBC,FBI,FBIENS,FBSTA,FBTTYP,FBY
"RTN","FBFHLD3",35,0)
 K FBD
"RTN","FBFHLD3",36,0)
 S FBC=0 ; line count
"RTN","FBFHLD3",37,0)
 ;
"RTN","FBFHLD3",38,0)
 ; loop thru lines on invoice
"RTN","FBFHLD3",39,0)
 S DA(3)=0
"RTN","FBFHLD3",40,0)
 F  S DA(3)=$O(^FBAAC("C",FBAAIN,DA(3))) Q:'DA(3)  D
"RTN","FBFHLD3",41,0)
 .S DA(2)=0
"RTN","FBFHLD3",42,0)
 .F  S DA(2)=$O(^FBAAC("C",FBAAIN,DA(3),DA(2))) Q:'DA(2)  D
"RTN","FBFHLD3",43,0)
 ..S DA(1)=0
"RTN","FBFHLD3",44,0)
 ..F  S DA(1)=$O(^FBAAC("C",FBAAIN,DA(3),DA(2),DA(1))) Q:'DA(1)  D
"RTN","FBFHLD3",45,0)
 ...S DA=0
"RTN","FBFHLD3",46,0)
 ...F  S DA=$O(^FBAAC("C",FBAAIN,DA(3),DA(2),DA(1),DA)) Q:'DA  D
"RTN","FBFHLD3",47,0)
 ....S FBIENS=DA_","_DA(1)_","_DA(2)_","_DA(3)_","
"RTN","FBFHLD3",48,0)
 ....F FBI=0,2,3,"FBREJ" S FBY(FBI)=$G(^FBAAC(DA(3),1,DA(2),1,DA(1),1,DA,FBI))
"RTN","FBFHLD3",49,0)
 ....Q:'$$CKLNST()  ; skip line if status not OK to transmit
"RTN","FBFHLD3",50,0)
 ....S FBC=FBC+1
"RTN","FBFHLD3",51,0)
 ....; if 1st line then get invoice level data
"RTN","FBFHLD3",52,0)
 ....I FBC=1 D INVOICE
"RTN","FBFHLD3",53,0)
 ....I FBTTYP="L" D LINE
"RTN","FBFHLD3",54,0)
 Q
"RTN","FBFHLD3",55,0)
 ;
"RTN","FBFHLD3",56,0)
INVOICE ; determine invoice data from 1st line item
"RTN","FBFHLD3",57,0)
 ;   FBD(0,"AMT") = Amount Disbursed^Amount Interest 
"RTN","FBFHLD3",58,0)
 ;   FBD(0,"CAN") = Cancel Date^Cancel Reason^Cancel Activity
"RTN","FBFHLD3",59,0)
 ;   FBD(0,"DT") = Invoice Date
"RTN","FBFHLD3",60,0)
 ;   FBD(0,"FPPS") = FPPS Claim ID
"RTN","FBFHLD3",61,0)
 ;   FBD(0,"INV") = Invoice #^Transaction Type^Station #
"RTN","FBFHLD3",62,0)
 ;   FBSTA = station number
"RTN","FBFHLD3",63,0)
 ;   FBTTYP = transaction type (L or X)
"RTN","FBFHLD3",64,0)
 ;
"RTN","FBFHLD3",65,0)
 N FBDT,FBOB,FBX
"RTN","FBFHLD3",66,0)
 ; determine Transaction Type (based on CANCELLATION DATE)
"RTN","FBFHLD3",67,0)
 S FBTTYP=$S($P(FBY(2),U,4)]"":"X",1:"L")
"RTN","FBFHLD3",68,0)
 ;
"RTN","FBFHLD3",69,0)
 ; determine station number
"RTN","FBFHLD3",70,0)
 S FBSTA=$$STANO^FBFHLU($P(FBY(0),U,8))
"RTN","FBFHLD3",71,0)
 ;
"RTN","FBFHLD3",72,0)
 ;INV
"RTN","FBFHLD3",73,0)
 S FBD(0,"INV")=FBAAIN_U_FBTTYP_U_FBSTA
"RTN","FBFHLD3",74,0)
 ;
"RTN","FBFHLD3",75,0)
 ;FPPS
"RTN","FBFHLD3",76,0)
 S FBD(0,"FPPS")=$P(FBY(3),U)
"RTN","FBFHLD3",77,0)
 ;
"RTN","FBFHLD3",78,0)
 ;CAN
"RTN","FBFHLD3",79,0)
 ; if cancel then get cancel data
"RTN","FBFHLD3",80,0)
 I FBTTYP="X" D  Q
"RTN","FBFHLD3",81,0)
 . S FBD(0,"CAN")=$P(FBY(2),U,4)_U_$$GET1^DIQ(162.03,FBIENS,"37:1")_U_$P(FBY(2),U,6)
"RTN","FBFHLD3",82,0)
 ;
"RTN","FBFHLD3",83,0)
 ;AMT
"RTN","FBFHLD3",84,0)
 S FBD(0,"AMT")="0^0" ; initialize sums
"RTN","FBFHLD3",85,0)
 ;
"RTN","FBFHLD3",86,0)
 ;DT
"RTN","FBFHLD3",87,0)
 ; determine invoice date
"RTN","FBFHLD3",88,0)
 ;   (date finalized or date paid or date supervisor closed batch)
"RTN","FBFHLD3",89,0)
 S FBDT=$P(FBY(0),U,6) ; date finalized
"RTN","FBFHLD3",90,0)
 I FBDT="" S FBDT=$P(FBY(0),U,14) ; date paid
"RTN","FBFHLD3",91,0)
 I FBDT="",$P(FBY(0),U,8) S FBDT=$P(^FBAA(161.7,$P(FBY(0),U,8),0),U,6) ; date supv closed batch (for 0.00 invoices)
"RTN","FBFHLD3",92,0)
 S FBD(0,"DT")=FBDT
"RTN","FBFHLD3",93,0)
 ;
"RTN","FBFHLD3",94,0)
 Q
"RTN","FBFHLD3",95,0)
 ;
"RTN","FBFHLD3",96,0)
LINE ; FBC
"RTN","FBFHLD3",97,0)
 ;   FBD(#,"ADJ") = AdjReason1^AdjGrp1^AdjAmt1^AdjReason2^AdjGrp2^AdjAmt2
"RTN","FBFHLD3",98,0)
 ;   FBD(#,"AMT") = Amount Claimed^Amount Paid
"RTN","FBFHLD3",99,0)
 ;   FBD(#,"CK") = Check Number^Check Date^Payment Method
"RTN","FBFHLD3",100,0)
 ;   FBD(#,"835") = Routing Number^Financial Institution^^Account Number    ; FB*3.5*122
"RTN","FBFHLD3",101,0)
 ;   FBD(#,"DT") = Date of Service
"RTN","FBFHLD3",102,0)
 ;   FBD(#,"FPPS") = FPPS Line Item
"RTN","FBFHLD3",103,0)
 ;   FBD(#,"RMK") = Remittance Remark1^Remittance Remark2
"RTN","FBFHLD3",104,0)
 ;   FBD(#,"SVC") = Service Code^Qualifier^Mod1,Mod2,Mod3,Mod4^Units
"RTN","FBFHLD3",105,0)
 ;
"RTN","FBFHLD3",106,0)
 N FBAARCE,FBADJ,FBMODLE
"RTN","FBFHLD3",107,0)
 ; compare invoice transaction type (L,X) with line cancel status
"RTN","FBFHLD3",108,0)
 I ((FBTTYP="X")&($P(FBY(2),U,4)=""))!((FBTTYP="L")&($P(FBY(2),U,4)]"")) D POST^FBFHLU(FBAAIN,"E","ALL LINES DO NOT HAVE SAME CANCEL STATUS") Q
"RTN","FBFHLD3",109,0)
 ;
"RTN","FBFHLD3",110,0)
 ; SVC
"RTN","FBFHLD3",111,0)
 S FBAARCE=$$GET1^DIQ(162.03,FBIENS,48)
"RTN","FBFHLD3",112,0)
 I FBAARCE]"" S FBD(FBC,"SVC")=FBAARCE_U_"NU"
"RTN","FBFHLD3",113,0)
 E  D
"RTN","FBFHLD3",114,0)
 . S FBD(FBC,"SVC")=$$GET1^DIQ(162.03,FBIENS,.01)_U_"HC"
"RTN","FBFHLD3",115,0)
 . S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",1,"_DA_",""M"")","E")
"RTN","FBFHLD3",116,0)
 . I $L(FBMODLE,",")>4 S FBMODLE=$P(FBMODLE,",",1,4)
"RTN","FBFHLD3",117,0)
 . S $P(FBD(FBC,"SVC"),U,3)=FBMODLE
"RTN","FBFHLD3",118,0)
 S $P(FBD(FBC,"SVC"),U,4)=$P(FBY(2),U,14) ; units paid
"RTN","FBFHLD3",119,0)
 ;
"RTN","FBFHLD3",120,0)
 ;FPPS
"RTN","FBFHLD3",121,0)
 S FBD(FBC,"FPPS")=$P(FBY(3),U,2)
"RTN","FBFHLD3",122,0)
 ;
"RTN","FBFHLD3",123,0)
 ;DT
"RTN","FBFHLD3",124,0)
 S FBD(FBC,"DT")=$P($G(^FBAAC(DA(3),1,DA(2),1,DA(1),0)),U)
"RTN","FBFHLD3",125,0)
 ;
"RTN","FBFHLD3",126,0)
 ;AMT
"RTN","FBFHLD3",127,0)
 S FBD(FBC,"AMT")=$P(FBY(0),U,2)_U_$P(FBY(0),U,3)
"RTN","FBFHLD3",128,0)
 ;
"RTN","FBFHLD3",129,0)
 ;ADJ
"RTN","FBFHLD3",130,0)
 D LOADADJ^FBAAFA(FBIENS,.FBADJ)
"RTN","FBFHLD3",131,0)
 I $D(FBADJ) S FBD(FBC,"ADJ")=$$ADJL^FBUTL2(.FBADJ)
"RTN","FBFHLD3",132,0)
 ;
"RTN","FBFHLD3",133,0)
 ;RMK
"RTN","FBFHLD3",134,0)
 S FBD(FBC,"RMK")=$$RRL^FBAAFR(FBIENS)
"RTN","FBFHLD3",135,0)
 ;
"RTN","FBFHLD3",136,0)
 ;CK
"RTN","FBFHLD3",137,0)
 S FBD(FBC,"CK")=$P(FBY(2),U,3)_U_$P(FBY(0),U,14)_U_$$PAYMETH^FBFHLU($P(FBY(2),U,3))
"RTN","FBFHLD3",138,0)
 ;
"RTN","FBFHLD3",139,0)
 ;835   FB*3.5*122
"RTN","FBFHLD3",140,0)
 I $P(FBY(2),U,17),$P(FBY(2),U,18),$P(FBY(2),U,19)'="" S FBD(FBC,"835")=$P(FBY(2),U,17)_U_$P(FBY(2),U,18)_U_$P(FBY(2),U,19)
"RTN","FBFHLD3",141,0)
 ;
"RTN","FBFHLD3",142,0)
 ;CAMT ; add disbursed and interest amounts to claim (0) level
"RTN","FBFHLD3",143,0)
 ; note - disbursed amount on file includes the interest
"RTN","FBFHLD3",144,0)
 ;        since FPPS wants it w/o interest - interest is subtracted
"RTN","FBFHLD3",145,0)
 S $P(FBD(0,"AMT"),U)=$P(FBD(0,"AMT"),U)+($P(FBY(2),U,8)-$P(FBY(2),U,9))
"RTN","FBFHLD3",146,0)
 S $P(FBD(0,"AMT"),U,2)=$P(FBD(0,"AMT"),U,2)+$P(FBY(2),U,9)
"RTN","FBFHLD3",147,0)
 Q
"RTN","FBFHLD3",148,0)
 ;
"RTN","FBFHLD3",149,0)
CKLNST() ; check line status extrinsic function
"RTN","FBFHLD3",150,0)
 ; result (0 or 1)
"RTN","FBFHLD3",151,0)
 ;   0 when line should not be sent to FPPS
"RTN","FBFHLD3",152,0)
 ;   1 when line should be sent to FPPS
"RTN","FBFHLD3",153,0)
 N FBRET
"RTN","FBFHLD3",154,0)
 S FBRET=1
"RTN","FBFHLD3",155,0)
 ;
"RTN","FBFHLD3",156,0)
 ; check if rejected line
"RTN","FBFHLD3",157,0)
 I $P(FBY("FBREJ"),U)]"" S FBRET=0
"RTN","FBFHLD3",158,0)
 ;
"RTN","FBFHLD3",159,0)
 Q FBRET
"RTN","FBFHLD3",160,0)
 ;
"RTN","FBFHLD3",161,0)
 ;FBFHLD3
"RTN","FBFHLD9")
0^15^B11448900^B9980518
"RTN","FBFHLD9",1,0)
FBFHLD9 ;OIFO/SAB-GET DATA FOR INPATIENT INVOICE ;9/9/2003
"RTN","FBFHLD9",2,0)
 ;;3.5;FEE BASIS;**61,122**;JUNE 6, 2011;Build 8
"RTN","FBFHLD9",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBFHLD9",4,0)
 Q
"RTN","FBFHLD9",5,0)
 ;
"RTN","FBFHLD9",6,0)
EN ;
"RTN","FBFHLD9",7,0)
 ; input
"RTN","FBFHLD9",8,0)
 ;   FBAAIN - invoice number
"RTN","FBFHLD9",9,0)
 ; output
"RTN","FBFHLD9",10,0)
 ;   If transaction type = "X" then only * items are output
"RTN","FBFHLD9",11,0)
 ;   Claim Level Data
"RTN","FBFHLD9",12,0)
 ;   FBD(0,"AMT") = Amount Disbursed^Amount Interest 
"RTN","FBFHLD9",13,0)
 ;  *FBD(0,"CAN") = Cancel Date^Cancel Reason^Cancel Activity
"RTN","FBFHLD9",14,0)
 ;   FBD(0,"DAYS) = Covered Days
"RTN","FBFHLD9",15,0)
 ;   FBD(0,"DRG") = DRG^DRG Weight
"RTN","FBFHLD9",16,0)
 ;   FBD(0,"DT") = Invoice Date
"RTN","FBFHLD9",17,0)
 ;  *FBD(0,"FPPS") = FPPS Claim ID
"RTN","FBFHLD9",18,0)
 ;  *FBD(0,"INV") = Invoice #^Transaction Type^Station #
"RTN","FBFHLD9",19,0)
 ;
"RTN","FBFHLD9",20,0)
 ;   Line Level Data
"RTN","FBFHLD9",21,0)
 ;   FBD(1,"ADJ") = AdjReason1^AdjGrp1^AdjAmt1
"RTN","FBFHLD9",22,0)
 ;   FBD(1,"AMT") = Amount Claimed^Amount Paid
"RTN","FBFHLD9",23,0)
 ;   FBD(1,"CK") = Check Number^Check Date^Payment Method
"RTN","FBFHLD9",24,0)
 ;   FBD(1,"835") = Routing Number^Financial Institution^^Account Number    ; FB*3.5*122
"RTN","FBFHLD9",25,0)
 ;   FBD(1,"DT") = Start Date^End Date
"RTN","FBFHLD9",26,0)
 ;   FBD(1,"FPPS") = FPPS Line Item
"RTN","FBFHLD9",27,0)
 ;   FBD(1,"RMK") = Remittance Remark1,Remittance Remark2
"RTN","FBFHLD9",28,0)
 ;
"RTN","FBFHLD9",29,0)
 ;   If exceptions for invoice
"RTN","FBFHLD9",30,0)
 ;   ^TMP($J,"FBE",FBAAIN,seq number)=message
"RTN","FBFHLD9",31,0)
 ;   If warnings for invoice
"RTN","FBFHLD9",32,0)
 ;   ^TMP($J,"FBW",FBAAIN,seq number)=message
"RTN","FBFHLD9",33,0)
 ;
"RTN","FBFHLD9",34,0)
 ; initialize variables
"RTN","FBFHLD9",35,0)
 N DA,FBC,FBI,FBIENS,FBSTA,FBTTYP,FBY
"RTN","FBFHLD9",36,0)
 K FBD
"RTN","FBFHLD9",37,0)
 ;
"RTN","FBFHLD9",38,0)
 S DA=FBAAIN
"RTN","FBFHLD9",39,0)
 S FBIENS=DA_","
"RTN","FBFHLD9",40,0)
 F FBI=0,2,3,"FBREJ" S FBY(FBI)=$G(^FBAAI(DA,FBI))
"RTN","FBFHLD9",41,0)
 Q:'$$CKLNST()  ; skip line if status not OK to transmit
"RTN","FBFHLD9",42,0)
 S FBC=1
"RTN","FBFHLD9",43,0)
 D INVOICE
"RTN","FBFHLD9",44,0)
 I FBTTYP="C" D LINE
"RTN","FBFHLD9",45,0)
 Q
"RTN","FBFHLD9",46,0)
 ;
"RTN","FBFHLD9",47,0)
INVOICE ; determine invoice data
"RTN","FBFHLD9",48,0)
 ;   FBD(0,"AMT") = Amount Disbursed^Amount Interest 
"RTN","FBFHLD9",49,0)
 ;   FBD(0,"CAN") = Cancel Date^Cancel Reason^Cancel Activity
"RTN","FBFHLD9",50,0)
 ;   FBD(0,"DAYS")
"RTN","FBFHLD9",51,0)
 ;   FBD(0,"DRG")
"RTN","FBFHLD9",52,0)
 ;   FBD(0,"DT") = Invoice Date
"RTN","FBFHLD9",53,0)
 ;   FBD(0,"FPPS") = FPPS Claim ID
"RTN","FBFHLD9",54,0)
 ;   FBD(0,"INV") = Invoice #^Transaction Type^Station #
"RTN","FBFHLD9",55,0)
 ;   FBSTA = station number
"RTN","FBFHLD9",56,0)
 ;   FBTTYP = transaction type (C or X)
"RTN","FBFHLD9",57,0)
 ;
"RTN","FBFHLD9",58,0)
 N FBDT,FBOB,FBX
"RTN","FBFHLD9",59,0)
 ; determine Transaction Type (based on CANCELLATION DATE)
"RTN","FBFHLD9",60,0)
 S FBTTYP=$S($P(FBY(2),U,5)]"":"X",1:"C")
"RTN","FBFHLD9",61,0)
 ;
"RTN","FBFHLD9",62,0)
 ; determine station number
"RTN","FBFHLD9",63,0)
 S FBSTA=$$STANO^FBFHLU($P(FBY(0),U,17))
"RTN","FBFHLD9",64,0)
 ;
"RTN","FBFHLD9",65,0)
 ;INV
"RTN","FBFHLD9",66,0)
 S FBD(0,"INV")=FBAAIN_U_FBTTYP_U_FBSTA
"RTN","FBFHLD9",67,0)
 ;
"RTN","FBFHLD9",68,0)
 ;FPPS
"RTN","FBFHLD9",69,0)
 S FBD(0,"FPPS")=$P(FBY(3),U)
"RTN","FBFHLD9",70,0)
 ;
"RTN","FBFHLD9",71,0)
 ;CAN
"RTN","FBFHLD9",72,0)
 ; if cancel then get cancel data
"RTN","FBFHLD9",73,0)
 I FBTTYP="X" D  Q
"RTN","FBFHLD9",74,0)
 . S FBD(0,"CAN")=$P(FBY(2),U,5)_U_$$GET1^DIQ(162.5,FBIENS,"50:1")_U_$P(FBY(2),U,7)
"RTN","FBFHLD9",75,0)
 ;
"RTN","FBFHLD9",76,0)
 ;AMT
"RTN","FBFHLD9",77,0)
 S FBD(0,"AMT")="0^0" ; initialize sums
"RTN","FBFHLD9",78,0)
 ;
"RTN","FBFHLD9",79,0)
 ;DT
"RTN","FBFHLD9",80,0)
 ; determine invoice date
"RTN","FBFHLD9",81,0)
 ;   (date finalized or date paid or date supervisor closed batch)
"RTN","FBFHLD9",82,0)
 S FBDT=$P(FBY(0),U,16) ; date finalized
"RTN","FBFHLD9",83,0)
 I FBDT="" S FBDT=$P(FBY(2),U) ; date paid
"RTN","FBFHLD9",84,0)
 I FBDT="",$P(FBY(0),U,17) S FBDT=$P(^FBAA(161.7,$P(FBY(0),U,17),0),U,6) ; date supv closed
"RTN","FBFHLD9",85,0)
 S FBD(0,"DT")=FBDT
"RTN","FBFHLD9",86,0)
 ;
"RTN","FBFHLD9",87,0)
 ;DAYS
"RTN","FBFHLD9",88,0)
 S FBD(0,"DAYS")=+$P(FBY(2),U,10)
"RTN","FBFHLD9",89,0)
 ;
"RTN","FBFHLD9",90,0)
 ;DRG
"RTN","FBFHLD9",91,0)
 S FBX=$$GET1^DIQ(162.5,FBIENS,24)
"RTN","FBFHLD9",92,0)
 I $E(FBX,1,3)="DRG" S FBX=$E(FBX,4,999)
"RTN","FBFHLD9",93,0)
 S FBD(0,"DRG")=FBX_U_$P(FBY(2),U,12)
"RTN","FBFHLD9",94,0)
 ;
"RTN","FBFHLD9",95,0)
 Q
"RTN","FBFHLD9",96,0)
 ;
"RTN","FBFHLD9",97,0)
LINE ;   FBC
"RTN","FBFHLD9",98,0)
 ;   FBD(#,"ADJ") = AdjReason1^AdjGrp1^AdjAmt1
"RTN","FBFHLD9",99,0)
 ;   FBD(#,"AMT") = Amount Claimed^Amount Paid
"RTN","FBFHLD9",100,0)
 ;   FBD(#,"CK") = Check Number^Check Date^Payment Method
"RTN","FBFHLD9",101,0)
 ;   FBD(#,"835") = Routing Number^Financial Institution^^Account Number    ; FB*3.5*122
"RTN","FBFHLD9",102,0)
 ;   FBD(#,"DT") = Start Date^End Date
"RTN","FBFHLD9",103,0)
 ;   FBD(#,"FPPS") = FPPS Line Item
"RTN","FBFHLD9",104,0)
 ;   FBD(#,"RMK") = Remittance Remark1^Remittance Remark2
"RTN","FBFHLD9",105,0)
 ;
"RTN","FBFHLD9",106,0)
 N FBADJ
"RTN","FBFHLD9",107,0)
 ;
"RTN","FBFHLD9",108,0)
 ;FPPS
"RTN","FBFHLD9",109,0)
 S FBD(FBC,"FPPS")=$P(FBY(3),U,2)
"RTN","FBFHLD9",110,0)
 ;
"RTN","FBFHLD9",111,0)
 ;DT
"RTN","FBFHLD9",112,0)
 S FBD(FBC,"DT")=$P(FBY(0),U,6)_U_$P(FBY(0),U,7)
"RTN","FBFHLD9",113,0)
 ;
"RTN","FBFHLD9",114,0)
 ;AMT
"RTN","FBFHLD9",115,0)
 S FBD(FBC,"AMT")=$P(FBY(0),U,8)_U_$P(FBY(0),U,9)
"RTN","FBFHLD9",116,0)
 ;
"RTN","FBFHLD9",117,0)
 ;ADJ
"RTN","FBFHLD9",118,0)
 D LOADADJ^FBCHFA(FBIENS,.FBADJ)
"RTN","FBFHLD9",119,0)
 I $D(FBADJ) S FBD(FBC,"ADJ")=$$ADJL^FBUTL2(.FBADJ)
"RTN","FBFHLD9",120,0)
 ;
"RTN","FBFHLD9",121,0)
 ;RMK
"RTN","FBFHLD9",122,0)
 S FBD(FBC,"RMK")=$$RRL^FBCHFR(FBIENS)
"RTN","FBFHLD9",123,0)
 ;
"RTN","FBFHLD9",124,0)
 ;CK
"RTN","FBFHLD9",125,0)
 S FBD(FBC,"CK")=$P(FBY(2),U,4)_U_$P(FBY(2),U)_U_$$PAYMETH^FBFHLU($P(FBY(2),U,4))
"RTN","FBFHLD9",126,0)
 ;
"RTN","FBFHLD9",127,0)
 ;835   FB*3.5*122
"RTN","FBFHLD9",128,0)
 I $P(FBY(2),U,13),$P(FBY(2),U,14),$P(FBY(2),U,15)'="" S FBD(FBC,"835")=$P(FBY(2),U,13)_U_$P(FBY(2),U,14)_U_$P(FBY(2),U,15)
"RTN","FBFHLD9",129,0)
 ;
"RTN","FBFHLD9",130,0)
 ;CAMT ; add disbursed and interest amounts to claim (0) level
"RTN","FBFHLD9",131,0)
 ; note - disbursed amount on file includes the interest
"RTN","FBFHLD9",132,0)
 ;        since FPPS wants it w/o interest - interest is subtracted
"RTN","FBFHLD9",133,0)
 S $P(FBD(0,"AMT"),U)=$P(FBD(0,"AMT"),U)+($P(FBY(2),U,8)-$P(FBY(2),U,9))
"RTN","FBFHLD9",134,0)
 S $P(FBD(0,"AMT"),U,2)=$P(FBD(0,"AMT"),U,2)+$P(FBY(2),U,9)
"RTN","FBFHLD9",135,0)
 Q
"RTN","FBFHLD9",136,0)
 ;
"RTN","FBFHLD9",137,0)
CKLNST() ; check line status extrinsic function
"RTN","FBFHLD9",138,0)
 ; result (0 or 1)
"RTN","FBFHLD9",139,0)
 ;   0 when line should not be sent to FPPS
"RTN","FBFHLD9",140,0)
 ;   1 when line should be sent to FPPS
"RTN","FBFHLD9",141,0)
 N FBRET
"RTN","FBFHLD9",142,0)
 S FBRET=1
"RTN","FBFHLD9",143,0)
 ;
"RTN","FBFHLD9",144,0)
 ; check if rejected line
"RTN","FBFHLD9",145,0)
 I $P(FBY("FBREJ"),U)]"" S FBRET=0
"RTN","FBFHLD9",146,0)
 ;
"RTN","FBFHLD9",147,0)
 Q FBRET
"RTN","FBFHLD9",148,0)
 ;
"RTN","FBFHLD9",149,0)
 ;FBFHLD9
"RTN","FBFHLS")
0^16^B61137128^B56632671
"RTN","FBFHLS",1,0)
FBFHLS ;OIFO/SAB-BUILD HL7 MESSAGE SEGMENTS ;11/21/2003
"RTN","FBFHLS",2,0)
 ;;3.5;FEE BASIS;**61,68,122**;JUNE 6, 2011;Build 8
"RTN","FBFHLS",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBFHLS",4,0)
 Q
"RTN","FBFHLS",5,0)
 ;
"RTN","FBFHLS",6,0)
EN ;
"RTN","FBFHLS",7,0)
 ; input
"RTN","FBFHLS",8,0)
 ; HLFS  - HL7 field separator
"RTN","FBFHLS",9,0)
 ; HLECH - HL7 encoding characters
"RTN","FBFHLS",10,0)
 ; FBAAIN - invoice number
"RTN","FBFHLS",11,0)
 ; FBD( array containing the invoice data
"RTN","FBFHLS",12,0)
 ;  Applicablity of a FBD node for a given transaction type (C,L, or X)
"RTN","FBFHLS",13,0)
 ;  is indicated by the presence of the transaction type code at the
"RTN","FBFHLS",14,0)
 ;  beginning of the line in the following table.
"RTN","FBFHLS",15,0)
 ;
"RTN","FBFHLS",16,0)
 ;   Claim Level Data
"RTN","FBFHLS",17,0)
 ; CL   FBD(0,"AMT")  = Amount Disbursed^Amount Interest 
"RTN","FBFHLS",18,0)
 ;   X  FBD(0,"CAN")  = Cancel Date^Cancel Reason^Cancel Activity
"RTN","FBFHLS",19,0)
 ; C    FBD(0,"DAYS") = Covered Days
"RTN","FBFHLS",20,0)
 ; C    FBD(0,"DRG")  = DRG Code^DRG Weight
"RTN","FBFHLS",21,0)
 ; CL   FBD(0,"DT")   = Invoice Date
"RTN","FBFHLS",22,0)
 ; CLX  FBD(0,"FPPS") = FPPS Claim ID
"RTN","FBFHLS",23,0)
 ; CLX  FBD(0,"INV")  = Invoice #^Transaction Type^Station #
"RTN","FBFHLS",24,0)
 ;
"RTN","FBFHLS",25,0)
 ;   Line Level Data (# is a sequential number)
"RTN","FBFHLS",26,0)
 ; CL   FBD(#,"ADJ")  = AdjReas1^AdjGrp1^AdjAmt1^AdjReas2^AdjGrp2^AdjAmt2
"RTN","FBFHLS",27,0)
 ;       note: ADJ node is only defined when there is an adjustment
"RTN","FBFHLS",28,0)
 ;       note: only 1 adjustment for C type
"RTN","FBFHLS",29,0)
 ; CL   FBD(#,"AMT")  = Amount Claimed^Amount Paid
"RTN","FBFHLS",30,0)
 ; CL   FBD(#,"CK")   = Check Number^Check Date^Payment Method
"RTN","FBFHLS",31,0)
 ; CL   FBD(#,"835")  = Routing Number^Account Number^Financial Institution   FB*3.5*122
"RTN","FBFHLS",32,0)
 ; CL   FBD(#,"DT")   = Date of Service/Start Date^End Date
"RTN","FBFHLS",33,0)
 ;       note: End Date only applicable for C type
"RTN","FBFHLS",34,0)
 ; CL   FBD(#,"FPPS") = FPPS Line Item
"RTN","FBFHLS",35,0)
 ; CL   FBD(#,"RMK")  = Remittance Remark1,Remittance Remark2
"RTN","FBFHLS",36,0)
 ;  L   FBD(#,"SVC")  = Service Code^Qualifier^Mod1,Mod2,Mod3,Mod4^Units
"RTN","FBFHLS",37,0)
 ;       note: SVC node is not defined for pharmacy invoices
"RTN","FBFHLS",38,0)
 ;
"RTN","FBFHLS",39,0)
 ; If existing exceptions for invoice
"RTN","FBFHLS",40,0)
 ;   ^TMP($J,"FBE",FBAAIN,seq number)=message
"RTN","FBFHLS",41,0)
 ; If existing warnings for invoice
"RTN","FBFHLS",42,0)
 ;   ^TMP($J,"FBW",FBAAIN,seq number)=message
"RTN","FBFHLS",43,0)
 ;
"RTN","FBFHLS",44,0)
 ; output
"RTN","FBFHLS",45,0)
 ;   ^TMP("HLS",$J) = HL global array for invoice
"RTN","FBFHLS",46,0)
 ;   If new exceptions for invoice
"RTN","FBFHLS",47,0)
 ;     ^TMP($J,"FBE",FBAAIN,seq number)=message
"RTN","FBFHLS",48,0)
 ;   If new warnings for invoice
"RTN","FBFHLS",49,0)
 ;     ^TMP($J,"FBW",FBAAIN,seq number)=message
"RTN","FBFHLS",50,0)
 ;
"RTN","FBFHLS",51,0)
 ; initialize variables
"RTN","FBFHLS",52,0)
 N FBTTYP
"RTN","FBFHLS",53,0)
 K ^TMP("HLS",$J)
"RTN","FBFHLS",54,0)
 ;
"RTN","FBFHLS",55,0)
 ; determine transaction type
"RTN","FBFHLS",56,0)
 S FBTTYP=$P($G(FBD(0,"INV")),U,2)
"RTN","FBFHLS",57,0)
 ;
"RTN","FBFHLS",58,0)
 I '$D(HLFS) D  I '$D(HLFS) Q
"RTN","FBFHLS",59,0)
 . N FBHL
"RTN","FBFHLS",60,0)
 . D INIT^HLFNC2("FB FEE TO FPPS EVENT",.FBHL)
"RTN","FBFHLS",61,0)
 . I $G(FBHL) Q
"RTN","FBFHLS",62,0)
 . S HLFS=FBHL("FS")
"RTN","FBFHLS",63,0)
 . S HLECH=FBHL("ECH")
"RTN","FBFHLS",64,0)
 ;
"RTN","FBFHLS",65,0)
 ; check for required fields
"RTN","FBFHLS",66,0)
 D CHKREQ^FBFHLS1
"RTN","FBFHLS",67,0)
 ;
"RTN","FBFHLS",68,0)
 ; quit if exceptions
"RTN","FBFHLS",69,0)
 Q:$D(^TMP($J,"FBE",FBAAIN))
"RTN","FBFHLS",70,0)
 ;
"RTN","FBFHLS",71,0)
 ; build segments for invoice in ^TMP("HLS",$J,
"RTN","FBFHLS",72,0)
 I FBTTYP="C" D CL
"RTN","FBFHLS",73,0)
 I FBTTYP="L" D CL
"RTN","FBFHLS",74,0)
 I FBTTYP="X" D X
"RTN","FBFHLS",75,0)
 ;
"RTN","FBFHLS",76,0)
 Q
"RTN","FBFHLS",77,0)
 ;
"RTN","FBFHLS",78,0)
CL ; Claim or Line Transaction
"RTN","FBFHLS",79,0)
 N FBCOMP,FBFLD,FBFT1,FBI,FBL,FBORC,FBX
"RTN","FBFHLS",80,0)
 S FBL=0 ; line counter for HL7 lines in ^TMP("HLS",$J,line
"RTN","FBFHLS",81,0)
 ; loop thru line items (Claim Transaction must have just 1 line)
"RTN","FBFHLS",82,0)
 S FBI=0 F  S FBI=$O(FBD(FBI)) Q:'FBI  D
"RTN","FBFHLS",83,0)
 . S FBORC="ORC"
"RTN","FBFHLS",84,0)
 . ; transaction type (005)
"RTN","FBFHLS",85,0)
 . S $P(FBORC,HLFS,6)=$P(FBD(0,"INV"),U,2)
"RTN","FBFHLS",86,0)
 . ;
"RTN","FBFHLS",87,0)
 . I FBTTYP="C" D
"RTN","FBFHLS",88,0)
 . . ; covered days (007.3)
"RTN","FBFHLS",89,0)
 . . S FBFLD=$P(FBORC,HLFS,8)
"RTN","FBFHLS",90,0)
 . . S $P(FBFLD,$E(HLECH,1),3)=$P(FBD(0,"DAYS"),U)
"RTN","FBFHLS",91,0)
 . . S $P(FBORC,HLFS,8)=FBFLD
"RTN","FBFHLS",92,0)
 . ;
"RTN","FBFHLS",93,0)
 . ; date of service/start date (007.4.1)
"RTN","FBFHLS",94,0)
 . S FBFLD=$P(FBORC,HLFS,8)
"RTN","FBFHLS",95,0)
 . S FBCOMP=$P(FBFLD,$E(HLECH,1),4)
"RTN","FBFHLS",96,0)
 . S $P(FBCOMP,$E(HLECH,2),1)=$$FMTHL7^XLFDT($P(FBD(FBI,"DT"),U))
"RTN","FBFHLS",97,0)
 . S $P(FBFLD,$E(HLECH,1),4)=FBCOMP
"RTN","FBFHLS",98,0)
 . S $P(FBORC,HLFS,8)=FBFLD
"RTN","FBFHLS",99,0)
 . ;
"RTN","FBFHLS",100,0)
 . I FBTTYP="C" D
"RTN","FBFHLS",101,0)
 . . ; end date (007.5.1)
"RTN","FBFHLS",102,0)
 . . S FBFLD=$P(FBORC,HLFS,8)
"RTN","FBFHLS",103,0)
 . . S FBCOMP=$P(FBFLD,$E(HLECH,1),5)
"RTN","FBFHLS",104,0)
 . . S $P(FBCOMP,$E(HLECH,2),1)=$$FMTHL7^XLFDT($P(FBD(FBI,"DT"),U,2))
"RTN","FBFHLS",105,0)
 . . S $P(FBFLD,$E(HLECH,1),5)=FBCOMP
"RTN","FBFHLS",106,0)
 . . S $P(FBORC,HLFS,8)=FBFLD
"RTN","FBFHLS",107,0)
 . ;
"RTN","FBFHLS",108,0)
 . ; invoice date (009.1)
"RTN","FBFHLS",109,0)
 . S FBFLD=$P(FBORC,HLFS,10)
"RTN","FBFHLS",110,0)
 . S $P(FBFLD,$E(HLECH,1),1)=$$FMTHL7^XLFDT($P(FBD(0,"DT"),U))
"RTN","FBFHLS",111,0)
 . S $P(FBORC,HLFS,10)=FBFLD
"RTN","FBFHLS",112,0)
 . ;
"RTN","FBFHLS",113,0)
 . ; station number (013.4.2)
"RTN","FBFHLS",114,0)
 . S FBFLD=$P(FBORC,HLFS,14)
"RTN","FBFHLS",115,0)
 . S FBCOMP=$P(FBFLD,$E(HLECH,1),4)
"RTN","FBFHLS",116,0)
 . S $P(FBCOMP,$E(HLECH,2),2)=$P(FBD(0,"INV"),U,3)
"RTN","FBFHLS",117,0)
 . S $P(FBFLD,$E(HLECH,1),4)=FBCOMP
"RTN","FBFHLS",118,0)
 . S $P(FBORC,HLFS,14)=FBFLD
"RTN","FBFHLS",119,0)
 . ;
"RTN","FBFHLS",120,0)
 . ; store HL ORC segment for the line item
"RTN","FBFHLS",121,0)
 . S FBX=FBORC D TMPHL
"RTN","FBFHLS",122,0)
 . ;
"RTN","FBFHLS",123,0)
 . S FBFT1="FT1"
"RTN","FBFHLS",124,0)
 . ;
"RTN","FBFHLS",125,0)
 . ; FPPS CLAIM-LINE (002)
"RTN","FBFHLS",126,0)
 . S $P(FBFT1,HLFS,3)=$P(FBD(0,"FPPS"),U)_"-"_$$EXPLIST($P(FBD(FBI,"FPPS"),U))
"RTN","FBFHLS",127,0)
 . ;
"RTN","FBFHLS",128,0)
 . ; INVOICE # (003)
"RTN","FBFHLS",129,0)
 . S $P(FBFT1,HLFS,4)=$P(FBD(0,"INV"),U)
"RTN","FBFHLS",130,0)
 . ;
"RTN","FBFHLS",131,0)
 . ; CHECK DATE (004)
"RTN","FBFHLS",132,0)
 . S $P(FBFT1,HLFS,5)=$$FMTHL7^XLFDT($P(FBD(FBI,"CK"),U,2))
"RTN","FBFHLS",133,0)
 . ;
"RTN","FBFHLS",134,0)
 . ; PAYMENT METHOD (006)
"RTN","FBFHLS",135,0)
 . S $P(FBFT1,HLFS,7)=$P(FBD(FBI,"CK"),U,3)
"RTN","FBFHLS",136,0)
 . ;
"RTN","FBFHLS",137,0)
 . I FBTTYP="L" D
"RTN","FBFHLS",138,0)
 . . ; UNITS PAID (010)
"RTN","FBFHLS",139,0)
 . . S $P(FBFT1,HLFS,11)=$P($G(FBD(FBI,"SVC")),U,4)
"RTN","FBFHLS",140,0)
 . ;
"RTN","FBFHLS",141,0)
 . ; REMITTANCE REMARKS (013)
"RTN","FBFHLS",142,0)
 . S $P(FBFT1,HLFS,14)=$P(FBD(FBI,"RMK"),U)
"RTN","FBFHLS",143,0)
 . ;
"RTN","FBFHLS",144,0)
 . I FBTTYP="L" D
"RTN","FBFHLS",145,0)
 . . ; SERVICE QUALIFIER (019)
"RTN","FBFHLS",146,0)
 . . S $P(FBFT1,HLFS,20)=$P($G(FBD(FBI,"SVC")),U,2)
"RTN","FBFHLS",147,0)
 . ;
"RTN","FBFHLS",148,0)
 . ; CHECK NUMBER (023)
"RTN","FBFHLS",149,0)
 . S $P(FBFT1,HLFS,24)=$P(FBD(FBI,"CK"),U)
"RTN","FBFHLS",150,0)
 . ;
"RTN","FBFHLS",151,0)
 . I FBTTYP="L" D
"RTN","FBFHLS",152,0)
 . . ; SERVICE PROVIDED (025)
"RTN","FBFHLS",153,0)
 . . S $P(FBFT1,HLFS,26)=$P($G(FBD(FBI,"SVC")),U)
"RTN","FBFHLS",154,0)
 . ;
"RTN","FBFHLS",155,0)
 . I FBTTYP="C" D
"RTN","FBFHLS",156,0)
 . . ; DRG (025)
"RTN","FBFHLS",157,0)
 . . S $P(FBFT1,HLFS,26)=$P(FBD(0,"DRG"),U)
"RTN","FBFHLS",158,0)
 . ;
"RTN","FBFHLS",159,0)
 . I FBTTYP="L" D
"RTN","FBFHLS",160,0)
 . . ; MODIFIERS (026)
"RTN","FBFHLS",161,0)
 . . S $P(FBFT1,HLFS,27)=$P($G(FBD(FBI,"SVC")),U,3)
"RTN","FBFHLS",162,0)
 . ;
"RTN","FBFHLS",163,0)
 . I FBTTYP="C" D
"RTN","FBFHLS",164,0)
 . . ; DRG WEIGHT (026)
"RTN","FBFHLS",165,0)
 . . S $P(FBFT1,HLFS,27)=$P(FBD(0,"DRG"),U,2)
"RTN","FBFHLS",166,0)
 . ;
"RTN","FBFHLS",167,0)
 . ;  835 (030)     FB*3.5*122
"RTN","FBFHLS",168,0)
 . I $G(FBD(FBI,"835")) D  S $P(FBFT1,HLFS,31)=FBD(FBI,"835",1)_FBD(FBI,"835",2)_FBD(FBI,"835",3)
"RTN","FBFHLS",169,0)
 .. S FBD(FBI,"835",1)=$P(FBD(FBI,"835"),U)
"RTN","FBFHLS",170,0)
 .. S $P(FBD(FBI,"835",2),$E(HLECH),8)=$E(HLECH)_$P(FBD(FBI,"835"),U,2)
"RTN","FBFHLS",171,0)
 .. S FBD(FBI,"835",3)=$E(HLECH,4)_$P(FBD(FBI,"835"),U,3)
"RTN","FBFHLS",172,0)
 . ;
"RTN","FBFHLS",173,0)
 . ; generate and store FT1s for each of the different $ amounts
"RTN","FBFHLS",174,0)
 . ; amount claimed
"RTN","FBFHLS",175,0)
 . S FBX=$$FT1(1,$P(FBD(FBI,"AMT"),U)) D TMPHL
"RTN","FBFHLS",176,0)
 . ; amount paid
"RTN","FBFHLS",177,0)
 . S FBX=$$FT1(2,$P(FBD(FBI,"AMT"),U,2)) D TMPHL
"RTN","FBFHLS",178,0)
 . ; interest amount (conditional)
"RTN","FBFHLS",179,0)
 . I $P(FBD(0,"AMT"),U,2)>0 S FBX=$$FT1(3,$P(FBD(0,"AMT"),U,2)) D TMPHL
"RTN","FBFHLS",180,0)
 . ; disbursed amount
"RTN","FBFHLS",181,0)
 . S FBX=$$FT1(4,$P(FBD(0,"AMT"),U)) D TMPHL
"RTN","FBFHLS",182,0)
 . ; adjustment amount 1 (conditional)
"RTN","FBFHLS",183,0)
 . I +$P($G(FBD(FBI,"ADJ")),U,3)'=0 S FBX=$$FT1(5,$P(FBD(FBI,"ADJ"),U,1,3)) D TMPHL
"RTN","FBFHLS",184,0)
 . I FBTTYP="L" D
"RTN","FBFHLS",185,0)
 . . ; adjustment amount 2 (conditional)
"RTN","FBFHLS",186,0)
 . . I +$P($G(FBD(FBI,"ADJ")),U,6)'=0 S FBX=$$FT1(5,$P(FBD(FBI,"ADJ"),U,4,6)) D TMPHL
"RTN","FBFHLS",187,0)
 ;
"RTN","FBFHLS",188,0)
 Q
"RTN","FBFHLS",189,0)
 ;
"RTN","FBFHLS",190,0)
X ; Cancel Transaction
"RTN","FBFHLS",191,0)
 N FBCOMP,FBFLD,FBFT1,FBL,FBORC
"RTN","FBFHLS",192,0)
 S FBL=0 ; line counter for HL7 lines in ^TMP("HLS",$J,line
"RTN","FBFHLS",193,0)
 S FBORC="ORC"
"RTN","FBFHLS",194,0)
 ; transaction type (005)
"RTN","FBFHLS",195,0)
 S $P(FBORC,HLFS,6)=$P(FBD(0,"INV"),U,2)
"RTN","FBFHLS",196,0)
 ;
"RTN","FBFHLS",197,0)
 ; cancel date (009.1)
"RTN","FBFHLS",198,0)
 S FBFLD=$P(FBORC,HLFS,10)
"RTN","FBFHLS",199,0)
 S $P(FBFLD,$E(HLECH,1),1)=$$FMTHL7^XLFDT($P(FBD(0,"CAN"),U))
"RTN","FBFHLS",200,0)
 S $P(FBORC,HLFS,10)=FBFLD
"RTN","FBFHLS",201,0)
 ;
"RTN","FBFHLS",202,0)
 ; station number (013.4.2)
"RTN","FBFHLS",203,0)
 S FBFLD=$P(FBORC,HLFS,14)
"RTN","FBFHLS",204,0)
 S FBCOMP=$P(FBFLD,$E(HLECH,1),4)
"RTN","FBFHLS",205,0)
 S $P(FBCOMP,$E(HLECH,2),2)=$P(FBD(0,"INV"),U,3)
"RTN","FBFHLS",206,0)
 S $P(FBFLD,$E(HLECH,1),4)=FBCOMP
"RTN","FBFHLS",207,0)
 S $P(FBORC,HLFS,14)=FBFLD
"RTN","FBFHLS",208,0)
 ;
"RTN","FBFHLS",209,0)
 S FBFT1="FT1"
"RTN","FBFHLS",210,0)
 ;
"RTN","FBFHLS",211,0)
 ; FPPS CLAIM (002)
"RTN","FBFHLS",212,0)
 S $P(FBFT1,HLFS,3)=$P(FBD(0,"FPPS"),U)
"RTN","FBFHLS",213,0)
 ;
"RTN","FBFHLS",214,0)
 ; INVOICE # (003)
"RTN","FBFHLS",215,0)
 S $P(FBFT1,HLFS,4)=$P(FBD(0,"INV"),U)
"RTN","FBFHLS",216,0)
 ;
"RTN","FBFHLS",217,0)
 ; CANCEL ACTIVITY CODE (006)
"RTN","FBFHLS",218,0)
 S $P(FBFT1,HLFS,7)="F"_$P(FBD(0,"CAN"),U,3)
"RTN","FBFHLS",219,0)
 ;
"RTN","FBFHLS",220,0)
 ; CANCEL REASON (017)
"RTN","FBFHLS",221,0)
 S $P(FBFT1,HLFS,18)=$P(FBD(0,"CAN"),U,2)
"RTN","FBFHLS",222,0)
 ;
"RTN","FBFHLS",223,0)
 ; store HL segments for line item
"RTN","FBFHLS",224,0)
 S FBX=FBORC D TMPHL
"RTN","FBFHLS",225,0)
 S FBX=FBFT1 D TMPHL
"RTN","FBFHLS",226,0)
 ;
"RTN","FBFHLS",227,0)
 Q
"RTN","FBFHLS",228,0)
 ;
"RTN","FBFHLS",229,0)
EXPLIST(FBLIST) ; expand ranges in a list
"RTN","FBFHLS",230,0)
 ; input FBIST - list or range or "ALL"
"RTN","FBFHLS",231,0)
 ; result expanded list (e.g. "1-3" returned as "1,2,3")
"RTN","FBFHLS",232,0)
 ;
"RTN","FBFHLS",233,0)
 N FBER,FBRET,FBLIST2,FBI,FBX,FBY
"RTN","FBFHLS",234,0)
 S FBRET=$G(FBLIST)
"RTN","FBFHLS",235,0)
 I FBRET["-" D
"RTN","FBFHLS",236,0)
 . S FBLIST2="" ; init new list
"RTN","FBFHLS",237,0)
 . ; loop thru comma pieces in original list
"RTN","FBFHLS",238,0)
 . F FBI=1:1 S FBX=$P(FBLIST,",",FBI) Q:FBX=""  D
"RTN","FBFHLS",239,0)
 . . I FBX'["-" S FBLIST2=FBLIST2_FBX_"," Q  ; not range - put in new
"RTN","FBFHLS",240,0)
 . . ; expand range then put in new
"RTN","FBFHLS",241,0)
 . . S FBER=""
"RTN","FBFHLS",242,0)
 . . F FBY=$P(FBX,"-"):1:$P(FBX,"-",2) S FBER=FBER_FBY_","
"RTN","FBFHLS",243,0)
 . . ; append expanded range to new list
"RTN","FBFHLS",244,0)
 . . S FBLIST2=FBLIST2_FBER
"RTN","FBFHLS",245,0)
 . ; replace return value with expanded list
"RTN","FBFHLS",246,0)
 . S FBRET=FBLIST2
"RTN","FBFHLS",247,0)
 ;
"RTN","FBFHLS",248,0)
 ; remove trailing comma
"RTN","FBFHLS",249,0)
 I $E(FBRET,$L(FBRET))="," S FBRET=$E(FBRET,1,$L(FBRET)-1)
"RTN","FBFHLS",250,0)
 ;
"RTN","FBFHLS",251,0)
 Q FBRET
"RTN","FBFHLS",252,0)
 ;
"RTN","FBFHLS",253,0)
FT1(FBTYAMT,FBX) ; add amount to FT1 segment
"RTN","FBFHLS",254,0)
 ; input
"RTN","FBFHLS",255,0)
 ;   FBTYAMT - type of amount (1,2,3,4,5)
"RTN","FBFHLS",256,0)
 ;   FBX - if type 1-4 then amount
"RTN","FBFHLS",257,0)
 ;       - if type 5 then adj reason^adjustment group^adj amount
"RTN","FBFHLS",258,0)
 ;   FBFT1 - FT1 segment without an amount
"RTN","FBFHLS",259,0)
 ; result (string)
"RTN","FBFHLS",260,0)
 ;   FT1 segment with amount (and reason, group) inserted
"RTN","FBFHLS",261,0)
 N FBRET
"RTN","FBFHLS",262,0)
 S FBRET=FBFT1
"RTN","FBFHLS",263,0)
 ;
"RTN","FBFHLS",264,0)
 ; TYPE AMOUNT (007)
"RTN","FBFHLS",265,0)
 S $P(FBRET,HLFS,8)=FBTYAMT
"RTN","FBFHLS",266,0)
 ;
"RTN","FBFHLS",267,0)
 ; AMOUNT (011)
"RTN","FBFHLS",268,0)
 I FBTYAMT<5 S $P(FBRET,HLFS,12)=$FN($P(FBX,U),"",2)
"RTN","FBFHLS",269,0)
 I FBTYAMT=5 S $P(FBRET,HLFS,12)=$FN($P(FBX,U,3),"",2)
"RTN","FBFHLS",270,0)
 ;
"RTN","FBFHLS",271,0)
 ; ADJUSTMENT REASON (017)
"RTN","FBFHLS",272,0)
 I FBTYAMT=5 S $P(FBRET,HLFS,18)=$P(FBX,U)
"RTN","FBFHLS",273,0)
 ;
"RTN","FBFHLS",274,0)
 ; ADJUSTMENT GROUP (018)
"RTN","FBFHLS",275,0)
 I FBTYAMT=5 S $P(FBRET,HLFS,19)=$P(FBX,U,2)
"RTN","FBFHLS",276,0)
 ;
"RTN","FBFHLS",277,0)
 Q FBRET
"RTN","FBFHLS",278,0)
 ;
"RTN","FBFHLS",279,0)
TMPHL ; Place HL7 segment in ^TMP
"RTN","FBFHLS",280,0)
 ; input
"RTN","FBFHLS",281,0)
 ;   FBL - last line written to ^TMP
"RTN","FBFHLS",282,0)
 ;   FBX - HL7 segment
"RTN","FBFHLS",283,0)
 ; output
"RTN","FBFHLS",284,0)
 ;   FBL - will be incremented by 1
"RTN","FBFHLS",285,0)
 ;   stores FBX in ^TMP("HLS",$J,FBL+1)
"RTN","FBFHLS",286,0)
 ;   if length of FBX exceeds 244 then continuation lines will be used
"RTN","FBFHLS",287,0)
 ;     example ^TMP($J,"HLS",$J,FBL+1,1)
"RTN","FBFHLS",288,0)
 N FBLS
"RTN","FBFHLS",289,0)
 S FBL=FBL+1
"RTN","FBFHLS",290,0)
 I $L(FBX)<245 S ^TMP("HLS",$J,FBL)=FBX Q
"RTN","FBFHLS",291,0)
 S ^TMP("HLS",$J,FBL)=$E(FBX,1,244)
"RTN","FBFHLS",292,0)
 F FBLS=1:1 Q:$E(FBX,(FBLS*244)+1,(FBLS*244)+244)=""  D
"RTN","FBFHLS",293,0)
 . S ^TMP("HLS",$J,FBL,FBLS)=$E(FBX,(FBLS*244)+1,(FBLS*244)+244)
"RTN","FBFHLS",294,0)
 Q
"RTN","FBFHLS",295,0)
 ;
"RTN","FBFHLS",296,0)
 ;FBFHLS
"RTN","FBFHLX")
0^9^B58317729^B55631854
"RTN","FBFHLX",1,0)
FBFHLX ;WOIFO/SAB-TRANSMIT HL7 MESSAGES TO FPPS ;10/8/2003
"RTN","FBFHLX",2,0)
 ;;3.5;FEE BASIS;**61,121,122**;JUNE 6, 2011;Build 8
"RTN","FBFHLX",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBFHLX",4,0)
 Q
"RTN","FBFHLX",5,0)
 ;
"RTN","FBFHLX",6,0)
EN ; Entry Point
"RTN","FBFHLX",7,0)
 ;   may be called by scheduled option as non-interactive task
"RTN","FBFHLX",8,0)
 ;   may be called by user menu option as interactive task
"RTN","FBFHLX",9,0)
 ;
"RTN","FBFHLX",10,0)
 N FBMODE,FBQUIT
"RTN","FBFHLX",11,0)
 S FBQUIT=0
"RTN","FBFHLX",12,0)
 ;
"RTN","FBFHLX",13,0)
 ; Determine Mode - (A)LL PENDING or BY SELECTED (I)NVOICE
"RTN","FBFHLX",14,0)
 I $E(IOST,1,2)'="C-" S FBMODE="A" ; non-interactive is always ALL
"RTN","FBFHLX",15,0)
 I $E(IOST,1,2)="C-" D
"RTN","FBFHLX",16,0)
 . ; ask mode
"RTN","FBFHLX",17,0)
 . W !,"This option transmits HL7 messages to FPPS for EDI invoices."
"RTN","FBFHLX",18,0)
 . S DIR(0)="S^I:By Specified Invoice;A:All Pending Invoices"
"RTN","FBFHLX",19,0)
 . S DIR("A")="Select Transmission Option"
"RTN","FBFHLX",20,0)
 . S DIR("?",1)="Enter I to transmit a single invoice or A to transmit"
"RTN","FBFHLX",21,0)
 . S DIR("?",2)="all pending invoices.  If I is entered then you will be"
"RTN","FBFHLX",22,0)
 . S DIR("?",3)="asked to select the invoice."
"RTN","FBFHLX",23,0)
 . S DIR("?",4)=""
"RTN","FBFHLX",24,0)
 . S DIR("?")="Enter a code from the list."
"RTN","FBFHLX",25,0)
 . D ^DIR K DIR I $D(DIRUT) S FBQUIT=1 Q
"RTN","FBFHLX",26,0)
 . S FBMODE=Y
"RTN","FBFHLX",27,0)
 . ; confirm all
"RTN","FBFHLX",28,0)
 . I FBMODE="A" D
"RTN","FBFHLX",29,0)
 . . S DIR(0)="Y",DIR("A")="Transmit all pending invoices now"
"RTN","FBFHLX",30,0)
 . . D ^DIR K DIR I 'Y!$D(DIRUT) S FBQUIT=1 Q
"RTN","FBFHLX",31,0)
 Q:FBQUIT
"RTN","FBFHLX",32,0)
 ;
"RTN","FBFHLX",33,0)
 I FBMODE="A" D ALL
"RTN","FBFHLX",34,0)
 I FBMODE="I" D BYINV
"RTN","FBFHLX",35,0)
 ;
"RTN","FBFHLX",36,0)
 Q
"RTN","FBFHLX",37,0)
 ;
"RTN","FBFHLX",38,0)
ALL ; Transmit All Pending Invoices (interactive and non-interactive)
"RTN","FBFHLX",39,0)
 ; input
"RTN","FBFHLX",40,0)
 ;   FBQUIT - boolean value (0 or 1), true if process should stop
"RTN","FBFHLX",41,0)
 ; output
"RTN","FBFHLX",42,0)
 ;   FBQUIT - may change value
"RTN","FBFHLX",43,0)
 ;
"RTN","FBFHLX",44,0)
 N FBCNT,FBERR,FBHL,FBQDA,FBSTA,FBTTYP,FBXL,FBXMIT,FBFTRACK,HLFS,HLECH  ; FB*3.5*122
"RTN","FBFHLX",45,0)
 ;
"RTN","FBFHLX",46,0)
 ; init
"RTN","FBFHLX",47,0)
 S FBXL=20 ; last line used for message text (save 20 lines for header)
"RTN","FBFHLX",48,0)
 S FBCNT("PENDT")=0 ; count of pending invoices that were transmitted
"RTN","FBFHLX",49,0)
 S FBCNT("PENDE")=0 ; count of pending invoices that had exception
"RTN","FBFHLX",50,0)
 ;
"RTN","FBFHLX",51,0)
 ; save time that process started
"RTN","FBFHLX",52,0)
 S FBXMIT("START")=$$NOW^XLFDT()
"RTN","FBFHLX",53,0)
 I $E(IOST,1,2)="C-" W !!,"Starting Process..."
"RTN","FBFHLX",54,0)
 D TIME^FBFHLX2("START",FBXMIT("START"),.FBFTRACK) I $G(FBFTRACK) Q   ; active job to quit ; FB*3.5*122
"RTN","FBFHLX",55,0)
 ;
"RTN","FBFHLX",56,0)
 ; initialize HL variables
"RTN","FBFHLX",57,0)
 D INIT^HLFNC2("FB FEE TO FPPS EVENT",.FBHL)
"RTN","FBFHLX",58,0)
 I $G(FBHL) D
"RTN","FBFHLX",59,0)
 . S FBQUIT=1
"RTN","FBFHLX",60,0)
 . D PTXT^FBFHLX1(.FBXL,"Error: Unable to initialize HL variables.")
"RTN","FBFHLX",61,0)
 . D PTXT^FBFHLX1(.FBXL,FBHL)
"RTN","FBFHLX",62,0)
 E  D
"RTN","FBFHLX",63,0)
 . S HLFS=FBHL("FS")
"RTN","FBFHLX",64,0)
 . S HLECH=FBHL("ECH")
"RTN","FBFHLX",65,0)
 ;
"RTN","FBFHLX",66,0)
 ; check for transmitted invoices w/o commit ACK
"RTN","FBFHLX",67,0)
 S FBXMIT("ACK")=$$NOW^XLFDT()
"RTN","FBFHLX",68,0)
 I 'FBQUIT,$E(IOST,1,2)="C-" W !!,"Checking for acknowledgements..."
"RTN","FBFHLX",69,0)
 I 'FBQUIT D CHKACK^FBFHLX1
"RTN","FBFHLX",70,0)
 ;
"RTN","FBFHLX",71,0)
 S FBXMIT("SEND")=$$NOW^XLFDT()
"RTN","FBFHLX",72,0)
 ;
"RTN","FBFHLX",73,0)
 I 'FBQUIT,$E(IOST,1,2)="C-" W !!,"Transmitting Pending Invoices..."
"RTN","FBFHLX",74,0)
 ; loop thru pending invoices and transmit
"RTN","FBFHLX",75,0)
 S FBQDA=0 F  S FBQDA=$O(^FBHL(163.5,"AC",0,FBQDA)) Q:'FBQDA!FBQUIT  D
"RTN","FBFHLX",76,0)
 . ; check for taskman quit request
"RTN","FBFHLX",77,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1,FBQUIT=1 Q
"RTN","FBFHLX",78,0)
 . S ^XTMP("FBFHLX","IEN")=$H_U_FBQDA_"^XMIT^"        ; FB*3.5*122
"RTN","FBFHLX",79,0)
 . ; try to transmit invoice
"RTN","FBFHLX",80,0)
 . D INVOICE
"RTN","FBFHLX",81,0)
 . ; update counters based on result
"RTN","FBFHLX",82,0)
 . I FBERR S FBCNT("PENDE")=FBCNT("PENDE")+1
"RTN","FBFHLX",83,0)
 . E  S FBCNT("PENDT")=FBCNT("PENDT")+1
"RTN","FBFHLX",84,0)
 . I FBCNT("PENDE")+FBCNT("PENDT")>9999 S (FBCNT("10K"),FBQUIT)=1  ; FB*3.5*121
"RTN","FBFHLX",85,0)
 ;
"RTN","FBFHLX",86,0)
 ; save time that process ended
"RTN","FBFHLX",87,0)
 S FBXMIT("END")=$$NOW^XLFDT()
"RTN","FBFHLX",88,0)
 I $E(IOST,1,2)="C-" W !!,"Process complete. Sending Summary Message to G.FEE..."
"RTN","FBFHLX",89,0)
 D TIME^FBFHLX2("END",FBXMIT("END"))  ; FB*3.5*121
"RTN","FBFHLX",90,0)
 ;
"RTN","FBFHLX",91,0)
 ; build and send summary mail message to G.FEE
"RTN","FBFHLX",92,0)
 D SUMMSG^FBFHLX1
"RTN","FBFHLX",93,0)
 ;
"RTN","FBFHLX",94,0)
 ; clean-up
"RTN","FBFHLX",95,0)
 K ^TMP($J,"FBE"),^TMP($J,"FBNA"),^TMP($J,"FBW"),^TMP($J,"FBX")
"RTN","FBFHLX",96,0)
 ;
"RTN","FBFHLX",97,0)
 Q
"RTN","FBFHLX",98,0)
 ;
"RTN","FBFHLX",99,0)
BYINV ; Transmit Selected Invoices (interactive)
"RTN","FBFHLX",100,0)
 ;
"RTN","FBFHLX",101,0)
 N FBAAIN,FBERR,FBHL,FBQDA,FBSTA,FBTTYP,FBX,HLFS,HLECH
"RTN","FBFHLX",102,0)
 ;
"RTN","FBFHLX",103,0)
 ; initialize HL variables
"RTN","FBFHLX",104,0)
 D INIT^HLFNC2("FB FEE TO FPPS EVENT",.FBHL)
"RTN","FBFHLX",105,0)
 I $G(FBHL) D  Q
"RTN","FBFHLX",106,0)
 . W !,$C(7),"ERROR: Couldn't initialize HL variables!"
"RTN","FBFHLX",107,0)
 . W !,FBHL
"RTN","FBFHLX",108,0)
 S HLFS=FBHL("FS")
"RTN","FBFHLX",109,0)
 S HLECH=FBHL("ECH")
"RTN","FBFHLX",110,0)
 ;
"RTN","FBFHLX",111,0)
 ; select invoice
"RTN","FBFHLX",112,0)
 F  Q:FBQUIT  D
"RTN","FBFHLX",113,0)
 . S DIC="^FBHL(163.5,",DIC(0)="AEQM"
"RTN","FBFHLX",114,0)
 . D ^DIC I Y'>0 S FBQUIT=1 Q
"RTN","FBFHLX",115,0)
 . S FBQDA=+Y
"RTN","FBFHLX",116,0)
 . ;
"RTN","FBFHLX",117,0)
 . ; get invoice number and switch to last entry for invoice
"RTN","FBFHLX",118,0)
 . S FBAAIN=$P($G(^FBHL(163.5,FBQDA,0)),U)
"RTN","FBFHLX",119,0)
 . S FBQDA=$$LAST^FBFHLU(FBAAIN)
"RTN","FBFHLX",120,0)
 . I 'FBQDA W !,"Error, invalid data for invoice ",FBAAIN," in file 163.5" Q
"RTN","FBFHLX",121,0)
 . S FBQY=$G(^FBHL(163.5,FBQDA,0))
"RTN","FBFHLX",122,0)
 . ;
"RTN","FBFHLX",123,0)
 . ; confirm
"RTN","FBFHLX",124,0)
 . S FBX=$S($P(FBQY,U,3)=0:"",1:"re-")
"RTN","FBFHLX",125,0)
 . S DIR(0)="Y"
"RTN","FBFHLX",126,0)
 . S DIR("A")="Do you want to "_FBX_"transmit invoice "_FBAAIN
"RTN","FBFHLX",127,0)
 . D ^DIR K DIR S:$D(DIRUT) FBQUIT=1 I 'Y Q
"RTN","FBFHLX",128,0)
 . ;
"RTN","FBFHLX",129,0)
 . ; if re-transmit then create a new pending entry for invoice
"RTN","FBFHLX",130,0)
 . I FBX="re-" D
"RTN","FBFHLX",131,0)
 . . D FILEQUE^FBFHLL(FBAAIN,$P(FBQY,U,2))
"RTN","FBFHLX",132,0)
 . . S FBQDA=$$LAST^FBFHLU(FBAAIN)
"RTN","FBFHLX",133,0)
 . . I FBQDA S FBQY=$G(^FBHL(163.5,FBQDA,0))
"RTN","FBFHLX",134,0)
 . . E  S FBQY=""
"RTN","FBFHLX",135,0)
 . ;
"RTN","FBFHLX",136,0)
 . ; check that pending entry was added
"RTN","FBFHLX",137,0)
 . I FBX="re-",$P(FBQY,U,3)'=0 D  Q
"RTN","FBFHLX",138,0)
 . . W !,"Error adding entry to file 163.5. Can't re-transmit invoice."
"RTN","FBFHLX",139,0)
 . ;
"RTN","FBFHLX",140,0)
 . ; transmit specified invoice
"RTN","FBFHLX",141,0)
 . D INVOICE
"RTN","FBFHLX",142,0)
 . ;
"RTN","FBFHLX",143,0)
 . ; report success or failure of transmit
"RTN","FBFHLX",144,0)
 . I FBERR=0 W !,"Invoice has been transmitted to the HL7 package.",!!
"RTN","FBFHLX",145,0)
 . I FBERR=1 D
"RTN","FBFHLX",146,0)
 . . N FBL
"RTN","FBFHLX",147,0)
 . . W $C(7),!,"Problems prevented transmission of the invoice."
"RTN","FBFHLX",148,0)
 . . S FBL=0 F  S FBL=$O(^TMP($J,"FBE",FBAAIN,FBL)) Q:'FBL  D
"RTN","FBFHLX",149,0)
 . . . W !,"  ",$G(^TMP($J,"FBE",FBAAIN,FBL))
"RTN","FBFHLX",150,0)
 . . W !
"RTN","FBFHLX",151,0)
 . ;
"RTN","FBFHLX",152,0)
 . ; clean up after transmit
"RTN","FBFHLX",153,0)
 . K ^TMP($J,"FBE",FBAAIN)
"RTN","FBFHLX",154,0)
 . K ^TMP($J,"FBW",FBAAIN)
"RTN","FBFHLX",155,0)
 ;
"RTN","FBFHLX",156,0)
 Q
"RTN","FBFHLX",157,0)
 ;
"RTN","FBFHLX",158,0)
INVOICE ; transmit invoice
"RTN","FBFHLX",159,0)
 ; input
"RTN","FBFHLX",160,0)
 ;   FBQDA - ien of entry in file 163.5 to transmit, required
"RTN","FBFHLX",161,0)
 ; output
"RTN","FBFHLX",162,0)
 ;   FBERR - error flag (0 or 1), true if error prevented transmit
"RTN","FBFHLX",163,0)
 ;   FBSTA  - station number in transmitted message (may be null if err)
"RTN","FBFHLX",164,0)
 ;   FBTTYP - transaction type in transmitted message (may be null)
"RTN","FBFHLX",165,0)
 ;   ^TMP($J,"FBE",invoice number,#) - any exceptions
"RTN","FBFHLX",166,0)
 ;   ^TMP($J,"FBW",invoice number,#) - any warnings
"RTN","FBFHLX",167,0)
 ;
"RTN","FBFHLX",168,0)
 ; N FBAAIN,FBD,FBFILE,FBRESULT,FBQY
"RTN","FBFHLX",169,0)
 ;
"RTN","FBFHLX",170,0)
 ; initialize
"RTN","FBFHLX",171,0)
 S FBERR=0
"RTN","FBFHLX",172,0)
 S FBSTA=""
"RTN","FBFHLX",173,0)
 S FBTTYP=""
"RTN","FBFHLX",174,0)
 ;
"RTN","FBFHLX",175,0)
 ; check for required input
"RTN","FBFHLX",176,0)
 I '$G(FBQDA) S FBERR=1 Q
"RTN","FBFHLX",177,0)
 ;
"RTN","FBFHLX",178,0)
 ; lock record
"RTN","FBFHLX",179,0)
 L +^FBHL(163.5,FBQDA):10
"RTN","FBFHLX",180,0)
 I '$T D  Q
"RTN","FBFHLX",181,0)
 . S FBERR=1
"RTN","FBFHLX",182,0)
 . S FBAAIN=+$P($G(^FBHL(163.5,FBQDA,0)),U)
"RTN","FBFHLX",183,0)
 . I FBAAIN D POST^FBFHLU(FBAAIN,"E","Couldn't Lock Entry "_FBQDA_" in File 163.5.")
"RTN","FBFHLX",184,0)
 ;
"RTN","FBFHLX",185,0)
 ; get invoice number and file number
"RTN","FBFHLX",186,0)
 I 'FBERR D
"RTN","FBFHLX",187,0)
 . N FBQY
"RTN","FBFHLX",188,0)
 . S FBQY=$G(^FBHL(163.5,FBQDA,0))
"RTN","FBFHLX",189,0)
 . S FBAAIN=+$P(FBQY,U)
"RTN","FBFHLX",190,0)
 . I 'FBAAIN D
"RTN","FBFHLX",191,0)
 . . S FBERR=1
"RTN","FBFHLX",192,0)
 . . D POST^FBFHLU(0,"E","Couldn't determine invoice # for entry "_FBQDA_" in file 163.5.")
"RTN","FBFHLX",193,0)
 . Q:FBERR
"RTN","FBFHLX",194,0)
 . S FBFILE=$P(FBQY,U,2)
"RTN","FBFHLX",195,0)
 . I "^3^5^9^"'[(U_FBFILE_U) D
"RTN","FBFHLX",196,0)
 . . S FBERR=1
"RTN","FBFHLX",197,0)
 . . D POST^FBFHLU(FBAAIN,"E","Invalid File # for entry "_FBQDA_" in file 163.5.")
"RTN","FBFHLX",198,0)
 ;
"RTN","FBFHLX",199,0)
 ; gather invoice data
"RTN","FBFHLX",200,0)
 I 'FBERR D @("EN^FBFHLD"_FBFILE) I $D(^TMP($J,"FBE",FBAAIN)) S FBERR=1
"RTN","FBFHLX",201,0)
 S FBTTYP=$P($G(FBD(0,"INV")),U,2)
"RTN","FBFHLX",202,0)
 S FBSTA=$P($G(FBD(0,"INV")),U,3)
"RTN","FBFHLX",203,0)
 ;
"RTN","FBFHLX",204,0)
 ; build HL segments
"RTN","FBFHLX",205,0)
 I 'FBERR D EN^FBFHLS I $D(^TMP($J,"FBE",FBAAIN)) S FBERR=1
"RTN","FBFHLX",206,0)
 ;
"RTN","FBFHLX",207,0)
 ; generate HL message
"RTN","FBFHLX",208,0)
 I 'FBERR D
"RTN","FBFHLX",209,0)
 . K FBRESULT
"RTN","FBFHLX",210,0)
 . D GENERATE^HLMA("FB FEE TO FPPS EVENT","GM",1,.FBRESULT)
"RTN","FBFHLX",211,0)
 . I +$P(FBRESULT,U,2) D
"RTN","FBFHLX",212,0)
 . . S FBERR=1
"RTN","FBFHLX",213,0)
 . . D POST^FBFHLU(FBAAIN,"E","HL ERR:"_$P(FBRESULT,U,3))
"RTN","FBFHLX",214,0)
 ;
"RTN","FBFHLX",215,0)
 ; update file 163.5
"RTN","FBFHLX",216,0)
 I 'FBERR D
"RTN","FBFHLX",217,0)
 . N FBFDA
"RTN","FBFHLX",218,0)
 . S FBFDA(163.5,FBQDA_",",2)="1" ; set status = transmitted
"RTN","FBFHLX",219,0)
 . S FBFDA(163.5,FBQDA_",",3)=$P(FBRESULT,U) ; message ID
"RTN","FBFHLX",220,0)
 . S FBFDA(163.5,FBQDA_",",4)=$$NOW^XLFDT() ; message date/time
"RTN","FBFHLX",221,0)
 . S FBFDA(163.5,FBQDA_",",5)=FBTTYP ; transaction type
"RTN","FBFHLX",222,0)
 . S FBFDA(163.5,FBQDA_",",6)=FBSTA ; station number
"RTN","FBFHLX",223,0)
 . I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBFHLX",224,0)
 . ;
"RTN","FBFHLX",225,0)
 . ; store HL segments in word-processing field
"RTN","FBFHLX",226,0)
 . D MOVEHL
"RTN","FBFHLX",227,0)
 . D WP^DIE(163.5,FBQDA_",",7,"","^TMP($J,""FBHLSEG"")")
"RTN","FBFHLX",228,0)
 . K ^TMP($J,"FBHLSEG")
"RTN","FBFHLX",229,0)
 ;
"RTN","FBFHLX",230,0)
 ; unlock record
"RTN","FBFHLX",231,0)
 L -^FBHL(163.5,FBQDA)
"RTN","FBFHLX",232,0)
 ;
"RTN","FBFHLX",233,0)
 ; clean-up
"RTN","FBFHLX",234,0)
 K ^TMP("HLS",$J)
"RTN","FBFHLX",235,0)
 Q
"RTN","FBFHLX",236,0)
 ;
"RTN","FBFHLX",237,0)
MOVEHL ; Copy HL segment data into word-processing style array
"RTN","FBFHLX",238,0)
 ; input
"RTN","FBFHLX",239,0)
 ; ^TMP("HLS",$J, array
"RTN","FBFHLX",240,0)
 ; output
"RTN","FBFHLX",241,0)
 ; ^TMP($J,"HLSEG",#)=line of text
"RTN","FBFHLX",242,0)
 ;  there will be a blank line after each segment
"RTN","FBFHLX",243,0)
 ;
"RTN","FBFHLX",244,0)
 N FBI,FBII,FBL
"RTN","FBFHLX",245,0)
 K ^TMP($J,"FBHLSEG")
"RTN","FBFHLX",246,0)
 S FBL=0
"RTN","FBFHLX",247,0)
 S FBI=0 F  S FBI=$O(^TMP("HLS",$J,FBI)) Q:'FBI  D
"RTN","FBFHLX",248,0)
 . S FBL=FBL+1,^TMP($J,"FBHLSEG",FBL)=$G(^TMP("HLS",$J,FBI))
"RTN","FBFHLX",249,0)
 . S FBII=0 F  S FBII=$O(^TMP("HLS",$J,FBI,FBII)) Q:'FBII  D
"RTN","FBFHLX",250,0)
 . . S FBL=FBL+1,^TMP($J,"FBHLSEG",FBL)=$G(^TMP("HLS",$J,FBI,FBII))
"RTN","FBFHLX",251,0)
 . S FBL=FBL+1,^TMP($J,"FBHLSEG",FBL)=""
"RTN","FBFHLX",252,0)
 Q
"RTN","FBFHLX",253,0)
 ;
"RTN","FBFHLX",254,0)
 ;FBFHLX
"RTN","FBFHLX1")
0^10^B30972593^B30458874
"RTN","FBFHLX1",1,0)
FBFHLX1 ;WOIFO/SAB-TRANSMIT HL7 MESSAGES TO FPPS (CON'T) ;9/9/2003
"RTN","FBFHLX1",2,0)
 ;;3.5;FEE BASIS;**61,121,122**;JAN 30 1995;Build 8
"RTN","FBFHLX1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBFHLX1",4,0)
 Q
"RTN","FBFHLX1",5,0)
 ;
"RTN","FBFHLX1",6,0)
CHKACK ; check for acknowledgements
"RTN","FBFHLX1",7,0)
 ; input  - none
"RTN","FBFHLX1",8,0)
 ; output
"RTN","FBFHLX1",9,0)
 ;   FBCNT("ACKT") - count of previously transmitted invoices w/o ack
"RTN","FBFHLX1",10,0)
 ;   FBCNT("ACKA") - count of these that were accepted
"RTN","FBFHLX1",11,0)
 ;   FBCNT("ACKR") - count of these that were rejected
"RTN","FBFHLX1",12,0)
 ;   FBCNT("ACKW") - count of these that are still waiting for ack
"RTN","FBFHLX1",13,0)
 ;   ^TMP($J,"FBNA",invoice number)="" - list waiting for ack
"RTN","FBFHLX1",14,0)
 ;   update file 163.5
"RTN","FBFHLX1",15,0)
 N FBAAIN,FBMSGID,FBQDA,FBQY,FBSTATUS,FBX
"RTN","FBFHLX1",16,0)
 ;
"RTN","FBFHLX1",17,0)
 ; initialize
"RTN","FBFHLX1",18,0)
 K ^TMP($J,"FBNA")
"RTN","FBFHLX1",19,0)
 F FBX="ACKA","ACKR","ACKW" S FBCNT(FBX)=0
"RTN","FBFHLX1",20,0)
 ;
"RTN","FBFHLX1",21,0)
 ; loop thru transmitted (not yet acknowledged entries)
"RTN","FBFHLX1",22,0)
 S FBQDA=0  F  S FBQDA=$O(^FBHL(163.5,"AC",1,FBQDA)) Q:'FBQDA  D
"RTN","FBFHLX1",23,0)
 . S ^XTMP("FBFHLX","IEN")=$H_U_FBQDA_"^NYACK^"   ; FB*3.5*122
"RTN","FBFHLX1",24,0)
 . S FBQY=$G(^FBHL(163.5,FBQDA,0))
"RTN","FBFHLX1",25,0)
 . S FBAAIN=$P(FBQY,U)
"RTN","FBFHLX1",26,0)
 . Q:FBAAIN=""  ; invalid invoice number
"RTN","FBFHLX1",27,0)
 . S FBMSGID=$P(FBQY,U,4)
"RTN","FBFHLX1",28,0)
 . Q:FBMSGID=""
"RTN","FBFHLX1",29,0)
 . ;
"RTN","FBFHLX1",30,0)
 . S FBSTATUS=$$MSGSTAT^HLUTIL(FBMSGID)
"RTN","FBFHLX1",31,0)
 . ;
"RTN","FBFHLX1",32,0)
 . I $P(FBSTATUS,U)=3 D  Q
"RTN","FBFHLX1",33,0)
 . . N FBFDA
"RTN","FBFHLX1",34,0)
 . . S FBFDA(163.5,FBQDA_",",2)="2" ; set status = acknowledged
"RTN","FBFHLX1",35,0)
 . . S FBFDA(163.5,FBQDA_",",8)="A" ; set ACK FLAG = ACCEPTED
"RTN","FBFHLX1",36,0)
 . . S FBFDA(163.5,FBQDA_",",9)=$P(FBSTATUS,U,2) ; set ACK DATE/TIME
"RTN","FBFHLX1",37,0)
 . . I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBFHLX1",38,0)
 . . S FBCNT("ACKA")=FBCNT("ACKA")+1
"RTN","FBFHLX1",39,0)
 . ;
"RTN","FBFHLX1",40,0)
 . I $P(FBSTATUS,U)=4 D  Q
"RTN","FBFHLX1",41,0)
 . . N FBFDA,FBTXT
"RTN","FBFHLX1",42,0)
 . . S FBFDA(163.5,FBQDA_",",2)="2" ; set status = acknowledged
"RTN","FBFHLX1",43,0)
 . . S FBFDA(163.5,FBQDA_",",8)="R" ; set ACK FLAG = rejected
"RTN","FBFHLX1",44,0)
 . . S FBFDA(163.5,FBQDA_",",9)=$P(FBSTATUS,U,2) ; set ACK DATE/TIME
"RTN","FBFHLX1",45,0)
 . . S FBFDA(163.5,FBQDA_",",10)="N" ; rej status = not reported
"RTN","FBFHLX1",46,0)
 . . I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBFHLX1",47,0)
 . . S FBTXT(1)=$P(FBSTATUS,U,3)
"RTN","FBFHLX1",48,0)
 . . I FBTXT(1)]"" D WP^DIE(163.5,FBQDA_",",11,"","FBTXT") ; error msg
"RTN","FBFHLX1",49,0)
 . . S FBCNT("ACKR")=FBCNT("ACKR")+1
"RTN","FBFHLX1",50,0)
 . ;
"RTN","FBFHLX1",51,0)
 . ; don't report not acknowledged unless it is last entry for invoice
"RTN","FBFHLX1",52,0)
 . Q:$$LAST^FBFHLU($P(FBQY,U))'=FBQDA
"RTN","FBFHLX1",53,0)
 . ;
"RTN","FBFHLX1",54,0)
 . ; last entry for invoice was not acknowledged yet
"RTN","FBFHLX1",55,0)
 . S ^TMP($J,"FBNA",FBAAIN)=""
"RTN","FBFHLX1",56,0)
 . S FBCNT("ACKW")=FBCNT("ACKW")+1
"RTN","FBFHLX1",57,0)
 ;
"RTN","FBFHLX1",58,0)
 S FBCNT("ACKT")=FBCNT("ACKA")+FBCNT("ACKR")+FBCNT("ACKW")
"RTN","FBFHLX1",59,0)
 ;
"RTN","FBFHLX1",60,0)
 Q
"RTN","FBFHLX1",61,0)
 ;
"RTN","FBFHLX1",62,0)
SUMMSG ; Summary Message (build and send)
"RTN","FBFHLX1",63,0)
 ; input
"RTN","FBFHLX1",64,0)
 ;   ^TMP($J,"FBE",invoice number,seq number)=error text
"RTN","FBFHLX1",65,0)
 ;   ^TMP($J,"FBW",invoice number,seq number)=warning text
"RTN","FBFHLX1",66,0)
 ;   ^TMP($J,"FBNA",invoice number)="" for invoices not acknowledged
"RTN","FBFHLX1",67,0)
 ;   ^TMP($J,"FBX",seq number)=message text so far
"RTN","FBFHLX1",68,0)
 ;   FBXL = last line used in ^TMP($J,"FBX",seq number)
"RTN","FBFHLX1",69,0)
 ;   FBXMIT("START") = start process, FileMan date/time
"RTN","FBFHLX1",70,0)
 ;   FBXMIT("ACK") = start check for acks, FileMan date/time
"RTN","FBFHLX1",71,0)
 ;   FBXMIT("SEND") = start transmit, FileMan date/time
"RTN","FBFHLX1",72,0)
 ;   FBXMIT("END") = end process, FileMan date/time
"RTN","FBFHLX1",73,0)
 ;   FBCNT("PENDT")= count of pending invoices that were transmitted
"RTN","FBFHLX1",74,0)
 ;   FBCNT("PENDE")= count of pending invoices that had exception
"RTN","FBFHLX1",75,0)
 ;   FBCNT("ACKT") = count of previously transmitted invoices w/o ack
"RTN","FBFHLX1",76,0)
 ;   FBCNT("ACKA") = count of these that were accepted
"RTN","FBFHLX1",77,0)
 ;   FBCNT("ACKR") = count of these that were rejected
"RTN","FBFHLX1",78,0)
 ;   FBCNT("ACKW") = count of these that are still waiting for ack
"RTN","FBFHLX1",79,0)
 ; output
"RTN","FBFHLX1",80,0)
 ;   ^TMP($J,"FBX",
"RTN","FBFHLX1",81,0)
 ;   mail message
"RTN","FBFHLX1",82,0)
 ;
"RTN","FBFHLX1",83,0)
 N XMDUZ,XMSUB,XMTEXT,XMY,XMZ
"RTN","FBFHLX1",84,0)
 ;
"RTN","FBFHLX1",85,0)
 ; add header text
"RTN","FBFHLX1",86,0)
 S ^TMP($J,"FBX",1)=$$FMTE^XLFDT(FBXMIT("START"))_"  Process Started."
"RTN","FBFHLX1",87,0)
 S ^TMP($J,"FBX",2)=$$FMTE^XLFDT(FBXMIT("ACK"))_"  Check transmitted messages for acknowledgement..."
"RTN","FBFHLX1",88,0)
 S ^TMP($J,"FBX",3)="                       "_FBCNT("ACKT")_" previously transmitted messages w/o ack."
"RTN","FBFHLX1",89,0)
 S ^TMP($J,"FBX",4)="                       "_FBCNT("ACKA")_" of these were accepted."
"RTN","FBFHLX1",90,0)
 S ^TMP($J,"FBX",5)="                       "_FBCNT("ACKR")_" of these were rejected."
"RTN","FBFHLX1",91,0)
 S ^TMP($J,"FBX",6)="                       "_FBCNT("ACKW")_" of these still waiting for ack."
"RTN","FBFHLX1",92,0)
 S ^TMP($J,"FBX",7)=$$FMTE^XLFDT(FBXMIT("SEND"))_"  Transmit pending invoices..."
"RTN","FBFHLX1",93,0)
 S ^TMP($J,"FBX",8)="                       "_FBCNT("PENDT")_" transmitted."
"RTN","FBFHLX1",94,0)
 S ^TMP($J,"FBX",9)="                       "_FBCNT("PENDE")_" not transmitted due to exception."
"RTN","FBFHLX1",95,0)
 S ^TMP($J,"FBX",10)=$$FMTE^XLFDT(FBXMIT("END"))_"  Process Complete."
"RTN","FBFHLX1",96,0)
 I $D(ZTSTOP) S ^TMP($J,"FBX",11)="  Process (task) stopped due to user request."
"RTN","FBFHLX1",97,0)
 I $D(FBCNT("10K")) S ^TMP($J,"FBX",12)="  Process (task) stopped due to reaching 10K message limit."  ; FB*3.5*121
"RTN","FBFHLX1",98,0)
 ;
"RTN","FBFHLX1",99,0)
 ; List Exceptions
"RTN","FBFHLX1",100,0)
 I FBCNT("PENDE")>0 D
"RTN","FBFHLX1",101,0)
 . N FBAAIN,FBL,FBX
"RTN","FBFHLX1",102,0)
 . D PTXT(.FBXL," ")
"RTN","FBFHLX1",103,0)
 . D PTXT(.FBXL,"List of Exceptions during Transmit of Pending Invoices")
"RTN","FBFHLX1",104,0)
 . S FBAAIN="" F  S FBAAIN=$O(^TMP($J,"FBE",FBAAIN)) Q:FBAAIN=""  D
"RTN","FBFHLX1",105,0)
 . . D PTXT(.FBXL,"Invoice: "_FBAAIN)
"RTN","FBFHLX1",106,0)
 . . S FBL=0 F  S FBL=$O(^TMP($J,"FBE",FBAAIN,FBL)) Q:'FBL  D
"RTN","FBFHLX1",107,0)
 . . . S FBX=$G(^TMP($J,"FBE",FBAAIN,FBL))
"RTN","FBFHLX1",108,0)
 . . . I FBX]"" D PTXT(.FBXL,"  "_FBX)
"RTN","FBFHLX1",109,0)
 ;
"RTN","FBFHLX1",110,0)
 ; List Invoices Waiting for Ack
"RTN","FBFHLX1",111,0)
 I FBCNT("ACKW")>0 D
"RTN","FBFHLX1",112,0)
 . N FBAAIN
"RTN","FBFHLX1",113,0)
 . D PTXT(.FBXL," ")
"RTN","FBFHLX1",114,0)
 . D PTXT(.FBXL,"List of Invoices Waiting for Acknowledgement")
"RTN","FBFHLX1",115,0)
 . S FBAAIN="" F  S FBAAIN=$O(^TMP($J,"FBW",FBAAIN)) Q:FBAAIN=""  D
"RTN","FBFHLX1",116,0)
 . . D PTXT(.FBXL,"Invoice: "_FBAAIN)
"RTN","FBFHLX1",117,0)
 ;
"RTN","FBFHLX1",118,0)
 ; Report Rejected Acks
"RTN","FBFHLX1",119,0)
 I $D(^FBHL(163.5,"ARS","N")) D
"RTN","FBFHLX1",120,0)
 . N FBAAIN,FBFDA,FBI,FBQDA,FBTXT,FBWP,FBX
"RTN","FBFHLX1",121,0)
 . D PTXT(.FBXL," ")
"RTN","FBFHLX1",122,0)
 . D PTXT(.FBXL,"List of Rejected Invoices that have not been reported.")
"RTN","FBFHLX1",123,0)
 . S FBQDA=0 F  S FBQDA=$O(^FBHL(163.5,"ARS","N",FBQDA)) Q:'FBQDA  D
"RTN","FBFHLX1",124,0)
 . . S FBQY=$G(^FBHL(163.5,FBQDA,0))
"RTN","FBFHLX1",125,0)
 . . S FBAAIN=$P(FBQY,U)
"RTN","FBFHLX1",126,0)
 . . D PTXT(.FBXL,"Invoice: "_FBAAIN)
"RTN","FBFHLX1",127,0)
 . . ;
"RTN","FBFHLX1",128,0)
 . . K FBWP
"RTN","FBFHLX1",129,0)
 . . S FBX=$$GET1^DIQ(163.5,FBQDA_",",11,"","FBWP")
"RTN","FBFHLX1",130,0)
 . . S FBI=0 F  S FBI=$O(FBWP(FBI)) Q:'FBI  D
"RTN","FBFHLX1",131,0)
 . . . S FBTXT=FBWP(FBI)
"RTN","FBFHLX1",132,0)
 . . . D PTXT(.FBXL,"  "_FBTXT)
"RTN","FBFHLX1",133,0)
 . . ;
"RTN","FBFHLX1",134,0)
 . . K FBFDA
"RTN","FBFHLX1",135,0)
 . . S FBFDA(163,FBQDA_",",10)="R" ; set reject status = reported
"RTN","FBFHLX1",136,0)
 . . I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBFHLX1",137,0)
 ;
"RTN","FBFHLX1",138,0)
 D PTXT(.FBXL," ")
"RTN","FBFHLX1",139,0)
 D PTXT(.FBXL,"END OF SUMMARY MESSAGE")
"RTN","FBFHLX1",140,0)
 ;
"RTN","FBFHLX1",141,0)
 ; send message
"RTN","FBFHLX1",142,0)
 S XMSUB="FEE BASIS FPPS Transmit "_$$FMTE^XLFDT(FBXMIT("START"),"DF")
"RTN","FBFHLX1",143,0)
 S XMDUZ="FEE BASIS"
"RTN","FBFHLX1",144,0)
 S XMY("G.FEE")=""
"RTN","FBFHLX1",145,0)
 S XMTEXT="^TMP($J,""FBX"","
"RTN","FBFHLX1",146,0)
 D ^XMD
"RTN","FBFHLX1",147,0)
 Q
"RTN","FBFHLX1",148,0)
 ;
"RTN","FBFHLX1",149,0)
PTXT(FBXL,FBTXT) ; Post line of text in global array for summary message
"RTN","FBFHLX1",150,0)
 ; input
"RTN","FBFHLX1",151,0)
 ;   FBXL  - last line number used, passed by reference
"RTN","FBFHLX1",152,0)
 ;   FBTXT - line of text
"RTN","FBFHLX1",153,0)
 ; output
"RTN","FBFHLX1",154,0)
 ;   FBXL -  increments value by 1
"RTN","FBFHLX1",155,0)
 ;   ^TMP($J,"FBX",input line+1)=text
"RTN","FBFHLX1",156,0)
 ;
"RTN","FBFHLX1",157,0)
 S FBXL=FBXL+1
"RTN","FBFHLX1",158,0)
 S ^TMP($J,"FBX",FBXL)=FBTXT
"RTN","FBFHLX1",159,0)
 ;
"RTN","FBFHLX1",160,0)
 Q
"RTN","FBFHLX1",161,0)
 ;
"RTN","FBFHLX1",162,0)
 ;FBFHLX1
"RTN","FBFHLX2")
0^11^B5499281^n/a
"RTN","FBFHLX2",1,0)
FBFHLX2 ;DSS/LJF - VISTA FEE 5010 UPGRADE ;4/4/2011
"RTN","FBFHLX2",2,0)
 ;;3.5;FEE BASIS;**122**;JAN 30, 1995;Build 8
"RTN","FBFHLX2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBFHLX2",4,0)
 Q
"RTN","FBFHLX2",5,0)
 ;
"RTN","FBFHLX2",6,0)
TIME(FBTYPE,FBDTG,FBFTRACK) ;
"RTN","FBFHLX2",7,0)
 N FBFENFLD,FBFPARIX,FBFPROOT,FBFSTFLD,FBFINTER  ; set by $$INIT
"RTN","FBFHLX2",8,0)
 N FBFDA,FBFJOB,FBSTFLAG,FBFPURGE,FBFXTMP,FBF2RDTH
"RTN","FBFHLX2",9,0)
 S FBTYPE=$G(FBTYPE),FBDTG=+$G(FBDTG),ZTSK=+$G(ZTSK),FBFTRACK=1  I 'FBDTG Q
"RTN","FBFHLX2",10,0)
 K ZTDTH
"RTN","FBFHLX2",11,0)
 I '$$INIT^FBMON K FBFTRACK Q
"RTN","FBFHLX2",12,0)
 ;
"RTN","FBFHLX2",13,0)
 I FBTYPE="START" D  Q
"RTN","FBFHLX2",14,0)
 . I $$FACTIVE^FBMON(.FBFTRACK) D:'ZTSK INFORM^FBMON(1,FBFTRACK("START"),FBFTRACK("END"),FBFTRACK("STATE")) Q
"RTN","FBFHLX2",15,0)
 . ;
"RTN","FBFHLX2",16,0)
 . S FBFDA(FBFPROOT,FBFPARIX,FBFSTFLD)=FBDTG D FILE^DIE("","FBFDA") K FBFDA
"RTN","FBFHLX2",17,0)
 . S ^XTMP("FBFHLX",0)=$$FMADD^XLFDT(FBDTG,3)_U_FBDTG_U_" FB FPPS TRANSMIT active process status."
"RTN","FBFHLX2",18,0)
 . S ^XTMP("FBFHLX","IEN")=$H_"^0^INIT^"
"RTN","FBFHLX2",19,0)
 . S FBFTRACK=0
"RTN","FBFHLX2",20,0)
 ;
"RTN","FBFHLX2",21,0)
 I FBTYPE="END" D
"RTN","FBFHLX2",22,0)
 . K ^XTMP("FBFHLX")
"RTN","FBFHLX2",23,0)
 . S FBFDA(FBFPROOT,FBFPARIX,FBFENFLD)=FBDTG D FILE^DIE("","FBFDA") K FBFDA
"RTN","FBFHLX2",24,0)
 Q
"RTN","FBFHLX2",25,0)
 ;
"RTN","FBFHLX2",26,0)
SETITIME(FBSTRT,FBEND) ; Set specific times to FB TRANSMIT START & FB TRANSMIT END
"RTN","FBFHLX2",27,0)
 N FBFDA,FBFENFLD,FBFPARIX,FBFPROOT,FBFSTFLD,FBFINTER  ; set by $$INIT
"RTN","FBFHLX2",28,0)
 I '$$INIT^FBMON Q
"RTN","FBFHLX2",29,0)
 S FBSTRT=$G(FBSTRT,$$NOW^XLFDT),FBEND=$G(FBEND,$$NOW^XLFDT)
"RTN","FBFHLX2",30,0)
 I FBSTRT,FBEND
"RTN","FBFHLX2",31,0)
 I  I $$FMDIFF^XLFDT(FBSTRT,$$FMADD^XLFDT($$NOW^XLFDT,-4),1)<5,$$FMDIFF^XLFDT(FBSTRT,$$FMADD^XLFDT($$NOW^XLFDT,-4),1)>0  ;from now, up to 4 days ago
"RTN","FBFHLX2",32,0)
 I  I $$FMDIFF^XLFDT(FBEND,$$FMADD^XLFDT($$NOW^XLFDT,-4),1)<5,$$FMDIFF^XLFDT(FBEND,$$FMADD^XLFDT($$NOW^XLFDT,-4),1)>0
"RTN","FBFHLX2",33,0)
 E  Q
"RTN","FBFHLX2",34,0)
 S FBFDA(FBFPROOT,FBFPARIX,FBFSTFLD)=FBSTRT
"RTN","FBFHLX2",35,0)
 S FBFDA(FBFPROOT,FBFPARIX,FBFENFLD)=FBEND
"RTN","FBFHLX2",36,0)
 D FILE^DIE("","FBFDA") K FBFDA
"RTN","FBFHLX2",37,0)
 Q
"RTN","FBFHLX2",38,0)
 ;
"RTN","FBFHLX2",39,0)
 ;FBFHLX2
"RTN","FBMON")
0^13^B36112227^n/a
"RTN","FBMON",1,0)
FBMON ;DSS/LJF - VISTA FEE 5010 UPGRADE ;4/4/2011
"RTN","FBMON",2,0)
 ;;3.5;FEE BASIS;**122**;JAN 30, 1995;Build 8
"RTN","FBMON",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBMON",4,0)
 Q
"RTN","FBMON",5,0)
 ;
"RTN","FBMON",6,0)
INIT() ; Standard data items
"RTN","FBMON",7,0)
 ; N FBFENFLD,FBFPARIX,FBFPROOT,FBFSTFLD,FBFINTER  ; set by $$INIT
"RTN","FBMON",8,0)
 I $E($G(IOST),1,2)="C-" S FBFINTER=1  ; interactive flag
"RTN","FBMON",9,0)
 S FBFSTFLD=36,FBFENFLD=37,FBFPROOT=161.4,FBFPARIX=$O(^FBAA(FBFPROOT,0))_"," I 'FBFPARIX Q 0  ; FBFPARIX EG: "1234,"
"RTN","FBMON",10,0)
 Q 1
"RTN","FBMON",11,0)
 ;
"RTN","FBMON",12,0)
EN ; OPTION "FB FPPS MONITOR" entry point
"RTN","FBMON",13,0)
 N FBFSTAT
"RTN","FBMON",14,0)
 S ZTSK=+$G(ZTSK)
"RTN","FBMON",15,0)
 I 'ZTSK D FOREGRND Q
"RTN","FBMON",16,0)
 ; background process
"RTN","FBMON",17,0)
 S FBFSTAT=$$FACTIVE(.FBFSTAT)
"RTN","FBMON",18,0)
 I FBFSTAT("STATE")'="STALLED 2+ HOURS",FBFSTAT("STATE")'="STALLED 50+ HOURS" Q
"RTN","FBMON",19,0)
 D REPORTIT(.FBFSTAT) K ^XTMP("FBFHLX")
"RTN","FBMON",20,0)
 Q
"RTN","FBMON",21,0)
 ;
"RTN","FBMON",22,0)
FOREGRND ;
"RTN","FBMON",23,0)
 N FBFSTAT
"RTN","FBMON",24,0)
 S FBFSTAT=$$FACTIVE(.FBFSTAT)
"RTN","FBMON",25,0)
 I FBFSTAT("STATE")="INACTIVE" D INFORM(2,FBFSTAT("START"),FBFSTAT("END"),FBFSTAT("STATE"),,,,,,FBFSTAT) Q
"RTN","FBMON",26,0)
 I FBFSTAT("STATE")="ACTIVE" D INFORM(3,FBFSTAT("START"),FBFSTAT("END"),FBFSTAT("STATE"),FBFSTAT("UPDATE"),FBFSTAT("IEN"),,,,FBFSTAT) Q
"RTN","FBMON",27,0)
 I FBFSTAT("STATE")="STALLED 50+ HOURS" D INFORM(4,FBFSTAT("START"),FBFSTAT("END"),FBFSTAT("STATE"),,,,,,FBFSTAT) Q
"RTN","FBMON",28,0)
 I FBFSTAT("STATE")="STALLED 2+ HOURS" D INFORM(3,FBFSTAT("START"),FBFSTAT("END"),FBFSTAT("STATE"),FBFSTAT("UPDATE"),FBFSTAT("IEN"),,,,FBFSTAT) Q
"RTN","FBMON",29,0)
 D INFORM(,FBFSTAT("START"),FBFSTAT("END"),FBFSTAT("STATE"),FBFSTAT("UPDATE"),FBFSTAT("IEN"),,,,FBFSTAT)
"RTN","FBMON",30,0)
 Q
"RTN","FBMON",31,0)
 ;
"RTN","FBMON",32,0)
FACTIVE(FBFRET) ; Return active/inactive flag
"RTN","FBMON",33,0)
 N FBFDIFF,FBFXDA
"RTN","FBMON",34,0)
 S FBFRET="0^INACTIVE",FBFRET("STATE")="INACTIVE",(FBFRET("START"),FBFRET("UPDATE"),FBFRET("END"),FBFRET("IEN"))=""
"RTN","FBMON",35,0)
 I '$$INIT Q
"RTN","FBMON",36,0)
 D GETS^DIQ(FBFPROOT,FBFPARIX,FBFSTFLD_";"_FBFENFLD,"I","FBFXDA")
"RTN","FBMON",37,0)
 S FBFRET("START")=FBFXDA(FBFPROOT,FBFPARIX,FBFSTFLD,"I"),FBFRET("END")=FBFXDA(FBFPROOT,FBFPARIX,FBFENFLD,"I")
"RTN","FBMON",38,0)
 ; S^XTMP("FBFHLX","IEN")=$H_U_IEN_"^XMIT^"
"RTN","FBMON",39,0)
 S FBFRET("UPDATE")=$G(^XTMP("FBFHLX","IEN")),FBFRET("IEN")=$P(FBFRET("UPDATE"),U,2),FBFRET("UPDATE")=$P(FBFRET("UPDATE"),U)
"RTN","FBMON",40,0)
 I FBFRET("UPDATE") S FBFRET("UPDATE")=$$HTFM^XLFDT(FBFRET("UPDATE"))
"RTN","FBMON",41,0)
 I $$FMDIFF^XLFDT($$NOW^XLFDT,+FBFRET("START"),2)>180000 S FBFRET("STATE")="STALLED 50+ HOURS",FBFRET="0^STALLED 50+ HOURS"  Q FBFRET  ; 50 hours okay to start
"RTN","FBMON",42,0)
 ;
"RTN","FBMON",43,0)
 I FBFRET("END")'<FBFRET("START") Q FBFRET
"RTN","FBMON",44,0)
 I 'FBFRET("UPDATE"),FBFRET("END")'<FBFRET("START") Q FBFRET  ; no active FB FPPS TRANSMIT
"RTN","FBMON",45,0)
 ;
"RTN","FBMON",46,0)
 I FBFRET("UPDATE"),$$FMDIFF^XLFDT($$NOW^XLFDT,+FBFRET("UPDATE"),2)\3600 S FBFRET("STATE")="STALLED 2+ HOURS",FBFRET="1^STALLED"  Q FBFRET
"RTN","FBMON",47,0)
 S FBFRET="1^ACTIVE",FBFRET("STATE")="ACTIVE"
"RTN","FBMON",48,0)
 Q FBFRET
"RTN","FBMON",49,0)
 ;
"RTN","FBMON",50,0)
REPORTIT(FBFARG1) ;
"RTN","FBMON",51,0)
 ;  ;FBFARG1 
"RTN","FBMON",52,0)
 N XMSUB,XMDUZ,XMY,MTEXT,XMTEXT,FBMG,FBMG1
"RTN","FBMON",53,0)
 S FBFARG1="FEE5010",FBFARG1("START")=$G(FBFARG1("START")),FBFARG1("END")=$G(FBFARG1("END"))
"RTN","FBMON",54,0)
 S FBFARG1("UPDATE")=$G(FBFARG1("UPDATE")),FBFARG1("IEN")=$G(FBFARG1("IEN")),FBFARG1("STATE")=$G(FBFARG1("STATE"))
"RTN","FBMON",55,0)
 K ^TMP($J,FBFARG1)
"RTN","FBMON",56,0)
 S ^TMP($J,FBFARG1,1)="            ** FB FPPS MONITOR **"
"RTN","FBMON",57,0)
 S ^TMP($J,FBFARG1,2)=""
"RTN","FBMON",58,0)
 S ^TMP($J,FBFARG1,3)="      Current date: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","FBMON",59,0)
 S ^TMP($J,FBFARG1,4)=""
"RTN","FBMON",60,0)
 S ^TMP($J,FBFARG1,5)="  The FB FPPS TRANSMIT option has not run."
"RTN","FBMON",61,0)
 S ^TMP($J,FBFARG1,6)="  Last started:          "_$$FMTE^XLFDT(FBFARG1("START"))
"RTN","FBMON",62,0)
 S ^TMP($J,FBFARG1,7)="  Last completed:        "_$$FMTE^XLFDT(FBFARG1("END"))
"RTN","FBMON",63,0)
 S ^TMP($J,FBFARG1,8)="  Last update:           "_$$FMTE^XLFDT(FBFARG1("UPDATE"))
"RTN","FBMON",64,0)
 S ^TMP($J,FBFARG1,9)="  Last record processed: "_FBFARG1("IEN")
"RTN","FBMON",65,0)
 S ^TMP($J,FBFARG1,10)="  The current status is: "_FBFARG1("STATE")
"RTN","FBMON",66,0)
 S ^TMP($J,FBFARG1,11)=""
"RTN","FBMON",67,0)
 S ^TMP($J,FBFARG1,12)="  Please check the FB FPPS TRANSMIT option for scheduling issues or errors."
"RTN","FBMON",68,0)
 ;
"RTN","FBMON",69,0)
 S XMSUB="FEE BASIS FPPS Transmit Issue"
"RTN","FBMON",70,0)
 S XMDUZ=.5
"RTN","FBMON",71,0)
 S XMY("G.FEE")=""
"RTN","FBMON",72,0)
 S XMTEXT="^TMP($J,"""_FBFARG1_""","
"RTN","FBMON",73,0)
 D ^XMD
"RTN","FBMON",74,0)
 K ^TMP($J,FBFARG1)
"RTN","FBMON",75,0)
 ;
"RTN","FBMON",76,0)
 S ^TMP($J,FBFARG1,1)="Site: "_$TR($P($$SITE^VASITE,U,1,2),U," ")
"RTN","FBMON",77,0)
 S ^TMP($J,FBFARG1,2)=""
"RTN","FBMON",78,0)
 S ^TMP($J,FBFARG1,3)="Current date: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","FBMON",79,0)
 S ^TMP($J,FBFARG1,4)="The FB FPPS TRANSMIT option has not run."
"RTN","FBMON",80,0)
 S ^TMP($J,FBFARG1,5)="The last completed transmission was on "_$$FMTE^XLFDT(FBFARG1("END"))
"RTN","FBMON",81,0)
 S ^TMP($J,FBFARG1,6)=""
"RTN","FBMON",82,0)
 S ^TMP($J,FBFARG1,7)="Local site recipients of this message are:"
"RTN","FBMON",83,0)
 D FIND^DIC(3.8,,"@;.01","BOX","FEE",1,"B",,,"FBMG")
"RTN","FBMON",84,0)
 I $G(FBMG("DILIST","2",1)) D GETS^DIQ(3.8,FBMG("DILIST","2",1),"2*","IN","FBMG1") S XMDUZ=0 F  S XMDUZ=$O(FBMG1("3.81",XMDUZ)) Q:XMDUZ=""  D
"RTN","FBMON",85,0)
 . S XMSUB=$$GET1^DIQ(200,+FBMG1("3.81",XMDUZ,".01","I"),.01)
"RTN","FBMON",86,0)
 . I XMSUB]"" S ^TMP($J,FBFARG1,"7."_+FBMG1("3.81",XMDUZ,".01","I"))=XMSUB
"RTN","FBMON",87,0)
 S ^TMP($J,FBFARG1,8)=""
"RTN","FBMON",88,0)
 S ^TMP($J,FBFARG1,9)=""
"RTN","FBMON",89,0)
 S ^TMP($J,FBFARG1,10)="Please contact the local site for scheduling issues or errors with this option."
"RTN","FBMON",90,0)
 ;
"RTN","FBMON",91,0)
 S XMSUB="FPPS Transmit Issue "_$P($$SITE^VASITE,U,2)
"RTN","FBMON",92,0)
 S XMDUZ=.5
"RTN","FBMON",93,0)
 S XMY("Fee.EDI_Issues@va.gov")=""
"RTN","FBMON",94,0)
 S XMTEXT="^TMP($J,"""_FBFARG1_""","
"RTN","FBMON",95,0)
 D ^XMD
"RTN","FBMON",96,0)
 Q
"RTN","FBMON",97,0)
 ;
"RTN","FBMON",98,0)
 ;  FBFARG1 .eqs. message to display FBFARG2...FBFARGn .eqs. arguments for particular display
"RTN","FBMON",99,0)
INFORM(FBFARG1,FBFARG2,FBFARG3,FBFARG4,FBFARG5,FBFARG6,FBFARG7,FBFARG8,FBFARG9,FBFARG10) ;
"RTN","FBMON",100,0)
 N DIR,DIRUT,X,Y
"RTN","FBMON",101,0)
 S FBFARG1=$G(FBFARG1),FBFARG2=$G(FBFARG2),FBFARG3=$G(FBFARG3),FBFARG4=$G(FBFARG4),FBFARG5=$G(FBFARG5)
"RTN","FBMON",102,0)
 S FBFARG6=$G(FBFARG6),FBFARG7=$G(FBFARG7),FBFARG8=$G(FBFARG8),FBFARG9=$G(FBFARG9),FBFARG10=$G(FBFARG10)
"RTN","FBMON",103,0)
 S DIR("A")="Press return to continue"
"RTN","FBMON",104,0)
 S DIR(0)="FO"
"RTN","FBMON",105,0)
 S DIR("A",.1)=""
"RTN","FBMON",106,0)
 S DIR("A",.11)="          -------------------------------------------------"
"RTN","FBMON",107,0)
 S DIR("A",.12)=""
"RTN","FBMON",108,0)
 S DIR("A",.2)="                    ** FB FPPS MONITOR **"
"RTN","FBMON",109,0)
 S DIR("A",.3)=""
"RTN","FBMON",110,0)
 S DIR("A",.4)="           The current time is: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","FBMON",111,0)
 S DIR("A",.5)=""
"RTN","FBMON",112,0)
 S DIR("A",.6)=""
"RTN","FBMON",113,0)
 S DIR("A",.7)=" 'FB FPPS TRANSMIT' started: "_$$FMTE^XLFDT(FBFARG2)
"RTN","FBMON",114,0)
 S DIR("A",.8)=" 'FB FPPS TRANSMIT' ended: "_$$FMTE^XLFDT(FBFARG3)
"RTN","FBMON",115,0)
 S DIR("A",.9)=""
"RTN","FBMON",116,0)
 S DIR("A",1)=" The current status is: "_$S(FBFARG4="INACTIVE":"COMPLETED SUCCESSFULLY, NOT CURRENTLY RUNNING",FBFARG4="ACTIVE":"RUNNING",1:FBFARG4)
"RTN","FBMON",117,0)
 S DIR("A",2)=""
"RTN","FBMON",118,0)
 D ^DIR K DIR
"RTN","FBMON",119,0)
 Q
"RTN","FBMON",120,0)
 ;
"RTN","FBMON",121,0)
SETH(X) ; Fileman date input, returns $H value
"RTN","FBMON",122,0)
 N %H
"RTN","FBMON",123,0)
 D H^XLFDT
"RTN","FBMON",124,0)
 Q %H
"RTN","FBPCR2")
0^21^B61489051^B35427334
"RTN","FBPCR2",1,0)
FBPCR2 ;AISC/DMK,GRR,TET-OUTPATIENT POTENTIAL COST RECOVERY SORT/PRINT ;07/01/2006
"RTN","FBPCR2",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,76,98,122**;JAN 30, 1995;Build 8
"RTN","FBPCR2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR2",4,0)
EN ;entry point
"RTN","FBPCR2",5,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR2",6,0)
SORT ;sort by date finalized, patient, vendor, treatment ien, service ien
"RTN","FBPCR2",7,0)
 S FBPVLIST="ATTENDING PROV NAME^ATTENDING PROV NPI^ATTENDING PROV TAXONOMY CODE^OPERATING PROV NAME^OPERATING PROV NPI^RENDERING PROV NAME"  ; FB*3.5*122
"RTN","FBPCR2",8,0)
 S FBPVLIST=FBPVLIST_"^RENDERING PROV NPI^RENDERING PROV TAXONOMY CODE^SERVICING PROV NAME^SERVICING PROV NPI^REFERRING PROV NAME^REFERRING PROV NPI"  ; FB*3.5*122
"RTN","FBPCR2",9,0)
 S FBLIPVL="^^LI-RENDERING-PROV-NAME^LI-RENDERING-PROV-NPI^LI-RENDERING-PROV-TAXONOMY"   ; FB*3.5*122
"RTN","FBPCR2",10,0)
 S I=FBBDATE-.1 F  S I=$O(^FBAAC("AK",I)) Q:'I!(I>FBEDATE)  S J=0 F  S J=$O(^FBAAC("AK",I,J)) Q:'J  D
"RTN","FBPCR2",11,0)
 .S DFN=J D VET^FBPCR
"RTN","FBPCR2",12,0)
 .S K=0  F  S K=$O(^FBAAC("AK",I,J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AK",I,J,K,L)) Q:'L  D SETTR S M=0 F  S M=$O(^FBAAC("AK",I,J,K,L,M)) Q:'M  D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR2",13,0)
 ..D SET Q:'FBPSV&('$D(FBPSV(FBPSF)))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR2",14,0)
KILL ;kill variables set in this routine
"RTN","FBPCR2",15,0)
 K A1,A2,A3,D,D2,DFN,FBAACPTC,FBBN,FBCATC,FBCP,FBDOB,FBDOS,FBDT,FBDT1,FBIN,FBINS,FBOB,FBP,FBPAT,FBPCR,FBPDX,FBPDXC,FBPID,FBPNAME,FBPSF,FBSC,FBTA,FBTYPE,FBVEN,FBVID,FBVNAME,FBVP,I,J,K,L,M,T,Y,FBMODLE
"RTN","FBPCR2",16,0)
 K FBCSID,FBADJLA,FBADJLR,FBRRMKL,FBUNITS,TAMT,T,FBADJ,FBDAT002,FBDAT003,FBPVLIST,FBLIPVL  ; FB*3.5*122
"RTN","FBPCR2",17,0)
 Q
"RTN","FBPCR2",18,0)
SET ;set variables - also entry point from FBPCR67
"RTN","FBPCR2",19,0)
 N FBPCR,FBX
"RTN","FBPCR2",20,0)
 S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) Q:'+$P(Y,U,9)!($G(^FBAAC(J,1,K,1,L,1,M,"FBREJ"))]"")
"RTN","FBPCR2",21,0)
 S FBY=$G(^FBAAC(J,1,K,1,L,1,M,2)),FBDAT003=$G(^FBAAC(J,1,K,1,L,1,M,3))  ; FB*3.5*122
"RTN","FBPCR2",22,0)
 S FBVNAME=$E($P($G(^FBAAV(K,0)),U),1,23),FBVID=$S(FBVNAME]"":$P(^(0),U,2)_"/"_$S($P($G(^(3)),U,2)]"":$P(^(3),U,2),1:"**********"),1:"")
"RTN","FBPCR2",23,0)
 S FBP=+$P(Y,U,9),FBSC=$P(Y,U,27),FBPDX=+$P(Y,U,23),FBPSF=+$P(Y,U,12)
"RTN","FBPCR2",24,0)
 S ^TMP($J,"FB",FBPSF)=$G(^FBAAC(J,1,K,1,L,4))  ; FB*3.5*122
"RTN","FBPCR2",25,0)
 S FBSC=$S(FBSC="Y":"YES",FBSC="N":"NO",1:"-")
"RTN","FBPCR2",26,0)
 S T=$P(Y,U,5),D2=$P(Y,U,6),FBDOS=D2,D2=$$DATX^FBAAUTL(D2),FBCP=$P(Y,U,18),FBCP=$S(FBCP=1:"(C&P)",1:"")
"RTN","FBPCR2",27,0)
 Q:FBCP]""!('FBPSV&('$D(FBPSV(FBPSF))))  S FBPCR=+$G(^FBAAC(J,1,K,1,L,0)),FBCATC=$$CATC^FBPCR(DFN,FBPCR,+$P(Y,U,18)),FBINS=$S(FBSC["N":$$INSURED^FBPCR4(DFN,FBPCR),1:0) Q:'FBCATC&'FBINS
"RTN","FBPCR2",28,0)
 S FBAACPTC=$$CPT^FBAAUTL4($P(Y,U))
"RTN","FBPCR2",29,0)
 S FBOB=$P(Y,U,10)
"RTN","FBPCR2",30,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBPCR2",31,0)
 S FBTYPE=$P(Y,U,20),FBVP=$P(Y,U,21),FBIN=$P(Y,U,16),FBBN=$P(Y,U,8),FBBN=$S(FBBN']"":"",$D(^FBAA(161.7,FBBN,0)):$P(^(0),U),1:""),FBBN=$S(FBBN="":"",1:$E("00000",$L(FBBN)+1,5)_FBBN)
"RTN","FBPCR2",32,0)
 S FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR2",33,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBPCR2",34,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U) ;suspend code
"RTN","FBPCR2",35,0)
 S TAMT=$FN($P(Y,U,4),"",2) ;suspend amount
"RTN","FBPCR2",36,0)
 S FBUNITS=$P(FBY,U,14) ;units paid
"RTN","FBPCR2",37,0)
 S FBCSID=$P(FBY,U,16) ;patient account number
"RTN","FBPCR2",38,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBPCR2",39,0)
 S FBADJLR=$P(FBX,U) ;adjustment codes
"RTN","FBPCR2",40,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amounts
"RTN","FBPCR2",41,0)
 S FBRRMKL=$$RRL^FBAAFR(M_","_L_","_K_","_J_",") ;remit remarks
"RTN","FBPCR2",42,0)
 ;output format
"RTN","FBPCR2",43,0)
 S A1=$J($P(Y,U,2),6,2),A2=$J($P(Y,U,3),6,2),A3=$J(A3,6,2),FBIN=$J(FBIN,7)
"RTN","FBPCR2",44,0)
 S FBDT1=$S(FBVP="VP":"#",1:"")_$S(FBTYPE="R":"*",1:" ")_FBDT
"RTN","FBPCR2",45,0)
 Q
"RTN","FBPCR2",46,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR2",47,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR2",48,0)
 I $P(Y,U,9)'=FBPI Q
"RTN","FBPCR2",49,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR2",50,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID
"RTN","FBPCR2",51,0)
 I $TR($G(FBDAT002),U)'="" S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN)=FBDAT002 K FBDAT002                   ; FB*3.5*122
"RTN","FBPCR2",52,0)
 I $TR($G(FBDAT004),U)'="" S $P(^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN),U,20)=FBDAT004 K FBDAT004          ; FB*3.5*122
"RTN","FBPCR2",53,0)
 I $TR($G(FBDAT003),U)'="" S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBDAT003")=FBDAT003 K FBDAT003  ; FB*3.5*122
"RTN","FBPCR2",54,0)
 Q
"RTN","FBPCR2",55,0)
SETTR S D=$S($D(^FBAAC(J,1,K,1,L,0)):$P(^(0),"^",1),1:""),A3=".00"
"RTN","FBPCR2",56,0)
 I D]"",$D(^FBAAC(J,3,"AB",D)) S FBTA=$O(^FBAAC(J,3,"AB",D,0)),A3=$S($P(^FBAAC(J,3,FBTA,0),"^",3)]"":$P(^(0),"^",3),1:.0001)
"RTN","FBPCR2",57,0)
 S FBDT=$$DATX^FBAAUTL(D)
"RTN","FBPCR2",58,0)
 S FBDAT002=$G(^FBAAC(J,1,K,1,L,2))  ; FB*3.5*122
"RTN","FBPCR2",59,0)
 S FBDAT004=$G(^FBAAC(J,1,K,1,L,4))  ; FB*3.5*122
"RTN","FBPCR2",60,0)
 Q
"RTN","FBPCR2",61,0)
EN1 ;entry point to set variables, called by fbpcr67, anc
"RTN","FBPCR2",62,0)
 N FBVEN,FBPAT,FBDT1
"RTN","FBPCR2",63,0)
 D SETTR,SET
"RTN","FBPCR2",64,0)
 Q
"RTN","FBPCR2",65,0)
PRINT ;write output
"RTN","FBPCR2",66,0)
 N FB5010PV,FBLIPVL,FBPVLIST
"RTN","FBPCR2",67,0)
 S FB5010PV=""
"RTN","FBPCR2",68,0)
 S FBPVLIST="ATTENDING PROV NAME^NPI^TAXONOMY CODE^OPERATING PROV NAME^NPI^RENDERING PROV NAME^NPI^TAXONOMY CODE"
"RTN","FBPCR2",69,0)
 S FBPVLIST=FBPVLIST_"^SERVICING PROV NAME^NPI^REFERRING PROV NAME^NPI"
"RTN","FBPCR2",70,0)
 S FBLIPVL="^^RENDERING PROV NAME (LI)^NPI^TAXONOMY CODE"
"RTN","FBPCR2",71,0)
 D HDR1 S FBVI=""
"RTN","FBPCR2",72,0)
 F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D:FB5010PV]"" PRNT5010(2,FB5010PV) S FB5010PV=FBVI D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR2",73,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S M=0 F  S M=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M)) Q:'M  D  Q:FBOUT
"RTN","FBPCR2",74,0)
 ..I ($Y+4)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR2",75,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M),FBCATC=$P(FBDATA,U,13),FBINS=$P(FBDATA,U,14)
"RTN","FBPCR2",76,0)
 ..S FBADJ=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M,"FBADJ"))
"RTN","FBPCR2",77,0)
 ..;S FBLOC=1_U_12_U_23_U_33_U_47_U_57_U_63_U_71
"RTN","FBPCR2",78,0)
 ..W !
"RTN","FBPCR2",79,0)
 ..;S I=1 W ?$P(FBLOC,U,I),$P(FBDATA,U,I)
"RTN","FBPCR2",80,0)
 ..W ?1,$P(FBDATA,U,1)
"RTN","FBPCR2",81,0)
 ..;S I=2 W ?$P(FBLOC,U,I),$P($P(FBDATA,U,I),",")
"RTN","FBPCR2",82,0)
 ..W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPCR2",83,0)
 ..;F I=3:1:8 W ?$P(FBLOC,U,I),$P(FBDATA,U,I)
"RTN","FBPCR2",84,0)
 ..W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPCR2",85,0)
 ..W ?43,$P(FBDATA,U,6)
"RTN","FBPCR2",86,0)
 ..W ?54,$P(FBDATA,U,7)
"RTN","FBPCR2",87,0)
 ..W ?64,$P(FBDATA,U,8)
"RTN","FBPCR2",88,0)
 ..I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPCR2",89,0)
 ...N FBI,FBMOD
"RTN","FBPCR2",90,0)
 ...F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPCR2",91,0)
 ....I $Y+7>IOSL D PAGE Q:FBOUT  W !,"  (continued)"
"RTN","FBPCR2",92,0)
 ....W !,?16,"-",FBMOD
"RTN","FBPCR2",93,0)
 ..W !,$P(FBDATA,U,3)
"RTN","FBPCR2",94,0)
 ..W ?13,$P(FBDATA,U,4)
"RTN","FBPCR2",95,0)
 ..W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPCR2",96,0)
 ..W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPCR2",97,0)
 ..W ?48,$P(FBADJ,U,5)
"RTN","FBPCR2",98,0)
 ..W ?60,$P(FBADJ,U,6)
"RTN","FBPCR2",99,0)
 ..S FBPDX=$P(FBDATA,U,10),FBPDXC=$$ICD9^FBCSV1(FBPDX,$$DT2FMDT^FBCSV1($P(FBDATA,U))),$P(FBDATA,U,10)=$E($$ICD9P^FBCSV1(FBPDX,3,$$DT2FMDT^FBCSV1($P(FBDATA,U))),1,19),FBPDXC=$S(FBPDXC="":"",1:" ("_FBPDXC_")")
"RTN","FBPCR2",100,0)
 ..W !?3,"Primary Dx: ",$P(FBDATA,U,10),FBPDXC,?45,"S/C Condition? ",$P(FBDATA,U,9) W ?66,"Obl.#: ",$P(FBDATA,U,11)
"RTN","FBPCR2",101,0)
 ..I FBCATC!FBINS D
"RTN","FBPCR2",102,0)
 ...W !?5,">>>"
"RTN","FBPCR2",103,0)
 ...I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR2",104,0)
 ...I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR2",105,0)
 ...I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR2",106,0)
 ...I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR2",107,0)
 ...I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR2",108,0)
 .. D PRNT5010(3,M)  ; FB*3.5*122
"RTN","FBPCR2",109,0)
 ..S A3=".00"
"RTN","FBPCR2",110,0)
 I FB5010PV]"" D PRNT5010(2,FB5010PV)  ; FB*3.5*122
"RTN","FBPCR2",111,0)
 Q
"RTN","FBPCR2",112,0)
HDR ;main header
"RTN","FBPCR2",113,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR2",114,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"FEE PROGRAM: ",FBXPROG
"RTN","FBPCR2",115,0)
 ;W !!,?2,"Svc Date",?11,"CPT-MOD",?23,"Amount",?33," Amount",?42,"Susp",?49,"Travel",?57,"Batch",?63,"Invoice",?71,"Voucher"
"RTN","FBPCR2",116,0)
 ;W !,?23,"Claimed",?35,"Paid",?42,"Code",?50,"Paid",?58,"Num",?64,"Num",?72,"Date",!,FBDASH
"RTN","FBPCR2",117,0)
 W !!,?1,"Svc Date",?11,"CPT-MOD ",?19,"Travel Paid",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPCR2",118,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPCR2",119,0)
 Q
"RTN","FBPCR2",120,0)
SH ;subheader - vendor, prints when name changed
"RTN","FBPCR2",121,0)
 I ($Y+6)>IOSL D HDR Q:FBOUT
"RTN","FBPCR2",122,0)
 ;W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID/NPI: ",$P(FBVI,";",2)
"RTN","FBPCR2",123,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P($P(FBVI,";",2),"/",1)
"RTN","FBPCR2",124,0)
 W !?20,"Fee Basis Billing Provider NPI: ",$P(FBVI,"/",2)
"RTN","FBPCR2",125,0)
 Q
"RTN","FBPCR2",126,0)
CR ;read for display
"RTN","FBPCR2",127,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR2",128,0)
 Q
"RTN","FBPCR2",129,0)
PAGE ;new page
"RTN","FBPCR2",130,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR2",131,0)
 Q
"RTN","FBPCR2",132,0)
PRNT5010(FBTYPE,FBNODE) ; Format and print based on data type  ; FB*3.5*122
"RTN","FBPCR2",133,0)
 N FBVDAT,FBCNT
"RTN","FBPCR2",134,0)
 I $G(FBTYPE)=2 D  Q   ; Vender level
"RTN","FBPCR2",135,0)
 . I $G(FBPSF)]"",$G(FBPT)]"",$G(FBPI)]"",$G(FBNODE)]"",$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBNODE))]"" S FBVDAT=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBNODE)
"RTN","FBPCR2",136,0)
 . E  Q
"RTN","FBPCR2",137,0)
 . F FBCNT=1,6 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR2",138,0)
 .. W !,$P(FBPVLIST,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVLIST,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR2",139,0)
 .. W !,?6,$P(FBPVLIST,U,FBCNT+2)_": "_$P(FBVDAT,U,FBCNT+2)
"RTN","FBPCR2",140,0)
 . F FBCNT=4,11,9 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR2",141,0)
 .. W !,$P(FBPVLIST,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVLIST,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR2",142,0)
 . I $P(FBVDAT,U,20)]"" D
"RTN","FBPCR2",143,0)
 .. W !,"  SERVICING FACILITY ADDRESS: "_$P(FBVDAT,U,20),!,"                              "_$P(FBVDAT,U,21)_", "
"RTN","FBPCR2",144,0)
 .. I $P(FBVDAT,U,22)]"" W $$GET1^DIQ(5,$P(FBVDAT,U,22)_",",.01)
"RTN","FBPCR2",145,0)
 .. W " "_$P(FBVDAT,U,23),!
"RTN","FBPCR2",146,0)
 ;
"RTN","FBPCR2",147,0)
 I $G(FBTYPE)=3 D  Q   ; Line Item level
"RTN","FBPCR2",148,0)
 . I $G(FBPSF)]"",$G(FBPT)]"",$G(FBPI)]"",$G(FBVI)]"",$G(FBDT)]"",$G(FBNODE)]"",$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBNODE,"FBDAT003"))]"" S FBVDAT=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBNODE,"FBDAT003")
"RTN","FBPCR2",149,0)
 . E  Q
"RTN","FBPCR2",150,0)
 . W !,?8,$P(FBLIPVL,U,3)_": "_$P(FBVDAT,U,3)
"RTN","FBPCR2",151,0)
 . W !,?12,$P(FBLIPVL,U,4)_": "_$P(FBVDAT,U,4),?35,$P(FBLIPVL,U,5),": ",$P(FBVDAT,U,5),!!
"RTN","FBPCR2",152,0)
 Q
"RTN","FBPCR67")
0^22^B24858243^B22170399
"RTN","FBPCR67",1,0)
FBPCR67 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY SORT ;07/01/2006
"RTN","FBPCR67",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,98,122**;JAN 30, 1995;Build 8
"RTN","FBPCR67",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR67",4,0)
EN ;entry point for sort
"RTN","FBPCR67",5,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",6,0)
SORT ;sort by date finalized, ien
"RTN","FBPCR67",7,0)
 N FBY2,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL
"RTN","FBPCR67",8,0)
 S FBM=FBBDATE-.1 F  S FBM=$O(^FBAAI("AD",FBM)) Q:'FBM!(FBM>FBEDATE)  S FBI=0 F  S FBI=$O(^FBAAI("AD",FBM,FBI)) Q:FBI'>0  S FBIN=$G(^FBAAI(FBI,0)) I FBIN]""&($G(^FBAAI(FBI,"FBREJ"))']"") D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR67",9,0)
 .S (DFN,J)=+$P(FBIN,U,4) D VET^FBPCR
"RTN","FBPCR67",10,0)
 .D SET Q:FBPI'[+$P(FBIN,U,12)!('FBPSV&('$D(FBPSV(FBPSF))))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR67",11,0)
KILL ;kill variables set in this routine and in FPAY2, sort/set sections
"RTN","FBPCR67",12,0)
 K A1,A2,A3,D,D2,DFN,FBAACPTC,FBBN,FBCATC,FBCNT,FBCP,FBDOB,FBDT,FBDT1,FBDX,FBDX1,FBI,FBIN,FBINS,FBIX,FBJ,FBM,FBOB,FBPAT,FBPDX,FBPROC,FBPROC1,FBPSF,FBSC,FBTA,FBVEN,FBVENID,FBVP,I,J,K,L,M,Y
"RTN","FBPCR67",13,0)
 K FBVNAME,FBVID,FBPNAME,FBPID
"RTN","FBPCR67",14,0)
 K FBY2,FBY4,FBCDAYS,FBCSID,FBX,FBADJLR,FBADJLA,FBRRMKL   ; FB*3.5*122
"RTN","FBPCR67",15,0)
 D KILL^FBPCR2
"RTN","FBPCR67",16,0)
 Q
"RTN","FBPCR67",17,0)
SET ;set variables
"RTN","FBPCR67",18,0)
 S FBY2=$G(^FBAAI(FBI,2)),FBY4=$G(^FBAAI(FBI,4)),$P(FBY4,U,20)=$G(^FBAAI(FBI,5))  ; FB*3.5*122
"RTN","FBPCR67",19,0)
 F FBJ=1,2,3,4,6,7,8,9,11,13,14 S FBIN(FBJ)=$P(FBIN,"^",FBJ)
"RTN","FBPCR67",20,0)
 Q:FBPI'[+$P(FBIN,U,12)  S FBPSF=+$P(FBIN,U,20)
"RTN","FBPCR67",21,0)
 Q:'FBPSV&('$D(FBPSV(FBPSF)))
"RTN","FBPCR67",22,0)
 S ^TMP($J,"FB",FBPSF)=$G(^FBAAI(FBI,5))  ; FB*3.5*122
"RTN","FBPCR67",23,0)
 D
"RTN","FBPCR67",24,0)
 . N FBCATC2
"RTN","FBPCR67",25,0)
 . S FBCATC=$$CATC^FBPCR(DFN,+$P(FBIN,U,6),+$P(FBIN,U,18))
"RTN","FBPCR67",26,0)
 . Q:FBCATC=2
"RTN","FBPCR67",27,0)
 . S FBCATC2=$$CATC^FBPCR(DFN,+$P(FBIN,U,7),+$P(FBIN,U,18))
"RTN","FBPCR67",28,0)
 . I FBCATC2=0 Q
"RTN","FBPCR67",29,0)
 . I FBCATC=0!(FBCATC=1) S FBCATC=FBCATC2 Q
"RTN","FBPCR67",30,0)
 . S:FBCATC2=2 FBCATC=2
"RTN","FBPCR67",31,0)
 ;,FBINS=$S($O(^FBAAA("AIC",FBIN(4),+$O(^FBAAA("AIC",FBIN(4),-FBIN(6))),0))="Y":1,1:0)
"RTN","FBPCR67",32,0)
 S FBINS=$S($$INSCK^FBPCR3(FBIN(6),FBIN(4),+$P(FBIN,U,12))=1:$$INSURED^FBPCR4(DFN,+$P(FBIN,U,6),+$P(FBIN,U,7)),1:0)
"RTN","FBPCR67",33,0)
 Q:'FBCATC&'FBINS
"RTN","FBPCR67",34,0)
 S FBIN(5)=$P(FBIN,U,5)
"RTN","FBPCR67",35,0)
 S FBIEN=FBIN(3),FBVNAME=$G(^FBAAV(FBIN(3),0)) Q:FBVNAME']""  S FBVID=$P(FBVNAME,U,2)_"/"_$S($P($G(^FBAAV(FBIEN,3)),U,2)]"":$P($G(^FBAAV(FBIEN,3)),U,2),1:"**********"),FBVNAME=$E($P(FBVNAME,U),1,23)
"RTN","FBPCR67",36,0)
 S FBIN(2)=$$DATX^FBAAUTL(FBIN(2)),FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR67",37,0)
 S FBIN(6)=$$DATX^FBAAUTL(FBIN(6)),FBIN(7)=$$DATX^FBAAUTL(FBIN(7))
"RTN","FBPCR67",38,0)
 Q
"RTN","FBPCR67",39,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR67",40,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",41,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI)=FBIN(2)_U_$J(FBIN(8),8,2)_U_$J(FBIN(9),8,2)_U_FBIN(11)_U_$J(FBIN(1),8)_U_FBIN(6)_U_FBIN(7)_U_$P(FBIN,U,12)_U_FBCATC_U_FBINS_U_FBIN(13)_U_FBIN(14)
"RTN","FBPCR67",42,0)
 S FBCDAYS=$P(FBY2,U,10) ; covered days
"RTN","FBPCR67",43,0)
 S FBCSID=$P(FBY2,U,11) ; patient control number
"RTN","FBPCR67",44,0)
 S FBX=$$ADJLRA^FBCHFA(FBI_",")
"RTN","FBPCR67",45,0)
 S FBADJLR=$P(FBX,U) ;adjustment reason
"RTN","FBPCR67",46,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPCR67",47,0)
 S FBRRMKL=$$RRL^FBCHFR(FBI_",") ;remittance remarks
"RTN","FBPCR67",48,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBINV")=FBCDAYS_"^"_FBCSID_"^"_FBADJLR_"^"_FBADJLA_"^"_FBRRMKL
"RTN","FBPCR67",49,0)
 S FBDX=$G(^FBAAI(FBI,"DX")) I FBDX]"" S FBDX1="" F I=1:1:5 S:$P(FBDX,U,I) FBDX1=FBDX1_$$ICD9^FBCSV1($P(FBDX,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",50,0)
 I FBDX]"" S FBDX1=$P(FBDX1,U,1,($L(FBDX1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"DX")=FBDX1
"RTN","FBPCR67",51,0)
 S FBPROC=$G(^FBAAI(FBI,"PROC")) I FBPROC]"" S FBPROC1="" F I=1:1:5 S:$P(FBPROC,U,I) FBPROC1=FBPROC1_$$ICD0^FBCSV1($P(FBPROC,U,I),+$P($G(FBIN),U,6))_U
"RTN","FBPCR67",52,0)
 I FBPROC]"" S FBPROC1=$P(FBPROC1,U,1,($L(FBPROC1,U)-1)),^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"PROC")=FBPROC1
"RTN","FBPCR67",53,0)
 ;*** removed conditional to get ancillary payments processed
"RTN","FBPCR67",54,0)
 ;D ANC:$D(^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI))
"RTN","FBPCR67",55,0)
 D ANC
"RTN","FBPCR67",56,0)
 I $TR(FBY4,U)]"" S ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"FBY4")=FBY4         ; FB*3.5*122
"RTN","FBPCR67",57,0)
 I FBPROC]"" K FB5010 F I=1:1:5 S:$P(FBPROC,U,I) FB5010(I)=$G(^FBAAI(FBI,"RPROV",I,0))          ; FB*3.5*122
"RTN","FBPCR67",58,0)
 I FBPROC]"" M ^TMP($J,"FB",FBPSF,FBPAT,+$P(FBIN,U,12),FBVEN,FBM,FBI,"RPROV")=FB5010 K FB5010   ; FB*3.5*122 
"RTN","FBPCR67",59,0)
 Q
"RTN","FBPCR67",60,0)
ANC ;ancillary payments
"RTN","FBPCR67",61,0)
 N J,K,L,M,Y,FBDT1,FBVID I FBPI=67 N FBPI S FBPI=+$P(FBIN,U,12)
"RTN","FBPCR67",62,0)
 S J=DFN,FBCNT=0 I J,+FBIN(5),$D(^FBAAC("AM",FBIN(5),J)) D
"RTN","FBPCR67",63,0)
 .F K=0:0 S K=$O(^FBAAC("AM",FBIN(5),J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AM",FBIN(5),J,K,L)) Q:'L  D
"RTN","FBPCR67",64,0)
 ..S FBDT1=$P($G(^FBAAC(J,1,K,1,L,0)),U) I FBDT1]"" S FBDT1=$$DATX^FBAAUTL(FBDT1)
"RTN","FBPCR67",65,0)
 ..S M=0 F  S M=$O(^FBAAC("AM",FBIN(5),J,K,L,M)) Q:'M  S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) I Y]"" D
"RTN","FBPCR67",66,0)
 ...D EN1^FBPCR2 Q:'$D(FBAACPTC)  S FBCNT=FBCNT+1
"RTN","FBPCR67",67,0)
 ...Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR67",68,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBVNAME_U_FBVID_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR67",69,0)
 ...S ^TMP($J,"FB",FBPSF,FBPAT,FBPI,FBVEN,FBM,FBI,"A",FBCNT,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID
"RTN","FBPCR67",70,0)
 Q
"RTN","FBPCR671")
0^23^B40566981^B26341228
"RTN","FBPCR671",1,0)
FBPCR671 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY PRINT ;07/18/2006
"RTN","FBPCR671",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,76,98,122**;JAN 30, 1995;Build 8
"RTN","FBPCR671",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR671",4,0)
PRINT ;print data from tmp global
"RTN","FBPCR671",5,0)
 I FBPG>1&(($Y+12)>IOSL) D HDR Q:FBOUT
"RTN","FBPCR671",6,0)
 E  D HDR1
"RTN","FBPCR671",7,0)
 S FBPVLIST="ATTENDING PROV NAME^NPI^TAXONOMY CODE^OPERATING PROV NAME^NPI^RENDERING PROV NAME"
"RTN","FBPCR671",8,0)
 S FBPVLIST=FBPVLIST_"^NPI^TAXONOMY CODE^SERVICING PROV NAME^NPI^REFERRING PROV NAME^NPI"
"RTN","FBPCR671",9,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR671",10,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S FBI=0 F  S FBI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI)) Q:'FBI  D  Q:FBOUT
"RTN","FBPCR671",11,0)
 ..I ($Y+5)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",12,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI),FBCATC=$P(FBDATA,U,9),FBINS=$P(FBDATA,U,10)
"RTN","FBPCR671",13,0)
 ..S FBINV=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBINV")
"RTN","FBPCR671",14,0)
 ..W ! W:$P(FBDATA,U,8)["R" "*" W:$P(FBDATA,U,9)]"" "#"
"RTN","FBPCR671",15,0)
 ..W ?2,$P(FBDATA,U,1),?15,$P(FBDATA,U,5),?31,$P(FBDATA,U,6)
"RTN","FBPCR671",16,0)
 ..W ?47,$P(FBDATA,U,7),?57,$P(FBINV,U,2)
"RTN","FBPCR671",17,0)
 ..W !?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?25,$P(FBINV,U,1)
"RTN","FBPCR671",18,0)
 .. ;Print adj reasons, if null then print suspend code
"RTN","FBPCR671",19,0)
 ..W ?36,$S($P(FBINV,U,3)]"":$P(FBINV,U,3),1:$P(FBDATA,U,4))
"RTN","FBPCR671",20,0)
 ..W ?46,$S($P(FBINV,U,3)]"":$J($P(FBINV,U,4),14),1:$J($P(FBDATA,U,10),14))
"RTN","FBPCR671",21,0)
 ..W ?63,$P(FBINV,U,5)
"RTN","FBPCR671",22,0)
 ..;F FBY="DX","PROC" I $D(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,FBY)) S FBDATA=^(FBY),FBSL=$L(FBDATA,"^") W !?2,FBY,": " F I=1:1:FBSL W $P(FBDATA,U,I),"    "
"RTN","FBPCR671",23,0)
 ..S FBDATA=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"DX")),FBSL=$L(FBDATA,"^") I FBDATA]"" W !?2,"DX: " F I=1:1:FBSL W $P(FBDATA,U,I),"    "
"RTN","FBPCR671",24,0)
 ..S FBDATA=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"PROC")),FBSL=$L(FBDATA,"^"),FBRPROV=1
"RTN","FBPCR671",25,0)
 ..I FBDATA]"" F I=1:1:FBSL I $P(FBDATA,U,I)]"" D                                                                                      ; FB*3.5*122
"RTN","FBPCR671",26,0)
 ...W:FBRPROV !,?2,"PROC: " W:'FBRPROV "    " W $P(FBDATA,U,I)                                                                         ; FB*3.5*122
"RTN","FBPCR671",27,0)
 ...S FBRPROV=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"RPROV",I)) I FBRPROV="" Q                                                 ; FB*3.5*122
"RTN","FBPCR671",28,0)
 ...W ?20,"RENDERING PROVIDER NAME: "_$P(FBRPROV,U,2),!,?21,"NPI: "_$P(FBRPROV,U,3),?46,"TAXONOMY CODE: "_$P(FBRPROV,U,4) S FBRPROV=1  ; FB*3.5*122
"RTN","FBPCR671",29,0)
 ..K FBRPROV
"RTN","FBPCR671",30,0)
 ..I FBCATC!FBINS D
"RTN","FBPCR671",31,0)
 ...W !?5,">>>"
"RTN","FBPCR671",32,0)
 ...I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",33,0)
 ...I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",34,0)
 ...I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",35,0)
 ...I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",36,0)
 ...I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",37,0)
 ..;
"RTN","FBPCR671",38,0)
 ..I +$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",0)) D  Q:FBOUT  W !,FBDASH1
"RTN","FBPCR671",39,0)
 ...S (FBOV,FBCNT)=0,FBSL=7 D SHA Q:FBOUT
"RTN","FBPCR671",40,0)
 ...F  S FBCNT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT)) Q:'FBCNT  S FBDATA=^(FBCNT),FBV=$P(FBDATA,U,11)_";"_$P(FBDATA,U,12) D  D WRT Q:FBOUT
"RTN","FBPCR671",41,0)
 ....N FBXX S FBXX=$O(^FBAAV("C",$P(FBDATA,U,12),"")) S $P(FBV,";",2)=$P(FBV,";",2)_"/"_$S(FBXX="":"**********",$P($G(^FBAAV(FBXX,3)),U,2)]"":$P(^FBAAV(FBXX,3),U,2),1:"**********")
"RTN","FBPCR671",42,0)
 ..D PRNT5010  ; FB*3.5*122
"RTN","FBPCR671",43,0)
 Q
"RTN","FBPCR671",44,0)
PRNT5010 ; Format and print based on data type  ; FB*3.5*122
"RTN","FBPCR671",45,0)
 N FBVDAT,FBCNT
"RTN","FBPCR671",46,0)
 I $G(FBPSF)]"",$G(FBPT)]"",$G(FBPI)]"",$G(FBVI)]"",$G(FBDT)]"",$G(FBI)]"",$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBY4"))]""
"RTN","FBPCR671",47,0)
 E  Q
"RTN","FBPCR671",48,0)
 W ! S FBVDAT=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBY4")
"RTN","FBPCR671",49,0)
 F FBCNT=1,6 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR671",50,0)
 . W !,$P(FBPVLIST,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVLIST,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR671",51,0)
 . W !,?6,$P(FBPVLIST,U,FBCNT+2)_": "_$P(FBVDAT,U,FBCNT+2)
"RTN","FBPCR671",52,0)
 F FBCNT=4,11,9 I $P(FBVDAT,U,FBCNT)]"" D
"RTN","FBPCR671",53,0)
 . W !,$P(FBPVLIST,U,FBCNT)_": "_$P(FBVDAT,U,FBCNT),?55,$P(FBPVLIST,U,FBCNT+1)_": "_$P(FBVDAT,U,FBCNT+1)
"RTN","FBPCR671",54,0)
 I $P(FBVDAT,U,20)]"" D
"RTN","FBPCR671",55,0)
 . W !,"  SERVICING FACILITY ADDRESS: "_$P(FBVDAT,U,20),!,"                              "_$P(FBVDAT,U,21)_", "
"RTN","FBPCR671",56,0)
 . I $P(FBVDAT,U,22)]"" W $$GET1^DIQ(5,$P(FBVDAT,U,22)_",",.01)
"RTN","FBPCR671",57,0)
 . W " "_$P(FBVDAT,U,23)
"RTN","FBPCR671",58,0)
 W !
"RTN","FBPCR671",59,0)
 Q
"RTN","FBPCR671",60,0)
WRT ;write ancillary info
"RTN","FBPCR671",61,0)
 N FBCATC,FBINS,FBADJ I ($Y+4)>IOSL D PAGE Q:FBOUT  D SHA,SHA2
"RTN","FBPCR671",62,0)
 D:FBOV'=FBV SHA2
"RTN","FBPCR671",63,0)
 S FBADJ=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT,"FBADJ")
"RTN","FBPCR671",64,0)
 S FBCATC=$P(FBDATA,U,14),FBINS=$P(FBDATA,U,15)
"RTN","FBPCR671",65,0)
 W !
"RTN","FBPCR671",66,0)
 W ?1,$P(FBDATA,U,1)
"RTN","FBPCR671",67,0)
 W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPCR671",68,0)
 W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPCR671",69,0)
 W ?43,$P(FBDATA,U,6)
"RTN","FBPCR671",70,0)
 W ?54,$P(FBDATA,U,7)
"RTN","FBPCR671",71,0)
 W ?64,$P(FBDATA,U,8)
"RTN","FBPCR671",72,0)
 I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPCR671",73,0)
 . N FBI,FBMOD
"RTN","FBPCR671",74,0)
 . F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPCR671",75,0)
 . . I $Y+6>IOSL D PAGE Q:FBOUT  D SHA,SHA2 W !,"  (continued)"
"RTN","FBPCR671",76,0)
 . . W !,?16,"-",FBMOD
"RTN","FBPCR671",77,0)
 W !,$P(FBDATA,U,3)
"RTN","FBPCR671",78,0)
 W ?13,$P(FBDATA,U,4)
"RTN","FBPCR671",79,0)
 W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPCR671",80,0)
 W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPCR671",81,0)
 W ?48,$P(FBADJ,U,5)
"RTN","FBPCR671",82,0)
 W ?60,$P(FBADJ,U,6)
"RTN","FBPCR671",83,0)
 W !?5,"Primary Dx: ",$P(FBDATA,U,9),?40,"S/C Condition? ",$P(FBDATA,U,8),?66,"Obl.#: ",$P(FBDATA,U,10)
"RTN","FBPCR671",84,0)
 I FBCATC!FBINS D
"RTN","FBPCR671",85,0)
 .W !?5,">>>"
"RTN","FBPCR671",86,0)
 .I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",87,0)
 .I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",88,0)
 .I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",89,0)
 .I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",90,0)
 .I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",91,0)
 ;
"RTN","FBPCR671",92,0)
 Q
"RTN","FBPCR671",93,0)
HDR ;main header
"RTN","FBPCR671",94,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR671",95,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"FEE PROGRAM: ",FBXPROG
"RTN","FBPCR671",96,0)
 W !?1,"Invoice Date",?15,"Invoice No.",?31,"From Date",?48,"To Date",?57,"Patient Control #"
"RTN","FBPCR671",97,0)
 W !?1,"Amt Claimed",?15,"Amt Paid",?25,"Cov Days",?36,"Adj Codes",?49,"Adj Amounts",?63,"Remit Remarks",!,FBDASH
"RTN","FBPCR671",98,0)
 Q
"RTN","FBPCR671",99,0)
SH ;subheader - vendor, prints when name changed
"RTN","FBPCR671",100,0)
 I ($Y+7)>IOSL D HDR Q:FBOUT
"RTN","FBPCR671",101,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P($P(FBVI,";",2),"/",1)
"RTN","FBPCR671",102,0)
 W !?20,"Fee Basis Billing Provider NPI: ",$P(FBVI,"/",2)
"RTN","FBPCR671",103,0)
 Q
"RTN","FBPCR671",104,0)
SHA ;ancillary subheader
"RTN","FBPCR671",105,0)
 I ($Y+16)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",106,0)
 W !?20,">>> ANCILLARY SERVICE PAYMENTS <<<",!
"RTN","FBPCR671",107,0)
SHA1 ;subheader for ancillary data
"RTN","FBPCR671",108,0)
 W !!,?1,"Svc Date",?11,"CPT-MOD ",?19,"Travel Paid",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPCR671",109,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPCR671",110,0)
 Q
"RTN","FBPCR671",111,0)
SHA2 ;subheader for vendor name
"RTN","FBPCR671",112,0)
 I ($Y+9)>IOSL D HDR Q:FBOUT  D SH,SHA
"RTN","FBPCR671",113,0)
 I FBOV'=FBV S FBOV=FBV
"RTN","FBPCR671",114,0)
 W !!,"Vendor: ",$P(FBV,";"),?41,"Vendor ID/NPI: ",$P(FBV,";",2)
"RTN","FBPCR671",115,0)
 Q
"RTN","FBPCR671",116,0)
CR ;read for display
"RTN","FBPCR671",117,0)
 Q:'FBPG  S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR671",118,0)
 Q
"RTN","FBPCR671",119,0)
PAGE ;new page
"RTN","FBPCR671",120,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR671",121,0)
 Q
"RTN","FBPCR671",122,0)
WRTDX I $P(FBDX,"^",K)]"" W ?4,"Dx: ",$$ICD9^FBCSV1($P(FBDX,"^",K)),"  " Q
"RTN","FBPCR671",123,0)
 Q
"RTN","FBPCR671",124,0)
WRTPC I $P(FBPROC,"^",L)]"" W ?4,"Proc: ",$$ICD0^FBCSV1($P(FBPROC,"^",L)),"   " Q
"RTN","FBPCR671",125,0)
 Q
"RTN","FBPCR671",126,0)
WRTSC ;write service connected
"RTN","FBPCR671",127,0)
 W !,"SERVICE CONNECTED? ",$S(+VAEL(3):"YES",1:"NO"),!
"RTN","FBPCR671",128,0)
 Q
"RTN","FBUTL8")
0^6^B31445484^n/a
"RTN","FBUTL8",1,0)
FBUTL8 ;DSS/BPD - FEE BASIS UTILITY FOR PROVIDER INFORMATION ;5/11/2011
"RTN","FBUTL8",2,0)
 ;;3.5;FEE BASIS;**122**;JAN 30, 1995;Build 8
"RTN","FBUTL8",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBUTL8",4,0)
 Q
"RTN","FBUTL8",5,0)
RPROV(FBPROV,FBPROVD) ; Prompt for adjustments
"RTN","FBUTL8",6,0)
 ;
"RTN","FBUTL8",7,0)
 ; Input
"RTN","FBUTL8",8,0)
 ;   FBPROV - required, array passed by reference
"RTN","FBUTL8",9,0)
 ;            will be initialized (killed)
"RTN","FBUTL8",10,0)
 ;            array of any entered adjustments
"RTN","FBUTL8",11,0)
 ;            format
"RTN","FBUTL8",12,0)
 ;              FBADJ(#)=FBADJR^FBADJG^FBADJA
"RTN","FBUTL8",13,0)
 ;            where
"RTN","FBUTL8",14,0)
 ;              # = sequentially assigned number starting with 1
"RTN","FBUTL8",15,0)
 ;              FBADJR = adjustment reason (internal value file 162.91)
"RTN","FBUTL8",16,0)
 ;              FBADJG = adjustment group (inernal value file 162.92)
"RTN","FBUTL8",17,0)
 ;              FBADJA = adjustment amount (dollar value)
"RTN","FBUTL8",18,0)
 ;             default to current date, used to determine available codes
"RTN","FBUTL8",19,0)
 ;   FBPROVD-  optional, array passed by reference
"RTN","FBUTL8",20,0)
 ;             same format as FBADJ
"RTN","FBUTL8",21,0)
 ;             if passed, it will be used to supply default values
"RTN","FBUTL8",22,0)
 ;             normally only used when editing an existing payment 
"RTN","FBUTL8",23,0)
 ;   FBNOOUT-  optional, boolean value, default 0, set =1 if user
"RTN","FBUTL8",24,0)
 ;             should not be allowed to exit using an uparrow
"RTN","FBUTL8",25,0)
 ; Result (value of $$ADJ extrinsic function)
"RTN","FBUTL8",26,0)
 ;   FBRET  - boulean value (0 or 1)
"RTN","FBUTL8",27,0)
 ;             = 1 when valid adjustments entered
"RTN","FBUTL8",28,0)
 ;             = 0 when processed ended due to time-out or entry of '^'
"RTN","FBUTL8",29,0)
 ; Output
"RTN","FBUTL8",30,0)
 ;   FBADJ  - the FBADJ input array passed by reference will be modified
"RTN","FBUTL8",31,0)
 ;            if the result = 1 then it will contain entered adjustments
"RTN","FBUTL8",32,0)
 ;            if the result = 0 then it will be undefined
"RTN","FBUTL8",33,0)
 ;
"RTN","FBUTL8",34,0)
 N FBADJR,FBCAS,FBCNT,FBEDIT,FBERR,FBI,FBNEW,FBRET
"RTN","FBUTL8",35,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","FBUTL8",36,0)
 S FBRET=1,FBEDIT=0
"RTN","FBUTL8",37,0)
 S FBNOOUT=$G(FBNOOUT,0)
"RTN","FBUTL8",38,0)
 K FBPROV N FBPROV
"RTN","FBUTL8",39,0)
 ;
"RTN","FBUTL8",40,0)
 ; if default adjustments exist then load them into array
"RTN","FBUTL8",41,0)
 I $D(FBPROVD) M FBPROV=FBPROVD
"RTN","FBUTL8",42,0)
 S (FBCNT,FBCAS)=0
"RTN","FBUTL8",43,0)
 I $D(FBPROV) S FBI=0 F  S FBI=$O(FBPROV(FBI)) Q:'FBI  D
"RTN","FBUTL8",44,0)
 . S FBCNT=FBCNT+1
"RTN","FBUTL8",45,0)
 ;
"RTN","FBUTL8",46,0)
 ; if more than one adjustment can be entered then display number
"RTN","FBUTL8",47,0)
 ;
"RTN","FBUTL8",48,0)
 ;
"RTN","FBUTL8",49,0)
ASKRPROV ; multiply prompt for adjustments
"RTN","FBUTL8",50,0)
 ;
"RTN","FBUTL8",51,0)
 ; display current list of Rendering Providers
"RTN","FBUTL8",52,0)
 I FBCNT>0 D
"RTN","FBUTL8",53,0)
 . W !!,"Current list of Line Item Rendering Providers: "
"RTN","FBUTL8",54,0)
 . I '$O(FBPROV(0)) W "none"
"RTN","FBUTL8",55,0)
 . S FBI=0 F  S FBI=$O(FBPROV(FBI)) Q:'FBI  D
"RTN","FBUTL8",56,0)
 . . W !?3,"Line Item: "_FBI
"RTN","FBUTL8",57,0)
 . . W ?25,"Rendering Provider Name: "_$P(FBPROV(FBI),U)
"RTN","FBUTL8",58,0)
 . . W !?3,"Rendering Provider NPI: "_$P(FBPROV(FBI),U,2)
"RTN","FBUTL8",59,0)
 . . W ?45,"Taxonomy Code: "_$P(FBPROV(FBI),U,3)
"RTN","FBUTL8",60,0)
 ;
"RTN","FBUTL8",61,0)
 ; prompt for Line Item Rendering Provider
"RTN","FBUTL8",62,0)
 ;I  D
"RTN","FBUTL8",63,0)
 N FBI,FBPROVR
"RTN","FBUTL8",64,0)
 S DIR(0)="162.579,.01",DIR("A")="Enter LINE ITEM NUMBER"
"RTN","FBUTL8",65,0)
 S DIR("?")="Please enter the Rendering Provider information for a specific line item."
"RTN","FBUTL8",66,0)
 S DIR("?",1)="This information is only required if the line item transaction has a different Rendering Provider than the claim."
"RTN","FBUTL8",67,0)
 D ^DIR K DIR I $D(DTOUT)!($D(DUOUT))!(Y="") G EXIT
"RTN","FBUTL8",68,0)
 S FBI=+Y I Y'=0,$G(FBPROV(+Y))'="" S FBEDIT=1
"RTN","FBUTL8",69,0)
 I 'FBEDIT S FBPROV(FBI)=""
"RTN","FBUTL8",70,0)
 S DIR(0)="162.579,.02" I FBEDIT=1 S DIR("B")=$P(FBPROV(FBI),U)
"RTN","FBUTL8",71,0)
 S DIR("A")="LINE ITEM RENDERING PROV NAME",DIR("?")="Enter the Rendering Provider's Name for the specified line item,"
"RTN","FBUTL8",72,0)
 S DIR("?",1)="if different than the claim level Rendering Provider" D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) G EXIT
"RTN","FBUTL8",73,0)
 I X="@" D DEL(FBI)
"RTN","FBUTL8",74,0)
 S $P(FBPROV(FBI),U)=Y
"RTN","FBUTL8",75,0)
 S DIR(0)="162.579,.03" I FBEDIT=1 S DIR("B")=$P(FBPROV(FBI),U,2)
"RTN","FBUTL8",76,0)
 S DIR("A")="LINE ITEM RENDERING PROV NPI",DIR("?")="Enter the Rendering Provider's NPI for the specified line item."
"RTN","FBUTL8",77,0)
 S DIR("?",1)="if different than the claim level Rendering Provider" D ^DIR K DIR I $D(DTOUT)!($D(DIOUT)) G EXIT
"RTN","FBUTL8",78,0)
 S $P(FBPROV(FBI),U,2)=Y
"RTN","FBUTL8",79,0)
 S DIR(0)="162.579,.04",DIR("A")="LINE ITEM RENDERING PROV TAXONOMY CODE" I FBEDIT=1 S DIR("B")=$P(FBPROV(FBI),U,3)
"RTN","FBUTL8",80,0)
 S DIR("?")="Enter the Rendering Provider's Name for the specified line item,"
"RTN","FBUTL8",81,0)
 S DIR("?",1)="if different than the claim level Rendering Provider" D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) G EXIT
"RTN","FBUTL8",82,0)
 S $P(FBPROV(FBI),U,3)=Y
"RTN","FBUTL8",83,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="ENTER ANOTHER LINE ITEM RENDERING PROVIDER"
"RTN","FBUTL8",84,0)
 S DIR("?")="Do you need to enter another Line Item level Rendering Provider?",DIR("?",1)="Answering yes will prompt you for more information or allow"
"RTN","FBUTL8",85,0)
 S DIR("?",2)="you to modify an entered record." D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) G EXIT
"RTN","FBUTL8",86,0)
 I FBPROV(FBI)="" K FBPROV(FBI)
"RTN","FBUTL8",87,0)
 G:Y ASKRPROV G:'Y EXIT
"RTN","FBUTL8",88,0)
 ;
"RTN","FBUTL8",89,0)
 ;VAL ; validate
"RTN","FBUTL8",90,0)
 ;S FBERR=0
"RTN","FBUTL8",91,0)
 ;I FBCAS'=FBTAS D
"RTN","FBUTL8",92,0)
 ;. S FBERR=1
"RTN","FBUTL8",93,0)
 ;. W !,$C(7),"ERROR: Must account for $",$FN(FBTAS-FBCAS,"",2)," more to cover the total amount suspended."
"RTN","FBUTL8",94,0)
 ;. W !,"   The current sum of adjustments is $",$FN(FBCAS,"",2),"."
"RTN","FBUTL8",95,0)
 ;. W !,"   The total amount suspended is $",$FN(FBTAS,"",2),"."
"RTN","FBUTL8",96,0)
 ;I FBCNT>FBMAX D
"RTN","FBUTL8",97,0)
 ;. S FBERR=1
"RTN","FBUTL8",98,0)
 ;. W !,$C(7),"ERROR: Maximum number of adjustment reasons (",FBMAX,") have been exceeded."
"RTN","FBUTL8",99,0)
 ;I FBERR G ASKADJ
"RTN","FBUTL8",100,0)
 ;
"RTN","FBUTL8",101,0)
EXIT Q FBRET
"RTN","FBUTL8",102,0)
 ;
"RTN","FBUTL8",103,0)
DEL(FBI) ; delete Rendering Provider from list
"RTN","FBUTL8",104,0)
 K FBPROV(FBI)
"RTN","FBUTL8",105,0)
 W "   (reason deleted)"
"RTN","FBUTL8",106,0)
 Q
"RTN","FBUTL8",107,0)
 ;
"RTN","FBUTL8",108,0)
 ;FBUTL2
"RTN","FBUTL8",109,0)
FILERP(FBIENS,FBPROV) ; Routine to file Rendering Provider information to 162.5
"RTN","FBUTL8",110,0)
 ; 
"RTN","FBUTL8",111,0)
 ; Input
"RTN","FBUTL8",112,0)
 ;       IENS - Required - DA_"," for the record to save the Rendering Provider information to
"RTN","FBUTL8",113,0)
 ;       FBPROV - Required - Passed by reference array that contains the information to save
"RTN","FBUTL8",114,0)
 ;
"RTN","FBUTL8",115,0)
  ; Output
"RTN","FBUTL8",116,0)
 ;   Data in File 162.5 will be modified
"RTN","FBUTL8",117,0)
 ;
"RTN","FBUTL8",118,0)
 N FB,FBFDA,FBI
"RTN","FBUTL8",119,0)
 ;
"RTN","FBUTL8",120,0)
 ; delete remitance remarks currently on file
"RTN","FBUTL8",121,0)
 D GETS^DIQ(162.5,FBIENS,"79*","","FB")
"RTN","FBUTL8",122,0)
 K FBFDA
"RTN","FBUTL8",123,0)
 S FBSIENS="" F  S FBSIENS=$O(FB(162.579,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBUTL8",124,0)
 . S FBFDA(162.579,FBSIENS,.01)="@"
"RTN","FBUTL8",125,0)
 I $D(FBFDA) D FILE^DIE("","FBFDA")
"RTN","FBUTL8",126,0)
 ;
"RTN","FBUTL8",127,0)
 ; file remarks from input array
"RTN","FBUTL8",128,0)
 K FBFDA
"RTN","FBUTL8",129,0)
 S FBI=0 F  S FBI=$O(FBPROV(FBI)) Q:'FBI  D
"RTN","FBUTL8",130,0)
 . S FBFDA(162.579,"+"_FBI_","_FBIENS,.01)=FBI
"RTN","FBUTL8",131,0)
 . S FBFDA(162.579,"+"_FBI_","_FBIENS,.02)=$P(FBPROV(FBI),U)
"RTN","FBUTL8",132,0)
 . S FBFDA(162.579,"+"_FBI_","_FBIENS,.03)=$P(FBPROV(FBI),U,2)
"RTN","FBUTL8",133,0)
 . S FBFDA(162.579,"+"_FBI_","_FBIENS,.04)=$P(FBPROV(FBI),U,3)
"RTN","FBUTL8",134,0)
 I $D(FBFDA) D UPDATE^DIE("","FBFDA")
"RTN","FBUTL8",135,0)
 ;
"RTN","FBUTL8",136,0)
 Q
"RTN","FBUTL8",137,0)
LOADRP(FBIENS,FBPROV) ; Load Remittance Remarks
"RTN","FBUTL8",138,0)
 ; Input
"RTN","FBUTL8",139,0)
 ;   FBIENS -  required, internal entry numbers for subfile 162.5
"RTN","FBUTL8",140,0)
 ;             in standard format as specified for FileMan DBS calls
"RTN","FBUTL8",141,0)
 ;   FBRRMK - required, array passed by reference
"RTN","FBUTL8",142,0)
 ;             array to load adjustments into
"RTN","FBUTL8",143,0)
 ; Output
"RTN","FBUTL8",144,0)
 ;   FBPROV - the FBRRMK input array passed by reference will be modified
"RTN","FBUTL8",145,0)
 ;             format
"RTN","FBUTL8",146,0)
 ;               FBRRMK(#)=FBRRMKC
"RTN","FBUTL8",147,0)
 ;             where
"RTN","FBUTL8",148,0)
 ;               # = sequentially assigned number starting with 1
"RTN","FBUTL8",149,0)
 ;               FBRRMKC = remittance remark (internal value file 162.93)
"RTN","FBUTL8",150,0)
 ;             if no remarks are on file then the array will be undefined
"RTN","FBUTL8",151,0)
 N FB,FBC,FBSIENS
"RTN","FBUTL8",152,0)
 ;
"RTN","FBUTL8",153,0)
 K FBRRMK
"RTN","FBUTL8",154,0)
 ;
"RTN","FBUTL8",155,0)
 S FBC=0
"RTN","FBUTL8",156,0)
 D GETS^DIQ(162.5,FBIENS,"79*","I","FB")
"RTN","FBUTL8",157,0)
 S FBSIENS="" F  S FBSIENS=$O(FB(162.579,FBSIENS)) Q:FBSIENS=""  D
"RTN","FBUTL8",158,0)
 . S FBC=FB(162.579,FBSIENS,.01,"I")
"RTN","FBUTL8",159,0)
 . S FBPROV(FBC)=FB(162.579,FBSIENS,.02,"I")
"RTN","FBUTL8",160,0)
 . S $P(FBPROV(FBC),U,2)=FB(162.579,FBSIENS,.03,"I")
"RTN","FBUTL8",161,0)
 . S $P(FBPROV(FBC),U,3)=FB(162.579,FBSIENS,.04,"I")
"RTN","FBUTL8",162,0)
 ;
"RTN","FBUTL8",163,0)
 Q
"RTN","FBUTL8",164,0)
FILE ; Save file #162 Provider information
"RTN","FBUTL8",165,0)
 I $D(FBAAOUT) Q  ;If user enters '^' in previous save, do not try to save new fields
"RTN","FBUTL8",166,0)
 K DR S DR="58;59;60;61;62;63;64;65;66;67;76;77;78;79;68;69"
"RTN","FBUTL8",167,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"
"RTN","FBUTL8",168,0)
 S DA(2)=DFN,DA(1)=FBV,DA=FBSDI
"RTN","FBUTL8",169,0)
 D ^DIE
"RTN","FBUTL8",170,0)
 Q
"UP",162,162.02,-2)
162^1
"UP",162,162.02,-1)
162.01^1
"UP",162,162.02,0)
162.02
"VER")
8.0^22.0
"^DD",162,162.02,76,0)
SERVICING FACILITY ADDRESS^F^^4;1^K:$L(X)>60!($L(X)<1) X
"^DD",162,162.02,76,3)
Answer must be 1-60 characters in length.
"^DD",162,162.02,76,21,0)
^^2^2^3110628^
"^DD",162,162.02,76,21,1,0)
Enter the Servicing Facility street address found in the claim 
"^DD",162,162.02,76,21,2,0)
information.
"^DD",162,162.02,76,"DT")
3110616
"^DD",162,162.02,77,0)
SERVICING FACILITY CITY^F^^4;2^K:$L(X)>20!($L(X)<1) X
"^DD",162,162.02,77,3)
Answer must be 1-20 characters in length.
"^DD",162,162.02,77,21,0)
^^1^1^3110616^
"^DD",162,162.02,77,21,1,0)
Enter the Servicing Facility city found in the claim information.
"^DD",162,162.02,77,"DT")
3110616
"^DD",162,162.02,78,0)
SERVICING FACILITY STATE^P5'^DIC(5,^4;3^Q
"^DD",162,162.02,78,21,0)
^^1^1^3110628^
"^DD",162,162.02,78,21,1,0)
Enter the Servicing Facility state found in the claim information.
"^DD",162,162.02,78,"DT")
3110616
"^DD",162,162.02,79,0)
SERVICING FACILITY ZIP^FXO^^4;4^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>20!($L(X)<5) X I $D(X) D ZIPIN^VAFADDR
"^DD",162,162.02,79,2)
S Y(0)=Y D ZIPOUT^VAFADDR
"^DD",162,162.02,79,2.1)
D ZIPOUT^VAFADDR
"^DD",162,162.02,79,3)
Answer with either 5 digit or 9 digit zip code.
"^DD",162,162.02,79,21,0)
^^2^2^3110628^
"^DD",162,162.02,79,21,1,0)
Enter the Servicing Facility zip code, in either the 5 digit format (e.g. 
"^DD",162,162.02,79,21,2,0)
12345) or 9 digit format (e.g. 12345-6789 or 123456789).
"^DD",162,162.02,79,"DT")
3110616
"^DD",162.5,162.5,80,0)
SERVICING FACILITY ADDRESS^F^^5;1^K:$L(X)>60!($L(X)<1) X
"^DD",162.5,162.5,80,3)
Answer must be 1-60 characters in length.
"^DD",162.5,162.5,80,21,0)
^^2^2^3110616^
"^DD",162.5,162.5,80,21,1,0)
Enter the Servicing Facility street address found in the claim 
"^DD",162.5,162.5,80,21,2,0)
information.
"^DD",162.5,162.5,80,"DT")
3110616
"^DD",162.5,162.5,81,0)
SERVICING FACILITY CITY^F^^5;2^K:$L(X)>20!($L(X)<1) X
"^DD",162.5,162.5,81,3)
Answer must be 1-20 characters in length.
"^DD",162.5,162.5,81,21,0)
^^1^1^3110616^
"^DD",162.5,162.5,81,21,1,0)
Enter the Servicing Facility city found in the claim information.
"^DD",162.5,162.5,81,"DT")
3110616
"^DD",162.5,162.5,82,0)
SERVICING FACILITY STATE^P5'^DIC(5,^5;3^Q
"^DD",162.5,162.5,82,21,0)
^^1^1^3110616^
"^DD",162.5,162.5,82,21,1,0)
Enter the Servicing Facility state found in the claim information.
"^DD",162.5,162.5,82,"DT")
3110616
"^DD",162.5,162.5,83,0)
SERVICING FACILITY ZIP^FXO^^5;4^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>20!($L(X)<5) X I $D(X) D ZIPIN^VAFADDR
"^DD",162.5,162.5,83,2)
S Y(0)=Y D ZIPOUT^VAFADDR
"^DD",162.5,162.5,83,2.1)
D ZIPOUT^VAFADDR
"^DD",162.5,162.5,83,3)
Answer with either 5 digit or 9 digit zip code.
"^DD",162.5,162.5,83,21,0)
^^2^2^3110628^
"^DD",162.5,162.5,83,21,1,0)
Enter the Servicing Facility zip code, in either the 5 digit format (e.g.
"^DD",162.5,162.5,83,21,2,0)
12345) or 9 digit format (e.g. 12345-6789 or 123456789).
"^DD",162.5,162.5,83,"DT")
3110616
"BLD",8565,6)
^110
**END**
**END**
